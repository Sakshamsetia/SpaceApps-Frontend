function Bge(t,e){for(var i=0;i<e.length;i++){const r=e[i];if(typeof r!="string"&&!Array.isArray(r)){for(const n in r)if(n!=="default"&&!(n in t)){const s=Object.getOwnPropertyDescriptor(r,n);s&&Object.defineProperty(t,n,s.get?s:{enumerable:!0,get:()=>r[n]})}}}return Object.freeze(Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))r(n);new MutationObserver(n=>{for(const s of n)if(s.type==="childList")for(const a of s.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&r(a)}).observe(document,{childList:!0,subtree:!0});function i(n){const s={};return n.integrity&&(s.integrity=n.integrity),n.referrerPolicy&&(s.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?s.credentials="include":n.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(n){if(n.ep)return;n.ep=!0;const s=i(n);fetch(n.href,s)}})();var zC=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Lh(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function Fge(t){if(Object.prototype.hasOwnProperty.call(t,"__esModule"))return t;var e=t.default;if(typeof e=="function"){var i=function r(){return this instanceof r?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};i.prototype=e.prototype}else i={};return Object.defineProperty(i,"__esModule",{value:!0}),Object.keys(t).forEach(function(r){var n=Object.getOwnPropertyDescriptor(t,r);Object.defineProperty(i,r,n.get?n:{enumerable:!0,get:function(){return t[r]}})}),i}var uk={exports:{}},LS={},hk={exports:{}},xr={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var oW;function zge(){if(oW)return xr;oW=1;var t=Symbol.for("react.element"),e=Symbol.for("react.portal"),i=Symbol.for("react.fragment"),r=Symbol.for("react.strict_mode"),n=Symbol.for("react.profiler"),s=Symbol.for("react.provider"),a=Symbol.for("react.context"),o=Symbol.for("react.forward_ref"),l=Symbol.for("react.suspense"),c=Symbol.for("react.memo"),u=Symbol.for("react.lazy"),h=Symbol.iterator;function d(j){return j===null||typeof j!="object"?null:(j=h&&j[h]||j["@@iterator"],typeof j=="function"?j:null)}var f={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},p=Object.assign,g={};function m(j,ee,pe){this.props=j,this.context=ee,this.refs=g,this.updater=pe||f}m.prototype.isReactComponent={},m.prototype.setState=function(j,ee){if(typeof j!="object"&&typeof j!="function"&&j!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,j,ee,"setState")},m.prototype.forceUpdate=function(j){this.updater.enqueueForceUpdate(this,j,"forceUpdate")};function y(){}y.prototype=m.prototype;function b(j,ee,pe){this.props=j,this.context=ee,this.refs=g,this.updater=pe||f}var w=b.prototype=new y;w.constructor=b,p(w,m.prototype),w.isPureReactComponent=!0;var E=Array.isArray,M=Object.prototype.hasOwnProperty,A={current:null},P={key:!0,ref:!0,__self:!0,__source:!0};function C(j,ee,pe){var fe,se={},re=null,le=null;if(ee!=null)for(fe in ee.ref!==void 0&&(le=ee.ref),ee.key!==void 0&&(re=""+ee.key),ee)M.call(ee,fe)&&!P.hasOwnProperty(fe)&&(se[fe]=ee[fe]);var he=arguments.length-2;if(he===1)se.children=pe;else if(1<he){for(var ve=Array(he),xe=0;xe<he;xe++)ve[xe]=arguments[xe+2];se.children=ve}if(j&&j.defaultProps)for(fe in he=j.defaultProps,he)se[fe]===void 0&&(se[fe]=he[fe]);return{$$typeof:t,type:j,key:re,ref:le,props:se,_owner:A.current}}function R(j,ee){return{$$typeof:t,type:j.type,key:ee,ref:j.ref,props:j.props,_owner:j._owner}}function I(j){return typeof j=="object"&&j!==null&&j.$$typeof===t}function k(j){var ee={"=":"=0",":":"=2"};return"$"+j.replace(/[=:]/g,function(pe){return ee[pe]})}var z=/\/+/g;function V(j,ee){return typeof j=="object"&&j!==null&&j.key!=null?k(""+j.key):ee.toString(36)}function F(j,ee,pe,fe,se){var re=typeof j;(re==="undefined"||re==="boolean")&&(j=null);var le=!1;if(j===null)le=!0;else switch(re){case"string":case"number":le=!0;break;case"object":switch(j.$$typeof){case t:case e:le=!0}}if(le)return le=j,se=se(le),j=fe===""?"."+V(le,0):fe,E(se)?(pe="",j!=null&&(pe=j.replace(z,"$&/")+"/"),F(se,ee,pe,"",function(xe){return xe})):se!=null&&(I(se)&&(se=R(se,pe+(!se.key||le&&le.key===se.key?"":(""+se.key).replace(z,"$&/")+"/")+j)),ee.push(se)),1;if(le=0,fe=fe===""?".":fe+":",E(j))for(var he=0;he<j.length;he++){re=j[he];var ve=fe+V(re,he);le+=F(re,ee,pe,ve,se)}else if(ve=d(j),typeof ve=="function")for(j=ve.call(j),he=0;!(re=j.next()).done;)re=re.value,ve=fe+V(re,he++),le+=F(re,ee,pe,ve,se);else if(re==="object")throw ee=String(j),Error("Objects are not valid as a React child (found: "+(ee==="[object Object]"?"object with keys {"+Object.keys(j).join(", ")+"}":ee)+"). If you meant to render a collection of children, use an array instead.");return le}function $(j,ee,pe){if(j==null)return j;var fe=[],se=0;return F(j,fe,"","",function(re){return ee.call(pe,re,se++)}),fe}function K(j){if(j._status===-1){var ee=j._result;ee=ee(),ee.then(function(pe){(j._status===0||j._status===-1)&&(j._status=1,j._result=pe)},function(pe){(j._status===0||j._status===-1)&&(j._status=2,j._result=pe)}),j._status===-1&&(j._status=0,j._result=ee)}if(j._status===1)return j._result.default;throw j._result}var X={current:null},U={transition:null},Y={ReactCurrentDispatcher:X,ReactCurrentBatchConfig:U,ReactCurrentOwner:A};function Z(){throw Error("act(...) is not supported in production builds of React.")}return xr.Children={map:$,forEach:function(j,ee,pe){$(j,function(){ee.apply(this,arguments)},pe)},count:function(j){var ee=0;return $(j,function(){ee++}),ee},toArray:function(j){return $(j,function(ee){return ee})||[]},only:function(j){if(!I(j))throw Error("React.Children.only expected to receive a single React element child.");return j}},xr.Component=m,xr.Fragment=i,xr.Profiler=n,xr.PureComponent=b,xr.StrictMode=r,xr.Suspense=l,xr.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Y,xr.act=Z,xr.cloneElement=function(j,ee,pe){if(j==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+j+".");var fe=p({},j.props),se=j.key,re=j.ref,le=j._owner;if(ee!=null){if(ee.ref!==void 0&&(re=ee.ref,le=A.current),ee.key!==void 0&&(se=""+ee.key),j.type&&j.type.defaultProps)var he=j.type.defaultProps;for(ve in ee)M.call(ee,ve)&&!P.hasOwnProperty(ve)&&(fe[ve]=ee[ve]===void 0&&he!==void 0?he[ve]:ee[ve])}var ve=arguments.length-2;if(ve===1)fe.children=pe;else if(1<ve){he=Array(ve);for(var xe=0;xe<ve;xe++)he[xe]=arguments[xe+2];fe.children=he}return{$$typeof:t,type:j.type,key:se,ref:re,props:fe,_owner:le}},xr.createContext=function(j){return j={$$typeof:a,_currentValue:j,_currentValue2:j,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},j.Provider={$$typeof:s,_context:j},j.Consumer=j},xr.createElement=C,xr.createFactory=function(j){var ee=C.bind(null,j);return ee.type=j,ee},xr.createRef=function(){return{current:null}},xr.forwardRef=function(j){return{$$typeof:o,render:j}},xr.isValidElement=I,xr.lazy=function(j){return{$$typeof:u,_payload:{_status:-1,_result:j},_init:K}},xr.memo=function(j,ee){return{$$typeof:c,type:j,compare:ee===void 0?null:ee}},xr.startTransition=function(j){var ee=U.transition;U.transition={};try{j()}finally{U.transition=ee}},xr.unstable_act=Z,xr.useCallback=function(j,ee){return X.current.useCallback(j,ee)},xr.useContext=function(j){return X.current.useContext(j)},xr.useDebugValue=function(){},xr.useDeferredValue=function(j){return X.current.useDeferredValue(j)},xr.useEffect=function(j,ee){return X.current.useEffect(j,ee)},xr.useId=function(){return X.current.useId()},xr.useImperativeHandle=function(j,ee,pe){return X.current.useImperativeHandle(j,ee,pe)},xr.useInsertionEffect=function(j,ee){return X.current.useInsertionEffect(j,ee)},xr.useLayoutEffect=function(j,ee){return X.current.useLayoutEffect(j,ee)},xr.useMemo=function(j,ee){return X.current.useMemo(j,ee)},xr.useReducer=function(j,ee,pe){return X.current.useReducer(j,ee,pe)},xr.useRef=function(j){return X.current.useRef(j)},xr.useState=function(j){return X.current.useState(j)},xr.useSyncExternalStore=function(j,ee,pe){return X.current.useSyncExternalStore(j,ee,pe)},xr.useTransition=function(){return X.current.useTransition()},xr.version="18.3.1",xr}var lW;function ZM(){return lW||(lW=1,hk.exports=zge()),hk.exports}/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var cW;function jge(){if(cW)return LS;cW=1;var t=ZM(),e=Symbol.for("react.element"),i=Symbol.for("react.fragment"),r=Object.prototype.hasOwnProperty,n=t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,s={key:!0,ref:!0,__self:!0,__source:!0};function a(o,l,c){var u,h={},d=null,f=null;c!==void 0&&(d=""+c),l.key!==void 0&&(d=""+l.key),l.ref!==void 0&&(f=l.ref);for(u in l)r.call(l,u)&&!s.hasOwnProperty(u)&&(h[u]=l[u]);if(o&&o.defaultProps)for(u in l=o.defaultProps,l)h[u]===void 0&&(h[u]=l[u]);return{$$typeof:e,type:o,key:d,ref:f,props:h,_owner:n.current}}return LS.Fragment=i,LS.jsx=a,LS.jsxs=a,LS}var uW;function Vge(){return uW||(uW=1,uk.exports=jge()),uk.exports}var O=Vge(),J=ZM();const kt=Lh(J),cre=Bge({__proto__:null,default:kt},[J]);var jC={},dk={exports:{}},Nl={},fk={exports:{}},pk={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var hW;function Hge(){return hW||(hW=1,(function(t){function e(U,Y){var Z=U.length;U.push(Y);e:for(;0<Z;){var j=Z-1>>>1,ee=U[j];if(0<n(ee,Y))U[j]=Y,U[Z]=ee,Z=j;else break e}}function i(U){return U.length===0?null:U[0]}function r(U){if(U.length===0)return null;var Y=U[0],Z=U.pop();if(Z!==Y){U[0]=Z;e:for(var j=0,ee=U.length,pe=ee>>>1;j<pe;){var fe=2*(j+1)-1,se=U[fe],re=fe+1,le=U[re];if(0>n(se,Z))re<ee&&0>n(le,se)?(U[j]=le,U[re]=Z,j=re):(U[j]=se,U[fe]=Z,j=fe);else if(re<ee&&0>n(le,Z))U[j]=le,U[re]=Z,j=re;else break e}}return Y}function n(U,Y){var Z=U.sortIndex-Y.sortIndex;return Z!==0?Z:U.id-Y.id}if(typeof performance=="object"&&typeof performance.now=="function"){var s=performance;t.unstable_now=function(){return s.now()}}else{var a=Date,o=a.now();t.unstable_now=function(){return a.now()-o}}var l=[],c=[],u=1,h=null,d=3,f=!1,p=!1,g=!1,m=typeof setTimeout=="function"?setTimeout:null,y=typeof clearTimeout=="function"?clearTimeout:null,b=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function w(U){for(var Y=i(c);Y!==null;){if(Y.callback===null)r(c);else if(Y.startTime<=U)r(c),Y.sortIndex=Y.expirationTime,e(l,Y);else break;Y=i(c)}}function E(U){if(g=!1,w(U),!p)if(i(l)!==null)p=!0,K(M);else{var Y=i(c);Y!==null&&X(E,Y.startTime-U)}}function M(U,Y){p=!1,g&&(g=!1,y(C),C=-1),f=!0;var Z=d;try{for(w(Y),h=i(l);h!==null&&(!(h.expirationTime>Y)||U&&!k());){var j=h.callback;if(typeof j=="function"){h.callback=null,d=h.priorityLevel;var ee=j(h.expirationTime<=Y);Y=t.unstable_now(),typeof ee=="function"?h.callback=ee:h===i(l)&&r(l),w(Y)}else r(l);h=i(l)}if(h!==null)var pe=!0;else{var fe=i(c);fe!==null&&X(E,fe.startTime-Y),pe=!1}return pe}finally{h=null,d=Z,f=!1}}var A=!1,P=null,C=-1,R=5,I=-1;function k(){return!(t.unstable_now()-I<R)}function z(){if(P!==null){var U=t.unstable_now();I=U;var Y=!0;try{Y=P(!0,U)}finally{Y?V():(A=!1,P=null)}}else A=!1}var V;if(typeof b=="function")V=function(){b(z)};else if(typeof MessageChannel<"u"){var F=new MessageChannel,$=F.port2;F.port1.onmessage=z,V=function(){$.postMessage(null)}}else V=function(){m(z,0)};function K(U){P=U,A||(A=!0,V())}function X(U,Y){C=m(function(){U(t.unstable_now())},Y)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(U){U.callback=null},t.unstable_continueExecution=function(){p||f||(p=!0,K(M))},t.unstable_forceFrameRate=function(U){0>U||125<U?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):R=0<U?Math.floor(1e3/U):5},t.unstable_getCurrentPriorityLevel=function(){return d},t.unstable_getFirstCallbackNode=function(){return i(l)},t.unstable_next=function(U){switch(d){case 1:case 2:case 3:var Y=3;break;default:Y=d}var Z=d;d=Y;try{return U()}finally{d=Z}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(U,Y){switch(U){case 1:case 2:case 3:case 4:case 5:break;default:U=3}var Z=d;d=U;try{return Y()}finally{d=Z}},t.unstable_scheduleCallback=function(U,Y,Z){var j=t.unstable_now();switch(typeof Z=="object"&&Z!==null?(Z=Z.delay,Z=typeof Z=="number"&&0<Z?j+Z:j):Z=j,U){case 1:var ee=-1;break;case 2:ee=250;break;case 5:ee=1073741823;break;case 4:ee=1e4;break;default:ee=5e3}return ee=Z+ee,U={id:u++,callback:Y,priorityLevel:U,startTime:Z,expirationTime:ee,sortIndex:-1},Z>j?(U.sortIndex=Z,e(c,U),i(l)===null&&U===i(c)&&(g?(y(C),C=-1):g=!0,X(E,Z-j))):(U.sortIndex=ee,e(l,U),p||f||(p=!0,K(M))),U},t.unstable_shouldYield=k,t.unstable_wrapCallback=function(U){var Y=d;return function(){var Z=d;d=Y;try{return U.apply(this,arguments)}finally{d=Z}}}})(pk)),pk}var dW;function Gge(){return dW||(dW=1,fk.exports=Hge()),fk.exports}/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var fW;function Wge(){if(fW)return Nl;fW=1;var t=ZM(),e=Gge();function i(v){for(var x="https://reactjs.org/docs/error-decoder.html?invariant="+v,T=1;T<arguments.length;T++)x+="&args[]="+encodeURIComponent(arguments[T]);return"Minified React error #"+v+"; visit "+x+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var r=new Set,n={};function s(v,x){a(v,x),a(v+"Capture",x)}function a(v,x){for(n[v]=x,v=0;v<x.length;v++)r.add(x[v])}var o=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),l=Object.prototype.hasOwnProperty,c=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,u={},h={};function d(v){return l.call(h,v)?!0:l.call(u,v)?!1:c.test(v)?h[v]=!0:(u[v]=!0,!1)}function f(v,x,T,L){if(T!==null&&T.type===0)return!1;switch(typeof x){case"function":case"symbol":return!0;case"boolean":return L?!1:T!==null?!T.acceptsBooleans:(v=v.toLowerCase().slice(0,5),v!=="data-"&&v!=="aria-");default:return!1}}function p(v,x,T,L){if(x===null||typeof x>"u"||f(v,x,T,L))return!0;if(L)return!1;if(T!==null)switch(T.type){case 3:return!x;case 4:return x===!1;case 5:return isNaN(x);case 6:return isNaN(x)||1>x}return!1}function g(v,x,T,L,B,q,ue){this.acceptsBooleans=x===2||x===3||x===4,this.attributeName=L,this.attributeNamespace=B,this.mustUseProperty=T,this.propertyName=v,this.type=x,this.sanitizeURL=q,this.removeEmptyString=ue}var m={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(v){m[v]=new g(v,0,!1,v,null,!1,!1)}),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(v){var x=v[0];m[x]=new g(x,1,!1,v[1],null,!1,!1)}),["contentEditable","draggable","spellCheck","value"].forEach(function(v){m[v]=new g(v,2,!1,v.toLowerCase(),null,!1,!1)}),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(v){m[v]=new g(v,2,!1,v,null,!1,!1)}),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(v){m[v]=new g(v,3,!1,v.toLowerCase(),null,!1,!1)}),["checked","multiple","muted","selected"].forEach(function(v){m[v]=new g(v,3,!0,v,null,!1,!1)}),["capture","download"].forEach(function(v){m[v]=new g(v,4,!1,v,null,!1,!1)}),["cols","rows","size","span"].forEach(function(v){m[v]=new g(v,6,!1,v,null,!1,!1)}),["rowSpan","start"].forEach(function(v){m[v]=new g(v,5,!1,v.toLowerCase(),null,!1,!1)});var y=/[\-:]([a-z])/g;function b(v){return v[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(v){var x=v.replace(y,b);m[x]=new g(x,1,!1,v,null,!1,!1)}),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(v){var x=v.replace(y,b);m[x]=new g(x,1,!1,v,"http://www.w3.org/1999/xlink",!1,!1)}),["xml:base","xml:lang","xml:space"].forEach(function(v){var x=v.replace(y,b);m[x]=new g(x,1,!1,v,"http://www.w3.org/XML/1998/namespace",!1,!1)}),["tabIndex","crossOrigin"].forEach(function(v){m[v]=new g(v,1,!1,v.toLowerCase(),null,!1,!1)}),m.xlinkHref=new g("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach(function(v){m[v]=new g(v,1,!1,v.toLowerCase(),null,!0,!0)});function w(v,x,T,L){var B=m.hasOwnProperty(x)?m[x]:null;(B!==null?B.type!==0:L||!(2<x.length)||x[0]!=="o"&&x[0]!=="O"||x[1]!=="n"&&x[1]!=="N")&&(p(x,T,B,L)&&(T=null),L||B===null?d(x)&&(T===null?v.removeAttribute(x):v.setAttribute(x,""+T)):B.mustUseProperty?v[B.propertyName]=T===null?B.type===3?!1:"":T:(x=B.attributeName,L=B.attributeNamespace,T===null?v.removeAttribute(x):(B=B.type,T=B===3||B===4&&T===!0?"":""+T,L?v.setAttributeNS(L,x,T):v.setAttribute(x,T))))}var E=t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,M=Symbol.for("react.element"),A=Symbol.for("react.portal"),P=Symbol.for("react.fragment"),C=Symbol.for("react.strict_mode"),R=Symbol.for("react.profiler"),I=Symbol.for("react.provider"),k=Symbol.for("react.context"),z=Symbol.for("react.forward_ref"),V=Symbol.for("react.suspense"),F=Symbol.for("react.suspense_list"),$=Symbol.for("react.memo"),K=Symbol.for("react.lazy"),X=Symbol.for("react.offscreen"),U=Symbol.iterator;function Y(v){return v===null||typeof v!="object"?null:(v=U&&v[U]||v["@@iterator"],typeof v=="function"?v:null)}var Z=Object.assign,j;function ee(v){if(j===void 0)try{throw Error()}catch(T){var x=T.stack.trim().match(/\n( *(at )?)/);j=x&&x[1]||""}return`
`+j+v}var pe=!1;function fe(v,x){if(!v||pe)return"";pe=!0;var T=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(x)if(x=function(){throw Error()},Object.defineProperty(x.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(x,[])}catch(lt){var L=lt}Reflect.construct(v,[],x)}else{try{x.call()}catch(lt){L=lt}v.call(x.prototype)}else{try{throw Error()}catch(lt){L=lt}v()}}catch(lt){if(lt&&L&&typeof lt.stack=="string"){for(var B=lt.stack.split(`
`),q=L.stack.split(`
`),ue=B.length-1,Me=q.length-1;1<=ue&&0<=Me&&B[ue]!==q[Me];)Me--;for(;1<=ue&&0<=Me;ue--,Me--)if(B[ue]!==q[Me]){if(ue!==1||Me!==1)do if(ue--,Me--,0>Me||B[ue]!==q[Me]){var Oe=`
`+B[ue].replace(" at new "," at ");return v.displayName&&Oe.includes("<anonymous>")&&(Oe=Oe.replace("<anonymous>",v.displayName)),Oe}while(1<=ue&&0<=Me);break}}}finally{pe=!1,Error.prepareStackTrace=T}return(v=v?v.displayName||v.name:"")?ee(v):""}function se(v){switch(v.tag){case 5:return ee(v.type);case 16:return ee("Lazy");case 13:return ee("Suspense");case 19:return ee("SuspenseList");case 0:case 2:case 15:return v=fe(v.type,!1),v;case 11:return v=fe(v.type.render,!1),v;case 1:return v=fe(v.type,!0),v;default:return""}}function re(v){if(v==null)return null;if(typeof v=="function")return v.displayName||v.name||null;if(typeof v=="string")return v;switch(v){case P:return"Fragment";case A:return"Portal";case R:return"Profiler";case C:return"StrictMode";case V:return"Suspense";case F:return"SuspenseList"}if(typeof v=="object")switch(v.$$typeof){case k:return(v.displayName||"Context")+".Consumer";case I:return(v._context.displayName||"Context")+".Provider";case z:var x=v.render;return v=v.displayName,v||(v=x.displayName||x.name||"",v=v!==""?"ForwardRef("+v+")":"ForwardRef"),v;case $:return x=v.displayName||null,x!==null?x:re(v.type)||"Memo";case K:x=v._payload,v=v._init;try{return re(v(x))}catch{}}return null}function le(v){var x=v.type;switch(v.tag){case 24:return"Cache";case 9:return(x.displayName||"Context")+".Consumer";case 10:return(x._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return v=x.render,v=v.displayName||v.name||"",x.displayName||(v!==""?"ForwardRef("+v+")":"ForwardRef");case 7:return"Fragment";case 5:return x;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return re(x);case 8:return x===C?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof x=="function")return x.displayName||x.name||null;if(typeof x=="string")return x}return null}function he(v){switch(typeof v){case"boolean":case"number":case"string":case"undefined":return v;case"object":return v;default:return""}}function ve(v){var x=v.type;return(v=v.nodeName)&&v.toLowerCase()==="input"&&(x==="checkbox"||x==="radio")}function xe(v){var x=ve(v)?"checked":"value",T=Object.getOwnPropertyDescriptor(v.constructor.prototype,x),L=""+v[x];if(!v.hasOwnProperty(x)&&typeof T<"u"&&typeof T.get=="function"&&typeof T.set=="function"){var B=T.get,q=T.set;return Object.defineProperty(v,x,{configurable:!0,get:function(){return B.call(this)},set:function(ue){L=""+ue,q.call(this,ue)}}),Object.defineProperty(v,x,{enumerable:T.enumerable}),{getValue:function(){return L},setValue:function(ue){L=""+ue},stopTracking:function(){v._valueTracker=null,delete v[x]}}}}function Se(v){v._valueTracker||(v._valueTracker=xe(v))}function Ce(v){if(!v)return!1;var x=v._valueTracker;if(!x)return!0;var T=x.getValue(),L="";return v&&(L=ve(v)?v.checked?"true":"false":v.value),v=L,v!==T?(x.setValue(v),!0):!1}function ce(v){if(v=v||(typeof document<"u"?document:void 0),typeof v>"u")return null;try{return v.activeElement||v.body}catch{return v.body}}function Fe(v,x){var T=x.checked;return Z({},x,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:T??v._wrapperState.initialChecked})}function De(v,x){var T=x.defaultValue==null?"":x.defaultValue,L=x.checked!=null?x.checked:x.defaultChecked;T=he(x.value!=null?x.value:T),v._wrapperState={initialChecked:L,initialValue:T,controlled:x.type==="checkbox"||x.type==="radio"?x.checked!=null:x.value!=null}}function He(v,x){x=x.checked,x!=null&&w(v,"checked",x,!1)}function Be(v,x){He(v,x);var T=he(x.value),L=x.type;if(T!=null)L==="number"?(T===0&&v.value===""||v.value!=T)&&(v.value=""+T):v.value!==""+T&&(v.value=""+T);else if(L==="submit"||L==="reset"){v.removeAttribute("value");return}x.hasOwnProperty("value")?ze(v,x.type,T):x.hasOwnProperty("defaultValue")&&ze(v,x.type,he(x.defaultValue)),x.checked==null&&x.defaultChecked!=null&&(v.defaultChecked=!!x.defaultChecked)}function $e(v,x,T){if(x.hasOwnProperty("value")||x.hasOwnProperty("defaultValue")){var L=x.type;if(!(L!=="submit"&&L!=="reset"||x.value!==void 0&&x.value!==null))return;x=""+v._wrapperState.initialValue,T||x===v.value||(v.value=x),v.defaultValue=x}T=v.name,T!==""&&(v.name=""),v.defaultChecked=!!v._wrapperState.initialChecked,T!==""&&(v.name=T)}function ze(v,x,T){(x!=="number"||ce(v.ownerDocument)!==v)&&(T==null?v.defaultValue=""+v._wrapperState.initialValue:v.defaultValue!==""+T&&(v.defaultValue=""+T))}var it=Array.isArray;function wt(v,x,T,L){if(v=v.options,x){x={};for(var B=0;B<T.length;B++)x["$"+T[B]]=!0;for(T=0;T<v.length;T++)B=x.hasOwnProperty("$"+v[T].value),v[T].selected!==B&&(v[T].selected=B),B&&L&&(v[T].defaultSelected=!0)}else{for(T=""+he(T),x=null,B=0;B<v.length;B++){if(v[B].value===T){v[B].selected=!0,L&&(v[B].defaultSelected=!0);return}x!==null||v[B].disabled||(x=v[B])}x!==null&&(x.selected=!0)}}function ge(v,x){if(x.dangerouslySetInnerHTML!=null)throw Error(i(91));return Z({},x,{value:void 0,defaultValue:void 0,children:""+v._wrapperState.initialValue})}function G(v,x){var T=x.value;if(T==null){if(T=x.children,x=x.defaultValue,T!=null){if(x!=null)throw Error(i(92));if(it(T)){if(1<T.length)throw Error(i(93));T=T[0]}x=T}x==null&&(x=""),T=x}v._wrapperState={initialValue:he(T)}}function Q(v,x){var T=he(x.value),L=he(x.defaultValue);T!=null&&(T=""+T,T!==v.value&&(v.value=T),x.defaultValue==null&&v.defaultValue!==T&&(v.defaultValue=T)),L!=null&&(v.defaultValue=""+L)}function we(v){var x=v.textContent;x===v._wrapperState.initialValue&&x!==""&&x!==null&&(v.value=x)}function te(v){switch(v){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Ne(v,x){return v==null||v==="http://www.w3.org/1999/xhtml"?te(x):v==="http://www.w3.org/2000/svg"&&x==="foreignObject"?"http://www.w3.org/1999/xhtml":v}var Le,at=(function(v){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(x,T,L,B){MSApp.execUnsafeLocalFunction(function(){return v(x,T,L,B)})}:v})(function(v,x){if(v.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in v)v.innerHTML=x;else{for(Le=Le||document.createElement("div"),Le.innerHTML="<svg>"+x.valueOf().toString()+"</svg>",x=Le.firstChild;v.firstChild;)v.removeChild(v.firstChild);for(;x.firstChild;)v.appendChild(x.firstChild)}});function Te(v,x){if(x){var T=v.firstChild;if(T&&T===v.lastChild&&T.nodeType===3){T.nodeValue=x;return}}v.textContent=x}var dt={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},ot=["Webkit","ms","Moz","O"];Object.keys(dt).forEach(function(v){ot.forEach(function(x){x=x+v.charAt(0).toUpperCase()+v.substring(1),dt[x]=dt[v]})});function Qe(v,x,T){return x==null||typeof x=="boolean"||x===""?"":T||typeof x!="number"||x===0||dt.hasOwnProperty(v)&&dt[v]?(""+x).trim():x+"px"}function pt(v,x){v=v.style;for(var T in x)if(x.hasOwnProperty(T)){var L=T.indexOf("--")===0,B=Qe(T,x[T],L);T==="float"&&(T="cssFloat"),L?v.setProperty(T,B):v[T]=B}}var _t=Z({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function yt(v,x){if(x){if(_t[v]&&(x.children!=null||x.dangerouslySetInnerHTML!=null))throw Error(i(137,v));if(x.dangerouslySetInnerHTML!=null){if(x.children!=null)throw Error(i(60));if(typeof x.dangerouslySetInnerHTML!="object"||!("__html"in x.dangerouslySetInnerHTML))throw Error(i(61))}if(x.style!=null&&typeof x.style!="object")throw Error(i(62))}}function Et(v,x){if(v.indexOf("-")===-1)return typeof x.is=="string";switch(v){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var $t=null;function oe(v){return v=v.target||v.srcElement||window,v.correspondingUseElement&&(v=v.correspondingUseElement),v.nodeType===3?v.parentNode:v}var Re=null,ke=null,st=null;function rt(v){if(v=Lu(v)){if(typeof Re!="function")throw Error(i(280));var x=v.stateNode;x&&(x=Dx(x),Re(v.stateNode,v.type,x))}}function je(v){ke?st?st.push(v):st=[v]:ke=v}function Tt(){if(ke){var v=ke,x=st;if(st=ke=null,rt(v),x)for(v=0;v<x.length;v++)rt(x[v])}}function Ft(v,x){return v(x)}function wi(){}var ti=!1;function Zi(v,x,T){if(ti)return v(x,T);ti=!0;try{return Ft(v,x,T)}finally{ti=!1,(ke!==null||st!==null)&&(wi(),Tt())}}function Xi(v,x){var T=v.stateNode;if(T===null)return null;var L=Dx(T);if(L===null)return null;T=L[x];e:switch(x){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(L=!L.disabled)||(v=v.type,L=!(v==="button"||v==="input"||v==="select"||v==="textarea")),v=!L;break e;default:v=!1}if(v)return null;if(T&&typeof T!="function")throw Error(i(231,x,typeof T));return T}var As=!1;if(o)try{var Gr={};Object.defineProperty(Gr,"passive",{get:function(){As=!0}}),window.addEventListener("test",Gr,Gr),window.removeEventListener("test",Gr,Gr)}catch{As=!1}function Nn(v,x,T,L,B,q,ue,Me,Oe){var lt=Array.prototype.slice.call(arguments,3);try{x.apply(T,lt)}catch(Pt){this.onError(Pt)}}var us=!1,ye=null,Xe=!1,ht=null,qe={onError:function(v){us=!0,ye=v}};function gt(v,x,T,L,B,q,ue,Me,Oe){us=!1,ye=null,Nn.apply(qe,arguments)}function Zt(v,x,T,L,B,q,ue,Me,Oe){if(gt.apply(this,arguments),us){if(us){var lt=ye;us=!1,ye=null}else throw Error(i(198));Xe||(Xe=!0,ht=lt)}}function yi(v){var x=v,T=v;if(v.alternate)for(;x.return;)x=x.return;else{v=x;do x=v,(x.flags&4098)!==0&&(T=x.return),v=x.return;while(v)}return x.tag===3?T:null}function Ti(v){if(v.tag===13){var x=v.memoizedState;if(x===null&&(v=v.alternate,v!==null&&(x=v.memoizedState)),x!==null)return x.dehydrated}return null}function fi(v){if(yi(v)!==v)throw Error(i(188))}function vr(v){var x=v.alternate;if(!x){if(x=yi(v),x===null)throw Error(i(188));return x!==v?null:v}for(var T=v,L=x;;){var B=T.return;if(B===null)break;var q=B.alternate;if(q===null){if(L=B.return,L!==null){T=L;continue}break}if(B.child===q.child){for(q=B.child;q;){if(q===T)return fi(B),v;if(q===L)return fi(B),x;q=q.sibling}throw Error(i(188))}if(T.return!==L.return)T=B,L=q;else{for(var ue=!1,Me=B.child;Me;){if(Me===T){ue=!0,T=B,L=q;break}if(Me===L){ue=!0,L=B,T=q;break}Me=Me.sibling}if(!ue){for(Me=q.child;Me;){if(Me===T){ue=!0,T=q,L=B;break}if(Me===L){ue=!0,L=q,T=B;break}Me=Me.sibling}if(!ue)throw Error(i(189))}}if(T.alternate!==L)throw Error(i(190))}if(T.tag!==3)throw Error(i(188));return T.stateNode.current===T?v:x}function ji(v){return v=vr(v),v!==null?Vi(v):null}function Vi(v){if(v.tag===5||v.tag===6)return v;for(v=v.child;v!==null;){var x=Vi(v);if(x!==null)return x;v=v.sibling}return null}var de=e.unstable_scheduleCallback,Ue=e.unstable_cancelCallback,Je=e.unstable_shouldYield,nt=e.unstable_requestPaint,Ie=e.unstable_now,ft=e.unstable_getCurrentPriorityLevel,Dt=e.unstable_ImmediatePriority,Mt=e.unstable_UserBlockingPriority,Vt=e.unstable_NormalPriority,di=e.unstable_LowPriority,si=e.unstable_IdlePriority,Wt=null,ne=null;function ae(v){if(ne&&typeof ne.onCommitFiberRoot=="function")try{ne.onCommitFiberRoot(Wt,v,void 0,(v.current.flags&128)===128)}catch{}}var _e=Math.clz32?Math.clz32:Ze,me=Math.log,Pe=Math.LN2;function Ze(v){return v>>>=0,v===0?32:31-(me(v)/Pe|0)|0}var Qi=64,_i=4194304;function nn(v){switch(v&-v){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return v&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return v&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return v}}function Sa(v,x){var T=v.pendingLanes;if(T===0)return 0;var L=0,B=v.suspendedLanes,q=v.pingedLanes,ue=T&268435455;if(ue!==0){var Me=ue&~B;Me!==0?L=nn(Me):(q&=ue,q!==0&&(L=nn(q)))}else ue=T&~B,ue!==0?L=nn(ue):q!==0&&(L=nn(q));if(L===0)return 0;if(x!==0&&x!==L&&(x&B)===0&&(B=L&-L,q=x&-x,B>=q||B===16&&(q&4194240)!==0))return x;if((L&4)!==0&&(L|=T&16),x=v.entangledLanes,x!==0)for(v=v.entanglements,x&=L;0<x;)T=31-_e(x),B=1<<T,L|=v[T],x&=~B;return L}function Hn(v,x){switch(v){case 1:case 2:case 4:return x+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return x+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Eo(v,x){for(var T=v.suspendedLanes,L=v.pingedLanes,B=v.expirationTimes,q=v.pendingLanes;0<q;){var ue=31-_e(q),Me=1<<ue,Oe=B[ue];Oe===-1?((Me&T)===0||(Me&L)!==0)&&(B[ue]=Hn(Me,x)):Oe<=x&&(v.expiredLanes|=Me),q&=~Me}}function $r(v){return v=v.pendingLanes&-1073741825,v!==0?v:v&1073741824?1073741824:0}function bn(){var v=Qi;return Qi<<=1,(Qi&4194240)===0&&(Qi=64),v}function Ea(v){for(var x=[],T=0;31>T;T++)x.push(v);return x}function Gn(v,x,T){v.pendingLanes|=x,x!==536870912&&(v.suspendedLanes=0,v.pingedLanes=0),v=v.eventTimes,x=31-_e(x),v[x]=T}function Aa(v,x){var T=v.pendingLanes&~x;v.pendingLanes=x,v.suspendedLanes=0,v.pingedLanes=0,v.expiredLanes&=x,v.mutableReadLanes&=x,v.entangledLanes&=x,x=v.entanglements;var L=v.eventTimes;for(v=v.expirationTimes;0<T;){var B=31-_e(T),q=1<<B;x[B]=0,L[B]=-1,v[B]=-1,T&=~q}}function Fc(v,x){var T=v.entangledLanes|=x;for(v=v.entanglements;T;){var L=31-_e(T),B=1<<L;B&x|v[L]&x&&(v[L]|=x),T&=~B}}var cr=0;function im(v){return v&=-v,1<v?4<v?(v&268435455)!==0?16:536870912:4:1}var bv,z_,$T,ex,tx,df=!1,ix=[],zc=null,fr=null,Mu=null,ff=new Map,rm=new Map,zh=[],kL="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function hs(v,x){switch(v){case"focusin":case"focusout":zc=null;break;case"dragenter":case"dragleave":fr=null;break;case"mouseover":case"mouseout":Mu=null;break;case"pointerover":case"pointerout":ff.delete(x.pointerId);break;case"gotpointercapture":case"lostpointercapture":rm.delete(x.pointerId)}}function pf(v,x,T,L,B,q){return v===null||v.nativeEvent!==q?(v={blockedOn:x,domEventName:T,eventSystemFlags:L,nativeEvent:q,targetContainers:[B]},x!==null&&(x=Lu(x),x!==null&&z_(x)),v):(v.eventSystemFlags|=L,x=v.targetContainers,B!==null&&x.indexOf(B)===-1&&x.push(B),v)}function NL(v,x,T,L,B){switch(x){case"focusin":return zc=pf(zc,v,x,T,L,B),!0;case"dragenter":return fr=pf(fr,v,x,T,L,B),!0;case"mouseover":return Mu=pf(Mu,v,x,T,L,B),!0;case"pointerover":var q=B.pointerId;return ff.set(q,pf(ff.get(q)||null,v,x,T,L,B)),!0;case"gotpointercapture":return q=B.pointerId,rm.set(q,pf(rm.get(q)||null,v,x,T,L,B)),!0}return!1}function rx(v){var x=Xh(v.target);if(x!==null){var T=yi(x);if(T!==null){if(x=T.tag,x===13){if(x=Ti(T),x!==null){v.blockedOn=x,tx(v.priority,function(){$T(T)});return}}else if(x===3&&T.stateNode.current.memoizedState.isDehydrated){v.blockedOn=T.tag===3?T.stateNode.containerInfo:null;return}}}v.blockedOn=null}function nx(v){if(v.blockedOn!==null)return!1;for(var x=v.targetContainers;0<x.length;){var T=Ml(v.domEventName,v.eventSystemFlags,x[0],v.nativeEvent);if(T===null){T=v.nativeEvent;var L=new T.constructor(T.type,T);$t=L,T.target.dispatchEvent(L),$t=null}else return x=Lu(T),x!==null&&z_(x),v.blockedOn=T,!1;x.shift()}return!0}function wv(v,x,T){nx(v)&&T.delete(x)}function jc(){df=!1,zc!==null&&nx(zc)&&(zc=null),fr!==null&&nx(fr)&&(fr=null),Mu!==null&&nx(Mu)&&(Mu=null),ff.forEach(wv),rm.forEach(wv)}function _v(v,x){v.blockedOn===x&&(v.blockedOn=null,df||(df=!0,e.unstable_scheduleCallback(e.unstable_NormalPriority,jc)))}function Sv(v){function x(B){return _v(B,v)}if(0<ix.length){_v(ix[0],v);for(var T=1;T<ix.length;T++){var L=ix[T];L.blockedOn===v&&(L.blockedOn=null)}}for(zc!==null&&_v(zc,v),fr!==null&&_v(fr,v),Mu!==null&&_v(Mu,v),ff.forEach(x),rm.forEach(x),T=0;T<zh.length;T++)L=zh[T],L.blockedOn===v&&(L.blockedOn=null);for(;0<zh.length&&(T=zh[0],T.blockedOn===null);)rx(T),T.blockedOn===null&&zh.shift()}var Ja=E.ReactCurrentBatchConfig,Al=!0;function sx(v,x,T,L){var B=cr,q=Ja.transition;Ja.transition=null;try{cr=1,ax(v,x,T,L)}finally{cr=B,Ja.transition=q}}function j_(v,x,T,L){var B=cr,q=Ja.transition;Ja.transition=null;try{cr=4,ax(v,x,T,L)}finally{cr=B,Ja.transition=q}}function ax(v,x,T,L){if(Al){var B=Ml(v,x,T,L);if(B===null)Mx(v,x,L,ox,T),hs(v,L);else if(NL(B,v,x,T,L))L.stopPropagation();else if(hs(v,L),x&4&&-1<kL.indexOf(v)){for(;B!==null;){var q=Lu(B);if(q!==null&&bv(q),q=Ml(v,x,T,L),q===null&&Mx(v,x,L,ox,T),q===B)break;B=q}B!==null&&L.stopPropagation()}else Mx(v,x,L,null,T)}}var ox=null;function Ml(v,x,T,L){if(ox=null,v=oe(L),v=Xh(v),v!==null)if(x=yi(v),x===null)v=null;else if(T=x.tag,T===13){if(v=Ti(x),v!==null)return v;v=null}else if(T===3){if(x.stateNode.current.memoizedState.isDehydrated)return x.tag===3?x.stateNode.containerInfo:null;v=null}else x!==v&&(v=null);return ox=v,null}function YT(v){switch(v){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(ft()){case Dt:return 1;case Mt:return 4;case Vt:case di:return 16;case si:return 536870912;default:return 16}default:return 16}}var hc=null,V_=null,Ao=null;function Ev(){if(Ao)return Ao;var v,x=V_,T=x.length,L,B="value"in hc?hc.value:hc.textContent,q=B.length;for(v=0;v<T&&x[v]===B[v];v++);var ue=T-v;for(L=1;L<=ue&&x[T-L]===B[q-L];L++);return Ao=B.slice(v,1<L?1-L:void 0)}function mf(v){var x=v.keyCode;return"charCode"in v?(v=v.charCode,v===0&&x===13&&(v=13)):v=x,v===10&&(v=13),32<=v||v===13?v:0}function Tu(){return!0}function lx(){return!1}function eo(v){function x(T,L,B,q,ue){this._reactName=T,this._targetInst=B,this.type=L,this.nativeEvent=q,this.target=ue,this.currentTarget=null;for(var Me in v)v.hasOwnProperty(Me)&&(T=v[Me],this[Me]=T?T(q):q[Me]);return this.isDefaultPrevented=(q.defaultPrevented!=null?q.defaultPrevented:q.returnValue===!1)?Tu:lx,this.isPropagationStopped=lx,this}return Z(x.prototype,{preventDefault:function(){this.defaultPrevented=!0;var T=this.nativeEvent;T&&(T.preventDefault?T.preventDefault():typeof T.returnValue!="unknown"&&(T.returnValue=!1),this.isDefaultPrevented=Tu)},stopPropagation:function(){var T=this.nativeEvent;T&&(T.stopPropagation?T.stopPropagation():typeof T.cancelBubble!="unknown"&&(T.cancelBubble=!0),this.isPropagationStopped=Tu)},persist:function(){},isPersistent:Tu}),x}var gf={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(v){return v.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Av=eo(gf),vf=Z({},gf,{view:0,detail:0}),nm=eo(vf),Mo,Tl,Cl,sm=Z({},vf,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Vh,button:0,buttons:0,relatedTarget:function(v){return v.relatedTarget===void 0?v.fromElement===v.srcElement?v.toElement:v.fromElement:v.relatedTarget},movementX:function(v){return"movementX"in v?v.movementX:(v!==Cl&&(Cl&&v.type==="mousemove"?(Mo=v.screenX-Cl.screenX,Tl=v.screenY-Cl.screenY):Tl=Mo=0,Cl=v),Mo)},movementY:function(v){return"movementY"in v?v.movementY:Tl}}),H_=eo(sm),Cu=Z({},sm,{dataTransfer:0}),jh=eo(Cu),cx=Z({},vf,{relatedTarget:0}),ux=eo(cx),hx=Z({},gf,{animationName:0,elapsedTime:0,pseudoElement:0}),KT=eo(hx),ZT=Z({},gf,{clipboardData:function(v){return"clipboardData"in v?v.clipboardData:window.clipboardData}}),G_=eo(ZT),dx=Z({},gf,{data:0}),W_=eo(dx),QT={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},JT={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},q_={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function am(v){var x=this.nativeEvent;return x.getModifierState?x.getModifierState(v):(v=q_[v])?!!x[v]:!1}function Vh(){return am}var fx=Z({},vf,{key:function(v){if(v.key){var x=QT[v.key]||v.key;if(x!=="Unidentified")return x}return v.type==="keypress"?(v=mf(v),v===13?"Enter":String.fromCharCode(v)):v.type==="keydown"||v.type==="keyup"?JT[v.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Vh,charCode:function(v){return v.type==="keypress"?mf(v):0},keyCode:function(v){return v.type==="keydown"||v.type==="keyup"?v.keyCode:0},which:function(v){return v.type==="keypress"?mf(v):v.type==="keydown"||v.type==="keyup"?v.keyCode:0}}),px=eo(fx),Pl=Z({},sm,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),qo=eo(Pl),yf=Z({},vf,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Vh}),Pu=eo(yf),Ru=Z({},gf,{propertyName:0,elapsedTime:0,pseudoElement:0}),xf=eo(Ru),eC=Z({},sm,{deltaX:function(v){return"deltaX"in v?v.deltaX:"wheelDeltaX"in v?-v.wheelDeltaX:0},deltaY:function(v){return"deltaY"in v?v.deltaY:"wheelDeltaY"in v?-v.wheelDeltaY:"wheelDelta"in v?-v.wheelDelta:0},deltaZ:0,deltaMode:0}),X_=eo(eC),$_=[9,13,27,32],to=o&&"CompositionEvent"in window,$s=null;o&&"documentMode"in document&&($s=document.documentMode);var An=o&&"TextEvent"in window&&!$s,om=o&&(!to||$s&&8<$s&&11>=$s),Rl=" ",Y_=!1;function K_(v,x){switch(v){case"keyup":return $_.indexOf(x.keyCode)!==-1;case"keydown":return x.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function mx(v){return v=v.detail,typeof v=="object"&&"data"in v?v.data:null}var Hh=!1;function tC(v,x){switch(v){case"compositionend":return mx(x);case"keypress":return x.which!==32?null:(Y_=!0,Rl);case"textInput":return v=x.data,v===Rl&&Y_?null:v;default:return null}}function Mv(v,x){if(Hh)return v==="compositionend"||!to&&K_(v,x)?(v=Ev(),Ao=V_=hc=null,Hh=!1,v):null;switch(v){case"paste":return null;case"keypress":if(!(x.ctrlKey||x.altKey||x.metaKey)||x.ctrlKey&&x.altKey){if(x.char&&1<x.char.length)return x.char;if(x.which)return String.fromCharCode(x.which)}return null;case"compositionend":return om&&x.locale!=="ko"?null:x.data;default:return null}}var lm={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function gx(v){var x=v&&v.nodeName&&v.nodeName.toLowerCase();return x==="input"?!!lm[v.type]:x==="textarea"}function cm(v,x,T,L){je(L),x=Tx(x,"onChange"),0<x.length&&(T=new Av("onChange","change",null,T,L),v.push({event:T,listeners:x}))}var Gh=null,um=null;function iC(v){pm(v,0)}function Iu(v){var x=Wn(v);if(Ce(x))return v}function rC(v,x){if(v==="change")return x}var hm=!1;if(o){var To;if(o){var bf="oninput"in document;if(!bf){var wf=document.createElement("div");wf.setAttribute("oninput","return;"),bf=typeof wf.oninput=="function"}To=bf}else To=!1;hm=To&&(!document.documentMode||9<document.documentMode)}function dc(){Gh&&(Gh.detachEvent("onpropertychange",vx),um=Gh=null)}function vx(v){if(v.propertyName==="value"&&Iu(um)){var x=[];cm(x,um,v,oe(v)),Zi(iC,x)}}function dm(v,x,T){v==="focusin"?(dc(),Gh=x,um=T,Gh.attachEvent("onpropertychange",vx)):v==="focusout"&&dc()}function nC(v){if(v==="selectionchange"||v==="keyup"||v==="keydown")return Iu(um)}function Z_(v,x){if(v==="click")return Iu(x)}function In(v,x){if(v==="input"||v==="change")return Iu(x)}function yx(v,x){return v===x&&(v!==0||1/v===1/x)||v!==v&&x!==x}var Xo=typeof Object.is=="function"?Object.is:yx;function _f(v,x){if(Xo(v,x))return!0;if(typeof v!="object"||v===null||typeof x!="object"||x===null)return!1;var T=Object.keys(v),L=Object.keys(x);if(T.length!==L.length)return!1;for(L=0;L<T.length;L++){var B=T[L];if(!l.call(x,B)||!Xo(v[B],x[B]))return!1}return!0}function Tv(v){for(;v&&v.firstChild;)v=v.firstChild;return v}function $o(v,x){var T=Tv(v);v=0;for(var L;T;){if(T.nodeType===3){if(L=v+T.textContent.length,v<=x&&L>=x)return{node:T,offset:x-v};v=L}e:{for(;T;){if(T.nextSibling){T=T.nextSibling;break e}T=T.parentNode}T=void 0}T=Tv(T)}}function Sf(v,x){return v&&x?v===x?!0:v&&v.nodeType===3?!1:x&&x.nodeType===3?Sf(v,x.parentNode):"contains"in v?v.contains(x):v.compareDocumentPosition?!!(v.compareDocumentPosition(x)&16):!1:!1}function Dn(){for(var v=window,x=ce();x instanceof v.HTMLIFrameElement;){try{var T=typeof x.contentWindow.location.href=="string"}catch{T=!1}if(T)v=x.contentWindow;else break;x=ce(v.document)}return x}function Ms(v){var x=v&&v.nodeName&&v.nodeName.toLowerCase();return x&&(x==="input"&&(v.type==="text"||v.type==="search"||v.type==="tel"||v.type==="url"||v.type==="password")||x==="textarea"||v.contentEditable==="true")}function Ts(v){var x=Dn(),T=v.focusedElem,L=v.selectionRange;if(x!==T&&T&&T.ownerDocument&&Sf(T.ownerDocument.documentElement,T)){if(L!==null&&Ms(T)){if(x=L.start,v=L.end,v===void 0&&(v=x),"selectionStart"in T)T.selectionStart=x,T.selectionEnd=Math.min(v,T.value.length);else if(v=(x=T.ownerDocument||document)&&x.defaultView||window,v.getSelection){v=v.getSelection();var B=T.textContent.length,q=Math.min(L.start,B);L=L.end===void 0?q:Math.min(L.end,B),!v.extend&&q>L&&(B=L,L=q,q=B),B=$o(T,q);var ue=$o(T,L);B&&ue&&(v.rangeCount!==1||v.anchorNode!==B.node||v.anchorOffset!==B.offset||v.focusNode!==ue.node||v.focusOffset!==ue.offset)&&(x=x.createRange(),x.setStart(B.node,B.offset),v.removeAllRanges(),q>L?(v.addRange(x),v.extend(ue.node,ue.offset)):(x.setEnd(ue.node,ue.offset),v.addRange(x)))}}for(x=[],v=T;v=v.parentNode;)v.nodeType===1&&x.push({element:v,left:v.scrollLeft,top:v.scrollTop});for(typeof T.focus=="function"&&T.focus(),T=0;T<x.length;T++)v=x[T],v.element.scrollLeft=v.left,v.element.scrollTop=v.top}}var xx=o&&"documentMode"in document&&11>=document.documentMode,Vc=null,Ef=null,Cv=null,Cs=!1;function bx(v,x,T){var L=T.window===T?T.document:T.nodeType===9?T:T.ownerDocument;Cs||Vc==null||Vc!==ce(L)||(L=Vc,"selectionStart"in L&&Ms(L)?L={start:L.selectionStart,end:L.selectionEnd}:(L=(L.ownerDocument&&L.ownerDocument.defaultView||window).getSelection(),L={anchorNode:L.anchorNode,anchorOffset:L.anchorOffset,focusNode:L.focusNode,focusOffset:L.focusOffset}),Cv&&_f(Cv,L)||(Cv=L,L=Tx(Ef,"onSelect"),0<L.length&&(x=new Av("onSelect","select",null,x,T),v.push({event:x,listeners:L}),x.target=Vc)))}function fm(v,x){var T={};return T[v.toLowerCase()]=x.toLowerCase(),T["Webkit"+v]="webkit"+x,T["Moz"+v]="moz"+x,T}var Wh={animationend:fm("Animation","AnimationEnd"),animationiteration:fm("Animation","AnimationIteration"),animationstart:fm("Animation","AnimationStart"),transitionend:fm("Transition","TransitionEnd")},fc={},pc={};o&&(pc=document.createElement("div").style,"AnimationEvent"in window||(delete Wh.animationend.animation,delete Wh.animationiteration.animation,delete Wh.animationstart.animation),"TransitionEvent"in window||delete Wh.transitionend.transition);function Hc(v){if(fc[v])return fc[v];if(!Wh[v])return v;var x=Wh[v],T;for(T in x)if(x.hasOwnProperty(T)&&T in pc)return fc[v]=x[T];return v}var Pv=Hc("animationend"),Rv=Hc("animationiteration"),Q_=Hc("animationstart"),J_=Hc("transitionend"),eS=new Map,tS="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Du(v,x){eS.set(v,x),s(x,[v])}for(var wx=0;wx<tS.length;wx++){var Iv=tS[wx],Dv=Iv.toLowerCase(),sC=Iv[0].toUpperCase()+Iv.slice(1);Du(Dv,"on"+sC)}Du(Pv,"onAnimationEnd"),Du(Rv,"onAnimationIteration"),Du(Q_,"onAnimationStart"),Du("dblclick","onDoubleClick"),Du("focusin","onFocus"),Du("focusout","onBlur"),Du(J_,"onTransitionEnd"),a("onMouseEnter",["mouseout","mouseover"]),a("onMouseLeave",["mouseout","mouseover"]),a("onPointerEnter",["pointerout","pointerover"]),a("onPointerLeave",["pointerout","pointerover"]),s("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),s("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),s("onBeforeInput",["compositionend","keypress","textInput","paste"]),s("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),s("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),s("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var qh="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),_x=new Set("cancel close invalid load scroll toggle".split(" ").concat(qh));function Sx(v,x,T){var L=v.type||"unknown-event";v.currentTarget=T,Zt(L,x,void 0,v),v.currentTarget=null}function pm(v,x){x=(x&4)!==0;for(var T=0;T<v.length;T++){var L=v[T],B=L.event;L=L.listeners;e:{var q=void 0;if(x)for(var ue=L.length-1;0<=ue;ue--){var Me=L[ue],Oe=Me.instance,lt=Me.currentTarget;if(Me=Me.listener,Oe!==q&&B.isPropagationStopped())break e;Sx(B,Me,lt),q=Oe}else for(ue=0;ue<L.length;ue++){if(Me=L[ue],Oe=Me.instance,lt=Me.currentTarget,Me=Me.listener,Oe!==q&&B.isPropagationStopped())break e;Sx(B,Me,lt),q=Oe}}}if(Xe)throw v=ht,Xe=!1,ht=null,v}function fn(v,x){var T=x[Tf];T===void 0&&(T=x[Tf]=new Set);var L=v+"__bubble";T.has(L)||(Ax(x,v,2,!1),T.add(L))}function Ex(v,x,T){var L=0;x&&(L|=4),Ax(T,v,L,x)}var Ov="_reactListening"+Math.random().toString(36).slice(2);function mm(v){if(!v[Ov]){v[Ov]=!0,r.forEach(function(T){T!=="selectionchange"&&(_x.has(T)||Ex(T,!1,v),Ex(T,!0,v))});var x=v.nodeType===9?v:v.ownerDocument;x===null||x[Ov]||(x[Ov]=!0,Ex("selectionchange",!1,x))}}function Ax(v,x,T,L){switch(YT(x)){case 1:var B=sx;break;case 4:B=j_;break;default:B=ax}T=B.bind(null,x,T,v),B=void 0,!As||x!=="touchstart"&&x!=="touchmove"&&x!=="wheel"||(B=!0),L?B!==void 0?v.addEventListener(x,T,{capture:!0,passive:B}):v.addEventListener(x,T,!0):B!==void 0?v.addEventListener(x,T,{passive:B}):v.addEventListener(x,T,!1)}function Mx(v,x,T,L,B){var q=L;if((x&1)===0&&(x&2)===0&&L!==null)e:for(;;){if(L===null)return;var ue=L.tag;if(ue===3||ue===4){var Me=L.stateNode.containerInfo;if(Me===B||Me.nodeType===8&&Me.parentNode===B)break;if(ue===4)for(ue=L.return;ue!==null;){var Oe=ue.tag;if((Oe===3||Oe===4)&&(Oe=ue.stateNode.containerInfo,Oe===B||Oe.nodeType===8&&Oe.parentNode===B))return;ue=ue.return}for(;Me!==null;){if(ue=Xh(Me),ue===null)return;if(Oe=ue.tag,Oe===5||Oe===6){L=q=ue;continue e}Me=Me.parentNode}}L=L.return}Zi(function(){var lt=q,Pt=oe(T),It=[];e:{var Ct=eS.get(v);if(Ct!==void 0){var Jt=Av,li=v;switch(v){case"keypress":if(mf(T)===0)break e;case"keydown":case"keyup":Jt=px;break;case"focusin":li="focus",Jt=ux;break;case"focusout":li="blur",Jt=ux;break;case"beforeblur":case"afterblur":Jt=ux;break;case"click":if(T.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":Jt=H_;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":Jt=jh;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":Jt=Pu;break;case Pv:case Rv:case Q_:Jt=KT;break;case J_:Jt=xf;break;case"scroll":Jt=nm;break;case"wheel":Jt=X_;break;case"copy":case"cut":case"paste":Jt=G_;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":Jt=qo}var pi=(x&4)!==0,fs=!pi&&v==="scroll",Ye=pi?Ct!==null?Ct+"Capture":null:Ct;pi=[];for(var Ve=lt,et;Ve!==null;){et=Ve;var Lt=et.stateNode;if(et.tag===5&&Lt!==null&&(et=Lt,Ye!==null&&(Lt=Xi(Ve,Ye),Lt!=null&&pi.push(gm(Ve,Lt,et)))),fs)break;Ve=Ve.return}0<pi.length&&(Ct=new Jt(Ct,li,null,T,Pt),It.push({event:Ct,listeners:pi}))}}if((x&7)===0){e:{if(Ct=v==="mouseover"||v==="pointerover",Jt=v==="mouseout"||v==="pointerout",Ct&&T!==$t&&(li=T.relatedTarget||T.fromElement)&&(Xh(li)||li[Yo]))break e;if((Jt||Ct)&&(Ct=Pt.window===Pt?Pt:(Ct=Pt.ownerDocument)?Ct.defaultView||Ct.parentWindow:window,Jt?(li=T.relatedTarget||T.toElement,Jt=lt,li=li?Xh(li):null,li!==null&&(fs=yi(li),li!==fs||li.tag!==5&&li.tag!==6)&&(li=null)):(Jt=null,li=lt),Jt!==li)){if(pi=H_,Lt="onMouseLeave",Ye="onMouseEnter",Ve="mouse",(v==="pointerout"||v==="pointerover")&&(pi=qo,Lt="onPointerLeave",Ye="onPointerEnter",Ve="pointer"),fs=Jt==null?Ct:Wn(Jt),et=li==null?Ct:Wn(li),Ct=new pi(Lt,Ve+"leave",Jt,T,Pt),Ct.target=fs,Ct.relatedTarget=et,Lt=null,Xh(Pt)===lt&&(pi=new pi(Ye,Ve+"enter",li,T,Pt),pi.target=et,pi.relatedTarget=fs,Lt=pi),fs=Lt,Jt&&li)t:{for(pi=Jt,Ye=li,Ve=0,et=pi;et;et=Af(et))Ve++;for(et=0,Lt=Ye;Lt;Lt=Af(Lt))et++;for(;0<Ve-et;)pi=Af(pi),Ve--;for(;0<et-Ve;)Ye=Af(Ye),et--;for(;Ve--;){if(pi===Ye||Ye!==null&&pi===Ye.alternate)break t;pi=Af(pi),Ye=Af(Ye)}pi=null}else pi=null;Jt!==null&&aC(It,Ct,Jt,pi,!1),li!==null&&fs!==null&&aC(It,fs,li,pi,!0)}}e:{if(Ct=lt?Wn(lt):window,Jt=Ct.nodeName&&Ct.nodeName.toLowerCase(),Jt==="select"||Jt==="input"&&Ct.type==="file")var xi=rC;else if(gx(Ct))if(hm)xi=In;else{xi=nC;var Oi=dm}else(Jt=Ct.nodeName)&&Jt.toLowerCase()==="input"&&(Ct.type==="checkbox"||Ct.type==="radio")&&(xi=Z_);if(xi&&(xi=xi(v,lt))){cm(It,xi,T,Pt);break e}Oi&&Oi(v,Ct,lt),v==="focusout"&&(Oi=Ct._wrapperState)&&Oi.controlled&&Ct.type==="number"&&ze(Ct,"number",Ct.value)}switch(Oi=lt?Wn(lt):window,v){case"focusin":(gx(Oi)||Oi.contentEditable==="true")&&(Vc=Oi,Ef=lt,Cv=null);break;case"focusout":Cv=Ef=Vc=null;break;case"mousedown":Cs=!0;break;case"contextmenu":case"mouseup":case"dragend":Cs=!1,bx(It,T,Pt);break;case"selectionchange":if(xx)break;case"keydown":case"keyup":bx(It,T,Pt)}var Li;if(to)e:{switch(v){case"compositionstart":var qi="onCompositionStart";break e;case"compositionend":qi="onCompositionEnd";break e;case"compositionupdate":qi="onCompositionUpdate";break e}qi=void 0}else Hh?K_(v,T)&&(qi="onCompositionEnd"):v==="keydown"&&T.keyCode===229&&(qi="onCompositionStart");qi&&(om&&T.locale!=="ko"&&(Hh||qi!=="onCompositionStart"?qi==="onCompositionEnd"&&Hh&&(Li=Ev()):(hc=Pt,V_="value"in hc?hc.value:hc.textContent,Hh=!0)),Oi=Tx(lt,qi),0<Oi.length&&(qi=new W_(qi,v,null,T,Pt),It.push({event:qi,listeners:Oi}),Li?qi.data=Li:(Li=mx(T),Li!==null&&(qi.data=Li)))),(Li=An?tC(v,T):Mv(v,T))&&(lt=Tx(lt,"onBeforeInput"),0<lt.length&&(Pt=new W_("onBeforeInput","beforeinput",null,T,Pt),It.push({event:Pt,listeners:lt}),Pt.data=Li))}pm(It,x)})}function gm(v,x,T){return{instance:v,listener:x,currentTarget:T}}function Tx(v,x){for(var T=x+"Capture",L=[];v!==null;){var B=v,q=B.stateNode;B.tag===5&&q!==null&&(B=q,q=Xi(v,T),q!=null&&L.unshift(gm(v,q,B)),q=Xi(v,x),q!=null&&L.push(gm(v,q,B))),v=v.return}return L}function Af(v){if(v===null)return null;do v=v.return;while(v&&v.tag!==5);return v||null}function aC(v,x,T,L,B){for(var q=x._reactName,ue=[];T!==null&&T!==L;){var Me=T,Oe=Me.alternate,lt=Me.stateNode;if(Oe!==null&&Oe===L)break;Me.tag===5&&lt!==null&&(Me=lt,B?(Oe=Xi(T,q),Oe!=null&&ue.unshift(gm(T,Oe,Me))):B||(Oe=Xi(T,q),Oe!=null&&ue.push(gm(T,Oe,Me)))),T=T.return}ue.length!==0&&v.push({event:x,listeners:ue})}var UL=/\r\n?/g,oC=/\u0000|\uFFFD/g;function iS(v){return(typeof v=="string"?v:""+v).replace(UL,`
`).replace(oC,"")}function Lv(v,x,T){if(x=iS(x),iS(v)!==x&&T)throw Error(i(425))}function kv(){}var vm=null,rS=null;function nS(v,x){return v==="textarea"||v==="noscript"||typeof x.children=="string"||typeof x.children=="number"||typeof x.dangerouslySetInnerHTML=="object"&&x.dangerouslySetInnerHTML!==null&&x.dangerouslySetInnerHTML.__html!=null}var sS=typeof setTimeout=="function"?setTimeout:void 0,aS=typeof clearTimeout=="function"?clearTimeout:void 0,Cx=typeof Promise=="function"?Promise:void 0,BL=typeof queueMicrotask=="function"?queueMicrotask:typeof Cx<"u"?function(v){return Cx.resolve(null).then(v).catch(lC)}:sS;function lC(v){setTimeout(function(){throw v})}function Px(v,x){var T=x,L=0;do{var B=T.nextSibling;if(v.removeChild(T),B&&B.nodeType===8)if(T=B.data,T==="/$"){if(L===0){v.removeChild(B),Sv(x);return}L--}else T!=="$"&&T!=="$?"&&T!=="$!"||L++;T=B}while(T);Sv(x)}function Ou(v){for(;v!=null;v=v.nextSibling){var x=v.nodeType;if(x===1||x===3)break;if(x===8){if(x=v.data,x==="$"||x==="$!"||x==="$?")break;if(x==="/$")return null}}return v}function oS(v){v=v.previousSibling;for(var x=0;v;){if(v.nodeType===8){var T=v.data;if(T==="$"||T==="$!"||T==="$?"){if(x===0)return v;x--}else T==="/$"&&x++}v=v.previousSibling}return null}var Mf=Math.random().toString(36).slice(2),ds="__reactFiber$"+Mf,ym="__reactProps$"+Mf,Yo="__reactContainer$"+Mf,Tf="__reactEvents$"+Mf,Rx="__reactListeners$"+Mf,Ix="__reactHandles$"+Mf;function Xh(v){var x=v[ds];if(x)return x;for(var T=v.parentNode;T;){if(x=T[Yo]||T[ds]){if(T=x.alternate,x.child!==null||T!==null&&T.child!==null)for(v=oS(v);v!==null;){if(T=v[ds])return T;v=oS(v)}return x}v=T,T=v.parentNode}return null}function Lu(v){return v=v[ds]||v[Yo],!v||v.tag!==5&&v.tag!==6&&v.tag!==13&&v.tag!==3?null:v}function Wn(v){if(v.tag===5||v.tag===6)return v.stateNode;throw Error(i(33))}function Dx(v){return v[ym]||null}var lS=[],Ps=-1;function Un(v){return{current:v}}function pn(v){0>Ps||(v.current=lS[Ps],lS[Ps]=null,Ps--)}function sn(v,x){Ps++,lS[Ps]=v.current,v.current=x}var ku={},Ys=Un(ku),io=Un(!1),Nu=ku;function Cf(v,x){var T=v.type.contextTypes;if(!T)return ku;var L=v.stateNode;if(L&&L.__reactInternalMemoizedUnmaskedChildContext===x)return L.__reactInternalMemoizedMaskedChildContext;var B={},q;for(q in T)B[q]=x[q];return L&&(v=v.stateNode,v.__reactInternalMemoizedUnmaskedChildContext=x,v.__reactInternalMemoizedMaskedChildContext=B),B}function Ma(v){return v=v.childContextTypes,v!=null}function Nv(){pn(io),pn(Ys)}function cS(v,x,T){if(Ys.current!==ku)throw Error(i(168));sn(Ys,x),sn(io,T)}function Uv(v,x,T){var L=v.stateNode;if(x=x.childContextTypes,typeof L.getChildContext!="function")return T;L=L.getChildContext();for(var B in L)if(!(B in x))throw Error(i(108,le(v)||"Unknown",B));return Z({},T,L)}function Pf(v){return v=(v=v.stateNode)&&v.__reactInternalMemoizedMergedChildContext||ku,Nu=Ys.current,sn(Ys,v),sn(io,io.current),!0}function uS(v,x,T){var L=v.stateNode;if(!L)throw Error(i(169));T?(v=Uv(v,x,Nu),L.__reactInternalMemoizedMergedChildContext=v,pn(io),pn(Ys),sn(Ys,v)):pn(io),sn(io,T)}var mc=null,Bv=!1,Ox=!1;function Fv(v){mc===null?mc=[v]:mc.push(v)}function cC(v){Bv=!0,Fv(v)}function Gc(){if(!Ox&&mc!==null){Ox=!0;var v=0,x=cr;try{var T=mc;for(cr=1;v<T.length;v++){var L=T[v];do L=L(!0);while(L!==null)}mc=null,Bv=!1}catch(B){throw mc!==null&&(mc=mc.slice(v+1)),de(Dt,Gc),B}finally{cr=x,Ox=!1}}return null}var Rf=[],Co=0,Lx=null,kx=0,ro=[],Rs=0,If=null,zt=1,Il="";function Uu(v,x){Rf[Co++]=kx,Rf[Co++]=Lx,Lx=v,kx=x}function hS(v,x,T){ro[Rs++]=zt,ro[Rs++]=Il,ro[Rs++]=If,If=v;var L=zt;v=Il;var B=32-_e(L)-1;L&=~(1<<B),T+=1;var q=32-_e(x)+B;if(30<q){var ue=B-B%5;q=(L&(1<<ue)-1).toString(32),L>>=ue,B-=ue,zt=1<<32-_e(x)+B|T<<B|L,Il=q+v}else zt=1<<q|T<<B|L,Il=v}function dS(v){v.return!==null&&(Uu(v,1),hS(v,1,0))}function Bu(v){for(;v===Lx;)Lx=Rf[--Co],Rf[Co]=null,kx=Rf[--Co],Rf[Co]=null;for(;v===If;)If=ro[--Rs],ro[Rs]=null,Il=ro[--Rs],ro[Rs]=null,zt=ro[--Rs],ro[Rs]=null}var Ks=null,no=null,wn=!1,Dl=null;function fS(v,x){var T=Yc(5,null,null,0);T.elementType="DELETED",T.stateNode=x,T.return=v,x=v.deletions,x===null?(v.deletions=[T],v.flags|=16):x.push(T)}function pS(v,x){switch(v.tag){case 5:var T=v.type;return x=x.nodeType!==1||T.toLowerCase()!==x.nodeName.toLowerCase()?null:x,x!==null?(v.stateNode=x,Ks=v,no=Ou(x.firstChild),!0):!1;case 6:return x=v.pendingProps===""||x.nodeType!==3?null:x,x!==null?(v.stateNode=x,Ks=v,no=null,!0):!1;case 13:return x=x.nodeType!==8?null:x,x!==null?(T=If!==null?{id:zt,overflow:Il}:null,v.memoizedState={dehydrated:x,treeContext:T,retryLane:1073741824},T=Yc(18,null,null,0),T.stateNode=x,T.return=v,v.child=T,Ks=v,no=null,!0):!1;default:return!1}}function Nx(v){return(v.mode&1)!==0&&(v.flags&128)===0}function Ux(v){if(wn){var x=no;if(x){var T=x;if(!pS(v,x)){if(Nx(v))throw Error(i(418));x=Ou(T.nextSibling);var L=Ks;x&&pS(v,x)?fS(L,T):(v.flags=v.flags&-4097|2,wn=!1,Ks=v)}}else{if(Nx(v))throw Error(i(418));v.flags=v.flags&-4097|2,wn=!1,Ks=v}}}function Bx(v){for(v=v.return;v!==null&&v.tag!==5&&v.tag!==3&&v.tag!==13;)v=v.return;Ks=v}function xm(v){if(v!==Ks)return!1;if(!wn)return Bx(v),wn=!0,!1;var x;if((x=v.tag!==3)&&!(x=v.tag!==5)&&(x=v.type,x=x!=="head"&&x!=="body"&&!nS(v.type,v.memoizedProps)),x&&(x=no)){if(Nx(v))throw mS(),Error(i(418));for(;x;)fS(v,x),x=Ou(x.nextSibling)}if(Bx(v),v.tag===13){if(v=v.memoizedState,v=v!==null?v.dehydrated:null,!v)throw Error(i(317));e:{for(v=v.nextSibling,x=0;v;){if(v.nodeType===8){var T=v.data;if(T==="/$"){if(x===0){no=Ou(v.nextSibling);break e}x--}else T!=="$"&&T!=="$!"&&T!=="$?"||x++}v=v.nextSibling}no=null}}else no=Ks?Ou(v.stateNode.nextSibling):null;return!0}function mS(){for(var v=no;v;)v=Ou(v.nextSibling)}function $h(){no=Ks=null,wn=!1}function bm(v){Dl===null?Dl=[v]:Dl.push(v)}var FL=E.ReactCurrentBatchConfig;function zv(v,x,T){if(v=T.ref,v!==null&&typeof v!="function"&&typeof v!="object"){if(T._owner){if(T=T._owner,T){if(T.tag!==1)throw Error(i(309));var L=T.stateNode}if(!L)throw Error(i(147,v));var B=L,q=""+v;return x!==null&&x.ref!==null&&typeof x.ref=="function"&&x.ref._stringRef===q?x.ref:(x=function(ue){var Me=B.refs;ue===null?delete Me[q]:Me[q]=ue},x._stringRef=q,x)}if(typeof v!="string")throw Error(i(284));if(!T._owner)throw Error(i(290,v))}return v}function jv(v,x){throw v=Object.prototype.toString.call(x),Error(i(31,v==="[object Object]"?"object with keys {"+Object.keys(x).join(", ")+"}":v))}function gS(v){var x=v._init;return x(v._payload)}function vS(v){function x(Ye,Ve){if(v){var et=Ye.deletions;et===null?(Ye.deletions=[Ve],Ye.flags|=16):et.push(Ve)}}function T(Ye,Ve){if(!v)return null;for(;Ve!==null;)x(Ye,Ve),Ve=Ve.sibling;return null}function L(Ye,Ve){for(Ye=new Map;Ve!==null;)Ve.key!==null?Ye.set(Ve.key,Ve):Ye.set(Ve.index,Ve),Ve=Ve.sibling;return Ye}function B(Ye,Ve){return Ye=Im(Ye,Ve),Ye.index=0,Ye.sibling=null,Ye}function q(Ye,Ve,et){return Ye.index=et,v?(et=Ye.alternate,et!==null?(et=et.index,et<Ve?(Ye.flags|=2,Ve):et):(Ye.flags|=2,Ve)):(Ye.flags|=1048576,Ve)}function ue(Ye){return v&&Ye.alternate===null&&(Ye.flags|=2),Ye}function Me(Ye,Ve,et,Lt){return Ve===null||Ve.tag!==6?(Ve=nk(et,Ye.mode,Lt),Ve.return=Ye,Ve):(Ve=B(Ve,et),Ve.return=Ye,Ve)}function Oe(Ye,Ve,et,Lt){var xi=et.type;return xi===P?Pt(Ye,Ve,et.props.children,Lt,et.key):Ve!==null&&(Ve.elementType===xi||typeof xi=="object"&&xi!==null&&xi.$$typeof===K&&gS(xi)===Ve.type)?(Lt=B(Ve,et.props),Lt.ref=zv(Ye,Ve,et),Lt.return=Ye,Lt):(Lt=DC(et.type,et.key,et.props,null,Ye.mode,Lt),Lt.ref=zv(Ye,Ve,et),Lt.return=Ye,Lt)}function lt(Ye,Ve,et,Lt){return Ve===null||Ve.tag!==4||Ve.stateNode.containerInfo!==et.containerInfo||Ve.stateNode.implementation!==et.implementation?(Ve=sk(et,Ye.mode,Lt),Ve.return=Ye,Ve):(Ve=B(Ve,et.children||[]),Ve.return=Ye,Ve)}function Pt(Ye,Ve,et,Lt,xi){return Ve===null||Ve.tag!==7?(Ve=ny(et,Ye.mode,Lt,xi),Ve.return=Ye,Ve):(Ve=B(Ve,et),Ve.return=Ye,Ve)}function It(Ye,Ve,et){if(typeof Ve=="string"&&Ve!==""||typeof Ve=="number")return Ve=nk(""+Ve,Ye.mode,et),Ve.return=Ye,Ve;if(typeof Ve=="object"&&Ve!==null){switch(Ve.$$typeof){case M:return et=DC(Ve.type,Ve.key,Ve.props,null,Ye.mode,et),et.ref=zv(Ye,null,Ve),et.return=Ye,et;case A:return Ve=sk(Ve,Ye.mode,et),Ve.return=Ye,Ve;case K:var Lt=Ve._init;return It(Ye,Lt(Ve._payload),et)}if(it(Ve)||Y(Ve))return Ve=ny(Ve,Ye.mode,et,null),Ve.return=Ye,Ve;jv(Ye,Ve)}return null}function Ct(Ye,Ve,et,Lt){var xi=Ve!==null?Ve.key:null;if(typeof et=="string"&&et!==""||typeof et=="number")return xi!==null?null:Me(Ye,Ve,""+et,Lt);if(typeof et=="object"&&et!==null){switch(et.$$typeof){case M:return et.key===xi?Oe(Ye,Ve,et,Lt):null;case A:return et.key===xi?lt(Ye,Ve,et,Lt):null;case K:return xi=et._init,Ct(Ye,Ve,xi(et._payload),Lt)}if(it(et)||Y(et))return xi!==null?null:Pt(Ye,Ve,et,Lt,null);jv(Ye,et)}return null}function Jt(Ye,Ve,et,Lt,xi){if(typeof Lt=="string"&&Lt!==""||typeof Lt=="number")return Ye=Ye.get(et)||null,Me(Ve,Ye,""+Lt,xi);if(typeof Lt=="object"&&Lt!==null){switch(Lt.$$typeof){case M:return Ye=Ye.get(Lt.key===null?et:Lt.key)||null,Oe(Ve,Ye,Lt,xi);case A:return Ye=Ye.get(Lt.key===null?et:Lt.key)||null,lt(Ve,Ye,Lt,xi);case K:var Oi=Lt._init;return Jt(Ye,Ve,et,Oi(Lt._payload),xi)}if(it(Lt)||Y(Lt))return Ye=Ye.get(et)||null,Pt(Ve,Ye,Lt,xi,null);jv(Ve,Lt)}return null}function li(Ye,Ve,et,Lt){for(var xi=null,Oi=null,Li=Ve,qi=Ve=0,Ra=null;Li!==null&&qi<et.length;qi++){Li.index>qi?(Ra=Li,Li=null):Ra=Li.sibling;var zr=Ct(Ye,Li,et[qi],Lt);if(zr===null){Li===null&&(Li=Ra);break}v&&Li&&zr.alternate===null&&x(Ye,Li),Ve=q(zr,Ve,qi),Oi===null?xi=zr:Oi.sibling=zr,Oi=zr,Li=Ra}if(qi===et.length)return T(Ye,Li),wn&&Uu(Ye,qi),xi;if(Li===null){for(;qi<et.length;qi++)Li=It(Ye,et[qi],Lt),Li!==null&&(Ve=q(Li,Ve,qi),Oi===null?xi=Li:Oi.sibling=Li,Oi=Li);return wn&&Uu(Ye,qi),xi}for(Li=L(Ye,Li);qi<et.length;qi++)Ra=Jt(Li,Ye,qi,et[qi],Lt),Ra!==null&&(v&&Ra.alternate!==null&&Li.delete(Ra.key===null?qi:Ra.key),Ve=q(Ra,Ve,qi),Oi===null?xi=Ra:Oi.sibling=Ra,Oi=Ra);return v&&Li.forEach(function(Dm){return x(Ye,Dm)}),wn&&Uu(Ye,qi),xi}function pi(Ye,Ve,et,Lt){var xi=Y(et);if(typeof xi!="function")throw Error(i(150));if(et=xi.call(et),et==null)throw Error(i(151));for(var Oi=xi=null,Li=Ve,qi=Ve=0,Ra=null,zr=et.next();Li!==null&&!zr.done;qi++,zr=et.next()){Li.index>qi?(Ra=Li,Li=null):Ra=Li.sibling;var Dm=Ct(Ye,Li,zr.value,Lt);if(Dm===null){Li===null&&(Li=Ra);break}v&&Li&&Dm.alternate===null&&x(Ye,Li),Ve=q(Dm,Ve,qi),Oi===null?xi=Dm:Oi.sibling=Dm,Oi=Dm,Li=Ra}if(zr.done)return T(Ye,Li),wn&&Uu(Ye,qi),xi;if(Li===null){for(;!zr.done;qi++,zr=et.next())zr=It(Ye,zr.value,Lt),zr!==null&&(Ve=q(zr,Ve,qi),Oi===null?xi=zr:Oi.sibling=zr,Oi=zr);return wn&&Uu(Ye,qi),xi}for(Li=L(Ye,Li);!zr.done;qi++,zr=et.next())zr=Jt(Li,Ye,qi,zr.value,Lt),zr!==null&&(v&&zr.alternate!==null&&Li.delete(zr.key===null?qi:zr.key),Ve=q(zr,Ve,qi),Oi===null?xi=zr:Oi.sibling=zr,Oi=zr);return v&&Li.forEach(function(Uge){return x(Ye,Uge)}),wn&&Uu(Ye,qi),xi}function fs(Ye,Ve,et,Lt){if(typeof et=="object"&&et!==null&&et.type===P&&et.key===null&&(et=et.props.children),typeof et=="object"&&et!==null){switch(et.$$typeof){case M:e:{for(var xi=et.key,Oi=Ve;Oi!==null;){if(Oi.key===xi){if(xi=et.type,xi===P){if(Oi.tag===7){T(Ye,Oi.sibling),Ve=B(Oi,et.props.children),Ve.return=Ye,Ye=Ve;break e}}else if(Oi.elementType===xi||typeof xi=="object"&&xi!==null&&xi.$$typeof===K&&gS(xi)===Oi.type){T(Ye,Oi.sibling),Ve=B(Oi,et.props),Ve.ref=zv(Ye,Oi,et),Ve.return=Ye,Ye=Ve;break e}T(Ye,Oi);break}else x(Ye,Oi);Oi=Oi.sibling}et.type===P?(Ve=ny(et.props.children,Ye.mode,Lt,et.key),Ve.return=Ye,Ye=Ve):(Lt=DC(et.type,et.key,et.props,null,Ye.mode,Lt),Lt.ref=zv(Ye,Ve,et),Lt.return=Ye,Ye=Lt)}return ue(Ye);case A:e:{for(Oi=et.key;Ve!==null;){if(Ve.key===Oi)if(Ve.tag===4&&Ve.stateNode.containerInfo===et.containerInfo&&Ve.stateNode.implementation===et.implementation){T(Ye,Ve.sibling),Ve=B(Ve,et.children||[]),Ve.return=Ye,Ye=Ve;break e}else{T(Ye,Ve);break}else x(Ye,Ve);Ve=Ve.sibling}Ve=sk(et,Ye.mode,Lt),Ve.return=Ye,Ye=Ve}return ue(Ye);case K:return Oi=et._init,fs(Ye,Ve,Oi(et._payload),Lt)}if(it(et))return li(Ye,Ve,et,Lt);if(Y(et))return pi(Ye,Ve,et,Lt);jv(Ye,et)}return typeof et=="string"&&et!==""||typeof et=="number"?(et=""+et,Ve!==null&&Ve.tag===6?(T(Ye,Ve.sibling),Ve=B(Ve,et),Ve.return=Ye,Ye=Ve):(T(Ye,Ve),Ve=nk(et,Ye.mode,Lt),Ve.return=Ye,Ye=Ve),ue(Ye)):T(Ye,Ve)}return fs}var Df=vS(!0),Vv=vS(!1),Of=Un(null),Lf=null,Fu=null,wm=null;function kf(){wm=Fu=Lf=null}function Hv(v){var x=Of.current;pn(Of),v._currentValue=x}function Gv(v,x,T){for(;v!==null;){var L=v.alternate;if((v.childLanes&x)!==x?(v.childLanes|=x,L!==null&&(L.childLanes|=x)):L!==null&&(L.childLanes&x)!==x&&(L.childLanes|=x),v===T)break;v=v.return}}function Yh(v,x){Lf=v,wm=Fu=null,v=v.dependencies,v!==null&&v.firstContext!==null&&((v.lanes&x)!==0&&(ur=!0),v.firstContext=null)}function Ko(v){var x=v._currentValue;if(wm!==v)if(v={context:v,memoizedValue:x,next:null},Fu===null){if(Lf===null)throw Error(i(308));Fu=v,Lf.dependencies={lanes:0,firstContext:v}}else Fu=Fu.next=v;return x}var zu=null;function yS(v){zu===null?zu=[v]:zu.push(v)}function Wv(v,x,T,L){var B=x.interleaved;return B===null?(T.next=T,yS(x)):(T.next=B.next,B.next=T),x.interleaved=T,gc(v,L)}function gc(v,x){v.lanes|=x;var T=v.alternate;for(T!==null&&(T.lanes|=x),T=v,v=v.return;v!==null;)v.childLanes|=x,T=v.alternate,T!==null&&(T.childLanes|=x),T=v,v=v.return;return T.tag===3?T.stateNode:null}var Yr=!1;function sr(v){v.updateQueue={baseState:v.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function qn(v,x){v=v.updateQueue,x.updateQueue===v&&(x.updateQueue={baseState:v.baseState,firstBaseUpdate:v.firstBaseUpdate,lastBaseUpdate:v.lastBaseUpdate,shared:v.shared,effects:v.effects})}function Kr(v,x){return{eventTime:v,lane:x,tag:0,payload:null,callback:null,next:null}}function Mn(v,x,T){var L=v.updateQueue;if(L===null)return null;if(L=L.shared,(kr&2)!==0){var B=L.pending;return B===null?x.next=x:(x.next=B.next,B.next=x),L.pending=x,gc(v,T)}return B=L.interleaved,B===null?(x.next=x,yS(L)):(x.next=B.next,B.next=x),L.interleaved=x,gc(v,T)}function Ta(v,x,T){if(x=x.updateQueue,x!==null&&(x=x.shared,(T&4194240)!==0)){var L=x.lanes;L&=v.pendingLanes,T|=L,x.lanes=T,Fc(v,T)}}function Nf(v,x){var T=v.updateQueue,L=v.alternate;if(L!==null&&(L=L.updateQueue,T===L)){var B=null,q=null;if(T=T.firstBaseUpdate,T!==null){do{var ue={eventTime:T.eventTime,lane:T.lane,tag:T.tag,payload:T.payload,callback:T.callback,next:null};q===null?B=q=ue:q=q.next=ue,T=T.next}while(T!==null);q===null?B=q=x:q=q.next=x}else B=q=x;T={baseState:L.baseState,firstBaseUpdate:B,lastBaseUpdate:q,shared:L.shared,effects:L.effects},v.updateQueue=T;return}v=T.lastBaseUpdate,v===null?T.firstBaseUpdate=x:v.next=x,T.lastBaseUpdate=x}function Bn(v,x,T,L){var B=v.updateQueue;Yr=!1;var q=B.firstBaseUpdate,ue=B.lastBaseUpdate,Me=B.shared.pending;if(Me!==null){B.shared.pending=null;var Oe=Me,lt=Oe.next;Oe.next=null,ue===null?q=lt:ue.next=lt,ue=Oe;var Pt=v.alternate;Pt!==null&&(Pt=Pt.updateQueue,Me=Pt.lastBaseUpdate,Me!==ue&&(Me===null?Pt.firstBaseUpdate=lt:Me.next=lt,Pt.lastBaseUpdate=Oe))}if(q!==null){var It=B.baseState;ue=0,Pt=lt=Oe=null,Me=q;do{var Ct=Me.lane,Jt=Me.eventTime;if((L&Ct)===Ct){Pt!==null&&(Pt=Pt.next={eventTime:Jt,lane:0,tag:Me.tag,payload:Me.payload,callback:Me.callback,next:null});e:{var li=v,pi=Me;switch(Ct=x,Jt=T,pi.tag){case 1:if(li=pi.payload,typeof li=="function"){It=li.call(Jt,It,Ct);break e}It=li;break e;case 3:li.flags=li.flags&-65537|128;case 0:if(li=pi.payload,Ct=typeof li=="function"?li.call(Jt,It,Ct):li,Ct==null)break e;It=Z({},It,Ct);break e;case 2:Yr=!0}}Me.callback!==null&&Me.lane!==0&&(v.flags|=64,Ct=B.effects,Ct===null?B.effects=[Me]:Ct.push(Me))}else Jt={eventTime:Jt,lane:Ct,tag:Me.tag,payload:Me.payload,callback:Me.callback,next:null},Pt===null?(lt=Pt=Jt,Oe=It):Pt=Pt.next=Jt,ue|=Ct;if(Me=Me.next,Me===null){if(Me=B.shared.pending,Me===null)break;Ct=Me,Me=Ct.next,Ct.next=null,B.lastBaseUpdate=Ct,B.shared.pending=null}}while(!0);if(Pt===null&&(Oe=It),B.baseState=Oe,B.firstBaseUpdate=lt,B.lastBaseUpdate=Pt,x=B.shared.interleaved,x!==null){B=x;do ue|=B.lane,B=B.next;while(B!==x)}else q===null&&(B.shared.lanes=0);ey|=ue,v.lanes=ue,v.memoizedState=It}}function _m(v,x,T){if(v=x.effects,x.effects=null,v!==null)for(x=0;x<v.length;x++){var L=v[x],B=L.callback;if(B!==null){if(L.callback=null,L=T,typeof B!="function")throw Error(i(191,B));B.call(L)}}}var Wc={},Zo=Un(Wc),Uf=Un(Wc),ju=Un(Wc);function Zn(v){if(v===Wc)throw Error(i(174));return v}function qv(v,x){switch(sn(ju,x),sn(Uf,v),sn(Zo,Wc),v=x.nodeType,v){case 9:case 11:x=(x=x.documentElement)?x.namespaceURI:Ne(null,"");break;default:v=v===8?x.parentNode:x,x=v.namespaceURI||null,v=v.tagName,x=Ne(x,v)}pn(Zo),sn(Zo,x)}function Kh(){pn(Zo),pn(Uf),pn(ju)}function Bf(v){Zn(ju.current);var x=Zn(Zo.current),T=Ne(x,v.type);x!==T&&(sn(Uf,v),sn(Zo,T))}function Sm(v){Uf.current===v&&(pn(Zo),pn(Uf))}var _n=Un(0);function vc(v){for(var x=v;x!==null;){if(x.tag===13){var T=x.memoizedState;if(T!==null&&(T=T.dehydrated,T===null||T.data==="$?"||T.data==="$!"))return x}else if(x.tag===19&&x.memoizedProps.revealOrder!==void 0){if((x.flags&128)!==0)return x}else if(x.child!==null){x.child.return=x,x=x.child;continue}if(x===v)break;for(;x.sibling===null;){if(x.return===null||x.return===v)return null;x=x.return}x.sibling.return=x.return,x=x.sibling}return null}var Em=[];function qc(){for(var v=0;v<Em.length;v++)Em[v]._workInProgressVersionPrimary=null;Em.length=0}var Ff=E.ReactCurrentDispatcher,zf=E.ReactCurrentBatchConfig,Vu=0,mn=null,Fn=null,Ir=null,yc=!1,Ca=!1,Zh=0,Po=0;function Zs(){throw Error(i(321))}function Xv(v,x){if(x===null)return!1;for(var T=0;T<x.length&&T<v.length;T++)if(!Xo(v[T],x[T]))return!1;return!0}function $v(v,x,T,L,B,q){if(Vu=q,mn=x,x.memoizedState=null,x.updateQueue=null,x.lanes=0,Ff.current=v===null||v.memoizedState===null?gC:vC,v=T(L,B),Ca){q=0;do{if(Ca=!1,Zh=0,25<=q)throw Error(i(301));q+=1,Ir=Fn=null,x.updateQueue=null,Ff.current=yC,v=T(L,B)}while(Ca)}if(Ff.current=Wx,x=Fn!==null&&Fn.next!==null,Vu=0,Ir=Fn=mn=null,yc=!1,x)throw Error(i(300));return v}function xS(){var v=Zh!==0;return Zh=0,v}function Qs(){var v={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Ir===null?mn.memoizedState=Ir=v:Ir=Ir.next=v,Ir}function Qo(){if(Fn===null){var v=mn.alternate;v=v!==null?v.memoizedState:null}else v=Fn.next;var x=Ir===null?mn.memoizedState:Ir.next;if(x!==null)Ir=x,Fn=v;else{if(v===null)throw Error(i(310));Fn=v,v={memoizedState:Fn.memoizedState,baseState:Fn.baseState,baseQueue:Fn.baseQueue,queue:Fn.queue,next:null},Ir===null?mn.memoizedState=Ir=v:Ir=Ir.next=v}return Ir}function Am(v,x){return typeof x=="function"?x(v):x}function Yv(v){var x=Qo(),T=x.queue;if(T===null)throw Error(i(311));T.lastRenderedReducer=v;var L=Fn,B=L.baseQueue,q=T.pending;if(q!==null){if(B!==null){var ue=B.next;B.next=q.next,q.next=ue}L.baseQueue=B=q,T.pending=null}if(B!==null){q=B.next,L=L.baseState;var Me=ue=null,Oe=null,lt=q;do{var Pt=lt.lane;if((Vu&Pt)===Pt)Oe!==null&&(Oe=Oe.next={lane:0,action:lt.action,hasEagerState:lt.hasEagerState,eagerState:lt.eagerState,next:null}),L=lt.hasEagerState?lt.eagerState:v(L,lt.action);else{var It={lane:Pt,action:lt.action,hasEagerState:lt.hasEagerState,eagerState:lt.eagerState,next:null};Oe===null?(Me=Oe=It,ue=L):Oe=Oe.next=It,mn.lanes|=Pt,ey|=Pt}lt=lt.next}while(lt!==null&&lt!==q);Oe===null?ue=L:Oe.next=Me,Xo(L,x.memoizedState)||(ur=!0),x.memoizedState=L,x.baseState=ue,x.baseQueue=Oe,T.lastRenderedState=L}if(v=T.interleaved,v!==null){B=v;do q=B.lane,mn.lanes|=q,ey|=q,B=B.next;while(B!==v)}else B===null&&(T.lanes=0);return[x.memoizedState,T.dispatch]}function Hu(v){var x=Qo(),T=x.queue;if(T===null)throw Error(i(311));T.lastRenderedReducer=v;var L=T.dispatch,B=T.pending,q=x.memoizedState;if(B!==null){T.pending=null;var ue=B=B.next;do q=v(q,ue.action),ue=ue.next;while(ue!==B);Xo(q,x.memoizedState)||(ur=!0),x.memoizedState=q,x.baseQueue===null&&(x.baseState=q),T.lastRenderedState=q}return[q,L]}function bS(){}function wS(v,x){var T=mn,L=Qo(),B=x(),q=!Xo(L.memoizedState,B);if(q&&(L.memoizedState=B,ur=!0),L=L.queue,ES(uC.bind(null,T,L,v),[v]),L.getSnapshot!==x||q||Ir!==null&&Ir.memoizedState.tag&1){if(T.flags|=2048,xc(9,Kv.bind(null,T,L,B,x),void 0,null),Pa===null)throw Error(i(349));(Vu&30)!==0||Fx(T,x,B)}return B}function Fx(v,x,T){v.flags|=16384,v={getSnapshot:x,value:T},x=mn.updateQueue,x===null?(x={lastEffect:null,stores:null},mn.updateQueue=x,x.stores=[v]):(T=x.stores,T===null?x.stores=[v]:T.push(v))}function Kv(v,x,T,L){x.value=T,x.getSnapshot=L,hC(x)&&_S(v)}function uC(v,x,T){return T(function(){hC(x)&&_S(v)})}function hC(v){var x=v.getSnapshot;v=v.value;try{var T=x();return!Xo(v,T)}catch{return!0}}function _S(v){var x=gc(v,1);x!==null&&$u(x,v,1,-1)}function SS(v){var x=Qs();return typeof v=="function"&&(v=v()),x.memoizedState=x.baseState=v,v={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Am,lastRenderedState:v},x.queue=v,v=v.dispatch=jf.bind(null,mn,v),[x.memoizedState,v]}function xc(v,x,T,L){return v={tag:v,create:x,destroy:T,deps:L,next:null},x=mn.updateQueue,x===null?(x={lastEffect:null,stores:null},mn.updateQueue=x,x.lastEffect=v.next=v):(T=x.lastEffect,T===null?x.lastEffect=v.next=v:(L=T.next,T.next=v,v.next=L,x.lastEffect=v)),v}function dC(){return Qo().memoizedState}function Xc(v,x,T,L){var B=Qs();mn.flags|=v,B.memoizedState=xc(1|x,T,void 0,L===void 0?null:L)}function Zv(v,x,T,L){var B=Qo();L=L===void 0?null:L;var q=void 0;if(Fn!==null){var ue=Fn.memoizedState;if(q=ue.destroy,L!==null&&Xv(L,ue.deps)){B.memoizedState=xc(x,T,q,L);return}}mn.flags|=v,B.memoizedState=xc(1|x,T,q,L)}function so(v,x){return Xc(8390656,8,v,x)}function ES(v,x){return Zv(2048,8,v,x)}function AS(v,x){return Zv(4,2,v,x)}function fC(v,x){return Zv(4,4,v,x)}function pC(v,x){if(typeof x=="function")return v=v(),x(v),function(){x(null)};if(x!=null)return v=v(),x.current=v,function(){x.current=null}}function MS(v,x,T){return T=T!=null?T.concat([v]):null,Zv(4,4,pC.bind(null,x,v),T)}function zx(){}function mC(v,x){var T=Qo();x=x===void 0?null:x;var L=T.memoizedState;return L!==null&&x!==null&&Xv(x,L[1])?L[0]:(T.memoizedState=[v,x],v)}function Jo(v,x){var T=Qo();x=x===void 0?null:x;var L=T.memoizedState;return L!==null&&x!==null&&Xv(x,L[1])?L[0]:(v=v(),T.memoizedState=[v,x],v)}function jx(v,x,T){return(Vu&21)===0?(v.baseState&&(v.baseState=!1,ur=!0),v.memoizedState=T):(Xo(T,x)||(T=bn(),mn.lanes|=T,ey|=T,v.baseState=!0),x)}function zL(v,x){var T=cr;cr=T!==0&&4>T?T:4,v(!0);var L=zf.transition;zf.transition={};try{v(!1),x()}finally{cr=T,zf.transition=L}}function Gu(){return Qo().memoizedState}function Vx(v,x,T){var L=Pm(v);if(T={lane:L,action:T,hasEagerState:!1,eagerState:null,next:null},Qv(v))Hx(x,T);else if(T=Wv(v,x,T,L),T!==null){var B=tl();$u(T,v,L,B),Gx(T,x,L)}}function jf(v,x,T){var L=Pm(v),B={lane:L,action:T,hasEagerState:!1,eagerState:null,next:null};if(Qv(v))Hx(x,B);else{var q=v.alternate;if(v.lanes===0&&(q===null||q.lanes===0)&&(q=x.lastRenderedReducer,q!==null))try{var ue=x.lastRenderedState,Me=q(ue,T);if(B.hasEagerState=!0,B.eagerState=Me,Xo(Me,ue)){var Oe=x.interleaved;Oe===null?(B.next=B,yS(x)):(B.next=Oe.next,Oe.next=B),x.interleaved=B;return}}catch{}finally{}T=Wv(v,x,B,L),T!==null&&(B=tl(),$u(T,v,L,B),Gx(T,x,L))}}function Qv(v){var x=v.alternate;return v===mn||x!==null&&x===mn}function Hx(v,x){Ca=yc=!0;var T=v.pending;T===null?x.next=x:(x.next=T.next,T.next=x),v.pending=x}function Gx(v,x,T){if((T&4194240)!==0){var L=x.lanes;L&=v.pendingLanes,T|=L,x.lanes=T,Fc(v,T)}}var Wx={readContext:Ko,useCallback:Zs,useContext:Zs,useEffect:Zs,useImperativeHandle:Zs,useInsertionEffect:Zs,useLayoutEffect:Zs,useMemo:Zs,useReducer:Zs,useRef:Zs,useState:Zs,useDebugValue:Zs,useDeferredValue:Zs,useTransition:Zs,useMutableSource:Zs,useSyncExternalStore:Zs,useId:Zs,unstable_isNewReconciler:!1},gC={readContext:Ko,useCallback:function(v,x){return Qs().memoizedState=[v,x===void 0?null:x],v},useContext:Ko,useEffect:so,useImperativeHandle:function(v,x,T){return T=T!=null?T.concat([v]):null,Xc(4194308,4,pC.bind(null,x,v),T)},useLayoutEffect:function(v,x){return Xc(4194308,4,v,x)},useInsertionEffect:function(v,x){return Xc(4,2,v,x)},useMemo:function(v,x){var T=Qs();return x=x===void 0?null:x,v=v(),T.memoizedState=[v,x],v},useReducer:function(v,x,T){var L=Qs();return x=T!==void 0?T(x):x,L.memoizedState=L.baseState=x,v={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:v,lastRenderedState:x},L.queue=v,v=v.dispatch=Vx.bind(null,mn,v),[L.memoizedState,v]},useRef:function(v){var x=Qs();return v={current:v},x.memoizedState=v},useState:SS,useDebugValue:zx,useDeferredValue:function(v){return Qs().memoizedState=v},useTransition:function(){var v=SS(!1),x=v[0];return v=zL.bind(null,v[1]),Qs().memoizedState=v,[x,v]},useMutableSource:function(){},useSyncExternalStore:function(v,x,T){var L=mn,B=Qs();if(wn){if(T===void 0)throw Error(i(407));T=T()}else{if(T=x(),Pa===null)throw Error(i(349));(Vu&30)!==0||Fx(L,x,T)}B.memoizedState=T;var q={value:T,getSnapshot:x};return B.queue=q,so(uC.bind(null,L,q,v),[v]),L.flags|=2048,xc(9,Kv.bind(null,L,q,T,x),void 0,null),T},useId:function(){var v=Qs(),x=Pa.identifierPrefix;if(wn){var T=Il,L=zt;T=(L&~(1<<32-_e(L)-1)).toString(32)+T,x=":"+x+"R"+T,T=Zh++,0<T&&(x+="H"+T.toString(32)),x+=":"}else T=Po++,x=":"+x+"r"+T.toString(32)+":";return v.memoizedState=x},unstable_isNewReconciler:!1},vC={readContext:Ko,useCallback:mC,useContext:Ko,useEffect:ES,useImperativeHandle:MS,useInsertionEffect:AS,useLayoutEffect:fC,useMemo:Jo,useReducer:Yv,useRef:dC,useState:function(){return Yv(Am)},useDebugValue:zx,useDeferredValue:function(v){var x=Qo();return jx(x,Fn.memoizedState,v)},useTransition:function(){var v=Yv(Am)[0],x=Qo().memoizedState;return[v,x]},useMutableSource:bS,useSyncExternalStore:wS,useId:Gu,unstable_isNewReconciler:!1},yC={readContext:Ko,useCallback:mC,useContext:Ko,useEffect:ES,useImperativeHandle:MS,useInsertionEffect:AS,useLayoutEffect:fC,useMemo:Jo,useReducer:Hu,useRef:dC,useState:function(){return Hu(Am)},useDebugValue:zx,useDeferredValue:function(v){var x=Qo();return Fn===null?x.memoizedState=v:jx(x,Fn.memoizedState,v)},useTransition:function(){var v=Hu(Am)[0],x=Qo().memoizedState;return[v,x]},useMutableSource:bS,useSyncExternalStore:wS,useId:Gu,unstable_isNewReconciler:!1};function Ol(v,x){if(v&&v.defaultProps){x=Z({},x),v=v.defaultProps;for(var T in v)x[T]===void 0&&(x[T]=v[T]);return x}return x}function Jv(v,x,T,L){x=v.memoizedState,T=T(L,x),T=T==null?x:Z({},x,T),v.memoizedState=T,v.lanes===0&&(v.updateQueue.baseState=T)}var qx={isMounted:function(v){return(v=v._reactInternals)?yi(v)===v:!1},enqueueSetState:function(v,x,T){v=v._reactInternals;var L=tl(),B=Pm(v),q=Kr(L,B);q.payload=x,T!=null&&(q.callback=T),x=Mn(v,q,B),x!==null&&($u(x,v,B,L),Ta(x,v,B))},enqueueReplaceState:function(v,x,T){v=v._reactInternals;var L=tl(),B=Pm(v),q=Kr(L,B);q.tag=1,q.payload=x,T!=null&&(q.callback=T),x=Mn(v,q,B),x!==null&&($u(x,v,B,L),Ta(x,v,B))},enqueueForceUpdate:function(v,x){v=v._reactInternals;var T=tl(),L=Pm(v),B=Kr(T,L);B.tag=2,x!=null&&(B.callback=x),x=Mn(v,B,L),x!==null&&($u(x,v,L,T),Ta(x,v,L))}};function xC(v,x,T,L,B,q,ue){return v=v.stateNode,typeof v.shouldComponentUpdate=="function"?v.shouldComponentUpdate(L,q,ue):x.prototype&&x.prototype.isPureReactComponent?!_f(T,L)||!_f(B,q):!0}function _(v,x,T){var L=!1,B=ku,q=x.contextType;return typeof q=="object"&&q!==null?q=Ko(q):(B=Ma(x)?Nu:Ys.current,L=x.contextTypes,q=(L=L!=null)?Cf(v,B):ku),x=new x(T,q),v.memoizedState=x.state!==null&&x.state!==void 0?x.state:null,x.updater=qx,v.stateNode=x,x._reactInternals=v,L&&(v=v.stateNode,v.__reactInternalMemoizedUnmaskedChildContext=B,v.__reactInternalMemoizedMaskedChildContext=q),x}function S(v,x,T,L){v=x.state,typeof x.componentWillReceiveProps=="function"&&x.componentWillReceiveProps(T,L),typeof x.UNSAFE_componentWillReceiveProps=="function"&&x.UNSAFE_componentWillReceiveProps(T,L),x.state!==v&&qx.enqueueReplaceState(x,x.state,null)}function D(v,x,T,L){var B=v.stateNode;B.props=T,B.state=v.memoizedState,B.refs={},sr(v);var q=x.contextType;typeof q=="object"&&q!==null?B.context=Ko(q):(q=Ma(x)?Nu:Ys.current,B.context=Cf(v,q)),B.state=v.memoizedState,q=x.getDerivedStateFromProps,typeof q=="function"&&(Jv(v,x,q,T),B.state=v.memoizedState),typeof x.getDerivedStateFromProps=="function"||typeof B.getSnapshotBeforeUpdate=="function"||typeof B.UNSAFE_componentWillMount!="function"&&typeof B.componentWillMount!="function"||(x=B.state,typeof B.componentWillMount=="function"&&B.componentWillMount(),typeof B.UNSAFE_componentWillMount=="function"&&B.UNSAFE_componentWillMount(),x!==B.state&&qx.enqueueReplaceState(B,B.state,null),Bn(v,T,B,L),B.state=v.memoizedState),typeof B.componentDidMount=="function"&&(v.flags|=4194308)}function N(v,x){try{var T="",L=x;do T+=se(L),L=L.return;while(L);var B=T}catch(q){B=`
Error generating stack: `+q.message+`
`+q.stack}return{value:v,source:x,stack:B,digest:null}}function H(v,x,T){return{value:v,source:null,stack:T??null,digest:x??null}}function ie(v,x){try{console.error(x.value)}catch(T){setTimeout(function(){throw T})}}var Ee=typeof WeakMap=="function"?WeakMap:Map;function Ge(v,x,T){T=Kr(-1,T),T.tag=3,T.payload={element:null};var L=x.value;return T.callback=function(){MC||(MC=!0,KL=L),ie(v,x)},T}function vt(v,x,T){T=Kr(-1,T),T.tag=3;var L=v.type.getDerivedStateFromError;if(typeof L=="function"){var B=x.value;T.payload=function(){return L(B)},T.callback=function(){ie(v,x)}}var q=v.stateNode;return q!==null&&typeof q.componentDidCatch=="function"&&(T.callback=function(){ie(v,x),typeof L!="function"&&(Tm===null?Tm=new Set([this]):Tm.add(this));var ue=x.stack;this.componentDidCatch(x.value,{componentStack:ue!==null?ue:""})}),T}function Ot(v,x,T){var L=v.pingCache;if(L===null){L=v.pingCache=new Ee;var B=new Set;L.set(x,B)}else B=L.get(x),B===void 0&&(B=new Set,L.set(x,B));B.has(T)||(B.add(T),v=Mge.bind(null,v,x,T),x.then(v,v))}function ri(v){do{var x;if((x=v.tag===13)&&(x=v.memoizedState,x=x!==null?x.dehydrated!==null:!0),x)return v;v=v.return}while(v!==null);return null}function $i(v,x,T,L,B){return(v.mode&1)===0?(v===x?v.flags|=65536:(v.flags|=128,T.flags|=131072,T.flags&=-52805,T.tag===1&&(T.alternate===null?T.tag=17:(x=Kr(-1,1),x.tag=2,Mn(T,x,1))),T.lanes|=1),v):(v.flags|=65536,v.lanes=B,v)}var Ci=E.ReactCurrentOwner,ur=!1;function Yt(v,x,T,L){x.child=v===null?Vv(x,null,T,L):Df(x,v.child,T,L)}function Js(v,x,T,L,B){T=T.render;var q=x.ref;return Yh(x,B),L=$v(v,x,T,L,q,B),T=xS(),v!==null&&!ur?(x.updateQueue=v.updateQueue,x.flags&=-2053,v.lanes&=~B,Vf(v,x,B)):(wn&&T&&dS(x),x.flags|=1,Yt(v,x,L,B),x.child)}function el(v,x,T,L,B){if(v===null){var q=T.type;return typeof q=="function"&&!rk(q)&&q.defaultProps===void 0&&T.compare===null&&T.defaultProps===void 0?(x.tag=15,x.type=q,tt(v,x,q,L,B)):(v=DC(T.type,null,L,x,x.mode,B),v.ref=x.ref,v.return=x,x.child=v)}if(q=v.child,(v.lanes&B)===0){var ue=q.memoizedProps;if(T=T.compare,T=T!==null?T:_f,T(ue,L)&&v.ref===x.ref)return Vf(v,x,B)}return x.flags|=1,v=Im(q,L),v.ref=x.ref,v.return=x,x.child=v}function tt(v,x,T,L,B){if(v!==null){var q=v.memoizedProps;if(_f(q,L)&&v.ref===x.ref)if(ur=!1,x.pendingProps=L=q,(v.lanes&B)!==0)(v.flags&131072)!==0&&(ur=!0);else return x.lanes=v.lanes,Vf(v,x,B)}return qt(v,x,T,L,B)}function We(v,x,T){var L=x.pendingProps,B=L.children,q=v!==null?v.memoizedState:null;if(L.mode==="hidden")if((x.mode&1)===0)x.memoizedState={baseLanes:0,cachePool:null,transitions:null},sn($x,bc),bc|=T;else{if((T&1073741824)===0)return v=q!==null?q.baseLanes|T:T,x.lanes=x.childLanes=1073741824,x.memoizedState={baseLanes:v,cachePool:null,transitions:null},x.updateQueue=null,sn($x,bc),bc|=v,null;x.memoizedState={baseLanes:0,cachePool:null,transitions:null},L=q!==null?q.baseLanes:T,sn($x,bc),bc|=L}else q!==null?(L=q.baseLanes|T,x.memoizedState=null):L=T,sn($x,bc),bc|=L;return Yt(v,x,B,T),x.child}function ut(v,x){var T=x.ref;(v===null&&T!==null||v!==null&&v.ref!==T)&&(x.flags|=512,x.flags|=2097152)}function qt(v,x,T,L,B){var q=Ma(T)?Nu:Ys.current;return q=Cf(x,q),Yh(x,B),T=$v(v,x,T,L,q,B),L=xS(),v!==null&&!ur?(x.updateQueue=v.updateQueue,x.flags&=-2053,v.lanes&=~B,Vf(v,x,B)):(wn&&L&&dS(x),x.flags|=1,Yt(v,x,T,B),x.child)}function vi(v,x,T,L,B){if(Ma(T)){var q=!0;Pf(x)}else q=!1;if(Yh(x,B),x.stateNode===null)wC(v,x),_(x,T,L),D(x,T,L,B),L=!0;else if(v===null){var ue=x.stateNode,Me=x.memoizedProps;ue.props=Me;var Oe=ue.context,lt=T.contextType;typeof lt=="object"&&lt!==null?lt=Ko(lt):(lt=Ma(T)?Nu:Ys.current,lt=Cf(x,lt));var Pt=T.getDerivedStateFromProps,It=typeof Pt=="function"||typeof ue.getSnapshotBeforeUpdate=="function";It||typeof ue.UNSAFE_componentWillReceiveProps!="function"&&typeof ue.componentWillReceiveProps!="function"||(Me!==L||Oe!==lt)&&S(x,ue,L,lt),Yr=!1;var Ct=x.memoizedState;ue.state=Ct,Bn(x,L,ue,B),Oe=x.memoizedState,Me!==L||Ct!==Oe||io.current||Yr?(typeof Pt=="function"&&(Jv(x,T,Pt,L),Oe=x.memoizedState),(Me=Yr||xC(x,T,Me,L,Ct,Oe,lt))?(It||typeof ue.UNSAFE_componentWillMount!="function"&&typeof ue.componentWillMount!="function"||(typeof ue.componentWillMount=="function"&&ue.componentWillMount(),typeof ue.UNSAFE_componentWillMount=="function"&&ue.UNSAFE_componentWillMount()),typeof ue.componentDidMount=="function"&&(x.flags|=4194308)):(typeof ue.componentDidMount=="function"&&(x.flags|=4194308),x.memoizedProps=L,x.memoizedState=Oe),ue.props=L,ue.state=Oe,ue.context=lt,L=Me):(typeof ue.componentDidMount=="function"&&(x.flags|=4194308),L=!1)}else{ue=x.stateNode,qn(v,x),Me=x.memoizedProps,lt=x.type===x.elementType?Me:Ol(x.type,Me),ue.props=lt,It=x.pendingProps,Ct=ue.context,Oe=T.contextType,typeof Oe=="object"&&Oe!==null?Oe=Ko(Oe):(Oe=Ma(T)?Nu:Ys.current,Oe=Cf(x,Oe));var Jt=T.getDerivedStateFromProps;(Pt=typeof Jt=="function"||typeof ue.getSnapshotBeforeUpdate=="function")||typeof ue.UNSAFE_componentWillReceiveProps!="function"&&typeof ue.componentWillReceiveProps!="function"||(Me!==It||Ct!==Oe)&&S(x,ue,L,Oe),Yr=!1,Ct=x.memoizedState,ue.state=Ct,Bn(x,L,ue,B);var li=x.memoizedState;Me!==It||Ct!==li||io.current||Yr?(typeof Jt=="function"&&(Jv(x,T,Jt,L),li=x.memoizedState),(lt=Yr||xC(x,T,lt,L,Ct,li,Oe)||!1)?(Pt||typeof ue.UNSAFE_componentWillUpdate!="function"&&typeof ue.componentWillUpdate!="function"||(typeof ue.componentWillUpdate=="function"&&ue.componentWillUpdate(L,li,Oe),typeof ue.UNSAFE_componentWillUpdate=="function"&&ue.UNSAFE_componentWillUpdate(L,li,Oe)),typeof ue.componentDidUpdate=="function"&&(x.flags|=4),typeof ue.getSnapshotBeforeUpdate=="function"&&(x.flags|=1024)):(typeof ue.componentDidUpdate!="function"||Me===v.memoizedProps&&Ct===v.memoizedState||(x.flags|=4),typeof ue.getSnapshotBeforeUpdate!="function"||Me===v.memoizedProps&&Ct===v.memoizedState||(x.flags|=1024),x.memoizedProps=L,x.memoizedState=li),ue.props=L,ue.state=li,ue.context=Oe,L=lt):(typeof ue.componentDidUpdate!="function"||Me===v.memoizedProps&&Ct===v.memoizedState||(x.flags|=4),typeof ue.getSnapshotBeforeUpdate!="function"||Me===v.memoizedProps&&Ct===v.memoizedState||(x.flags|=1024),L=!1)}return tr(v,x,T,L,q,B)}function tr(v,x,T,L,B,q){ut(v,x);var ue=(x.flags&128)!==0;if(!L&&!ue)return B&&uS(x,T,!1),Vf(v,x,q);L=x.stateNode,Ci.current=x;var Me=ue&&typeof T.getDerivedStateFromError!="function"?null:L.render();return x.flags|=1,v!==null&&ue?(x.child=Df(x,v.child,null,q),x.child=Df(x,null,Me,q)):Yt(v,x,Me,q),x.memoizedState=L.state,B&&uS(x,T,!0),x.child}function Yi(v){var x=v.stateNode;x.pendingContext?cS(v,x.pendingContext,x.pendingContext!==x.context):x.context&&cS(v,x.context,!1),qv(v,x.containerInfo)}function Cr(v,x,T,L,B){return $h(),bm(B),x.flags|=256,Yt(v,x,T,L),x.child}var Qn={dehydrated:null,treeContext:null,retryLane:0};function Ar(v){return{baseLanes:v,cachePool:null,transitions:null}}function Wu(v,x,T){var L=x.pendingProps,B=_n.current,q=!1,ue=(x.flags&128)!==0,Me;if((Me=ue)||(Me=v!==null&&v.memoizedState===null?!1:(B&2)!==0),Me?(q=!0,x.flags&=-129):(v===null||v.memoizedState!==null)&&(B|=1),sn(_n,B&1),v===null)return Ux(x),v=x.memoizedState,v!==null&&(v=v.dehydrated,v!==null)?((x.mode&1)===0?x.lanes=1:v.data==="$!"?x.lanes=8:x.lanes=1073741824,null):(ue=L.children,v=L.fallback,q?(L=x.mode,q=x.child,ue={mode:"hidden",children:ue},(L&1)===0&&q!==null?(q.childLanes=0,q.pendingProps=ue):q=OC(ue,L,0,null),v=ny(v,L,T,null),q.return=x,v.return=x,q.sibling=v,x.child=q,x.child.memoizedState=Ar(T),x.memoizedState=Qn,v):TS(x,ue));if(B=v.memoizedState,B!==null&&(Me=B.dehydrated,Me!==null))return pge(v,x,ue,L,Me,B,T);if(q){q=L.fallback,ue=x.mode,B=v.child,Me=B.sibling;var Oe={mode:"hidden",children:L.children};return(ue&1)===0&&x.child!==B?(L=x.child,L.childLanes=0,L.pendingProps=Oe,x.deletions=null):(L=Im(B,Oe),L.subtreeFlags=B.subtreeFlags&14680064),Me!==null?q=Im(Me,q):(q=ny(q,ue,T,null),q.flags|=2),q.return=x,L.return=x,L.sibling=q,x.child=L,L=q,q=x.child,ue=v.child.memoizedState,ue=ue===null?Ar(T):{baseLanes:ue.baseLanes|T,cachePool:null,transitions:ue.transitions},q.memoizedState=ue,q.childLanes=v.childLanes&~T,x.memoizedState=Qn,L}return q=v.child,v=q.sibling,L=Im(q,{mode:"visible",children:L.children}),(x.mode&1)===0&&(L.lanes=T),L.return=x,L.sibling=null,v!==null&&(T=x.deletions,T===null?(x.deletions=[v],x.flags|=16):T.push(v)),x.child=L,x.memoizedState=null,L}function TS(v,x){return x=OC({mode:"visible",children:x},v.mode,0,null),x.return=v,v.child=x}function bC(v,x,T,L){return L!==null&&bm(L),Df(x,v.child,null,T),v=TS(x,x.pendingProps.children),v.flags|=2,x.memoizedState=null,v}function pge(v,x,T,L,B,q,ue){if(T)return x.flags&256?(x.flags&=-257,L=H(Error(i(422))),bC(v,x,ue,L)):x.memoizedState!==null?(x.child=v.child,x.flags|=128,null):(q=L.fallback,B=x.mode,L=OC({mode:"visible",children:L.children},B,0,null),q=ny(q,B,ue,null),q.flags|=2,L.return=x,q.return=x,L.sibling=q,x.child=L,(x.mode&1)!==0&&Df(x,v.child,null,ue),x.child.memoizedState=Ar(ue),x.memoizedState=Qn,q);if((x.mode&1)===0)return bC(v,x,ue,null);if(B.data==="$!"){if(L=B.nextSibling&&B.nextSibling.dataset,L)var Me=L.dgst;return L=Me,q=Error(i(419)),L=H(q,L,void 0),bC(v,x,ue,L)}if(Me=(ue&v.childLanes)!==0,ur||Me){if(L=Pa,L!==null){switch(ue&-ue){case 4:B=2;break;case 16:B=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:B=32;break;case 536870912:B=268435456;break;default:B=0}B=(B&(L.suspendedLanes|ue))!==0?0:B,B!==0&&B!==q.retryLane&&(q.retryLane=B,gc(v,B),$u(L,v,B,-1))}return ik(),L=H(Error(i(421))),bC(v,x,ue,L)}return B.data==="$?"?(x.flags|=128,x.child=v.child,x=Tge.bind(null,v),B._reactRetry=x,null):(v=q.treeContext,no=Ou(B.nextSibling),Ks=x,wn=!0,Dl=null,v!==null&&(ro[Rs++]=zt,ro[Rs++]=Il,ro[Rs++]=If,zt=v.id,Il=v.overflow,If=x),x=TS(x,L.children),x.flags|=4096,x)}function R8(v,x,T){v.lanes|=x;var L=v.alternate;L!==null&&(L.lanes|=x),Gv(v.return,x,T)}function jL(v,x,T,L,B){var q=v.memoizedState;q===null?v.memoizedState={isBackwards:x,rendering:null,renderingStartTime:0,last:L,tail:T,tailMode:B}:(q.isBackwards=x,q.rendering=null,q.renderingStartTime=0,q.last=L,q.tail=T,q.tailMode=B)}function I8(v,x,T){var L=x.pendingProps,B=L.revealOrder,q=L.tail;if(Yt(v,x,L.children,T),L=_n.current,(L&2)!==0)L=L&1|2,x.flags|=128;else{if(v!==null&&(v.flags&128)!==0)e:for(v=x.child;v!==null;){if(v.tag===13)v.memoizedState!==null&&R8(v,T,x);else if(v.tag===19)R8(v,T,x);else if(v.child!==null){v.child.return=v,v=v.child;continue}if(v===x)break e;for(;v.sibling===null;){if(v.return===null||v.return===x)break e;v=v.return}v.sibling.return=v.return,v=v.sibling}L&=1}if(sn(_n,L),(x.mode&1)===0)x.memoizedState=null;else switch(B){case"forwards":for(T=x.child,B=null;T!==null;)v=T.alternate,v!==null&&vc(v)===null&&(B=T),T=T.sibling;T=B,T===null?(B=x.child,x.child=null):(B=T.sibling,T.sibling=null),jL(x,!1,B,T,q);break;case"backwards":for(T=null,B=x.child,x.child=null;B!==null;){if(v=B.alternate,v!==null&&vc(v)===null){x.child=B;break}v=B.sibling,B.sibling=T,T=B,B=v}jL(x,!0,T,null,q);break;case"together":jL(x,!1,null,null,void 0);break;default:x.memoizedState=null}return x.child}function wC(v,x){(x.mode&1)===0&&v!==null&&(v.alternate=null,x.alternate=null,x.flags|=2)}function Vf(v,x,T){if(v!==null&&(x.dependencies=v.dependencies),ey|=x.lanes,(T&x.childLanes)===0)return null;if(v!==null&&x.child!==v.child)throw Error(i(153));if(x.child!==null){for(v=x.child,T=Im(v,v.pendingProps),x.child=T,T.return=x;v.sibling!==null;)v=v.sibling,T=T.sibling=Im(v,v.pendingProps),T.return=x;T.sibling=null}return x.child}function mge(v,x,T){switch(x.tag){case 3:Yi(x),$h();break;case 5:Bf(x);break;case 1:Ma(x.type)&&Pf(x);break;case 4:qv(x,x.stateNode.containerInfo);break;case 10:var L=x.type._context,B=x.memoizedProps.value;sn(Of,L._currentValue),L._currentValue=B;break;case 13:if(L=x.memoizedState,L!==null)return L.dehydrated!==null?(sn(_n,_n.current&1),x.flags|=128,null):(T&x.child.childLanes)!==0?Wu(v,x,T):(sn(_n,_n.current&1),v=Vf(v,x,T),v!==null?v.sibling:null);sn(_n,_n.current&1);break;case 19:if(L=(T&x.childLanes)!==0,(v.flags&128)!==0){if(L)return I8(v,x,T);x.flags|=128}if(B=x.memoizedState,B!==null&&(B.rendering=null,B.tail=null,B.lastEffect=null),sn(_n,_n.current),L)break;return null;case 22:case 23:return x.lanes=0,We(v,x,T)}return Vf(v,x,T)}var D8,VL,O8,L8;D8=function(v,x){for(var T=x.child;T!==null;){if(T.tag===5||T.tag===6)v.appendChild(T.stateNode);else if(T.tag!==4&&T.child!==null){T.child.return=T,T=T.child;continue}if(T===x)break;for(;T.sibling===null;){if(T.return===null||T.return===x)return;T=T.return}T.sibling.return=T.return,T=T.sibling}},VL=function(){},O8=function(v,x,T,L){var B=v.memoizedProps;if(B!==L){v=x.stateNode,Zn(Zo.current);var q=null;switch(T){case"input":B=Fe(v,B),L=Fe(v,L),q=[];break;case"select":B=Z({},B,{value:void 0}),L=Z({},L,{value:void 0}),q=[];break;case"textarea":B=ge(v,B),L=ge(v,L),q=[];break;default:typeof B.onClick!="function"&&typeof L.onClick=="function"&&(v.onclick=kv)}yt(T,L);var ue;T=null;for(lt in B)if(!L.hasOwnProperty(lt)&&B.hasOwnProperty(lt)&&B[lt]!=null)if(lt==="style"){var Me=B[lt];for(ue in Me)Me.hasOwnProperty(ue)&&(T||(T={}),T[ue]="")}else lt!=="dangerouslySetInnerHTML"&&lt!=="children"&&lt!=="suppressContentEditableWarning"&&lt!=="suppressHydrationWarning"&&lt!=="autoFocus"&&(n.hasOwnProperty(lt)?q||(q=[]):(q=q||[]).push(lt,null));for(lt in L){var Oe=L[lt];if(Me=B?.[lt],L.hasOwnProperty(lt)&&Oe!==Me&&(Oe!=null||Me!=null))if(lt==="style")if(Me){for(ue in Me)!Me.hasOwnProperty(ue)||Oe&&Oe.hasOwnProperty(ue)||(T||(T={}),T[ue]="");for(ue in Oe)Oe.hasOwnProperty(ue)&&Me[ue]!==Oe[ue]&&(T||(T={}),T[ue]=Oe[ue])}else T||(q||(q=[]),q.push(lt,T)),T=Oe;else lt==="dangerouslySetInnerHTML"?(Oe=Oe?Oe.__html:void 0,Me=Me?Me.__html:void 0,Oe!=null&&Me!==Oe&&(q=q||[]).push(lt,Oe)):lt==="children"?typeof Oe!="string"&&typeof Oe!="number"||(q=q||[]).push(lt,""+Oe):lt!=="suppressContentEditableWarning"&&lt!=="suppressHydrationWarning"&&(n.hasOwnProperty(lt)?(Oe!=null&&lt==="onScroll"&&fn("scroll",v),q||Me===Oe||(q=[])):(q=q||[]).push(lt,Oe))}T&&(q=q||[]).push("style",T);var lt=q;(x.updateQueue=lt)&&(x.flags|=4)}},L8=function(v,x,T,L){T!==L&&(x.flags|=4)};function CS(v,x){if(!wn)switch(v.tailMode){case"hidden":x=v.tail;for(var T=null;x!==null;)x.alternate!==null&&(T=x),x=x.sibling;T===null?v.tail=null:T.sibling=null;break;case"collapsed":T=v.tail;for(var L=null;T!==null;)T.alternate!==null&&(L=T),T=T.sibling;L===null?x||v.tail===null?v.tail=null:v.tail.sibling=null:L.sibling=null}}function Ro(v){var x=v.alternate!==null&&v.alternate.child===v.child,T=0,L=0;if(x)for(var B=v.child;B!==null;)T|=B.lanes|B.childLanes,L|=B.subtreeFlags&14680064,L|=B.flags&14680064,B.return=v,B=B.sibling;else for(B=v.child;B!==null;)T|=B.lanes|B.childLanes,L|=B.subtreeFlags,L|=B.flags,B.return=v,B=B.sibling;return v.subtreeFlags|=L,v.childLanes=T,x}function gge(v,x,T){var L=x.pendingProps;switch(Bu(x),x.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Ro(x),null;case 1:return Ma(x.type)&&Nv(),Ro(x),null;case 3:return L=x.stateNode,Kh(),pn(io),pn(Ys),qc(),L.pendingContext&&(L.context=L.pendingContext,L.pendingContext=null),(v===null||v.child===null)&&(xm(x)?x.flags|=4:v===null||v.memoizedState.isDehydrated&&(x.flags&256)===0||(x.flags|=1024,Dl!==null&&(JL(Dl),Dl=null))),VL(v,x),Ro(x),null;case 5:Sm(x);var B=Zn(ju.current);if(T=x.type,v!==null&&x.stateNode!=null)O8(v,x,T,L,B),v.ref!==x.ref&&(x.flags|=512,x.flags|=2097152);else{if(!L){if(x.stateNode===null)throw Error(i(166));return Ro(x),null}if(v=Zn(Zo.current),xm(x)){L=x.stateNode,T=x.type;var q=x.memoizedProps;switch(L[ds]=x,L[ym]=q,v=(x.mode&1)!==0,T){case"dialog":fn("cancel",L),fn("close",L);break;case"iframe":case"object":case"embed":fn("load",L);break;case"video":case"audio":for(B=0;B<qh.length;B++)fn(qh[B],L);break;case"source":fn("error",L);break;case"img":case"image":case"link":fn("error",L),fn("load",L);break;case"details":fn("toggle",L);break;case"input":De(L,q),fn("invalid",L);break;case"select":L._wrapperState={wasMultiple:!!q.multiple},fn("invalid",L);break;case"textarea":G(L,q),fn("invalid",L)}yt(T,q),B=null;for(var ue in q)if(q.hasOwnProperty(ue)){var Me=q[ue];ue==="children"?typeof Me=="string"?L.textContent!==Me&&(q.suppressHydrationWarning!==!0&&Lv(L.textContent,Me,v),B=["children",Me]):typeof Me=="number"&&L.textContent!==""+Me&&(q.suppressHydrationWarning!==!0&&Lv(L.textContent,Me,v),B=["children",""+Me]):n.hasOwnProperty(ue)&&Me!=null&&ue==="onScroll"&&fn("scroll",L)}switch(T){case"input":Se(L),$e(L,q,!0);break;case"textarea":Se(L),we(L);break;case"select":case"option":break;default:typeof q.onClick=="function"&&(L.onclick=kv)}L=B,x.updateQueue=L,L!==null&&(x.flags|=4)}else{ue=B.nodeType===9?B:B.ownerDocument,v==="http://www.w3.org/1999/xhtml"&&(v=te(T)),v==="http://www.w3.org/1999/xhtml"?T==="script"?(v=ue.createElement("div"),v.innerHTML="<script><\/script>",v=v.removeChild(v.firstChild)):typeof L.is=="string"?v=ue.createElement(T,{is:L.is}):(v=ue.createElement(T),T==="select"&&(ue=v,L.multiple?ue.multiple=!0:L.size&&(ue.size=L.size))):v=ue.createElementNS(v,T),v[ds]=x,v[ym]=L,D8(v,x,!1,!1),x.stateNode=v;e:{switch(ue=Et(T,L),T){case"dialog":fn("cancel",v),fn("close",v),B=L;break;case"iframe":case"object":case"embed":fn("load",v),B=L;break;case"video":case"audio":for(B=0;B<qh.length;B++)fn(qh[B],v);B=L;break;case"source":fn("error",v),B=L;break;case"img":case"image":case"link":fn("error",v),fn("load",v),B=L;break;case"details":fn("toggle",v),B=L;break;case"input":De(v,L),B=Fe(v,L),fn("invalid",v);break;case"option":B=L;break;case"select":v._wrapperState={wasMultiple:!!L.multiple},B=Z({},L,{value:void 0}),fn("invalid",v);break;case"textarea":G(v,L),B=ge(v,L),fn("invalid",v);break;default:B=L}yt(T,B),Me=B;for(q in Me)if(Me.hasOwnProperty(q)){var Oe=Me[q];q==="style"?pt(v,Oe):q==="dangerouslySetInnerHTML"?(Oe=Oe?Oe.__html:void 0,Oe!=null&&at(v,Oe)):q==="children"?typeof Oe=="string"?(T!=="textarea"||Oe!=="")&&Te(v,Oe):typeof Oe=="number"&&Te(v,""+Oe):q!=="suppressContentEditableWarning"&&q!=="suppressHydrationWarning"&&q!=="autoFocus"&&(n.hasOwnProperty(q)?Oe!=null&&q==="onScroll"&&fn("scroll",v):Oe!=null&&w(v,q,Oe,ue))}switch(T){case"input":Se(v),$e(v,L,!1);break;case"textarea":Se(v),we(v);break;case"option":L.value!=null&&v.setAttribute("value",""+he(L.value));break;case"select":v.multiple=!!L.multiple,q=L.value,q!=null?wt(v,!!L.multiple,q,!1):L.defaultValue!=null&&wt(v,!!L.multiple,L.defaultValue,!0);break;default:typeof B.onClick=="function"&&(v.onclick=kv)}switch(T){case"button":case"input":case"select":case"textarea":L=!!L.autoFocus;break e;case"img":L=!0;break e;default:L=!1}}L&&(x.flags|=4)}x.ref!==null&&(x.flags|=512,x.flags|=2097152)}return Ro(x),null;case 6:if(v&&x.stateNode!=null)L8(v,x,v.memoizedProps,L);else{if(typeof L!="string"&&x.stateNode===null)throw Error(i(166));if(T=Zn(ju.current),Zn(Zo.current),xm(x)){if(L=x.stateNode,T=x.memoizedProps,L[ds]=x,(q=L.nodeValue!==T)&&(v=Ks,v!==null))switch(v.tag){case 3:Lv(L.nodeValue,T,(v.mode&1)!==0);break;case 5:v.memoizedProps.suppressHydrationWarning!==!0&&Lv(L.nodeValue,T,(v.mode&1)!==0)}q&&(x.flags|=4)}else L=(T.nodeType===9?T:T.ownerDocument).createTextNode(L),L[ds]=x,x.stateNode=L}return Ro(x),null;case 13:if(pn(_n),L=x.memoizedState,v===null||v.memoizedState!==null&&v.memoizedState.dehydrated!==null){if(wn&&no!==null&&(x.mode&1)!==0&&(x.flags&128)===0)mS(),$h(),x.flags|=98560,q=!1;else if(q=xm(x),L!==null&&L.dehydrated!==null){if(v===null){if(!q)throw Error(i(318));if(q=x.memoizedState,q=q!==null?q.dehydrated:null,!q)throw Error(i(317));q[ds]=x}else $h(),(x.flags&128)===0&&(x.memoizedState=null),x.flags|=4;Ro(x),q=!1}else Dl!==null&&(JL(Dl),Dl=null),q=!0;if(!q)return x.flags&65536?x:null}return(x.flags&128)!==0?(x.lanes=T,x):(L=L!==null,L!==(v!==null&&v.memoizedState!==null)&&L&&(x.child.flags|=8192,(x.mode&1)!==0&&(v===null||(_n.current&1)!==0?ea===0&&(ea=3):ik())),x.updateQueue!==null&&(x.flags|=4),Ro(x),null);case 4:return Kh(),VL(v,x),v===null&&mm(x.stateNode.containerInfo),Ro(x),null;case 10:return Hv(x.type._context),Ro(x),null;case 17:return Ma(x.type)&&Nv(),Ro(x),null;case 19:if(pn(_n),q=x.memoizedState,q===null)return Ro(x),null;if(L=(x.flags&128)!==0,ue=q.rendering,ue===null)if(L)CS(q,!1);else{if(ea!==0||v!==null&&(v.flags&128)!==0)for(v=x.child;v!==null;){if(ue=vc(v),ue!==null){for(x.flags|=128,CS(q,!1),L=ue.updateQueue,L!==null&&(x.updateQueue=L,x.flags|=4),x.subtreeFlags=0,L=T,T=x.child;T!==null;)q=T,v=L,q.flags&=14680066,ue=q.alternate,ue===null?(q.childLanes=0,q.lanes=v,q.child=null,q.subtreeFlags=0,q.memoizedProps=null,q.memoizedState=null,q.updateQueue=null,q.dependencies=null,q.stateNode=null):(q.childLanes=ue.childLanes,q.lanes=ue.lanes,q.child=ue.child,q.subtreeFlags=0,q.deletions=null,q.memoizedProps=ue.memoizedProps,q.memoizedState=ue.memoizedState,q.updateQueue=ue.updateQueue,q.type=ue.type,v=ue.dependencies,q.dependencies=v===null?null:{lanes:v.lanes,firstContext:v.firstContext}),T=T.sibling;return sn(_n,_n.current&1|2),x.child}v=v.sibling}q.tail!==null&&Ie()>Yx&&(x.flags|=128,L=!0,CS(q,!1),x.lanes=4194304)}else{if(!L)if(v=vc(ue),v!==null){if(x.flags|=128,L=!0,T=v.updateQueue,T!==null&&(x.updateQueue=T,x.flags|=4),CS(q,!0),q.tail===null&&q.tailMode==="hidden"&&!ue.alternate&&!wn)return Ro(x),null}else 2*Ie()-q.renderingStartTime>Yx&&T!==1073741824&&(x.flags|=128,L=!0,CS(q,!1),x.lanes=4194304);q.isBackwards?(ue.sibling=x.child,x.child=ue):(T=q.last,T!==null?T.sibling=ue:x.child=ue,q.last=ue)}return q.tail!==null?(x=q.tail,q.rendering=x,q.tail=x.sibling,q.renderingStartTime=Ie(),x.sibling=null,T=_n.current,sn(_n,L?T&1|2:T&1),x):(Ro(x),null);case 22:case 23:return tk(),L=x.memoizedState!==null,v!==null&&v.memoizedState!==null!==L&&(x.flags|=8192),L&&(x.mode&1)!==0?(bc&1073741824)!==0&&(Ro(x),x.subtreeFlags&6&&(x.flags|=8192)):Ro(x),null;case 24:return null;case 25:return null}throw Error(i(156,x.tag))}function vge(v,x){switch(Bu(x),x.tag){case 1:return Ma(x.type)&&Nv(),v=x.flags,v&65536?(x.flags=v&-65537|128,x):null;case 3:return Kh(),pn(io),pn(Ys),qc(),v=x.flags,(v&65536)!==0&&(v&128)===0?(x.flags=v&-65537|128,x):null;case 5:return Sm(x),null;case 13:if(pn(_n),v=x.memoizedState,v!==null&&v.dehydrated!==null){if(x.alternate===null)throw Error(i(340));$h()}return v=x.flags,v&65536?(x.flags=v&-65537|128,x):null;case 19:return pn(_n),null;case 4:return Kh(),null;case 10:return Hv(x.type._context),null;case 22:case 23:return tk(),null;case 24:return null;default:return null}}var _C=!1,Io=!1,yge=typeof WeakSet=="function"?WeakSet:Set,ai=null;function Xx(v,x){var T=v.ref;if(T!==null)if(typeof T=="function")try{T(null)}catch(L){Jn(v,x,L)}else T.current=null}function HL(v,x,T){try{T()}catch(L){Jn(v,x,L)}}var k8=!1;function xge(v,x){if(vm=Al,v=Dn(),Ms(v)){if("selectionStart"in v)var T={start:v.selectionStart,end:v.selectionEnd};else e:{T=(T=v.ownerDocument)&&T.defaultView||window;var L=T.getSelection&&T.getSelection();if(L&&L.rangeCount!==0){T=L.anchorNode;var B=L.anchorOffset,q=L.focusNode;L=L.focusOffset;try{T.nodeType,q.nodeType}catch{T=null;break e}var ue=0,Me=-1,Oe=-1,lt=0,Pt=0,It=v,Ct=null;t:for(;;){for(var Jt;It!==T||B!==0&&It.nodeType!==3||(Me=ue+B),It!==q||L!==0&&It.nodeType!==3||(Oe=ue+L),It.nodeType===3&&(ue+=It.nodeValue.length),(Jt=It.firstChild)!==null;)Ct=It,It=Jt;for(;;){if(It===v)break t;if(Ct===T&&++lt===B&&(Me=ue),Ct===q&&++Pt===L&&(Oe=ue),(Jt=It.nextSibling)!==null)break;It=Ct,Ct=It.parentNode}It=Jt}T=Me===-1||Oe===-1?null:{start:Me,end:Oe}}else T=null}T=T||{start:0,end:0}}else T=null;for(rS={focusedElem:v,selectionRange:T},Al=!1,ai=x;ai!==null;)if(x=ai,v=x.child,(x.subtreeFlags&1028)!==0&&v!==null)v.return=x,ai=v;else for(;ai!==null;){x=ai;try{var li=x.alternate;if((x.flags&1024)!==0)switch(x.tag){case 0:case 11:case 15:break;case 1:if(li!==null){var pi=li.memoizedProps,fs=li.memoizedState,Ye=x.stateNode,Ve=Ye.getSnapshotBeforeUpdate(x.elementType===x.type?pi:Ol(x.type,pi),fs);Ye.__reactInternalSnapshotBeforeUpdate=Ve}break;case 3:var et=x.stateNode.containerInfo;et.nodeType===1?et.textContent="":et.nodeType===9&&et.documentElement&&et.removeChild(et.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(i(163))}}catch(Lt){Jn(x,x.return,Lt)}if(v=x.sibling,v!==null){v.return=x.return,ai=v;break}ai=x.return}return li=k8,k8=!1,li}function PS(v,x,T){var L=x.updateQueue;if(L=L!==null?L.lastEffect:null,L!==null){var B=L=L.next;do{if((B.tag&v)===v){var q=B.destroy;B.destroy=void 0,q!==void 0&&HL(x,T,q)}B=B.next}while(B!==L)}}function SC(v,x){if(x=x.updateQueue,x=x!==null?x.lastEffect:null,x!==null){var T=x=x.next;do{if((T.tag&v)===v){var L=T.create;T.destroy=L()}T=T.next}while(T!==x)}}function GL(v){var x=v.ref;if(x!==null){var T=v.stateNode;switch(v.tag){case 5:v=T;break;default:v=T}typeof x=="function"?x(v):x.current=v}}function N8(v){var x=v.alternate;x!==null&&(v.alternate=null,N8(x)),v.child=null,v.deletions=null,v.sibling=null,v.tag===5&&(x=v.stateNode,x!==null&&(delete x[ds],delete x[ym],delete x[Tf],delete x[Rx],delete x[Ix])),v.stateNode=null,v.return=null,v.dependencies=null,v.memoizedProps=null,v.memoizedState=null,v.pendingProps=null,v.stateNode=null,v.updateQueue=null}function U8(v){return v.tag===5||v.tag===3||v.tag===4}function B8(v){e:for(;;){for(;v.sibling===null;){if(v.return===null||U8(v.return))return null;v=v.return}for(v.sibling.return=v.return,v=v.sibling;v.tag!==5&&v.tag!==6&&v.tag!==18;){if(v.flags&2||v.child===null||v.tag===4)continue e;v.child.return=v,v=v.child}if(!(v.flags&2))return v.stateNode}}function WL(v,x,T){var L=v.tag;if(L===5||L===6)v=v.stateNode,x?T.nodeType===8?T.parentNode.insertBefore(v,x):T.insertBefore(v,x):(T.nodeType===8?(x=T.parentNode,x.insertBefore(v,T)):(x=T,x.appendChild(v)),T=T._reactRootContainer,T!=null||x.onclick!==null||(x.onclick=kv));else if(L!==4&&(v=v.child,v!==null))for(WL(v,x,T),v=v.sibling;v!==null;)WL(v,x,T),v=v.sibling}function qL(v,x,T){var L=v.tag;if(L===5||L===6)v=v.stateNode,x?T.insertBefore(v,x):T.appendChild(v);else if(L!==4&&(v=v.child,v!==null))for(qL(v,x,T),v=v.sibling;v!==null;)qL(v,x,T),v=v.sibling}var ao=null,qu=!1;function Mm(v,x,T){for(T=T.child;T!==null;)F8(v,x,T),T=T.sibling}function F8(v,x,T){if(ne&&typeof ne.onCommitFiberUnmount=="function")try{ne.onCommitFiberUnmount(Wt,T)}catch{}switch(T.tag){case 5:Io||Xx(T,x);case 6:var L=ao,B=qu;ao=null,Mm(v,x,T),ao=L,qu=B,ao!==null&&(qu?(v=ao,T=T.stateNode,v.nodeType===8?v.parentNode.removeChild(T):v.removeChild(T)):ao.removeChild(T.stateNode));break;case 18:ao!==null&&(qu?(v=ao,T=T.stateNode,v.nodeType===8?Px(v.parentNode,T):v.nodeType===1&&Px(v,T),Sv(v)):Px(ao,T.stateNode));break;case 4:L=ao,B=qu,ao=T.stateNode.containerInfo,qu=!0,Mm(v,x,T),ao=L,qu=B;break;case 0:case 11:case 14:case 15:if(!Io&&(L=T.updateQueue,L!==null&&(L=L.lastEffect,L!==null))){B=L=L.next;do{var q=B,ue=q.destroy;q=q.tag,ue!==void 0&&((q&2)!==0||(q&4)!==0)&&HL(T,x,ue),B=B.next}while(B!==L)}Mm(v,x,T);break;case 1:if(!Io&&(Xx(T,x),L=T.stateNode,typeof L.componentWillUnmount=="function"))try{L.props=T.memoizedProps,L.state=T.memoizedState,L.componentWillUnmount()}catch(Me){Jn(T,x,Me)}Mm(v,x,T);break;case 21:Mm(v,x,T);break;case 22:T.mode&1?(Io=(L=Io)||T.memoizedState!==null,Mm(v,x,T),Io=L):Mm(v,x,T);break;default:Mm(v,x,T)}}function z8(v){var x=v.updateQueue;if(x!==null){v.updateQueue=null;var T=v.stateNode;T===null&&(T=v.stateNode=new yge),x.forEach(function(L){var B=Cge.bind(null,v,L);T.has(L)||(T.add(L),L.then(B,B))})}}function Xu(v,x){var T=x.deletions;if(T!==null)for(var L=0;L<T.length;L++){var B=T[L];try{var q=v,ue=x,Me=ue;e:for(;Me!==null;){switch(Me.tag){case 5:ao=Me.stateNode,qu=!1;break e;case 3:ao=Me.stateNode.containerInfo,qu=!0;break e;case 4:ao=Me.stateNode.containerInfo,qu=!0;break e}Me=Me.return}if(ao===null)throw Error(i(160));F8(q,ue,B),ao=null,qu=!1;var Oe=B.alternate;Oe!==null&&(Oe.return=null),B.return=null}catch(lt){Jn(B,x,lt)}}if(x.subtreeFlags&12854)for(x=x.child;x!==null;)j8(x,v),x=x.sibling}function j8(v,x){var T=v.alternate,L=v.flags;switch(v.tag){case 0:case 11:case 14:case 15:if(Xu(x,v),Qh(v),L&4){try{PS(3,v,v.return),SC(3,v)}catch(pi){Jn(v,v.return,pi)}try{PS(5,v,v.return)}catch(pi){Jn(v,v.return,pi)}}break;case 1:Xu(x,v),Qh(v),L&512&&T!==null&&Xx(T,T.return);break;case 5:if(Xu(x,v),Qh(v),L&512&&T!==null&&Xx(T,T.return),v.flags&32){var B=v.stateNode;try{Te(B,"")}catch(pi){Jn(v,v.return,pi)}}if(L&4&&(B=v.stateNode,B!=null)){var q=v.memoizedProps,ue=T!==null?T.memoizedProps:q,Me=v.type,Oe=v.updateQueue;if(v.updateQueue=null,Oe!==null)try{Me==="input"&&q.type==="radio"&&q.name!=null&&He(B,q),Et(Me,ue);var lt=Et(Me,q);for(ue=0;ue<Oe.length;ue+=2){var Pt=Oe[ue],It=Oe[ue+1];Pt==="style"?pt(B,It):Pt==="dangerouslySetInnerHTML"?at(B,It):Pt==="children"?Te(B,It):w(B,Pt,It,lt)}switch(Me){case"input":Be(B,q);break;case"textarea":Q(B,q);break;case"select":var Ct=B._wrapperState.wasMultiple;B._wrapperState.wasMultiple=!!q.multiple;var Jt=q.value;Jt!=null?wt(B,!!q.multiple,Jt,!1):Ct!==!!q.multiple&&(q.defaultValue!=null?wt(B,!!q.multiple,q.defaultValue,!0):wt(B,!!q.multiple,q.multiple?[]:"",!1))}B[ym]=q}catch(pi){Jn(v,v.return,pi)}}break;case 6:if(Xu(x,v),Qh(v),L&4){if(v.stateNode===null)throw Error(i(162));B=v.stateNode,q=v.memoizedProps;try{B.nodeValue=q}catch(pi){Jn(v,v.return,pi)}}break;case 3:if(Xu(x,v),Qh(v),L&4&&T!==null&&T.memoizedState.isDehydrated)try{Sv(x.containerInfo)}catch(pi){Jn(v,v.return,pi)}break;case 4:Xu(x,v),Qh(v);break;case 13:Xu(x,v),Qh(v),B=v.child,B.flags&8192&&(q=B.memoizedState!==null,B.stateNode.isHidden=q,!q||B.alternate!==null&&B.alternate.memoizedState!==null||(YL=Ie())),L&4&&z8(v);break;case 22:if(Pt=T!==null&&T.memoizedState!==null,v.mode&1?(Io=(lt=Io)||Pt,Xu(x,v),Io=lt):Xu(x,v),Qh(v),L&8192){if(lt=v.memoizedState!==null,(v.stateNode.isHidden=lt)&&!Pt&&(v.mode&1)!==0)for(ai=v,Pt=v.child;Pt!==null;){for(It=ai=Pt;ai!==null;){switch(Ct=ai,Jt=Ct.child,Ct.tag){case 0:case 11:case 14:case 15:PS(4,Ct,Ct.return);break;case 1:Xx(Ct,Ct.return);var li=Ct.stateNode;if(typeof li.componentWillUnmount=="function"){L=Ct,T=Ct.return;try{x=L,li.props=x.memoizedProps,li.state=x.memoizedState,li.componentWillUnmount()}catch(pi){Jn(L,T,pi)}}break;case 5:Xx(Ct,Ct.return);break;case 22:if(Ct.memoizedState!==null){G8(It);continue}}Jt!==null?(Jt.return=Ct,ai=Jt):G8(It)}Pt=Pt.sibling}e:for(Pt=null,It=v;;){if(It.tag===5){if(Pt===null){Pt=It;try{B=It.stateNode,lt?(q=B.style,typeof q.setProperty=="function"?q.setProperty("display","none","important"):q.display="none"):(Me=It.stateNode,Oe=It.memoizedProps.style,ue=Oe!=null&&Oe.hasOwnProperty("display")?Oe.display:null,Me.style.display=Qe("display",ue))}catch(pi){Jn(v,v.return,pi)}}}else if(It.tag===6){if(Pt===null)try{It.stateNode.nodeValue=lt?"":It.memoizedProps}catch(pi){Jn(v,v.return,pi)}}else if((It.tag!==22&&It.tag!==23||It.memoizedState===null||It===v)&&It.child!==null){It.child.return=It,It=It.child;continue}if(It===v)break e;for(;It.sibling===null;){if(It.return===null||It.return===v)break e;Pt===It&&(Pt=null),It=It.return}Pt===It&&(Pt=null),It.sibling.return=It.return,It=It.sibling}}break;case 19:Xu(x,v),Qh(v),L&4&&z8(v);break;case 21:break;default:Xu(x,v),Qh(v)}}function Qh(v){var x=v.flags;if(x&2){try{e:{for(var T=v.return;T!==null;){if(U8(T)){var L=T;break e}T=T.return}throw Error(i(160))}switch(L.tag){case 5:var B=L.stateNode;L.flags&32&&(Te(B,""),L.flags&=-33);var q=B8(v);qL(v,q,B);break;case 3:case 4:var ue=L.stateNode.containerInfo,Me=B8(v);WL(v,Me,ue);break;default:throw Error(i(161))}}catch(Oe){Jn(v,v.return,Oe)}v.flags&=-3}x&4096&&(v.flags&=-4097)}function bge(v,x,T){ai=v,V8(v)}function V8(v,x,T){for(var L=(v.mode&1)!==0;ai!==null;){var B=ai,q=B.child;if(B.tag===22&&L){var ue=B.memoizedState!==null||_C;if(!ue){var Me=B.alternate,Oe=Me!==null&&Me.memoizedState!==null||Io;Me=_C;var lt=Io;if(_C=ue,(Io=Oe)&&!lt)for(ai=B;ai!==null;)ue=ai,Oe=ue.child,ue.tag===22&&ue.memoizedState!==null?W8(B):Oe!==null?(Oe.return=ue,ai=Oe):W8(B);for(;q!==null;)ai=q,V8(q),q=q.sibling;ai=B,_C=Me,Io=lt}H8(v)}else(B.subtreeFlags&8772)!==0&&q!==null?(q.return=B,ai=q):H8(v)}}function H8(v){for(;ai!==null;){var x=ai;if((x.flags&8772)!==0){var T=x.alternate;try{if((x.flags&8772)!==0)switch(x.tag){case 0:case 11:case 15:Io||SC(5,x);break;case 1:var L=x.stateNode;if(x.flags&4&&!Io)if(T===null)L.componentDidMount();else{var B=x.elementType===x.type?T.memoizedProps:Ol(x.type,T.memoizedProps);L.componentDidUpdate(B,T.memoizedState,L.__reactInternalSnapshotBeforeUpdate)}var q=x.updateQueue;q!==null&&_m(x,q,L);break;case 3:var ue=x.updateQueue;if(ue!==null){if(T=null,x.child!==null)switch(x.child.tag){case 5:T=x.child.stateNode;break;case 1:T=x.child.stateNode}_m(x,ue,T)}break;case 5:var Me=x.stateNode;if(T===null&&x.flags&4){T=Me;var Oe=x.memoizedProps;switch(x.type){case"button":case"input":case"select":case"textarea":Oe.autoFocus&&T.focus();break;case"img":Oe.src&&(T.src=Oe.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(x.memoizedState===null){var lt=x.alternate;if(lt!==null){var Pt=lt.memoizedState;if(Pt!==null){var It=Pt.dehydrated;It!==null&&Sv(It)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(i(163))}Io||x.flags&512&&GL(x)}catch(Ct){Jn(x,x.return,Ct)}}if(x===v){ai=null;break}if(T=x.sibling,T!==null){T.return=x.return,ai=T;break}ai=x.return}}function G8(v){for(;ai!==null;){var x=ai;if(x===v){ai=null;break}var T=x.sibling;if(T!==null){T.return=x.return,ai=T;break}ai=x.return}}function W8(v){for(;ai!==null;){var x=ai;try{switch(x.tag){case 0:case 11:case 15:var T=x.return;try{SC(4,x)}catch(Oe){Jn(x,T,Oe)}break;case 1:var L=x.stateNode;if(typeof L.componentDidMount=="function"){var B=x.return;try{L.componentDidMount()}catch(Oe){Jn(x,B,Oe)}}var q=x.return;try{GL(x)}catch(Oe){Jn(x,q,Oe)}break;case 5:var ue=x.return;try{GL(x)}catch(Oe){Jn(x,ue,Oe)}}}catch(Oe){Jn(x,x.return,Oe)}if(x===v){ai=null;break}var Me=x.sibling;if(Me!==null){Me.return=x.return,ai=Me;break}ai=x.return}}var wge=Math.ceil,EC=E.ReactCurrentDispatcher,XL=E.ReactCurrentOwner,$c=E.ReactCurrentBatchConfig,kr=0,Pa=null,Is=null,oo=0,bc=0,$x=Un(0),ea=0,RS=null,ey=0,AC=0,$L=0,IS=null,Ll=null,YL=0,Yx=1/0,Hf=null,MC=!1,KL=null,Tm=null,TC=!1,Cm=null,CC=0,DS=0,ZL=null,PC=-1,RC=0;function tl(){return(kr&6)!==0?Ie():PC!==-1?PC:PC=Ie()}function Pm(v){return(v.mode&1)===0?1:(kr&2)!==0&&oo!==0?oo&-oo:FL.transition!==null?(RC===0&&(RC=bn()),RC):(v=cr,v!==0||(v=window.event,v=v===void 0?16:YT(v.type)),v)}function $u(v,x,T,L){if(50<DS)throw DS=0,ZL=null,Error(i(185));Gn(v,T,L),((kr&2)===0||v!==Pa)&&(v===Pa&&((kr&2)===0&&(AC|=T),ea===4&&Rm(v,oo)),kl(v,L),T===1&&kr===0&&(x.mode&1)===0&&(Yx=Ie()+500,Bv&&Gc()))}function kl(v,x){var T=v.callbackNode;Eo(v,x);var L=Sa(v,v===Pa?oo:0);if(L===0)T!==null&&Ue(T),v.callbackNode=null,v.callbackPriority=0;else if(x=L&-L,v.callbackPriority!==x){if(T!=null&&Ue(T),x===1)v.tag===0?cC(X8.bind(null,v)):Fv(X8.bind(null,v)),BL(function(){(kr&6)===0&&Gc()}),T=null;else{switch(im(L)){case 1:T=Dt;break;case 4:T=Mt;break;case 16:T=Vt;break;case 536870912:T=si;break;default:T=Vt}T=tW(T,q8.bind(null,v))}v.callbackPriority=x,v.callbackNode=T}}function q8(v,x){if(PC=-1,RC=0,(kr&6)!==0)throw Error(i(327));var T=v.callbackNode;if(Kx()&&v.callbackNode!==T)return null;var L=Sa(v,v===Pa?oo:0);if(L===0)return null;if((L&30)!==0||(L&v.expiredLanes)!==0||x)x=IC(v,L);else{x=L;var B=kr;kr|=2;var q=Y8();(Pa!==v||oo!==x)&&(Hf=null,Yx=Ie()+500,iy(v,x));do try{Ege();break}catch(Me){$8(v,Me)}while(!0);kf(),EC.current=q,kr=B,Is!==null?x=0:(Pa=null,oo=0,x=ea)}if(x!==0){if(x===2&&(B=$r(v),B!==0&&(L=B,x=QL(v,B))),x===1)throw T=RS,iy(v,0),Rm(v,L),kl(v,Ie()),T;if(x===6)Rm(v,L);else{if(B=v.current.alternate,(L&30)===0&&!_ge(B)&&(x=IC(v,L),x===2&&(q=$r(v),q!==0&&(L=q,x=QL(v,q))),x===1))throw T=RS,iy(v,0),Rm(v,L),kl(v,Ie()),T;switch(v.finishedWork=B,v.finishedLanes=L,x){case 0:case 1:throw Error(i(345));case 2:ry(v,Ll,Hf);break;case 3:if(Rm(v,L),(L&130023424)===L&&(x=YL+500-Ie(),10<x)){if(Sa(v,0)!==0)break;if(B=v.suspendedLanes,(B&L)!==L){tl(),v.pingedLanes|=v.suspendedLanes&B;break}v.timeoutHandle=sS(ry.bind(null,v,Ll,Hf),x);break}ry(v,Ll,Hf);break;case 4:if(Rm(v,L),(L&4194240)===L)break;for(x=v.eventTimes,B=-1;0<L;){var ue=31-_e(L);q=1<<ue,ue=x[ue],ue>B&&(B=ue),L&=~q}if(L=B,L=Ie()-L,L=(120>L?120:480>L?480:1080>L?1080:1920>L?1920:3e3>L?3e3:4320>L?4320:1960*wge(L/1960))-L,10<L){v.timeoutHandle=sS(ry.bind(null,v,Ll,Hf),L);break}ry(v,Ll,Hf);break;case 5:ry(v,Ll,Hf);break;default:throw Error(i(329))}}}return kl(v,Ie()),v.callbackNode===T?q8.bind(null,v):null}function QL(v,x){var T=IS;return v.current.memoizedState.isDehydrated&&(iy(v,x).flags|=256),v=IC(v,x),v!==2&&(x=Ll,Ll=T,x!==null&&JL(x)),v}function JL(v){Ll===null?Ll=v:Ll.push.apply(Ll,v)}function _ge(v){for(var x=v;;){if(x.flags&16384){var T=x.updateQueue;if(T!==null&&(T=T.stores,T!==null))for(var L=0;L<T.length;L++){var B=T[L],q=B.getSnapshot;B=B.value;try{if(!Xo(q(),B))return!1}catch{return!1}}}if(T=x.child,x.subtreeFlags&16384&&T!==null)T.return=x,x=T;else{if(x===v)break;for(;x.sibling===null;){if(x.return===null||x.return===v)return!0;x=x.return}x.sibling.return=x.return,x=x.sibling}}return!0}function Rm(v,x){for(x&=~$L,x&=~AC,v.suspendedLanes|=x,v.pingedLanes&=~x,v=v.expirationTimes;0<x;){var T=31-_e(x),L=1<<T;v[T]=-1,x&=~L}}function X8(v){if((kr&6)!==0)throw Error(i(327));Kx();var x=Sa(v,0);if((x&1)===0)return kl(v,Ie()),null;var T=IC(v,x);if(v.tag!==0&&T===2){var L=$r(v);L!==0&&(x=L,T=QL(v,L))}if(T===1)throw T=RS,iy(v,0),Rm(v,x),kl(v,Ie()),T;if(T===6)throw Error(i(345));return v.finishedWork=v.current.alternate,v.finishedLanes=x,ry(v,Ll,Hf),kl(v,Ie()),null}function ek(v,x){var T=kr;kr|=1;try{return v(x)}finally{kr=T,kr===0&&(Yx=Ie()+500,Bv&&Gc())}}function ty(v){Cm!==null&&Cm.tag===0&&(kr&6)===0&&Kx();var x=kr;kr|=1;var T=$c.transition,L=cr;try{if($c.transition=null,cr=1,v)return v()}finally{cr=L,$c.transition=T,kr=x,(kr&6)===0&&Gc()}}function tk(){bc=$x.current,pn($x)}function iy(v,x){v.finishedWork=null,v.finishedLanes=0;var T=v.timeoutHandle;if(T!==-1&&(v.timeoutHandle=-1,aS(T)),Is!==null)for(T=Is.return;T!==null;){var L=T;switch(Bu(L),L.tag){case 1:L=L.type.childContextTypes,L!=null&&Nv();break;case 3:Kh(),pn(io),pn(Ys),qc();break;case 5:Sm(L);break;case 4:Kh();break;case 13:pn(_n);break;case 19:pn(_n);break;case 10:Hv(L.type._context);break;case 22:case 23:tk()}T=T.return}if(Pa=v,Is=v=Im(v.current,null),oo=bc=x,ea=0,RS=null,$L=AC=ey=0,Ll=IS=null,zu!==null){for(x=0;x<zu.length;x++)if(T=zu[x],L=T.interleaved,L!==null){T.interleaved=null;var B=L.next,q=T.pending;if(q!==null){var ue=q.next;q.next=B,L.next=ue}T.pending=L}zu=null}return v}function $8(v,x){do{var T=Is;try{if(kf(),Ff.current=Wx,yc){for(var L=mn.memoizedState;L!==null;){var B=L.queue;B!==null&&(B.pending=null),L=L.next}yc=!1}if(Vu=0,Ir=Fn=mn=null,Ca=!1,Zh=0,XL.current=null,T===null||T.return===null){ea=1,RS=x,Is=null;break}e:{var q=v,ue=T.return,Me=T,Oe=x;if(x=oo,Me.flags|=32768,Oe!==null&&typeof Oe=="object"&&typeof Oe.then=="function"){var lt=Oe,Pt=Me,It=Pt.tag;if((Pt.mode&1)===0&&(It===0||It===11||It===15)){var Ct=Pt.alternate;Ct?(Pt.updateQueue=Ct.updateQueue,Pt.memoizedState=Ct.memoizedState,Pt.lanes=Ct.lanes):(Pt.updateQueue=null,Pt.memoizedState=null)}var Jt=ri(ue);if(Jt!==null){Jt.flags&=-257,$i(Jt,ue,Me,q,x),Jt.mode&1&&Ot(q,lt,x),x=Jt,Oe=lt;var li=x.updateQueue;if(li===null){var pi=new Set;pi.add(Oe),x.updateQueue=pi}else li.add(Oe);break e}else{if((x&1)===0){Ot(q,lt,x),ik();break e}Oe=Error(i(426))}}else if(wn&&Me.mode&1){var fs=ri(ue);if(fs!==null){(fs.flags&65536)===0&&(fs.flags|=256),$i(fs,ue,Me,q,x),bm(N(Oe,Me));break e}}q=Oe=N(Oe,Me),ea!==4&&(ea=2),IS===null?IS=[q]:IS.push(q),q=ue;do{switch(q.tag){case 3:q.flags|=65536,x&=-x,q.lanes|=x;var Ye=Ge(q,Oe,x);Nf(q,Ye);break e;case 1:Me=Oe;var Ve=q.type,et=q.stateNode;if((q.flags&128)===0&&(typeof Ve.getDerivedStateFromError=="function"||et!==null&&typeof et.componentDidCatch=="function"&&(Tm===null||!Tm.has(et)))){q.flags|=65536,x&=-x,q.lanes|=x;var Lt=vt(q,Me,x);Nf(q,Lt);break e}}q=q.return}while(q!==null)}Z8(T)}catch(xi){x=xi,Is===T&&T!==null&&(Is=T=T.return);continue}break}while(!0)}function Y8(){var v=EC.current;return EC.current=Wx,v===null?Wx:v}function ik(){(ea===0||ea===3||ea===2)&&(ea=4),Pa===null||(ey&268435455)===0&&(AC&268435455)===0||Rm(Pa,oo)}function IC(v,x){var T=kr;kr|=2;var L=Y8();(Pa!==v||oo!==x)&&(Hf=null,iy(v,x));do try{Sge();break}catch(B){$8(v,B)}while(!0);if(kf(),kr=T,EC.current=L,Is!==null)throw Error(i(261));return Pa=null,oo=0,ea}function Sge(){for(;Is!==null;)K8(Is)}function Ege(){for(;Is!==null&&!Je();)K8(Is)}function K8(v){var x=eW(v.alternate,v,bc);v.memoizedProps=v.pendingProps,x===null?Z8(v):Is=x,XL.current=null}function Z8(v){var x=v;do{var T=x.alternate;if(v=x.return,(x.flags&32768)===0){if(T=gge(T,x,bc),T!==null){Is=T;return}}else{if(T=vge(T,x),T!==null){T.flags&=32767,Is=T;return}if(v!==null)v.flags|=32768,v.subtreeFlags=0,v.deletions=null;else{ea=6,Is=null;return}}if(x=x.sibling,x!==null){Is=x;return}Is=x=v}while(x!==null);ea===0&&(ea=5)}function ry(v,x,T){var L=cr,B=$c.transition;try{$c.transition=null,cr=1,Age(v,x,T,L)}finally{$c.transition=B,cr=L}return null}function Age(v,x,T,L){do Kx();while(Cm!==null);if((kr&6)!==0)throw Error(i(327));T=v.finishedWork;var B=v.finishedLanes;if(T===null)return null;if(v.finishedWork=null,v.finishedLanes=0,T===v.current)throw Error(i(177));v.callbackNode=null,v.callbackPriority=0;var q=T.lanes|T.childLanes;if(Aa(v,q),v===Pa&&(Is=Pa=null,oo=0),(T.subtreeFlags&2064)===0&&(T.flags&2064)===0||TC||(TC=!0,tW(Vt,function(){return Kx(),null})),q=(T.flags&15990)!==0,(T.subtreeFlags&15990)!==0||q){q=$c.transition,$c.transition=null;var ue=cr;cr=1;var Me=kr;kr|=4,XL.current=null,xge(v,T),j8(T,v),Ts(rS),Al=!!vm,rS=vm=null,v.current=T,bge(T),nt(),kr=Me,cr=ue,$c.transition=q}else v.current=T;if(TC&&(TC=!1,Cm=v,CC=B),q=v.pendingLanes,q===0&&(Tm=null),ae(T.stateNode),kl(v,Ie()),x!==null)for(L=v.onRecoverableError,T=0;T<x.length;T++)B=x[T],L(B.value,{componentStack:B.stack,digest:B.digest});if(MC)throw MC=!1,v=KL,KL=null,v;return(CC&1)!==0&&v.tag!==0&&Kx(),q=v.pendingLanes,(q&1)!==0?v===ZL?DS++:(DS=0,ZL=v):DS=0,Gc(),null}function Kx(){if(Cm!==null){var v=im(CC),x=$c.transition,T=cr;try{if($c.transition=null,cr=16>v?16:v,Cm===null)var L=!1;else{if(v=Cm,Cm=null,CC=0,(kr&6)!==0)throw Error(i(331));var B=kr;for(kr|=4,ai=v.current;ai!==null;){var q=ai,ue=q.child;if((ai.flags&16)!==0){var Me=q.deletions;if(Me!==null){for(var Oe=0;Oe<Me.length;Oe++){var lt=Me[Oe];for(ai=lt;ai!==null;){var Pt=ai;switch(Pt.tag){case 0:case 11:case 15:PS(8,Pt,q)}var It=Pt.child;if(It!==null)It.return=Pt,ai=It;else for(;ai!==null;){Pt=ai;var Ct=Pt.sibling,Jt=Pt.return;if(N8(Pt),Pt===lt){ai=null;break}if(Ct!==null){Ct.return=Jt,ai=Ct;break}ai=Jt}}}var li=q.alternate;if(li!==null){var pi=li.child;if(pi!==null){li.child=null;do{var fs=pi.sibling;pi.sibling=null,pi=fs}while(pi!==null)}}ai=q}}if((q.subtreeFlags&2064)!==0&&ue!==null)ue.return=q,ai=ue;else e:for(;ai!==null;){if(q=ai,(q.flags&2048)!==0)switch(q.tag){case 0:case 11:case 15:PS(9,q,q.return)}var Ye=q.sibling;if(Ye!==null){Ye.return=q.return,ai=Ye;break e}ai=q.return}}var Ve=v.current;for(ai=Ve;ai!==null;){ue=ai;var et=ue.child;if((ue.subtreeFlags&2064)!==0&&et!==null)et.return=ue,ai=et;else e:for(ue=Ve;ai!==null;){if(Me=ai,(Me.flags&2048)!==0)try{switch(Me.tag){case 0:case 11:case 15:SC(9,Me)}}catch(xi){Jn(Me,Me.return,xi)}if(Me===ue){ai=null;break e}var Lt=Me.sibling;if(Lt!==null){Lt.return=Me.return,ai=Lt;break e}ai=Me.return}}if(kr=B,Gc(),ne&&typeof ne.onPostCommitFiberRoot=="function")try{ne.onPostCommitFiberRoot(Wt,v)}catch{}L=!0}return L}finally{cr=T,$c.transition=x}}return!1}function Q8(v,x,T){x=N(T,x),x=Ge(v,x,1),v=Mn(v,x,1),x=tl(),v!==null&&(Gn(v,1,x),kl(v,x))}function Jn(v,x,T){if(v.tag===3)Q8(v,v,T);else for(;x!==null;){if(x.tag===3){Q8(x,v,T);break}else if(x.tag===1){var L=x.stateNode;if(typeof x.type.getDerivedStateFromError=="function"||typeof L.componentDidCatch=="function"&&(Tm===null||!Tm.has(L))){v=N(T,v),v=vt(x,v,1),x=Mn(x,v,1),v=tl(),x!==null&&(Gn(x,1,v),kl(x,v));break}}x=x.return}}function Mge(v,x,T){var L=v.pingCache;L!==null&&L.delete(x),x=tl(),v.pingedLanes|=v.suspendedLanes&T,Pa===v&&(oo&T)===T&&(ea===4||ea===3&&(oo&130023424)===oo&&500>Ie()-YL?iy(v,0):$L|=T),kl(v,x)}function J8(v,x){x===0&&((v.mode&1)===0?x=1:(x=_i,_i<<=1,(_i&130023424)===0&&(_i=4194304)));var T=tl();v=gc(v,x),v!==null&&(Gn(v,x,T),kl(v,T))}function Tge(v){var x=v.memoizedState,T=0;x!==null&&(T=x.retryLane),J8(v,T)}function Cge(v,x){var T=0;switch(v.tag){case 13:var L=v.stateNode,B=v.memoizedState;B!==null&&(T=B.retryLane);break;case 19:L=v.stateNode;break;default:throw Error(i(314))}L!==null&&L.delete(x),J8(v,T)}var eW;eW=function(v,x,T){if(v!==null)if(v.memoizedProps!==x.pendingProps||io.current)ur=!0;else{if((v.lanes&T)===0&&(x.flags&128)===0)return ur=!1,mge(v,x,T);ur=(v.flags&131072)!==0}else ur=!1,wn&&(x.flags&1048576)!==0&&hS(x,kx,x.index);switch(x.lanes=0,x.tag){case 2:var L=x.type;wC(v,x),v=x.pendingProps;var B=Cf(x,Ys.current);Yh(x,T),B=$v(null,x,L,v,B,T);var q=xS();return x.flags|=1,typeof B=="object"&&B!==null&&typeof B.render=="function"&&B.$$typeof===void 0?(x.tag=1,x.memoizedState=null,x.updateQueue=null,Ma(L)?(q=!0,Pf(x)):q=!1,x.memoizedState=B.state!==null&&B.state!==void 0?B.state:null,sr(x),B.updater=qx,x.stateNode=B,B._reactInternals=x,D(x,L,v,T),x=tr(null,x,L,!0,q,T)):(x.tag=0,wn&&q&&dS(x),Yt(null,x,B,T),x=x.child),x;case 16:L=x.elementType;e:{switch(wC(v,x),v=x.pendingProps,B=L._init,L=B(L._payload),x.type=L,B=x.tag=Rge(L),v=Ol(L,v),B){case 0:x=qt(null,x,L,v,T);break e;case 1:x=vi(null,x,L,v,T);break e;case 11:x=Js(null,x,L,v,T);break e;case 14:x=el(null,x,L,Ol(L.type,v),T);break e}throw Error(i(306,L,""))}return x;case 0:return L=x.type,B=x.pendingProps,B=x.elementType===L?B:Ol(L,B),qt(v,x,L,B,T);case 1:return L=x.type,B=x.pendingProps,B=x.elementType===L?B:Ol(L,B),vi(v,x,L,B,T);case 3:e:{if(Yi(x),v===null)throw Error(i(387));L=x.pendingProps,q=x.memoizedState,B=q.element,qn(v,x),Bn(x,L,null,T);var ue=x.memoizedState;if(L=ue.element,q.isDehydrated)if(q={element:L,isDehydrated:!1,cache:ue.cache,pendingSuspenseBoundaries:ue.pendingSuspenseBoundaries,transitions:ue.transitions},x.updateQueue.baseState=q,x.memoizedState=q,x.flags&256){B=N(Error(i(423)),x),x=Cr(v,x,L,T,B);break e}else if(L!==B){B=N(Error(i(424)),x),x=Cr(v,x,L,T,B);break e}else for(no=Ou(x.stateNode.containerInfo.firstChild),Ks=x,wn=!0,Dl=null,T=Vv(x,null,L,T),x.child=T;T;)T.flags=T.flags&-3|4096,T=T.sibling;else{if($h(),L===B){x=Vf(v,x,T);break e}Yt(v,x,L,T)}x=x.child}return x;case 5:return Bf(x),v===null&&Ux(x),L=x.type,B=x.pendingProps,q=v!==null?v.memoizedProps:null,ue=B.children,nS(L,B)?ue=null:q!==null&&nS(L,q)&&(x.flags|=32),ut(v,x),Yt(v,x,ue,T),x.child;case 6:return v===null&&Ux(x),null;case 13:return Wu(v,x,T);case 4:return qv(x,x.stateNode.containerInfo),L=x.pendingProps,v===null?x.child=Df(x,null,L,T):Yt(v,x,L,T),x.child;case 11:return L=x.type,B=x.pendingProps,B=x.elementType===L?B:Ol(L,B),Js(v,x,L,B,T);case 7:return Yt(v,x,x.pendingProps,T),x.child;case 8:return Yt(v,x,x.pendingProps.children,T),x.child;case 12:return Yt(v,x,x.pendingProps.children,T),x.child;case 10:e:{if(L=x.type._context,B=x.pendingProps,q=x.memoizedProps,ue=B.value,sn(Of,L._currentValue),L._currentValue=ue,q!==null)if(Xo(q.value,ue)){if(q.children===B.children&&!io.current){x=Vf(v,x,T);break e}}else for(q=x.child,q!==null&&(q.return=x);q!==null;){var Me=q.dependencies;if(Me!==null){ue=q.child;for(var Oe=Me.firstContext;Oe!==null;){if(Oe.context===L){if(q.tag===1){Oe=Kr(-1,T&-T),Oe.tag=2;var lt=q.updateQueue;if(lt!==null){lt=lt.shared;var Pt=lt.pending;Pt===null?Oe.next=Oe:(Oe.next=Pt.next,Pt.next=Oe),lt.pending=Oe}}q.lanes|=T,Oe=q.alternate,Oe!==null&&(Oe.lanes|=T),Gv(q.return,T,x),Me.lanes|=T;break}Oe=Oe.next}}else if(q.tag===10)ue=q.type===x.type?null:q.child;else if(q.tag===18){if(ue=q.return,ue===null)throw Error(i(341));ue.lanes|=T,Me=ue.alternate,Me!==null&&(Me.lanes|=T),Gv(ue,T,x),ue=q.sibling}else ue=q.child;if(ue!==null)ue.return=q;else for(ue=q;ue!==null;){if(ue===x){ue=null;break}if(q=ue.sibling,q!==null){q.return=ue.return,ue=q;break}ue=ue.return}q=ue}Yt(v,x,B.children,T),x=x.child}return x;case 9:return B=x.type,L=x.pendingProps.children,Yh(x,T),B=Ko(B),L=L(B),x.flags|=1,Yt(v,x,L,T),x.child;case 14:return L=x.type,B=Ol(L,x.pendingProps),B=Ol(L.type,B),el(v,x,L,B,T);case 15:return tt(v,x,x.type,x.pendingProps,T);case 17:return L=x.type,B=x.pendingProps,B=x.elementType===L?B:Ol(L,B),wC(v,x),x.tag=1,Ma(L)?(v=!0,Pf(x)):v=!1,Yh(x,T),_(x,L,B),D(x,L,B,T),tr(null,x,L,!0,v,T);case 19:return I8(v,x,T);case 22:return We(v,x,T)}throw Error(i(156,x.tag))};function tW(v,x){return de(v,x)}function Pge(v,x,T,L){this.tag=v,this.key=T,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=x,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=L,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Yc(v,x,T,L){return new Pge(v,x,T,L)}function rk(v){return v=v.prototype,!(!v||!v.isReactComponent)}function Rge(v){if(typeof v=="function")return rk(v)?1:0;if(v!=null){if(v=v.$$typeof,v===z)return 11;if(v===$)return 14}return 2}function Im(v,x){var T=v.alternate;return T===null?(T=Yc(v.tag,x,v.key,v.mode),T.elementType=v.elementType,T.type=v.type,T.stateNode=v.stateNode,T.alternate=v,v.alternate=T):(T.pendingProps=x,T.type=v.type,T.flags=0,T.subtreeFlags=0,T.deletions=null),T.flags=v.flags&14680064,T.childLanes=v.childLanes,T.lanes=v.lanes,T.child=v.child,T.memoizedProps=v.memoizedProps,T.memoizedState=v.memoizedState,T.updateQueue=v.updateQueue,x=v.dependencies,T.dependencies=x===null?null:{lanes:x.lanes,firstContext:x.firstContext},T.sibling=v.sibling,T.index=v.index,T.ref=v.ref,T}function DC(v,x,T,L,B,q){var ue=2;if(L=v,typeof v=="function")rk(v)&&(ue=1);else if(typeof v=="string")ue=5;else e:switch(v){case P:return ny(T.children,B,q,x);case C:ue=8,B|=8;break;case R:return v=Yc(12,T,x,B|2),v.elementType=R,v.lanes=q,v;case V:return v=Yc(13,T,x,B),v.elementType=V,v.lanes=q,v;case F:return v=Yc(19,T,x,B),v.elementType=F,v.lanes=q,v;case X:return OC(T,B,q,x);default:if(typeof v=="object"&&v!==null)switch(v.$$typeof){case I:ue=10;break e;case k:ue=9;break e;case z:ue=11;break e;case $:ue=14;break e;case K:ue=16,L=null;break e}throw Error(i(130,v==null?v:typeof v,""))}return x=Yc(ue,T,x,B),x.elementType=v,x.type=L,x.lanes=q,x}function ny(v,x,T,L){return v=Yc(7,v,L,x),v.lanes=T,v}function OC(v,x,T,L){return v=Yc(22,v,L,x),v.elementType=X,v.lanes=T,v.stateNode={isHidden:!1},v}function nk(v,x,T){return v=Yc(6,v,null,x),v.lanes=T,v}function sk(v,x,T){return x=Yc(4,v.children!==null?v.children:[],v.key,x),x.lanes=T,x.stateNode={containerInfo:v.containerInfo,pendingChildren:null,implementation:v.implementation},x}function Ige(v,x,T,L,B){this.tag=x,this.containerInfo=v,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=Ea(0),this.expirationTimes=Ea(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Ea(0),this.identifierPrefix=L,this.onRecoverableError=B,this.mutableSourceEagerHydrationData=null}function ak(v,x,T,L,B,q,ue,Me,Oe){return v=new Ige(v,x,T,Me,Oe),x===1?(x=1,q===!0&&(x|=8)):x=0,q=Yc(3,null,null,x),v.current=q,q.stateNode=v,q.memoizedState={element:L,isDehydrated:T,cache:null,transitions:null,pendingSuspenseBoundaries:null},sr(q),v}function Dge(v,x,T){var L=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:A,key:L==null?null:""+L,children:v,containerInfo:x,implementation:T}}function iW(v){if(!v)return ku;v=v._reactInternals;e:{if(yi(v)!==v||v.tag!==1)throw Error(i(170));var x=v;do{switch(x.tag){case 3:x=x.stateNode.context;break e;case 1:if(Ma(x.type)){x=x.stateNode.__reactInternalMemoizedMergedChildContext;break e}}x=x.return}while(x!==null);throw Error(i(171))}if(v.tag===1){var T=v.type;if(Ma(T))return Uv(v,T,x)}return x}function rW(v,x,T,L,B,q,ue,Me,Oe){return v=ak(T,L,!0,v,B,q,ue,Me,Oe),v.context=iW(null),T=v.current,L=tl(),B=Pm(T),q=Kr(L,B),q.callback=x??null,Mn(T,q,B),v.current.lanes=B,Gn(v,B,L),kl(v,L),v}function LC(v,x,T,L){var B=x.current,q=tl(),ue=Pm(B);return T=iW(T),x.context===null?x.context=T:x.pendingContext=T,x=Kr(q,ue),x.payload={element:v},L=L===void 0?null:L,L!==null&&(x.callback=L),v=Mn(B,x,ue),v!==null&&($u(v,B,ue,q),Ta(v,B,ue)),ue}function kC(v){if(v=v.current,!v.child)return null;switch(v.child.tag){case 5:return v.child.stateNode;default:return v.child.stateNode}}function nW(v,x){if(v=v.memoizedState,v!==null&&v.dehydrated!==null){var T=v.retryLane;v.retryLane=T!==0&&T<x?T:x}}function ok(v,x){nW(v,x),(v=v.alternate)&&nW(v,x)}function Oge(){return null}var sW=typeof reportError=="function"?reportError:function(v){console.error(v)};function lk(v){this._internalRoot=v}NC.prototype.render=lk.prototype.render=function(v){var x=this._internalRoot;if(x===null)throw Error(i(409));LC(v,x,null,null)},NC.prototype.unmount=lk.prototype.unmount=function(){var v=this._internalRoot;if(v!==null){this._internalRoot=null;var x=v.containerInfo;ty(function(){LC(null,v,null,null)}),x[Yo]=null}};function NC(v){this._internalRoot=v}NC.prototype.unstable_scheduleHydration=function(v){if(v){var x=ex();v={blockedOn:null,target:v,priority:x};for(var T=0;T<zh.length&&x!==0&&x<zh[T].priority;T++);zh.splice(T,0,v),T===0&&rx(v)}};function ck(v){return!(!v||v.nodeType!==1&&v.nodeType!==9&&v.nodeType!==11)}function UC(v){return!(!v||v.nodeType!==1&&v.nodeType!==9&&v.nodeType!==11&&(v.nodeType!==8||v.nodeValue!==" react-mount-point-unstable "))}function aW(){}function Lge(v,x,T,L,B){if(B){if(typeof L=="function"){var q=L;L=function(){var lt=kC(ue);q.call(lt)}}var ue=rW(x,L,v,0,null,!1,!1,"",aW);return v._reactRootContainer=ue,v[Yo]=ue.current,mm(v.nodeType===8?v.parentNode:v),ty(),ue}for(;B=v.lastChild;)v.removeChild(B);if(typeof L=="function"){var Me=L;L=function(){var lt=kC(Oe);Me.call(lt)}}var Oe=ak(v,0,!1,null,null,!1,!1,"",aW);return v._reactRootContainer=Oe,v[Yo]=Oe.current,mm(v.nodeType===8?v.parentNode:v),ty(function(){LC(x,Oe,T,L)}),Oe}function BC(v,x,T,L,B){var q=T._reactRootContainer;if(q){var ue=q;if(typeof B=="function"){var Me=B;B=function(){var Oe=kC(ue);Me.call(Oe)}}LC(x,ue,v,B)}else ue=Lge(T,x,v,B,L);return kC(ue)}bv=function(v){switch(v.tag){case 3:var x=v.stateNode;if(x.current.memoizedState.isDehydrated){var T=nn(x.pendingLanes);T!==0&&(Fc(x,T|1),kl(x,Ie()),(kr&6)===0&&(Yx=Ie()+500,Gc()))}break;case 13:ty(function(){var L=gc(v,1);if(L!==null){var B=tl();$u(L,v,1,B)}}),ok(v,1)}},z_=function(v){if(v.tag===13){var x=gc(v,134217728);if(x!==null){var T=tl();$u(x,v,134217728,T)}ok(v,134217728)}},$T=function(v){if(v.tag===13){var x=Pm(v),T=gc(v,x);if(T!==null){var L=tl();$u(T,v,x,L)}ok(v,x)}},ex=function(){return cr},tx=function(v,x){var T=cr;try{return cr=v,x()}finally{cr=T}},Re=function(v,x,T){switch(x){case"input":if(Be(v,T),x=T.name,T.type==="radio"&&x!=null){for(T=v;T.parentNode;)T=T.parentNode;for(T=T.querySelectorAll("input[name="+JSON.stringify(""+x)+'][type="radio"]'),x=0;x<T.length;x++){var L=T[x];if(L!==v&&L.form===v.form){var B=Dx(L);if(!B)throw Error(i(90));Ce(L),Be(L,B)}}}break;case"textarea":Q(v,T);break;case"select":x=T.value,x!=null&&wt(v,!!T.multiple,x,!1)}},Ft=ek,wi=ty;var kge={usingClientEntryPoint:!1,Events:[Lu,Wn,Dx,je,Tt,ek]},OS={findFiberByHostInstance:Xh,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},Nge={bundleType:OS.bundleType,version:OS.version,rendererPackageName:OS.rendererPackageName,rendererConfig:OS.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:E.ReactCurrentDispatcher,findHostInstanceByFiber:function(v){return v=ji(v),v===null?null:v.stateNode},findFiberByHostInstance:OS.findFiberByHostInstance||Oge,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var FC=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!FC.isDisabled&&FC.supportsFiber)try{Wt=FC.inject(Nge),ne=FC}catch{}}return Nl.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=kge,Nl.createPortal=function(v,x){var T=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!ck(x))throw Error(i(200));return Dge(v,x,null,T)},Nl.createRoot=function(v,x){if(!ck(v))throw Error(i(299));var T=!1,L="",B=sW;return x!=null&&(x.unstable_strictMode===!0&&(T=!0),x.identifierPrefix!==void 0&&(L=x.identifierPrefix),x.onRecoverableError!==void 0&&(B=x.onRecoverableError)),x=ak(v,1,!1,null,null,T,!1,L,B),v[Yo]=x.current,mm(v.nodeType===8?v.parentNode:v),new lk(x)},Nl.findDOMNode=function(v){if(v==null)return null;if(v.nodeType===1)return v;var x=v._reactInternals;if(x===void 0)throw typeof v.render=="function"?Error(i(188)):(v=Object.keys(v).join(","),Error(i(268,v)));return v=ji(x),v=v===null?null:v.stateNode,v},Nl.flushSync=function(v){return ty(v)},Nl.hydrate=function(v,x,T){if(!UC(x))throw Error(i(200));return BC(null,v,x,!0,T)},Nl.hydrateRoot=function(v,x,T){if(!ck(v))throw Error(i(405));var L=T!=null&&T.hydratedSources||null,B=!1,q="",ue=sW;if(T!=null&&(T.unstable_strictMode===!0&&(B=!0),T.identifierPrefix!==void 0&&(q=T.identifierPrefix),T.onRecoverableError!==void 0&&(ue=T.onRecoverableError)),x=rW(x,null,v,1,T??null,B,!1,q,ue),v[Yo]=x.current,mm(v),L)for(v=0;v<L.length;v++)T=L[v],B=T._getVersion,B=B(T._source),x.mutableSourceEagerHydrationData==null?x.mutableSourceEagerHydrationData=[T,B]:x.mutableSourceEagerHydrationData.push(T,B);return new NC(x)},Nl.render=function(v,x,T){if(!UC(x))throw Error(i(200));return BC(null,v,x,!1,T)},Nl.unmountComponentAtNode=function(v){if(!UC(v))throw Error(i(40));return v._reactRootContainer?(ty(function(){BC(null,null,v,!1,function(){v._reactRootContainer=null,v[Yo]=null})}),!0):!1},Nl.unstable_batchedUpdates=ek,Nl.unstable_renderSubtreeIntoContainer=function(v,x,T,L){if(!UC(T))throw Error(i(200));if(v==null||v._reactInternals===void 0)throw Error(i(38));return BC(v,x,T,!1,L)},Nl.version="18.3.1-next-f1338f8080-20240426",Nl}var pW;function ure(){if(pW)return dk.exports;pW=1;function t(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(t)}catch(e){console.error(e)}}return t(),dk.exports=Wge(),dk.exports}var mW;function qge(){if(mW)return jC;mW=1;var t=ure();return jC.createRoot=t.createRoot,jC.hydrateRoot=t.hydrateRoot,jC}var Xge=qge();const $ge=Lh(Xge),SV=J.createContext({});function i_(t){const e=J.useRef(null);return e.current===null&&(e.current=t()),e.current}const EV=typeof window<"u",X3=EV?J.useLayoutEffect:J.useEffect,$3=J.createContext(null);function AV(t,e){t.indexOf(e)===-1&&t.push(e)}function MV(t,e){const i=t.indexOf(e);i>-1&&t.splice(i,1)}const $d=(t,e,i)=>i>e?e:i<t?t:i;let VA=()=>{};const Np={},hre=t=>/^-?(?:\d+(?:\.\d+)?|\.\d+)$/u.test(t);function dre(t){return typeof t=="object"&&t!==null}const fre=t=>/^0[^.\s]+$/u.test(t);function TV(t){let e;return()=>(e===void 0&&(e=t()),e)}const nc=t=>t,Yge=(t,e)=>i=>e(t(i)),QM=(...t)=>t.reduce(Yge),v1=(t,e,i)=>{const r=e-t;return r===0?1:(i-t)/r};class CV{constructor(){this.subscriptions=[]}add(e){return AV(this.subscriptions,e),()=>MV(this.subscriptions,e)}notify(e,i,r){const n=this.subscriptions.length;if(n)if(n===1)this.subscriptions[0](e,i,r);else for(let s=0;s<n;s++){const a=this.subscriptions[s];a&&a(e,i,r)}}getSize(){return this.subscriptions.length}clear(){this.subscriptions.length=0}}const Bd=t=>t*1e3,pu=t=>t/1e3;function PV(t,e){return e?t*(1e3/e):0}const pre=(t,e,i)=>(((1-3*i+3*e)*t+(3*i-6*e))*t+3*e)*t,Kge=1e-7,Zge=12;function Qge(t,e,i,r,n){let s,a,o=0;do a=e+(i-e)/2,s=pre(a,r,n)-t,s>0?i=a:e=a;while(Math.abs(s)>Kge&&++o<Zge);return a}function JM(t,e,i,r){if(t===e&&i===r)return nc;const n=s=>Qge(s,0,1,t,i);return s=>s===0||s===1?s:pre(n(s),e,r)}const mre=t=>e=>e<=.5?t(2*e)/2:(2-t(2*(1-e)))/2,gre=t=>e=>1-t(1-e),vre=JM(.33,1.53,.69,.99),RV=gre(vre),yre=mre(RV),xre=t=>(t*=2)<1?.5*RV(t):.5*(2-Math.pow(2,-10*(t-1))),IV=t=>1-Math.sin(Math.acos(t)),bre=gre(IV),wre=mre(IV),Jge=JM(.42,0,1,1),eve=JM(0,0,.58,1),_re=JM(.42,0,.58,1),tve=t=>Array.isArray(t)&&typeof t[0]!="number",Sre=t=>Array.isArray(t)&&typeof t[0]=="number",ive={linear:nc,easeIn:Jge,easeInOut:_re,easeOut:eve,circIn:IV,circInOut:wre,circOut:bre,backIn:RV,backInOut:yre,backOut:vre,anticipate:xre},rve=t=>typeof t=="string",gW=t=>{if(Sre(t)){VA(t.length===4);const[e,i,r,n]=t;return JM(e,i,r,n)}else if(rve(t))return ive[t];return t},VC=["setup","read","resolveKeyframes","preUpdate","update","preRender","render","postRender"];function nve(t,e){let i=new Set,r=new Set,n=!1,s=!1;const a=new WeakSet;let o={delta:0,timestamp:0,isProcessing:!1};function l(u){a.has(u)&&(c.schedule(u),t()),u(o)}const c={schedule:(u,h=!1,d=!1)=>{const p=d&&n?i:r;return h&&a.add(u),p.has(u)||p.add(u),u},cancel:u=>{r.delete(u),a.delete(u)},process:u=>{if(o=u,n){s=!0;return}n=!0,[i,r]=[r,i],i.forEach(l),i.clear(),n=!1,s&&(s=!1,c.process(u))}};return c}const sve=40;function Ere(t,e){let i=!1,r=!0;const n={delta:0,timestamp:0,isProcessing:!1},s=()=>i=!0,a=VC.reduce((w,E)=>(w[E]=nve(s),w),{}),{setup:o,read:l,resolveKeyframes:c,preUpdate:u,update:h,preRender:d,render:f,postRender:p}=a,g=()=>{const w=Np.useManualTiming?n.timestamp:performance.now();i=!1,Np.useManualTiming||(n.delta=r?1e3/60:Math.max(Math.min(w-n.timestamp,sve),1)),n.timestamp=w,n.isProcessing=!0,o.process(n),l.process(n),c.process(n),u.process(n),h.process(n),d.process(n),f.process(n),p.process(n),n.isProcessing=!1,i&&e&&(r=!1,t(g))},m=()=>{i=!0,r=!0,n.isProcessing||t(g)};return{schedule:VC.reduce((w,E)=>{const M=a[E];return w[E]=(A,P=!1,C=!1)=>(i||m(),M.schedule(A,P,C)),w},{}),cancel:w=>{for(let E=0;E<VC.length;E++)a[VC[E]].cancel(w)},state:n,steps:a}}const{schedule:Jr,cancel:Ah,state:Ua,steps:mk}=Ere(typeof requestAnimationFrame<"u"?requestAnimationFrame:nc,!0);let UR;function ave(){UR=void 0}const Jl={now:()=>(UR===void 0&&Jl.set(Ua.isProcessing||Np.useManualTiming?Ua.timestamp:performance.now()),UR),set:t=>{UR=t,queueMicrotask(ave)}},Are=t=>e=>typeof e=="string"&&e.startsWith(t),DV=Are("--"),ove=Are("var(--"),OV=t=>ove(t)?lve.test(t.split("/*")[0].trim()):!1,lve=/var\(--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)$/iu,r_={test:t=>typeof t=="number",parse:parseFloat,transform:t=>t},HA={...r_,transform:t=>$d(0,1,t)},HC={...r_,default:1},eA=t=>Math.round(t*1e5)/1e5,LV=/-?(?:\d+(?:\.\d+)?|\.\d+)/gu;function cve(t){return t==null}const uve=/^(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))$/iu,kV=(t,e)=>i=>!!(typeof i=="string"&&uve.test(i)&&i.startsWith(t)||e&&!cve(i)&&Object.prototype.hasOwnProperty.call(i,e)),Mre=(t,e,i)=>r=>{if(typeof r!="string")return r;const[n,s,a,o]=r.match(LV);return{[t]:parseFloat(n),[e]:parseFloat(s),[i]:parseFloat(a),alpha:o!==void 0?parseFloat(o):1}},hve=t=>$d(0,255,t),gk={...r_,transform:t=>Math.round(hve(t))},$y={test:kV("rgb","red"),parse:Mre("red","green","blue"),transform:({red:t,green:e,blue:i,alpha:r=1})=>"rgba("+gk.transform(t)+", "+gk.transform(e)+", "+gk.transform(i)+", "+eA(HA.transform(r))+")"};function dve(t){let e="",i="",r="",n="";return t.length>5?(e=t.substring(1,3),i=t.substring(3,5),r=t.substring(5,7),n=t.substring(7,9)):(e=t.substring(1,2),i=t.substring(2,3),r=t.substring(3,4),n=t.substring(4,5),e+=e,i+=i,r+=r,n+=n),{red:parseInt(e,16),green:parseInt(i,16),blue:parseInt(r,16),alpha:n?parseInt(n,16)/255:1}}const L4={test:kV("#"),parse:dve,transform:$y.transform},eT=t=>({test:e=>typeof e=="string"&&e.endsWith(t)&&e.split(" ").length===1,parse:parseFloat,transform:e=>`${e}${t}`}),ag=eT("deg"),Fd=eT("%"),Wi=eT("px"),fve=eT("vh"),pve=eT("vw"),vW={...Fd,parse:t=>Fd.parse(t)/100,transform:t=>Fd.transform(t*100)},Ow={test:kV("hsl","hue"),parse:Mre("hue","saturation","lightness"),transform:({hue:t,saturation:e,lightness:i,alpha:r=1})=>"hsla("+Math.round(t)+", "+Fd.transform(eA(e))+", "+Fd.transform(eA(i))+", "+eA(HA.transform(r))+")"},Ns={test:t=>$y.test(t)||L4.test(t)||Ow.test(t),parse:t=>$y.test(t)?$y.parse(t):Ow.test(t)?Ow.parse(t):L4.parse(t),transform:t=>typeof t=="string"?t:t.hasOwnProperty("red")?$y.transform(t):Ow.transform(t),getAnimatableNone:t=>{const e=Ns.parse(t);return e.alpha=0,Ns.transform(e)}},mve=/(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))/giu;function gve(t){return isNaN(t)&&typeof t=="string"&&(t.match(LV)?.length||0)+(t.match(mve)?.length||0)>0}const Tre="number",Cre="color",vve="var",yve="var(",yW="${}",xve=/var\s*\(\s*--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)|#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\)|-?(?:\d+(?:\.\d+)?|\.\d+)/giu;function GA(t){const e=t.toString(),i=[],r={color:[],number:[],var:[]},n=[];let s=0;const o=e.replace(xve,l=>(Ns.test(l)?(r.color.push(s),n.push(Cre),i.push(Ns.parse(l))):l.startsWith(yve)?(r.var.push(s),n.push(vve),i.push(l)):(r.number.push(s),n.push(Tre),i.push(parseFloat(l))),++s,yW)).split(yW);return{values:i,split:o,indexes:r,types:n}}function Pre(t){return GA(t).values}function Rre(t){const{split:e,types:i}=GA(t),r=e.length;return n=>{let s="";for(let a=0;a<r;a++)if(s+=e[a],n[a]!==void 0){const o=i[a];o===Tre?s+=eA(n[a]):o===Cre?s+=Ns.transform(n[a]):s+=n[a]}return s}}const bve=t=>typeof t=="number"?0:Ns.test(t)?Ns.getAnimatableNone(t):t;function wve(t){const e=Pre(t);return Rre(t)(e.map(bve))}const $g={test:gve,parse:Pre,createTransformer:Rre,getAnimatableNone:wve};function vk(t,e,i){return i<0&&(i+=1),i>1&&(i-=1),i<1/6?t+(e-t)*6*i:i<1/2?e:i<2/3?t+(e-t)*(2/3-i)*6:t}function _ve({hue:t,saturation:e,lightness:i,alpha:r}){t/=360,e/=100,i/=100;let n=0,s=0,a=0;if(!e)n=s=a=i;else{const o=i<.5?i*(1+e):i+e-i*e,l=2*i-o;n=vk(l,o,t+1/3),s=vk(l,o,t),a=vk(l,o,t-1/3)}return{red:Math.round(n*255),green:Math.round(s*255),blue:Math.round(a*255),alpha:r}}function yI(t,e){return i=>i>0?e:t}const Xn=(t,e,i)=>t+(e-t)*i,yk=(t,e,i)=>{const r=t*t,n=i*(e*e-r)+r;return n<0?0:Math.sqrt(n)},Sve=[L4,$y,Ow],Eve=t=>Sve.find(e=>e.test(t));function xW(t){const e=Eve(t);if(!e)return!1;let i=e.parse(t);return e===Ow&&(i=_ve(i)),i}const bW=(t,e)=>{const i=xW(t),r=xW(e);if(!i||!r)return yI(t,e);const n={...i};return s=>(n.red=yk(i.red,r.red,s),n.green=yk(i.green,r.green,s),n.blue=yk(i.blue,r.blue,s),n.alpha=Xn(i.alpha,r.alpha,s),$y.transform(n))},k4=new Set(["none","hidden"]);function Ave(t,e){return k4.has(t)?i=>i<=0?t:e:i=>i>=1?e:t}function Mve(t,e){return i=>Xn(t,e,i)}function NV(t){return typeof t=="number"?Mve:typeof t=="string"?OV(t)?yI:Ns.test(t)?bW:Pve:Array.isArray(t)?Ire:typeof t=="object"?Ns.test(t)?bW:Tve:yI}function Ire(t,e){const i=[...t],r=i.length,n=t.map((s,a)=>NV(s)(s,e[a]));return s=>{for(let a=0;a<r;a++)i[a]=n[a](s);return i}}function Tve(t,e){const i={...t,...e},r={};for(const n in i)t[n]!==void 0&&e[n]!==void 0&&(r[n]=NV(t[n])(t[n],e[n]));return n=>{for(const s in r)i[s]=r[s](n);return i}}function Cve(t,e){const i=[],r={color:0,var:0,number:0};for(let n=0;n<e.values.length;n++){const s=e.types[n],a=t.indexes[s][r[s]],o=t.values[a]??0;i[n]=o,r[s]++}return i}const Pve=(t,e)=>{const i=$g.createTransformer(e),r=GA(t),n=GA(e);return r.indexes.var.length===n.indexes.var.length&&r.indexes.color.length===n.indexes.color.length&&r.indexes.number.length>=n.indexes.number.length?k4.has(t)&&!n.values.length||k4.has(e)&&!r.values.length?Ave(t,e):QM(Ire(Cve(r,n),n.values),i):yI(t,e)};function Dre(t,e,i){return typeof t=="number"&&typeof e=="number"&&typeof i=="number"?Xn(t,e,i):NV(t)(t,e)}const Rve=t=>{const e=({timestamp:i})=>t(i);return{start:(i=!0)=>Jr.update(e,i),stop:()=>Ah(e),now:()=>Ua.isProcessing?Ua.timestamp:Jl.now()}},Ore=(t,e,i=10)=>{let r="";const n=Math.max(Math.round(e/i),2);for(let s=0;s<n;s++)r+=Math.round(t(s/(n-1))*1e4)/1e4+", ";return`linear(${r.substring(0,r.length-2)})`},xI=2e4;function UV(t){let e=0;const i=50;let r=t.next(e);for(;!r.done&&e<xI;)e+=i,r=t.next(e);return e>=xI?1/0:e}function Ive(t,e=100,i){const r=i({...t,keyframes:[0,e]}),n=Math.min(UV(r),xI);return{type:"keyframes",ease:s=>r.next(n*s).value/e,duration:pu(n)}}const Dve=5;function Lre(t,e,i){const r=Math.max(e-Dve,0);return PV(i-t(r),e-r)}const rs={stiffness:100,damping:10,mass:1,velocity:0,duration:800,bounce:.3,visualDuration:.3,restSpeed:{granular:.01,default:2},restDelta:{granular:.005,default:.5},minDuration:.01,maxDuration:10,minDamping:.05,maxDamping:1},xk=.001;function Ove({duration:t=rs.duration,bounce:e=rs.bounce,velocity:i=rs.velocity,mass:r=rs.mass}){let n,s,a=1-e;a=$d(rs.minDamping,rs.maxDamping,a),t=$d(rs.minDuration,rs.maxDuration,pu(t)),a<1?(n=c=>{const u=c*a,h=u*t,d=u-i,f=N4(c,a),p=Math.exp(-h);return xk-d/f*p},s=c=>{const h=c*a*t,d=h*i+i,f=Math.pow(a,2)*Math.pow(c,2)*t,p=Math.exp(-h),g=N4(Math.pow(c,2),a);return(-n(c)+xk>0?-1:1)*((d-f)*p)/g}):(n=c=>{const u=Math.exp(-c*t),h=(c-i)*t+1;return-xk+u*h},s=c=>{const u=Math.exp(-c*t),h=(i-c)*(t*t);return u*h});const o=5/t,l=kve(n,s,o);if(t=Bd(t),isNaN(l))return{stiffness:rs.stiffness,damping:rs.damping,duration:t};{const c=Math.pow(l,2)*r;return{stiffness:c,damping:a*2*Math.sqrt(r*c),duration:t}}}const Lve=12;function kve(t,e,i){let r=i;for(let n=1;n<Lve;n++)r=r-t(r)/e(r);return r}function N4(t,e){return t*Math.sqrt(1-e*e)}const Nve=["duration","bounce"],Uve=["stiffness","damping","mass"];function wW(t,e){return e.some(i=>t[i]!==void 0)}function Bve(t){let e={velocity:rs.velocity,stiffness:rs.stiffness,damping:rs.damping,mass:rs.mass,isResolvedFromDuration:!1,...t};if(!wW(t,Uve)&&wW(t,Nve))if(t.visualDuration){const i=t.visualDuration,r=2*Math.PI/(i*1.2),n=r*r,s=2*$d(.05,1,1-(t.bounce||0))*Math.sqrt(n);e={...e,mass:rs.mass,stiffness:n,damping:s}}else{const i=Ove(t);e={...e,...i,mass:rs.mass},e.isResolvedFromDuration=!0}return e}function bI(t=rs.visualDuration,e=rs.bounce){const i=typeof t!="object"?{visualDuration:t,keyframes:[0,1],bounce:e}:t;let{restSpeed:r,restDelta:n}=i;const s=i.keyframes[0],a=i.keyframes[i.keyframes.length-1],o={done:!1,value:s},{stiffness:l,damping:c,mass:u,duration:h,velocity:d,isResolvedFromDuration:f}=Bve({...i,velocity:-pu(i.velocity||0)}),p=d||0,g=c/(2*Math.sqrt(l*u)),m=a-s,y=pu(Math.sqrt(l/u)),b=Math.abs(m)<5;r||(r=b?rs.restSpeed.granular:rs.restSpeed.default),n||(n=b?rs.restDelta.granular:rs.restDelta.default);let w;if(g<1){const M=N4(y,g);w=A=>{const P=Math.exp(-g*y*A);return a-P*((p+g*y*m)/M*Math.sin(M*A)+m*Math.cos(M*A))}}else if(g===1)w=M=>a-Math.exp(-y*M)*(m+(p+y*m)*M);else{const M=y*Math.sqrt(g*g-1);w=A=>{const P=Math.exp(-g*y*A),C=Math.min(M*A,300);return a-P*((p+g*y*m)*Math.sinh(C)+M*m*Math.cosh(C))/M}}const E={calculatedDuration:f&&h||null,next:M=>{const A=w(M);if(f)o.done=M>=h;else{let P=M===0?p:0;g<1&&(P=M===0?Bd(p):Lre(w,M,A));const C=Math.abs(P)<=r,R=Math.abs(a-A)<=n;o.done=C&&R}return o.value=o.done?a:A,o},toString:()=>{const M=Math.min(UV(E),xI),A=Ore(P=>E.next(M*P).value,M,30);return M+"ms "+A},toTransition:()=>{}};return E}bI.applyToOptions=t=>{const e=Ive(t,100,bI);return t.ease=e.ease,t.duration=Bd(e.duration),t.type="keyframes",t};function U4({keyframes:t,velocity:e=0,power:i=.8,timeConstant:r=325,bounceDamping:n=10,bounceStiffness:s=500,modifyTarget:a,min:o,max:l,restDelta:c=.5,restSpeed:u}){const h=t[0],d={done:!1,value:h},f=C=>o!==void 0&&C<o||l!==void 0&&C>l,p=C=>o===void 0?l:l===void 0||Math.abs(o-C)<Math.abs(l-C)?o:l;let g=i*e;const m=h+g,y=a===void 0?m:a(m);y!==m&&(g=y-h);const b=C=>-g*Math.exp(-C/r),w=C=>y+b(C),E=C=>{const R=b(C),I=w(C);d.done=Math.abs(R)<=c,d.value=d.done?y:I};let M,A;const P=C=>{f(d.value)&&(M=C,A=bI({keyframes:[d.value,p(d.value)],velocity:Lre(w,C,d.value),damping:n,stiffness:s,restDelta:c,restSpeed:u}))};return P(0),{calculatedDuration:null,next:C=>{let R=!1;return!A&&M===void 0&&(R=!0,E(C),P(C)),M!==void 0&&C>=M?A.next(C-M):(!R&&E(C),d)}}}function Fve(t,e,i){const r=[],n=i||Np.mix||Dre,s=t.length-1;for(let a=0;a<s;a++){let o=n(t[a],t[a+1]);if(e){const l=Array.isArray(e)?e[a]||nc:e;o=QM(l,o)}r.push(o)}return r}function BV(t,e,{clamp:i=!0,ease:r,mixer:n}={}){const s=t.length;if(VA(s===e.length),s===1)return()=>e[0];if(s===2&&e[0]===e[1])return()=>e[1];const a=t[0]===t[1];t[0]>t[s-1]&&(t=[...t].reverse(),e=[...e].reverse());const o=Fve(e,r,n),l=o.length,c=u=>{if(a&&u<t[0])return e[0];let h=0;if(l>1)for(;h<t.length-2&&!(u<t[h+1]);h++);const d=v1(t[h],t[h+1],u);return o[h](d)};return i?u=>c($d(t[0],t[s-1],u)):c}function zve(t,e){const i=t[t.length-1];for(let r=1;r<=e;r++){const n=v1(0,e,r);t.push(Xn(i,1,n))}}function kre(t){const e=[0];return zve(e,t.length-1),e}function jve(t,e){return t.map(i=>i*e)}function Vve(t,e){return t.map(()=>e||_re).splice(0,t.length-1)}function tA({duration:t=300,keyframes:e,times:i,ease:r="easeInOut"}){const n=tve(r)?r.map(gW):gW(r),s={done:!1,value:e[0]},a=jve(i&&i.length===e.length?i:kre(e),t),o=BV(a,e,{ease:Array.isArray(n)?n:Vve(e,n)});return{calculatedDuration:t,next:l=>(s.value=o(l),s.done=l>=t,s)}}const Hve=t=>t!==null;function FV(t,{repeat:e,repeatType:i="loop"},r,n=1){const s=t.filter(Hve),o=n<0||e&&i!=="loop"&&e%2===1?0:s.length-1;return!o||r===void 0?s[o]:r}const Gve={decay:U4,inertia:U4,tween:tA,keyframes:tA,spring:bI};function Nre(t){typeof t.type=="string"&&(t.type=Gve[t.type])}class zV{constructor(){this.updateFinished()}get finished(){return this._finished}updateFinished(){this._finished=new Promise(e=>{this.resolve=e})}notifyFinished(){this.resolve()}then(e,i){return this.finished.then(e,i)}}const Wve=t=>t/100;class Y3 extends zV{constructor(e){super(),this.state="idle",this.startTime=null,this.isStopped=!1,this.currentTime=0,this.holdTime=null,this.playbackSpeed=1,this.stop=()=>{const{motionValue:i}=this.options;i&&i.updatedAt!==Jl.now()&&this.tick(Jl.now()),this.isStopped=!0,this.state!=="idle"&&(this.teardown(),this.options.onStop?.())},this.options=e,this.initAnimation(),this.play(),e.autoplay===!1&&this.pause()}initAnimation(){const{options:e}=this;Nre(e);const{type:i=tA,repeat:r=0,repeatDelay:n=0,repeatType:s,velocity:a=0}=e;let{keyframes:o}=e;const l=i||tA;l!==tA&&typeof o[0]!="number"&&(this.mixKeyframes=QM(Wve,Dre(o[0],o[1])),o=[0,100]);const c=l({...e,keyframes:o});s==="mirror"&&(this.mirroredGenerator=l({...e,keyframes:[...o].reverse(),velocity:-a})),c.calculatedDuration===null&&(c.calculatedDuration=UV(c));const{calculatedDuration:u}=c;this.calculatedDuration=u,this.resolvedDuration=u+n,this.totalDuration=this.resolvedDuration*(r+1)-n,this.generator=c}updateTime(e){const i=Math.round(e-this.startTime)*this.playbackSpeed;this.holdTime!==null?this.currentTime=this.holdTime:this.currentTime=i}tick(e,i=!1){const{generator:r,totalDuration:n,mixKeyframes:s,mirroredGenerator:a,resolvedDuration:o,calculatedDuration:l}=this;if(this.startTime===null)return r.next(0);const{delay:c=0,keyframes:u,repeat:h,repeatType:d,repeatDelay:f,type:p,onUpdate:g,finalKeyframe:m}=this.options;this.speed>0?this.startTime=Math.min(this.startTime,e):this.speed<0&&(this.startTime=Math.min(e-n/this.speed,this.startTime)),i?this.currentTime=e:this.updateTime(e);const y=this.currentTime-c*(this.playbackSpeed>=0?1:-1),b=this.playbackSpeed>=0?y<0:y>n;this.currentTime=Math.max(y,0),this.state==="finished"&&this.holdTime===null&&(this.currentTime=n);let w=this.currentTime,E=r;if(h){const C=Math.min(this.currentTime,n)/o;let R=Math.floor(C),I=C%1;!I&&C>=1&&(I=1),I===1&&R--,R=Math.min(R,h+1),!!(R%2)&&(d==="reverse"?(I=1-I,f&&(I-=f/o)):d==="mirror"&&(E=a)),w=$d(0,1,I)*o}const M=b?{done:!1,value:u[0]}:E.next(w);s&&(M.value=s(M.value));let{done:A}=M;!b&&l!==null&&(A=this.playbackSpeed>=0?this.currentTime>=n:this.currentTime<=0);const P=this.holdTime===null&&(this.state==="finished"||this.state==="running"&&A);return P&&p!==U4&&(M.value=FV(u,this.options,m,this.speed)),g&&g(M.value),P&&this.finish(),M}then(e,i){return this.finished.then(e,i)}get duration(){return pu(this.calculatedDuration)}get iterationDuration(){const{delay:e=0}=this.options||{};return this.duration+pu(e)}get time(){return pu(this.currentTime)}set time(e){e=Bd(e),this.currentTime=e,this.startTime===null||this.holdTime!==null||this.playbackSpeed===0?this.holdTime=e:this.driver&&(this.startTime=this.driver.now()-e/this.playbackSpeed),this.driver?.start(!1)}get speed(){return this.playbackSpeed}set speed(e){this.updateTime(Jl.now());const i=this.playbackSpeed!==e;this.playbackSpeed=e,i&&(this.time=pu(this.currentTime))}play(){if(this.isStopped)return;const{driver:e=Rve,startTime:i}=this.options;this.driver||(this.driver=e(n=>this.tick(n))),this.options.onPlay?.();const r=this.driver.now();this.state==="finished"?(this.updateFinished(),this.startTime=r):this.holdTime!==null?this.startTime=r-this.holdTime:this.startTime||(this.startTime=i??r),this.state==="finished"&&this.speed<0&&(this.startTime+=this.calculatedDuration),this.holdTime=null,this.state="running",this.driver.start()}pause(){this.state="paused",this.updateTime(Jl.now()),this.holdTime=this.currentTime}complete(){this.state!=="running"&&this.play(),this.state="finished",this.holdTime=null}finish(){this.notifyFinished(),this.teardown(),this.state="finished",this.options.onComplete?.()}cancel(){this.holdTime=null,this.startTime=0,this.tick(0),this.teardown(),this.options.onCancel?.()}teardown(){this.state="idle",this.stopDriver(),this.startTime=this.holdTime=null}stopDriver(){this.driver&&(this.driver.stop(),this.driver=void 0)}sample(e){return this.startTime=0,this.tick(e,!0)}attachTimeline(e){return this.options.allowFlatten&&(this.options.type="keyframes",this.options.ease="linear",this.initAnimation()),this.driver?.stop(),e.observe(this)}}function qve(t){for(let e=1;e<t.length;e++)t[e]??(t[e]=t[e-1])}const Yy=t=>t*180/Math.PI,B4=t=>{const e=Yy(Math.atan2(t[1],t[0]));return F4(e)},Xve={x:4,y:5,translateX:4,translateY:5,scaleX:0,scaleY:3,scale:t=>(Math.abs(t[0])+Math.abs(t[3]))/2,rotate:B4,rotateZ:B4,skewX:t=>Yy(Math.atan(t[1])),skewY:t=>Yy(Math.atan(t[2])),skew:t=>(Math.abs(t[1])+Math.abs(t[2]))/2},F4=t=>(t=t%360,t<0&&(t+=360),t),_W=B4,SW=t=>Math.sqrt(t[0]*t[0]+t[1]*t[1]),EW=t=>Math.sqrt(t[4]*t[4]+t[5]*t[5]),$ve={x:12,y:13,z:14,translateX:12,translateY:13,translateZ:14,scaleX:SW,scaleY:EW,scale:t=>(SW(t)+EW(t))/2,rotateX:t=>F4(Yy(Math.atan2(t[6],t[5]))),rotateY:t=>F4(Yy(Math.atan2(-t[2],t[0]))),rotateZ:_W,rotate:_W,skewX:t=>Yy(Math.atan(t[4])),skewY:t=>Yy(Math.atan(t[1])),skew:t=>(Math.abs(t[1])+Math.abs(t[4]))/2};function z4(t){return t.includes("scale")?1:0}function j4(t,e){if(!t||t==="none")return z4(e);const i=t.match(/^matrix3d\(([-\d.e\s,]+)\)$/u);let r,n;if(i)r=$ve,n=i;else{const o=t.match(/^matrix\(([-\d.e\s,]+)\)$/u);r=Xve,n=o}if(!n)return z4(e);const s=r[e],a=n[1].split(",").map(Kve);return typeof s=="function"?s(a):a[s]}const Yve=(t,e)=>{const{transform:i="none"}=getComputedStyle(t);return j4(i,e)};function Kve(t){return parseFloat(t.trim())}const n_=["transformPerspective","x","y","z","translateX","translateY","translateZ","scale","scaleX","scaleY","rotate","rotateX","rotateY","rotateZ","skew","skewX","skewY"],s_=new Set(n_),AW=t=>t===r_||t===Wi,Zve=new Set(["x","y","z"]),Qve=n_.filter(t=>!Zve.has(t));function Jve(t){const e=[];return Qve.forEach(i=>{const r=t.getValue(i);r!==void 0&&(e.push([i,r.get()]),r.set(i.startsWith("scale")?1:0))}),e}const o0={width:({x:t},{paddingLeft:e="0",paddingRight:i="0"})=>t.max-t.min-parseFloat(e)-parseFloat(i),height:({y:t},{paddingTop:e="0",paddingBottom:i="0"})=>t.max-t.min-parseFloat(e)-parseFloat(i),top:(t,{top:e})=>parseFloat(e),left:(t,{left:e})=>parseFloat(e),bottom:({y:t},{top:e})=>parseFloat(e)+(t.max-t.min),right:({x:t},{left:e})=>parseFloat(e)+(t.max-t.min),x:(t,{transform:e})=>j4(e,"x"),y:(t,{transform:e})=>j4(e,"y")};o0.translateX=o0.x;o0.translateY=o0.y;const l0=new Set;let V4=!1,H4=!1,G4=!1;function Ure(){if(H4){const t=Array.from(l0).filter(r=>r.needsMeasurement),e=new Set(t.map(r=>r.element)),i=new Map;e.forEach(r=>{const n=Jve(r);n.length&&(i.set(r,n),r.render())}),t.forEach(r=>r.measureInitialState()),e.forEach(r=>{r.render();const n=i.get(r);n&&n.forEach(([s,a])=>{r.getValue(s)?.set(a)})}),t.forEach(r=>r.measureEndState()),t.forEach(r=>{r.suspendedScrollY!==void 0&&window.scrollTo(0,r.suspendedScrollY)})}H4=!1,V4=!1,l0.forEach(t=>t.complete(G4)),l0.clear()}function Bre(){l0.forEach(t=>{t.readKeyframes(),t.needsMeasurement&&(H4=!0)})}function eye(){G4=!0,Bre(),Ure(),G4=!1}class jV{constructor(e,i,r,n,s,a=!1){this.state="pending",this.isAsync=!1,this.needsMeasurement=!1,this.unresolvedKeyframes=[...e],this.onComplete=i,this.name=r,this.motionValue=n,this.element=s,this.isAsync=a}scheduleResolve(){this.state="scheduled",this.isAsync?(l0.add(this),V4||(V4=!0,Jr.read(Bre),Jr.resolveKeyframes(Ure))):(this.readKeyframes(),this.complete())}readKeyframes(){const{unresolvedKeyframes:e,name:i,element:r,motionValue:n}=this;if(e[0]===null){const s=n?.get(),a=e[e.length-1];if(s!==void 0)e[0]=s;else if(r&&i){const o=r.readValue(i,a);o!=null&&(e[0]=o)}e[0]===void 0&&(e[0]=a),n&&s===void 0&&n.set(e[0])}qve(e)}setFinalKeyframe(){}measureInitialState(){}renderEndStyles(){}measureEndState(){}complete(e=!1){this.state="complete",this.onComplete(this.unresolvedKeyframes,this.finalKeyframe,e),l0.delete(this)}cancel(){this.state==="scheduled"&&(l0.delete(this),this.state="pending")}resume(){this.state==="pending"&&this.scheduleResolve()}}const tye=t=>t.startsWith("--");function iye(t,e,i){tye(e)?t.style.setProperty(e,i):t.style[e]=i}const Fre=TV(()=>window.ScrollTimeline!==void 0),rye={};function nye(t,e){const i=TV(t);return()=>rye[e]??i()}const zre=nye(()=>{try{document.createElement("div").animate({opacity:0},{easing:"linear(0, 1)"})}catch{return!1}return!0},"linearEasing"),OE=([t,e,i,r])=>`cubic-bezier(${t}, ${e}, ${i}, ${r})`,MW={linear:"linear",ease:"ease",easeIn:"ease-in",easeOut:"ease-out",easeInOut:"ease-in-out",circIn:OE([0,.65,.55,1]),circOut:OE([.55,0,1,.45]),backIn:OE([.31,.01,.66,-.59]),backOut:OE([.33,1.53,.69,.99])};function jre(t,e){if(t)return typeof t=="function"?zre()?Ore(t,e):"ease-out":Sre(t)?OE(t):Array.isArray(t)?t.map(i=>jre(i,e)||MW.easeOut):MW[t]}function sye(t,e,i,{delay:r=0,duration:n=300,repeat:s=0,repeatType:a="loop",ease:o="easeOut",times:l}={},c=void 0){const u={[e]:i};l&&(u.offset=l);const h=jre(o,n);Array.isArray(h)&&(u.easing=h);const d={delay:r,duration:n,easing:Array.isArray(h)?"linear":h,fill:"both",iterations:s+1,direction:a==="reverse"?"alternate":"normal"};return c&&(d.pseudoElement=c),t.animate(u,d)}function Vre(t){return typeof t=="function"&&"applyToOptions"in t}function aye({type:t,...e}){return Vre(t)&&zre()?t.applyToOptions(e):(e.duration??(e.duration=300),e.ease??(e.ease="easeOut"),e)}class oye extends zV{constructor(e){if(super(),this.finishedTime=null,this.isStopped=!1,!e)return;const{element:i,name:r,keyframes:n,pseudoElement:s,allowFlatten:a=!1,finalKeyframe:o,onComplete:l}=e;this.isPseudoElement=!!s,this.allowFlatten=a,this.options=e,VA(typeof e.type!="string");const c=aye(e);this.animation=sye(i,r,n,c,s),c.autoplay===!1&&this.animation.pause(),this.animation.onfinish=()=>{if(this.finishedTime=this.time,!s){const u=FV(n,this.options,o,this.speed);this.updateMotionValue?this.updateMotionValue(u):iye(i,r,u),this.animation.cancel()}l?.(),this.notifyFinished()}}play(){this.isStopped||(this.animation.play(),this.state==="finished"&&this.updateFinished())}pause(){this.animation.pause()}complete(){this.animation.finish?.()}cancel(){try{this.animation.cancel()}catch{}}stop(){if(this.isStopped)return;this.isStopped=!0;const{state:e}=this;e==="idle"||e==="finished"||(this.updateMotionValue?this.updateMotionValue():this.commitStyles(),this.isPseudoElement||this.cancel())}commitStyles(){this.isPseudoElement||this.animation.commitStyles?.()}get duration(){const e=this.animation.effect?.getComputedTiming?.().duration||0;return pu(Number(e))}get iterationDuration(){const{delay:e=0}=this.options||{};return this.duration+pu(e)}get time(){return pu(Number(this.animation.currentTime)||0)}set time(e){this.finishedTime=null,this.animation.currentTime=Bd(e)}get speed(){return this.animation.playbackRate}set speed(e){e<0&&(this.finishedTime=null),this.animation.playbackRate=e}get state(){return this.finishedTime!==null?"finished":this.animation.playState}get startTime(){return Number(this.animation.startTime)}set startTime(e){this.animation.startTime=e}attachTimeline({timeline:e,observe:i}){return this.allowFlatten&&this.animation.effect?.updateTiming({easing:"linear"}),this.animation.onfinish=null,e&&Fre()?(this.animation.timeline=e,nc):i(this)}}const Hre={anticipate:xre,backInOut:yre,circInOut:wre};function lye(t){return t in Hre}function cye(t){typeof t.ease=="string"&&lye(t.ease)&&(t.ease=Hre[t.ease])}const TW=10;class uye extends oye{constructor(e){cye(e),Nre(e),super(e),e.startTime&&(this.startTime=e.startTime),this.options=e}updateMotionValue(e){const{motionValue:i,onUpdate:r,onComplete:n,element:s,...a}=this.options;if(!i)return;if(e!==void 0){i.set(e);return}const o=new Y3({...a,autoplay:!1}),l=Bd(this.finishedTime??this.time);i.setWithVelocity(o.sample(l-TW).value,o.sample(l).value,TW),o.stop()}}const CW=(t,e)=>e==="zIndex"?!1:!!(typeof t=="number"||Array.isArray(t)||typeof t=="string"&&($g.test(t)||t==="0")&&!t.startsWith("url("));function hye(t){const e=t[0];if(t.length===1)return!0;for(let i=0;i<t.length;i++)if(t[i]!==e)return!0}function dye(t,e,i,r){const n=t[0];if(n===null)return!1;if(e==="display"||e==="visibility")return!0;const s=t[t.length-1],a=CW(n,e),o=CW(s,e);return!a||!o?!1:hye(t)||(i==="spring"||Vre(i))&&r}function W4(t){t.duration=0,t.type="keyframes"}const fye=new Set(["opacity","clipPath","filter","transform"]),pye=TV(()=>Object.hasOwnProperty.call(Element.prototype,"animate"));function mye(t){const{motionValue:e,name:i,repeatDelay:r,repeatType:n,damping:s,type:a}=t;if(!(e?.owner?.current instanceof HTMLElement))return!1;const{onUpdate:l,transformTemplate:c}=e.owner.getProps();return pye()&&i&&fye.has(i)&&(i!=="transform"||!c)&&!l&&!r&&n!=="mirror"&&s!==0&&a!=="inertia"}const gye=40;class vye extends zV{constructor({autoplay:e=!0,delay:i=0,type:r="keyframes",repeat:n=0,repeatDelay:s=0,repeatType:a="loop",keyframes:o,name:l,motionValue:c,element:u,...h}){super(),this.stop=()=>{this._animation&&(this._animation.stop(),this.stopTimeline?.()),this.keyframeResolver?.cancel()},this.createdAt=Jl.now();const d={autoplay:e,delay:i,type:r,repeat:n,repeatDelay:s,repeatType:a,name:l,motionValue:c,element:u,...h},f=u?.KeyframeResolver||jV;this.keyframeResolver=new f(o,(p,g,m)=>this.onKeyframesResolved(p,g,d,!m),l,c,u),this.keyframeResolver?.scheduleResolve()}onKeyframesResolved(e,i,r,n){this.keyframeResolver=void 0;const{name:s,type:a,velocity:o,delay:l,isHandoff:c,onUpdate:u}=r;this.resolvedAt=Jl.now(),dye(e,s,a,o)||((Np.instantAnimations||!l)&&u?.(FV(e,r,i)),e[0]=e[e.length-1],W4(r),r.repeat=0);const d={startTime:n?this.resolvedAt?this.resolvedAt-this.createdAt>gye?this.resolvedAt:this.createdAt:this.createdAt:void 0,finalKeyframe:i,...r,keyframes:e},f=!c&&mye(d)?new uye({...d,element:d.motionValue.owner.current}):new Y3(d);f.finished.then(()=>this.notifyFinished()).catch(nc),this.pendingTimeline&&(this.stopTimeline=f.attachTimeline(this.pendingTimeline),this.pendingTimeline=void 0),this._animation=f}get finished(){return this._animation?this.animation.finished:this._finished}then(e,i){return this.finished.finally(e).then(()=>{})}get animation(){return this._animation||(this.keyframeResolver?.resume(),eye()),this._animation}get duration(){return this.animation.duration}get iterationDuration(){return this.animation.iterationDuration}get time(){return this.animation.time}set time(e){this.animation.time=e}get speed(){return this.animation.speed}get state(){return this.animation.state}set speed(e){this.animation.speed=e}get startTime(){return this.animation.startTime}attachTimeline(e){return this._animation?this.stopTimeline=this.animation.attachTimeline(e):this.pendingTimeline=e,()=>this.stop()}play(){this.animation.play()}pause(){this.animation.pause()}complete(){this.animation.complete()}cancel(){this._animation&&this.animation.cancel(),this.keyframeResolver?.cancel()}}const yye=/^var\(--(?:([\w-]+)|([\w-]+), ?([a-zA-Z\d ()%#.,-]+))\)/u;function xye(t){const e=yye.exec(t);if(!e)return[,];const[,i,r,n]=e;return[`--${i??r}`,n]}function Gre(t,e,i=1){const[r,n]=xye(t);if(!r)return;const s=window.getComputedStyle(e).getPropertyValue(r);if(s){const a=s.trim();return hre(a)?parseFloat(a):a}return OV(n)?Gre(n,e,i+1):n}function VV(t,e){return t?.[e]??t?.default??t}const Wre=new Set(["width","height","top","left","right","bottom",...n_]),bye={test:t=>t==="auto",parse:t=>t},qre=t=>e=>e.test(t),Xre=[r_,Wi,Fd,ag,pve,fve,bye],PW=t=>Xre.find(qre(t));function wye(t){return typeof t=="number"?t===0:t!==null?t==="none"||t==="0"||fre(t):!0}const _ye=new Set(["brightness","contrast","saturate","opacity"]);function Sye(t){const[e,i]=t.slice(0,-1).split("(");if(e==="drop-shadow")return t;const[r]=i.match(LV)||[];if(!r)return t;const n=i.replace(r,"");let s=_ye.has(e)?1:0;return r!==i&&(s*=100),e+"("+s+n+")"}const Eye=/\b([a-z-]*)\(.*?\)/gu,q4={...$g,getAnimatableNone:t=>{const e=t.match(Eye);return e?e.map(Sye).join(" "):t}},RW={...r_,transform:Math.round},Aye={rotate:ag,rotateX:ag,rotateY:ag,rotateZ:ag,scale:HC,scaleX:HC,scaleY:HC,scaleZ:HC,skew:ag,skewX:ag,skewY:ag,distance:Wi,translateX:Wi,translateY:Wi,translateZ:Wi,x:Wi,y:Wi,z:Wi,perspective:Wi,transformPerspective:Wi,opacity:HA,originX:vW,originY:vW,originZ:Wi},HV={borderWidth:Wi,borderTopWidth:Wi,borderRightWidth:Wi,borderBottomWidth:Wi,borderLeftWidth:Wi,borderRadius:Wi,radius:Wi,borderTopLeftRadius:Wi,borderTopRightRadius:Wi,borderBottomRightRadius:Wi,borderBottomLeftRadius:Wi,width:Wi,maxWidth:Wi,height:Wi,maxHeight:Wi,top:Wi,right:Wi,bottom:Wi,left:Wi,padding:Wi,paddingTop:Wi,paddingRight:Wi,paddingBottom:Wi,paddingLeft:Wi,margin:Wi,marginTop:Wi,marginRight:Wi,marginBottom:Wi,marginLeft:Wi,backgroundPositionX:Wi,backgroundPositionY:Wi,...Aye,zIndex:RW,fillOpacity:HA,strokeOpacity:HA,numOctaves:RW},Mye={...HV,color:Ns,backgroundColor:Ns,outlineColor:Ns,fill:Ns,stroke:Ns,borderColor:Ns,borderTopColor:Ns,borderRightColor:Ns,borderBottomColor:Ns,borderLeftColor:Ns,filter:q4,WebkitFilter:q4},$re=t=>Mye[t];function Yre(t,e){let i=$re(t);return i!==q4&&(i=$g),i.getAnimatableNone?i.getAnimatableNone(e):void 0}const Tye=new Set(["auto","none","0"]);function Cye(t,e,i){let r=0,n;for(;r<t.length&&!n;){const s=t[r];typeof s=="string"&&!Tye.has(s)&&GA(s).values.length&&(n=t[r]),r++}if(n&&i)for(const s of e)t[s]=Yre(i,n)}class Pye extends jV{constructor(e,i,r,n,s){super(e,i,r,n,s,!0)}readKeyframes(){const{unresolvedKeyframes:e,element:i,name:r}=this;if(!i||!i.current)return;super.readKeyframes();for(let l=0;l<e.length;l++){let c=e[l];if(typeof c=="string"&&(c=c.trim(),OV(c))){const u=Gre(c,i.current);u!==void 0&&(e[l]=u),l===e.length-1&&(this.finalKeyframe=c)}}if(this.resolveNoneKeyframes(),!Wre.has(r)||e.length!==2)return;const[n,s]=e,a=PW(n),o=PW(s);if(a!==o)if(AW(a)&&AW(o))for(let l=0;l<e.length;l++){const c=e[l];typeof c=="string"&&(e[l]=parseFloat(c))}else o0[r]&&(this.needsMeasurement=!0)}resolveNoneKeyframes(){const{unresolvedKeyframes:e,name:i}=this,r=[];for(let n=0;n<e.length;n++)(e[n]===null||wye(e[n]))&&r.push(n);r.length&&Cye(e,r,i)}measureInitialState(){const{element:e,unresolvedKeyframes:i,name:r}=this;if(!e||!e.current)return;r==="height"&&(this.suspendedScrollY=window.pageYOffset),this.measuredOrigin=o0[r](e.measureViewportBox(),window.getComputedStyle(e.current)),i[0]=this.measuredOrigin;const n=i[i.length-1];n!==void 0&&e.getValue(r,n).jump(n,!1)}measureEndState(){const{element:e,name:i,unresolvedKeyframes:r}=this;if(!e||!e.current)return;const n=e.getValue(i);n&&n.jump(this.measuredOrigin,!1);const s=r.length-1,a=r[s];r[s]=o0[i](e.measureViewportBox(),window.getComputedStyle(e.current)),a!==null&&this.finalKeyframe===void 0&&(this.finalKeyframe=a),this.removedTransforms?.length&&this.removedTransforms.forEach(([o,l])=>{e.getValue(o).set(l)}),this.resolveNoneKeyframes()}}function GV(t,e,i){if(t instanceof EventTarget)return[t];if(typeof t=="string"){const n=document.querySelectorAll(t);return n?Array.from(n):[]}return Array.from(t)}const Kre=(t,e)=>e&&typeof t=="number"?e.transform(t):t;function WV(t){return dre(t)&&"offsetHeight"in t}const IW=30,Rye=t=>!isNaN(parseFloat(t)),iA={current:void 0};class Iye{constructor(e,i={}){this.canTrackVelocity=null,this.events={},this.updateAndNotify=r=>{const n=Jl.now();if(this.updatedAt!==n&&this.setPrevFrameValue(),this.prev=this.current,this.setCurrent(r),this.current!==this.prev&&(this.events.change?.notify(this.current),this.dependents))for(const s of this.dependents)s.dirty()},this.hasAnimated=!1,this.setCurrent(e),this.owner=i.owner}setCurrent(e){this.current=e,this.updatedAt=Jl.now(),this.canTrackVelocity===null&&e!==void 0&&(this.canTrackVelocity=Rye(this.current))}setPrevFrameValue(e=this.current){this.prevFrameValue=e,this.prevUpdatedAt=this.updatedAt}onChange(e){return this.on("change",e)}on(e,i){this.events[e]||(this.events[e]=new CV);const r=this.events[e].add(i);return e==="change"?()=>{r(),Jr.read(()=>{this.events.change.getSize()||this.stop()})}:r}clearListeners(){for(const e in this.events)this.events[e].clear()}attach(e,i){this.passiveEffect=e,this.stopPassiveEffect=i}set(e){this.passiveEffect?this.passiveEffect(e,this.updateAndNotify):this.updateAndNotify(e)}setWithVelocity(e,i,r){this.set(i),this.prev=void 0,this.prevFrameValue=e,this.prevUpdatedAt=this.updatedAt-r}jump(e,i=!0){this.updateAndNotify(e),this.prev=e,this.prevUpdatedAt=this.prevFrameValue=void 0,i&&this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}dirty(){this.events.change?.notify(this.current)}addDependent(e){this.dependents||(this.dependents=new Set),this.dependents.add(e)}removeDependent(e){this.dependents&&this.dependents.delete(e)}get(){return iA.current&&iA.current.push(this),this.current}getPrevious(){return this.prev}getVelocity(){const e=Jl.now();if(!this.canTrackVelocity||this.prevFrameValue===void 0||e-this.updatedAt>IW)return 0;const i=Math.min(this.updatedAt-this.prevUpdatedAt,IW);return PV(parseFloat(this.current)-parseFloat(this.prevFrameValue),i)}start(e){return this.stop(),new Promise(i=>{this.hasAnimated=!0,this.animation=e(i),this.events.animationStart&&this.events.animationStart.notify()}).then(()=>{this.events.animationComplete&&this.events.animationComplete.notify(),this.clearAnimation()})}stop(){this.animation&&(this.animation.stop(),this.events.animationCancel&&this.events.animationCancel.notify()),this.clearAnimation()}isAnimating(){return!!this.animation}clearAnimation(){delete this.animation}destroy(){this.dependents?.clear(),this.events.destroy?.notify(),this.clearListeners(),this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}}function yh(t,e){return new Iye(t,e)}const{schedule:qV}=Ere(queueMicrotask,!1),dh={x:!1,y:!1};function Zre(){return dh.x||dh.y}function Dye(t){return t==="x"||t==="y"?dh[t]?null:(dh[t]=!0,()=>{dh[t]=!1}):dh.x||dh.y?null:(dh.x=dh.y=!0,()=>{dh.x=dh.y=!1})}function Qre(t,e){const i=GV(t),r=new AbortController,n={passive:!0,...e,signal:r.signal};return[i,n,()=>r.abort()]}function DW(t){return!(t.pointerType==="touch"||Zre())}function Oye(t,e,i={}){const[r,n,s]=Qre(t,i),a=o=>{if(!DW(o))return;const{target:l}=o,c=e(l,o);if(typeof c!="function"||!l)return;const u=h=>{DW(h)&&(c(h),l.removeEventListener("pointerleave",u))};l.addEventListener("pointerleave",u,n)};return r.forEach(o=>{o.addEventListener("pointerenter",a,n)}),s}const Jre=(t,e)=>e?t===e?!0:Jre(t,e.parentElement):!1,XV=t=>t.pointerType==="mouse"?typeof t.button!="number"||t.button<=0:t.isPrimary!==!1,Lye=new Set(["BUTTON","INPUT","SELECT","TEXTAREA","A"]);function kye(t){return Lye.has(t.tagName)||t.tabIndex!==-1}const BR=new WeakSet;function OW(t){return e=>{e.key==="Enter"&&t(e)}}function bk(t,e){t.dispatchEvent(new PointerEvent("pointer"+e,{isPrimary:!0,bubbles:!0}))}const Nye=(t,e)=>{const i=t.currentTarget;if(!i)return;const r=OW(()=>{if(BR.has(i))return;bk(i,"down");const n=OW(()=>{bk(i,"up")}),s=()=>bk(i,"cancel");i.addEventListener("keyup",n,e),i.addEventListener("blur",s,e)});i.addEventListener("keydown",r,e),i.addEventListener("blur",()=>i.removeEventListener("keydown",r),e)};function LW(t){return XV(t)&&!Zre()}function Uye(t,e,i={}){const[r,n,s]=Qre(t,i),a=o=>{const l=o.currentTarget;if(!LW(o))return;BR.add(l);const c=e(l,o),u=(f,p)=>{window.removeEventListener("pointerup",h),window.removeEventListener("pointercancel",d),BR.has(l)&&BR.delete(l),LW(f)&&typeof c=="function"&&c(f,{success:p})},h=f=>{u(f,l===window||l===document||i.useGlobalTarget||Jre(l,f.target))},d=f=>{u(f,!1)};window.addEventListener("pointerup",h,n),window.addEventListener("pointercancel",d,n)};return r.forEach(o=>{(i.useGlobalTarget?window:o).addEventListener("pointerdown",a,n),WV(o)&&(o.addEventListener("focus",c=>Nye(c,n)),!kye(o)&&!o.hasAttribute("tabindex")&&(o.tabIndex=0))}),s}function $V(t){return dre(t)&&"ownerSVGElement"in t}const FR=new WeakMap;let zR;const ene=(t,e,i)=>(r,n)=>n&&n[0]?n[0][t+"Size"]:$V(r)&&"getBBox"in r?r.getBBox()[e]:r[i],Bye=ene("inline","width","offsetWidth"),Fye=ene("block","height","offsetHeight");function zye({target:t,borderBoxSize:e}){FR.get(t)?.forEach(i=>{i(t,{get width(){return Bye(t,e)},get height(){return Fye(t,e)}})})}function jye(t){t.forEach(zye)}function Vye(){typeof ResizeObserver>"u"||(zR=new ResizeObserver(jye))}function Hye(t,e){zR||Vye();const i=GV(t);return i.forEach(r=>{let n=FR.get(r);n||(n=new Set,FR.set(r,n)),n.add(e),zR?.observe(r)}),()=>{i.forEach(r=>{const n=FR.get(r);n?.delete(e),n?.size||zR?.unobserve(r)})}}const jR=new Set;let Lw;function Gye(){Lw=()=>{const t={get width(){return window.innerWidth},get height(){return window.innerHeight}};jR.forEach(e=>e(t))},window.addEventListener("resize",Lw)}function Wye(t){return jR.add(t),Lw||Gye(),()=>{jR.delete(t),!jR.size&&typeof Lw=="function"&&(window.removeEventListener("resize",Lw),Lw=void 0)}}function qye(t,e){return typeof t=="function"?Wye(t):Hye(t,e)}function tne(t,e){let i;const r=()=>{const{currentTime:n}=e,a=(n===null?0:n.value)/100;i!==a&&t(a),i=a};return Jr.preUpdate(r,!0),()=>Ah(r)}function Xye(t){return $V(t)&&t.tagName==="svg"}function $ye(...t){const e=!Array.isArray(t[0]),i=e?0:-1,r=t[0+i],n=t[1+i],s=t[2+i],a=t[3+i],o=BV(n,s,a);return e?o(r):o}const Wa=t=>!!(t&&t.getVelocity);function Yye(t,e,i){const r=t.get();let n=null,s=r,a;const o=typeof r=="string"?r.replace(/[\d.-]/g,""):void 0,l=()=>{n&&(n.stop(),n=null)},c=()=>{l(),n=new Y3({keyframes:[NW(t.get()),NW(s)],velocity:t.getVelocity(),type:"spring",restDelta:.001,restSpeed:.01,...i,onUpdate:a})};if(t.attach((u,h)=>(s=u,a=d=>h(kW(d,o)),Jr.postRender(c),t.get()),l),Wa(e)){const u=e.on("change",d=>t.set(kW(d,o))),h=t.on("destroy",u);return()=>{u(),h()}}return l}function kW(t,e){return e?t+e:t}function NW(t){return typeof t=="number"?t:parseFloat(t)}const Kye=[...Xre,Ns,$g],Zye=t=>Kye.find(qre(t)),tT=J.createContext({transformPagePoint:t=>t,isStatic:!1,reducedMotion:"never"});function UW(t,e){if(typeof t=="function")return t(e);t!=null&&(t.current=e)}function Qye(...t){return e=>{let i=!1;const r=t.map(n=>{const s=UW(n,e);return!i&&typeof s=="function"&&(i=!0),s});if(i)return()=>{for(let n=0;n<r.length;n++){const s=r[n];typeof s=="function"?s():UW(t[n],null)}}}}function Jye(...t){return J.useCallback(Qye(...t),t)}class e0e extends J.Component{getSnapshotBeforeUpdate(e){const i=this.props.childRef.current;if(i&&e.isPresent&&!this.props.isPresent){const r=i.offsetParent,n=WV(r)&&r.offsetWidth||0,s=this.props.sizeRef.current;s.height=i.offsetHeight||0,s.width=i.offsetWidth||0,s.top=i.offsetTop,s.left=i.offsetLeft,s.right=n-s.width-s.left}return null}componentDidUpdate(){}render(){return this.props.children}}function t0e({children:t,isPresent:e,anchorX:i,root:r}){const n=J.useId(),s=J.useRef(null),a=J.useRef({width:0,height:0,top:0,left:0,right:0}),{nonce:o}=J.useContext(tT),l=Jye(s,t?.ref);return J.useInsertionEffect(()=>{const{width:c,height:u,top:h,left:d,right:f}=a.current;if(e||!s.current||!c||!u)return;const p=i==="left"?`left: ${d}`:`right: ${f}`;s.current.dataset.motionPopId=n;const g=document.createElement("style");o&&(g.nonce=o);const m=r??document.head;return m.appendChild(g),g.sheet&&g.sheet.insertRule(`
          [data-motion-pop-id="${n}"] {
            position: absolute !important;
            width: ${c}px !important;
            height: ${u}px !important;
            ${p}px !important;
            top: ${h}px !important;
          }
        `),()=>{m.contains(g)&&m.removeChild(g)}},[e]),O.jsx(e0e,{isPresent:e,childRef:s,sizeRef:a,children:J.cloneElement(t,{ref:l})})}const i0e=({children:t,initial:e,isPresent:i,onExitComplete:r,custom:n,presenceAffectsLayout:s,mode:a,anchorX:o,root:l})=>{const c=i_(r0e),u=J.useId();let h=!0,d=J.useMemo(()=>(h=!1,{id:u,initial:e,isPresent:i,custom:n,onExitComplete:f=>{c.set(f,!0);for(const p of c.values())if(!p)return;r&&r()},register:f=>(c.set(f,!1),()=>c.delete(f))}),[i,c,r]);return s&&h&&(d={...d}),J.useMemo(()=>{c.forEach((f,p)=>c.set(p,!1))},[i]),J.useEffect(()=>{!i&&!c.size&&r&&r()},[i]),a==="popLayout"&&(t=O.jsx(t0e,{isPresent:i,anchorX:o,root:l,children:t})),O.jsx($3.Provider,{value:d,children:t})};function r0e(){return new Map}function ine(t=!0){const e=J.useContext($3);if(e===null)return[!0,null];const{isPresent:i,onExitComplete:r,register:n}=e,s=J.useId();J.useEffect(()=>{if(t)return n(s)},[t]);const a=J.useCallback(()=>t&&r&&r(s),[s,r,t]);return!i&&r?[!1,a]:[!0]}const GC=t=>t.key||"";function BW(t){const e=[];return J.Children.forEach(t,i=>{J.isValidElement(i)&&e.push(i)}),e}const ql=({children:t,custom:e,initial:i=!0,onExitComplete:r,presenceAffectsLayout:n=!0,mode:s="sync",propagate:a=!1,anchorX:o="left",root:l})=>{const[c,u]=ine(a),h=J.useMemo(()=>BW(t),[t]),d=a&&!c?[]:h.map(GC),f=J.useRef(!0),p=J.useRef(h),g=i_(()=>new Map),[m,y]=J.useState(h),[b,w]=J.useState(h);X3(()=>{f.current=!1,p.current=h;for(let A=0;A<b.length;A++){const P=GC(b[A]);d.includes(P)?g.delete(P):g.get(P)!==!0&&g.set(P,!1)}},[b,d.length,d.join("-")]);const E=[];if(h!==m){let A=[...h];for(let P=0;P<b.length;P++){const C=b[P],R=GC(C);d.includes(R)||(A.splice(P,0,C),E.push(C))}return s==="wait"&&E.length&&(A=E),w(BW(A)),y(h),null}const{forceRender:M}=J.useContext(SV);return O.jsx(O.Fragment,{children:b.map(A=>{const P=GC(A),C=a&&!c?!1:h===b||d.includes(P),R=()=>{if(g.has(P))g.set(P,!0);else return;let I=!0;g.forEach(k=>{k||(I=!1)}),I&&(M?.(),w(p.current),a&&u?.(),r&&r())};return O.jsx(i0e,{isPresent:C,initial:!f.current||i?void 0:!1,custom:e,presenceAffectsLayout:n,mode:s,root:l,onExitComplete:C?void 0:R,anchorX:o,children:A},P)})})},rne=J.createContext({strict:!1}),FW={animation:["animate","variants","whileHover","whileTap","exit","whileInView","whileFocus","whileDrag"],exit:["exit"],drag:["drag","dragControls"],focus:["whileFocus"],hover:["whileHover","onHoverStart","onHoverEnd"],tap:["whileTap","onTap","onTapStart","onTapCancel"],pan:["onPan","onPanStart","onPanSessionStart","onPanEnd"],inView:["whileInView","onViewportEnter","onViewportLeave"],layout:["layout","layoutId"]},y1={};for(const t in FW)y1[t]={isEnabled:e=>FW[t].some(i=>!!e[i])};function n0e(t){for(const e in t)y1[e]={...y1[e],...t[e]}}const s0e=new Set(["animate","exit","variants","initial","style","values","variants","transition","transformTemplate","custom","inherit","onBeforeLayoutMeasure","onAnimationStart","onAnimationComplete","onUpdate","onDragStart","onDrag","onDragEnd","onMeasureDragConstraints","onDirectionLock","onDragTransitionEnd","_dragX","_dragY","onHoverStart","onHoverEnd","onViewportEnter","onViewportLeave","globalTapTarget","ignoreStrict","viewport"]);function wI(t){return t.startsWith("while")||t.startsWith("drag")&&t!=="draggable"||t.startsWith("layout")||t.startsWith("onTap")||t.startsWith("onPan")||t.startsWith("onLayout")||s0e.has(t)}let nne=t=>!wI(t);function a0e(t){typeof t=="function"&&(nne=e=>e.startsWith("on")?!wI(e):t(e))}try{a0e(require("@emotion/is-prop-valid").default)}catch{}function o0e(t,e,i){const r={};for(const n in t)n==="values"&&typeof t.values=="object"||(nne(n)||i===!0&&wI(n)||!e&&!wI(n)||t.draggable&&n.startsWith("onDrag"))&&(r[n]=t[n]);return r}const K3=J.createContext({});function Z3(t){return t!==null&&typeof t=="object"&&typeof t.start=="function"}function WA(t){return typeof t=="string"||Array.isArray(t)}const YV=["animate","whileInView","whileFocus","whileHover","whileTap","whileDrag","exit"],KV=["initial",...YV];function Q3(t){return Z3(t.animate)||KV.some(e=>WA(t[e]))}function sne(t){return!!(Q3(t)||t.variants)}function l0e(t,e){if(Q3(t)){const{initial:i,animate:r}=t;return{initial:i===!1||WA(i)?i:void 0,animate:WA(r)?r:void 0}}return t.inherit!==!1?e:{}}function c0e(t){const{initial:e,animate:i}=l0e(t,J.useContext(K3));return J.useMemo(()=>({initial:e,animate:i}),[zW(e),zW(i)])}function zW(t){return Array.isArray(t)?t.join(" "):t}const qA={};function u0e(t){for(const e in t)qA[e]=t[e],DV(e)&&(qA[e].isCSSVariable=!0)}function ane(t,{layout:e,layoutId:i}){return s_.has(t)||t.startsWith("origin")||(e||i!==void 0)&&(!!qA[t]||t==="opacity")}const h0e={x:"translateX",y:"translateY",z:"translateZ",transformPerspective:"perspective"},d0e=n_.length;function f0e(t,e,i){let r="",n=!0;for(let s=0;s<d0e;s++){const a=n_[s],o=t[a];if(o===void 0)continue;let l=!0;if(typeof o=="number"?l=o===(a.startsWith("scale")?1:0):l=parseFloat(o)===0,!l||i){const c=Kre(o,HV[a]);if(!l){n=!1;const u=h0e[a]||a;r+=`${u}(${c}) `}i&&(e[a]=c)}}return r=r.trim(),i?r=i(e,n?"":r):n&&(r="none"),r}function ZV(t,e,i){const{style:r,vars:n,transformOrigin:s}=t;let a=!1,o=!1;for(const l in e){const c=e[l];if(s_.has(l)){a=!0;continue}else if(DV(l)){n[l]=c;continue}else{const u=Kre(c,HV[l]);l.startsWith("origin")?(o=!0,s[l]=u):r[l]=u}}if(e.transform||(a||i?r.transform=f0e(e,t.transform,i):r.transform&&(r.transform="none")),o){const{originX:l="50%",originY:c="50%",originZ:u=0}=s;r.transformOrigin=`${l} ${c} ${u}`}}const QV=()=>({style:{},transform:{},transformOrigin:{},vars:{}});function one(t,e,i){for(const r in e)!Wa(e[r])&&!ane(r,i)&&(t[r]=e[r])}function p0e({transformTemplate:t},e){return J.useMemo(()=>{const i=QV();return ZV(i,e,t),Object.assign({},i.vars,i.style)},[e])}function m0e(t,e){const i=t.style||{},r={};return one(r,i,t),Object.assign(r,p0e(t,e)),r}function g0e(t,e){const i={},r=m0e(t,e);return t.drag&&t.dragListener!==!1&&(i.draggable=!1,r.userSelect=r.WebkitUserSelect=r.WebkitTouchCallout="none",r.touchAction=t.drag===!0?"none":`pan-${t.drag==="x"?"y":"x"}`),t.tabIndex===void 0&&(t.onTap||t.onTapStart||t.whileTap)&&(i.tabIndex=0),i.style=r,i}const v0e={offset:"stroke-dashoffset",array:"stroke-dasharray"},y0e={offset:"strokeDashoffset",array:"strokeDasharray"};function x0e(t,e,i=1,r=0,n=!0){t.pathLength=1;const s=n?v0e:y0e;t[s.offset]=Wi.transform(-r);const a=Wi.transform(e),o=Wi.transform(i);t[s.array]=`${a} ${o}`}function lne(t,{attrX:e,attrY:i,attrScale:r,pathLength:n,pathSpacing:s=1,pathOffset:a=0,...o},l,c,u){if(ZV(t,o,c),l){t.style.viewBox&&(t.attrs.viewBox=t.style.viewBox);return}t.attrs=t.style,t.style={};const{attrs:h,style:d}=t;h.transform&&(d.transform=h.transform,delete h.transform),(d.transform||h.transformOrigin)&&(d.transformOrigin=h.transformOrigin??"50% 50%",delete h.transformOrigin),d.transform&&(d.transformBox=u?.transformBox??"fill-box",delete h.transformBox),e!==void 0&&(h.x=e),i!==void 0&&(h.y=i),r!==void 0&&(h.scale=r),n!==void 0&&x0e(h,n,s,a,!1)}const cne=()=>({...QV(),attrs:{}}),une=t=>typeof t=="string"&&t.toLowerCase()==="svg";function b0e(t,e,i,r){const n=J.useMemo(()=>{const s=cne();return lne(s,e,une(r),t.transformTemplate,t.style),{...s.attrs,style:{...s.style}}},[e]);if(t.style){const s={};one(s,t.style,t),n.style={...s,...n.style}}return n}const w0e=["animate","circle","defs","desc","ellipse","g","image","line","filter","marker","mask","metadata","path","pattern","polygon","polyline","rect","stop","switch","symbol","svg","text","tspan","use","view"];function JV(t){return typeof t!="string"||t.includes("-")?!1:!!(w0e.indexOf(t)>-1||/[A-Z]/u.test(t))}function _0e(t,e,i,{latestValues:r},n,s=!1){const o=(JV(t)?b0e:g0e)(e,r,n,t),l=o0e(e,typeof t=="string",s),c=t!==J.Fragment?{...l,...o,ref:i}:{},{children:u}=e,h=J.useMemo(()=>Wa(u)?u.get():u,[u]);return J.createElement(t,{...c,children:h})}function jW(t){const e=[{},{}];return t?.values.forEach((i,r)=>{e[0][r]=i.get(),e[1][r]=i.getVelocity()}),e}function e6(t,e,i,r){if(typeof e=="function"){const[n,s]=jW(r);e=e(i!==void 0?i:t.custom,n,s)}if(typeof e=="string"&&(e=t.variants&&t.variants[e]),typeof e=="function"){const[n,s]=jW(r);e=e(i!==void 0?i:t.custom,n,s)}return e}function VR(t){return Wa(t)?t.get():t}function S0e({scrapeMotionValuesFromProps:t,createRenderState:e},i,r,n){return{latestValues:E0e(i,r,n,t),renderState:e()}}function E0e(t,e,i,r){const n={},s=r(t,{});for(const d in s)n[d]=VR(s[d]);let{initial:a,animate:o}=t;const l=Q3(t),c=sne(t);e&&c&&!l&&t.inherit!==!1&&(a===void 0&&(a=e.initial),o===void 0&&(o=e.animate));let u=i?i.initial===!1:!1;u=u||a===!1;const h=u?o:a;if(h&&typeof h!="boolean"&&!Z3(h)){const d=Array.isArray(h)?h:[h];for(let f=0;f<d.length;f++){const p=e6(t,d[f]);if(p){const{transitionEnd:g,transition:m,...y}=p;for(const b in y){let w=y[b];if(Array.isArray(w)){const E=u?w.length-1:0;w=w[E]}w!==null&&(n[b]=w)}for(const b in g)n[b]=g[b]}}}return n}const hne=t=>(e,i)=>{const r=J.useContext(K3),n=J.useContext($3),s=()=>S0e(t,e,r,n);return i?s():i_(s)};function t6(t,e,i){const{style:r}=t,n={};for(const s in r)(Wa(r[s])||e.style&&Wa(e.style[s])||ane(s,t)||i?.getValue(s)?.liveStyle!==void 0)&&(n[s]=r[s]);return n}const A0e=hne({scrapeMotionValuesFromProps:t6,createRenderState:QV});function dne(t,e,i){const r=t6(t,e,i);for(const n in t)if(Wa(t[n])||Wa(e[n])){const s=n_.indexOf(n)!==-1?"attr"+n.charAt(0).toUpperCase()+n.substring(1):n;r[s]=t[n]}return r}const M0e=hne({scrapeMotionValuesFromProps:dne,createRenderState:cne}),T0e=Symbol.for("motionComponentSymbol");function kw(t){return t&&typeof t=="object"&&Object.prototype.hasOwnProperty.call(t,"current")}function C0e(t,e,i){return J.useCallback(r=>{r&&t.onMount&&t.onMount(r),e&&(r?e.mount(r):e.unmount()),i&&(typeof i=="function"?i(r):kw(i)&&(i.current=r))},[e])}const i6=t=>t.replace(/([a-z])([A-Z])/gu,"$1-$2").toLowerCase(),P0e="framerAppearId",fne="data-"+i6(P0e),pne=J.createContext({});function R0e(t,e,i,r,n){const{visualElement:s}=J.useContext(K3),a=J.useContext(rne),o=J.useContext($3),l=J.useContext(tT).reducedMotion,c=J.useRef(null);r=r||a.renderer,!c.current&&r&&(c.current=r(t,{visualState:e,parent:s,props:i,presenceContext:o,blockInitialAnimation:o?o.initial===!1:!1,reducedMotionConfig:l}));const u=c.current,h=J.useContext(pne);u&&!u.projection&&n&&(u.type==="html"||u.type==="svg")&&I0e(c.current,i,n,h);const d=J.useRef(!1);J.useInsertionEffect(()=>{u&&d.current&&u.update(i,o)});const f=i[fne],p=J.useRef(!!f&&!window.MotionHandoffIsComplete?.(f)&&window.MotionHasOptimisedAnimation?.(f));return X3(()=>{u&&(d.current=!0,window.MotionIsMounted=!0,u.updateFeatures(),u.scheduleRenderMicrotask(),p.current&&u.animationState&&u.animationState.animateChanges())}),J.useEffect(()=>{u&&(!p.current&&u.animationState&&u.animationState.animateChanges(),p.current&&(queueMicrotask(()=>{window.MotionHandoffMarkAsComplete?.(f)}),p.current=!1),u.enteringChildren=void 0)}),u}function I0e(t,e,i,r){const{layoutId:n,layout:s,drag:a,dragConstraints:o,layoutScroll:l,layoutRoot:c,layoutCrossfade:u}=e;t.projection=new i(t.latestValues,e["data-framer-portal-id"]?void 0:mne(t.parent)),t.projection.setOptions({layoutId:n,layout:s,alwaysMeasureLayout:!!a||o&&kw(o),visualElement:t,animationType:typeof s=="string"?s:"both",initialPromotionConfig:r,crossfade:u,layoutScroll:l,layoutRoot:c})}function mne(t){if(t)return t.options.allowProjection!==!1?t.projection:mne(t.parent)}function wk(t,{forwardMotionProps:e=!1}={},i,r){i&&n0e(i);const n=JV(t)?M0e:A0e;function s(o,l){let c;const u={...J.useContext(tT),...o,layoutId:D0e(o)},{isStatic:h}=u,d=c0e(o),f=n(o,h);if(!h&&EV){O0e();const p=L0e(u);c=p.MeasureLayout,d.visualElement=R0e(t,f,u,r,p.ProjectionNode)}return O.jsxs(K3.Provider,{value:d,children:[c&&d.visualElement?O.jsx(c,{visualElement:d.visualElement,...u}):null,_0e(t,o,C0e(f,d.visualElement,l),f,h,e)]})}s.displayName=`motion.${typeof t=="string"?t:`create(${t.displayName??t.name??""})`}`;const a=J.forwardRef(s);return a[T0e]=t,a}function D0e({layoutId:t}){const e=J.useContext(SV).id;return e&&t!==void 0?e+"-"+t:t}function O0e(t,e){J.useContext(rne).strict}function L0e(t){const{drag:e,layout:i}=y1;if(!e&&!i)return{};const r={...e,...i};return{MeasureLayout:e?.isEnabled(t)||i?.isEnabled(t)?r.MeasureLayout:void 0,ProjectionNode:r.ProjectionNode}}function k0e(t,e){if(typeof Proxy>"u")return wk;const i=new Map,r=(s,a)=>wk(s,a,t,e),n=(s,a)=>r(s,a);return new Proxy(n,{get:(s,a)=>a==="create"?r:(i.has(a)||i.set(a,wk(a,void 0,t,e)),i.get(a))})}function gne({top:t,left:e,right:i,bottom:r}){return{x:{min:e,max:i},y:{min:t,max:r}}}function N0e({x:t,y:e}){return{top:e.min,right:t.max,bottom:e.max,left:t.min}}function U0e(t,e){if(!e)return t;const i=e({x:t.left,y:t.top}),r=e({x:t.right,y:t.bottom});return{top:i.y,left:i.x,bottom:r.y,right:r.x}}function _k(t){return t===void 0||t===1}function X4({scale:t,scaleX:e,scaleY:i}){return!_k(t)||!_k(e)||!_k(i)}function Dy(t){return X4(t)||vne(t)||t.z||t.rotate||t.rotateX||t.rotateY||t.skewX||t.skewY}function vne(t){return VW(t.x)||VW(t.y)}function VW(t){return t&&t!=="0%"}function _I(t,e,i){const r=t-i,n=e*r;return i+n}function HW(t,e,i,r,n){return n!==void 0&&(t=_I(t,n,r)),_I(t,i,r)+e}function $4(t,e=0,i=1,r,n){t.min=HW(t.min,e,i,r,n),t.max=HW(t.max,e,i,r,n)}function yne(t,{x:e,y:i}){$4(t.x,e.translate,e.scale,e.originPoint),$4(t.y,i.translate,i.scale,i.originPoint)}const GW=.999999999999,WW=1.0000000000001;function B0e(t,e,i,r=!1){const n=i.length;if(!n)return;e.x=e.y=1;let s,a;for(let o=0;o<n;o++){s=i[o],a=s.projectionDelta;const{visualElement:l}=s.options;l&&l.props.style&&l.props.style.display==="contents"||(r&&s.options.layoutScroll&&s.scroll&&s!==s.root&&Uw(t,{x:-s.scroll.offset.x,y:-s.scroll.offset.y}),a&&(e.x*=a.x.scale,e.y*=a.y.scale,yne(t,a)),r&&Dy(s.latestValues)&&Uw(t,s.latestValues))}e.x<WW&&e.x>GW&&(e.x=1),e.y<WW&&e.y>GW&&(e.y=1)}function Nw(t,e){t.min=t.min+e,t.max=t.max+e}function qW(t,e,i,r,n=.5){const s=Xn(t.min,t.max,n);$4(t,e,i,s,r)}function Uw(t,e){qW(t.x,e.x,e.scaleX,e.scale,e.originX),qW(t.y,e.y,e.scaleY,e.scale,e.originY)}function xne(t,e){return gne(U0e(t.getBoundingClientRect(),e))}function F0e(t,e,i){const r=xne(t,i),{scroll:n}=e;return n&&(Nw(r.x,n.offset.x),Nw(r.y,n.offset.y)),r}const XW=()=>({translate:0,scale:1,origin:0,originPoint:0}),Bw=()=>({x:XW(),y:XW()}),$W=()=>({min:0,max:0}),ys=()=>({x:$W(),y:$W()}),Y4={current:null},bne={current:!1};function z0e(){if(bne.current=!0,!!EV)if(window.matchMedia){const t=window.matchMedia("(prefers-reduced-motion)"),e=()=>Y4.current=t.matches;t.addEventListener("change",e),e()}else Y4.current=!1}const j0e=new WeakMap;function V0e(t,e,i){for(const r in e){const n=e[r],s=i[r];if(Wa(n))t.addValue(r,n);else if(Wa(s))t.addValue(r,yh(n,{owner:t}));else if(s!==n)if(t.hasValue(r)){const a=t.getValue(r);a.liveStyle===!0?a.jump(n):a.hasAnimated||a.set(n)}else{const a=t.getStaticValue(r);t.addValue(r,yh(a!==void 0?a:n,{owner:t}))}}for(const r in i)e[r]===void 0&&t.removeValue(r);return e}const YW=["AnimationStart","AnimationComplete","Update","BeforeLayoutMeasure","LayoutMeasure","LayoutAnimationStart","LayoutAnimationComplete"];class H0e{scrapeMotionValuesFromProps(e,i,r){return{}}constructor({parent:e,props:i,presenceContext:r,reducedMotionConfig:n,blockInitialAnimation:s,visualState:a},o={}){this.current=null,this.children=new Set,this.isVariantNode=!1,this.isControllingVariants=!1,this.shouldReduceMotion=null,this.values=new Map,this.KeyframeResolver=jV,this.features={},this.valueSubscriptions=new Map,this.prevMotionValues={},this.events={},this.propEventSubscriptions={},this.notifyUpdate=()=>this.notify("Update",this.latestValues),this.render=()=>{this.current&&(this.triggerBuild(),this.renderInstance(this.current,this.renderState,this.props.style,this.projection))},this.renderScheduledAt=0,this.scheduleRender=()=>{const d=Jl.now();this.renderScheduledAt<d&&(this.renderScheduledAt=d,Jr.render(this.render,!1,!0))};const{latestValues:l,renderState:c}=a;this.latestValues=l,this.baseTarget={...l},this.initialValues=i.initial?{...l}:{},this.renderState=c,this.parent=e,this.props=i,this.presenceContext=r,this.depth=e?e.depth+1:0,this.reducedMotionConfig=n,this.options=o,this.blockInitialAnimation=!!s,this.isControllingVariants=Q3(i),this.isVariantNode=sne(i),this.isVariantNode&&(this.variantChildren=new Set),this.manuallyAnimateOnMount=!!(e&&e.current);const{willChange:u,...h}=this.scrapeMotionValuesFromProps(i,{},this);for(const d in h){const f=h[d];l[d]!==void 0&&Wa(f)&&f.set(l[d])}}mount(e){this.current=e,j0e.set(e,this),this.projection&&!this.projection.instance&&this.projection.mount(e),this.parent&&this.isVariantNode&&!this.isControllingVariants&&(this.removeFromVariantTree=this.parent.addVariantChild(this)),this.values.forEach((i,r)=>this.bindToMotionValue(r,i)),bne.current||z0e(),this.shouldReduceMotion=this.reducedMotionConfig==="never"?!1:this.reducedMotionConfig==="always"?!0:Y4.current,this.parent?.addChild(this),this.update(this.props,this.presenceContext)}unmount(){this.projection&&this.projection.unmount(),Ah(this.notifyUpdate),Ah(this.render),this.valueSubscriptions.forEach(e=>e()),this.valueSubscriptions.clear(),this.removeFromVariantTree&&this.removeFromVariantTree(),this.parent?.removeChild(this);for(const e in this.events)this.events[e].clear();for(const e in this.features){const i=this.features[e];i&&(i.unmount(),i.isMounted=!1)}this.current=null}addChild(e){this.children.add(e),this.enteringChildren??(this.enteringChildren=new Set),this.enteringChildren.add(e)}removeChild(e){this.children.delete(e),this.enteringChildren&&this.enteringChildren.delete(e)}bindToMotionValue(e,i){this.valueSubscriptions.has(e)&&this.valueSubscriptions.get(e)();const r=s_.has(e);r&&this.onBindTransform&&this.onBindTransform();const n=i.on("change",a=>{this.latestValues[e]=a,this.props.onUpdate&&Jr.preRender(this.notifyUpdate),r&&this.projection&&(this.projection.isTransformDirty=!0),this.scheduleRender()});let s;window.MotionCheckAppearSync&&(s=window.MotionCheckAppearSync(this,e,i)),this.valueSubscriptions.set(e,()=>{n(),s&&s(),i.owner&&i.stop()})}sortNodePosition(e){return!this.current||!this.sortInstanceNodePosition||this.type!==e.type?0:this.sortInstanceNodePosition(this.current,e.current)}updateFeatures(){let e="animation";for(e in y1){const i=y1[e];if(!i)continue;const{isEnabled:r,Feature:n}=i;if(!this.features[e]&&n&&r(this.props)&&(this.features[e]=new n(this)),this.features[e]){const s=this.features[e];s.isMounted?s.update():(s.mount(),s.isMounted=!0)}}}triggerBuild(){this.build(this.renderState,this.latestValues,this.props)}measureViewportBox(){return this.current?this.measureInstanceViewportBox(this.current,this.props):ys()}getStaticValue(e){return this.latestValues[e]}setStaticValue(e,i){this.latestValues[e]=i}update(e,i){(e.transformTemplate||this.props.transformTemplate)&&this.scheduleRender(),this.prevProps=this.props,this.props=e,this.prevPresenceContext=this.presenceContext,this.presenceContext=i;for(let r=0;r<YW.length;r++){const n=YW[r];this.propEventSubscriptions[n]&&(this.propEventSubscriptions[n](),delete this.propEventSubscriptions[n]);const s="on"+n,a=e[s];a&&(this.propEventSubscriptions[n]=this.on(n,a))}this.prevMotionValues=V0e(this,this.scrapeMotionValuesFromProps(e,this.prevProps,this),this.prevMotionValues),this.handleChildMotionValue&&this.handleChildMotionValue()}getProps(){return this.props}getVariant(e){return this.props.variants?this.props.variants[e]:void 0}getDefaultTransition(){return this.props.transition}getTransformPagePoint(){return this.props.transformPagePoint}getClosestVariantNode(){return this.isVariantNode?this:this.parent?this.parent.getClosestVariantNode():void 0}addVariantChild(e){const i=this.getClosestVariantNode();if(i)return i.variantChildren&&i.variantChildren.add(e),()=>i.variantChildren.delete(e)}addValue(e,i){const r=this.values.get(e);i!==r&&(r&&this.removeValue(e),this.bindToMotionValue(e,i),this.values.set(e,i),this.latestValues[e]=i.get())}removeValue(e){this.values.delete(e);const i=this.valueSubscriptions.get(e);i&&(i(),this.valueSubscriptions.delete(e)),delete this.latestValues[e],this.removeValueFromRenderState(e,this.renderState)}hasValue(e){return this.values.has(e)}getValue(e,i){if(this.props.values&&this.props.values[e])return this.props.values[e];let r=this.values.get(e);return r===void 0&&i!==void 0&&(r=yh(i===null?void 0:i,{owner:this}),this.addValue(e,r)),r}readValue(e,i){let r=this.latestValues[e]!==void 0||!this.current?this.latestValues[e]:this.getBaseTargetFromProps(this.props,e)??this.readValueFromInstance(this.current,e,this.options);return r!=null&&(typeof r=="string"&&(hre(r)||fre(r))?r=parseFloat(r):!Zye(r)&&$g.test(i)&&(r=Yre(e,i)),this.setBaseTarget(e,Wa(r)?r.get():r)),Wa(r)?r.get():r}setBaseTarget(e,i){this.baseTarget[e]=i}getBaseTarget(e){const{initial:i}=this.props;let r;if(typeof i=="string"||typeof i=="object"){const s=e6(this.props,i,this.presenceContext?.custom);s&&(r=s[e])}if(i&&r!==void 0)return r;const n=this.getBaseTargetFromProps(this.props,e);return n!==void 0&&!Wa(n)?n:this.initialValues[e]!==void 0&&r===void 0?void 0:this.baseTarget[e]}on(e,i){return this.events[e]||(this.events[e]=new CV),this.events[e].add(i)}notify(e,...i){this.events[e]&&this.events[e].notify(...i)}scheduleRenderMicrotask(){qV.render(this.render)}}class wne extends H0e{constructor(){super(...arguments),this.KeyframeResolver=Pye}sortInstanceNodePosition(e,i){return e.compareDocumentPosition(i)&2?1:-1}getBaseTargetFromProps(e,i){return e.style?e.style[i]:void 0}removeValueFromRenderState(e,{vars:i,style:r}){delete i[e],delete r[e]}handleChildMotionValue(){this.childSubscription&&(this.childSubscription(),delete this.childSubscription);const{children:e}=this.props;Wa(e)&&(this.childSubscription=e.on("change",i=>{this.current&&(this.current.textContent=`${i}`)}))}}function _ne(t,{style:e,vars:i},r,n){const s=t.style;let a;for(a in e)s[a]=e[a];n?.applyProjectionStyles(s,r);for(a in i)s.setProperty(a,i[a])}function G0e(t){return window.getComputedStyle(t)}class W0e extends wne{constructor(){super(...arguments),this.type="html",this.renderInstance=_ne}readValueFromInstance(e,i){if(s_.has(i))return this.projection?.isProjecting?z4(i):Yve(e,i);{const r=G0e(e),n=(DV(i)?r.getPropertyValue(i):r[i])||0;return typeof n=="string"?n.trim():n}}measureInstanceViewportBox(e,{transformPagePoint:i}){return xne(e,i)}build(e,i,r){ZV(e,i,r.transformTemplate)}scrapeMotionValuesFromProps(e,i,r){return t6(e,i,r)}}const Sne=new Set(["baseFrequency","diffuseConstant","kernelMatrix","kernelUnitLength","keySplines","keyTimes","limitingConeAngle","markerHeight","markerWidth","numOctaves","targetX","targetY","surfaceScale","specularConstant","specularExponent","stdDeviation","tableValues","viewBox","gradientTransform","pathLength","startOffset","textLength","lengthAdjust"]);function q0e(t,e,i,r){_ne(t,e,void 0,r);for(const n in e.attrs)t.setAttribute(Sne.has(n)?n:i6(n),e.attrs[n])}class X0e extends wne{constructor(){super(...arguments),this.type="svg",this.isSVGTag=!1,this.measureInstanceViewportBox=ys}getBaseTargetFromProps(e,i){return e[i]}readValueFromInstance(e,i){if(s_.has(i)){const r=$re(i);return r&&r.default||0}return i=Sne.has(i)?i:i6(i),e.getAttribute(i)}scrapeMotionValuesFromProps(e,i,r){return dne(e,i,r)}build(e,i,r){lne(e,i,this.isSVGTag,r.transformTemplate,r.style)}renderInstance(e,i,r,n){q0e(e,i,r,n)}mount(e){this.isSVGTag=une(e.tagName),super.mount(e)}}const $0e=(t,e)=>JV(t)?new X0e(e):new W0e(e,{allowProjection:t!==J.Fragment});function e1(t,e,i){const r=t.getProps();return e6(r,e,i!==void 0?i:r.custom,t)}const K4=t=>Array.isArray(t);function Y0e(t,e,i){t.hasValue(e)?t.getValue(e).set(i):t.addValue(e,yh(i))}function K0e(t){return K4(t)?t[t.length-1]||0:t}function Z0e(t,e){const i=e1(t,e);let{transitionEnd:r={},transition:n={},...s}=i||{};s={...s,...r};for(const a in s){const o=K0e(s[a]);Y0e(t,a,o)}}function Q0e(t){return!!(Wa(t)&&t.add)}function Z4(t,e){const i=t.getValue("willChange");if(Q0e(i))return i.add(e);if(!i&&Np.WillChange){const r=new Np.WillChange("auto");t.addValue("willChange",r),r.add(e)}}function Ene(t){return t.props[fne]}const J0e=t=>t!==null;function exe(t,{repeat:e,repeatType:i="loop"},r){const n=t.filter(J0e),s=e&&i!=="loop"&&e%2===1?0:n.length-1;return n[s]}const txe={type:"spring",stiffness:500,damping:25,restSpeed:10},ixe=t=>({type:"spring",stiffness:550,damping:t===0?2*Math.sqrt(550):30,restSpeed:10}),rxe={type:"keyframes",duration:.8},nxe={type:"keyframes",ease:[.25,.1,.35,1],duration:.3},sxe=(t,{keyframes:e})=>e.length>2?rxe:s_.has(t)?t.startsWith("scale")?ixe(e[1]):txe:nxe;function axe({when:t,delay:e,delayChildren:i,staggerChildren:r,staggerDirection:n,repeat:s,repeatType:a,repeatDelay:o,from:l,elapsed:c,...u}){return!!Object.keys(u).length}const r6=(t,e,i,r={},n,s)=>a=>{const o=VV(r,t)||{},l=o.delay||r.delay||0;let{elapsed:c=0}=r;c=c-Bd(l);const u={keyframes:Array.isArray(i)?i:[null,i],ease:"easeOut",velocity:e.getVelocity(),...o,delay:-c,onUpdate:d=>{e.set(d),o.onUpdate&&o.onUpdate(d)},onComplete:()=>{a(),o.onComplete&&o.onComplete()},name:t,motionValue:e,element:s?void 0:n};axe(o)||Object.assign(u,sxe(t,u)),u.duration&&(u.duration=Bd(u.duration)),u.repeatDelay&&(u.repeatDelay=Bd(u.repeatDelay)),u.from!==void 0&&(u.keyframes[0]=u.from);let h=!1;if((u.type===!1||u.duration===0&&!u.repeatDelay)&&(W4(u),u.delay===0&&(h=!0)),(Np.instantAnimations||Np.skipAnimations)&&(h=!0,W4(u),u.delay=0),u.allowFlatten=!o.type&&!o.ease,h&&!s&&e.get()!==void 0){const d=exe(u.keyframes,o);if(d!==void 0){Jr.update(()=>{u.onUpdate(d),u.onComplete()});return}}return o.isSync?new Y3(u):new vye(u)};function oxe({protectedKeys:t,needsAnimating:e},i){const r=t.hasOwnProperty(i)&&e[i]!==!0;return e[i]=!1,r}function Ane(t,e,{delay:i=0,transitionOverride:r,type:n}={}){let{transition:s=t.getDefaultTransition(),transitionEnd:a,...o}=e;r&&(s=r);const l=[],c=n&&t.animationState&&t.animationState.getState()[n];for(const u in o){const h=t.getValue(u,t.latestValues[u]??null),d=o[u];if(d===void 0||c&&oxe(c,u))continue;const f={delay:i,...VV(s||{},u)},p=h.get();if(p!==void 0&&!h.isAnimating&&!Array.isArray(d)&&d===p&&!f.velocity)continue;let g=!1;if(window.MotionHandoffAnimation){const y=Ene(t);if(y){const b=window.MotionHandoffAnimation(y,u,Jr);b!==null&&(f.startTime=b,g=!0)}}Z4(t,u),h.start(r6(u,h,d,t.shouldReduceMotion&&Wre.has(u)?{type:!1}:f,t,g));const m=h.animation;m&&l.push(m)}return a&&Promise.all(l).then(()=>{Jr.update(()=>{a&&Z0e(t,a)})}),l}function Mne(t,e,i,r=0,n=1){const s=Array.from(t).sort((c,u)=>c.sortNodePosition(u)).indexOf(e),a=t.size,o=(a-1)*r;return typeof i=="function"?i(s,a):n===1?s*r:o-s*r}function Q4(t,e,i={}){const r=e1(t,e,i.type==="exit"?t.presenceContext?.custom:void 0);let{transition:n=t.getDefaultTransition()||{}}=r||{};i.transitionOverride&&(n=i.transitionOverride);const s=r?()=>Promise.all(Ane(t,r,i)):()=>Promise.resolve(),a=t.variantChildren&&t.variantChildren.size?(l=0)=>{const{delayChildren:c=0,staggerChildren:u,staggerDirection:h}=n;return lxe(t,e,l,c,u,h,i)}:()=>Promise.resolve(),{when:o}=n;if(o){const[l,c]=o==="beforeChildren"?[s,a]:[a,s];return l().then(()=>c())}else return Promise.all([s(),a(i.delay)])}function lxe(t,e,i=0,r=0,n=0,s=1,a){const o=[];for(const l of t.variantChildren)l.notify("AnimationStart",e),o.push(Q4(l,e,{...a,delay:i+(typeof r=="function"?0:r)+Mne(t.variantChildren,l,r,n,s)}).then(()=>l.notify("AnimationComplete",e)));return Promise.all(o)}function cxe(t,e,i={}){t.notify("AnimationStart",e);let r;if(Array.isArray(e)){const n=e.map(s=>Q4(t,s,i));r=Promise.all(n)}else if(typeof e=="string")r=Q4(t,e,i);else{const n=typeof e=="function"?e1(t,e,i.custom):e;r=Promise.all(Ane(t,n,i))}return r.then(()=>{t.notify("AnimationComplete",e)})}function Tne(t,e){if(!Array.isArray(e))return!1;const i=e.length;if(i!==t.length)return!1;for(let r=0;r<i;r++)if(e[r]!==t[r])return!1;return!0}const uxe=KV.length;function Cne(t){if(!t)return;if(!t.isControllingVariants){const i=t.parent?Cne(t.parent)||{}:{};return t.props.initial!==void 0&&(i.initial=t.props.initial),i}const e={};for(let i=0;i<uxe;i++){const r=KV[i],n=t.props[r];(WA(n)||n===!1)&&(e[r]=n)}return e}const hxe=[...YV].reverse(),dxe=YV.length;function fxe(t){return e=>Promise.all(e.map(({animation:i,options:r})=>cxe(t,i,r)))}function pxe(t){let e=fxe(t),i=KW(),r=!0;const n=l=>(c,u)=>{const h=e1(t,u,l==="exit"?t.presenceContext?.custom:void 0);if(h){const{transition:d,transitionEnd:f,...p}=h;c={...c,...p,...f}}return c};function s(l){e=l(t)}function a(l){const{props:c}=t,u=Cne(t.parent)||{},h=[],d=new Set;let f={},p=1/0;for(let m=0;m<dxe;m++){const y=hxe[m],b=i[y],w=c[y]!==void 0?c[y]:u[y],E=WA(w),M=y===l?b.isActive:null;M===!1&&(p=m);let A=w===u[y]&&w!==c[y]&&E;if(A&&r&&t.manuallyAnimateOnMount&&(A=!1),b.protectedKeys={...f},!b.isActive&&M===null||!w&&!b.prevProp||Z3(w)||typeof w=="boolean")continue;const P=mxe(b.prevProp,w);let C=P||y===l&&b.isActive&&!A&&E||m>p&&E,R=!1;const I=Array.isArray(w)?w:[w];let k=I.reduce(n(y),{});M===!1&&(k={});const{prevResolvedValues:z={}}=b,V={...z,...k},F=X=>{C=!0,d.has(X)&&(R=!0,d.delete(X)),b.needsAnimating[X]=!0;const U=t.getValue(X);U&&(U.liveStyle=!1)};for(const X in V){const U=k[X],Y=z[X];if(f.hasOwnProperty(X))continue;let Z=!1;K4(U)&&K4(Y)?Z=!Tne(U,Y):Z=U!==Y,Z?U!=null?F(X):d.add(X):U!==void 0&&d.has(X)?F(X):b.protectedKeys[X]=!0}b.prevProp=w,b.prevResolvedValues=k,b.isActive&&(f={...f,...k}),r&&t.blockInitialAnimation&&(C=!1);const $=A&&P;C&&(!$||R)&&h.push(...I.map(X=>{const U={type:y};if(typeof X=="string"&&r&&!$&&t.manuallyAnimateOnMount&&t.parent){const{parent:Y}=t,Z=e1(Y,X);if(Y.enteringChildren&&Z){const{delayChildren:j}=Z.transition||{};U.delay=Mne(Y.enteringChildren,t,j)}}return{animation:X,options:U}}))}if(d.size){const m={};if(typeof c.initial!="boolean"){const y=e1(t,Array.isArray(c.initial)?c.initial[0]:c.initial);y&&y.transition&&(m.transition=y.transition)}d.forEach(y=>{const b=t.getBaseTarget(y),w=t.getValue(y);w&&(w.liveStyle=!0),m[y]=b??null}),h.push({animation:m})}let g=!!h.length;return r&&(c.initial===!1||c.initial===c.animate)&&!t.manuallyAnimateOnMount&&(g=!1),r=!1,g?e(h):Promise.resolve()}function o(l,c){if(i[l].isActive===c)return Promise.resolve();t.variantChildren?.forEach(h=>h.animationState?.setActive(l,c)),i[l].isActive=c;const u=a(l);for(const h in i)i[h].protectedKeys={};return u}return{animateChanges:a,setActive:o,setAnimateFunction:s,getState:()=>i,reset:()=>{i=KW(),r=!0}}}function mxe(t,e){return typeof e=="string"?e!==t:Array.isArray(e)?!Tne(e,t):!1}function sy(t=!1){return{isActive:t,protectedKeys:{},needsAnimating:{},prevResolvedValues:{}}}function KW(){return{animate:sy(!0),whileInView:sy(),whileHover:sy(),whileTap:sy(),whileDrag:sy(),whileFocus:sy(),exit:sy()}}class ov{constructor(e){this.isMounted=!1,this.node=e}update(){}}class gxe extends ov{constructor(e){super(e),e.animationState||(e.animationState=pxe(e))}updateAnimationControlsSubscription(){const{animate:e}=this.node.getProps();Z3(e)&&(this.unmountControls=e.subscribe(this.node))}mount(){this.updateAnimationControlsSubscription()}update(){const{animate:e}=this.node.getProps(),{animate:i}=this.node.prevProps||{};e!==i&&this.updateAnimationControlsSubscription()}unmount(){this.node.animationState.reset(),this.unmountControls?.()}}let vxe=0;class yxe extends ov{constructor(){super(...arguments),this.id=vxe++}update(){if(!this.node.presenceContext)return;const{isPresent:e,onExitComplete:i}=this.node.presenceContext,{isPresent:r}=this.node.prevPresenceContext||{};if(!this.node.animationState||e===r)return;const n=this.node.animationState.setActive("exit",!e);i&&!e&&n.then(()=>{i(this.id)})}mount(){const{register:e,onExitComplete:i}=this.node.presenceContext||{};i&&i(this.id),e&&(this.unmount=e(this.id))}unmount(){}}const xxe={animation:{Feature:gxe},exit:{Feature:yxe}};function XA(t,e,i,r={passive:!0}){return t.addEventListener(e,i,r),()=>t.removeEventListener(e,i)}function iT(t){return{point:{x:t.pageX,y:t.pageY}}}const bxe=t=>e=>XV(e)&&t(e,iT(e));function rA(t,e,i,r){return XA(t,e,bxe(i),r)}const Pne=1e-4,wxe=1-Pne,_xe=1+Pne,Rne=.01,Sxe=0-Rne,Exe=0+Rne;function vl(t){return t.max-t.min}function Axe(t,e,i){return Math.abs(t-e)<=i}function ZW(t,e,i,r=.5){t.origin=r,t.originPoint=Xn(e.min,e.max,t.origin),t.scale=vl(i)/vl(e),t.translate=Xn(i.min,i.max,t.origin)-t.originPoint,(t.scale>=wxe&&t.scale<=_xe||isNaN(t.scale))&&(t.scale=1),(t.translate>=Sxe&&t.translate<=Exe||isNaN(t.translate))&&(t.translate=0)}function nA(t,e,i,r){ZW(t.x,e.x,i.x,r?r.originX:void 0),ZW(t.y,e.y,i.y,r?r.originY:void 0)}function QW(t,e,i){t.min=i.min+e.min,t.max=t.min+vl(e)}function Mxe(t,e,i){QW(t.x,e.x,i.x),QW(t.y,e.y,i.y)}function JW(t,e,i){t.min=e.min-i.min,t.max=t.min+vl(e)}function sA(t,e,i){JW(t.x,e.x,i.x),JW(t.y,e.y,i.y)}function ou(t){return[t("x"),t("y")]}const Ine=({current:t})=>t?t.ownerDocument.defaultView:null,e9=(t,e)=>Math.abs(t-e);function Txe(t,e){const i=e9(t.x,e.x),r=e9(t.y,e.y);return Math.sqrt(i**2+r**2)}class Dne{constructor(e,i,{transformPagePoint:r,contextWindow:n=window,dragSnapToOrigin:s=!1,distanceThreshold:a=3}={}){if(this.startEvent=null,this.lastMoveEvent=null,this.lastMoveEventInfo=null,this.handlers={},this.contextWindow=window,this.updatePoint=()=>{if(!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const d=Ek(this.lastMoveEventInfo,this.history),f=this.startEvent!==null,p=Txe(d.offset,{x:0,y:0})>=this.distanceThreshold;if(!f&&!p)return;const{point:g}=d,{timestamp:m}=Ua;this.history.push({...g,timestamp:m});const{onStart:y,onMove:b}=this.handlers;f||(y&&y(this.lastMoveEvent,d),this.startEvent=this.lastMoveEvent),b&&b(this.lastMoveEvent,d)},this.handlePointerMove=(d,f)=>{this.lastMoveEvent=d,this.lastMoveEventInfo=Sk(f,this.transformPagePoint),Jr.update(this.updatePoint,!0)},this.handlePointerUp=(d,f)=>{this.end();const{onEnd:p,onSessionEnd:g,resumeAnimation:m}=this.handlers;if(this.dragSnapToOrigin&&m&&m(),!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const y=Ek(d.type==="pointercancel"?this.lastMoveEventInfo:Sk(f,this.transformPagePoint),this.history);this.startEvent&&p&&p(d,y),g&&g(d,y)},!XV(e))return;this.dragSnapToOrigin=s,this.handlers=i,this.transformPagePoint=r,this.distanceThreshold=a,this.contextWindow=n||window;const o=iT(e),l=Sk(o,this.transformPagePoint),{point:c}=l,{timestamp:u}=Ua;this.history=[{...c,timestamp:u}];const{onSessionStart:h}=i;h&&h(e,Ek(l,this.history)),this.removeListeners=QM(rA(this.contextWindow,"pointermove",this.handlePointerMove),rA(this.contextWindow,"pointerup",this.handlePointerUp),rA(this.contextWindow,"pointercancel",this.handlePointerUp))}updateHandlers(e){this.handlers=e}end(){this.removeListeners&&this.removeListeners(),Ah(this.updatePoint)}}function Sk(t,e){return e?{point:e(t.point)}:t}function t9(t,e){return{x:t.x-e.x,y:t.y-e.y}}function Ek({point:t},e){return{point:t,delta:t9(t,One(e)),offset:t9(t,Cxe(e)),velocity:Pxe(e,.1)}}function Cxe(t){return t[0]}function One(t){return t[t.length-1]}function Pxe(t,e){if(t.length<2)return{x:0,y:0};let i=t.length-1,r=null;const n=One(t);for(;i>=0&&(r=t[i],!(n.timestamp-r.timestamp>Bd(e)));)i--;if(!r)return{x:0,y:0};const s=pu(n.timestamp-r.timestamp);if(s===0)return{x:0,y:0};const a={x:(n.x-r.x)/s,y:(n.y-r.y)/s};return a.x===1/0&&(a.x=0),a.y===1/0&&(a.y=0),a}function Rxe(t,{min:e,max:i},r){return e!==void 0&&t<e?t=r?Xn(e,t,r.min):Math.max(t,e):i!==void 0&&t>i&&(t=r?Xn(i,t,r.max):Math.min(t,i)),t}function i9(t,e,i){return{min:e!==void 0?t.min+e:void 0,max:i!==void 0?t.max+i-(t.max-t.min):void 0}}function Ixe(t,{top:e,left:i,bottom:r,right:n}){return{x:i9(t.x,i,n),y:i9(t.y,e,r)}}function r9(t,e){let i=e.min-t.min,r=e.max-t.max;return e.max-e.min<t.max-t.min&&([i,r]=[r,i]),{min:i,max:r}}function Dxe(t,e){return{x:r9(t.x,e.x),y:r9(t.y,e.y)}}function Oxe(t,e){let i=.5;const r=vl(t),n=vl(e);return n>r?i=v1(e.min,e.max-r,t.min):r>n&&(i=v1(t.min,t.max-n,e.min)),$d(0,1,i)}function Lxe(t,e){const i={};return e.min!==void 0&&(i.min=e.min-t.min),e.max!==void 0&&(i.max=e.max-t.min),i}const J4=.35;function kxe(t=J4){return t===!1?t=0:t===!0&&(t=J4),{x:n9(t,"left","right"),y:n9(t,"top","bottom")}}function n9(t,e,i){return{min:s9(t,e),max:s9(t,i)}}function s9(t,e){return typeof t=="number"?t:t[e]||0}const Nxe=new WeakMap;class Uxe{constructor(e){this.openDragLock=null,this.isDragging=!1,this.currentDirection=null,this.originPoint={x:0,y:0},this.constraints=!1,this.hasMutatedConstraints=!1,this.elastic=ys(),this.latestPointerEvent=null,this.latestPanInfo=null,this.visualElement=e}start(e,{snapToCursor:i=!1,distanceThreshold:r}={}){const{presenceContext:n}=this.visualElement;if(n&&n.isPresent===!1)return;const s=h=>{const{dragSnapToOrigin:d}=this.getProps();d?this.pauseAnimation():this.stopAnimation(),i&&this.snapToCursor(iT(h).point)},a=(h,d)=>{const{drag:f,dragPropagation:p,onDragStart:g}=this.getProps();if(f&&!p&&(this.openDragLock&&this.openDragLock(),this.openDragLock=Dye(f),!this.openDragLock))return;this.latestPointerEvent=h,this.latestPanInfo=d,this.isDragging=!0,this.currentDirection=null,this.resolveConstraints(),this.visualElement.projection&&(this.visualElement.projection.isAnimationBlocked=!0,this.visualElement.projection.target=void 0),ou(y=>{let b=this.getAxisMotionValue(y).get()||0;if(Fd.test(b)){const{projection:w}=this.visualElement;if(w&&w.layout){const E=w.layout.layoutBox[y];E&&(b=vl(E)*(parseFloat(b)/100))}}this.originPoint[y]=b}),g&&Jr.postRender(()=>g(h,d)),Z4(this.visualElement,"transform");const{animationState:m}=this.visualElement;m&&m.setActive("whileDrag",!0)},o=(h,d)=>{this.latestPointerEvent=h,this.latestPanInfo=d;const{dragPropagation:f,dragDirectionLock:p,onDirectionLock:g,onDrag:m}=this.getProps();if(!f&&!this.openDragLock)return;const{offset:y}=d;if(p&&this.currentDirection===null){this.currentDirection=Bxe(y),this.currentDirection!==null&&g&&g(this.currentDirection);return}this.updateAxis("x",d.point,y),this.updateAxis("y",d.point,y),this.visualElement.render(),m&&m(h,d)},l=(h,d)=>{this.latestPointerEvent=h,this.latestPanInfo=d,this.stop(h,d),this.latestPointerEvent=null,this.latestPanInfo=null},c=()=>ou(h=>this.getAnimationState(h)==="paused"&&this.getAxisMotionValue(h).animation?.play()),{dragSnapToOrigin:u}=this.getProps();this.panSession=new Dne(e,{onSessionStart:s,onStart:a,onMove:o,onSessionEnd:l,resumeAnimation:c},{transformPagePoint:this.visualElement.getTransformPagePoint(),dragSnapToOrigin:u,distanceThreshold:r,contextWindow:Ine(this.visualElement)})}stop(e,i){const r=e||this.latestPointerEvent,n=i||this.latestPanInfo,s=this.isDragging;if(this.cancel(),!s||!n||!r)return;const{velocity:a}=n;this.startAnimation(a);const{onDragEnd:o}=this.getProps();o&&Jr.postRender(()=>o(r,n))}cancel(){this.isDragging=!1;const{projection:e,animationState:i}=this.visualElement;e&&(e.isAnimationBlocked=!1),this.panSession&&this.panSession.end(),this.panSession=void 0;const{dragPropagation:r}=this.getProps();!r&&this.openDragLock&&(this.openDragLock(),this.openDragLock=null),i&&i.setActive("whileDrag",!1)}updateAxis(e,i,r){const{drag:n}=this.getProps();if(!r||!WC(e,n,this.currentDirection))return;const s=this.getAxisMotionValue(e);let a=this.originPoint[e]+r[e];this.constraints&&this.constraints[e]&&(a=Rxe(a,this.constraints[e],this.elastic[e])),s.set(a)}resolveConstraints(){const{dragConstraints:e,dragElastic:i}=this.getProps(),r=this.visualElement.projection&&!this.visualElement.projection.layout?this.visualElement.projection.measure(!1):this.visualElement.projection?.layout,n=this.constraints;e&&kw(e)?this.constraints||(this.constraints=this.resolveRefConstraints()):e&&r?this.constraints=Ixe(r.layoutBox,e):this.constraints=!1,this.elastic=kxe(i),n!==this.constraints&&r&&this.constraints&&!this.hasMutatedConstraints&&ou(s=>{this.constraints!==!1&&this.getAxisMotionValue(s)&&(this.constraints[s]=Lxe(r.layoutBox[s],this.constraints[s]))})}resolveRefConstraints(){const{dragConstraints:e,onMeasureDragConstraints:i}=this.getProps();if(!e||!kw(e))return!1;const r=e.current,{projection:n}=this.visualElement;if(!n||!n.layout)return!1;const s=F0e(r,n.root,this.visualElement.getTransformPagePoint());let a=Dxe(n.layout.layoutBox,s);if(i){const o=i(N0e(a));this.hasMutatedConstraints=!!o,o&&(a=gne(o))}return a}startAnimation(e){const{drag:i,dragMomentum:r,dragElastic:n,dragTransition:s,dragSnapToOrigin:a,onDragTransitionEnd:o}=this.getProps(),l=this.constraints||{},c=ou(u=>{if(!WC(u,i,this.currentDirection))return;let h=l&&l[u]||{};a&&(h={min:0,max:0});const d=n?200:1e6,f=n?40:1e7,p={type:"inertia",velocity:r?e[u]:0,bounceStiffness:d,bounceDamping:f,timeConstant:750,restDelta:1,restSpeed:10,...s,...h};return this.startAxisValueAnimation(u,p)});return Promise.all(c).then(o)}startAxisValueAnimation(e,i){const r=this.getAxisMotionValue(e);return Z4(this.visualElement,e),r.start(r6(e,r,0,i,this.visualElement,!1))}stopAnimation(){ou(e=>this.getAxisMotionValue(e).stop())}pauseAnimation(){ou(e=>this.getAxisMotionValue(e).animation?.pause())}getAnimationState(e){return this.getAxisMotionValue(e).animation?.state}getAxisMotionValue(e){const i=`_drag${e.toUpperCase()}`,r=this.visualElement.getProps(),n=r[i];return n||this.visualElement.getValue(e,(r.initial?r.initial[e]:void 0)||0)}snapToCursor(e){ou(i=>{const{drag:r}=this.getProps();if(!WC(i,r,this.currentDirection))return;const{projection:n}=this.visualElement,s=this.getAxisMotionValue(i);if(n&&n.layout){const{min:a,max:o}=n.layout.layoutBox[i];s.set(e[i]-Xn(a,o,.5))}})}scalePositionWithinConstraints(){if(!this.visualElement.current)return;const{drag:e,dragConstraints:i}=this.getProps(),{projection:r}=this.visualElement;if(!kw(i)||!r||!this.constraints)return;this.stopAnimation();const n={x:0,y:0};ou(a=>{const o=this.getAxisMotionValue(a);if(o&&this.constraints!==!1){const l=o.get();n[a]=Oxe({min:l,max:l},this.constraints[a])}});const{transformTemplate:s}=this.visualElement.getProps();this.visualElement.current.style.transform=s?s({},""):"none",r.root&&r.root.updateScroll(),r.updateLayout(),this.resolveConstraints(),ou(a=>{if(!WC(a,e,null))return;const o=this.getAxisMotionValue(a),{min:l,max:c}=this.constraints[a];o.set(Xn(l,c,n[a]))})}addListeners(){if(!this.visualElement.current)return;Nxe.set(this.visualElement,this);const e=this.visualElement.current,i=rA(e,"pointerdown",l=>{const{drag:c,dragListener:u=!0}=this.getProps();c&&u&&this.start(l)}),r=()=>{const{dragConstraints:l}=this.getProps();kw(l)&&l.current&&(this.constraints=this.resolveRefConstraints())},{projection:n}=this.visualElement,s=n.addEventListener("measure",r);n&&!n.layout&&(n.root&&n.root.updateScroll(),n.updateLayout()),Jr.read(r);const a=XA(window,"resize",()=>this.scalePositionWithinConstraints()),o=n.addEventListener("didUpdate",(({delta:l,hasLayoutChanged:c})=>{this.isDragging&&c&&(ou(u=>{const h=this.getAxisMotionValue(u);h&&(this.originPoint[u]+=l[u].translate,h.set(h.get()+l[u].translate))}),this.visualElement.render())}));return()=>{a(),i(),s(),o&&o()}}getProps(){const e=this.visualElement.getProps(),{drag:i=!1,dragDirectionLock:r=!1,dragPropagation:n=!1,dragConstraints:s=!1,dragElastic:a=J4,dragMomentum:o=!0}=e;return{...e,drag:i,dragDirectionLock:r,dragPropagation:n,dragConstraints:s,dragElastic:a,dragMomentum:o}}}function WC(t,e,i){return(e===!0||e===t)&&(i===null||i===t)}function Bxe(t,e=10){let i=null;return Math.abs(t.y)>e?i="y":Math.abs(t.x)>e&&(i="x"),i}class Fxe extends ov{constructor(e){super(e),this.removeGroupControls=nc,this.removeListeners=nc,this.controls=new Uxe(e)}mount(){const{dragControls:e}=this.node.getProps();e&&(this.removeGroupControls=e.subscribe(this.controls)),this.removeListeners=this.controls.addListeners()||nc}unmount(){this.removeGroupControls(),this.removeListeners()}}const a9=t=>(e,i)=>{t&&Jr.postRender(()=>t(e,i))};class zxe extends ov{constructor(){super(...arguments),this.removePointerDownListener=nc}onPointerDown(e){this.session=new Dne(e,this.createPanHandlers(),{transformPagePoint:this.node.getTransformPagePoint(),contextWindow:Ine(this.node)})}createPanHandlers(){const{onPanSessionStart:e,onPanStart:i,onPan:r,onPanEnd:n}=this.node.getProps();return{onSessionStart:a9(e),onStart:a9(i),onMove:r,onEnd:(s,a)=>{delete this.session,n&&Jr.postRender(()=>n(s,a))}}}mount(){this.removePointerDownListener=rA(this.node.current,"pointerdown",e=>this.onPointerDown(e))}update(){this.session&&this.session.updateHandlers(this.createPanHandlers())}unmount(){this.removePointerDownListener(),this.session&&this.session.end()}}const HR={hasAnimatedSinceResize:!0,hasEverUpdated:!1};function o9(t,e){return e.max===e.min?0:t/(e.max-e.min)*100}const kS={correct:(t,e)=>{if(!e.target)return t;if(typeof t=="string")if(Wi.test(t))t=parseFloat(t);else return t;const i=o9(t,e.target.x),r=o9(t,e.target.y);return`${i}% ${r}%`}},jxe={correct:(t,{treeScale:e,projectionDelta:i})=>{const r=t,n=$g.parse(t);if(n.length>5)return r;const s=$g.createTransformer(t),a=typeof n[0]!="number"?1:0,o=i.x.scale*e.x,l=i.y.scale*e.y;n[0+a]/=o,n[1+a]/=l;const c=Xn(o,l,.5);return typeof n[2+a]=="number"&&(n[2+a]/=c),typeof n[3+a]=="number"&&(n[3+a]/=c),s(n)}};let Ak=!1;class Vxe extends J.Component{componentDidMount(){const{visualElement:e,layoutGroup:i,switchLayoutGroup:r,layoutId:n}=this.props,{projection:s}=e;u0e(Hxe),s&&(i.group&&i.group.add(s),r&&r.register&&n&&r.register(s),Ak&&s.root.didUpdate(),s.addEventListener("animationComplete",()=>{this.safeToRemove()}),s.setOptions({...s.options,onExitComplete:()=>this.safeToRemove()})),HR.hasEverUpdated=!0}getSnapshotBeforeUpdate(e){const{layoutDependency:i,visualElement:r,drag:n,isPresent:s}=this.props,{projection:a}=r;return a&&(a.isPresent=s,Ak=!0,n||e.layoutDependency!==i||i===void 0||e.isPresent!==s?a.willUpdate():this.safeToRemove(),e.isPresent!==s&&(s?a.promote():a.relegate()||Jr.postRender(()=>{const o=a.getStack();(!o||!o.members.length)&&this.safeToRemove()}))),null}componentDidUpdate(){const{projection:e}=this.props.visualElement;e&&(e.root.didUpdate(),qV.postRender(()=>{!e.currentAnimation&&e.isLead()&&this.safeToRemove()}))}componentWillUnmount(){const{visualElement:e,layoutGroup:i,switchLayoutGroup:r}=this.props,{projection:n}=e;Ak=!0,n&&(n.scheduleCheckAfterUnmount(),i&&i.group&&i.group.remove(n),r&&r.deregister&&r.deregister(n))}safeToRemove(){const{safeToRemove:e}=this.props;e&&e()}render(){return null}}function Lne(t){const[e,i]=ine(),r=J.useContext(SV);return O.jsx(Vxe,{...t,layoutGroup:r,switchLayoutGroup:J.useContext(pne),isPresent:e,safeToRemove:i})}const Hxe={borderRadius:{...kS,applyTo:["borderTopLeftRadius","borderTopRightRadius","borderBottomLeftRadius","borderBottomRightRadius"]},borderTopLeftRadius:kS,borderTopRightRadius:kS,borderBottomLeftRadius:kS,borderBottomRightRadius:kS,boxShadow:jxe};function Gxe(t,e,i){const r=Wa(t)?t:yh(t);return r.start(r6("",r,e,i)),r.animation}const Wxe=(t,e)=>t.depth-e.depth;class qxe{constructor(){this.children=[],this.isDirty=!1}add(e){AV(this.children,e),this.isDirty=!0}remove(e){MV(this.children,e),this.isDirty=!0}forEach(e){this.isDirty&&this.children.sort(Wxe),this.isDirty=!1,this.children.forEach(e)}}function Xxe(t,e){const i=Jl.now(),r=({timestamp:n})=>{const s=n-i;s>=e&&(Ah(r),t(s-e))};return Jr.setup(r,!0),()=>Ah(r)}const kne=["TopLeft","TopRight","BottomLeft","BottomRight"],$xe=kne.length,l9=t=>typeof t=="string"?parseFloat(t):t,c9=t=>typeof t=="number"||Wi.test(t);function Yxe(t,e,i,r,n,s){n?(t.opacity=Xn(0,i.opacity??1,Kxe(r)),t.opacityExit=Xn(e.opacity??1,0,Zxe(r))):s&&(t.opacity=Xn(e.opacity??1,i.opacity??1,r));for(let a=0;a<$xe;a++){const o=`border${kne[a]}Radius`;let l=u9(e,o),c=u9(i,o);if(l===void 0&&c===void 0)continue;l||(l=0),c||(c=0),l===0||c===0||c9(l)===c9(c)?(t[o]=Math.max(Xn(l9(l),l9(c),r),0),(Fd.test(c)||Fd.test(l))&&(t[o]+="%")):t[o]=c}(e.rotate||i.rotate)&&(t.rotate=Xn(e.rotate||0,i.rotate||0,r))}function u9(t,e){return t[e]!==void 0?t[e]:t.borderRadius}const Kxe=Nne(0,.5,bre),Zxe=Nne(.5,.95,nc);function Nne(t,e,i){return r=>r<t?0:r>e?1:i(v1(t,e,r))}function h9(t,e){t.min=e.min,t.max=e.max}function Kc(t,e){h9(t.x,e.x),h9(t.y,e.y)}function d9(t,e){t.translate=e.translate,t.scale=e.scale,t.originPoint=e.originPoint,t.origin=e.origin}function f9(t,e,i,r,n){return t-=e,t=_I(t,1/i,r),n!==void 0&&(t=_I(t,1/n,r)),t}function Qxe(t,e=0,i=1,r=.5,n,s=t,a=t){if(Fd.test(e)&&(e=parseFloat(e),e=Xn(a.min,a.max,e/100)-a.min),typeof e!="number")return;let o=Xn(s.min,s.max,r);t===s&&(o-=e),t.min=f9(t.min,e,i,o,n),t.max=f9(t.max,e,i,o,n)}function p9(t,e,[i,r,n],s,a){Qxe(t,e[i],e[r],e[n],e.scale,s,a)}const Jxe=["x","scaleX","originX"],ebe=["y","scaleY","originY"];function m9(t,e,i,r){p9(t.x,e,Jxe,i?i.x:void 0,r?r.x:void 0),p9(t.y,e,ebe,i?i.y:void 0,r?r.y:void 0)}function g9(t){return t.translate===0&&t.scale===1}function Une(t){return g9(t.x)&&g9(t.y)}function v9(t,e){return t.min===e.min&&t.max===e.max}function tbe(t,e){return v9(t.x,e.x)&&v9(t.y,e.y)}function y9(t,e){return Math.round(t.min)===Math.round(e.min)&&Math.round(t.max)===Math.round(e.max)}function Bne(t,e){return y9(t.x,e.x)&&y9(t.y,e.y)}function x9(t){return vl(t.x)/vl(t.y)}function b9(t,e){return t.translate===e.translate&&t.scale===e.scale&&t.originPoint===e.originPoint}class ibe{constructor(){this.members=[]}add(e){AV(this.members,e),e.scheduleRender()}remove(e){if(MV(this.members,e),e===this.prevLead&&(this.prevLead=void 0),e===this.lead){const i=this.members[this.members.length-1];i&&this.promote(i)}}relegate(e){const i=this.members.findIndex(n=>e===n);if(i===0)return!1;let r;for(let n=i;n>=0;n--){const s=this.members[n];if(s.isPresent!==!1){r=s;break}}return r?(this.promote(r),!0):!1}promote(e,i){const r=this.lead;if(e!==r&&(this.prevLead=r,this.lead=e,e.show(),r)){r.instance&&r.scheduleRender(),e.scheduleRender(),e.resumeFrom=r,i&&(e.resumeFrom.preserveOpacity=!0),r.snapshot&&(e.snapshot=r.snapshot,e.snapshot.latestValues=r.animationValues||r.latestValues),e.root&&e.root.isUpdating&&(e.isLayoutDirty=!0);const{crossfade:n}=e.options;n===!1&&r.hide()}}exitAnimationComplete(){this.members.forEach(e=>{const{options:i,resumingFrom:r}=e;i.onExitComplete&&i.onExitComplete(),r&&r.options.onExitComplete&&r.options.onExitComplete()})}scheduleRender(){this.members.forEach(e=>{e.instance&&e.scheduleRender(!1)})}removeLeadSnapshot(){this.lead&&this.lead.snapshot&&(this.lead.snapshot=void 0)}}function rbe(t,e,i){let r="";const n=t.x.translate/e.x,s=t.y.translate/e.y,a=i?.z||0;if((n||s||a)&&(r=`translate3d(${n}px, ${s}px, ${a}px) `),(e.x!==1||e.y!==1)&&(r+=`scale(${1/e.x}, ${1/e.y}) `),i){const{transformPerspective:c,rotate:u,rotateX:h,rotateY:d,skewX:f,skewY:p}=i;c&&(r=`perspective(${c}px) ${r}`),u&&(r+=`rotate(${u}deg) `),h&&(r+=`rotateX(${h}deg) `),d&&(r+=`rotateY(${d}deg) `),f&&(r+=`skewX(${f}deg) `),p&&(r+=`skewY(${p}deg) `)}const o=t.x.scale*e.x,l=t.y.scale*e.y;return(o!==1||l!==1)&&(r+=`scale(${o}, ${l})`),r||"none"}const Mk=["","X","Y","Z"],nbe=1e3;let sbe=0;function Tk(t,e,i,r){const{latestValues:n}=e;n[t]&&(i[t]=n[t],e.setStaticValue(t,0),r&&(r[t]=0))}function Fne(t){if(t.hasCheckedOptimisedAppear=!0,t.root===t)return;const{visualElement:e}=t.options;if(!e)return;const i=Ene(e);if(window.MotionHasOptimisedAnimation(i,"transform")){const{layout:n,layoutId:s}=t.options;window.MotionCancelOptimisedAnimation(i,"transform",Jr,!(n||s))}const{parent:r}=t;r&&!r.hasCheckedOptimisedAppear&&Fne(r)}function zne({attachResizeListener:t,defaultParent:e,measureScroll:i,checkIsScrollRoot:r,resetTransform:n}){return class{constructor(a={},o=e?.()){this.id=sbe++,this.animationId=0,this.animationCommitId=0,this.children=new Set,this.options={},this.isTreeAnimating=!1,this.isAnimationBlocked=!1,this.isLayoutDirty=!1,this.isProjectionDirty=!1,this.isSharedProjectionDirty=!1,this.isTransformDirty=!1,this.updateManuallyBlocked=!1,this.updateBlockedByResize=!1,this.isUpdating=!1,this.isSVG=!1,this.needsReset=!1,this.shouldResetTransform=!1,this.hasCheckedOptimisedAppear=!1,this.treeScale={x:1,y:1},this.eventHandlers=new Map,this.hasTreeAnimated=!1,this.updateScheduled=!1,this.scheduleUpdate=()=>this.update(),this.projectionUpdateScheduled=!1,this.checkUpdateFailed=()=>{this.isUpdating&&(this.isUpdating=!1,this.clearAllSnapshots())},this.updateProjection=()=>{this.projectionUpdateScheduled=!1,this.nodes.forEach(lbe),this.nodes.forEach(dbe),this.nodes.forEach(fbe),this.nodes.forEach(cbe)},this.resolvedRelativeTargetAt=0,this.hasProjected=!1,this.isVisible=!0,this.animationProgress=0,this.sharedNodes=new Map,this.latestValues=a,this.root=o?o.root||o:this,this.path=o?[...o.path,o]:[],this.parent=o,this.depth=o?o.depth+1:0;for(let l=0;l<this.path.length;l++)this.path[l].shouldResetTransform=!0;this.root===this&&(this.nodes=new qxe)}addEventListener(a,o){return this.eventHandlers.has(a)||this.eventHandlers.set(a,new CV),this.eventHandlers.get(a).add(o)}notifyListeners(a,...o){const l=this.eventHandlers.get(a);l&&l.notify(...o)}hasListeners(a){return this.eventHandlers.has(a)}mount(a){if(this.instance)return;this.isSVG=$V(a)&&!Xye(a),this.instance=a;const{layoutId:o,layout:l,visualElement:c}=this.options;if(c&&!c.current&&c.mount(a),this.root.nodes.add(this),this.parent&&this.parent.children.add(this),this.root.hasTreeAnimated&&(l||o)&&(this.isLayoutDirty=!0),t){let u,h=0;const d=()=>this.root.updateBlockedByResize=!1;Jr.read(()=>{h=window.innerWidth}),t(a,()=>{const f=window.innerWidth;f!==h&&(h=f,this.root.updateBlockedByResize=!0,u&&u(),u=Xxe(d,250),HR.hasAnimatedSinceResize&&(HR.hasAnimatedSinceResize=!1,this.nodes.forEach(S9)))})}o&&this.root.registerSharedNode(o,this),this.options.animate!==!1&&c&&(o||l)&&this.addEventListener("didUpdate",({delta:u,hasLayoutChanged:h,hasRelativeLayoutChanged:d,layout:f})=>{if(this.isTreeAnimationBlocked()){this.target=void 0,this.relativeTarget=void 0;return}const p=this.options.transition||c.getDefaultTransition()||ybe,{onLayoutAnimationStart:g,onLayoutAnimationComplete:m}=c.getProps(),y=!this.targetLayout||!Bne(this.targetLayout,f),b=!h&&d;if(this.options.layoutRoot||this.resumeFrom||b||h&&(y||!this.currentAnimation)){this.resumeFrom&&(this.resumingFrom=this.resumeFrom,this.resumingFrom.resumingFrom=void 0);const w={...VV(p,"layout"),onPlay:g,onComplete:m};(c.shouldReduceMotion||this.options.layoutRoot)&&(w.delay=0,w.type=!1),this.startAnimation(w),this.setAnimationOrigin(u,b)}else h||S9(this),this.isLead()&&this.options.onExitComplete&&this.options.onExitComplete();this.targetLayout=f})}unmount(){this.options.layoutId&&this.willUpdate(),this.root.nodes.remove(this);const a=this.getStack();a&&a.remove(this),this.parent&&this.parent.children.delete(this),this.instance=void 0,this.eventHandlers.clear(),Ah(this.updateProjection)}blockUpdate(){this.updateManuallyBlocked=!0}unblockUpdate(){this.updateManuallyBlocked=!1}isUpdateBlocked(){return this.updateManuallyBlocked||this.updateBlockedByResize}isTreeAnimationBlocked(){return this.isAnimationBlocked||this.parent&&this.parent.isTreeAnimationBlocked()||!1}startUpdate(){this.isUpdateBlocked()||(this.isUpdating=!0,this.nodes&&this.nodes.forEach(pbe),this.animationId++)}getTransformTemplate(){const{visualElement:a}=this.options;return a&&a.getProps().transformTemplate}willUpdate(a=!0){if(this.root.hasTreeAnimated=!0,this.root.isUpdateBlocked()){this.options.onExitComplete&&this.options.onExitComplete();return}if(window.MotionCancelOptimisedAnimation&&!this.hasCheckedOptimisedAppear&&Fne(this),!this.root.isUpdating&&this.root.startUpdate(),this.isLayoutDirty)return;this.isLayoutDirty=!0;for(let u=0;u<this.path.length;u++){const h=this.path[u];h.shouldResetTransform=!0,h.updateScroll("snapshot"),h.options.layoutRoot&&h.willUpdate(!1)}const{layoutId:o,layout:l}=this.options;if(o===void 0&&!l)return;const c=this.getTransformTemplate();this.prevTransformTemplateValue=c?c(this.latestValues,""):void 0,this.updateSnapshot(),a&&this.notifyListeners("willUpdate")}update(){if(this.updateScheduled=!1,this.isUpdateBlocked()){this.unblockUpdate(),this.clearAllSnapshots(),this.nodes.forEach(w9);return}if(this.animationId<=this.animationCommitId){this.nodes.forEach(_9);return}this.animationCommitId=this.animationId,this.isUpdating?(this.isUpdating=!1,this.nodes.forEach(hbe),this.nodes.forEach(abe),this.nodes.forEach(obe)):this.nodes.forEach(_9),this.clearAllSnapshots();const o=Jl.now();Ua.delta=$d(0,1e3/60,o-Ua.timestamp),Ua.timestamp=o,Ua.isProcessing=!0,mk.update.process(Ua),mk.preRender.process(Ua),mk.render.process(Ua),Ua.isProcessing=!1}didUpdate(){this.updateScheduled||(this.updateScheduled=!0,qV.read(this.scheduleUpdate))}clearAllSnapshots(){this.nodes.forEach(ube),this.sharedNodes.forEach(mbe)}scheduleUpdateProjection(){this.projectionUpdateScheduled||(this.projectionUpdateScheduled=!0,Jr.preRender(this.updateProjection,!1,!0))}scheduleCheckAfterUnmount(){Jr.postRender(()=>{this.isLayoutDirty?this.root.didUpdate():this.root.checkUpdateFailed()})}updateSnapshot(){this.snapshot||!this.instance||(this.snapshot=this.measure(),this.snapshot&&!vl(this.snapshot.measuredBox.x)&&!vl(this.snapshot.measuredBox.y)&&(this.snapshot=void 0))}updateLayout(){if(!this.instance||(this.updateScroll(),!(this.options.alwaysMeasureLayout&&this.isLead())&&!this.isLayoutDirty))return;if(this.resumeFrom&&!this.resumeFrom.instance)for(let l=0;l<this.path.length;l++)this.path[l].updateScroll();const a=this.layout;this.layout=this.measure(!1),this.layoutCorrected=ys(),this.isLayoutDirty=!1,this.projectionDelta=void 0,this.notifyListeners("measure",this.layout.layoutBox);const{visualElement:o}=this.options;o&&o.notify("LayoutMeasure",this.layout.layoutBox,a?a.layoutBox:void 0)}updateScroll(a="measure"){let o=!!(this.options.layoutScroll&&this.instance);if(this.scroll&&this.scroll.animationId===this.root.animationId&&this.scroll.phase===a&&(o=!1),o&&this.instance){const l=r(this.instance);this.scroll={animationId:this.root.animationId,phase:a,isRoot:l,offset:i(this.instance),wasRoot:this.scroll?this.scroll.isRoot:l}}}resetTransform(){if(!n)return;const a=this.isLayoutDirty||this.shouldResetTransform||this.options.alwaysMeasureLayout,o=this.projectionDelta&&!Une(this.projectionDelta),l=this.getTransformTemplate(),c=l?l(this.latestValues,""):void 0,u=c!==this.prevTransformTemplateValue;a&&this.instance&&(o||Dy(this.latestValues)||u)&&(n(this.instance,c),this.shouldResetTransform=!1,this.scheduleRender())}measure(a=!0){const o=this.measurePageBox();let l=this.removeElementScroll(o);return a&&(l=this.removeTransform(l)),xbe(l),{animationId:this.root.animationId,measuredBox:o,layoutBox:l,latestValues:{},source:this.id}}measurePageBox(){const{visualElement:a}=this.options;if(!a)return ys();const o=a.measureViewportBox();if(!(this.scroll?.wasRoot||this.path.some(bbe))){const{scroll:c}=this.root;c&&(Nw(o.x,c.offset.x),Nw(o.y,c.offset.y))}return o}removeElementScroll(a){const o=ys();if(Kc(o,a),this.scroll?.wasRoot)return o;for(let l=0;l<this.path.length;l++){const c=this.path[l],{scroll:u,options:h}=c;c!==this.root&&u&&h.layoutScroll&&(u.wasRoot&&Kc(o,a),Nw(o.x,u.offset.x),Nw(o.y,u.offset.y))}return o}applyTransform(a,o=!1){const l=ys();Kc(l,a);for(let c=0;c<this.path.length;c++){const u=this.path[c];!o&&u.options.layoutScroll&&u.scroll&&u!==u.root&&Uw(l,{x:-u.scroll.offset.x,y:-u.scroll.offset.y}),Dy(u.latestValues)&&Uw(l,u.latestValues)}return Dy(this.latestValues)&&Uw(l,this.latestValues),l}removeTransform(a){const o=ys();Kc(o,a);for(let l=0;l<this.path.length;l++){const c=this.path[l];if(!c.instance||!Dy(c.latestValues))continue;X4(c.latestValues)&&c.updateSnapshot();const u=ys(),h=c.measurePageBox();Kc(u,h),m9(o,c.latestValues,c.snapshot?c.snapshot.layoutBox:void 0,u)}return Dy(this.latestValues)&&m9(o,this.latestValues),o}setTargetDelta(a){this.targetDelta=a,this.root.scheduleUpdateProjection(),this.isProjectionDirty=!0}setOptions(a){this.options={...this.options,...a,crossfade:a.crossfade!==void 0?a.crossfade:!0}}clearMeasurements(){this.scroll=void 0,this.layout=void 0,this.snapshot=void 0,this.prevTransformTemplateValue=void 0,this.targetDelta=void 0,this.target=void 0,this.isLayoutDirty=!1}forceRelativeParentToResolveTarget(){this.relativeParent&&this.relativeParent.resolvedRelativeTargetAt!==Ua.timestamp&&this.relativeParent.resolveTargetDelta(!0)}resolveTargetDelta(a=!1){const o=this.getLead();this.isProjectionDirty||(this.isProjectionDirty=o.isProjectionDirty),this.isTransformDirty||(this.isTransformDirty=o.isTransformDirty),this.isSharedProjectionDirty||(this.isSharedProjectionDirty=o.isSharedProjectionDirty);const l=!!this.resumingFrom||this!==o;if(!(a||l&&this.isSharedProjectionDirty||this.isProjectionDirty||this.parent?.isProjectionDirty||this.attemptToResolveRelativeTarget||this.root.updateBlockedByResize))return;const{layout:u,layoutId:h}=this.options;if(!(!this.layout||!(u||h))){if(this.resolvedRelativeTargetAt=Ua.timestamp,!this.targetDelta&&!this.relativeTarget){const d=this.getClosestProjectingParent();d&&d.layout&&this.animationProgress!==1?(this.relativeParent=d,this.forceRelativeParentToResolveTarget(),this.relativeTarget=ys(),this.relativeTargetOrigin=ys(),sA(this.relativeTargetOrigin,this.layout.layoutBox,d.layout.layoutBox),Kc(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}if(!(!this.relativeTarget&&!this.targetDelta)&&(this.target||(this.target=ys(),this.targetWithTransforms=ys()),this.relativeTarget&&this.relativeTargetOrigin&&this.relativeParent&&this.relativeParent.target?(this.forceRelativeParentToResolveTarget(),Mxe(this.target,this.relativeTarget,this.relativeParent.target)):this.targetDelta?(this.resumingFrom?this.target=this.applyTransform(this.layout.layoutBox):Kc(this.target,this.layout.layoutBox),yne(this.target,this.targetDelta)):Kc(this.target,this.layout.layoutBox),this.attemptToResolveRelativeTarget)){this.attemptToResolveRelativeTarget=!1;const d=this.getClosestProjectingParent();d&&!!d.resumingFrom==!!this.resumingFrom&&!d.options.layoutScroll&&d.target&&this.animationProgress!==1?(this.relativeParent=d,this.forceRelativeParentToResolveTarget(),this.relativeTarget=ys(),this.relativeTargetOrigin=ys(),sA(this.relativeTargetOrigin,this.target,d.target),Kc(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}}}getClosestProjectingParent(){if(!(!this.parent||X4(this.parent.latestValues)||vne(this.parent.latestValues)))return this.parent.isProjecting()?this.parent:this.parent.getClosestProjectingParent()}isProjecting(){return!!((this.relativeTarget||this.targetDelta||this.options.layoutRoot)&&this.layout)}calcProjection(){const a=this.getLead(),o=!!this.resumingFrom||this!==a;let l=!0;if((this.isProjectionDirty||this.parent?.isProjectionDirty)&&(l=!1),o&&(this.isSharedProjectionDirty||this.isTransformDirty)&&(l=!1),this.resolvedRelativeTargetAt===Ua.timestamp&&(l=!1),l)return;const{layout:c,layoutId:u}=this.options;if(this.isTreeAnimating=!!(this.parent&&this.parent.isTreeAnimating||this.currentAnimation||this.pendingAnimation),this.isTreeAnimating||(this.targetDelta=this.relativeTarget=void 0),!this.layout||!(c||u))return;Kc(this.layoutCorrected,this.layout.layoutBox);const h=this.treeScale.x,d=this.treeScale.y;B0e(this.layoutCorrected,this.treeScale,this.path,o),a.layout&&!a.target&&(this.treeScale.x!==1||this.treeScale.y!==1)&&(a.target=a.layout.layoutBox,a.targetWithTransforms=ys());const{target:f}=a;if(!f){this.prevProjectionDelta&&(this.createProjectionDeltas(),this.scheduleRender());return}!this.projectionDelta||!this.prevProjectionDelta?this.createProjectionDeltas():(d9(this.prevProjectionDelta.x,this.projectionDelta.x),d9(this.prevProjectionDelta.y,this.projectionDelta.y)),nA(this.projectionDelta,this.layoutCorrected,f,this.latestValues),(this.treeScale.x!==h||this.treeScale.y!==d||!b9(this.projectionDelta.x,this.prevProjectionDelta.x)||!b9(this.projectionDelta.y,this.prevProjectionDelta.y))&&(this.hasProjected=!0,this.scheduleRender(),this.notifyListeners("projectionUpdate",f))}hide(){this.isVisible=!1}show(){this.isVisible=!0}scheduleRender(a=!0){if(this.options.visualElement?.scheduleRender(),a){const o=this.getStack();o&&o.scheduleRender()}this.resumingFrom&&!this.resumingFrom.instance&&(this.resumingFrom=void 0)}createProjectionDeltas(){this.prevProjectionDelta=Bw(),this.projectionDelta=Bw(),this.projectionDeltaWithTransform=Bw()}setAnimationOrigin(a,o=!1){const l=this.snapshot,c=l?l.latestValues:{},u={...this.latestValues},h=Bw();(!this.relativeParent||!this.relativeParent.options.layoutRoot)&&(this.relativeTarget=this.relativeTargetOrigin=void 0),this.attemptToResolveRelativeTarget=!o;const d=ys(),f=l?l.source:void 0,p=this.layout?this.layout.source:void 0,g=f!==p,m=this.getStack(),y=!m||m.members.length<=1,b=!!(g&&!y&&this.options.crossfade===!0&&!this.path.some(vbe));this.animationProgress=0;let w;this.mixTargetDelta=E=>{const M=E/1e3;E9(h.x,a.x,M),E9(h.y,a.y,M),this.setTargetDelta(h),this.relativeTarget&&this.relativeTargetOrigin&&this.layout&&this.relativeParent&&this.relativeParent.layout&&(sA(d,this.layout.layoutBox,this.relativeParent.layout.layoutBox),gbe(this.relativeTarget,this.relativeTargetOrigin,d,M),w&&tbe(this.relativeTarget,w)&&(this.isProjectionDirty=!1),w||(w=ys()),Kc(w,this.relativeTarget)),g&&(this.animationValues=u,Yxe(u,c,this.latestValues,M,b,y)),this.root.scheduleUpdateProjection(),this.scheduleRender(),this.animationProgress=M},this.mixTargetDelta(this.options.layoutRoot?1e3:0)}startAnimation(a){this.notifyListeners("animationStart"),this.currentAnimation?.stop(),this.resumingFrom?.currentAnimation?.stop(),this.pendingAnimation&&(Ah(this.pendingAnimation),this.pendingAnimation=void 0),this.pendingAnimation=Jr.update(()=>{HR.hasAnimatedSinceResize=!0,this.motionValue||(this.motionValue=yh(0)),this.currentAnimation=Gxe(this.motionValue,[0,1e3],{...a,velocity:0,isSync:!0,onUpdate:o=>{this.mixTargetDelta(o),a.onUpdate&&a.onUpdate(o)},onStop:()=>{},onComplete:()=>{a.onComplete&&a.onComplete(),this.completeAnimation()}}),this.resumingFrom&&(this.resumingFrom.currentAnimation=this.currentAnimation),this.pendingAnimation=void 0})}completeAnimation(){this.resumingFrom&&(this.resumingFrom.currentAnimation=void 0,this.resumingFrom.preserveOpacity=void 0);const a=this.getStack();a&&a.exitAnimationComplete(),this.resumingFrom=this.currentAnimation=this.animationValues=void 0,this.notifyListeners("animationComplete")}finishAnimation(){this.currentAnimation&&(this.mixTargetDelta&&this.mixTargetDelta(nbe),this.currentAnimation.stop()),this.completeAnimation()}applyTransformsToTarget(){const a=this.getLead();let{targetWithTransforms:o,target:l,layout:c,latestValues:u}=a;if(!(!o||!l||!c)){if(this!==a&&this.layout&&c&&jne(this.options.animationType,this.layout.layoutBox,c.layoutBox)){l=this.target||ys();const h=vl(this.layout.layoutBox.x);l.x.min=a.target.x.min,l.x.max=l.x.min+h;const d=vl(this.layout.layoutBox.y);l.y.min=a.target.y.min,l.y.max=l.y.min+d}Kc(o,l),Uw(o,u),nA(this.projectionDeltaWithTransform,this.layoutCorrected,o,u)}}registerSharedNode(a,o){this.sharedNodes.has(a)||this.sharedNodes.set(a,new ibe),this.sharedNodes.get(a).add(o);const c=o.options.initialPromotionConfig;o.promote({transition:c?c.transition:void 0,preserveFollowOpacity:c&&c.shouldPreserveFollowOpacity?c.shouldPreserveFollowOpacity(o):void 0})}isLead(){const a=this.getStack();return a?a.lead===this:!0}getLead(){const{layoutId:a}=this.options;return a?this.getStack()?.lead||this:this}getPrevLead(){const{layoutId:a}=this.options;return a?this.getStack()?.prevLead:void 0}getStack(){const{layoutId:a}=this.options;if(a)return this.root.sharedNodes.get(a)}promote({needsReset:a,transition:o,preserveFollowOpacity:l}={}){const c=this.getStack();c&&c.promote(this,l),a&&(this.projectionDelta=void 0,this.needsReset=!0),o&&this.setOptions({transition:o})}relegate(){const a=this.getStack();return a?a.relegate(this):!1}resetSkewAndRotation(){const{visualElement:a}=this.options;if(!a)return;let o=!1;const{latestValues:l}=a;if((l.z||l.rotate||l.rotateX||l.rotateY||l.rotateZ||l.skewX||l.skewY)&&(o=!0),!o)return;const c={};l.z&&Tk("z",a,c,this.animationValues);for(let u=0;u<Mk.length;u++)Tk(`rotate${Mk[u]}`,a,c,this.animationValues),Tk(`skew${Mk[u]}`,a,c,this.animationValues);a.render();for(const u in c)a.setStaticValue(u,c[u]),this.animationValues&&(this.animationValues[u]=c[u]);a.scheduleRender()}applyProjectionStyles(a,o){if(!this.instance||this.isSVG)return;if(!this.isVisible){a.visibility="hidden";return}const l=this.getTransformTemplate();if(this.needsReset){this.needsReset=!1,a.visibility="",a.opacity="",a.pointerEvents=VR(o?.pointerEvents)||"",a.transform=l?l(this.latestValues,""):"none";return}const c=this.getLead();if(!this.projectionDelta||!this.layout||!c.target){this.options.layoutId&&(a.opacity=this.latestValues.opacity!==void 0?this.latestValues.opacity:1,a.pointerEvents=VR(o?.pointerEvents)||""),this.hasProjected&&!Dy(this.latestValues)&&(a.transform=l?l({},""):"none",this.hasProjected=!1);return}a.visibility="";const u=c.animationValues||c.latestValues;this.applyTransformsToTarget();let h=rbe(this.projectionDeltaWithTransform,this.treeScale,u);l&&(h=l(u,h)),a.transform=h;const{x:d,y:f}=this.projectionDelta;a.transformOrigin=`${d.origin*100}% ${f.origin*100}% 0`,c.animationValues?a.opacity=c===this?u.opacity??this.latestValues.opacity??1:this.preserveOpacity?this.latestValues.opacity:u.opacityExit:a.opacity=c===this?u.opacity!==void 0?u.opacity:"":u.opacityExit!==void 0?u.opacityExit:0;for(const p in qA){if(u[p]===void 0)continue;const{correct:g,applyTo:m,isCSSVariable:y}=qA[p],b=h==="none"?u[p]:g(u[p],c);if(m){const w=m.length;for(let E=0;E<w;E++)a[m[E]]=b}else y?this.options.visualElement.renderState.vars[p]=b:a[p]=b}this.options.layoutId&&(a.pointerEvents=c===this?VR(o?.pointerEvents)||"":"none")}clearSnapshot(){this.resumeFrom=this.snapshot=void 0}resetTree(){this.root.nodes.forEach(a=>a.currentAnimation?.stop()),this.root.nodes.forEach(w9),this.root.sharedNodes.clear()}}}function abe(t){t.updateLayout()}function obe(t){const e=t.resumeFrom?.snapshot||t.snapshot;if(t.isLead()&&t.layout&&e&&t.hasListeners("didUpdate")){const{layoutBox:i,measuredBox:r}=t.layout,{animationType:n}=t.options,s=e.source!==t.layout.source;n==="size"?ou(u=>{const h=s?e.measuredBox[u]:e.layoutBox[u],d=vl(h);h.min=i[u].min,h.max=h.min+d}):jne(n,e.layoutBox,i)&&ou(u=>{const h=s?e.measuredBox[u]:e.layoutBox[u],d=vl(i[u]);h.max=h.min+d,t.relativeTarget&&!t.currentAnimation&&(t.isProjectionDirty=!0,t.relativeTarget[u].max=t.relativeTarget[u].min+d)});const a=Bw();nA(a,i,e.layoutBox);const o=Bw();s?nA(o,t.applyTransform(r,!0),e.measuredBox):nA(o,i,e.layoutBox);const l=!Une(a);let c=!1;if(!t.resumeFrom){const u=t.getClosestProjectingParent();if(u&&!u.resumeFrom){const{snapshot:h,layout:d}=u;if(h&&d){const f=ys();sA(f,e.layoutBox,h.layoutBox);const p=ys();sA(p,i,d.layoutBox),Bne(f,p)||(c=!0),u.options.layoutRoot&&(t.relativeTarget=p,t.relativeTargetOrigin=f,t.relativeParent=u)}}}t.notifyListeners("didUpdate",{layout:i,snapshot:e,delta:o,layoutDelta:a,hasLayoutChanged:l,hasRelativeLayoutChanged:c})}else if(t.isLead()){const{onExitComplete:i}=t.options;i&&i()}t.options.transition=void 0}function lbe(t){t.parent&&(t.isProjecting()||(t.isProjectionDirty=t.parent.isProjectionDirty),t.isSharedProjectionDirty||(t.isSharedProjectionDirty=!!(t.isProjectionDirty||t.parent.isProjectionDirty||t.parent.isSharedProjectionDirty)),t.isTransformDirty||(t.isTransformDirty=t.parent.isTransformDirty))}function cbe(t){t.isProjectionDirty=t.isSharedProjectionDirty=t.isTransformDirty=!1}function ube(t){t.clearSnapshot()}function w9(t){t.clearMeasurements()}function _9(t){t.isLayoutDirty=!1}function hbe(t){const{visualElement:e}=t.options;e&&e.getProps().onBeforeLayoutMeasure&&e.notify("BeforeLayoutMeasure"),t.resetTransform()}function S9(t){t.finishAnimation(),t.targetDelta=t.relativeTarget=t.target=void 0,t.isProjectionDirty=!0}function dbe(t){t.resolveTargetDelta()}function fbe(t){t.calcProjection()}function pbe(t){t.resetSkewAndRotation()}function mbe(t){t.removeLeadSnapshot()}function E9(t,e,i){t.translate=Xn(e.translate,0,i),t.scale=Xn(e.scale,1,i),t.origin=e.origin,t.originPoint=e.originPoint}function A9(t,e,i,r){t.min=Xn(e.min,i.min,r),t.max=Xn(e.max,i.max,r)}function gbe(t,e,i,r){A9(t.x,e.x,i.x,r),A9(t.y,e.y,i.y,r)}function vbe(t){return t.animationValues&&t.animationValues.opacityExit!==void 0}const ybe={duration:.45,ease:[.4,0,.1,1]},M9=t=>typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().includes(t),T9=M9("applewebkit/")&&!M9("chrome/")?Math.round:nc;function C9(t){t.min=T9(t.min),t.max=T9(t.max)}function xbe(t){C9(t.x),C9(t.y)}function jne(t,e,i){return t==="position"||t==="preserve-aspect"&&!Axe(x9(e),x9(i),.2)}function bbe(t){return t!==t.root&&t.scroll?.wasRoot}const wbe=zne({attachResizeListener:(t,e)=>XA(t,"resize",e),measureScroll:()=>({x:document.documentElement.scrollLeft||document.body.scrollLeft,y:document.documentElement.scrollTop||document.body.scrollTop}),checkIsScrollRoot:()=>!0}),Ck={current:void 0},Vne=zne({measureScroll:t=>({x:t.scrollLeft,y:t.scrollTop}),defaultParent:()=>{if(!Ck.current){const t=new wbe({});t.mount(window),t.setOptions({layoutScroll:!0}),Ck.current=t}return Ck.current},resetTransform:(t,e)=>{t.style.transform=e!==void 0?e:"none"},checkIsScrollRoot:t=>window.getComputedStyle(t).position==="fixed"}),_be={pan:{Feature:zxe},drag:{Feature:Fxe,ProjectionNode:Vne,MeasureLayout:Lne}};function P9(t,e,i){const{props:r}=t;t.animationState&&r.whileHover&&t.animationState.setActive("whileHover",i==="Start");const n="onHover"+i,s=r[n];s&&Jr.postRender(()=>s(e,iT(e)))}class Sbe extends ov{mount(){const{current:e}=this.node;e&&(this.unmount=Oye(e,(i,r)=>(P9(this.node,r,"Start"),n=>P9(this.node,n,"End"))))}unmount(){}}class Ebe extends ov{constructor(){super(...arguments),this.isActive=!1}onFocus(){let e=!1;try{e=this.node.current.matches(":focus-visible")}catch{e=!0}!e||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!0),this.isActive=!0)}onBlur(){!this.isActive||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!1),this.isActive=!1)}mount(){this.unmount=QM(XA(this.node.current,"focus",()=>this.onFocus()),XA(this.node.current,"blur",()=>this.onBlur()))}unmount(){}}function R9(t,e,i){const{props:r}=t;if(t.current instanceof HTMLButtonElement&&t.current.disabled)return;t.animationState&&r.whileTap&&t.animationState.setActive("whileTap",i==="Start");const n="onTap"+(i==="End"?"":i),s=r[n];s&&Jr.postRender(()=>s(e,iT(e)))}class Abe extends ov{mount(){const{current:e}=this.node;e&&(this.unmount=Uye(e,(i,r)=>(R9(this.node,r,"Start"),(n,{success:s})=>R9(this.node,n,s?"End":"Cancel")),{useGlobalTarget:this.node.props.globalTapTarget}))}unmount(){}}const ez=new WeakMap,Pk=new WeakMap,Mbe=t=>{const e=ez.get(t.target);e&&e(t)},Tbe=t=>{t.forEach(Mbe)};function Cbe({root:t,...e}){const i=t||document;Pk.has(i)||Pk.set(i,{});const r=Pk.get(i),n=JSON.stringify(e);return r[n]||(r[n]=new IntersectionObserver(Tbe,{root:t,...e})),r[n]}function Pbe(t,e,i){const r=Cbe(e);return ez.set(t,i),r.observe(t),()=>{ez.delete(t),r.unobserve(t)}}const Rbe={some:0,all:1};class Ibe extends ov{constructor(){super(...arguments),this.hasEnteredView=!1,this.isInView=!1}startObserver(){this.unmount();const{viewport:e={}}=this.node.getProps(),{root:i,margin:r,amount:n="some",once:s}=e,a={root:i?i.current:void 0,rootMargin:r,threshold:typeof n=="number"?n:Rbe[n]},o=l=>{const{isIntersecting:c}=l;if(this.isInView===c||(this.isInView=c,s&&!c&&this.hasEnteredView))return;c&&(this.hasEnteredView=!0),this.node.animationState&&this.node.animationState.setActive("whileInView",c);const{onViewportEnter:u,onViewportLeave:h}=this.node.getProps(),d=c?u:h;d&&d(l)};return Pbe(this.node.current,a,o)}mount(){this.startObserver()}update(){if(typeof IntersectionObserver>"u")return;const{props:e,prevProps:i}=this.node;["amount","margin","root"].some(Dbe(e,i))&&this.startObserver()}unmount(){}}function Dbe({viewport:t={}},{viewport:e={}}={}){return i=>t[i]!==e[i]}const Obe={inView:{Feature:Ibe},tap:{Feature:Abe},focus:{Feature:Ebe},hover:{Feature:Sbe}},Lbe={layout:{ProjectionNode:Vne,MeasureLayout:Lne}},kbe={...xxe,...Obe,..._be,...Lbe},Rt=k0e(kbe,$0e),Nbe=50,I9=()=>({current:0,offset:[],progress:0,scrollLength:0,targetOffset:0,targetLength:0,containerLength:0,velocity:0}),Ube=()=>({time:0,x:I9(),y:I9()}),Bbe={x:{length:"Width",position:"Left"},y:{length:"Height",position:"Top"}};function D9(t,e,i,r){const n=i[e],{length:s,position:a}=Bbe[e],o=n.current,l=i.time;n.current=t[`scroll${a}`],n.scrollLength=t[`scroll${s}`]-t[`client${s}`],n.offset.length=0,n.offset[0]=0,n.offset[1]=n.scrollLength,n.progress=v1(0,n.scrollLength,n.current);const c=r-l;n.velocity=c>Nbe?0:PV(n.current-o,c)}function Fbe(t,e,i){D9(t,"x",e,i),D9(t,"y",e,i),e.time=i}function zbe(t,e){const i={x:0,y:0};let r=t;for(;r&&r!==e;)if(WV(r))i.x+=r.offsetLeft,i.y+=r.offsetTop,r=r.offsetParent;else if(r.tagName==="svg"){const n=r.getBoundingClientRect();r=r.parentElement;const s=r.getBoundingClientRect();i.x+=n.left-s.left,i.y+=n.top-s.top}else if(r instanceof SVGGraphicsElement){const{x:n,y:s}=r.getBBox();i.x+=n,i.y+=s;let a=null,o=r.parentNode;for(;!a;)o.tagName==="svg"&&(a=o),o=r.parentNode;r=a}else break;return i}const tz={start:0,center:.5,end:1};function O9(t,e,i=0){let r=0;if(t in tz&&(t=tz[t]),typeof t=="string"){const n=parseFloat(t);t.endsWith("px")?r=n:t.endsWith("%")?t=n/100:t.endsWith("vw")?r=n/100*document.documentElement.clientWidth:t.endsWith("vh")?r=n/100*document.documentElement.clientHeight:t=n}return typeof t=="number"&&(r=e*t),i+r}const jbe=[0,0];function Vbe(t,e,i,r){let n=Array.isArray(t)?t:jbe,s=0,a=0;return typeof t=="number"?n=[t,t]:typeof t=="string"&&(t=t.trim(),t.includes(" ")?n=t.split(" "):n=[t,tz[t]?t:"0"]),s=O9(n[0],i,r),a=O9(n[1],e),s-a}const Hbe={All:[[0,0],[1,1]]},Gbe={x:0,y:0};function Wbe(t){return"getBBox"in t&&t.tagName!=="svg"?t.getBBox():{width:t.clientWidth,height:t.clientHeight}}function qbe(t,e,i){const{offset:r=Hbe.All}=i,{target:n=t,axis:s="y"}=i,a=s==="y"?"height":"width",o=n!==t?zbe(n,t):Gbe,l=n===t?{width:t.scrollWidth,height:t.scrollHeight}:Wbe(n),c={width:t.clientWidth,height:t.clientHeight};e[s].offset.length=0;let u=!e[s].interpolate;const h=r.length;for(let d=0;d<h;d++){const f=Vbe(r[d],c[a],l[a],o[s]);!u&&f!==e[s].interpolatorOffsets[d]&&(u=!0),e[s].offset[d]=f}u&&(e[s].interpolate=BV(e[s].offset,kre(r),{clamp:!1}),e[s].interpolatorOffsets=[...e[s].offset]),e[s].progress=$d(0,1,e[s].interpolate(e[s].current))}function Xbe(t,e=t,i){if(i.x.targetOffset=0,i.y.targetOffset=0,e!==t){let r=e;for(;r&&r!==t;)i.x.targetOffset+=r.offsetLeft,i.y.targetOffset+=r.offsetTop,r=r.offsetParent}i.x.targetLength=e===t?e.scrollWidth:e.clientWidth,i.y.targetLength=e===t?e.scrollHeight:e.clientHeight,i.x.containerLength=t.clientWidth,i.y.containerLength=t.clientHeight}function $be(t,e,i,r={}){return{measure:n=>{Xbe(t,r.target,i),Fbe(t,i,n),(r.offset||r.target)&&qbe(t,i,r)},notify:()=>e(i)}}const NS=new WeakMap,L9=new WeakMap,Rk=new WeakMap,k9=t=>t===document.scrollingElement?window:t;function Hne(t,{container:e=document.scrollingElement,...i}={}){if(!e)return nc;let r=Rk.get(e);r||(r=new Set,Rk.set(e,r));const n=Ube(),s=$be(e,t,n,i);if(r.add(s),!NS.has(e)){const o=()=>{for(const h of r)h.measure(Ua.timestamp);Jr.preUpdate(l)},l=()=>{for(const h of r)h.notify()},c=()=>Jr.read(o);NS.set(e,c);const u=k9(e);window.addEventListener("resize",c,{passive:!0}),e!==document.documentElement&&L9.set(e,qye(e,c)),u.addEventListener("scroll",c,{passive:!0}),c()}const a=NS.get(e);return Jr.read(a,!1,!0),()=>{Ah(a);const o=Rk.get(e);if(!o||(o.delete(s),o.size))return;const l=NS.get(e);NS.delete(e),l&&(k9(e).removeEventListener("scroll",l),L9.get(e)?.(),window.removeEventListener("resize",l))}}const N9=new Map;function Ybe(t){const e={value:0},i=Hne(r=>{e.value=r[t.axis].progress*100},t);return{currentTime:e,cancel:i}}function Gne({source:t,container:e,...i}){const{axis:r}=i;t&&(e=t);const n=N9.get(e)??new Map;N9.set(e,n);const s=i.target??"self",a=n.get(s)??{},o=r+(i.offset??[]).join(",");return a[o]||(a[o]=!i.target&&Fre()?new ScrollTimeline({source:e,axis:r}):Ybe({container:e,...i})),a[o]}function Kbe(t,e){const i=Gne(e);return t.attachTimeline({timeline:e.target?void 0:i,observe:r=>(r.pause(),tne(n=>{r.time=r.iterationDuration*n},i))})}function Zbe(t){return t.length===2}function Qbe(t,e){return Zbe(t)?Hne(i=>{t(i[e.axis].progress,i)},e):tne(t,Gne(e))}function Jbe(t,{axis:e="y",container:i=document.scrollingElement,...r}={}){if(!i)return nc;const n={axis:e,container:i,...r};return typeof t=="function"?Qbe(t,n):Kbe(t,n)}const ewe=()=>({scrollX:yh(0),scrollY:yh(0),scrollXProgress:yh(0),scrollYProgress:yh(0)}),qC=t=>t?!t.current:!1;function twe({container:t,target:e,...i}={}){const r=i_(ewe),n=J.useRef(null),s=J.useRef(!1),a=J.useCallback(()=>(n.current=Jbe((o,{x:l,y:c})=>{r.scrollX.set(l.current),r.scrollXProgress.set(l.progress),r.scrollY.set(c.current),r.scrollYProgress.set(c.progress)},{...i,container:t?.current||void 0,target:e?.current||void 0}),()=>{n.current?.()}),[t,e,JSON.stringify(i.offset)]);return X3(()=>{if(s.current=!1,qC(t)||qC(e)){s.current=!0;return}else return a()},[a]),J.useEffect(()=>{if(s.current)return VA(!qC(t)),VA(!qC(e)),a()},[a]),r}function Wne(t){const e=i_(()=>yh(t)),{isStatic:i}=J.useContext(tT);if(i){const[,r]=J.useState(t);J.useEffect(()=>e.on("change",r),[])}return e}function qne(t,e){const i=Wne(e()),r=()=>i.set(e());return r(),X3(()=>{const n=()=>Jr.preRender(r,!1,!0),s=t.map(a=>a.on("change",n));return()=>{s.forEach(a=>a()),Ah(r)}}),i}function iwe(t){iA.current=[],t();const e=qne(iA.current,t);return iA.current=void 0,e}function rwe(t,e,i,r){if(typeof t=="function")return iwe(t);const n=$ye(e,i,r);return Array.isArray(t)?U9(t,n):U9([t],([s])=>n(s))}function U9(t,e){const i=i_(()=>[]);return qne(t,()=>{i.length=0;const r=t.length;for(let n=0;n<r;n++)i[n]=t[n].get();return e(i)})}function nwe(t,e={}){const{isStatic:i}=J.useContext(tT),r=()=>Wa(t)?t.get():t;if(i)return rwe(r);const n=Wne(r());return J.useInsertionEffect(()=>Yye(n,t,e),[n,JSON.stringify(e)]),n}const swe={some:0,all:1};function awe(t,e,{root:i,margin:r,amount:n="some"}={}){const s=GV(t),a=new WeakMap,o=c=>{c.forEach(u=>{const h=a.get(u.target);if(u.isIntersecting!==!!h)if(u.isIntersecting){const d=e(u.target,u);typeof d=="function"?a.set(u.target,d):l.unobserve(u.target)}else typeof h=="function"&&(h(u),a.delete(u.target))})},l=new IntersectionObserver(o,{root:i,rootMargin:r,threshold:typeof n=="number"?n:swe[n]});return s.forEach(c=>l.observe(c)),()=>l.disconnect()}function owe(t,{root:e,margin:i,amount:r,once:n=!1,initial:s=!1}={}){const[a,o]=J.useState(s);return J.useEffect(()=>{if(!t.current||n&&a)return;const l=()=>(o(!0),n?void 0:()=>o(!1)),c={root:e&&e.current||void 0,margin:i,amount:r};return awe(t.current,l,c)},[e,t,i,n,r]),a}function B9(t,e){if(typeof t=="function")return t(e);t!=null&&(t.current=e)}function Xne(...t){return e=>{let i=!1;const r=t.map(n=>{const s=B9(n,e);return!i&&typeof s=="function"&&(i=!0),s});if(i)return()=>{for(let n=0;n<r.length;n++){const s=r[n];typeof s=="function"?s():B9(t[n],null)}}}}function ga(...t){return J.useCallback(Xne(...t),t)}function $A(t){const e=lwe(t),i=J.forwardRef((r,n)=>{const{children:s,...a}=r,o=J.Children.toArray(s),l=o.find(uwe);if(l){const c=l.props.children,u=o.map(h=>h===l?J.Children.count(c)>1?J.Children.only(null):J.isValidElement(c)?c.props.children:null:h);return O.jsx(e,{...a,ref:n,children:J.isValidElement(c)?J.cloneElement(c,void 0,u):null})}return O.jsx(e,{...a,ref:n,children:s})});return i.displayName=`${t}.Slot`,i}var $ne=$A("Slot");function lwe(t){const e=J.forwardRef((i,r)=>{const{children:n,...s}=i;if(J.isValidElement(n)){const a=dwe(n),o=hwe(s,n.props);return n.type!==J.Fragment&&(o.ref=r?Xne(r,a):a),J.cloneElement(n,o)}return J.Children.count(n)>1?J.Children.only(null):null});return e.displayName=`${t}.SlotClone`,e}var cwe=Symbol("radix.slottable");function uwe(t){return J.isValidElement(t)&&typeof t.type=="function"&&"__radixId"in t.type&&t.type.__radixId===cwe}function hwe(t,e){const i={...e};for(const r in e){const n=t[r],s=e[r];/^on[A-Z]/.test(r)?n&&s?i[r]=(...o)=>{const l=s(...o);return n(...o),l}:n&&(i[r]=n):r==="style"?i[r]={...n,...s}:r==="className"&&(i[r]=[n,s].filter(Boolean).join(" "))}return{...t,...i}}function dwe(t){let e=Object.getOwnPropertyDescriptor(t.props,"ref")?.get,i=e&&"isReactWarning"in e&&e.isReactWarning;return i?t.ref:(e=Object.getOwnPropertyDescriptor(t,"ref")?.get,i=e&&"isReactWarning"in e&&e.isReactWarning,i?t.props.ref:t.props.ref||t.ref)}function Yne(t){var e,i,r="";if(typeof t=="string"||typeof t=="number")r+=t;else if(typeof t=="object")if(Array.isArray(t)){var n=t.length;for(e=0;e<n;e++)t[e]&&(i=Yne(t[e]))&&(r&&(r+=" "),r+=i)}else for(i in t)t[i]&&(r&&(r+=" "),r+=i);return r}function Kne(){for(var t,e,i=0,r="",n=arguments.length;i<n;i++)(t=arguments[i])&&(e=Yne(t))&&(r&&(r+=" "),r+=e);return r}const F9=t=>typeof t=="boolean"?`${t}`:t===0?"0":t,z9=Kne,Zne=(t,e)=>i=>{var r;if(e?.variants==null)return z9(t,i?.class,i?.className);const{variants:n,defaultVariants:s}=e,a=Object.keys(n).map(c=>{const u=i?.[c],h=s?.[c];if(u===null)return null;const d=F9(u)||F9(h);return n[c][d]}),o=i&&Object.entries(i).reduce((c,u)=>{let[h,d]=u;return d===void 0||(c[h]=d),c},{}),l=e==null||(r=e.compoundVariants)===null||r===void 0?void 0:r.reduce((c,u)=>{let{class:h,className:d,...f}=u;return Object.entries(f).every(p=>{let[g,m]=p;return Array.isArray(m)?m.includes({...s,...o}[g]):{...s,...o}[g]===m})?[...c,h,d]:c},[]);return z9(t,a,l,i?.class,i?.className)},n6="-",fwe=t=>{const e=mwe(t),{conflictingClassGroups:i,conflictingClassGroupModifiers:r}=t;return{getClassGroupId:a=>{const o=a.split(n6);return o[0]===""&&o.length!==1&&o.shift(),Qne(o,e)||pwe(a)},getConflictingClassGroupIds:(a,o)=>{const l=i[a]||[];return o&&r[a]?[...l,...r[a]]:l}}},Qne=(t,e)=>{if(t.length===0)return e.classGroupId;const i=t[0],r=e.nextPart.get(i),n=r?Qne(t.slice(1),r):void 0;if(n)return n;if(e.validators.length===0)return;const s=t.join(n6);return e.validators.find(({validator:a})=>a(s))?.classGroupId},j9=/^\[(.+)\]$/,pwe=t=>{if(j9.test(t)){const e=j9.exec(t)[1],i=e?.substring(0,e.indexOf(":"));if(i)return"arbitrary.."+i}},mwe=t=>{const{theme:e,classGroups:i}=t,r={nextPart:new Map,validators:[]};for(const n in i)iz(i[n],r,n,e);return r},iz=(t,e,i,r)=>{t.forEach(n=>{if(typeof n=="string"){const s=n===""?e:V9(e,n);s.classGroupId=i;return}if(typeof n=="function"){if(gwe(n)){iz(n(r),e,i,r);return}e.validators.push({validator:n,classGroupId:i});return}Object.entries(n).forEach(([s,a])=>{iz(a,V9(e,s),i,r)})})},V9=(t,e)=>{let i=t;return e.split(n6).forEach(r=>{i.nextPart.has(r)||i.nextPart.set(r,{nextPart:new Map,validators:[]}),i=i.nextPart.get(r)}),i},gwe=t=>t.isThemeGetter,vwe=t=>{if(t<1)return{get:()=>{},set:()=>{}};let e=0,i=new Map,r=new Map;const n=(s,a)=>{i.set(s,a),e++,e>t&&(e=0,r=i,i=new Map)};return{get(s){let a=i.get(s);if(a!==void 0)return a;if((a=r.get(s))!==void 0)return n(s,a),a},set(s,a){i.has(s)?i.set(s,a):n(s,a)}}},rz="!",nz=":",ywe=nz.length,xwe=t=>{const{prefix:e,experimentalParseClassName:i}=t;let r=n=>{const s=[];let a=0,o=0,l=0,c;for(let p=0;p<n.length;p++){let g=n[p];if(a===0&&o===0){if(g===nz){s.push(n.slice(l,p)),l=p+ywe;continue}if(g==="/"){c=p;continue}}g==="["?a++:g==="]"?a--:g==="("?o++:g===")"&&o--}const u=s.length===0?n:n.substring(l),h=bwe(u),d=h!==u,f=c&&c>l?c-l:void 0;return{modifiers:s,hasImportantModifier:d,baseClassName:h,maybePostfixModifierPosition:f}};if(e){const n=e+nz,s=r;r=a=>a.startsWith(n)?s(a.substring(n.length)):{isExternal:!0,modifiers:[],hasImportantModifier:!1,baseClassName:a,maybePostfixModifierPosition:void 0}}if(i){const n=r;r=s=>i({className:s,parseClassName:n})}return r},bwe=t=>t.endsWith(rz)?t.substring(0,t.length-1):t.startsWith(rz)?t.substring(1):t,wwe=t=>{const e=Object.fromEntries(t.orderSensitiveModifiers.map(r=>[r,!0]));return r=>{if(r.length<=1)return r;const n=[];let s=[];return r.forEach(a=>{a[0]==="["||e[a]?(n.push(...s.sort(),a),s=[]):s.push(a)}),n.push(...s.sort()),n}},_we=t=>({cache:vwe(t.cacheSize),parseClassName:xwe(t),sortModifiers:wwe(t),...fwe(t)}),Swe=/\s+/,Ewe=(t,e)=>{const{parseClassName:i,getClassGroupId:r,getConflictingClassGroupIds:n,sortModifiers:s}=e,a=[],o=t.trim().split(Swe);let l="";for(let c=o.length-1;c>=0;c-=1){const u=o[c],{isExternal:h,modifiers:d,hasImportantModifier:f,baseClassName:p,maybePostfixModifierPosition:g}=i(u);if(h){l=u+(l.length>0?" "+l:l);continue}let m=!!g,y=r(m?p.substring(0,g):p);if(!y){if(!m){l=u+(l.length>0?" "+l:l);continue}if(y=r(p),!y){l=u+(l.length>0?" "+l:l);continue}m=!1}const b=s(d).join(":"),w=f?b+rz:b,E=w+y;if(a.includes(E))continue;a.push(E);const M=n(y,m);for(let A=0;A<M.length;++A){const P=M[A];a.push(w+P)}l=u+(l.length>0?" "+l:l)}return l};function Awe(){let t=0,e,i,r="";for(;t<arguments.length;)(e=arguments[t++])&&(i=Jne(e))&&(r&&(r+=" "),r+=i);return r}const Jne=t=>{if(typeof t=="string")return t;let e,i="";for(let r=0;r<t.length;r++)t[r]&&(e=Jne(t[r]))&&(i&&(i+=" "),i+=e);return i};function Mwe(t,...e){let i,r,n,s=a;function a(l){const c=e.reduce((u,h)=>h(u),t());return i=_we(c),r=i.cache.get,n=i.cache.set,s=o,o(l)}function o(l){const c=r(l);if(c)return c;const u=Ewe(l,i);return n(l,u),u}return function(){return s(Awe.apply(null,arguments))}}const ta=t=>{const e=i=>i[t]||[];return e.isThemeGetter=!0,e},ese=/^\[(?:(\w[\w-]*):)?(.+)\]$/i,tse=/^\((?:(\w[\w-]*):)?(.+)\)$/i,Twe=/^\d+\/\d+$/,Cwe=/^(\d+(\.\d+)?)?(xs|sm|md|lg|xl)$/,Pwe=/\d+(%|px|r?em|[sdl]?v([hwib]|min|max)|pt|pc|in|cm|mm|cap|ch|ex|r?lh|cq(w|h|i|b|min|max))|\b(calc|min|max|clamp)\(.+\)|^0$/,Rwe=/^(rgba?|hsla?|hwb|(ok)?(lab|lch)|color-mix)\(.+\)$/,Iwe=/^(inset_)?-?((\d+)?\.?(\d+)[a-z]+|0)_-?((\d+)?\.?(\d+)[a-z]+|0)/,Dwe=/^(url|image|image-set|cross-fade|element|(repeating-)?(linear|radial|conic)-gradient)\(.+\)$/,Zx=t=>Twe.test(t),yr=t=>!!t&&!Number.isNaN(Number(t)),Om=t=>!!t&&Number.isInteger(Number(t)),Ik=t=>t.endsWith("%")&&yr(t.slice(0,-1)),Gf=t=>Cwe.test(t),Owe=()=>!0,Lwe=t=>Pwe.test(t)&&!Rwe.test(t),ise=()=>!1,kwe=t=>Iwe.test(t),Nwe=t=>Dwe.test(t),Uwe=t=>!ci(t)&&!ui(t),Bwe=t=>a_(t,sse,ise),ci=t=>ese.test(t),ay=t=>a_(t,ase,Lwe),Dk=t=>a_(t,Hwe,yr),H9=t=>a_(t,rse,ise),Fwe=t=>a_(t,nse,Nwe),XC=t=>a_(t,ose,kwe),ui=t=>tse.test(t),US=t=>o_(t,ase),zwe=t=>o_(t,Gwe),G9=t=>o_(t,rse),jwe=t=>o_(t,sse),Vwe=t=>o_(t,nse),$C=t=>o_(t,ose,!0),a_=(t,e,i)=>{const r=ese.exec(t);return r?r[1]?e(r[1]):i(r[2]):!1},o_=(t,e,i=!1)=>{const r=tse.exec(t);return r?r[1]?e(r[1]):i:!1},rse=t=>t==="position"||t==="percentage",nse=t=>t==="image"||t==="url",sse=t=>t==="length"||t==="size"||t==="bg-size",ase=t=>t==="length",Hwe=t=>t==="number",Gwe=t=>t==="family-name",ose=t=>t==="shadow",Wwe=()=>{const t=ta("color"),e=ta("font"),i=ta("text"),r=ta("font-weight"),n=ta("tracking"),s=ta("leading"),a=ta("breakpoint"),o=ta("container"),l=ta("spacing"),c=ta("radius"),u=ta("shadow"),h=ta("inset-shadow"),d=ta("text-shadow"),f=ta("drop-shadow"),p=ta("blur"),g=ta("perspective"),m=ta("aspect"),y=ta("ease"),b=ta("animate"),w=()=>["auto","avoid","all","avoid-page","page","left","right","column"],E=()=>["center","top","bottom","left","right","top-left","left-top","top-right","right-top","bottom-right","right-bottom","bottom-left","left-bottom"],M=()=>[...E(),ui,ci],A=()=>["auto","hidden","clip","visible","scroll"],P=()=>["auto","contain","none"],C=()=>[ui,ci,l],R=()=>[Zx,"full","auto",...C()],I=()=>[Om,"none","subgrid",ui,ci],k=()=>["auto",{span:["full",Om,ui,ci]},Om,ui,ci],z=()=>[Om,"auto",ui,ci],V=()=>["auto","min","max","fr",ui,ci],F=()=>["start","end","center","between","around","evenly","stretch","baseline","center-safe","end-safe"],$=()=>["start","end","center","stretch","center-safe","end-safe"],K=()=>["auto",...C()],X=()=>[Zx,"auto","full","dvw","dvh","lvw","lvh","svw","svh","min","max","fit",...C()],U=()=>[t,ui,ci],Y=()=>[...E(),G9,H9,{position:[ui,ci]}],Z=()=>["no-repeat",{repeat:["","x","y","space","round"]}],j=()=>["auto","cover","contain",jwe,Bwe,{size:[ui,ci]}],ee=()=>[Ik,US,ay],pe=()=>["","none","full",c,ui,ci],fe=()=>["",yr,US,ay],se=()=>["solid","dashed","dotted","double"],re=()=>["normal","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","hue","saturation","color","luminosity"],le=()=>[yr,Ik,G9,H9],he=()=>["","none",p,ui,ci],ve=()=>["none",yr,ui,ci],xe=()=>["none",yr,ui,ci],Se=()=>[yr,ui,ci],Ce=()=>[Zx,"full",...C()];return{cacheSize:500,theme:{animate:["spin","ping","pulse","bounce"],aspect:["video"],blur:[Gf],breakpoint:[Gf],color:[Owe],container:[Gf],"drop-shadow":[Gf],ease:["in","out","in-out"],font:[Uwe],"font-weight":["thin","extralight","light","normal","medium","semibold","bold","extrabold","black"],"inset-shadow":[Gf],leading:["none","tight","snug","normal","relaxed","loose"],perspective:["dramatic","near","normal","midrange","distant","none"],radius:[Gf],shadow:[Gf],spacing:["px",yr],text:[Gf],"text-shadow":[Gf],tracking:["tighter","tight","normal","wide","wider","widest"]},classGroups:{aspect:[{aspect:["auto","square",Zx,ci,ui,m]}],container:["container"],columns:[{columns:[yr,ci,ui,o]}],"break-after":[{"break-after":w()}],"break-before":[{"break-before":w()}],"break-inside":[{"break-inside":["auto","avoid","avoid-page","avoid-column"]}],"box-decoration":[{"box-decoration":["slice","clone"]}],box:[{box:["border","content"]}],display:["block","inline-block","inline","flex","inline-flex","table","inline-table","table-caption","table-cell","table-column","table-column-group","table-footer-group","table-header-group","table-row-group","table-row","flow-root","grid","inline-grid","contents","list-item","hidden"],sr:["sr-only","not-sr-only"],float:[{float:["right","left","none","start","end"]}],clear:[{clear:["left","right","both","none","start","end"]}],isolation:["isolate","isolation-auto"],"object-fit":[{object:["contain","cover","fill","none","scale-down"]}],"object-position":[{object:M()}],overflow:[{overflow:A()}],"overflow-x":[{"overflow-x":A()}],"overflow-y":[{"overflow-y":A()}],overscroll:[{overscroll:P()}],"overscroll-x":[{"overscroll-x":P()}],"overscroll-y":[{"overscroll-y":P()}],position:["static","fixed","absolute","relative","sticky"],inset:[{inset:R()}],"inset-x":[{"inset-x":R()}],"inset-y":[{"inset-y":R()}],start:[{start:R()}],end:[{end:R()}],top:[{top:R()}],right:[{right:R()}],bottom:[{bottom:R()}],left:[{left:R()}],visibility:["visible","invisible","collapse"],z:[{z:[Om,"auto",ui,ci]}],basis:[{basis:[Zx,"full","auto",o,...C()]}],"flex-direction":[{flex:["row","row-reverse","col","col-reverse"]}],"flex-wrap":[{flex:["nowrap","wrap","wrap-reverse"]}],flex:[{flex:[yr,Zx,"auto","initial","none",ci]}],grow:[{grow:["",yr,ui,ci]}],shrink:[{shrink:["",yr,ui,ci]}],order:[{order:[Om,"first","last","none",ui,ci]}],"grid-cols":[{"grid-cols":I()}],"col-start-end":[{col:k()}],"col-start":[{"col-start":z()}],"col-end":[{"col-end":z()}],"grid-rows":[{"grid-rows":I()}],"row-start-end":[{row:k()}],"row-start":[{"row-start":z()}],"row-end":[{"row-end":z()}],"grid-flow":[{"grid-flow":["row","col","dense","row-dense","col-dense"]}],"auto-cols":[{"auto-cols":V()}],"auto-rows":[{"auto-rows":V()}],gap:[{gap:C()}],"gap-x":[{"gap-x":C()}],"gap-y":[{"gap-y":C()}],"justify-content":[{justify:[...F(),"normal"]}],"justify-items":[{"justify-items":[...$(),"normal"]}],"justify-self":[{"justify-self":["auto",...$()]}],"align-content":[{content:["normal",...F()]}],"align-items":[{items:[...$(),{baseline:["","last"]}]}],"align-self":[{self:["auto",...$(),{baseline:["","last"]}]}],"place-content":[{"place-content":F()}],"place-items":[{"place-items":[...$(),"baseline"]}],"place-self":[{"place-self":["auto",...$()]}],p:[{p:C()}],px:[{px:C()}],py:[{py:C()}],ps:[{ps:C()}],pe:[{pe:C()}],pt:[{pt:C()}],pr:[{pr:C()}],pb:[{pb:C()}],pl:[{pl:C()}],m:[{m:K()}],mx:[{mx:K()}],my:[{my:K()}],ms:[{ms:K()}],me:[{me:K()}],mt:[{mt:K()}],mr:[{mr:K()}],mb:[{mb:K()}],ml:[{ml:K()}],"space-x":[{"space-x":C()}],"space-x-reverse":["space-x-reverse"],"space-y":[{"space-y":C()}],"space-y-reverse":["space-y-reverse"],size:[{size:X()}],w:[{w:[o,"screen",...X()]}],"min-w":[{"min-w":[o,"screen","none",...X()]}],"max-w":[{"max-w":[o,"screen","none","prose",{screen:[a]},...X()]}],h:[{h:["screen","lh",...X()]}],"min-h":[{"min-h":["screen","lh","none",...X()]}],"max-h":[{"max-h":["screen","lh",...X()]}],"font-size":[{text:["base",i,US,ay]}],"font-smoothing":["antialiased","subpixel-antialiased"],"font-style":["italic","not-italic"],"font-weight":[{font:[r,ui,Dk]}],"font-stretch":[{"font-stretch":["ultra-condensed","extra-condensed","condensed","semi-condensed","normal","semi-expanded","expanded","extra-expanded","ultra-expanded",Ik,ci]}],"font-family":[{font:[zwe,ci,e]}],"fvn-normal":["normal-nums"],"fvn-ordinal":["ordinal"],"fvn-slashed-zero":["slashed-zero"],"fvn-figure":["lining-nums","oldstyle-nums"],"fvn-spacing":["proportional-nums","tabular-nums"],"fvn-fraction":["diagonal-fractions","stacked-fractions"],tracking:[{tracking:[n,ui,ci]}],"line-clamp":[{"line-clamp":[yr,"none",ui,Dk]}],leading:[{leading:[s,...C()]}],"list-image":[{"list-image":["none",ui,ci]}],"list-style-position":[{list:["inside","outside"]}],"list-style-type":[{list:["disc","decimal","none",ui,ci]}],"text-alignment":[{text:["left","center","right","justify","start","end"]}],"placeholder-color":[{placeholder:U()}],"text-color":[{text:U()}],"text-decoration":["underline","overline","line-through","no-underline"],"text-decoration-style":[{decoration:[...se(),"wavy"]}],"text-decoration-thickness":[{decoration:[yr,"from-font","auto",ui,ay]}],"text-decoration-color":[{decoration:U()}],"underline-offset":[{"underline-offset":[yr,"auto",ui,ci]}],"text-transform":["uppercase","lowercase","capitalize","normal-case"],"text-overflow":["truncate","text-ellipsis","text-clip"],"text-wrap":[{text:["wrap","nowrap","balance","pretty"]}],indent:[{indent:C()}],"vertical-align":[{align:["baseline","top","middle","bottom","text-top","text-bottom","sub","super",ui,ci]}],whitespace:[{whitespace:["normal","nowrap","pre","pre-line","pre-wrap","break-spaces"]}],break:[{break:["normal","words","all","keep"]}],wrap:[{wrap:["break-word","anywhere","normal"]}],hyphens:[{hyphens:["none","manual","auto"]}],content:[{content:["none",ui,ci]}],"bg-attachment":[{bg:["fixed","local","scroll"]}],"bg-clip":[{"bg-clip":["border","padding","content","text"]}],"bg-origin":[{"bg-origin":["border","padding","content"]}],"bg-position":[{bg:Y()}],"bg-repeat":[{bg:Z()}],"bg-size":[{bg:j()}],"bg-image":[{bg:["none",{linear:[{to:["t","tr","r","br","b","bl","l","tl"]},Om,ui,ci],radial:["",ui,ci],conic:[Om,ui,ci]},Vwe,Fwe]}],"bg-color":[{bg:U()}],"gradient-from-pos":[{from:ee()}],"gradient-via-pos":[{via:ee()}],"gradient-to-pos":[{to:ee()}],"gradient-from":[{from:U()}],"gradient-via":[{via:U()}],"gradient-to":[{to:U()}],rounded:[{rounded:pe()}],"rounded-s":[{"rounded-s":pe()}],"rounded-e":[{"rounded-e":pe()}],"rounded-t":[{"rounded-t":pe()}],"rounded-r":[{"rounded-r":pe()}],"rounded-b":[{"rounded-b":pe()}],"rounded-l":[{"rounded-l":pe()}],"rounded-ss":[{"rounded-ss":pe()}],"rounded-se":[{"rounded-se":pe()}],"rounded-ee":[{"rounded-ee":pe()}],"rounded-es":[{"rounded-es":pe()}],"rounded-tl":[{"rounded-tl":pe()}],"rounded-tr":[{"rounded-tr":pe()}],"rounded-br":[{"rounded-br":pe()}],"rounded-bl":[{"rounded-bl":pe()}],"border-w":[{border:fe()}],"border-w-x":[{"border-x":fe()}],"border-w-y":[{"border-y":fe()}],"border-w-s":[{"border-s":fe()}],"border-w-e":[{"border-e":fe()}],"border-w-t":[{"border-t":fe()}],"border-w-r":[{"border-r":fe()}],"border-w-b":[{"border-b":fe()}],"border-w-l":[{"border-l":fe()}],"divide-x":[{"divide-x":fe()}],"divide-x-reverse":["divide-x-reverse"],"divide-y":[{"divide-y":fe()}],"divide-y-reverse":["divide-y-reverse"],"border-style":[{border:[...se(),"hidden","none"]}],"divide-style":[{divide:[...se(),"hidden","none"]}],"border-color":[{border:U()}],"border-color-x":[{"border-x":U()}],"border-color-y":[{"border-y":U()}],"border-color-s":[{"border-s":U()}],"border-color-e":[{"border-e":U()}],"border-color-t":[{"border-t":U()}],"border-color-r":[{"border-r":U()}],"border-color-b":[{"border-b":U()}],"border-color-l":[{"border-l":U()}],"divide-color":[{divide:U()}],"outline-style":[{outline:[...se(),"none","hidden"]}],"outline-offset":[{"outline-offset":[yr,ui,ci]}],"outline-w":[{outline:["",yr,US,ay]}],"outline-color":[{outline:U()}],shadow:[{shadow:["","none",u,$C,XC]}],"shadow-color":[{shadow:U()}],"inset-shadow":[{"inset-shadow":["none",h,$C,XC]}],"inset-shadow-color":[{"inset-shadow":U()}],"ring-w":[{ring:fe()}],"ring-w-inset":["ring-inset"],"ring-color":[{ring:U()}],"ring-offset-w":[{"ring-offset":[yr,ay]}],"ring-offset-color":[{"ring-offset":U()}],"inset-ring-w":[{"inset-ring":fe()}],"inset-ring-color":[{"inset-ring":U()}],"text-shadow":[{"text-shadow":["none",d,$C,XC]}],"text-shadow-color":[{"text-shadow":U()}],opacity:[{opacity:[yr,ui,ci]}],"mix-blend":[{"mix-blend":[...re(),"plus-darker","plus-lighter"]}],"bg-blend":[{"bg-blend":re()}],"mask-clip":[{"mask-clip":["border","padding","content","fill","stroke","view"]},"mask-no-clip"],"mask-composite":[{mask:["add","subtract","intersect","exclude"]}],"mask-image-linear-pos":[{"mask-linear":[yr]}],"mask-image-linear-from-pos":[{"mask-linear-from":le()}],"mask-image-linear-to-pos":[{"mask-linear-to":le()}],"mask-image-linear-from-color":[{"mask-linear-from":U()}],"mask-image-linear-to-color":[{"mask-linear-to":U()}],"mask-image-t-from-pos":[{"mask-t-from":le()}],"mask-image-t-to-pos":[{"mask-t-to":le()}],"mask-image-t-from-color":[{"mask-t-from":U()}],"mask-image-t-to-color":[{"mask-t-to":U()}],"mask-image-r-from-pos":[{"mask-r-from":le()}],"mask-image-r-to-pos":[{"mask-r-to":le()}],"mask-image-r-from-color":[{"mask-r-from":U()}],"mask-image-r-to-color":[{"mask-r-to":U()}],"mask-image-b-from-pos":[{"mask-b-from":le()}],"mask-image-b-to-pos":[{"mask-b-to":le()}],"mask-image-b-from-color":[{"mask-b-from":U()}],"mask-image-b-to-color":[{"mask-b-to":U()}],"mask-image-l-from-pos":[{"mask-l-from":le()}],"mask-image-l-to-pos":[{"mask-l-to":le()}],"mask-image-l-from-color":[{"mask-l-from":U()}],"mask-image-l-to-color":[{"mask-l-to":U()}],"mask-image-x-from-pos":[{"mask-x-from":le()}],"mask-image-x-to-pos":[{"mask-x-to":le()}],"mask-image-x-from-color":[{"mask-x-from":U()}],"mask-image-x-to-color":[{"mask-x-to":U()}],"mask-image-y-from-pos":[{"mask-y-from":le()}],"mask-image-y-to-pos":[{"mask-y-to":le()}],"mask-image-y-from-color":[{"mask-y-from":U()}],"mask-image-y-to-color":[{"mask-y-to":U()}],"mask-image-radial":[{"mask-radial":[ui,ci]}],"mask-image-radial-from-pos":[{"mask-radial-from":le()}],"mask-image-radial-to-pos":[{"mask-radial-to":le()}],"mask-image-radial-from-color":[{"mask-radial-from":U()}],"mask-image-radial-to-color":[{"mask-radial-to":U()}],"mask-image-radial-shape":[{"mask-radial":["circle","ellipse"]}],"mask-image-radial-size":[{"mask-radial":[{closest:["side","corner"],farthest:["side","corner"]}]}],"mask-image-radial-pos":[{"mask-radial-at":E()}],"mask-image-conic-pos":[{"mask-conic":[yr]}],"mask-image-conic-from-pos":[{"mask-conic-from":le()}],"mask-image-conic-to-pos":[{"mask-conic-to":le()}],"mask-image-conic-from-color":[{"mask-conic-from":U()}],"mask-image-conic-to-color":[{"mask-conic-to":U()}],"mask-mode":[{mask:["alpha","luminance","match"]}],"mask-origin":[{"mask-origin":["border","padding","content","fill","stroke","view"]}],"mask-position":[{mask:Y()}],"mask-repeat":[{mask:Z()}],"mask-size":[{mask:j()}],"mask-type":[{"mask-type":["alpha","luminance"]}],"mask-image":[{mask:["none",ui,ci]}],filter:[{filter:["","none",ui,ci]}],blur:[{blur:he()}],brightness:[{brightness:[yr,ui,ci]}],contrast:[{contrast:[yr,ui,ci]}],"drop-shadow":[{"drop-shadow":["","none",f,$C,XC]}],"drop-shadow-color":[{"drop-shadow":U()}],grayscale:[{grayscale:["",yr,ui,ci]}],"hue-rotate":[{"hue-rotate":[yr,ui,ci]}],invert:[{invert:["",yr,ui,ci]}],saturate:[{saturate:[yr,ui,ci]}],sepia:[{sepia:["",yr,ui,ci]}],"backdrop-filter":[{"backdrop-filter":["","none",ui,ci]}],"backdrop-blur":[{"backdrop-blur":he()}],"backdrop-brightness":[{"backdrop-brightness":[yr,ui,ci]}],"backdrop-contrast":[{"backdrop-contrast":[yr,ui,ci]}],"backdrop-grayscale":[{"backdrop-grayscale":["",yr,ui,ci]}],"backdrop-hue-rotate":[{"backdrop-hue-rotate":[yr,ui,ci]}],"backdrop-invert":[{"backdrop-invert":["",yr,ui,ci]}],"backdrop-opacity":[{"backdrop-opacity":[yr,ui,ci]}],"backdrop-saturate":[{"backdrop-saturate":[yr,ui,ci]}],"backdrop-sepia":[{"backdrop-sepia":["",yr,ui,ci]}],"border-collapse":[{border:["collapse","separate"]}],"border-spacing":[{"border-spacing":C()}],"border-spacing-x":[{"border-spacing-x":C()}],"border-spacing-y":[{"border-spacing-y":C()}],"table-layout":[{table:["auto","fixed"]}],caption:[{caption:["top","bottom"]}],transition:[{transition:["","all","colors","opacity","shadow","transform","none",ui,ci]}],"transition-behavior":[{transition:["normal","discrete"]}],duration:[{duration:[yr,"initial",ui,ci]}],ease:[{ease:["linear","initial",y,ui,ci]}],delay:[{delay:[yr,ui,ci]}],animate:[{animate:["none",b,ui,ci]}],backface:[{backface:["hidden","visible"]}],perspective:[{perspective:[g,ui,ci]}],"perspective-origin":[{"perspective-origin":M()}],rotate:[{rotate:ve()}],"rotate-x":[{"rotate-x":ve()}],"rotate-y":[{"rotate-y":ve()}],"rotate-z":[{"rotate-z":ve()}],scale:[{scale:xe()}],"scale-x":[{"scale-x":xe()}],"scale-y":[{"scale-y":xe()}],"scale-z":[{"scale-z":xe()}],"scale-3d":["scale-3d"],skew:[{skew:Se()}],"skew-x":[{"skew-x":Se()}],"skew-y":[{"skew-y":Se()}],transform:[{transform:[ui,ci,"","none","gpu","cpu"]}],"transform-origin":[{origin:M()}],"transform-style":[{transform:["3d","flat"]}],translate:[{translate:Ce()}],"translate-x":[{"translate-x":Ce()}],"translate-y":[{"translate-y":Ce()}],"translate-z":[{"translate-z":Ce()}],"translate-none":["translate-none"],accent:[{accent:U()}],appearance:[{appearance:["none","auto"]}],"caret-color":[{caret:U()}],"color-scheme":[{scheme:["normal","dark","light","light-dark","only-dark","only-light"]}],cursor:[{cursor:["auto","default","pointer","wait","text","move","help","not-allowed","none","context-menu","progress","cell","crosshair","vertical-text","alias","copy","no-drop","grab","grabbing","all-scroll","col-resize","row-resize","n-resize","e-resize","s-resize","w-resize","ne-resize","nw-resize","se-resize","sw-resize","ew-resize","ns-resize","nesw-resize","nwse-resize","zoom-in","zoom-out",ui,ci]}],"field-sizing":[{"field-sizing":["fixed","content"]}],"pointer-events":[{"pointer-events":["auto","none"]}],resize:[{resize:["none","","y","x"]}],"scroll-behavior":[{scroll:["auto","smooth"]}],"scroll-m":[{"scroll-m":C()}],"scroll-mx":[{"scroll-mx":C()}],"scroll-my":[{"scroll-my":C()}],"scroll-ms":[{"scroll-ms":C()}],"scroll-me":[{"scroll-me":C()}],"scroll-mt":[{"scroll-mt":C()}],"scroll-mr":[{"scroll-mr":C()}],"scroll-mb":[{"scroll-mb":C()}],"scroll-ml":[{"scroll-ml":C()}],"scroll-p":[{"scroll-p":C()}],"scroll-px":[{"scroll-px":C()}],"scroll-py":[{"scroll-py":C()}],"scroll-ps":[{"scroll-ps":C()}],"scroll-pe":[{"scroll-pe":C()}],"scroll-pt":[{"scroll-pt":C()}],"scroll-pr":[{"scroll-pr":C()}],"scroll-pb":[{"scroll-pb":C()}],"scroll-pl":[{"scroll-pl":C()}],"snap-align":[{snap:["start","end","center","align-none"]}],"snap-stop":[{snap:["normal","always"]}],"snap-type":[{snap:["none","x","y","both"]}],"snap-strictness":[{snap:["mandatory","proximity"]}],touch:[{touch:["auto","none","manipulation"]}],"touch-x":[{"touch-pan":["x","left","right"]}],"touch-y":[{"touch-pan":["y","up","down"]}],"touch-pz":["touch-pinch-zoom"],select:[{select:["none","text","all","auto"]}],"will-change":[{"will-change":["auto","scroll","contents","transform",ui,ci]}],fill:[{fill:["none",...U()]}],"stroke-w":[{stroke:[yr,US,ay,Dk]}],stroke:[{stroke:["none",...U()]}],"forced-color-adjust":[{"forced-color-adjust":["auto","none"]}]},conflictingClassGroups:{overflow:["overflow-x","overflow-y"],overscroll:["overscroll-x","overscroll-y"],inset:["inset-x","inset-y","start","end","top","right","bottom","left"],"inset-x":["right","left"],"inset-y":["top","bottom"],flex:["basis","grow","shrink"],gap:["gap-x","gap-y"],p:["px","py","ps","pe","pt","pr","pb","pl"],px:["pr","pl"],py:["pt","pb"],m:["mx","my","ms","me","mt","mr","mb","ml"],mx:["mr","ml"],my:["mt","mb"],size:["w","h"],"font-size":["leading"],"fvn-normal":["fvn-ordinal","fvn-slashed-zero","fvn-figure","fvn-spacing","fvn-fraction"],"fvn-ordinal":["fvn-normal"],"fvn-slashed-zero":["fvn-normal"],"fvn-figure":["fvn-normal"],"fvn-spacing":["fvn-normal"],"fvn-fraction":["fvn-normal"],"line-clamp":["display","overflow"],rounded:["rounded-s","rounded-e","rounded-t","rounded-r","rounded-b","rounded-l","rounded-ss","rounded-se","rounded-ee","rounded-es","rounded-tl","rounded-tr","rounded-br","rounded-bl"],"rounded-s":["rounded-ss","rounded-es"],"rounded-e":["rounded-se","rounded-ee"],"rounded-t":["rounded-tl","rounded-tr"],"rounded-r":["rounded-tr","rounded-br"],"rounded-b":["rounded-br","rounded-bl"],"rounded-l":["rounded-tl","rounded-bl"],"border-spacing":["border-spacing-x","border-spacing-y"],"border-w":["border-w-x","border-w-y","border-w-s","border-w-e","border-w-t","border-w-r","border-w-b","border-w-l"],"border-w-x":["border-w-r","border-w-l"],"border-w-y":["border-w-t","border-w-b"],"border-color":["border-color-x","border-color-y","border-color-s","border-color-e","border-color-t","border-color-r","border-color-b","border-color-l"],"border-color-x":["border-color-r","border-color-l"],"border-color-y":["border-color-t","border-color-b"],translate:["translate-x","translate-y","translate-none"],"translate-none":["translate","translate-x","translate-y","translate-z"],"scroll-m":["scroll-mx","scroll-my","scroll-ms","scroll-me","scroll-mt","scroll-mr","scroll-mb","scroll-ml"],"scroll-mx":["scroll-mr","scroll-ml"],"scroll-my":["scroll-mt","scroll-mb"],"scroll-p":["scroll-px","scroll-py","scroll-ps","scroll-pe","scroll-pt","scroll-pr","scroll-pb","scroll-pl"],"scroll-px":["scroll-pr","scroll-pl"],"scroll-py":["scroll-pt","scroll-pb"],touch:["touch-x","touch-y","touch-pz"],"touch-x":["touch"],"touch-y":["touch"],"touch-pz":["touch"]},conflictingClassGroupModifiers:{"font-size":["leading"]},orderSensitiveModifiers:["*","**","after","backdrop","before","details-content","file","first-letter","first-line","marker","placeholder","selection"]}},qwe=Mwe(Wwe);function Ws(...t){return qwe(Kne(t))}const Xwe=Zne("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg:not([class*='size-'])]:size-4 shrink-0 [&_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-white hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",outline:"border bg-background text-foreground hover:bg-accent hover:text-accent-foreground dark:bg-input/30 dark:border-input dark:hover:bg-input/50",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2 has-[>svg]:px-3",sm:"h-8 rounded-md gap-1.5 px-3 has-[>svg]:px-2.5",lg:"h-10 rounded-md px-6 has-[>svg]:px-4",icon:"size-9 rounded-md"}},defaultVariants:{variant:"default",size:"default"}});function jr({className:t,variant:e,size:i,asChild:r=!1,...n}){const s=r?$ne:"button";return O.jsx(s,{"data-slot":"button",className:Ws(Xwe({variant:e,size:i,className:t})),...n})}function aA({className:t,type:e,...i}){return O.jsx("input",{type:e,"data-slot":"input",className:Ws("file:text-foreground placeholder:text-muted-foreground selection:bg-primary selection:text-primary-foreground dark:bg-input/30 border-input flex h-9 w-full min-w-0 rounded-md border px-3 py-1 text-base bg-input-background transition-[color,box-shadow] outline-none file:inline-flex file:h-7 file:border-0 file:bg-transparent file:text-sm file:font-medium disabled:pointer-events-none disabled:cursor-not-allowed disabled:opacity-50 md:text-sm","focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px]","aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",t),...i})}function zn({className:t,...e}){return O.jsx("div",{"data-slot":"card",className:Ws("bg-card text-card-foreground flex flex-col gap-6 rounded-xl border",t),...e})}function Yd({className:t,...e}){return O.jsx("div",{"data-slot":"card-header",className:Ws("@container/card-header grid auto-rows-min grid-rows-[auto_auto] items-start gap-1.5 px-6 pt-6 has-data-[slot=card-action]:grid-cols-[1fr_auto] [.border-b]:pb-6",t),...e})}function Kd({className:t,...e}){return O.jsx("h4",{"data-slot":"card-title",className:Ws("leading-none",t),...e})}function jn({className:t,...e}){return O.jsx("div",{"data-slot":"card-content",className:Ws("px-6 [&:last-child]:pb-6",t),...e})}/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $we=t=>t.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),Ywe=t=>t.replace(/^([A-Z])|[\s-_]+(\w)/g,(e,i,r)=>r?r.toUpperCase():i.toLowerCase()),W9=t=>{const e=Ywe(t);return e.charAt(0).toUpperCase()+e.slice(1)},lse=(...t)=>t.filter((e,i,r)=>!!e&&e.trim()!==""&&r.indexOf(e)===i).join(" ").trim();/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var Kwe={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Zwe=J.forwardRef(({color:t="currentColor",size:e=24,strokeWidth:i=2,absoluteStrokeWidth:r,className:n="",children:s,iconNode:a,...o},l)=>J.createElement("svg",{ref:l,...Kwe,width:e,height:e,stroke:t,strokeWidth:r?Number(i)*24/Number(e):i,className:lse("lucide",n),...o},[...a.map(([c,u])=>J.createElement(c,u)),...Array.isArray(s)?s:[s]]));/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Bi=(t,e)=>{const i=J.forwardRef(({className:r,...n},s)=>J.createElement(Zwe,{ref:s,iconNode:e,className:lse(`lucide-${$we(W9(t))}`,`lucide-${t}`,r),...n}));return i.displayName=W9(t),i};/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qwe=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]],Jwe=Bi("arrow-right",Qwe);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const e1e=[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["path",{d:"M20.2 20.2c2.04-2.03.02-7.36-4.5-11.9-4.54-4.52-9.87-6.54-11.9-4.5-2.04 2.03-.02 7.36 4.5 11.9 4.54 4.52 9.87 6.54 11.9 4.5Z",key:"1l2ple"}],["path",{d:"M15.7 15.7c4.52-4.54 6.54-9.87 4.5-11.9-2.03-2.04-7.36-.02-11.9 4.5-4.52 4.54-6.54 9.87-4.5 11.9 2.03 2.04 7.36.02 11.9-4.5Z",key:"1wam0m"}]],cse=Bi("atom",e1e);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const t1e=[["path",{d:"m15.477 12.89 1.515 8.526a.5.5 0 0 1-.81.47l-3.58-2.687a1 1 0 0 0-1.197 0l-3.586 2.686a.5.5 0 0 1-.81-.469l1.514-8.526",key:"1yiouv"}],["circle",{cx:"12",cy:"8",r:"6",key:"1vp47v"}]],i1e=Bi("award",t1e);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const r1e=[["path",{d:"M10.268 21a2 2 0 0 0 3.464 0",key:"vwvbt9"}],["path",{d:"M22 8c0-2.3-.8-4.3-2-6",key:"5bb3ad"}],["path",{d:"M3.262 15.326A1 1 0 0 0 4 17h16a1 1 0 0 0 .74-1.673C19.41 13.956 18 12.499 18 8A6 6 0 0 0 6 8c0 4.499-1.411 5.956-2.738 7.326",key:"11g9vi"}],["path",{d:"M4 2C2.8 3.7 2 5.7 2 8",key:"tap9e0"}]],q9=Bi("bell-ring",r1e);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const n1e=[["path",{d:"M12 7v14",key:"1akyts"}],["path",{d:"M3 18a1 1 0 0 1-1-1V4a1 1 0 0 1 1-1h5a4 4 0 0 1 4 4 4 4 0 0 1 4-4h5a1 1 0 0 1 1 1v13a1 1 0 0 1-1 1h-6a3 3 0 0 0-3 3 3 3 0 0 0-3-3z",key:"ruj8y"}]],oA=Bi("book-open",n1e);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const s1e=[["path",{d:"M12 8V4H8",key:"hb8ula"}],["rect",{width:"16",height:"12",x:"4",y:"8",rx:"2",key:"enze0r"}],["path",{d:"M2 14h2",key:"vft8re"}],["path",{d:"M20 14h2",key:"4cs60a"}],["path",{d:"M15 13v2",key:"1xurst"}],["path",{d:"M9 13v2",key:"rq6x2g"}]],YC=Bi("bot",s1e);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const a1e=[["path",{d:"M12 5a3 3 0 1 0-5.997.125 4 4 0 0 0-2.526 5.77 4 4 0 0 0 .556 6.588A4 4 0 1 0 12 18Z",key:"l5xja"}],["path",{d:"M12 5a3 3 0 1 1 5.997.125 4 4 0 0 1 2.526 5.77 4 4 0 0 1-.556 6.588A4 4 0 1 1 12 18Z",key:"ep3f8r"}],["path",{d:"M15 13a4.5 4.5 0 0 1-3-4 4.5 4.5 0 0 1-3 4",key:"1p4c4q"}],["path",{d:"M17.599 6.5a3 3 0 0 0 .399-1.375",key:"tmeiqw"}],["path",{d:"M6.003 5.125A3 3 0 0 0 6.401 6.5",key:"105sqy"}],["path",{d:"M3.477 10.896a4 4 0 0 1 .585-.396",key:"ql3yin"}],["path",{d:"M19.938 10.5a4 4 0 0 1 .585.396",key:"1qfode"}],["path",{d:"M6 18a4 4 0 0 1-1.967-.516",key:"2e4loj"}],["path",{d:"M19.967 17.484A4 4 0 0 1 18 18",key:"159ez6"}]],ss=Bi("brain",a1e);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const o1e=[["path",{d:"M3 3v16a2 2 0 0 0 2 2h16",key:"c24i48"}],["path",{d:"M18 17V9",key:"2bz60n"}],["path",{d:"M13 17V5",key:"1frdt8"}],["path",{d:"M8 17v-3",key:"17ska0"}]],SI=Bi("chart-column",o1e);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const l1e=[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]],c1e=Bi("check",l1e);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const u1e=[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]],rT=Bi("chevron-down",u1e);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const h1e=[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]],s6=Bi("chevron-up",h1e);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const d1e=[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]],f1e=Bi("circle-check-big",d1e);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const p1e=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3",key:"1u773s"}],["path",{d:"M12 17h.01",key:"p32p05"}]],m1e=Bi("circle-help",p1e);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const g1e=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]],X9=Bi("clock",g1e);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const v1e=[["polyline",{points:"16 18 22 12 16 6",key:"z7tu5w"}],["polyline",{points:"8 6 2 12 8 18",key:"1eg1df"}]],y1e=Bi("code",v1e);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const x1e=[["ellipse",{cx:"12",cy:"5",rx:"9",ry:"3",key:"msslwz"}],["path",{d:"M3 5V19A9 3 0 0 0 21 19V5",key:"1wlel7"}],["path",{d:"M3 12A9 3 0 0 0 21 12",key:"mv7ke4"}]],Mh=Bi("database",x1e);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const b1e=[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]],use=Bi("download",b1e);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const w1e=[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]],a6=Bi("external-link",w1e);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _1e=[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]],YA=Bi("file-text",_1e);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const S1e=[["path",{d:"M14 2v6a2 2 0 0 0 .245.96l5.51 10.08A2 2 0 0 1 18 22H6a2 2 0 0 1-1.755-2.96l5.51-10.08A2 2 0 0 0 10 8V2",key:"18mbvz"}],["path",{d:"M6.453 15h11.094",key:"3shlmq"}],["path",{d:"M8.5 2h7",key:"csnxdl"}]],E1e=Bi("flask-conical",S1e);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const A1e=[["path",{d:"M10 20a1 1 0 0 0 .553.895l2 1A1 1 0 0 0 14 21v-7a2 2 0 0 1 .517-1.341L21.74 4.67A1 1 0 0 0 21 3H3a1 1 0 0 0-.742 1.67l7.225 7.989A2 2 0 0 1 10 14z",key:"sc7q7i"}]],$9=Bi("funnel",A1e);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const M1e=[["path",{d:"M15 22v-4a4.8 4.8 0 0 0-1-3.5c3 0 6-2 6-5.5.08-1.25-.27-2.48-1-3.5.28-1.15.28-2.35 0-3.5 0 0-1 0-3 1.5-2.64-.5-5.36-.5-8 0C6 2 5 2 5 2c-.3 1.15-.3 2.35 0 3.5A5.403 5.403 0 0 0 4 9c0 3.5 3 5.5 6 5.5-.39.49-.68 1.05-.85 1.65-.17.6-.22 1.23-.15 1.85v4",key:"tonef"}],["path",{d:"M9 18c-4.51 2-5-2-7-2",key:"9comsn"}]],hse=Bi("github",M1e);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const T1e=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20",key:"13o1zl"}],["path",{d:"M2 12h20",key:"9i4pu4"}]],dse=Bi("globe",T1e);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const C1e=[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M12 7v5l4 2",key:"1fdv2h"}]],P1e=Bi("history",C1e);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const R1e=[["path",{d:"M15 21v-8a1 1 0 0 0-1-1h-4a1 1 0 0 0-1 1v8",key:"5wwlr5"}],["path",{d:"M3 10a2 2 0 0 1 .709-1.528l7-5.999a2 2 0 0 1 2.582 0l7 5.999A2 2 0 0 1 21 10v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z",key:"1d0kgt"}]],I1e=Bi("house",R1e);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const D1e=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]],O1e=Bi("image",D1e);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const L1e=[["path",{d:"M11 20A7 7 0 0 1 9.8 6.1C15.5 5 17 4.48 19 2c1 2 2 4.18 2 8 0 5.5-4.78 10-10 10Z",key:"nnexq3"}],["path",{d:"M2 21c0-3 1.85-5.36 5.08-6C9.5 14.52 12 13 13 12",key:"mt58a7"}]],k1e=Bi("leaf",L1e);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const N1e=[["path",{d:"M16 8a6 6 0 0 1 6 6v7h-4v-7a2 2 0 0 0-2-2 2 2 0 0 0-2 2v7h-4v-7a6 6 0 0 1 6-6z",key:"c2jq9f"}],["rect",{width:"4",height:"12",x:"2",y:"9",key:"mk3on5"}],["circle",{cx:"4",cy:"4",r:"2",key:"bt5ra8"}]],fse=Bi("linkedin",N1e);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const U1e=[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]],sz=Bi("loader-circle",U1e);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const B1e=[["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}],["polyline",{points:"16 17 21 12 16 7",key:"1gabdz"}],["line",{x1:"21",x2:"9",y1:"12",y2:"12",key:"1uyos4"}]],F1e=Bi("log-out",B1e);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const z1e=[["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}],["path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7",key:"1ocrg3"}]],az=Bi("mail",z1e);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const j1e=[["path",{d:"M14.106 5.553a2 2 0 0 0 1.788 0l3.659-1.83A1 1 0 0 1 21 4.619v12.764a1 1 0 0 1-.553.894l-4.553 2.277a2 2 0 0 1-1.788 0l-4.212-2.106a2 2 0 0 0-1.788 0l-3.659 1.83A1 1 0 0 1 3 19.381V6.618a1 1 0 0 1 .553-.894l4.553-2.277a2 2 0 0 1 1.788 0z",key:"169xi5"}],["path",{d:"M15 5.764v15",key:"1pn4in"}],["path",{d:"M9 3.236v15",key:"1uimfh"}]],x1=Bi("map",j1e);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const V1e=[["path",{d:"M7.9 20A9 9 0 1 0 4 16.1L2 22Z",key:"vv11sd"}]],H1e=Bi("message-circle",V1e);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const G1e=[["path",{d:"M12 2a3 3 0 0 0-3 3v7a3 3 0 0 0 6 0V5a3 3 0 0 0-3-3Z",key:"131961"}],["path",{d:"M19 10v2a7 7 0 0 1-14 0v-2",key:"1vc78b"}],["line",{x1:"12",x2:"12",y1:"19",y2:"22",key:"x3vr5v"}]],W1e=Bi("mic",G1e);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const q1e=[["circle",{cx:"13.5",cy:"6.5",r:".5",fill:"currentColor",key:"1okk4w"}],["circle",{cx:"17.5",cy:"10.5",r:".5",fill:"currentColor",key:"f64h9f"}],["circle",{cx:"8.5",cy:"7.5",r:".5",fill:"currentColor",key:"fotxhn"}],["circle",{cx:"6.5",cy:"12.5",r:".5",fill:"currentColor",key:"qy21gx"}],["path",{d:"M12 2C6.5 2 2 6.5 2 12s4.5 10 10 10c.926 0 1.648-.746 1.648-1.688 0-.437-.18-.835-.437-1.125-.29-.289-.438-.652-.438-1.125a1.64 1.64 0 0 1 1.668-1.668h1.996c3.051 0 5.555-2.503 5.555-5.554C21.965 6.012 17.461 2 12 2z",key:"12rzf8"}]],pse=Bi("palette",q1e);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const X1e=[["path",{d:"M4.5 16.5c-1.5 1.26-2 5-2 5s3.74-.5 5-2c.71-.84.7-2.13-.09-2.91a2.18 2.18 0 0 0-2.91-.09z",key:"m3kijz"}],["path",{d:"m12 15-3-3a22 22 0 0 1 2-3.95A12.88 12.88 0 0 1 22 2c0 2.72-.78 7.5-6 11a22.35 22.35 0 0 1-4 2z",key:"1fmvmk"}],["path",{d:"M9 12H4s.55-3.03 2-4c1.62-1.08 5 0 5 0",key:"1f8sc4"}],["path",{d:"M12 15v5s3.03-.55 4-2c1.08-1.62 0-5 0-5",key:"qeys4"}]],KA=Bi("rocket",X1e);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $1e=[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]],Pd=Bi("search",$1e);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Y1e=[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]],mse=Bi("send",Y1e);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const K1e=[["path",{d:"M9.937 15.5A2 2 0 0 0 8.5 14.063l-6.135-1.582a.5.5 0 0 1 0-.962L8.5 9.936A2 2 0 0 0 9.937 8.5l1.582-6.135a.5.5 0 0 1 .963 0L14.063 8.5A2 2 0 0 0 15.5 9.937l6.135 1.581a.5.5 0 0 1 0 .964L15.5 14.063a2 2 0 0 0-1.437 1.437l-1.582 6.135a.5.5 0 0 1-.963 0z",key:"4pj2yx"}],["path",{d:"M20 3v4",key:"1olli1"}],["path",{d:"M22 5h-4",key:"1gvqau"}],["path",{d:"M4 17v2",key:"vumght"}],["path",{d:"M5 18H3",key:"zchphs"}]],mu=Bi("sparkles",K1e);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Z1e=[["path",{d:"M11.525 2.295a.53.53 0 0 1 .95 0l2.31 4.679a2.123 2.123 0 0 0 1.595 1.16l5.166.756a.53.53 0 0 1 .294.904l-3.736 3.638a2.123 2.123 0 0 0-.611 1.878l.882 5.14a.53.53 0 0 1-.771.56l-4.618-2.428a2.122 2.122 0 0 0-1.973 0L6.396 21.01a.53.53 0 0 1-.77-.56l.881-5.139a2.122 2.122 0 0 0-.611-1.879L2.16 9.795a.53.53 0 0 1 .294-.906l5.165-.755a2.122 2.122 0 0 0 1.597-1.16z",key:"r04s7s"}]],oz=Bi("star",Z1e);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Q1e=[["circle",{cx:"12",cy:"12",r:"4",key:"4exip2"}],["path",{d:"M12 2v2",key:"tus03m"}],["path",{d:"M12 20v2",key:"1lh1kg"}],["path",{d:"m4.93 4.93 1.41 1.41",key:"149t6j"}],["path",{d:"m17.66 17.66 1.41 1.41",key:"ptbguv"}],["path",{d:"M2 12h2",key:"1t8f8n"}],["path",{d:"M20 12h2",key:"1q8mjw"}],["path",{d:"m6.34 17.66-1.41 1.41",key:"1m8zz5"}],["path",{d:"m19.07 4.93-1.41 1.41",key:"1shlcs"}]],J1e=Bi("sun",Q1e);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const e_e=[["path",{d:"M12.586 2.586A2 2 0 0 0 11.172 2H4a2 2 0 0 0-2 2v7.172a2 2 0 0 0 .586 1.414l8.704 8.704a2.426 2.426 0 0 0 3.42 0l6.58-6.58a2.426 2.426 0 0 0 0-3.42z",key:"vktsd0"}],["circle",{cx:"7.5",cy:"7.5",r:".5",fill:"currentColor",key:"kqv944"}]],Y9=Bi("tag",e_e);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const t_e=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"12",r:"6",key:"1vlfrh"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}]],J3=Bi("target",t_e);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const i_e=[["polyline",{points:"4 17 10 11 4 5",key:"akl6gq"}],["line",{x1:"12",x2:"20",y1:"19",y2:"19",key:"q2wloq"}]],Ok=Bi("terminal",i_e);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const r_e=[["polyline",{points:"22 7 13.5 15.5 8.5 10.5 2 17",key:"126l90"}],["polyline",{points:"16 7 22 7 22 13",key:"kwv8wd"}]],b1=Bi("trending-up",r_e);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const n_e=[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]],o6=Bi("upload",n_e);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const s_e=[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]],a_e=Bi("user",s_e);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const o_e=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]],w1=Bi("users",o_e);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const l_e=[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]],gse=Bi("x",l_e);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const c_e=[["path",{d:"M4 14a1 1 0 0 1-.78-1.63l9.9-10.2a.5.5 0 0 1 .86.46l-1.92 6.02A1 1 0 0 0 13 10h7a1 1 0 0 1 .78 1.63l-9.9 10.2a.5.5 0 0 1-.86-.46l1.92-6.02A1 1 0 0 0 11 14z",key:"1xq2db"}]],ZA=Bi("zap",c_e),u_e="modulepreload",h_e=function(t){return"/"+t},K9={},Bc=function(e,i,r){let n=Promise.resolve();if(i&&i.length>0){let a=function(c){return Promise.all(c.map(u=>Promise.resolve(u).then(h=>({status:"fulfilled",value:h}),h=>({status:"rejected",reason:h}))))};document.getElementsByTagName("link");const o=document.querySelector("meta[property=csp-nonce]"),l=o?.nonce||o?.getAttribute("nonce");n=a(i.map(c=>{if(c=h_e(c),c in K9)return;K9[c]=!0;const u=c.endsWith(".css"),h=u?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${c}"]${h}`))return;const d=document.createElement("link");if(d.rel=u?"stylesheet":u_e,u||(d.as="script"),d.crossOrigin="",d.href=c,l&&d.setAttribute("nonce",l),document.head.appendChild(d),u)return new Promise((f,p)=>{d.addEventListener("load",f),d.addEventListener("error",()=>p(new Error(`Unable to preload CSS for ${c}`)))})}))}function s(a){const o=new Event("vite:preloadError",{cancelable:!0});if(o.payload=a,window.dispatchEvent(o),!o.defaultPrevented)throw a}return n.then(a=>{for(const o of a||[])o.status==="rejected"&&s(o.reason);return e().catch(s)})},d_e=t=>{let e;return t?e=t:typeof fetch>"u"?e=(...i)=>Bc(async()=>{const{default:r}=await Promise.resolve().then(()=>l_);return{default:r}},void 0).then(({default:r})=>r(...i)):e=fetch,(...i)=>e(...i)};class l6 extends Error{constructor(e,i="FunctionsError",r){super(e),this.name=i,this.context=r}}class Z9 extends l6{constructor(e){super("Failed to send a request to the Edge Function","FunctionsFetchError",e)}}class Q9 extends l6{constructor(e){super("Relay Error invoking the Edge Function","FunctionsRelayError",e)}}class J9 extends l6{constructor(e){super("Edge Function returned a non-2xx status code","FunctionsHttpError",e)}}var lz;(function(t){t.Any="any",t.ApNortheast1="ap-northeast-1",t.ApNortheast2="ap-northeast-2",t.ApSouth1="ap-south-1",t.ApSoutheast1="ap-southeast-1",t.ApSoutheast2="ap-southeast-2",t.CaCentral1="ca-central-1",t.EuCentral1="eu-central-1",t.EuWest1="eu-west-1",t.EuWest2="eu-west-2",t.EuWest3="eu-west-3",t.SaEast1="sa-east-1",t.UsEast1="us-east-1",t.UsWest1="us-west-1",t.UsWest2="us-west-2"})(lz||(lz={}));var f_e=function(t,e,i,r){function n(s){return s instanceof i?s:new i(function(a){a(s)})}return new(i||(i=Promise))(function(s,a){function o(u){try{c(r.next(u))}catch(h){a(h)}}function l(u){try{c(r.throw(u))}catch(h){a(h)}}function c(u){u.done?s(u.value):n(u.value).then(o,l)}c((r=r.apply(t,e||[])).next())})};class p_e{constructor(e,{headers:i={},customFetch:r,region:n=lz.Any}={}){this.url=e,this.headers=i,this.region=n,this.fetch=d_e(r)}setAuth(e){this.headers.Authorization=`Bearer ${e}`}invoke(e,i={}){var r;return f_e(this,void 0,void 0,function*(){try{const{headers:n,method:s,body:a,signal:o}=i;let l={},{region:c}=i;c||(c=this.region);const u=new URL(`${this.url}/${e}`);c&&c!=="any"&&(l["x-region"]=c,u.searchParams.set("forceFunctionRegion",c));let h;a&&(n&&!Object.prototype.hasOwnProperty.call(n,"Content-Type")||!n)&&(typeof Blob<"u"&&a instanceof Blob||a instanceof ArrayBuffer?(l["Content-Type"]="application/octet-stream",h=a):typeof a=="string"?(l["Content-Type"]="text/plain",h=a):typeof FormData<"u"&&a instanceof FormData?h=a:(l["Content-Type"]="application/json",h=JSON.stringify(a)));const d=yield this.fetch(u.toString(),{method:s||"POST",headers:Object.assign(Object.assign(Object.assign({},l),this.headers),n),body:h,signal:o}).catch(m=>{throw m.name==="AbortError"?m:new Z9(m)}),f=d.headers.get("x-relay-error");if(f&&f==="true")throw new Q9(d);if(!d.ok)throw new J9(d);let p=((r=d.headers.get("Content-Type"))!==null&&r!==void 0?r:"text/plain").split(";")[0].trim(),g;return p==="application/json"?g=yield d.json():p==="application/octet-stream"?g=yield d.blob():p==="text/event-stream"?g=d:p==="multipart/form-data"?g=yield d.formData():g=yield d.text(),{data:g,error:null,response:d}}catch(n){return n instanceof Error&&n.name==="AbortError"?{data:null,error:new Z9(n)}:{data:null,error:n,response:n instanceof J9||n instanceof Q9?n.context:void 0}}})}}var Ia={},Qx={},Jx={},eb={},tb={},ib={},m_e=function(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("unable to locate global object")},_1=m_e();const g_e=_1.fetch,vse=_1.fetch.bind(_1),yse=_1.Headers,v_e=_1.Request,y_e=_1.Response,l_=Object.freeze(Object.defineProperty({__proto__:null,Headers:yse,Request:v_e,Response:y_e,default:vse,fetch:g_e},Symbol.toStringTag,{value:"Module"})),x_e=Fge(l_);var KC={},e7;function xse(){if(e7)return KC;e7=1,Object.defineProperty(KC,"__esModule",{value:!0});class t extends Error{constructor(i){super(i.message),this.name="PostgrestError",this.details=i.details,this.hint=i.hint,this.code=i.code}}return KC.default=t,KC}var t7;function bse(){if(t7)return ib;t7=1;var t=ib&&ib.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(ib,"__esModule",{value:!0});const e=t(x_e),i=t(xse());class r{constructor(s){var a,o;this.shouldThrowOnError=!1,this.method=s.method,this.url=s.url,this.headers=new Headers(s.headers),this.schema=s.schema,this.body=s.body,this.shouldThrowOnError=(a=s.shouldThrowOnError)!==null&&a!==void 0?a:!1,this.signal=s.signal,this.isMaybeSingle=(o=s.isMaybeSingle)!==null&&o!==void 0?o:!1,s.fetch?this.fetch=s.fetch:typeof fetch>"u"?this.fetch=e.default:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(s,a){return this.headers=new Headers(this.headers),this.headers.set(s,a),this}then(s,a){this.schema===void 0||(["GET","HEAD"].includes(this.method)?this.headers.set("Accept-Profile",this.schema):this.headers.set("Content-Profile",this.schema)),this.method!=="GET"&&this.method!=="HEAD"&&this.headers.set("Content-Type","application/json");const o=this.fetch;let l=o(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async c=>{var u,h,d,f;let p=null,g=null,m=null,y=c.status,b=c.statusText;if(c.ok){if(this.method!=="HEAD"){const A=await c.text();A===""||(this.headers.get("Accept")==="text/csv"||this.headers.get("Accept")&&(!((u=this.headers.get("Accept"))===null||u===void 0)&&u.includes("application/vnd.pgrst.plan+text"))?g=A:g=JSON.parse(A))}const E=(h=this.headers.get("Prefer"))===null||h===void 0?void 0:h.match(/count=(exact|planned|estimated)/),M=(d=c.headers.get("content-range"))===null||d===void 0?void 0:d.split("/");E&&M&&M.length>1&&(m=parseInt(M[1])),this.isMaybeSingle&&this.method==="GET"&&Array.isArray(g)&&(g.length>1?(p={code:"PGRST116",details:`Results contain ${g.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},g=null,m=null,y=406,b="Not Acceptable"):g.length===1?g=g[0]:g=null)}else{const E=await c.text();try{p=JSON.parse(E),Array.isArray(p)&&c.status===404&&(g=[],p=null,y=200,b="OK")}catch{c.status===404&&E===""?(y=204,b="No Content"):p={message:E}}if(p&&this.isMaybeSingle&&(!((f=p?.details)===null||f===void 0)&&f.includes("0 rows"))&&(p=null,y=200,b="OK"),p&&this.shouldThrowOnError)throw new i.default(p)}return{error:p,data:g,count:m,status:y,statusText:b}});return this.shouldThrowOnError||(l=l.catch(c=>{var u,h,d;return{error:{message:`${(u=c?.name)!==null&&u!==void 0?u:"FetchError"}: ${c?.message}`,details:`${(h=c?.stack)!==null&&h!==void 0?h:""}`,hint:"",code:`${(d=c?.code)!==null&&d!==void 0?d:""}`},data:null,count:null,status:0,statusText:""}})),l.then(s,a)}returns(){return this}overrideTypes(){return this}}return ib.default=r,ib}var i7;function wse(){if(i7)return tb;i7=1;var t=tb&&tb.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(tb,"__esModule",{value:!0});const e=t(bse());class i extends e.default{select(n){let s=!1;const a=(n??"*").split("").map(o=>/\s/.test(o)&&!s?"":(o==='"'&&(s=!s),o)).join("");return this.url.searchParams.set("select",a),this.headers.append("Prefer","return=representation"),this}order(n,{ascending:s=!0,nullsFirst:a,foreignTable:o,referencedTable:l=o}={}){const c=l?`${l}.order`:"order",u=this.url.searchParams.get(c);return this.url.searchParams.set(c,`${u?`${u},`:""}${n}.${s?"asc":"desc"}${a===void 0?"":a?".nullsfirst":".nullslast"}`),this}limit(n,{foreignTable:s,referencedTable:a=s}={}){const o=typeof a>"u"?"limit":`${a}.limit`;return this.url.searchParams.set(o,`${n}`),this}range(n,s,{foreignTable:a,referencedTable:o=a}={}){const l=typeof o>"u"?"offset":`${o}.offset`,c=typeof o>"u"?"limit":`${o}.limit`;return this.url.searchParams.set(l,`${n}`),this.url.searchParams.set(c,`${s-n+1}`),this}abortSignal(n){return this.signal=n,this}single(){return this.headers.set("Accept","application/vnd.pgrst.object+json"),this}maybeSingle(){return this.method==="GET"?this.headers.set("Accept","application/json"):this.headers.set("Accept","application/vnd.pgrst.object+json"),this.isMaybeSingle=!0,this}csv(){return this.headers.set("Accept","text/csv"),this}geojson(){return this.headers.set("Accept","application/geo+json"),this}explain({analyze:n=!1,verbose:s=!1,settings:a=!1,buffers:o=!1,wal:l=!1,format:c="text"}={}){var u;const h=[n?"analyze":null,s?"verbose":null,a?"settings":null,o?"buffers":null,l?"wal":null].filter(Boolean).join("|"),d=(u=this.headers.get("Accept"))!==null&&u!==void 0?u:"application/json";return this.headers.set("Accept",`application/vnd.pgrst.plan+${c}; for="${d}"; options=${h};`),c==="json"?this:this}rollback(){return this.headers.append("Prefer","tx=rollback"),this}returns(){return this}maxAffected(n){return this.headers.append("Prefer","handling=strict"),this.headers.append("Prefer",`max-affected=${n}`),this}}return tb.default=i,tb}var r7;function c6(){if(r7)return eb;r7=1;var t=eb&&eb.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(eb,"__esModule",{value:!0});const e=t(wse());class i extends e.default{eq(n,s){return this.url.searchParams.append(n,`eq.${s}`),this}neq(n,s){return this.url.searchParams.append(n,`neq.${s}`),this}gt(n,s){return this.url.searchParams.append(n,`gt.${s}`),this}gte(n,s){return this.url.searchParams.append(n,`gte.${s}`),this}lt(n,s){return this.url.searchParams.append(n,`lt.${s}`),this}lte(n,s){return this.url.searchParams.append(n,`lte.${s}`),this}like(n,s){return this.url.searchParams.append(n,`like.${s}`),this}likeAllOf(n,s){return this.url.searchParams.append(n,`like(all).{${s.join(",")}}`),this}likeAnyOf(n,s){return this.url.searchParams.append(n,`like(any).{${s.join(",")}}`),this}ilike(n,s){return this.url.searchParams.append(n,`ilike.${s}`),this}ilikeAllOf(n,s){return this.url.searchParams.append(n,`ilike(all).{${s.join(",")}}`),this}ilikeAnyOf(n,s){return this.url.searchParams.append(n,`ilike(any).{${s.join(",")}}`),this}is(n,s){return this.url.searchParams.append(n,`is.${s}`),this}in(n,s){const a=Array.from(new Set(s)).map(o=>typeof o=="string"&&new RegExp("[,()]").test(o)?`"${o}"`:`${o}`).join(",");return this.url.searchParams.append(n,`in.(${a})`),this}contains(n,s){return typeof s=="string"?this.url.searchParams.append(n,`cs.${s}`):Array.isArray(s)?this.url.searchParams.append(n,`cs.{${s.join(",")}}`):this.url.searchParams.append(n,`cs.${JSON.stringify(s)}`),this}containedBy(n,s){return typeof s=="string"?this.url.searchParams.append(n,`cd.${s}`):Array.isArray(s)?this.url.searchParams.append(n,`cd.{${s.join(",")}}`):this.url.searchParams.append(n,`cd.${JSON.stringify(s)}`),this}rangeGt(n,s){return this.url.searchParams.append(n,`sr.${s}`),this}rangeGte(n,s){return this.url.searchParams.append(n,`nxl.${s}`),this}rangeLt(n,s){return this.url.searchParams.append(n,`sl.${s}`),this}rangeLte(n,s){return this.url.searchParams.append(n,`nxr.${s}`),this}rangeAdjacent(n,s){return this.url.searchParams.append(n,`adj.${s}`),this}overlaps(n,s){return typeof s=="string"?this.url.searchParams.append(n,`ov.${s}`):this.url.searchParams.append(n,`ov.{${s.join(",")}}`),this}textSearch(n,s,{config:a,type:o}={}){let l="";o==="plain"?l="pl":o==="phrase"?l="ph":o==="websearch"&&(l="w");const c=a===void 0?"":`(${a})`;return this.url.searchParams.append(n,`${l}fts${c}.${s}`),this}match(n){return Object.entries(n).forEach(([s,a])=>{this.url.searchParams.append(s,`eq.${a}`)}),this}not(n,s,a){return this.url.searchParams.append(n,`not.${s}.${a}`),this}or(n,{foreignTable:s,referencedTable:a=s}={}){const o=a?`${a}.or`:"or";return this.url.searchParams.append(o,`(${n})`),this}filter(n,s,a){return this.url.searchParams.append(n,`${s}.${a}`),this}}return eb.default=i,eb}var n7;function _se(){if(n7)return Jx;n7=1;var t=Jx&&Jx.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(Jx,"__esModule",{value:!0});const e=t(c6());class i{constructor(n,{headers:s={},schema:a,fetch:o}){this.url=n,this.headers=new Headers(s),this.schema=a,this.fetch=o}select(n,{head:s=!1,count:a}={}){const o=s?"HEAD":"GET";let l=!1;const c=(n??"*").split("").map(u=>/\s/.test(u)&&!l?"":(u==='"'&&(l=!l),u)).join("");return this.url.searchParams.set("select",c),a&&this.headers.append("Prefer",`count=${a}`),new e.default({method:o,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch})}insert(n,{count:s,defaultToNull:a=!0}={}){var o;const l="POST";if(s&&this.headers.append("Prefer",`count=${s}`),a||this.headers.append("Prefer","missing=default"),Array.isArray(n)){const c=n.reduce((u,h)=>u.concat(Object.keys(h)),[]);if(c.length>0){const u=[...new Set(c)].map(h=>`"${h}"`);this.url.searchParams.set("columns",u.join(","))}}return new e.default({method:l,url:this.url,headers:this.headers,schema:this.schema,body:n,fetch:(o=this.fetch)!==null&&o!==void 0?o:fetch})}upsert(n,{onConflict:s,ignoreDuplicates:a=!1,count:o,defaultToNull:l=!0}={}){var c;const u="POST";if(this.headers.append("Prefer",`resolution=${a?"ignore":"merge"}-duplicates`),s!==void 0&&this.url.searchParams.set("on_conflict",s),o&&this.headers.append("Prefer",`count=${o}`),l||this.headers.append("Prefer","missing=default"),Array.isArray(n)){const h=n.reduce((d,f)=>d.concat(Object.keys(f)),[]);if(h.length>0){const d=[...new Set(h)].map(f=>`"${f}"`);this.url.searchParams.set("columns",d.join(","))}}return new e.default({method:u,url:this.url,headers:this.headers,schema:this.schema,body:n,fetch:(c=this.fetch)!==null&&c!==void 0?c:fetch})}update(n,{count:s}={}){var a;const o="PATCH";return s&&this.headers.append("Prefer",`count=${s}`),new e.default({method:o,url:this.url,headers:this.headers,schema:this.schema,body:n,fetch:(a=this.fetch)!==null&&a!==void 0?a:fetch})}delete({count:n}={}){var s;const a="DELETE";return n&&this.headers.append("Prefer",`count=${n}`),new e.default({method:a,url:this.url,headers:this.headers,schema:this.schema,fetch:(s=this.fetch)!==null&&s!==void 0?s:fetch})}}return Jx.default=i,Jx}var s7;function b_e(){if(s7)return Qx;s7=1;var t=Qx&&Qx.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(Qx,"__esModule",{value:!0});const e=t(_se()),i=t(c6());class r{constructor(s,{headers:a={},schema:o,fetch:l}={}){this.url=s,this.headers=new Headers(a),this.schemaName=o,this.fetch=l}from(s){const a=new URL(`${this.url}/${s}`);return new e.default(a,{headers:new Headers(this.headers),schema:this.schemaName,fetch:this.fetch})}schema(s){return new r(this.url,{headers:this.headers,schema:s,fetch:this.fetch})}rpc(s,a={},{head:o=!1,get:l=!1,count:c}={}){var u;let h;const d=new URL(`${this.url}/rpc/${s}`);let f;o||l?(h=o?"HEAD":"GET",Object.entries(a).filter(([g,m])=>m!==void 0).map(([g,m])=>[g,Array.isArray(m)?`{${m.join(",")}}`:`${m}`]).forEach(([g,m])=>{d.searchParams.append(g,m)})):(h="POST",f=a);const p=new Headers(this.headers);return c&&p.set("Prefer",`count=${c}`),new i.default({method:h,url:d,headers:p,schema:this.schemaName,body:f,fetch:(u=this.fetch)!==null&&u!==void 0?u:fetch})}}return Qx.default=r,Qx}var a7;function w_e(){if(a7)return Ia;a7=1;var t=Ia&&Ia.__importDefault||function(o){return o&&o.__esModule?o:{default:o}};Object.defineProperty(Ia,"__esModule",{value:!0}),Ia.PostgrestError=Ia.PostgrestBuilder=Ia.PostgrestTransformBuilder=Ia.PostgrestFilterBuilder=Ia.PostgrestQueryBuilder=Ia.PostgrestClient=void 0;const e=t(b_e());Ia.PostgrestClient=e.default;const i=t(_se());Ia.PostgrestQueryBuilder=i.default;const r=t(c6());Ia.PostgrestFilterBuilder=r.default;const n=t(wse());Ia.PostgrestTransformBuilder=n.default;const s=t(bse());Ia.PostgrestBuilder=s.default;const a=t(xse());return Ia.PostgrestError=a.default,Ia.default={PostgrestClient:e.default,PostgrestQueryBuilder:i.default,PostgrestFilterBuilder:r.default,PostgrestTransformBuilder:n.default,PostgrestBuilder:s.default,PostgrestError:a.default},Ia}var __e=w_e();const S_e=Lh(__e),{PostgrestClient:E_e,PostgrestQueryBuilder:rgt,PostgrestFilterBuilder:ngt,PostgrestTransformBuilder:sgt,PostgrestBuilder:agt,PostgrestError:ogt}=S_e;class A_e{static detectEnvironment(){var e;if(typeof WebSocket<"u")return{type:"native",constructor:WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocket<"u")return{type:"native",constructor:globalThis.WebSocket};if(typeof global<"u"&&typeof global.WebSocket<"u")return{type:"native",constructor:global.WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocketPair<"u"&&typeof globalThis.WebSocket>"u")return{type:"cloudflare",error:"Cloudflare Workers detected. WebSocket clients are not supported in Cloudflare Workers.",workaround:"Use Cloudflare Workers WebSocket API for server-side WebSocket handling, or deploy to a different runtime."};if(typeof globalThis<"u"&&globalThis.EdgeRuntime||typeof navigator<"u"&&(!((e=navigator.userAgent)===null||e===void 0)&&e.includes("Vercel-Edge")))return{type:"unsupported",error:"Edge runtime detected (Vercel Edge/Netlify Edge). WebSockets are not supported in edge functions.",workaround:"Use serverless functions or a different deployment target for WebSocket functionality."};if(typeof process<"u"){const i=process.versions;if(i&&i.node){const r=i.node,n=parseInt(r.replace(/^v/,"").split(".")[0]);return n>=22?typeof globalThis.WebSocket<"u"?{type:"native",constructor:globalThis.WebSocket}:{type:"unsupported",error:`Node.js ${n} detected but native WebSocket not found.`,workaround:"Provide a WebSocket implementation via the transport option."}:{type:"unsupported",error:`Node.js ${n} detected without native WebSocket support.`,workaround:`For Node.js < 22, install "ws" package and provide it via the transport option:
import ws from "ws"
new RealtimeClient(url, { transport: ws })`}}}return{type:"unsupported",error:"Unknown JavaScript runtime without WebSocket support.",workaround:"Ensure you're running in a supported environment (browser, Node.js, Deno) or provide a custom WebSocket implementation."}}static getWebSocketConstructor(){const e=this.detectEnvironment();if(e.constructor)return e.constructor;let i=e.error||"WebSocket not supported in this environment.";throw e.workaround&&(i+=`

Suggested solution: ${e.workaround}`),new Error(i)}static createWebSocket(e,i){const r=this.getWebSocketConstructor();return new r(e,i)}static isWebSocketSupported(){try{const e=this.detectEnvironment();return e.type==="native"||e.type==="ws"}catch{return!1}}}const M_e="2.15.5",T_e=`realtime-js/${M_e}`,C_e="1.0.0",cz=1e4,P_e=1e3,R_e=100;var lA;(function(t){t[t.connecting=0]="connecting",t[t.open=1]="open",t[t.closing=2]="closing",t[t.closed=3]="closed"})(lA||(lA={}));var oa;(function(t){t.closed="closed",t.errored="errored",t.joined="joined",t.joining="joining",t.leaving="leaving"})(oa||(oa={}));var mh;(function(t){t.close="phx_close",t.error="phx_error",t.join="phx_join",t.reply="phx_reply",t.leave="phx_leave",t.access_token="access_token"})(mh||(mh={}));var uz;(function(t){t.websocket="websocket"})(uz||(uz={}));var zy;(function(t){t.Connecting="connecting",t.Open="open",t.Closing="closing",t.Closed="closed"})(zy||(zy={}));class I_e{constructor(){this.HEADER_LENGTH=1}decode(e,i){return e.constructor===ArrayBuffer?i(this._binaryDecode(e)):i(typeof e=="string"?JSON.parse(e):{})}_binaryDecode(e){const i=new DataView(e),r=new TextDecoder;return this._decodeBroadcast(e,i,r)}_decodeBroadcast(e,i,r){const n=i.getUint8(1),s=i.getUint8(2);let a=this.HEADER_LENGTH+2;const o=r.decode(e.slice(a,a+n));a=a+n;const l=r.decode(e.slice(a,a+s));a=a+s;const c=JSON.parse(r.decode(e.slice(a,e.byteLength)));return{ref:null,topic:o,event:l,payload:c}}}let Sse=class{constructor(e,i){this.callback=e,this.timerCalc=i,this.timer=void 0,this.tries=0,this.callback=e,this.timerCalc=i}reset(){this.tries=0,clearTimeout(this.timer),this.timer=void 0}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}};var Tn;(function(t){t.abstime="abstime",t.bool="bool",t.date="date",t.daterange="daterange",t.float4="float4",t.float8="float8",t.int2="int2",t.int4="int4",t.int4range="int4range",t.int8="int8",t.int8range="int8range",t.json="json",t.jsonb="jsonb",t.money="money",t.numeric="numeric",t.oid="oid",t.reltime="reltime",t.text="text",t.time="time",t.timestamp="timestamp",t.timestamptz="timestamptz",t.timetz="timetz",t.tsrange="tsrange",t.tstzrange="tstzrange"})(Tn||(Tn={}));const o7=(t,e,i={})=>{var r;const n=(r=i.skipTypes)!==null&&r!==void 0?r:[];return Object.keys(e).reduce((s,a)=>(s[a]=D_e(a,t,e,n),s),{})},D_e=(t,e,i,r)=>{const n=e.find(o=>o.name===t),s=n?.type,a=i[t];return s&&!r.includes(s)?Ese(s,a):hz(a)},Ese=(t,e)=>{if(t.charAt(0)==="_"){const i=t.slice(1,t.length);return N_e(e,i)}switch(t){case Tn.bool:return O_e(e);case Tn.float4:case Tn.float8:case Tn.int2:case Tn.int4:case Tn.int8:case Tn.numeric:case Tn.oid:return L_e(e);case Tn.json:case Tn.jsonb:return k_e(e);case Tn.timestamp:return U_e(e);case Tn.abstime:case Tn.date:case Tn.daterange:case Tn.int4range:case Tn.int8range:case Tn.money:case Tn.reltime:case Tn.text:case Tn.time:case Tn.timestamptz:case Tn.timetz:case Tn.tsrange:case Tn.tstzrange:return hz(e);default:return hz(e)}},hz=t=>t,O_e=t=>{switch(t){case"t":return!0;case"f":return!1;default:return t}},L_e=t=>{if(typeof t=="string"){const e=parseFloat(t);if(!Number.isNaN(e))return e}return t},k_e=t=>{if(typeof t=="string")try{return JSON.parse(t)}catch(e){return console.log(`JSON parse error: ${e}`),t}return t},N_e=(t,e)=>{if(typeof t!="string")return t;const i=t.length-1,r=t[i];if(t[0]==="{"&&r==="}"){let s;const a=t.slice(1,i);try{s=JSON.parse("["+a+"]")}catch{s=a?a.split(","):[]}return s.map(o=>Ese(e,o))}return t},U_e=t=>typeof t=="string"?t.replace(" ","T"):t,Ase=t=>{let e=t;return e=e.replace(/^ws/i,"http"),e=e.replace(/(\/socket\/websocket|\/socket|\/websocket)\/?$/i,""),e.replace(/\/+$/,"")+"/api/broadcast"};class Lk{constructor(e,i,r={},n=cz){this.channel=e,this.event=i,this.payload=r,this.timeout=n,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(e){this.timeout=e,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(e){this.payload=Object.assign(Object.assign({},this.payload),e)}receive(e,i){var r;return this._hasReceived(e)&&i((r=this.receivedResp)===null||r===void 0?void 0:r.response),this.recHooks.push({status:e,callback:i}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);const e=i=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=i,this._matchReceive(i)};this.channel._on(this.refEvent,{},e),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(e,i){this.refEvent&&this.channel._trigger(this.refEvent,{status:e,response:i})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:e,response:i}){this.recHooks.filter(r=>r.status===e).forEach(r=>r.callback(i))}_hasReceived(e){return this.receivedResp&&this.receivedResp.status===e}}var l7;(function(t){t.SYNC="sync",t.JOIN="join",t.LEAVE="leave"})(l7||(l7={}));class cA{constructor(e,i){this.channel=e,this.state={},this.pendingDiffs=[],this.joinRef=null,this.enabled=!1,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const r=i?.events||{state:"presence_state",diff:"presence_diff"};this.channel._on(r.state,{},n=>{const{onJoin:s,onLeave:a,onSync:o}=this.caller;this.joinRef=this.channel._joinRef(),this.state=cA.syncState(this.state,n,s,a),this.pendingDiffs.forEach(l=>{this.state=cA.syncDiff(this.state,l,s,a)}),this.pendingDiffs=[],o()}),this.channel._on(r.diff,{},n=>{const{onJoin:s,onLeave:a,onSync:o}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(n):(this.state=cA.syncDiff(this.state,n,s,a),o())}),this.onJoin((n,s,a)=>{this.channel._trigger("presence",{event:"join",key:n,currentPresences:s,newPresences:a})}),this.onLeave((n,s,a)=>{this.channel._trigger("presence",{event:"leave",key:n,currentPresences:s,leftPresences:a})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(e,i,r,n){const s=this.cloneDeep(e),a=this.transformState(i),o={},l={};return this.map(s,(c,u)=>{a[c]||(l[c]=u)}),this.map(a,(c,u)=>{const h=s[c];if(h){const d=u.map(m=>m.presence_ref),f=h.map(m=>m.presence_ref),p=u.filter(m=>f.indexOf(m.presence_ref)<0),g=h.filter(m=>d.indexOf(m.presence_ref)<0);p.length>0&&(o[c]=p),g.length>0&&(l[c]=g)}else o[c]=u}),this.syncDiff(s,{joins:o,leaves:l},r,n)}static syncDiff(e,i,r,n){const{joins:s,leaves:a}={joins:this.transformState(i.joins),leaves:this.transformState(i.leaves)};return r||(r=()=>{}),n||(n=()=>{}),this.map(s,(o,l)=>{var c;const u=(c=e[o])!==null&&c!==void 0?c:[];if(e[o]=this.cloneDeep(l),u.length>0){const h=e[o].map(f=>f.presence_ref),d=u.filter(f=>h.indexOf(f.presence_ref)<0);e[o].unshift(...d)}r(o,u,l)}),this.map(a,(o,l)=>{let c=e[o];if(!c)return;const u=l.map(h=>h.presence_ref);c=c.filter(h=>u.indexOf(h.presence_ref)<0),e[o]=c,n(o,c,l),c.length===0&&delete e[o]}),e}static map(e,i){return Object.getOwnPropertyNames(e).map(r=>i(r,e[r]))}static transformState(e){return e=this.cloneDeep(e),Object.getOwnPropertyNames(e).reduce((i,r)=>{const n=e[r];return"metas"in n?i[r]=n.metas.map(s=>(s.presence_ref=s.phx_ref,delete s.phx_ref,delete s.phx_ref_prev,s)):i[r]=n,i},{})}static cloneDeep(e){return JSON.parse(JSON.stringify(e))}onJoin(e){this.caller.onJoin=e}onLeave(e){this.caller.onLeave=e}onSync(e){this.caller.onSync=e}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}var c7;(function(t){t.ALL="*",t.INSERT="INSERT",t.UPDATE="UPDATE",t.DELETE="DELETE"})(c7||(c7={}));var uA;(function(t){t.BROADCAST="broadcast",t.PRESENCE="presence",t.POSTGRES_CHANGES="postgres_changes",t.SYSTEM="system"})(uA||(uA={}));var dp;(function(t){t.SUBSCRIBED="SUBSCRIBED",t.TIMED_OUT="TIMED_OUT",t.CLOSED="CLOSED",t.CHANNEL_ERROR="CHANNEL_ERROR"})(dp||(dp={}));class u6{constructor(e,i={config:{}},r){this.topic=e,this.params=i,this.socket=r,this.bindings={},this.state=oa.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=e.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:"",enabled:!1},private:!1},i.config),this.timeout=this.socket.timeout,this.joinPush=new Lk(this,mh.join,this.params,this.timeout),this.rejoinTimer=new Sse(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=oa.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(n=>n.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=oa.closed,this.socket._remove(this)}),this._onError(n=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,n),this.state=oa.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=oa.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("error",n=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,n),this.state=oa.errored,this.rejoinTimer.scheduleTimeout())}),this._on(mh.reply,{},(n,s)=>{this._trigger(this._replyEventName(s),n)}),this.presence=new cA(this),this.broadcastEndpointURL=Ase(this.socket.endPoint),this.private=this.params.config.private||!1}subscribe(e,i=this.timeout){var r,n,s;if(this.socket.isConnected()||this.socket.connect(),this.state==oa.closed){const{config:{broadcast:a,presence:o,private:l}}=this.params,c=(n=(r=this.bindings.postgres_changes)===null||r===void 0?void 0:r.map(f=>f.filter))!==null&&n!==void 0?n:[],u=!!this.bindings[uA.PRESENCE]&&this.bindings[uA.PRESENCE].length>0||((s=this.params.config.presence)===null||s===void 0?void 0:s.enabled)===!0,h={},d={broadcast:a,presence:Object.assign(Object.assign({},o),{enabled:u}),postgres_changes:c,private:l};this.socket.accessTokenValue&&(h.access_token=this.socket.accessTokenValue),this._onError(f=>e?.(dp.CHANNEL_ERROR,f)),this._onClose(()=>e?.(dp.CLOSED)),this.updateJoinPayload(Object.assign({config:d},h)),this.joinedOnce=!0,this._rejoin(i),this.joinPush.receive("ok",async({postgres_changes:f})=>{var p;if(this.socket.setAuth(),f===void 0){e?.(dp.SUBSCRIBED);return}else{const g=this.bindings.postgres_changes,m=(p=g?.length)!==null&&p!==void 0?p:0,y=[];for(let b=0;b<m;b++){const w=g[b],{filter:{event:E,schema:M,table:A,filter:P}}=w,C=f&&f[b];if(C&&C.event===E&&C.schema===M&&C.table===A&&C.filter===P)y.push(Object.assign(Object.assign({},w),{id:C.id}));else{this.unsubscribe(),this.state=oa.errored,e?.(dp.CHANNEL_ERROR,new Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=y,e&&e(dp.SUBSCRIBED);return}}).receive("error",f=>{this.state=oa.errored,e?.(dp.CHANNEL_ERROR,new Error(JSON.stringify(Object.values(f).join(", ")||"error")))}).receive("timeout",()=>{e?.(dp.TIMED_OUT)})}return this}presenceState(){return this.presence.state}async track(e,i={}){return await this.send({type:"presence",event:"track",payload:e},i.timeout||this.timeout)}async untrack(e={}){return await this.send({type:"presence",event:"untrack"},e)}on(e,i,r){return this.state===oa.joined&&e===uA.PRESENCE&&(this.socket.log("channel",`resubscribe to ${this.topic} due to change in presence callbacks on joined channel`),this.unsubscribe().then(()=>this.subscribe())),this._on(e,i,r)}async send(e,i={}){var r,n;if(!this._canPush()&&e.type==="broadcast"){const{event:s,payload:a}=e,l={method:"POST",headers:{Authorization:this.socket.accessTokenValue?`Bearer ${this.socket.accessTokenValue}`:"",apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:s,payload:a,private:this.private}]})};try{const c=await this._fetchWithTimeout(this.broadcastEndpointURL,l,(r=i.timeout)!==null&&r!==void 0?r:this.timeout);return await((n=c.body)===null||n===void 0?void 0:n.cancel()),c.ok?"ok":"error"}catch(c){return c.name==="AbortError"?"timed out":"error"}}else return new Promise(s=>{var a,o,l;const c=this._push(e.type,e,i.timeout||this.timeout);e.type==="broadcast"&&!(!((l=(o=(a=this.params)===null||a===void 0?void 0:a.config)===null||o===void 0?void 0:o.broadcast)===null||l===void 0)&&l.ack)&&s("ok"),c.receive("ok",()=>s("ok")),c.receive("error",()=>s("error")),c.receive("timeout",()=>s("timed out"))})}updateJoinPayload(e){this.joinPush.updatePayload(e)}unsubscribe(e=this.timeout){this.state=oa.leaving;const i=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(mh.close,"leave",this._joinRef())};this.joinPush.destroy();let r=null;return new Promise(n=>{r=new Lk(this,mh.leave,{},e),r.receive("ok",()=>{i(),n("ok")}).receive("timeout",()=>{i(),n("timed out")}).receive("error",()=>{n("error")}),r.send(),this._canPush()||r.trigger("ok",{})}).finally(()=>{r?.destroy()})}teardown(){this.pushBuffer.forEach(e=>e.destroy()),this.pushBuffer=[],this.rejoinTimer.reset(),this.joinPush.destroy(),this.state=oa.closed,this.bindings={}}async _fetchWithTimeout(e,i,r){const n=new AbortController,s=setTimeout(()=>n.abort(),r),a=await this.socket.fetch(e,Object.assign(Object.assign({},i),{signal:n.signal}));return clearTimeout(s),a}_push(e,i,r=this.timeout){if(!this.joinedOnce)throw`tried to push '${e}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let n=new Lk(this,e,i,r);return this._canPush()?n.send():this._addToPushBuffer(n),n}_addToPushBuffer(e){if(e.startTimeout(),this.pushBuffer.push(e),this.pushBuffer.length>R_e){const i=this.pushBuffer.shift();i&&(i.destroy(),this.socket.log("channel",`discarded push due to buffer overflow: ${i.event}`,i.payload))}}_onMessage(e,i,r){return i}_isMember(e){return this.topic===e}_joinRef(){return this.joinPush.ref}_trigger(e,i,r){var n,s;const a=e.toLocaleLowerCase(),{close:o,error:l,leave:c,join:u}=mh;if(r&&[o,l,c,u].indexOf(a)>=0&&r!==this._joinRef())return;let d=this._onMessage(a,i,r);if(i&&!d)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(a)?(n=this.bindings.postgres_changes)===null||n===void 0||n.filter(f=>{var p,g,m;return((p=f.filter)===null||p===void 0?void 0:p.event)==="*"||((m=(g=f.filter)===null||g===void 0?void 0:g.event)===null||m===void 0?void 0:m.toLocaleLowerCase())===a}).map(f=>f.callback(d,r)):(s=this.bindings[a])===null||s===void 0||s.filter(f=>{var p,g,m,y,b,w;if(["broadcast","presence","postgres_changes"].includes(a))if("id"in f){const E=f.id,M=(p=f.filter)===null||p===void 0?void 0:p.event;return E&&((g=i.ids)===null||g===void 0?void 0:g.includes(E))&&(M==="*"||M?.toLocaleLowerCase()===((m=i.data)===null||m===void 0?void 0:m.type.toLocaleLowerCase()))}else{const E=(b=(y=f?.filter)===null||y===void 0?void 0:y.event)===null||b===void 0?void 0:b.toLocaleLowerCase();return E==="*"||E===((w=i?.event)===null||w===void 0?void 0:w.toLocaleLowerCase())}else return f.type.toLocaleLowerCase()===a}).map(f=>{if(typeof d=="object"&&"ids"in d){const p=d.data,{schema:g,table:m,commit_timestamp:y,type:b,errors:w}=p;d=Object.assign(Object.assign({},{schema:g,table:m,commit_timestamp:y,eventType:b,new:{},old:{},errors:w}),this._getPayloadRecords(p))}f.callback(d,r)})}_isClosed(){return this.state===oa.closed}_isJoined(){return this.state===oa.joined}_isJoining(){return this.state===oa.joining}_isLeaving(){return this.state===oa.leaving}_replyEventName(e){return`chan_reply_${e}`}_on(e,i,r){const n=e.toLocaleLowerCase(),s={type:n,filter:i,callback:r};return this.bindings[n]?this.bindings[n].push(s):this.bindings[n]=[s],this}_off(e,i){const r=e.toLocaleLowerCase();return this.bindings[r]&&(this.bindings[r]=this.bindings[r].filter(n=>{var s;return!(((s=n.type)===null||s===void 0?void 0:s.toLocaleLowerCase())===r&&u6.isEqual(n.filter,i))})),this}static isEqual(e,i){if(Object.keys(e).length!==Object.keys(i).length)return!1;for(const r in e)if(e[r]!==i[r])return!1;return!0}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(e){this._on(mh.close,{},e)}_onError(e){this._on(mh.error,{},i=>e(i))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(e=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=oa.joining,this.joinPush.resend(e))}_getPayloadRecords(e){const i={new:{},old:{}};return(e.type==="INSERT"||e.type==="UPDATE")&&(i.new=o7(e.columns,e.record)),(e.type==="UPDATE"||e.type==="DELETE")&&(i.old=o7(e.columns,e.old_record)),i}}const kk=()=>{},ZC={HEARTBEAT_INTERVAL:25e3,RECONNECT_DELAY:10,HEARTBEAT_TIMEOUT_FALLBACK:100},B_e=[1e3,2e3,5e3,1e4],F_e=1e4,z_e=`
  addEventListener("message", (e) => {
    if (e.data.event === "start") {
      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);
    }
  });`;class j_e{constructor(e,i){var r;if(this.accessTokenValue=null,this.apiKey=null,this.channels=new Array,this.endPoint="",this.httpEndpoint="",this.headers={},this.params={},this.timeout=cz,this.transport=null,this.heartbeatIntervalMs=ZC.HEARTBEAT_INTERVAL,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.heartbeatCallback=kk,this.ref=0,this.reconnectTimer=null,this.logger=kk,this.conn=null,this.sendBuffer=[],this.serializer=new I_e,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._connectionState="disconnected",this._wasManualDisconnect=!1,this._authPromise=null,this._resolveFetch=n=>{let s;return n?s=n:typeof fetch>"u"?s=(...a)=>Bc(async()=>{const{default:o}=await Promise.resolve().then(()=>l_);return{default:o}},void 0).then(({default:o})=>o(...a)).catch(o=>{throw new Error(`Failed to load @supabase/node-fetch: ${o.message}. This is required for HTTP requests in Node.js environments without native fetch.`)}):s=fetch,(...a)=>s(...a)},!(!((r=i?.params)===null||r===void 0)&&r.apikey))throw new Error("API key is required to connect to Realtime");this.apiKey=i.params.apikey,this.endPoint=`${e}/${uz.websocket}`,this.httpEndpoint=Ase(e),this._initializeOptions(i),this._setupReconnectionTimer(),this.fetch=this._resolveFetch(i?.fetch)}connect(){if(!(this.isConnecting()||this.isDisconnecting()||this.conn!==null&&this.isConnected())){if(this._setConnectionState("connecting"),this._setAuthSafely("connect"),this.transport)this.conn=new this.transport(this.endpointURL());else try{this.conn=A_e.createWebSocket(this.endpointURL())}catch(e){this._setConnectionState("disconnected");const i=e.message;throw i.includes("Node.js")?new Error(`${i}

To use Realtime in Node.js, you need to provide a WebSocket implementation:

Option 1: Use Node.js 22+ which has native WebSocket support
Option 2: Install and provide the "ws" package:

  npm install ws

  import ws from "ws"
  const client = new RealtimeClient(url, {
    ...options,
    transport: ws
  })`):new Error(`WebSocket not available: ${i}`)}this._setupConnectionHandlers()}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:C_e}))}disconnect(e,i){if(!this.isDisconnecting())if(this._setConnectionState("disconnecting",!0),this.conn){const r=setTimeout(()=>{this._setConnectionState("disconnected")},100);this.conn.onclose=()=>{clearTimeout(r),this._setConnectionState("disconnected")},e?this.conn.close(e,i??""):this.conn.close(),this._teardownConnection()}else this._setConnectionState("disconnected")}getChannels(){return this.channels}async removeChannel(e){const i=await e.unsubscribe();return this.channels.length===0&&this.disconnect(),i}async removeAllChannels(){const e=await Promise.all(this.channels.map(i=>i.unsubscribe()));return this.channels=[],this.disconnect(),e}log(e,i,r){this.logger(e,i,r)}connectionState(){switch(this.conn&&this.conn.readyState){case lA.connecting:return zy.Connecting;case lA.open:return zy.Open;case lA.closing:return zy.Closing;default:return zy.Closed}}isConnected(){return this.connectionState()===zy.Open}isConnecting(){return this._connectionState==="connecting"}isDisconnecting(){return this._connectionState==="disconnecting"}channel(e,i={config:{}}){const r=`realtime:${e}`,n=this.getChannels().find(s=>s.topic===r);if(n)return n;{const s=new u6(`realtime:${e}`,i,this);return this.channels.push(s),s}}push(e){const{topic:i,event:r,payload:n,ref:s}=e,a=()=>{this.encode(e,o=>{var l;(l=this.conn)===null||l===void 0||l.send(o)})};this.log("push",`${i} ${r} (${s})`,n),this.isConnected()?a():this.sendBuffer.push(a)}async setAuth(e=null){this._authPromise=this._performAuth(e);try{await this._authPromise}finally{this._authPromise=null}}async sendHeartbeat(){var e;if(!this.isConnected()){try{this.heartbeatCallback("disconnected")}catch(i){this.log("error","error in heartbeat callback",i)}return}if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection");try{this.heartbeatCallback("timeout")}catch(i){this.log("error","error in heartbeat callback",i)}this._wasManualDisconnect=!1,(e=this.conn)===null||e===void 0||e.close(P_e,"heartbeat timeout"),setTimeout(()=>{var i;this.isConnected()||(i=this.reconnectTimer)===null||i===void 0||i.scheduleTimeout()},ZC.HEARTBEAT_TIMEOUT_FALLBACK);return}this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef});try{this.heartbeatCallback("sent")}catch(i){this.log("error","error in heartbeat callback",i)}this._setAuthSafely("heartbeat")}onHeartbeat(e){this.heartbeatCallback=e}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(e=>e()),this.sendBuffer=[])}_makeRef(){let e=this.ref+1;return e===this.ref?this.ref=0:this.ref=e,this.ref.toString()}_leaveOpenTopic(e){let i=this.channels.find(r=>r.topic===e&&(r._isJoined()||r._isJoining()));i&&(this.log("transport",`leaving duplicate topic "${e}"`),i.unsubscribe())}_remove(e){this.channels=this.channels.filter(i=>i.topic!==e.topic)}_onConnMessage(e){this.decode(e.data,i=>{if(i.topic==="phoenix"&&i.event==="phx_reply")try{this.heartbeatCallback(i.payload.status==="ok"?"ok":"error")}catch(c){this.log("error","error in heartbeat callback",c)}i.ref&&i.ref===this.pendingHeartbeatRef&&(this.pendingHeartbeatRef=null);const{topic:r,event:n,payload:s,ref:a}=i,o=a?`(${a})`:"",l=s.status||"";this.log("receive",`${l} ${r} ${n} ${o}`.trim(),s),this.channels.filter(c=>c._isMember(r)).forEach(c=>c._trigger(n,s,a)),this._triggerStateCallbacks("message",i)})}_clearTimer(e){var i;e==="heartbeat"&&this.heartbeatTimer?(clearInterval(this.heartbeatTimer),this.heartbeatTimer=void 0):e==="reconnect"&&((i=this.reconnectTimer)===null||i===void 0||i.reset())}_clearAllTimers(){this._clearTimer("heartbeat"),this._clearTimer("reconnect")}_setupConnectionHandlers(){this.conn&&("binaryType"in this.conn&&(this.conn.binaryType="arraybuffer"),this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=e=>this._onConnError(e),this.conn.onmessage=e=>this._onConnMessage(e),this.conn.onclose=e=>this._onConnClose(e))}_teardownConnection(){this.conn&&(this.conn.onopen=null,this.conn.onerror=null,this.conn.onmessage=null,this.conn.onclose=null,this.conn=null),this._clearAllTimers(),this.channels.forEach(e=>e.teardown())}_onConnOpen(){this._setConnectionState("connected"),this.log("transport",`connected to ${this.endpointURL()}`),this.flushSendBuffer(),this._clearTimer("reconnect"),this.worker?this.workerRef||this._startWorkerHeartbeat():this._startHeartbeat(),this._triggerStateCallbacks("open")}_startHeartbeat(){this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs)}_startWorkerHeartbeat(){this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");const e=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(e),this.workerRef.onerror=i=>{this.log("worker","worker error",i.message),this.workerRef.terminate()},this.workerRef.onmessage=i=>{i.data.event==="keepAlive"&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}_onConnClose(e){var i;this._setConnectionState("disconnected"),this.log("transport","close",e),this._triggerChanError(),this._clearTimer("heartbeat"),this._wasManualDisconnect||(i=this.reconnectTimer)===null||i===void 0||i.scheduleTimeout(),this._triggerStateCallbacks("close",e)}_onConnError(e){this._setConnectionState("disconnected"),this.log("transport",`${e}`),this._triggerChanError(),this._triggerStateCallbacks("error",e)}_triggerChanError(){this.channels.forEach(e=>e._trigger(mh.error))}_appendParams(e,i){if(Object.keys(i).length===0)return e;const r=e.match(/\?/)?"&":"?",n=new URLSearchParams(i);return`${e}${r}${n}`}_workerObjectUrl(e){let i;if(e)i=e;else{const r=new Blob([z_e],{type:"application/javascript"});i=URL.createObjectURL(r)}return i}_setConnectionState(e,i=!1){this._connectionState=e,e==="connecting"?this._wasManualDisconnect=!1:e==="disconnecting"&&(this._wasManualDisconnect=i)}async _performAuth(e=null){let i;e?i=e:this.accessToken?i=await this.accessToken():i=this.accessTokenValue,this.accessTokenValue!=i&&(this.accessTokenValue=i,this.channels.forEach(r=>{const n={access_token:i,version:T_e};i&&r.updateJoinPayload(n),r.joinedOnce&&r._isJoined()&&r._push(mh.access_token,{access_token:i})}))}async _waitForAuthIfNeeded(){this._authPromise&&await this._authPromise}_setAuthSafely(e="general"){this.setAuth().catch(i=>{this.log("error",`error setting auth in ${e}`,i)})}_triggerStateCallbacks(e,i){try{this.stateChangeCallbacks[e].forEach(r=>{try{r(i)}catch(n){this.log("error",`error in ${e} callback`,n)}})}catch(r){this.log("error",`error triggering ${e} callbacks`,r)}}_setupReconnectionTimer(){this.reconnectTimer=new Sse(async()=>{setTimeout(async()=>{await this._waitForAuthIfNeeded(),this.isConnected()||this.connect()},ZC.RECONNECT_DELAY)},this.reconnectAfterMs)}_initializeOptions(e){var i,r,n,s,a,o,l,c,u;if(this.transport=(i=e?.transport)!==null&&i!==void 0?i:null,this.timeout=(r=e?.timeout)!==null&&r!==void 0?r:cz,this.heartbeatIntervalMs=(n=e?.heartbeatIntervalMs)!==null&&n!==void 0?n:ZC.HEARTBEAT_INTERVAL,this.worker=(s=e?.worker)!==null&&s!==void 0?s:!1,this.accessToken=(a=e?.accessToken)!==null&&a!==void 0?a:null,this.heartbeatCallback=(o=e?.heartbeatCallback)!==null&&o!==void 0?o:kk,e?.params&&(this.params=e.params),e?.logger&&(this.logger=e.logger),(e?.logLevel||e?.log_level)&&(this.logLevel=e.logLevel||e.log_level,this.params=Object.assign(Object.assign({},this.params),{log_level:this.logLevel})),this.reconnectAfterMs=(l=e?.reconnectAfterMs)!==null&&l!==void 0?l:(h=>B_e[h-1]||F_e),this.encode=(c=e?.encode)!==null&&c!==void 0?c:((h,d)=>d(JSON.stringify(h))),this.decode=(u=e?.decode)!==null&&u!==void 0?u:this.serializer.decode.bind(this.serializer),this.worker){if(typeof window<"u"&&!window.Worker)throw new Error("Web Worker is not supported");this.workerUrl=e?.workerUrl}}}class h6 extends Error{constructor(e){super(e),this.__isStorageError=!0,this.name="StorageError"}}function ks(t){return typeof t=="object"&&t!==null&&"__isStorageError"in t}class V_e extends h6{constructor(e,i,r){super(e),this.name="StorageApiError",this.status=i,this.statusCode=r}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}}class dz extends h6{constructor(e,i){super(e),this.name="StorageUnknownError",this.originalError=i}}var H_e=function(t,e,i,r){function n(s){return s instanceof i?s:new i(function(a){a(s)})}return new(i||(i=Promise))(function(s,a){function o(u){try{c(r.next(u))}catch(h){a(h)}}function l(u){try{c(r.throw(u))}catch(h){a(h)}}function c(u){u.done?s(u.value):n(u.value).then(o,l)}c((r=r.apply(t,e||[])).next())})};const Mse=t=>{let e;return t?e=t:typeof fetch>"u"?e=(...i)=>Bc(async()=>{const{default:r}=await Promise.resolve().then(()=>l_);return{default:r}},void 0).then(({default:r})=>r(...i)):e=fetch,(...i)=>e(...i)},G_e=()=>H_e(void 0,void 0,void 0,function*(){return typeof Response>"u"?(yield Bc(()=>Promise.resolve().then(()=>l_),void 0)).Response:Response}),fz=t=>{if(Array.isArray(t))return t.map(i=>fz(i));if(typeof t=="function"||t!==Object(t))return t;const e={};return Object.entries(t).forEach(([i,r])=>{const n=i.replace(/([-_][a-z])/gi,s=>s.toUpperCase().replace(/[-_]/g,""));e[n]=fz(r)}),e},W_e=t=>{if(typeof t!="object"||t===null)return!1;const e=Object.getPrototypeOf(t);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Symbol.toStringTag in t)&&!(Symbol.iterator in t)};var H0=function(t,e,i,r){function n(s){return s instanceof i?s:new i(function(a){a(s)})}return new(i||(i=Promise))(function(s,a){function o(u){try{c(r.next(u))}catch(h){a(h)}}function l(u){try{c(r.throw(u))}catch(h){a(h)}}function c(u){u.done?s(u.value):n(u.value).then(o,l)}c((r=r.apply(t,e||[])).next())})};const Nk=t=>t.msg||t.message||t.error_description||t.error||JSON.stringify(t),q_e=(t,e,i)=>H0(void 0,void 0,void 0,function*(){const r=yield G_e();t instanceof r&&!i?.noResolveJson?t.json().then(n=>{const s=t.status||500,a=n?.statusCode||s+"";e(new V_e(Nk(n),s,a))}).catch(n=>{e(new dz(Nk(n),n))}):e(new dz(Nk(t),t))}),X_e=(t,e,i,r)=>{const n={method:t,headers:e?.headers||{}};return t==="GET"||!r?n:(W_e(r)?(n.headers=Object.assign({"Content-Type":"application/json"},e?.headers),n.body=JSON.stringify(r)):n.body=r,e?.duplex&&(n.duplex=e.duplex),Object.assign(Object.assign({},n),i))};function nT(t,e,i,r,n,s){return H0(this,void 0,void 0,function*(){return new Promise((a,o)=>{t(i,X_e(e,r,n,s)).then(l=>{if(!l.ok)throw l;return r?.noResolveJson?l:l.json()}).then(l=>a(l)).catch(l=>q_e(l,o,r))})})}function EI(t,e,i,r){return H0(this,void 0,void 0,function*(){return nT(t,"GET",e,i,r)})}function vd(t,e,i,r,n){return H0(this,void 0,void 0,function*(){return nT(t,"POST",e,r,n,i)})}function pz(t,e,i,r,n){return H0(this,void 0,void 0,function*(){return nT(t,"PUT",e,r,n,i)})}function $_e(t,e,i,r){return H0(this,void 0,void 0,function*(){return nT(t,"HEAD",e,Object.assign(Object.assign({},i),{noResolveJson:!0}),r)})}function Tse(t,e,i,r,n){return H0(this,void 0,void 0,function*(){return nT(t,"DELETE",e,r,n,i)})}var Y_e=function(t,e,i,r){function n(s){return s instanceof i?s:new i(function(a){a(s)})}return new(i||(i=Promise))(function(s,a){function o(u){try{c(r.next(u))}catch(h){a(h)}}function l(u){try{c(r.throw(u))}catch(h){a(h)}}function c(u){u.done?s(u.value):n(u.value).then(o,l)}c((r=r.apply(t,e||[])).next())})};class K_e{constructor(e,i){this.downloadFn=e,this.shouldThrowOnError=i}then(e,i){return this.execute().then(e,i)}execute(){return Y_e(this,void 0,void 0,function*(){try{return{data:(yield this.downloadFn()).body,error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(ks(e))return{data:null,error:e};throw e}})}}var Z_e=function(t,e,i,r){function n(s){return s instanceof i?s:new i(function(a){a(s)})}return new(i||(i=Promise))(function(s,a){function o(u){try{c(r.next(u))}catch(h){a(h)}}function l(u){try{c(r.throw(u))}catch(h){a(h)}}function c(u){u.done?s(u.value):n(u.value).then(o,l)}c((r=r.apply(t,e||[])).next())})};class Q_e{constructor(e,i){this.downloadFn=e,this.shouldThrowOnError=i}asStream(){return new K_e(this.downloadFn,this.shouldThrowOnError)}then(e,i){return this.execute().then(e,i)}execute(){return Z_e(this,void 0,void 0,function*(){try{return{data:yield(yield this.downloadFn()).blob(),error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(ks(e))return{data:null,error:e};throw e}})}}var Ul=function(t,e,i,r){function n(s){return s instanceof i?s:new i(function(a){a(s)})}return new(i||(i=Promise))(function(s,a){function o(u){try{c(r.next(u))}catch(h){a(h)}}function l(u){try{c(r.throw(u))}catch(h){a(h)}}function c(u){u.done?s(u.value):n(u.value).then(o,l)}c((r=r.apply(t,e||[])).next())})};const J_e={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},u7={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};class eSe{constructor(e,i={},r,n){this.shouldThrowOnError=!1,this.url=e,this.headers=i,this.bucketId=r,this.fetch=Mse(n)}throwOnError(){return this.shouldThrowOnError=!0,this}uploadOrUpdate(e,i,r,n){return Ul(this,void 0,void 0,function*(){try{let s;const a=Object.assign(Object.assign({},u7),n);let o=Object.assign(Object.assign({},this.headers),e==="POST"&&{"x-upsert":String(a.upsert)});const l=a.metadata;typeof Blob<"u"&&r instanceof Blob?(s=new FormData,s.append("cacheControl",a.cacheControl),l&&s.append("metadata",this.encodeMetadata(l)),s.append("",r)):typeof FormData<"u"&&r instanceof FormData?(s=r,s.append("cacheControl",a.cacheControl),l&&s.append("metadata",this.encodeMetadata(l))):(s=r,o["cache-control"]=`max-age=${a.cacheControl}`,o["content-type"]=a.contentType,l&&(o["x-metadata"]=this.toBase64(this.encodeMetadata(l)))),n?.headers&&(o=Object.assign(Object.assign({},o),n.headers));const c=this._removeEmptyFolders(i),u=this._getFinalPath(c),h=yield(e=="PUT"?pz:vd)(this.fetch,`${this.url}/object/${u}`,s,Object.assign({headers:o},a?.duplex?{duplex:a.duplex}:{}));return{data:{path:c,id:h.Id,fullPath:h.Key},error:null}}catch(s){if(this.shouldThrowOnError)throw s;if(ks(s))return{data:null,error:s};throw s}})}upload(e,i,r){return Ul(this,void 0,void 0,function*(){return this.uploadOrUpdate("POST",e,i,r)})}uploadToSignedUrl(e,i,r,n){return Ul(this,void 0,void 0,function*(){const s=this._removeEmptyFolders(e),a=this._getFinalPath(s),o=new URL(this.url+`/object/upload/sign/${a}`);o.searchParams.set("token",i);try{let l;const c=Object.assign({upsert:u7.upsert},n),u=Object.assign(Object.assign({},this.headers),{"x-upsert":String(c.upsert)});typeof Blob<"u"&&r instanceof Blob?(l=new FormData,l.append("cacheControl",c.cacheControl),l.append("",r)):typeof FormData<"u"&&r instanceof FormData?(l=r,l.append("cacheControl",c.cacheControl)):(l=r,u["cache-control"]=`max-age=${c.cacheControl}`,u["content-type"]=c.contentType);const h=yield pz(this.fetch,o.toString(),l,{headers:u});return{data:{path:s,fullPath:h.Key},error:null}}catch(l){if(this.shouldThrowOnError)throw l;if(ks(l))return{data:null,error:l};throw l}})}createSignedUploadUrl(e,i){return Ul(this,void 0,void 0,function*(){try{let r=this._getFinalPath(e);const n=Object.assign({},this.headers);i?.upsert&&(n["x-upsert"]="true");const s=yield vd(this.fetch,`${this.url}/object/upload/sign/${r}`,{},{headers:n}),a=new URL(this.url+s.url),o=a.searchParams.get("token");if(!o)throw new h6("No token returned by API");return{data:{signedUrl:a.toString(),path:e,token:o},error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(ks(r))return{data:null,error:r};throw r}})}update(e,i,r){return Ul(this,void 0,void 0,function*(){return this.uploadOrUpdate("PUT",e,i,r)})}move(e,i,r){return Ul(this,void 0,void 0,function*(){try{return{data:yield vd(this.fetch,`${this.url}/object/move`,{bucketId:this.bucketId,sourceKey:e,destinationKey:i,destinationBucket:r?.destinationBucket},{headers:this.headers}),error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(ks(n))return{data:null,error:n};throw n}})}copy(e,i,r){return Ul(this,void 0,void 0,function*(){try{return{data:{path:(yield vd(this.fetch,`${this.url}/object/copy`,{bucketId:this.bucketId,sourceKey:e,destinationKey:i,destinationBucket:r?.destinationBucket},{headers:this.headers})).Key},error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(ks(n))return{data:null,error:n};throw n}})}createSignedUrl(e,i,r){return Ul(this,void 0,void 0,function*(){try{let n=this._getFinalPath(e),s=yield vd(this.fetch,`${this.url}/object/sign/${n}`,Object.assign({expiresIn:i},r?.transform?{transform:r.transform}:{}),{headers:this.headers});const a=r?.download?`&download=${r.download===!0?"":r.download}`:"";return s={signedUrl:encodeURI(`${this.url}${s.signedURL}${a}`)},{data:s,error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(ks(n))return{data:null,error:n};throw n}})}createSignedUrls(e,i,r){return Ul(this,void 0,void 0,function*(){try{const n=yield vd(this.fetch,`${this.url}/object/sign/${this.bucketId}`,{expiresIn:i,paths:e},{headers:this.headers}),s=r?.download?`&download=${r.download===!0?"":r.download}`:"";return{data:n.map(a=>Object.assign(Object.assign({},a),{signedUrl:a.signedURL?encodeURI(`${this.url}${a.signedURL}${s}`):null})),error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(ks(n))return{data:null,error:n};throw n}})}download(e,i){const n=typeof i?.transform<"u"?"render/image/authenticated":"object",s=this.transformOptsToQueryString(i?.transform||{}),a=s?`?${s}`:"",o=this._getFinalPath(e),l=()=>EI(this.fetch,`${this.url}/${n}/${o}${a}`,{headers:this.headers,noResolveJson:!0});return new Q_e(l,this.shouldThrowOnError)}info(e){return Ul(this,void 0,void 0,function*(){const i=this._getFinalPath(e);try{const r=yield EI(this.fetch,`${this.url}/object/info/${i}`,{headers:this.headers});return{data:fz(r),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(ks(r))return{data:null,error:r};throw r}})}exists(e){return Ul(this,void 0,void 0,function*(){const i=this._getFinalPath(e);try{return yield $_e(this.fetch,`${this.url}/object/${i}`,{headers:this.headers}),{data:!0,error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(ks(r)&&r instanceof dz){const n=r.originalError;if([400,404].includes(n?.status))return{data:!1,error:r}}throw r}})}getPublicUrl(e,i){const r=this._getFinalPath(e),n=[],s=i?.download?`download=${i.download===!0?"":i.download}`:"";s!==""&&n.push(s);const o=typeof i?.transform<"u"?"render/image":"object",l=this.transformOptsToQueryString(i?.transform||{});l!==""&&n.push(l);let c=n.join("&");return c!==""&&(c=`?${c}`),{data:{publicUrl:encodeURI(`${this.url}/${o}/public/${r}${c}`)}}}remove(e){return Ul(this,void 0,void 0,function*(){try{return{data:yield Tse(this.fetch,`${this.url}/object/${this.bucketId}`,{prefixes:e},{headers:this.headers}),error:null}}catch(i){if(this.shouldThrowOnError)throw i;if(ks(i))return{data:null,error:i};throw i}})}list(e,i,r){return Ul(this,void 0,void 0,function*(){try{const n=Object.assign(Object.assign(Object.assign({},J_e),i),{prefix:e||""});return{data:yield vd(this.fetch,`${this.url}/object/list/${this.bucketId}`,n,{headers:this.headers},r),error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(ks(n))return{data:null,error:n};throw n}})}listV2(e,i){return Ul(this,void 0,void 0,function*(){try{const r=Object.assign({},e);return{data:yield vd(this.fetch,`${this.url}/object/list-v2/${this.bucketId}`,r,{headers:this.headers},i),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(ks(r))return{data:null,error:r};throw r}})}encodeMetadata(e){return JSON.stringify(e)}toBase64(e){return typeof Buffer<"u"?Buffer.from(e).toString("base64"):btoa(e)}_getFinalPath(e){return`${this.bucketId}/${e.replace(/^\/+/,"")}`}_removeEmptyFolders(e){return e.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(e){const i=[];return e.width&&i.push(`width=${e.width}`),e.height&&i.push(`height=${e.height}`),e.resize&&i.push(`resize=${e.resize}`),e.format&&i.push(`format=${e.format}`),e.quality&&i.push(`quality=${e.quality}`),i.join("&")}}const tSe="2.12.2",iSe={"X-Client-Info":`storage-js/${tSe}`};var rb=function(t,e,i,r){function n(s){return s instanceof i?s:new i(function(a){a(s)})}return new(i||(i=Promise))(function(s,a){function o(u){try{c(r.next(u))}catch(h){a(h)}}function l(u){try{c(r.throw(u))}catch(h){a(h)}}function c(u){u.done?s(u.value):n(u.value).then(o,l)}c((r=r.apply(t,e||[])).next())})};class rSe{constructor(e,i={},r,n){this.shouldThrowOnError=!1;const s=new URL(e);n?.useNewHostname&&/supabase\.(co|in|red)$/.test(s.hostname)&&!s.hostname.includes("storage.supabase.")&&(s.hostname=s.hostname.replace("supabase.","storage.supabase.")),this.url=s.href,this.headers=Object.assign(Object.assign({},iSe),i),this.fetch=Mse(r)}throwOnError(){return this.shouldThrowOnError=!0,this}listBuckets(){return rb(this,void 0,void 0,function*(){try{return{data:yield EI(this.fetch,`${this.url}/bucket`,{headers:this.headers}),error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(ks(e))return{data:null,error:e};throw e}})}getBucket(e){return rb(this,void 0,void 0,function*(){try{return{data:yield EI(this.fetch,`${this.url}/bucket/${e}`,{headers:this.headers}),error:null}}catch(i){if(this.shouldThrowOnError)throw i;if(ks(i))return{data:null,error:i};throw i}})}createBucket(e,i={public:!1}){return rb(this,void 0,void 0,function*(){try{return{data:yield vd(this.fetch,`${this.url}/bucket`,{id:e,name:e,type:i.type,public:i.public,file_size_limit:i.fileSizeLimit,allowed_mime_types:i.allowedMimeTypes},{headers:this.headers}),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(ks(r))return{data:null,error:r};throw r}})}updateBucket(e,i){return rb(this,void 0,void 0,function*(){try{return{data:yield pz(this.fetch,`${this.url}/bucket/${e}`,{id:e,name:e,public:i.public,file_size_limit:i.fileSizeLimit,allowed_mime_types:i.allowedMimeTypes},{headers:this.headers}),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(ks(r))return{data:null,error:r};throw r}})}emptyBucket(e){return rb(this,void 0,void 0,function*(){try{return{data:yield vd(this.fetch,`${this.url}/bucket/${e}/empty`,{},{headers:this.headers}),error:null}}catch(i){if(this.shouldThrowOnError)throw i;if(ks(i))return{data:null,error:i};throw i}})}deleteBucket(e){return rb(this,void 0,void 0,function*(){try{return{data:yield Tse(this.fetch,`${this.url}/bucket/${e}`,{},{headers:this.headers}),error:null}}catch(i){if(this.shouldThrowOnError)throw i;if(ks(i))return{data:null,error:i};throw i}})}}class nSe extends rSe{constructor(e,i={},r,n){super(e,i,r,n)}from(e){return new eSe(this.url,this.headers,e,this.fetch)}}const sSe="2.58.0";let LE="";typeof Deno<"u"?LE="deno":typeof document<"u"?LE="web":typeof navigator<"u"&&navigator.product==="ReactNative"?LE="react-native":LE="node";const aSe={"X-Client-Info":`supabase-js-${LE}/${sSe}`},oSe={headers:aSe},lSe={schema:"public"},cSe={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},uSe={};var hSe=function(t,e,i,r){function n(s){return s instanceof i?s:new i(function(a){a(s)})}return new(i||(i=Promise))(function(s,a){function o(u){try{c(r.next(u))}catch(h){a(h)}}function l(u){try{c(r.throw(u))}catch(h){a(h)}}function c(u){u.done?s(u.value):n(u.value).then(o,l)}c((r=r.apply(t,e||[])).next())})};const dSe=t=>{let e;return t?e=t:typeof fetch>"u"?e=vse:e=fetch,(...i)=>e(...i)},fSe=()=>typeof Headers>"u"?yse:Headers,pSe=(t,e,i)=>{const r=dSe(i),n=fSe();return(s,a)=>hSe(void 0,void 0,void 0,function*(){var o;const l=(o=yield e())!==null&&o!==void 0?o:t;let c=new n(a?.headers);return c.has("apikey")||c.set("apikey",t),c.has("Authorization")||c.set("Authorization",`Bearer ${l}`),r(s,Object.assign(Object.assign({},a),{headers:c}))})};var mSe=function(t,e,i,r){function n(s){return s instanceof i?s:new i(function(a){a(s)})}return new(i||(i=Promise))(function(s,a){function o(u){try{c(r.next(u))}catch(h){a(h)}}function l(u){try{c(r.throw(u))}catch(h){a(h)}}function c(u){u.done?s(u.value):n(u.value).then(o,l)}c((r=r.apply(t,e||[])).next())})};function gSe(t){return t.endsWith("/")?t:t+"/"}function vSe(t,e){var i,r;const{db:n,auth:s,realtime:a,global:o}=t,{db:l,auth:c,realtime:u,global:h}=e,d={db:Object.assign(Object.assign({},l),n),auth:Object.assign(Object.assign({},c),s),realtime:Object.assign(Object.assign({},u),a),storage:{},global:Object.assign(Object.assign(Object.assign({},h),o),{headers:Object.assign(Object.assign({},(i=h?.headers)!==null&&i!==void 0?i:{}),(r=o?.headers)!==null&&r!==void 0?r:{})}),accessToken:()=>mSe(this,void 0,void 0,function*(){return""})};return t.accessToken?d.accessToken=t.accessToken:delete d.accessToken,d}function ySe(t){const e=t?.trim();if(!e)throw new Error("supabaseUrl is required.");if(!e.match(/^https?:\/\//i))throw new Error("Invalid supabaseUrl: Must be a valid HTTP or HTTPS URL.");try{return new URL(gSe(e))}catch{throw Error("Invalid supabaseUrl: Provided URL is malformed.")}}const Cse="2.72.0",bw=30*1e3,mz=3,Uk=mz*bw,xSe="http://localhost:9999",bSe="supabase.auth.token",wSe={"X-Client-Info":`gotrue-js/${Cse}`},gz="X-Supabase-Api-Version",Pse={"2024-01-01":{timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"}},_Se=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}$|[a-z0-9_-]{2}$)$/i,SSe=600*1e3;class d6 extends Error{constructor(e,i,r){super(e),this.__isAuthError=!0,this.name="AuthError",this.status=i,this.code=r}}function or(t){return typeof t=="object"&&t!==null&&"__isAuthError"in t}class ESe extends d6{constructor(e,i,r){super(e,i,r),this.name="AuthApiError",this.status=i,this.code=r}}function ASe(t){return or(t)&&t.name==="AuthApiError"}class Rse extends d6{constructor(e,i){super(e),this.name="AuthUnknownError",this.originalError=i}}class lv extends d6{constructor(e,i,r,n){super(e,r,n),this.name=i,this.status=r}}class og extends lv{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}function MSe(t){return or(t)&&t.name==="AuthSessionMissingError"}class BS extends lv{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class QC extends lv{constructor(e){super(e,"AuthInvalidCredentialsError",400,void 0)}}class JC extends lv{constructor(e,i=null){super(e,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=i}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}function TSe(t){return or(t)&&t.name==="AuthImplicitGrantRedirectError"}class h7 extends lv{constructor(e,i=null){super(e,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=i}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class vz extends lv{constructor(e,i){super(e,"AuthRetryableFetchError",i,void 0)}}function Bk(t){return or(t)&&t.name==="AuthRetryableFetchError"}class d7 extends lv{constructor(e,i,r){super(e,"AuthWeakPasswordError",i,"weak_password"),this.reasons=r}}class yz extends lv{constructor(e){super(e,"AuthInvalidJwtError",400,"invalid_jwt")}}const AI="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".split(""),f7=` 	
\r=`.split(""),CSe=(()=>{const t=new Array(128);for(let e=0;e<t.length;e+=1)t[e]=-1;for(let e=0;e<f7.length;e+=1)t[f7[e].charCodeAt(0)]=-2;for(let e=0;e<AI.length;e+=1)t[AI[e].charCodeAt(0)]=e;return t})();function p7(t,e,i){if(t!==null)for(e.queue=e.queue<<8|t,e.queuedBits+=8;e.queuedBits>=6;){const r=e.queue>>e.queuedBits-6&63;i(AI[r]),e.queuedBits-=6}else if(e.queuedBits>0)for(e.queue=e.queue<<6-e.queuedBits,e.queuedBits=6;e.queuedBits>=6;){const r=e.queue>>e.queuedBits-6&63;i(AI[r]),e.queuedBits-=6}}function Ise(t,e,i){const r=CSe[t];if(r>-1)for(e.queue=e.queue<<6|r,e.queuedBits+=6;e.queuedBits>=8;)i(e.queue>>e.queuedBits-8&255),e.queuedBits-=8;else{if(r===-2)return;throw new Error(`Invalid Base64-URL character "${String.fromCharCode(t)}"`)}}function m7(t){const e=[],i=a=>{e.push(String.fromCodePoint(a))},r={utf8seq:0,codepoint:0},n={queue:0,queuedBits:0},s=a=>{ISe(a,r,i)};for(let a=0;a<t.length;a+=1)Ise(t.charCodeAt(a),n,s);return e.join("")}function PSe(t,e){if(t<=127){e(t);return}else if(t<=2047){e(192|t>>6),e(128|t&63);return}else if(t<=65535){e(224|t>>12),e(128|t>>6&63),e(128|t&63);return}else if(t<=1114111){e(240|t>>18),e(128|t>>12&63),e(128|t>>6&63),e(128|t&63);return}throw new Error(`Unrecognized Unicode codepoint: ${t.toString(16)}`)}function RSe(t,e){for(let i=0;i<t.length;i+=1){let r=t.charCodeAt(i);if(r>55295&&r<=56319){const n=(r-55296)*1024&65535;r=(t.charCodeAt(i+1)-56320&65535|n)+65536,i+=1}PSe(r,e)}}function ISe(t,e,i){if(e.utf8seq===0){if(t<=127){i(t);return}for(let r=1;r<6;r+=1)if((t>>7-r&1)===0){e.utf8seq=r;break}if(e.utf8seq===2)e.codepoint=t&31;else if(e.utf8seq===3)e.codepoint=t&15;else if(e.utf8seq===4)e.codepoint=t&7;else throw new Error("Invalid UTF-8 sequence");e.utf8seq-=1}else if(e.utf8seq>0){if(t<=127)throw new Error("Invalid UTF-8 sequence");e.codepoint=e.codepoint<<6|t&63,e.utf8seq-=1,e.utf8seq===0&&i(e.codepoint)}}function DSe(t){const e=[],i={queue:0,queuedBits:0},r=n=>{e.push(n)};for(let n=0;n<t.length;n+=1)Ise(t.charCodeAt(n),i,r);return new Uint8Array(e)}function OSe(t){const e=[];return RSe(t,i=>e.push(i)),new Uint8Array(e)}function LSe(t){const e=[],i={queue:0,queuedBits:0},r=n=>{e.push(n)};return t.forEach(n=>p7(n,i,r)),p7(null,i,r),e.join("")}function kSe(t){return Math.round(Date.now()/1e3)+t}function NSe(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){const e=Math.random()*16|0;return(t=="x"?e:e&3|8).toString(16)})}const su=()=>typeof window<"u"&&typeof document<"u",oy={tested:!1,writable:!1},Dse=()=>{if(!su())return!1;try{if(typeof globalThis.localStorage!="object")return!1}catch{return!1}if(oy.tested)return oy.writable;const t=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(t,t),globalThis.localStorage.removeItem(t),oy.tested=!0,oy.writable=!0}catch{oy.tested=!0,oy.writable=!1}return oy.writable};function USe(t){const e={},i=new URL(t);if(i.hash&&i.hash[0]==="#")try{new URLSearchParams(i.hash.substring(1)).forEach((n,s)=>{e[s]=n})}catch{}return i.searchParams.forEach((r,n)=>{e[n]=r}),e}const Ose=t=>{let e;return t?e=t:typeof fetch>"u"?e=(...i)=>Bc(async()=>{const{default:r}=await Promise.resolve().then(()=>l_);return{default:r}},void 0).then(({default:r})=>r(...i)):e=fetch,(...i)=>e(...i)},BSe=t=>typeof t=="object"&&t!==null&&"status"in t&&"ok"in t&&"json"in t&&typeof t.json=="function",ww=async(t,e,i)=>{await t.setItem(e,JSON.stringify(i))},ly=async(t,e)=>{const i=await t.getItem(e);if(!i)return null;try{return JSON.parse(i)}catch{return i}},Lm=async(t,e)=>{await t.removeItem(e)};class eO{constructor(){this.promise=new eO.promiseConstructor((e,i)=>{this.resolve=e,this.reject=i})}}eO.promiseConstructor=Promise;function Fk(t){const e=t.split(".");if(e.length!==3)throw new yz("Invalid JWT structure");for(let r=0;r<e.length;r++)if(!_Se.test(e[r]))throw new yz("JWT not in base64url format");return{header:JSON.parse(m7(e[0])),payload:JSON.parse(m7(e[1])),signature:DSe(e[2]),raw:{header:e[0],payload:e[1]}}}async function FSe(t){return await new Promise(e=>{setTimeout(()=>e(null),t)})}function zSe(t,e){return new Promise((r,n)=>{(async()=>{for(let s=0;s<1/0;s++)try{const a=await t(s);if(!e(s,null,a)){r(a);return}}catch(a){if(!e(s,a)){n(a);return}}})()})}function jSe(t){return("0"+t.toString(16)).substr(-2)}function VSe(){const e=new Uint32Array(56);if(typeof crypto>"u"){const i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",r=i.length;let n="";for(let s=0;s<56;s++)n+=i.charAt(Math.floor(Math.random()*r));return n}return crypto.getRandomValues(e),Array.from(e,jSe).join("")}async function HSe(t){const i=new TextEncoder().encode(t),r=await crypto.subtle.digest("SHA-256",i),n=new Uint8Array(r);return Array.from(n).map(s=>String.fromCharCode(s)).join("")}async function GSe(t){if(!(typeof crypto<"u"&&typeof crypto.subtle<"u"&&typeof TextEncoder<"u"))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),t;const i=await HSe(t);return btoa(i).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function nb(t,e,i=!1){const r=VSe();let n=r;i&&(n+="/PASSWORD_RECOVERY"),await ww(t,`${e}-code-verifier`,n);const s=await GSe(r);return[s,r===s?"plain":"s256"]}const WSe=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;function qSe(t){const e=t.headers.get(gz);if(!e||!e.match(WSe))return null;try{return new Date(`${e}T00:00:00.0Z`)}catch{return null}}function XSe(t){if(!t)throw new Error("Missing exp claim");const e=Math.floor(Date.now()/1e3);if(t<=e)throw new Error("JWT has expired")}function $Se(t){switch(t){case"RS256":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"ES256":return{name:"ECDSA",namedCurve:"P-256",hash:{name:"SHA-256"}};default:throw new Error("Invalid alg claim")}}const YSe=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/;function sb(t){if(!YSe.test(t))throw new Error("@supabase/auth-js: Expected parameter to be UUID but is not")}function zk(){const t={};return new Proxy(t,{get:(e,i)=>{if(i==="__isUserNotAvailableProxy")return!0;if(typeof i=="symbol"){const r=i.toString();if(r==="Symbol(Symbol.toPrimitive)"||r==="Symbol(Symbol.toStringTag)"||r==="Symbol(util.inspect.custom)")return}throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Accessing the "${i}" property of the session object is not supported. Please use getUser() instead.`)},set:(e,i)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Setting the "${i}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)},deleteProperty:(e,i)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Deleting the "${i}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)}})}function g7(t){return JSON.parse(JSON.stringify(t))}var KSe=function(t,e){var i={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0&&(i[r]=t[r]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var n=0,r=Object.getOwnPropertySymbols(t);n<r.length;n++)e.indexOf(r[n])<0&&Object.prototype.propertyIsEnumerable.call(t,r[n])&&(i[r[n]]=t[r[n]]);return i};const Oy=t=>t.msg||t.message||t.error_description||t.error||JSON.stringify(t),ZSe=[502,503,504];async function v7(t){var e;if(!BSe(t))throw new vz(Oy(t),0);if(ZSe.includes(t.status))throw new vz(Oy(t),t.status);let i;try{i=await t.json()}catch(s){throw new Rse(Oy(s),s)}let r;const n=qSe(t);if(n&&n.getTime()>=Pse["2024-01-01"].timestamp&&typeof i=="object"&&i&&typeof i.code=="string"?r=i.code:typeof i=="object"&&i&&typeof i.error_code=="string"&&(r=i.error_code),r){if(r==="weak_password")throw new d7(Oy(i),t.status,((e=i.weak_password)===null||e===void 0?void 0:e.reasons)||[]);if(r==="session_not_found")throw new og}else if(typeof i=="object"&&i&&typeof i.weak_password=="object"&&i.weak_password&&Array.isArray(i.weak_password.reasons)&&i.weak_password.reasons.length&&i.weak_password.reasons.reduce((s,a)=>s&&typeof a=="string",!0))throw new d7(Oy(i),t.status,i.weak_password.reasons);throw new ESe(Oy(i),t.status||500,r)}const QSe=(t,e,i,r)=>{const n={method:t,headers:e?.headers||{}};return t==="GET"?n:(n.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},e?.headers),n.body=JSON.stringify(r),Object.assign(Object.assign({},n),i))};async function wr(t,e,i,r){var n;const s=Object.assign({},r?.headers);s[gz]||(s[gz]=Pse["2024-01-01"].name),r?.jwt&&(s.Authorization=`Bearer ${r.jwt}`);const a=(n=r?.query)!==null&&n!==void 0?n:{};r?.redirectTo&&(a.redirect_to=r.redirectTo);const o=Object.keys(a).length?"?"+new URLSearchParams(a).toString():"",l=await JSe(t,e,i+o,{headers:s,noResolveJson:r?.noResolveJson},{},r?.body);return r?.xform?r?.xform(l):{data:Object.assign({},l),error:null}}async function JSe(t,e,i,r,n,s){const a=QSe(e,r,n,s);let o;try{o=await t(i,Object.assign({},a))}catch(l){throw console.error(l),new vz(Oy(l),0)}if(o.ok||await v7(o),r?.noResolveJson)return o;try{return await o.json()}catch(l){await v7(l)}}function md(t){var e;let i=null;rEe(t)&&(i=Object.assign({},t),t.expires_at||(i.expires_at=kSe(t.expires_in)));const r=(e=t.user)!==null&&e!==void 0?e:t;return{data:{session:i,user:r},error:null}}function y7(t){const e=md(t);return!e.error&&t.weak_password&&typeof t.weak_password=="object"&&Array.isArray(t.weak_password.reasons)&&t.weak_password.reasons.length&&t.weak_password.message&&typeof t.weak_password.message=="string"&&t.weak_password.reasons.reduce((i,r)=>i&&typeof r=="string",!0)&&(e.data.weak_password=t.weak_password),e}function gg(t){var e;return{data:{user:(e=t.user)!==null&&e!==void 0?e:t},error:null}}function eEe(t){return{data:t,error:null}}function tEe(t){const{action_link:e,email_otp:i,hashed_token:r,redirect_to:n,verification_type:s}=t,a=KSe(t,["action_link","email_otp","hashed_token","redirect_to","verification_type"]),o={action_link:e,email_otp:i,hashed_token:r,redirect_to:n,verification_type:s},l=Object.assign({},a);return{data:{properties:o,user:l},error:null}}function iEe(t){return t}function rEe(t){return t.access_token&&t.refresh_token&&t.expires_in}const jk=["global","local","others"];var nEe=function(t,e){var i={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0&&(i[r]=t[r]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var n=0,r=Object.getOwnPropertySymbols(t);n<r.length;n++)e.indexOf(r[n])<0&&Object.prototype.propertyIsEnumerable.call(t,r[n])&&(i[r[n]]=t[r[n]]);return i};class sEe{constructor({url:e="",headers:i={},fetch:r}){this.url=e,this.headers=i,this.fetch=Ose(r),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)}}async signOut(e,i=jk[0]){if(jk.indexOf(i)<0)throw new Error(`@supabase/auth-js: Parameter scope must be one of ${jk.join(", ")}`);try{return await wr(this.fetch,"POST",`${this.url}/logout?scope=${i}`,{headers:this.headers,jwt:e,noResolveJson:!0}),{data:null,error:null}}catch(r){if(or(r))return{data:null,error:r};throw r}}async inviteUserByEmail(e,i={}){try{return await wr(this.fetch,"POST",`${this.url}/invite`,{body:{email:e,data:i.data},headers:this.headers,redirectTo:i.redirectTo,xform:gg})}catch(r){if(or(r))return{data:{user:null},error:r};throw r}}async generateLink(e){try{const{options:i}=e,r=nEe(e,["options"]),n=Object.assign(Object.assign({},r),i);return"newEmail"in r&&(n.new_email=r?.newEmail,delete n.newEmail),await wr(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:n,headers:this.headers,xform:tEe,redirectTo:i?.redirectTo})}catch(i){if(or(i))return{data:{properties:null,user:null},error:i};throw i}}async createUser(e){try{return await wr(this.fetch,"POST",`${this.url}/admin/users`,{body:e,headers:this.headers,xform:gg})}catch(i){if(or(i))return{data:{user:null},error:i};throw i}}async listUsers(e){var i,r,n,s,a,o,l;try{const c={nextPage:null,lastPage:0,total:0},u=await wr(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:(r=(i=e?.page)===null||i===void 0?void 0:i.toString())!==null&&r!==void 0?r:"",per_page:(s=(n=e?.perPage)===null||n===void 0?void 0:n.toString())!==null&&s!==void 0?s:""},xform:iEe});if(u.error)throw u.error;const h=await u.json(),d=(a=u.headers.get("x-total-count"))!==null&&a!==void 0?a:0,f=(l=(o=u.headers.get("link"))===null||o===void 0?void 0:o.split(","))!==null&&l!==void 0?l:[];return f.length>0&&(f.forEach(p=>{const g=parseInt(p.split(";")[0].split("=")[1].substring(0,1)),m=JSON.parse(p.split(";")[1].split("=")[1]);c[`${m}Page`]=g}),c.total=parseInt(d)),{data:Object.assign(Object.assign({},h),c),error:null}}catch(c){if(or(c))return{data:{users:[]},error:c};throw c}}async getUserById(e){sb(e);try{return await wr(this.fetch,"GET",`${this.url}/admin/users/${e}`,{headers:this.headers,xform:gg})}catch(i){if(or(i))return{data:{user:null},error:i};throw i}}async updateUserById(e,i){sb(e);try{return await wr(this.fetch,"PUT",`${this.url}/admin/users/${e}`,{body:i,headers:this.headers,xform:gg})}catch(r){if(or(r))return{data:{user:null},error:r};throw r}}async deleteUser(e,i=!1){sb(e);try{return await wr(this.fetch,"DELETE",`${this.url}/admin/users/${e}`,{headers:this.headers,body:{should_soft_delete:i},xform:gg})}catch(r){if(or(r))return{data:{user:null},error:r};throw r}}async _listFactors(e){sb(e.userId);try{const{data:i,error:r}=await wr(this.fetch,"GET",`${this.url}/admin/users/${e.userId}/factors`,{headers:this.headers,xform:n=>({data:{factors:n},error:null})});return{data:i,error:r}}catch(i){if(or(i))return{data:null,error:i};throw i}}async _deleteFactor(e){sb(e.userId),sb(e.id);try{return{data:await wr(this.fetch,"DELETE",`${this.url}/admin/users/${e.userId}/factors/${e.id}`,{headers:this.headers}),error:null}}catch(i){if(or(i))return{data:null,error:i};throw i}}}function x7(t={}){return{getItem:e=>t[e]||null,setItem:(e,i)=>{t[e]=i},removeItem:e=>{delete t[e]}}}function aEe(){if(typeof globalThis!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch{typeof self<"u"&&(self.globalThis=self)}}const ab={debug:!!(globalThis&&Dse()&&globalThis.localStorage&&globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug")==="true")};class Lse extends Error{constructor(e){super(e),this.isAcquireTimeout=!0}}class oEe extends Lse{}async function lEe(t,e,i){ab.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",t,e);const r=new globalThis.AbortController;return e>0&&setTimeout(()=>{r.abort(),ab.debug&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",t)},e),await Promise.resolve().then(()=>globalThis.navigator.locks.request(t,e===0?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:r.signal},async n=>{if(n){ab.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquired",t,n.name);try{return await i()}finally{ab.debug&&console.log("@supabase/gotrue-js: navigatorLock: released",t,n.name)}}else{if(e===0)throw ab.debug&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",t),new oEe(`Acquiring an exclusive Navigator LockManager lock "${t}" immediately failed`);if(ab.debug)try{const s=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(s,null,"  "))}catch(s){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",s)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await i()}}))}function kse(t){if(!/^0x[a-fA-F0-9]{40}$/.test(t))throw new Error(`@supabase/auth-js: Address "${t}" is invalid.`);return t.toLowerCase()}function cEe(t){return parseInt(t,16)}function uEe(t){const e=new TextEncoder().encode(t);return"0x"+Array.from(e,r=>r.toString(16).padStart(2,"0")).join("")}function hEe(t){var e;const{chainId:i,domain:r,expirationTime:n,issuedAt:s=new Date,nonce:a,notBefore:o,requestId:l,resources:c,scheme:u,uri:h,version:d}=t;{if(!Number.isInteger(i))throw new Error(`@supabase/auth-js: Invalid SIWE message field "chainId". Chain ID must be a EIP-155 chain ID. Provided value: ${i}`);if(!r)throw new Error('@supabase/auth-js: Invalid SIWE message field "domain". Domain must be provided.');if(a&&a.length<8)throw new Error(`@supabase/auth-js: Invalid SIWE message field "nonce". Nonce must be at least 8 characters. Provided value: ${a}`);if(!h)throw new Error('@supabase/auth-js: Invalid SIWE message field "uri". URI must be provided.');if(d!=="1")throw new Error(`@supabase/auth-js: Invalid SIWE message field "version". Version must be '1'. Provided value: ${d}`);if(!((e=t.statement)===null||e===void 0)&&e.includes(`
`))throw new Error(`@supabase/auth-js: Invalid SIWE message field "statement". Statement must not include '\\n'. Provided value: ${t.statement}`)}const f=kse(t.address),p=u?`${u}://${r}`:r,g=t.statement?`${t.statement}
`:"",m=`${p} wants you to sign in with your Ethereum account:
${f}

${g}`;let y=`URI: ${h}
Version: ${d}
Chain ID: ${i}${a?`
Nonce: ${a}`:""}
Issued At: ${s.toISOString()}`;if(n&&(y+=`
Expiration Time: ${n.toISOString()}`),o&&(y+=`
Not Before: ${o.toISOString()}`),l&&(y+=`
Request ID: ${l}`),c){let b=`
Resources:`;for(const w of c){if(!w||typeof w!="string")throw new Error(`@supabase/auth-js: Invalid SIWE message field "resources". Every resource must be a valid string. Provided value: ${w}`);b+=`
- ${w}`}y+=b}return`${m}
${y}`}aEe();const dEe={url:xSe,storageKey:bSe,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:wSe,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1};async function b7(t,e,i){return await i()}const ob={};class QA{constructor(e){var i,r;this.userStorage=null,this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log,this.instanceID=QA.nextInstanceID,QA.nextInstanceID+=1,this.instanceID>0&&su()&&console.warn("Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.");const n=Object.assign(Object.assign({},dEe),e);if(this.logDebugMessages=!!n.debug,typeof n.debug=="function"&&(this.logger=n.debug),this.persistSession=n.persistSession,this.storageKey=n.storageKey,this.autoRefreshToken=n.autoRefreshToken,this.admin=new sEe({url:n.url,headers:n.headers,fetch:n.fetch}),this.url=n.url,this.headers=n.headers,this.fetch=Ose(n.fetch),this.lock=n.lock||b7,this.detectSessionInUrl=n.detectSessionInUrl,this.flowType=n.flowType,this.hasCustomAuthorizationHeader=n.hasCustomAuthorizationHeader,n.lock?this.lock=n.lock:su()&&(!((i=globalThis?.navigator)===null||i===void 0)&&i.locks)?this.lock=lEe:this.lock=b7,this.jwks||(this.jwks={keys:[]},this.jwks_cached_at=Number.MIN_SAFE_INTEGER),this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this)},this.persistSession?(n.storage?this.storage=n.storage:Dse()?this.storage=globalThis.localStorage:(this.memoryStorage={},this.storage=x7(this.memoryStorage)),n.userStorage&&(this.userStorage=n.userStorage)):(this.memoryStorage={},this.storage=x7(this.memoryStorage)),su()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(s){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",s)}(r=this.broadcastChannel)===null||r===void 0||r.addEventListener("message",async s=>{this._debug("received broadcast notification from other tab or client",s),await this._notifyAllSubscribers(s.data.event,s.data.session,!1)})}this.initialize()}get jwks(){var e,i;return(i=(e=ob[this.storageKey])===null||e===void 0?void 0:e.jwks)!==null&&i!==void 0?i:{keys:[]}}set jwks(e){ob[this.storageKey]=Object.assign(Object.assign({},ob[this.storageKey]),{jwks:e})}get jwks_cached_at(){var e,i;return(i=(e=ob[this.storageKey])===null||e===void 0?void 0:e.cachedAt)!==null&&i!==void 0?i:Number.MIN_SAFE_INTEGER}set jwks_cached_at(e){ob[this.storageKey]=Object.assign(Object.assign({},ob[this.storageKey]),{cachedAt:e})}_debug(...e){return this.logDebugMessages&&this.logger(`GoTrueClient@${this.instanceID} (${Cse}) ${new Date().toISOString()}`,...e),this}async initialize(){return this.initializePromise?await this.initializePromise:(this.initializePromise=(async()=>await this._acquireLock(-1,async()=>await this._initialize()))(),await this.initializePromise)}async _initialize(){var e;try{const i=USe(window.location.href);let r="none";if(this._isImplicitGrantCallback(i)?r="implicit":await this._isPKCECallback(i)&&(r="pkce"),su()&&this.detectSessionInUrl&&r!=="none"){const{data:n,error:s}=await this._getSessionFromURL(i,r);if(s){if(this._debug("#_initialize()","error detecting session from URL",s),TSe(s)){const l=(e=s.details)===null||e===void 0?void 0:e.code;if(l==="identity_already_exists"||l==="identity_not_found"||l==="single_identity_not_deletable")return{error:s}}return await this._removeSession(),{error:s}}const{session:a,redirectType:o}=n;return this._debug("#_initialize()","detected session in URL",a,"redirect type",o),await this._saveSession(a),setTimeout(async()=>{o==="recovery"?await this._notifyAllSubscribers("PASSWORD_RECOVERY",a):await this._notifyAllSubscribers("SIGNED_IN",a)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(i){return or(i)?{error:i}:{error:new Rse("Unexpected error during initialization",i)}}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(e){var i,r,n;try{const s=await wr(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:(r=(i=e?.options)===null||i===void 0?void 0:i.data)!==null&&r!==void 0?r:{},gotrue_meta_security:{captcha_token:(n=e?.options)===null||n===void 0?void 0:n.captchaToken}},xform:md}),{data:a,error:o}=s;if(o||!a)return{data:{user:null,session:null},error:o};const l=a.session,c=a.user;return a.session&&(await this._saveSession(a.session),await this._notifyAllSubscribers("SIGNED_IN",l)),{data:{user:c,session:l},error:null}}catch(s){if(or(s))return{data:{user:null,session:null},error:s};throw s}}async signUp(e){var i,r,n;try{let s;if("email"in e){const{email:u,password:h,options:d}=e;let f=null,p=null;this.flowType==="pkce"&&([f,p]=await nb(this.storage,this.storageKey)),s=await wr(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:d?.emailRedirectTo,body:{email:u,password:h,data:(i=d?.data)!==null&&i!==void 0?i:{},gotrue_meta_security:{captcha_token:d?.captchaToken},code_challenge:f,code_challenge_method:p},xform:md})}else if("phone"in e){const{phone:u,password:h,options:d}=e;s=await wr(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:u,password:h,data:(r=d?.data)!==null&&r!==void 0?r:{},channel:(n=d?.channel)!==null&&n!==void 0?n:"sms",gotrue_meta_security:{captcha_token:d?.captchaToken}},xform:md})}else throw new QC("You must provide either an email or phone number and a password");const{data:a,error:o}=s;if(o||!a)return{data:{user:null,session:null},error:o};const l=a.session,c=a.user;return a.session&&(await this._saveSession(a.session),await this._notifyAllSubscribers("SIGNED_IN",l)),{data:{user:c,session:l},error:null}}catch(s){if(or(s))return{data:{user:null,session:null},error:s};throw s}}async signInWithPassword(e){try{let i;if("email"in e){const{email:s,password:a,options:o}=e;i=await wr(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:s,password:a,gotrue_meta_security:{captcha_token:o?.captchaToken}},xform:y7})}else if("phone"in e){const{phone:s,password:a,options:o}=e;i=await wr(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:s,password:a,gotrue_meta_security:{captcha_token:o?.captchaToken}},xform:y7})}else throw new QC("You must provide either an email or phone number and a password");const{data:r,error:n}=i;return n?{data:{user:null,session:null},error:n}:!r||!r.session||!r.user?{data:{user:null,session:null},error:new BS}:(r.session&&(await this._saveSession(r.session),await this._notifyAllSubscribers("SIGNED_IN",r.session)),{data:Object.assign({user:r.user,session:r.session},r.weak_password?{weakPassword:r.weak_password}:null),error:n})}catch(i){if(or(i))return{data:{user:null,session:null},error:i};throw i}}async signInWithOAuth(e){var i,r,n,s;return await this._handleProviderSignIn(e.provider,{redirectTo:(i=e.options)===null||i===void 0?void 0:i.redirectTo,scopes:(r=e.options)===null||r===void 0?void 0:r.scopes,queryParams:(n=e.options)===null||n===void 0?void 0:n.queryParams,skipBrowserRedirect:(s=e.options)===null||s===void 0?void 0:s.skipBrowserRedirect})}async exchangeCodeForSession(e){return await this.initializePromise,this._acquireLock(-1,async()=>this._exchangeCodeForSession(e))}async signInWithWeb3(e){const{chain:i}=e;switch(i){case"ethereum":return await this.signInWithEthereum(e);case"solana":return await this.signInWithSolana(e);default:throw new Error(`@supabase/auth-js: Unsupported chain "${i}"`)}}async signInWithEthereum(e){var i,r,n,s,a,o,l,c,u,h,d;let f,p;if("message"in e)f=e.message,p=e.signature;else{const{chain:g,wallet:m,statement:y,options:b}=e;let w;if(su())if(typeof m=="object")w=m;else{const R=window;if("ethereum"in R&&typeof R.ethereum=="object"&&"request"in R.ethereum&&typeof R.ethereum.request=="function")w=R.ethereum;else throw new Error("@supabase/auth-js: No compatible Ethereum wallet interface on the window object (window.ethereum) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'ethereum', wallet: resolvedUserWallet }) instead.")}else{if(typeof m!="object"||!b?.url)throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");w=m}const E=new URL((i=b?.url)!==null&&i!==void 0?i:window.location.href),M=await w.request({method:"eth_requestAccounts"}).then(R=>R).catch(()=>{throw new Error("@supabase/auth-js: Wallet method eth_requestAccounts is missing or invalid")});if(!M||M.length===0)throw new Error("@supabase/auth-js: No accounts available. Please ensure the wallet is connected.");const A=kse(M[0]);let P=(r=b?.signInWithEthereum)===null||r===void 0?void 0:r.chainId;if(!P){const R=await w.request({method:"eth_chainId"});P=cEe(R)}const C={domain:E.host,address:A,statement:y,uri:E.href,version:"1",chainId:P,nonce:(n=b?.signInWithEthereum)===null||n===void 0?void 0:n.nonce,issuedAt:(a=(s=b?.signInWithEthereum)===null||s===void 0?void 0:s.issuedAt)!==null&&a!==void 0?a:new Date,expirationTime:(o=b?.signInWithEthereum)===null||o===void 0?void 0:o.expirationTime,notBefore:(l=b?.signInWithEthereum)===null||l===void 0?void 0:l.notBefore,requestId:(c=b?.signInWithEthereum)===null||c===void 0?void 0:c.requestId,resources:(u=b?.signInWithEthereum)===null||u===void 0?void 0:u.resources};f=hEe(C),p=await w.request({method:"personal_sign",params:[uEe(f),A]})}try{const{data:g,error:m}=await wr(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"ethereum",message:f,signature:p},!((h=e.options)===null||h===void 0)&&h.captchaToken?{gotrue_meta_security:{captcha_token:(d=e.options)===null||d===void 0?void 0:d.captchaToken}}:null),xform:md});if(m)throw m;return!g||!g.session||!g.user?{data:{user:null,session:null},error:new BS}:(g.session&&(await this._saveSession(g.session),await this._notifyAllSubscribers("SIGNED_IN",g.session)),{data:Object.assign({},g),error:m})}catch(g){if(or(g))return{data:{user:null,session:null},error:g};throw g}}async signInWithSolana(e){var i,r,n,s,a,o,l,c,u,h,d,f;let p,g;if("message"in e)p=e.message,g=e.signature;else{const{chain:m,wallet:y,statement:b,options:w}=e;let E;if(su())if(typeof y=="object")E=y;else{const A=window;if("solana"in A&&typeof A.solana=="object"&&("signIn"in A.solana&&typeof A.solana.signIn=="function"||"signMessage"in A.solana&&typeof A.solana.signMessage=="function"))E=A.solana;else throw new Error("@supabase/auth-js: No compatible Solana wallet interface on the window object (window.solana) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'solana', wallet: resolvedUserWallet }) instead.")}else{if(typeof y!="object"||!w?.url)throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");E=y}const M=new URL((i=w?.url)!==null&&i!==void 0?i:window.location.href);if("signIn"in E&&E.signIn){const A=await E.signIn(Object.assign(Object.assign(Object.assign({issuedAt:new Date().toISOString()},w?.signInWithSolana),{version:"1",domain:M.host,uri:M.href}),b?{statement:b}:null));let P;if(Array.isArray(A)&&A[0]&&typeof A[0]=="object")P=A[0];else if(A&&typeof A=="object"&&"signedMessage"in A&&"signature"in A)P=A;else throw new Error("@supabase/auth-js: Wallet method signIn() returned unrecognized value");if("signedMessage"in P&&"signature"in P&&(typeof P.signedMessage=="string"||P.signedMessage instanceof Uint8Array)&&P.signature instanceof Uint8Array)p=typeof P.signedMessage=="string"?P.signedMessage:new TextDecoder().decode(P.signedMessage),g=P.signature;else throw new Error("@supabase/auth-js: Wallet method signIn() API returned object without signedMessage and signature fields")}else{if(!("signMessage"in E)||typeof E.signMessage!="function"||!("publicKey"in E)||typeof E!="object"||!E.publicKey||!("toBase58"in E.publicKey)||typeof E.publicKey.toBase58!="function")throw new Error("@supabase/auth-js: Wallet does not have a compatible signMessage() and publicKey.toBase58() API");p=[`${M.host} wants you to sign in with your Solana account:`,E.publicKey.toBase58(),...b?["",b,""]:[""],"Version: 1",`URI: ${M.href}`,`Issued At: ${(n=(r=w?.signInWithSolana)===null||r===void 0?void 0:r.issuedAt)!==null&&n!==void 0?n:new Date().toISOString()}`,...!((s=w?.signInWithSolana)===null||s===void 0)&&s.notBefore?[`Not Before: ${w.signInWithSolana.notBefore}`]:[],...!((a=w?.signInWithSolana)===null||a===void 0)&&a.expirationTime?[`Expiration Time: ${w.signInWithSolana.expirationTime}`]:[],...!((o=w?.signInWithSolana)===null||o===void 0)&&o.chainId?[`Chain ID: ${w.signInWithSolana.chainId}`]:[],...!((l=w?.signInWithSolana)===null||l===void 0)&&l.nonce?[`Nonce: ${w.signInWithSolana.nonce}`]:[],...!((c=w?.signInWithSolana)===null||c===void 0)&&c.requestId?[`Request ID: ${w.signInWithSolana.requestId}`]:[],...!((h=(u=w?.signInWithSolana)===null||u===void 0?void 0:u.resources)===null||h===void 0)&&h.length?["Resources",...w.signInWithSolana.resources.map(P=>`- ${P}`)]:[]].join(`
`);const A=await E.signMessage(new TextEncoder().encode(p),"utf8");if(!A||!(A instanceof Uint8Array))throw new Error("@supabase/auth-js: Wallet signMessage() API returned an recognized value");g=A}}try{const{data:m,error:y}=await wr(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"solana",message:p,signature:LSe(g)},!((d=e.options)===null||d===void 0)&&d.captchaToken?{gotrue_meta_security:{captcha_token:(f=e.options)===null||f===void 0?void 0:f.captchaToken}}:null),xform:md});if(y)throw y;return!m||!m.session||!m.user?{data:{user:null,session:null},error:new BS}:(m.session&&(await this._saveSession(m.session),await this._notifyAllSubscribers("SIGNED_IN",m.session)),{data:Object.assign({},m),error:y})}catch(m){if(or(m))return{data:{user:null,session:null},error:m};throw m}}async _exchangeCodeForSession(e){const i=await ly(this.storage,`${this.storageKey}-code-verifier`),[r,n]=(i??"").split("/");try{const{data:s,error:a}=await wr(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:e,code_verifier:r},xform:md});if(await Lm(this.storage,`${this.storageKey}-code-verifier`),a)throw a;return!s||!s.session||!s.user?{data:{user:null,session:null,redirectType:null},error:new BS}:(s.session&&(await this._saveSession(s.session),await this._notifyAllSubscribers("SIGNED_IN",s.session)),{data:Object.assign(Object.assign({},s),{redirectType:n??null}),error:a})}catch(s){if(or(s))return{data:{user:null,session:null,redirectType:null},error:s};throw s}}async signInWithIdToken(e){try{const{options:i,provider:r,token:n,access_token:s,nonce:a}=e,o=await wr(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:r,id_token:n,access_token:s,nonce:a,gotrue_meta_security:{captcha_token:i?.captchaToken}},xform:md}),{data:l,error:c}=o;return c?{data:{user:null,session:null},error:c}:!l||!l.session||!l.user?{data:{user:null,session:null},error:new BS}:(l.session&&(await this._saveSession(l.session),await this._notifyAllSubscribers("SIGNED_IN",l.session)),{data:l,error:c})}catch(i){if(or(i))return{data:{user:null,session:null},error:i};throw i}}async signInWithOtp(e){var i,r,n,s,a;try{if("email"in e){const{email:o,options:l}=e;let c=null,u=null;this.flowType==="pkce"&&([c,u]=await nb(this.storage,this.storageKey));const{error:h}=await wr(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:o,data:(i=l?.data)!==null&&i!==void 0?i:{},create_user:(r=l?.shouldCreateUser)!==null&&r!==void 0?r:!0,gotrue_meta_security:{captcha_token:l?.captchaToken},code_challenge:c,code_challenge_method:u},redirectTo:l?.emailRedirectTo});return{data:{user:null,session:null},error:h}}if("phone"in e){const{phone:o,options:l}=e,{data:c,error:u}=await wr(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:o,data:(n=l?.data)!==null&&n!==void 0?n:{},create_user:(s=l?.shouldCreateUser)!==null&&s!==void 0?s:!0,gotrue_meta_security:{captcha_token:l?.captchaToken},channel:(a=l?.channel)!==null&&a!==void 0?a:"sms"}});return{data:{user:null,session:null,messageId:c?.message_id},error:u}}throw new QC("You must provide either an email or phone number.")}catch(o){if(or(o))return{data:{user:null,session:null},error:o};throw o}}async verifyOtp(e){var i,r;try{let n,s;"options"in e&&(n=(i=e.options)===null||i===void 0?void 0:i.redirectTo,s=(r=e.options)===null||r===void 0?void 0:r.captchaToken);const{data:a,error:o}=await wr(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},e),{gotrue_meta_security:{captcha_token:s}}),redirectTo:n,xform:md});if(o)throw o;if(!a)throw new Error("An error occurred on token verification.");const l=a.session,c=a.user;return l?.access_token&&(await this._saveSession(l),await this._notifyAllSubscribers(e.type=="recovery"?"PASSWORD_RECOVERY":"SIGNED_IN",l)),{data:{user:c,session:l},error:null}}catch(n){if(or(n))return{data:{user:null,session:null},error:n};throw n}}async signInWithSSO(e){var i,r,n;try{let s=null,a=null;return this.flowType==="pkce"&&([s,a]=await nb(this.storage,this.storageKey)),await wr(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in e?{provider_id:e.providerId}:null),"domain"in e?{domain:e.domain}:null),{redirect_to:(r=(i=e.options)===null||i===void 0?void 0:i.redirectTo)!==null&&r!==void 0?r:void 0}),!((n=e?.options)===null||n===void 0)&&n.captchaToken?{gotrue_meta_security:{captcha_token:e.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:s,code_challenge_method:a}),headers:this.headers,xform:eEe})}catch(s){if(or(s))return{data:null,error:s};throw s}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async e=>{const{data:{session:i},error:r}=e;if(r)throw r;if(!i)throw new og;const{error:n}=await wr(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:i.access_token});return{data:{user:null,session:null},error:n}})}catch(e){if(or(e))return{data:{user:null,session:null},error:e};throw e}}async resend(e){try{const i=`${this.url}/resend`;if("email"in e){const{email:r,type:n,options:s}=e,{error:a}=await wr(this.fetch,"POST",i,{headers:this.headers,body:{email:r,type:n,gotrue_meta_security:{captcha_token:s?.captchaToken}},redirectTo:s?.emailRedirectTo});return{data:{user:null,session:null},error:a}}else if("phone"in e){const{phone:r,type:n,options:s}=e,{data:a,error:o}=await wr(this.fetch,"POST",i,{headers:this.headers,body:{phone:r,type:n,gotrue_meta_security:{captcha_token:s?.captchaToken}}});return{data:{user:null,session:null,messageId:a?.message_id},error:o}}throw new QC("You must provide either an email or phone number and a type")}catch(i){if(or(i))return{data:{user:null,session:null},error:i};throw i}}async getSession(){return await this.initializePromise,await this._acquireLock(-1,async()=>this._useSession(async i=>i))}async _acquireLock(e,i){this._debug("#_acquireLock","begin",e);try{if(this.lockAcquired){const r=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),n=(async()=>(await r,await i()))();return this.pendingInLock.push((async()=>{try{await n}catch{}})()),n}return await this.lock(`lock:${this.storageKey}`,e,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const r=i();for(this.pendingInLock.push((async()=>{try{await r}catch{}})()),await r;this.pendingInLock.length;){const n=[...this.pendingInLock];await Promise.all(n),this.pendingInLock.splice(0,n.length)}return await r}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(e){this._debug("#_useSession","begin");try{const i=await this.__loadSession();return await e(i)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",new Error().stack);try{let e=null;const i=await ly(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",i),i!==null&&(this._isValidSession(i)?e=i:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!e)return{data:{session:null},error:null};const r=e.expires_at?e.expires_at*1e3-Date.now()<Uk:!1;if(this._debug("#__loadSession()",`session has${r?"":" not"} expired`,"expires_at",e.expires_at),!r){if(this.userStorage){const a=await ly(this.userStorage,this.storageKey+"-user");a?.user?e.user=a.user:e.user=zk()}if(this.storage.isServer&&e.user){let a=this.suppressGetSessionWarning;e=new Proxy(e,{get:(l,c,u)=>(!a&&c==="user"&&(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),a=!0,this.suppressGetSessionWarning=!0),Reflect.get(l,c,u))})}return{data:{session:e},error:null}}const{session:n,error:s}=await this._callRefreshToken(e.refresh_token);return s?{data:{session:null},error:s}:{data:{session:n},error:null}}finally{this._debug("#__loadSession()","end")}}async getUser(e){return e?await this._getUser(e):(await this.initializePromise,await this._acquireLock(-1,async()=>await this._getUser()))}async _getUser(e){try{return e?await wr(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:e,xform:gg}):await this._useSession(async i=>{var r,n,s;const{data:a,error:o}=i;if(o)throw o;return!(!((r=a.session)===null||r===void 0)&&r.access_token)&&!this.hasCustomAuthorizationHeader?{data:{user:null},error:new og}:await wr(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:(s=(n=a.session)===null||n===void 0?void 0:n.access_token)!==null&&s!==void 0?s:void 0,xform:gg})})}catch(i){if(or(i))return MSe(i)&&(await this._removeSession(),await Lm(this.storage,`${this.storageKey}-code-verifier`)),{data:{user:null},error:i};throw i}}async updateUser(e,i={}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._updateUser(e,i))}async _updateUser(e,i={}){try{return await this._useSession(async r=>{const{data:n,error:s}=r;if(s)throw s;if(!n.session)throw new og;const a=n.session;let o=null,l=null;this.flowType==="pkce"&&e.email!=null&&([o,l]=await nb(this.storage,this.storageKey));const{data:c,error:u}=await wr(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:i?.emailRedirectTo,body:Object.assign(Object.assign({},e),{code_challenge:o,code_challenge_method:l}),jwt:a.access_token,xform:gg});if(u)throw u;return a.user=c.user,await this._saveSession(a),await this._notifyAllSubscribers("USER_UPDATED",a),{data:{user:a.user},error:null}})}catch(r){if(or(r))return{data:{user:null},error:r};throw r}}async setSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._setSession(e))}async _setSession(e){try{if(!e.access_token||!e.refresh_token)throw new og;const i=Date.now()/1e3;let r=i,n=!0,s=null;const{payload:a}=Fk(e.access_token);if(a.exp&&(r=a.exp,n=r<=i),n){const{session:o,error:l}=await this._callRefreshToken(e.refresh_token);if(l)return{data:{user:null,session:null},error:l};if(!o)return{data:{user:null,session:null},error:null};s=o}else{const{data:o,error:l}=await this._getUser(e.access_token);if(l)throw l;s={access_token:e.access_token,refresh_token:e.refresh_token,user:o.user,token_type:"bearer",expires_in:r-i,expires_at:r},await this._saveSession(s),await this._notifyAllSubscribers("SIGNED_IN",s)}return{data:{user:s.user,session:s},error:null}}catch(i){if(or(i))return{data:{session:null,user:null},error:i};throw i}}async refreshSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._refreshSession(e))}async _refreshSession(e){try{return await this._useSession(async i=>{var r;if(!e){const{data:a,error:o}=i;if(o)throw o;e=(r=a.session)!==null&&r!==void 0?r:void 0}if(!e?.refresh_token)throw new og;const{session:n,error:s}=await this._callRefreshToken(e.refresh_token);return s?{data:{user:null,session:null},error:s}:n?{data:{user:n.user,session:n},error:null}:{data:{user:null,session:null},error:null}})}catch(i){if(or(i))return{data:{user:null,session:null},error:i};throw i}}async _getSessionFromURL(e,i){try{if(!su())throw new JC("No browser detected.");if(e.error||e.error_description||e.error_code)throw new JC(e.error_description||"Error in URL with unspecified error_description",{error:e.error||"unspecified_error",code:e.error_code||"unspecified_code"});switch(i){case"implicit":if(this.flowType==="pkce")throw new h7("Not a valid PKCE flow url.");break;case"pkce":if(this.flowType==="implicit")throw new JC("Not a valid implicit grant flow url.");break;default:}if(i==="pkce"){if(this._debug("#_initialize()","begin","is PKCE flow",!0),!e.code)throw new h7("No code detected.");const{data:b,error:w}=await this._exchangeCodeForSession(e.code);if(w)throw w;const E=new URL(window.location.href);return E.searchParams.delete("code"),window.history.replaceState(window.history.state,"",E.toString()),{data:{session:b.session,redirectType:null},error:null}}const{provider_token:r,provider_refresh_token:n,access_token:s,refresh_token:a,expires_in:o,expires_at:l,token_type:c}=e;if(!s||!o||!a||!c)throw new JC("No session defined in URL");const u=Math.round(Date.now()/1e3),h=parseInt(o);let d=u+h;l&&(d=parseInt(l));const f=d-u;f*1e3<=bw&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${f}s, should have been closer to ${h}s`);const p=d-h;u-p>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",p,d,u):u-p<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",p,d,u);const{data:g,error:m}=await this._getUser(s);if(m)throw m;const y={provider_token:r,provider_refresh_token:n,access_token:s,expires_in:h,expires_at:d,refresh_token:a,token_type:c,user:g.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),{data:{session:y,redirectType:e.type},error:null}}catch(r){if(or(r))return{data:{session:null,redirectType:null},error:r};throw r}}_isImplicitGrantCallback(e){return!!(e.access_token||e.error_description)}async _isPKCECallback(e){const i=await ly(this.storage,`${this.storageKey}-code-verifier`);return!!(e.code&&i)}async signOut(e={scope:"global"}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._signOut(e))}async _signOut({scope:e}={scope:"global"}){return await this._useSession(async i=>{var r;const{data:n,error:s}=i;if(s)return{error:s};const a=(r=n.session)===null||r===void 0?void 0:r.access_token;if(a){const{error:o}=await this.admin.signOut(a,e);if(o&&!(ASe(o)&&(o.status===404||o.status===401||o.status===403)))return{error:o}}return e!=="others"&&(await this._removeSession(),await Lm(this.storage,`${this.storageKey}-code-verifier`)),{error:null}})}onAuthStateChange(e){const i=NSe(),r={id:i,callback:e,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",i),this.stateChangeEmitters.delete(i)}};return this._debug("#onAuthStateChange()","registered callback with id",i),this.stateChangeEmitters.set(i,r),(async()=>(await this.initializePromise,await this._acquireLock(-1,async()=>{this._emitInitialSession(i)})))(),{data:{subscription:r}}}async _emitInitialSession(e){return await this._useSession(async i=>{var r,n;try{const{data:{session:s},error:a}=i;if(a)throw a;await((r=this.stateChangeEmitters.get(e))===null||r===void 0?void 0:r.callback("INITIAL_SESSION",s)),this._debug("INITIAL_SESSION","callback id",e,"session",s)}catch(s){await((n=this.stateChangeEmitters.get(e))===null||n===void 0?void 0:n.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",e,"error",s),console.error(s)}})}async resetPasswordForEmail(e,i={}){let r=null,n=null;this.flowType==="pkce"&&([r,n]=await nb(this.storage,this.storageKey,!0));try{return await wr(this.fetch,"POST",`${this.url}/recover`,{body:{email:e,code_challenge:r,code_challenge_method:n,gotrue_meta_security:{captcha_token:i.captchaToken}},headers:this.headers,redirectTo:i.redirectTo})}catch(s){if(or(s))return{data:null,error:s};throw s}}async getUserIdentities(){var e;try{const{data:i,error:r}=await this.getUser();if(r)throw r;return{data:{identities:(e=i.user.identities)!==null&&e!==void 0?e:[]},error:null}}catch(i){if(or(i))return{data:null,error:i};throw i}}async linkIdentity(e){var i;try{const{data:r,error:n}=await this._useSession(async s=>{var a,o,l,c,u;const{data:h,error:d}=s;if(d)throw d;const f=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,e.provider,{redirectTo:(a=e.options)===null||a===void 0?void 0:a.redirectTo,scopes:(o=e.options)===null||o===void 0?void 0:o.scopes,queryParams:(l=e.options)===null||l===void 0?void 0:l.queryParams,skipBrowserRedirect:!0});return await wr(this.fetch,"GET",f,{headers:this.headers,jwt:(u=(c=h.session)===null||c===void 0?void 0:c.access_token)!==null&&u!==void 0?u:void 0})});if(n)throw n;return su()&&!(!((i=e.options)===null||i===void 0)&&i.skipBrowserRedirect)&&window.location.assign(r?.url),{data:{provider:e.provider,url:r?.url},error:null}}catch(r){if(or(r))return{data:{provider:e.provider,url:null},error:r};throw r}}async unlinkIdentity(e){try{return await this._useSession(async i=>{var r,n;const{data:s,error:a}=i;if(a)throw a;return await wr(this.fetch,"DELETE",`${this.url}/user/identities/${e.identity_id}`,{headers:this.headers,jwt:(n=(r=s.session)===null||r===void 0?void 0:r.access_token)!==null&&n!==void 0?n:void 0})})}catch(i){if(or(i))return{data:null,error:i};throw i}}async _refreshAccessToken(e){const i=`#_refreshAccessToken(${e.substring(0,5)}...)`;this._debug(i,"begin");try{const r=Date.now();return await zSe(async n=>(n>0&&await FSe(200*Math.pow(2,n-1)),this._debug(i,"refreshing attempt",n),await wr(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:e},headers:this.headers,xform:md})),(n,s)=>{const a=200*Math.pow(2,n);return s&&Bk(s)&&Date.now()+a-r<bw})}catch(r){if(this._debug(i,"error",r),or(r))return{data:{session:null,user:null},error:r};throw r}finally{this._debug(i,"end")}}_isValidSession(e){return typeof e=="object"&&e!==null&&"access_token"in e&&"refresh_token"in e&&"expires_at"in e}async _handleProviderSignIn(e,i){const r=await this._getUrlForProvider(`${this.url}/authorize`,e,{redirectTo:i.redirectTo,scopes:i.scopes,queryParams:i.queryParams});return this._debug("#_handleProviderSignIn()","provider",e,"options",i,"url",r),su()&&!i.skipBrowserRedirect&&window.location.assign(r),{data:{provider:e,url:r},error:null}}async _recoverAndRefresh(){var e,i;const r="#_recoverAndRefresh()";this._debug(r,"begin");try{const n=await ly(this.storage,this.storageKey);if(n&&this.userStorage){let a=await ly(this.userStorage,this.storageKey+"-user");!this.storage.isServer&&Object.is(this.storage,this.userStorage)&&!a&&(a={user:n.user},await ww(this.userStorage,this.storageKey+"-user",a)),n.user=(e=a?.user)!==null&&e!==void 0?e:zk()}else if(n&&!n.user&&!n.user){const a=await ly(this.storage,this.storageKey+"-user");a&&a?.user?(n.user=a.user,await Lm(this.storage,this.storageKey+"-user"),await ww(this.storage,this.storageKey,n)):n.user=zk()}if(this._debug(r,"session from storage",n),!this._isValidSession(n)){this._debug(r,"session is not valid"),n!==null&&await this._removeSession();return}const s=((i=n.expires_at)!==null&&i!==void 0?i:1/0)*1e3-Date.now()<Uk;if(this._debug(r,`session has${s?"":" not"} expired with margin of ${Uk}s`),s){if(this.autoRefreshToken&&n.refresh_token){const{error:a}=await this._callRefreshToken(n.refresh_token);a&&(console.error(a),Bk(a)||(this._debug(r,"refresh failed with a non-retryable error, removing the session",a),await this._removeSession()))}}else if(n.user&&n.user.__isUserNotAvailableProxy===!0)try{const{data:a,error:o}=await this._getUser(n.access_token);!o&&a?.user?(n.user=a.user,await this._saveSession(n),await this._notifyAllSubscribers("SIGNED_IN",n)):this._debug(r,"could not get user data, skipping SIGNED_IN notification")}catch(a){console.error("Error getting user data:",a),this._debug(r,"error getting user data, skipping SIGNED_IN notification",a)}else await this._notifyAllSubscribers("SIGNED_IN",n)}catch(n){this._debug(r,"error",n),console.error(n);return}finally{this._debug(r,"end")}}async _callRefreshToken(e){var i,r;if(!e)throw new og;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const n=`#_callRefreshToken(${e.substring(0,5)}...)`;this._debug(n,"begin");try{this.refreshingDeferred=new eO;const{data:s,error:a}=await this._refreshAccessToken(e);if(a)throw a;if(!s.session)throw new og;await this._saveSession(s.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",s.session);const o={session:s.session,error:null};return this.refreshingDeferred.resolve(o),o}catch(s){if(this._debug(n,"error",s),or(s)){const a={session:null,error:s};return Bk(s)||await this._removeSession(),(i=this.refreshingDeferred)===null||i===void 0||i.resolve(a),a}throw(r=this.refreshingDeferred)===null||r===void 0||r.reject(s),s}finally{this.refreshingDeferred=null,this._debug(n,"end")}}async _notifyAllSubscribers(e,i,r=!0){const n=`#_notifyAllSubscribers(${e})`;this._debug(n,"begin",i,`broadcast = ${r}`);try{this.broadcastChannel&&r&&this.broadcastChannel.postMessage({event:e,session:i});const s=[],a=Array.from(this.stateChangeEmitters.values()).map(async o=>{try{await o.callback(e,i)}catch(l){s.push(l)}});if(await Promise.all(a),s.length>0){for(let o=0;o<s.length;o+=1)console.error(s[o]);throw s[0]}}finally{this._debug(n,"end")}}async _saveSession(e){this._debug("#_saveSession()",e),this.suppressGetSessionWarning=!0;const i=Object.assign({},e),r=i.user&&i.user.__isUserNotAvailableProxy===!0;if(this.userStorage){!r&&i.user&&await ww(this.userStorage,this.storageKey+"-user",{user:i.user});const n=Object.assign({},i);delete n.user;const s=g7(n);await ww(this.storage,this.storageKey,s)}else{const n=g7(i);await ww(this.storage,this.storageKey,n)}}async _removeSession(){this._debug("#_removeSession()"),await Lm(this.storage,this.storageKey),await Lm(this.storage,this.storageKey+"-code-verifier"),await Lm(this.storage,this.storageKey+"-user"),this.userStorage&&await Lm(this.userStorage,this.storageKey+"-user"),await this._notifyAllSubscribers("SIGNED_OUT",null)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const e=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{e&&su()&&window?.removeEventListener&&window.removeEventListener("visibilitychange",e)}catch(i){console.error("removing visibilitychange callback failed",i)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const e=setInterval(()=>this._autoRefreshTokenTick(),bw);this.autoRefreshTicker=e,e&&typeof e=="object"&&typeof e.unref=="function"?e.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(e),setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const e=this.autoRefreshTicker;this.autoRefreshTicker=null,e&&clearInterval(e)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{const e=Date.now();try{return await this._useSession(async i=>{const{data:{session:r}}=i;if(!r||!r.refresh_token||!r.expires_at){this._debug("#_autoRefreshTokenTick()","no session");return}const n=Math.floor((r.expires_at*1e3-e)/bw);this._debug("#_autoRefreshTokenTick()",`access token expires in ${n} ticks, a tick lasts ${bw}ms, refresh threshold is ${mz} ticks`),n<=mz&&await this._callRefreshToken(r.refresh_token)})}catch(i){console.error("Auto refresh tick failed with error. This is likely a transient error.",i)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(e){if(e.isAcquireTimeout||e instanceof Lse)this._debug("auto refresh token tick lock not available");else throw e}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!su()||!window?.addEventListener)return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>await this._onVisibilityChanged(!1),window?.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(e){console.error("_handleVisibilityChange",e)}}async _onVisibilityChanged(e){const i=`#_onVisibilityChanged(${e})`;this._debug(i,"visibilityState",document.visibilityState),document.visibilityState==="visible"?(this.autoRefreshToken&&this._startAutoRefresh(),e||(await this.initializePromise,await this._acquireLock(-1,async()=>{if(document.visibilityState!=="visible"){this._debug(i,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting");return}await this._recoverAndRefresh()}))):document.visibilityState==="hidden"&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(e,i,r){const n=[`provider=${encodeURIComponent(i)}`];if(r?.redirectTo&&n.push(`redirect_to=${encodeURIComponent(r.redirectTo)}`),r?.scopes&&n.push(`scopes=${encodeURIComponent(r.scopes)}`),this.flowType==="pkce"){const[s,a]=await nb(this.storage,this.storageKey),o=new URLSearchParams({code_challenge:`${encodeURIComponent(s)}`,code_challenge_method:`${encodeURIComponent(a)}`});n.push(o.toString())}if(r?.queryParams){const s=new URLSearchParams(r.queryParams);n.push(s.toString())}return r?.skipBrowserRedirect&&n.push(`skip_http_redirect=${r.skipBrowserRedirect}`),`${e}?${n.join("&")}`}async _unenroll(e){try{return await this._useSession(async i=>{var r;const{data:n,error:s}=i;return s?{data:null,error:s}:await wr(this.fetch,"DELETE",`${this.url}/factors/${e.factorId}`,{headers:this.headers,jwt:(r=n?.session)===null||r===void 0?void 0:r.access_token})})}catch(i){if(or(i))return{data:null,error:i};throw i}}async _enroll(e){try{return await this._useSession(async i=>{var r,n;const{data:s,error:a}=i;if(a)return{data:null,error:a};const o=Object.assign({friendly_name:e.friendlyName,factor_type:e.factorType},e.factorType==="phone"?{phone:e.phone}:{issuer:e.issuer}),{data:l,error:c}=await wr(this.fetch,"POST",`${this.url}/factors`,{body:o,headers:this.headers,jwt:(r=s?.session)===null||r===void 0?void 0:r.access_token});return c?{data:null,error:c}:(e.factorType==="totp"&&(!((n=l?.totp)===null||n===void 0)&&n.qr_code)&&(l.totp.qr_code=`data:image/svg+xml;utf-8,${l.totp.qr_code}`),{data:l,error:null})})}catch(i){if(or(i))return{data:null,error:i};throw i}}async _verify(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async i=>{var r;const{data:n,error:s}=i;if(s)return{data:null,error:s};const{data:a,error:o}=await wr(this.fetch,"POST",`${this.url}/factors/${e.factorId}/verify`,{body:{code:e.code,challenge_id:e.challengeId},headers:this.headers,jwt:(r=n?.session)===null||r===void 0?void 0:r.access_token});return o?{data:null,error:o}:(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+a.expires_in},a)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",a),{data:a,error:o})})}catch(i){if(or(i))return{data:null,error:i};throw i}})}async _challenge(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async i=>{var r;const{data:n,error:s}=i;return s?{data:null,error:s}:await wr(this.fetch,"POST",`${this.url}/factors/${e.factorId}/challenge`,{body:{channel:e.channel},headers:this.headers,jwt:(r=n?.session)===null||r===void 0?void 0:r.access_token})})}catch(i){if(or(i))return{data:null,error:i};throw i}})}async _challengeAndVerify(e){const{data:i,error:r}=await this._challenge({factorId:e.factorId});return r?{data:null,error:r}:await this._verify({factorId:e.factorId,challengeId:i.id,code:e.code})}async _listFactors(){const{data:{user:e},error:i}=await this.getUser();if(i)return{data:null,error:i};const r=e?.factors||[],n=r.filter(a=>a.factor_type==="totp"&&a.status==="verified"),s=r.filter(a=>a.factor_type==="phone"&&a.status==="verified");return{data:{all:r,totp:n,phone:s},error:null}}async _getAuthenticatorAssuranceLevel(){return this._acquireLock(-1,async()=>await this._useSession(async e=>{var i,r;const{data:{session:n},error:s}=e;if(s)return{data:null,error:s};if(!n)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const{payload:a}=Fk(n.access_token);let o=null;a.aal&&(o=a.aal);let l=o;((r=(i=n.user.factors)===null||i===void 0?void 0:i.filter(h=>h.status==="verified"))!==null&&r!==void 0?r:[]).length>0&&(l="aal2");const u=a.amr||[];return{data:{currentLevel:o,nextLevel:l,currentAuthenticationMethods:u},error:null}}))}async fetchJwk(e,i={keys:[]}){let r=i.keys.find(o=>o.kid===e);if(r)return r;const n=Date.now();if(r=this.jwks.keys.find(o=>o.kid===e),r&&this.jwks_cached_at+SSe>n)return r;const{data:s,error:a}=await wr(this.fetch,"GET",`${this.url}/.well-known/jwks.json`,{headers:this.headers});if(a)throw a;return!s.keys||s.keys.length===0||(this.jwks=s,this.jwks_cached_at=n,r=s.keys.find(o=>o.kid===e),!r)?null:r}async getClaims(e,i={}){try{let r=e;if(!r){const{data:f,error:p}=await this.getSession();if(p||!f.session)return{data:null,error:p};r=f.session.access_token}const{header:n,payload:s,signature:a,raw:{header:o,payload:l}}=Fk(r);i?.allowExpired||XSe(s.exp);const c=!n.alg||n.alg.startsWith("HS")||!n.kid||!("crypto"in globalThis&&"subtle"in globalThis.crypto)?null:await this.fetchJwk(n.kid,i?.keys?{keys:i.keys}:i?.jwks);if(!c){const{error:f}=await this.getUser(r);if(f)throw f;return{data:{claims:s,header:n,signature:a},error:null}}const u=$Se(n.alg),h=await crypto.subtle.importKey("jwk",c,u,!0,["verify"]);if(!await crypto.subtle.verify(u,h,a,OSe(`${o}.${l}`)))throw new yz("Invalid JWT signature");return{data:{claims:s,header:n,signature:a},error:null}}catch(r){if(or(r))return{data:null,error:r};throw r}}}QA.nextInstanceID=0;const fEe=QA;class pEe extends fEe{constructor(e){super(e)}}var mEe=function(t,e,i,r){function n(s){return s instanceof i?s:new i(function(a){a(s)})}return new(i||(i=Promise))(function(s,a){function o(u){try{c(r.next(u))}catch(h){a(h)}}function l(u){try{c(r.throw(u))}catch(h){a(h)}}function c(u){u.done?s(u.value):n(u.value).then(o,l)}c((r=r.apply(t,e||[])).next())})};class gEe{constructor(e,i,r){var n,s,a;this.supabaseUrl=e,this.supabaseKey=i;const o=ySe(e);if(!i)throw new Error("supabaseKey is required.");this.realtimeUrl=new URL("realtime/v1",o),this.realtimeUrl.protocol=this.realtimeUrl.protocol.replace("http","ws"),this.authUrl=new URL("auth/v1",o),this.storageUrl=new URL("storage/v1",o),this.functionsUrl=new URL("functions/v1",o);const l=`sb-${o.hostname.split(".")[0]}-auth-token`,c={db:lSe,realtime:uSe,auth:Object.assign(Object.assign({},cSe),{storageKey:l}),global:oSe},u=vSe(r??{},c);this.storageKey=(n=u.auth.storageKey)!==null&&n!==void 0?n:"",this.headers=(s=u.global.headers)!==null&&s!==void 0?s:{},u.accessToken?(this.accessToken=u.accessToken,this.auth=new Proxy({},{get:(h,d)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(d)} is not possible`)}})):this.auth=this._initSupabaseAuthClient((a=u.auth)!==null&&a!==void 0?a:{},this.headers,u.global.fetch),this.fetch=pSe(i,this._getAccessToken.bind(this),u.global.fetch),this.realtime=this._initRealtimeClient(Object.assign({headers:this.headers,accessToken:this._getAccessToken.bind(this)},u.realtime)),this.rest=new E_e(new URL("rest/v1",o).href,{headers:this.headers,schema:u.db.schema,fetch:this.fetch}),this.storage=new nSe(this.storageUrl.href,this.headers,this.fetch,r?.storage),u.accessToken||this._listenForAuthEvents()}get functions(){return new p_e(this.functionsUrl.href,{headers:this.headers,customFetch:this.fetch})}from(e){return this.rest.from(e)}schema(e){return this.rest.schema(e)}rpc(e,i={},r={}){return this.rest.rpc(e,i,r)}channel(e,i={config:{}}){return this.realtime.channel(e,i)}getChannels(){return this.realtime.getChannels()}removeChannel(e){return this.realtime.removeChannel(e)}removeAllChannels(){return this.realtime.removeAllChannels()}_getAccessToken(){var e,i;return mEe(this,void 0,void 0,function*(){if(this.accessToken)return yield this.accessToken();const{data:r}=yield this.auth.getSession();return(i=(e=r.session)===null||e===void 0?void 0:e.access_token)!==null&&i!==void 0?i:this.supabaseKey})}_initSupabaseAuthClient({autoRefreshToken:e,persistSession:i,detectSessionInUrl:r,storage:n,userStorage:s,storageKey:a,flowType:o,lock:l,debug:c},u,h){const d={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new pEe({url:this.authUrl.href,headers:Object.assign(Object.assign({},d),u),storageKey:a,autoRefreshToken:e,persistSession:i,detectSessionInUrl:r,storage:n,userStorage:s,flowType:o,lock:l,debug:c,fetch:h,hasCustomAuthorizationHeader:Object.keys(this.headers).some(f=>f.toLowerCase()==="authorization")})}_initRealtimeClient(e){return new j_e(this.realtimeUrl.href,Object.assign(Object.assign({},e),{params:Object.assign({apikey:this.supabaseKey},e?.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((i,r)=>{this._handleTokenChanged(i,"CLIENT",r?.access_token)})}_handleTokenChanged(e,i,r){(e==="TOKEN_REFRESHED"||e==="SIGNED_IN")&&this.changedAccessToken!==r?(this.changedAccessToken=r,this.realtime.setAuth(r)):e==="SIGNED_OUT"&&(this.realtime.setAuth(),i=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}}const vEe=(t,e,i)=>new gEe(t,e,i);function yEe(){if(typeof window<"u"||typeof process>"u")return!1;const t=process.version;if(t==null)return!1;const e=t.match(/^v(\d+)\./);return e?parseInt(e[1],10)<=18:!1}yEe()&&console.warn("  Node.js 18 and below are deprecated and will no longer be supported in future versions of @supabase/supabase-js. Please upgrade to Node.js 20 or later. For more information, visit: https://github.com/orgs/supabase/discussions/37217");const xEe="https://hneoiyskrgonzzzdeetx.supabase.co",bEe="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImhuZW9peXNrcmdvbnp6emRlZXR4Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTkzODQwNjQsImV4cCI6MjA3NDk2MDA2NH0.6oIfvKrqPmxdMNGSn-tq5LKkKG78chTgXi-Uur_YW90",bd=vEe(xEe,bEe),Nse=J.createContext({session:null,signIn:async()=>({success:!1,error:{message:"Not initialized"}}),signUp:async()=>({success:!1,error:{message:"Not initialized"}}),signOut:async()=>({success:!1,error:{message:"Not initialized"}})}),Use=({children:t})=>{const[e,i]=J.useState(null),[r,n]=J.useState(!0),s="demo@demo.com",a="demo123",o=async(h,d,f="scientist",p)=>{try{const{data:g,error:m}=await bd.auth.signUp({email:h,password:d,options:{data:{user_type:f,name:p}}});if(m)return console.log("Error signing up:",m.message),{success:!1,error:m};const y=g?.user?.id;if(y){const{error:b}=await bd.from("profiles").insert([{id:y,email:h,user_type:f}]);b&&console.warn("Warning: failed to insert profile row:",b.message)}return{success:!0,data:g}}catch(g){return console.error("Sign up error:",g),{success:!1,error:g}}},l=async(h,d)=>{if(h===s&&d===a){const f={user:{id:"demo-user-id",email:s,user_type:"demo",name:"Demo User"},access_token:"demo-access-token"};return i(f),{success:!0,data:f}}try{const{data:f,error:p}=await bd.auth.signInWithPassword({email:h,password:d});return p?(console.log("Error signing in:",p.message),{success:!1,error:p}):{success:!0,data:f}}catch(f){return console.log("Error signing in:",f.message),{success:!1,error:f}}},c=async()=>{try{const{error:h}=await bd.auth.signOut();return h?(console.log("Error signing out:",h.message),{success:!1,error:h}):{success:!0}}catch(h){return console.error("Sign out error:",h),{success:!1,error:h}}};J.useEffect(()=>{bd.auth.getSession().then(({data:{session:d}})=>{i(d),n(!1)});const{data:{subscription:h}}=bd.auth.onAuthStateChange((d,f)=>{i(f),n(!1)});return()=>h.unsubscribe()},[]);const u={session:e,signIn:l,signUp:o,signOut:c,loading:r};return O.jsx(Nse.Provider,{value:u,children:t})};function Bse(){return J.useContext(Nse)}var sT=ure();const Fse=Lh(sT);function wEe(t){if(typeof document>"u")return;let e=document.head||document.getElementsByTagName("head")[0],i=document.createElement("style");i.type="text/css",e.appendChild(i),i.styleSheet?i.styleSheet.cssText=t:i.appendChild(document.createTextNode(t))}const _Ee=t=>{switch(t){case"success":return AEe;case"info":return TEe;case"warning":return MEe;case"error":return CEe;default:return null}},SEe=Array(12).fill(0),EEe=({visible:t,className:e})=>kt.createElement("div",{className:["sonner-loading-wrapper",e].filter(Boolean).join(" "),"data-visible":t},kt.createElement("div",{className:"sonner-spinner"},SEe.map((i,r)=>kt.createElement("div",{className:"sonner-loading-bar",key:`spinner-bar-${r}`})))),AEe=kt.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},kt.createElement("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.857-9.809a.75.75 0 00-1.214-.882l-3.483 4.79-1.88-1.88a.75.75 0 10-1.06 1.061l2.5 2.5a.75.75 0 001.137-.089l4-5.5z",clipRule:"evenodd"})),MEe=kt.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",height:"20",width:"20"},kt.createElement("path",{fillRule:"evenodd",d:"M9.401 3.003c1.155-2 4.043-2 5.197 0l7.355 12.748c1.154 2-.29 4.5-2.599 4.5H4.645c-2.309 0-3.752-2.5-2.598-4.5L9.4 3.003zM12 8.25a.75.75 0 01.75.75v3.75a.75.75 0 01-1.5 0V9a.75.75 0 01.75-.75zm0 8.25a.75.75 0 100-1.5.75.75 0 000 1.5z",clipRule:"evenodd"})),TEe=kt.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},kt.createElement("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a.75.75 0 000 1.5h.253a.25.25 0 01.244.304l-.459 2.066A1.75 1.75 0 0010.747 15H11a.75.75 0 000-1.5h-.253a.25.25 0 01-.244-.304l.459-2.066A1.75 1.75 0 009.253 9H9z",clipRule:"evenodd"})),CEe=kt.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},kt.createElement("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-8-5a.75.75 0 01.75.75v4.5a.75.75 0 01-1.5 0v-4.5A.75.75 0 0110 5zm0 10a1 1 0 100-2 1 1 0 000 2z",clipRule:"evenodd"})),PEe=kt.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"},kt.createElement("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),kt.createElement("line",{x1:"6",y1:"6",x2:"18",y2:"18"})),REe=()=>{const[t,e]=kt.useState(document.hidden);return kt.useEffect(()=>{const i=()=>{e(document.hidden)};return document.addEventListener("visibilitychange",i),()=>window.removeEventListener("visibilitychange",i)},[]),t};let xz=1;class IEe{constructor(){this.subscribe=e=>(this.subscribers.push(e),()=>{const i=this.subscribers.indexOf(e);this.subscribers.splice(i,1)}),this.publish=e=>{this.subscribers.forEach(i=>i(e))},this.addToast=e=>{this.publish(e),this.toasts=[...this.toasts,e]},this.create=e=>{var i;const{message:r,...n}=e,s=typeof e?.id=="number"||((i=e.id)==null?void 0:i.length)>0?e.id:xz++,a=this.toasts.find(l=>l.id===s),o=e.dismissible===void 0?!0:e.dismissible;return this.dismissedToasts.has(s)&&this.dismissedToasts.delete(s),a?this.toasts=this.toasts.map(l=>l.id===s?(this.publish({...l,...e,id:s,title:r}),{...l,...e,id:s,dismissible:o,title:r}):l):this.addToast({title:r,...n,dismissible:o,id:s}),s},this.dismiss=e=>(e?(this.dismissedToasts.add(e),requestAnimationFrame(()=>this.subscribers.forEach(i=>i({id:e,dismiss:!0})))):this.toasts.forEach(i=>{this.subscribers.forEach(r=>r({id:i.id,dismiss:!0}))}),e),this.message=(e,i)=>this.create({...i,message:e}),this.error=(e,i)=>this.create({...i,message:e,type:"error"}),this.success=(e,i)=>this.create({...i,type:"success",message:e}),this.info=(e,i)=>this.create({...i,type:"info",message:e}),this.warning=(e,i)=>this.create({...i,type:"warning",message:e}),this.loading=(e,i)=>this.create({...i,type:"loading",message:e}),this.promise=(e,i)=>{if(!i)return;let r;i.loading!==void 0&&(r=this.create({...i,promise:e,type:"loading",message:i.loading,description:typeof i.description!="function"?i.description:void 0}));const n=Promise.resolve(e instanceof Function?e():e);let s=r!==void 0,a;const o=n.then(async c=>{if(a=["resolve",c],kt.isValidElement(c))s=!1,this.create({id:r,type:"default",message:c});else if(OEe(c)&&!c.ok){s=!1;const h=typeof i.error=="function"?await i.error(`HTTP error! status: ${c.status}`):i.error,d=typeof i.description=="function"?await i.description(`HTTP error! status: ${c.status}`):i.description,p=typeof h=="object"&&!kt.isValidElement(h)?h:{message:h};this.create({id:r,type:"error",description:d,...p})}else if(c instanceof Error){s=!1;const h=typeof i.error=="function"?await i.error(c):i.error,d=typeof i.description=="function"?await i.description(c):i.description,p=typeof h=="object"&&!kt.isValidElement(h)?h:{message:h};this.create({id:r,type:"error",description:d,...p})}else if(i.success!==void 0){s=!1;const h=typeof i.success=="function"?await i.success(c):i.success,d=typeof i.description=="function"?await i.description(c):i.description,p=typeof h=="object"&&!kt.isValidElement(h)?h:{message:h};this.create({id:r,type:"success",description:d,...p})}}).catch(async c=>{if(a=["reject",c],i.error!==void 0){s=!1;const u=typeof i.error=="function"?await i.error(c):i.error,h=typeof i.description=="function"?await i.description(c):i.description,f=typeof u=="object"&&!kt.isValidElement(u)?u:{message:u};this.create({id:r,type:"error",description:h,...f})}}).finally(()=>{s&&(this.dismiss(r),r=void 0),i.finally==null||i.finally.call(i)}),l=()=>new Promise((c,u)=>o.then(()=>a[0]==="reject"?u(a[1]):c(a[1])).catch(u));return typeof r!="string"&&typeof r!="number"?{unwrap:l}:Object.assign(r,{unwrap:l})},this.custom=(e,i)=>{const r=i?.id||xz++;return this.create({jsx:e(r),id:r,...i}),r},this.getActiveToasts=()=>this.toasts.filter(e=>!this.dismissedToasts.has(e.id)),this.subscribers=[],this.toasts=[],this.dismissedToasts=new Set}}const Vl=new IEe,DEe=(t,e)=>{const i=e?.id||xz++;return Vl.addToast({title:t,...e,id:i}),i},OEe=t=>t&&typeof t=="object"&&"ok"in t&&typeof t.ok=="boolean"&&"status"in t&&typeof t.status=="number",LEe=DEe,kEe=()=>Vl.toasts,NEe=()=>Vl.getActiveToasts(),la=Object.assign(LEe,{success:Vl.success,info:Vl.info,warning:Vl.warning,error:Vl.error,custom:Vl.custom,message:Vl.message,promise:Vl.promise,dismiss:Vl.dismiss,loading:Vl.loading},{getHistory:kEe,getToasts:NEe});wEe("[data-sonner-toaster][dir=ltr],html[dir=ltr]{--toast-icon-margin-start:-3px;--toast-icon-margin-end:4px;--toast-svg-margin-start:-1px;--toast-svg-margin-end:0px;--toast-button-margin-start:auto;--toast-button-margin-end:0;--toast-close-button-start:0;--toast-close-button-end:unset;--toast-close-button-transform:translate(-35%, -35%)}[data-sonner-toaster][dir=rtl],html[dir=rtl]{--toast-icon-margin-start:4px;--toast-icon-margin-end:-3px;--toast-svg-margin-start:0px;--toast-svg-margin-end:-1px;--toast-button-margin-start:0;--toast-button-margin-end:auto;--toast-close-button-start:unset;--toast-close-button-end:0;--toast-close-button-transform:translate(35%, -35%)}[data-sonner-toaster]{position:fixed;width:var(--width);font-family:ui-sans-serif,system-ui,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Arial,Noto Sans,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol,Noto Color Emoji;--gray1:hsl(0, 0%, 99%);--gray2:hsl(0, 0%, 97.3%);--gray3:hsl(0, 0%, 95.1%);--gray4:hsl(0, 0%, 93%);--gray5:hsl(0, 0%, 90.9%);--gray6:hsl(0, 0%, 88.7%);--gray7:hsl(0, 0%, 85.8%);--gray8:hsl(0, 0%, 78%);--gray9:hsl(0, 0%, 56.1%);--gray10:hsl(0, 0%, 52.3%);--gray11:hsl(0, 0%, 43.5%);--gray12:hsl(0, 0%, 9%);--border-radius:8px;box-sizing:border-box;padding:0;margin:0;list-style:none;outline:0;z-index:999999999;transition:transform .4s ease}[data-sonner-toaster][data-lifted=true]{transform:translateY(-8px)}@media (hover:none) and (pointer:coarse){[data-sonner-toaster][data-lifted=true]{transform:none}}[data-sonner-toaster][data-x-position=right]{right:var(--offset-right)}[data-sonner-toaster][data-x-position=left]{left:var(--offset-left)}[data-sonner-toaster][data-x-position=center]{left:50%;transform:translateX(-50%)}[data-sonner-toaster][data-y-position=top]{top:var(--offset-top)}[data-sonner-toaster][data-y-position=bottom]{bottom:var(--offset-bottom)}[data-sonner-toast]{--y:translateY(100%);--lift-amount:calc(var(--lift) * var(--gap));z-index:var(--z-index);position:absolute;opacity:0;transform:var(--y);touch-action:none;transition:transform .4s,opacity .4s,height .4s,box-shadow .2s;box-sizing:border-box;outline:0;overflow-wrap:anywhere}[data-sonner-toast][data-styled=true]{padding:16px;background:var(--normal-bg);border:1px solid var(--normal-border);color:var(--normal-text);border-radius:var(--border-radius);box-shadow:0 4px 12px rgba(0,0,0,.1);width:var(--width);font-size:13px;display:flex;align-items:center;gap:6px}[data-sonner-toast]:focus-visible{box-shadow:0 4px 12px rgba(0,0,0,.1),0 0 0 2px rgba(0,0,0,.2)}[data-sonner-toast][data-y-position=top]{top:0;--y:translateY(-100%);--lift:1;--lift-amount:calc(1 * var(--gap))}[data-sonner-toast][data-y-position=bottom]{bottom:0;--y:translateY(100%);--lift:-1;--lift-amount:calc(var(--lift) * var(--gap))}[data-sonner-toast][data-styled=true] [data-description]{font-weight:400;line-height:1.4;color:#3f3f3f}[data-rich-colors=true][data-sonner-toast][data-styled=true] [data-description]{color:inherit}[data-sonner-toaster][data-sonner-theme=dark] [data-description]{color:#e8e8e8}[data-sonner-toast][data-styled=true] [data-title]{font-weight:500;line-height:1.5;color:inherit}[data-sonner-toast][data-styled=true] [data-icon]{display:flex;height:16px;width:16px;position:relative;justify-content:flex-start;align-items:center;flex-shrink:0;margin-left:var(--toast-icon-margin-start);margin-right:var(--toast-icon-margin-end)}[data-sonner-toast][data-promise=true] [data-icon]>svg{opacity:0;transform:scale(.8);transform-origin:center;animation:sonner-fade-in .3s ease forwards}[data-sonner-toast][data-styled=true] [data-icon]>*{flex-shrink:0}[data-sonner-toast][data-styled=true] [data-icon] svg{margin-left:var(--toast-svg-margin-start);margin-right:var(--toast-svg-margin-end)}[data-sonner-toast][data-styled=true] [data-content]{display:flex;flex-direction:column;gap:2px}[data-sonner-toast][data-styled=true] [data-button]{border-radius:4px;padding-left:8px;padding-right:8px;height:24px;font-size:12px;color:var(--normal-bg);background:var(--normal-text);margin-left:var(--toast-button-margin-start);margin-right:var(--toast-button-margin-end);border:none;font-weight:500;cursor:pointer;outline:0;display:flex;align-items:center;flex-shrink:0;transition:opacity .4s,box-shadow .2s}[data-sonner-toast][data-styled=true] [data-button]:focus-visible{box-shadow:0 0 0 2px rgba(0,0,0,.4)}[data-sonner-toast][data-styled=true] [data-button]:first-of-type{margin-left:var(--toast-button-margin-start);margin-right:var(--toast-button-margin-end)}[data-sonner-toast][data-styled=true] [data-cancel]{color:var(--normal-text);background:rgba(0,0,0,.08)}[data-sonner-toaster][data-sonner-theme=dark] [data-sonner-toast][data-styled=true] [data-cancel]{background:rgba(255,255,255,.3)}[data-sonner-toast][data-styled=true] [data-close-button]{position:absolute;left:var(--toast-close-button-start);right:var(--toast-close-button-end);top:0;height:20px;width:20px;display:flex;justify-content:center;align-items:center;padding:0;color:var(--gray12);background:var(--normal-bg);border:1px solid var(--gray4);transform:var(--toast-close-button-transform);border-radius:50%;cursor:pointer;z-index:1;transition:opacity .1s,background .2s,border-color .2s}[data-sonner-toast][data-styled=true] [data-close-button]:focus-visible{box-shadow:0 4px 12px rgba(0,0,0,.1),0 0 0 2px rgba(0,0,0,.2)}[data-sonner-toast][data-styled=true] [data-disabled=true]{cursor:not-allowed}[data-sonner-toast][data-styled=true]:hover [data-close-button]:hover{background:var(--gray2);border-color:var(--gray5)}[data-sonner-toast][data-swiping=true]::before{content:'';position:absolute;left:-100%;right:-100%;height:100%;z-index:-1}[data-sonner-toast][data-y-position=top][data-swiping=true]::before{bottom:50%;transform:scaleY(3) translateY(50%)}[data-sonner-toast][data-y-position=bottom][data-swiping=true]::before{top:50%;transform:scaleY(3) translateY(-50%)}[data-sonner-toast][data-swiping=false][data-removed=true]::before{content:'';position:absolute;inset:0;transform:scaleY(2)}[data-sonner-toast][data-expanded=true]::after{content:'';position:absolute;left:0;height:calc(var(--gap) + 1px);bottom:100%;width:100%}[data-sonner-toast][data-mounted=true]{--y:translateY(0);opacity:1}[data-sonner-toast][data-expanded=false][data-front=false]{--scale:var(--toasts-before) * 0.05 + 1;--y:translateY(calc(var(--lift-amount) * var(--toasts-before))) scale(calc(-1 * var(--scale)));height:var(--front-toast-height)}[data-sonner-toast]>*{transition:opacity .4s}[data-sonner-toast][data-x-position=right]{right:0}[data-sonner-toast][data-x-position=left]{left:0}[data-sonner-toast][data-expanded=false][data-front=false][data-styled=true]>*{opacity:0}[data-sonner-toast][data-visible=false]{opacity:0;pointer-events:none}[data-sonner-toast][data-mounted=true][data-expanded=true]{--y:translateY(calc(var(--lift) * var(--offset)));height:var(--initial-height)}[data-sonner-toast][data-removed=true][data-front=true][data-swipe-out=false]{--y:translateY(calc(var(--lift) * -100%));opacity:0}[data-sonner-toast][data-removed=true][data-front=false][data-swipe-out=false][data-expanded=true]{--y:translateY(calc(var(--lift) * var(--offset) + var(--lift) * -100%));opacity:0}[data-sonner-toast][data-removed=true][data-front=false][data-swipe-out=false][data-expanded=false]{--y:translateY(40%);opacity:0;transition:transform .5s,opacity .2s}[data-sonner-toast][data-removed=true][data-front=false]::before{height:calc(var(--initial-height) + 20%)}[data-sonner-toast][data-swiping=true]{transform:var(--y) translateY(var(--swipe-amount-y,0)) translateX(var(--swipe-amount-x,0));transition:none}[data-sonner-toast][data-swiped=true]{user-select:none}[data-sonner-toast][data-swipe-out=true][data-y-position=bottom],[data-sonner-toast][data-swipe-out=true][data-y-position=top]{animation-duration:.2s;animation-timing-function:ease-out;animation-fill-mode:forwards}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=left]{animation-name:swipe-out-left}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=right]{animation-name:swipe-out-right}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=up]{animation-name:swipe-out-up}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=down]{animation-name:swipe-out-down}@keyframes swipe-out-left{from{transform:var(--y) translateX(var(--swipe-amount-x));opacity:1}to{transform:var(--y) translateX(calc(var(--swipe-amount-x) - 100%));opacity:0}}@keyframes swipe-out-right{from{transform:var(--y) translateX(var(--swipe-amount-x));opacity:1}to{transform:var(--y) translateX(calc(var(--swipe-amount-x) + 100%));opacity:0}}@keyframes swipe-out-up{from{transform:var(--y) translateY(var(--swipe-amount-y));opacity:1}to{transform:var(--y) translateY(calc(var(--swipe-amount-y) - 100%));opacity:0}}@keyframes swipe-out-down{from{transform:var(--y) translateY(var(--swipe-amount-y));opacity:1}to{transform:var(--y) translateY(calc(var(--swipe-amount-y) + 100%));opacity:0}}@media (max-width:600px){[data-sonner-toaster]{position:fixed;right:var(--mobile-offset-right);left:var(--mobile-offset-left);width:100%}[data-sonner-toaster][dir=rtl]{left:calc(var(--mobile-offset-left) * -1)}[data-sonner-toaster] [data-sonner-toast]{left:0;right:0;width:calc(100% - var(--mobile-offset-left) * 2)}[data-sonner-toaster][data-x-position=left]{left:var(--mobile-offset-left)}[data-sonner-toaster][data-y-position=bottom]{bottom:var(--mobile-offset-bottom)}[data-sonner-toaster][data-y-position=top]{top:var(--mobile-offset-top)}[data-sonner-toaster][data-x-position=center]{left:var(--mobile-offset-left);right:var(--mobile-offset-right);transform:none}}[data-sonner-toaster][data-sonner-theme=light]{--normal-bg:#fff;--normal-border:var(--gray4);--normal-text:var(--gray12);--success-bg:hsl(143, 85%, 96%);--success-border:hsl(145, 92%, 87%);--success-text:hsl(140, 100%, 27%);--info-bg:hsl(208, 100%, 97%);--info-border:hsl(221, 91%, 93%);--info-text:hsl(210, 92%, 45%);--warning-bg:hsl(49, 100%, 97%);--warning-border:hsl(49, 91%, 84%);--warning-text:hsl(31, 92%, 45%);--error-bg:hsl(359, 100%, 97%);--error-border:hsl(359, 100%, 94%);--error-text:hsl(360, 100%, 45%)}[data-sonner-toaster][data-sonner-theme=light] [data-sonner-toast][data-invert=true]{--normal-bg:#000;--normal-border:hsl(0, 0%, 20%);--normal-text:var(--gray1)}[data-sonner-toaster][data-sonner-theme=dark] [data-sonner-toast][data-invert=true]{--normal-bg:#fff;--normal-border:var(--gray3);--normal-text:var(--gray12)}[data-sonner-toaster][data-sonner-theme=dark]{--normal-bg:#000;--normal-bg-hover:hsl(0, 0%, 12%);--normal-border:hsl(0, 0%, 20%);--normal-border-hover:hsl(0, 0%, 25%);--normal-text:var(--gray1);--success-bg:hsl(150, 100%, 6%);--success-border:hsl(147, 100%, 12%);--success-text:hsl(150, 86%, 65%);--info-bg:hsl(215, 100%, 6%);--info-border:hsl(223, 43%, 17%);--info-text:hsl(216, 87%, 65%);--warning-bg:hsl(64, 100%, 6%);--warning-border:hsl(60, 100%, 9%);--warning-text:hsl(46, 87%, 65%);--error-bg:hsl(358, 76%, 10%);--error-border:hsl(357, 89%, 16%);--error-text:hsl(358, 100%, 81%)}[data-sonner-toaster][data-sonner-theme=dark] [data-sonner-toast] [data-close-button]{background:var(--normal-bg);border-color:var(--normal-border);color:var(--normal-text)}[data-sonner-toaster][data-sonner-theme=dark] [data-sonner-toast] [data-close-button]:hover{background:var(--normal-bg-hover);border-color:var(--normal-border-hover)}[data-rich-colors=true][data-sonner-toast][data-type=success]{background:var(--success-bg);border-color:var(--success-border);color:var(--success-text)}[data-rich-colors=true][data-sonner-toast][data-type=success] [data-close-button]{background:var(--success-bg);border-color:var(--success-border);color:var(--success-text)}[data-rich-colors=true][data-sonner-toast][data-type=info]{background:var(--info-bg);border-color:var(--info-border);color:var(--info-text)}[data-rich-colors=true][data-sonner-toast][data-type=info] [data-close-button]{background:var(--info-bg);border-color:var(--info-border);color:var(--info-text)}[data-rich-colors=true][data-sonner-toast][data-type=warning]{background:var(--warning-bg);border-color:var(--warning-border);color:var(--warning-text)}[data-rich-colors=true][data-sonner-toast][data-type=warning] [data-close-button]{background:var(--warning-bg);border-color:var(--warning-border);color:var(--warning-text)}[data-rich-colors=true][data-sonner-toast][data-type=error]{background:var(--error-bg);border-color:var(--error-border);color:var(--error-text)}[data-rich-colors=true][data-sonner-toast][data-type=error] [data-close-button]{background:var(--error-bg);border-color:var(--error-border);color:var(--error-text)}.sonner-loading-wrapper{--size:16px;height:var(--size);width:var(--size);position:absolute;inset:0;z-index:10}.sonner-loading-wrapper[data-visible=false]{transform-origin:center;animation:sonner-fade-out .2s ease forwards}.sonner-spinner{position:relative;top:50%;left:50%;height:var(--size);width:var(--size)}.sonner-loading-bar{animation:sonner-spin 1.2s linear infinite;background:var(--gray11);border-radius:6px;height:8%;left:-10%;position:absolute;top:-3.9%;width:24%}.sonner-loading-bar:first-child{animation-delay:-1.2s;transform:rotate(.0001deg) translate(146%)}.sonner-loading-bar:nth-child(2){animation-delay:-1.1s;transform:rotate(30deg) translate(146%)}.sonner-loading-bar:nth-child(3){animation-delay:-1s;transform:rotate(60deg) translate(146%)}.sonner-loading-bar:nth-child(4){animation-delay:-.9s;transform:rotate(90deg) translate(146%)}.sonner-loading-bar:nth-child(5){animation-delay:-.8s;transform:rotate(120deg) translate(146%)}.sonner-loading-bar:nth-child(6){animation-delay:-.7s;transform:rotate(150deg) translate(146%)}.sonner-loading-bar:nth-child(7){animation-delay:-.6s;transform:rotate(180deg) translate(146%)}.sonner-loading-bar:nth-child(8){animation-delay:-.5s;transform:rotate(210deg) translate(146%)}.sonner-loading-bar:nth-child(9){animation-delay:-.4s;transform:rotate(240deg) translate(146%)}.sonner-loading-bar:nth-child(10){animation-delay:-.3s;transform:rotate(270deg) translate(146%)}.sonner-loading-bar:nth-child(11){animation-delay:-.2s;transform:rotate(300deg) translate(146%)}.sonner-loading-bar:nth-child(12){animation-delay:-.1s;transform:rotate(330deg) translate(146%)}@keyframes sonner-fade-in{0%{opacity:0;transform:scale(.8)}100%{opacity:1;transform:scale(1)}}@keyframes sonner-fade-out{0%{opacity:1;transform:scale(1)}100%{opacity:0;transform:scale(.8)}}@keyframes sonner-spin{0%{opacity:1}100%{opacity:.15}}@media (prefers-reduced-motion){.sonner-loading-bar,[data-sonner-toast],[data-sonner-toast]>*{transition:none!important;animation:none!important}}.sonner-loader{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);transform-origin:center;transition:opacity .2s,transform .2s}.sonner-loader[data-visible=false]{opacity:0;transform:scale(.8) translate(-50%,-50%)}");function e2(t){return t.label!==void 0}const UEe=3,BEe="24px",FEe="16px",w7=4e3,zEe=356,jEe=14,VEe=45,HEe=200;function Jh(...t){return t.filter(Boolean).join(" ")}function GEe(t){const[e,i]=t.split("-"),r=[];return e&&r.push(e),i&&r.push(i),r}const WEe=t=>{var e,i,r,n,s,a,o,l,c;const{invert:u,toast:h,unstyled:d,interacting:f,setHeights:p,visibleToasts:g,heights:m,index:y,toasts:b,expanded:w,removeToast:E,defaultRichColors:M,closeButton:A,style:P,cancelButtonStyle:C,actionButtonStyle:R,className:I="",descriptionClassName:k="",duration:z,position:V,gap:F,expandByDefault:$,classNames:K,icons:X,closeButtonAriaLabel:U="Close toast"}=t,[Y,Z]=kt.useState(null),[j,ee]=kt.useState(null),[pe,fe]=kt.useState(!1),[se,re]=kt.useState(!1),[le,he]=kt.useState(!1),[ve,xe]=kt.useState(!1),[Se,Ce]=kt.useState(!1),[ce,Fe]=kt.useState(0),[De,He]=kt.useState(0),Be=kt.useRef(h.duration||z||w7),$e=kt.useRef(null),ze=kt.useRef(null),it=y===0,wt=y+1<=g,ge=h.type,G=h.dismissible!==!1,Q=h.className||"",we=h.descriptionClassName||"",te=kt.useMemo(()=>m.findIndex(je=>je.toastId===h.id)||0,[m,h.id]),Ne=kt.useMemo(()=>{var je;return(je=h.closeButton)!=null?je:A},[h.closeButton,A]),Le=kt.useMemo(()=>h.duration||z||w7,[h.duration,z]),at=kt.useRef(0),Te=kt.useRef(0),dt=kt.useRef(0),ot=kt.useRef(null),[Qe,pt]=V.split("-"),_t=kt.useMemo(()=>m.reduce((je,Tt,Ft)=>Ft>=te?je:je+Tt.height,0),[m,te]),yt=REe(),Et=h.invert||u,$t=ge==="loading";Te.current=kt.useMemo(()=>te*F+_t,[te,_t]),kt.useEffect(()=>{Be.current=Le},[Le]),kt.useEffect(()=>{fe(!0)},[]),kt.useEffect(()=>{const je=ze.current;if(je){const Tt=je.getBoundingClientRect().height;return He(Tt),p(Ft=>[{toastId:h.id,height:Tt,position:h.position},...Ft]),()=>p(Ft=>Ft.filter(wi=>wi.toastId!==h.id))}},[p,h.id]),kt.useLayoutEffect(()=>{if(!pe)return;const je=ze.current,Tt=je.style.height;je.style.height="auto";const Ft=je.getBoundingClientRect().height;je.style.height=Tt,He(Ft),p(wi=>wi.find(Zi=>Zi.toastId===h.id)?wi.map(Zi=>Zi.toastId===h.id?{...Zi,height:Ft}:Zi):[{toastId:h.id,height:Ft,position:h.position},...wi])},[pe,h.title,h.description,p,h.id]);const oe=kt.useCallback(()=>{re(!0),Fe(Te.current),p(je=>je.filter(Tt=>Tt.toastId!==h.id)),setTimeout(()=>{E(h)},HEe)},[h,E,p,Te]);kt.useEffect(()=>{if(h.promise&&ge==="loading"||h.duration===1/0||h.type==="loading")return;let je;return w||f||yt?(()=>{if(dt.current<at.current){const wi=new Date().getTime()-at.current;Be.current=Be.current-wi}dt.current=new Date().getTime()})():(()=>{Be.current!==1/0&&(at.current=new Date().getTime(),je=setTimeout(()=>{h.onAutoClose==null||h.onAutoClose.call(h,h),oe()},Be.current))})(),()=>clearTimeout(je)},[w,f,h,ge,yt,oe]),kt.useEffect(()=>{h.delete&&oe()},[oe,h.delete]);function Re(){var je;if(X?.loading){var Tt;return kt.createElement("div",{className:Jh(K?.loader,h==null||(Tt=h.classNames)==null?void 0:Tt.loader,"sonner-loader"),"data-visible":ge==="loading"},X.loading)}return kt.createElement(EEe,{className:Jh(K?.loader,h==null||(je=h.classNames)==null?void 0:je.loader),visible:ge==="loading"})}const ke=h.icon||X?.[ge]||_Ee(ge);var st,rt;return kt.createElement("li",{tabIndex:0,ref:ze,className:Jh(I,Q,K?.toast,h==null||(e=h.classNames)==null?void 0:e.toast,K?.default,K?.[ge],h==null||(i=h.classNames)==null?void 0:i[ge]),"data-sonner-toast":"","data-rich-colors":(st=h.richColors)!=null?st:M,"data-styled":!(h.jsx||h.unstyled||d),"data-mounted":pe,"data-promise":!!h.promise,"data-swiped":Se,"data-removed":se,"data-visible":wt,"data-y-position":Qe,"data-x-position":pt,"data-index":y,"data-front":it,"data-swiping":le,"data-dismissible":G,"data-type":ge,"data-invert":Et,"data-swipe-out":ve,"data-swipe-direction":j,"data-expanded":!!(w||$&&pe),style:{"--index":y,"--toasts-before":y,"--z-index":b.length-y,"--offset":`${se?ce:Te.current}px`,"--initial-height":$?"auto":`${De}px`,...P,...h.style},onDragEnd:()=>{he(!1),Z(null),ot.current=null},onPointerDown:je=>{$t||!G||($e.current=new Date,Fe(Te.current),je.target.setPointerCapture(je.pointerId),je.target.tagName!=="BUTTON"&&(he(!0),ot.current={x:je.clientX,y:je.clientY}))},onPointerUp:()=>{var je,Tt,Ft;if(ve||!G)return;ot.current=null;const wi=Number(((je=ze.current)==null?void 0:je.style.getPropertyValue("--swipe-amount-x").replace("px",""))||0),ti=Number(((Tt=ze.current)==null?void 0:Tt.style.getPropertyValue("--swipe-amount-y").replace("px",""))||0),Zi=new Date().getTime()-((Ft=$e.current)==null?void 0:Ft.getTime()),Xi=Y==="x"?wi:ti,As=Math.abs(Xi)/Zi;if(Math.abs(Xi)>=VEe||As>.11){Fe(Te.current),h.onDismiss==null||h.onDismiss.call(h,h),ee(Y==="x"?wi>0?"right":"left":ti>0?"down":"up"),oe(),xe(!0);return}else{var Gr,Nn;(Gr=ze.current)==null||Gr.style.setProperty("--swipe-amount-x","0px"),(Nn=ze.current)==null||Nn.style.setProperty("--swipe-amount-y","0px")}Ce(!1),he(!1),Z(null)},onPointerMove:je=>{var Tt,Ft,wi;if(!ot.current||!G||((Tt=window.getSelection())==null?void 0:Tt.toString().length)>0)return;const Zi=je.clientY-ot.current.y,Xi=je.clientX-ot.current.x;var As;const Gr=(As=t.swipeDirections)!=null?As:GEe(V);!Y&&(Math.abs(Xi)>1||Math.abs(Zi)>1)&&Z(Math.abs(Xi)>Math.abs(Zi)?"x":"y");let Nn={x:0,y:0};const us=ye=>1/(1.5+Math.abs(ye)/20);if(Y==="y"){if(Gr.includes("top")||Gr.includes("bottom"))if(Gr.includes("top")&&Zi<0||Gr.includes("bottom")&&Zi>0)Nn.y=Zi;else{const ye=Zi*us(Zi);Nn.y=Math.abs(ye)<Math.abs(Zi)?ye:Zi}}else if(Y==="x"&&(Gr.includes("left")||Gr.includes("right")))if(Gr.includes("left")&&Xi<0||Gr.includes("right")&&Xi>0)Nn.x=Xi;else{const ye=Xi*us(Xi);Nn.x=Math.abs(ye)<Math.abs(Xi)?ye:Xi}(Math.abs(Nn.x)>0||Math.abs(Nn.y)>0)&&Ce(!0),(Ft=ze.current)==null||Ft.style.setProperty("--swipe-amount-x",`${Nn.x}px`),(wi=ze.current)==null||wi.style.setProperty("--swipe-amount-y",`${Nn.y}px`)}},Ne&&!h.jsx&&ge!=="loading"?kt.createElement("button",{"aria-label":U,"data-disabled":$t,"data-close-button":!0,onClick:$t||!G?()=>{}:()=>{oe(),h.onDismiss==null||h.onDismiss.call(h,h)},className:Jh(K?.closeButton,h==null||(r=h.classNames)==null?void 0:r.closeButton)},(rt=X?.close)!=null?rt:PEe):null,(ge||h.icon||h.promise)&&h.icon!==null&&(X?.[ge]!==null||h.icon)?kt.createElement("div",{"data-icon":"",className:Jh(K?.icon,h==null||(n=h.classNames)==null?void 0:n.icon)},h.promise||h.type==="loading"&&!h.icon?h.icon||Re():null,h.type!=="loading"?ke:null):null,kt.createElement("div",{"data-content":"",className:Jh(K?.content,h==null||(s=h.classNames)==null?void 0:s.content)},kt.createElement("div",{"data-title":"",className:Jh(K?.title,h==null||(a=h.classNames)==null?void 0:a.title)},h.jsx?h.jsx:typeof h.title=="function"?h.title():h.title),h.description?kt.createElement("div",{"data-description":"",className:Jh(k,we,K?.description,h==null||(o=h.classNames)==null?void 0:o.description)},typeof h.description=="function"?h.description():h.description):null),kt.isValidElement(h.cancel)?h.cancel:h.cancel&&e2(h.cancel)?kt.createElement("button",{"data-button":!0,"data-cancel":!0,style:h.cancelButtonStyle||C,onClick:je=>{e2(h.cancel)&&G&&(h.cancel.onClick==null||h.cancel.onClick.call(h.cancel,je),oe())},className:Jh(K?.cancelButton,h==null||(l=h.classNames)==null?void 0:l.cancelButton)},h.cancel.label):null,kt.isValidElement(h.action)?h.action:h.action&&e2(h.action)?kt.createElement("button",{"data-button":!0,"data-action":!0,style:h.actionButtonStyle||R,onClick:je=>{e2(h.action)&&(h.action.onClick==null||h.action.onClick.call(h.action,je),!je.defaultPrevented&&oe())},className:Jh(K?.actionButton,h==null||(c=h.classNames)==null?void 0:c.actionButton)},h.action.label):null)};function _7(){if(typeof window>"u"||typeof document>"u")return"ltr";const t=document.documentElement.getAttribute("dir");return t==="auto"||!t?window.getComputedStyle(document.documentElement).direction:t}function qEe(t,e){const i={};return[t,e].forEach((r,n)=>{const s=n===1,a=s?"--mobile-offset":"--offset",o=s?FEe:BEe;function l(c){["top","right","bottom","left"].forEach(u=>{i[`${a}-${u}`]=typeof c=="number"?`${c}px`:c})}typeof r=="number"||typeof r=="string"?l(r):typeof r=="object"?["top","right","bottom","left"].forEach(c=>{r[c]===void 0?i[`${a}-${c}`]=o:i[`${a}-${c}`]=typeof r[c]=="number"?`${r[c]}px`:r[c]}):l(o)}),i}const XEe=kt.forwardRef(function(e,i){const{invert:r,position:n="bottom-right",hotkey:s=["altKey","KeyT"],expand:a,closeButton:o,className:l,offset:c,mobileOffset:u,theme:h="light",richColors:d,duration:f,style:p,visibleToasts:g=UEe,toastOptions:m,dir:y=_7(),gap:b=jEe,icons:w,containerAriaLabel:E="Notifications"}=e,[M,A]=kt.useState([]),P=kt.useMemo(()=>Array.from(new Set([n].concat(M.filter(j=>j.position).map(j=>j.position)))),[M,n]),[C,R]=kt.useState([]),[I,k]=kt.useState(!1),[z,V]=kt.useState(!1),[F,$]=kt.useState(h!=="system"?h:typeof window<"u"&&window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"),K=kt.useRef(null),X=s.join("+").replace(/Key/g,"").replace(/Digit/g,""),U=kt.useRef(null),Y=kt.useRef(!1),Z=kt.useCallback(j=>{A(ee=>{var pe;return(pe=ee.find(fe=>fe.id===j.id))!=null&&pe.delete||Vl.dismiss(j.id),ee.filter(({id:fe})=>fe!==j.id)})},[]);return kt.useEffect(()=>Vl.subscribe(j=>{if(j.dismiss){requestAnimationFrame(()=>{A(ee=>ee.map(pe=>pe.id===j.id?{...pe,delete:!0}:pe))});return}setTimeout(()=>{Fse.flushSync(()=>{A(ee=>{const pe=ee.findIndex(fe=>fe.id===j.id);return pe!==-1?[...ee.slice(0,pe),{...ee[pe],...j},...ee.slice(pe+1)]:[j,...ee]})})})}),[M]),kt.useEffect(()=>{if(h!=="system"){$(h);return}if(h==="system"&&(window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?$("dark"):$("light")),typeof window>"u")return;const j=window.matchMedia("(prefers-color-scheme: dark)");try{j.addEventListener("change",({matches:ee})=>{$(ee?"dark":"light")})}catch{j.addListener(({matches:pe})=>{try{$(pe?"dark":"light")}catch(fe){console.error(fe)}})}},[h]),kt.useEffect(()=>{M.length<=1&&k(!1)},[M]),kt.useEffect(()=>{const j=ee=>{var pe;if(s.every(re=>ee[re]||ee.code===re)){var se;k(!0),(se=K.current)==null||se.focus()}ee.code==="Escape"&&(document.activeElement===K.current||(pe=K.current)!=null&&pe.contains(document.activeElement))&&k(!1)};return document.addEventListener("keydown",j),()=>document.removeEventListener("keydown",j)},[s]),kt.useEffect(()=>{if(K.current)return()=>{U.current&&(U.current.focus({preventScroll:!0}),U.current=null,Y.current=!1)}},[K.current]),kt.createElement("section",{ref:i,"aria-label":`${E} ${X}`,tabIndex:-1,"aria-live":"polite","aria-relevant":"additions text","aria-atomic":"false",suppressHydrationWarning:!0},P.map((j,ee)=>{var pe;const[fe,se]=j.split("-");return M.length?kt.createElement("ol",{key:j,dir:y==="auto"?_7():y,tabIndex:-1,ref:K,className:l,"data-sonner-toaster":!0,"data-sonner-theme":F,"data-y-position":fe,"data-lifted":I&&M.length>1&&!a,"data-x-position":se,style:{"--front-toast-height":`${((pe=C[0])==null?void 0:pe.height)||0}px`,"--width":`${zEe}px`,"--gap":`${b}px`,...p,...qEe(c,u)},onBlur:re=>{Y.current&&!re.currentTarget.contains(re.relatedTarget)&&(Y.current=!1,U.current&&(U.current.focus({preventScroll:!0}),U.current=null))},onFocus:re=>{re.target instanceof HTMLElement&&re.target.dataset.dismissible==="false"||Y.current||(Y.current=!0,U.current=re.relatedTarget)},onMouseEnter:()=>k(!0),onMouseMove:()=>k(!0),onMouseLeave:()=>{z||k(!1)},onDragEnd:()=>k(!1),onPointerDown:re=>{re.target instanceof HTMLElement&&re.target.dataset.dismissible==="false"||V(!0)},onPointerUp:()=>V(!1)},M.filter(re=>!re.position&&ee===0||re.position===j).map((re,le)=>{var he,ve;return kt.createElement(WEe,{key:re.id,icons:w,index:le,toast:re,defaultRichColors:d,duration:(he=m?.duration)!=null?he:f,className:m?.className,descriptionClassName:m?.descriptionClassName,invert:r,visibleToasts:g,closeButton:(ve=m?.closeButton)!=null?ve:o,interacting:z,position:j,style:m?.style,unstyled:m?.unstyled,classNames:m?.classNames,cancelButtonStyle:m?.cancelButtonStyle,actionButtonStyle:m?.actionButtonStyle,closeButtonAriaLabel:m?.closeButtonAriaLabel,removeToast:Z,toasts:M.filter(xe=>xe.position==re.position),heights:C.filter(xe=>xe.position==re.position),setHeights:R,expandByDefault:a,gap:b,expanded:I,swipeDirections:e.swipeDirections})})):null}))});function $Ee(t){const{onUserTypeChange:e}=t||{},{signIn:i,signUp:r,loading:n}=Bse()||{},[s,a]=J.useState(!0),[o,l]=J.useState(""),[c,u]=J.useState(""),[h,d]=J.useState(""),[f,p]=J.useState("scientist"),[g,m]=J.useState(""),y=[{id:"scientist",title:"Scientist",icon:ss,description:"Generate new hypotheses and analyze research",color:"from-blue-500 to-cyan-500"},{id:"investor",title:"Manager/Investor",icon:b1,description:"Identify investment opportunities",color:"from-green-500 to-emerald-500"},{id:"mission-architect",title:"Mission Architect",icon:x1,description:"Plan Moon and Mars missions safely",color:"from-red-500 to-orange-500"}],b=[{name:"Kartavya",role:"RAG System and Frontend",avatar:""},{name:"Surya Shrivastav",role:"Knowldge Graph builder",avatar:""},{name:"Saksham Sethia",role:"Backend",avatar:""},{name:"Yash Sharma",role:"Data Scientist",avatar:""},{name:"Sapphire ..",role:"Knowledge Graph",avatar:""},{name:"Sanvi ..",role:"UI/UX Designer",avatar:""}],w=async()=>{try{if(!o.trim())throw new Error("Please enter your email address");if(!c)throw new Error("Please enter your password");if(!s&&!h.trim())throw new Error("Please enter your full name");if(!s&&c.length<6)throw new Error("Password must be at least 6 characters long");let M;if(s){if(M=await i(o.trim(),c),!M?.data?.user||M?.error){const P=M?.error?.message||"Sign in failed. Please check your credentials.";la.error(P);return}const A=M?.data?.user?.user_type||f;e&&e(A),la.success("Welcome back to AstroNots!")}else{if(M=await r(o.trim(),c,f,h.trim()),!M?.data?.user||M?.error){const A=M?.error?.message||"Sign up failed. Please try again.";la.error(A);return}e&&e(f),la.success("Welcome to AstroNots! ")}}catch(M){const A=M instanceof Error?M.message:String(M);la.error(A||"An unexpected error occurred"),console.error("Auth error:",M)}},E=M=>{if(!M||typeof M!="string")return"";try{const A=new URL(M);if(A.protocol==="http:"||A.protocol==="https:")return A.toString()}catch{}return""};return O.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 via-blue-900 to-slate-900 overflow-hidden relative",children:[O.jsxs("div",{className:"absolute inset-0 overflow-hidden",children:[O.jsx("div",{className:"absolute inset-0 bg-black/40"}),O.jsx(Rt.div,{animate:{scale:[1,1.1,1]},transition:{duration:20,repeat:1/0},className:"absolute top-0 right-0 w-1/3 h-1/2 opacity-20",children:O.jsx("img",{src:E("https://images.unsplash.com/photo-1607539594630-e86855287bc9?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&ixid=M3w3Nzg4Nzd8MHwxfHNlYXJjaHwxfHxtYXJzJTIwcGxhbmV0JTIwc3BhY2UlMjBleHBsb3JhdGlvbnxlbnwxfHx8fDE3NTkzMDcwMTd8MA&ixlib=rb-4.1.0&q=80&w=1080&utm_source=figma&utm_medium=referral"),alt:"Space Station",className:"w-full h-full object-cover rounded-lg"})}),O.jsx(Rt.div,{animate:{scale:[1.1,1,1.1]},transition:{duration:25,repeat:1/0},className:"absolute bottom-0 left-0 w-1/4 h-1/3 opacity-15",children:O.jsx("img",{src:E("https://images.unsplash.com/photo-1614729375290-b2a429db839b?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&ixid=M3w3Nzg4Nzd8MHwxfHxyb2NrZXQlMjBsYXVuY2glMjBzcGFjZWNyYWZ0fGVufDF8fHx8MTc1OTMwNzAyMXww&ixlib=rb-4.1.0&q=80&w=1080&utm_source=figma&utm_medium=referral"),alt:"Rocket Launch",className:"w-full h-full object-cover rounded-lg"})})]}),O.jsx("div",{className:"absolute inset-0 overflow-hidden",children:[...Array(20)].map((M,A)=>O.jsx(Rt.div,{className:"absolute w-2 h-2 bg-white rounded-full opacity-20",animate:{x:[0,Math.random()*100,0],y:[0,Math.random()*100,0],scale:[0,1,0]},transition:{duration:Math.random()*10+10,repeat:1/0,delay:Math.random()*5},style:{left:`${Math.random()*100}%`,top:`${Math.random()*100}%`}},A))}),O.jsxs("div",{className:"relative z-10 container mx-auto px-4 py-8 grid lg:grid-cols-2 gap-8 min-h-screen",children:[O.jsxs("div",{className:"flex flex-col justify-center space-y-8",children:[O.jsxs(Rt.div,{initial:{opacity:0,y:50},animate:{opacity:1,y:0},transition:{duration:.8},children:[O.jsxs("div",{className:"flex items-center gap-4 mb-6",children:[O.jsx(Rt.div,{animate:{rotate:360},transition:{duration:20,repeat:1/0,ease:"linear"},className:"w-16 h-16 bg-gradient-to-r from-blue-500 to-purple-500 rounded-full flex items-center justify-center",children:O.jsx(KA,{className:"w-8 h-8 text-white"})}),O.jsxs("div",{children:[O.jsx("h1",{className:"text-4xl font-bold text-white",children:"AstroNots"}),O.jsx("p",{className:"text-purple-300",children:"NASA Space Apps Challenge 2024"})]})]}),O.jsxs("div",{className:"space-y-4 text-gray-300 mb-8",children:[O.jsx("p",{className:"text-xl",children:"Revolutionizing space research analysis with AI-powered insights"}),O.jsxs("div",{className:"grid gap-4",children:[O.jsxs("div",{className:"flex items-center gap-3",children:[O.jsx(J3,{className:"w-5 h-5 text-blue-400"}),O.jsx("span",{children:"Analyze NASA research papers with advanced AI"})]}),O.jsxs("div",{className:"flex items-center gap-3",children:[O.jsx(ss,{className:"w-5 h-5 text-purple-400"}),O.jsx("span",{children:"Generate custom explanations for your field"})]}),O.jsxs("div",{className:"flex items-center gap-3",children:[O.jsx(w1,{className:"w-5 h-5 text-green-400"}),O.jsx("span",{children:"Collaborative research platform"})]})]})]})]}),O.jsxs(Rt.div,{initial:{opacity:0,x:-50},animate:{opacity:1,x:0},transition:{duration:.8,delay:.2},children:[O.jsx("h3",{className:"text-xl font-semibold text-white mb-4",children:"Meet the AstroNots Team"}),O.jsx("div",{className:"grid grid-cols-2 gap-4",children:b.map((M,A)=>O.jsxs(Rt.div,{whileHover:{scale:1.05},className:"bg-white/10 backdrop-blur-sm rounded-lg p-4 border border-white/20",children:[O.jsx("div",{className:"text-2xl mb-2",children:M.avatar}),O.jsx("h4",{className:"text-white font-medium",children:M.name}),O.jsx("p",{className:"text-gray-400 text-sm",children:M.role})]},A))})]})]}),O.jsx("div",{className:"flex flex-col justify-center",children:O.jsx(Rt.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},transition:{duration:.8,delay:.4},children:O.jsxs(zn,{className:"bg-white/10 backdrop-blur-sm border-white/20",children:[O.jsx(Yd,{children:O.jsx(Kd,{className:"text-white text-center",children:s?"Welcome Back":"Join AstroNots"})}),O.jsxs(jn,{className:"space-y-6",children:[O.jsxs("div",{className:"space-y-3",children:[O.jsx("label",{className:"text-white text-sm font-medium",children:"I am a:"}),O.jsx("div",{className:"grid gap-3",children:y.map(M=>{const A=M.icon;return O.jsx(Rt.div,{whileHover:{scale:1.02},whileTap:{scale:.98},onClick:()=>p(M.id),className:`p-4 rounded-lg border-2 cursor-pointer transition-all ${f===M.id?"border-white bg-white/20":"border-white/30 bg-white/5 hover:bg-white/10"}`,children:O.jsxs("div",{className:"flex items-center gap-3",children:[O.jsx("div",{className:`w-10 h-10 rounded-full bg-gradient-to-r ${M.color} flex items-center justify-center`,children:O.jsx(A,{className:"w-5 h-5 text-white"})}),O.jsxs("div",{children:[O.jsx("h4",{className:"text-white font-medium",children:M.title}),O.jsx("p",{className:"text-gray-300 text-sm",children:M.description})]})]})},M.id)})})]}),!s&&O.jsx(aA,{type:"text",placeholder:"Full Name",value:h,onChange:M=>d(M.target.value),className:"bg-white/10 border-white/30 text-white placeholder:text-gray-400",required:!0}),O.jsx(aA,{type:"email",placeholder:"Email",value:o,onChange:M=>l(M.target.value),className:"bg-white/10 border-white/30 text-white placeholder:text-gray-400",required:!0}),O.jsx(aA,{type:"password",placeholder:"Password (min 6 characters)",value:c,onChange:M=>u(M.target.value),className:"bg-white/10 border-white/30 text-white placeholder:text-gray-400",required:!0,minLength:6}),O.jsx(jr,{onClick:w,disabled:!o||!c||!s&&!h||n,className:"w-full bg-gradient-to-r from-blue-500 to-purple-500 hover:from-blue-600 hover:to-purple-600",children:s?"Launch Mission":"Join the Crew"}),O.jsxs("div",{className:"space-y-2",children:[O.jsx("p",{className:"text-gray-400 text-sm text-center",children:"Try demo accounts:"}),O.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[O.jsx(jr,{onClick:async()=>{l("scientist@astronots.space"),u("science123"),d("Dr. Sarah Chen"),p("scientist"),a(!0),la.success('Scientist demo loaded! Now click "Launch Mission"')},variant:"outline",size:"sm",className:"border-blue-500/30 text-blue-300 hover:bg-blue-500/10 text-xs",children:" Scientist"}),O.jsx(jr,{onClick:()=>{l("investor@astronots.space"),u("invest123"),d("Mike Johnson"),p("investor"),a(!0),la.success('Investor demo loaded! Now click "Launch Mission"')},variant:"outline",size:"sm",className:"border-green-500/30 text-green-300 hover:bg-green-500/10 text-xs",children:" Investor"}),O.jsx(jr,{onClick:()=>{l("architect@astronots.space"),u("mission123"),d("Emma Rodriguez"),p("mission-architect"),a(!0),la.success('Mission Architect demo loaded! Now click "Launch Mission"')},variant:"outline",size:"sm",className:"border-red-500/30 text-red-300 hover:bg-red-500/10 text-xs",children:" Architect"})]}),O.jsx(jr,{onClick:async()=>{try{if(console.log("Attempting quick login with scientist@astronots.space"),!i){console.error("Sign in function is not available"),la.error("Authentication service is not available");return}const M=await i("scientist@astronots.space","science123");if(console.log("Quick login result:",M),!M?.success||M?.error){const A=M?.error?.message||"Quick login failed";console.error("Quick login error:",A),la.error(A)}else e&&e("scientist"),la.success("Quick login successful!")}catch(M){console.error("Quick login error:",M),la.error("Login failed: "+(M?.message||String(M)))}},variant:"outline",size:"sm",className:"w-full border-purple-500/30 text-purple-300 hover:bg-purple-500/10 text-xs",children:" Quick Login (Scientist)"})]}),O.jsx("div",{className:"text-center",children:O.jsx("button",{onClick:()=>a(!s),className:"text-purple-300 hover:text-white transition-colors text-sm",children:s?"Don't have an account? Sign up":"Already have an account? Sign in"})}),g&&O.jsx("div",{className:"text-red-500 text-sm text-center",children:g})]})]})})})]})]})}function c_(t,e=[]){let i=[];function r(s,a){const o=J.createContext(a),l=i.length;i=[...i,a];const c=h=>{const{scope:d,children:f,...p}=h,g=d?.[t]?.[l]||o,m=J.useMemo(()=>p,Object.values(p));return O.jsx(g.Provider,{value:m,children:f})};c.displayName=s+"Provider";function u(h,d){const f=d?.[t]?.[l]||o,p=J.useContext(f);if(p)return p;if(a!==void 0)return a;throw new Error(`\`${h}\` must be used within \`${s}\``)}return[c,u]}const n=()=>{const s=i.map(a=>J.createContext(a));return function(o){const l=o?.[t]||s;return J.useMemo(()=>({[`__scope${t}`]:{...o,[t]:l}}),[o,l])}};return n.scopeName=t,[r,YEe(n,...e)]}function YEe(...t){const e=t[0];if(t.length===1)return e;const i=()=>{const r=t.map(n=>({useScope:n(),scopeName:n.scopeName}));return function(s){const a=r.reduce((o,{useScope:l,scopeName:c})=>{const h=l(s)[`__scope${c}`];return{...o,...h}},{});return J.useMemo(()=>({[`__scope${e.scopeName}`]:a}),[a])}};return i.scopeName=e.scopeName,i}function Up(t){const e=J.useRef(t);return J.useEffect(()=>{e.current=t}),J.useMemo(()=>(...i)=>e.current?.(...i),[])}var va=globalThis?.document?J.useLayoutEffect:()=>{},KEe=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"],rn=KEe.reduce((t,e)=>{const i=$A(`Primitive.${e}`),r=J.forwardRef((n,s)=>{const{asChild:a,...o}=n,l=a?i:e;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),O.jsx(l,{...o,ref:s})});return r.displayName=`Primitive.${e}`,{...t,[e]:r}},{});function ZEe(t,e){t&&sT.flushSync(()=>t.dispatchEvent(e))}var Vk={exports:{}},Hk={};/**
 * @license React
 * use-sync-external-store-shim.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var S7;function QEe(){if(S7)return Hk;S7=1;var t=ZM();function e(h,d){return h===d&&(h!==0||1/h===1/d)||h!==h&&d!==d}var i=typeof Object.is=="function"?Object.is:e,r=t.useState,n=t.useEffect,s=t.useLayoutEffect,a=t.useDebugValue;function o(h,d){var f=d(),p=r({inst:{value:f,getSnapshot:d}}),g=p[0].inst,m=p[1];return s(function(){g.value=f,g.getSnapshot=d,l(g)&&m({inst:g})},[h,f,d]),n(function(){return l(g)&&m({inst:g}),h(function(){l(g)&&m({inst:g})})},[h]),a(f),f}function l(h){var d=h.getSnapshot;h=h.value;try{var f=d();return!i(h,f)}catch{return!0}}function c(h,d){return d()}var u=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?c:o;return Hk.useSyncExternalStore=t.useSyncExternalStore!==void 0?t.useSyncExternalStore:u,Hk}var E7;function JEe(){return E7||(E7=1,Vk.exports=QEe()),Vk.exports}var eAe=JEe();function tAe(){return eAe.useSyncExternalStore(iAe,()=>!0,()=>!1)}function iAe(){return()=>{}}var f6="Avatar",[rAe]=c_(f6),[nAe,zse]=rAe(f6),jse=J.forwardRef((t,e)=>{const{__scopeAvatar:i,...r}=t,[n,s]=J.useState("idle");return O.jsx(nAe,{scope:i,imageLoadingStatus:n,onImageLoadingStatusChange:s,children:O.jsx(rn.span,{...r,ref:e})})});jse.displayName=f6;var Vse="AvatarImage",sAe=J.forwardRef((t,e)=>{const{__scopeAvatar:i,src:r,onLoadingStatusChange:n=()=>{},...s}=t,a=zse(Vse,i),o=aAe(r,s),l=Up(c=>{n(c),a.onImageLoadingStatusChange(c)});return va(()=>{o!=="idle"&&l(o)},[o,l]),o==="loaded"?O.jsx(rn.img,{...s,ref:e,src:r}):null});sAe.displayName=Vse;var Hse="AvatarFallback",Gse=J.forwardRef((t,e)=>{const{__scopeAvatar:i,delayMs:r,...n}=t,s=zse(Hse,i),[a,o]=J.useState(r===void 0);return J.useEffect(()=>{if(r!==void 0){const l=window.setTimeout(()=>o(!0),r);return()=>window.clearTimeout(l)}},[r]),a&&s.imageLoadingStatus!=="loaded"?O.jsx(rn.span,{...n,ref:e}):null});Gse.displayName=Hse;function A7(t,e){return t?e?(t.src!==e&&(t.src=e),t.complete&&t.naturalWidth>0?"loaded":"loading"):"error":"idle"}function aAe(t,{referrerPolicy:e,crossOrigin:i}){const r=tAe(),n=J.useRef(null),s=r?(n.current||(n.current=new window.Image),n.current):null,[a,o]=J.useState(()=>A7(s,t));return va(()=>{o(A7(s,t))},[s,t]),va(()=>{const l=h=>()=>{o(h)};if(!s)return;const c=l("loaded"),u=l("error");return s.addEventListener("load",c),s.addEventListener("error",u),e&&(s.referrerPolicy=e),typeof i=="string"&&(s.crossOrigin=i),()=>{s.removeEventListener("load",c),s.removeEventListener("error",u)}},[s,i,e]),a}var oAe=jse,lAe=Gse;function cAe({className:t,...e}){return O.jsx(oAe,{"data-slot":"avatar",className:Ws("relative flex size-10 shrink-0 overflow-hidden rounded-full",t),...e})}function uAe({className:t,...e}){return O.jsx(lAe,{"data-slot":"avatar-fallback",className:Ws("bg-muted flex size-full items-center justify-center rounded-full",t),...e})}const Wse=J.createContext(),qse=()=>J.useContext(Wse),hAe=({children:t})=>{const[e,i]=J.useState(null),[r,n]=J.useState(!0);J.useEffect(()=>{bd.auth.getSession().then(({data:{session:l}})=>{i(l),n(!1)});const{data:{subscription:o}}=bd.auth.onAuthStateChange((l,c)=>{i(c)});return()=>o.unsubscribe()},[]);const s=async(o,l)=>{if(!e)return console.log("404: session not found"),{success:!1,error:"No session"};const c=[{user_id:e.user.id,query:o,response:l}];try{const{data:u,error:h}=await bd.from("history").insert(c);if(h)throw h;return{success:!0,data:u}}catch(u){return console.error("Error storing history:",u),{success:!1,error:u}}},a=async()=>{if(!e?.user?.id)return console.error("No valid session, cannot fetch history"),{success:!1,error:"No session"};try{const{data:o,error:l}=await bd.from("history").select("id, query, response, created_at").eq("user_id",e.user.id).order("created_at",{ascending:!1});if(l)throw l;return{success:!0,data:o}}catch(o){return console.error("Error getting history:",o),{success:!1,error:o}}};return O.jsx(Wse.Provider,{value:{session:e,loading:r,createHistory:s,getHistory:a},children:t})};function dAe({user:t,userType:e,currentPage:i,onPageChange:r,onUserTypeChange:n,onSignOut:s,theme:a,onToggle:o,onSelectHistory:l}){const{getHistory:c,session:u,loading:h}=qse(),[d,f]=J.useState(!1),[p,g]=J.useState([]),[m,y]=J.useState(!1),b=async()=>{if(h){console.log("History fetch skipped: auth loading");return}if(!u?.user?.id){console.warn("No user session found. Please sign in."),f(I=>!I);return}if(d){f(!1);return}try{y(!0);const I=await c();if(I?.success){const z=(Array.isArray(I.data)?I.data:[]).map(V=>({query:V.query||"",response:V.response||""}));g(z)}else console.error("Failed to get history:",I?.error||"Unknown error"),g([])}catch(I){console.error("Error getting history:",I),g([])}finally{y(!1),f(!0)}},w=()=>{switch(e){case"scientist":return ss;case"investor":return b1;case"mission-architect":return x1;default:return KA}},E=()=>{switch(e){case"scientist":return"bg-blue-500";case"investor":return"bg-green-500";case"mission-architect":return"bg-amber-400";default:return"bg-purple-500"}},M=w(),A=[{id:"main",label:"New Chat with Astro",icon:I1e},{id:"data-gallery",label:"Data Library",icon:oA},{id:"chat-history",label:"Chat History",icon:P1e}],P=[{id:"how-it-works",label:"How It Works",icon:m1e},{id:"about",label:"Our Team",icon:w1}],C=[{id:"scientist",label:"Scientist",icon:ss},{id:"investor",label:"Manager/Investor",icon:b1},{id:"mission-architect",label:"Mission Architect",icon:x1}],R=()=>{r&&r("main"),typeof window<"u"&&setTimeout(()=>{window.location.reload()},50)};return O.jsxs(Rt.div,{className:"w-80 h-full bg-black/20 backdrop-blur-sm border-r border-white/10 flex flex-col relative z-50",initial:{x:-300},animate:{x:0},transition:{duration:.3},children:[O.jsxs("div",{className:"p-6 border-b border-white/10",children:[O.jsxs("div",{className:"flex items-center justify-between mb-4",children:[O.jsxs("div",{className:"flex items-center gap-3",children:[O.jsx(Rt.div,{animate:{rotate:360},transition:{duration:20,repeat:1/0,ease:"linear"},className:`w-10 h-10 bg-gradient-to-r ${a?.primary} rounded-full flex items-center justify-center`,children:O.jsx(KA,{className:"w-5 h-5 text-white"})}),O.jsxs("div",{children:[O.jsx("h2",{className:"text-white font-semibold",children:"AstroNots"}),O.jsx("p",{className:"text-gray-400 text-sm",children:"Space Research AI"})]})]}),O.jsx(jr,{variant:"ghost",size:"sm",onClick:o,className:"text-gray-400 hover:text-white p-1","aria-label":"Close sidebar",children:O.jsx(gse,{className:"w-5 h-5"})})]}),O.jsxs("div",{className:"flex items-center gap-3 p-3 bg-white/5 rounded-lg",children:[O.jsx(cAe,{className:"w-10 h-10",children:O.jsx(uAe,{className:`${E()} text-white`,children:t?.user_metadata?.name?.[0]||t?.email?.[0]?.toUpperCase()})}),O.jsxs("div",{className:"flex-1 min-w-0",children:[O.jsx("p",{className:"text-white text-sm font-medium truncate",children:t?.user_metadata?.name||t?.email}),O.jsxs("div",{className:"flex items-center gap-2",children:[O.jsx(M,{className:"w-3 h-3 text-gray-400"}),O.jsx("p",{className:"text-gray-400 text-xs capitalize",children:e.replace("-"," ")})]})]})]})]}),O.jsxs("div",{className:"flex-1 p-4 space-y-2",children:[A.map(I=>{const k=I.icon,z=i===I.id,V=()=>{I.id==="main"?R():I.id==="chat-history"?b():r&&r(I.id)};return O.jsxs("div",{children:[O.jsx(Rt.div,{whileHover:{scale:1.02},whileTap:{scale:.98},children:O.jsxs(jr,{variant:"ghost",onClick:V,className:`w-full justify-start gap-3 h-12 transition-all ${z?`bg-gradient-to-r ${a?.primary} text-white shadow-lg`:"text-gray-300 hover:text-white hover:bg-white/10"}`,"aria-expanded":I.id==="chat-history"?d:void 0,children:[O.jsx(k,{className:"w-5 h-5"}),O.jsx("span",{children:I.label}),I.id==="chat-history"&&O.jsx(rT,{className:`w-4 h-4 ml-auto transition-transform duration-200 ${d?"rotate-180":"rotate-0"} text-gray-400`,"aria-hidden":!0})]})}),I.id==="chat-history"&&O.jsx(ql,{children:d&&O.jsx(Rt.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},transition:{duration:.25,ease:"easeInOut"},className:"mt-2 overflow-hidden",children:O.jsx("div",{className:"max-h-64 overflow-auto space-y-2 p-2 bg-white/5 rounded border border-white/10",children:m?O.jsx("div",{className:"text-gray-300 text-sm p-2",children:"Loading history"}):p.length===0?O.jsx("div",{className:"text-gray-400 text-sm p-2",children:"No chat history found."}):p.map((F,$)=>O.jsxs(jr,{variant:"ghost",type:"button",onClick:()=>{let K="";const X=F.response;typeof X=="string"?K=X:Array.isArray(X)?K=X.map(Y=>Y&&typeof Y=="object"&&"text"in Y?Y.text:JSON.stringify(Y)).join(`

`):X&&typeof X=="object"?Array.isArray(X.paragraphs)?K=X.paragraphs.map(Y=>typeof Y?.text=="string"?Y.text:JSON.stringify(Y)).join(`

`):K=JSON.stringify(X):K=String(X??"");const U={paragraphs:[{title:"",text:K,images:[],tables:[]}],metadata:{total_paragraphs:1,total_images:[],total_tables:[],source_documents:0,user_type:e,query:F.query},userType:e,overallTitle:""};l&&l(U),f(!1),r&&r("main")},className:"w-full justify-start text-sm text-gray-300 hover:text-white hover:bg-white/10 truncate",title:F.query,children:[String(F.query||"").slice(0,50),String(F.query||"").length>50?"":""]},$))})})})]},I.id)}),O.jsxs("div",{className:"pt-4 border-t border-white/10 mt-4",children:[O.jsx("p",{className:"text-gray-400 text-xs uppercase tracking-wider mb-3 px-3",children:"User Type"}),O.jsx("div",{className:"space-y-1",children:C.map(I=>{const k=I.icon,z=e===I.id;return O.jsx(Rt.div,{whileHover:{scale:1.02},whileTap:{scale:.98},children:O.jsxs(jr,{variant:"ghost",onClick:()=>n(I.id),className:`w-full justify-start gap-3 h-10 text-sm transition-all ${z?"bg-white/10 text-white":"text-gray-400 hover:text-gray-300 hover:bg-white/5"}`,children:[O.jsx(k,{className:"w-4 h-4"}),I.label]})},I.id)})})]}),O.jsx("div",{className:"pt-4 border-t border-white/10 mt-4 space-y-2",children:P.map(I=>{const k=I.icon,z=i===I.id;return O.jsx(Rt.div,{whileHover:{scale:1.02},whileTap:{scale:.98},children:O.jsxs(jr,{variant:"ghost",onClick:()=>r(I.id),className:`w-full justify-start gap-3 h-12 transition-all ${z?`bg-gradient-to-r ${a?.primary} text-white shadow-lg`:"text-gray-300 hover:text-white hover:bg-white/10"}`,children:[O.jsx(k,{className:"w-5 h-5"}),I.label]})},I.id)})})]}),O.jsx("div",{className:"p-4 border-t border-white/10 space-y-2",children:O.jsxs(jr,{variant:"ghost",onClick:s,className:"w-full justify-start gap-3 text-red-400 hover:text-red-300 hover:bg-red-500/10",children:[O.jsx(F1e,{className:"w-5 h-5"}),"Sign Out"]})})]})}function Xse({className:t,...e}){return O.jsx("textarea",{"data-slot":"textarea",className:Ws("resize-none border-input placeholder:text-muted-foreground focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 flex field-sizing-content min-h-16 w-full rounded-md border bg-input-background px-3 py-2 text-base transition-[color,box-shadow] outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",t),...e})}var M7;(function(t){t.STRING="string",t.NUMBER="number",t.INTEGER="integer",t.BOOLEAN="boolean",t.ARRAY="array",t.OBJECT="object"})(M7||(M7={}));/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var T7;(function(t){t.LANGUAGE_UNSPECIFIED="language_unspecified",t.PYTHON="python"})(T7||(T7={}));var C7;(function(t){t.OUTCOME_UNSPECIFIED="outcome_unspecified",t.OUTCOME_OK="outcome_ok",t.OUTCOME_FAILED="outcome_failed",t.OUTCOME_DEADLINE_EXCEEDED="outcome_deadline_exceeded"})(C7||(C7={}));/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const P7=["user","model","function","system"];var R7;(function(t){t.HARM_CATEGORY_UNSPECIFIED="HARM_CATEGORY_UNSPECIFIED",t.HARM_CATEGORY_HATE_SPEECH="HARM_CATEGORY_HATE_SPEECH",t.HARM_CATEGORY_SEXUALLY_EXPLICIT="HARM_CATEGORY_SEXUALLY_EXPLICIT",t.HARM_CATEGORY_HARASSMENT="HARM_CATEGORY_HARASSMENT",t.HARM_CATEGORY_DANGEROUS_CONTENT="HARM_CATEGORY_DANGEROUS_CONTENT",t.HARM_CATEGORY_CIVIC_INTEGRITY="HARM_CATEGORY_CIVIC_INTEGRITY"})(R7||(R7={}));var I7;(function(t){t.HARM_BLOCK_THRESHOLD_UNSPECIFIED="HARM_BLOCK_THRESHOLD_UNSPECIFIED",t.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",t.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",t.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",t.BLOCK_NONE="BLOCK_NONE"})(I7||(I7={}));var D7;(function(t){t.HARM_PROBABILITY_UNSPECIFIED="HARM_PROBABILITY_UNSPECIFIED",t.NEGLIGIBLE="NEGLIGIBLE",t.LOW="LOW",t.MEDIUM="MEDIUM",t.HIGH="HIGH"})(D7||(D7={}));var O7;(function(t){t.BLOCKED_REASON_UNSPECIFIED="BLOCKED_REASON_UNSPECIFIED",t.SAFETY="SAFETY",t.OTHER="OTHER"})(O7||(O7={}));var hA;(function(t){t.FINISH_REASON_UNSPECIFIED="FINISH_REASON_UNSPECIFIED",t.STOP="STOP",t.MAX_TOKENS="MAX_TOKENS",t.SAFETY="SAFETY",t.RECITATION="RECITATION",t.LANGUAGE="LANGUAGE",t.BLOCKLIST="BLOCKLIST",t.PROHIBITED_CONTENT="PROHIBITED_CONTENT",t.SPII="SPII",t.MALFORMED_FUNCTION_CALL="MALFORMED_FUNCTION_CALL",t.OTHER="OTHER"})(hA||(hA={}));var L7;(function(t){t.TASK_TYPE_UNSPECIFIED="TASK_TYPE_UNSPECIFIED",t.RETRIEVAL_QUERY="RETRIEVAL_QUERY",t.RETRIEVAL_DOCUMENT="RETRIEVAL_DOCUMENT",t.SEMANTIC_SIMILARITY="SEMANTIC_SIMILARITY",t.CLASSIFICATION="CLASSIFICATION",t.CLUSTERING="CLUSTERING"})(L7||(L7={}));var Fw;(function(t){t.MODE_UNSPECIFIED="MODE_UNSPECIFIED",t.AUTO="AUTO",t.ANY="ANY",t.NONE="NONE"})(Fw||(Fw={}));var k7;(function(t){t.MODE_UNSPECIFIED="MODE_UNSPECIFIED",t.MODE_DYNAMIC="MODE_DYNAMIC"})(k7||(k7={}));/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Uo extends Error{constructor(e){super(`[GoogleGenerativeAI Error]: ${e}`)}}class lb extends Uo{constructor(e,i){super(e),this.response=i}}class $se extends Uo{constructor(e,i,r,n){super(e),this.status=i,this.statusText=r,this.errorDetails=n}}class Fg extends Uo{}class Yse extends Uo{}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const fAe="https://generativelanguage.googleapis.com",pAe="v1beta",mAe="0.24.1",gAe="genai-js";var _0;(function(t){t.GENERATE_CONTENT="generateContent",t.STREAM_GENERATE_CONTENT="streamGenerateContent",t.COUNT_TOKENS="countTokens",t.EMBED_CONTENT="embedContent",t.BATCH_EMBED_CONTENTS="batchEmbedContents"})(_0||(_0={}));class vAe{constructor(e,i,r,n,s){this.model=e,this.task=i,this.apiKey=r,this.stream=n,this.requestOptions=s}toString(){var e,i;const r=((e=this.requestOptions)===null||e===void 0?void 0:e.apiVersion)||pAe;let s=`${((i=this.requestOptions)===null||i===void 0?void 0:i.baseUrl)||fAe}/${r}/${this.model}:${this.task}`;return this.stream&&(s+="?alt=sse"),s}}function yAe(t){const e=[];return t?.apiClient&&e.push(t.apiClient),e.push(`${gAe}/${mAe}`),e.join(" ")}async function xAe(t){var e;const i=new Headers;i.append("Content-Type","application/json"),i.append("x-goog-api-client",yAe(t.requestOptions)),i.append("x-goog-api-key",t.apiKey);let r=(e=t.requestOptions)===null||e===void 0?void 0:e.customHeaders;if(r){if(!(r instanceof Headers))try{r=new Headers(r)}catch(n){throw new Fg(`unable to convert customHeaders value ${JSON.stringify(r)} to Headers: ${n.message}`)}for(const[n,s]of r.entries()){if(n==="x-goog-api-key")throw new Fg(`Cannot set reserved header name ${n}`);if(n==="x-goog-api-client")throw new Fg(`Header name ${n} can only be set using the apiClient field`);i.append(n,s)}}return i}async function bAe(t,e,i,r,n,s){const a=new vAe(t,e,i,r,s);return{url:a.toString(),fetchOptions:Object.assign(Object.assign({},EAe(s)),{method:"POST",headers:await xAe(a),body:n})}}async function aT(t,e,i,r,n,s={},a=fetch){const{url:o,fetchOptions:l}=await bAe(t,e,i,r,n,s);return wAe(o,l,a)}async function wAe(t,e,i=fetch){let r;try{r=await i(t,e)}catch(n){_Ae(n,t)}return r.ok||await SAe(r,t),r}function _Ae(t,e){let i=t;throw i.name==="AbortError"?(i=new Yse(`Request aborted when fetching ${e.toString()}: ${t.message}`),i.stack=t.stack):t instanceof $se||t instanceof Fg||(i=new Uo(`Error fetching from ${e.toString()}: ${t.message}`),i.stack=t.stack),i}async function SAe(t,e){let i="",r;try{const n=await t.json();i=n.error.message,n.error.details&&(i+=` ${JSON.stringify(n.error.details)}`,r=n.error.details)}catch{}throw new $se(`Error fetching from ${e.toString()}: [${t.status} ${t.statusText}] ${i}`,t.status,t.statusText,r)}function EAe(t){const e={};if(t?.signal!==void 0||t?.timeout>=0){const i=new AbortController;t?.timeout>=0&&setTimeout(()=>i.abort(),t.timeout),t?.signal&&t.signal.addEventListener("abort",()=>{i.abort()}),e.signal=i.signal}return e}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function p6(t){return t.text=()=>{if(t.candidates&&t.candidates.length>0){if(t.candidates.length>1&&console.warn(`This response had ${t.candidates.length} candidates. Returning text from the first candidate only. Access response.candidates directly to use the other candidates.`),GR(t.candidates[0]))throw new lb(`${cg(t)}`,t);return AAe(t)}else if(t.promptFeedback)throw new lb(`Text not available. ${cg(t)}`,t);return""},t.functionCall=()=>{if(t.candidates&&t.candidates.length>0){if(t.candidates.length>1&&console.warn(`This response had ${t.candidates.length} candidates. Returning function calls from the first candidate only. Access response.candidates directly to use the other candidates.`),GR(t.candidates[0]))throw new lb(`${cg(t)}`,t);return console.warn("response.functionCall() is deprecated. Use response.functionCalls() instead."),N7(t)[0]}else if(t.promptFeedback)throw new lb(`Function call not available. ${cg(t)}`,t)},t.functionCalls=()=>{if(t.candidates&&t.candidates.length>0){if(t.candidates.length>1&&console.warn(`This response had ${t.candidates.length} candidates. Returning function calls from the first candidate only. Access response.candidates directly to use the other candidates.`),GR(t.candidates[0]))throw new lb(`${cg(t)}`,t);return N7(t)}else if(t.promptFeedback)throw new lb(`Function call not available. ${cg(t)}`,t)},t}function AAe(t){var e,i,r,n;const s=[];if(!((i=(e=t.candidates)===null||e===void 0?void 0:e[0].content)===null||i===void 0)&&i.parts)for(const a of(n=(r=t.candidates)===null||r===void 0?void 0:r[0].content)===null||n===void 0?void 0:n.parts)a.text&&s.push(a.text),a.executableCode&&s.push("\n```"+a.executableCode.language+`
`+a.executableCode.code+"\n```\n"),a.codeExecutionResult&&s.push("\n```\n"+a.codeExecutionResult.output+"\n```\n");return s.length>0?s.join(""):""}function N7(t){var e,i,r,n;const s=[];if(!((i=(e=t.candidates)===null||e===void 0?void 0:e[0].content)===null||i===void 0)&&i.parts)for(const a of(n=(r=t.candidates)===null||r===void 0?void 0:r[0].content)===null||n===void 0?void 0:n.parts)a.functionCall&&s.push(a.functionCall);if(s.length>0)return s}const MAe=[hA.RECITATION,hA.SAFETY,hA.LANGUAGE];function GR(t){return!!t.finishReason&&MAe.includes(t.finishReason)}function cg(t){var e,i,r;let n="";if((!t.candidates||t.candidates.length===0)&&t.promptFeedback)n+="Response was blocked",!((e=t.promptFeedback)===null||e===void 0)&&e.blockReason&&(n+=` due to ${t.promptFeedback.blockReason}`),!((i=t.promptFeedback)===null||i===void 0)&&i.blockReasonMessage&&(n+=`: ${t.promptFeedback.blockReasonMessage}`);else if(!((r=t.candidates)===null||r===void 0)&&r[0]){const s=t.candidates[0];GR(s)&&(n+=`Candidate was blocked due to ${s.finishReason}`,s.finishMessage&&(n+=`: ${s.finishMessage}`))}return n}function JA(t){return this instanceof JA?(this.v=t,this):new JA(t)}function TAe(t,e,i){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r=i.apply(t,e||[]),n,s=[];return n={},a("next"),a("throw"),a("return"),n[Symbol.asyncIterator]=function(){return this},n;function a(d){r[d]&&(n[d]=function(f){return new Promise(function(p,g){s.push([d,f,p,g])>1||o(d,f)})})}function o(d,f){try{l(r[d](f))}catch(p){h(s[0][3],p)}}function l(d){d.value instanceof JA?Promise.resolve(d.value.v).then(c,u):h(s[0][2],d)}function c(d){o("next",d)}function u(d){o("throw",d)}function h(d,f){d(f),s.shift(),s.length&&o(s[0][0],s[0][1])}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const U7=/^data\: (.*)(?:\n\n|\r\r|\r\n\r\n)/;function CAe(t){const e=t.body.pipeThrough(new TextDecoderStream("utf8",{fatal:!0})),i=IAe(e),[r,n]=i.tee();return{stream:RAe(r),response:PAe(n)}}async function PAe(t){const e=[],i=t.getReader();for(;;){const{done:r,value:n}=await i.read();if(r)return p6(DAe(e));e.push(n)}}function RAe(t){return TAe(this,arguments,function*(){const i=t.getReader();for(;;){const{value:r,done:n}=yield JA(i.read());if(n)break;yield yield JA(p6(r))}})}function IAe(t){const e=t.getReader();return new ReadableStream({start(r){let n="";return s();function s(){return e.read().then(({value:a,done:o})=>{if(o){if(n.trim()){r.error(new Uo("Failed to parse stream"));return}r.close();return}n+=a;let l=n.match(U7),c;for(;l;){try{c=JSON.parse(l[1])}catch{r.error(new Uo(`Error parsing JSON response: "${l[1]}"`));return}r.enqueue(c),n=n.substring(l[0].length),l=n.match(U7)}return s()}).catch(a=>{let o=a;throw o.stack=a.stack,o.name==="AbortError"?o=new Yse("Request aborted when reading from the stream"):o=new Uo("Error reading from the stream"),o})}}})}function DAe(t){const e=t[t.length-1],i={promptFeedback:e?.promptFeedback};for(const r of t){if(r.candidates){let n=0;for(const s of r.candidates)if(i.candidates||(i.candidates=[]),i.candidates[n]||(i.candidates[n]={index:n}),i.candidates[n].citationMetadata=s.citationMetadata,i.candidates[n].groundingMetadata=s.groundingMetadata,i.candidates[n].finishReason=s.finishReason,i.candidates[n].finishMessage=s.finishMessage,i.candidates[n].safetyRatings=s.safetyRatings,s.content&&s.content.parts){i.candidates[n].content||(i.candidates[n].content={role:s.content.role||"user",parts:[]});const a={};for(const o of s.content.parts)o.text&&(a.text=o.text),o.functionCall&&(a.functionCall=o.functionCall),o.executableCode&&(a.executableCode=o.executableCode),o.codeExecutionResult&&(a.codeExecutionResult=o.codeExecutionResult),Object.keys(a).length===0&&(a.text=""),i.candidates[n].content.parts.push(a)}n++}r.usageMetadata&&(i.usageMetadata=r.usageMetadata)}return i}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Kse(t,e,i,r){const n=await aT(e,_0.STREAM_GENERATE_CONTENT,t,!0,JSON.stringify(i),r);return CAe(n)}async function Zse(t,e,i,r){const s=await(await aT(e,_0.GENERATE_CONTENT,t,!1,JSON.stringify(i),r)).json();return{response:p6(s)}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Qse(t){if(t!=null){if(typeof t=="string")return{role:"system",parts:[{text:t}]};if(t.text)return{role:"system",parts:[t]};if(t.parts)return t.role?t:{role:"system",parts:t.parts}}}function eM(t){let e=[];if(typeof t=="string")e=[{text:t}];else for(const i of t)typeof i=="string"?e.push({text:i}):e.push(i);return OAe(e)}function OAe(t){const e={role:"user",parts:[]},i={role:"function",parts:[]};let r=!1,n=!1;for(const s of t)"functionResponse"in s?(i.parts.push(s),n=!0):(e.parts.push(s),r=!0);if(r&&n)throw new Uo("Within a single message, FunctionResponse cannot be mixed with other type of part in the request for sending chat message.");if(!r&&!n)throw new Uo("No content is provided for sending chat message.");return r?e:i}function LAe(t,e){var i;let r={model:e?.model,generationConfig:e?.generationConfig,safetySettings:e?.safetySettings,tools:e?.tools,toolConfig:e?.toolConfig,systemInstruction:e?.systemInstruction,cachedContent:(i=e?.cachedContent)===null||i===void 0?void 0:i.name,contents:[]};const n=t.generateContentRequest!=null;if(t.contents){if(n)throw new Fg("CountTokensRequest must have one of contents or generateContentRequest, not both.");r.contents=t.contents}else if(n)r=Object.assign(Object.assign({},r),t.generateContentRequest);else{const s=eM(t);r.contents=[s]}return{generateContentRequest:r}}function B7(t){let e;return t.contents?e=t:e={contents:[eM(t)]},t.systemInstruction&&(e.systemInstruction=Qse(t.systemInstruction)),e}function kAe(t){return typeof t=="string"||Array.isArray(t)?{content:eM(t)}:t}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const F7=["text","inlineData","functionCall","functionResponse","executableCode","codeExecutionResult"],NAe={user:["text","inlineData"],function:["functionResponse"],model:["text","functionCall","executableCode","codeExecutionResult"],system:["text"]};function UAe(t){let e=!1;for(const i of t){const{role:r,parts:n}=i;if(!e&&r!=="user")throw new Uo(`First content should be with role 'user', got ${r}`);if(!P7.includes(r))throw new Uo(`Each item should include role field. Got ${r} but valid roles are: ${JSON.stringify(P7)}`);if(!Array.isArray(n))throw new Uo("Content should have 'parts' property with an array of Parts");if(n.length===0)throw new Uo("Each Content should have at least one part");const s={text:0,inlineData:0,functionCall:0,functionResponse:0,fileData:0,executableCode:0,codeExecutionResult:0};for(const o of n)for(const l of F7)l in o&&(s[l]+=1);const a=NAe[r];for(const o of F7)if(!a.includes(o)&&s[o]>0)throw new Uo(`Content with role '${r}' can't contain '${o}' part`);e=!0}}function z7(t){var e;if(t.candidates===void 0||t.candidates.length===0)return!1;const i=(e=t.candidates[0])===null||e===void 0?void 0:e.content;if(i===void 0||i.parts===void 0||i.parts.length===0)return!1;for(const r of i.parts)if(r===void 0||Object.keys(r).length===0||r.text!==void 0&&r.text==="")return!1;return!0}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const j7="SILENT_ERROR";class BAe{constructor(e,i,r,n={}){this.model=i,this.params=r,this._requestOptions=n,this._history=[],this._sendPromise=Promise.resolve(),this._apiKey=e,r?.history&&(UAe(r.history),this._history=r.history)}async getHistory(){return await this._sendPromise,this._history}async sendMessage(e,i={}){var r,n,s,a,o,l;await this._sendPromise;const c=eM(e),u={safetySettings:(r=this.params)===null||r===void 0?void 0:r.safetySettings,generationConfig:(n=this.params)===null||n===void 0?void 0:n.generationConfig,tools:(s=this.params)===null||s===void 0?void 0:s.tools,toolConfig:(a=this.params)===null||a===void 0?void 0:a.toolConfig,systemInstruction:(o=this.params)===null||o===void 0?void 0:o.systemInstruction,cachedContent:(l=this.params)===null||l===void 0?void 0:l.cachedContent,contents:[...this._history,c]},h=Object.assign(Object.assign({},this._requestOptions),i);let d;return this._sendPromise=this._sendPromise.then(()=>Zse(this._apiKey,this.model,u,h)).then(f=>{var p;if(z7(f.response)){this._history.push(c);const g=Object.assign({parts:[],role:"model"},(p=f.response.candidates)===null||p===void 0?void 0:p[0].content);this._history.push(g)}else{const g=cg(f.response);g&&console.warn(`sendMessage() was unsuccessful. ${g}. Inspect response object for details.`)}d=f}).catch(f=>{throw this._sendPromise=Promise.resolve(),f}),await this._sendPromise,d}async sendMessageStream(e,i={}){var r,n,s,a,o,l;await this._sendPromise;const c=eM(e),u={safetySettings:(r=this.params)===null||r===void 0?void 0:r.safetySettings,generationConfig:(n=this.params)===null||n===void 0?void 0:n.generationConfig,tools:(s=this.params)===null||s===void 0?void 0:s.tools,toolConfig:(a=this.params)===null||a===void 0?void 0:a.toolConfig,systemInstruction:(o=this.params)===null||o===void 0?void 0:o.systemInstruction,cachedContent:(l=this.params)===null||l===void 0?void 0:l.cachedContent,contents:[...this._history,c]},h=Object.assign(Object.assign({},this._requestOptions),i),d=Kse(this._apiKey,this.model,u,h);return this._sendPromise=this._sendPromise.then(()=>d).catch(f=>{throw new Error(j7)}).then(f=>f.response).then(f=>{if(z7(f)){this._history.push(c);const p=Object.assign({},f.candidates[0].content);p.role||(p.role="model"),this._history.push(p)}else{const p=cg(f);p&&console.warn(`sendMessageStream() was unsuccessful. ${p}. Inspect response object for details.`)}}).catch(f=>{f.message!==j7&&console.error(f)}),d}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function FAe(t,e,i,r){return(await aT(e,_0.COUNT_TOKENS,t,!1,JSON.stringify(i),r)).json()}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function zAe(t,e,i,r){return(await aT(e,_0.EMBED_CONTENT,t,!1,JSON.stringify(i),r)).json()}async function jAe(t,e,i,r){const n=i.requests.map(a=>Object.assign(Object.assign({},a),{model:e}));return(await aT(e,_0.BATCH_EMBED_CONTENTS,t,!1,JSON.stringify({requests:n}),r)).json()}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class V7{constructor(e,i,r={}){this.apiKey=e,this._requestOptions=r,i.model.includes("/")?this.model=i.model:this.model=`models/${i.model}`,this.generationConfig=i.generationConfig||{},this.safetySettings=i.safetySettings||[],this.tools=i.tools,this.toolConfig=i.toolConfig,this.systemInstruction=Qse(i.systemInstruction),this.cachedContent=i.cachedContent}async generateContent(e,i={}){var r;const n=B7(e),s=Object.assign(Object.assign({},this._requestOptions),i);return Zse(this.apiKey,this.model,Object.assign({generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:(r=this.cachedContent)===null||r===void 0?void 0:r.name},n),s)}async generateContentStream(e,i={}){var r;const n=B7(e),s=Object.assign(Object.assign({},this._requestOptions),i);return Kse(this.apiKey,this.model,Object.assign({generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:(r=this.cachedContent)===null||r===void 0?void 0:r.name},n),s)}startChat(e){var i;return new BAe(this.apiKey,this.model,Object.assign({generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:(i=this.cachedContent)===null||i===void 0?void 0:i.name},e),this._requestOptions)}async countTokens(e,i={}){const r=LAe(e,{model:this.model,generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:this.cachedContent}),n=Object.assign(Object.assign({},this._requestOptions),i);return FAe(this.apiKey,this.model,r,n)}async embedContent(e,i={}){const r=kAe(e),n=Object.assign(Object.assign({},this._requestOptions),i);return zAe(this.apiKey,this.model,r,n)}async batchEmbedContents(e,i={}){const r=Object.assign(Object.assign({},this._requestOptions),i);return jAe(this.apiKey,this.model,e,r)}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class H7{constructor(e){this.apiKey=e}getGenerativeModel(e,i){if(!e.model)throw new Uo("Must provide a model name. Example: genai.getGenerativeModel({ model: 'my-model-name' })");return new V7(this.apiKey,e,i)}getGenerativeModelFromCachedContent(e,i,r){if(!e.name)throw new Fg("Cached content must contain a `name` field.");if(!e.model)throw new Fg("Cached content must contain a `model` field.");const n=["model","systemInstruction"];for(const a of n)if(i?.[a]&&e[a]&&i?.[a]!==e[a]){if(a==="model"){const o=i.model.startsWith("models/")?i.model.replace("models/",""):i.model,l=e.model.startsWith("models/")?e.model.replace("models/",""):e.model;if(o===l)continue}throw new Fg(`Different value for "${a}" specified in modelParams (${i[a]}) and cachedContent (${e[a]})`)}const s=Object.assign(Object.assign({},i),{model:e.model,tools:e.tools,toolConfig:e.toolConfig,systemInstruction:e.systemInstruction,cachedContent:e});return new V7(this.apiKey,s,r)}}var VAe={};const HAe=()=>typeof window<"u"&&typeof window.document<"u",GAe=()=>typeof globalThis=="object"&&globalThis.constructor&&globalThis.constructor.name==="DedicatedWorkerGlobalScope",WAe=()=>typeof window<"u"&&window.name==="nodejs"||typeof navigator<"u"&&navigator.userAgent.includes("jsdom"),m6=()=>typeof Deno<"u",qAe=()=>typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"&&!m6(),XAe=()=>{let t;return HAe()?t="browser":qAe()?t="node":GAe()?t="webworker":WAe()?t="jsdom":m6()?t="deno":t="other",t};let Gk;function $Ae(){return Gk===void 0&&(Gk={library:"langchain-js",runtime:XAe()}),Gk}function c0(t){try{return typeof process<"u"?VAe?.[t]:m6()?Deno?.env.get(t):void 0}catch{return}}function G7(t,e=Jse){t=t.trim();const i=t.indexOf("```");if(i===-1)return e(t);let r=t.substring(i+3);r.startsWith(`json
`)?r=r.substring(5):r.startsWith("json")?r=r.substring(4):r.startsWith(`
`)&&(r=r.substring(1));const n=r.indexOf("```");let s=r;return n!==-1&&(s=r.substring(0,n)),e(s.trim())}function Jse(t){if(typeof t>"u")return null;try{return JSON.parse(t)}catch{}let e="";const i=[];let r=!1,n=!1;for(let s of t){if(r)s==='"'&&!n?r=!1:s===`
`&&!n?s="\\n":s==="\\"?n=!n:n=!1;else if(s==='"')r=!0,n=!1;else if(s==="{")i.push("}");else if(s==="[")i.push("]");else if(s==="}"||s==="]")if(i&&i[i.length-1]===s)i.pop();else return null;e+=s}r&&(e+='"');for(let s=i.length-1;s>=0;s-=1)e+=i[s];try{return JSON.parse(e)}catch{return null}}var Wk,W7;function YAe(){return W7||(W7=1,Wk=function(t,e){if(typeof t!="string")throw new TypeError("Expected a string");return e=typeof e>"u"?"_":e,t.replace(/([a-z\d])([A-Z])/g,"$1"+e+"$2").replace(/([A-Z]+)([A-Z][a-z\d]+)/g,"$1"+e+"$2").toLowerCase()}),Wk}var KAe=YAe();const ZAe=Lh(KAe);var t2={exports:{}},q7;function QAe(){if(q7)return t2.exports;q7=1;const t=/[\p{Lu}]/u,e=/[\p{Ll}]/u,i=/^[\p{Lu}](?![\p{Lu}])/gu,r=/([\p{Alpha}\p{N}_]|$)/u,n=/[_.\- ]+/,s=new RegExp("^"+n.source),a=new RegExp(n.source+r.source,"gu"),o=new RegExp("\\d+"+r.source,"gu"),l=(d,f,p)=>{let g=!1,m=!1,y=!1;for(let b=0;b<d.length;b++){const w=d[b];g&&t.test(w)?(d=d.slice(0,b)+"-"+d.slice(b),g=!1,y=m,m=!0,b++):m&&y&&e.test(w)?(d=d.slice(0,b-1)+"-"+d.slice(b-1),y=m,m=!1,g=!0):(g=f(w)===w&&p(w)!==w,y=m,m=p(w)===w&&f(w)!==w)}return d},c=(d,f)=>(i.lastIndex=0,d.replace(i,p=>f(p))),u=(d,f)=>(a.lastIndex=0,o.lastIndex=0,d.replace(a,(p,g)=>f(g)).replace(o,p=>f(p))),h=(d,f)=>{if(!(typeof d=="string"||Array.isArray(d)))throw new TypeError("Expected the input to be `string | string[]`");if(f={pascalCase:!1,preserveConsecutiveUppercase:!1,...f},Array.isArray(d)?d=d.map(y=>y.trim()).filter(y=>y.length).join("-"):d=d.trim(),d.length===0)return"";const p=f.locale===!1?y=>y.toLowerCase():y=>y.toLocaleLowerCase(f.locale),g=f.locale===!1?y=>y.toUpperCase():y=>y.toLocaleUpperCase(f.locale);return d.length===1?f.pascalCase?g(d):p(d):(d!==p(d)&&(d=l(d,p,g)),d=d.replace(s,""),f.preserveConsecutiveUppercase?d=c(d,p):d=p(d),f.pascalCase&&(d=g(d.charAt(0))+d.slice(1)),u(d,g))};return t2.exports=h,t2.exports.default=h,t2.exports}QAe();function JAe(t,e){return e?.[t]||ZAe(t)}function eMe(t,e,i){const r={};for(const n in t)Object.hasOwn(t,n)&&(r[e(n,i)]=t[n]);return r}function X7(t){return Array.isArray(t)?[...t]:{...t}}function tMe(t,e){const i=X7(t);for(const[r,n]of Object.entries(e)){const[s,...a]=r.split(".").reverse();let o=i;for(const l of a.reverse()){if(o[l]===void 0)break;o[l]=X7(o[l]),o=o[l]}o[s]!==void 0&&(o[s]={lc:1,type:"secret",id:[n]})}return i}function eae(t){const e=Object.getPrototypeOf(t);return typeof t.lc_name=="function"&&(typeof e.lc_name!="function"||t.lc_name()!==e.lc_name())?t.lc_name():t.name}class S0{static lc_name(){return this.name}get lc_id(){return[...this.lc_namespace,eae(this.constructor)]}get lc_secrets(){}get lc_attributes(){}get lc_aliases(){}get lc_serializable_keys(){}constructor(e,...i){Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lc_kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.lc_serializable_keys!==void 0?this.lc_kwargs=Object.fromEntries(Object.entries(e||{}).filter(([r])=>this.lc_serializable_keys?.includes(r))):this.lc_kwargs=e??{}}toJSON(){if(!this.lc_serializable)return this.toJSONNotImplemented();if(this.lc_kwargs instanceof S0||typeof this.lc_kwargs!="object"||Array.isArray(this.lc_kwargs))return this.toJSONNotImplemented();const e={},i={},r=Object.keys(this.lc_kwargs).reduce((n,s)=>(n[s]=s in this?this[s]:this.lc_kwargs[s],n),{});for(let n=Object.getPrototypeOf(this);n;n=Object.getPrototypeOf(n))Object.assign(e,Reflect.get(n,"lc_aliases",this)),Object.assign(i,Reflect.get(n,"lc_secrets",this)),Object.assign(r,Reflect.get(n,"lc_attributes",this));return Object.keys(i).forEach(n=>{let s=this,a=r;const[o,...l]=n.split(".").reverse();for(const c of l.reverse()){if(!(c in s)||s[c]===void 0)return;(!(c in a)||a[c]===void 0)&&(typeof s[c]=="object"&&s[c]!=null?a[c]={}:Array.isArray(s[c])&&(a[c]=[])),s=s[c],a=a[c]}o in s&&s[o]!==void 0&&(a[o]=a[o]||s[o])}),{lc:1,type:"constructor",id:this.lc_id,kwargs:eMe(Object.keys(i).length?tMe(r,i):r,JAe,e)}}toJSONNotImplemented(){return{lc:1,type:"not_implemented",id:this.lc_id}}}function S1(t){return typeof t=="object"&&t!==null&&"type"in t&&typeof t.type=="string"&&"source_type"in t&&(t.source_type==="url"||t.source_type==="base64"||t.source_type==="text"||t.source_type==="id")}function iMe(t){return S1(t)&&t.source_type==="url"&&"url"in t&&typeof t.url=="string"}function rMe(t){return S1(t)&&t.source_type==="base64"&&"data"in t&&typeof t.data=="string"}function nMe(t){if(S1(t)){if(t.source_type==="url")return{type:"image_url",image_url:{url:t.url}};if(t.source_type==="base64"){if(!t.mime_type)throw new Error("mime_type key is required for base64 data.");return{type:"image_url",image_url:{url:`data:${t.mime_type};base64,${t.data}`}}}}throw new Error("Unsupported source type. Only 'url' and 'base64' are supported.")}function qk({dataUrl:t,asTypedArray:e=!1}){const i=t.match(/^data:(\w+\/\w+);base64,([A-Za-z0-9+/]+=*)$/);let r;if(i){r=i[1].toLowerCase();const n=e?Uint8Array.from(atob(i[2]),s=>s.charCodeAt(0)):i[2];return{mime_type:r,data:n}}}function sMe(t,e){if(t.type==="text"){if(!e.fromStandardTextBlock)throw new Error(`Converter for ${e.providerName} does not implement \`fromStandardTextBlock\` method.`);return e.fromStandardTextBlock(t)}if(t.type==="image"){if(!e.fromStandardImageBlock)throw new Error(`Converter for ${e.providerName} does not implement \`fromStandardImageBlock\` method.`);return e.fromStandardImageBlock(t)}if(t.type==="audio"){if(!e.fromStandardAudioBlock)throw new Error(`Converter for ${e.providerName} does not implement \`fromStandardAudioBlock\` method.`);return e.fromStandardAudioBlock(t)}if(t.type==="file"){if(!e.fromStandardFileBlock)throw new Error(`Converter for ${e.providerName} does not implement \`fromStandardFileBlock\` method.`);return e.fromStandardFileBlock(t)}throw new Error(`Unable to convert content block type '${t.type}' to provider-specific format: not recognized.`)}function oT(t,e){return typeof t=="string"?t===""?e:typeof e=="string"?t+e:Array.isArray(e)&&e.some(i=>S1(i))?[{type:"text",source_type:"text",text:t},...e]:[{type:"text",text:t},...e]:Array.isArray(e)?g6(t,e)??[...t,...e]:e===""?t:Array.isArray(t)&&t.some(i=>S1(i))?[...t,{type:"file",source_type:"text",text:e}]:[...t,{type:"text",text:e}]}function aMe(t,e){function i(r,n){if(typeof r!="object"||r===null||r===void 0)return r;if(n>=e)return Array.isArray(r)?"[Array]":"[Object]";if(Array.isArray(r))return r.map(a=>i(a,n+1));const s={};for(const a of Object.keys(r))s[a]=i(r[a],n+1);return s}return JSON.stringify(i(t,0),null,2)}class G0 extends S0{get lc_aliases(){return{additional_kwargs:"additional_kwargs",response_metadata:"response_metadata"}}get text(){return typeof this.content=="string"?this.content:Array.isArray(this.content)?this.content.map(e=>typeof e=="string"?e:e.type==="text"?e.text:"").join(""):""}getType(){return this._getType()}constructor(e,i){typeof e=="string"&&(e={content:e,additional_kwargs:i,response_metadata:{}}),e.additional_kwargs||(e.additional_kwargs={}),e.response_metadata||(e.response_metadata={}),super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","messages"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"content",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"additional_kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"response_metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.name=e.name,this.content=e.content,this.additional_kwargs=e.additional_kwargs,this.response_metadata=e.response_metadata,this.id=e.id}toDict(){return{type:this._getType(),data:this.toJSON().kwargs}}static lc_name(){return"BaseMessage"}get _printableFields(){return{id:this.id,content:this.content,name:this.name,additional_kwargs:this.additional_kwargs,response_metadata:this.response_metadata}}_updateId(e){this.id=e,this.lc_kwargs.id=e}get[Symbol.toStringTag](){return this.constructor.lc_name()}[Symbol.for("nodejs.util.inspect.custom")](e){if(e===null)return this;const i=aMe(this._printableFields,Math.max(4,e));return`${this.constructor.lc_name()} ${i}`}}function wu(t,e){const i={...t};for(const[r,n]of Object.entries(e))if(i[r]==null)i[r]=n;else{if(n==null)continue;if(typeof i[r]!=typeof n||Array.isArray(i[r])!==Array.isArray(n))throw new Error(`field[${r}] already exists in the message chunk, but with a different type.`);if(typeof i[r]=="string"){if(r==="type")continue;["id","name","output_version","model_provider"].includes(r)?i[r]=n:i[r]+=n}else if(typeof i[r]=="object"&&!Array.isArray(i[r]))i[r]=wu(i[r],n);else if(Array.isArray(i[r]))i[r]=g6(i[r],n);else{if(i[r]===n)continue;console.warn(`field[${r}] already exists in this message chunk and value has unsupported type.`)}}return i}function g6(t,e){if(!(t===void 0&&e===void 0)){if(t===void 0||e===void 0)return t||e;{const i=[...t];for(const r of e)if(typeof r=="object"&&r!==null&&"index"in r&&typeof r.index=="number"){const n=i.findIndex(s=>{const a=typeof s=="object",o="index"in s&&s.index===r.index,l="id"in s&&"id"in r&&s?.id===r?.id,c=!("id"in s)||!s?.id||!("id"in r)||!r?.id;return a&&o&&(l||c)});n!==-1&&typeof i[n]=="object"&&i[n]!==null?i[n]=wu(i[n],r):i.push(r)}else{if(typeof r=="object"&&r!==null&&"text"in r&&r.text==="")continue;i.push(r)}return i}}}class lT extends G0{}function oMe(t){return typeof t.role=="string"}function cT(t){return typeof t?._getType=="function"}function lMe(t){return cT(t)&&typeof t.concat=="function"}class cMe extends G0{static lc_name(){return"ToolMessage"}get lc_aliases(){return{tool_call_id:"tool_call_id"}}constructor(e,i,r){typeof e=="string"&&(e={content:e,name:r,tool_call_id:i}),super(e),Object.defineProperty(this,"lc_direct_tool_output",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"status",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tool_call_id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"artifact",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.tool_call_id=e.tool_call_id,this.artifact=e.artifact,this.status=e.status,this.metadata=e.metadata}_getType(){return"tool"}static isInstance(e){return e._getType()==="tool"}get _printableFields(){return{...super._printableFields,tool_call_id:this.tool_call_id,artifact:this.artifact}}}function uMe(t){const e=[],i=[];for(const r of t)if(r.function){const n=r.function.name;try{const s=JSON.parse(r.function.arguments),a={name:n||"",args:s||{},id:r.id};e.push(a)}catch{i.push({name:n,args:r.function.arguments,id:r.id,error:"Malformed args."})}}else continue;return[e,i]}function hMe(t){return t._getType()==="tool"}class bz extends G0{get lc_aliases(){return{...super.lc_aliases,tool_calls:"tool_calls",invalid_tool_calls:"invalid_tool_calls"}}constructor(e,i){let r;if(typeof e=="string")r={content:e,tool_calls:[],invalid_tool_calls:[],additional_kwargs:i??{}};else{r=e;const n=r.additional_kwargs?.tool_calls,s=r.tool_calls;n!=null&&n.length>0&&(s===void 0||s.length===0)&&console.warn(["New LangChain packages are available that more efficiently handle",`tool calling.

Please upgrade your packages to versions that set`,"message tool calls. e.g., `yarn add @langchain/anthropic`,","yarn add @langchain/openai`, etc."].join(" "));try{if(n!=null&&s===void 0){const[a,o]=uMe(n);r.tool_calls=a??[],r.invalid_tool_calls=o??[]}else r.tool_calls=r.tool_calls??[],r.invalid_tool_calls=r.invalid_tool_calls??[]}catch{r.tool_calls=[],r.invalid_tool_calls=[]}}super(r),Object.defineProperty(this,"tool_calls",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"invalid_tool_calls",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"usage_metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),typeof r!="string"&&(this.tool_calls=r.tool_calls??this.tool_calls,this.invalid_tool_calls=r.invalid_tool_calls??this.invalid_tool_calls),this.usage_metadata=r.usage_metadata}static lc_name(){return"AIMessage"}_getType(){return"ai"}get _printableFields(){return{...super._printableFields,tool_calls:this.tool_calls,invalid_tool_calls:this.invalid_tool_calls,usage_metadata:this.usage_metadata}}}function v6(t){return t._getType()==="ai"}function $7(t){return t._getType()==="ai"}class u_ extends lT{constructor(e){let i;if(typeof e=="string")i={content:e,tool_calls:[],invalid_tool_calls:[],tool_call_chunks:[]};else if(e.tool_call_chunks===void 0)i={...e,tool_calls:e.tool_calls??[],invalid_tool_calls:[],tool_call_chunks:[],usage_metadata:e.usage_metadata!==void 0?e.usage_metadata:void 0};else{const r=e.tool_call_chunks.reduce((a,o)=>{const l=a.findIndex(([c])=>"id"in o&&o.id&&"index"in o&&o.index!==void 0?o.id===c.id&&o.index===c.index:"id"in o&&o.id?o.id===c.id:"index"in o&&o.index!==void 0?o.index===c.index:!1);return l!==-1?a[l].push(o):a.push([o]),a},[]),n=[],s=[];for(const a of r){let o={};const l=a[0]?.name??"",c=a.map(d=>d.args||"").join(""),u=c.length?c:"{}",h=a[0]?.id;try{if(o=Jse(u),!h||o===null||typeof o!="object"||Array.isArray(o))throw new Error("Malformed tool call chunk args.");n.push({name:l,args:o,id:h,type:"tool_call"})}catch{s.push({name:l,args:u,id:h,error:"Malformed args.",type:"invalid_tool_call"})}}i={...e,tool_calls:n,invalid_tool_calls:s,usage_metadata:e.usage_metadata!==void 0?e.usage_metadata:void 0}}super(i),Object.defineProperty(this,"tool_calls",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"invalid_tool_calls",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"tool_call_chunks",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"usage_metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.tool_call_chunks=i.tool_call_chunks??this.tool_call_chunks,this.tool_calls=i.tool_calls??this.tool_calls,this.invalid_tool_calls=i.invalid_tool_calls??this.invalid_tool_calls,this.usage_metadata=i.usage_metadata}get lc_aliases(){return{...super.lc_aliases,tool_calls:"tool_calls",invalid_tool_calls:"invalid_tool_calls",tool_call_chunks:"tool_call_chunks"}}static lc_name(){return"AIMessageChunk"}_getType(){return"ai"}get _printableFields(){return{...super._printableFields,tool_calls:this.tool_calls,tool_call_chunks:this.tool_call_chunks,invalid_tool_calls:this.invalid_tool_calls,usage_metadata:this.usage_metadata}}concat(e){const i={content:oT(this.content,e.content),additional_kwargs:wu(this.additional_kwargs,e.additional_kwargs),response_metadata:wu(this.response_metadata,e.response_metadata),tool_call_chunks:[],id:this.id??e.id};if(this.tool_call_chunks!==void 0||e.tool_call_chunks!==void 0){const r=g6(this.tool_call_chunks,e.tool_call_chunks);r!==void 0&&r.length>0&&(i.tool_call_chunks=r)}if(this.usage_metadata!==void 0||e.usage_metadata!==void 0){const r={...(this.usage_metadata?.input_token_details?.audio!==void 0||e.usage_metadata?.input_token_details?.audio!==void 0)&&{audio:(this.usage_metadata?.input_token_details?.audio??0)+(e.usage_metadata?.input_token_details?.audio??0)},...(this.usage_metadata?.input_token_details?.cache_read!==void 0||e.usage_metadata?.input_token_details?.cache_read!==void 0)&&{cache_read:(this.usage_metadata?.input_token_details?.cache_read??0)+(e.usage_metadata?.input_token_details?.cache_read??0)},...(this.usage_metadata?.input_token_details?.cache_creation!==void 0||e.usage_metadata?.input_token_details?.cache_creation!==void 0)&&{cache_creation:(this.usage_metadata?.input_token_details?.cache_creation??0)+(e.usage_metadata?.input_token_details?.cache_creation??0)}},n={...(this.usage_metadata?.output_token_details?.audio!==void 0||e.usage_metadata?.output_token_details?.audio!==void 0)&&{audio:(this.usage_metadata?.output_token_details?.audio??0)+(e.usage_metadata?.output_token_details?.audio??0)},...(this.usage_metadata?.output_token_details?.reasoning!==void 0||e.usage_metadata?.output_token_details?.reasoning!==void 0)&&{reasoning:(this.usage_metadata?.output_token_details?.reasoning??0)+(e.usage_metadata?.output_token_details?.reasoning??0)}},s=this.usage_metadata??{input_tokens:0,output_tokens:0,total_tokens:0},a=e.usage_metadata??{input_tokens:0,output_tokens:0,total_tokens:0},o={input_tokens:s.input_tokens+a.input_tokens,output_tokens:s.output_tokens+a.output_tokens,total_tokens:s.total_tokens+a.total_tokens,...Object.keys(r).length>0&&{input_token_details:r},...Object.keys(n).length>0&&{output_token_details:n}};i.usage_metadata=o}return new u_(i)}}class tO extends G0{static lc_name(){return"ChatMessage"}static _chatMessageClass(){return tO}constructor(e,i){typeof e=="string"&&(e={content:e,role:i}),super(e),Object.defineProperty(this,"role",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.role=e.role}_getType(){return"generic"}static isInstance(e){return e._getType()==="generic"}get _printableFields(){return{...super._printableFields,role:this.role}}}class y6 extends lT{static lc_name(){return"ChatMessageChunk"}constructor(e,i){typeof e=="string"&&(e={content:e,role:i}),super(e),Object.defineProperty(this,"role",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.role=e.role}_getType(){return"generic"}concat(e){return new y6({content:oT(this.content,e.content),additional_kwargs:wu(this.additional_kwargs,e.additional_kwargs),response_metadata:wu(this.response_metadata,e.response_metadata),role:this.role,id:this.id??e.id})}get _printableFields(){return{...super._printableFields,role:this.role}}}class x6 extends lT{static lc_name(){return"FunctionMessageChunk"}_getType(){return"function"}concat(e){return new x6({content:oT(this.content,e.content),additional_kwargs:wu(this.additional_kwargs,e.additional_kwargs),response_metadata:wu(this.response_metadata,e.response_metadata),name:this.name??"",id:this.id??e.id})}}class iO extends G0{static lc_name(){return"HumanMessage"}_getType(){return"human"}constructor(e,i){super(e,i)}}class b6 extends lT{static lc_name(){return"HumanMessageChunk"}_getType(){return"human"}constructor(e,i){super(e,i)}concat(e){return new b6({content:oT(this.content,e.content),additional_kwargs:wu(this.additional_kwargs,e.additional_kwargs),response_metadata:wu(this.response_metadata,e.response_metadata),id:this.id??e.id})}}class Y7 extends G0{static lc_name(){return"SystemMessage"}_getType(){return"system"}constructor(e,i){super(e,i)}}class w6 extends lT{static lc_name(){return"SystemMessageChunk"}_getType(){return"system"}constructor(e,i){super(e,i)}concat(e){return new w6({content:oT(this.content,e.content),additional_kwargs:wu(this.additional_kwargs,e.additional_kwargs),response_metadata:wu(this.response_metadata,e.response_metadata),id:this.id??e.id})}}function tae(t,e){return t.lc_error_code=e,t.message=`${t.message}

Troubleshooting URL: https://js.langchain.com/docs/troubleshooting/errors/${e}/
`,t}function iae(t){return!!(t&&typeof t=="object"&&"type"in t&&t.type==="tool_call")}class dMe extends Error{constructor(e,i){super(e),Object.defineProperty(this,"output",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.output=i}}class fMe extends G0{constructor(e){super({...e,content:""}),Object.defineProperty(this,"id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.id=e.id}_getType(){return"remove"}get _printableFields(){return{...super._printableFields,id:this.id}}}function pMe(t){return iae(t)?t:typeof t.id=="string"&&t.type==="function"&&typeof t.function=="object"&&t.function!==null&&"arguments"in t.function&&typeof t.function.arguments=="string"&&"name"in t.function&&typeof t.function.name=="string"?{id:t.id,args:JSON.parse(t.function.arguments),name:t.function.name,type:"tool_call"}:t}function mMe(t){return typeof t=="object"&&t!=null&&t.lc===1&&Array.isArray(t.id)&&t.kwargs!=null&&typeof t.kwargs=="object"}function Xk(t){let e,i;if(mMe(t)){const r=t.id.at(-1);r==="HumanMessage"||r==="HumanMessageChunk"?e="user":r==="AIMessage"||r==="AIMessageChunk"?e="assistant":r==="SystemMessage"||r==="SystemMessageChunk"?e="system":r==="FunctionMessage"||r==="FunctionMessageChunk"?e="function":r==="ToolMessage"||r==="ToolMessageChunk"?e="tool":e="unknown",i=t.kwargs}else{const{type:r,...n}=t;e=r,i=n}if(e==="human"||e==="user")return new iO(i);if(e==="ai"||e==="assistant"){const{tool_calls:r,...n}=i;if(!Array.isArray(r))return new bz(i);const s=r.map(pMe);return new bz({...n,tool_calls:s})}else{if(e==="system")return new Y7(i);if(e==="developer")return new Y7({...i,additional_kwargs:{...i.additional_kwargs,__openai_role__:"developer"}});if(e==="tool"&&"tool_call_id"in i)return new cMe({...i,content:i.content,tool_call_id:i.tool_call_id,name:i.name});if(e==="remove"&&"id"in i&&typeof i.id=="string")return new fMe({...i,id:i.id});throw tae(new Error(`Unable to coerce message from array: only human, AI, system, developer, or tool message coercion is currently supported.

Received: ${JSON.stringify(t,null,2)}`),"MESSAGE_COERCION_FAILURE")}}function kE(t){if(typeof t=="string")return new iO(t);if(cT(t))return t;if(Array.isArray(t)){const[e,i]=t;return Xk({type:e,content:i})}else if(oMe(t)){const{role:e,...i}=t;return Xk({...i,type:e})}else return Xk(t)}function rae(t,e="Human",i="AI"){const r=[];for(const n of t){let s;if(n._getType()==="human")s=e;else if(n._getType()==="ai")s=i;else if(n._getType()==="system")s="System";else if(n._getType()==="function")s="Function";else if(n._getType()==="tool")s="Tool";else if(n._getType()==="generic")s=n.role;else throw new Error(`Got unsupported message type: ${n._getType()}`);const a=n.name?`${n.name}, `:"",o=typeof n.content=="string"?n.content:JSON.stringify(n.content,null,2);r.push(`${s}: ${a}${o}`)}return r.join(`
`)}function gMe(t){const e=t._getType();if(e==="human")return new b6({...t});if(e==="ai"){let i={...t};return"tool_calls"in i&&(i={...i,tool_call_chunks:i.tool_calls?.map(r=>({...r,type:"tool_call_chunk",index:void 0,args:JSON.stringify(r.args)}))}),new u_({...i})}else{if(e==="system")return new w6({...t});if(e==="function")return new x6({...t});if(tO.isInstance(t))return new y6({...t});throw new Error("Unknown message type.")}}var Hr;(function(t){t.assertEqual=n=>{};function e(n){}t.assertIs=e;function i(n){throw new Error}t.assertNever=i,t.arrayToEnum=n=>{const s={};for(const a of n)s[a]=a;return s},t.getValidEnumValues=n=>{const s=t.objectKeys(n).filter(o=>typeof n[n[o]]!="number"),a={};for(const o of s)a[o]=n[o];return t.objectValues(a)},t.objectValues=n=>t.objectKeys(n).map(function(s){return n[s]}),t.objectKeys=typeof Object.keys=="function"?n=>Object.keys(n):n=>{const s=[];for(const a in n)Object.prototype.hasOwnProperty.call(n,a)&&s.push(a);return s},t.find=(n,s)=>{for(const a of n)if(s(a))return a},t.isInteger=typeof Number.isInteger=="function"?n=>Number.isInteger(n):n=>typeof n=="number"&&Number.isFinite(n)&&Math.floor(n)===n;function r(n,s=" | "){return n.map(a=>typeof a=="string"?`'${a}'`:a).join(s)}t.joinValues=r,t.jsonStringifyReplacer=(n,s)=>typeof s=="bigint"?s.toString():s})(Hr||(Hr={}));var K7;(function(t){t.mergeShapes=(e,i)=>({...e,...i})})(K7||(K7={}));const mi=Hr.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),ug=t=>{switch(typeof t){case"undefined":return mi.undefined;case"string":return mi.string;case"number":return Number.isNaN(t)?mi.nan:mi.number;case"boolean":return mi.boolean;case"function":return mi.function;case"bigint":return mi.bigint;case"symbol":return mi.symbol;case"object":return Array.isArray(t)?mi.array:t===null?mi.null:t.then&&typeof t.then=="function"&&t.catch&&typeof t.catch=="function"?mi.promise:typeof Map<"u"&&t instanceof Map?mi.map:typeof Set<"u"&&t instanceof Set?mi.set:typeof Date<"u"&&t instanceof Date?mi.date:mi.object;default:return mi.unknown}},Nt=Hr.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]);class Bp extends Error{get errors(){return this.issues}constructor(e){super(),this.issues=[],this.addIssue=r=>{this.issues=[...this.issues,r]},this.addIssues=(r=[])=>{this.issues=[...this.issues,...r]};const i=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,i):this.__proto__=i,this.name="ZodError",this.issues=e}format(e){const i=e||function(s){return s.message},r={_errors:[]},n=s=>{for(const a of s.issues)if(a.code==="invalid_union")a.unionErrors.map(n);else if(a.code==="invalid_return_type")n(a.returnTypeError);else if(a.code==="invalid_arguments")n(a.argumentsError);else if(a.path.length===0)r._errors.push(i(a));else{let o=r,l=0;for(;l<a.path.length;){const c=a.path[l];l===a.path.length-1?(o[c]=o[c]||{_errors:[]},o[c]._errors.push(i(a))):o[c]=o[c]||{_errors:[]},o=o[c],l++}}};return n(this),r}static assert(e){if(!(e instanceof Bp))throw new Error(`Not a ZodError: ${e}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,Hr.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(e=i=>i.message){const i={},r=[];for(const n of this.issues)if(n.path.length>0){const s=n.path[0];i[s]=i[s]||[],i[s].push(e(n))}else r.push(e(n));return{formErrors:r,fieldErrors:i}}get formErrors(){return this.flatten()}}Bp.create=t=>new Bp(t);const wz=(t,e)=>{let i;switch(t.code){case Nt.invalid_type:t.received===mi.undefined?i="Required":i=`Expected ${t.expected}, received ${t.received}`;break;case Nt.invalid_literal:i=`Invalid literal value, expected ${JSON.stringify(t.expected,Hr.jsonStringifyReplacer)}`;break;case Nt.unrecognized_keys:i=`Unrecognized key(s) in object: ${Hr.joinValues(t.keys,", ")}`;break;case Nt.invalid_union:i="Invalid input";break;case Nt.invalid_union_discriminator:i=`Invalid discriminator value. Expected ${Hr.joinValues(t.options)}`;break;case Nt.invalid_enum_value:i=`Invalid enum value. Expected ${Hr.joinValues(t.options)}, received '${t.received}'`;break;case Nt.invalid_arguments:i="Invalid function arguments";break;case Nt.invalid_return_type:i="Invalid function return type";break;case Nt.invalid_date:i="Invalid date";break;case Nt.invalid_string:typeof t.validation=="object"?"includes"in t.validation?(i=`Invalid input: must include "${t.validation.includes}"`,typeof t.validation.position=="number"&&(i=`${i} at one or more positions greater than or equal to ${t.validation.position}`)):"startsWith"in t.validation?i=`Invalid input: must start with "${t.validation.startsWith}"`:"endsWith"in t.validation?i=`Invalid input: must end with "${t.validation.endsWith}"`:Hr.assertNever(t.validation):t.validation!=="regex"?i=`Invalid ${t.validation}`:i="Invalid";break;case Nt.too_small:t.type==="array"?i=`Array must contain ${t.exact?"exactly":t.inclusive?"at least":"more than"} ${t.minimum} element(s)`:t.type==="string"?i=`String must contain ${t.exact?"exactly":t.inclusive?"at least":"over"} ${t.minimum} character(s)`:t.type==="number"?i=`Number must be ${t.exact?"exactly equal to ":t.inclusive?"greater than or equal to ":"greater than "}${t.minimum}`:t.type==="bigint"?i=`Number must be ${t.exact?"exactly equal to ":t.inclusive?"greater than or equal to ":"greater than "}${t.minimum}`:t.type==="date"?i=`Date must be ${t.exact?"exactly equal to ":t.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(t.minimum))}`:i="Invalid input";break;case Nt.too_big:t.type==="array"?i=`Array must contain ${t.exact?"exactly":t.inclusive?"at most":"less than"} ${t.maximum} element(s)`:t.type==="string"?i=`String must contain ${t.exact?"exactly":t.inclusive?"at most":"under"} ${t.maximum} character(s)`:t.type==="number"?i=`Number must be ${t.exact?"exactly":t.inclusive?"less than or equal to":"less than"} ${t.maximum}`:t.type==="bigint"?i=`BigInt must be ${t.exact?"exactly":t.inclusive?"less than or equal to":"less than"} ${t.maximum}`:t.type==="date"?i=`Date must be ${t.exact?"exactly":t.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(t.maximum))}`:i="Invalid input";break;case Nt.custom:i="Invalid input";break;case Nt.invalid_intersection_types:i="Intersection results could not be merged";break;case Nt.not_multiple_of:i=`Number must be a multiple of ${t.multipleOf}`;break;case Nt.not_finite:i="Number must be finite";break;default:i=e.defaultError,Hr.assertNever(t)}return{message:i}};let vMe=wz;function yMe(){return vMe}const xMe=t=>{const{data:e,path:i,errorMaps:r,issueData:n}=t,s=[...i,...n.path||[]],a={...n,path:s};if(n.message!==void 0)return{...n,path:s,message:n.message};let o="";const l=r.filter(c=>!!c).slice().reverse();for(const c of l)o=c(a,{data:e,defaultError:o}).message;return{...n,path:s,message:o}};function ei(t,e){const i=yMe(),r=xMe({issueData:e,data:t.data,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,i,i===wz?void 0:wz].filter(n=>!!n)});t.common.issues.push(r)}class Dc{constructor(){this.value="valid"}dirty(){this.value==="valid"&&(this.value="dirty")}abort(){this.value!=="aborted"&&(this.value="aborted")}static mergeArray(e,i){const r=[];for(const n of i){if(n.status==="aborted")return rr;n.status==="dirty"&&e.dirty(),r.push(n.value)}return{status:e.value,value:r}}static async mergeObjectAsync(e,i){const r=[];for(const n of i){const s=await n.key,a=await n.value;r.push({key:s,value:a})}return Dc.mergeObjectSync(e,r)}static mergeObjectSync(e,i){const r={};for(const n of i){const{key:s,value:a}=n;if(s.status==="aborted"||a.status==="aborted")return rr;s.status==="dirty"&&e.dirty(),a.status==="dirty"&&e.dirty(),s.value!=="__proto__"&&(typeof a.value<"u"||n.alwaysSet)&&(r[s.value]=a.value)}return{status:e.value,value:r}}}const rr=Object.freeze({status:"aborted"}),NE=t=>({status:"dirty",value:t}),Eu=t=>({status:"valid",value:t}),Z7=t=>t.status==="aborted",Q7=t=>t.status==="dirty",E1=t=>t.status==="valid",MI=t=>typeof Promise<"u"&&t instanceof Promise;var bi;(function(t){t.errToObj=e=>typeof e=="string"?{message:e}:e||{},t.toString=e=>typeof e=="string"?e:e?.message})(bi||(bi={}));class Yg{constructor(e,i,r,n){this._cachedPath=[],this.parent=e,this.data=i,this._path=r,this._key=n}get path(){return this._cachedPath.length||(Array.isArray(this._key)?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}}const J7=(t,e)=>{if(E1(e))return{success:!0,data:e.value};if(!t.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;const i=new Bp(t.common.issues);return this._error=i,this._error}}};function _r(t){if(!t)return{};const{errorMap:e,invalid_type_error:i,required_error:r,description:n}=t;if(e&&(i||r))throw new Error(`Can't use "invalid_type_error" or "required_error" in conjunction with custom error map.`);return e?{errorMap:e,description:n}:{errorMap:(a,o)=>{const{message:l}=t;return a.code==="invalid_enum_value"?{message:l??o.defaultError}:typeof o.data>"u"?{message:l??r??o.defaultError}:a.code!=="invalid_type"?{message:o.defaultError}:{message:l??i??o.defaultError}},description:n}}class Fr{get description(){return this._def.description}_getType(e){return ug(e.data)}_getOrReturnCtx(e,i){return i||{common:e.parent.common,data:e.data,parsedType:ug(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}_processInputParams(e){return{status:new Dc,ctx:{common:e.parent.common,data:e.data,parsedType:ug(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}}_parseSync(e){const i=this._parse(e);if(MI(i))throw new Error("Synchronous parse encountered promise.");return i}_parseAsync(e){const i=this._parse(e);return Promise.resolve(i)}parse(e,i){const r=this.safeParse(e,i);if(r.success)return r.data;throw r.error}safeParse(e,i){const r={common:{issues:[],async:i?.async??!1,contextualErrorMap:i?.errorMap},path:i?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:ug(e)},n=this._parseSync({data:e,path:r.path,parent:r});return J7(r,n)}"~validate"(e){const i={common:{issues:[],async:!!this["~standard"].async},path:[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:ug(e)};if(!this["~standard"].async)try{const r=this._parseSync({data:e,path:[],parent:i});return E1(r)?{value:r.value}:{issues:i.common.issues}}catch(r){r?.message?.toLowerCase()?.includes("encountered")&&(this["~standard"].async=!0),i.common={issues:[],async:!0}}return this._parseAsync({data:e,path:[],parent:i}).then(r=>E1(r)?{value:r.value}:{issues:i.common.issues})}async parseAsync(e,i){const r=await this.safeParseAsync(e,i);if(r.success)return r.data;throw r.error}async safeParseAsync(e,i){const r={common:{issues:[],contextualErrorMap:i?.errorMap,async:!0},path:i?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:ug(e)},n=this._parse({data:e,path:r.path,parent:r}),s=await(MI(n)?n:Promise.resolve(n));return J7(r,s)}refine(e,i){const r=n=>typeof i=="string"||typeof i>"u"?{message:i}:typeof i=="function"?i(n):i;return this._refinement((n,s)=>{const a=e(n),o=()=>s.addIssue({code:Nt.custom,...r(n)});return typeof Promise<"u"&&a instanceof Promise?a.then(l=>l?!0:(o(),!1)):a?!0:(o(),!1)})}refinement(e,i){return this._refinement((r,n)=>e(r)?!0:(n.addIssue(typeof i=="function"?i(r,n):i),!1))}_refinement(e){return new M1({schema:this,typeName:Ut.ZodEffects,effect:{type:"refinement",refinement:e}})}superRefine(e){return this._refinement(e)}constructor(e){this.spa=this.safeParseAsync,this._def=e,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this),this["~standard"]={version:1,vendor:"zod",validate:i=>this["~validate"](i)}}optional(){return zg.create(this,this._def)}nullable(){return T1.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return zd.create(this)}promise(){return RI.create(this,this._def)}or(e){return CI.create([this,e],this._def)}and(e){return PI.create(this,e,this._def)}transform(e){return new M1({..._r(this._def),schema:this,typeName:Ut.ZodEffects,effect:{type:"transform",transform:e}})}default(e){const i=typeof e=="function"?e:()=>e;return new Ez({..._r(this._def),innerType:this,defaultValue:i,typeName:Ut.ZodDefault})}brand(){return new VMe({typeName:Ut.ZodBranded,type:this,..._r(this._def)})}catch(e){const i=typeof e=="function"?e:()=>e;return new Az({..._r(this._def),innerType:this,catchValue:i,typeName:Ut.ZodCatch})}describe(e){const i=this.constructor;return new i({...this._def,description:e})}pipe(e){return _6.create(this,e)}readonly(){return Mz.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}}const bMe=/^c[^\s-]{8,}$/i,wMe=/^[0-9a-z]+$/,_Me=/^[0-9A-HJKMNP-TV-Z]{26}$/i,SMe=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,EMe=/^[a-z0-9_-]{21}$/i,AMe=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/,MMe=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,TMe=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,CMe="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$";let $k;const PMe=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,RMe=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,IMe=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/,DMe=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,OMe=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,LMe=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,nae="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",kMe=new RegExp(`^${nae}$`);function sae(t){let e="[0-5]\\d";t.precision?e=`${e}\\.\\d{${t.precision}}`:t.precision==null&&(e=`${e}(\\.\\d+)?`);const i=t.precision?"+":"?";return`([01]\\d|2[0-3]):[0-5]\\d(:${e})${i}`}function NMe(t){return new RegExp(`^${sae(t)}$`)}function UMe(t){let e=`${nae}T${sae(t)}`;const i=[];return i.push(t.local?"Z?":"Z"),t.offset&&i.push("([+-]\\d{2}:?\\d{2})"),e=`${e}(${i.join("|")})`,new RegExp(`^${e}$`)}function BMe(t,e){return!!((e==="v4"||!e)&&PMe.test(t)||(e==="v6"||!e)&&IMe.test(t))}function FMe(t,e){if(!AMe.test(t))return!1;try{const[i]=t.split(".");if(!i)return!1;const r=i.replace(/-/g,"+").replace(/_/g,"/").padEnd(i.length+(4-i.length%4)%4,"="),n=JSON.parse(atob(r));return!(typeof n!="object"||n===null||"typ"in n&&n?.typ!=="JWT"||!n.alg||e&&n.alg!==e)}catch{return!1}}function zMe(t,e){return!!((e==="v4"||!e)&&RMe.test(t)||(e==="v6"||!e)&&DMe.test(t))}class Mg extends Fr{_parse(e){if(this._def.coerce&&(e.data=String(e.data)),this._getType(e)!==mi.string){const s=this._getOrReturnCtx(e);return ei(s,{code:Nt.invalid_type,expected:mi.string,received:s.parsedType}),rr}const r=new Dc;let n;for(const s of this._def.checks)if(s.kind==="min")e.data.length<s.value&&(n=this._getOrReturnCtx(e,n),ei(n,{code:Nt.too_small,minimum:s.value,type:"string",inclusive:!0,exact:!1,message:s.message}),r.dirty());else if(s.kind==="max")e.data.length>s.value&&(n=this._getOrReturnCtx(e,n),ei(n,{code:Nt.too_big,maximum:s.value,type:"string",inclusive:!0,exact:!1,message:s.message}),r.dirty());else if(s.kind==="length"){const a=e.data.length>s.value,o=e.data.length<s.value;(a||o)&&(n=this._getOrReturnCtx(e,n),a?ei(n,{code:Nt.too_big,maximum:s.value,type:"string",inclusive:!0,exact:!0,message:s.message}):o&&ei(n,{code:Nt.too_small,minimum:s.value,type:"string",inclusive:!0,exact:!0,message:s.message}),r.dirty())}else if(s.kind==="email")TMe.test(e.data)||(n=this._getOrReturnCtx(e,n),ei(n,{validation:"email",code:Nt.invalid_string,message:s.message}),r.dirty());else if(s.kind==="emoji")$k||($k=new RegExp(CMe,"u")),$k.test(e.data)||(n=this._getOrReturnCtx(e,n),ei(n,{validation:"emoji",code:Nt.invalid_string,message:s.message}),r.dirty());else if(s.kind==="uuid")SMe.test(e.data)||(n=this._getOrReturnCtx(e,n),ei(n,{validation:"uuid",code:Nt.invalid_string,message:s.message}),r.dirty());else if(s.kind==="nanoid")EMe.test(e.data)||(n=this._getOrReturnCtx(e,n),ei(n,{validation:"nanoid",code:Nt.invalid_string,message:s.message}),r.dirty());else if(s.kind==="cuid")bMe.test(e.data)||(n=this._getOrReturnCtx(e,n),ei(n,{validation:"cuid",code:Nt.invalid_string,message:s.message}),r.dirty());else if(s.kind==="cuid2")wMe.test(e.data)||(n=this._getOrReturnCtx(e,n),ei(n,{validation:"cuid2",code:Nt.invalid_string,message:s.message}),r.dirty());else if(s.kind==="ulid")_Me.test(e.data)||(n=this._getOrReturnCtx(e,n),ei(n,{validation:"ulid",code:Nt.invalid_string,message:s.message}),r.dirty());else if(s.kind==="url")try{new URL(e.data)}catch{n=this._getOrReturnCtx(e,n),ei(n,{validation:"url",code:Nt.invalid_string,message:s.message}),r.dirty()}else s.kind==="regex"?(s.regex.lastIndex=0,s.regex.test(e.data)||(n=this._getOrReturnCtx(e,n),ei(n,{validation:"regex",code:Nt.invalid_string,message:s.message}),r.dirty())):s.kind==="trim"?e.data=e.data.trim():s.kind==="includes"?e.data.includes(s.value,s.position)||(n=this._getOrReturnCtx(e,n),ei(n,{code:Nt.invalid_string,validation:{includes:s.value,position:s.position},message:s.message}),r.dirty()):s.kind==="toLowerCase"?e.data=e.data.toLowerCase():s.kind==="toUpperCase"?e.data=e.data.toUpperCase():s.kind==="startsWith"?e.data.startsWith(s.value)||(n=this._getOrReturnCtx(e,n),ei(n,{code:Nt.invalid_string,validation:{startsWith:s.value},message:s.message}),r.dirty()):s.kind==="endsWith"?e.data.endsWith(s.value)||(n=this._getOrReturnCtx(e,n),ei(n,{code:Nt.invalid_string,validation:{endsWith:s.value},message:s.message}),r.dirty()):s.kind==="datetime"?UMe(s).test(e.data)||(n=this._getOrReturnCtx(e,n),ei(n,{code:Nt.invalid_string,validation:"datetime",message:s.message}),r.dirty()):s.kind==="date"?kMe.test(e.data)||(n=this._getOrReturnCtx(e,n),ei(n,{code:Nt.invalid_string,validation:"date",message:s.message}),r.dirty()):s.kind==="time"?NMe(s).test(e.data)||(n=this._getOrReturnCtx(e,n),ei(n,{code:Nt.invalid_string,validation:"time",message:s.message}),r.dirty()):s.kind==="duration"?MMe.test(e.data)||(n=this._getOrReturnCtx(e,n),ei(n,{validation:"duration",code:Nt.invalid_string,message:s.message}),r.dirty()):s.kind==="ip"?BMe(e.data,s.version)||(n=this._getOrReturnCtx(e,n),ei(n,{validation:"ip",code:Nt.invalid_string,message:s.message}),r.dirty()):s.kind==="jwt"?FMe(e.data,s.alg)||(n=this._getOrReturnCtx(e,n),ei(n,{validation:"jwt",code:Nt.invalid_string,message:s.message}),r.dirty()):s.kind==="cidr"?zMe(e.data,s.version)||(n=this._getOrReturnCtx(e,n),ei(n,{validation:"cidr",code:Nt.invalid_string,message:s.message}),r.dirty()):s.kind==="base64"?OMe.test(e.data)||(n=this._getOrReturnCtx(e,n),ei(n,{validation:"base64",code:Nt.invalid_string,message:s.message}),r.dirty()):s.kind==="base64url"?LMe.test(e.data)||(n=this._getOrReturnCtx(e,n),ei(n,{validation:"base64url",code:Nt.invalid_string,message:s.message}),r.dirty()):Hr.assertNever(s);return{status:r.value,value:e.data}}_regex(e,i,r){return this.refinement(n=>e.test(n),{validation:i,code:Nt.invalid_string,...bi.errToObj(r)})}_addCheck(e){return new Mg({...this._def,checks:[...this._def.checks,e]})}email(e){return this._addCheck({kind:"email",...bi.errToObj(e)})}url(e){return this._addCheck({kind:"url",...bi.errToObj(e)})}emoji(e){return this._addCheck({kind:"emoji",...bi.errToObj(e)})}uuid(e){return this._addCheck({kind:"uuid",...bi.errToObj(e)})}nanoid(e){return this._addCheck({kind:"nanoid",...bi.errToObj(e)})}cuid(e){return this._addCheck({kind:"cuid",...bi.errToObj(e)})}cuid2(e){return this._addCheck({kind:"cuid2",...bi.errToObj(e)})}ulid(e){return this._addCheck({kind:"ulid",...bi.errToObj(e)})}base64(e){return this._addCheck({kind:"base64",...bi.errToObj(e)})}base64url(e){return this._addCheck({kind:"base64url",...bi.errToObj(e)})}jwt(e){return this._addCheck({kind:"jwt",...bi.errToObj(e)})}ip(e){return this._addCheck({kind:"ip",...bi.errToObj(e)})}cidr(e){return this._addCheck({kind:"cidr",...bi.errToObj(e)})}datetime(e){return typeof e=="string"?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:e}):this._addCheck({kind:"datetime",precision:typeof e?.precision>"u"?null:e?.precision,offset:e?.offset??!1,local:e?.local??!1,...bi.errToObj(e?.message)})}date(e){return this._addCheck({kind:"date",message:e})}time(e){return typeof e=="string"?this._addCheck({kind:"time",precision:null,message:e}):this._addCheck({kind:"time",precision:typeof e?.precision>"u"?null:e?.precision,...bi.errToObj(e?.message)})}duration(e){return this._addCheck({kind:"duration",...bi.errToObj(e)})}regex(e,i){return this._addCheck({kind:"regex",regex:e,...bi.errToObj(i)})}includes(e,i){return this._addCheck({kind:"includes",value:e,position:i?.position,...bi.errToObj(i?.message)})}startsWith(e,i){return this._addCheck({kind:"startsWith",value:e,...bi.errToObj(i)})}endsWith(e,i){return this._addCheck({kind:"endsWith",value:e,...bi.errToObj(i)})}min(e,i){return this._addCheck({kind:"min",value:e,...bi.errToObj(i)})}max(e,i){return this._addCheck({kind:"max",value:e,...bi.errToObj(i)})}length(e,i){return this._addCheck({kind:"length",value:e,...bi.errToObj(i)})}nonempty(e){return this.min(1,bi.errToObj(e))}trim(){return new Mg({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new Mg({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new Mg({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(e=>e.kind==="datetime")}get isDate(){return!!this._def.checks.find(e=>e.kind==="date")}get isTime(){return!!this._def.checks.find(e=>e.kind==="time")}get isDuration(){return!!this._def.checks.find(e=>e.kind==="duration")}get isEmail(){return!!this._def.checks.find(e=>e.kind==="email")}get isURL(){return!!this._def.checks.find(e=>e.kind==="url")}get isEmoji(){return!!this._def.checks.find(e=>e.kind==="emoji")}get isUUID(){return!!this._def.checks.find(e=>e.kind==="uuid")}get isNANOID(){return!!this._def.checks.find(e=>e.kind==="nanoid")}get isCUID(){return!!this._def.checks.find(e=>e.kind==="cuid")}get isCUID2(){return!!this._def.checks.find(e=>e.kind==="cuid2")}get isULID(){return!!this._def.checks.find(e=>e.kind==="ulid")}get isIP(){return!!this._def.checks.find(e=>e.kind==="ip")}get isCIDR(){return!!this._def.checks.find(e=>e.kind==="cidr")}get isBase64(){return!!this._def.checks.find(e=>e.kind==="base64")}get isBase64url(){return!!this._def.checks.find(e=>e.kind==="base64url")}get minLength(){let e=null;for(const i of this._def.checks)i.kind==="min"&&(e===null||i.value>e)&&(e=i.value);return e}get maxLength(){let e=null;for(const i of this._def.checks)i.kind==="max"&&(e===null||i.value<e)&&(e=i.value);return e}}Mg.create=t=>new Mg({checks:[],typeName:Ut.ZodString,coerce:t?.coerce??!1,..._r(t)});function jMe(t,e){const i=(t.toString().split(".")[1]||"").length,r=(e.toString().split(".")[1]||"").length,n=i>r?i:r,s=Number.parseInt(t.toFixed(n).replace(".","")),a=Number.parseInt(e.toFixed(n).replace(".",""));return s%a/10**n}class tM extends Fr{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(e){if(this._def.coerce&&(e.data=Number(e.data)),this._getType(e)!==mi.number){const s=this._getOrReturnCtx(e);return ei(s,{code:Nt.invalid_type,expected:mi.number,received:s.parsedType}),rr}let r;const n=new Dc;for(const s of this._def.checks)s.kind==="int"?Hr.isInteger(e.data)||(r=this._getOrReturnCtx(e,r),ei(r,{code:Nt.invalid_type,expected:"integer",received:"float",message:s.message}),n.dirty()):s.kind==="min"?(s.inclusive?e.data<s.value:e.data<=s.value)&&(r=this._getOrReturnCtx(e,r),ei(r,{code:Nt.too_small,minimum:s.value,type:"number",inclusive:s.inclusive,exact:!1,message:s.message}),n.dirty()):s.kind==="max"?(s.inclusive?e.data>s.value:e.data>=s.value)&&(r=this._getOrReturnCtx(e,r),ei(r,{code:Nt.too_big,maximum:s.value,type:"number",inclusive:s.inclusive,exact:!1,message:s.message}),n.dirty()):s.kind==="multipleOf"?jMe(e.data,s.value)!==0&&(r=this._getOrReturnCtx(e,r),ei(r,{code:Nt.not_multiple_of,multipleOf:s.value,message:s.message}),n.dirty()):s.kind==="finite"?Number.isFinite(e.data)||(r=this._getOrReturnCtx(e,r),ei(r,{code:Nt.not_finite,message:s.message}),n.dirty()):Hr.assertNever(s);return{status:n.value,value:e.data}}gte(e,i){return this.setLimit("min",e,!0,bi.toString(i))}gt(e,i){return this.setLimit("min",e,!1,bi.toString(i))}lte(e,i){return this.setLimit("max",e,!0,bi.toString(i))}lt(e,i){return this.setLimit("max",e,!1,bi.toString(i))}setLimit(e,i,r,n){return new tM({...this._def,checks:[...this._def.checks,{kind:e,value:i,inclusive:r,message:bi.toString(n)}]})}_addCheck(e){return new tM({...this._def,checks:[...this._def.checks,e]})}int(e){return this._addCheck({kind:"int",message:bi.toString(e)})}positive(e){return this._addCheck({kind:"min",value:0,inclusive:!1,message:bi.toString(e)})}negative(e){return this._addCheck({kind:"max",value:0,inclusive:!1,message:bi.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:0,inclusive:!0,message:bi.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:0,inclusive:!0,message:bi.toString(e)})}multipleOf(e,i){return this._addCheck({kind:"multipleOf",value:e,message:bi.toString(i)})}finite(e){return this._addCheck({kind:"finite",message:bi.toString(e)})}safe(e){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:bi.toString(e)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:bi.toString(e)})}get minValue(){let e=null;for(const i of this._def.checks)i.kind==="min"&&(e===null||i.value>e)&&(e=i.value);return e}get maxValue(){let e=null;for(const i of this._def.checks)i.kind==="max"&&(e===null||i.value<e)&&(e=i.value);return e}get isInt(){return!!this._def.checks.find(e=>e.kind==="int"||e.kind==="multipleOf"&&Hr.isInteger(e.value))}get isFinite(){let e=null,i=null;for(const r of this._def.checks){if(r.kind==="finite"||r.kind==="int"||r.kind==="multipleOf")return!0;r.kind==="min"?(i===null||r.value>i)&&(i=r.value):r.kind==="max"&&(e===null||r.value<e)&&(e=r.value)}return Number.isFinite(i)&&Number.isFinite(e)}}tM.create=t=>new tM({checks:[],typeName:Ut.ZodNumber,coerce:t?.coerce||!1,..._r(t)});class iM extends Fr{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(e){if(this._def.coerce)try{e.data=BigInt(e.data)}catch{return this._getInvalidInput(e)}if(this._getType(e)!==mi.bigint)return this._getInvalidInput(e);let r;const n=new Dc;for(const s of this._def.checks)s.kind==="min"?(s.inclusive?e.data<s.value:e.data<=s.value)&&(r=this._getOrReturnCtx(e,r),ei(r,{code:Nt.too_small,type:"bigint",minimum:s.value,inclusive:s.inclusive,message:s.message}),n.dirty()):s.kind==="max"?(s.inclusive?e.data>s.value:e.data>=s.value)&&(r=this._getOrReturnCtx(e,r),ei(r,{code:Nt.too_big,type:"bigint",maximum:s.value,inclusive:s.inclusive,message:s.message}),n.dirty()):s.kind==="multipleOf"?e.data%s.value!==BigInt(0)&&(r=this._getOrReturnCtx(e,r),ei(r,{code:Nt.not_multiple_of,multipleOf:s.value,message:s.message}),n.dirty()):Hr.assertNever(s);return{status:n.value,value:e.data}}_getInvalidInput(e){const i=this._getOrReturnCtx(e);return ei(i,{code:Nt.invalid_type,expected:mi.bigint,received:i.parsedType}),rr}gte(e,i){return this.setLimit("min",e,!0,bi.toString(i))}gt(e,i){return this.setLimit("min",e,!1,bi.toString(i))}lte(e,i){return this.setLimit("max",e,!0,bi.toString(i))}lt(e,i){return this.setLimit("max",e,!1,bi.toString(i))}setLimit(e,i,r,n){return new iM({...this._def,checks:[...this._def.checks,{kind:e,value:i,inclusive:r,message:bi.toString(n)}]})}_addCheck(e){return new iM({...this._def,checks:[...this._def.checks,e]})}positive(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:bi.toString(e)})}negative(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:bi.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:bi.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:bi.toString(e)})}multipleOf(e,i){return this._addCheck({kind:"multipleOf",value:e,message:bi.toString(i)})}get minValue(){let e=null;for(const i of this._def.checks)i.kind==="min"&&(e===null||i.value>e)&&(e=i.value);return e}get maxValue(){let e=null;for(const i of this._def.checks)i.kind==="max"&&(e===null||i.value<e)&&(e=i.value);return e}}iM.create=t=>new iM({checks:[],typeName:Ut.ZodBigInt,coerce:t?.coerce??!1,..._r(t)});class eq extends Fr{_parse(e){if(this._def.coerce&&(e.data=!!e.data),this._getType(e)!==mi.boolean){const r=this._getOrReturnCtx(e);return ei(r,{code:Nt.invalid_type,expected:mi.boolean,received:r.parsedType}),rr}return Eu(e.data)}}eq.create=t=>new eq({typeName:Ut.ZodBoolean,coerce:t?.coerce||!1,..._r(t)});class TI extends Fr{_parse(e){if(this._def.coerce&&(e.data=new Date(e.data)),this._getType(e)!==mi.date){const s=this._getOrReturnCtx(e);return ei(s,{code:Nt.invalid_type,expected:mi.date,received:s.parsedType}),rr}if(Number.isNaN(e.data.getTime())){const s=this._getOrReturnCtx(e);return ei(s,{code:Nt.invalid_date}),rr}const r=new Dc;let n;for(const s of this._def.checks)s.kind==="min"?e.data.getTime()<s.value&&(n=this._getOrReturnCtx(e,n),ei(n,{code:Nt.too_small,message:s.message,inclusive:!0,exact:!1,minimum:s.value,type:"date"}),r.dirty()):s.kind==="max"?e.data.getTime()>s.value&&(n=this._getOrReturnCtx(e,n),ei(n,{code:Nt.too_big,message:s.message,inclusive:!0,exact:!1,maximum:s.value,type:"date"}),r.dirty()):Hr.assertNever(s);return{status:r.value,value:new Date(e.data.getTime())}}_addCheck(e){return new TI({...this._def,checks:[...this._def.checks,e]})}min(e,i){return this._addCheck({kind:"min",value:e.getTime(),message:bi.toString(i)})}max(e,i){return this._addCheck({kind:"max",value:e.getTime(),message:bi.toString(i)})}get minDate(){let e=null;for(const i of this._def.checks)i.kind==="min"&&(e===null||i.value>e)&&(e=i.value);return e!=null?new Date(e):null}get maxDate(){let e=null;for(const i of this._def.checks)i.kind==="max"&&(e===null||i.value<e)&&(e=i.value);return e!=null?new Date(e):null}}TI.create=t=>new TI({checks:[],coerce:t?.coerce||!1,typeName:Ut.ZodDate,..._r(t)});class tq extends Fr{_parse(e){if(this._getType(e)!==mi.symbol){const r=this._getOrReturnCtx(e);return ei(r,{code:Nt.invalid_type,expected:mi.symbol,received:r.parsedType}),rr}return Eu(e.data)}}tq.create=t=>new tq({typeName:Ut.ZodSymbol,..._r(t)});class iq extends Fr{_parse(e){if(this._getType(e)!==mi.undefined){const r=this._getOrReturnCtx(e);return ei(r,{code:Nt.invalid_type,expected:mi.undefined,received:r.parsedType}),rr}return Eu(e.data)}}iq.create=t=>new iq({typeName:Ut.ZodUndefined,..._r(t)});class rq extends Fr{_parse(e){if(this._getType(e)!==mi.null){const r=this._getOrReturnCtx(e);return ei(r,{code:Nt.invalid_type,expected:mi.null,received:r.parsedType}),rr}return Eu(e.data)}}rq.create=t=>new rq({typeName:Ut.ZodNull,..._r(t)});class _z extends Fr{constructor(){super(...arguments),this._any=!0}_parse(e){return Eu(e.data)}}_z.create=t=>new _z({typeName:Ut.ZodAny,..._r(t)});class nq extends Fr{constructor(){super(...arguments),this._unknown=!0}_parse(e){return Eu(e.data)}}nq.create=t=>new nq({typeName:Ut.ZodUnknown,..._r(t)});class Kg extends Fr{_parse(e){const i=this._getOrReturnCtx(e);return ei(i,{code:Nt.invalid_type,expected:mi.never,received:i.parsedType}),rr}}Kg.create=t=>new Kg({typeName:Ut.ZodNever,..._r(t)});class sq extends Fr{_parse(e){if(this._getType(e)!==mi.undefined){const r=this._getOrReturnCtx(e);return ei(r,{code:Nt.invalid_type,expected:mi.void,received:r.parsedType}),rr}return Eu(e.data)}}sq.create=t=>new sq({typeName:Ut.ZodVoid,..._r(t)});class zd extends Fr{_parse(e){const{ctx:i,status:r}=this._processInputParams(e),n=this._def;if(i.parsedType!==mi.array)return ei(i,{code:Nt.invalid_type,expected:mi.array,received:i.parsedType}),rr;if(n.exactLength!==null){const a=i.data.length>n.exactLength.value,o=i.data.length<n.exactLength.value;(a||o)&&(ei(i,{code:a?Nt.too_big:Nt.too_small,minimum:o?n.exactLength.value:void 0,maximum:a?n.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:n.exactLength.message}),r.dirty())}if(n.minLength!==null&&i.data.length<n.minLength.value&&(ei(i,{code:Nt.too_small,minimum:n.minLength.value,type:"array",inclusive:!0,exact:!1,message:n.minLength.message}),r.dirty()),n.maxLength!==null&&i.data.length>n.maxLength.value&&(ei(i,{code:Nt.too_big,maximum:n.maxLength.value,type:"array",inclusive:!0,exact:!1,message:n.maxLength.message}),r.dirty()),i.common.async)return Promise.all([...i.data].map((a,o)=>n.type._parseAsync(new Yg(i,a,i.path,o)))).then(a=>Dc.mergeArray(r,a));const s=[...i.data].map((a,o)=>n.type._parseSync(new Yg(i,a,i.path,o)));return Dc.mergeArray(r,s)}get element(){return this._def.type}min(e,i){return new zd({...this._def,minLength:{value:e,message:bi.toString(i)}})}max(e,i){return new zd({...this._def,maxLength:{value:e,message:bi.toString(i)}})}length(e,i){return new zd({...this._def,exactLength:{value:e,message:bi.toString(i)}})}nonempty(e){return this.min(1,e)}}zd.create=(t,e)=>new zd({type:t,minLength:null,maxLength:null,exactLength:null,typeName:Ut.ZodArray,..._r(e)});function _w(t){if(t instanceof Us){const e={};for(const i in t.shape){const r=t.shape[i];e[i]=zg.create(_w(r))}return new Us({...t._def,shape:()=>e})}else return t instanceof zd?new zd({...t._def,type:_w(t.element)}):t instanceof zg?zg.create(_w(t.unwrap())):t instanceof T1?T1.create(_w(t.unwrap())):t instanceof E0?E0.create(t.items.map(e=>_w(e))):t}class Us extends Fr{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(this._cached!==null)return this._cached;const e=this._def.shape(),i=Hr.objectKeys(e);return this._cached={shape:e,keys:i},this._cached}_parse(e){if(this._getType(e)!==mi.object){const c=this._getOrReturnCtx(e);return ei(c,{code:Nt.invalid_type,expected:mi.object,received:c.parsedType}),rr}const{status:r,ctx:n}=this._processInputParams(e),{shape:s,keys:a}=this._getCached(),o=[];if(!(this._def.catchall instanceof Kg&&this._def.unknownKeys==="strip"))for(const c in n.data)a.includes(c)||o.push(c);const l=[];for(const c of a){const u=s[c],h=n.data[c];l.push({key:{status:"valid",value:c},value:u._parse(new Yg(n,h,n.path,c)),alwaysSet:c in n.data})}if(this._def.catchall instanceof Kg){const c=this._def.unknownKeys;if(c==="passthrough")for(const u of o)l.push({key:{status:"valid",value:u},value:{status:"valid",value:n.data[u]}});else if(c==="strict")o.length>0&&(ei(n,{code:Nt.unrecognized_keys,keys:o}),r.dirty());else if(c!=="strip")throw new Error("Internal ZodObject error: invalid unknownKeys value.")}else{const c=this._def.catchall;for(const u of o){const h=n.data[u];l.push({key:{status:"valid",value:u},value:c._parse(new Yg(n,h,n.path,u)),alwaysSet:u in n.data})}}return n.common.async?Promise.resolve().then(async()=>{const c=[];for(const u of l){const h=await u.key,d=await u.value;c.push({key:h,value:d,alwaysSet:u.alwaysSet})}return c}).then(c=>Dc.mergeObjectSync(r,c)):Dc.mergeObjectSync(r,l)}get shape(){return this._def.shape()}strict(e){return bi.errToObj,new Us({...this._def,unknownKeys:"strict",...e!==void 0?{errorMap:(i,r)=>{const n=this._def.errorMap?.(i,r).message??r.defaultError;return i.code==="unrecognized_keys"?{message:bi.errToObj(e).message??n}:{message:n}}}:{}})}strip(){return new Us({...this._def,unknownKeys:"strip"})}passthrough(){return new Us({...this._def,unknownKeys:"passthrough"})}extend(e){return new Us({...this._def,shape:()=>({...this._def.shape(),...e})})}merge(e){return new Us({unknownKeys:e._def.unknownKeys,catchall:e._def.catchall,shape:()=>({...this._def.shape(),...e._def.shape()}),typeName:Ut.ZodObject})}setKey(e,i){return this.augment({[e]:i})}catchall(e){return new Us({...this._def,catchall:e})}pick(e){const i={};for(const r of Hr.objectKeys(e))e[r]&&this.shape[r]&&(i[r]=this.shape[r]);return new Us({...this._def,shape:()=>i})}omit(e){const i={};for(const r of Hr.objectKeys(this.shape))e[r]||(i[r]=this.shape[r]);return new Us({...this._def,shape:()=>i})}deepPartial(){return _w(this)}partial(e){const i={};for(const r of Hr.objectKeys(this.shape)){const n=this.shape[r];e&&!e[r]?i[r]=n:i[r]=n.optional()}return new Us({...this._def,shape:()=>i})}required(e){const i={};for(const r of Hr.objectKeys(this.shape))if(e&&!e[r])i[r]=this.shape[r];else{let s=this.shape[r];for(;s instanceof zg;)s=s._def.innerType;i[r]=s}return new Us({...this._def,shape:()=>i})}keyof(){return aae(Hr.objectKeys(this.shape))}}Us.create=(t,e)=>new Us({shape:()=>t,unknownKeys:"strip",catchall:Kg.create(),typeName:Ut.ZodObject,..._r(e)});Us.strictCreate=(t,e)=>new Us({shape:()=>t,unknownKeys:"strict",catchall:Kg.create(),typeName:Ut.ZodObject,..._r(e)});Us.lazycreate=(t,e)=>new Us({shape:t,unknownKeys:"strip",catchall:Kg.create(),typeName:Ut.ZodObject,..._r(e)});class CI extends Fr{_parse(e){const{ctx:i}=this._processInputParams(e),r=this._def.options;function n(s){for(const o of s)if(o.result.status==="valid")return o.result;for(const o of s)if(o.result.status==="dirty")return i.common.issues.push(...o.ctx.common.issues),o.result;const a=s.map(o=>new Bp(o.ctx.common.issues));return ei(i,{code:Nt.invalid_union,unionErrors:a}),rr}if(i.common.async)return Promise.all(r.map(async s=>{const a={...i,common:{...i.common,issues:[]},parent:null};return{result:await s._parseAsync({data:i.data,path:i.path,parent:a}),ctx:a}})).then(n);{let s;const a=[];for(const l of r){const c={...i,common:{...i.common,issues:[]},parent:null},u=l._parseSync({data:i.data,path:i.path,parent:c});if(u.status==="valid")return u;u.status==="dirty"&&!s&&(s={result:u,ctx:c}),c.common.issues.length&&a.push(c.common.issues)}if(s)return i.common.issues.push(...s.ctx.common.issues),s.result;const o=a.map(l=>new Bp(l));return ei(i,{code:Nt.invalid_union,unionErrors:o}),rr}}get options(){return this._def.options}}CI.create=(t,e)=>new CI({options:t,typeName:Ut.ZodUnion,..._r(e)});function Sz(t,e){const i=ug(t),r=ug(e);if(t===e)return{valid:!0,data:t};if(i===mi.object&&r===mi.object){const n=Hr.objectKeys(e),s=Hr.objectKeys(t).filter(o=>n.indexOf(o)!==-1),a={...t,...e};for(const o of s){const l=Sz(t[o],e[o]);if(!l.valid)return{valid:!1};a[o]=l.data}return{valid:!0,data:a}}else if(i===mi.array&&r===mi.array){if(t.length!==e.length)return{valid:!1};const n=[];for(let s=0;s<t.length;s++){const a=t[s],o=e[s],l=Sz(a,o);if(!l.valid)return{valid:!1};n.push(l.data)}return{valid:!0,data:n}}else return i===mi.date&&r===mi.date&&+t==+e?{valid:!0,data:t}:{valid:!1}}class PI extends Fr{_parse(e){const{status:i,ctx:r}=this._processInputParams(e),n=(s,a)=>{if(Z7(s)||Z7(a))return rr;const o=Sz(s.value,a.value);return o.valid?((Q7(s)||Q7(a))&&i.dirty(),{status:i.value,value:o.data}):(ei(r,{code:Nt.invalid_intersection_types}),rr)};return r.common.async?Promise.all([this._def.left._parseAsync({data:r.data,path:r.path,parent:r}),this._def.right._parseAsync({data:r.data,path:r.path,parent:r})]).then(([s,a])=>n(s,a)):n(this._def.left._parseSync({data:r.data,path:r.path,parent:r}),this._def.right._parseSync({data:r.data,path:r.path,parent:r}))}}PI.create=(t,e,i)=>new PI({left:t,right:e,typeName:Ut.ZodIntersection,..._r(i)});class E0 extends Fr{_parse(e){const{status:i,ctx:r}=this._processInputParams(e);if(r.parsedType!==mi.array)return ei(r,{code:Nt.invalid_type,expected:mi.array,received:r.parsedType}),rr;if(r.data.length<this._def.items.length)return ei(r,{code:Nt.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),rr;!this._def.rest&&r.data.length>this._def.items.length&&(ei(r,{code:Nt.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),i.dirty());const s=[...r.data].map((a,o)=>{const l=this._def.items[o]||this._def.rest;return l?l._parse(new Yg(r,a,r.path,o)):null}).filter(a=>!!a);return r.common.async?Promise.all(s).then(a=>Dc.mergeArray(i,a)):Dc.mergeArray(i,s)}get items(){return this._def.items}rest(e){return new E0({...this._def,rest:e})}}E0.create=(t,e)=>{if(!Array.isArray(t))throw new Error("You must pass an array of schemas to z.tuple([ ... ])");return new E0({items:t,typeName:Ut.ZodTuple,rest:null,..._r(e)})};class aq extends Fr{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){const{status:i,ctx:r}=this._processInputParams(e);if(r.parsedType!==mi.map)return ei(r,{code:Nt.invalid_type,expected:mi.map,received:r.parsedType}),rr;const n=this._def.keyType,s=this._def.valueType,a=[...r.data.entries()].map(([o,l],c)=>({key:n._parse(new Yg(r,o,r.path,[c,"key"])),value:s._parse(new Yg(r,l,r.path,[c,"value"]))}));if(r.common.async){const o=new Map;return Promise.resolve().then(async()=>{for(const l of a){const c=await l.key,u=await l.value;if(c.status==="aborted"||u.status==="aborted")return rr;(c.status==="dirty"||u.status==="dirty")&&i.dirty(),o.set(c.value,u.value)}return{status:i.value,value:o}})}else{const o=new Map;for(const l of a){const c=l.key,u=l.value;if(c.status==="aborted"||u.status==="aborted")return rr;(c.status==="dirty"||u.status==="dirty")&&i.dirty(),o.set(c.value,u.value)}return{status:i.value,value:o}}}}aq.create=(t,e,i)=>new aq({valueType:e,keyType:t,typeName:Ut.ZodMap,..._r(i)});class rM extends Fr{_parse(e){const{status:i,ctx:r}=this._processInputParams(e);if(r.parsedType!==mi.set)return ei(r,{code:Nt.invalid_type,expected:mi.set,received:r.parsedType}),rr;const n=this._def;n.minSize!==null&&r.data.size<n.minSize.value&&(ei(r,{code:Nt.too_small,minimum:n.minSize.value,type:"set",inclusive:!0,exact:!1,message:n.minSize.message}),i.dirty()),n.maxSize!==null&&r.data.size>n.maxSize.value&&(ei(r,{code:Nt.too_big,maximum:n.maxSize.value,type:"set",inclusive:!0,exact:!1,message:n.maxSize.message}),i.dirty());const s=this._def.valueType;function a(l){const c=new Set;for(const u of l){if(u.status==="aborted")return rr;u.status==="dirty"&&i.dirty(),c.add(u.value)}return{status:i.value,value:c}}const o=[...r.data.values()].map((l,c)=>s._parse(new Yg(r,l,r.path,c)));return r.common.async?Promise.all(o).then(l=>a(l)):a(o)}min(e,i){return new rM({...this._def,minSize:{value:e,message:bi.toString(i)}})}max(e,i){return new rM({...this._def,maxSize:{value:e,message:bi.toString(i)}})}size(e,i){return this.min(e,i).max(e,i)}nonempty(e){return this.min(1,e)}}rM.create=(t,e)=>new rM({valueType:t,minSize:null,maxSize:null,typeName:Ut.ZodSet,..._r(e)});class oq extends Fr{get schema(){return this._def.getter()}_parse(e){const{ctx:i}=this._processInputParams(e);return this._def.getter()._parse({data:i.data,path:i.path,parent:i})}}oq.create=(t,e)=>new oq({getter:t,typeName:Ut.ZodLazy,..._r(e)});class lq extends Fr{_parse(e){if(e.data!==this._def.value){const i=this._getOrReturnCtx(e);return ei(i,{received:i.data,code:Nt.invalid_literal,expected:this._def.value}),rr}return{status:"valid",value:e.data}}get value(){return this._def.value}}lq.create=(t,e)=>new lq({value:t,typeName:Ut.ZodLiteral,..._r(e)});function aae(t,e){return new A1({values:t,typeName:Ut.ZodEnum,..._r(e)})}class A1 extends Fr{_parse(e){if(typeof e.data!="string"){const i=this._getOrReturnCtx(e),r=this._def.values;return ei(i,{expected:Hr.joinValues(r),received:i.parsedType,code:Nt.invalid_type}),rr}if(this._cache||(this._cache=new Set(this._def.values)),!this._cache.has(e.data)){const i=this._getOrReturnCtx(e),r=this._def.values;return ei(i,{received:i.data,code:Nt.invalid_enum_value,options:r}),rr}return Eu(e.data)}get options(){return this._def.values}get enum(){const e={};for(const i of this._def.values)e[i]=i;return e}get Values(){const e={};for(const i of this._def.values)e[i]=i;return e}get Enum(){const e={};for(const i of this._def.values)e[i]=i;return e}extract(e,i=this._def){return A1.create(e,{...this._def,...i})}exclude(e,i=this._def){return A1.create(this.options.filter(r=>!e.includes(r)),{...this._def,...i})}}A1.create=aae;class cq extends Fr{_parse(e){const i=Hr.getValidEnumValues(this._def.values),r=this._getOrReturnCtx(e);if(r.parsedType!==mi.string&&r.parsedType!==mi.number){const n=Hr.objectValues(i);return ei(r,{expected:Hr.joinValues(n),received:r.parsedType,code:Nt.invalid_type}),rr}if(this._cache||(this._cache=new Set(Hr.getValidEnumValues(this._def.values))),!this._cache.has(e.data)){const n=Hr.objectValues(i);return ei(r,{received:r.data,code:Nt.invalid_enum_value,options:n}),rr}return Eu(e.data)}get enum(){return this._def.values}}cq.create=(t,e)=>new cq({values:t,typeName:Ut.ZodNativeEnum,..._r(e)});class RI extends Fr{unwrap(){return this._def.type}_parse(e){const{ctx:i}=this._processInputParams(e);if(i.parsedType!==mi.promise&&i.common.async===!1)return ei(i,{code:Nt.invalid_type,expected:mi.promise,received:i.parsedType}),rr;const r=i.parsedType===mi.promise?i.data:Promise.resolve(i.data);return Eu(r.then(n=>this._def.type.parseAsync(n,{path:i.path,errorMap:i.common.contextualErrorMap})))}}RI.create=(t,e)=>new RI({type:t,typeName:Ut.ZodPromise,..._r(e)});class M1 extends Fr{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===Ut.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(e){const{status:i,ctx:r}=this._processInputParams(e),n=this._def.effect||null,s={addIssue:a=>{ei(r,a),a.fatal?i.abort():i.dirty()},get path(){return r.path}};if(s.addIssue=s.addIssue.bind(s),n.type==="preprocess"){const a=n.transform(r.data,s);if(r.common.async)return Promise.resolve(a).then(async o=>{if(i.value==="aborted")return rr;const l=await this._def.schema._parseAsync({data:o,path:r.path,parent:r});return l.status==="aborted"?rr:l.status==="dirty"||i.value==="dirty"?NE(l.value):l});{if(i.value==="aborted")return rr;const o=this._def.schema._parseSync({data:a,path:r.path,parent:r});return o.status==="aborted"?rr:o.status==="dirty"||i.value==="dirty"?NE(o.value):o}}if(n.type==="refinement"){const a=o=>{const l=n.refinement(o,s);if(r.common.async)return Promise.resolve(l);if(l instanceof Promise)throw new Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return o};if(r.common.async===!1){const o=this._def.schema._parseSync({data:r.data,path:r.path,parent:r});return o.status==="aborted"?rr:(o.status==="dirty"&&i.dirty(),a(o.value),{status:i.value,value:o.value})}else return this._def.schema._parseAsync({data:r.data,path:r.path,parent:r}).then(o=>o.status==="aborted"?rr:(o.status==="dirty"&&i.dirty(),a(o.value).then(()=>({status:i.value,value:o.value}))))}if(n.type==="transform")if(r.common.async===!1){const a=this._def.schema._parseSync({data:r.data,path:r.path,parent:r});if(!E1(a))return rr;const o=n.transform(a.value,s);if(o instanceof Promise)throw new Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:i.value,value:o}}else return this._def.schema._parseAsync({data:r.data,path:r.path,parent:r}).then(a=>E1(a)?Promise.resolve(n.transform(a.value,s)).then(o=>({status:i.value,value:o})):rr);Hr.assertNever(n)}}M1.create=(t,e,i)=>new M1({schema:t,typeName:Ut.ZodEffects,effect:e,..._r(i)});M1.createWithPreprocess=(t,e,i)=>new M1({schema:e,effect:{type:"preprocess",transform:t},typeName:Ut.ZodEffects,..._r(i)});class zg extends Fr{_parse(e){return this._getType(e)===mi.undefined?Eu(void 0):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}zg.create=(t,e)=>new zg({innerType:t,typeName:Ut.ZodOptional,..._r(e)});class T1 extends Fr{_parse(e){return this._getType(e)===mi.null?Eu(null):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}T1.create=(t,e)=>new T1({innerType:t,typeName:Ut.ZodNullable,..._r(e)});class Ez extends Fr{_parse(e){const{ctx:i}=this._processInputParams(e);let r=i.data;return i.parsedType===mi.undefined&&(r=this._def.defaultValue()),this._def.innerType._parse({data:r,path:i.path,parent:i})}removeDefault(){return this._def.innerType}}Ez.create=(t,e)=>new Ez({innerType:t,typeName:Ut.ZodDefault,defaultValue:typeof e.default=="function"?e.default:()=>e.default,..._r(e)});class Az extends Fr{_parse(e){const{ctx:i}=this._processInputParams(e),r={...i,common:{...i.common,issues:[]}},n=this._def.innerType._parse({data:r.data,path:r.path,parent:{...r}});return MI(n)?n.then(s=>({status:"valid",value:s.status==="valid"?s.value:this._def.catchValue({get error(){return new Bp(r.common.issues)},input:r.data})})):{status:"valid",value:n.status==="valid"?n.value:this._def.catchValue({get error(){return new Bp(r.common.issues)},input:r.data})}}removeCatch(){return this._def.innerType}}Az.create=(t,e)=>new Az({innerType:t,typeName:Ut.ZodCatch,catchValue:typeof e.catch=="function"?e.catch:()=>e.catch,..._r(e)});class uq extends Fr{_parse(e){if(this._getType(e)!==mi.nan){const r=this._getOrReturnCtx(e);return ei(r,{code:Nt.invalid_type,expected:mi.nan,received:r.parsedType}),rr}return{status:"valid",value:e.data}}}uq.create=t=>new uq({typeName:Ut.ZodNaN,..._r(t)});class VMe extends Fr{_parse(e){const{ctx:i}=this._processInputParams(e),r=i.data;return this._def.type._parse({data:r,path:i.path,parent:i})}unwrap(){return this._def.type}}class _6 extends Fr{_parse(e){const{status:i,ctx:r}=this._processInputParams(e);if(r.common.async)return(async()=>{const s=await this._def.in._parseAsync({data:r.data,path:r.path,parent:r});return s.status==="aborted"?rr:s.status==="dirty"?(i.dirty(),NE(s.value)):this._def.out._parseAsync({data:s.value,path:r.path,parent:r})})();{const n=this._def.in._parseSync({data:r.data,path:r.path,parent:r});return n.status==="aborted"?rr:n.status==="dirty"?(i.dirty(),{status:"dirty",value:n.value}):this._def.out._parseSync({data:n.value,path:r.path,parent:r})}}static create(e,i){return new _6({in:e,out:i,typeName:Ut.ZodPipeline})}}class Mz extends Fr{_parse(e){const i=this._def.innerType._parse(e),r=n=>(E1(n)&&(n.value=Object.freeze(n.value)),n);return MI(i)?i.then(n=>r(n)):r(i)}unwrap(){return this._def.innerType}}Mz.create=(t,e)=>new Mz({innerType:t,typeName:Ut.ZodReadonly,..._r(e)});var Ut;(function(t){t.ZodString="ZodString",t.ZodNumber="ZodNumber",t.ZodNaN="ZodNaN",t.ZodBigInt="ZodBigInt",t.ZodBoolean="ZodBoolean",t.ZodDate="ZodDate",t.ZodSymbol="ZodSymbol",t.ZodUndefined="ZodUndefined",t.ZodNull="ZodNull",t.ZodAny="ZodAny",t.ZodUnknown="ZodUnknown",t.ZodNever="ZodNever",t.ZodVoid="ZodVoid",t.ZodArray="ZodArray",t.ZodObject="ZodObject",t.ZodUnion="ZodUnion",t.ZodDiscriminatedUnion="ZodDiscriminatedUnion",t.ZodIntersection="ZodIntersection",t.ZodTuple="ZodTuple",t.ZodRecord="ZodRecord",t.ZodMap="ZodMap",t.ZodSet="ZodSet",t.ZodFunction="ZodFunction",t.ZodLazy="ZodLazy",t.ZodLiteral="ZodLiteral",t.ZodEnum="ZodEnum",t.ZodEffects="ZodEffects",t.ZodNativeEnum="ZodNativeEnum",t.ZodOptional="ZodOptional",t.ZodNullable="ZodNullable",t.ZodDefault="ZodDefault",t.ZodCatch="ZodCatch",t.ZodPromise="ZodPromise",t.ZodBranded="ZodBranded",t.ZodPipeline="ZodPipeline",t.ZodReadonly="ZodReadonly"})(Ut||(Ut={}));const HMe=Mg.create,hq=_z.create;Kg.create;zd.create;const GMe=Us.create;CI.create;PI.create;E0.create;A1.create;RI.create;zg.create;T1.create;var FS={exports:{}},Yk={},Kk,dq;function WMe(){if(dq)return Kk;dq=1;function t(e,i){typeof i=="boolean"&&(i={forever:i}),this._originalTimeouts=JSON.parse(JSON.stringify(e)),this._timeouts=e,this._options=i||{},this._maxRetryTime=i&&i.maxRetryTime||1/0,this._fn=null,this._errors=[],this._attempts=1,this._operationTimeout=null,this._operationTimeoutCb=null,this._timeout=null,this._operationStart=null,this._timer=null,this._options.forever&&(this._cachedTimeouts=this._timeouts.slice(0))}return Kk=t,t.prototype.reset=function(){this._attempts=1,this._timeouts=this._originalTimeouts.slice(0)},t.prototype.stop=function(){this._timeout&&clearTimeout(this._timeout),this._timer&&clearTimeout(this._timer),this._timeouts=[],this._cachedTimeouts=null},t.prototype.retry=function(e){if(this._timeout&&clearTimeout(this._timeout),!e)return!1;var i=new Date().getTime();if(e&&i-this._operationStart>=this._maxRetryTime)return this._errors.push(e),this._errors.unshift(new Error("RetryOperation timeout occurred")),!1;this._errors.push(e);var r=this._timeouts.shift();if(r===void 0)if(this._cachedTimeouts)this._errors.splice(0,this._errors.length-1),r=this._cachedTimeouts.slice(-1);else return!1;var n=this;return this._timer=setTimeout(function(){n._attempts++,n._operationTimeoutCb&&(n._timeout=setTimeout(function(){n._operationTimeoutCb(n._attempts)},n._operationTimeout),n._options.unref&&n._timeout.unref()),n._fn(n._attempts)},r),this._options.unref&&this._timer.unref(),!0},t.prototype.attempt=function(e,i){this._fn=e,i&&(i.timeout&&(this._operationTimeout=i.timeout),i.cb&&(this._operationTimeoutCb=i.cb));var r=this;this._operationTimeoutCb&&(this._timeout=setTimeout(function(){r._operationTimeoutCb()},r._operationTimeout)),this._operationStart=new Date().getTime(),this._fn(this._attempts)},t.prototype.try=function(e){console.log("Using RetryOperation.try() is deprecated"),this.attempt(e)},t.prototype.start=function(e){console.log("Using RetryOperation.start() is deprecated"),this.attempt(e)},t.prototype.start=t.prototype.try,t.prototype.errors=function(){return this._errors},t.prototype.attempts=function(){return this._attempts},t.prototype.mainError=function(){if(this._errors.length===0)return null;for(var e={},i=null,r=0,n=0;n<this._errors.length;n++){var s=this._errors[n],a=s.message,o=(e[a]||0)+1;e[a]=o,o>=r&&(i=s,r=o)}return i},Kk}var fq;function qMe(){return fq||(fq=1,(function(t){var e=WMe();t.operation=function(i){var r=t.timeouts(i);return new e(r,{forever:i&&(i.forever||i.retries===1/0),unref:i&&i.unref,maxRetryTime:i&&i.maxRetryTime})},t.timeouts=function(i){if(i instanceof Array)return[].concat(i);var r={retries:10,factor:2,minTimeout:1*1e3,maxTimeout:1/0,randomize:!1};for(var n in i)r[n]=i[n];if(r.minTimeout>r.maxTimeout)throw new Error("minTimeout is greater than maxTimeout");for(var s=[],a=0;a<r.retries;a++)s.push(this.createTimeout(a,r));return i&&i.forever&&!s.length&&s.push(this.createTimeout(a,r)),s.sort(function(o,l){return o-l}),s},t.createTimeout=function(i,r){var n=r.randomize?Math.random()+1:1,s=Math.round(n*Math.max(r.minTimeout,1)*Math.pow(r.factor,i));return s=Math.min(s,r.maxTimeout),s},t.wrap=function(i,r,n){if(r instanceof Array&&(n=r,r=null),!n){n=[];for(var s in i)typeof i[s]=="function"&&n.push(s)}for(var a=0;a<n.length;a++){var o=n[a],l=i[o];i[o]=function(u){var h=t.operation(r),d=Array.prototype.slice.call(arguments,1),f=d.pop();d.push(function(p){h.retry(p)||(p&&(arguments[0]=h.mainError()),f.apply(this,arguments))}),h.attempt(function(){u.apply(i,d)})}.bind(i,l),i[o].options=r}}})(Yk)),Yk}var Zk,pq;function XMe(){return pq||(pq=1,Zk=qMe()),Zk}var mq;function $Me(){if(mq)return FS.exports;mq=1;const t=XMe(),e=["Failed to fetch","NetworkError when attempting to fetch resource.","The Internet connection appears to be offline.","Network request failed"];class i extends Error{constructor(o){super(),o instanceof Error?(this.originalError=o,{message:o}=o):(this.originalError=new Error(o),this.originalError.stack=this.stack),this.name="AbortError",this.message=o}}const r=(a,o,l)=>{const c=l.retries-(o-1);return a.attemptNumber=o,a.retriesLeft=c,a},n=a=>e.includes(a),s=(a,o)=>new Promise((l,c)=>{o={onFailedAttempt:()=>{},retries:10,...o};const u=t.operation(o);u.attempt(async h=>{try{l(await a(h))}catch(d){if(!(d instanceof Error)){c(new TypeError(`Non-error was thrown: "${d}". You should only throw errors.`));return}if(d instanceof i)u.stop(),c(d.originalError);else if(d instanceof TypeError&&!n(d.message))u.stop(),c(d);else{r(d,h,o);try{await o.onFailedAttempt(d)}catch(f){c(f);return}u.retry(d)||c(u.mainError())}}})});return FS.exports=s,FS.exports.default=s,FS.exports.AbortError=i,FS.exports}var YMe=$Me();const II=Lh(YMe),KMe=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-8][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000|ffffffff-ffff-ffff-ffff-ffffffffffff)$/i;function dA(t){return typeof t=="string"&&KMe.test(t)}function ZMe(t){if(!dA(t))throw TypeError("Invalid UUID");var e,i=new Uint8Array(16);return i[0]=(e=parseInt(t.slice(0,8),16))>>>24,i[1]=e>>>16&255,i[2]=e>>>8&255,i[3]=e&255,i[4]=(e=parseInt(t.slice(9,13),16))>>>8,i[5]=e&255,i[6]=(e=parseInt(t.slice(14,18),16))>>>8,i[7]=e&255,i[8]=(e=parseInt(t.slice(19,23),16))>>>8,i[9]=e&255,i[10]=(e=parseInt(t.slice(24,36),16))/1099511627776&255,i[11]=e/4294967296&255,i[12]=e>>>24&255,i[13]=e>>>16&255,i[14]=e>>>8&255,i[15]=e&255,i}var uo=[];for(var Qk=0;Qk<256;++Qk)uo.push((Qk+256).toString(16).slice(1));function oae(t,e=0){return(uo[t[e+0]]+uo[t[e+1]]+uo[t[e+2]]+uo[t[e+3]]+"-"+uo[t[e+4]]+uo[t[e+5]]+"-"+uo[t[e+6]]+uo[t[e+7]]+"-"+uo[t[e+8]]+uo[t[e+9]]+"-"+uo[t[e+10]]+uo[t[e+11]]+uo[t[e+12]]+uo[t[e+13]]+uo[t[e+14]]+uo[t[e+15]]).toLowerCase()}var i2,QMe=new Uint8Array(16);function JMe(){if(!i2&&(i2=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!i2))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return i2(QMe)}function eTe(t){t=unescape(encodeURIComponent(t));for(var e=[],i=0;i<t.length;++i)e.push(t.charCodeAt(i));return e}var tTe="6ba7b810-9dad-11d1-80b4-00c04fd430c8",iTe="6ba7b811-9dad-11d1-80b4-00c04fd430c8";function rTe(t,e,i){function r(n,s,a,o){var l;if(typeof n=="string"&&(n=eTe(n)),typeof s=="string"&&(s=ZMe(s)),((l=s)===null||l===void 0?void 0:l.length)!==16)throw TypeError("Namespace must be array-like (16 iterable integer values, 0-255)");var c=new Uint8Array(16+n.length);if(c.set(s),c.set(n,s.length),c=i(c),c[6]=c[6]&15|e,c[8]=c[8]&63|128,a){o=o||0;for(var u=0;u<16;++u)a[o+u]=c[u];return a}return oae(c)}try{r.name=t}catch{}return r.DNS=tTe,r.URL=iTe,r}var nTe=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto);const gq={randomUUID:nTe};function dl(t,e,i){if(gq.randomUUID&&!t)return gq.randomUUID();t=t||{};var r=t.random||(t.rng||JMe)();return r[6]=r[6]&15|64,r[8]=r[8]&63|128,oae(r)}function sTe(t,e,i,r){switch(t){case 0:return e&i^~e&r;case 1:return e^i^r;case 2:return e&i^e&r^i&r;case 3:return e^i^r}}function Jk(t,e){return t<<e|t>>>32-e}function aTe(t){var e=[1518500249,1859775393,2400959708,3395469782],i=[1732584193,4023233417,2562383102,271733878,3285377520];if(typeof t=="string"){var r=unescape(encodeURIComponent(t));t=[];for(var n=0;n<r.length;++n)t.push(r.charCodeAt(n))}else Array.isArray(t)||(t=Array.prototype.slice.call(t));t.push(128);for(var s=t.length/4+2,a=Math.ceil(s/16),o=new Array(a),l=0;l<a;++l){for(var c=new Uint32Array(16),u=0;u<16;++u)c[u]=t[l*64+u*4]<<24|t[l*64+u*4+1]<<16|t[l*64+u*4+2]<<8|t[l*64+u*4+3];o[l]=c}o[a-1][14]=(t.length-1)*8/Math.pow(2,32),o[a-1][14]=Math.floor(o[a-1][14]),o[a-1][15]=(t.length-1)*8&4294967295;for(var h=0;h<a;++h){for(var d=new Uint32Array(80),f=0;f<16;++f)d[f]=o[h][f];for(var p=16;p<80;++p)d[p]=Jk(d[p-3]^d[p-8]^d[p-14]^d[p-16],1);for(var g=i[0],m=i[1],y=i[2],b=i[3],w=i[4],E=0;E<80;++E){var M=Math.floor(E/20),A=Jk(g,5)+sTe(M,m,y,b)+w+e[M]+d[E]>>>0;w=b,b=y,y=Jk(m,30)>>>0,m=g,g=A}i[0]=i[0]+g>>>0,i[1]=i[1]+m>>>0,i[2]=i[2]+y>>>0,i[3]=i[3]+b>>>0,i[4]=i[4]+w>>>0}return[i[0]>>24&255,i[0]>>16&255,i[0]>>8&255,i[0]&255,i[1]>>24&255,i[1]>>16&255,i[1]>>8&255,i[1]&255,i[2]>>24&255,i[2]>>16&255,i[2]>>8&255,i[2]&255,i[3]>>24&255,i[3]>>16&255,i[3]>>8&255,i[3]&255,i[4]>>24&255,i[4]>>16&255,i[4]>>8&255,i[4]&255]}var vq=rTe("v5",80,aTe);let oTe=class{getStore(){}run(e,i){return i()}};const eN=Symbol.for("ls:tracing_async_local_storage"),lTe=new oTe;let cTe=class{getInstance(){return globalThis[eN]??lTe}initializeGlobalInstance(e){globalThis[eN]===void 0&&(globalThis[eN]=e)}};const uTe=new cTe;function hTe(t=!1){const e=uTe.getInstance().getStore();if(!t&&e===void 0)throw new Error(`Could not get the current run tree.

Please make sure you are calling this method within a traceable function and that tracing is enabled.`);return e}function S6(t){return typeof t=="function"&&"langsmith:traceable"in t}/*!
 * https://github.com/Starcounter-Jack/JSON-Patch
 * (c) 2017-2022 Joachim Wester
 * MIT licensed
 */const dTe=Object.prototype.hasOwnProperty;function Tz(t,e){return dTe.call(t,e)}function Cz(t){if(Array.isArray(t)){const i=new Array(t.length);for(let r=0;r<i.length;r++)i[r]=""+r;return i}if(Object.keys)return Object.keys(t);let e=[];for(let i in t)Tz(t,i)&&e.push(i);return e}function Rd(t){switch(typeof t){case"object":return JSON.parse(JSON.stringify(t));case"undefined":return null;default:return t}}function Pz(t){let e=0;const i=t.length;let r;for(;e<i;){if(r=t.charCodeAt(e),r>=48&&r<=57){e++;continue}return!1}return!0}function cb(t){return t.indexOf("/")===-1&&t.indexOf("~")===-1?t:t.replace(/~/g,"~0").replace(/\//g,"~1")}function fTe(t){return t.replace(/~1/g,"/").replace(/~0/g,"~")}function Rz(t){if(t===void 0)return!0;if(t){if(Array.isArray(t)){for(let i=0,r=t.length;i<r;i++)if(Rz(t[i]))return!0}else if(typeof t=="object"){const i=Cz(t),r=i.length;for(var e=0;e<r;e++)if(Rz(t[i[e]]))return!0}}return!1}function yq(t,e){const i=[t];for(const r in e){const n=typeof e[r]=="object"?JSON.stringify(e[r],null,2):e[r];typeof n<"u"&&i.push(`${r}: ${n}`)}return i.join(`
`)}class pTe extends Error{constructor(e,i,r,n,s){super(yq(e,{name:i,index:r,operation:n,tree:s})),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:i}),Object.defineProperty(this,"index",{enumerable:!0,configurable:!0,writable:!0,value:r}),Object.defineProperty(this,"operation",{enumerable:!0,configurable:!0,writable:!0,value:n}),Object.defineProperty(this,"tree",{enumerable:!0,configurable:!0,writable:!0,value:s}),Object.setPrototypeOf(this,new.target.prototype),this.message=yq(e,{name:i,index:r,operation:n,tree:s})}}const Bs=pTe,zw={add:function(t,e,i){return t[e]=this.value,{newDocument:i}},remove:function(t,e,i){var r=t[e];return delete t[e],{newDocument:i,removed:r}},replace:function(t,e,i){var r=t[e];return t[e]=this.value,{newDocument:i,removed:r}},move:function(t,e,i){let r=Iz(i,this.path);r&&(r=Rd(r));const n=fA(i,{op:"remove",path:this.from}).removed;return fA(i,{op:"add",path:this.path,value:n}),{newDocument:i,removed:r}},copy:function(t,e,i){const r=Iz(i,this.from);return fA(i,{op:"add",path:this.path,value:Rd(r)}),{newDocument:i}},test:function(t,e,i){return{newDocument:i,test:OI(t[e],this.value)}},_get:function(t,e,i){return this.value=t[e],{newDocument:i}}};var mTe={add:function(t,e,i){return Pz(e)?t.splice(e,0,this.value):t[e]=this.value,{newDocument:i,index:e}},remove:function(t,e,i){var r=t.splice(e,1);return{newDocument:i,removed:r[0]}},replace:function(t,e,i){var r=t[e];return t[e]=this.value,{newDocument:i,removed:r}},move:zw.move,copy:zw.copy,test:zw.test,_get:zw._get};function Iz(t,e){if(e=="")return t;var i={op:"_get",path:e};return fA(t,i),i.value}function fA(t,e,i=!1,r=!0,n=!0,s=0){if(i&&(typeof i=="function"?i(e,0,t,e.path):Dz(e,0)),e.path===""){let a={newDocument:t};if(e.op==="add")return a.newDocument=e.value,a;if(e.op==="replace")return a.newDocument=e.value,a.removed=t,a;if(e.op==="move"||e.op==="copy")return a.newDocument=Iz(t,e.from),e.op==="move"&&(a.removed=t),a;if(e.op==="test"){if(a.test=OI(t,e.value),a.test===!1)throw new Bs("Test operation failed","TEST_OPERATION_FAILED",s,e,t);return a.newDocument=t,a}else{if(e.op==="remove")return a.removed=t,a.newDocument=null,a;if(e.op==="_get")return e.value=t,a;if(i)throw new Bs("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",s,e,t);return a}}else{r||(t=Rd(t));const o=(e.path||"").split("/");let l=t,c=1,u=o.length,h,d,f;for(typeof i=="function"?f=i:f=Dz;;){if(d=o[c],d&&d.indexOf("~")!=-1&&(d=fTe(d)),n&&(d=="__proto__"||d=="prototype"&&c>0&&o[c-1]=="constructor"))throw new TypeError("JSON-Patch: modifying `__proto__` or `constructor/prototype` prop is banned for security reasons, if this was on purpose, please set `banPrototypeModifications` flag false and pass it to this function. More info in fast-json-patch README");if(i&&h===void 0&&(l[d]===void 0?h=o.slice(0,c).join("/"):c==u-1&&(h=e.path),h!==void 0&&f(e,0,t,h)),c++,Array.isArray(l)){if(d==="-")d=l.length;else{if(i&&!Pz(d))throw new Bs("Expected an unsigned base-10 integer value, making the new referenced value the array element with the zero-based index","OPERATION_PATH_ILLEGAL_ARRAY_INDEX",s,e,t);Pz(d)&&(d=~~d)}if(c>=u){if(i&&e.op==="add"&&d>l.length)throw new Bs("The specified index MUST NOT be greater than the number of elements in the array","OPERATION_VALUE_OUT_OF_BOUNDS",s,e,t);const p=mTe[e.op].call(e,l,d,t);if(p.test===!1)throw new Bs("Test operation failed","TEST_OPERATION_FAILED",s,e,t);return p}}else if(c>=u){const p=zw[e.op].call(e,l,d,t);if(p.test===!1)throw new Bs("Test operation failed","TEST_OPERATION_FAILED",s,e,t);return p}if(l=l[d],i&&c<u&&(!l||typeof l!="object"))throw new Bs("Cannot perform operation at the desired path","OPERATION_PATH_UNRESOLVABLE",s,e,t)}}}function DI(t,e,i,r=!0,n=!0){if(i&&!Array.isArray(e))throw new Bs("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");r||(t=Rd(t));const s=new Array(e.length);for(let a=0,o=e.length;a<o;a++)s[a]=fA(t,e[a],i,!0,n,a),t=s[a].newDocument;return s.newDocument=t,s}function Dz(t,e,i,r){if(typeof t!="object"||t===null||Array.isArray(t))throw new Bs("Operation is not an object","OPERATION_NOT_AN_OBJECT",e,t,i);if(zw[t.op]){if(typeof t.path!="string")throw new Bs("Operation `path` property is not a string","OPERATION_PATH_INVALID",e,t,i);if(t.path.indexOf("/")!==0&&t.path.length>0)throw new Bs('Operation `path` property must start with "/"',"OPERATION_PATH_INVALID",e,t,i);if((t.op==="move"||t.op==="copy")&&typeof t.from!="string")throw new Bs("Operation `from` property is not present (applicable in `move` and `copy` operations)","OPERATION_FROM_REQUIRED",e,t,i);if((t.op==="add"||t.op==="replace"||t.op==="test")&&t.value===void 0)throw new Bs("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_REQUIRED",e,t,i);if((t.op==="add"||t.op==="replace"||t.op==="test")&&Rz(t.value))throw new Bs("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_CANNOT_CONTAIN_UNDEFINED",e,t,i);if(i){if(t.op=="add"){var n=t.path.split("/").length,s=r.split("/").length;if(n!==s+1&&n!==s)throw new Bs("Cannot perform an `add` operation at the desired path","OPERATION_PATH_CANNOT_ADD",e,t,i)}else if(t.op==="replace"||t.op==="remove"||t.op==="_get"){if(t.path!==r)throw new Bs("Cannot perform the operation at a path that does not exist","OPERATION_PATH_UNRESOLVABLE",e,t,i)}else if(t.op==="move"||t.op==="copy"){var a={op:"_get",path:t.from,value:void 0},o=gTe([a],i);if(o&&o.name==="OPERATION_PATH_UNRESOLVABLE")throw new Bs("Cannot perform the operation from a path that does not exist","OPERATION_FROM_UNRESOLVABLE",e,t,i)}}}else throw new Bs("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",e,t,i)}function gTe(t,e,i){try{if(!Array.isArray(t))throw new Bs("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");if(e)DI(Rd(e),Rd(t),i||!0);else{i=i||Dz;for(var r=0;r<t.length;r++)i(t[r],r,e,void 0)}}catch(n){if(n instanceof Bs)return n;throw n}}function OI(t,e){if(t===e)return!0;if(t&&e&&typeof t=="object"&&typeof e=="object"){var i=Array.isArray(t),r=Array.isArray(e),n,s,a;if(i&&r){if(s=t.length,s!=e.length)return!1;for(n=s;n--!==0;)if(!OI(t[n],e[n]))return!1;return!0}if(i!=r)return!1;var o=Object.keys(t);if(s=o.length,s!==Object.keys(e).length)return!1;for(n=s;n--!==0;)if(!e.hasOwnProperty(o[n]))return!1;for(n=s;n--!==0;)if(a=o[n],!OI(t[a],e[a]))return!1;return!0}return t!==t&&e!==e}/*!
 * https://github.com/Starcounter-Jack/JSON-Patch
 * (c) 2013-2021 Joachim Wester
 * MIT license
 */function lae(t,e,i,r,n){if(e!==t){typeof e.toJSON=="function"&&(e=e.toJSON());for(var s=Cz(e),a=Cz(t),o=!1,l=a.length-1;l>=0;l--){var c=a[l],u=t[c];if(Tz(e,c)&&!(e[c]===void 0&&u!==void 0&&Array.isArray(e)===!1)){var h=e[c];typeof u=="object"&&u!=null&&typeof h=="object"&&h!=null&&Array.isArray(u)===Array.isArray(h)?lae(u,h,i,r+"/"+cb(c),n):u!==h&&(n&&i.push({op:"test",path:r+"/"+cb(c),value:Rd(u)}),i.push({op:"replace",path:r+"/"+cb(c),value:Rd(h)}))}else Array.isArray(t)===Array.isArray(e)?(n&&i.push({op:"test",path:r+"/"+cb(c),value:Rd(u)}),i.push({op:"remove",path:r+"/"+cb(c)}),o=!0):(n&&i.push({op:"test",path:r,value:t}),i.push({op:"replace",path:r,value:e}))}if(!(!o&&s.length==a.length))for(var l=0;l<s.length;l++){var c=s[l];!Tz(t,c)&&e[c]!==void 0&&i.push({op:"add",path:r+"/"+cb(c),value:Rd(e[c])})}}}function vTe(t,e,i=!1){var r=[];return lae(t,e,r,"",i),r}const yTe="gen_ai.operation.name",xTe="gen_ai.system",xq="gen_ai.request.model",bTe="gen_ai.response.model",bq="gen_ai.usage.input_tokens",wq="gen_ai.usage.output_tokens",_q="gen_ai.usage.total_tokens",wTe="gen_ai.request.max_tokens",_Te="gen_ai.request.temperature",STe="gen_ai.request.top_p",ETe="gen_ai.request.frequency_penalty",ATe="gen_ai.request.presence_penalty",MTe="gen_ai.response.finish_reasons",TTe="gen_ai.prompt",CTe="gen_ai.completion",PTe="gen_ai.request.extra_query",RTe="gen_ai.request.extra_body",ITe="gen_ai.serialized.name",DTe="gen_ai.serialized.signature",OTe="gen_ai.serialized.doc",LTe="gen_ai.response.id",kTe="gen_ai.response.service_tier",NTe="gen_ai.response.system_fingerprint",UTe="gen_ai.usage.input_token_details",BTe="gen_ai.usage.output_token_details",FTe="langsmith.trace.session_id",zTe="langsmith.trace.session_name",jTe="langsmith.span.kind",VTe="langsmith.trace.name",HTe="langsmith.metadata",Sq="langsmith.span.tags",GTe="langsmith.request.streaming",WTe="langsmith.request.headers",qTe=(...t)=>fetch(...t),cae=Symbol.for("ls:fetch_implementation"),XTe=()=>{const t=globalThis[cae];return t?typeof t=="function"&&"Headers"in t&&"Request"in t&&"Response"in t:!1},$Te=t=>async(...e)=>{if(t||Xl("DEBUG")==="true"){const[r,n]=e;console.log(` ${n?.method||"GET"} ${r}`)}const i=await(globalThis[cae]??qTe)(...e);return(t||Xl("DEBUG")==="true")&&console.log(` ${i.status} ${i.statusText} ${i.url}`),i},uae=()=>Xl("PROJECT")??Zd("LANGCHAIN_SESSION")??"default",hae="0.3.72";var Oz={};let ed;const YTe=()=>typeof window<"u"&&typeof window.document<"u",KTe=()=>typeof globalThis=="object"&&globalThis.constructor&&globalThis.constructor.name==="DedicatedWorkerGlobalScope",ZTe=()=>typeof window<"u"&&window.name==="nodejs"||typeof navigator<"u"&&navigator.userAgent.includes("jsdom"),dae=()=>typeof Deno<"u",QTe=()=>typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"&&!dae(),fae=()=>ed||(typeof Bun<"u"?ed="bun":YTe()?ed="browser":QTe()?ed="node":KTe()?ed="webworker":ZTe()?ed="jsdom":dae()?ed="deno":ed="other",ed);let tN;function pae(){if(tN===void 0){const t=fae(),e=tCe();tN={library:"langsmith",runtime:t,sdk:"langsmith-js",sdk_version:hae,...e}}return tN}function JTe(){const t=eCe()||{},e={},i=["LANGCHAIN_API_KEY","LANGCHAIN_ENDPOINT","LANGCHAIN_TRACING_V2","LANGCHAIN_PROJECT","LANGCHAIN_SESSION","LANGSMITH_API_KEY","LANGSMITH_ENDPOINT","LANGSMITH_TRACING_V2","LANGSMITH_PROJECT","LANGSMITH_SESSION"];for(const[r,n]of Object.entries(t))(r.startsWith("LANGCHAIN_")||r.startsWith("LANGSMITH_"))&&typeof n=="string"&&!i.includes(r)&&!r.toLowerCase().includes("key")&&!r.toLowerCase().includes("secret")&&!r.toLowerCase().includes("token")&&(r==="LANGCHAIN_REVISION_ID"?e.revision_id=n:e[r]=n);return e}function eCe(){try{return typeof process<"u"&&Oz?Object.entries(Oz).reduce((t,[e,i])=>(t[e]=String(i),t),{}):void 0}catch{return}}function Zd(t){try{return typeof process<"u"?Oz?.[t]:void 0}catch{return}}function Xl(t){return Zd(`LANGSMITH_${t}`)||Zd(`LANGCHAIN_${t}`)}let iN;function tCe(){if(iN!==void 0)return iN;const t=["VERCEL_GIT_COMMIT_SHA","NEXT_PUBLIC_VERCEL_GIT_COMMIT_SHA","COMMIT_REF","RENDER_GIT_COMMIT","CI_COMMIT_SHA","CIRCLE_SHA1","CF_PAGES_COMMIT_SHA","REACT_APP_GIT_SHA","SOURCE_VERSION","GITHUB_SHA","TRAVIS_COMMIT","GIT_COMMIT","BUILD_VCS_NUMBER","bamboo_planRepository_revision","Build.SourceVersion","BITBUCKET_COMMIT","DRONE_COMMIT_SHA","SEMAPHORE_GIT_SHA","BUILDKITE_COMMIT"],e={};for(const i of t){const r=Zd(i);r!==void 0&&(e[i]=r)}return iN=e,e}function mae(){return Zd("OTEL_ENABLED")==="true"||Xl("OTEL_ENABLED")==="true"}class iCe{constructor(){Object.defineProperty(this,"hasWarned",{enumerable:!0,configurable:!0,writable:!0,value:!1})}startActiveSpan(e,...i){!this.hasWarned&&mae()&&(console.warn('You have enabled OTEL export via the `OTEL_ENABLED` or `LANGSMITH_OTEL_ENABLED` environment variable, but have not initialized the required OTEL instances. Please add:\n```\nimport { initializeOTEL } from "langsmith/experimental/otel/setup";\ninitializeOTEL();\n```\nat the beginning of your code.'),this.hasWarned=!0);let r;if(i.length===1&&typeof i[0]=="function"?r=i[0]:i.length===2&&typeof i[1]=="function"?r=i[1]:i.length===3&&typeof i[2]=="function"&&(r=i[2]),typeof r=="function")return r()}}class rCe{constructor(){Object.defineProperty(this,"mockTracer",{enumerable:!0,configurable:!0,writable:!0,value:new iCe})}getTracer(e,i){return this.mockTracer}getActiveSpan(){}setSpan(e,i){return e}getSpan(e){}setSpanContext(e,i){return e}getTracerProvider(){}setGlobalTracerProvider(e){return!1}}class nCe{active(){return{}}with(e,i){return i()}}const rN=Symbol.for("ls:otel_trace"),nN=Symbol.for("ls:otel_context"),Eq=Symbol.for("ls:otel_get_default_otlp_tracer_provider"),sCe=new rCe,aCe=new nCe;class oCe{getTraceInstance(){return globalThis[rN]??sCe}getContextInstance(){return globalThis[nN]??aCe}initializeGlobalInstances(e){globalThis[rN]===void 0&&(globalThis[rN]=e.trace),globalThis[nN]===void 0&&(globalThis[nN]=e.context)}setDefaultOTLPTracerComponents(e){globalThis[Eq]=e}getDefaultOTLPTracerComponents(){return globalThis[Eq]??void 0}}const E6=new oCe;function gae(){return E6.getTraceInstance()}function lCe(){return E6.getContextInstance()}function cCe(){return E6.getDefaultOTLPTracerComponents()}const uCe={llm:"chat",tool:"execute_tool",retriever:"embeddings",embedding:"embeddings",prompt:"chat"};function hCe(t){return uCe[t]||t}class dCe{constructor(){Object.defineProperty(this,"spans",{enumerable:!0,configurable:!0,writable:!0,value:new Map})}exportBatch(e,i){for(const r of e)try{if(!r.run)continue;if(r.operation==="post"){const n=this.createSpanForRun(r,r.run,i.get(r.id));n&&!r.run.end_time&&this.spans.set(r.id,n)}else this.updateSpanForRun(r,r.run)}catch(n){console.error(`Error processing operation ${r.id}:`,n)}}createSpanForRun(e,i,r){const n=r&&gae().getSpan(r);if(n)try{return this.finishSpanSetup(n,i,e)}catch(s){console.error(`Failed to create span for run ${e.id}:`,s);return}}finishSpanSetup(e,i,r){return this.setSpanAttributes(e,i,r),i.error?(e.setStatus({code:2}),e.recordException(new Error(i.error))):e.setStatus({code:1}),i.end_time&&e.end(new Date(i.end_time)),e}updateSpanForRun(e,i){try{const r=this.spans.get(e.id);if(!r){console.debug(`No span found for run ${e.id} during update`);return}this.setSpanAttributes(r,i,e),i.error?(r.setStatus({code:2}),r.recordException(new Error(i.error))):r.setStatus({code:1});const n=i.end_time;n&&(r.end(new Date(n)),this.spans.delete(e.id))}catch(r){console.error(`Failed to update span for run ${e.id}:`,r)}}extractModelName(e){if(e.extra?.metadata){const i=e.extra.metadata;if(i.ls_model_name)return i.ls_model_name;if(i.invocation_params){const r=i.invocation_params;if(r.model)return r.model;if(r.model_name)return r.model_name}}}setSpanAttributes(e,i,r){if("run_type"in i&&i.run_type){e.setAttribute(jTe,i.run_type);const o=hCe(i.run_type||"chain");e.setAttribute(yTe,o)}"name"in i&&i.name&&e.setAttribute(VTe,i.name),"session_id"in i&&i.session_id&&e.setAttribute(FTe,i.session_id),"session_name"in i&&i.session_name&&e.setAttribute(zTe,i.session_name),this.setGenAiSystem(e,i);const n=this.extractModelName(i);n&&e.setAttribute(xq,n),"prompt_tokens"in i&&typeof i.prompt_tokens=="number"&&e.setAttribute(bq,i.prompt_tokens),"completion_tokens"in i&&typeof i.completion_tokens=="number"&&e.setAttribute(wq,i.completion_tokens),"total_tokens"in i&&typeof i.total_tokens=="number"&&e.setAttribute(_q,i.total_tokens),this.setInvocationParameters(e,i);const s=i.extra?.metadata||{};for(const[o,l]of Object.entries(s))l!=null&&e.setAttribute(`${HTe}.${o}`,String(l));const a=i.tags;if(a&&Array.isArray(a)?e.setAttribute(Sq,a.join(", ")):a&&e.setAttribute(Sq,String(a)),"serialized"in i&&typeof i.serialized=="object"){const o=i.serialized;o.name&&e.setAttribute(ITe,String(o.name)),o.signature&&e.setAttribute(DTe,String(o.signature)),o.doc&&e.setAttribute(OTe,String(o.doc))}this.setIOAttributes(e,r)}setGenAiSystem(e,i){let r="langchain";const n=this.extractModelName(i);if(n){const s=n.toLowerCase();s.includes("anthropic")||s.startsWith("claude")?r="anthropic":s.includes("bedrock")?r="aws.bedrock":s.includes("azure")&&s.includes("openai")?r="az.ai.openai":s.includes("azure")&&s.includes("inference")?r="az.ai.inference":s.includes("cohere")?r="cohere":s.includes("deepseek")?r="deepseek":s.includes("gemini")?r="gemini":s.includes("groq")?r="groq":s.includes("watson")||s.includes("ibm")?r="ibm.watsonx.ai":s.includes("mistral")?r="mistral_ai":s.includes("gpt")||s.includes("openai")?r="openai":s.includes("perplexity")||s.includes("sonar")?r="perplexity":s.includes("vertex")?r="vertex_ai":(s.includes("xai")||s.includes("grok"))&&(r="xai")}e.setAttribute(xTe,r)}setInvocationParameters(e,i){if(!i.extra?.metadata?.invocation_params)return;const r=i.extra.metadata.invocation_params;r.max_tokens!==void 0&&e.setAttribute(wTe,r.max_tokens),r.temperature!==void 0&&e.setAttribute(_Te,r.temperature),r.top_p!==void 0&&e.setAttribute(STe,r.top_p),r.frequency_penalty!==void 0&&e.setAttribute(ETe,r.frequency_penalty),r.presence_penalty!==void 0&&e.setAttribute(ATe,r.presence_penalty)}setIOAttributes(e,i){if(i.run.inputs)try{const r=i.run.inputs;typeof r=="object"&&r!==null&&(r.model&&Array.isArray(r.messages)&&e.setAttribute(xq,r.model),r.stream!==void 0&&e.setAttribute(GTe,r.stream),r.extra_headers&&e.setAttribute(WTe,JSON.stringify(r.extra_headers)),r.extra_query&&e.setAttribute(PTe,JSON.stringify(r.extra_query)),r.extra_body&&e.setAttribute(RTe,JSON.stringify(r.extra_body))),e.setAttribute(TTe,JSON.stringify(r))}catch(r){console.debug(`Failed to process inputs for run ${i.id}`,r)}if(i.run.outputs)try{const r=i.run.outputs,n=this.getUnifiedRunTokens(r);if(n&&(e.setAttribute(bq,n[0]),e.setAttribute(wq,n[1]),e.setAttribute(_q,n[0]+n[1])),r&&typeof r=="object"){if(r.model&&e.setAttribute(bTe,String(r.model)),r.id&&e.setAttribute(LTe,r.id),r.choices&&Array.isArray(r.choices)){const s=r.choices.map(a=>a.finish_reason).filter(a=>a).map(String);s.length>0&&e.setAttribute(MTe,s.join(", "))}if(r.service_tier&&e.setAttribute(kTe,r.service_tier),r.system_fingerprint&&e.setAttribute(NTe,r.system_fingerprint),r.usage_metadata&&typeof r.usage_metadata=="object"){const s=r.usage_metadata;s.input_token_details&&e.setAttribute(UTe,JSON.stringify(s.input_token_details)),s.output_token_details&&e.setAttribute(BTe,JSON.stringify(s.output_token_details))}}e.setAttribute(CTe,JSON.stringify(r))}catch(r){console.debug(`Failed to process outputs for run ${i.id}`,r)}}getUnifiedRunTokens(e){if(!e)return null;let i=this.extractUnifiedRunTokens(e.usage_metadata);if(i)return i;const r=Object.keys(e);for(const a of r){const o=e[a];if(!(!o||typeof o!="object")&&(i=this.extractUnifiedRunTokens(o.usage_metadata),i||o.lc===1&&o.kwargs&&typeof o.kwargs=="object"&&(i=this.extractUnifiedRunTokens(o.kwargs.usage_metadata),i)))return i}const n=e.generations||[];if(!Array.isArray(n))return null;const s=Array.isArray(n[0])?n.flat():n;for(const a of s)if(typeof a=="object"&&a.message&&typeof a.message=="object"&&a.message.kwargs&&typeof a.message.kwargs=="object"&&(i=this.extractUnifiedRunTokens(a.message.kwargs.usage_metadata),i))return i;return null}extractUnifiedRunTokens(e){return!e||typeof e!="object"||typeof e.input_tokens!="number"||typeof e.output_tokens!="number"?null:[e.input_tokens,e.output_tokens]}}var r2={},sN={exports:{}},Aq;function fCe(){return Aq||(Aq=1,(function(t){var e=Object.prototype.hasOwnProperty,i="~";function r(){}Object.create&&(r.prototype=Object.create(null),new r().__proto__||(i=!1));function n(l,c,u){this.fn=l,this.context=c,this.once=u||!1}function s(l,c,u,h,d){if(typeof u!="function")throw new TypeError("The listener must be a function");var f=new n(u,h||l,d),p=i?i+c:c;return l._events[p]?l._events[p].fn?l._events[p]=[l._events[p],f]:l._events[p].push(f):(l._events[p]=f,l._eventsCount++),l}function a(l,c){--l._eventsCount===0?l._events=new r:delete l._events[c]}function o(){this._events=new r,this._eventsCount=0}o.prototype.eventNames=function(){var c=[],u,h;if(this._eventsCount===0)return c;for(h in u=this._events)e.call(u,h)&&c.push(i?h.slice(1):h);return Object.getOwnPropertySymbols?c.concat(Object.getOwnPropertySymbols(u)):c},o.prototype.listeners=function(c){var u=i?i+c:c,h=this._events[u];if(!h)return[];if(h.fn)return[h.fn];for(var d=0,f=h.length,p=new Array(f);d<f;d++)p[d]=h[d].fn;return p},o.prototype.listenerCount=function(c){var u=i?i+c:c,h=this._events[u];return h?h.fn?1:h.length:0},o.prototype.emit=function(c,u,h,d,f,p){var g=i?i+c:c;if(!this._events[g])return!1;var m=this._events[g],y=arguments.length,b,w;if(m.fn){switch(m.once&&this.removeListener(c,m.fn,void 0,!0),y){case 1:return m.fn.call(m.context),!0;case 2:return m.fn.call(m.context,u),!0;case 3:return m.fn.call(m.context,u,h),!0;case 4:return m.fn.call(m.context,u,h,d),!0;case 5:return m.fn.call(m.context,u,h,d,f),!0;case 6:return m.fn.call(m.context,u,h,d,f,p),!0}for(w=1,b=new Array(y-1);w<y;w++)b[w-1]=arguments[w];m.fn.apply(m.context,b)}else{var E=m.length,M;for(w=0;w<E;w++)switch(m[w].once&&this.removeListener(c,m[w].fn,void 0,!0),y){case 1:m[w].fn.call(m[w].context);break;case 2:m[w].fn.call(m[w].context,u);break;case 3:m[w].fn.call(m[w].context,u,h);break;case 4:m[w].fn.call(m[w].context,u,h,d);break;default:if(!b)for(M=1,b=new Array(y-1);M<y;M++)b[M-1]=arguments[M];m[w].fn.apply(m[w].context,b)}}return!0},o.prototype.on=function(c,u,h){return s(this,c,u,h,!1)},o.prototype.once=function(c,u,h){return s(this,c,u,h,!0)},o.prototype.removeListener=function(c,u,h,d){var f=i?i+c:c;if(!this._events[f])return this;if(!u)return a(this,f),this;var p=this._events[f];if(p.fn)p.fn===u&&(!d||p.once)&&(!h||p.context===h)&&a(this,f);else{for(var g=0,m=[],y=p.length;g<y;g++)(p[g].fn!==u||d&&!p[g].once||h&&p[g].context!==h)&&m.push(p[g]);m.length?this._events[f]=m.length===1?m[0]:m:a(this,f)}return this},o.prototype.removeAllListeners=function(c){var u;return c?(u=i?i+c:c,this._events[u]&&a(this,u)):(this._events=new r,this._eventsCount=0),this},o.prototype.off=o.prototype.removeListener,o.prototype.addListener=o.prototype.on,o.prefixed=i,o.EventEmitter=o,t.exports=o})(sN)),sN.exports}var zS={exports:{}},aN,Mq;function pCe(){return Mq||(Mq=1,aN=(t,e)=>(e=e||(()=>{}),t.then(i=>new Promise(r=>{r(e())}).then(()=>i),i=>new Promise(r=>{r(e())}).then(()=>{throw i})))),aN}var Tq;function mCe(){if(Tq)return zS.exports;Tq=1;const t=pCe();class e extends Error{constructor(n){super(n),this.name="TimeoutError"}}const i=(r,n,s)=>new Promise((a,o)=>{if(typeof n!="number"||n<0)throw new TypeError("Expected `milliseconds` to be a positive number");if(n===1/0){a(r);return}const l=setTimeout(()=>{if(typeof s=="function"){try{a(s())}catch(h){o(h)}return}const c=typeof s=="string"?s:`Promise timed out after ${n} milliseconds`,u=s instanceof Error?s:new e(c);typeof r.cancel=="function"&&r.cancel(),o(u)},n);t(r.then(a,o),()=>{clearTimeout(l)})});return zS.exports=i,zS.exports.default=i,zS.exports.TimeoutError=e,zS.exports}var n2={},s2={},Cq;function gCe(){if(Cq)return s2;Cq=1,Object.defineProperty(s2,"__esModule",{value:!0});function t(e,i,r){let n=0,s=e.length;for(;s>0;){const a=s/2|0;let o=n+a;r(e[o],i)<=0?(n=++o,s-=a+1):s=a}return n}return s2.default=t,s2}var Pq;function vCe(){if(Pq)return n2;Pq=1,Object.defineProperty(n2,"__esModule",{value:!0});const t=gCe();class e{constructor(){this._queue=[]}enqueue(r,n){n=Object.assign({priority:0},n);const s={priority:n.priority,run:r};if(this.size&&this._queue[this.size-1].priority>=n.priority){this._queue.push(s);return}const a=t.default(this._queue,s,(o,l)=>l.priority-o.priority);this._queue.splice(a,0,s)}dequeue(){const r=this._queue.shift();return r?.run}filter(r){return this._queue.filter(n=>n.priority===r.priority).map(n=>n.run)}get size(){return this._queue.length}}return n2.default=e,n2}var Rq;function yCe(){if(Rq)return r2;Rq=1,Object.defineProperty(r2,"__esModule",{value:!0});const t=fCe(),e=mCe(),i=vCe(),r=()=>{},n=new e.TimeoutError;class s extends t{constructor(o){var l,c,u,h;if(super(),this._intervalCount=0,this._intervalEnd=0,this._pendingCount=0,this._resolveEmpty=r,this._resolveIdle=r,o=Object.assign({carryoverConcurrencyCount:!1,intervalCap:1/0,interval:0,concurrency:1/0,autoStart:!0,queueClass:i.default},o),!(typeof o.intervalCap=="number"&&o.intervalCap>=1))throw new TypeError(`Expected \`intervalCap\` to be a number from 1 and up, got \`${(c=(l=o.intervalCap)===null||l===void 0?void 0:l.toString())!==null&&c!==void 0?c:""}\` (${typeof o.intervalCap})`);if(o.interval===void 0||!(Number.isFinite(o.interval)&&o.interval>=0))throw new TypeError(`Expected \`interval\` to be a finite number >= 0, got \`${(h=(u=o.interval)===null||u===void 0?void 0:u.toString())!==null&&h!==void 0?h:""}\` (${typeof o.interval})`);this._carryoverConcurrencyCount=o.carryoverConcurrencyCount,this._isIntervalIgnored=o.intervalCap===1/0||o.interval===0,this._intervalCap=o.intervalCap,this._interval=o.interval,this._queue=new o.queueClass,this._queueClass=o.queueClass,this.concurrency=o.concurrency,this._timeout=o.timeout,this._throwOnTimeout=o.throwOnTimeout===!0,this._isPaused=o.autoStart===!1}get _doesIntervalAllowAnother(){return this._isIntervalIgnored||this._intervalCount<this._intervalCap}get _doesConcurrentAllowAnother(){return this._pendingCount<this._concurrency}_next(){this._pendingCount--,this._tryToStartAnother(),this.emit("next")}_resolvePromises(){this._resolveEmpty(),this._resolveEmpty=r,this._pendingCount===0&&(this._resolveIdle(),this._resolveIdle=r,this.emit("idle"))}_onResumeInterval(){this._onInterval(),this._initializeIntervalIfNeeded(),this._timeoutId=void 0}_isIntervalPaused(){const o=Date.now();if(this._intervalId===void 0){const l=this._intervalEnd-o;if(l<0)this._intervalCount=this._carryoverConcurrencyCount?this._pendingCount:0;else return this._timeoutId===void 0&&(this._timeoutId=setTimeout(()=>{this._onResumeInterval()},l)),!0}return!1}_tryToStartAnother(){if(this._queue.size===0)return this._intervalId&&clearInterval(this._intervalId),this._intervalId=void 0,this._resolvePromises(),!1;if(!this._isPaused){const o=!this._isIntervalPaused();if(this._doesIntervalAllowAnother&&this._doesConcurrentAllowAnother){const l=this._queue.dequeue();return l?(this.emit("active"),l(),o&&this._initializeIntervalIfNeeded(),!0):!1}}return!1}_initializeIntervalIfNeeded(){this._isIntervalIgnored||this._intervalId!==void 0||(this._intervalId=setInterval(()=>{this._onInterval()},this._interval),this._intervalEnd=Date.now()+this._interval)}_onInterval(){this._intervalCount===0&&this._pendingCount===0&&this._intervalId&&(clearInterval(this._intervalId),this._intervalId=void 0),this._intervalCount=this._carryoverConcurrencyCount?this._pendingCount:0,this._processQueue()}_processQueue(){for(;this._tryToStartAnother(););}get concurrency(){return this._concurrency}set concurrency(o){if(!(typeof o=="number"&&o>=1))throw new TypeError(`Expected \`concurrency\` to be a number from 1 and up, got \`${o}\` (${typeof o})`);this._concurrency=o,this._processQueue()}async add(o,l={}){return new Promise((c,u)=>{const h=async()=>{this._pendingCount++,this._intervalCount++;try{const d=this._timeout===void 0&&l.timeout===void 0?o():e.default(Promise.resolve(o()),l.timeout===void 0?this._timeout:l.timeout,()=>{(l.throwOnTimeout===void 0?this._throwOnTimeout:l.throwOnTimeout)&&u(n)});c(await d)}catch(d){u(d)}this._next()};this._queue.enqueue(h,l),this._tryToStartAnother(),this.emit("add")})}async addAll(o,l){return Promise.all(o.map(async c=>this.add(c,l)))}start(){return this._isPaused?(this._isPaused=!1,this._processQueue(),this):this}pause(){this._isPaused=!0}clear(){this._queue=new this._queueClass}async onEmpty(){if(this._queue.size!==0)return new Promise(o=>{const l=this._resolveEmpty;this._resolveEmpty=()=>{l(),o()}})}async onIdle(){if(!(this._pendingCount===0&&this._queue.size===0))return new Promise(o=>{const l=this._resolveIdle;this._resolveIdle=()=>{l(),o()}})}get size(){return this._queue.size}sizeBy(o){return this._queue.filter(o).length}get pending(){return this._pendingCount}get isPaused(){return this._isPaused}get timeout(){return this._timeout}set timeout(o){this._timeout=o}}return r2.default=s,r2}var xCe=yCe();const Rp=Lh(xCe),bCe=[429,500,502,503,504];let Iq=class{constructor(e){Object.defineProperty(this,"maxConcurrency",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"maxRetries",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"queue",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"onFailedResponseHook",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.maxConcurrency=e.maxConcurrency??1/0,this.maxRetries=e.maxRetries??6,"default"in Rp?this.queue=new Rp.default({concurrency:this.maxConcurrency}):this.queue=new Rp({concurrency:this.maxConcurrency}),this.onFailedResponseHook=e?.onFailedResponseHook}call(e,...i){const r=this.onFailedResponseHook;return this.queue.add(()=>II(()=>e(...i).catch(n=>{throw n instanceof Error?n:new Error(n)}),{async onFailedAttempt(n){if(n.message.startsWith("Cancel")||n.message.startsWith("TimeoutError")||n.name==="TimeoutError"||n.message.startsWith("AbortError")||n?.code==="ECONNABORTED")throw n;const s=n?.response;if(r&&await r(s))return;const a=s?.status??n?.status;if(a&&!bCe.includes(+a))throw n},retries:this.maxRetries,randomize:!0}),{throwOnTimeout:!0})}callWithOptions(e,i,...r){return e.signal?Promise.race([this.call(i,...r),new Promise((n,s)=>{e.signal?.addEventListener("abort",()=>{s(new Error("AbortError"))})})]):this.call(i,...r)}};function Dq(t){return typeof t?._getType=="function"}function Oq(t){const e={type:t._getType(),data:{content:t.content}};return t?.additional_kwargs&&Object.keys(t.additional_kwargs).length>0&&(e.data.additional_kwargs={...t.additional_kwargs}),e}const wCe=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i;function ar(t,e){if(!wCe.test(t)){const i=e!==void 0?`Invalid UUID for ${e}: ${t}`:`Invalid UUID: ${t}`;throw new Error(i)}return t}const Lq={};function vae(t){Lq[t]||(console.warn(t),Lq[t]=!0)}var a2={exports:{}},oN,kq;function rO(){if(kq)return oN;kq=1;const t="2.0.0",e=256,i=Number.MAX_SAFE_INTEGER||9007199254740991,r=16,n=e-6;return oN={MAX_LENGTH:e,MAX_SAFE_COMPONENT_LENGTH:r,MAX_SAFE_BUILD_LENGTH:n,MAX_SAFE_INTEGER:i,RELEASE_TYPES:["major","premajor","minor","preminor","patch","prepatch","prerelease"],SEMVER_SPEC_VERSION:t,FLAG_INCLUDE_PRERELEASE:1,FLAG_LOOSE:2},oN}var lN,Nq;function nO(){if(Nq)return lN;Nq=1;var t={};return lN=typeof process=="object"&&t&&t.NODE_DEBUG&&/\bsemver\b/i.test(t.NODE_DEBUG)?(...i)=>console.error("SEMVER",...i):()=>{},lN}var Uq;function uT(){return Uq||(Uq=1,(function(t,e){const{MAX_SAFE_COMPONENT_LENGTH:i,MAX_SAFE_BUILD_LENGTH:r,MAX_LENGTH:n}=rO(),s=nO();e=t.exports={};const a=e.re=[],o=e.safeRe=[],l=e.src=[],c=e.safeSrc=[],u=e.t={};let h=0;const d="[a-zA-Z0-9-]",f=[["\\s",1],["\\d",n],[d,r]],p=m=>{for(const[y,b]of f)m=m.split(`${y}*`).join(`${y}{0,${b}}`).split(`${y}+`).join(`${y}{1,${b}}`);return m},g=(m,y,b)=>{const w=p(y),E=h++;s(m,E,y),u[m]=E,l[E]=y,c[E]=w,a[E]=new RegExp(y,b?"g":void 0),o[E]=new RegExp(w,b?"g":void 0)};g("NUMERICIDENTIFIER","0|[1-9]\\d*"),g("NUMERICIDENTIFIERLOOSE","\\d+"),g("NONNUMERICIDENTIFIER",`\\d*[a-zA-Z-]${d}*`),g("MAINVERSION",`(${l[u.NUMERICIDENTIFIER]})\\.(${l[u.NUMERICIDENTIFIER]})\\.(${l[u.NUMERICIDENTIFIER]})`),g("MAINVERSIONLOOSE",`(${l[u.NUMERICIDENTIFIERLOOSE]})\\.(${l[u.NUMERICIDENTIFIERLOOSE]})\\.(${l[u.NUMERICIDENTIFIERLOOSE]})`),g("PRERELEASEIDENTIFIER",`(?:${l[u.NONNUMERICIDENTIFIER]}|${l[u.NUMERICIDENTIFIER]})`),g("PRERELEASEIDENTIFIERLOOSE",`(?:${l[u.NONNUMERICIDENTIFIER]}|${l[u.NUMERICIDENTIFIERLOOSE]})`),g("PRERELEASE",`(?:-(${l[u.PRERELEASEIDENTIFIER]}(?:\\.${l[u.PRERELEASEIDENTIFIER]})*))`),g("PRERELEASELOOSE",`(?:-?(${l[u.PRERELEASEIDENTIFIERLOOSE]}(?:\\.${l[u.PRERELEASEIDENTIFIERLOOSE]})*))`),g("BUILDIDENTIFIER",`${d}+`),g("BUILD",`(?:\\+(${l[u.BUILDIDENTIFIER]}(?:\\.${l[u.BUILDIDENTIFIER]})*))`),g("FULLPLAIN",`v?${l[u.MAINVERSION]}${l[u.PRERELEASE]}?${l[u.BUILD]}?`),g("FULL",`^${l[u.FULLPLAIN]}$`),g("LOOSEPLAIN",`[v=\\s]*${l[u.MAINVERSIONLOOSE]}${l[u.PRERELEASELOOSE]}?${l[u.BUILD]}?`),g("LOOSE",`^${l[u.LOOSEPLAIN]}$`),g("GTLT","((?:<|>)?=?)"),g("XRANGEIDENTIFIERLOOSE",`${l[u.NUMERICIDENTIFIERLOOSE]}|x|X|\\*`),g("XRANGEIDENTIFIER",`${l[u.NUMERICIDENTIFIER]}|x|X|\\*`),g("XRANGEPLAIN",`[v=\\s]*(${l[u.XRANGEIDENTIFIER]})(?:\\.(${l[u.XRANGEIDENTIFIER]})(?:\\.(${l[u.XRANGEIDENTIFIER]})(?:${l[u.PRERELEASE]})?${l[u.BUILD]}?)?)?`),g("XRANGEPLAINLOOSE",`[v=\\s]*(${l[u.XRANGEIDENTIFIERLOOSE]})(?:\\.(${l[u.XRANGEIDENTIFIERLOOSE]})(?:\\.(${l[u.XRANGEIDENTIFIERLOOSE]})(?:${l[u.PRERELEASELOOSE]})?${l[u.BUILD]}?)?)?`),g("XRANGE",`^${l[u.GTLT]}\\s*${l[u.XRANGEPLAIN]}$`),g("XRANGELOOSE",`^${l[u.GTLT]}\\s*${l[u.XRANGEPLAINLOOSE]}$`),g("COERCEPLAIN",`(^|[^\\d])(\\d{1,${i}})(?:\\.(\\d{1,${i}}))?(?:\\.(\\d{1,${i}}))?`),g("COERCE",`${l[u.COERCEPLAIN]}(?:$|[^\\d])`),g("COERCEFULL",l[u.COERCEPLAIN]+`(?:${l[u.PRERELEASE]})?(?:${l[u.BUILD]})?(?:$|[^\\d])`),g("COERCERTL",l[u.COERCE],!0),g("COERCERTLFULL",l[u.COERCEFULL],!0),g("LONETILDE","(?:~>?)"),g("TILDETRIM",`(\\s*)${l[u.LONETILDE]}\\s+`,!0),e.tildeTrimReplace="$1~",g("TILDE",`^${l[u.LONETILDE]}${l[u.XRANGEPLAIN]}$`),g("TILDELOOSE",`^${l[u.LONETILDE]}${l[u.XRANGEPLAINLOOSE]}$`),g("LONECARET","(?:\\^)"),g("CARETTRIM",`(\\s*)${l[u.LONECARET]}\\s+`,!0),e.caretTrimReplace="$1^",g("CARET",`^${l[u.LONECARET]}${l[u.XRANGEPLAIN]}$`),g("CARETLOOSE",`^${l[u.LONECARET]}${l[u.XRANGEPLAINLOOSE]}$`),g("COMPARATORLOOSE",`^${l[u.GTLT]}\\s*(${l[u.LOOSEPLAIN]})$|^$`),g("COMPARATOR",`^${l[u.GTLT]}\\s*(${l[u.FULLPLAIN]})$|^$`),g("COMPARATORTRIM",`(\\s*)${l[u.GTLT]}\\s*(${l[u.LOOSEPLAIN]}|${l[u.XRANGEPLAIN]})`,!0),e.comparatorTrimReplace="$1$2$3",g("HYPHENRANGE",`^\\s*(${l[u.XRANGEPLAIN]})\\s+-\\s+(${l[u.XRANGEPLAIN]})\\s*$`),g("HYPHENRANGELOOSE",`^\\s*(${l[u.XRANGEPLAINLOOSE]})\\s+-\\s+(${l[u.XRANGEPLAINLOOSE]})\\s*$`),g("STAR","(<|>)?=?\\s*\\*"),g("GTE0","^\\s*>=\\s*0\\.0\\.0\\s*$"),g("GTE0PRE","^\\s*>=\\s*0\\.0\\.0-0\\s*$")})(a2,a2.exports)),a2.exports}var cN,Bq;function A6(){if(Bq)return cN;Bq=1;const t=Object.freeze({loose:!0}),e=Object.freeze({});return cN=r=>r?typeof r!="object"?t:r:e,cN}var uN,Fq;function yae(){if(Fq)return uN;Fq=1;const t=/^[0-9]+$/,e=(r,n)=>{const s=t.test(r),a=t.test(n);return s&&a&&(r=+r,n=+n),r===n?0:s&&!a?-1:a&&!s?1:r<n?-1:1};return uN={compareIdentifiers:e,rcompareIdentifiers:(r,n)=>e(n,r)},uN}var hN,zq;function _l(){if(zq)return hN;zq=1;const t=nO(),{MAX_LENGTH:e,MAX_SAFE_INTEGER:i}=rO(),{safeRe:r,t:n}=uT(),s=A6(),{compareIdentifiers:a}=yae();class o{constructor(c,u){if(u=s(u),c instanceof o){if(c.loose===!!u.loose&&c.includePrerelease===!!u.includePrerelease)return c;c=c.version}else if(typeof c!="string")throw new TypeError(`Invalid version. Must be a string. Got type "${typeof c}".`);if(c.length>e)throw new TypeError(`version is longer than ${e} characters`);t("SemVer",c,u),this.options=u,this.loose=!!u.loose,this.includePrerelease=!!u.includePrerelease;const h=c.trim().match(u.loose?r[n.LOOSE]:r[n.FULL]);if(!h)throw new TypeError(`Invalid Version: ${c}`);if(this.raw=c,this.major=+h[1],this.minor=+h[2],this.patch=+h[3],this.major>i||this.major<0)throw new TypeError("Invalid major version");if(this.minor>i||this.minor<0)throw new TypeError("Invalid minor version");if(this.patch>i||this.patch<0)throw new TypeError("Invalid patch version");h[4]?this.prerelease=h[4].split(".").map(d=>{if(/^[0-9]+$/.test(d)){const f=+d;if(f>=0&&f<i)return f}return d}):this.prerelease=[],this.build=h[5]?h[5].split("."):[],this.format()}format(){return this.version=`${this.major}.${this.minor}.${this.patch}`,this.prerelease.length&&(this.version+=`-${this.prerelease.join(".")}`),this.version}toString(){return this.version}compare(c){if(t("SemVer.compare",this.version,this.options,c),!(c instanceof o)){if(typeof c=="string"&&c===this.version)return 0;c=new o(c,this.options)}return c.version===this.version?0:this.compareMain(c)||this.comparePre(c)}compareMain(c){return c instanceof o||(c=new o(c,this.options)),a(this.major,c.major)||a(this.minor,c.minor)||a(this.patch,c.patch)}comparePre(c){if(c instanceof o||(c=new o(c,this.options)),this.prerelease.length&&!c.prerelease.length)return-1;if(!this.prerelease.length&&c.prerelease.length)return 1;if(!this.prerelease.length&&!c.prerelease.length)return 0;let u=0;do{const h=this.prerelease[u],d=c.prerelease[u];if(t("prerelease compare",u,h,d),h===void 0&&d===void 0)return 0;if(d===void 0)return 1;if(h===void 0)return-1;if(h===d)continue;return a(h,d)}while(++u)}compareBuild(c){c instanceof o||(c=new o(c,this.options));let u=0;do{const h=this.build[u],d=c.build[u];if(t("build compare",u,h,d),h===void 0&&d===void 0)return 0;if(d===void 0)return 1;if(h===void 0)return-1;if(h===d)continue;return a(h,d)}while(++u)}inc(c,u,h){if(c.startsWith("pre")){if(!u&&h===!1)throw new Error("invalid increment argument: identifier is empty");if(u){const d=`-${u}`.match(this.options.loose?r[n.PRERELEASELOOSE]:r[n.PRERELEASE]);if(!d||d[1]!==u)throw new Error(`invalid identifier: ${u}`)}}switch(c){case"premajor":this.prerelease.length=0,this.patch=0,this.minor=0,this.major++,this.inc("pre",u,h);break;case"preminor":this.prerelease.length=0,this.patch=0,this.minor++,this.inc("pre",u,h);break;case"prepatch":this.prerelease.length=0,this.inc("patch",u,h),this.inc("pre",u,h);break;case"prerelease":this.prerelease.length===0&&this.inc("patch",u,h),this.inc("pre",u,h);break;case"release":if(this.prerelease.length===0)throw new Error(`version ${this.raw} is not a prerelease`);this.prerelease.length=0;break;case"major":(this.minor!==0||this.patch!==0||this.prerelease.length===0)&&this.major++,this.minor=0,this.patch=0,this.prerelease=[];break;case"minor":(this.patch!==0||this.prerelease.length===0)&&this.minor++,this.patch=0,this.prerelease=[];break;case"patch":this.prerelease.length===0&&this.patch++,this.prerelease=[];break;case"pre":{const d=Number(h)?1:0;if(this.prerelease.length===0)this.prerelease=[d];else{let f=this.prerelease.length;for(;--f>=0;)typeof this.prerelease[f]=="number"&&(this.prerelease[f]++,f=-2);if(f===-1){if(u===this.prerelease.join(".")&&h===!1)throw new Error("invalid increment argument: identifier already exists");this.prerelease.push(d)}}if(u){let f=[u,d];h===!1&&(f=[u]),a(this.prerelease[0],u)===0?isNaN(this.prerelease[1])&&(this.prerelease=f):this.prerelease=f}break}default:throw new Error(`invalid increment argument: ${c}`)}return this.raw=this.format(),this.build.length&&(this.raw+=`+${this.build.join(".")}`),this}}return hN=o,hN}var dN,jq;function h_(){if(jq)return dN;jq=1;const t=_l();return dN=(i,r,n=!1)=>{if(i instanceof t)return i;try{return new t(i,r)}catch(s){if(!n)return null;throw s}},dN}var fN,Vq;function _Ce(){if(Vq)return fN;Vq=1;const t=h_();return fN=(i,r)=>{const n=t(i,r);return n?n.version:null},fN}var pN,Hq;function SCe(){if(Hq)return pN;Hq=1;const t=h_();return pN=(i,r)=>{const n=t(i.trim().replace(/^[=v]+/,""),r);return n?n.version:null},pN}var mN,Gq;function ECe(){if(Gq)return mN;Gq=1;const t=_l();return mN=(i,r,n,s,a)=>{typeof n=="string"&&(a=s,s=n,n=void 0);try{return new t(i instanceof t?i.version:i,n).inc(r,s,a).version}catch{return null}},mN}var gN,Wq;function ACe(){if(Wq)return gN;Wq=1;const t=h_();return gN=(i,r)=>{const n=t(i,null,!0),s=t(r,null,!0),a=n.compare(s);if(a===0)return null;const o=a>0,l=o?n:s,c=o?s:n,u=!!l.prerelease.length;if(!!c.prerelease.length&&!u){if(!c.patch&&!c.minor)return"major";if(c.compareMain(l)===0)return c.minor&&!c.patch?"minor":"patch"}const d=u?"pre":"";return n.major!==s.major?d+"major":n.minor!==s.minor?d+"minor":n.patch!==s.patch?d+"patch":"prerelease"},gN}var vN,qq;function MCe(){if(qq)return vN;qq=1;const t=_l();return vN=(i,r)=>new t(i,r).major,vN}var yN,Xq;function TCe(){if(Xq)return yN;Xq=1;const t=_l();return yN=(i,r)=>new t(i,r).minor,yN}var xN,$q;function CCe(){if($q)return xN;$q=1;const t=_l();return xN=(i,r)=>new t(i,r).patch,xN}var bN,Yq;function PCe(){if(Yq)return bN;Yq=1;const t=h_();return bN=(i,r)=>{const n=t(i,r);return n&&n.prerelease.length?n.prerelease:null},bN}var wN,Kq;function kh(){if(Kq)return wN;Kq=1;const t=_l();return wN=(i,r,n)=>new t(i,n).compare(new t(r,n)),wN}var _N,Zq;function RCe(){if(Zq)return _N;Zq=1;const t=kh();return _N=(i,r,n)=>t(r,i,n),_N}var SN,Qq;function ICe(){if(Qq)return SN;Qq=1;const t=kh();return SN=(i,r)=>t(i,r,!0),SN}var EN,Jq;function M6(){if(Jq)return EN;Jq=1;const t=_l();return EN=(i,r,n)=>{const s=new t(i,n),a=new t(r,n);return s.compare(a)||s.compareBuild(a)},EN}var AN,eX;function DCe(){if(eX)return AN;eX=1;const t=M6();return AN=(i,r)=>i.sort((n,s)=>t(n,s,r)),AN}var MN,tX;function OCe(){if(tX)return MN;tX=1;const t=M6();return MN=(i,r)=>i.sort((n,s)=>t(s,n,r)),MN}var TN,iX;function sO(){if(iX)return TN;iX=1;const t=kh();return TN=(i,r,n)=>t(i,r,n)>0,TN}var CN,rX;function T6(){if(rX)return CN;rX=1;const t=kh();return CN=(i,r,n)=>t(i,r,n)<0,CN}var PN,nX;function xae(){if(nX)return PN;nX=1;const t=kh();return PN=(i,r,n)=>t(i,r,n)===0,PN}var RN,sX;function bae(){if(sX)return RN;sX=1;const t=kh();return RN=(i,r,n)=>t(i,r,n)!==0,RN}var IN,aX;function C6(){if(aX)return IN;aX=1;const t=kh();return IN=(i,r,n)=>t(i,r,n)>=0,IN}var DN,oX;function P6(){if(oX)return DN;oX=1;const t=kh();return DN=(i,r,n)=>t(i,r,n)<=0,DN}var ON,lX;function wae(){if(lX)return ON;lX=1;const t=xae(),e=bae(),i=sO(),r=C6(),n=T6(),s=P6();return ON=(o,l,c,u)=>{switch(l){case"===":return typeof o=="object"&&(o=o.version),typeof c=="object"&&(c=c.version),o===c;case"!==":return typeof o=="object"&&(o=o.version),typeof c=="object"&&(c=c.version),o!==c;case"":case"=":case"==":return t(o,c,u);case"!=":return e(o,c,u);case">":return i(o,c,u);case">=":return r(o,c,u);case"<":return n(o,c,u);case"<=":return s(o,c,u);default:throw new TypeError(`Invalid operator: ${l}`)}},ON}var LN,cX;function LCe(){if(cX)return LN;cX=1;const t=_l(),e=h_(),{safeRe:i,t:r}=uT();return LN=(s,a)=>{if(s instanceof t)return s;if(typeof s=="number"&&(s=String(s)),typeof s!="string")return null;a=a||{};let o=null;if(!a.rtl)o=s.match(a.includePrerelease?i[r.COERCEFULL]:i[r.COERCE]);else{const f=a.includePrerelease?i[r.COERCERTLFULL]:i[r.COERCERTL];let p;for(;(p=f.exec(s))&&(!o||o.index+o[0].length!==s.length);)(!o||p.index+p[0].length!==o.index+o[0].length)&&(o=p),f.lastIndex=p.index+p[1].length+p[2].length;f.lastIndex=-1}if(o===null)return null;const l=o[2],c=o[3]||"0",u=o[4]||"0",h=a.includePrerelease&&o[5]?`-${o[5]}`:"",d=a.includePrerelease&&o[6]?`+${o[6]}`:"";return e(`${l}.${c}.${u}${h}${d}`,a)},LN}var kN,uX;function kCe(){if(uX)return kN;uX=1;class t{constructor(){this.max=1e3,this.map=new Map}get(i){const r=this.map.get(i);if(r!==void 0)return this.map.delete(i),this.map.set(i,r),r}delete(i){return this.map.delete(i)}set(i,r){if(!this.delete(i)&&r!==void 0){if(this.map.size>=this.max){const s=this.map.keys().next().value;this.delete(s)}this.map.set(i,r)}return this}}return kN=t,kN}var NN,hX;function Nh(){if(hX)return NN;hX=1;const t=/\s+/g;class e{constructor($,K){if(K=n(K),$ instanceof e)return $.loose===!!K.loose&&$.includePrerelease===!!K.includePrerelease?$:new e($.raw,K);if($ instanceof s)return this.raw=$.value,this.set=[[$]],this.formatted=void 0,this;if(this.options=K,this.loose=!!K.loose,this.includePrerelease=!!K.includePrerelease,this.raw=$.trim().replace(t," "),this.set=this.raw.split("||").map(X=>this.parseRange(X.trim())).filter(X=>X.length),!this.set.length)throw new TypeError(`Invalid SemVer Range: ${this.raw}`);if(this.set.length>1){const X=this.set[0];if(this.set=this.set.filter(U=>!g(U[0])),this.set.length===0)this.set=[X];else if(this.set.length>1){for(const U of this.set)if(U.length===1&&m(U[0])){this.set=[U];break}}}this.formatted=void 0}get range(){if(this.formatted===void 0){this.formatted="";for(let $=0;$<this.set.length;$++){$>0&&(this.formatted+="||");const K=this.set[$];for(let X=0;X<K.length;X++)X>0&&(this.formatted+=" "),this.formatted+=K[X].toString().trim()}}return this.formatted}format(){return this.range}toString(){return this.range}parseRange($){const X=((this.options.includePrerelease&&f)|(this.options.loose&&p))+":"+$,U=r.get(X);if(U)return U;const Y=this.options.loose,Z=Y?l[c.HYPHENRANGELOOSE]:l[c.HYPHENRANGE];$=$.replace(Z,z(this.options.includePrerelease)),a("hyphen replace",$),$=$.replace(l[c.COMPARATORTRIM],u),a("comparator trim",$),$=$.replace(l[c.TILDETRIM],h),a("tilde trim",$),$=$.replace(l[c.CARETTRIM],d),a("caret trim",$);let j=$.split(" ").map(se=>b(se,this.options)).join(" ").split(/\s+/).map(se=>k(se,this.options));Y&&(j=j.filter(se=>(a("loose invalid filter",se,this.options),!!se.match(l[c.COMPARATORLOOSE])))),a("range list",j);const ee=new Map,pe=j.map(se=>new s(se,this.options));for(const se of pe){if(g(se))return[se];ee.set(se.value,se)}ee.size>1&&ee.has("")&&ee.delete("");const fe=[...ee.values()];return r.set(X,fe),fe}intersects($,K){if(!($ instanceof e))throw new TypeError("a Range is required");return this.set.some(X=>y(X,K)&&$.set.some(U=>y(U,K)&&X.every(Y=>U.every(Z=>Y.intersects(Z,K)))))}test($){if(!$)return!1;if(typeof $=="string")try{$=new o($,this.options)}catch{return!1}for(let K=0;K<this.set.length;K++)if(V(this.set[K],$,this.options))return!0;return!1}}NN=e;const i=kCe(),r=new i,n=A6(),s=aO(),a=nO(),o=_l(),{safeRe:l,t:c,comparatorTrimReplace:u,tildeTrimReplace:h,caretTrimReplace:d}=uT(),{FLAG_INCLUDE_PRERELEASE:f,FLAG_LOOSE:p}=rO(),g=F=>F.value==="<0.0.0-0",m=F=>F.value==="",y=(F,$)=>{let K=!0;const X=F.slice();let U=X.pop();for(;K&&X.length;)K=X.every(Y=>U.intersects(Y,$)),U=X.pop();return K},b=(F,$)=>(a("comp",F,$),F=A(F,$),a("caret",F),F=E(F,$),a("tildes",F),F=C(F,$),a("xrange",F),F=I(F,$),a("stars",F),F),w=F=>!F||F.toLowerCase()==="x"||F==="*",E=(F,$)=>F.trim().split(/\s+/).map(K=>M(K,$)).join(" "),M=(F,$)=>{const K=$.loose?l[c.TILDELOOSE]:l[c.TILDE];return F.replace(K,(X,U,Y,Z,j)=>{a("tilde",F,X,U,Y,Z,j);let ee;return w(U)?ee="":w(Y)?ee=`>=${U}.0.0 <${+U+1}.0.0-0`:w(Z)?ee=`>=${U}.${Y}.0 <${U}.${+Y+1}.0-0`:j?(a("replaceTilde pr",j),ee=`>=${U}.${Y}.${Z}-${j} <${U}.${+Y+1}.0-0`):ee=`>=${U}.${Y}.${Z} <${U}.${+Y+1}.0-0`,a("tilde return",ee),ee})},A=(F,$)=>F.trim().split(/\s+/).map(K=>P(K,$)).join(" "),P=(F,$)=>{a("caret",F,$);const K=$.loose?l[c.CARETLOOSE]:l[c.CARET],X=$.includePrerelease?"-0":"";return F.replace(K,(U,Y,Z,j,ee)=>{a("caret",F,U,Y,Z,j,ee);let pe;return w(Y)?pe="":w(Z)?pe=`>=${Y}.0.0${X} <${+Y+1}.0.0-0`:w(j)?Y==="0"?pe=`>=${Y}.${Z}.0${X} <${Y}.${+Z+1}.0-0`:pe=`>=${Y}.${Z}.0${X} <${+Y+1}.0.0-0`:ee?(a("replaceCaret pr",ee),Y==="0"?Z==="0"?pe=`>=${Y}.${Z}.${j}-${ee} <${Y}.${Z}.${+j+1}-0`:pe=`>=${Y}.${Z}.${j}-${ee} <${Y}.${+Z+1}.0-0`:pe=`>=${Y}.${Z}.${j}-${ee} <${+Y+1}.0.0-0`):(a("no pr"),Y==="0"?Z==="0"?pe=`>=${Y}.${Z}.${j}${X} <${Y}.${Z}.${+j+1}-0`:pe=`>=${Y}.${Z}.${j}${X} <${Y}.${+Z+1}.0-0`:pe=`>=${Y}.${Z}.${j} <${+Y+1}.0.0-0`),a("caret return",pe),pe})},C=(F,$)=>(a("replaceXRanges",F,$),F.split(/\s+/).map(K=>R(K,$)).join(" ")),R=(F,$)=>{F=F.trim();const K=$.loose?l[c.XRANGELOOSE]:l[c.XRANGE];return F.replace(K,(X,U,Y,Z,j,ee)=>{a("xRange",F,X,U,Y,Z,j,ee);const pe=w(Y),fe=pe||w(Z),se=fe||w(j),re=se;return U==="="&&re&&(U=""),ee=$.includePrerelease?"-0":"",pe?U===">"||U==="<"?X="<0.0.0-0":X="*":U&&re?(fe&&(Z=0),j=0,U===">"?(U=">=",fe?(Y=+Y+1,Z=0,j=0):(Z=+Z+1,j=0)):U==="<="&&(U="<",fe?Y=+Y+1:Z=+Z+1),U==="<"&&(ee="-0"),X=`${U+Y}.${Z}.${j}${ee}`):fe?X=`>=${Y}.0.0${ee} <${+Y+1}.0.0-0`:se&&(X=`>=${Y}.${Z}.0${ee} <${Y}.${+Z+1}.0-0`),a("xRange return",X),X})},I=(F,$)=>(a("replaceStars",F,$),F.trim().replace(l[c.STAR],"")),k=(F,$)=>(a("replaceGTE0",F,$),F.trim().replace(l[$.includePrerelease?c.GTE0PRE:c.GTE0],"")),z=F=>($,K,X,U,Y,Z,j,ee,pe,fe,se,re)=>(w(X)?K="":w(U)?K=`>=${X}.0.0${F?"-0":""}`:w(Y)?K=`>=${X}.${U}.0${F?"-0":""}`:Z?K=`>=${K}`:K=`>=${K}${F?"-0":""}`,w(pe)?ee="":w(fe)?ee=`<${+pe+1}.0.0-0`:w(se)?ee=`<${pe}.${+fe+1}.0-0`:re?ee=`<=${pe}.${fe}.${se}-${re}`:F?ee=`<${pe}.${fe}.${+se+1}-0`:ee=`<=${ee}`,`${K} ${ee}`.trim()),V=(F,$,K)=>{for(let X=0;X<F.length;X++)if(!F[X].test($))return!1;if($.prerelease.length&&!K.includePrerelease){for(let X=0;X<F.length;X++)if(a(F[X].semver),F[X].semver!==s.ANY&&F[X].semver.prerelease.length>0){const U=F[X].semver;if(U.major===$.major&&U.minor===$.minor&&U.patch===$.patch)return!0}return!1}return!0};return NN}var UN,dX;function aO(){if(dX)return UN;dX=1;const t=Symbol("SemVer ANY");class e{static get ANY(){return t}constructor(u,h){if(h=i(h),u instanceof e){if(u.loose===!!h.loose)return u;u=u.value}u=u.trim().split(/\s+/).join(" "),a("comparator",u,h),this.options=h,this.loose=!!h.loose,this.parse(u),this.semver===t?this.value="":this.value=this.operator+this.semver.version,a("comp",this)}parse(u){const h=this.options.loose?r[n.COMPARATORLOOSE]:r[n.COMPARATOR],d=u.match(h);if(!d)throw new TypeError(`Invalid comparator: ${u}`);this.operator=d[1]!==void 0?d[1]:"",this.operator==="="&&(this.operator=""),d[2]?this.semver=new o(d[2],this.options.loose):this.semver=t}toString(){return this.value}test(u){if(a("Comparator.test",u,this.options.loose),this.semver===t||u===t)return!0;if(typeof u=="string")try{u=new o(u,this.options)}catch{return!1}return s(u,this.operator,this.semver,this.options)}intersects(u,h){if(!(u instanceof e))throw new TypeError("a Comparator is required");return this.operator===""?this.value===""?!0:new l(u.value,h).test(this.value):u.operator===""?u.value===""?!0:new l(this.value,h).test(u.semver):(h=i(h),h.includePrerelease&&(this.value==="<0.0.0-0"||u.value==="<0.0.0-0")||!h.includePrerelease&&(this.value.startsWith("<0.0.0")||u.value.startsWith("<0.0.0"))?!1:!!(this.operator.startsWith(">")&&u.operator.startsWith(">")||this.operator.startsWith("<")&&u.operator.startsWith("<")||this.semver.version===u.semver.version&&this.operator.includes("=")&&u.operator.includes("=")||s(this.semver,"<",u.semver,h)&&this.operator.startsWith(">")&&u.operator.startsWith("<")||s(this.semver,">",u.semver,h)&&this.operator.startsWith("<")&&u.operator.startsWith(">")))}}UN=e;const i=A6(),{safeRe:r,t:n}=uT(),s=wae(),a=nO(),o=_l(),l=Nh();return UN}var BN,fX;function oO(){if(fX)return BN;fX=1;const t=Nh();return BN=(i,r,n)=>{try{r=new t(r,n)}catch{return!1}return r.test(i)},BN}var FN,pX;function NCe(){if(pX)return FN;pX=1;const t=Nh();return FN=(i,r)=>new t(i,r).set.map(n=>n.map(s=>s.value).join(" ").trim().split(" ")),FN}var zN,mX;function UCe(){if(mX)return zN;mX=1;const t=_l(),e=Nh();return zN=(r,n,s)=>{let a=null,o=null,l=null;try{l=new e(n,s)}catch{return null}return r.forEach(c=>{l.test(c)&&(!a||o.compare(c)===-1)&&(a=c,o=new t(a,s))}),a},zN}var jN,gX;function BCe(){if(gX)return jN;gX=1;const t=_l(),e=Nh();return jN=(r,n,s)=>{let a=null,o=null,l=null;try{l=new e(n,s)}catch{return null}return r.forEach(c=>{l.test(c)&&(!a||o.compare(c)===1)&&(a=c,o=new t(a,s))}),a},jN}var VN,vX;function FCe(){if(vX)return VN;vX=1;const t=_l(),e=Nh(),i=sO();return VN=(n,s)=>{n=new e(n,s);let a=new t("0.0.0");if(n.test(a)||(a=new t("0.0.0-0"),n.test(a)))return a;a=null;for(let o=0;o<n.set.length;++o){const l=n.set[o];let c=null;l.forEach(u=>{const h=new t(u.semver.version);switch(u.operator){case">":h.prerelease.length===0?h.patch++:h.prerelease.push(0),h.raw=h.format();case"":case">=":(!c||i(h,c))&&(c=h);break;case"<":case"<=":break;default:throw new Error(`Unexpected operation: ${u.operator}`)}}),c&&(!a||i(a,c))&&(a=c)}return a&&n.test(a)?a:null},VN}var HN,yX;function zCe(){if(yX)return HN;yX=1;const t=Nh();return HN=(i,r)=>{try{return new t(i,r).range||"*"}catch{return null}},HN}var GN,xX;function R6(){if(xX)return GN;xX=1;const t=_l(),e=aO(),{ANY:i}=e,r=Nh(),n=oO(),s=sO(),a=T6(),o=P6(),l=C6();return GN=(u,h,d,f)=>{u=new t(u,f),h=new r(h,f);let p,g,m,y,b;switch(d){case">":p=s,g=o,m=a,y=">",b=">=";break;case"<":p=a,g=l,m=s,y="<",b="<=";break;default:throw new TypeError('Must provide a hilo val of "<" or ">"')}if(n(u,h,f))return!1;for(let w=0;w<h.set.length;++w){const E=h.set[w];let M=null,A=null;if(E.forEach(P=>{P.semver===i&&(P=new e(">=0.0.0")),M=M||P,A=A||P,p(P.semver,M.semver,f)?M=P:m(P.semver,A.semver,f)&&(A=P)}),M.operator===y||M.operator===b||(!A.operator||A.operator===y)&&g(u,A.semver))return!1;if(A.operator===b&&m(u,A.semver))return!1}return!0},GN}var WN,bX;function jCe(){if(bX)return WN;bX=1;const t=R6();return WN=(i,r,n)=>t(i,r,">",n),WN}var qN,wX;function VCe(){if(wX)return qN;wX=1;const t=R6();return qN=(i,r,n)=>t(i,r,"<",n),qN}var XN,_X;function HCe(){if(_X)return XN;_X=1;const t=Nh();return XN=(i,r,n)=>(i=new t(i,n),r=new t(r,n),i.intersects(r,n)),XN}var $N,SX;function GCe(){if(SX)return $N;SX=1;const t=oO(),e=kh();return $N=(i,r,n)=>{const s=[];let a=null,o=null;const l=i.sort((d,f)=>e(d,f,n));for(const d of l)t(d,r,n)?(o=d,a||(a=d)):(o&&s.push([a,o]),o=null,a=null);a&&s.push([a,null]);const c=[];for(const[d,f]of s)d===f?c.push(d):!f&&d===l[0]?c.push("*"):f?d===l[0]?c.push(`<=${f}`):c.push(`${d} - ${f}`):c.push(`>=${d}`);const u=c.join(" || "),h=typeof r.raw=="string"?r.raw:String(r);return u.length<h.length?u:r},$N}var YN,EX;function WCe(){if(EX)return YN;EX=1;const t=Nh(),e=aO(),{ANY:i}=e,r=oO(),n=kh(),s=(h,d,f={})=>{if(h===d)return!0;h=new t(h,f),d=new t(d,f);let p=!1;e:for(const g of h.set){for(const m of d.set){const y=l(g,m,f);if(p=p||y!==null,y)continue e}if(p)return!1}return!0},a=[new e(">=0.0.0-0")],o=[new e(">=0.0.0")],l=(h,d,f)=>{if(h===d)return!0;if(h.length===1&&h[0].semver===i){if(d.length===1&&d[0].semver===i)return!0;f.includePrerelease?h=a:h=o}if(d.length===1&&d[0].semver===i){if(f.includePrerelease)return!0;d=o}const p=new Set;let g,m;for(const C of h)C.operator===">"||C.operator===">="?g=c(g,C,f):C.operator==="<"||C.operator==="<="?m=u(m,C,f):p.add(C.semver);if(p.size>1)return null;let y;if(g&&m){if(y=n(g.semver,m.semver,f),y>0)return null;if(y===0&&(g.operator!==">="||m.operator!=="<="))return null}for(const C of p){if(g&&!r(C,String(g),f)||m&&!r(C,String(m),f))return null;for(const R of d)if(!r(C,String(R),f))return!1;return!0}let b,w,E,M,A=m&&!f.includePrerelease&&m.semver.prerelease.length?m.semver:!1,P=g&&!f.includePrerelease&&g.semver.prerelease.length?g.semver:!1;A&&A.prerelease.length===1&&m.operator==="<"&&A.prerelease[0]===0&&(A=!1);for(const C of d){if(M=M||C.operator===">"||C.operator===">=",E=E||C.operator==="<"||C.operator==="<=",g){if(P&&C.semver.prerelease&&C.semver.prerelease.length&&C.semver.major===P.major&&C.semver.minor===P.minor&&C.semver.patch===P.patch&&(P=!1),C.operator===">"||C.operator===">="){if(b=c(g,C,f),b===C&&b!==g)return!1}else if(g.operator===">="&&!r(g.semver,String(C),f))return!1}if(m){if(A&&C.semver.prerelease&&C.semver.prerelease.length&&C.semver.major===A.major&&C.semver.minor===A.minor&&C.semver.patch===A.patch&&(A=!1),C.operator==="<"||C.operator==="<="){if(w=u(m,C,f),w===C&&w!==m)return!1}else if(m.operator==="<="&&!r(m.semver,String(C),f))return!1}if(!C.operator&&(m||g)&&y!==0)return!1}return!(g&&E&&!m&&y!==0||m&&M&&!g&&y!==0||P||A)},c=(h,d,f)=>{if(!h)return d;const p=n(h.semver,d.semver,f);return p>0?h:p<0||d.operator===">"&&h.operator===">="?d:h},u=(h,d,f)=>{if(!h)return d;const p=n(h.semver,d.semver,f);return p<0?h:p>0||d.operator==="<"&&h.operator==="<="?d:h};return YN=s,YN}var KN,AX;function qCe(){if(AX)return KN;AX=1;const t=uT(),e=rO(),i=_l(),r=yae(),n=h_(),s=_Ce(),a=SCe(),o=ECe(),l=ACe(),c=MCe(),u=TCe(),h=CCe(),d=PCe(),f=kh(),p=RCe(),g=ICe(),m=M6(),y=DCe(),b=OCe(),w=sO(),E=T6(),M=xae(),A=bae(),P=C6(),C=P6(),R=wae(),I=LCe(),k=aO(),z=Nh(),V=oO(),F=NCe(),$=UCe(),K=BCe(),X=FCe(),U=zCe(),Y=R6(),Z=jCe(),j=VCe(),ee=HCe(),pe=GCe(),fe=WCe();return KN={parse:n,valid:s,clean:a,inc:o,diff:l,major:c,minor:u,patch:h,prerelease:d,compare:f,rcompare:p,compareLoose:g,compareBuild:m,sort:y,rsort:b,gt:w,lt:E,eq:M,neq:A,gte:P,lte:C,cmp:R,coerce:I,Comparator:k,Range:z,satisfies:V,toComparators:F,maxSatisfying:$,minSatisfying:K,minVersion:X,validRange:U,outside:Y,gtr:Z,ltr:j,intersects:ee,simplifyRange:pe,subset:fe,SemVer:i,re:t.re,src:t.src,tokens:t.t,SEMVER_SPEC_VERSION:e.SEMVER_SPEC_VERSION,RELEASE_TYPES:e.RELEASE_TYPES,compareIdentifiers:r.compareIdentifiers,rcompareIdentifiers:r.rcompareIdentifiers},KN}qCe();function km(t){if(!t||t.split("/").length>2||t.startsWith("/")||t.endsWith("/")||t.split(":").length>2)throw new Error(`Invalid identifier format: ${t}`);const[e,i]=t.split(":"),r=i||"latest";if(e.includes("/")){const[n,s]=e.split("/",2);if(!n||!s)throw new Error(`Invalid identifier format: ${t}`);return[n,s,r]}else{if(!e)throw new Error(`Invalid identifier format: ${t}`);return["-",e,r]}}class XCe extends Error{constructor(e){super(e),Object.defineProperty(this,"status",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.name="LangSmithConflictError",this.status=409}}async function Si(t,e,i){let r;if(t.ok){i&&(r=await t.text());return}if(t.status===403)try{(await t.json())?.error==="org_scoped_key_requires_workspace"&&(r="This API key is org-scoped and requires workspace specification. Please provide 'workspaceId' parameter, or set LANGSMITH_WORKSPACE_ID environment variable.")}catch{const o=new Error(`${t.status} ${t.statusText}`);throw o.status=t?.status,o}if(r===void 0)try{r=await t.text()}catch{r=""}const n=`Failed to ${e}. Received status [${t.status}]: ${t.statusText}. Message: ${r}`;if(t.status===409)throw new XCe(n);const s=new Error(n);throw s.status=t.status,s}const _ae="ERR_CONFLICTING_ENDPOINTS";class $Ce extends Error{constructor(){super("You cannot provide both LANGSMITH_ENDPOINT / LANGCHAIN_ENDPOINT and LANGSMITH_RUNS_ENDPOINTS."),Object.defineProperty(this,"code",{enumerable:!0,configurable:!0,writable:!0,value:_ae}),this.name="ConflictingEndpointsError"}}function YCe(t){return typeof t=="object"&&t!==null&&t.code===_ae}var MX="[...]",KCe={result:"[Circular]"},LI=[],jw=[];const ZCe=new TextEncoder;function QCe(){return{depthLimit:Number.MAX_SAFE_INTEGER,edgesLimit:Number.MAX_SAFE_INTEGER}}function o2(t){return ZCe.encode(t)}function Sae(t){if(t&&typeof t=="object"&&t!==null){if(t instanceof Map)return Object.fromEntries(t);if(t instanceof Set)return Array.from(t);if(t instanceof Date)return t.toISOString();if(t instanceof RegExp)return t.toString();if(t instanceof Error)return{name:t.name,message:t.message}}else if(typeof t=="bigint")return t.toString();return t}function JCe(t){return function(e,i){return Sae(i)}}function Ac(t,e,i,r,n){try{const s=JSON.stringify(t,JCe(i),r);return o2(s)}catch(s){if(!s.message?.includes("Converting circular structure to JSON"))return console.warn(`[WARNING]: LangSmith received unserializable value.${e?`
Context: ${e}`:""}`),o2("[Unserializable]");Xl("SUPPRESS_CIRCULAR_JSON_WARNINGS")!=="true"&&console.warn(`[WARNING]: LangSmith received circular JSON. This will decrease tracer performance. ${e?`
Context: ${e}`:""}`),typeof n>"u"&&(n=QCe()),Lz(t,"",0,[],void 0,0,n);let a;try{jw.length===0?a=JSON.stringify(t,i,r):a=JSON.stringify(t,e2e(i),r)}catch{return o2("[unable to serialize, circular reference is too complex to analyze]")}finally{for(;LI.length!==0;){const o=LI.pop();o.length===4?Object.defineProperty(o[0],o[1],o[3]):o[0][o[1]]=o[2]}}return o2(a)}}function ZN(t,e,i,r){var n=Object.getOwnPropertyDescriptor(r,i);n.get!==void 0?n.configurable?(Object.defineProperty(r,i,{value:t}),LI.push([r,i,e,n])):jw.push([e,i,t]):(r[i]=t,LI.push([r,i,e]))}function Lz(t,e,i,r,n,s,a){s+=1;var o;if(typeof t=="object"&&t!==null){for(o=0;o<r.length;o++)if(r[o]===t){ZN(KCe,t,e,n);return}if(typeof a.depthLimit<"u"&&s>a.depthLimit){ZN(MX,t,e,n);return}if(typeof a.edgesLimit<"u"&&i+1>a.edgesLimit){ZN(MX,t,e,n);return}if(r.push(t),Array.isArray(t))for(o=0;o<t.length;o++)Lz(t[o],o,o,r,t,s,a);else{t=Sae(t);var l=Object.keys(t);for(o=0;o<l.length;o++){var c=l[o];Lz(t[c],c,o,r,t,s,a)}}r.pop()}}function e2e(t){return t=typeof t<"u"?t:function(e,i){return i},function(e,i){if(jw.length>0)for(var r=0;r<jw.length;r++){var n=jw[r];if(n[1]===e&&n[0]===i){i=n[2],jw.splice(r,1);break}}return t.call(this,e,i)}}function TX(t){const e=pae(),i=JTe(),r=t.extra??{},n=r.metadata;return t.extra={...r,runtime:{...e,...r?.runtime},metadata:{...i,...i.revision_id||"revision_id"in t&&t.revision_id?{revision_id:("revision_id"in t?t.revision_id:void 0)??i.revision_id}:{},...n}},t}const t2e=t=>{const e=t?.toString()??Xl("TRACING_SAMPLING_RATE");if(e===void 0)return;const i=parseFloat(e);if(i<0||i>1)throw new Error(`LANGSMITH_TRACING_SAMPLING_RATE must be between 0 and 1 if set. Got: ${i}`);return i},i2e=t=>{const i=t.replace("http://","").replace("https://","").split("/")[0].split(":")[0];return i==="localhost"||i==="127.0.0.1"||i==="::1"};async function r2e(t){const e=[];for await(const i of t)e.push(i);return e}function l2(t){if(t!==void 0)return t.trim().replace(/^"(.*)"$/,"$1").replace(/^'(.*)'$/,"$1")}const n2e=async t=>{if(t?.status===429){const e=parseInt(t.headers.get("retry-after")??"10",10)*1e3;if(e>0)return await new Promise(i=>setTimeout(i,e)),!0}return!1};function CX(t){return typeof t=="number"?Number(t.toFixed(4)):t}class s2e{constructor(){Object.defineProperty(this,"items",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"sizeBytes",{enumerable:!0,configurable:!0,writable:!0,value:0})}peek(){return this.items[0]}push(e){let i;const r=new Promise(s=>{i=s}),n=Ac(e.item,`Serializing run with id: ${e.item.id}`).length;return this.items.push({action:e.action,payload:e.item,otelContext:e.otelContext,apiKey:e.apiKey,apiUrl:e.apiUrl,itemPromiseResolve:i,itemPromise:r,size:n}),this.sizeBytes+=n,r}pop({upToSizeBytes:e,upToSize:i}){if(e<1)throw new Error("Number of bytes to pop off may not be less than 1.");const r=[];let n=0;for(;n+(this.peek()?.size??0)<e&&this.items.length>0&&r.length<i;){const s=this.items.shift();s&&(r.push(s),n+=s.size,this.sizeBytes-=s.size)}if(r.length===0&&this.items.length>0){const s=this.items.shift();r.push(s),n+=s.size,this.sizeBytes-=s.size}return[r.map(s=>({action:s.action,item:s.payload,otelContext:s.otelContext,apiKey:s.apiKey,apiUrl:s.apiUrl})),()=>r.forEach(s=>s.itemPromiseResolve())]}}const a2e=24*1024*1024,o2e=1e4,l2e=100,PX="https://api.smith.langchain.com";class nM{get _fetch(){return this.fetchImplementation||$Te(this.debug)}constructor(e={}){Object.defineProperty(this,"apiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"apiUrl",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"webUrl",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"workspaceId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"caller",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"batchIngestCaller",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"timeout_ms",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_tenantId",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"hideInputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"hideOutputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tracingSampleRate",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"filteredPostUuids",{enumerable:!0,configurable:!0,writable:!0,value:new Set}),Object.defineProperty(this,"autoBatchTracing",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"autoBatchQueue",{enumerable:!0,configurable:!0,writable:!0,value:new s2e}),Object.defineProperty(this,"autoBatchTimeout",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"autoBatchAggregationDelayMs",{enumerable:!0,configurable:!0,writable:!0,value:250}),Object.defineProperty(this,"batchSizeBytesLimit",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"batchSizeLimit",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"fetchOptions",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"settings",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"blockOnRootRunFinalization",{enumerable:!0,configurable:!0,writable:!0,value:Zd("LANGSMITH_TRACING_BACKGROUND")==="false"}),Object.defineProperty(this,"traceBatchConcurrency",{enumerable:!0,configurable:!0,writable:!0,value:5}),Object.defineProperty(this,"_serverInfo",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_getServerInfoPromise",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"manualFlushMode",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"langSmithToOTELTranslator",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"fetchImplementation",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"multipartStreamingDisabled",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"debug",{enumerable:!0,configurable:!0,writable:!0,value:Zd("LANGSMITH_DEBUG")==="true"});const i=nM.getDefaultClientConfig();if(this.tracingSampleRate=t2e(e.tracingSamplingRate),this.apiUrl=l2(e.apiUrl??i.apiUrl)??"",this.apiUrl.endsWith("/")&&(this.apiUrl=this.apiUrl.slice(0,-1)),this.apiKey=l2(e.apiKey??i.apiKey),this.webUrl=l2(e.webUrl??i.webUrl),this.webUrl?.endsWith("/")&&(this.webUrl=this.webUrl.slice(0,-1)),this.workspaceId=l2(e.workspaceId??Xl("WORKSPACE_ID")),this.timeout_ms=e.timeout_ms??9e4,this.caller=new Iq({...e.callerOptions??{},maxRetries:4,debug:e.debug??this.debug}),this.traceBatchConcurrency=e.traceBatchConcurrency??this.traceBatchConcurrency,this.traceBatchConcurrency<1)throw new Error("Trace batch concurrency must be positive.");this.debug=e.debug??this.debug,this.fetchImplementation=e.fetchImplementation,this.batchIngestCaller=new Iq({maxRetries:2,maxConcurrency:this.traceBatchConcurrency,...e.callerOptions??{},onFailedResponseHook:n2e,debug:e.debug??this.debug}),this.hideInputs=e.hideInputs??e.anonymizer??i.hideInputs,this.hideOutputs=e.hideOutputs??e.anonymizer??i.hideOutputs,this.autoBatchTracing=e.autoBatchTracing??this.autoBatchTracing,this.blockOnRootRunFinalization=e.blockOnRootRunFinalization??this.blockOnRootRunFinalization,this.batchSizeBytesLimit=e.batchSizeBytesLimit,this.batchSizeLimit=e.batchSizeLimit,this.fetchOptions=e.fetchOptions||{},this.manualFlushMode=e.manualFlushMode??this.manualFlushMode,mae()&&(this.langSmithToOTELTranslator=new dCe)}static getDefaultClientConfig(){const e=Xl("API_KEY"),i=Xl("ENDPOINT")??PX,r=Xl("HIDE_INPUTS")==="true",n=Xl("HIDE_OUTPUTS")==="true";return{apiUrl:i,apiKey:e,webUrl:void 0,hideInputs:r,hideOutputs:n}}getHostUrl(){return this.webUrl?this.webUrl:i2e(this.apiUrl)?(this.webUrl="http://localhost:3000",this.webUrl):this.apiUrl.endsWith("/api/v1")?(this.webUrl=this.apiUrl.replace("/api/v1",""),this.webUrl):this.apiUrl.includes("/api")&&!this.apiUrl.split(".",1)[0].endsWith("api")?(this.webUrl=this.apiUrl.replace("/api",""),this.webUrl):this.apiUrl.split(".",1)[0].includes("dev")?(this.webUrl="https://dev.smith.langchain.com",this.webUrl):this.apiUrl.split(".",1)[0].includes("eu")?(this.webUrl="https://eu.smith.langchain.com",this.webUrl):this.apiUrl.split(".",1)[0].includes("beta")?(this.webUrl="https://beta.smith.langchain.com",this.webUrl):(this.webUrl="https://smith.langchain.com",this.webUrl)}get headers(){const e={"User-Agent":`langsmith-js/${hae}`};return this.apiKey&&(e["x-api-key"]=`${this.apiKey}`),this.workspaceId&&(e["x-tenant-id"]=this.workspaceId),e}_getPlatformEndpointPath(e){return this.apiUrl.slice(-3)!=="/v1"&&this.apiUrl.slice(-4)!=="/v1/"?`/v1/platform/${e}`:`/platform/${e}`}async processInputs(e){return this.hideInputs===!1?e:this.hideInputs===!0?{}:typeof this.hideInputs=="function"?this.hideInputs(e):e}async processOutputs(e){return this.hideOutputs===!1?e:this.hideOutputs===!0?{}:typeof this.hideOutputs=="function"?this.hideOutputs(e):e}async prepareRunCreateOrUpdateInputs(e){const i={...e};return i.inputs!==void 0&&(i.inputs=await this.processInputs(i.inputs)),i.outputs!==void 0&&(i.outputs=await this.processOutputs(i.outputs)),i}async _getResponse(e,i){const r=i?.toString()??"",n=`${this.apiUrl}${e}?${r}`;return await this.caller.call(async()=>{const a=await this._fetch(n,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await Si(a,`fetch ${e}`),a})}async _get(e,i){return(await this._getResponse(e,i)).json()}async*_getPaginated(e,i=new URLSearchParams,r){let n=Number(i.get("offset"))||0;const s=Number(i.get("limit"))||100;for(;;){i.set("offset",String(n)),i.set("limit",String(s));const a=`${this.apiUrl}${e}?${i}`,o=await this.caller.call(async()=>{const c=await this._fetch(a,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await Si(c,`fetch ${e}`),c}),l=r?r(await o.json()):await o.json();if(l.length===0||(yield l,l.length<s))break;n+=l.length}}async*_getCursorPaginatedList(e,i=null,r="POST",n="runs"){const s=i?{...i}:{};for(;;){const a=JSON.stringify(s),l=await(await this.caller.call(async()=>{const u=await this._fetch(`${this.apiUrl}${e}`,{method:r,headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:a});return await Si(u,`fetch ${e}`),u})).json();if(!l||!l[n])break;yield l[n];const c=l.cursors;if(!c||!c.next)break;s.cursor=c.next}}_shouldSample(){return this.tracingSampleRate===void 0?!0:Math.random()<this.tracingSampleRate}_filterForSampling(e,i=!1){if(this.tracingSampleRate===void 0)return e;if(i){const r=[];for(const n of e)this.filteredPostUuids.has(n.trace_id)?n.id===n.trace_id&&this.filteredPostUuids.delete(n.trace_id):r.push(n);return r}else{const r=[];for(const n of e){const s=n.trace_id??n.id;this.filteredPostUuids.has(s)||(n.id===s?this._shouldSample()?r.push(n):this.filteredPostUuids.add(s):r.push(n))}return r}}async _getBatchSizeLimitBytes(){const e=await this._ensureServerInfo();return this.batchSizeBytesLimit??e.batch_ingest_config?.size_limit_bytes??a2e}async _getBatchSizeLimit(){const e=await this._ensureServerInfo();return this.batchSizeLimit??e.batch_ingest_config?.size_limit??l2e}async _getDatasetExamplesMultiPartSupport(){return(await this._ensureServerInfo()).instance_flags?.dataset_examples_multipart_enabled??!1}drainAutoBatchQueue({batchSizeLimitBytes:e,batchSizeLimit:i}){const r=[];for(;this.autoBatchQueue.items.length>0;){const[n,s]=this.autoBatchQueue.pop({upToSizeBytes:e,upToSize:i});if(!n.length){s();break}const a=n.reduce((c,u)=>{const h=u.apiUrl??this.apiUrl,d=u.apiKey??this.apiKey,p=u.apiKey===this.apiKey&&u.apiUrl===this.apiUrl?"default":`${h}|${d}`;return c[p]||(c[p]=[]),c[p].push(u),c},{}),o=[];for(const[c,u]of Object.entries(a)){const h=this._processBatch(u,{apiUrl:c==="default"?void 0:c.split("|")[0],apiKey:c==="default"?void 0:c.split("|")[1]});o.push(h)}const l=Promise.all(o).finally(s);r.push(l)}return Promise.all(r)}async _processBatch(e,i){if(e.length)try{if(this.langSmithToOTELTranslator!==void 0)this._sendBatchToOTELTranslator(e);else{const r={runCreates:e.filter(s=>s.action==="create").map(s=>s.item),runUpdates:e.filter(s=>s.action==="update").map(s=>s.item)},n=await this._ensureServerInfo();if(n?.batch_ingest_config?.use_multipart_endpoint){const s=n?.instance_flags?.gzip_body_enabled;await this.multipartIngestRuns(r,{...i,useGzip:s})}else await this.batchIngestRuns(r,i)}}catch(r){console.error("Error exporting batch:",r)}}_sendBatchToOTELTranslator(e){if(this.langSmithToOTELTranslator!==void 0){const i=new Map,r=[];for(const n of e)n.item.id&&n.otelContext&&(i.set(n.item.id,n.otelContext),n.action==="create"?r.push({operation:"post",id:n.item.id,trace_id:n.item.trace_id??n.item.id,run:n.item}):r.push({operation:"patch",id:n.item.id,trace_id:n.item.trace_id??n.item.id,run:n.item}));this.langSmithToOTELTranslator.exportBatch(r,i)}}async processRunOperation(e){clearTimeout(this.autoBatchTimeout),this.autoBatchTimeout=void 0,e.item=TX(e.item);const i=this.autoBatchQueue.push(e);if(this.manualFlushMode)return i;const r=await this._getBatchSizeLimitBytes(),n=await this._getBatchSizeLimit();return(this.autoBatchQueue.sizeBytes>r||this.autoBatchQueue.items.length>n)&&this.drainAutoBatchQueue({batchSizeLimitBytes:r,batchSizeLimit:n}),this.autoBatchQueue.items.length>0&&(this.autoBatchTimeout=setTimeout(()=>{this.autoBatchTimeout=void 0,this.drainAutoBatchQueue({batchSizeLimitBytes:r,batchSizeLimit:n})},this.autoBatchAggregationDelayMs)),i}async _getServerInfo(){const i=await(await this.caller.call(async()=>{const r=await this._fetch(`${this.apiUrl}/info`,{method:"GET",headers:{Accept:"application/json"},signal:AbortSignal.timeout(o2e),...this.fetchOptions});return await Si(r,"get server info"),r})).json();return this.debug&&console.log(`
=== LangSmith Server Configuration ===
`+JSON.stringify(i,null,2)+`
`),i}async _ensureServerInfo(){return this._getServerInfoPromise===void 0&&(this._getServerInfoPromise=(async()=>{if(this._serverInfo===void 0)try{this._serverInfo=await this._getServerInfo()}catch(e){console.warn(`[LANGSMITH]: Failed to fetch info on supported operations. Falling back to batch operations and default limits. Info: ${e.status??"Unspecified status code"} ${e.message}`)}return this._serverInfo??{}})()),this._getServerInfoPromise.then(e=>(this._serverInfo===void 0&&(this._getServerInfoPromise=void 0),e))}async _getSettings(){return this.settings||(this.settings=this._get("/settings")),await this.settings}async flush(){const e=await this._getBatchSizeLimitBytes(),i=await this._getBatchSizeLimit();await this.drainAutoBatchQueue({batchSizeLimitBytes:e,batchSizeLimit:i})}_cloneCurrentOTELContext(){const e=gae(),i=lCe();if(this.langSmithToOTELTranslator!==void 0){const r=e.getActiveSpan();if(r)return e.setSpan(i.active(),r)}}async createRun(e,i){if(!this._filterForSampling([e]).length)return;const r={...this.headers,"Content-Type":"application/json"},n=e.project_name;delete e.project_name;const s=await this.prepareRunCreateOrUpdateInputs({session_name:n,...e,start_time:e.start_time??Date.now()});if(this.autoBatchTracing&&s.trace_id!==void 0&&s.dotted_order!==void 0){const l=this._cloneCurrentOTELContext();this.processRunOperation({action:"create",item:s,otelContext:l,apiKey:i?.apiKey,apiUrl:i?.apiUrl}).catch(console.error);return}const a=TX(s);i?.apiKey!==void 0&&(r["x-api-key"]=i.apiKey),i?.workspaceId!==void 0&&(r["x-tenant-id"]=i.workspaceId);const o=Ac(a,`Creating run with id: ${a.id}`);await this.caller.call(async()=>{const l=await this._fetch(`${i?.apiUrl??this.apiUrl}/runs`,{method:"POST",headers:r,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:o});return await Si(l,"create run",!0),l})}async batchIngestRuns({runCreates:e,runUpdates:i},r){if(e===void 0&&i===void 0)return;let n=await Promise.all(e?.map(l=>this.prepareRunCreateOrUpdateInputs(l))??[]),s=await Promise.all(i?.map(l=>this.prepareRunCreateOrUpdateInputs(l))??[]);if(n.length>0&&s.length>0){const l=n.reduce((u,h)=>(h.id&&(u[h.id]=h),u),{}),c=[];for(const u of s)u.id!==void 0&&l[u.id]?l[u.id]={...l[u.id],...u}:c.push(u);n=Object.values(l),s=c}const a={post:n,patch:s};if(!a.post.length&&!a.patch.length)return;const o={post:[],patch:[]};for(const l of["post","patch"]){const c=l,u=a[c].reverse();let h=u.pop();for(;h!==void 0;)o[c].push(h),h=u.pop()}if(o.post.length>0||o.patch.length>0){const l=o.post.map(c=>c.id).concat(o.patch.map(c=>c.id)).join(",");await this._postBatchIngestRuns(Ac(o,`Ingesting runs with ids: ${l}`),r)}}async _postBatchIngestRuns(e,i){const r={...this.headers,"Content-Type":"application/json",Accept:"application/json"};i?.apiKey!==void 0&&(r["x-api-key"]=i.apiKey),await this.batchIngestCaller.call(async()=>{const n=await this._fetch(`${i?.apiUrl??this.apiUrl}/runs/batch`,{method:"POST",headers:r,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:e});return await Si(n,"batch create run",!0),n})}async multipartIngestRuns({runCreates:e,runUpdates:i},r){if(e===void 0&&i===void 0)return;const n={};let s=[];for(const h of e??[]){const d=await this.prepareRunCreateOrUpdateInputs(h);d.id!==void 0&&d.attachments!==void 0&&(n[d.id]=d.attachments),delete d.attachments,s.push(d)}let a=[];for(const h of i??[])a.push(await this.prepareRunCreateOrUpdateInputs(h));if(s.find(h=>h.trace_id===void 0||h.dotted_order===void 0)!==void 0)throw new Error('Multipart ingest requires "trace_id" and "dotted_order" to be set when creating a run');if(a.find(h=>h.trace_id===void 0||h.dotted_order===void 0)!==void 0)throw new Error('Multipart ingest requires "trace_id" and "dotted_order" to be set when updating a run');if(s.length>0&&a.length>0){const h=s.reduce((f,p)=>(p.id&&(f[p.id]=p),f),{}),d=[];for(const f of a)f.id!==void 0&&h[f.id]?h[f.id]={...h[f.id],...f}:d.push(f);s=Object.values(h),a=d}if(s.length===0&&a.length===0)return;const c=[],u=[];for(const[h,d]of[["post",s],["patch",a]])for(const f of d){const{inputs:p,outputs:g,events:m,extra:y,error:b,serialized:w,attachments:E,...M}=f,A={inputs:p,outputs:g,events:m,extra:y,error:b,serialized:w},P=Ac(M,`Serializing for multipart ingestion of run with id: ${M.id}`);u.push({name:`${h}.${M.id}`,payload:new Blob([P],{type:`application/json; length=${P.length}`})});for(const[C,R]of Object.entries(A)){if(R===void 0)continue;const I=Ac(R,`Serializing ${C} for multipart ingestion of run with id: ${M.id}`);u.push({name:`${h}.${M.id}.${C}`,payload:new Blob([I],{type:`application/json; length=${I.length}`})})}if(M.id!==void 0){const C=n[M.id];if(C){delete n[M.id];for(const[R,I]of Object.entries(C)){let k,z;if(Array.isArray(I)?[k,z]=I:(k=I.mimeType,z=I.data),R.includes(".")){console.warn(`Skipping attachment '${R}' for run ${M.id}: Invalid attachment name. Attachment names must not contain periods ('.'). Please rename the attachment and try again.`);continue}u.push({name:`attachment.${M.id}.${R}`,payload:new Blob([z],{type:`${k}; length=${z.byteLength}`})})}}}c.push(`trace=${M.trace_id},id=${M.id}`)}await this._sendMultipartRequest(u,c.join("; "),r)}async _createNodeFetchBody(e,i){const r=[];for(const a of e)r.push(new Blob([`--${i}\r
`])),r.push(new Blob([`Content-Disposition: form-data; name="${a.name}"\r
`,`Content-Type: ${a.payload.type}\r
\r
`])),r.push(a.payload),r.push(new Blob([`\r
`]));return r.push(new Blob([`--${i}--\r
`])),await new Blob(r).arrayBuffer()}async _createMultipartStream(e,i){const r=new TextEncoder;return new ReadableStream({async start(s){const a=async o=>{typeof o=="string"?s.enqueue(r.encode(o)):s.enqueue(o)};for(const o of e){await a(`--${i}\r
`),await a(`Content-Disposition: form-data; name="${o.name}"\r
`),await a(`Content-Type: ${o.payload.type}\r
\r
`);const c=o.payload.stream().getReader();try{let u;for(;!(u=await c.read()).done;)s.enqueue(u.value)}finally{c.releaseLock()}await a(`\r
`)}await a(`--${i}--\r
`),s.close()}})}async _sendMultipartRequest(e,i,r){const n="----LangSmithFormBoundary"+Math.random().toString(36).slice(2),s=XTe(),a=()=>this._createNodeFetchBody(e,n),o=()=>this._createMultipartStream(e,n),l=async c=>this.batchIngestCaller.call(async()=>{const u=await c(),h={...this.headers,"Content-Type":`multipart/form-data; boundary=${n}`};r?.apiKey!==void 0&&(h["x-api-key"]=r.apiKey);let d=u;r?.useGzip&&typeof u=="object"&&"pipeThrough"in u&&(d=u.pipeThrough(new CompressionStream("gzip")),h["Content-Encoding"]="gzip");const f=await this._fetch(`${r?.apiUrl??this.apiUrl}/runs/multipart`,{method:"POST",headers:h,body:d,duplex:"half",signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await Si(f,"Failed to send multipart request",!0),f});try{let c,u=!1;!s&&!this.multipartStreamingDisabled&&fae()!=="bun"?(u=!0,c=await l(o)):c=await l(a),(!this.multipartStreamingDisabled||u)&&c.status===422&&(r?.apiUrl??this.apiUrl)!==PX&&(console.warn(`Streaming multipart upload to ${r?.apiUrl??this.apiUrl}/runs/multipart failed. This usually means the host does not support chunked uploads. Retrying with a buffered upload for operation "${i}".`),this.multipartStreamingDisabled=!0,c=await l(a))}catch(c){console.warn(`${c.message.trim()}

Context: ${i}`)}}async updateRun(e,i,r){ar(e),i.inputs&&(i.inputs=await this.processInputs(i.inputs)),i.outputs&&(i.outputs=await this.processOutputs(i.outputs));const n={...i,id:e};if(!this._filterForSampling([n],!0).length)return;if(this.autoBatchTracing&&n.trace_id!==void 0&&n.dotted_order!==void 0){const o=this._cloneCurrentOTELContext();if(i.end_time!==void 0&&n.parent_run_id===void 0&&this.blockOnRootRunFinalization&&!this.manualFlushMode){await this.processRunOperation({action:"update",item:n,otelContext:o,apiKey:r?.apiKey,apiUrl:r?.apiUrl}).catch(console.error);return}else this.processRunOperation({action:"update",item:n,otelContext:o,apiKey:r?.apiKey,apiUrl:r?.apiUrl}).catch(console.error);return}const s={...this.headers,"Content-Type":"application/json"};r?.apiKey!==void 0&&(s["x-api-key"]=r.apiKey),r?.workspaceId!==void 0&&(s["x-tenant-id"]=r.workspaceId);const a=Ac(i,`Serializing payload to update run with id: ${e}`);await this.caller.call(async()=>{const o=await this._fetch(`${r?.apiUrl??this.apiUrl}/runs/${e}`,{method:"PATCH",headers:s,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:a});return await Si(o,"update run",!0),o})}async readRun(e,{loadChildRuns:i}={loadChildRuns:!1}){ar(e);let r=await this._get(`/runs/${e}`);return i&&(r=await this._loadChildRuns(r)),r}async getRunUrl({runId:e,run:i,projectOpts:r}){if(i!==void 0){let n;i.session_id?n=i.session_id:r?.projectName?n=(await this.readProject({projectName:r?.projectName})).id:r?.projectId?n=r?.projectId:n=(await this.readProject({projectName:Xl("PROJECT")||"default"})).id;const s=await this._getTenantId();return`${this.getHostUrl()}/o/${s}/projects/p/${n}/r/${i.id}?poll=true`}else if(e!==void 0){const n=await this.readRun(e);if(!n.app_path)throw new Error(`Run ${e} has no app_path`);return`${this.getHostUrl()}${n.app_path}`}else throw new Error("Must provide either runId or run")}async _loadChildRuns(e){const i=await r2e(this.listRuns({isRoot:!1,projectId:e.session_id,traceId:e.trace_id})),r={},n={};i.sort((s,a)=>(s?.dotted_order??"").localeCompare(a?.dotted_order??""));for(const s of i){if(s.parent_run_id===null||s.parent_run_id===void 0)throw new Error(`Child run ${s.id} has no parent`);s.dotted_order?.startsWith(e.dotted_order??"")&&s.id!==e.id&&(s.parent_run_id in r||(r[s.parent_run_id]=[]),r[s.parent_run_id].push(s),n[s.id]=s)}e.child_runs=r[e.id]||[];for(const s in r)s!==e.id&&(n[s].child_runs=r[s]);return e}async*listRuns(e){const{projectId:i,projectName:r,parentRunId:n,traceId:s,referenceExampleId:a,startTime:o,executionOrder:l,isRoot:c,runType:u,error:h,id:d,query:f,filter:p,traceFilter:g,treeFilter:m,limit:y,select:b,order:w}=e;let E=[];if(i&&(E=Array.isArray(i)?i:[i]),r){const C=Array.isArray(r)?r:[r],R=await Promise.all(C.map(I=>this.readProject({projectName:I}).then(k=>k.id)));E.push(...R)}const M=["app_path","completion_cost","completion_tokens","dotted_order","end_time","error","events","extra","feedback_stats","first_token_time","id","inputs","name","outputs","parent_run_id","parent_run_ids","prompt_cost","prompt_tokens","reference_example_id","run_type","session_id","start_time","status","tags","total_cost","total_tokens","trace_id"],A={session:E.length?E:null,run_type:u,reference_example:a,query:f,filter:p,trace_filter:g,tree_filter:m,execution_order:l,parent_run:n,start_time:o?o.toISOString():null,error:h,id:d,limit:y,trace:s,select:b||M,is_root:c,order:w};let P=0;for await(const C of this._getCursorPaginatedList("/runs/query",A))if(y){if(P>=y)break;if(C.length+P>y){yield*C.slice(0,y-P);break}P+=C.length,yield*C}else yield*C}async*listGroupRuns(e){const{projectId:i,projectName:r,groupBy:n,filter:s,startTime:a,endTime:o,limit:l,offset:c}=e,h={session_id:i||(await this.readProject({projectName:r})).id,group_by:n,filter:s,start_time:a?a.toISOString():null,end_time:o?o.toISOString():null,limit:Number(l)||100};let d=Number(c)||0;const f="/runs/group",p=`${this.apiUrl}${f}`;for(;;){const g={...h,offset:d},m=Object.fromEntries(Object.entries(g).filter(([A,P])=>P!==void 0)),y=JSON.stringify(m),w=await(await this.caller.call(async()=>{const A=await this._fetch(p,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:y});return await Si(A,`Failed to fetch ${f}`),A})).json(),{groups:E,total:M}=w;if(E.length===0)break;for(const A of E)yield A;if(d+=E.length,d>=M)break}}async getRunStats({id:e,trace:i,parentRun:r,runType:n,projectNames:s,projectIds:a,referenceExampleIds:o,startTime:l,endTime:c,error:u,query:h,filter:d,traceFilter:f,treeFilter:p,isRoot:g,dataSourceType:m}){let y=a||[];s&&(y=[...a||[],...await Promise.all(s.map(P=>this.readProject({projectName:P}).then(C=>C.id)))]);const w=Object.fromEntries(Object.entries({id:e,trace:i,parent_run:r,run_type:n,session:y,reference_example:o,start_time:l,end_time:c,error:u,query:h,filter:d,trace_filter:f,tree_filter:p,is_root:g,data_source_type:m}).filter(([P,C])=>C!==void 0)),E=JSON.stringify(w);return await(await this.caller.call(async()=>{const P=await this._fetch(`${this.apiUrl}/runs/stats`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:E});return await Si(P,"get run stats"),P})).json()}async shareRun(e,{shareId:i}={}){const r={run_id:e,share_token:i||dl()};ar(e);const n=JSON.stringify(r),a=await(await this.caller.call(async()=>{const o=await this._fetch(`${this.apiUrl}/runs/${e}/share`,{method:"PUT",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:n});return await Si(o,"share run"),o})).json();if(a===null||!("share_token"in a))throw new Error("Invalid response from server");return`${this.getHostUrl()}/public/${a.share_token}/r`}async unshareRun(e){ar(e),await this.caller.call(async()=>{const i=await this._fetch(`${this.apiUrl}/runs/${e}/share`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await Si(i,"unshare run",!0),i})}async readRunSharedLink(e){ar(e);const r=await(await this.caller.call(async()=>{const n=await this._fetch(`${this.apiUrl}/runs/${e}/share`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await Si(n,"read run shared link"),n})).json();if(!(r===null||!("share_token"in r)))return`${this.getHostUrl()}/public/${r.share_token}/r`}async listSharedRuns(e,{runIds:i}={}){const r=new URLSearchParams({share_token:e});if(i!==void 0)for(const a of i)r.append("id",a);return ar(e),await(await this.caller.call(async()=>{const a=await this._fetch(`${this.apiUrl}/public/${e}/runs${r}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await Si(a,"list shared runs"),a})).json()}async readDatasetSharedSchema(e,i){if(!e&&!i)throw new Error("Either datasetId or datasetName must be given");e||(e=(await this.readDataset({datasetName:i})).id),ar(e);const n=await(await this.caller.call(async()=>{const s=await this._fetch(`${this.apiUrl}/datasets/${e}/share`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await Si(s,"read dataset shared schema"),s})).json();return n.url=`${this.getHostUrl()}/public/${n.share_token}/d`,n}async shareDataset(e,i){if(!e&&!i)throw new Error("Either datasetId or datasetName must be given");e||(e=(await this.readDataset({datasetName:i})).id);const r={dataset_id:e};ar(e);const n=JSON.stringify(r),a=await(await this.caller.call(async()=>{const o=await this._fetch(`${this.apiUrl}/datasets/${e}/share`,{method:"PUT",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:n});return await Si(o,"share dataset"),o})).json();return a.url=`${this.getHostUrl()}/public/${a.share_token}/d`,a}async unshareDataset(e){ar(e),await this.caller.call(async()=>{const i=await this._fetch(`${this.apiUrl}/datasets/${e}/share`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await Si(i,"unshare dataset",!0),i})}async readSharedDataset(e){return ar(e),await(await this.caller.call(async()=>{const n=await this._fetch(`${this.apiUrl}/public/${e}/datasets`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await Si(n,"read shared dataset"),n})).json()}async listSharedExamples(e,i){const r={};i?.exampleIds&&(r.id=i.exampleIds);const n=new URLSearchParams;Object.entries(r).forEach(([o,l])=>{Array.isArray(l)?l.forEach(c=>n.append(o,c)):n.append(o,l)});const s=await this.caller.call(async()=>{const o=await this._fetch(`${this.apiUrl}/public/${e}/examples?${n.toString()}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await Si(o,"list shared examples"),o}),a=await s.json();if(!s.ok)throw"detail"in a?new Error(`Failed to list shared examples.
Status: ${s.status}
Message: ${Array.isArray(a.detail)?a.detail.join(`
`):"Unspecified error"}`):new Error(`Failed to list shared examples: ${s.status} ${s.statusText}`);return a.map(o=>({...o,_hostUrl:this.getHostUrl()}))}async createProject({projectName:e,description:i=null,metadata:r=null,upsert:n=!1,projectExtra:s=null,referenceDatasetId:a=null}){const o=n?"?upsert=true":"",l=`${this.apiUrl}/sessions${o}`,c=s||{};r&&(c.metadata=r);const u={name:e,extra:c,description:i};a!==null&&(u.reference_dataset_id=a);const h=JSON.stringify(u);return await(await this.caller.call(async()=>{const p=await this._fetch(l,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:h});return await Si(p,"create project"),p})).json()}async updateProject(e,{name:i=null,description:r=null,metadata:n=null,projectExtra:s=null,endTime:a=null}){const o=`${this.apiUrl}/sessions/${e}`;let l=s;n&&(l={...l||{},metadata:n});const c=JSON.stringify({name:i,extra:l,description:r,end_time:a?new Date(a).toISOString():null});return await(await this.caller.call(async()=>{const d=await this._fetch(o,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:c});return await Si(d,"update project"),d})).json()}async hasProject({projectId:e,projectName:i}){let r="/sessions";const n=new URLSearchParams;if(e!==void 0&&i!==void 0)throw new Error("Must provide either projectName or projectId, not both");if(e!==void 0)ar(e),r+=`/${e}`;else if(i!==void 0)n.append("name",i);else throw new Error("Must provide projectName or projectId");const s=await this.caller.call(async()=>{const a=await this._fetch(`${this.apiUrl}${r}?${n}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await Si(a,"has project"),a});try{const a=await s.json();return s.ok?Array.isArray(a)?a.length>0:!0:!1}catch{return!1}}async readProject({projectId:e,projectName:i,includeStats:r}){let n="/sessions";const s=new URLSearchParams;if(e!==void 0&&i!==void 0)throw new Error("Must provide either projectName or projectId, not both");if(e!==void 0)ar(e),n+=`/${e}`;else if(i!==void 0)s.append("name",i);else throw new Error("Must provide projectName or projectId");r!==void 0&&s.append("include_stats",r.toString());const a=await this._get(n,s);let o;if(Array.isArray(a)){if(a.length===0)throw new Error(`Project[id=${e}, name=${i}] not found`);o=a[0]}else o=a;return o}async getProjectUrl({projectId:e,projectName:i}){if(e===void 0&&i===void 0)throw new Error("Must provide either projectName or projectId");const r=await this.readProject({projectId:e,projectName:i}),n=await this._getTenantId();return`${this.getHostUrl()}/o/${n}/projects/p/${r.id}`}async getDatasetUrl({datasetId:e,datasetName:i}){if(e===void 0&&i===void 0)throw new Error("Must provide either datasetName or datasetId");const r=await this.readDataset({datasetId:e,datasetName:i}),n=await this._getTenantId();return`${this.getHostUrl()}/o/${n}/datasets/${r.id}`}async _getTenantId(){if(this._tenantId!==null)return this._tenantId;const e=new URLSearchParams({limit:"1"});for await(const i of this._getPaginated("/sessions",e))return this._tenantId=i[0].tenant_id,i[0].tenant_id;throw new Error("No projects found to resolve tenant.")}async*listProjects({projectIds:e,name:i,nameContains:r,referenceDatasetId:n,referenceDatasetName:s,includeStats:a,datasetVersion:o,referenceFree:l,metadata:c}={}){const u=new URLSearchParams;if(e!==void 0)for(const h of e)u.append("id",h);if(i!==void 0&&u.append("name",i),r!==void 0&&u.append("name_contains",r),n!==void 0)u.append("reference_dataset",n);else if(s!==void 0){const h=await this.readDataset({datasetName:s});u.append("reference_dataset",h.id)}a!==void 0&&u.append("include_stats",a.toString()),o!==void 0&&u.append("dataset_version",o),l!==void 0&&u.append("reference_free",l.toString()),c!==void 0&&u.append("metadata",JSON.stringify(c));for await(const h of this._getPaginated("/sessions",u))yield*h}async deleteProject({projectId:e,projectName:i}){let r;if(e===void 0&&i===void 0)throw new Error("Must provide projectName or projectId");if(e!==void 0&&i!==void 0)throw new Error("Must provide either projectName or projectId, not both");e===void 0?r=(await this.readProject({projectName:i})).id:r=e,ar(r),await this.caller.call(async()=>{const n=await this._fetch(`${this.apiUrl}/sessions/${r}`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await Si(n,`delete session ${r} (${i})`,!0),n})}async uploadCsv({csvFile:e,fileName:i,inputKeys:r,outputKeys:n,description:s,dataType:a,name:o}){const l=`${this.apiUrl}/datasets/upload`,c=new FormData;return c.append("file",e,i),r.forEach(d=>{c.append("input_keys",d)}),n.forEach(d=>{c.append("output_keys",d)}),s&&c.append("description",s),a&&c.append("data_type",a),o&&c.append("name",o),await(await this.caller.call(async()=>{const d=await this._fetch(l,{method:"POST",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:c});return await Si(d,"upload CSV"),d})).json()}async createDataset(e,{description:i,dataType:r,inputsSchema:n,outputsSchema:s,metadata:a}={}){const o={name:e,description:i,extra:a?{metadata:a}:void 0};r&&(o.data_type=r),n&&(o.inputs_schema_definition=n),s&&(o.outputs_schema_definition=s);const l=JSON.stringify(o);return await(await this.caller.call(async()=>{const h=await this._fetch(`${this.apiUrl}/datasets`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:l});return await Si(h,"create dataset"),h})).json()}async readDataset({datasetId:e,datasetName:i}){let r="/datasets";const n=new URLSearchParams({limit:"1"});if(e&&i)throw new Error("Must provide either datasetName or datasetId, not both");if(e)ar(e),r+=`/${e}`;else if(i)n.append("name",i);else throw new Error("Must provide datasetName or datasetId");const s=await this._get(r,n);let a;if(Array.isArray(s)){if(s.length===0)throw new Error(`Dataset[id=${e}, name=${i}] not found`);a=s[0]}else a=s;return a}async hasDataset({datasetId:e,datasetName:i}){try{return await this.readDataset({datasetId:e,datasetName:i}),!0}catch(r){if(r instanceof Error&&r.message.toLocaleLowerCase().includes("not found"))return!1;throw r}}async diffDatasetVersions({datasetId:e,datasetName:i,fromVersion:r,toVersion:n}){let s=e;if(s===void 0&&i===void 0)throw new Error("Must provide either datasetName or datasetId");if(s!==void 0&&i!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");s===void 0&&(s=(await this.readDataset({datasetName:i})).id);const a=new URLSearchParams({from_version:typeof r=="string"?r:r.toISOString(),to_version:typeof n=="string"?n:n.toISOString()});return await this._get(`/datasets/${s}/versions/diff`,a)}async readDatasetOpenaiFinetuning({datasetId:e,datasetName:i}){const r="/datasets";if(e===void 0)if(i!==void 0)e=(await this.readDataset({datasetName:i})).id;else throw new Error("Must provide either datasetName or datasetId");return(await(await this._getResponse(`${r}/${e}/openai_ft`)).text()).trim().split(`
`).map(o=>JSON.parse(o))}async*listDatasets({limit:e=100,offset:i=0,datasetIds:r,datasetName:n,datasetNameContains:s,metadata:a}={}){const o="/datasets",l=new URLSearchParams({limit:e.toString(),offset:i.toString()});if(r!==void 0)for(const c of r)l.append("id",c);n!==void 0&&l.append("name",n),s!==void 0&&l.append("name_contains",s),a!==void 0&&l.append("metadata",JSON.stringify(a));for await(const c of this._getPaginated(o,l))yield*c}async updateDataset(e){const{datasetId:i,datasetName:r,...n}=e;if(!i&&!r)throw new Error("Must provide either datasetName or datasetId");const s=i??(await this.readDataset({datasetName:r})).id;ar(s);const a=JSON.stringify(n);return await(await this.caller.call(async()=>{const l=await this._fetch(`${this.apiUrl}/datasets/${s}`,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:a});return await Si(l,"update dataset"),l})).json()}async updateDatasetTag(e){const{datasetId:i,datasetName:r,asOf:n,tag:s}=e;if(!i&&!r)throw new Error("Must provide either datasetName or datasetId");const a=i??(await this.readDataset({datasetName:r})).id;ar(a);const o=JSON.stringify({as_of:typeof n=="string"?n:n.toISOString(),tag:s});await this.caller.call(async()=>{const l=await this._fetch(`${this.apiUrl}/datasets/${a}/tags`,{method:"PUT",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:o});return await Si(l,"update dataset tags",!0),l})}async deleteDataset({datasetId:e,datasetName:i}){let r="/datasets",n=e;if(e!==void 0&&i!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");if(i!==void 0&&(n=(await this.readDataset({datasetName:i})).id),n!==void 0)ar(n),r+=`/${n}`;else throw new Error("Must provide datasetName or datasetId");await this.caller.call(async()=>{const s=await this._fetch(this.apiUrl+r,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await Si(s,`delete ${r}`,!0),s})}async indexDataset({datasetId:e,datasetName:i,tag:r}){let n=e;if(!n&&!i)throw new Error("Must provide either datasetName or datasetId");if(n&&i)throw new Error("Must provide either datasetName or datasetId, not both");n||(n=(await this.readDataset({datasetName:i})).id),ar(n);const a=JSON.stringify({tag:r});await(await this.caller.call(async()=>{const l=await this._fetch(`${this.apiUrl}/datasets/${n}/index`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:a});return await Si(l,"index dataset"),l})).json()}async similarExamples(e,i,r,{filter:n}={}){const s={limit:r,inputs:e};n!==void 0&&(s.filter=n),ar(i);const a=JSON.stringify(s);return(await(await this.caller.call(async()=>{const c=await this._fetch(`${this.apiUrl}/datasets/${i}/search`,{headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,method:"POST",body:a});return await Si(c,"fetch similar examples"),c})).json()).examples}async createExample(e,i,r){if(RX(e)&&(i!==void 0||r!==void 0))throw new Error("Cannot provide outputs or options when using ExampleCreate object");let n=i?r?.datasetId:e.dataset_id;const s=i?r?.datasetName:e.dataset_name;if(n===void 0&&s===void 0)throw new Error("Must provide either datasetName or datasetId");if(n!==void 0&&s!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");n===void 0&&(n=(await this.readDataset({datasetName:s})).id);const a=(i?r?.createdAt:e.created_at)||new Date;let o;RX(e)?o=e:o={inputs:e,outputs:i,created_at:a?.toISOString(),id:r?.exampleId,metadata:r?.metadata,split:r?.split,source_run_id:r?.sourceRunId,use_source_run_io:r?.useSourceRunIO,use_source_run_attachments:r?.useSourceRunAttachments,attachments:r?.attachments};const l=await this._uploadExamplesMultipart(n,[o]);return await this.readExample(l.example_ids?.[0]??dl())}async createExamples(e){if(Array.isArray(e)){if(e.length===0)return[];const b=e;let w=b[0].dataset_id;const E=b[0].dataset_name;if(w===void 0&&E===void 0)throw new Error("Must provide either datasetName or datasetId");if(w!==void 0&&E!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");w===void 0&&(w=(await this.readDataset({datasetName:E})).id);const M=await this._uploadExamplesMultipart(w,b);return await Promise.all(M.example_ids.map(P=>this.readExample(P)))}const{inputs:i,outputs:r,metadata:n,splits:s,sourceRunIds:a,useSourceRunIOs:o,useSourceRunAttachments:l,attachments:c,exampleIds:u,datasetId:h,datasetName:d}=e;if(i===void 0)throw new Error("Must provide inputs when using legacy parameters");let f=h;const p=d;if(f===void 0&&p===void 0)throw new Error("Must provide either datasetName or datasetId");if(f!==void 0&&p!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");f===void 0&&(f=(await this.readDataset({datasetName:p})).id);const g=i.map((b,w)=>({dataset_id:f,inputs:b,outputs:r?.[w],metadata:n?.[w],split:s?.[w],id:u?.[w],attachments:c?.[w],source_run_id:a?.[w],use_source_run_io:o?.[w],use_source_run_attachments:l?.[w]})),m=await this._uploadExamplesMultipart(f,g);return await Promise.all(m.example_ids.map(b=>this.readExample(b)))}async createLLMExample(e,i,r){return this.createExample({input:e},{output:i},r)}async createChatExample(e,i,r){const n=e.map(a=>Dq(a)?Oq(a):a),s=Dq(i)?Oq(i):i;return this.createExample({input:n},{output:s},r)}async readExample(e){ar(e);const i=`/examples/${e}`,r=await this._get(i),{attachment_urls:n,...s}=r,a=s;return n&&(a.attachments=Object.entries(n).reduce((o,[l,c])=>(o[l.slice(11)]={presigned_url:c.presigned_url,mime_type:c.mime_type},o),{})),a}async*listExamples({datasetId:e,datasetName:i,exampleIds:r,asOf:n,splits:s,inlineS3Urls:a,metadata:o,limit:l,offset:c,filter:u,includeAttachments:h}={}){let d;if(e!==void 0&&i!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");if(e!==void 0)d=e;else if(i!==void 0)d=(await this.readDataset({datasetName:i})).id;else throw new Error("Must provide a datasetName or datasetId");const f=new URLSearchParams({dataset:d}),p=n?typeof n=="string"?n:n?.toISOString():void 0;p&&f.append("as_of",p);const g=a??!0;if(f.append("inline_s3_urls",g.toString()),r!==void 0)for(const y of r)f.append("id",y);if(s!==void 0)for(const y of s)f.append("splits",y);if(o!==void 0){const y=JSON.stringify(o);f.append("metadata",y)}l!==void 0&&f.append("limit",l.toString()),c!==void 0&&f.append("offset",c.toString()),u!==void 0&&f.append("filter",u),h===!0&&["attachment_urls","outputs","metadata"].forEach(y=>f.append("select",y));let m=0;for await(const y of this._getPaginated("/examples",f)){for(const b of y){const{attachment_urls:w,...E}=b,M=E;w&&(M.attachments=Object.entries(w).reduce((A,[P,C])=>(A[P.slice(11)]={presigned_url:C.presigned_url,mime_type:C.mime_type||void 0},A),{})),yield M,m++}if(l!==void 0&&m>=l)break}}async deleteExample(e){ar(e);const i=`/examples/${e}`;await this.caller.call(async()=>{const r=await this._fetch(this.apiUrl+i,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await Si(r,`delete ${i}`,!0),r})}async updateExample(e,i){let r;i?r=e:r=e.id,ar(r);let n;i?n={id:r,...i}:n=e;let s;return n.dataset_id!==void 0?s=n.dataset_id:s=(await this.readExample(r)).dataset_id,this._updateExamplesMultipart(s,[n])}async updateExamples(e){let i;return e[0].dataset_id===void 0?i=(await this.readExample(e[0].id)).dataset_id:i=e[0].dataset_id,this._updateExamplesMultipart(i,e)}async readDatasetVersion({datasetId:e,datasetName:i,asOf:r,tag:n}){let s;if(e?s=e:s=(await this.readDataset({datasetName:i})).id,ar(s),r&&n||!r&&!n)throw new Error("Exactly one of asOf and tag must be specified.");const a=new URLSearchParams;return r!==void 0&&a.append("as_of",typeof r=="string"?r:r.toISOString()),n!==void 0&&a.append("tag",n),await(await this.caller.call(async()=>{const l=await this._fetch(`${this.apiUrl}/datasets/${s}/version?${a.toString()}`,{method:"GET",headers:{...this.headers},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await Si(l,"read dataset version"),l})).json()}async listDatasetSplits({datasetId:e,datasetName:i,asOf:r}){let n;if(e===void 0&&i===void 0)throw new Error("Must provide dataset name or ID");if(e!==void 0&&i!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");e===void 0?n=(await this.readDataset({datasetName:i})).id:n=e,ar(n);const s=new URLSearchParams,a=r?typeof r=="string"?r:r?.toISOString():void 0;return a&&s.append("as_of",a),await this._get(`/datasets/${n}/splits`,s)}async updateDatasetSplits({datasetId:e,datasetName:i,splitName:r,exampleIds:n,remove:s=!1}){let a;if(e===void 0&&i===void 0)throw new Error("Must provide dataset name or ID");if(e!==void 0&&i!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");e===void 0?a=(await this.readDataset({datasetName:i})).id:a=e,ar(a);const o={split_name:r,examples:n.map(c=>(ar(c),c)),remove:s},l=JSON.stringify(o);await this.caller.call(async()=>{const c=await this._fetch(`${this.apiUrl}/datasets/${a}/splits`,{method:"PUT",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:l});return await Si(c,"update dataset splits",!0),c})}async evaluateRun(e,i,{sourceInfo:r,loadChildRuns:n,referenceExample:s}={loadChildRuns:!1}){vae("This method is deprecated and will be removed in future LangSmith versions, use `evaluate` from `langsmith/evaluation` instead.");let a;if(typeof e=="string")a=await this.readRun(e,{loadChildRuns:n});else if(typeof e=="object"&&"id"in e)a=e;else throw new Error(`Invalid run type: ${typeof e}`);a.reference_example_id!==null&&a.reference_example_id!==void 0&&(s=await this.readExample(a.reference_example_id));const o=await i.evaluateRun(a,s),[l,c]=await this._logEvaluationFeedback(o,a,r);return c[0]}async createFeedback(e,i,{score:r,value:n,correction:s,comment:a,sourceInfo:o,feedbackSourceType:l="api",sourceRunId:c,feedbackId:u,feedbackConfig:h,projectId:d,comparativeExperimentId:f}){if(!e&&!d)throw new Error("One of runId or projectId must be provided");if(e&&d)throw new Error("Only one of runId or projectId can be provided");const p={type:l??"api",metadata:o??{}};c!==void 0&&p?.metadata!==void 0&&!p.metadata.__run&&(p.metadata.__run={run_id:c}),p?.metadata!==void 0&&p.metadata.__run?.run_id!==void 0&&ar(p.metadata.__run.run_id);const g={id:u??dl(),run_id:e,key:i,score:CX(r),value:n,correction:s,comment:a,feedback_source:p,comparative_experiment_id:f,feedbackConfig:h,session_id:d},m=JSON.stringify(g),y=`${this.apiUrl}/feedback`;return await this.caller.call(async()=>{const b=await this._fetch(y,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:m});return await Si(b,"create feedback",!0),b}),g}async updateFeedback(e,{score:i,value:r,correction:n,comment:s}){const a={};i!=null&&(a.score=CX(i)),r!=null&&(a.value=r),n!=null&&(a.correction=n),s!=null&&(a.comment=s),ar(e);const o=JSON.stringify(a);await this.caller.call(async()=>{const l=await this._fetch(`${this.apiUrl}/feedback/${e}`,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:o});return await Si(l,"update feedback",!0),l})}async readFeedback(e){ar(e);const i=`/feedback/${e}`;return await this._get(i)}async deleteFeedback(e){ar(e);const i=`/feedback/${e}`;await this.caller.call(async()=>{const r=await this._fetch(this.apiUrl+i,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await Si(r,`delete ${i}`,!0),r})}async*listFeedback({runIds:e,feedbackKeys:i,feedbackSourceTypes:r}={}){const n=new URLSearchParams;if(e)for(const s of e)ar(s),n.append("run",s);if(i)for(const s of i)n.append("key",s);if(r)for(const s of r)n.append("source",s);for await(const s of this._getPaginated("/feedback",n))yield*s}async createPresignedFeedbackToken(e,i,{expiration:r,feedbackConfig:n}={}){const s={run_id:e,feedback_key:i,feedback_config:n};r?typeof r=="string"?s.expires_at=r:(r?.hours||r?.minutes||r?.days)&&(s.expires_in=r):s.expires_in={hours:3};const a=JSON.stringify(s);return await(await this.caller.call(async()=>{const l=await this._fetch(`${this.apiUrl}/feedback/tokens`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:a});return await Si(l,"create presigned feedback token"),l})).json()}async createComparativeExperiment({name:e,experimentIds:i,referenceDatasetId:r,createdAt:n,description:s,metadata:a,id:o}){if(i.length===0)throw new Error("At least one experiment is required");if(r||(r=(await this.readProject({projectId:i[0]})).reference_dataset_id),!r==null)throw new Error("A reference dataset is required");const l={id:o,name:e,experiment_ids:i,reference_dataset_id:r,description:s,created_at:(n??new Date)?.toISOString(),extra:{}};a&&(l.extra.metadata=a);const c=JSON.stringify(l);return(await this.caller.call(async()=>{const h=await this._fetch(`${this.apiUrl}/datasets/comparative`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:c});return await Si(h,"create comparative experiment"),h})).json()}async*listPresignedFeedbackTokens(e){ar(e);const i=new URLSearchParams({run_id:e});for await(const r of this._getPaginated("/feedback/tokens",i))yield*r}_selectEvalResults(e){let i;return"results"in e?i=e.results:Array.isArray(e)?i=e:i=[e],i}async _logEvaluationFeedback(e,i,r){const n=this._selectEvalResults(e),s=[];for(const a of n){let o=r||{};a.evaluatorInfo&&(o={...a.evaluatorInfo,...o});let l=null;a.targetRunId?l=a.targetRunId:i&&(l=i.id),s.push(await this.createFeedback(l,a.key,{score:a.score,value:a.value,comment:a.comment,correction:a.correction,sourceInfo:o,sourceRunId:a.sourceRunId,feedbackConfig:a.feedbackConfig,feedbackSourceType:"model"}))}return[n,s]}async logEvaluationFeedback(e,i,r){const[n]=await this._logEvaluationFeedback(e,i,r);return n}async*listAnnotationQueues(e={}){const{queueIds:i,name:r,nameContains:n,limit:s}=e,a=new URLSearchParams;i&&i.forEach((l,c)=>{ar(l,`queueIds[${c}]`),a.append("ids",l)}),r&&a.append("name",r),n&&a.append("name_contains",n),a.append("limit",(s!==void 0?Math.min(s,100):100).toString());let o=0;for await(const l of this._getPaginated("/annotation-queues",a))if(yield*l,o++,s!==void 0&&o>=s)break}async createAnnotationQueue(e){const{name:i,description:r,queueId:n,rubricInstructions:s}=e,a={name:i,description:r,id:n||dl(),rubric_instructions:s},o=JSON.stringify(Object.fromEntries(Object.entries(a).filter(([c,u])=>u!==void 0)));return(await this.caller.call(async()=>{const c=await this._fetch(`${this.apiUrl}/annotation-queues`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:o});return await Si(c,"create annotation queue"),c})).json()}async readAnnotationQueue(e){return(await this.caller.call(async()=>{const r=await this._fetch(`${this.apiUrl}/annotation-queues/${ar(e,"queueId")}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await Si(r,"read annotation queue"),r})).json()}async updateAnnotationQueue(e,i){const{name:r,description:n,rubricInstructions:s}=i,a=JSON.stringify({name:r,description:n,rubric_instructions:s});await this.caller.call(async()=>{const o=await this._fetch(`${this.apiUrl}/annotation-queues/${ar(e,"queueId")}`,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:a});return await Si(o,"update annotation queue",!0),o})}async deleteAnnotationQueue(e){await this.caller.call(async()=>{const i=await this._fetch(`${this.apiUrl}/annotation-queues/${ar(e,"queueId")}`,{method:"DELETE",headers:{...this.headers,Accept:"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await Si(i,"delete annotation queue",!0),i})}async addRunsToAnnotationQueue(e,i){const r=JSON.stringify(i.map((n,s)=>ar(n,`runIds[${s}]`).toString()));await this.caller.call(async()=>{const n=await this._fetch(`${this.apiUrl}/annotation-queues/${ar(e,"queueId")}/runs`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:r});return await Si(n,"add runs to annotation queue",!0),n})}async getRunFromAnnotationQueue(e,i){const r=`/annotation-queues/${ar(e,"queueId")}/run`;return(await this.caller.call(async()=>{const s=await this._fetch(`${this.apiUrl}${r}/${i}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await Si(s,"get run from annotation queue"),s})).json()}async deleteRunFromAnnotationQueue(e,i){await this.caller.call(async()=>{const r=await this._fetch(`${this.apiUrl}/annotation-queues/${ar(e,"queueId")}/runs/${ar(i,"queueRunId")}`,{method:"DELETE",headers:{...this.headers,Accept:"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await Si(r,"delete run from annotation queue",!0),r})}async getSizeFromAnnotationQueue(e){return(await this.caller.call(async()=>{const r=await this._fetch(`${this.apiUrl}/annotation-queues/${ar(e,"queueId")}/size`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await Si(r,"get size from annotation queue"),r})).json()}async _currentTenantIsOwner(e){const i=await this._getSettings();return e=="-"||i.tenant_handle===e}async _ownerConflictError(e,i){const r=await this._getSettings();return new Error(`Cannot ${e} for another tenant.

      Current tenant: ${r.tenant_handle}

      Requested tenant: ${i}`)}async _getLatestCommitHash(e){const r=await(await this.caller.call(async()=>{const n=await this._fetch(`${this.apiUrl}/commits/${e}/?limit=1&offset=0`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await Si(n,"get latest commit hash"),n})).json();if(r.commits.length!==0)return r.commits[0].commit_hash}async _likeOrUnlikePrompt(e,i){const[r,n,s]=km(e),a=JSON.stringify({like:i});return(await this.caller.call(async()=>{const l=await this._fetch(`${this.apiUrl}/likes/${r}/${n}`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:a});return await Si(l,`${i?"like":"unlike"} prompt`),l})).json()}async _getPromptUrl(e){const[i,r,n]=km(e);if(await this._currentTenantIsOwner(i)){const s=await this._getSettings();return n!=="latest"?`${this.getHostUrl()}/prompts/${r}/${n.substring(0,8)}?organizationId=${s.id}`:`${this.getHostUrl()}/prompts/${r}?organizationId=${s.id}`}else return n!=="latest"?`${this.getHostUrl()}/hub/${i}/${r}/${n.substring(0,8)}`:`${this.getHostUrl()}/hub/${i}/${r}`}async promptExists(e){return!!await this.getPrompt(e)}async likePrompt(e){return this._likeOrUnlikePrompt(e,!0)}async unlikePrompt(e){return this._likeOrUnlikePrompt(e,!1)}async*listCommits(e){for await(const i of this._getPaginated(`/commits/${e}/`,new URLSearchParams,r=>r.commits))yield*i}async*listPrompts(e){const i=new URLSearchParams;i.append("sort_field",e?.sortField??"updated_at"),i.append("sort_direction","desc"),i.append("is_archived",(!!e?.isArchived).toString()),e?.isPublic!==void 0&&i.append("is_public",e.isPublic.toString()),e?.query&&i.append("query",e.query);for await(const r of this._getPaginated("/repos",i,n=>n.repos))yield*r}async getPrompt(e){const[i,r,n]=km(e),a=await(await this.caller.call(async()=>{const o=await this._fetch(`${this.apiUrl}/repos/${i}/${r}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return o?.status===404?null:(await Si(o,"get prompt"),o)}))?.json();return a?.repo?a.repo:null}async createPrompt(e,i){const r=await this._getSettings();if(i?.isPublic&&!r.tenant_handle)throw new Error(`Cannot create a public prompt without first

        creating a LangChain Hub handle.
        You can add a handle by creating a public prompt at:

        https://smith.langchain.com/prompts`);const[n,s,a]=km(e);if(!await this._currentTenantIsOwner(n))throw await this._ownerConflictError("create a prompt",n);const o={repo_handle:s,...i?.description&&{description:i.description},...i?.readme&&{readme:i.readme},...i?.tags&&{tags:i.tags},is_public:!!i?.isPublic},l=JSON.stringify(o),c=await this.caller.call(async()=>{const h=await this._fetch(`${this.apiUrl}/repos/`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:l});return await Si(h,"create prompt"),h}),{repo:u}=await c.json();return u}async createCommit(e,i,r){if(!await this.promptExists(e))throw new Error("Prompt does not exist, you must create it first.");const[n,s,a]=km(e),o=r?.parentCommitHash==="latest"||!r?.parentCommitHash?await this._getLatestCommitHash(`${n}/${s}`):r?.parentCommitHash,l={manifest:JSON.parse(JSON.stringify(i)),parent_commit:o},c=JSON.stringify(l),h=await(await this.caller.call(async()=>{const d=await this._fetch(`${this.apiUrl}/commits/${n}/${s}`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:c});return await Si(d,"create commit"),d})).json();return this._getPromptUrl(`${n}/${s}${h.commit_hash?`:${h.commit_hash}`:""}`)}async updateExamplesMultipart(e,i=[]){return this._updateExamplesMultipart(e,i)}async _updateExamplesMultipart(e,i=[]){if(!await this._getDatasetExamplesMultiPartSupport())throw new Error("Your LangSmith deployment does not allow using the multipart examples endpoint, please upgrade your deployment to the latest version.");const r=new FormData;for(const a of i){const o=a.id,l={...a.metadata&&{metadata:a.metadata},...a.split&&{split:a.split}},c=Ac(l,`Serializing body for example with id: ${o}`),u=new Blob([c],{type:"application/json"});if(r.append(o,u),a.inputs){const h=Ac(a.inputs,`Serializing inputs for example with id: ${o}`),d=new Blob([h],{type:"application/json"});r.append(`${o}.inputs`,d)}if(a.outputs){const h=Ac(a.outputs,`Serializing outputs whle updating example with id: ${o}`),d=new Blob([h],{type:"application/json"});r.append(`${o}.outputs`,d)}if(a.attachments)for(const[h,d]of Object.entries(a.attachments)){let f,p;Array.isArray(d)?[f,p]=d:(f=d.mimeType,p=d.data);const g=new Blob([p],{type:`${f}; length=${p.byteLength}`});r.append(`${o}.attachment.${h}`,g)}if(a.attachments_operations){const h=Ac(a.attachments_operations,`Serializing attachments while updating example with id: ${o}`),d=new Blob([h],{type:"application/json"});r.append(`${o}.attachments_operations`,d)}}const n=e??i[0]?.dataset_id;return(await this.caller.call(async()=>{const a=await this._fetch(`${this.apiUrl}${this._getPlatformEndpointPath(`datasets/${n}/examples`)}`,{method:"PATCH",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:r});return await Si(a,"update examples"),a})).json()}async uploadExamplesMultipart(e,i=[]){return this._uploadExamplesMultipart(e,i)}async _uploadExamplesMultipart(e,i=[]){if(!await this._getDatasetExamplesMultiPartSupport())throw new Error("Your LangSmith deployment does not allow using the multipart examples endpoint, please upgrade your deployment to the latest version.");const r=new FormData;for(const s of i){const a=(s.id??dl()).toString(),o={created_at:s.created_at,...s.metadata&&{metadata:s.metadata},...s.split&&{split:s.split},...s.source_run_id&&{source_run_id:s.source_run_id},...s.use_source_run_io&&{use_source_run_io:s.use_source_run_io},...s.use_source_run_attachments&&{use_source_run_attachments:s.use_source_run_attachments}},l=Ac(o,`Serializing body for uploaded example with id: ${a}`),c=new Blob([l],{type:"application/json"});if(r.append(a,c),s.inputs){const u=Ac(s.inputs,`Serializing inputs for uploaded example with id: ${a}`),h=new Blob([u],{type:"application/json"});r.append(`${a}.inputs`,h)}if(s.outputs){const u=Ac(s.outputs,`Serializing outputs for uploaded example with id: ${a}`),h=new Blob([u],{type:"application/json"});r.append(`${a}.outputs`,h)}if(s.attachments)for(const[u,h]of Object.entries(s.attachments)){let d,f;Array.isArray(h)?[d,f]=h:(d=h.mimeType,f=h.data);const p=new Blob([f],{type:`${d}; length=${f.byteLength}`});r.append(`${a}.attachment.${u}`,p)}}return(await this.caller.call(async()=>{const s=await this._fetch(`${this.apiUrl}${this._getPlatformEndpointPath(`datasets/${e}/examples`)}`,{method:"POST",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:r});return await Si(s,"upload examples"),s})).json()}async updatePrompt(e,i){if(!await this.promptExists(e))throw new Error("Prompt does not exist, you must create it first.");const[r,n]=km(e);if(!await this._currentTenantIsOwner(r))throw await this._ownerConflictError("update a prompt",r);const s={};if(i?.description!==void 0&&(s.description=i.description),i?.readme!==void 0&&(s.readme=i.readme),i?.tags!==void 0&&(s.tags=i.tags),i?.isPublic!==void 0&&(s.is_public=i.isPublic),i?.isArchived!==void 0&&(s.is_archived=i.isArchived),Object.keys(s).length===0)throw new Error("No valid update options provided");const a=JSON.stringify(s);return(await this.caller.call(async()=>{const l=await this._fetch(`${this.apiUrl}/repos/${r}/${n}`,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:a});return await Si(l,"update prompt"),l})).json()}async deletePrompt(e){if(!await this.promptExists(e))throw new Error("Prompt does not exist, you must create it first.");const[i,r,n]=km(e);if(!await this._currentTenantIsOwner(i))throw await this._ownerConflictError("delete a prompt",i);return(await this.caller.call(async()=>{const a=await this._fetch(`${this.apiUrl}/repos/${i}/${r}`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await Si(a,"delete prompt"),a})).json()}async pullPromptCommit(e,i){const[r,n,s]=km(e),o=await(await this.caller.call(async()=>{const l=await this._fetch(`${this.apiUrl}/commits/${r}/${n}/${s}${i?.includeModel?"?include_model=true":""}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await Si(l,"pull prompt commit"),l})).json();return{owner:r,repo:n,commit_hash:o.commit_hash,manifest:o.manifest,examples:o.examples}}async _pullPrompt(e,i){const r=await this.pullPromptCommit(e,{includeModel:i?.includeModel});return JSON.stringify(r.manifest)}async pushPrompt(e,i){return await this.promptExists(e)?i&&Object.keys(i).some(n=>n!=="object")&&await this.updatePrompt(e,{description:i?.description,readme:i?.readme,tags:i?.tags,isPublic:i?.isPublic}):await this.createPrompt(e,{description:i?.description,readme:i?.readme,tags:i?.tags,isPublic:i?.isPublic}),i?.object?await this.createCommit(e,i?.object,{parentCommitHash:i?.parentCommitHash}):await this._getPromptUrl(e)}async clonePublicDataset(e,i={}){const{sourceApiUrl:r=this.apiUrl,datasetName:n}=i,[s,a]=this.parseTokenOrUrl(e,r),o=new nM({apiUrl:s,apiKey:"placeholder"}),l=await o.readSharedDataset(a),c=n||l.name;try{if(await this.hasDataset({datasetId:c})){console.log(`Dataset ${c} already exists in your tenant. Skipping.`);return}}catch{}const u=await o.listSharedExamples(a),h=await this.createDataset(c,{description:l.description,dataType:l.data_type||"kv",inputsSchema:l.inputs_schema_definition??void 0,outputsSchema:l.outputs_schema_definition??void 0});try{await this.createExamples({inputs:u.map(d=>d.inputs),outputs:u.flatMap(d=>d.outputs?[d.outputs]:[]),datasetId:h.id})}catch(d){throw console.error(`An error occurred while creating dataset ${c}. You should delete it manually.`),d}}parseTokenOrUrl(e,i,r=2,n="dataset"){try{return ar(e),[i,e]}catch{}try{const a=new URL(e).pathname.split("/").filter(o=>o!=="");if(a.length>=r){const o=a[a.length-r];return[i,o]}else throw new Error(`Invalid public ${n} URL: ${e}`)}catch{throw new Error(`Invalid public ${n} URL or token: ${e}`)}}async awaitPendingTraceBatches(){if(this.manualFlushMode)return console.warn("[WARNING]: When tracing in manual flush mode, you must call `await client.flush()` manually to submit trace batches."),Promise.resolve();await Promise.all([...this.autoBatchQueue.items.map(({itemPromise:e})=>e),this.batchIngestCaller.queue.onIdle()]),this.langSmithToOTELTranslator!==void 0&&await cCe()?.DEFAULT_LANGSMITH_SPAN_PROCESSOR?.forceFlush()}}function RX(t){return"dataset_id"in t||"dataset_name"in t}const c2e=t=>!!["TRACING_V2","TRACING"].find(i=>Xl(i)==="true"),QN=Symbol.for("lc:context_variables");function u2e(t){return t.replace(/[-:.]/g,"")}function Eae(t,e,i=1){const r=i.toFixed(0).slice(0,3).padStart(3,"0"),n=`${new Date(t).toISOString().slice(0,-1)}${r}Z`;return{dottedOrder:u2e(n)+e,microsecondPrecisionDatestring:n}}class kI{constructor(e,i,r,n){Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"project_name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"replicas",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.metadata=e,this.tags=i,this.project_name=r,this.replicas=n}static fromHeader(e){const i=e.split(",");let r={},n=[],s,a;for(const o of i){const[l,c]=o.split("="),u=decodeURIComponent(c);l==="langsmith-metadata"?r=JSON.parse(u):l==="langsmith-tags"?n=u.split(","):l==="langsmith-project"?s=u:l==="langsmith-replicas"&&(a=JSON.parse(u))}return new kI(r,n,s,a)}toHeader(){const e=[];return this.metadata&&Object.keys(this.metadata).length>0&&e.push(`langsmith-metadata=${encodeURIComponent(JSON.stringify(this.metadata))}`),this.tags&&this.tags.length>0&&e.push(`langsmith-tags=${encodeURIComponent(this.tags.join(","))}`),this.project_name&&e.push(`langsmith-project=${encodeURIComponent(this.project_name)}`),e.join(",")}}class Hl{constructor(e){if(Object.defineProperty(this,"id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"run_type",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"project_name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"parent_run",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"parent_run_id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"child_runs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"start_time",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"end_time",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"extra",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"error",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"serialized",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"inputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"outputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"reference_example_id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"events",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"trace_id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"dotted_order",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tracingEnabled",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"execution_order",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"child_execution_order",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"attachments",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"replicas",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_serialized_start_time",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),h2e(e)){Object.assign(this,{...e});return}const i=Hl.getDefaultConfig(),{metadata:r,...n}=e,s=n.client??Hl.getSharedClient(),a={...r,...n?.extra?.metadata};if(n.extra={...n.extra,metadata:a},Object.assign(this,{...i,...n,client:s}),this.trace_id||(this.parent_run?this.trace_id=this.parent_run.trace_id??this.id:this.trace_id=this.id),this.replicas=g2e(this.replicas),this.execution_order??=1,this.child_execution_order??=1,!this.dotted_order){const{dottedOrder:o,microsecondPrecisionDatestring:l}=Eae(this.start_time,this.id,this.execution_order);this.parent_run?this.dotted_order=this.parent_run.dotted_order+"."+o:this.dotted_order=o,this._serialized_start_time=l}}set metadata(e){this.extra={...this.extra,metadata:{...this.extra?.metadata,...e}}}get metadata(){return this.extra?.metadata}static getDefaultConfig(){return{id:dl(),run_type:"chain",project_name:uae(),child_runs:[],api_url:Zd("LANGCHAIN_ENDPOINT")??"http://localhost:1984",api_key:Zd("LANGCHAIN_API_KEY"),caller_options:{},start_time:Date.now(),serialized:{},inputs:{},extra:{}}}static getSharedClient(){return Hl.sharedClient||(Hl.sharedClient=new nM),Hl.sharedClient}createChild(e){const i=this.child_execution_order+1,r=new Hl({...e,parent_run:this,project_name:this.project_name,replicas:this.replicas,client:this.client,tracingEnabled:this.tracingEnabled,execution_order:i,child_execution_order:i});QN in this&&(r[QN]=this[QN]);const n=Symbol.for("lc:child_config"),s=e.extra?.[n]??this.extra[n];if(f2e(s)){const l={...s},c=d2e(l.callbacks)?l.callbacks.copy?.():void 0;c&&(Object.assign(c,{_parentRunId:r.id}),c.handlers?.find(Aae)?.updateFromRunTree?.(r),l.callbacks=c),r.extra[n]=l}const a=new Set;let o=this;for(;o!=null&&!a.has(o.id);)a.add(o.id),o.child_execution_order=Math.max(o.child_execution_order,i),o=o.parent_run;return this.child_runs.push(r),r}async end(e,i,r=Date.now(),n){this.outputs=this.outputs??e,this.error=this.error??i,this.end_time=this.end_time??r,n&&Object.keys(n).length>0&&(this.extra=this.extra?{...this.extra,metadata:{...this.extra.metadata,...n}}:{metadata:n})}_convertToCreate(e,i,r=!0){const n=e.extra??{};if(n?.runtime?.library===void 0&&(n.runtime||(n.runtime={}),i))for(const[o,l]of Object.entries(i))n.runtime[o]||(n.runtime[o]=l);let s,a;return r?(a=e.parent_run?.id??e.parent_run_id,s=[]):(s=e.child_runs.map(o=>this._convertToCreate(o,i,r)),a=void 0),{id:e.id,name:e.name,start_time:e._serialized_start_time??e.start_time,end_time:e.end_time,run_type:e.run_type,reference_example_id:e.reference_example_id,extra:n,serialized:e.serialized,error:e.error,inputs:e.inputs,outputs:e.outputs,session_name:e.project_name,child_runs:s,parent_run_id:a,trace_id:e.trace_id,dotted_order:e.dotted_order,tags:e.tags,attachments:e.attachments,events:e.events}}_remapForProject(e,i,r=!0){const n=this._convertToCreate(this,i,r);if(e===this.project_name)return n;const s=h=>vq(`${h}:${e}`,vq.DNS),a=s(n.id),o=n.trace_id?s(n.trace_id):void 0,l=n.parent_run_id?s(n.parent_run_id):void 0;let c;if(n.dotted_order){const h=p2e(n.dotted_order),d=[];for(let p=0;p<h.length-1;p++){const[g,m]=h[p],y=s(m);d.push(g.toISOString().replace(/[-:]/g,"").replace(".","")+y)}const[f]=h[h.length-1];d.push(f.toISOString().replace(/[-:]/g,"").replace(".","")+a),c=d.join(".")}else c=void 0;return{...n,id:a,trace_id:o,parent_run_id:l,dotted_order:c,session_name:e}}async postRun(e=!0){try{const i=pae();if(this.replicas&&this.replicas.length>0)for(const{projectName:r,apiKey:n,apiUrl:s,workspaceId:a}of this.replicas){const o=this._remapForProject(r??this.project_name,i,!0);await this.client.createRun(o,{apiKey:n,apiUrl:s,workspaceId:a})}else{const r=this._convertToCreate(this,i,e);await this.client.createRun(r)}if(!e){vae("Posting with excludeChildRuns=false is deprecated and will be removed in a future version.");for(const r of this.child_runs)await r.postRun(!1)}}catch(i){console.error(`Error in postRun for run ${this.id}:`,i)}}async patchRun(e){if(this.replicas&&this.replicas.length>0)for(const{projectName:i,apiKey:r,apiUrl:n,workspaceId:s,updates:a}of this.replicas){const o=this._remapForProject(i??this.project_name),l={id:o.id,outputs:o.outputs,error:o.error,parent_run_id:o.parent_run_id,session_name:o.session_name,reference_example_id:o.reference_example_id,end_time:o.end_time,dotted_order:o.dotted_order,trace_id:o.trace_id,events:o.events,tags:o.tags,extra:o.extra,attachments:this.attachments,...a};e?.excludeInputs||(l.inputs=o.inputs),await this.client.updateRun(o.id,l,{apiKey:r,apiUrl:n,workspaceId:s})}else try{const i={end_time:this.end_time,error:this.error,outputs:this.outputs,parent_run_id:this.parent_run?.id??this.parent_run_id,reference_example_id:this.reference_example_id,extra:this.extra,events:this.events,dotted_order:this.dotted_order,trace_id:this.trace_id,tags:this.tags,attachments:this.attachments,session_name:this.project_name};e?.excludeInputs||(i.inputs=this.inputs),await this.client.updateRun(this.id,i)}catch(i){console.error(`Error in patchRun for run ${this.id}`,i)}}toJSON(){return this._convertToCreate(this,void 0,!1)}addEvent(e){this.events||(this.events=[]),typeof e=="string"?this.events.push({name:"event",time:new Date().toISOString(),message:e}):this.events.push({...e,time:e.time??new Date().toISOString()})}static fromRunnableConfig(e,i){const r=e?.callbacks;let n,s,a,o=c2e();if(r){const c=r?.getParentRunId?.()??"",u=r?.handlers?.find(h=>h?.name=="langchain_tracer");n=u?.getRun?.(c),s=u?.projectName,a=u?.client,o=o||!!u}return n?new Hl({name:n.name,id:n.id,trace_id:n.trace_id,dotted_order:n.dotted_order,client:a,tracingEnabled:o,project_name:s,tags:[...new Set((n?.tags??[]).concat(e?.tags??[]))],extra:{metadata:{...n?.extra?.metadata,...e?.metadata}}}).createChild(i):new Hl({...i,client:a,tracingEnabled:o,project_name:s})}static fromDottedOrder(e){return this.fromHeaders({"langsmith-trace":e})}static fromHeaders(e,i){const r="get"in e&&typeof e.get=="function"?{"langsmith-trace":e.get("langsmith-trace"),baggage:e.get("baggage")}:e,n=r["langsmith-trace"];if(!n||typeof n!="string")return;const s=n.trim(),a=s.split(".").map(c=>{const[u,h]=c.split("Z");return{strTime:u,time:Date.parse(u+"Z"),uuid:h}}),o=a[0].uuid,l={...i,name:i?.name??"parent",run_type:i?.run_type??"chain",start_time:i?.start_time??Date.now(),id:a.at(-1)?.uuid,trace_id:o,dotted_order:s};if(r.baggage&&typeof r.baggage=="string"){const c=kI.fromHeader(r.baggage);l.metadata=c.metadata,l.tags=c.tags,l.project_name=c.project_name,l.replicas=c.replicas}return new Hl(l)}toHeaders(e){const i={"langsmith-trace":this.dotted_order,baggage:new kI(this.extra?.metadata,this.tags,this.project_name,this.replicas).toHeader()};if(e)for(const[r,n]of Object.entries(i))e.set(r,n);return i}}Object.defineProperty(Hl,"sharedClient",{enumerable:!0,configurable:!0,writable:!0,value:null});function h2e(t){return t!=null&&typeof t.createChild=="function"&&typeof t.postRun=="function"}function Aae(t){return typeof t=="object"&&t!=null&&typeof t.name=="string"&&t.name==="langchain_tracer"}function IX(t){return Array.isArray(t)&&t.some(e=>Aae(e))}function d2e(t){return typeof t=="object"&&t!=null&&Array.isArray(t.handlers)}function f2e(t){return t!=null&&typeof t.callbacks=="object"&&(IX(t.callbacks?.handlers)||IX(t.callbacks))}function p2e(t){return t.split(".").map(i=>{const r=i.slice(0,-36),n=i.slice(-36),s=parseInt(r.slice(0,4)),a=parseInt(r.slice(4,6))-1,o=parseInt(r.slice(6,8)),l=parseInt(r.slice(9,11)),c=parseInt(r.slice(11,13)),u=parseInt(r.slice(13,15)),h=parseInt(r.slice(15,21));return[new Date(s,a,o,l,c,u,h/1e3),n]})}function m2e(){const t=Zd("LANGSMITH_RUNS_ENDPOINTS");if(!t)return[];try{const e=JSON.parse(t);if(Array.isArray(e)){const i=[];for(const r of e){if(typeof r!="object"||r===null){console.warn(`Invalid item type in LANGSMITH_RUNS_ENDPOINTS: expected object, got ${typeof r}`);continue}if(typeof r.api_url!="string"){console.warn(`Invalid api_url type in LANGSMITH_RUNS_ENDPOINTS: expected string, got ${typeof r.api_url}`);continue}if(typeof r.api_key!="string"){console.warn(`Invalid api_key type in LANGSMITH_RUNS_ENDPOINTS: expected string, got ${typeof r.api_key}`);continue}i.push({apiUrl:r.api_url.replace(/\/$/,""),apiKey:r.api_key})}return i}else if(typeof e=="object"&&e!==null){v2e(e);const i=[];for(const[r,n]of Object.entries(e)){const s=r.replace(/\/$/,"");if(typeof n=="string")i.push({apiUrl:s,apiKey:n});else{console.warn(`Invalid value type in LANGSMITH_RUNS_ENDPOINTS for URL ${r}: expected string, got ${typeof n}`);continue}}return i}else return console.warn(`Invalid LANGSMITH_RUNS_ENDPOINTS  must be valid JSON array of objects with api_url and api_key properties, or object mapping url->apiKey, got ${typeof e}`),[]}catch(e){if(YCe(e))throw e;return console.warn("Invalid LANGSMITH_RUNS_ENDPOINTS  must be valid JSON array of objects with api_url and api_key properties, or object mapping url->apiKey"),[]}}function g2e(t){return t?t.map(e=>Array.isArray(e)?{projectName:e[0],updates:e[1]}:e):m2e()}function v2e(t){if(Object.keys(t).length>0&&Xl("ENDPOINT"))throw new $Ce}class y2e{}function x2e(t){return"lc_prefer_streaming"in t&&t.lc_prefer_streaming}class hT extends y2e{get lc_namespace(){return["langchain_core","callbacks",this.name]}get lc_secrets(){}get lc_attributes(){}get lc_aliases(){}get lc_serializable_keys(){}static lc_name(){return this.name}get lc_id(){return[...this.lc_namespace,eae(this.constructor)]}constructor(e){super(),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lc_kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"ignoreLLM",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"ignoreChain",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"ignoreAgent",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"ignoreRetriever",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"ignoreCustomEvent",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"raiseError",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"awaitHandlers",{enumerable:!0,configurable:!0,writable:!0,value:c0("LANGCHAIN_CALLBACKS_BACKGROUND")==="false"}),this.lc_kwargs=e||{},e&&(this.ignoreLLM=e.ignoreLLM??this.ignoreLLM,this.ignoreChain=e.ignoreChain??this.ignoreChain,this.ignoreAgent=e.ignoreAgent??this.ignoreAgent,this.ignoreRetriever=e.ignoreRetriever??this.ignoreRetriever,this.ignoreCustomEvent=e.ignoreCustomEvent??this.ignoreCustomEvent,this.raiseError=e.raiseError??this.raiseError,this.awaitHandlers=this.raiseError||(e._awaitHandler??this.awaitHandlers))}copy(){return new this.constructor(this)}toJSON(){return S0.prototype.toJSON.call(this)}toJSONNotImplemented(){return S0.prototype.toJSONNotImplemented.call(this)}static fromMethods(e){class i extends hT{constructor(){super(),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:dl()}),Object.assign(this,e)}}return new i}}const b2e=t=>{const e=t;return e!==void 0&&typeof e.copy=="function"&&typeof e.name=="string"&&typeof e.awaitHandlers=="boolean"},w2e=t=>{if(t)return t.events=t.events??[],t.child_runs=t.child_runs??[],t};function kz(t,e){if(t)return new Hl({...t,start_time:t._serialized_start_time??t.start_time,parent_run:kz(e),child_runs:t.child_runs.map(i=>kz(i)).filter(i=>i!==void 0),extra:{...t.extra,runtime:$Ae()},tracingEnabled:!1})}function JN(t,e){return t&&!Array.isArray(t)&&typeof t=="object"?t:{[e]:t}}function jS(t){return typeof t._addRunToRunMap=="function"}class dT extends hT{constructor(e){super(...arguments),Object.defineProperty(this,"runMap",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"runTreeMap",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"usesRunTreeMap",{enumerable:!0,configurable:!0,writable:!0,value:!1})}copy(){return this}getRunById(e){if(e!==void 0)return this.usesRunTreeMap?w2e(this.runTreeMap.get(e)):this.runMap.get(e)}stringifyError(e){return e instanceof Error?e.message+(e?.stack?`

${e.stack}`:""):typeof e=="string"?e:`${e}`}_addChildRun(e,i){e.child_runs.push(i)}_addRunToRunMap(e){const{dottedOrder:i,microsecondPrecisionDatestring:r}=Eae(new Date(e.start_time).getTime(),e.id,e.execution_order),n={...e},s=this.getRunById(n.parent_run_id);if(n.parent_run_id!==void 0?s&&(this._addChildRun(s,n),s.child_execution_order=Math.max(s.child_execution_order,n.child_execution_order),n.trace_id=s.trace_id,s.dotted_order!==void 0&&(n.dotted_order=[s.dotted_order,i].join("."),n._serialized_start_time=r)):(n.trace_id=n.id,n.dotted_order=i,n._serialized_start_time=r),this.usesRunTreeMap){const a=kz(n,s);a!==void 0&&this.runTreeMap.set(n.id,a)}else this.runMap.set(n.id,n);return n}async _endTrace(e){const i=e.parent_run_id!==void 0&&this.getRunById(e.parent_run_id);i?i.child_execution_order=Math.max(i.child_execution_order,e.child_execution_order):await this.persistRun(e),await this.onRunUpdate?.(e),this.usesRunTreeMap?this.runTreeMap.delete(e.id):this.runMap.delete(e.id)}_getExecutionOrder(e){const i=e!==void 0&&this.getRunById(e);return i?i.child_execution_order+1:1}_createRunForLLMStart(e,i,r,n,s,a,o,l){const c=this._getExecutionOrder(n),u=Date.now(),h=o?{...s,metadata:o}:s,d={id:r,name:l??e.id[e.id.length-1],parent_run_id:n,start_time:u,serialized:e,events:[{name:"start",time:new Date(u).toISOString()}],inputs:{prompts:i},execution_order:c,child_runs:[],child_execution_order:c,run_type:"llm",extra:h??{},tags:a||[]};return this._addRunToRunMap(d)}async handleLLMStart(e,i,r,n,s,a,o,l){const c=this.getRunById(r)??this._createRunForLLMStart(e,i,r,n,s,a,o,l);return await this.onRunCreate?.(c),await this.onLLMStart?.(c),c}_createRunForChatModelStart(e,i,r,n,s,a,o,l){const c=this._getExecutionOrder(n),u=Date.now(),h=o?{...s,metadata:o}:s,d={id:r,name:l??e.id[e.id.length-1],parent_run_id:n,start_time:u,serialized:e,events:[{name:"start",time:new Date(u).toISOString()}],inputs:{messages:i},execution_order:c,child_runs:[],child_execution_order:c,run_type:"llm",extra:h??{},tags:a||[]};return this._addRunToRunMap(d)}async handleChatModelStart(e,i,r,n,s,a,o,l){const c=this.getRunById(r)??this._createRunForChatModelStart(e,i,r,n,s,a,o,l);return await this.onRunCreate?.(c),await this.onLLMStart?.(c),c}async handleLLMEnd(e,i,r,n,s){const a=this.getRunById(i);if(!a||a?.run_type!=="llm")throw new Error("No LLM run to end.");return a.end_time=Date.now(),a.outputs=e,a.events.push({name:"end",time:new Date(a.end_time).toISOString()}),a.extra={...a.extra,...s},await this.onLLMEnd?.(a),await this._endTrace(a),a}async handleLLMError(e,i,r,n,s){const a=this.getRunById(i);if(!a||a?.run_type!=="llm")throw new Error("No LLM run to end.");return a.end_time=Date.now(),a.error=this.stringifyError(e),a.events.push({name:"error",time:new Date(a.end_time).toISOString()}),a.extra={...a.extra,...s},await this.onLLMError?.(a),await this._endTrace(a),a}_createRunForChainStart(e,i,r,n,s,a,o,l){const c=this._getExecutionOrder(n),u=Date.now(),h={id:r,name:l??e.id[e.id.length-1],parent_run_id:n,start_time:u,serialized:e,events:[{name:"start",time:new Date(u).toISOString()}],inputs:i,execution_order:c,child_execution_order:c,run_type:o??"chain",child_runs:[],extra:a?{metadata:a}:{},tags:s||[]};return this._addRunToRunMap(h)}async handleChainStart(e,i,r,n,s,a,o,l){const c=this.getRunById(r)??this._createRunForChainStart(e,i,r,n,s,a,o,l);return await this.onRunCreate?.(c),await this.onChainStart?.(c),c}async handleChainEnd(e,i,r,n,s){const a=this.getRunById(i);if(!a)throw new Error("No chain run to end.");return a.end_time=Date.now(),a.outputs=JN(e,"output"),a.events.push({name:"end",time:new Date(a.end_time).toISOString()}),s?.inputs!==void 0&&(a.inputs=JN(s.inputs,"input")),await this.onChainEnd?.(a),await this._endTrace(a),a}async handleChainError(e,i,r,n,s){const a=this.getRunById(i);if(!a)throw new Error("No chain run to end.");return a.end_time=Date.now(),a.error=this.stringifyError(e),a.events.push({name:"error",time:new Date(a.end_time).toISOString()}),s?.inputs!==void 0&&(a.inputs=JN(s.inputs,"input")),await this.onChainError?.(a),await this._endTrace(a),a}_createRunForToolStart(e,i,r,n,s,a,o){const l=this._getExecutionOrder(n),c=Date.now(),u={id:r,name:o??e.id[e.id.length-1],parent_run_id:n,start_time:c,serialized:e,events:[{name:"start",time:new Date(c).toISOString()}],inputs:{input:i},execution_order:l,child_execution_order:l,run_type:"tool",child_runs:[],extra:a?{metadata:a}:{},tags:s||[]};return this._addRunToRunMap(u)}async handleToolStart(e,i,r,n,s,a,o){const l=this.getRunById(r)??this._createRunForToolStart(e,i,r,n,s,a,o);return await this.onRunCreate?.(l),await this.onToolStart?.(l),l}async handleToolEnd(e,i){const r=this.getRunById(i);if(!r||r?.run_type!=="tool")throw new Error("No tool run to end");return r.end_time=Date.now(),r.outputs={output:e},r.events.push({name:"end",time:new Date(r.end_time).toISOString()}),await this.onToolEnd?.(r),await this._endTrace(r),r}async handleToolError(e,i){const r=this.getRunById(i);if(!r||r?.run_type!=="tool")throw new Error("No tool run to end");return r.end_time=Date.now(),r.error=this.stringifyError(e),r.events.push({name:"error",time:new Date(r.end_time).toISOString()}),await this.onToolError?.(r),await this._endTrace(r),r}async handleAgentAction(e,i){const r=this.getRunById(i);if(!r||r?.run_type!=="chain")return;const n=r;n.actions=n.actions||[],n.actions.push(e),n.events.push({name:"agent_action",time:new Date().toISOString(),kwargs:{action:e}}),await this.onAgentAction?.(r)}async handleAgentEnd(e,i){const r=this.getRunById(i);!r||r?.run_type!=="chain"||(r.events.push({name:"agent_end",time:new Date().toISOString(),kwargs:{action:e}}),await this.onAgentEnd?.(r))}_createRunForRetrieverStart(e,i,r,n,s,a,o){const l=this._getExecutionOrder(n),c=Date.now(),u={id:r,name:o??e.id[e.id.length-1],parent_run_id:n,start_time:c,serialized:e,events:[{name:"start",time:new Date(c).toISOString()}],inputs:{query:i},execution_order:l,child_execution_order:l,run_type:"retriever",child_runs:[],extra:a?{metadata:a}:{},tags:s||[]};return this._addRunToRunMap(u)}async handleRetrieverStart(e,i,r,n,s,a,o){const l=this.getRunById(r)??this._createRunForRetrieverStart(e,i,r,n,s,a,o);return await this.onRunCreate?.(l),await this.onRetrieverStart?.(l),l}async handleRetrieverEnd(e,i){const r=this.getRunById(i);if(!r||r?.run_type!=="retriever")throw new Error("No retriever run to end");return r.end_time=Date.now(),r.outputs={documents:e},r.events.push({name:"end",time:new Date(r.end_time).toISOString()}),await this.onRetrieverEnd?.(r),await this._endTrace(r),r}async handleRetrieverError(e,i){const r=this.getRunById(i);if(!r||r?.run_type!=="retriever")throw new Error("No retriever run to end");return r.end_time=Date.now(),r.error=this.stringifyError(e),r.events.push({name:"error",time:new Date(r.end_time).toISOString()}),await this.onRetrieverError?.(r),await this._endTrace(r),r}async handleText(e,i){const r=this.getRunById(i);!r||r?.run_type!=="chain"||(r.events.push({name:"text",time:new Date().toISOString(),kwargs:{text:e}}),await this.onText?.(r))}async handleLLMNewToken(e,i,r,n,s,a){const o=this.getRunById(r);if(!o||o?.run_type!=="llm")throw new Error('Invalid "runId" provided to "handleLLMNewToken" callback.');return o.events.push({name:"new_token",time:new Date().toISOString(),kwargs:{token:e,idx:i,chunk:a?.chunk}}),await this.onLLMNewToken?.(o,e,{chunk:a?.chunk}),o}}var WR={exports:{}};WR.exports;var DX;function _2e(){return DX||(DX=1,(function(t){const i=(s=0)=>a=>`\x1B[${38+s};5;${a}m`,r=(s=0)=>(a,o,l)=>`\x1B[${38+s};2;${a};${o};${l}m`;function n(){const s=new Map,a={modifier:{reset:[0,0],bold:[1,22],dim:[2,22],italic:[3,23],underline:[4,24],overline:[53,55],inverse:[7,27],hidden:[8,28],strikethrough:[9,29]},color:{black:[30,39],red:[31,39],green:[32,39],yellow:[33,39],blue:[34,39],magenta:[35,39],cyan:[36,39],white:[37,39],blackBright:[90,39],redBright:[91,39],greenBright:[92,39],yellowBright:[93,39],blueBright:[94,39],magentaBright:[95,39],cyanBright:[96,39],whiteBright:[97,39]},bgColor:{bgBlack:[40,49],bgRed:[41,49],bgGreen:[42,49],bgYellow:[43,49],bgBlue:[44,49],bgMagenta:[45,49],bgCyan:[46,49],bgWhite:[47,49],bgBlackBright:[100,49],bgRedBright:[101,49],bgGreenBright:[102,49],bgYellowBright:[103,49],bgBlueBright:[104,49],bgMagentaBright:[105,49],bgCyanBright:[106,49],bgWhiteBright:[107,49]}};a.color.gray=a.color.blackBright,a.bgColor.bgGray=a.bgColor.bgBlackBright,a.color.grey=a.color.blackBright,a.bgColor.bgGrey=a.bgColor.bgBlackBright;for(const[o,l]of Object.entries(a)){for(const[c,u]of Object.entries(l))a[c]={open:`\x1B[${u[0]}m`,close:`\x1B[${u[1]}m`},l[c]=a[c],s.set(u[0],u[1]);Object.defineProperty(a,o,{value:l,enumerable:!1})}return Object.defineProperty(a,"codes",{value:s,enumerable:!1}),a.color.close="\x1B[39m",a.bgColor.close="\x1B[49m",a.color.ansi256=i(),a.color.ansi16m=r(),a.bgColor.ansi256=i(10),a.bgColor.ansi16m=r(10),Object.defineProperties(a,{rgbToAnsi256:{value:(o,l,c)=>o===l&&l===c?o<8?16:o>248?231:Math.round((o-8)/247*24)+232:16+36*Math.round(o/255*5)+6*Math.round(l/255*5)+Math.round(c/255*5),enumerable:!1},hexToRgb:{value:o=>{const l=/(?<colorString>[a-f\d]{6}|[a-f\d]{3})/i.exec(o.toString(16));if(!l)return[0,0,0];let{colorString:c}=l.groups;c.length===3&&(c=c.split("").map(h=>h+h).join(""));const u=Number.parseInt(c,16);return[u>>16&255,u>>8&255,u&255]},enumerable:!1},hexToAnsi256:{value:o=>a.rgbToAnsi256(...a.hexToRgb(o)),enumerable:!1}}),a}Object.defineProperty(t,"exports",{enumerable:!0,get:n})})(WR)),WR.exports}var S2e=_2e();const Mae=Lh(S2e);function il(t,e){return`${t.open}${e}${t.close}`}function au(t,e){try{return JSON.stringify(t,null,2)}catch{return e}}function OX(t){return typeof t=="string"?t.trim():t==null?t:au(t,t.toString())}function Nm(t){if(!t.end_time)return"";const e=t.end_time-t.start_time;return e<1e3?`${e}ms`:`${(e/1e3).toFixed(2)}s`}const{color:Bl}=Mae;class LX extends dT{constructor(){super(...arguments),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"console_callback_handler"})}persistRun(e){return Promise.resolve()}getParents(e){const i=[];let r=e;for(;r.parent_run_id;){const n=this.runMap.get(r.parent_run_id);if(n)i.push(n),r=n;else break}return i}getBreadcrumbs(e){const r=[...this.getParents(e).reverse(),e].map((n,s,a)=>{const o=`${n.execution_order}:${n.run_type}:${n.name}`;return s===a.length-1?il(Mae.bold,o):o}).join(" > ");return il(Bl.grey,r)}onChainStart(e){const i=this.getBreadcrumbs(e);console.log(`${il(Bl.green,"[chain/start]")} [${i}] Entering Chain run with input: ${au(e.inputs,"[inputs]")}`)}onChainEnd(e){const i=this.getBreadcrumbs(e);console.log(`${il(Bl.cyan,"[chain/end]")} [${i}] [${Nm(e)}] Exiting Chain run with output: ${au(e.outputs,"[outputs]")}`)}onChainError(e){const i=this.getBreadcrumbs(e);console.log(`${il(Bl.red,"[chain/error]")} [${i}] [${Nm(e)}] Chain run errored with error: ${au(e.error,"[error]")}`)}onLLMStart(e){const i=this.getBreadcrumbs(e),r="prompts"in e.inputs?{prompts:e.inputs.prompts.map(n=>n.trim())}:e.inputs;console.log(`${il(Bl.green,"[llm/start]")} [${i}] Entering LLM run with input: ${au(r,"[inputs]")}`)}onLLMEnd(e){const i=this.getBreadcrumbs(e);console.log(`${il(Bl.cyan,"[llm/end]")} [${i}] [${Nm(e)}] Exiting LLM run with output: ${au(e.outputs,"[response]")}`)}onLLMError(e){const i=this.getBreadcrumbs(e);console.log(`${il(Bl.red,"[llm/error]")} [${i}] [${Nm(e)}] LLM run errored with error: ${au(e.error,"[error]")}`)}onToolStart(e){const i=this.getBreadcrumbs(e);console.log(`${il(Bl.green,"[tool/start]")} [${i}] Entering Tool run with input: "${OX(e.inputs.input)}"`)}onToolEnd(e){const i=this.getBreadcrumbs(e);console.log(`${il(Bl.cyan,"[tool/end]")} [${i}] [${Nm(e)}] Exiting Tool run with output: "${OX(e.outputs?.output)}"`)}onToolError(e){const i=this.getBreadcrumbs(e);console.log(`${il(Bl.red,"[tool/error]")} [${i}] [${Nm(e)}] Tool run errored with error: ${au(e.error,"[error]")}`)}onRetrieverStart(e){const i=this.getBreadcrumbs(e);console.log(`${il(Bl.green,"[retriever/start]")} [${i}] Entering Retriever run with input: ${au(e.inputs,"[inputs]")}`)}onRetrieverEnd(e){const i=this.getBreadcrumbs(e);console.log(`${il(Bl.cyan,"[retriever/end]")} [${i}] [${Nm(e)}] Exiting Retriever run with output: ${au(e.outputs,"[outputs]")}`)}onRetrieverError(e){const i=this.getBreadcrumbs(e);console.log(`${il(Bl.red,"[retriever/error]")} [${i}] [${Nm(e)}] Retriever run errored with error: ${au(e.error,"[error]")}`)}onAgentAction(e){const i=e,r=this.getBreadcrumbs(e);console.log(`${il(Bl.blue,"[agent/action]")} [${r}] Agent selected action: ${au(i.actions[i.actions.length-1],"[action]")}`)}}let eU;const E2e=()=>{if(eU===void 0){const t=c0("LANGCHAIN_CALLBACKS_BACKGROUND")==="false"?{blockOnRootRunFinalization:!0}:{};eU=new nM(t)}return eU};class pA extends dT{constructor(e={}){super(e),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"langchain_tracer"}),Object.defineProperty(this,"projectName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"exampleId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"replicas",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"usesRunTreeMap",{enumerable:!0,configurable:!0,writable:!0,value:!0});const{exampleId:i,projectName:r,client:n,replicas:s}=e;this.projectName=r??uae(),this.replicas=s,this.exampleId=i,this.client=n??E2e();const a=pA.getTraceableRunTree();a&&this.updateFromRunTree(a)}async persistRun(e){}async onRunCreate(e){await this.getRunTreeWithTracingConfig(e.id)?.postRun()}async onRunUpdate(e){await this.getRunTreeWithTracingConfig(e.id)?.patchRun()}getRun(e){return this.runTreeMap.get(e)}updateFromRunTree(e){this.runTreeMap.set(e.id,e);let i=e;const r=new Set;for(;i.parent_run&&!(r.has(i.id)||(r.add(i.id),!i.parent_run));)i=i.parent_run;r.clear();const n=[i];for(;n.length>0;){const s=n.shift();!s||r.has(s.id)||(r.add(s.id),this.runTreeMap.set(s.id,s),s.child_runs&&n.push(...s.child_runs))}this.client=e.client??this.client,this.replicas=e.replicas??this.replicas,this.projectName=e.project_name??this.projectName,this.exampleId=e.reference_example_id??this.exampleId}getRunTreeWithTracingConfig(e){const i=this.runTreeMap.get(e);if(i)return new Hl({...i,client:this.client,project_name:this.projectName,replicas:this.replicas,reference_example_id:this.exampleId,tracingEnabled:!0})}static getTraceableRunTree(){try{return hTe(!0)}catch{return}}}const Tae=Symbol.for("ls:tracing_async_local_storage"),qR=Symbol.for("lc:context_variables"),A2e=t=>{globalThis[Tae]=t},sM=()=>globalThis[Tae];let mA;function M2e(){const t="default"in Rp?Rp.default:Rp;return new t({autoStart:!0,concurrency:1})}function T2e(){return typeof mA>"u"&&(mA=M2e()),mA}async function ua(t,e){if(e===!0){const i=sM();i!==void 0?await i.run(void 0,async()=>t()):await t()}else mA=T2e(),mA.add(async()=>{const i=sM();i!==void 0?await i.run(void 0,async()=>t()):await t()})}const C2e=t=>!!["LANGSMITH_TRACING_V2","LANGCHAIN_TRACING_V2","LANGSMITH_TRACING","LANGCHAIN_TRACING"].find(i=>c0(i)==="true");function Cae(t){const e=sM();return e===void 0?void 0:e.getStore()?.[qR]?.[t]}const P2e=Symbol("lc:configure_hooks"),R2e=()=>Cae(P2e)||[];class I2e{setHandler(e){return this.setHandlers([e])}}class lO{constructor(e,i,r,n,s,a,o,l){Object.defineProperty(this,"runId",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"handlers",{enumerable:!0,configurable:!0,writable:!0,value:i}),Object.defineProperty(this,"inheritableHandlers",{enumerable:!0,configurable:!0,writable:!0,value:r}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:n}),Object.defineProperty(this,"inheritableTags",{enumerable:!0,configurable:!0,writable:!0,value:s}),Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:a}),Object.defineProperty(this,"inheritableMetadata",{enumerable:!0,configurable:!0,writable:!0,value:o}),Object.defineProperty(this,"_parentRunId",{enumerable:!0,configurable:!0,writable:!0,value:l})}get parentRunId(){return this._parentRunId}async handleText(e){await Promise.all(this.handlers.map(i=>ua(async()=>{try{await i.handleText?.(e,this.runId,this._parentRunId,this.tags)}catch(r){if((i.raiseError?console.error:console.warn)(`Error in handler ${i.constructor.name}, handleText: ${r}`),i.raiseError)throw r}},i.awaitHandlers)))}async handleCustomEvent(e,i,r,n,s){await Promise.all(this.handlers.map(a=>ua(async()=>{try{await a.handleCustomEvent?.(e,i,this.runId,this.tags,this.metadata)}catch(o){if((a.raiseError?console.error:console.warn)(`Error in handler ${a.constructor.name}, handleCustomEvent: ${o}`),a.raiseError)throw o}},a.awaitHandlers)))}}class D2e extends lO{getChild(e){const i=new ec(this.runId);return i.setHandlers(this.inheritableHandlers),i.addTags(this.inheritableTags),i.addMetadata(this.inheritableMetadata),e&&i.addTags([e],!1),i}async handleRetrieverEnd(e){await Promise.all(this.handlers.map(i=>ua(async()=>{if(!i.ignoreRetriever)try{await i.handleRetrieverEnd?.(e,this.runId,this._parentRunId,this.tags)}catch(r){if((i.raiseError?console.error:console.warn)(`Error in handler ${i.constructor.name}, handleRetriever`),i.raiseError)throw r}},i.awaitHandlers)))}async handleRetrieverError(e){await Promise.all(this.handlers.map(i=>ua(async()=>{if(!i.ignoreRetriever)try{await i.handleRetrieverError?.(e,this.runId,this._parentRunId,this.tags)}catch(r){if((i.raiseError?console.error:console.warn)(`Error in handler ${i.constructor.name}, handleRetrieverError: ${r}`),i.raiseError)throw e}},i.awaitHandlers)))}}class kX extends lO{async handleLLMNewToken(e,i,r,n,s,a){await Promise.all(this.handlers.map(o=>ua(async()=>{if(!o.ignoreLLM)try{await o.handleLLMNewToken?.(e,i??{prompt:0,completion:0},this.runId,this._parentRunId,this.tags,a)}catch(l){if((o.raiseError?console.error:console.warn)(`Error in handler ${o.constructor.name}, handleLLMNewToken: ${l}`),o.raiseError)throw l}},o.awaitHandlers)))}async handleLLMError(e,i,r,n,s){await Promise.all(this.handlers.map(a=>ua(async()=>{if(!a.ignoreLLM)try{await a.handleLLMError?.(e,this.runId,this._parentRunId,this.tags,s)}catch(o){if((a.raiseError?console.error:console.warn)(`Error in handler ${a.constructor.name}, handleLLMError: ${o}`),a.raiseError)throw o}},a.awaitHandlers)))}async handleLLMEnd(e,i,r,n,s){await Promise.all(this.handlers.map(a=>ua(async()=>{if(!a.ignoreLLM)try{await a.handleLLMEnd?.(e,this.runId,this._parentRunId,this.tags,s)}catch(o){if((a.raiseError?console.error:console.warn)(`Error in handler ${a.constructor.name}, handleLLMEnd: ${o}`),a.raiseError)throw o}},a.awaitHandlers)))}}class O2e extends lO{getChild(e){const i=new ec(this.runId);return i.setHandlers(this.inheritableHandlers),i.addTags(this.inheritableTags),i.addMetadata(this.inheritableMetadata),e&&i.addTags([e],!1),i}async handleChainError(e,i,r,n,s){await Promise.all(this.handlers.map(a=>ua(async()=>{if(!a.ignoreChain)try{await a.handleChainError?.(e,this.runId,this._parentRunId,this.tags,s)}catch(o){if((a.raiseError?console.error:console.warn)(`Error in handler ${a.constructor.name}, handleChainError: ${o}`),a.raiseError)throw o}},a.awaitHandlers)))}async handleChainEnd(e,i,r,n,s){await Promise.all(this.handlers.map(a=>ua(async()=>{if(!a.ignoreChain)try{await a.handleChainEnd?.(e,this.runId,this._parentRunId,this.tags,s)}catch(o){if((a.raiseError?console.error:console.warn)(`Error in handler ${a.constructor.name}, handleChainEnd: ${o}`),a.raiseError)throw o}},a.awaitHandlers)))}async handleAgentAction(e){await Promise.all(this.handlers.map(i=>ua(async()=>{if(!i.ignoreAgent)try{await i.handleAgentAction?.(e,this.runId,this._parentRunId,this.tags)}catch(r){if((i.raiseError?console.error:console.warn)(`Error in handler ${i.constructor.name}, handleAgentAction: ${r}`),i.raiseError)throw r}},i.awaitHandlers)))}async handleAgentEnd(e){await Promise.all(this.handlers.map(i=>ua(async()=>{if(!i.ignoreAgent)try{await i.handleAgentEnd?.(e,this.runId,this._parentRunId,this.tags)}catch(r){if((i.raiseError?console.error:console.warn)(`Error in handler ${i.constructor.name}, handleAgentEnd: ${r}`),i.raiseError)throw r}},i.awaitHandlers)))}}class L2e extends lO{getChild(e){const i=new ec(this.runId);return i.setHandlers(this.inheritableHandlers),i.addTags(this.inheritableTags),i.addMetadata(this.inheritableMetadata),e&&i.addTags([e],!1),i}async handleToolError(e){await Promise.all(this.handlers.map(i=>ua(async()=>{if(!i.ignoreAgent)try{await i.handleToolError?.(e,this.runId,this._parentRunId,this.tags)}catch(r){if((i.raiseError?console.error:console.warn)(`Error in handler ${i.constructor.name}, handleToolError: ${r}`),i.raiseError)throw r}},i.awaitHandlers)))}async handleToolEnd(e){await Promise.all(this.handlers.map(i=>ua(async()=>{if(!i.ignoreAgent)try{await i.handleToolEnd?.(e,this.runId,this._parentRunId,this.tags)}catch(r){if((i.raiseError?console.error:console.warn)(`Error in handler ${i.constructor.name}, handleToolEnd: ${r}`),i.raiseError)throw r}},i.awaitHandlers)))}}class ec extends I2e{constructor(e,i){super(),Object.defineProperty(this,"handlers",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"inheritableHandlers",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"inheritableTags",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"inheritableMetadata",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"callback_manager"}),Object.defineProperty(this,"_parentRunId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.handlers=i?.handlers??this.handlers,this.inheritableHandlers=i?.inheritableHandlers??this.inheritableHandlers,this.tags=i?.tags??this.tags,this.inheritableTags=i?.inheritableTags??this.inheritableTags,this.metadata=i?.metadata??this.metadata,this.inheritableMetadata=i?.inheritableMetadata??this.inheritableMetadata,this._parentRunId=e}getParentRunId(){return this._parentRunId}async handleLLMStart(e,i,r=void 0,n=void 0,s=void 0,a=void 0,o=void 0,l=void 0){return Promise.all(i.map(async(c,u)=>{const h=u===0&&r?r:dl();return await Promise.all(this.handlers.map(d=>{if(!d.ignoreLLM)return jS(d)&&d._createRunForLLMStart(e,[c],h,this._parentRunId,s,this.tags,this.metadata,l),ua(async()=>{try{await d.handleLLMStart?.(e,[c],h,this._parentRunId,s,this.tags,this.metadata,l)}catch(f){if((d.raiseError?console.error:console.warn)(`Error in handler ${d.constructor.name}, handleLLMStart: ${f}`),d.raiseError)throw f}},d.awaitHandlers)})),new kX(h,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}))}async handleChatModelStart(e,i,r=void 0,n=void 0,s=void 0,a=void 0,o=void 0,l=void 0){return Promise.all(i.map(async(c,u)=>{const h=u===0&&r?r:dl();return await Promise.all(this.handlers.map(d=>{if(!d.ignoreLLM)return jS(d)&&d._createRunForChatModelStart(e,[c],h,this._parentRunId,s,this.tags,this.metadata,l),ua(async()=>{try{if(d.handleChatModelStart)await d.handleChatModelStart?.(e,[c],h,this._parentRunId,s,this.tags,this.metadata,l);else if(d.handleLLMStart){const f=rae(c);await d.handleLLMStart?.(e,[f],h,this._parentRunId,s,this.tags,this.metadata,l)}}catch(f){if((d.raiseError?console.error:console.warn)(`Error in handler ${d.constructor.name}, handleLLMStart: ${f}`),d.raiseError)throw f}},d.awaitHandlers)})),new kX(h,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}))}async handleChainStart(e,i,r=dl(),n=void 0,s=void 0,a=void 0,o=void 0){return await Promise.all(this.handlers.map(l=>{if(!l.ignoreChain)return jS(l)&&l._createRunForChainStart(e,i,r,this._parentRunId,this.tags,this.metadata,n,o),ua(async()=>{try{await l.handleChainStart?.(e,i,r,this._parentRunId,this.tags,this.metadata,n,o)}catch(c){if((l.raiseError?console.error:console.warn)(`Error in handler ${l.constructor.name}, handleChainStart: ${c}`),l.raiseError)throw c}},l.awaitHandlers)})),new O2e(r,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}async handleToolStart(e,i,r=dl(),n=void 0,s=void 0,a=void 0,o=void 0){return await Promise.all(this.handlers.map(l=>{if(!l.ignoreAgent)return jS(l)&&l._createRunForToolStart(e,i,r,this._parentRunId,this.tags,this.metadata,o),ua(async()=>{try{await l.handleToolStart?.(e,i,r,this._parentRunId,this.tags,this.metadata,o)}catch(c){if((l.raiseError?console.error:console.warn)(`Error in handler ${l.constructor.name}, handleToolStart: ${c}`),l.raiseError)throw c}},l.awaitHandlers)})),new L2e(r,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}async handleRetrieverStart(e,i,r=dl(),n=void 0,s=void 0,a=void 0,o=void 0){return await Promise.all(this.handlers.map(l=>{if(!l.ignoreRetriever)return jS(l)&&l._createRunForRetrieverStart(e,i,r,this._parentRunId,this.tags,this.metadata,o),ua(async()=>{try{await l.handleRetrieverStart?.(e,i,r,this._parentRunId,this.tags,this.metadata,o)}catch(c){if((l.raiseError?console.error:console.warn)(`Error in handler ${l.constructor.name}, handleRetrieverStart: ${c}`),l.raiseError)throw c}},l.awaitHandlers)})),new D2e(r,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}async handleCustomEvent(e,i,r,n,s){await Promise.all(this.handlers.map(a=>ua(async()=>{if(!a.ignoreCustomEvent)try{await a.handleCustomEvent?.(e,i,r,this.tags,this.metadata)}catch(o){if((a.raiseError?console.error:console.warn)(`Error in handler ${a.constructor.name}, handleCustomEvent: ${o}`),a.raiseError)throw o}},a.awaitHandlers)))}addHandler(e,i=!0){this.handlers.push(e),i&&this.inheritableHandlers.push(e)}removeHandler(e){this.handlers=this.handlers.filter(i=>i!==e),this.inheritableHandlers=this.inheritableHandlers.filter(i=>i!==e)}setHandlers(e,i=!0){this.handlers=[],this.inheritableHandlers=[];for(const r of e)this.addHandler(r,i)}addTags(e,i=!0){this.removeTags(e),this.tags.push(...e),i&&this.inheritableTags.push(...e)}removeTags(e){this.tags=this.tags.filter(i=>!e.includes(i)),this.inheritableTags=this.inheritableTags.filter(i=>!e.includes(i))}addMetadata(e,i=!0){this.metadata={...this.metadata,...e},i&&(this.inheritableMetadata={...this.inheritableMetadata,...e})}removeMetadata(e){for(const i of Object.keys(e))delete this.metadata[i],delete this.inheritableMetadata[i]}copy(e=[],i=!0){const r=new ec(this._parentRunId);for(const n of this.handlers){const s=this.inheritableHandlers.includes(n);r.addHandler(n,s)}for(const n of this.tags){const s=this.inheritableTags.includes(n);r.addTags([n],s)}for(const n of Object.keys(this.metadata)){const s=Object.keys(this.inheritableMetadata).includes(n);r.addMetadata({[n]:this.metadata[n]},s)}for(const n of e)r.handlers.filter(s=>s.name==="console_callback_handler").some(s=>s.name===n.name)||r.addHandler(n,i);return r}static fromHandlers(e){class i extends hT{constructor(){super(),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:dl()}),Object.assign(this,e)}}const r=new this;return r.addHandler(new i),r}static configure(e,i,r,n,s,a,o){return this._configureSync(e,i,r,n,s,a,o)}static _configureSync(e,i,r,n,s,a,o){let l;(e||i)&&(Array.isArray(e)||!e?(l=new ec,l.setHandlers(e?.map(NI)??[],!0)):l=e,l=l.copy(Array.isArray(i)?i.map(NI):i?.handlers,!1));const c=c0("LANGCHAIN_VERBOSE")==="true"||o?.verbose,u=pA.getTraceableRunTree()?.tracingEnabled||C2e(),h=u||(c0("LANGCHAIN_TRACING")??!1);if(c||h){if(l||(l=new ec),c&&!l.handlers.some(d=>d.name===LX.prototype.name)){const d=new LX;l.addHandler(d,!0)}if(h&&!l.handlers.some(d=>d.name==="langchain_tracer")&&u){const d=new pA;l.addHandler(d,!0)}if(u){const d=pA.getTraceableRunTree();d&&l._parentRunId===void 0&&(l._parentRunId=d.id,l.handlers.find(p=>p.name==="langchain_tracer")?.updateFromRunTree(d))}}for(const{contextVar:d,inheritable:f=!0,handlerClass:p,envVar:g}of R2e()){const m=g&&c0(g)==="true"&&p;let y;const b=d!==void 0?Cae(d):void 0;b&&b2e(b)?y=b:m&&(y=new p({})),y!==void 0&&(l||(l=new ec),l.handlers.some(w=>w.name===y.name)||l.addHandler(y,f))}return(r||n)&&l&&(l.addTags(r??[]),l.addTags(n??[],!1)),(s||a)&&l&&(l.addMetadata(s??{}),l.addMetadata(a??{},!1)),l}}function NI(t){return"name"in t?t:hT.fromMethods(t)}class k2e{getStore(){}run(e,i){return i()}enterWith(e){}}const N2e=new k2e,NX=Symbol.for("lc:child_config");class U2e{getInstance(){return sM()??N2e}getRunnableConfig(){return this.getInstance().getStore()?.extra?.[NX]}runWithConfig(e,i,r){const n=ec._configureSync(e?.callbacks,void 0,e?.tags,void 0,e?.metadata),s=this.getInstance(),a=s.getStore(),o=n?.getParentRunId(),l=n?.handlers?.find(u=>u?.name==="langchain_tracer");let c;return l&&o?c=l.getRunTreeWithTracingConfig(o):r||(c=new Hl({name:"<runnable_lambda>",tracingEnabled:!1})),c&&(c.extra={...c.extra,[NX]:e}),a!==void 0&&a[qR]!==void 0&&(c===void 0&&(c={}),c[qR]=a[qR]),s.run(c,i)}initializeGlobalInstance(e){sM()===void 0&&A2e(e)}}const Zg=new U2e,tU=25;async function Sh(t){return ec._configureSync(t?.callbacks,void 0,t?.tags,void 0,t?.metadata)}function UX(...t){const e={};for(const i of t.filter(r=>!!r))for(const r of Object.keys(i))if(r==="metadata")e[r]={...e[r],...i[r]};else if(r==="tags"){const n=e[r]??[];e[r]=[...new Set(n.concat(i[r]??[]))]}else if(r==="configurable")e[r]={...e[r],...i[r]};else if(r==="timeout")e.timeout===void 0?e.timeout=i.timeout:i.timeout!==void 0&&(e.timeout=Math.min(e.timeout,i.timeout));else if(r==="signal")e.signal===void 0?e.signal=i.signal:i.signal!==void 0&&("any"in AbortSignal?e.signal=AbortSignal.any([e.signal,i.signal]):e.signal=i.signal);else if(r==="callbacks"){const n=e.callbacks,s=i.callbacks;if(Array.isArray(s))if(!n)e.callbacks=s;else if(Array.isArray(n))e.callbacks=n.concat(s);else{const a=n.copy();for(const o of s)a.addHandler(NI(o),!0);e.callbacks=a}else if(s)if(!n)e.callbacks=s;else if(Array.isArray(n)){const a=s.copy();for(const o of n)a.addHandler(NI(o),!0);e.callbacks=a}else e.callbacks=new ec(s._parentRunId,{handlers:n.handlers.concat(s.handlers),inheritableHandlers:n.inheritableHandlers.concat(s.inheritableHandlers),tags:Array.from(new Set(n.tags.concat(s.tags))),inheritableTags:Array.from(new Set(n.inheritableTags.concat(s.inheritableTags))),metadata:{...n.metadata,...s.metadata}})}else{const n=r;e[n]=i[n]??e[n]}return e}const B2e=new Set(["string","number","boolean"]);function Qr(t){const e=Zg.getRunnableConfig();let i={tags:[],metadata:{},recursionLimit:25,runId:void 0};if(e){const{runId:r,runName:n,...s}=e;i=Object.entries(s).reduce((a,[o,l])=>(l!==void 0&&(a[o]=l),a),i)}if(t&&(i=Object.entries(t).reduce((r,[n,s])=>(s!==void 0&&(r[n]=s),r),i)),i?.configurable)for(const r of Object.keys(i.configurable))B2e.has(typeof i.configurable[r])&&!i.metadata?.[r]&&(i.metadata||(i.metadata={}),i.metadata[r]=i.configurable[r]);if(i.timeout!==void 0){if(i.timeout<=0)throw new Error("Timeout must be a positive number");const r=AbortSignal.timeout(i.timeout);i.signal!==void 0?"any"in AbortSignal&&(i.signal=AbortSignal.any([i.signal,r])):i.signal=r,delete i.timeout}return i}function Bo(t={},{callbacks:e,maxConcurrency:i,recursionLimit:r,runName:n,configurable:s,runId:a}={}){const o=Qr(t);return e!==void 0&&(delete o.runName,o.callbacks=e),r!==void 0&&(o.recursionLimit=r),i!==void 0&&(o.maxConcurrency=i),n!==void 0&&(o.runName=n),s!==void 0&&(o.configurable={...o.configurable,...s}),a!==void 0&&delete o.runId,o}function C1(t){return t?{configurable:t.configurable,recursionLimit:t.recursionLimit,callbacks:t.callbacks,tags:t.tags,metadata:t.metadata,maxConcurrency:t.maxConcurrency,timeout:t.timeout,signal:t.signal}:void 0}async function Qg(t,e){if(e===void 0)return t;let i;return Promise.race([t.catch(r=>{if(!e?.aborted)throw r}),new Promise((r,n)=>{i=()=>{n(new Error("Aborted"))},e.addEventListener("abort",i),e.aborted&&n(new Error("Aborted"))})]).finally(()=>e.removeEventListener("abort",i))}class Oc extends ReadableStream{constructor(){super(...arguments),Object.defineProperty(this,"reader",{enumerable:!0,configurable:!0,writable:!0,value:void 0})}ensureReader(){this.reader||(this.reader=this.getReader())}async next(){this.ensureReader();try{const e=await this.reader.read();return e.done?(this.reader.releaseLock(),{done:!0,value:void 0}):{done:!1,value:e.value}}catch(e){throw this.reader.releaseLock(),e}}async return(){if(this.ensureReader(),this.locked){const e=this.reader.cancel();this.reader.releaseLock(),await e}return{done:!0,value:void 0}}async throw(e){if(this.ensureReader(),this.locked){const i=this.reader.cancel();this.reader.releaseLock(),await i}throw e}[Symbol.asyncIterator](){return this}async[Symbol.asyncDispose](){await this.return()}static fromReadableStream(e){const i=e.getReader();return new Oc({start(r){return n();function n(){return i.read().then(({done:s,value:a})=>{if(s){r.close();return}return r.enqueue(a),n()})}},cancel(){i.releaseLock()}})}static fromAsyncGenerator(e){return new Oc({async pull(i){const{value:r,done:n}=await e.next();n&&i.close(),i.enqueue(r)},async cancel(i){await e.return(i)}})}}function Pae(t,e=2){const i=Array.from({length:e},()=>[]);return i.map(async function*(n){for(;;)if(n.length===0){const s=await t.next();for(const a of i)a.push(s)}else{if(n[0].done)return;yield n.shift().value}})}function cO(t,e){if(Array.isArray(t)&&Array.isArray(e))return t.concat(e);if(typeof t=="string"&&typeof e=="string")return t+e;if(typeof t=="number"&&typeof e=="number")return t+e;if("concat"in t&&typeof t.concat=="function")return t.concat(e);if(typeof t=="object"&&typeof e=="object"){const i={...t};for(const[r,n]of Object.entries(e))r in i&&!Array.isArray(i[r])?i[r]=cO(i[r],n):i[r]=n;return i}else throw new Error(`Cannot concat ${typeof t} and ${typeof e}`)}class d_{constructor(e){Object.defineProperty(this,"generator",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"setup",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"config",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"signal",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"firstResult",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"firstResultUsed",{enumerable:!0,configurable:!0,writable:!0,value:!1}),this.generator=e.generator,this.config=e.config,this.signal=e.signal??this.config?.signal,this.setup=new Promise((i,r)=>{Zg.runWithConfig(C1(e.config),async()=>{this.firstResult=e.generator.next(),e.startSetup?this.firstResult.then(e.startSetup).then(i,r):this.firstResult.then(n=>i(void 0),r)},!0)})}async next(...e){return this.signal?.throwIfAborted(),this.firstResultUsed?Zg.runWithConfig(C1(this.config),this.signal?async()=>Qg(this.generator.next(...e),this.signal):async()=>this.generator.next(...e),!0):(this.firstResultUsed=!0,this.firstResult)}async return(e){return this.generator.return(e)}async throw(e){return this.generator.throw(e)}[Symbol.asyncIterator](){return this}async[Symbol.asyncDispose](){await this.return()}}async function F2e(t,e,i,r,...n){const s=new d_({generator:e,startSetup:i,signal:r}),a=await s.setup;return{output:t(s,a,...n),setup:a}}class hg{constructor(e){Object.defineProperty(this,"ops",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.ops=e.ops??[]}concat(e){const i=this.ops.concat(e.ops),r=DI({},i);return new aM({ops:i,state:r[r.length-1].newDocument})}}class aM extends hg{constructor(e){super(e),Object.defineProperty(this,"state",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.state=e.state}concat(e){const i=this.ops.concat(e.ops),r=DI(this.state,e.ops);return new aM({ops:i,state:r[r.length-1].newDocument})}static fromRunLogPatch(e){const i=DI({},e.ops);return new aM({ops:e.ops,state:i[i.length-1].newDocument})}}const z2e=t=>t.name==="log_stream_tracer";async function BX(t,e){if(e==="original")throw new Error("Do not assign inputs with original schema drop the key for now. When inputs are added to streamLog they should be added with standardized schema for streaming events.");const{inputs:i}=t;if(["retriever","llm","prompt"].includes(t.run_type))return i;if(!(Object.keys(i).length===1&&i?.input===""))return i.input}async function FX(t,e){const{outputs:i}=t;return e==="original"||["retriever","llm","prompt"].includes(t.run_type)?i:i!==void 0&&Object.keys(i).length===1&&i?.output!==void 0?i.output:i}function j2e(t){return t!==void 0&&t.message!==void 0}class zX extends dT{constructor(e){super({_awaitHandler:!0,...e}),Object.defineProperty(this,"autoClose",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"includeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_schemaFormat",{enumerable:!0,configurable:!0,writable:!0,value:"original"}),Object.defineProperty(this,"rootId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"keyMapByRunId",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"counterMapByRunName",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"transformStream",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"writer",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"receiveStream",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"log_stream_tracer"}),Object.defineProperty(this,"lc_prefer_streaming",{enumerable:!0,configurable:!0,writable:!0,value:!0}),this.autoClose=e?.autoClose??!0,this.includeNames=e?.includeNames,this.includeTypes=e?.includeTypes,this.includeTags=e?.includeTags,this.excludeNames=e?.excludeNames,this.excludeTypes=e?.excludeTypes,this.excludeTags=e?.excludeTags,this._schemaFormat=e?._schemaFormat??this._schemaFormat,this.transformStream=new TransformStream,this.writer=this.transformStream.writable.getWriter(),this.receiveStream=Oc.fromReadableStream(this.transformStream.readable)}[Symbol.asyncIterator](){return this.receiveStream}async persistRun(e){}_includeRun(e){if(e.id===this.rootId)return!1;const i=e.tags??[];let r=this.includeNames===void 0&&this.includeTags===void 0&&this.includeTypes===void 0;return this.includeNames!==void 0&&(r=r||this.includeNames.includes(e.name)),this.includeTypes!==void 0&&(r=r||this.includeTypes.includes(e.run_type)),this.includeTags!==void 0&&(r=r||i.find(n=>this.includeTags?.includes(n))!==void 0),this.excludeNames!==void 0&&(r=r&&!this.excludeNames.includes(e.name)),this.excludeTypes!==void 0&&(r=r&&!this.excludeTypes.includes(e.run_type)),this.excludeTags!==void 0&&(r=r&&i.every(n=>!this.excludeTags?.includes(n))),r}async*tapOutputIterable(e,i){for await(const r of i){if(e!==this.rootId){const n=this.keyMapByRunId[e];n&&await this.writer.write(new hg({ops:[{op:"add",path:`/logs/${n}/streamed_output/-`,value:r}]}))}yield r}}async onRunCreate(e){if(this.rootId===void 0&&(this.rootId=e.id,await this.writer.write(new hg({ops:[{op:"replace",path:"",value:{id:e.id,name:e.name,type:e.run_type,streamed_output:[],final_output:void 0,logs:{}}}]}))),!this._includeRun(e))return;this.counterMapByRunName[e.name]===void 0&&(this.counterMapByRunName[e.name]=0),this.counterMapByRunName[e.name]+=1;const i=this.counterMapByRunName[e.name];this.keyMapByRunId[e.id]=i===1?e.name:`${e.name}:${i}`;const r={id:e.id,name:e.name,type:e.run_type,tags:e.tags??[],metadata:e.extra?.metadata??{},start_time:new Date(e.start_time).toISOString(),streamed_output:[],streamed_output_str:[],final_output:void 0,end_time:void 0};this._schemaFormat==="streaming_events"&&(r.inputs=await BX(e,this._schemaFormat)),await this.writer.write(new hg({ops:[{op:"add",path:`/logs/${this.keyMapByRunId[e.id]}`,value:r}]}))}async onRunUpdate(e){try{const i=this.keyMapByRunId[e.id];if(i===void 0)return;const r=[];this._schemaFormat==="streaming_events"&&r.push({op:"replace",path:`/logs/${i}/inputs`,value:await BX(e,this._schemaFormat)}),r.push({op:"add",path:`/logs/${i}/final_output`,value:await FX(e,this._schemaFormat)}),e.end_time!==void 0&&r.push({op:"add",path:`/logs/${i}/end_time`,value:new Date(e.end_time).toISOString()});const n=new hg({ops:r});await this.writer.write(n)}finally{if(e.id===this.rootId){const i=new hg({ops:[{op:"replace",path:"/final_output",value:await FX(e,this._schemaFormat)}]});await this.writer.write(i),this.autoClose&&await this.writer.close()}}}async onLLMNewToken(e,i,r){const n=this.keyMapByRunId[e.id];if(n===void 0)return;const s=e.inputs.messages!==void 0;let a;s?j2e(r?.chunk)?a=r?.chunk:a=new u_({id:`run-${e.id}`,content:i}):a=i;const o=new hg({ops:[{op:"add",path:`/logs/${n}/streamed_output_str/-`,value:i},{op:"add",path:`/logs/${n}/streamed_output/-`,value:a}]});await this.writer.write(o)}}const jX="__run";class P1{constructor(e){Object.defineProperty(this,"text",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"generationInfo",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.text=e.text,this.generationInfo=e.generationInfo}concat(e){return new P1({text:this.text+e.text,generationInfo:{...this.generationInfo,...e.generationInfo}})}}class oM extends P1{constructor(e){super(e),Object.defineProperty(this,"message",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.message=e.message}concat(e){return new oM({text:this.text+e.text,generationInfo:{...this.generationInfo,...e.generationInfo},message:this.message.concat(e.message)})}}function c2({name:t,serialized:e}){return t!==void 0?t:e?.name!==void 0?e.name:e?.id!==void 0&&Array.isArray(e?.id)?e.id[e.id.length-1]:"Unnamed"}const V2e=t=>t.name==="event_stream_tracer";class H2e extends dT{constructor(e){super({_awaitHandler:!0,...e}),Object.defineProperty(this,"autoClose",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"includeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"runInfoMap",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"tappedPromises",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"transformStream",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"writer",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"receiveStream",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"event_stream_tracer"}),Object.defineProperty(this,"lc_prefer_streaming",{enumerable:!0,configurable:!0,writable:!0,value:!0}),this.autoClose=e?.autoClose??!0,this.includeNames=e?.includeNames,this.includeTypes=e?.includeTypes,this.includeTags=e?.includeTags,this.excludeNames=e?.excludeNames,this.excludeTypes=e?.excludeTypes,this.excludeTags=e?.excludeTags,this.transformStream=new TransformStream,this.writer=this.transformStream.writable.getWriter(),this.receiveStream=Oc.fromReadableStream(this.transformStream.readable)}[Symbol.asyncIterator](){return this.receiveStream}async persistRun(e){}_includeRun(e){const i=e.tags??[];let r=this.includeNames===void 0&&this.includeTags===void 0&&this.includeTypes===void 0;return this.includeNames!==void 0&&(r=r||this.includeNames.includes(e.name)),this.includeTypes!==void 0&&(r=r||this.includeTypes.includes(e.runType)),this.includeTags!==void 0&&(r=r||i.find(n=>this.includeTags?.includes(n))!==void 0),this.excludeNames!==void 0&&(r=r&&!this.excludeNames.includes(e.name)),this.excludeTypes!==void 0&&(r=r&&!this.excludeTypes.includes(e.runType)),this.excludeTags!==void 0&&(r=r&&i.every(n=>!this.excludeTags?.includes(n))),r}async*tapOutputIterable(e,i){const r=await i.next();if(r.done)return;const n=this.runInfoMap.get(e);if(n===void 0){yield r.value;return}function s(o,l){return o==="llm"&&typeof l=="string"?new P1({text:l}):l}let a=this.tappedPromises.get(e);if(a===void 0){let o;a=new Promise(l=>{o=l}),this.tappedPromises.set(e,a);try{const l={event:`on_${n.runType}_stream`,run_id:e,name:n.name,tags:n.tags,metadata:n.metadata,data:{}};await this.send({...l,data:{chunk:s(n.runType,r.value)}},n),yield r.value;for await(const c of i)n.runType!=="tool"&&n.runType!=="retriever"&&await this.send({...l,data:{chunk:s(n.runType,c)}},n),yield c}finally{o()}}else{yield r.value;for await(const o of i)yield o}}async send(e,i){this._includeRun(i)&&await this.writer.write(e)}async sendEndEvent(e,i){const r=this.tappedPromises.get(e.run_id);r!==void 0?r.then(()=>{this.send(e,i)}):await this.send(e,i)}async onLLMStart(e){const i=c2(e),r=e.inputs.messages!==void 0?"chat_model":"llm",n={tags:e.tags??[],metadata:e.extra?.metadata??{},name:i,runType:r,inputs:e.inputs};this.runInfoMap.set(e.id,n);const s=`on_${r}_start`;await this.send({event:s,data:{input:e.inputs},name:i,tags:e.tags??[],run_id:e.id,metadata:e.extra?.metadata??{}},n)}async onLLMNewToken(e,i,r){const n=this.runInfoMap.get(e.id);let s,a;if(n===void 0)throw new Error(`onLLMNewToken: Run ID ${e.id} not found in run map.`);if(this.runInfoMap.size!==1){if(n.runType==="chat_model")a="on_chat_model_stream",r?.chunk===void 0?s=new u_({content:i,id:`run-${e.id}`}):s=r.chunk.message;else if(n.runType==="llm")a="on_llm_stream",r?.chunk===void 0?s=new P1({text:i}):s=r.chunk;else throw new Error(`Unexpected run type ${n.runType}`);await this.send({event:a,data:{chunk:s},run_id:e.id,name:n.name,tags:n.tags,metadata:n.metadata},n)}}async onLLMEnd(e){const i=this.runInfoMap.get(e.id);this.runInfoMap.delete(e.id);let r;if(i===void 0)throw new Error(`onLLMEnd: Run ID ${e.id} not found in run map.`);const n=e.outputs?.generations;let s;if(i.runType==="chat_model"){for(const a of n??[]){if(s!==void 0)break;s=a[0]?.message}r="on_chat_model_end"}else if(i.runType==="llm")s={generations:n?.map(a=>a.map(o=>({text:o.text,generationInfo:o.generationInfo}))),llmOutput:e.outputs?.llmOutput??{}},r="on_llm_end";else throw new Error(`onLLMEnd: Unexpected run type: ${i.runType}`);await this.sendEndEvent({event:r,data:{output:s,input:i.inputs},run_id:e.id,name:i.name,tags:i.tags,metadata:i.metadata},i)}async onChainStart(e){const i=c2(e),r=e.run_type??"chain",n={tags:e.tags??[],metadata:e.extra?.metadata??{},name:i,runType:e.run_type};let s={};e.inputs.input===""&&Object.keys(e.inputs).length===1?(s={},n.inputs={}):e.inputs.input!==void 0?(s.input=e.inputs.input,n.inputs=e.inputs.input):(s.input=e.inputs,n.inputs=e.inputs),this.runInfoMap.set(e.id,n),await this.send({event:`on_${r}_start`,data:s,name:i,tags:e.tags??[],run_id:e.id,metadata:e.extra?.metadata??{}},n)}async onChainEnd(e){const i=this.runInfoMap.get(e.id);if(this.runInfoMap.delete(e.id),i===void 0)throw new Error(`onChainEnd: Run ID ${e.id} not found in run map.`);const r=`on_${e.run_type}_end`,n=e.inputs??i.inputs??{},a={output:e.outputs?.output??e.outputs,input:n};n.input&&Object.keys(n).length===1&&(a.input=n.input,i.inputs=n.input),await this.sendEndEvent({event:r,data:a,run_id:e.id,name:i.name,tags:i.tags,metadata:i.metadata??{}},i)}async onToolStart(e){const i=c2(e),r={tags:e.tags??[],metadata:e.extra?.metadata??{},name:i,runType:"tool",inputs:e.inputs??{}};this.runInfoMap.set(e.id,r),await this.send({event:"on_tool_start",data:{input:e.inputs??{}},name:i,run_id:e.id,tags:e.tags??[],metadata:e.extra?.metadata??{}},r)}async onToolEnd(e){const i=this.runInfoMap.get(e.id);if(this.runInfoMap.delete(e.id),i===void 0)throw new Error(`onToolEnd: Run ID ${e.id} not found in run map.`);if(i.inputs===void 0)throw new Error(`onToolEnd: Run ID ${e.id} is a tool call, and is expected to have traced inputs.`);const r=e.outputs?.output===void 0?e.outputs:e.outputs.output;await this.sendEndEvent({event:"on_tool_end",data:{output:r,input:i.inputs},run_id:e.id,name:i.name,tags:i.tags,metadata:i.metadata},i)}async onRetrieverStart(e){const i=c2(e),n={tags:e.tags??[],metadata:e.extra?.metadata??{},name:i,runType:"retriever",inputs:{query:e.inputs.query}};this.runInfoMap.set(e.id,n),await this.send({event:"on_retriever_start",data:{input:{query:e.inputs.query}},name:i,tags:e.tags??[],run_id:e.id,metadata:e.extra?.metadata??{}},n)}async onRetrieverEnd(e){const i=this.runInfoMap.get(e.id);if(this.runInfoMap.delete(e.id),i===void 0)throw new Error(`onRetrieverEnd: Run ID ${e.id} not found in run map.`);await this.sendEndEvent({event:"on_retriever_end",data:{output:e.outputs?.documents??e.outputs,input:i.inputs},run_id:e.id,name:i.name,tags:i.tags,metadata:i.metadata},i)}async handleCustomEvent(e,i,r){const n=this.runInfoMap.get(r);if(n===void 0)throw new Error(`handleCustomEvent: Run ID ${r} not found in run map.`);await this.send({event:"on_custom_event",run_id:r,name:e,tags:n.tags,metadata:n.metadata,data:i},n)}async finish(){const e=[...this.tappedPromises.values()];Promise.all(e).finally(()=>{this.writer.close()})}}const G2e=[400,401,402,403,404,405,406,407,409],W2e=t=>{if(t.message.startsWith("Cancel")||t.message.startsWith("AbortError")||t.name==="AbortError"||t?.code==="ECONNABORTED")throw t;const e=t?.response?.status??t?.status;if(e&&G2e.includes(+e))throw t;if(t?.error?.code==="insufficient_quota"){const i=new Error(t?.message);throw i.name="InsufficientQuotaError",i}};class I6{constructor(e){Object.defineProperty(this,"maxConcurrency",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"maxRetries",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"onFailedAttempt",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"queue",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.maxConcurrency=e.maxConcurrency??1/0,this.maxRetries=e.maxRetries??6,this.onFailedAttempt=e.onFailedAttempt??W2e;const i="default"in Rp?Rp.default:Rp;this.queue=new i({concurrency:this.maxConcurrency})}call(e,...i){return this.queue.add(()=>II(()=>e(...i).catch(r=>{throw r instanceof Error?r:new Error(r)}),{onFailedAttempt:this.onFailedAttempt,retries:this.maxRetries,randomize:!0}),{throwOnTimeout:!0})}callWithOptions(e,i,...r){return e.signal?Promise.race([this.call(i,...r),new Promise((n,s)=>{e.signal?.addEventListener("abort",()=>{s(new Error("AbortError"))})})]):this.call(i,...r)}fetch(...e){return this.call(()=>fetch(...e).then(i=>i.ok?i:Promise.reject(i)))}}class Rae extends dT{constructor({config:e,onStart:i,onEnd:r,onError:n}){super({_awaitHandler:!0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"RootListenersTracer"}),Object.defineProperty(this,"rootId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"config",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"argOnStart",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"argOnEnd",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"argOnError",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.config=e,this.argOnStart=i,this.argOnEnd=r,this.argOnError=n}persistRun(e){return Promise.resolve()}async onRunCreate(e){this.rootId||(this.rootId=e.id,this.argOnStart&&await this.argOnStart(e,this.config))}async onRunUpdate(e){e.id===this.rootId&&(e.error?this.argOnError&&await this.argOnError(e,this.config):this.argOnEnd&&await this.argOnEnd(e,this.config))}}function D6(t){return t?t.lc_runnable:!1}class q2e{constructor(e){Object.defineProperty(this,"includeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.includeNames=e.includeNames,this.includeTypes=e.includeTypes,this.includeTags=e.includeTags,this.excludeNames=e.excludeNames,this.excludeTypes=e.excludeTypes,this.excludeTags=e.excludeTags}includeEvent(e,i){let r=this.includeNames===void 0&&this.includeTypes===void 0&&this.includeTags===void 0;const n=e.tags??[];return this.includeNames!==void 0&&(r=r||this.includeNames.includes(e.name)),this.includeTypes!==void 0&&(r=r||this.includeTypes.includes(i)),this.includeTags!==void 0&&(r=r||n.some(s=>this.includeTags?.includes(s))),this.excludeNames!==void 0&&(r=r&&!this.excludeNames.includes(e.name)),this.excludeTypes!==void 0&&(r=r&&!this.excludeTypes.includes(i)),this.excludeTags!==void 0&&(r=r&&n.every(s=>!this.excludeTags?.includes(s))),r}}function iU(t){return t.replace(/[^a-zA-Z-_0-9]/g,"_")}const X2e=["*","_","`"];function $2e(t){let e="";for(const[i,r]of Object.entries(t))e+=`	classDef ${i} ${r};
`;return e}function Y2e(t,e,i){const{firstNode:r,lastNode:n,nodeColors:s,withStyles:a=!0,curveStyle:o="linear",wrapLabelNWords:l=9}=i??{};let c=a?`%%{init: {'flowchart': {'curve': '${o}'}}}%%
graph TD;
`:`graph TD;
`;if(a){const f="default",p={[f]:"{0}({1})"};r!==void 0&&(p[r]="{0}([{1}]):::first"),n!==void 0&&(p[n]="{0}([{1}]):::last");for(const[g,m]of Object.entries(t)){const y=m.name.split(":").pop()??"";let w=X2e.some(M=>y.startsWith(M)&&y.endsWith(M))?`<p>${y}</p>`:y;Object.keys(m.metadata??{}).length&&(w+=`<hr/><small><em>${Object.entries(m.metadata??{}).map(([M,A])=>`${M} = ${A}`).join(`
`)}</em></small>`);const E=(p[g]??p[f]).replace("{0}",iU(g)).replace("{1}",w);c+=`	${E}
`}}const u={};for(const f of e){const p=f.source.split(":"),g=f.target.split(":"),m=p.filter((y,b)=>y===g[b]).join(":");u[m]||(u[m]=[]),u[m].push(f)}const h=new Set;function d(f,p){const g=f.length===1&&f[0].source===f[0].target;if(p&&!g){const m=p.split(":").pop();if(h.has(m))throw new Error(`Found duplicate subgraph '${m}' -- this likely means that you're reusing a subgraph node with the same name. Please adjust your graph to have subgraph nodes with unique names.`);h.add(m),c+=`	subgraph ${m}
`}for(const m of f){const{source:y,target:b,data:w,conditional:E}=m;let M="";if(w!==void 0){let A=w;const P=A.split(" ");P.length>l&&(A=Array.from({length:Math.ceil(P.length/l)},(C,R)=>P.slice(R*l,(R+1)*l).join(" ")).join("&nbsp;<br>&nbsp;")),M=E?` -. &nbsp;${A}&nbsp; .-> `:` -- &nbsp;${A}&nbsp; --> `}else M=E?" -.-> ":" --> ";c+=`	${iU(y)}${M}${iU(b)};
`}for(const m in u)m.startsWith(`${p}:`)&&m!==p&&d(u[m],m);p&&!g&&(c+=`	end
`)}d(u[""]??[],"");for(const f in u)!f.includes(":")&&f!==""&&d(u[f],f);return a&&(c+=$2e(s??{})),c}async function K2e(t,e){return Z2e(t,{...e,imageType:"png"})}async function Z2e(t,e){let i=e?.backgroundColor??"white";const r=e?.imageType,n=btoa(t);i!==void 0&&(/^#(?:[0-9a-fA-F]{3}){1,2}$/.test(i)||(i=`!${i}`));const s=`https://mermaid.ink/img/${n}?bgColor=${i}&type=${r}`,a=await fetch(s);if(!a.ok)throw new Error(["Failed to render the graph using the Mermaid.INK API.",`Status code: ${a.status}`,`Status text: ${a.statusText}`].join(`
`));return await a.blob()}function uO(t,e,i){function r(o,l){var c;Object.defineProperty(o,"_zod",{value:o._zod??{},enumerable:!1}),(c=o._zod).traits??(c.traits=new Set),o._zod.traits.add(t),e(o,l);for(const u in a.prototype)u in o||Object.defineProperty(o,u,{value:a.prototype[u].bind(o)});o._zod.constr=a,o._zod.def=l}const n=i?.Parent??Object;class s extends n{}Object.defineProperty(s,"name",{value:t});function a(o){var l;const c=i?.Parent?new s:this;r(c,o),(l=c._zod).deferred??(l.deferred=[]);for(const u of c._zod.deferred)u();return c}return Object.defineProperty(a,"init",{value:r}),Object.defineProperty(a,Symbol.hasInstance,{value:o=>i?.Parent&&o instanceof i.Parent?!0:o?._zod?.traits?.has(t)}),Object.defineProperty(a,"name",{value:t}),a}class UI extends Error{constructor(){super("Encountered Promise during synchronous parse. Use .parseAsync() instead.")}}const Q2e={};function hO(t){return Q2e}function J2e(t){const e=Object.values(t).filter(r=>typeof r=="number");return Object.entries(t).filter(([r,n])=>e.indexOf(+r)===-1).map(([r,n])=>n)}function ePe(t,e){return typeof e=="bigint"?e.toString():e}const Iae=Error.captureStackTrace?Error.captureStackTrace:(...t)=>{};function BI(t,e,i){const r=new t._zod.constr(e??t._zod.def);return(!e||i?.parent)&&(r._zod.parent=t),r}function tPe(t){return{}}function rU(t,e=0){for(let i=e;i<t.issues.length;i++)if(t.issues[i]?.continue!==!0)return!0;return!1}function u2(t){return typeof t=="string"?t:t?.message}function dO(t,e,i){const r={...t,path:t.path??[]};if(!t.message){const n=u2(t.inst?._zod.def?.error?.(t))??u2(e?.error?.(t))??u2(i.customError?.(t))??u2(i.localeError?.(t))??"Invalid input";r.message=n}return delete r.inst,delete r.continue,e?.reportInput||delete r.input,r}const Dae=(t,e)=>{t.name="$ZodError",Object.defineProperty(t,"_zod",{value:t._zod,enumerable:!1}),Object.defineProperty(t,"issues",{value:e,enumerable:!1}),Object.defineProperty(t,"message",{get(){return JSON.stringify(e,ePe,2)},enumerable:!0}),Object.defineProperty(t,"toString",{value:()=>t.message,enumerable:!1})},iPe=uO("$ZodError",Dae),fO=uO("$ZodError",Dae,{Parent:Error}),rPe=t=>(e,i,r,n)=>{const s=r?Object.assign(r,{async:!1}):{async:!1},a=e._zod.run({value:i,issues:[]},s);if(a instanceof Promise)throw new UI;if(a.issues.length){const o=new(n?.Err??t)(a.issues.map(l=>dO(l,s,hO())));throw Iae(o,n?.callee),o}return a.value},nPe=rPe(fO),sPe=t=>async(e,i,r,n)=>{const s=r?Object.assign(r,{async:!0}):{async:!0};let a=e._zod.run({value:i,issues:[]},s);if(a instanceof Promise&&(a=await a),a.issues.length){const o=new(n?.Err??t)(a.issues.map(l=>dO(l,s,hO())));throw Iae(o,n?.callee),o}return a.value},aPe=sPe(fO),oPe=t=>(e,i,r)=>{const n=r?{...r,async:!1}:{async:!1},s=e._zod.run({value:i,issues:[]},n);if(s instanceof Promise)throw new UI;return s.issues.length?{success:!1,error:new(t??iPe)(s.issues.map(a=>dO(a,n,hO())))}:{success:!0,data:s.value}},lPe=oPe(fO),cPe=t=>async(e,i,r)=>{const n=r?Object.assign(r,{async:!0}):{async:!0};let s=e._zod.run({value:i,issues:[]},n);return s instanceof Promise&&(s=await s),s.issues.length?{success:!1,error:new t(s.issues.map(a=>dO(a,n,hO())))}:{success:!0,data:s.value}},uPe=cPe(fO),hPe={major:4,minor:0,patch:0},dPe=uO("$ZodType",(t,e)=>{var i;t??(t={}),t._zod.def=e,t._zod.bag=t._zod.bag||{},t._zod.version=hPe;const r=[...t._zod.def.checks??[]];t._zod.traits.has("$ZodCheck")&&r.unshift(t);for(const n of r)for(const s of n._zod.onattach)s(t);if(r.length===0)(i=t._zod).deferred??(i.deferred=[]),t._zod.deferred?.push(()=>{t._zod.run=t._zod.parse});else{const n=(s,a,o)=>{let l=rU(s),c;for(const u of a){if(u._zod.def.when){if(!u._zod.def.when(s))continue}else if(l)continue;const h=s.issues.length,d=u._zod.check(s);if(d instanceof Promise&&o?.async===!1)throw new UI;if(c||d instanceof Promise)c=(c??Promise.resolve()).then(async()=>{await d,s.issues.length!==h&&(l||(l=rU(s,h)))});else{if(s.issues.length===h)continue;l||(l=rU(s,h))}}return c?c.then(()=>s):s};t._zod.run=(s,a)=>{const o=t._zod.parse(s,a);if(o instanceof Promise){if(a.async===!1)throw new UI;return o.then(l=>n(l,r,a))}return n(o,r,a)}}t["~standard"]={validate:n=>{try{const s=lPe(t,n);return s.success?{value:s.data}:{issues:s.error?.issues}}catch{return uPe(t,n).then(a=>a.success?{value:a.data}:{issues:a.error?.issues})}},vendor:"zod",version:1}}),fPe=uO("$ZodNever",(t,e)=>{dPe.init(t,e),t._zod.parse=(i,r)=>(i.issues.push({expected:"never",code:"invalid_type",input:i.value,inst:t}),i)});class Oae{constructor(){this._map=new Map,this._idmap=new Map}add(e,...i){const r=i[0];if(this._map.set(e,r),r&&typeof r=="object"&&"id"in r){if(this._idmap.has(r.id))throw new Error(`ID ${r.id} already exists in the registry`);this._idmap.set(r.id,e)}return this}clear(){return this._map=new Map,this._idmap=new Map,this}remove(e){const i=this._map.get(e);return i&&typeof i=="object"&&"id"in i&&this._idmap.delete(i.id),this._map.delete(e),this}get(e){const i=e._zod.parent;if(i){const r={...this.get(i)??{}};return delete r.id,{...r,...this._map.get(e)}}return this._map.get(e)}has(e){return this._map.has(e)}}function pPe(){return new Oae}const Tg=pPe();function mPe(t,e){return new t({type:"never",...tPe()})}class VX{constructor(e){this.counter=0,this.metadataRegistry=e?.metadata??Tg,this.target=e?.target??"draft-2020-12",this.unrepresentable=e?.unrepresentable??"throw",this.override=e?.override??(()=>{}),this.io=e?.io??"output",this.seen=new Map}process(e,i={path:[],schemaPath:[]}){var r;const n=e._zod.def,s={guid:"uuid",url:"uri",datetime:"date-time",json_string:"json-string",regex:""},a=this.seen.get(e);if(a)return a.count++,i.schemaPath.includes(e)&&(a.cycle=i.path),a.schema;const o={schema:{},count:1,cycle:void 0,path:i.path};this.seen.set(e,o);const l=e._zod.toJSONSchema?.();if(l)o.schema=l;else{const h={...i,schemaPath:[...i.schemaPath,e],path:i.path},d=e._zod.parent;if(d)o.ref=d,this.process(d,h),this.seen.get(d).isParent=!0;else{const f=o.schema;switch(n.type){case"string":{const p=f;p.type="string";const{minimum:g,maximum:m,format:y,patterns:b,contentEncoding:w}=e._zod.bag;if(typeof g=="number"&&(p.minLength=g),typeof m=="number"&&(p.maxLength=m),y&&(p.format=s[y]??y,p.format===""&&delete p.format),w&&(p.contentEncoding=w),b&&b.size>0){const E=[...b];E.length===1?p.pattern=E[0].source:E.length>1&&(o.schema.allOf=[...E.map(M=>({...this.target==="draft-7"?{type:"string"}:{},pattern:M.source}))])}break}case"number":{const p=f,{minimum:g,maximum:m,format:y,multipleOf:b,exclusiveMaximum:w,exclusiveMinimum:E}=e._zod.bag;typeof y=="string"&&y.includes("int")?p.type="integer":p.type="number",typeof E=="number"&&(p.exclusiveMinimum=E),typeof g=="number"&&(p.minimum=g,typeof E=="number"&&(E>=g?delete p.minimum:delete p.exclusiveMinimum)),typeof w=="number"&&(p.exclusiveMaximum=w),typeof m=="number"&&(p.maximum=m,typeof w=="number"&&(w<=m?delete p.maximum:delete p.exclusiveMaximum)),typeof b=="number"&&(p.multipleOf=b);break}case"boolean":{const p=f;p.type="boolean";break}case"bigint":{if(this.unrepresentable==="throw")throw new Error("BigInt cannot be represented in JSON Schema");break}case"symbol":{if(this.unrepresentable==="throw")throw new Error("Symbols cannot be represented in JSON Schema");break}case"null":{f.type="null";break}case"any":break;case"unknown":break;case"undefined":{if(this.unrepresentable==="throw")throw new Error("Undefined cannot be represented in JSON Schema");break}case"void":{if(this.unrepresentable==="throw")throw new Error("Void cannot be represented in JSON Schema");break}case"never":{f.not={};break}case"date":{if(this.unrepresentable==="throw")throw new Error("Date cannot be represented in JSON Schema");break}case"array":{const p=f,{minimum:g,maximum:m}=e._zod.bag;typeof g=="number"&&(p.minItems=g),typeof m=="number"&&(p.maxItems=m),p.type="array",p.items=this.process(n.element,{...h,path:[...h.path,"items"]});break}case"object":{const p=f;p.type="object",p.properties={};const g=n.shape;for(const b in g)p.properties[b]=this.process(g[b],{...h,path:[...h.path,"properties",b]});const m=new Set(Object.keys(g)),y=new Set([...m].filter(b=>{const w=n.shape[b]._zod;return this.io==="input"?w.optin===void 0:w.optout===void 0}));y.size>0&&(p.required=Array.from(y)),n.catchall?._zod.def.type==="never"?p.additionalProperties=!1:n.catchall?n.catchall&&(p.additionalProperties=this.process(n.catchall,{...h,path:[...h.path,"additionalProperties"]})):this.io==="output"&&(p.additionalProperties=!1);break}case"union":{const p=f;p.anyOf=n.options.map((g,m)=>this.process(g,{...h,path:[...h.path,"anyOf",m]}));break}case"intersection":{const p=f,g=this.process(n.left,{...h,path:[...h.path,"allOf",0]}),m=this.process(n.right,{...h,path:[...h.path,"allOf",1]}),y=w=>"allOf"in w&&Object.keys(w).length===1,b=[...y(g)?g.allOf:[g],...y(m)?m.allOf:[m]];p.allOf=b;break}case"tuple":{const p=f;p.type="array";const g=n.items.map((b,w)=>this.process(b,{...h,path:[...h.path,"prefixItems",w]}));if(this.target==="draft-2020-12"?p.prefixItems=g:p.items=g,n.rest){const b=this.process(n.rest,{...h,path:[...h.path,"items"]});this.target==="draft-2020-12"?p.items=b:p.additionalItems=b}n.rest&&(p.items=this.process(n.rest,{...h,path:[...h.path,"items"]}));const{minimum:m,maximum:y}=e._zod.bag;typeof m=="number"&&(p.minItems=m),typeof y=="number"&&(p.maxItems=y);break}case"record":{const p=f;p.type="object",p.propertyNames=this.process(n.keyType,{...h,path:[...h.path,"propertyNames"]}),p.additionalProperties=this.process(n.valueType,{...h,path:[...h.path,"additionalProperties"]});break}case"map":{if(this.unrepresentable==="throw")throw new Error("Map cannot be represented in JSON Schema");break}case"set":{if(this.unrepresentable==="throw")throw new Error("Set cannot be represented in JSON Schema");break}case"enum":{const p=f,g=J2e(n.entries);g.every(m=>typeof m=="number")&&(p.type="number"),g.every(m=>typeof m=="string")&&(p.type="string"),p.enum=g;break}case"literal":{const p=f,g=[];for(const m of n.values)if(m===void 0){if(this.unrepresentable==="throw")throw new Error("Literal `undefined` cannot be represented in JSON Schema")}else if(typeof m=="bigint"){if(this.unrepresentable==="throw")throw new Error("BigInt literals cannot be represented in JSON Schema");g.push(Number(m))}else g.push(m);if(g.length!==0)if(g.length===1){const m=g[0];p.type=m===null?"null":typeof m,p.const=m}else g.every(m=>typeof m=="number")&&(p.type="number"),g.every(m=>typeof m=="string")&&(p.type="string"),g.every(m=>typeof m=="boolean")&&(p.type="string"),g.every(m=>m===null)&&(p.type="null"),p.enum=g;break}case"file":{const p=f,g={type:"string",format:"binary",contentEncoding:"binary"},{minimum:m,maximum:y,mime:b}=e._zod.bag;m!==void 0&&(g.minLength=m),y!==void 0&&(g.maxLength=y),b?b.length===1?(g.contentMediaType=b[0],Object.assign(p,g)):p.anyOf=b.map(w=>({...g,contentMediaType:w})):Object.assign(p,g);break}case"transform":{if(this.unrepresentable==="throw")throw new Error("Transforms cannot be represented in JSON Schema");break}case"nullable":{const p=this.process(n.innerType,h);f.anyOf=[p,{type:"null"}];break}case"nonoptional":{this.process(n.innerType,h),o.ref=n.innerType;break}case"success":{const p=f;p.type="boolean";break}case"default":{this.process(n.innerType,h),o.ref=n.innerType,f.default=JSON.parse(JSON.stringify(n.defaultValue));break}case"prefault":{this.process(n.innerType,h),o.ref=n.innerType,this.io==="input"&&(f._prefault=JSON.parse(JSON.stringify(n.defaultValue)));break}case"catch":{this.process(n.innerType,h),o.ref=n.innerType;let p;try{p=n.catchValue(void 0)}catch{throw new Error("Dynamic catch values are not supported in JSON Schema")}f.default=p;break}case"nan":{if(this.unrepresentable==="throw")throw new Error("NaN cannot be represented in JSON Schema");break}case"template_literal":{const p=f,g=e._zod.pattern;if(!g)throw new Error("Pattern not found in template literal");p.type="string",p.pattern=g.source;break}case"pipe":{const p=this.io==="input"?n.in._zod.def.type==="transform"?n.out:n.in:n.out;this.process(p,h),o.ref=p;break}case"readonly":{this.process(n.innerType,h),o.ref=n.innerType,f.readOnly=!0;break}case"promise":{this.process(n.innerType,h),o.ref=n.innerType;break}case"optional":{this.process(n.innerType,h),o.ref=n.innerType;break}case"lazy":{const p=e._zod.innerType;this.process(p,h),o.ref=p;break}case"custom":{if(this.unrepresentable==="throw")throw new Error("Custom types cannot be represented in JSON Schema");break}}}}const c=this.metadataRegistry.get(e);return c&&Object.assign(o.schema,c),this.io==="input"&&sa(e)&&(delete o.schema.examples,delete o.schema.default),this.io==="input"&&o.schema._prefault&&((r=o.schema).default??(r.default=o.schema._prefault)),delete o.schema._prefault,this.seen.get(e).schema}emit(e,i){const r={cycles:i?.cycles??"ref",reused:i?.reused??"inline",external:i?.external??void 0},n=this.seen.get(e);if(!n)throw new Error("Unprocessed schema. This is a bug in Zod.");const s=u=>{const h=this.target==="draft-2020-12"?"$defs":"definitions";if(r.external){const g=r.external.registry.get(u[0])?.id,m=r.external.uri??(b=>b);if(g)return{ref:m(g)};const y=u[1].defId??u[1].schema.id??`schema${this.counter++}`;return u[1].defId=y,{defId:y,ref:`${m("__shared")}#/${h}/${y}`}}if(u[1]===n)return{ref:"#"};const f=`#/${h}/`,p=u[1].schema.id??`__schema${this.counter++}`;return{defId:p,ref:f+p}},a=u=>{if(u[1].schema.$ref)return;const h=u[1],{ref:d,defId:f}=s(u);h.def={...h.schema},f&&(h.defId=f);const p=h.schema;for(const g in p)delete p[g];p.$ref=d};if(r.cycles==="throw")for(const u of this.seen.entries()){const h=u[1];if(h.cycle)throw new Error(`Cycle detected: #/${h.cycle?.join("/")}/<root>

Set the \`cycles\` parameter to \`"ref"\` to resolve cyclical schemas with defs.`)}for(const u of this.seen.entries()){const h=u[1];if(e===u[0]){a(u);continue}if(r.external){const f=r.external.registry.get(u[0])?.id;if(e!==u[0]&&f){a(u);continue}}if(this.metadataRegistry.get(u[0])?.id){a(u);continue}if(h.cycle){a(u);continue}if(h.count>1&&r.reused==="ref"){a(u);continue}}const o=(u,h)=>{const d=this.seen.get(u),f=d.def??d.schema,p={...f};if(d.ref===null)return;const g=d.ref;if(d.ref=null,g){o(g,h);const m=this.seen.get(g).schema;m.$ref&&h.target==="draft-7"?(f.allOf=f.allOf??[],f.allOf.push(m)):(Object.assign(f,m),Object.assign(f,p))}d.isParent||this.override({zodSchema:u,jsonSchema:f,path:d.path??[]})};for(const u of[...this.seen.entries()].reverse())o(u[0],{target:this.target});const l={};if(this.target==="draft-2020-12"?l.$schema="https://json-schema.org/draft/2020-12/schema":this.target==="draft-7"?l.$schema="http://json-schema.org/draft-07/schema#":console.warn(`Invalid target: ${this.target}`),r.external?.uri){const u=r.external.registry.get(e)?.id;if(!u)throw new Error("Schema is missing an `id` property");l.$id=r.external.uri(u)}Object.assign(l,n.def);const c=r.external?.defs??{};for(const u of this.seen.entries()){const h=u[1];h.def&&h.defId&&(c[h.defId]=h.def)}r.external||Object.keys(c).length>0&&(this.target==="draft-2020-12"?l.$defs=c:l.definitions=c);try{return JSON.parse(JSON.stringify(l))}catch{throw new Error("Error converting schema to JSON.")}}}function HX(t,e){if(t instanceof Oae){const r=new VX(e),n={};for(const o of t._idmap.entries()){const[l,c]=o;r.process(c)}const s={},a={registry:t,uri:e?.uri,defs:n};for(const o of t._idmap.entries()){const[l,c]=o;s[l]=r.emit(c,{...e,external:a})}if(Object.keys(n).length>0){const o=r.target==="draft-2020-12"?"$defs":"definitions";s.__shared={[o]:n}}return{schemas:s}}const i=new VX(e);return i.process(t),i.emit(t,e)}function sa(t,e){const i=e??{seen:new Set};if(i.seen.has(t))return!1;i.seen.add(t);const n=t._zod.def;switch(n.type){case"string":case"number":case"bigint":case"boolean":case"date":case"symbol":case"undefined":case"null":case"any":case"unknown":case"never":case"void":case"literal":case"enum":case"nan":case"file":case"template_literal":return!1;case"array":return sa(n.element,i);case"object":{for(const s in n.shape)if(sa(n.shape[s],i))return!0;return!1}case"union":{for(const s of n.options)if(sa(s,i))return!0;return!1}case"intersection":return sa(n.left,i)||sa(n.right,i);case"tuple":{for(const s of n.items)if(sa(s,i))return!0;return!!(n.rest&&sa(n.rest,i))}case"record":return sa(n.keyType,i)||sa(n.valueType,i);case"map":return sa(n.keyType,i)||sa(n.valueType,i);case"set":return sa(n.valueType,i);case"promise":case"optional":case"nonoptional":case"nullable":case"readonly":return sa(n.innerType,i);case"lazy":return sa(n.getter(),i);case"default":return sa(n.innerType,i);case"prefault":return sa(n.innerType,i);case"custom":return!1;case"transform":return!0;case"pipe":return sa(n.in,i)||sa(n.out,i);case"success":return!1;case"catch":return!1}throw new Error(`Unknown schema type: ${n.type}`)}const gPe=Symbol("Let zodToJsonSchema decide on which parser to use"),vPe={name:void 0,$refStrategy:"root",basePath:["#"],effectStrategy:"input",pipeStrategy:"all",dateStrategy:"format:date-time",mapStrategy:"entries",removeAdditionalStrategy:"passthrough",allowedAdditionalProperties:!0,rejectedAdditionalProperties:!1,definitionPath:"definitions",target:"jsonSchema7",strictUnions:!1,definitions:{},errorMessages:!1,markdownDescription:!1,patternStrategy:"escape",applyRegexFlags:!1,emailStrategy:"format:email",base64Strategy:"contentEncoding:base64",nameStrategy:"ref",openAiAnyTypeName:"OpenAiAnyType"},yPe=t=>({...vPe,...t}),xPe=t=>{const e=yPe(t),i=e.name!==void 0?[...e.basePath,e.definitionPath,e.name]:e.basePath;return{...e,flags:{hasReferencedOpenAiAnyType:!1},currentPath:i,propertyPath:void 0,seen:new Map(Object.entries(e.definitions).map(([r,n])=>[n._def,{def:n._def,path:[...e.basePath,e.definitionPath,r],jsonSchema:void 0}]))}};function Lae(t,e,i,r){r?.errorMessages&&i&&(t.errorMessage={...t.errorMessage,[e]:i})}function un(t,e,i,r,n){t[e]=i,Lae(t,e,r,n)}const kae=(t,e)=>{let i=0;for(;i<t.length&&i<e.length&&t[i]===e[i];i++);return[(t.length-i).toString(),...e.slice(i)].join("/")};function Lc(t){if(t.target!=="openAi")return{};const e=[...t.basePath,t.definitionPath,t.openAiAnyTypeName];return t.flags.hasReferencedOpenAiAnyType=!0,{$ref:t.$refStrategy==="relative"?kae(e,t.currentPath):e.join("/")}}function bPe(t,e){const i={type:"array"};return t.type?._def&&t.type?._def?.typeName!==Ut.ZodAny&&(i.items=en(t.type._def,{...e,currentPath:[...e.currentPath,"items"]})),t.minLength&&un(i,"minItems",t.minLength.value,t.minLength.message,e),t.maxLength&&un(i,"maxItems",t.maxLength.value,t.maxLength.message,e),t.exactLength&&(un(i,"minItems",t.exactLength.value,t.exactLength.message,e),un(i,"maxItems",t.exactLength.value,t.exactLength.message,e)),i}function wPe(t,e){const i={type:"integer",format:"int64"};if(!t.checks)return i;for(const r of t.checks)switch(r.kind){case"min":e.target==="jsonSchema7"?r.inclusive?un(i,"minimum",r.value,r.message,e):un(i,"exclusiveMinimum",r.value,r.message,e):(r.inclusive||(i.exclusiveMinimum=!0),un(i,"minimum",r.value,r.message,e));break;case"max":e.target==="jsonSchema7"?r.inclusive?un(i,"maximum",r.value,r.message,e):un(i,"exclusiveMaximum",r.value,r.message,e):(r.inclusive||(i.exclusiveMaximum=!0),un(i,"maximum",r.value,r.message,e));break;case"multipleOf":un(i,"multipleOf",r.value,r.message,e);break}return i}function _Pe(){return{type:"boolean"}}function Nae(t,e){return en(t.type._def,e)}const SPe=(t,e)=>en(t.innerType._def,e);function Uae(t,e,i){const r=i??e.dateStrategy;if(Array.isArray(r))return{anyOf:r.map((n,s)=>Uae(t,e,n))};switch(r){case"string":case"format:date-time":return{type:"string",format:"date-time"};case"format:date":return{type:"string",format:"date"};case"integer":return EPe(t,e)}}const EPe=(t,e)=>{const i={type:"integer",format:"unix-time"};if(e.target==="openApi3")return i;for(const r of t.checks)switch(r.kind){case"min":un(i,"minimum",r.value,r.message,e);break;case"max":un(i,"maximum",r.value,r.message,e);break}return i};function APe(t,e){return{...en(t.innerType._def,e),default:t.defaultValue()}}function MPe(t,e){return e.effectStrategy==="input"?en(t.schema._def,e):Lc(e)}function TPe(t){return{type:"string",enum:Array.from(t.values)}}const CPe=t=>"type"in t&&t.type==="string"?!1:"allOf"in t;function PPe(t,e){const i=[en(t.left._def,{...e,currentPath:[...e.currentPath,"allOf","0"]}),en(t.right._def,{...e,currentPath:[...e.currentPath,"allOf","1"]})].filter(s=>!!s);let r=e.target==="jsonSchema2019-09"?{unevaluatedProperties:!1}:void 0;const n=[];return i.forEach(s=>{if(CPe(s))n.push(...s.allOf),s.unevaluatedProperties===void 0&&(r=void 0);else{let a=s;if("additionalProperties"in s&&s.additionalProperties===!1){const{additionalProperties:o,...l}=s;a=l}else r=void 0;n.push(a)}}),n.length?{allOf:n,...r}:void 0}function RPe(t,e){const i=typeof t.value;return i!=="bigint"&&i!=="number"&&i!=="boolean"&&i!=="string"?{type:Array.isArray(t.value)?"array":"object"}:e.target==="openApi3"?{type:i==="bigint"?"integer":i,enum:[t.value]}:{type:i==="bigint"?"integer":i,const:t.value}}let nU;const Yu={cuid:/^[cC][^\s-]{8,}$/,cuid2:/^[0-9a-z]+$/,ulid:/^[0-9A-HJKMNP-TV-Z]{26}$/,email:/^(?!\.)(?!.*\.\.)([a-zA-Z0-9_'+\-\.]*)[a-zA-Z0-9_+-]@([a-zA-Z0-9][a-zA-Z0-9\-]*\.)+[a-zA-Z]{2,}$/,emoji:()=>(nU===void 0&&(nU=RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u")),nU),uuid:/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/,ipv4:/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,ipv4Cidr:/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,ipv6:/^(([a-f0-9]{1,4}:){7}|::([a-f0-9]{1,4}:){0,6}|([a-f0-9]{1,4}:){1}:([a-f0-9]{1,4}:){0,5}|([a-f0-9]{1,4}:){2}:([a-f0-9]{1,4}:){0,4}|([a-f0-9]{1,4}:){3}:([a-f0-9]{1,4}:){0,3}|([a-f0-9]{1,4}:){4}:([a-f0-9]{1,4}:){0,2}|([a-f0-9]{1,4}:){5}:([a-f0-9]{1,4}:){0,1})([a-f0-9]{1,4}|(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2})))$/,ipv6Cidr:/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,base64:/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,base64url:/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,nanoid:/^[a-zA-Z0-9_-]{21}$/,jwt:/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/};function Bae(t,e){const i={type:"string"};if(t.checks)for(const r of t.checks)switch(r.kind){case"min":un(i,"minLength",typeof i.minLength=="number"?Math.max(i.minLength,r.value):r.value,r.message,e);break;case"max":un(i,"maxLength",typeof i.maxLength=="number"?Math.min(i.maxLength,r.value):r.value,r.message,e);break;case"email":switch(e.emailStrategy){case"format:email":Ku(i,"email",r.message,e);break;case"format:idn-email":Ku(i,"idn-email",r.message,e);break;case"pattern:zod":rl(i,Yu.email,r.message,e);break}break;case"url":Ku(i,"uri",r.message,e);break;case"uuid":Ku(i,"uuid",r.message,e);break;case"regex":rl(i,r.regex,r.message,e);break;case"cuid":rl(i,Yu.cuid,r.message,e);break;case"cuid2":rl(i,Yu.cuid2,r.message,e);break;case"startsWith":rl(i,RegExp(`^${sU(r.value,e)}`),r.message,e);break;case"endsWith":rl(i,RegExp(`${sU(r.value,e)}$`),r.message,e);break;case"datetime":Ku(i,"date-time",r.message,e);break;case"date":Ku(i,"date",r.message,e);break;case"time":Ku(i,"time",r.message,e);break;case"duration":Ku(i,"duration",r.message,e);break;case"length":un(i,"minLength",typeof i.minLength=="number"?Math.max(i.minLength,r.value):r.value,r.message,e),un(i,"maxLength",typeof i.maxLength=="number"?Math.min(i.maxLength,r.value):r.value,r.message,e);break;case"includes":{rl(i,RegExp(sU(r.value,e)),r.message,e);break}case"ip":{r.version!=="v6"&&Ku(i,"ipv4",r.message,e),r.version!=="v4"&&Ku(i,"ipv6",r.message,e);break}case"base64url":rl(i,Yu.base64url,r.message,e);break;case"jwt":rl(i,Yu.jwt,r.message,e);break;case"cidr":{r.version!=="v6"&&rl(i,Yu.ipv4Cidr,r.message,e),r.version!=="v4"&&rl(i,Yu.ipv6Cidr,r.message,e);break}case"emoji":rl(i,Yu.emoji(),r.message,e);break;case"ulid":{rl(i,Yu.ulid,r.message,e);break}case"base64":{switch(e.base64Strategy){case"format:binary":{Ku(i,"binary",r.message,e);break}case"contentEncoding:base64":{un(i,"contentEncoding","base64",r.message,e);break}case"pattern:zod":{rl(i,Yu.base64,r.message,e);break}}break}case"nanoid":rl(i,Yu.nanoid,r.message,e)}return i}function sU(t,e){return e.patternStrategy==="escape"?DPe(t):t}const IPe=new Set("ABCDEFGHIJKLMNOPQRSTUVXYZabcdefghijklmnopqrstuvxyz0123456789");function DPe(t){let e="";for(let i=0;i<t.length;i++)IPe.has(t[i])||(e+="\\"),e+=t[i];return e}function Ku(t,e,i,r){t.format||t.anyOf?.some(n=>n.format)?(t.anyOf||(t.anyOf=[]),t.format&&(t.anyOf.push({format:t.format,...t.errorMessage&&r.errorMessages&&{errorMessage:{format:t.errorMessage.format}}}),delete t.format,t.errorMessage&&(delete t.errorMessage.format,Object.keys(t.errorMessage).length===0&&delete t.errorMessage)),t.anyOf.push({format:e,...i&&r.errorMessages&&{errorMessage:{format:i}}})):un(t,"format",e,i,r)}function rl(t,e,i,r){t.pattern||t.allOf?.some(n=>n.pattern)?(t.allOf||(t.allOf=[]),t.pattern&&(t.allOf.push({pattern:t.pattern,...t.errorMessage&&r.errorMessages&&{errorMessage:{pattern:t.errorMessage.pattern}}}),delete t.pattern,t.errorMessage&&(delete t.errorMessage.pattern,Object.keys(t.errorMessage).length===0&&delete t.errorMessage)),t.allOf.push({pattern:GX(e,r),...i&&r.errorMessages&&{errorMessage:{pattern:i}}})):un(t,"pattern",GX(e,r),i,r)}function GX(t,e){if(!e.applyRegexFlags||!t.flags)return t.source;const i={i:t.flags.includes("i"),m:t.flags.includes("m"),s:t.flags.includes("s")},r=i.i?t.source.toLowerCase():t.source;let n="",s=!1,a=!1,o=!1;for(let l=0;l<r.length;l++){if(s){n+=r[l],s=!1;continue}if(i.i){if(a){if(r[l].match(/[a-z]/)){o?(n+=r[l],n+=`${r[l-2]}-${r[l]}`.toUpperCase(),o=!1):r[l+1]==="-"&&r[l+2]?.match(/[a-z]/)?(n+=r[l],o=!0):n+=`${r[l]}${r[l].toUpperCase()}`;continue}}else if(r[l].match(/[a-z]/)){n+=`[${r[l]}${r[l].toUpperCase()}]`;continue}}if(i.m){if(r[l]==="^"){n+=`(^|(?<=[\r
]))`;continue}else if(r[l]==="$"){n+=`($|(?=[\r
]))`;continue}}if(i.s&&r[l]==="."){n+=a?`${r[l]}\r
`:`[${r[l]}\r
]`;continue}n+=r[l],r[l]==="\\"?s=!0:a&&r[l]==="]"?a=!1:!a&&r[l]==="["&&(a=!0)}try{new RegExp(n)}catch{return console.warn(`Could not convert regex pattern at ${e.currentPath.join("/")} to a flag-independent form! Falling back to the flag-ignorant source`),t.source}return n}function Fae(t,e){if(e.target==="openAi"&&console.warn("Warning: OpenAI may not support records in schemas! Try an array of key-value pairs instead."),e.target==="openApi3"&&t.keyType?._def.typeName===Ut.ZodEnum)return{type:"object",required:t.keyType._def.values,properties:t.keyType._def.values.reduce((r,n)=>({...r,[n]:en(t.valueType._def,{...e,currentPath:[...e.currentPath,"properties",n]})??Lc(e)}),{}),additionalProperties:e.rejectedAdditionalProperties};const i={type:"object",additionalProperties:en(t.valueType._def,{...e,currentPath:[...e.currentPath,"additionalProperties"]})??e.allowedAdditionalProperties};if(e.target==="openApi3")return i;if(t.keyType?._def.typeName===Ut.ZodString&&t.keyType._def.checks?.length){const{type:r,...n}=Bae(t.keyType._def,e);return{...i,propertyNames:n}}else{if(t.keyType?._def.typeName===Ut.ZodEnum)return{...i,propertyNames:{enum:t.keyType._def.values}};if(t.keyType?._def.typeName===Ut.ZodBranded&&t.keyType._def.type._def.typeName===Ut.ZodString&&t.keyType._def.type._def.checks?.length){const{type:r,...n}=Nae(t.keyType._def,e);return{...i,propertyNames:n}}}return i}function OPe(t,e){if(e.mapStrategy==="record")return Fae(t,e);const i=en(t.keyType._def,{...e,currentPath:[...e.currentPath,"items","items","0"]})||Lc(e),r=en(t.valueType._def,{...e,currentPath:[...e.currentPath,"items","items","1"]})||Lc(e);return{type:"array",maxItems:125,items:{type:"array",items:[i,r],minItems:2,maxItems:2}}}function LPe(t){const e=t.values,r=Object.keys(t.values).filter(s=>typeof e[e[s]]!="number").map(s=>e[s]),n=Array.from(new Set(r.map(s=>typeof s)));return{type:n.length===1?n[0]==="string"?"string":"number":["string","number"],enum:r}}function kPe(t){return t.target==="openAi"?void 0:{not:Lc({...t,currentPath:[...t.currentPath,"not"]})}}function NPe(t){return t.target==="openApi3"?{enum:["null"],nullable:!0}:{type:"null"}}const FI={ZodString:"string",ZodNumber:"number",ZodBigInt:"integer",ZodBoolean:"boolean",ZodNull:"null"};function UPe(t,e){if(e.target==="openApi3")return WX(t,e);const i=t.options instanceof Map?Array.from(t.options.values()):t.options;if(i.every(r=>r._def.typeName in FI&&(!r._def.checks||!r._def.checks.length))){const r=i.reduce((n,s)=>{const a=FI[s._def.typeName];return a&&!n.includes(a)?[...n,a]:n},[]);return{type:r.length>1?r:r[0]}}else if(i.every(r=>r._def.typeName==="ZodLiteral"&&!r.description)){const r=i.reduce((n,s)=>{const a=typeof s._def.value;switch(a){case"string":case"number":case"boolean":return[...n,a];case"bigint":return[...n,"integer"];case"object":if(s._def.value===null)return[...n,"null"];case"symbol":case"undefined":case"function":default:return n}},[]);if(r.length===i.length){const n=r.filter((s,a,o)=>o.indexOf(s)===a);return{type:n.length>1?n:n[0],enum:i.reduce((s,a)=>s.includes(a._def.value)?s:[...s,a._def.value],[])}}}else if(i.every(r=>r._def.typeName==="ZodEnum"))return{type:"string",enum:i.reduce((r,n)=>[...r,...n._def.values.filter(s=>!r.includes(s))],[])};return WX(t,e)}const WX=(t,e)=>{const i=(t.options instanceof Map?Array.from(t.options.values()):t.options).map((r,n)=>en(r._def,{...e,currentPath:[...e.currentPath,"anyOf",`${n}`]})).filter(r=>!!r&&(!e.strictUnions||typeof r=="object"&&Object.keys(r).length>0));return i.length?{anyOf:i}:void 0};function BPe(t,e){if(["ZodString","ZodNumber","ZodBigInt","ZodBoolean","ZodNull"].includes(t.innerType._def.typeName)&&(!t.innerType._def.checks||!t.innerType._def.checks.length))return e.target==="openApi3"?{type:FI[t.innerType._def.typeName],nullable:!0}:{type:[FI[t.innerType._def.typeName],"null"]};if(e.target==="openApi3"){const r=en(t.innerType._def,{...e,currentPath:[...e.currentPath]});return r&&"$ref"in r?{allOf:[r],nullable:!0}:r&&{...r,nullable:!0}}const i=en(t.innerType._def,{...e,currentPath:[...e.currentPath,"anyOf","0"]});return i&&{anyOf:[i,{type:"null"}]}}function FPe(t,e){const i={type:"number"};if(!t.checks)return i;for(const r of t.checks)switch(r.kind){case"int":i.type="integer",Lae(i,"type",r.message,e);break;case"min":e.target==="jsonSchema7"?r.inclusive?un(i,"minimum",r.value,r.message,e):un(i,"exclusiveMinimum",r.value,r.message,e):(r.inclusive||(i.exclusiveMinimum=!0),un(i,"minimum",r.value,r.message,e));break;case"max":e.target==="jsonSchema7"?r.inclusive?un(i,"maximum",r.value,r.message,e):un(i,"exclusiveMaximum",r.value,r.message,e):(r.inclusive||(i.exclusiveMaximum=!0),un(i,"maximum",r.value,r.message,e));break;case"multipleOf":un(i,"multipleOf",r.value,r.message,e);break}return i}function zPe(t,e){const i=e.target==="openAi",r={type:"object",properties:{}},n=[],s=t.shape();for(const o in s){let l=s[o];if(l===void 0||l._def===void 0)continue;let c=VPe(l);c&&i&&(l._def.typeName==="ZodOptional"&&(l=l._def.innerType),l.isNullable()||(l=l.nullable()),c=!1);const u=en(l._def,{...e,currentPath:[...e.currentPath,"properties",o],propertyPath:[...e.currentPath,"properties",o]});u!==void 0&&(r.properties[o]=u,c||n.push(o))}n.length&&(r.required=n);const a=jPe(t,e);return a!==void 0&&(r.additionalProperties=a),r}function jPe(t,e){if(t.catchall._def.typeName!=="ZodNever")return en(t.catchall._def,{...e,currentPath:[...e.currentPath,"additionalProperties"]});switch(t.unknownKeys){case"passthrough":return e.allowedAdditionalProperties;case"strict":return e.rejectedAdditionalProperties;case"strip":return e.removeAdditionalStrategy==="strict"?e.allowedAdditionalProperties:e.rejectedAdditionalProperties}}function VPe(t){try{return t.isOptional()}catch{return!0}}const HPe=(t,e)=>{if(e.currentPath.toString()===e.propertyPath?.toString())return en(t.innerType._def,e);const i=en(t.innerType._def,{...e,currentPath:[...e.currentPath,"anyOf","1"]});return i?{anyOf:[{not:Lc(e)},i]}:Lc(e)},GPe=(t,e)=>{if(e.pipeStrategy==="input")return en(t.in._def,e);if(e.pipeStrategy==="output")return en(t.out._def,e);const i=en(t.in._def,{...e,currentPath:[...e.currentPath,"allOf","0"]}),r=en(t.out._def,{...e,currentPath:[...e.currentPath,"allOf",i?"1":"0"]});return{allOf:[i,r].filter(n=>n!==void 0)}};function WPe(t,e){return en(t.type._def,e)}function qPe(t,e){const r={type:"array",uniqueItems:!0,items:en(t.valueType._def,{...e,currentPath:[...e.currentPath,"items"]})};return t.minSize&&un(r,"minItems",t.minSize.value,t.minSize.message,e),t.maxSize&&un(r,"maxItems",t.maxSize.value,t.maxSize.message,e),r}function XPe(t,e){return t.rest?{type:"array",minItems:t.items.length,items:t.items.map((i,r)=>en(i._def,{...e,currentPath:[...e.currentPath,"items",`${r}`]})).reduce((i,r)=>r===void 0?i:[...i,r],[]),additionalItems:en(t.rest._def,{...e,currentPath:[...e.currentPath,"additionalItems"]})}:{type:"array",minItems:t.items.length,maxItems:t.items.length,items:t.items.map((i,r)=>en(i._def,{...e,currentPath:[...e.currentPath,"items",`${r}`]})).reduce((i,r)=>r===void 0?i:[...i,r],[])}}function $Pe(t){return{not:Lc(t)}}function YPe(t){return Lc(t)}const KPe=(t,e)=>en(t.innerType._def,e),ZPe=(t,e,i)=>{switch(e){case Ut.ZodString:return Bae(t,i);case Ut.ZodNumber:return FPe(t,i);case Ut.ZodObject:return zPe(t,i);case Ut.ZodBigInt:return wPe(t,i);case Ut.ZodBoolean:return _Pe();case Ut.ZodDate:return Uae(t,i);case Ut.ZodUndefined:return $Pe(i);case Ut.ZodNull:return NPe(i);case Ut.ZodArray:return bPe(t,i);case Ut.ZodUnion:case Ut.ZodDiscriminatedUnion:return UPe(t,i);case Ut.ZodIntersection:return PPe(t,i);case Ut.ZodTuple:return XPe(t,i);case Ut.ZodRecord:return Fae(t,i);case Ut.ZodLiteral:return RPe(t,i);case Ut.ZodEnum:return TPe(t);case Ut.ZodNativeEnum:return LPe(t);case Ut.ZodNullable:return BPe(t,i);case Ut.ZodOptional:return HPe(t,i);case Ut.ZodMap:return OPe(t,i);case Ut.ZodSet:return qPe(t,i);case Ut.ZodLazy:return()=>t.getter()._def;case Ut.ZodPromise:return WPe(t,i);case Ut.ZodNaN:case Ut.ZodNever:return kPe(i);case Ut.ZodEffects:return MPe(t,i);case Ut.ZodAny:return Lc(i);case Ut.ZodUnknown:return YPe(i);case Ut.ZodDefault:return APe(t,i);case Ut.ZodBranded:return Nae(t,i);case Ut.ZodReadonly:return KPe(t,i);case Ut.ZodCatch:return SPe(t,i);case Ut.ZodPipeline:return GPe(t,i);case Ut.ZodFunction:case Ut.ZodVoid:case Ut.ZodSymbol:return;default:return(r=>{})()}};function en(t,e,i=!1){const r=e.seen.get(t);if(e.override){const o=e.override?.(t,e,r,i);if(o!==gPe)return o}if(r&&!i){const o=QPe(r,e);if(o!==void 0)return o}const n={def:t,path:e.currentPath,jsonSchema:void 0};e.seen.set(t,n);const s=ZPe(t,t.typeName,e),a=typeof s=="function"?en(s(),e):s;if(a&&JPe(t,e,a),e.postProcess){const o=e.postProcess(a,t,e);return n.jsonSchema=a,o}return n.jsonSchema=a,a}const QPe=(t,e)=>{switch(e.$refStrategy){case"root":return{$ref:t.path.join("/")};case"relative":return{$ref:kae(e.currentPath,t.path)};case"none":case"seen":return t.path.length<e.currentPath.length&&t.path.every((i,r)=>e.currentPath[r]===i)?(console.warn(`Recursive reference detected at ${e.currentPath.join("/")}! Defaulting to any`),Lc(e)):e.$refStrategy==="seen"?Lc(e):void 0}},JPe=(t,e,i)=>(t.description&&(i.description=t.description,e.markdownDescription&&(i.markdownDescription=t.description)),i),eRe=(t,e)=>{const i=xPe(e);let r;const n=e?.name,s=en(t._def,i,!1)??Lc(i);i.flags.hasReferencedOpenAiAnyType&&(r||(r={}),r[i.openAiAnyTypeName]||(r[i.openAiAnyTypeName]={type:["string","number","integer","boolean","array","null"],items:{$ref:i.$refStrategy==="relative"?"1":[...i.basePath,i.definitionPath,i.openAiAnyTypeName].join("/")}}));const a=n===void 0?r?{...s,[i.definitionPath]:r}:s:{$ref:[...i.$refStrategy==="relative"?[]:i.basePath,i.definitionPath,n].join("/"),[i.definitionPath]:{...r,[n]:s}};return i.target==="jsonSchema7"?a.$schema="http://json-schema.org/draft-07/schema#":(i.target==="jsonSchema2019-09"||i.target==="openAi")&&(a.$schema="https://json-schema.org/draft/2019-09/schema#"),i.target==="openAi"&&("anyOf"in a||"oneOf"in a||"allOf"in a||"type"in a&&Array.isArray(a.type))&&console.warn("Warning: OpenAI may not support schemas with unions as roots! Try wrapping it in an object property."),a};function Nz(t,e){const i=typeof t;if(i!==typeof e)return!1;if(Array.isArray(t)){if(!Array.isArray(e))return!1;const r=t.length;if(r!==e.length)return!1;for(let n=0;n<r;n++)if(!Nz(t[n],e[n]))return!1;return!0}if(i==="object"){if(!t||!e)return t===e;const r=Object.keys(t),n=Object.keys(e);if(r.length!==n.length)return!1;for(const a of r)if(!Nz(t[a],e[a]))return!1;return!0}return t===e}function sf(t){if(typeof t!="object"||t===null)return!1;const e=t;if(!("_zod"in e))return!1;const i=e._zod;return typeof i=="object"&&i!==null&&"def"in i}function Jp(t){if(typeof t!="object"||t===null)return!1;const e=t;if(!("_def"in e)||"_zod"in e)return!1;const i=e._def;return typeof i=="object"&&i!=null&&"typeName"in i}function fT(t){return!t||typeof t!="object"||Array.isArray(t)?!1:!!(sf(t)||Jp(t))}async function tRe(t,e){if(sf(t))try{return{success:!0,data:await aPe(t,e)}}catch(i){return{success:!1,error:i}}if(Jp(t))return t.safeParse(e);throw new Error("Schema must be an instance of z3.ZodType or z4.$ZodType")}async function iRe(t,e){if(sf(t))return nPe(t,e);if(Jp(t))return t.parse(e);throw new Error("Schema must be an instance of z3.ZodType or z4.$ZodType")}function zae(t){if(sf(t))return Tg.get(t)?.description;if(Jp(t)||"description"in t&&typeof t.description=="string")return t.description}function rRe(t){return fT(t)?Jp(t)?t._def.typeName==="ZodString":sf(t)?t._zod.def.type==="string":!1:!1}function gA(t){return sf(t)?typeof t=="object"&&t!==null&&"_zod"in t&&typeof t._zod=="object"&&t._zod!==null&&"def"in t._zod&&typeof t._zod.def=="object"&&t._zod.def!==null&&"type"in t._zod.def&&t._zod.def.type==="object":!1}function jae(t){return sf(t)?typeof t=="object"&&t!==null&&"_zod"in t&&typeof t._zod=="object"&&t._zod!==null&&"def"in t._zod&&typeof t._zod.def=="object"&&t._zod.def!==null&&"type"in t._zod.def&&t._zod.def.type==="array":!1}function Uz(t,e=!1){if(Jp(t))return t.strict();if(gA(t)){const i=t._zod.def.shape;if(e)for(const[s,a]of Object.entries(t._zod.def.shape)){if(gA(a)){const l=Uz(a,e);i[s]=l}else if(jae(a)){let l=a._zod.def.element;gA(l)&&(l=Uz(l,e)),i[s]=BI(a,{...a._zod.def,element:l})}else i[s]=a;const o=Tg.get(a);o&&Tg.add(i[s],o)}const r=BI(t,{...t._zod.def,shape:i,catchall:mPe(fPe)}),n=Tg.get(t);return n&&Tg.add(r,n),r}throw new Error("Schema must be an instance of z3.ZodObject or z4.$ZodObject")}function nRe(t){return Jp(t)&&"typeName"in t._def&&t._def.typeName==="ZodEffects"}function sRe(t){return sf(t)&&t._zod.def.type==="pipe"}function UE(t,e=!1){if(Jp(t))return nRe(t)?UE(t._def.schema,e):t;if(sf(t)){let i=t;if(sRe(t)&&(i=UE(t._zod.def.in,e)),e){if(gA(i)){const n=i._zod.def.shape;for(const[s,a]of Object.entries(i._zod.def.shape))n[s]=UE(a,e);i=BI(i,{...i._zod.def,shape:n})}else if(jae(i)){const n=UE(i._zod.def.element,e);i=BI(i,{...i._zod.def,element:n})}}const r=Tg.get(t);return r&&Tg.add(i,r),i}throw new Error("Schema must be an instance of z3.ZodType or z4.$ZodType")}function O6(t){if(sf(t)){const e=UE(t,!0);if(gA(e)){const i=Uz(e,!0);return HX(i)}else return HX(t)}return Jp(t)?eRe(t):t}function aRe(t,e){if(t!==void 0&&!dA(t))return t;if(D6(e))try{let i=e.getName();return i=i.startsWith("Runnable")?i.slice(8):i,i}catch{return e.getName()}else return e.name??"UnknownSchema"}function oRe(t){return D6(t.data)?{type:"runnable",data:{id:t.data.lc_id,name:t.data.getName()}}:{type:"schema",data:{...O6(t.data.schema),title:t.data.name}}}class pO{constructor(e){Object.defineProperty(this,"nodes",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"edges",{enumerable:!0,configurable:!0,writable:!0,value:[]}),this.nodes=e?.nodes??this.nodes,this.edges=e?.edges??this.edges}toJSON(){const e={};return Object.values(this.nodes).forEach((i,r)=>{e[i.id]=dA(i.id)?r:i.id}),{nodes:Object.values(this.nodes).map(i=>({id:e[i.id],...oRe(i)})),edges:this.edges.map(i=>{const r={source:e[i.source],target:e[i.target]};return typeof i.data<"u"&&(r.data=i.data),typeof i.conditional<"u"&&(r.conditional=i.conditional),r})}}addNode(e,i,r){if(i!==void 0&&this.nodes[i]!==void 0)throw new Error(`Node with id ${i} already exists`);const n=i??dl(),s={id:n,data:e,name:aRe(i,e),metadata:r};return this.nodes[n]=s,s}removeNode(e){delete this.nodes[e.id],this.edges=this.edges.filter(i=>i.source!==e.id&&i.target!==e.id)}addEdge(e,i,r,n){if(this.nodes[e.id]===void 0)throw new Error(`Source node ${e.id} not in graph`);if(this.nodes[i.id]===void 0)throw new Error(`Target node ${i.id} not in graph`);const s={source:e.id,target:i.id,data:r,conditional:n};return this.edges.push(s),s}firstNode(){return qX(this)}lastNode(){return XX(this)}extend(e,i=""){let r=i;Object.values(e.nodes).map(c=>c.id).every(dA)&&(r="");const s=c=>r?`${r}:${c}`:c;Object.entries(e.nodes).forEach(([c,u])=>{this.nodes[s(c)]={...u,id:s(c)}});const a=e.edges.map(c=>({...c,source:s(c.source),target:s(c.target)}));this.edges=[...this.edges,...a];const o=e.firstNode(),l=e.lastNode();return[o?{id:s(o.id),data:o.data}:void 0,l?{id:s(l.id),data:l.data}:void 0]}trimFirstNode(){const e=this.firstNode();e&&qX(this,[e.id])&&this.removeNode(e)}trimLastNode(){const e=this.lastNode();e&&XX(this,[e.id])&&this.removeNode(e)}reid(){const e=Object.fromEntries(Object.values(this.nodes).map(n=>[n.id,n.name])),i=new Map;Object.values(e).forEach(n=>{i.set(n,(i.get(n)||0)+1)});const r=n=>{const s=e[n];return dA(n)&&i.get(s)===1?s:n};return new pO({nodes:Object.fromEntries(Object.entries(this.nodes).map(([n,s])=>[r(n),{...s,id:r(n)}])),edges:this.edges.map(n=>({...n,source:r(n.source),target:r(n.target)}))})}drawMermaid(e){const{withStyles:i,curveStyle:r,nodeColors:n={default:"fill:#f2f0ff,line-height:1.2",first:"fill-opacity:0",last:"fill:#bfb6fc"},wrapLabelNWords:s}=e??{},a=this.reid(),o=a.firstNode(),l=a.lastNode();return Y2e(a.nodes,a.edges,{firstNode:o?.id,lastNode:l?.id,withStyles:i,curveStyle:r,nodeColors:n,wrapLabelNWords:s})}async drawMermaidPng(e){const i=this.drawMermaid(e);return K2e(i,{backgroundColor:e?.backgroundColor})}}function qX(t,e=[]){const i=new Set(t.edges.filter(n=>!e.includes(n.source)).map(n=>n.target)),r=[];for(const n of Object.values(t.nodes))!e.includes(n.id)&&!i.has(n.id)&&r.push(n);return r.length===1?r[0]:void 0}function XX(t,e=[]){const i=new Set(t.edges.filter(n=>!e.includes(n.target)).map(n=>n.source)),r=[];for(const n of Object.values(t.nodes))!e.includes(n.id)&&!i.has(n.id)&&r.push(n);return r.length===1?r[0]:void 0}function lRe(t){const e=new TextEncoder,i=new ReadableStream({async start(r){for await(const n of t)r.enqueue(e.encode(`event: data
data: ${JSON.stringify(n)}

`));r.enqueue(e.encode(`event: end

`)),r.close()}});return Oc.fromReadableStream(i)}function $X(t){return typeof t=="object"&&t!==null&&typeof t[Symbol.iterator]=="function"&&typeof t.next=="function"}const cRe=t=>t!=null&&typeof t=="object"&&"next"in t&&typeof t.next=="function";function Bz(t){return typeof t=="object"&&t!==null&&typeof t[Symbol.asyncIterator]=="function"}function*YX(t,e){for(;;){const{value:i,done:r}=Zg.runWithConfig(C1(t),e.next.bind(e),!0);if(r)break;yield i}}async function*Fz(t,e){const i=e[Symbol.asyncIterator]();for(;;){const{value:r,done:n}=await Zg.runWithConfig(C1(t),i.next.bind(e),!0);if(n)break;yield r}}function za(t,e){return t&&!Array.isArray(t)&&!(t instanceof Date)&&typeof t=="object"?t:{[e]:t}}class $a extends S0{constructor(){super(...arguments),Object.defineProperty(this,"lc_runnable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0})}getName(e){const i=this.name??this.constructor.lc_name()??this.constructor.name;return e?`${i}${e}`:i}bind(e){return new u0({bound:this,kwargs:e,config:{}})}map(){return new zI({bound:this})}withRetry(e){return new Vae({bound:this,kwargs:{},config:{},maxAttemptNumber:e?.stopAfterAttempt,...e})}withConfig(e){return new u0({bound:this,config:e,kwargs:{}})}withFallbacks(e){const i=Array.isArray(e)?e:e.fallbacks;return new hRe({runnable:this,fallbacks:i})}_getOptionsList(e,i=0){if(Array.isArray(e)&&e.length!==i)throw new Error(`Passed "options" must be an array with the same length as the inputs, but got ${e.length} options for ${i} inputs`);if(Array.isArray(e))return e.map(Qr);if(i>1&&!Array.isArray(e)&&e.runId){console.warn("Provided runId will be used only for the first element of the batch.");const r=Object.fromEntries(Object.entries(e).filter(([n])=>n!=="runId"));return Array.from({length:i},(n,s)=>Qr(s===0?e:r))}return Array.from({length:i},()=>Qr(e))}async batch(e,i,r){const n=this._getOptionsList(i??{},e.length),s=n[0]?.maxConcurrency??r?.maxConcurrency,a=new I6({maxConcurrency:s,onFailedAttempt:l=>{throw l}}),o=e.map((l,c)=>a.call(async()=>{try{return await this.invoke(l,n[c])}catch(u){if(r?.returnExceptions)return u;throw u}}));return Promise.all(o)}async*_streamIterator(e,i){yield this.invoke(e,i)}async stream(e,i){const r=Qr(i),n=new d_({generator:this._streamIterator(e,r),config:r});return await n.setup,Oc.fromAsyncGenerator(n)}_separateRunnableConfigFromCallOptions(e){let i;e===void 0?i=Qr(e):i=Qr({callbacks:e.callbacks,tags:e.tags,metadata:e.metadata,runName:e.runName,configurable:e.configurable,recursionLimit:e.recursionLimit,maxConcurrency:e.maxConcurrency,runId:e.runId,timeout:e.timeout,signal:e.signal});const r={...e};return delete r.callbacks,delete r.tags,delete r.metadata,delete r.runName,delete r.configurable,delete r.recursionLimit,delete r.maxConcurrency,delete r.runId,delete r.timeout,delete r.signal,[i,r]}async _callWithConfig(e,i,r){const n=Qr(r),a=await(await Sh(n))?.handleChainStart(this.toJSON(),za(i,"input"),n.runId,n?.runType,void 0,void 0,n?.runName??this.getName());delete n.runId;let o;try{const l=e.call(this,i,n,a);o=await Qg(l,r?.signal)}catch(l){throw await a?.handleChainError(l),l}return await a?.handleChainEnd(za(o,"output")),o}async _batchWithConfig(e,i,r,n){const s=this._getOptionsList(r??{},i.length),a=await Promise.all(s.map(Sh)),o=await Promise.all(a.map(async(c,u)=>{const h=await c?.handleChainStart(this.toJSON(),za(i[u],"input"),s[u].runId,s[u].runType,void 0,void 0,s[u].runName??this.getName());return delete s[u].runId,h}));let l;try{const c=e.call(this,i,s,o,n);l=await Qg(c,s?.[0]?.signal)}catch(c){throw await Promise.all(o.map(u=>u?.handleChainError(c))),c}return await Promise.all(o.map(c=>c?.handleChainEnd(za(l,"output")))),l}_concatOutputChunks(e,i){return cO(e,i)}async*_transformStreamWithConfig(e,i,r){let n,s=!0,a,o=!0;const l=Qr(r),c=await Sh(l),u=this;async function*h(){for await(const f of e){if(s)if(n===void 0)n=f;else try{n=u._concatOutputChunks(n,f)}catch{n=void 0,s=!1}yield f}}let d;try{const f=await F2e(i.bind(this),h(),async()=>c?.handleChainStart(this.toJSON(),{input:""},l.runId,l.runType,void 0,void 0,l.runName??this.getName()),r?.signal,l);delete l.runId,d=f.setup;const p=d?.handlers.find(V2e);let g=f.output;p!==void 0&&d!==void 0&&(g=p.tapOutputIterable(d.runId,g));const m=d?.handlers.find(z2e);m!==void 0&&d!==void 0&&(g=m.tapOutputIterable(d.runId,g));for await(const y of g)if(yield y,o)if(a===void 0)a=y;else try{a=this._concatOutputChunks(a,y)}catch{a=void 0,o=!1}}catch(f){throw await d?.handleChainError(f,void 0,void 0,void 0,{inputs:za(n,"input")}),f}await d?.handleChainEnd(a??{},void 0,void 0,void 0,{inputs:za(n,"input")})}getGraph(e){const i=new pO,r=i.addNode({name:`${this.getName()}Input`,schema:hq()}),n=i.addNode(this),s=i.addNode({name:`${this.getName()}Output`,schema:hq()});return i.addEdge(r,n),i.addEdge(n,s),i}pipe(e){return new Sp({first:this,last:Ky(e)})}pick(e){return this.pipe(new dRe(e))}assign(e){return this.pipe(new Hae(new f_({steps:e})))}async*transform(e,i){let r;for await(const n of e)r===void 0?r=n:r=this._concatOutputChunks(r,n);yield*this._streamIterator(r,Qr(i))}async*streamLog(e,i,r){const n=new zX({...r,autoClose:!1,_schemaFormat:"original"}),s=Qr(i);yield*this._streamLog(e,n,s)}async*_streamLog(e,i,r){const{callbacks:n}=r;if(n===void 0)r.callbacks=[i];else if(Array.isArray(n))r.callbacks=n.concat([i]);else{const l=n.copy();l.addHandler(i,!0),r.callbacks=l}const s=this.stream(e,r);async function a(){try{const l=await s;for await(const c of l){const u=new hg({ops:[{op:"add",path:"/streamed_output/-",value:c}]});await i.writer.write(u)}}finally{await i.writer.close()}}const o=a();try{for await(const l of i)yield l}finally{await o}}streamEvents(e,i,r){let n;if(i.version==="v1")n=this._streamEventsV1(e,i,r);else if(i.version==="v2")n=this._streamEventsV2(e,i,r);else throw new Error('Only versions "v1" and "v2" of the schema are currently supported.');return i.encoding==="text/event-stream"?lRe(n):Oc.fromAsyncGenerator(n)}async*_streamEventsV2(e,i,r){const n=new H2e({...r,autoClose:!1}),s=Qr(i),a=s.runId??dl();s.runId=a;const o=s.callbacks;if(o===void 0)s.callbacks=[n];else if(Array.isArray(o))s.callbacks=o.concat(n);else{const p=o.copy();p.addHandler(n,!0),s.callbacks=p}const l=new AbortController,c=this;async function u(){let p,g=null;try{i?.signal?"any"in AbortSignal?p=AbortSignal.any([l.signal,i.signal]):(p=i.signal,g=()=>{l.abort()},i.signal.addEventListener("abort",g,{once:!0})):p=l.signal;const m=await c.stream(e,{...s,signal:p}),y=n.tapOutputIterable(a,m);for await(const b of y)if(l.signal.aborted)break}finally{await n.finish(),p&&g&&p.removeEventListener("abort",g)}}const h=u();let d=!1,f;try{for await(const p of n){if(!d){p.data.input=e,d=!0,f=p.run_id,yield p;continue}p.run_id===f&&p.event.endsWith("_end")&&p.data?.input&&delete p.data.input,yield p}}finally{l.abort(),await h}}async*_streamEventsV1(e,i,r){let n,s=!1;const a=Qr(i),o=a.tags??[],l=a.metadata??{},c=a.runName??this.getName(),u=new zX({...r,autoClose:!1,_schemaFormat:"streaming_events"}),h=new q2e({...r}),d=this._streamLog(e,u,a);for await(const p of d){if(n?n=n.concat(p):n=aM.fromRunLogPatch(p),n.state===void 0)throw new Error('Internal error: "streamEvents" state is missing. Please open a bug report.');if(!s){s=!0;const b={...n.state},w={run_id:b.id,event:`on_${b.type}_start`,name:c,tags:o,metadata:l,data:{input:e}};h.includeEvent(w,b.type)&&(yield w)}const g=p.ops.filter(b=>b.path.startsWith("/logs/")).map(b=>b.path.split("/")[2]),m=[...new Set(g)];for(const b of m){let w,E={};const M=n.state.logs[b];if(M.end_time===void 0?M.streamed_output.length>0?w="stream":w="start":w="end",w==="start")M.inputs!==void 0&&(E.input=M.inputs);else if(w==="end")M.inputs!==void 0&&(E.input=M.inputs),E.output=M.final_output;else if(w==="stream"){const A=M.streamed_output.length;if(A!==1)throw new Error(`Expected exactly one chunk of streamed output, got ${A} instead. Encountered in: "${M.name}"`);E={chunk:M.streamed_output[0]},M.streamed_output=[]}yield{event:`on_${M.type}_${w}`,name:M.name,run_id:M.id,tags:M.tags,metadata:M.metadata,data:E}}const{state:y}=n;if(y.streamed_output.length>0){const b=y.streamed_output.length;if(b!==1)throw new Error(`Expected exactly one chunk of streamed output, got ${b} instead. Encountered in: "${y.name}"`);const w={chunk:y.streamed_output[0]};y.streamed_output=[];const E={event:`on_${y.type}_stream`,run_id:y.id,tags:o,metadata:l,name:c,data:w};h.includeEvent(E,y.type)&&(yield E)}}const f=n?.state;if(f!==void 0){const p={event:`on_${f.type}_end`,name:c,run_id:f.id,tags:o,metadata:l,data:{output:f.final_output}};h.includeEvent(p,f.type)&&(yield p)}}static isRunnable(e){return D6(e)}withListeners({onStart:e,onEnd:i,onError:r}){return new u0({bound:this,config:{},configFactories:[n=>({callbacks:[new Rae({config:n,onStart:e,onEnd:i,onError:r})]})]})}asTool(e){return fRe(this,e)}}class u0 extends $a{static lc_name(){return"RunnableBinding"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"bound",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"config",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"configFactories",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.bound=e.bound,this.kwargs=e.kwargs,this.config=e.config,this.configFactories=e.configFactories}getName(e){return this.bound.getName(e)}async _mergeConfig(...e){const i=UX(this.config,...e);return UX(i,...this.configFactories?await Promise.all(this.configFactories.map(async r=>await r(i))):[])}bind(e){return new this.constructor({bound:this.bound,kwargs:{...this.kwargs,...e},config:this.config})}withConfig(e){return new this.constructor({bound:this.bound,kwargs:this.kwargs,config:{...this.config,...e}})}withRetry(e){return new Vae({bound:this.bound,kwargs:this.kwargs,config:this.config,maxAttemptNumber:e?.stopAfterAttempt,...e})}async invoke(e,i){return this.bound.invoke(e,await this._mergeConfig(Qr(i),this.kwargs))}async batch(e,i,r){const n=Array.isArray(i)?await Promise.all(i.map(async s=>this._mergeConfig(Qr(s),this.kwargs))):await this._mergeConfig(Qr(i),this.kwargs);return this.bound.batch(e,n,r)}_concatOutputChunks(e,i){return this.bound._concatOutputChunks(e,i)}async*_streamIterator(e,i){yield*this.bound._streamIterator(e,await this._mergeConfig(Qr(i),this.kwargs))}async stream(e,i){return this.bound.stream(e,await this._mergeConfig(Qr(i),this.kwargs))}async*transform(e,i){yield*this.bound.transform(e,await this._mergeConfig(Qr(i),this.kwargs))}streamEvents(e,i,r){const n=this,s=async function*(){yield*n.bound.streamEvents(e,{...await n._mergeConfig(Qr(i),n.kwargs),version:i.version},r)};return Oc.fromAsyncGenerator(s())}static isRunnableBinding(e){return e.bound&&$a.isRunnable(e.bound)}withListeners({onStart:e,onEnd:i,onError:r}){return new u0({bound:this.bound,kwargs:this.kwargs,config:this.config,configFactories:[n=>({callbacks:[new Rae({config:n,onStart:e,onEnd:i,onError:r})]})]})}}class zI extends $a{static lc_name(){return"RunnableEach"}constructor(e){super(e),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"bound",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.bound=e.bound}bind(e){return new zI({bound:this.bound.bind(e)})}async invoke(e,i){return this._callWithConfig(this._invoke.bind(this),e,i)}async _invoke(e,i,r){return this.bound.batch(e,Bo(i,{callbacks:r?.getChild()}))}withListeners({onStart:e,onEnd:i,onError:r}){return new zI({bound:this.bound.withListeners({onStart:e,onEnd:i,onError:r})})}}class Vae extends u0{static lc_name(){return"RunnableRetry"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"maxAttemptNumber",{enumerable:!0,configurable:!0,writable:!0,value:3}),Object.defineProperty(this,"onFailedAttempt",{enumerable:!0,configurable:!0,writable:!0,value:()=>{}}),this.maxAttemptNumber=e.maxAttemptNumber??this.maxAttemptNumber,this.onFailedAttempt=e.onFailedAttempt??this.onFailedAttempt}_patchConfigForRetry(e,i,r){const n=e>1?`retry:attempt:${e}`:void 0;return Bo(i,{callbacks:r?.getChild(n)})}async _invoke(e,i,r){return II(n=>super.invoke(e,this._patchConfigForRetry(n,i,r)),{onFailedAttempt:n=>this.onFailedAttempt(n,e),retries:Math.max(this.maxAttemptNumber-1,0),randomize:!0})}async invoke(e,i){return this._callWithConfig(this._invoke.bind(this),e,i)}async _batch(e,i,r,n){const s={};try{await II(async a=>{const o=e.map((d,f)=>f).filter(d=>s[d.toString()]===void 0||s[d.toString()]instanceof Error),l=o.map(d=>e[d]),c=o.map(d=>this._patchConfigForRetry(a,i?.[d],r?.[d])),u=await super.batch(l,c,{...n,returnExceptions:!0});let h;for(let d=0;d<u.length;d+=1){const f=u[d],p=o[d];f instanceof Error&&h===void 0&&(h=f,h.input=l[d]),s[p.toString()]=f}if(h)throw h;return u},{onFailedAttempt:a=>this.onFailedAttempt(a,a.input),retries:Math.max(this.maxAttemptNumber-1,0),randomize:!0})}catch(a){if(n?.returnExceptions!==!0)throw a}return Object.keys(s).sort((a,o)=>parseInt(a,10)-parseInt(o,10)).map(a=>s[parseInt(a,10)])}async batch(e,i,r){return this._batchWithConfig(this._batch.bind(this),e,i,r)}}class Sp extends $a{static lc_name(){return"RunnableSequence"}constructor(e){super(e),Object.defineProperty(this,"first",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"middle",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"last",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"omitSequenceTags",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),this.first=e.first,this.middle=e.middle??this.middle,this.last=e.last,this.name=e.name,this.omitSequenceTags=e.omitSequenceTags??this.omitSequenceTags}get steps(){return[this.first,...this.middle,this.last]}async invoke(e,i){const r=Qr(i),s=await(await Sh(r))?.handleChainStart(this.toJSON(),za(e,"input"),r.runId,void 0,void 0,void 0,r?.runName);delete r.runId;let a=e,o;try{const l=[this.first,...this.middle];for(let c=0;c<l.length;c+=1){const h=l[c].invoke(a,Bo(r,{callbacks:s?.getChild(this.omitSequenceTags?void 0:`seq:step:${c+1}`)}));a=await Qg(h,i?.signal)}if(i?.signal?.aborted)throw new Error("Aborted");o=await this.last.invoke(a,Bo(r,{callbacks:s?.getChild(this.omitSequenceTags?void 0:`seq:step:${this.steps.length}`)}))}catch(l){throw await s?.handleChainError(l),l}return await s?.handleChainEnd(za(o,"output")),o}async batch(e,i,r){const n=this._getOptionsList(i??{},e.length),s=await Promise.all(n.map(Sh)),a=await Promise.all(s.map(async(l,c)=>{const u=await l?.handleChainStart(this.toJSON(),za(e[c],"input"),n[c].runId,void 0,void 0,void 0,n[c].runName);return delete n[c].runId,u}));let o=e;try{for(let l=0;l<this.steps.length;l+=1){const u=this.steps[l].batch(o,a.map((h,d)=>{const f=h?.getChild(this.omitSequenceTags?void 0:`seq:step:${l+1}`);return Bo(n[d],{callbacks:f})}),r);o=await Qg(u,n[0]?.signal)}}catch(l){throw await Promise.all(a.map(c=>c?.handleChainError(l))),l}return await Promise.all(a.map(l=>l?.handleChainEnd(za(o,"output")))),o}_concatOutputChunks(e,i){return this.last._concatOutputChunks(e,i)}async*_streamIterator(e,i){const r=await Sh(i),{runId:n,...s}=i??{},a=await r?.handleChainStart(this.toJSON(),za(e,"input"),n,void 0,void 0,void 0,s?.runName),o=[this.first,...this.middle,this.last];let l=!0,c;async function*u(){yield e}try{let h=o[0].transform(u(),Bo(s,{callbacks:a?.getChild(this.omitSequenceTags?void 0:"seq:step:1")}));for(let d=1;d<o.length;d+=1)h=await o[d].transform(h,Bo(s,{callbacks:a?.getChild(this.omitSequenceTags?void 0:`seq:step:${d+1}`)}));for await(const d of h)if(i?.signal?.throwIfAborted(),yield d,l)if(c===void 0)c=d;else try{c=this._concatOutputChunks(c,d)}catch{c=void 0,l=!1}}catch(h){throw await a?.handleChainError(h),h}await a?.handleChainEnd(za(c,"output"))}getGraph(e){const i=new pO;let r=null;return this.steps.forEach((n,s)=>{const a=n.getGraph(e);s!==0&&a.trimFirstNode(),s!==this.steps.length-1&&a.trimLastNode(),i.extend(a);const o=a.firstNode();if(!o)throw new Error(`Runnable ${n} has no first node`);r&&i.addEdge(r,o),r=a.lastNode()}),i}pipe(e){return Sp.isRunnableSequence(e)?new Sp({first:this.first,middle:this.middle.concat([this.last,e.first,...e.middle]),last:e.last,name:this.name??e.name}):new Sp({first:this.first,middle:[...this.middle,this.last],last:Ky(e),name:this.name})}static isRunnableSequence(e){return Array.isArray(e.middle)&&$a.isRunnable(e)}static from([e,...i],r){let n={};return typeof r=="string"?n.name=r:r!==void 0&&(n=r),new Sp({...n,first:Ky(e),middle:i.slice(0,-1).map(Ky),last:Ky(i[i.length-1])})}}class f_ extends $a{static lc_name(){return"RunnableMap"}getStepsKeys(){return Object.keys(this.steps)}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"steps",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.steps={};for(const[i,r]of Object.entries(e.steps))this.steps[i]=Ky(r)}static from(e){return new f_({steps:e})}async invoke(e,i){const r=Qr(i),s=await(await Sh(r))?.handleChainStart(this.toJSON(),{input:e},r.runId,void 0,void 0,void 0,r?.runName);delete r.runId;const a={};try{const o=Object.entries(this.steps).map(async([l,c])=>{a[l]=await c.invoke(e,Bo(r,{callbacks:s?.getChild(`map:key:${l}`)}))});await Qg(Promise.all(o),i?.signal)}catch(o){throw await s?.handleChainError(o),o}return await s?.handleChainEnd(a),a}async*_transform(e,i,r){const n={...this.steps},s=Pae(e,Object.keys(n).length),a=new Map(Object.entries(n).map(([o,l],c)=>{const u=l.transform(s[c],Bo(r,{callbacks:i?.getChild(`map:key:${o}`)}));return[o,u.next().then(h=>({key:o,gen:u,result:h}))]}));for(;a.size;){const o=Promise.race(a.values()),{key:l,result:c,gen:u}=await Qg(o,r?.signal);a.delete(l),c.done||(yield{[l]:c.value},a.set(l,u.next().then(h=>({key:l,gen:u,result:h}))))}}transform(e,i){return this._transformStreamWithConfig(e,this._transform.bind(this),i)}async stream(e,i){async function*r(){yield e}const n=Qr(i),s=new d_({generator:this.transform(r(),n),config:n});return await s.setup,Oc.fromAsyncGenerator(s)}}class L6 extends $a{constructor(e){if(super(e),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"func",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),!S6(e.func))throw new Error("RunnableTraceable requires a function that is wrapped in traceable higher-order function");this.func=e.func}async invoke(e,i){const[r]=this._getOptionsList(i??{},1),n=await Sh(r),s=this.func(Bo(r,{callbacks:n}),e);return Qg(s,r?.signal)}async*_streamIterator(e,i){const[r]=this._getOptionsList(i??{},1),n=await this.invoke(e,i);if(Bz(n)){for await(const s of n)r?.signal?.throwIfAborted(),yield s;return}if(cRe(n)){for(;;){r?.signal?.throwIfAborted();const s=n.next();if(s.done)break;yield s.value}return}yield n}static from(e){return new L6({func:e})}}function uRe(t){if(S6(t))throw new Error("RunnableLambda requires a function that is not wrapped in traceable higher-order function. This shouldn't happen.")}class pT extends $a{static lc_name(){return"RunnableLambda"}constructor(e){if(S6(e.func))return L6.from(e.func);super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"func",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),uRe(e.func),this.func=e.func}static from(e){return new pT({func:e})}async _invoke(e,i,r){return new Promise((n,s)=>{const a=Bo(i,{callbacks:r?.getChild(),recursionLimit:(i?.recursionLimit??tU)-1});Zg.runWithConfig(C1(a),async()=>{try{let o=await this.func(e,{...a});if(o&&$a.isRunnable(o)){if(i?.recursionLimit===0)throw new Error("Recursion limit reached.");o=await o.invoke(e,{...a,recursionLimit:(a.recursionLimit??tU)-1})}else if(Bz(o)){let l;for await(const c of Fz(a,o))if(i?.signal?.throwIfAborted(),l===void 0)l=c;else try{l=this._concatOutputChunks(l,c)}catch{l=c}o=l}else if($X(o)){let l;for(const c of YX(a,o))if(i?.signal?.throwIfAborted(),l===void 0)l=c;else try{l=this._concatOutputChunks(l,c)}catch{l=c}o=l}n(o)}catch(o){s(o)}})})}async invoke(e,i){return this._callWithConfig(this._invoke.bind(this),e,i)}async*_transform(e,i,r){let n;for await(const o of e)if(n===void 0)n=o;else try{n=this._concatOutputChunks(n,o)}catch{n=o}const s=Bo(r,{callbacks:i?.getChild(),recursionLimit:(r?.recursionLimit??tU)-1}),a=await new Promise((o,l)=>{Zg.runWithConfig(C1(s),async()=>{try{const c=await this.func(n,{...s,config:s});o(c)}catch(c){l(c)}})});if(a&&$a.isRunnable(a)){if(r?.recursionLimit===0)throw new Error("Recursion limit reached.");const o=await a.stream(n,s);for await(const l of o)yield l}else if(Bz(a))for await(const o of Fz(s,a))r?.signal?.throwIfAborted(),yield o;else if($X(a))for(const o of YX(s,a))r?.signal?.throwIfAborted(),yield o;else yield a}transform(e,i){return this._transformStreamWithConfig(e,this._transform.bind(this),i)}async stream(e,i){async function*r(){yield e}const n=Qr(i),s=new d_({generator:this.transform(r(),n),config:n});return await s.setup,Oc.fromAsyncGenerator(s)}}class hRe extends $a{static lc_name(){return"RunnableWithFallbacks"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"runnable",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"fallbacks",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.runnable=e.runnable,this.fallbacks=e.fallbacks}*runnables(){yield this.runnable;for(const e of this.fallbacks)yield e}async invoke(e,i){const r=Qr(i),n=await Sh(r),{runId:s,...a}=r,o=await n?.handleChainStart(this.toJSON(),za(e,"input"),s,void 0,void 0,void 0,a?.runName),l=Bo(a,{callbacks:o?.getChild()});return await Zg.runWithConfig(l,async()=>{let u;for(const h of this.runnables()){r?.signal?.throwIfAborted();try{const d=await h.invoke(e,l);return await o?.handleChainEnd(za(d,"output")),d}catch(d){u===void 0&&(u=d)}}throw u===void 0?new Error("No error stored at end of fallback."):(await o?.handleChainError(u),u)})}async*_streamIterator(e,i){const r=Qr(i),n=await Sh(r),{runId:s,...a}=r,o=await n?.handleChainStart(this.toJSON(),za(e,"input"),s,void 0,void 0,void 0,a?.runName);let l,c;for(const h of this.runnables()){r?.signal?.throwIfAborted();const d=Bo(a,{callbacks:o?.getChild()});try{const f=await h.stream(e,d);c=Fz(d,f);break}catch(f){l===void 0&&(l=f)}}if(c===void 0){const h=l??new Error("No error stored at end of fallback.");throw await o?.handleChainError(h),h}let u;try{for await(const h of c){yield h;try{u=u===void 0?u:this._concatOutputChunks(u,h)}catch{u=void 0}}}catch(h){throw await o?.handleChainError(h),h}await o?.handleChainEnd(za(u,"output"))}async batch(e,i,r){if(r?.returnExceptions)throw new Error("Not implemented.");const n=this._getOptionsList(i??{},e.length),s=await Promise.all(n.map(l=>Sh(l))),a=await Promise.all(s.map(async(l,c)=>{const u=await l?.handleChainStart(this.toJSON(),za(e[c],"input"),n[c].runId,void 0,void 0,void 0,n[c].runName);return delete n[c].runId,u}));let o;for(const l of this.runnables()){n[0].signal?.throwIfAborted();try{const c=await l.batch(e,a.map((u,h)=>Bo(n[h],{callbacks:u?.getChild()})),r);return await Promise.all(a.map((u,h)=>u?.handleChainEnd(za(c[h],"output")))),c}catch(c){o===void 0&&(o=c)}}throw o?(await Promise.all(a.map(l=>l?.handleChainError(o))),o):new Error("No error stored at end of fallbacks.")}}function Ky(t){if(typeof t=="function")return new pT({func:t});if($a.isRunnable(t))return t;if(!Array.isArray(t)&&typeof t=="object"){const e={};for(const[i,r]of Object.entries(t))e[i]=Ky(r);return new f_({steps:e})}else throw new Error(`Expected a Runnable, function or object.
Instead got an unsupported type.`)}class Hae extends $a{static lc_name(){return"RunnableAssign"}constructor(e){e instanceof f_&&(e={mapper:e}),super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"mapper",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.mapper=e.mapper}async invoke(e,i){const r=await this.mapper.invoke(e,i);return{...e,...r}}async*_transform(e,i,r){const n=this.mapper.getStepsKeys(),[s,a]=Pae(e),o=this.mapper.transform(a,Bo(r,{callbacks:i?.getChild()})),l=o.next();for await(const c of s){if(typeof c!="object"||Array.isArray(c))throw new Error(`RunnableAssign can only be used with objects as input, got ${typeof c}`);const u=Object.fromEntries(Object.entries(c).filter(([h])=>!n.includes(h)));Object.keys(u).length>0&&(yield u)}yield(await l).value;for await(const c of o)yield c}transform(e,i){return this._transformStreamWithConfig(e,this._transform.bind(this),i)}async stream(e,i){async function*r(){yield e}const n=Qr(i),s=new d_({generator:this.transform(r(),n),config:n});return await s.setup,Oc.fromAsyncGenerator(s)}}class dRe extends $a{static lc_name(){return"RunnablePick"}constructor(e){(typeof e=="string"||Array.isArray(e))&&(e={keys:e}),super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"keys",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.keys=e.keys}async _pick(e){if(typeof this.keys=="string")return e[this.keys];{const i=this.keys.map(r=>[r,e[r]]).filter(r=>r[1]!==void 0);return i.length===0?void 0:Object.fromEntries(i)}}async invoke(e,i){return this._callWithConfig(this._pick.bind(this),e,i)}async*_transform(e){for await(const i of e){const r=await this._pick(i);r!==void 0&&(yield r)}}transform(e,i){return this._transformStreamWithConfig(e,this._transform.bind(this),i)}async stream(e,i){async function*r(){yield e}const n=Qr(i),s=new d_({generator:this.transform(r(),n),config:n});return await s.setup,Oc.fromAsyncGenerator(s)}}class KX extends u0{constructor(e){const i=Sp.from([pT.from(async r=>{let n;if(iae(r))try{n=await iRe(this.schema,r.args)}catch{throw new dMe("Received tool input did not match expected schema",JSON.stringify(r.args))}else n=r;return n}).withConfig({runName:`${e.name}:parse_input`}),e.bound]).withConfig({runName:e.name});super({bound:i,config:e.config??{}}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"description",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"schema",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.name=e.name,this.description=e.description,this.schema=e.schema}static lc_name(){return"RunnableToolLike"}}function fRe(t,e){const i=e.name??t.getName(),r=e.description??zae(e.schema);return rRe(e.schema)?new KX({name:i,description:r,schema:GMe({input:HMe()}).transform(n=>n.input),bound:t}):new KX({name:i,description:r,schema:e.schema,bound:t})}/*
 * [js-sha1]{@link https://github.com/emn178/js-sha1}
 *
 * @version 0.6.0
 * @author Chen, Yi-Cyuan [emn178@gmail.com]
 * @copyright Chen, Yi-Cyuan 2014-2017
 * @license MIT
 */var pRe=typeof window=="object"?window:{},gr="0123456789abcdef".split(""),mRe=[-2147483648,8388608,32768,128],Zu=[24,16,8,0],Da=[];function Th(t){t?(Da[0]=Da[16]=Da[1]=Da[2]=Da[3]=Da[4]=Da[5]=Da[6]=Da[7]=Da[8]=Da[9]=Da[10]=Da[11]=Da[12]=Da[13]=Da[14]=Da[15]=0,this.blocks=Da):this.blocks=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],this.h0=1732584193,this.h1=4023233417,this.h2=2562383102,this.h3=271733878,this.h4=3285377520,this.block=this.start=this.bytes=this.hBytes=0,this.finalized=this.hashed=!1,this.first=!0}Th.prototype.update=function(t){if(!this.finalized){var e=typeof t!="string";e&&t.constructor===pRe.ArrayBuffer&&(t=new Uint8Array(t));for(var i,r=0,n,s=t.length||0,a=this.blocks;r<s;){if(this.hashed&&(this.hashed=!1,a[0]=this.block,a[16]=a[1]=a[2]=a[3]=a[4]=a[5]=a[6]=a[7]=a[8]=a[9]=a[10]=a[11]=a[12]=a[13]=a[14]=a[15]=0),e)for(n=this.start;r<s&&n<64;++r)a[n>>2]|=t[r]<<Zu[n++&3];else for(n=this.start;r<s&&n<64;++r)i=t.charCodeAt(r),i<128?a[n>>2]|=i<<Zu[n++&3]:i<2048?(a[n>>2]|=(192|i>>6)<<Zu[n++&3],a[n>>2]|=(128|i&63)<<Zu[n++&3]):i<55296||i>=57344?(a[n>>2]|=(224|i>>12)<<Zu[n++&3],a[n>>2]|=(128|i>>6&63)<<Zu[n++&3],a[n>>2]|=(128|i&63)<<Zu[n++&3]):(i=65536+((i&1023)<<10|t.charCodeAt(++r)&1023),a[n>>2]|=(240|i>>18)<<Zu[n++&3],a[n>>2]|=(128|i>>12&63)<<Zu[n++&3],a[n>>2]|=(128|i>>6&63)<<Zu[n++&3],a[n>>2]|=(128|i&63)<<Zu[n++&3]);this.lastByteIndex=n,this.bytes+=n-this.start,n>=64?(this.block=a[16],this.start=n-64,this.hash(),this.hashed=!0):this.start=n}return this.bytes>4294967295&&(this.hBytes+=this.bytes/4294967296<<0,this.bytes=this.bytes%4294967296),this}};Th.prototype.finalize=function(){if(!this.finalized){this.finalized=!0;var t=this.blocks,e=this.lastByteIndex;t[16]=this.block,t[e>>2]|=mRe[e&3],this.block=t[16],e>=56&&(this.hashed||this.hash(),t[0]=this.block,t[16]=t[1]=t[2]=t[3]=t[4]=t[5]=t[6]=t[7]=t[8]=t[9]=t[10]=t[11]=t[12]=t[13]=t[14]=t[15]=0),t[14]=this.hBytes<<3|this.bytes>>>29,t[15]=this.bytes<<3,this.hash()}};Th.prototype.hash=function(){var t=this.h0,e=this.h1,i=this.h2,r=this.h3,n=this.h4,s,a,o,l=this.blocks;for(a=16;a<80;++a)o=l[a-3]^l[a-8]^l[a-14]^l[a-16],l[a]=o<<1|o>>>31;for(a=0;a<20;a+=5)s=e&i|~e&r,o=t<<5|t>>>27,n=o+s+n+1518500249+l[a]<<0,e=e<<30|e>>>2,s=t&e|~t&i,o=n<<5|n>>>27,r=o+s+r+1518500249+l[a+1]<<0,t=t<<30|t>>>2,s=n&t|~n&e,o=r<<5|r>>>27,i=o+s+i+1518500249+l[a+2]<<0,n=n<<30|n>>>2,s=r&n|~r&t,o=i<<5|i>>>27,e=o+s+e+1518500249+l[a+3]<<0,r=r<<30|r>>>2,s=i&r|~i&n,o=e<<5|e>>>27,t=o+s+t+1518500249+l[a+4]<<0,i=i<<30|i>>>2;for(;a<40;a+=5)s=e^i^r,o=t<<5|t>>>27,n=o+s+n+1859775393+l[a]<<0,e=e<<30|e>>>2,s=t^e^i,o=n<<5|n>>>27,r=o+s+r+1859775393+l[a+1]<<0,t=t<<30|t>>>2,s=n^t^e,o=r<<5|r>>>27,i=o+s+i+1859775393+l[a+2]<<0,n=n<<30|n>>>2,s=r^n^t,o=i<<5|i>>>27,e=o+s+e+1859775393+l[a+3]<<0,r=r<<30|r>>>2,s=i^r^n,o=e<<5|e>>>27,t=o+s+t+1859775393+l[a+4]<<0,i=i<<30|i>>>2;for(;a<60;a+=5)s=e&i|e&r|i&r,o=t<<5|t>>>27,n=o+s+n-1894007588+l[a]<<0,e=e<<30|e>>>2,s=t&e|t&i|e&i,o=n<<5|n>>>27,r=o+s+r-1894007588+l[a+1]<<0,t=t<<30|t>>>2,s=n&t|n&e|t&e,o=r<<5|r>>>27,i=o+s+i-1894007588+l[a+2]<<0,n=n<<30|n>>>2,s=r&n|r&t|n&t,o=i<<5|i>>>27,e=o+s+e-1894007588+l[a+3]<<0,r=r<<30|r>>>2,s=i&r|i&n|r&n,o=e<<5|e>>>27,t=o+s+t-1894007588+l[a+4]<<0,i=i<<30|i>>>2;for(;a<80;a+=5)s=e^i^r,o=t<<5|t>>>27,n=o+s+n-899497514+l[a]<<0,e=e<<30|e>>>2,s=t^e^i,o=n<<5|n>>>27,r=o+s+r-899497514+l[a+1]<<0,t=t<<30|t>>>2,s=n^t^e,o=r<<5|r>>>27,i=o+s+i-899497514+l[a+2]<<0,n=n<<30|n>>>2,s=r^n^t,o=i<<5|i>>>27,e=o+s+e-899497514+l[a+3]<<0,r=r<<30|r>>>2,s=i^r^n,o=e<<5|e>>>27,t=o+s+t-899497514+l[a+4]<<0,i=i<<30|i>>>2;this.h0=this.h0+t<<0,this.h1=this.h1+e<<0,this.h2=this.h2+i<<0,this.h3=this.h3+r<<0,this.h4=this.h4+n<<0};Th.prototype.hex=function(){this.finalize();var t=this.h0,e=this.h1,i=this.h2,r=this.h3,n=this.h4;return gr[t>>28&15]+gr[t>>24&15]+gr[t>>20&15]+gr[t>>16&15]+gr[t>>12&15]+gr[t>>8&15]+gr[t>>4&15]+gr[t&15]+gr[e>>28&15]+gr[e>>24&15]+gr[e>>20&15]+gr[e>>16&15]+gr[e>>12&15]+gr[e>>8&15]+gr[e>>4&15]+gr[e&15]+gr[i>>28&15]+gr[i>>24&15]+gr[i>>20&15]+gr[i>>16&15]+gr[i>>12&15]+gr[i>>8&15]+gr[i>>4&15]+gr[i&15]+gr[r>>28&15]+gr[r>>24&15]+gr[r>>20&15]+gr[r>>16&15]+gr[r>>12&15]+gr[r>>8&15]+gr[r>>4&15]+gr[r&15]+gr[n>>28&15]+gr[n>>24&15]+gr[n>>20&15]+gr[n>>16&15]+gr[n>>12&15]+gr[n>>8&15]+gr[n>>4&15]+gr[n&15]};Th.prototype.toString=Th.prototype.hex;Th.prototype.digest=function(){this.finalize();var t=this.h0,e=this.h1,i=this.h2,r=this.h3,n=this.h4;return[t>>24&255,t>>16&255,t>>8&255,t&255,e>>24&255,e>>16&255,e>>8&255,e&255,i>>24&255,i>>16&255,i>>8&255,i&255,r>>24&255,r>>16&255,r>>8&255,r&255,n>>24&255,n>>16&255,n>>8&255,n&255]};Th.prototype.array=Th.prototype.digest;Th.prototype.arrayBuffer=function(){this.finalize();var t=new ArrayBuffer(20),e=new DataView(t);return e.setUint32(0,this.h0),e.setUint32(4,this.h1),e.setUint32(8,this.h2),e.setUint32(12,this.h3),e.setUint32(16,this.h4),t};let ZX=!1;const gRe=t=>(ZX||(console.warn(["The default method for hashing keys is insecure and will be replaced in a future version,","but hasn't been replaced yet as to not break existing caches. It's recommended that you use","a more secure hashing algorithm to avoid cache poisoning.","","See this page for more information:","|","> https://js.langchain.com/docs/troubleshooting/warnings/insecure-cache-algorithm"].join(`
`)),ZX=!0),new Th(!0).update(t).hex()),vRe=(...t)=>gRe(t.join("_"));class yRe{constructor(){Object.defineProperty(this,"keyEncoder",{enumerable:!0,configurable:!0,writable:!0,value:vRe})}makeDefaultKeyEncoder(e){this.keyEncoder=e}}const xRe=new Map;class k6 extends yRe{constructor(e){super(),Object.defineProperty(this,"cache",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.cache=e??new Map}lookup(e,i){return Promise.resolve(this.cache.get(this.keyEncoder(e,i))??null)}async update(e,i,r){this.cache.set(this.keyEncoder(e,i),r)}static global(){return new k6(xRe)}}class Gae extends S0{}class bRe extends Gae{static lc_name(){return"StringPromptValue"}constructor(e){super({value:e}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","prompt_values"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"value",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.value=e}toString(){return this.value}toChatMessages(){return[new iO(this.value)]}}class wRe extends Gae{static lc_name(){return"ChatPromptValue"}constructor(e){Array.isArray(e)&&(e={messages:e}),super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","prompt_values"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"messages",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.messages=e.messages}toString(){return rae(this.messages)}toChatMessages(){return this.messages}}var VS={},QX;function _Re(){if(QX)return VS;QX=1,VS.byteLength=o,VS.toByteArray=c,VS.fromByteArray=d;for(var t=[],e=[],i=typeof Uint8Array<"u"?Uint8Array:Array,r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",n=0,s=r.length;n<s;++n)t[n]=r[n],e[r.charCodeAt(n)]=n;e[45]=62,e[95]=63;function a(f){var p=f.length;if(p%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var g=f.indexOf("=");g===-1&&(g=p);var m=g===p?0:4-g%4;return[g,m]}function o(f){var p=a(f),g=p[0],m=p[1];return(g+m)*3/4-m}function l(f,p,g){return(p+g)*3/4-g}function c(f){var p,g=a(f),m=g[0],y=g[1],b=new i(l(f,m,y)),w=0,E=y>0?m-4:m,M;for(M=0;M<E;M+=4)p=e[f.charCodeAt(M)]<<18|e[f.charCodeAt(M+1)]<<12|e[f.charCodeAt(M+2)]<<6|e[f.charCodeAt(M+3)],b[w++]=p>>16&255,b[w++]=p>>8&255,b[w++]=p&255;return y===2&&(p=e[f.charCodeAt(M)]<<2|e[f.charCodeAt(M+1)]>>4,b[w++]=p&255),y===1&&(p=e[f.charCodeAt(M)]<<10|e[f.charCodeAt(M+1)]<<4|e[f.charCodeAt(M+2)]>>2,b[w++]=p>>8&255,b[w++]=p&255),b}function u(f){return t[f>>18&63]+t[f>>12&63]+t[f>>6&63]+t[f&63]}function h(f,p,g){for(var m,y=[],b=p;b<g;b+=3)m=(f[b]<<16&16711680)+(f[b+1]<<8&65280)+(f[b+2]&255),y.push(u(m));return y.join("")}function d(f){for(var p,g=f.length,m=g%3,y=[],b=16383,w=0,E=g-m;w<E;w+=b)y.push(h(f,w,w+b>E?E:w+b));return m===1?(p=f[g-1],y.push(t[p>>2]+t[p<<4&63]+"==")):m===2&&(p=(f[g-2]<<8)+f[g-1],y.push(t[p>>10]+t[p>>4&63]+t[p<<2&63]+"=")),y.join("")}return VS}var SRe=_Re();const ERe=Lh(SRe);var ARe=Object.defineProperty,MRe=(t,e,i)=>e in t?ARe(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i,TRe=(t,e,i)=>(MRe(t,e+"",i),i);function CRe(t,e){let i=Array.from({length:t.length},(r,n)=>({start:n,end:n+1}));for(;i.length>1;){let r=null;for(let n=0;n<i.length-1;n++){const s=t.slice(i[n].start,i[n+1].end),a=e.get(s.join(","));a!=null&&(r==null||a<r[0])&&(r=[a,n])}if(r!=null){const n=r[1];i[n]={start:i[n].start,end:i[n+1].end},i.splice(n+1,1)}else break}return i}function PRe(t,e){return t.length===1?[e.get(t.join(","))]:CRe(t,e).map(i=>e.get(t.slice(i.start,i.end).join(","))).filter(i=>i!=null)}function RRe(t){return t.replace(/[\\^$*+?.()|[\]{}]/g,"\\$&")}var zz=class{specialTokens;inverseSpecialTokens;patStr;textEncoder=new TextEncoder;textDecoder=new TextDecoder("utf-8");rankMap=new Map;textMap=new Map;constructor(t,e){this.patStr=t.pat_str;const i=t.bpe_ranks.split(`
`).filter(Boolean).reduce((r,n)=>{const[s,a,...o]=n.split(" "),l=Number.parseInt(a,10);return o.forEach((c,u)=>r[c]=l+u),r},{});for(const[r,n]of Object.entries(i)){const s=ERe.toByteArray(r);this.rankMap.set(s.join(","),n),this.textMap.set(n,s)}this.specialTokens={...t.special_tokens,...e},this.inverseSpecialTokens=Object.entries(this.specialTokens).reduce((r,[n,s])=>(r[s]=this.textEncoder.encode(n),r),{})}encode(t,e=[],i="all"){const r=new RegExp(this.patStr,"ug"),n=zz.specialTokenRegex(Object.keys(this.specialTokens)),s=[],a=new Set(e==="all"?Object.keys(this.specialTokens):e),o=new Set(i==="all"?Object.keys(this.specialTokens).filter(c=>!a.has(c)):i);if(o.size>0){const c=zz.specialTokenRegex([...o]),u=t.match(c);if(u!=null)throw new Error(`The text contains a special token that is not allowed: ${u[0]}`)}let l=0;for(;;){let c=null,u=l;for(;n.lastIndex=u,c=n.exec(t),!(c==null||a.has(c[0]));)u=c.index+1;const h=c?.index??t.length;for(const f of t.substring(l,h).matchAll(r)){const p=this.textEncoder.encode(f[0]),g=this.rankMap.get(p.join(","));if(g!=null){s.push(g);continue}s.push(...PRe(p,this.rankMap))}if(c==null)break;let d=this.specialTokens[c[0]];s.push(d),l=c.index+c[0].length}return s}decode(t){const e=[];let i=0;for(let s=0;s<t.length;++s){const a=t[s],o=this.textMap.get(a)??this.inverseSpecialTokens[a];o!=null&&(e.push(o),i+=o.length)}const r=new Uint8Array(i);let n=0;for(const s of e)r.set(s,n),n+=s.length;return this.textDecoder.decode(r)}},Wae=zz;TRe(Wae,"specialTokenRegex",t=>new RegExp(t.map(e=>RRe(e)).join("|"),"g"));function IRe(t){switch(t){case"gpt2":return"gpt2";case"code-cushman-001":case"code-cushman-002":case"code-davinci-001":case"code-davinci-002":case"cushman-codex":case"davinci-codex":case"davinci-002":case"text-davinci-002":case"text-davinci-003":return"p50k_base";case"code-davinci-edit-001":case"text-davinci-edit-001":return"p50k_edit";case"ada":case"babbage":case"babbage-002":case"code-search-ada-code-001":case"code-search-babbage-code-001":case"curie":case"davinci":case"text-ada-001":case"text-babbage-001":case"text-curie-001":case"text-davinci-001":case"text-search-ada-doc-001":case"text-search-babbage-doc-001":case"text-search-curie-doc-001":case"text-search-davinci-doc-001":case"text-similarity-ada-001":case"text-similarity-babbage-001":case"text-similarity-curie-001":case"text-similarity-davinci-001":return"r50k_base";case"gpt-3.5-turbo-instruct-0914":case"gpt-3.5-turbo-instruct":case"gpt-3.5-turbo-16k-0613":case"gpt-3.5-turbo-16k":case"gpt-3.5-turbo-0613":case"gpt-3.5-turbo-0301":case"gpt-3.5-turbo":case"gpt-4-32k-0613":case"gpt-4-32k-0314":case"gpt-4-32k":case"gpt-4-0613":case"gpt-4-0314":case"gpt-4":case"gpt-3.5-turbo-1106":case"gpt-35-turbo":case"gpt-4-1106-preview":case"gpt-4-vision-preview":case"gpt-3.5-turbo-0125":case"gpt-4-turbo":case"gpt-4-turbo-2024-04-09":case"gpt-4-turbo-preview":case"gpt-4-0125-preview":case"text-embedding-ada-002":case"text-embedding-3-small":case"text-embedding-3-large":return"cl100k_base";case"gpt-4o":case"gpt-4o-2024-05-13":case"gpt-4o-2024-08-06":case"gpt-4o-2024-11-20":case"gpt-4o-mini-2024-07-18":case"gpt-4o-mini":case"gpt-4o-search-preview":case"gpt-4o-search-preview-2025-03-11":case"gpt-4o-mini-search-preview":case"gpt-4o-mini-search-preview-2025-03-11":case"gpt-4o-audio-preview":case"gpt-4o-audio-preview-2024-12-17":case"gpt-4o-audio-preview-2024-10-01":case"gpt-4o-mini-audio-preview":case"gpt-4o-mini-audio-preview-2024-12-17":case"o1":case"o1-2024-12-17":case"o1-mini":case"o1-mini-2024-09-12":case"o1-preview":case"o1-preview-2024-09-12":case"o1-pro":case"o1-pro-2025-03-19":case"o3":case"o3-2025-04-16":case"o3-mini":case"o3-mini-2025-01-31":case"o4-mini":case"o4-mini-2025-04-16":case"chatgpt-4o-latest":case"gpt-4o-realtime":case"gpt-4o-realtime-preview-2024-10-01":case"gpt-4o-realtime-preview-2024-12-17":case"gpt-4o-mini-realtime-preview":case"gpt-4o-mini-realtime-preview-2024-12-17":case"gpt-4.1":case"gpt-4.1-2025-04-14":case"gpt-4.1-mini":case"gpt-4.1-mini-2025-04-14":case"gpt-4.1-nano":case"gpt-4.1-nano-2025-04-14":case"gpt-4.5-preview":case"gpt-4.5-preview-2025-02-27":case"gpt-5":case"gpt-5-2025-08-07":case"gpt-5-nano":case"gpt-5-nano-2025-08-07":case"gpt-5-mini":case"gpt-5-mini-2025-08-07":case"gpt-5-chat-latest":return"o200k_base";default:throw new Error("Unknown model")}}const h2={},DRe=new I6({});async function ORe(t){return t in h2||(h2[t]=DRe.fetch(`https://tiktoken.pages.dev/js/${t}.json`).then(e=>e.json()).then(e=>new Wae(e)).catch(e=>{throw delete h2[t],e})),await h2[t]}async function LRe(t){return ORe(IRe(t))}const kRe=t=>t.startsWith("gpt-3.5-turbo-16k")?"gpt-3.5-turbo-16k":t.startsWith("gpt-3.5-turbo-")?"gpt-3.5-turbo":t.startsWith("gpt-4-32k")?"gpt-4-32k":t.startsWith("gpt-4-")?"gpt-4":t.startsWith("gpt-4o")?"gpt-4o":t;function qae(t){return typeof t!="object"||!t?!1:!!("type"in t&&t.type==="function"&&"function"in t&&typeof t.function=="object"&&t.function&&"name"in t.function&&"parameters"in t.function)}const NRe=()=>!1;class URe extends $a{get lc_attributes(){return{callbacks:void 0,verbose:void 0}}constructor(e){super(e),Object.defineProperty(this,"verbose",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"callbacks",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.verbose=e.verbose??NRe(),this.callbacks=e.callbacks,this.tags=e.tags??[],this.metadata=e.metadata??{}}}class BRe extends URe{get callKeys(){return["stop","timeout","signal","tags","metadata","callbacks"]}constructor({callbacks:e,callbackManager:i,...r}){const{cache:n,...s}=r;super({callbacks:e??i,...s}),Object.defineProperty(this,"caller",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"cache",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_encoding",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),typeof n=="object"?this.cache=n:n?this.cache=k6.global():this.cache=void 0,this.caller=new I6(r??{})}async getNumTokens(e){let i;typeof e=="string"?i=e:i=e.map(n=>typeof n=="string"?n:n.type==="text"&&"text"in n?n.text:"").join("");let r=Math.ceil(i.length/4);if(!this._encoding)try{this._encoding=await LRe("modelName"in this?kRe(this.modelName):"gpt2")}catch(n){console.warn("Failed to calculate number of tokens, falling back to approximate count",n)}if(this._encoding)try{r=this._encoding.encode(i).length}catch(n){console.warn("Failed to calculate number of tokens, falling back to approximate count",n)}return r}static _convertInputToPromptValue(e){return typeof e=="string"?new bRe(e):Array.isArray(e)?new wRe(e.map(kE)):e}_identifyingParams(){return{}}_getSerializedCacheKeyParametersForCall({config:e,...i}){const r={...this._identifyingParams(),...i,_type:this._llmType(),_model:this._modelType()};return Object.entries(r).filter(([a,o])=>o!==void 0).map(([a,o])=>`${a}:${JSON.stringify(o)}`).sort().join(",")}serialize(){return{...this._identifyingParams(),_type:this._llmType(),_model:this._modelType()}}static async deserialize(e){throw new Error("Use .toJSON() instead")}}class jI extends $a{static lc_name(){return"RunnablePassthrough"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"func",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),e&&(this.func=e.func)}async invoke(e,i){const r=Qr(i);return this.func&&await this.func(e,r),this._callWithConfig(n=>Promise.resolve(n),e,r)}async*transform(e,i){const r=Qr(i);let n,s=!0;for await(const a of this._transformStreamWithConfig(e,o=>o,r))if(yield a,s)if(n===void 0)n=a;else try{n=cO(n,a)}catch{n=void 0,s=!1}this.func&&n!==void 0&&await this.func(n,r)}static assign(e){return new Hae(new f_({steps:e}))}}function aU(t){const e=[];for(const i of t){let r=i;if(Array.isArray(i.content))for(let n=0;n<i.content.length;n++){const s=i.content[n];(iMe(s)||rMe(s))&&r===i&&(r=new i.constructor({...r,content:[...i.content.slice(0,n),nMe(s),...i.content.slice(n+1)]}))}e.push(r)}return e}class dg extends BRe{constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","chat_models",this._llmType()]}),Object.defineProperty(this,"disableStreaming",{enumerable:!0,configurable:!0,writable:!0,value:!1})}_separateRunnableConfigFromCallOptionsCompat(e){const[i,r]=super._separateRunnableConfigFromCallOptions(e);return r.signal=i.signal,[i,r]}async invoke(e,i){const r=dg._convertInputToPromptValue(e);return(await this.generatePrompt([r],i,i?.callbacks)).generations[0][0].message}async*_streamResponseChunks(e,i,r){throw new Error("Not implemented.")}async*_streamIterator(e,i){if(this._streamResponseChunks===dg.prototype._streamResponseChunks||this.disableStreaming)yield this.invoke(e,i);else{const n=dg._convertInputToPromptValue(e).toChatMessages(),[s,a]=this._separateRunnableConfigFromCallOptionsCompat(i),o={...s.metadata,...this.getLsParams(a)},l=await ec.configure(s.callbacks,this.callbacks,s.tags,this.tags,o,this.metadata,{verbose:this.verbose}),c={options:a,invocation_params:this?.invocationParams(a),batch_size:1},u=await l?.handleChatModelStart(this.toJSON(),[aU(n)],s.runId,void 0,c,void 0,void 0,s.runName);let h,d;try{for await(const f of this._streamResponseChunks(n,a,u?.[0])){if(f.message.id==null){const p=u?.at(0)?.runId;p!=null&&f.message._updateId(`run-${p}`)}f.message.response_metadata={...f.generationInfo,...f.message.response_metadata},yield f.message,h?h=h.concat(f):h=f,$7(f.message)&&f.message.usage_metadata!==void 0&&(d={tokenUsage:{promptTokens:f.message.usage_metadata.input_tokens,completionTokens:f.message.usage_metadata.output_tokens,totalTokens:f.message.usage_metadata.total_tokens}})}}catch(f){throw await Promise.all((u??[]).map(p=>p?.handleLLMError(f))),f}await Promise.all((u??[]).map(f=>f?.handleLLMEnd({generations:[[h]],llmOutput:d})))}}getLsParams(e){const i=this.getName().startsWith("Chat")?this.getName().replace("Chat",""):this.getName();return{ls_model_type:"chat",ls_stop:e.stop,ls_provider:i}}async _generateUncached(e,i,r,n){const s=e.map(h=>h.map(kE));let a;if(n!==void 0&&n.length===s.length)a=n;else{const h={...r.metadata,...this.getLsParams(i)},d=await ec.configure(r.callbacks,this.callbacks,r.tags,this.tags,h,this.metadata,{verbose:this.verbose}),f={options:i,invocation_params:this?.invocationParams(i),batch_size:1};a=await d?.handleChatModelStart(this.toJSON(),s.map(aU),r.runId,void 0,f,void 0,void 0,r.runName)}const o=[],l=[];if(!!a?.[0].handlers.find(x2e)&&!this.disableStreaming&&s.length===1&&this._streamResponseChunks!==dg.prototype._streamResponseChunks)try{const h=await this._streamResponseChunks(s[0],i,a?.[0]);let d,f;for await(const p of h){if(p.message.id==null){const g=a?.at(0)?.runId;g!=null&&p.message._updateId(`run-${g}`)}d===void 0?d=p:d=cO(d,p),$7(p.message)&&p.message.usage_metadata!==void 0&&(f={tokenUsage:{promptTokens:p.message.usage_metadata.input_tokens,completionTokens:p.message.usage_metadata.output_tokens,totalTokens:p.message.usage_metadata.total_tokens}})}if(d===void 0)throw new Error("Received empty response from chat model call.");o.push([d]),await a?.[0].handleLLMEnd({generations:o,llmOutput:f})}catch(h){throw await a?.[0].handleLLMError(h),h}else{const h=await Promise.allSettled(s.map((d,f)=>this._generate(d,{...i,promptIndex:f},a?.[f])));await Promise.all(h.map(async(d,f)=>{if(d.status==="fulfilled"){const p=d.value;for(const g of p.generations){if(g.message.id==null){const m=a?.at(0)?.runId;m!=null&&g.message._updateId(`run-${m}`)}g.message.response_metadata={...g.generationInfo,...g.message.response_metadata}}return p.generations.length===1&&(p.generations[0].message.response_metadata={...p.llmOutput,...p.generations[0].message.response_metadata}),o[f]=p.generations,l[f]=p.llmOutput,a?.[f]?.handleLLMEnd({generations:[p.generations],llmOutput:p.llmOutput})}else return await a?.[f]?.handleLLMError(d.reason),Promise.reject(d.reason)}))}const u={generations:o,llmOutput:l.length?this._combineLLMOutput?.(...l):void 0};return Object.defineProperty(u,jX,{value:a?{runIds:a?.map(h=>h.runId)}:void 0,configurable:!0}),u}async _generateCached({messages:e,cache:i,llmStringKey:r,parsedOptions:n,handledOptions:s}){const a=e.map(m=>m.map(kE)),o={...s.metadata,...this.getLsParams(n)},l=await ec.configure(s.callbacks,this.callbacks,s.tags,this.tags,o,this.metadata,{verbose:this.verbose}),c={options:n,invocation_params:this?.invocationParams(n),batch_size:1},u=await l?.handleChatModelStart(this.toJSON(),a.map(aU),s.runId,void 0,c,void 0,void 0,s.runName),h=[],f=(await Promise.allSettled(a.map(async(m,y)=>{const b=dg._convertInputToPromptValue(m).toString(),w=await i.lookup(b,r);return w==null&&h.push(y),w}))).map((m,y)=>({result:m,runManager:u?.[y]})).filter(({result:m})=>m.status==="fulfilled"&&m.value!=null||m.status==="rejected"),p=[];await Promise.all(f.map(async({result:m,runManager:y},b)=>{if(m.status==="fulfilled"){const w=m.value;return p[b]=w.map(E=>("message"in E&&cT(E.message)&&v6(E.message)&&(E.message.usage_metadata={input_tokens:0,output_tokens:0,total_tokens:0}),E.generationInfo={...E.generationInfo,tokenUsage:{}},E)),w.length&&await y?.handleLLMNewToken(w[0].text),y?.handleLLMEnd({generations:[w]},void 0,void 0,void 0,{cached:!0})}else return await y?.handleLLMError(m.reason,void 0,void 0,void 0,{cached:!0}),Promise.reject(m.reason)}));const g={generations:p,missingPromptIndices:h,startedRunManagers:u};return Object.defineProperty(g,jX,{value:u?{runIds:u?.map(m=>m.runId)}:void 0,configurable:!0}),g}async generate(e,i,r){let n;Array.isArray(i)?n={stop:i}:n=i;const s=e.map(p=>p.map(kE)),[a,o]=this._separateRunnableConfigFromCallOptionsCompat(n);if(a.callbacks=a.callbacks??r,!this.cache)return this._generateUncached(s,o,a);const{cache:l}=this,c=this._getSerializedCacheKeyParametersForCall(o),{generations:u,missingPromptIndices:h,startedRunManagers:d}=await this._generateCached({messages:s,cache:l,llmStringKey:c,parsedOptions:o,handledOptions:a});let f={};if(h.length>0){const p=await this._generateUncached(h.map(g=>s[g]),o,a,d!==void 0?h.map(g=>d?.[g]):void 0);await Promise.all(p.generations.map(async(g,m)=>{const y=h[m];u[y]=g;const b=dg._convertInputToPromptValue(s[y]).toString();return l.update(b,c,g)})),f=p.llmOutput??{}}return{generations:u,llmOutput:f}}invocationParams(e){return{}}_modelType(){return"base_chat_model"}serialize(){return{...this.invocationParams(),_type:this._llmType(),_model:this._modelType()}}async generatePrompt(e,i,r){const n=e.map(s=>s.toChatMessages());return this.generate(n,i,r)}async call(e,i,r){return(await this.generate([e.map(kE)],i,r)).generations[0][0].message}async callPrompt(e,i,r){const n=e.toChatMessages();return this.call(n,i,r)}async predictMessages(e,i,r){return this.call(e,i,r)}async predict(e,i,r){const n=new iO(e),s=await this.call([n],i,r);if(typeof s.content!="string")throw new Error("Cannot use predict when output is not a string.");return s.content}withStructuredOutput(e,i){if(typeof this.bindTools!="function")throw new Error('Chat model must implement ".bindTools()" to use withStructuredOutput.');if(i?.strict)throw new Error('"strict" mode is not supported for this model by default.');const r=e,n=i?.name,s=zae(r)??"A function available to call.",a=i?.method,o=i?.includeRaw;if(a==="jsonMode")throw new Error('Base withStructuredOutput implementation only supports "functionCalling" as a method.');let l=n??"extract",c;fT(r)?c=[{type:"function",function:{name:l,description:s,parameters:O6(r)}}]:("name"in r&&(l=r.name),c=[{type:"function",function:{name:l,description:s,parameters:r}}]);const u=this.bindTools(c),h=pT.from(g=>{if(!g.tool_calls||g.tool_calls.length===0)throw new Error("No tool calls found in the response.");const m=g.tool_calls.find(y=>y.name===l);if(!m)throw new Error(`No tool call found with name ${l}.`);return m.args});if(!o)return u.pipe(h).withConfig({runName:"StructuredOutput"});const d=jI.assign({parsed:(g,m)=>h.invoke(g.raw,m)}),f=jI.assign({parsed:()=>null}),p=d.withFallbacks({fallbacks:[f]});return Sp.from([{raw:u},p]).withConfig({runName:"StructuredOutputRunnable"})}}class Xae extends $a{parseResultWithPrompt(e,i,r){return this.parseResult(e,r)}_baseMessageToString(e){return typeof e.content=="string"?e.content:this._baseMessageContentToString(e.content)}_baseMessageContentToString(e){return JSON.stringify(e)}async invoke(e,i){return typeof e=="string"?this._callWithConfig(async(r,n)=>this.parseResult([{text:r}],n?.callbacks),e,{...i,runType:"parser"}):this._callWithConfig(async(r,n)=>this.parseResult([{message:r,text:this._baseMessageToString(r)}],n?.callbacks),e,{...i,runType:"parser"})}}class FRe extends Xae{parseResult(e,i){return this.parse(e[0].text,i)}async parseWithPrompt(e,i,r){return this.parse(e,r)}_type(){throw new Error("_type not implemented")}}class zRe extends Error{constructor(e,i,r,n=!1){if(super(e),Object.defineProperty(this,"llmOutput",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"observation",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"sendToLLM",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.llmOutput=i,this.observation=r,this.sendToLLM=n,n&&(r===void 0||i===void 0))throw new Error("Arguments 'observation' & 'llmOutput' are required if 'sendToLlm' is true");tae(this,"OUTPUT_PARSING_FAILURE")}}class jRe extends FRe{async*_transform(e){for await(const i of e)typeof i=="string"?yield this.parseResult([{text:i}]):yield this.parseResult([{message:i,text:this._baseMessageToString(i)}])}async*transform(e,i){yield*this._transformStreamWithConfig(e,this._transform.bind(this),{...i,runType:"parser"})}}class VRe extends jRe{constructor(e){super(e),Object.defineProperty(this,"diff",{enumerable:!0,configurable:!0,writable:!0,value:!1}),this.diff=e?.diff??this.diff}async*_transform(e){let i,r;for await(const n of e){if(typeof n!="string"&&typeof n.content!="string")throw new Error("Cannot handle non-string output.");let s;if(lMe(n)){if(typeof n.content!="string")throw new Error("Cannot handle non-string message output.");s=new oM({message:n,text:n.content})}else if(cT(n)){if(typeof n.content!="string")throw new Error("Cannot handle non-string message output.");s=new oM({message:gMe(n),text:n.content})}else s=new P1({text:n});r===void 0?r=s:r=r.concat(s);const a=await this.parsePartialResult([r]);a!=null&&!Nz(a,i)&&(this.diff?yield this._diff(i,a):yield a,i=a)}}getFormatInstructions(){return""}}class HRe extends VRe{constructor(){super(...arguments),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","output_parsers"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0})}static lc_name(){return"JsonOutputParser"}_concatOutputChunks(e,i){return this.diff?super._concatOutputChunks(e,i):i}_diff(e,i){if(i)return e?vTe(e,i):[{op:"replace",path:"",value:i}]}async parsePartialResult(e){return G7(e[0].text)}async parse(e){return G7(e,JSON.parse)}getFormatInstructions(){return""}}function A0(t){if(typeof t=="object"&&t!==null){const e={...t};"additionalProperties"in e&&delete e.additionalProperties,"$schema"in e&&delete e.$schema,"strict"in e&&delete e.strict;for(const i in e)i in e&&(Array.isArray(e[i])?e[i]=e[i].map(A0):typeof e[i]=="object"&&e[i]!==null&&(e[i]=A0(e[i])));return e}return t}function jz(t){const e=A0(fT(t)?O6(t):t),{$schema:i,...r}=e;return r}function GRe(t){const e=A0(t),{$schema:i,...r}=e;return r}function WRe(t){return t!==void 0&&Array.isArray(t.lc_namespace)}function qRe(t){return t!==void 0&&$a.isRunnable(t)&&"lc_name"in t.constructor&&typeof t.constructor.lc_name=="function"&&t.constructor.lc_name()==="RunnableToolLike"}function XRe(t){return!!t&&typeof t=="object"&&"name"in t&&"schema"in t&&(fT(t.schema)||t.schema!=null&&typeof t.schema=="object"&&"type"in t.schema&&typeof t.schema.type=="string"&&["null","boolean","object","array","number","string"].includes(t.schema.type))}function $ae(t){return XRe(t)||qRe(t)||WRe(t)}const ho=[];for(let t=0;t<256;++t)ho.push((t+256).toString(16).slice(1));function $Re(t,e=0){return(ho[t[e+0]]+ho[t[e+1]]+ho[t[e+2]]+ho[t[e+3]]+"-"+ho[t[e+4]]+ho[t[e+5]]+"-"+ho[t[e+6]]+ho[t[e+7]]+"-"+ho[t[e+8]]+ho[t[e+9]]+"-"+ho[t[e+10]]+ho[t[e+11]]+ho[t[e+12]]+ho[t[e+13]]+ho[t[e+14]]+ho[t[e+15]]).toLowerCase()}let oU;const YRe=new Uint8Array(16);function KRe(){if(!oU){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");oU=crypto.getRandomValues.bind(crypto)}return oU(YRe)}const ZRe=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),JX={randomUUID:ZRe};function Yae(t,e,i){if(JX.randomUUID&&!t)return JX.randomUUID();t=t||{};const r=t.random??t.rng?.()??KRe();if(r.length<16)throw new Error("Random bytes length must be >= 16");return r[6]=r[6]&15|64,r[8]=r[8]&63|128,$Re(r)}function QRe(t){const e=t._getType();return tO.isInstance(t)?t.role:e==="tool"?e:t.name??e}function JRe(t){switch(t){case"supervisor":case"ai":case"model":return"model";case"system":return"system";case"human":return"user";case"tool":case"function":return"function";default:throw new Error(`Unknown / unsupported author: ${t}`)}}function eIe(t){if("mimeType"in t&&"data"in t)return{inlineData:{mimeType:t.mimeType,data:t.data}};if("mimeType"in t&&"fileUri"in t)return{fileData:{mimeType:t.mimeType,fileUri:t.fileUri}};throw new Error("Invalid media content")}function tIe(t,e){return e.map(i=>v6(i)?i.tool_calls??[]:[]).flat().find(i=>i.id===t.tool_call_id)?.name}function iIe(t){return{providerName:"Google Gemini",fromStandardTextBlock(i){return{text:i.text}},fromStandardImageBlock(i){if(!t)throw new Error("This model does not support images");if(i.source_type==="url"){const r=qk({dataUrl:i.url});return r?{inlineData:{mimeType:r.mime_type,data:r.data}}:{fileData:{mimeType:i.mime_type??"",fileUri:i.url}}}if(i.source_type==="base64")return{inlineData:{mimeType:i.mime_type??"",data:i.data}};throw new Error(`Unsupported source type: ${i.source_type}`)},fromStandardAudioBlock(i){if(!t)throw new Error("This model does not support audio");if(i.source_type==="url"){const r=qk({dataUrl:i.url});return r?{inlineData:{mimeType:r.mime_type,data:r.data}}:{fileData:{mimeType:i.mime_type??"",fileUri:i.url}}}if(i.source_type==="base64")return{inlineData:{mimeType:i.mime_type??"",data:i.data}};throw new Error(`Unsupported source type: ${i.source_type}`)},fromStandardFileBlock(i){if(!t)throw new Error("This model does not support files");if(i.source_type==="text")return{text:i.text};if(i.source_type==="url"){const r=qk({dataUrl:i.url});return r?{inlineData:{mimeType:r.mime_type,data:r.data}}:{fileData:{mimeType:i.mime_type??"",fileUri:i.url}}}if(i.source_type==="base64")return{inlineData:{mimeType:i.mime_type??"",data:i.data}};throw new Error(`Unsupported source type: ${i.source_type}`)}}}function e$(t,e){if(S1(t))return sMe(t,iIe(e));if(t.type==="text")return{text:t.text};if(t.type==="executableCode")return{executableCode:t.executableCode};if(t.type==="codeExecutionResult")return{codeExecutionResult:t.codeExecutionResult};if(t.type==="image_url"){if(!e)throw new Error("This model does not support images");let i;if(typeof t.image_url=="string")i=t.image_url;else if(typeof t.image_url=="object"&&"url"in t.image_url)i=t.image_url.url;else throw new Error("Please provide image as base64 encoded data URL");const[r,n]=i.split(",");if(!r.startsWith("data:"))throw new Error("Please provide image as base64 encoded data URL");const[s,a]=r.replace(/^data:/,"").split(";");if(a!=="base64")throw new Error("Please provide image as base64 encoded data URL");return{inlineData:{data:n,mimeType:s}}}else{if(t.type==="media")return eIe(t);if(t.type==="tool_use")return{functionCall:{name:t.name,args:t.input}};if(t.type?.includes("/")&&t.type.split("/").length===2&&"data"in t&&typeof t.data=="string")return{inlineData:{mimeType:t.type,data:t.data}};if("functionCall"in t)return;throw"type"in t?new Error(`Unknown content type ${t.type}`):new Error(`Unknown content ${JSON.stringify(t)}`)}}function rIe(t,e,i){if(hMe(t)){const s=t.name??tIe(t,i);if(s===void 0)throw new Error(`Google requires a tool name for each tool call response, and we could not infer a called tool name for ToolMessage "${t.id}" from your passed messages. Please populate a "name" field on that ToolMessage explicitly.`);const a=Array.isArray(t.content)?t.content.map(o=>e$(o,e)).filter(o=>o!==void 0):t.content;return t.status==="error"?[{functionResponse:{name:s,response:{error:{details:a}}}}]:[{functionResponse:{name:s,response:{result:a}}}]}let r=[];const n=[];return typeof t.content=="string"&&t.content&&n.push({text:t.content}),Array.isArray(t.content)&&n.push(...t.content.map(s=>e$(s,e)).filter(s=>s!==void 0)),v6(t)&&t.tool_calls?.length&&(r=t.tool_calls.map(s=>({functionCall:{name:s.name,args:s.args}}))),[...n,...r]}function t$(t,e,i=!1){return t.reduce((r,n,s)=>{if(!cT(n))throw new Error("Unsupported message input");const a=QRe(n);if(a==="system"&&s!==0)throw new Error("System message should be the first one");const o=JRe(a),l=r.content[r.content.length];if(!r.mergeWithPreviousContent&&l&&l.role===o)throw new Error("Google Generative AI requires alternate messages between authors");const c=rIe(n,e,t.slice(0,s));if(r.mergeWithPreviousContent){const d=r.content[r.content.length-1];if(!d)throw new Error("There was a problem parsing your system message. Please try a prompt without one.");return d.parts.push(...c),{mergeWithPreviousContent:!1,content:r.content}}let u=o;(u==="function"||u==="system"&&!i)&&(u="user");const h={role:u,parts:c};return{mergeWithPreviousContent:a==="system"&&!i,content:[...r.content,h]}},{content:[],mergeWithPreviousContent:!1}).content}function nIe(t,e){if(!t.candidates||t.candidates.length===0||!t.candidates[0])return{generations:[],llmOutput:{filters:t.promptFeedback}};const i=t.functionCalls(),[r]=t.candidates,{content:n,...s}=r;let a;Array.isArray(n?.parts)&&n.parts.length===1&&n.parts[0].text?a=n.parts[0].text:Array.isArray(n?.parts)&&n.parts.length>0?a=n.parts.map(c=>"text"in c?{type:"text",text:c.text}:"executableCode"in c?{type:"executableCode",executableCode:c.executableCode}:"codeExecutionResult"in c?{type:"codeExecutionResult",codeExecutionResult:c.codeExecutionResult}:c):a=[];let o="";return typeof a=="string"?o=a:Array.isArray(a)&&a.length>0&&(o=a.find(u=>"text"in u)?.text??o),{generations:[{text:o,message:new bz({content:a??"",tool_calls:i?.map(c=>({...c,type:"tool_call",id:"id"in c&&typeof c.id=="string"?c.id:Yae()})),additional_kwargs:{...s},usage_metadata:e?.usageMetadata}),generationInfo:s}],llmOutput:{tokenUsage:{promptTokens:e?.usageMetadata?.input_tokens,completionTokens:e?.usageMetadata?.output_tokens,totalTokens:e?.usageMetadata?.total_tokens}}}}function sIe(t,e){if(!t.candidates||t.candidates.length===0)return null;const i=t.functionCalls(),[r]=t.candidates,{content:n,...s}=r;let a;Array.isArray(n?.parts)&&n.parts.every(c=>"text"in c)?a=n.parts.map(c=>c.text).join(""):Array.isArray(n?.parts)?a=n.parts.map(c=>"text"in c?{type:"text",text:c.text}:"executableCode"in c?{type:"executableCode",executableCode:c.executableCode}:"codeExecutionResult"in c?{type:"codeExecutionResult",codeExecutionResult:c.codeExecutionResult}:c):a=[];let o="";a&&typeof a=="string"?o=a:Array.isArray(a)&&(o=a.find(u=>"text"in u)?.text??"");const l=[];return i&&l.push(...i.map(c=>({...c,args:JSON.stringify(c.args),index:e.index,type:"tool_call_chunk",id:"id"in c&&typeof c.id=="string"?c.id:Yae()}))),new oM({text:o,message:new u_({content:a||"",name:n?n.role:void 0,tool_call_chunks:l,additional_kwargs:{},usage_metadata:e.usageMetadata}),generationInfo:s})}function aIe(t){return t.every(e=>"functionDeclarations"in e&&Array.isArray(e.functionDeclarations))?t:[{functionDeclarations:t.map(e=>{if($ae(e)){const i=jz(e.schema);return i.type==="object"&&"properties"in i&&Object.keys(i.properties).length===0?{name:e.name,description:e.description}:{name:e.name,description:e.description,parameters:i}}return qae(e)?{name:e.function.name,description:e.function.description??"A function available to call.",parameters:GRe(e.function.parameters)}:e})}]}class i$ extends Xae{static lc_name(){return"GoogleGenerativeAIToolsOutputParser"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","google_genai","output_parsers"]}),Object.defineProperty(this,"returnId",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"keyName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"returnSingle",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"zodSchema",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.keyName=e.keyName,this.returnSingle=e.returnSingle??this.returnSingle,this.zodSchema=e.zodSchema}async _validateResult(e){if(this.zodSchema===void 0)return e;const i=await tRe(this.zodSchema,e);if(i.success)return i.data;throw new zRe(`Failed to parse. Text: "${JSON.stringify(e,null,2)}". Error: ${JSON.stringify(i.error.issues)}`,JSON.stringify(e,null,2))}async parseResult(e){const i=e.flatMap(s=>{const{message:a}=s;return!("tool_calls"in a)||!Array.isArray(a.tool_calls)?[]:a.tool_calls});if(i[0]===void 0)throw new Error("No parseable tool calls provided to GoogleGenerativeAIToolsOutputParser.");const[r]=i;return await this._validateResult(r.args)}}function r$(t,e){const i=oIe(t),r=cIe(i,e);return{tools:i,toolConfig:r}}function oIe(t){let e=[];const i=[];return t.forEach(n=>{if($ae(n)){const[s]=aIe([n]);s.functionDeclarations&&e.push(...s.functionDeclarations)}else if(qae(n)){const{functionDeclarations:s}=lIe(n);if(s)e.push(...s);else throw new Error("Failed to convert OpenAI structured tool to GenerativeAI tool")}else i.push(n)}),i.find(n=>"functionDeclarations"in n)?i.map(n=>{if(e?.length>0&&"functionDeclarations"in n){const s={functionDeclarations:[...n.functionDeclarations||[],...e]};return e=[],s}return n}):[...i,...e.length>0?[{functionDeclarations:e}]:[]]}function lIe(t){return{functionDeclarations:[{name:t.function.name,description:t.function.description,parameters:A0(t.function.parameters)}]}}function cIe(t,e){if(!t.length||!e)return;const{toolChoice:i,allowedFunctionNames:r}=e,n={any:Fw.ANY,auto:Fw.AUTO,none:Fw.NONE};if(i&&["any","auto","none"].includes(i))return{functionCallingConfig:{mode:n[i]??"MODE_UNSPECIFIED",allowedFunctionNames:r}};if(typeof i=="string"||r)return{functionCallingConfig:{mode:Fw.ANY,allowedFunctionNames:[...r??[],...i&&typeof i=="string"?[i]:[]]}}}class uIe extends dg{static lc_name(){return"ChatGoogleGenerativeAI"}get lc_secrets(){return{apiKey:"GOOGLE_API_KEY"}}get lc_aliases(){return{apiKey:"google_api_key"}}get _isMultimodalModel(){return this.model.includes("vision")||this.model.startsWith("gemini-1.5")||this.model.startsWith("gemini-2")||this.model.startsWith("gemma-3-")&&!this.model.startsWith("gemma-3-1b")}constructor(e){if(super(e),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","chat_models","google_genai"]}),Object.defineProperty(this,"model",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"temperature",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"maxOutputTokens",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"topP",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"topK",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"stopSequences",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"safetySettings",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"apiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"streaming",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"json",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"streamUsage",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"convertSystemMessageToHumanContent",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.model=e.model.replace(/^models\//,""),this.maxOutputTokens=e.maxOutputTokens??this.maxOutputTokens,this.maxOutputTokens&&this.maxOutputTokens<0)throw new Error("`maxOutputTokens` must be a positive integer");if(this.temperature=e.temperature??this.temperature,this.temperature&&(this.temperature<0||this.temperature>2))throw new Error("`temperature` must be in the range of [0.0,2.0]");if(this.topP=e.topP??this.topP,this.topP&&this.topP<0)throw new Error("`topP` must be a positive integer");if(this.topP&&this.topP>1)throw new Error("`topP` must be below 1.");if(this.topK=e.topK??this.topK,this.topK&&this.topK<0)throw new Error("`topK` must be a positive integer");if(this.stopSequences=e.stopSequences??this.stopSequences,this.apiKey=e.apiKey??c0("GOOGLE_API_KEY"),!this.apiKey)throw new Error("Please set an API key for Google GenerativeAI in the environment variable GOOGLE_API_KEY or in the `apiKey` field of the ChatGoogleGenerativeAI constructor");if(this.safetySettings=e.safetySettings??this.safetySettings,this.safetySettings&&this.safetySettings.length>0&&new Set(this.safetySettings.map(r=>r.category)).size!==this.safetySettings.length)throw new Error("The categories in `safetySettings` array must be unique");this.streaming=e.streaming??this.streaming,this.json=e.json,this.client=new H7(this.apiKey).getGenerativeModel({model:this.model,safetySettings:this.safetySettings,generationConfig:{stopSequences:this.stopSequences,maxOutputTokens:this.maxOutputTokens,temperature:this.temperature,topP:this.topP,topK:this.topK,...this.json?{responseMimeType:"application/json"}:{}}},{apiVersion:e.apiVersion,baseUrl:e.baseUrl}),this.streamUsage=e.streamUsage??this.streamUsage}useCachedContent(e,i,r){this.apiKey&&(this.client=new H7(this.apiKey).getGenerativeModelFromCachedContent(e,i,r))}get useSystemInstruction(){return typeof this.convertSystemMessageToHumanContent=="boolean"?!this.convertSystemMessageToHumanContent:this.computeUseSystemInstruction}get computeUseSystemInstruction(){return this.model==="gemini-1.0-pro-001"||this.model.startsWith("gemini-pro-vision")||this.model.startsWith("gemini-1.0-pro-vision")?!1:this.model!=="gemini-pro"}getLsParams(e){return{ls_provider:"google_genai",ls_model_name:this.model,ls_model_type:"chat",ls_temperature:this.client.generationConfig.temperature,ls_max_tokens:this.client.generationConfig.maxOutputTokens,ls_stop:e.stop}}_combineLLMOutput(){return[]}_llmType(){return"googlegenerativeai"}bindTools(e,i){return this.withConfig({tools:r$(e)?.tools,...i})}invocationParams(e){const i=e?.tools?.length?r$(e.tools,{toolChoice:e.tool_choice,allowedFunctionNames:e.allowedFunctionNames}):void 0;return e?.responseSchema?(this.client.generationConfig.responseSchema=e.responseSchema,this.client.generationConfig.responseMimeType="application/json"):(this.client.generationConfig.responseSchema=void 0,this.client.generationConfig.responseMimeType=this.json?"application/json":void 0),{...i?.tools?{tools:i.tools}:{},...i?.toolConfig?{toolConfig:i.toolConfig}:{}}}async _generate(e,i,r){const n=t$(e,this._isMultimodalModel,this.useSystemInstruction);let s=n;if(n[0].role==="system"){const[u]=n;this.client.systemInstruction=u,s=n.slice(1)}const a=this.invocationParams(i);if(this.streaming){const u={},h=this._streamResponseChunks(e,i,r),d={};for await(const p of h){const g=p.generationInfo?.completion??0;d[g]===void 0?d[g]=p:d[g]=d[g].concat(p)}return{generations:Object.entries(d).sort(([p],[g])=>parseInt(p,10)-parseInt(g,10)).map(([p,g])=>g),llmOutput:{estimatedTokenUsage:u}}}const o=await this.completionWithRetry({...a,contents:s});let l;if("usageMetadata"in o.response){const u=o.response.usageMetadata;l={input_tokens:u.promptTokenCount??0,output_tokens:u.candidatesTokenCount??0,total_tokens:u.totalTokenCount??0}}const c=nIe(o.response,{usageMetadata:l});return c.generations?.length>0&&await r?.handleLLMNewToken(c.generations[0]?.text??""),c}async*_streamResponseChunks(e,i,r){const n=t$(e,this._isMultimodalModel,this.useSystemInstruction);let s=n;if(n[0].role==="system"){const[p]=n;this.client.systemInstruction=p,s=n.slice(1)}const o={...this.invocationParams(i),contents:s},l=await this.caller.callWithOptions({signal:i?.signal},async()=>{const{stream:p}=await this.client.generateContentStream(o);return p});let c,u=0,h=0,d=0,f=0;for await(const p of l){if("usageMetadata"in p&&p.usageMetadata!==void 0&&this.streamUsage!==!1&&i.streamUsage!==!1){c={input_tokens:p.usageMetadata.promptTokenCount??0,output_tokens:p.usageMetadata.candidatesTokenCount??0,total_tokens:p.usageMetadata.totalTokenCount??0};const m=p.usageMetadata.promptTokenCount??0;c.input_tokens=Math.max(0,m-u),u=m;const y=p.usageMetadata.candidatesTokenCount??0;c.output_tokens=Math.max(0,y-h),h=y;const b=p.usageMetadata.totalTokenCount??0;c.total_tokens=Math.max(0,b-d),d=b}const g=sIe(p,{usageMetadata:c,index:f});f+=1,g&&(yield g,await r?.handleLLMNewToken(g.text??""))}}async completionWithRetry(e,i){return this.caller.callWithOptions({signal:i?.signal},async()=>{try{return await this.client.generateContent(e)}catch(r){throw r.message?.includes("400 Bad Request")&&(r.status=400),r}})}withStructuredOutput(e,i){const r=e,n=i?.name,s=i?.method,a=i?.includeRaw;if(s==="jsonMode")throw new Error('ChatGoogleGenerativeAI only supports "jsonSchema" or "functionCalling" as a method.');let o,l;if(s==="functionCalling"){let d=n??"extract",f;if(fT(r)){const p=jz(r);f=[{functionDeclarations:[{name:d,description:p.description??"A function available to call.",parameters:p}]}],l=new i$({returnSingle:!0,keyName:d,zodSchema:r})}else{let p;typeof r.name=="string"&&typeof r.parameters=="object"&&r.parameters!=null?(p=r,p.parameters=A0(r.parameters),d=r.name):p={name:d,description:r.description??"",parameters:A0(r)},f=[{functionDeclarations:[p]}],l=new i$({returnSingle:!0,keyName:d})}o=this.bindTools(f).withConfig({allowedFunctionNames:[d]})}else{const d=jz(r);o=this.withConfig({responseSchema:d}),l=new HRe}if(!a)return o.pipe(l).withConfig({runName:"ChatGoogleGenerativeAIStructuredOutput"});const c=jI.assign({parsed:(d,f)=>l.invoke(d.raw,f)}),u=jI.assign({parsed:()=>null}),h=c.withFallbacks({fallbacks:[u]});return Sp.from([{raw:o},h]).withConfig({runName:"StructuredOutputRunnable"})}}var hIe={};async function dIe(t){return await new Promise((e,i)=>{const r=new FileReader;r.onerror=()=>i(new Error("Failed to read file")),r.onload=()=>{const n=r.result;if(typeof n=="string"){const s=n.split(",");e({base64:s[1],mime:(n.match(/^data:(.*);base64,/)||[])[1]||t.type})}else i(new Error("Unexpected FileReader result"))},r.readAsDataURL(t)})}async function fIe(t,e,i="image/png"){const r=hIe.GOO,n="gemini-2.5-flash",s=new uIe({model:n,apiKey:r}),a="System Instructions: Describe the content of this image in detail focusing on space and biology aspects. Clearly mention any scientific elements, organisms, or phenomena visible in the image. Provide insights relevant to space biology research. Also extract the text present in the image properly. The user instrictions are: ";let o=null,l=i;if(t instanceof File||typeof Blob<"u"&&t instanceof Blob){const{base64:u,mime:h}=await dIe(t);o=u,l=h||i}else typeof t=="string"&&(o=t.replace(/^data:.*;base64,/,""));const c=[{role:"user",content:[{type:"text",text:a+e},...o?[{type:"image_url",image_url:`data:${l};base64,${o}`}]:[]]}];try{const u=await s.invoke(c);return Array.isArray(u.content)&&u.content[0]&&u.content[0].text?u.content[0].text:u.content&&typeof u.content=="string"?u.content:JSON.stringify(u)}catch(u){const h=u&&u.message?String(u.message):String(u);if(h.toLowerCase().includes("does not support images")||h.toLowerCase().includes("images"))try{const d=await s.invoke([{role:"user",content:[{type:"text",text:a+e+(o?`

(Note: image omitted due to model limitations)`:"")}]}]);return Array.isArray(d.content)&&d.content[0]&&d.content[0].text?d.content[0].text:d.content&&typeof d.content=="string"?d.content:JSON.stringify(d)}catch(d){throw d}throw u}try{return Array.isArray(res.content)&&res.content[0]&&res.content[0].text?res.content[0].text:res.content&&typeof res.content=="string"?res.content:JSON.stringify(res)}catch{return String(res)}}function pIe({userType:t,isThinking:e}){const i=J.useRef(null);J.useEffect(()=>{const a=i.current;if(!a)return;const o=a.getContext("2d"),{width:l,height:c}=a;let u,h=[],d=0;for(let g=0;g<50;g++)h.push({x:Math.random()*l,y:Math.random()*c,vx:(Math.random()-.5)*2,vy:(Math.random()-.5)*2,size:Math.random()*3+1,hue:Math.random()*360});const f=()=>{switch(t){case"scientist":return{primary:"#3b82f6",secondary:"#06b6d4"};case"investor":return{primary:"#10b981",secondary:"#34d399"};case"mission-architect":return{primary:"#ef4444",secondary:"#f97316"};default:return{primary:"#8b5cf6",secondary:"#a855f7"}}},p=()=>{o.clearRect(0,0,l,c),d+=.02;const g=f(),m=e?60+Math.sin(d*4)*10:50,y=o.createRadialGradient(l/2,c/2,0,l/2,c/2,m);y.addColorStop(0,g.primary+"80"),y.addColorStop(1,g.secondary+"20"),o.fillStyle=y,o.beginPath(),o.arc(l/2,c/2,m,0,Math.PI*2),o.fill();for(let b=0;b<3;b++){const w=80+b*20,E=.5+b*.2,M=d*E;o.strokeStyle=g.primary+"40",o.lineWidth=2,o.beginPath(),o.arc(l/2,c/2,w,0,Math.PI*2),o.stroke();for(let A=0;A<6;A++){const P=M+A*Math.PI*2/6,C=l/2+Math.cos(P)*w,R=c/2+Math.sin(P)*w;o.fillStyle=g.secondary,o.beginPath(),o.arc(C,R,4,0,Math.PI*2),o.fill()}}if(h.forEach(b=>{b.x+=b.vx*(e?2:1),b.y+=b.vy*(e?2:1),(b.x<0||b.x>l)&&(b.vx*=-1),(b.y<0||b.y>c)&&(b.vy*=-1);const w=e?.8:.4;o.fillStyle=`hsla(${b.hue}, 70%, 60%, ${w})`,o.beginPath(),o.arc(b.x,b.y,b.size,0,Math.PI*2),o.fill()}),e)for(let b=0;b<3;b++){const w=100+b*30+Math.sin(d*3+b)*20;o.strokeStyle=g.primary+"30",o.lineWidth=3,o.beginPath(),o.arc(l/2,c/2,w,0,Math.PI*2),o.stroke()}u=requestAnimationFrame(p)};return p(),()=>{u&&cancelAnimationFrame(u)}},[t,e]);const r=()=>{switch(t){case"scientist":return ss;case"investor":return b1;case"mission-architect":return x1;default:return mu}},n=()=>{switch(t){case"scientist":return"Scientific Analysis Agent";case"investor":return"Investment Analysis Agent";case"mission-architect":return"Mission Planning Agent";default:return"AI Research Agent"}},s=r();return O.jsxs("div",{className:"relative",children:[O.jsx("canvas",{ref:i,width:300,height:300,className:"rounded-xl"}),O.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center",children:[O.jsx(Rt.div,{animate:e?{scale:[1,1.1,1],rotate:[0,5,-5,0]}:{scale:1,rotate:0},transition:{duration:e?2:.5,repeat:e?1/0:0},className:"mb-4",children:O.jsx(s,{className:"w-12 h-12 text-white drop-shadow-lg"})}),O.jsx("h3",{className:"text-white font-semibold text-lg text-center drop-shadow-lg",children:n()}),e&&O.jsxs(Rt.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"mt-2 flex items-center gap-2",children:[O.jsx(Rt.div,{animate:{rotate:360},transition:{duration:1,repeat:1/0,ease:"linear"},children:O.jsx(cse,{className:"w-4 h-4 text-white/80"})}),O.jsx("span",{className:"text-white/80 text-sm",children:"Analyzing research..."})]})]}),O.jsx("div",{className:"absolute -bottom-2 left-1/2 transform -translate-x-1/2",children:O.jsx("div",{className:"flex gap-2",children:["neural","quantum","cosmic"].map((a,o)=>O.jsx(Rt.div,{animate:e?{scale:[1,1.3,1],opacity:[.5,1,.5]}:{scale:1,opacity:.5},transition:{duration:1.5,repeat:e?1/0:0,delay:o*.2},className:"w-2 h-2 bg-white rounded-full"},a))})})]})}const mIe=Zne("inline-flex items-center justify-center rounded-md border px-2 py-0.5 text-xs font-medium w-fit whitespace-nowrap shrink-0 [&>svg]:size-3 gap-1 [&>svg]:pointer-events-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive transition-[color,box-shadow] overflow-hidden",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground [a&]:hover:bg-primary/90",secondary:"border-transparent bg-secondary text-secondary-foreground [a&]:hover:bg-secondary/90",destructive:"border-transparent bg-destructive text-white [a&]:hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",outline:"text-foreground [a&]:hover:bg-accent [a&]:hover:text-accent-foreground"}},defaultVariants:{variant:"default"}});function Ip({className:t,variant:e,asChild:i=!1,...r}){const n=i?$ne:"span";return O.jsx(n,{"data-slot":"badge",className:Ws(mIe({variant:e}),t),...r})}const gIe={},lU=gIe?.VITE_API_BASE_URL||"http://127.0.0.1:8000",Kae={streamAnalysis:async(t,e)=>{try{const i=`${lU}/api/chat/`;console.log("[API] Sending request to:",i),console.log("[API] Request payload:",t);const r=await fetch(i,{method:"POST",headers:{"Content-Type":"application/json",Accept:"text/event-stream"},body:JSON.stringify(t)});if(console.log("[API] Response status:",r.status),!r.ok){const l=await r.text();throw new Error(`HTTP error! status: ${r.status}, message: ${l}`)}if(!r.body)throw new Error("Response body is not readable");const n=r.body.getReader(),s=new TextDecoder("utf-8");let a="",o=0;for(console.log("[API] Starting stream processing...");;){const{done:l,value:c}=await n.read();if(l){console.log("[API] Stream completed. Total messages:",o);break}const u=s.decode(c,{stream:!0});a+=u;let h;for(;(h=a.indexOf(`

`))!==-1;){const d=a.slice(0,h);if(a=a.slice(h+2),d.trim().startsWith("data: ")){const f=d.replace("data: ","").trim();if(f)try{const p=JSON.parse(f);o++,(p.type==="title"||p.type==="paragraph"||p.type==="done")&&console.log(`[API] Event ${o}:`,p.type),e(p),await Promise.resolve()}catch(p){console.error("[API] Failed to parse SSE message:",f.slice(0,100),p)}}}}console.log("[API] Stream processing finished")}catch(i){console.error("[API] Stream analysis error:",i),e({type:"error",content:`Connection error: ${i instanceof Error?i.message:"Unknown error"}`}),e({type:"done",content:null})}},streamChat:async(t,e)=>{try{const i=`${lU}/api/chat/options/`;console.log("[API] Sending chat request to:",i),console.log("[API] Chat request payload:",t);const r=await fetch(i,{method:"POST",headers:{"Content-Type":"application/json",Accept:"text/event-stream"},body:JSON.stringify(t)});if(console.log("[API] Chat response status:",r.status),!r.ok){const l=await r.text();throw new Error(`HTTP error! status: ${r.status}, message: ${l}`)}if(!r.body)throw new Error("Response body is not readable");const n=r.body.getReader(),s=new TextDecoder("utf-8");let a="",o=0;for(console.log("[API] Starting chat stream processing...");;){const{done:l,value:c}=await n.read();if(l){console.log("[API] Chat stream completed. Total messages:",o);break}const u=s.decode(c,{stream:!0});a+=u;let h;for(;(h=a.indexOf(`

`))!==-1;){const d=a.slice(0,h);if(a=a.slice(h+2),d.trim().startsWith("data: ")){const f=d.replace("data: ","").trim();if(f)try{const p=JSON.parse(f);o++,(p.type==="text"||p.type==="done")&&console.log(`[API] Chat Event ${o}:`,p.type),e(p),await Promise.resolve()}catch(p){console.error("[API] Failed to parse chat SSE message:",f.slice(0,100),p)}}}}console.log("[API] Chat stream processing finished")}catch(i){console.error("[API] Stream chat error:",i),e({type:"error",content:`Connection error: ${i instanceof Error?i.message:"Unknown error"}`}),e({type:"done",content:null})}},analyzeQuery:async t=>{const e=`${lU}/api/analyze/`,i=await fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!i.ok){const r=await i.text();throw new Error(`HTTP error! status: ${i.status}, message: ${r}`)}return i.json()}};function vIe({theme:t,sourceDocuments:e=0}){const[i,r]=J.useState([]),[n,s]=J.useState(!0),[a,o]=J.useState(!1),[l,c]=J.useState(null);J.useEffect(()=>{(async()=>{try{const d=await fetch("/SB_publication_PMC.csv");if(!d.ok)throw new Error(`Failed to load documents: ${d.status}`);const g=(await d.text()).split(`
`).filter(m=>m.trim()).slice(1).map(m=>{const[y,b]=m.split(",").map(w=>w.trim().replace(/"/g,""));return{title:y,link:b}}).filter(m=>m.title&&m.link);r(g),c(null)}catch(d){console.error("Error loading reference documents:",d),c("Failed to load reference documents")}finally{s(!1)}})()},[]);const u=a?i:i.slice(0,5);return n?O.jsx(zn,{className:"bg-white/5 backdrop-blur-sm border-white/10",children:O.jsx(jn,{className:"p-6",children:O.jsxs("div",{className:"flex items-center gap-3",children:[O.jsx(oA,{className:"w-5 h-5 text-blue-400 animate-pulse"}),O.jsx("p",{className:"text-gray-400",children:"Loading reference documents..."})]})})}):l?O.jsx(zn,{className:"bg-white/5 backdrop-blur-sm border-white/10",children:O.jsx(jn,{className:"p-6",children:O.jsxs("div",{className:"flex items-center gap-3",children:[O.jsx(oA,{className:"w-5 h-5 text-red-400"}),O.jsx("p",{className:"text-red-400",children:l})]})})}):O.jsxs(zn,{className:"bg-white/5 backdrop-blur-sm border-white/10",children:[O.jsx(Yd,{className:`bg-gradient-to-r ${t.primary} bg-opacity-20`,children:O.jsxs(Kd,{className:"text-white flex items-center gap-2",children:[O.jsx(oA,{className:"w-5 h-5"}),"Reference Documents",O.jsxs(Ip,{className:"bg-white/20 text-white ml-2",children:[i.length," papers"]})]})}),O.jsx(jn,{className:"p-0",children:O.jsxs("div",{className:"p-4",children:[O.jsx("p",{className:"text-gray-300 text-sm mb-4",children:"Based on the analysis above, here are the relevant research papers and documents that informed the findings:"}),O.jsx("div",{className:"space-y-3",children:u.map((h,d)=>O.jsx(Rt.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:d*.1},className:"bg-white/5 rounded-lg p-3 hover:bg-white/10 transition-colors duration-200",children:O.jsxs("div",{className:"flex items-start gap-3",children:[O.jsx(YA,{className:"w-4 h-4 text-blue-400 mt-1 flex-shrink-0"}),O.jsxs("div",{className:"flex-1 min-w-0",children:[O.jsx("h4",{className:"text-white text-sm font-medium mb-1 overflow-hidden",style:{display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical"},children:h.title}),O.jsxs("div",{className:"flex items-center gap-2",children:[O.jsx(dse,{className:"w-3 h-3 text-gray-400"}),O.jsx("span",{className:"text-xs text-gray-400 truncate",children:(()=>{try{return new URL(h.link).hostname}catch{return"External Link"}})()})]})]}),O.jsx(jr,{size:"sm",variant:"ghost",className:"text-blue-400 hover:text-blue-300 hover:bg-blue-500/20 p-2 h-auto",onClick:()=>{try{window.open(h.link,"_blank","noopener,noreferrer")}catch(f){console.error("Error opening link:",f)}},children:O.jsx(a6,{className:"w-4 h-4"})})]})},d))}),i.length>5&&O.jsx("div",{className:"mt-4 pt-4 border-t border-white/10",children:O.jsx(jr,{variant:"ghost",onClick:()=>o(!a),className:"w-full text-gray-400 hover:text-white hover:bg-white/10",children:a?O.jsxs(O.Fragment,{children:[O.jsx(s6,{className:"w-4 h-4 mr-2"}),"Show Less"]}):O.jsxs(O.Fragment,{children:[O.jsx(rT,{className:"w-4 h-4 mr-2"}),"Show All ",i.length," Documents"]})})}),O.jsx("div",{className:"mt-4 text-xs text-gray-500 text-center",children:" Click the external link icon to visit the full research paper"})]})})]})}function cU({children:t,delay:e=0}){const i=J.useRef(null),r=owe(i,{once:!1,margin:"-100px"});return O.jsx(Rt.div,{ref:i,initial:{opacity:0,y:50,scale:.95},animate:r?{opacity:1,y:0,scale:1}:{opacity:0,y:50,scale:.95},exit:{opacity:0,y:-50,scale:.95},transition:{duration:.6,delay:e},children:t})}function yIe({response:t,theme:e}){const[i,r]=J.useState({}),[n,s]=J.useState({}),[a,o]=J.useState(!0),[l,c]=J.useState(!0),[u,h]=J.useState([]),[d,f]=J.useState(""),[p,g]=J.useState(!1),[m,y]=J.useState(null),b=J.useRef(null);J.useEffect(()=>{(async()=>{try{const C=await fetch("/images.json");if(!C.ok)throw new Error(`Failed to load images.json: ${C.status}`);const R=await C.json();r(R)}catch(C){console.error("Error loading images.json:",C)}finally{o(!1)}})()},[]),J.useEffect(()=>{(async()=>{if(!t?.metadata?.total_tables||t.metadata.total_tables.length===0){c(!1);return}const C={};for(const R of t.metadata.total_tables)try{const I=await fetch(`/tables_data/${R}.html`);if(I.ok){const k=await I.text();C[R]=k}}catch(I){console.error(`Error loading table ${R}:`,I)}s(C),c(!1)})()},[t?.metadata?.total_tables]),J.useEffect(()=>{b.current?.scrollIntoView({behavior:"smooth"})},[u]);const w=async()=>{if(!d.trim()||p)return;const P={role:"user",content:d,timestamp:Date.now()};h(R=>[...R,P]);const C=d;f(""),g(!0);try{const R=t.paragraphs.map(z=>`${z.title}: ${z.text}`).join(`

`);let I="";const k={role:"assistant",content:"",timestamp:Date.now()};h(z=>[...z,k]),await Kae.streamChat({question:C,context:R,userType:t.userType||"scientist"},z=>{z.type==="text"&&z.content?(I+=z.content,h(V=>V.map((F,$)=>$===V.length-1?{...F,content:I.trim()}:F))):z.type==="error"?h(V=>V.map((F,$)=>$===V.length-1?{...F,content:`Sorry, I encountered an error: ${z.content}`}:F)):z.type==="done"&&g(!1)})}catch(R){console.error("Chat API error:",R);const I={role:"assistant",content:"Sorry, I couldn't process your question. Please try again.",timestamp:Date.now()};h(k=>[...k,I]),g(!1)}};if(!t||!t.paragraphs||t.paragraphs.length===0)return O.jsx(zn,{className:"bg-white/5 backdrop-blur-sm border-white/10",children:O.jsx(jn,{className:"p-6",children:O.jsx("p",{className:"text-gray-400 text-center",children:"No response data available"})})});const E=P=>{switch(P){case"scientist":return O.jsx(ss,{className:"w-5 h-5"});case"investor":return O.jsx(b1,{className:"w-5 h-5"});case"mission-architect":return O.jsx(x1,{className:"w-5 h-5"});default:return O.jsx(ss,{className:"w-5 h-5"})}},M=P=>{switch(P){case"scientist":return"Scientific Analysis";case"investor":return"Investment Analysis";case"mission-architect":return"Mission Architecture";default:return"Analysis"}},A=t?.metadata?.query||"";return O.jsxs("div",{className:"space-y-6",children:[A&&O.jsx(zn,{className:"bg-gradient-to-r from-purple-500/20 to-blue-500/20 backdrop-blur-sm border-white/20",children:O.jsx(jn,{className:"p-4",children:O.jsxs("div",{className:"flex items-start gap-3",children:[O.jsx(ZA,{className:"w-5 h-5 text-yellow-400 mt-1 flex-shrink-0"}),O.jsx("div",{className:"flex-1",children:O.jsx("p",{className:"text-white font-medium text-lg",children:A})})]})})}),t.overallTitle&&O.jsx(cU,{children:O.jsx(zn,{className:`bg-gradient-to-r ${e.primary} backdrop-blur-sm border-white/20`,children:O.jsx(jn,{className:"p-6",children:O.jsxs("div",{className:"flex items-center gap-3",children:[E(t.userType),O.jsx("h2",{className:"text-2xl font-bold text-white flex-1",children:t.overallTitle}),O.jsx(Ip,{className:"bg-white/20 text-white",children:M(t.userType)})]})})})}),t.paragraphs.map((P,C)=>O.jsxs("div",{className:"flex gap-6 items-start mb-6",children:[O.jsxs("div",{className:"flex-1",children:[O.jsx("h3",{className:"font-semibold text-white mb-2",children:P.title}),O.jsx("p",{className:"text-gray-300 mb-2",children:P.text}),P.tables&&P.tables.length>0&&O.jsx("div",{className:"space-y-2",children:P.tables.map((R,I)=>O.jsxs("div",{className:"bg-green-50 rounded-lg p-2 mb-2",children:[O.jsx("span",{className:"font-semibold text-green-900",children:" Table:"}),O.jsx("div",{dangerouslySetInnerHTML:{__html:n[R]||'<span class="text-gray-400">Table not found</span>'}})]},I))})]}),O.jsx("div",{className:"flex flex-col gap-3 items-end min-w-[400px] max-w-[600px]",children:P.images&&P.images.length>0&&P.images.map((R,I)=>O.jsx("img",{src:i[R],alt:`Image ${R}`,className:"rounded-lg shadow-lg object-contain cursor-pointer hover:shadow-xl transition-all duration-300 hover:scale-105",style:{width:"auto",height:"200px",maxWidth:"100%"},onClick:()=>y(i[R])},I))})]},C)),O.jsx(cU,{delay:.2,children:O.jsx(vIe,{theme:e,sourceDocuments:t.metadata?.source_documents||0})}),O.jsx(cU,{delay:.3,children:O.jsxs(zn,{className:"bg-white/5 backdrop-blur-sm border-white/10",children:[O.jsx(Yd,{className:`bg-gradient-to-r ${e.primary} bg-opacity-20`,children:O.jsxs(Kd,{className:"text-white flex items-center gap-2",children:[O.jsx(YC,{className:"w-5 h-5"}),"Doubt Bot - Ask Questions About This Analysis"]})}),O.jsxs(jn,{className:"p-0",children:[O.jsxs("div",{className:"max-h-96 overflow-y-auto p-4 space-y-4",children:[u.length===0?O.jsxs("div",{className:"text-center py-8 text-gray-400",children:[O.jsx(YC,{className:"w-12 h-12 mx-auto mb-3 opacity-50"}),O.jsx("p",{children:"Ask me anything about the analysis above"}),O.jsx("p",{className:"text-sm mt-2",children:"I can help clarify findings, explain methodologies, or discuss implications"}),O.jsxs("div",{className:"mt-4 text-xs text-gray-500",children:[O.jsx("p",{children:" Try asking:"}),O.jsx("p",{children:'"What does this data mean?"  "Can you explain this concept?"  "What are the implications?"'})]})]}):u.map((P,C)=>O.jsxs(Rt.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:C*.1},className:`flex gap-3 ${P.role==="user"?"justify-end":"justify-start"}`,children:[P.role==="assistant"&&O.jsx("div",{className:`p-2 bg-gradient-to-r ${e.primary} rounded-full h-8 w-8 flex items-center justify-center flex-shrink-0`,children:O.jsx(YC,{className:"w-4 h-4 text-white"})}),O.jsx("div",{className:`max-w-[70%] p-3 rounded-lg ${P.role==="user"?"bg-blue-500/20 text-white":"bg-white/10 text-gray-300"}`,children:O.jsx("p",{className:"text-sm leading-relaxed",children:P.content})}),P.role==="user"&&O.jsx("div",{className:"p-2 bg-blue-500/20 rounded-full h-8 w-8 flex items-center justify-center flex-shrink-0",children:O.jsx(a_e,{className:"w-4 h-4 text-white"})})]},C)),p&&O.jsxs(Rt.div,{initial:{opacity:0},animate:{opacity:1},className:"flex gap-3",children:[O.jsx("div",{className:`p-2 bg-gradient-to-r ${e.primary} rounded-full h-8 w-8 flex items-center justify-center`,children:O.jsx(YC,{className:"w-4 h-4 text-white"})}),O.jsx("div",{className:"bg-white/10 p-3 rounded-lg",children:O.jsxs("div",{className:"flex gap-1",children:[O.jsx(Rt.div,{className:"w-2 h-2 bg-gray-400 rounded-full",animate:{scale:[1,1.5,1]},transition:{duration:.6,repeat:1/0,delay:0}}),O.jsx(Rt.div,{className:"w-2 h-2 bg-gray-400 rounded-full",animate:{scale:[1,1.5,1]},transition:{duration:.6,repeat:1/0,delay:.2}}),O.jsx(Rt.div,{className:"w-2 h-2 bg-gray-400 rounded-full",animate:{scale:[1,1.5,1]},transition:{duration:.6,repeat:1/0,delay:.4}})]})})]}),O.jsx("div",{ref:b})]}),O.jsxs("div",{className:"p-4 border-t border-white/10",children:[O.jsxs("div",{className:"flex gap-2",children:[O.jsx(Xse,{value:d,onChange:P=>f(P.target.value),onKeyDown:P=>{P.key==="Enter"&&!P.shiftKey&&(P.preventDefault(),w())},placeholder:"Ask a question about this analysis... (e.g., 'What does this mean?', 'Can you explain this further?')",className:"min-h-[60px] bg-white/5 border-white/20 text-white placeholder:text-gray-400 resize-none flex-1"}),O.jsx(jr,{onClick:w,disabled:!d.trim()||p,className:`bg-gradient-to-r ${e.primary} hover:opacity-90 self-end`,children:p?O.jsx(sz,{className:"w-4 h-4 animate-spin"}):O.jsx(mse,{className:"w-4 h-4"})})]}),O.jsx("p",{className:"text-xs text-gray-500 mt-2",children:"Press Enter to send, Shift+Enter for new line"})]})]})]})}),m&&O.jsx(Rt.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 z-50 flex items-center justify-center bg-black/80 backdrop-blur-sm",onClick:()=>y(null),children:O.jsxs(Rt.div,{initial:{scale:.8,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.8,opacity:0},className:"relative max-w-[90vw] max-h-[90vh] bg-white rounded-lg shadow-2xl",onClick:P=>P.stopPropagation(),children:[O.jsx("button",{onClick:()=>y(null),className:"absolute -top-3 -right-3 z-10 bg-red-500 hover:bg-red-600 text-white rounded-full p-2 shadow-lg transition-colors duration-200",children:O.jsx(gse,{className:"w-5 h-5"})}),O.jsx("img",{src:m,alt:"Full size image",className:"max-w-full max-h-full object-contain rounded-lg"})]})})]})}function n$({userType:t,theme:e,initialResponse:i}){const[r,n]=J.useState(""),[s,a]=J.useState(!1),[o,l]=J.useState(null),[c,u]=J.useState(""),[h,d]=J.useState([]),[f,p]=J.useState(!1),[g,m]=J.useState(new Set),[y,b]=J.useState(null),[w,E]=J.useState(""),[M,A]=J.useState(5),[P,C]=J.useState(!1),R=J.useRef(null),I=J.useRef(null),[k,z]=J.useState(null),[V,F]=J.useState(!1),$=J.useRef([]),K=J.useRef(null),X=J.useRef(""),U=J.useRef([]),Y={scientist:{title:"Scientific Analysis",description:"Tools we Provide you",icon:ss,color:"blue",prompts:["Search for the reseach papers based on topics","Advanced discussion on NASA's research","Explain the statistical significance of these results","How does this research contribute to the field?"]},investor:{title:"Investment Analysis",description:"Identify commercial opportunities and market potential",icon:b1,color:"green",prompts:["What are the commercial applications of this research?","Analyze the market potential and investment opportunities","What are the economic implications of these findings?","Identify potential licensing and partnership opportunities"]},"mission-architect":{title:"Mission Planning",description:"Evaluate safety, efficiency, and feasibility for space missions",icon:x1,color:"red",prompts:["How can this research improve mission safety?","What are the engineering challenges and solutions?","Analyze the feasibility for Moon/Mars missions","What mission parameters need consideration?"]}},{createHistory:Z}=qse();J.useEffect(()=>{i&&(l(i),C(!1))},[i]),J.useEffect(()=>{if(y===null||!s)return;const he=h[y];if(!he)return;const ve=he.preview||he.output||(he.details?JSON.stringify(he.details,null,2):"");if(!ve||w.length>=ve.length){setTimeout(()=>{m(new Set),E("");let Se=y+1;for(;Se<h.length;){const Ce=h[Se];if(Ce.preview||Ce.output||Ce.details){b(Se),m(new Set([Se]));return}Se++}b(null)},300);return}const xe=setTimeout(()=>{const Se=Math.min(w.length+M,ve.length);E(ve.slice(0,Se))},50);return()=>clearTimeout(xe)},[w,y,h,M,s]),J.useEffect(()=>{if(h.length>0&&y===null&&s){const he=h.findIndex(ve=>ve.preview||ve.output||ve.details);he!==-1&&(b(he),m(new Set([he])))}},[h,y,s]);const j=async(he=null)=>{const ve=he||r;if(!ve.trim()){la.error("Please enter a query or upload a file");return}a(!0),C(!0),l(null),u(""),d([]),m(new Set),p(!1),b(null),E(""),$.current=[],K.current=null,X.current="";try{let xe=ve;if(V&&k)try{const Se=await fIe(k,ve);console.log("Parsed image text:",Se);const Ce=typeof Se=="string"?Se:Se?.toString?Se.toString():"";Ce&&Ce.trim()&&(xe=`${ve}

Image Analysis:
${Ce}`)}catch(Se){console.error("Image parsing failed:",Se),la.error("Failed to parse image. Proceeding with text only.")}await Kae.streamAnalysis({query:xe,userType:t},Se=>{if(Se.type==="thinking_step"){const Ce={...Se.content,timestamp:Date.now()};d(ce=>[...ce,Ce])}else if(Se.type==="document")U.current=[...U.current,Se.content],d(Ce=>[...Ce,{step:"Retrieved Document",message:`Retrieved document: ${Se.content.title||Se.content.name||"Document"}`,details:Se.content,timestamp:Date.now()}]),console.log("[MainContent] Retrieved document:",Se.content);else if(Se.type==="title")X.current=Se.content,u(Se.content);else if(Se.type==="paragraph"){let Ce;typeof Se.content=="string"?Ce={title:"",text:Se.content,images:[],tables:[]}:Se.content&&typeof Se.content=="object"?Ce={title:Se.content.title||"",text:Se.content.text||(typeof Se.content=="string"?Se.content:JSON.stringify(Se.content)),images:Se.content.images||[],tables:Se.content.tables||[]}:Ce={title:"",text:JSON.stringify(Se.content),images:[],tables:[]},$.current.push(Ce),l({paragraphs:[...$.current],metadata:K.current||{total_paragraphs:$.current.length,total_images:[],total_tables:[],source_documents:0,user_type:t},userType:t,overallTitle:X.current||"Analysis Results"})}else if(Se.type==="metadata"){const Ce={...Se.content,retrievedDocuments:U.current||[]};K.current=Ce,l(ce=>ce?{...ce,metadata:Ce}:{paragraphs:[...$.current],metadata:Se.content,userType:t,overallTitle:X.current||"Analysis Results"})}else if(Se.type==="error")console.error("Analysis error:",Se.content),la.error(`Error: ${Se.content}`);else if(Se.type==="done"){l({paragraphs:[...$.current],metadata:K.current||{total_paragraphs:$.current.length,total_images:[],total_tables:[],source_documents:0,user_type:t},userType:t,overallTitle:X.current||"Analysis Results"});try{const Ce=$.current.map(ce=>ce.text).filter(Boolean).join(`

`);Ce&&ve&&(Z(ve,Ce),console.log("Chat history stored"))}catch(Ce){console.error("Failed to persist chat history:",Ce)}p(!0),setTimeout(()=>{a(!1),C(!1),z(null),F(!1),I.current&&(I.current.value="")},1e3)}})}catch(xe){console.error("Analysis error:",xe),la.error("Failed to analyze content. Please try again."),a(!1),C(!1)}},ee=he=>{const ve=he.target.files[0];ve&&(n(`Analyze the uploaded file: ${ve.name}`),la.success(`File "${ve.name}" uploaded successfully`))},pe=async he=>{const ve=he.target.files?.[0];if(ve){if(!ve.type||!ve.type.startsWith("image/")){la.error("Not an image. Please upload an image file."),I.current&&(I.current.value=""),z(null),F(!1);return}z(ve),F(!0),la.success(`Image "${ve.name}" selected`)}},fe=he=>{const ve=new Set(g);ve.has(he)?ve.delete(he):ve.add(he),m(ve)},se=he=>he.includes("retrieval")||he.includes("document")?Mh:he.includes("search")||he.includes("tool")?Pd:he.includes("agent")?ss:Ok,re=Y[t],le=re.icon;return O.jsxs("div",{className:"h-full flex flex-col relative overflow-hidden",children:[O.jsx(Rt.div,{className:"p-6 border-b border-white/10",animate:{y:P?-100:0,opacity:P?0:1,height:P?0:"auto"},transition:{duration:.5},children:O.jsxs(Rt.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},className:"flex items-center justify-between",children:[O.jsxs("div",{children:[O.jsx("h1",{className:"text-3xl font-bold text-white mb-2",children:"NASA Research AI Agent"}),O.jsx("p",{className:"text-gray-300",children:"Analyze research papers, generate insights, and explore space science"})]}),O.jsx(Rt.div,{whileHover:{scale:1.05},className:`p-4 bg-gradient-to-r ${e.primary} rounded-xl`,children:O.jsx(mu,{className:"w-8 h-8 text-white"})})]})}),O.jsx("div",{className:"flex-1 flex overflow-hidden",children:O.jsx("div",{className:"flex-1 flex flex-col",children:O.jsx("div",{className:"flex-1 p-6 overflow-auto",children:O.jsxs("div",{className:"max-w-4xl mx-auto space-y-6",children:[O.jsx(ql,{children:P&&O.jsx(Rt.div,{initial:{opacity:0,y:50},animate:{opacity:1,y:0},exit:{opacity:0,y:-50},transition:{duration:.5},children:O.jsx(zn,{className:"bg-gradient-to-r from-purple-500/20 to-blue-500/20 backdrop-blur-sm border-white/20",children:O.jsx(jn,{className:"p-4",children:O.jsxs("div",{className:"flex items-start gap-3",children:[O.jsx(ZA,{className:"w-5 h-5 text-yellow-400 mt-1 flex-shrink-0"}),O.jsx("div",{className:"flex-1",children:O.jsx("p",{className:"text-white font-medium text-lg",children:r})})]})})})})}),!P&&O.jsx("div",{className:"flex justify-center mb-6",children:O.jsx(pIe,{userType:t,isThinking:!1})}),O.jsx(ql,{children:s&&h.length>0&&O.jsx(Rt.div,{initial:{opacity:0,scale:.95,y:20},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.95,y:-20,transition:{duration:.5}},transition:{duration:.5},children:O.jsxs(zn,{className:"bg-gradient-to-br from-blue-500/10 to-purple-500/10 backdrop-blur-sm border-blue-400/30 shadow-xl",children:[O.jsx(Yd,{children:O.jsxs(Kd,{className:"text-white flex items-center gap-2",children:[O.jsx(Rt.div,{animate:{rotate:360},transition:{duration:2,repeat:1/0,ease:"linear"},children:O.jsx(ss,{className:"w-5 h-5 text-blue-400"})}),"Agent Reasoning Process",O.jsxs(Rt.div,{className:"ml-auto flex gap-1",animate:{opacity:[.5,1,.5]},transition:{duration:1.5,repeat:1/0},children:[O.jsx("div",{className:"w-2 h-2 bg-blue-400 rounded-full"}),O.jsx("div",{className:"w-2 h-2 bg-purple-400 rounded-full"}),O.jsx("div",{className:"w-2 h-2 bg-pink-400 rounded-full"})]})]})}),O.jsx(jn,{className:"p-4 max-h-[600px] overflow-y-auto space-y-2",children:h.map((he,ve)=>{const xe=se(he.step),Se=g.has(ve),Ce=ve===y,ce=he.preview||he.output||he.details;return O.jsxs(Rt.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:ve*.02},className:"bg-white/5 rounded-lg border border-white/10 overflow-hidden",children:[O.jsxs("button",{onClick:()=>!Ce&&ce&&fe(ve),disabled:Ce,className:`w-full p-3 flex items-center gap-3 text-left transition-colors ${!Ce&&ce?"hover:bg-white/5 cursor-pointer":"cursor-default"}`,children:[O.jsx(Rt.div,{animate:{rotate:Se?180:0},transition:{duration:.3},children:O.jsx(rT,{className:`w-4 h-4 flex-shrink-0 ${ce?"text-blue-400":"text-gray-600"}`})}),O.jsx(xe,{className:"w-4 h-4 text-purple-400 flex-shrink-0"}),O.jsx("span",{className:"text-gray-300 flex-1 text-sm",children:he.message}),Ce&&O.jsx(sz,{className:"w-4 h-4 animate-spin text-blue-400 flex-shrink-0"})]}),O.jsx(ql,{children:Se&&ce&&O.jsx(Rt.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},transition:{duration:.3},className:"overflow-hidden",children:O.jsx("div",{className:"p-3 pt-0 space-y-3",children:Ce?O.jsxs("div",{className:"bg-white/5 rounded-lg p-3",children:[O.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[O.jsx(Ok,{className:"w-3 h-3 text-green-400"}),O.jsx("span",{className:"text-xs text-gray-400 font-semibold",children:he.preview?"Content Preview":he.output?"Retrieved Output":"Details"})]}),O.jsxs("pre",{className:"text-xs text-gray-300 whitespace-pre-wrap font-mono overflow-x-auto",children:[w,O.jsx(Rt.span,{animate:{opacity:[1,0]},transition:{duration:.5,repeat:1/0},className:"inline-block w-1 h-3 bg-blue-400 ml-1"})]})]}):O.jsxs(O.Fragment,{children:[he.details&&O.jsxs("div",{className:"bg-white/5 rounded-lg p-3",children:[O.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[O.jsx(Ok,{className:"w-3 h-3 text-green-400"}),O.jsx("span",{className:"text-xs text-gray-400 font-semibold",children:"Details"})]}),O.jsx("pre",{className:"text-xs text-gray-300 whitespace-pre-wrap font-mono overflow-x-auto",children:JSON.stringify(he.details,null,2)})]}),he.preview&&O.jsxs("div",{className:"bg-white/5 rounded-lg p-3",children:[O.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[O.jsx(YA,{className:"w-3 h-3 text-blue-400"}),O.jsx("span",{className:"text-xs text-gray-400 font-semibold",children:"Content Preview"})]}),O.jsx("div",{className:"text-sm text-gray-300 max-h-48 overflow-y-auto",children:O.jsx("p",{className:"font-mono text-xs whitespace-pre-wrap leading-relaxed",children:he.preview})})]}),he.output&&O.jsxs("div",{className:"bg-white/5 rounded-lg p-3",children:[O.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[O.jsx(Mh,{className:"w-3 h-3 text-yellow-400"}),O.jsx("span",{className:"text-xs text-gray-400 font-semibold",children:"Retrieved Output"})]}),O.jsx("div",{className:"text-sm text-gray-300 max-h-64 overflow-y-auto",children:O.jsx("p",{className:"font-mono text-xs whitespace-pre-wrap leading-relaxed",children:he.output})})]})]})})})})]},ve)})})]})})}),O.jsx(ql,{children:f&&O.jsx(Rt.div,{initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},exit:{opacity:0,scale:1.2},transition:{duration:.8},className:"flex justify-center",children:O.jsx(Rt.div,{className:`p-6 bg-gradient-to-r ${e.primary} rounded-full`,animate:{scale:[1,1.2,1],rotate:[0,180,360]},transition:{duration:1},children:O.jsx(f1e,{className:"w-12 h-12 text-white"})})})}),!o&&!P&&O.jsxs(Rt.div,{initial:{opacity:1},animate:{opacity:1},children:[O.jsxs(zn,{className:"bg-white/5 backdrop-blur-sm border-white/10",children:[O.jsx(Yd,{children:O.jsxs(Kd,{className:"text-white flex items-center gap-2",children:[O.jsx(le,{className:"w-5 h-5"}),"Custom Analyst: ",re.title]})}),O.jsxs(jn,{children:[O.jsx("p",{className:"text-gray-300 mb-4",children:re.description}),O.jsx("div",{className:"grid grid-cols-2 gap-2",children:re.prompts.map((he,ve)=>O.jsx(Rt.button,{whileHover:{scale:1.02},whileTap:{scale:.98},onClick:()=>j(he),className:"p-3 text-left bg-white/5 hover:bg-white/10 rounded-lg border border-white/10 text-gray-300 hover:text-white transition-all text-sm",children:he},ve))})]})]}),O.jsx(zn,{className:"bg-white/5 backdrop-blur-sm border-white/10 mt-6",children:O.jsx(jn,{className:"p-6",children:O.jsxs("div",{className:"space-y-4",children:[O.jsx(Xse,{value:r,onChange:he=>n(he.target.value),placeholder:"Ask me anything about NASA research, space science, or upload a research paper...",className:"min-h-32 bg-white/5 border-white/20 text-white placeholder:text-gray-400 resize-none"}),O.jsxs("div",{className:"flex items-center justify-between",children:[O.jsxs("div",{className:"flex gap-2",children:[O.jsxs(jr,{variant:"outline",size:"sm",onClick:()=>R.current?.click(),className:"border-white/20 text-gray-300 hover:text-white hover:bg-white/10",children:[O.jsx(o6,{className:"w-4 h-4 mr-2"}),"Upload"]}),O.jsxs(jr,{variant:"outline",size:"sm",onClick:()=>I.current?.click(),className:"border-white/20 text-gray-300 hover:text-white hover:bg-white/10",children:[O.jsx(O1e,{className:"w-4 h-4 mr-2"}),"Image"]}),O.jsxs(jr,{variant:"outline",size:"sm",className:"border-white/20 text-gray-300 hover:text-white hover:bg-white/10",children:[O.jsx(W1e,{className:"w-4 h-4 mr-2"}),"Audio"]})]}),O.jsxs(jr,{onClick:()=>j(),disabled:s,className:`bg-gradient-to-r ${e.primary} hover:opacity-90 px-6`,children:[s?O.jsx(sz,{className:"w-4 h-4 mr-2 animate-spin"}):O.jsx(mse,{className:"w-4 h-4 mr-2"}),s?"Analyzing...":"Analyze"]})]})]})})})]}),O.jsx(ql,{children:o&&o.paragraphs&&o.paragraphs.length>0&&O.jsx(Rt.div,{initial:{opacity:0,y:50},animate:{opacity:1,y:0},exit:{opacity:0,y:-50},transition:{duration:.6,delay:.3},children:O.jsx(yIe,{response:o,theme:e})})})]})})})}),O.jsx("input",{ref:R,type:"file",accept:".pdf,.doc,.docx,.txt,.jpg,.png",onChange:ee,className:"hidden"}),O.jsx("input",{ref:I,type:"file",accept:"image/*",onChange:pe,className:"hidden"})]})}function xIe({theme:t}){const e=[{id:1,title:"Input Your Content",description:"Upload research papers, images, or provide text/audio input about any NASA research topic",icon:o6,details:["Support for multiple file formats (PDF, DOC, images)","Text input for research questions","Audio input for spoken queries","Direct NASA database integration"],color:"from-blue-500 to-cyan-500"},{id:2,title:"AI Analysis Engine",description:"Our advanced AI processes your content using specialized models trained on NASA research",icon:ss,details:["Natural language processing for research papers","Computer vision for scientific imagery","Speech recognition for audio queries","Context-aware understanding"],color:"from-purple-500 to-pink-500"},{id:3,title:"Custom Analyst Selection",description:"Choose your perspective: Scientist, Manager/Investor, or Mission Architect",icon:w1,details:["Scientist: Focus on methodology and hypothesis generation","Manager/Investor: Commercial applications and opportunities","Mission Architect: Safety, efficiency, and feasibility","Tailored explanations for each perspective"],color:"from-green-500 to-emerald-500"},{id:4,title:"Intelligent Processing",description:"Advanced algorithms analyze patterns, extract insights, and generate comprehensive responses",icon:ZA,details:["Multi-modal data fusion","Statistical analysis and validation","Cross-reference with NASA databases","Real-time processing capabilities"],color:"from-yellow-500 to-orange-500"},{id:5,title:"Rich Response Generation",description:"Get detailed analysis with text, visualizations, tables, and actionable insights",icon:SI,details:["Comprehensive text analysis","Interactive charts and graphs","Data tables with key metrics","Visual representations of findings"],color:"from-red-500 to-pink-500"},{id:6,title:"Interactive Chat & Resources",description:"Ask follow-up questions and access relevant NASA resources for deeper understanding",icon:H1e,details:["Real-time chat with AI assistant","Access to NASA Open Science Data Repository","Links to related research papers","Contextual resource recommendations"],color:"from-indigo-500 to-purple-500"}],i=[{title:"Multi-Modal Input",description:"Process text, images, audio, and documents",icon:YA},{title:"NASA Database Integration",description:"Direct access to official NASA research repositories",icon:Mh},{title:"Real-Time Analysis",description:"Instant processing and response generation",icon:ZA},{title:"Specialized Perspectives",description:"Tailored analysis for different professional needs",icon:J3},{title:"Interactive Exploration",description:"Chat-based interface for deeper understanding",icon:Pd},{title:"Rich Visualizations",description:"Charts, graphs, and data tables for clarity",icon:SI}];return O.jsx("div",{className:"min-h-screen p-6",children:O.jsxs("div",{className:"max-w-6xl mx-auto space-y-8",children:[O.jsxs(Rt.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},className:"text-center space-y-4",children:[O.jsx("h1",{className:"text-4xl font-bold text-white mb-4",children:"How AstroNots Works"}),O.jsx("p",{className:"text-xl text-gray-300 max-w-3xl mx-auto",children:"Our AI-powered platform transforms complex NASA research into actionable insights tailored for scientists, investors, and mission architects"})]}),O.jsx("div",{className:"space-y-8",children:e.map((r,n)=>{const s=r.icon;return O.jsxs(Rt.div,{initial:{opacity:0,x:n%2===0?-50:50},animate:{opacity:1,x:0},transition:{duration:.6,delay:n*.1},children:[O.jsx(zn,{className:"bg-white/5 backdrop-blur-sm border-white/10 overflow-hidden",children:O.jsx(jn,{className:"p-8",children:O.jsxs("div",{className:`grid md:grid-cols-2 gap-8 items-center ${n%2===1?"md:grid-flow-col-dense":""}`,children:[O.jsxs("div",{className:n%2===1?"md:col-start-2":"",children:[O.jsxs("div",{className:"flex items-center gap-4 mb-6",children:[O.jsx("div",{className:`w-16 h-16 bg-gradient-to-r ${r.color} rounded-full flex items-center justify-center`,children:O.jsx(s,{className:"w-8 h-8 text-white"})}),O.jsxs("div",{children:[O.jsxs(Ip,{className:"mb-2 bg-white/10 text-white border-white/20",children:["Step ",r.id]}),O.jsx("h3",{className:"text-2xl font-bold text-white",children:r.title})]})]}),O.jsx("p",{className:"text-gray-300 text-lg mb-6",children:r.description}),O.jsx("ul",{className:"space-y-3",children:r.details.map((a,o)=>O.jsxs(Rt.li,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:n*.1+o*.05},className:"flex items-center gap-3 text-gray-300",children:[O.jsx("div",{className:"w-2 h-2 bg-white rounded-full flex-shrink-0"}),a]},o))})]}),O.jsx("div",{className:`${n%2===1?"md:col-start-1":""} flex justify-center`,children:O.jsx(Rt.div,{animate:{rotate:[0,5,-5,0],scale:[1,1.05,1]},transition:{duration:4,repeat:1/0,delay:n*.5},className:`w-64 h-64 bg-gradient-to-br ${r.color} rounded-2xl flex items-center justify-center opacity-20 border border-white/10`,children:O.jsx(s,{className:"w-24 h-24 text-white"})})})]})})}),n<e.length-1&&O.jsx(Rt.div,{initial:{opacity:0,scale:0},animate:{opacity:1,scale:1},transition:{delay:(n+1)*.1},className:"flex justify-center my-8",children:O.jsx("div",{className:`w-12 h-12 bg-gradient-to-r ${t.primary} rounded-full flex items-center justify-center`,children:O.jsx(Jwe,{className:"w-6 h-6 text-white"})})})]},r.id)})}),O.jsx(Rt.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.8},className:"mt-16",children:O.jsxs(zn,{className:"bg-white/5 backdrop-blur-sm border-white/10",children:[O.jsx(Yd,{children:O.jsxs(Kd,{className:"text-white text-2xl text-center flex items-center justify-center gap-2",children:[O.jsx(mu,{className:"w-6 h-6"}),"Key Features"]})}),O.jsx(jn,{children:O.jsx("div",{className:"grid md:grid-cols-3 gap-6",children:i.map((r,n)=>{const s=r.icon;return O.jsxs(Rt.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.9+n*.1},whileHover:{scale:1.05},className:"p-6 bg-white/5 rounded-lg border border-white/10 text-center hover:bg-white/10 transition-all",children:[O.jsx("div",{className:`w-12 h-12 bg-gradient-to-r ${t.primary} rounded-full flex items-center justify-center mx-auto mb-4`,children:O.jsx(s,{className:"w-6 h-6 text-white"})}),O.jsx("h4",{className:"text-white font-semibold mb-2",children:r.title}),O.jsx("p",{className:"text-gray-300 text-sm",children:r.description})]},n)})})})]})}),O.jsx(Rt.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:1.2},children:O.jsxs(zn,{className:"bg-white/5 backdrop-blur-sm border-white/10",children:[O.jsx(Yd,{children:O.jsx(Kd,{className:"text-white text-2xl text-center",children:"Powered by NASA Resources"})}),O.jsx(jn,{children:O.jsxs("div",{className:"grid md:grid-cols-3 gap-6",children:[O.jsxs("div",{className:"p-6 bg-white/5 rounded-lg border border-white/10 text-center",children:[O.jsx(Mh,{className:"w-8 h-8 text-blue-400 mx-auto mb-3"}),O.jsx("h4",{className:"text-white font-semibold mb-2",children:"NASA OSDR"}),O.jsx("p",{className:"text-gray-300 text-sm",children:"Open Science Data Repository with primary research data"})]}),O.jsxs("div",{className:"p-6 bg-white/5 rounded-lg border border-white/10 text-center",children:[O.jsx(YA,{className:"w-8 h-8 text-green-400 mx-auto mb-3"}),O.jsx("h4",{className:"text-white font-semibold mb-2",children:"Life Sciences Library"}),O.jsx("p",{className:"text-gray-300 text-sm",children:"Comprehensive collection of space life sciences publications"})]}),O.jsxs("div",{className:"p-6 bg-white/5 rounded-lg border border-white/10 text-center",children:[O.jsx(Pd,{className:"w-8 h-8 text-purple-400 mx-auto mb-3"}),O.jsx("h4",{className:"text-white font-semibold mb-2",children:"NASA Task Book"}),O.jsx("p",{className:"text-gray-300 text-sm",children:"Grant information and funding details for research studies"})]})]})})]})})]})})}function bIe({theme:t}){const e=[{name:"Kartavya",role:"RAG System and Frontend",avatar:"",description:"Develops scalable Retrieval-Augmented Generation (RAG) systems and integrates them into dynamic, user-friendly interfaces.",skills:["RAG","React","JavaScript","LangChain","Frontend Architecture"],achievements:["Built scalable RAG pipelines with LLM integration","Designed intuitive interfaces for complex data queries","Contributor to open-source AI tooling"],social:{github:"kartavya-dev",linkedin:"kartavya-rag",email:"kartavya@astronots.space"},icon:ss,color:"from-blue-500 to-cyan-500"},{name:"Surya Shrivastav",role:"Knowledge Graph Builder",avatar:"",description:"Specializes in building and maintaining semantic knowledge graphs to enhance information discovery and retrieval.",skills:["Knowledge Graphs","Neo4j","SPARQL","Python","Graph Databases"],achievements:["Built a research-driven knowledge graph from unstructured data","Optimized graph traversal for high-speed querying","Designed ontology for academic domains"],social:{github:"surya-kg",linkedin:"surya-shrivastav",email:"surya@astronots.space"},icon:KA,color:"from-red-500 to-orange-500"},{name:"Saksham Sethia",role:"Backend",avatar:"",description:"Develops and maintains backend infrastructure including APIs, data pipelines, and service orchestration.",skills:["Node.js","Python","API Development","PostgreSQL","Docker"],achievements:["Built APIs powering RAG and KG systems","Implemented scalable data ingestion pipelines","Integrated backend with frontend using REST and WebSocket"],social:{github:"saksham-backend",linkedin:"saksham-sethia",email:"saksham@astronots.space"},icon:Mh,color:"from-yellow-500 to-amber-500"},{name:"Yash Sharma",role:"Data Scientist",avatar:"",description:"Applies statistical and machine learning techniques to extract insights from complex datasets and support model training.",skills:["Data Science","Python","Pandas","Model Evaluation","Visualization"],achievements:["Processed and analyzed 10,000+ scientific documents","Built evaluation pipeline for LLM-based tools","Generated key insights for user behavior and system accuracy"],social:{github:"yash-ds",linkedin:"yash-sharma",email:"yash@astronots.space"},icon:Mh,color:"from-green-500 to-emerald-500"},{name:"Sapphire",role:"Knowledge Graph",avatar:"",description:"Focuses on data modeling and semantic structuring to enable contextual understanding of research data.",skills:["Ontology Design","GraphQL","Data Modeling","Python","Linked Data"],achievements:["Enhanced graph accuracy with advanced entity linking","Designed modular schemas for evolving scientific domains","Integrated external data sources into the KG pipeline"],social:{github:"sapphire-kg",linkedin:"sapphire-graph",email:"sapphire@astronots.space"},icon:ss,color:"from-indigo-500 to-blue-500"},{name:"Sanvi",role:"UI/UX Designer",avatar:"",description:"Creates engaging, user-centric interfaces that simplify access to complex scientific knowledge.",skills:["UI/UX Design","Figma","Prototyping","Design Systems","Accessibility"],achievements:["Designed interfaces for LLM-powered search tools","Conducted usability tests with domain experts","Implemented design systems for consistency and scalability"],social:{github:"sanvi-uiux",linkedin:"sanvi-designer",email:"sanvi@astronots.space"},icon:pse,color:"from-purple-500 to-pink-500"}],i=[{label:"Research Papers Analyzed",value:"608+",icon:i1e},{label:"Active Users",value:"2",icon:w1},{label:"AI Models Trained",value:"3",icon:ss},{label:"Insights Generated",value:"20+",icon:J3}],r=[{title:"NASA Space Apps Challenge 2024",description:"Our current mission: Creating tools that mine the text of NASA publications",status:"In Progress",objective:"Help scientists, managers, and mission architects explore research more effectively"}];return O.jsx("div",{className:"min-h-screen p-6",children:O.jsxs("div",{className:"max-w-6xl mx-auto space-y-8",children:[O.jsxs(Rt.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},className:"text-center space-y-4",children:[O.jsxs("div",{className:"flex items-center justify-center gap-4 mb-6",children:[O.jsx(Rt.div,{animate:{rotate:360},transition:{duration:20,repeat:1/0,ease:"linear"},className:`w-16 h-16 bg-gradient-to-r ${t.primary} rounded-full flex items-center justify-center`,children:O.jsx(KA,{className:"w-8 h-8 text-white"})}),O.jsxs("div",{children:[O.jsx("h1",{className:"text-4xl font-bold text-white",children:"Meet the AstroNots"}),O.jsx("p",{className:"text-purple-300",children:"Exploring the cosmos through AI and innovation"})]})]}),O.jsx("p",{className:"text-xl text-gray-300 max-w-3xl mx-auto",children:"We're a passionate team of engineers, scientists, and designers united by our mission to make space research more accessible and actionable for everyone."})]}),O.jsx(Rt.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2},children:O.jsx(zn,{className:"bg-white/5 backdrop-blur-sm border-white/10",children:O.jsx(jn,{className:"p-8",children:O.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-6",children:i.map((n,s)=>{const a=n.icon;return O.jsxs(Rt.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},transition:{delay:.3+s*.1},className:"text-center",children:[O.jsx("div",{className:`w-16 h-16 bg-gradient-to-r ${t.primary} rounded-full flex items-center justify-center mx-auto mb-3`,children:O.jsx(a,{className:"w-8 h-8 text-white"})}),O.jsx("div",{className:"text-2xl font-bold text-white mb-1",children:n.value}),O.jsx("div",{className:"text-gray-300 text-sm",children:n.label})]},s)})})})})}),O.jsx(Rt.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.4},children:O.jsxs(zn,{className:"bg-white/5 backdrop-blur-sm border-white/10",children:[O.jsx(Yd,{children:O.jsxs(Kd,{className:"text-white text-2xl flex items-center gap-2",children:[O.jsx(oz,{className:"w-6 h-6"}),"Our Current Mission"]})}),O.jsx(jn,{children:r.map((n,s)=>O.jsx("div",{className:"space-y-4",children:O.jsxs("div",{className:"flex items-start justify-between",children:[O.jsxs("div",{className:"flex-1",children:[O.jsx("h3",{className:"text-xl font-semibold text-white mb-2",children:n.title}),O.jsx("p",{className:"text-gray-300 mb-4",children:n.description}),O.jsx("p",{className:"text-gray-300",children:n.objective})]}),O.jsx(Ip,{className:`ml-4 bg-gradient-to-r ${t.primary}`,children:n.status})]})},s))})]})}),O.jsxs(Rt.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.6},className:"space-y-8",children:[O.jsx("h2",{className:"text-3xl font-bold text-white text-center",children:"Our Team"}),O.jsx("div",{className:"grid md:grid-cols-2 gap-8",children:e.map((n,s)=>{const a=n.icon;return O.jsx(Rt.div,{initial:{opacity:0,y:30},animate:{opacity:1,y:0},transition:{delay:.7+s*.1},whileHover:{scale:1.02},children:O.jsx(zn,{className:"bg-white/5 backdrop-blur-sm border-white/10 h-full",children:O.jsxs(jn,{className:"p-6",children:[O.jsxs("div",{className:"flex items-start gap-4 mb-4",children:[O.jsx("div",{className:"text-4xl",children:n.avatar}),O.jsxs("div",{className:"flex-1",children:[O.jsx("h3",{className:"text-xl font-bold text-white",children:n.name}),O.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[O.jsx(a,{className:"w-4 h-4 text-gray-400"}),O.jsx("p",{className:"text-gray-300",children:n.role})]})]}),O.jsx("div",{className:`w-12 h-12 bg-gradient-to-r ${n.color} rounded-full flex items-center justify-center`,children:O.jsx(a,{className:"w-6 h-6 text-white"})})]}),O.jsx("p",{className:"text-gray-300 mb-4",children:n.description}),O.jsxs("div",{className:"mb-4",children:[O.jsx("h4",{className:"text-white font-medium mb-2",children:"Skills"}),O.jsx("div",{className:"flex flex-wrap gap-2",children:n.skills.map((o,l)=>O.jsx(Ip,{className:"bg-white/10 text-white border-white/20 text-xs",children:o},l))})]}),O.jsxs("div",{className:"mb-4",children:[O.jsx("h4",{className:"text-white font-medium mb-2",children:"Key Achievements"}),O.jsx("ul",{className:"space-y-1",children:n.achievements.map((o,l)=>O.jsxs("li",{className:"text-gray-300 text-sm flex items-start gap-2",children:[O.jsx(oz,{className:"w-3 h-3 mt-0.5 text-yellow-400 flex-shrink-0"}),o]},l))})]}),O.jsxs("div",{className:"flex gap-2",children:[O.jsx(jr,{variant:"outline",size:"sm",className:"border-white/20 text-gray-300 hover:text-white hover:bg-white/10 p-2",children:O.jsx(hse,{className:"w-4 h-4"})}),O.jsx(jr,{variant:"outline",size:"sm",className:"border-white/20 text-gray-300 hover:text-white hover:bg-white/10 p-2",children:O.jsx(fse,{className:"w-4 h-4"})}),O.jsx(jr,{variant:"outline",size:"sm",className:"border-white/20 text-gray-300 hover:text-white hover:bg-white/10 p-2",children:O.jsx(az,{className:"w-4 h-4"})})]})]})})},s)})})]}),O.jsx(Rt.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:1.2},children:O.jsx(zn,{className:"bg-white/5 backdrop-blur-sm border-white/10",children:O.jsxs(jn,{className:"p-8 text-center",children:[O.jsx("h3",{className:"text-2xl font-bold text-white mb-4",children:"Our Mission"}),O.jsx("p",{className:"text-lg text-gray-300 max-w-4xl mx-auto leading-relaxed",children:"At AstroNots, we believe that groundbreaking space research should be accessible to everyone. Our AI-powered platform bridges the gap between complex scientific data and actionable insights, empowering scientists to generate new hypotheses, helping managers identify investment opportunities, and enabling mission architects to plan safer, more efficient space exploration missions."}),O.jsx("div",{className:"mt-6",children:O.jsx(Ip,{className:`bg-gradient-to-r ${t.primary} text-lg px-6 py-2`,children:"Making Space Science Accessible"})})]})})}),O.jsx(Rt.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:1.4},children:O.jsxs(zn,{className:"bg-white/5 backdrop-blur-sm border-white/10",children:[O.jsx(Yd,{children:O.jsx(Kd,{className:"text-white text-2xl text-center",children:"Get In Touch"})}),O.jsxs(jn,{className:"text-center",children:[O.jsx("p",{className:"text-gray-300 mb-6",children:"Interested in collaborating or have questions about our project? We'd love to hear from you!"}),O.jsxs("div",{className:"flex justify-center gap-4",children:[O.jsxs(jr,{className:`bg-gradient-to-r ${t.primary} hover:opacity-90`,children:[O.jsx(az,{className:"w-4 h-4 mr-2"}),"Contact Us"]}),O.jsxs(jr,{variant:"outline",className:"border-white/20 text-gray-300 hover:text-white hover:bg-white/10",children:[O.jsx(dse,{className:"w-4 h-4 mr-2"}),"Our Website"]})]})]})]})})]})})}/**
 * @license
 * Copyright 2010-2025 Three.js Authors
 * SPDX-License-Identifier: MIT
 */const mT="180",wIe={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2},_Ie={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},Zae=0,Vz=1,Qae=2,SIe=3,Jae=0,mO=1,vA=2,ph=3,Fp=0,bl=1,Sd=2,Dp=0,h0=1,Hz=2,Gz=3,Wz=4,eoe=5,vg=100,toe=101,ioe=102,roe=103,noe=104,soe=200,aoe=201,ooe=202,loe=203,VI=204,HI=205,coe=206,uoe=207,hoe=208,doe=209,foe=210,poe=211,moe=212,goe=213,voe=214,GI=0,WI=1,qI=2,M0=3,XI=4,$I=5,YI=6,KI=7,gT=0,yoe=1,xoe=2,jd=0,boe=1,woe=2,_oe=3,N6=4,Soe=5,Eoe=6,Aoe=7,qz="attached",Moe="detached",gO=300,zp=301,Jg=302,lM=303,cM=304,p_=306,uM=1e3,gu=1001,hM=1002,wo=1003,U6=1004,EIe=1004,Vw=1005,AIe=1005,ma=1006,yA=1007,MIe=1007,Id=1008,TIe=1008,_u=1009,B6=1010,F6=1011,R1=1012,vO=1013,jp=1014,tc=1015,m_=1016,yO=1017,xO=1018,I1=1020,z6=35902,j6=35899,V6=1021,H6=1022,zo=1023,D1=1026,O1=1027,bO=1028,vT=1029,G6=1030,wO=1031,CIe=1032,_O=1033,xA=33776,bA=33777,wA=33778,_A=33779,ZI=35840,QI=35841,JI=35842,eD=35843,tD=36196,iD=37492,rD=37496,nD=37808,sD=37809,aD=37810,oD=37811,lD=37812,cD=37813,uD=37814,hD=37815,dD=37816,fD=37817,pD=37818,mD=37819,gD=37820,vD=37821,yD=36492,xD=36494,bD=36495,wD=36283,_D=36284,SD=36285,ED=36286,Toe=2200,Coe=2201,Poe=2202,dM=2300,AD=2301,XR=2302,Zy=2400,Qy=2401,fM=2402,SO=2500,W6=2501,PIe=0,RIe=1,IIe=2,Roe=3200,Ioe=3201,DIe=3202,OIe=3203,cv=0,Doe=1,xp="",Wl="srgb",T0="srgb-linear",pM="linear",on="srgb",LIe=0,Ly=7680,kIe=7681,NIe=7682,UIe=7683,BIe=34055,FIe=34056,zIe=5386,jIe=512,VIe=513,HIe=514,GIe=515,WIe=516,qIe=517,XIe=518,Xz=519,Ooe=512,Loe=513,koe=514,q6=515,Noe=516,Uoe=517,Boe=518,Foe=519,mM=35044,d0=35048,$Ie=35040,YIe=35045,KIe=35049,ZIe=35041,QIe=35046,JIe=35050,eDe=35042,tDe="100",$z="300 es",Cc=2e3,L1=2001,iDe={COMPUTE:"compute",RENDER:"render"},rDe={PERSPECTIVE:"perspective",LINEAR:"linear",FLAT:"flat"},nDe={NORMAL:"normal",CENTROID:"centroid",SAMPLE:"sample",FIRST:"first",EITHER:"either"};class af{addEventListener(e,i){this._listeners===void 0&&(this._listeners={});const r=this._listeners;r[e]===void 0&&(r[e]=[]),r[e].indexOf(i)===-1&&r[e].push(i)}hasEventListener(e,i){const r=this._listeners;return r===void 0?!1:r[e]!==void 0&&r[e].indexOf(i)!==-1}removeEventListener(e,i){const r=this._listeners;if(r===void 0)return;const n=r[e];if(n!==void 0){const s=n.indexOf(i);s!==-1&&n.splice(s,1)}}dispatchEvent(e){const i=this._listeners;if(i===void 0)return;const r=i[e.type];if(r!==void 0){e.target=this;const n=r.slice(0);for(let s=0,a=n.length;s<a;s++)n[s].call(this,e);e.target=null}}}const Do=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];let s$=1234567;const f0=Math.PI/180,k1=180/Math.PI;function Rc(){const t=Math.random()*4294967295|0,e=Math.random()*4294967295|0,i=Math.random()*4294967295|0,r=Math.random()*4294967295|0;return(Do[t&255]+Do[t>>8&255]+Do[t>>16&255]+Do[t>>24&255]+"-"+Do[e&255]+Do[e>>8&255]+"-"+Do[e>>16&15|64]+Do[e>>24&255]+"-"+Do[i&63|128]+Do[i>>8&255]+"-"+Do[i>>16&255]+Do[i>>24&255]+Do[r&255]+Do[r>>8&255]+Do[r>>16&255]+Do[r>>24&255]).toLowerCase()}function Fi(t,e,i){return Math.max(e,Math.min(i,t))}function X6(t,e){return(t%e+e)%e}function sDe(t,e,i,r,n){return r+(t-e)*(n-r)/(i-e)}function aDe(t,e,i){return t!==e?(i-t)/(e-t):0}function SA(t,e,i){return(1-i)*t+i*e}function oDe(t,e,i,r){return SA(t,e,1-Math.exp(-i*r))}function lDe(t,e=1){return e-Math.abs(X6(t,e*2)-e)}function cDe(t,e,i){return t<=e?0:t>=i?1:(t=(t-e)/(i-e),t*t*(3-2*t))}function uDe(t,e,i){return t<=e?0:t>=i?1:(t=(t-e)/(i-e),t*t*t*(t*(t*6-15)+10))}function hDe(t,e){return t+Math.floor(Math.random()*(e-t+1))}function dDe(t,e){return t+Math.random()*(e-t)}function fDe(t){return t*(.5-Math.random())}function pDe(t){t!==void 0&&(s$=t);let e=s$+=1831565813;return e=Math.imul(e^e>>>15,e|1),e^=e+Math.imul(e^e>>>7,e|61),((e^e>>>14)>>>0)/4294967296}function mDe(t){return t*f0}function gDe(t){return t*k1}function vDe(t){return(t&t-1)===0&&t!==0}function yDe(t){return Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))}function xDe(t){return Math.pow(2,Math.floor(Math.log(t)/Math.LN2))}function bDe(t,e,i,r,n){const s=Math.cos,a=Math.sin,o=s(i/2),l=a(i/2),c=s((e+r)/2),u=a((e+r)/2),h=s((e-r)/2),d=a((e-r)/2),f=s((r-e)/2),p=a((r-e)/2);switch(n){case"XYX":t.set(o*u,l*h,l*d,o*c);break;case"YZY":t.set(l*d,o*u,l*h,o*c);break;case"ZXZ":t.set(l*h,l*d,o*u,o*c);break;case"XZX":t.set(o*u,l*p,l*f,o*c);break;case"YXY":t.set(l*f,o*u,l*p,o*c);break;case"ZYZ":t.set(l*p,l*f,o*u,o*c);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+n)}}function pl(t,e){switch(e.constructor){case Float32Array:return t;case Uint32Array:return t/4294967295;case Uint16Array:return t/65535;case Uint8Array:return t/255;case Int32Array:return Math.max(t/2147483647,-1);case Int16Array:return Math.max(t/32767,-1);case Int8Array:return Math.max(t/127,-1);default:throw new Error("Invalid component type.")}}function hr(t,e){switch(e.constructor){case Float32Array:return t;case Uint32Array:return Math.round(t*4294967295);case Uint16Array:return Math.round(t*65535);case Uint8Array:return Math.round(t*255);case Int32Array:return Math.round(t*2147483647);case Int16Array:return Math.round(t*32767);case Int8Array:return Math.round(t*127);default:throw new Error("Invalid component type.")}}const wDe={DEG2RAD:f0,RAD2DEG:k1,generateUUID:Rc,clamp:Fi,euclideanModulo:X6,mapLinear:sDe,inverseLerp:aDe,lerp:SA,damp:oDe,pingpong:lDe,smoothstep:cDe,smootherstep:uDe,randInt:hDe,randFloat:dDe,randFloatSpread:fDe,seededRandom:pDe,degToRad:mDe,radToDeg:gDe,isPowerOfTwo:vDe,ceilPowerOfTwo:yDe,floorPowerOfTwo:xDe,setQuaternionFromProperEuler:bDe,normalize:hr,denormalize:pl};class At{constructor(e=0,i=0){At.prototype.isVector2=!0,this.x=e,this.y=i}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,i){return this.x=e,this.y=i,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,i){switch(e){case 0:this.x=i;break;case 1:this.y=i;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,i){return this.x=e.x+i.x,this.y=e.y+i.y,this}addScaledVector(e,i){return this.x+=e.x*i,this.y+=e.y*i,this}sub(e){return this.x-=e.x,this.y-=e.y,this}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,i){return this.x=e.x-i.x,this.y=e.y-i.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const i=this.x,r=this.y,n=e.elements;return this.x=n[0]*i+n[3]*r+n[6],this.y=n[1]*i+n[4]*r+n[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,i){return this.x=Fi(this.x,e.x,i.x),this.y=Fi(this.y,e.y,i.y),this}clampScalar(e,i){return this.x=Fi(this.x,e,i),this.y=Fi(this.y,e,i),this}clampLength(e,i){const r=this.length();return this.divideScalar(r||1).multiplyScalar(Fi(r,e,i))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(e){const i=Math.sqrt(this.lengthSq()*e.lengthSq());if(i===0)return Math.PI/2;const r=this.dot(e)/i;return Math.acos(Fi(r,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const i=this.x-e.x,r=this.y-e.y;return i*i+r*r}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,i){return this.x+=(e.x-this.x)*i,this.y+=(e.y-this.y)*i,this}lerpVectors(e,i,r){return this.x=e.x+(i.x-e.x)*r,this.y=e.y+(i.y-e.y)*r,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,i=0){return this.x=e[i],this.y=e[i+1],this}toArray(e=[],i=0){return e[i]=this.x,e[i+1]=this.y,e}fromBufferAttribute(e,i){return this.x=e.getX(i),this.y=e.getY(i),this}rotateAround(e,i){const r=Math.cos(i),n=Math.sin(i),s=this.x-e.x,a=this.y-e.y;return this.x=s*r-a*n+e.x,this.y=s*n+a*r+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class sc{constructor(e=0,i=0,r=0,n=1){this.isQuaternion=!0,this._x=e,this._y=i,this._z=r,this._w=n}static slerpFlat(e,i,r,n,s,a,o){let l=r[n+0],c=r[n+1],u=r[n+2],h=r[n+3];const d=s[a+0],f=s[a+1],p=s[a+2],g=s[a+3];if(o===0){e[i+0]=l,e[i+1]=c,e[i+2]=u,e[i+3]=h;return}if(o===1){e[i+0]=d,e[i+1]=f,e[i+2]=p,e[i+3]=g;return}if(h!==g||l!==d||c!==f||u!==p){let m=1-o;const y=l*d+c*f+u*p+h*g,b=y>=0?1:-1,w=1-y*y;if(w>Number.EPSILON){const M=Math.sqrt(w),A=Math.atan2(M,y*b);m=Math.sin(m*A)/M,o=Math.sin(o*A)/M}const E=o*b;if(l=l*m+d*E,c=c*m+f*E,u=u*m+p*E,h=h*m+g*E,m===1-o){const M=1/Math.sqrt(l*l+c*c+u*u+h*h);l*=M,c*=M,u*=M,h*=M}}e[i]=l,e[i+1]=c,e[i+2]=u,e[i+3]=h}static multiplyQuaternionsFlat(e,i,r,n,s,a){const o=r[n],l=r[n+1],c=r[n+2],u=r[n+3],h=s[a],d=s[a+1],f=s[a+2],p=s[a+3];return e[i]=o*p+u*h+l*f-c*d,e[i+1]=l*p+u*d+c*h-o*f,e[i+2]=c*p+u*f+o*d-l*h,e[i+3]=u*p-o*h-l*d-c*f,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,i,r,n){return this._x=e,this._y=i,this._z=r,this._w=n,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,i=!0){const r=e._x,n=e._y,s=e._z,a=e._order,o=Math.cos,l=Math.sin,c=o(r/2),u=o(n/2),h=o(s/2),d=l(r/2),f=l(n/2),p=l(s/2);switch(a){case"XYZ":this._x=d*u*h+c*f*p,this._y=c*f*h-d*u*p,this._z=c*u*p+d*f*h,this._w=c*u*h-d*f*p;break;case"YXZ":this._x=d*u*h+c*f*p,this._y=c*f*h-d*u*p,this._z=c*u*p-d*f*h,this._w=c*u*h+d*f*p;break;case"ZXY":this._x=d*u*h-c*f*p,this._y=c*f*h+d*u*p,this._z=c*u*p+d*f*h,this._w=c*u*h-d*f*p;break;case"ZYX":this._x=d*u*h-c*f*p,this._y=c*f*h+d*u*p,this._z=c*u*p-d*f*h,this._w=c*u*h+d*f*p;break;case"YZX":this._x=d*u*h+c*f*p,this._y=c*f*h+d*u*p,this._z=c*u*p-d*f*h,this._w=c*u*h-d*f*p;break;case"XZY":this._x=d*u*h-c*f*p,this._y=c*f*h-d*u*p,this._z=c*u*p+d*f*h,this._w=c*u*h+d*f*p;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+a)}return i===!0&&this._onChangeCallback(),this}setFromAxisAngle(e,i){const r=i/2,n=Math.sin(r);return this._x=e.x*n,this._y=e.y*n,this._z=e.z*n,this._w=Math.cos(r),this._onChangeCallback(),this}setFromRotationMatrix(e){const i=e.elements,r=i[0],n=i[4],s=i[8],a=i[1],o=i[5],l=i[9],c=i[2],u=i[6],h=i[10],d=r+o+h;if(d>0){const f=.5/Math.sqrt(d+1);this._w=.25/f,this._x=(u-l)*f,this._y=(s-c)*f,this._z=(a-n)*f}else if(r>o&&r>h){const f=2*Math.sqrt(1+r-o-h);this._w=(u-l)/f,this._x=.25*f,this._y=(n+a)/f,this._z=(s+c)/f}else if(o>h){const f=2*Math.sqrt(1+o-r-h);this._w=(s-c)/f,this._x=(n+a)/f,this._y=.25*f,this._z=(l+u)/f}else{const f=2*Math.sqrt(1+h-r-o);this._w=(a-n)/f,this._x=(s+c)/f,this._y=(l+u)/f,this._z=.25*f}return this._onChangeCallback(),this}setFromUnitVectors(e,i){let r=e.dot(i)+1;return r<1e-8?(r=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=r):(this._x=0,this._y=-e.z,this._z=e.y,this._w=r)):(this._x=e.y*i.z-e.z*i.y,this._y=e.z*i.x-e.x*i.z,this._z=e.x*i.y-e.y*i.x,this._w=r),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(Fi(this.dot(e),-1,1)))}rotateTowards(e,i){const r=this.angleTo(e);if(r===0)return this;const n=Math.min(1,i/r);return this.slerp(e,n),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return e===0?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e){return this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,i){const r=e._x,n=e._y,s=e._z,a=e._w,o=i._x,l=i._y,c=i._z,u=i._w;return this._x=r*u+a*o+n*c-s*l,this._y=n*u+a*l+s*o-r*c,this._z=s*u+a*c+r*l-n*o,this._w=a*u-r*o-n*l-s*c,this._onChangeCallback(),this}slerp(e,i){if(i===0)return this;if(i===1)return this.copy(e);const r=this._x,n=this._y,s=this._z,a=this._w;let o=a*e._w+r*e._x+n*e._y+s*e._z;if(o<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,o=-o):this.copy(e),o>=1)return this._w=a,this._x=r,this._y=n,this._z=s,this;const l=1-o*o;if(l<=Number.EPSILON){const f=1-i;return this._w=f*a+i*this._w,this._x=f*r+i*this._x,this._y=f*n+i*this._y,this._z=f*s+i*this._z,this.normalize(),this}const c=Math.sqrt(l),u=Math.atan2(c,o),h=Math.sin((1-i)*u)/c,d=Math.sin(i*u)/c;return this._w=a*h+this._w*d,this._x=r*h+this._x*d,this._y=n*h+this._y*d,this._z=s*h+this._z*d,this._onChangeCallback(),this}slerpQuaternions(e,i,r){return this.copy(e).slerp(i,r)}random(){const e=2*Math.PI*Math.random(),i=2*Math.PI*Math.random(),r=Math.random(),n=Math.sqrt(1-r),s=Math.sqrt(r);return this.set(n*Math.sin(e),n*Math.cos(e),s*Math.sin(i),s*Math.cos(i))}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,i=0){return this._x=e[i],this._y=e[i+1],this._z=e[i+2],this._w=e[i+3],this._onChangeCallback(),this}toArray(e=[],i=0){return e[i]=this._x,e[i+1]=this._y,e[i+2]=this._z,e[i+3]=this._w,e}fromBufferAttribute(e,i){return this._x=e.getX(i),this._y=e.getY(i),this._z=e.getZ(i),this._w=e.getW(i),this._onChangeCallback(),this}toJSON(){return this.toArray()}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class be{constructor(e=0,i=0,r=0){be.prototype.isVector3=!0,this.x=e,this.y=i,this.z=r}set(e,i,r){return r===void 0&&(r=this.z),this.x=e,this.y=i,this.z=r,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,i){switch(e){case 0:this.x=i;break;case 1:this.y=i;break;case 2:this.z=i;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,i){return this.x=e.x+i.x,this.y=e.y+i.y,this.z=e.z+i.z,this}addScaledVector(e,i){return this.x+=e.x*i,this.y+=e.y*i,this.z+=e.z*i,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,i){return this.x=e.x-i.x,this.y=e.y-i.y,this.z=e.z-i.z,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,i){return this.x=e.x*i.x,this.y=e.y*i.y,this.z=e.z*i.z,this}applyEuler(e){return this.applyQuaternion(a$.setFromEuler(e))}applyAxisAngle(e,i){return this.applyQuaternion(a$.setFromAxisAngle(e,i))}applyMatrix3(e){const i=this.x,r=this.y,n=this.z,s=e.elements;return this.x=s[0]*i+s[3]*r+s[6]*n,this.y=s[1]*i+s[4]*r+s[7]*n,this.z=s[2]*i+s[5]*r+s[8]*n,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){const i=this.x,r=this.y,n=this.z,s=e.elements,a=1/(s[3]*i+s[7]*r+s[11]*n+s[15]);return this.x=(s[0]*i+s[4]*r+s[8]*n+s[12])*a,this.y=(s[1]*i+s[5]*r+s[9]*n+s[13])*a,this.z=(s[2]*i+s[6]*r+s[10]*n+s[14])*a,this}applyQuaternion(e){const i=this.x,r=this.y,n=this.z,s=e.x,a=e.y,o=e.z,l=e.w,c=2*(a*n-o*r),u=2*(o*i-s*n),h=2*(s*r-a*i);return this.x=i+l*c+a*h-o*u,this.y=r+l*u+o*c-s*h,this.z=n+l*h+s*u-a*c,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){const i=this.x,r=this.y,n=this.z,s=e.elements;return this.x=s[0]*i+s[4]*r+s[8]*n,this.y=s[1]*i+s[5]*r+s[9]*n,this.z=s[2]*i+s[6]*r+s[10]*n,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,i){return this.x=Fi(this.x,e.x,i.x),this.y=Fi(this.y,e.y,i.y),this.z=Fi(this.z,e.z,i.z),this}clampScalar(e,i){return this.x=Fi(this.x,e,i),this.y=Fi(this.y,e,i),this.z=Fi(this.z,e,i),this}clampLength(e,i){const r=this.length();return this.divideScalar(r||1).multiplyScalar(Fi(r,e,i))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,i){return this.x+=(e.x-this.x)*i,this.y+=(e.y-this.y)*i,this.z+=(e.z-this.z)*i,this}lerpVectors(e,i,r){return this.x=e.x+(i.x-e.x)*r,this.y=e.y+(i.y-e.y)*r,this.z=e.z+(i.z-e.z)*r,this}cross(e){return this.crossVectors(this,e)}crossVectors(e,i){const r=e.x,n=e.y,s=e.z,a=i.x,o=i.y,l=i.z;return this.x=n*l-s*o,this.y=s*a-r*l,this.z=r*o-n*a,this}projectOnVector(e){const i=e.lengthSq();if(i===0)return this.set(0,0,0);const r=e.dot(this)/i;return this.copy(e).multiplyScalar(r)}projectOnPlane(e){return uU.copy(this).projectOnVector(e),this.sub(uU)}reflect(e){return this.sub(uU.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){const i=Math.sqrt(this.lengthSq()*e.lengthSq());if(i===0)return Math.PI/2;const r=this.dot(e)/i;return Math.acos(Fi(r,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const i=this.x-e.x,r=this.y-e.y,n=this.z-e.z;return i*i+r*r+n*n}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,i,r){const n=Math.sin(i)*e;return this.x=n*Math.sin(r),this.y=Math.cos(i)*e,this.z=n*Math.cos(r),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,i,r){return this.x=e*Math.sin(i),this.y=r,this.z=e*Math.cos(i),this}setFromMatrixPosition(e){const i=e.elements;return this.x=i[12],this.y=i[13],this.z=i[14],this}setFromMatrixScale(e){const i=this.setFromMatrixColumn(e,0).length(),r=this.setFromMatrixColumn(e,1).length(),n=this.setFromMatrixColumn(e,2).length();return this.x=i,this.y=r,this.z=n,this}setFromMatrixColumn(e,i){return this.fromArray(e.elements,i*4)}setFromMatrix3Column(e,i){return this.fromArray(e.elements,i*3)}setFromEuler(e){return this.x=e._x,this.y=e._y,this.z=e._z,this}setFromColor(e){return this.x=e.r,this.y=e.g,this.z=e.b,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,i=0){return this.x=e[i],this.y=e[i+1],this.z=e[i+2],this}toArray(e=[],i=0){return e[i]=this.x,e[i+1]=this.y,e[i+2]=this.z,e}fromBufferAttribute(e,i){return this.x=e.getX(i),this.y=e.getY(i),this.z=e.getZ(i),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const e=Math.random()*Math.PI*2,i=Math.random()*2-1,r=Math.sqrt(1-i*i);return this.x=r*Math.cos(e),this.y=i,this.z=r*Math.sin(e),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const uU=new be,a$=new sc;class lr{constructor(e,i,r,n,s,a,o,l,c){lr.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],e!==void 0&&this.set(e,i,r,n,s,a,o,l,c)}set(e,i,r,n,s,a,o,l,c){const u=this.elements;return u[0]=e,u[1]=n,u[2]=o,u[3]=i,u[4]=s,u[5]=l,u[6]=r,u[7]=a,u[8]=c,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const i=this.elements,r=e.elements;return i[0]=r[0],i[1]=r[1],i[2]=r[2],i[3]=r[3],i[4]=r[4],i[5]=r[5],i[6]=r[6],i[7]=r[7],i[8]=r[8],this}extractBasis(e,i,r){return e.setFromMatrix3Column(this,0),i.setFromMatrix3Column(this,1),r.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const i=e.elements;return this.set(i[0],i[4],i[8],i[1],i[5],i[9],i[2],i[6],i[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,i){const r=e.elements,n=i.elements,s=this.elements,a=r[0],o=r[3],l=r[6],c=r[1],u=r[4],h=r[7],d=r[2],f=r[5],p=r[8],g=n[0],m=n[3],y=n[6],b=n[1],w=n[4],E=n[7],M=n[2],A=n[5],P=n[8];return s[0]=a*g+o*b+l*M,s[3]=a*m+o*w+l*A,s[6]=a*y+o*E+l*P,s[1]=c*g+u*b+h*M,s[4]=c*m+u*w+h*A,s[7]=c*y+u*E+h*P,s[2]=d*g+f*b+p*M,s[5]=d*m+f*w+p*A,s[8]=d*y+f*E+p*P,this}multiplyScalar(e){const i=this.elements;return i[0]*=e,i[3]*=e,i[6]*=e,i[1]*=e,i[4]*=e,i[7]*=e,i[2]*=e,i[5]*=e,i[8]*=e,this}determinant(){const e=this.elements,i=e[0],r=e[1],n=e[2],s=e[3],a=e[4],o=e[5],l=e[6],c=e[7],u=e[8];return i*a*u-i*o*c-r*s*u+r*o*l+n*s*c-n*a*l}invert(){const e=this.elements,i=e[0],r=e[1],n=e[2],s=e[3],a=e[4],o=e[5],l=e[6],c=e[7],u=e[8],h=u*a-o*c,d=o*l-u*s,f=c*s-a*l,p=i*h+r*d+n*f;if(p===0)return this.set(0,0,0,0,0,0,0,0,0);const g=1/p;return e[0]=h*g,e[1]=(n*c-u*r)*g,e[2]=(o*r-n*a)*g,e[3]=d*g,e[4]=(u*i-n*l)*g,e[5]=(n*s-o*i)*g,e[6]=f*g,e[7]=(r*l-c*i)*g,e[8]=(a*i-r*s)*g,this}transpose(){let e;const i=this.elements;return e=i[1],i[1]=i[3],i[3]=e,e=i[2],i[2]=i[6],i[6]=e,e=i[5],i[5]=i[7],i[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){const i=this.elements;return e[0]=i[0],e[1]=i[3],e[2]=i[6],e[3]=i[1],e[4]=i[4],e[5]=i[7],e[6]=i[2],e[7]=i[5],e[8]=i[8],this}setUvTransform(e,i,r,n,s,a,o){const l=Math.cos(s),c=Math.sin(s);return this.set(r*l,r*c,-r*(l*a+c*o)+a+e,-n*c,n*l,-n*(-c*a+l*o)+o+i,0,0,1),this}scale(e,i){return this.premultiply(hU.makeScale(e,i)),this}rotate(e){return this.premultiply(hU.makeRotation(-e)),this}translate(e,i){return this.premultiply(hU.makeTranslation(e,i)),this}makeTranslation(e,i){return e.isVector2?this.set(1,0,e.x,0,1,e.y,0,0,1):this.set(1,0,e,0,1,i,0,0,1),this}makeRotation(e){const i=Math.cos(e),r=Math.sin(e);return this.set(i,-r,0,r,i,0,0,0,1),this}makeScale(e,i){return this.set(e,0,0,0,i,0,0,0,1),this}equals(e){const i=this.elements,r=e.elements;for(let n=0;n<9;n++)if(i[n]!==r[n])return!1;return!0}fromArray(e,i=0){for(let r=0;r<9;r++)this.elements[r]=e[r+i];return this}toArray(e=[],i=0){const r=this.elements;return e[i]=r[0],e[i+1]=r[1],e[i+2]=r[2],e[i+3]=r[3],e[i+4]=r[4],e[i+5]=r[5],e[i+6]=r[6],e[i+7]=r[7],e[i+8]=r[8],e}clone(){return new this.constructor().fromArray(this.elements)}}const hU=new lr;function zoe(t){for(let e=t.length-1;e>=0;--e)if(t[e]>=65535)return!0;return!1}const _De={Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array};function Hw(t,e){return new _De[t](e)}function gM(t){return document.createElementNS("http://www.w3.org/1999/xhtml",t)}function joe(){const t=gM("canvas");return t.style.display="block",t}const o$={};function vM(t){t in o$||(o$[t]=!0,console.warn(t))}function SDe(t,e,i){return new Promise(function(r,n){function s(){switch(t.clientWaitSync(e,t.SYNC_FLUSH_COMMANDS_BIT,0)){case t.WAIT_FAILED:n();break;case t.TIMEOUT_EXPIRED:setTimeout(s,i);break;default:r()}}setTimeout(s,i)})}const l$=new lr().set(.4123908,.3575843,.1804808,.212639,.7151687,.0721923,.0193308,.1191948,.9505322),c$=new lr().set(3.2409699,-1.5373832,-.4986108,-.9692436,1.8759675,.0415551,.0556301,-.203977,1.0569715);function EDe(){const t={enabled:!0,workingColorSpace:T0,spaces:{},convert:function(n,s,a){return this.enabled===!1||s===a||!s||!a||(this.spaces[s].transfer===on&&(n.r=Op(n.r),n.g=Op(n.g),n.b=Op(n.b)),this.spaces[s].primaries!==this.spaces[a].primaries&&(n.applyMatrix3(this.spaces[s].toXYZ),n.applyMatrix3(this.spaces[a].fromXYZ)),this.spaces[a].transfer===on&&(n.r=t1(n.r),n.g=t1(n.g),n.b=t1(n.b))),n},workingToColorSpace:function(n,s){return this.convert(n,this.workingColorSpace,s)},colorSpaceToWorking:function(n,s){return this.convert(n,s,this.workingColorSpace)},getPrimaries:function(n){return this.spaces[n].primaries},getTransfer:function(n){return n===xp?pM:this.spaces[n].transfer},getToneMappingMode:function(n){return this.spaces[n].outputColorSpaceConfig.toneMappingMode||"standard"},getLuminanceCoefficients:function(n,s=this.workingColorSpace){return n.fromArray(this.spaces[s].luminanceCoefficients)},define:function(n){Object.assign(this.spaces,n)},_getMatrix:function(n,s,a){return n.copy(this.spaces[s].toXYZ).multiply(this.spaces[a].fromXYZ)},_getDrawingBufferColorSpace:function(n){return this.spaces[n].outputColorSpaceConfig.drawingBufferColorSpace},_getUnpackColorSpace:function(n=this.workingColorSpace){return this.spaces[n].workingColorSpaceConfig.unpackColorSpace},fromWorkingColorSpace:function(n,s){return vM("THREE.ColorManagement: .fromWorkingColorSpace() has been renamed to .workingToColorSpace()."),t.workingToColorSpace(n,s)},toWorkingColorSpace:function(n,s){return vM("THREE.ColorManagement: .toWorkingColorSpace() has been renamed to .colorSpaceToWorking()."),t.colorSpaceToWorking(n,s)}},e=[.64,.33,.3,.6,.15,.06],i=[.2126,.7152,.0722],r=[.3127,.329];return t.define({[T0]:{primaries:e,whitePoint:r,transfer:pM,toXYZ:l$,fromXYZ:c$,luminanceCoefficients:i,workingColorSpaceConfig:{unpackColorSpace:Wl},outputColorSpaceConfig:{drawingBufferColorSpace:Wl}},[Wl]:{primaries:e,whitePoint:r,transfer:on,toXYZ:l$,fromXYZ:c$,luminanceCoefficients:i,outputColorSpaceConfig:{drawingBufferColorSpace:Wl}}}),t}const Lr=EDe();function Op(t){return t<.04045?t*.0773993808:Math.pow(t*.9478672986+.0521327014,2.4)}function t1(t){return t<.0031308?t*12.92:1.055*Math.pow(t,.41666)-.055}let ub;class Voe{static getDataURL(e,i="image/png"){if(/^data:/i.test(e.src)||typeof HTMLCanvasElement>"u")return e.src;let r;if(e instanceof HTMLCanvasElement)r=e;else{ub===void 0&&(ub=gM("canvas")),ub.width=e.width,ub.height=e.height;const n=ub.getContext("2d");e instanceof ImageData?n.putImageData(e,0,0):n.drawImage(e,0,0,e.width,e.height),r=ub}return r.toDataURL(i)}static sRGBToLinear(e){if(typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&e instanceof ImageBitmap){const i=gM("canvas");i.width=e.width,i.height=e.height;const r=i.getContext("2d");r.drawImage(e,0,0,e.width,e.height);const n=r.getImageData(0,0,e.width,e.height),s=n.data;for(let a=0;a<s.length;a++)s[a]=Op(s[a]/255)*255;return r.putImageData(n,0,0),i}else if(e.data){const i=e.data.slice(0);for(let r=0;r<i.length;r++)i instanceof Uint8Array||i instanceof Uint8ClampedArray?i[r]=Math.floor(Op(i[r]/255)*255):i[r]=Op(i[r]);return{data:i,width:e.width,height:e.height}}else return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),e}}let ADe=0;class Cg{constructor(e=null){this.isSource=!0,Object.defineProperty(this,"id",{value:ADe++}),this.uuid=Rc(),this.data=e,this.dataReady=!0,this.version=0}getSize(e){const i=this.data;return typeof HTMLVideoElement<"u"&&i instanceof HTMLVideoElement?e.set(i.videoWidth,i.videoHeight,0):i instanceof VideoFrame?e.set(i.displayHeight,i.displayWidth,0):i!==null?e.set(i.width,i.height,i.depth||0):e.set(0,0,0),e}set needsUpdate(e){e===!0&&this.version++}toJSON(e){const i=e===void 0||typeof e=="string";if(!i&&e.images[this.uuid]!==void 0)return e.images[this.uuid];const r={uuid:this.uuid,url:""},n=this.data;if(n!==null){let s;if(Array.isArray(n)){s=[];for(let a=0,o=n.length;a<o;a++)n[a].isDataTexture?s.push(dU(n[a].image)):s.push(dU(n[a]))}else s=dU(n);r.url=s}return i||(e.images[this.uuid]=r),r}}function dU(t){return typeof HTMLImageElement<"u"&&t instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&t instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&t instanceof ImageBitmap?Voe.getDataURL(t):t.data?{data:Array.from(t.data),width:t.width,height:t.height,type:t.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}let MDe=0;const fU=new be;class ls extends af{constructor(e=ls.DEFAULT_IMAGE,i=ls.DEFAULT_MAPPING,r=gu,n=gu,s=ma,a=Id,o=zo,l=_u,c=ls.DEFAULT_ANISOTROPY,u=xp){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:MDe++}),this.uuid=Rc(),this.name="",this.source=new Cg(e),this.mipmaps=[],this.mapping=i,this.channel=0,this.wrapS=r,this.wrapT=n,this.magFilter=s,this.minFilter=a,this.anisotropy=c,this.format=o,this.internalFormat=null,this.type=l,this.offset=new At(0,0),this.repeat=new At(1,1),this.center=new At(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new lr,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.colorSpace=u,this.userData={},this.updateRanges=[],this.version=0,this.onUpdate=null,this.renderTarget=null,this.isRenderTargetTexture=!1,this.isArrayTexture=!!(e&&e.depth&&e.depth>1),this.pmremVersion=0}get width(){return this.source.getSize(fU).x}get height(){return this.source.getSize(fU).y}get depth(){return this.source.getSize(fU).z}get image(){return this.source.data}set image(e=null){this.source.data=e}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}addUpdateRange(e,i){this.updateRanges.push({start:e,count:i})}clearUpdateRanges(){this.updateRanges.length=0}clone(){return new this.constructor().copy(this)}copy(e){return this.name=e.name,this.source=e.source,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.channel=e.channel,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.colorSpace=e.colorSpace,this.renderTarget=e.renderTarget,this.isRenderTargetTexture=e.isRenderTargetTexture,this.isArrayTexture=e.isArrayTexture,this.userData=JSON.parse(JSON.stringify(e.userData)),this.needsUpdate=!0,this}setValues(e){for(const i in e){const r=e[i];if(r===void 0){console.warn(`THREE.Texture.setValues(): parameter '${i}' has value of undefined.`);continue}const n=this[i];if(n===void 0){console.warn(`THREE.Texture.setValues(): property '${i}' does not exist.`);continue}n&&r&&n.isVector2&&r.isVector2||n&&r&&n.isVector3&&r.isVector3||n&&r&&n.isMatrix3&&r.isMatrix3?n.copy(r):this[i]=r}}toJSON(e){const i=e===void 0||typeof e=="string";if(!i&&e.textures[this.uuid]!==void 0)return e.textures[this.uuid];const r={metadata:{version:4.7,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(e).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(r.userData=this.userData),i||(e.textures[this.uuid]=r),r}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(this.mapping!==gO)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case uM:e.x=e.x-Math.floor(e.x);break;case gu:e.x=e.x<0?0:1;break;case hM:Math.abs(Math.floor(e.x)%2)===1?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x);break}if(e.y<0||e.y>1)switch(this.wrapT){case uM:e.y=e.y-Math.floor(e.y);break;case gu:e.y=e.y<0?0:1;break;case hM:Math.abs(Math.floor(e.y)%2)===1?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y);break}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){e===!0&&(this.version++,this.source.needsUpdate=!0)}set needsPMREMUpdate(e){e===!0&&this.pmremVersion++}}ls.DEFAULT_IMAGE=null;ls.DEFAULT_MAPPING=gO;ls.DEFAULT_ANISOTROPY=1;class Ur{constructor(e=0,i=0,r=0,n=1){Ur.prototype.isVector4=!0,this.x=e,this.y=i,this.z=r,this.w=n}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,i,r,n){return this.x=e,this.y=i,this.z=r,this.w=n,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,i){switch(e){case 0:this.x=i;break;case 1:this.y=i;break;case 2:this.z=i;break;case 3:this.w=i;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w!==void 0?e.w:1,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,i){return this.x=e.x+i.x,this.y=e.y+i.y,this.z=e.z+i.z,this.w=e.w+i.w,this}addScaledVector(e,i){return this.x+=e.x*i,this.y+=e.y*i,this.z+=e.z*i,this.w+=e.w*i,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,i){return this.x=e.x-i.x,this.y=e.y-i.y,this.z=e.z-i.z,this.w=e.w-i.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){const i=this.x,r=this.y,n=this.z,s=this.w,a=e.elements;return this.x=a[0]*i+a[4]*r+a[8]*n+a[12]*s,this.y=a[1]*i+a[5]*r+a[9]*n+a[13]*s,this.z=a[2]*i+a[6]*r+a[10]*n+a[14]*s,this.w=a[3]*i+a[7]*r+a[11]*n+a[15]*s,this}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this.w/=e.w,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);const i=Math.sqrt(1-e.w*e.w);return i<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/i,this.y=e.y/i,this.z=e.z/i),this}setAxisAngleFromRotationMatrix(e){let i,r,n,s;const l=e.elements,c=l[0],u=l[4],h=l[8],d=l[1],f=l[5],p=l[9],g=l[2],m=l[6],y=l[10];if(Math.abs(u-d)<.01&&Math.abs(h-g)<.01&&Math.abs(p-m)<.01){if(Math.abs(u+d)<.1&&Math.abs(h+g)<.1&&Math.abs(p+m)<.1&&Math.abs(c+f+y-3)<.1)return this.set(1,0,0,0),this;i=Math.PI;const w=(c+1)/2,E=(f+1)/2,M=(y+1)/2,A=(u+d)/4,P=(h+g)/4,C=(p+m)/4;return w>E&&w>M?w<.01?(r=0,n=.707106781,s=.707106781):(r=Math.sqrt(w),n=A/r,s=P/r):E>M?E<.01?(r=.707106781,n=0,s=.707106781):(n=Math.sqrt(E),r=A/n,s=C/n):M<.01?(r=.707106781,n=.707106781,s=0):(s=Math.sqrt(M),r=P/s,n=C/s),this.set(r,n,s,i),this}let b=Math.sqrt((m-p)*(m-p)+(h-g)*(h-g)+(d-u)*(d-u));return Math.abs(b)<.001&&(b=1),this.x=(m-p)/b,this.y=(h-g)/b,this.z=(d-u)/b,this.w=Math.acos((c+f+y-1)/2),this}setFromMatrixPosition(e){const i=e.elements;return this.x=i[12],this.y=i[13],this.z=i[14],this.w=i[15],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,i){return this.x=Fi(this.x,e.x,i.x),this.y=Fi(this.y,e.y,i.y),this.z=Fi(this.z,e.z,i.z),this.w=Fi(this.w,e.w,i.w),this}clampScalar(e,i){return this.x=Fi(this.x,e,i),this.y=Fi(this.y,e,i),this.z=Fi(this.z,e,i),this.w=Fi(this.w,e,i),this}clampLength(e,i){const r=this.length();return this.divideScalar(r||1).multiplyScalar(Fi(r,e,i))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this.w=Math.trunc(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,i){return this.x+=(e.x-this.x)*i,this.y+=(e.y-this.y)*i,this.z+=(e.z-this.z)*i,this.w+=(e.w-this.w)*i,this}lerpVectors(e,i,r){return this.x=e.x+(i.x-e.x)*r,this.y=e.y+(i.y-e.y)*r,this.z=e.z+(i.z-e.z)*r,this.w=e.w+(i.w-e.w)*r,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e,i=0){return this.x=e[i],this.y=e[i+1],this.z=e[i+2],this.w=e[i+3],this}toArray(e=[],i=0){return e[i]=this.x,e[i+1]=this.y,e[i+2]=this.z,e[i+3]=this.w,e}fromBufferAttribute(e,i){return this.x=e.getX(i),this.y=e.getY(i),this.z=e.getZ(i),this.w=e.getW(i),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}class $6 extends af{constructor(e=1,i=1,r={}){super(),r=Object.assign({generateMipmaps:!1,internalFormat:null,minFilter:ma,depthBuffer:!0,stencilBuffer:!1,resolveDepthBuffer:!0,resolveStencilBuffer:!0,depthTexture:null,samples:0,count:1,depth:1,multiview:!1},r),this.isRenderTarget=!0,this.width=e,this.height=i,this.depth=r.depth,this.scissor=new Ur(0,0,e,i),this.scissorTest=!1,this.viewport=new Ur(0,0,e,i);const n={width:e,height:i,depth:r.depth},s=new ls(n);this.textures=[];const a=r.count;for(let o=0;o<a;o++)this.textures[o]=s.clone(),this.textures[o].isRenderTargetTexture=!0,this.textures[o].renderTarget=this;this._setTextureOptions(r),this.depthBuffer=r.depthBuffer,this.stencilBuffer=r.stencilBuffer,this.resolveDepthBuffer=r.resolveDepthBuffer,this.resolveStencilBuffer=r.resolveStencilBuffer,this._depthTexture=null,this.depthTexture=r.depthTexture,this.samples=r.samples,this.multiview=r.multiview}_setTextureOptions(e={}){const i={minFilter:ma,generateMipmaps:!1,flipY:!1,internalFormat:null};e.mapping!==void 0&&(i.mapping=e.mapping),e.wrapS!==void 0&&(i.wrapS=e.wrapS),e.wrapT!==void 0&&(i.wrapT=e.wrapT),e.wrapR!==void 0&&(i.wrapR=e.wrapR),e.magFilter!==void 0&&(i.magFilter=e.magFilter),e.minFilter!==void 0&&(i.minFilter=e.minFilter),e.format!==void 0&&(i.format=e.format),e.type!==void 0&&(i.type=e.type),e.anisotropy!==void 0&&(i.anisotropy=e.anisotropy),e.colorSpace!==void 0&&(i.colorSpace=e.colorSpace),e.flipY!==void 0&&(i.flipY=e.flipY),e.generateMipmaps!==void 0&&(i.generateMipmaps=e.generateMipmaps),e.internalFormat!==void 0&&(i.internalFormat=e.internalFormat);for(let r=0;r<this.textures.length;r++)this.textures[r].setValues(i)}get texture(){return this.textures[0]}set texture(e){this.textures[0]=e}set depthTexture(e){this._depthTexture!==null&&(this._depthTexture.renderTarget=null),e!==null&&(e.renderTarget=this),this._depthTexture=e}get depthTexture(){return this._depthTexture}setSize(e,i,r=1){if(this.width!==e||this.height!==i||this.depth!==r){this.width=e,this.height=i,this.depth=r;for(let n=0,s=this.textures.length;n<s;n++)this.textures[n].image.width=e,this.textures[n].image.height=i,this.textures[n].image.depth=r,this.textures[n].isArrayTexture=this.textures[n].image.depth>1;this.dispose()}this.viewport.set(0,0,e,i),this.scissor.set(0,0,e,i)}clone(){return new this.constructor().copy(this)}copy(e){this.width=e.width,this.height=e.height,this.depth=e.depth,this.scissor.copy(e.scissor),this.scissorTest=e.scissorTest,this.viewport.copy(e.viewport),this.textures.length=0;for(let i=0,r=e.textures.length;i<r;i++){this.textures[i]=e.textures[i].clone(),this.textures[i].isRenderTargetTexture=!0,this.textures[i].renderTarget=this;const n=Object.assign({},e.textures[i].image);this.textures[i].source=new Cg(n)}return this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,this.resolveDepthBuffer=e.resolveDepthBuffer,this.resolveStencilBuffer=e.resolveStencilBuffer,e.depthTexture!==null&&(this.depthTexture=e.depthTexture.clone()),this.samples=e.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}class Qd extends $6{constructor(e=1,i=1,r={}){super(e,i,r),this.isWebGLRenderTarget=!0}}class EO extends ls{constructor(e=null,i=1,r=1,n=1){super(null),this.isDataArrayTexture=!0,this.image={data:e,width:i,height:r,depth:n},this.magFilter=wo,this.minFilter=wo,this.wrapR=gu,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.layerUpdates=new Set}addLayerUpdate(e){this.layerUpdates.add(e)}clearLayerUpdates(){this.layerUpdates.clear()}}class TDe extends Qd{constructor(e=1,i=1,r=1,n={}){super(e,i,n),this.isWebGLArrayRenderTarget=!0,this.depth=r,this.texture=new EO(null,e,i,r),this._setTextureOptions(n),this.texture.isRenderTargetTexture=!0}}class AO extends ls{constructor(e=null,i=1,r=1,n=1){super(null),this.isData3DTexture=!0,this.image={data:e,width:i,height:r,depth:n},this.magFilter=wo,this.minFilter=wo,this.wrapR=gu,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class CDe extends Qd{constructor(e=1,i=1,r=1,n={}){super(e,i,n),this.isWebGL3DRenderTarget=!0,this.depth=r,this.texture=new AO(null,e,i,r),this._setTextureOptions(n),this.texture.isRenderTargetTexture=!0}}class Vo{constructor(e=new be(1/0,1/0,1/0),i=new be(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=e,this.max=i}set(e,i){return this.min.copy(e),this.max.copy(i),this}setFromArray(e){this.makeEmpty();for(let i=0,r=e.length;i<r;i+=3)this.expandByPoint(Qu.fromArray(e,i));return this}setFromBufferAttribute(e){this.makeEmpty();for(let i=0,r=e.count;i<r;i++)this.expandByPoint(Qu.fromBufferAttribute(e,i));return this}setFromPoints(e){this.makeEmpty();for(let i=0,r=e.length;i<r;i++)this.expandByPoint(e[i]);return this}setFromCenterAndSize(e,i){const r=Qu.copy(i).multiplyScalar(.5);return this.min.copy(e).sub(r),this.max.copy(e).add(r),this}setFromObject(e,i=!1){return this.makeEmpty(),this.expandByObject(e,i)}clone(){return new this.constructor().copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}expandByObject(e,i=!1){e.updateWorldMatrix(!1,!1);const r=e.geometry;if(r!==void 0){const s=r.getAttribute("position");if(i===!0&&s!==void 0&&e.isInstancedMesh!==!0)for(let a=0,o=s.count;a<o;a++)e.isMesh===!0?e.getVertexPosition(a,Qu):Qu.fromBufferAttribute(s,a),Qu.applyMatrix4(e.matrixWorld),this.expandByPoint(Qu);else e.boundingBox!==void 0?(e.boundingBox===null&&e.computeBoundingBox(),d2.copy(e.boundingBox)):(r.boundingBox===null&&r.computeBoundingBox(),d2.copy(r.boundingBox)),d2.applyMatrix4(e.matrixWorld),this.union(d2)}const n=e.children;for(let s=0,a=n.length;s<a;s++)this.expandByObject(n[s],i);return this}containsPoint(e){return e.x>=this.min.x&&e.x<=this.max.x&&e.y>=this.min.y&&e.y<=this.max.y&&e.z>=this.min.z&&e.z<=this.max.z}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}getParameter(e,i){return i.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(e){return e.max.x>=this.min.x&&e.min.x<=this.max.x&&e.max.y>=this.min.y&&e.min.y<=this.max.y&&e.max.z>=this.min.z&&e.min.z<=this.max.z}intersectsSphere(e){return this.clampPoint(e.center,Qu),Qu.distanceToSquared(e.center)<=e.radius*e.radius}intersectsPlane(e){let i,r;return e.normal.x>0?(i=e.normal.x*this.min.x,r=e.normal.x*this.max.x):(i=e.normal.x*this.max.x,r=e.normal.x*this.min.x),e.normal.y>0?(i+=e.normal.y*this.min.y,r+=e.normal.y*this.max.y):(i+=e.normal.y*this.max.y,r+=e.normal.y*this.min.y),e.normal.z>0?(i+=e.normal.z*this.min.z,r+=e.normal.z*this.max.z):(i+=e.normal.z*this.max.z,r+=e.normal.z*this.min.z),i<=-e.constant&&r>=-e.constant}intersectsTriangle(e){if(this.isEmpty())return!1;this.getCenter(HS),f2.subVectors(this.max,HS),hb.subVectors(e.a,HS),db.subVectors(e.b,HS),fb.subVectors(e.c,HS),Um.subVectors(db,hb),Bm.subVectors(fb,db),cy.subVectors(hb,fb);let i=[0,-Um.z,Um.y,0,-Bm.z,Bm.y,0,-cy.z,cy.y,Um.z,0,-Um.x,Bm.z,0,-Bm.x,cy.z,0,-cy.x,-Um.y,Um.x,0,-Bm.y,Bm.x,0,-cy.y,cy.x,0];return!pU(i,hb,db,fb,f2)||(i=[1,0,0,0,1,0,0,0,1],!pU(i,hb,db,fb,f2))?!1:(p2.crossVectors(Um,Bm),i=[p2.x,p2.y,p2.z],pU(i,hb,db,fb,f2))}clampPoint(e,i){return i.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return this.clampPoint(e,Qu).distanceTo(e)}getBoundingSphere(e){return this.isEmpty()?e.makeEmpty():(this.getCenter(e.center),e.radius=this.getSize(Qu).length()*.5),e}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}applyMatrix4(e){return this.isEmpty()?this:(Wf[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),Wf[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),Wf[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),Wf[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),Wf[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),Wf[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),Wf[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),Wf[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(Wf),this)}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}toJSON(){return{min:this.min.toArray(),max:this.max.toArray()}}fromJSON(e){return this.min.fromArray(e.min),this.max.fromArray(e.max),this}}const Wf=[new be,new be,new be,new be,new be,new be,new be,new be],Qu=new be,d2=new Vo,hb=new be,db=new be,fb=new be,Um=new be,Bm=new be,cy=new be,HS=new be,f2=new be,p2=new be,uy=new be;function pU(t,e,i,r,n){for(let s=0,a=t.length-3;s<=a;s+=3){uy.fromArray(t,s);const o=n.x*Math.abs(uy.x)+n.y*Math.abs(uy.y)+n.z*Math.abs(uy.z),l=e.dot(uy),c=i.dot(uy),u=r.dot(uy);if(Math.max(-Math.max(l,c,u),Math.min(l,c,u))>o)return!1}return!0}const PDe=new Vo,GS=new be,mU=new be;class _o{constructor(e=new be,i=-1){this.isSphere=!0,this.center=e,this.radius=i}set(e,i){return this.center.copy(e),this.radius=i,this}setFromPoints(e,i){const r=this.center;i!==void 0?r.copy(i):PDe.setFromPoints(e).getCenter(r);let n=0;for(let s=0,a=e.length;s<a;s++)n=Math.max(n,r.distanceToSquared(e[s]));return this.radius=Math.sqrt(n),this}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(e){return e.distanceTo(this.center)-this.radius}intersectsSphere(e){const i=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=i*i}intersectsBox(e){return e.intersectsSphere(this)}intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}clampPoint(e,i){const r=this.center.distanceToSquared(e);return i.copy(e),r>this.radius*this.radius&&(i.sub(this.center).normalize(),i.multiplyScalar(this.radius).add(this.center)),i}getBoundingBox(e){return this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}translate(e){return this.center.add(e),this}expandByPoint(e){if(this.isEmpty())return this.center.copy(e),this.radius=0,this;GS.subVectors(e,this.center);const i=GS.lengthSq();if(i>this.radius*this.radius){const r=Math.sqrt(i),n=(r-this.radius)*.5;this.center.addScaledVector(GS,n/r),this.radius+=n}return this}union(e){return e.isEmpty()?this:this.isEmpty()?(this.copy(e),this):(this.center.equals(e.center)===!0?this.radius=Math.max(this.radius,e.radius):(mU.subVectors(e.center,this.center).setLength(e.radius),this.expandByPoint(GS.copy(e.center).add(mU)),this.expandByPoint(GS.copy(e.center).sub(mU))),this)}equals(e){return e.center.equals(this.center)&&e.radius===this.radius}clone(){return new this.constructor().copy(this)}toJSON(){return{radius:this.radius,center:this.center.toArray()}}fromJSON(e){return this.radius=e.radius,this.center.fromArray(e.center),this}}const qf=new be,gU=new be,m2=new be,Fm=new be,vU=new be,g2=new be,yU=new be;class g_{constructor(e=new be,i=new be(0,0,-1)){this.origin=e,this.direction=i}set(e,i){return this.origin.copy(e),this.direction.copy(i),this}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}at(e,i){return i.copy(this.origin).addScaledVector(this.direction,e)}lookAt(e){return this.direction.copy(e).sub(this.origin).normalize(),this}recast(e){return this.origin.copy(this.at(e,qf)),this}closestPointToPoint(e,i){i.subVectors(e,this.origin);const r=i.dot(this.direction);return r<0?i.copy(this.origin):i.copy(this.origin).addScaledVector(this.direction,r)}distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}distanceSqToPoint(e){const i=qf.subVectors(e,this.origin).dot(this.direction);return i<0?this.origin.distanceToSquared(e):(qf.copy(this.origin).addScaledVector(this.direction,i),qf.distanceToSquared(e))}distanceSqToSegment(e,i,r,n){gU.copy(e).add(i).multiplyScalar(.5),m2.copy(i).sub(e).normalize(),Fm.copy(this.origin).sub(gU);const s=e.distanceTo(i)*.5,a=-this.direction.dot(m2),o=Fm.dot(this.direction),l=-Fm.dot(m2),c=Fm.lengthSq(),u=Math.abs(1-a*a);let h,d,f,p;if(u>0)if(h=a*l-o,d=a*o-l,p=s*u,h>=0)if(d>=-p)if(d<=p){const g=1/u;h*=g,d*=g,f=h*(h+a*d+2*o)+d*(a*h+d+2*l)+c}else d=s,h=Math.max(0,-(a*d+o)),f=-h*h+d*(d+2*l)+c;else d=-s,h=Math.max(0,-(a*d+o)),f=-h*h+d*(d+2*l)+c;else d<=-p?(h=Math.max(0,-(-a*s+o)),d=h>0?-s:Math.min(Math.max(-s,-l),s),f=-h*h+d*(d+2*l)+c):d<=p?(h=0,d=Math.min(Math.max(-s,-l),s),f=d*(d+2*l)+c):(h=Math.max(0,-(a*s+o)),d=h>0?s:Math.min(Math.max(-s,-l),s),f=-h*h+d*(d+2*l)+c);else d=a>0?-s:s,h=Math.max(0,-(a*d+o)),f=-h*h+d*(d+2*l)+c;return r&&r.copy(this.origin).addScaledVector(this.direction,h),n&&n.copy(gU).addScaledVector(m2,d),f}intersectSphere(e,i){qf.subVectors(e.center,this.origin);const r=qf.dot(this.direction),n=qf.dot(qf)-r*r,s=e.radius*e.radius;if(n>s)return null;const a=Math.sqrt(s-n),o=r-a,l=r+a;return l<0?null:o<0?this.at(l,i):this.at(o,i)}intersectsSphere(e){return e.radius<0?!1:this.distanceSqToPoint(e.center)<=e.radius*e.radius}distanceToPlane(e){const i=e.normal.dot(this.direction);if(i===0)return e.distanceToPoint(this.origin)===0?0:null;const r=-(this.origin.dot(e.normal)+e.constant)/i;return r>=0?r:null}intersectPlane(e,i){const r=this.distanceToPlane(e);return r===null?null:this.at(r,i)}intersectsPlane(e){const i=e.distanceToPoint(this.origin);return i===0||e.normal.dot(this.direction)*i<0}intersectBox(e,i){let r,n,s,a,o,l;const c=1/this.direction.x,u=1/this.direction.y,h=1/this.direction.z,d=this.origin;return c>=0?(r=(e.min.x-d.x)*c,n=(e.max.x-d.x)*c):(r=(e.max.x-d.x)*c,n=(e.min.x-d.x)*c),u>=0?(s=(e.min.y-d.y)*u,a=(e.max.y-d.y)*u):(s=(e.max.y-d.y)*u,a=(e.min.y-d.y)*u),r>a||s>n||((s>r||isNaN(r))&&(r=s),(a<n||isNaN(n))&&(n=a),h>=0?(o=(e.min.z-d.z)*h,l=(e.max.z-d.z)*h):(o=(e.max.z-d.z)*h,l=(e.min.z-d.z)*h),r>l||o>n)||((o>r||r!==r)&&(r=o),(l<n||n!==n)&&(n=l),n<0)?null:this.at(r>=0?r:n,i)}intersectsBox(e){return this.intersectBox(e,qf)!==null}intersectTriangle(e,i,r,n,s){vU.subVectors(i,e),g2.subVectors(r,e),yU.crossVectors(vU,g2);let a=this.direction.dot(yU),o;if(a>0){if(n)return null;o=1}else if(a<0)o=-1,a=-a;else return null;Fm.subVectors(this.origin,e);const l=o*this.direction.dot(g2.crossVectors(Fm,g2));if(l<0)return null;const c=o*this.direction.dot(vU.cross(Fm));if(c<0||l+c>a)return null;const u=-o*Fm.dot(yU);return u<0?null:this.at(u/a,s)}applyMatrix4(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}equals(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}clone(){return new this.constructor().copy(this)}}class zi{constructor(e,i,r,n,s,a,o,l,c,u,h,d,f,p,g,m){zi.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],e!==void 0&&this.set(e,i,r,n,s,a,o,l,c,u,h,d,f,p,g,m)}set(e,i,r,n,s,a,o,l,c,u,h,d,f,p,g,m){const y=this.elements;return y[0]=e,y[4]=i,y[8]=r,y[12]=n,y[1]=s,y[5]=a,y[9]=o,y[13]=l,y[2]=c,y[6]=u,y[10]=h,y[14]=d,y[3]=f,y[7]=p,y[11]=g,y[15]=m,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new zi().fromArray(this.elements)}copy(e){const i=this.elements,r=e.elements;return i[0]=r[0],i[1]=r[1],i[2]=r[2],i[3]=r[3],i[4]=r[4],i[5]=r[5],i[6]=r[6],i[7]=r[7],i[8]=r[8],i[9]=r[9],i[10]=r[10],i[11]=r[11],i[12]=r[12],i[13]=r[13],i[14]=r[14],i[15]=r[15],this}copyPosition(e){const i=this.elements,r=e.elements;return i[12]=r[12],i[13]=r[13],i[14]=r[14],this}setFromMatrix3(e){const i=e.elements;return this.set(i[0],i[3],i[6],0,i[1],i[4],i[7],0,i[2],i[5],i[8],0,0,0,0,1),this}extractBasis(e,i,r){return e.setFromMatrixColumn(this,0),i.setFromMatrixColumn(this,1),r.setFromMatrixColumn(this,2),this}makeBasis(e,i,r){return this.set(e.x,i.x,r.x,0,e.y,i.y,r.y,0,e.z,i.z,r.z,0,0,0,0,1),this}extractRotation(e){const i=this.elements,r=e.elements,n=1/pb.setFromMatrixColumn(e,0).length(),s=1/pb.setFromMatrixColumn(e,1).length(),a=1/pb.setFromMatrixColumn(e,2).length();return i[0]=r[0]*n,i[1]=r[1]*n,i[2]=r[2]*n,i[3]=0,i[4]=r[4]*s,i[5]=r[5]*s,i[6]=r[6]*s,i[7]=0,i[8]=r[8]*a,i[9]=r[9]*a,i[10]=r[10]*a,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,this}makeRotationFromEuler(e){const i=this.elements,r=e.x,n=e.y,s=e.z,a=Math.cos(r),o=Math.sin(r),l=Math.cos(n),c=Math.sin(n),u=Math.cos(s),h=Math.sin(s);if(e.order==="XYZ"){const d=a*u,f=a*h,p=o*u,g=o*h;i[0]=l*u,i[4]=-l*h,i[8]=c,i[1]=f+p*c,i[5]=d-g*c,i[9]=-o*l,i[2]=g-d*c,i[6]=p+f*c,i[10]=a*l}else if(e.order==="YXZ"){const d=l*u,f=l*h,p=c*u,g=c*h;i[0]=d+g*o,i[4]=p*o-f,i[8]=a*c,i[1]=a*h,i[5]=a*u,i[9]=-o,i[2]=f*o-p,i[6]=g+d*o,i[10]=a*l}else if(e.order==="ZXY"){const d=l*u,f=l*h,p=c*u,g=c*h;i[0]=d-g*o,i[4]=-a*h,i[8]=p+f*o,i[1]=f+p*o,i[5]=a*u,i[9]=g-d*o,i[2]=-a*c,i[6]=o,i[10]=a*l}else if(e.order==="ZYX"){const d=a*u,f=a*h,p=o*u,g=o*h;i[0]=l*u,i[4]=p*c-f,i[8]=d*c+g,i[1]=l*h,i[5]=g*c+d,i[9]=f*c-p,i[2]=-c,i[6]=o*l,i[10]=a*l}else if(e.order==="YZX"){const d=a*l,f=a*c,p=o*l,g=o*c;i[0]=l*u,i[4]=g-d*h,i[8]=p*h+f,i[1]=h,i[5]=a*u,i[9]=-o*u,i[2]=-c*u,i[6]=f*h+p,i[10]=d-g*h}else if(e.order==="XZY"){const d=a*l,f=a*c,p=o*l,g=o*c;i[0]=l*u,i[4]=-h,i[8]=c*u,i[1]=d*h+g,i[5]=a*u,i[9]=f*h-p,i[2]=p*h-f,i[6]=o*u,i[10]=g*h+d}return i[3]=0,i[7]=0,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,this}makeRotationFromQuaternion(e){return this.compose(RDe,e,IDe)}lookAt(e,i,r){const n=this.elements;return wc.subVectors(e,i),wc.lengthSq()===0&&(wc.z=1),wc.normalize(),zm.crossVectors(r,wc),zm.lengthSq()===0&&(Math.abs(r.z)===1?wc.x+=1e-4:wc.z+=1e-4,wc.normalize(),zm.crossVectors(r,wc)),zm.normalize(),v2.crossVectors(wc,zm),n[0]=zm.x,n[4]=v2.x,n[8]=wc.x,n[1]=zm.y,n[5]=v2.y,n[9]=wc.y,n[2]=zm.z,n[6]=v2.z,n[10]=wc.z,this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,i){const r=e.elements,n=i.elements,s=this.elements,a=r[0],o=r[4],l=r[8],c=r[12],u=r[1],h=r[5],d=r[9],f=r[13],p=r[2],g=r[6],m=r[10],y=r[14],b=r[3],w=r[7],E=r[11],M=r[15],A=n[0],P=n[4],C=n[8],R=n[12],I=n[1],k=n[5],z=n[9],V=n[13],F=n[2],$=n[6],K=n[10],X=n[14],U=n[3],Y=n[7],Z=n[11],j=n[15];return s[0]=a*A+o*I+l*F+c*U,s[4]=a*P+o*k+l*$+c*Y,s[8]=a*C+o*z+l*K+c*Z,s[12]=a*R+o*V+l*X+c*j,s[1]=u*A+h*I+d*F+f*U,s[5]=u*P+h*k+d*$+f*Y,s[9]=u*C+h*z+d*K+f*Z,s[13]=u*R+h*V+d*X+f*j,s[2]=p*A+g*I+m*F+y*U,s[6]=p*P+g*k+m*$+y*Y,s[10]=p*C+g*z+m*K+y*Z,s[14]=p*R+g*V+m*X+y*j,s[3]=b*A+w*I+E*F+M*U,s[7]=b*P+w*k+E*$+M*Y,s[11]=b*C+w*z+E*K+M*Z,s[15]=b*R+w*V+E*X+M*j,this}multiplyScalar(e){const i=this.elements;return i[0]*=e,i[4]*=e,i[8]*=e,i[12]*=e,i[1]*=e,i[5]*=e,i[9]*=e,i[13]*=e,i[2]*=e,i[6]*=e,i[10]*=e,i[14]*=e,i[3]*=e,i[7]*=e,i[11]*=e,i[15]*=e,this}determinant(){const e=this.elements,i=e[0],r=e[4],n=e[8],s=e[12],a=e[1],o=e[5],l=e[9],c=e[13],u=e[2],h=e[6],d=e[10],f=e[14],p=e[3],g=e[7],m=e[11],y=e[15];return p*(+s*l*h-n*c*h-s*o*d+r*c*d+n*o*f-r*l*f)+g*(+i*l*f-i*c*d+s*a*d-n*a*f+n*c*u-s*l*u)+m*(+i*c*h-i*o*f-s*a*h+r*a*f+s*o*u-r*c*u)+y*(-n*o*u-i*l*h+i*o*d+n*a*h-r*a*d+r*l*u)}transpose(){const e=this.elements;let i;return i=e[1],e[1]=e[4],e[4]=i,i=e[2],e[2]=e[8],e[8]=i,i=e[6],e[6]=e[9],e[9]=i,i=e[3],e[3]=e[12],e[12]=i,i=e[7],e[7]=e[13],e[13]=i,i=e[11],e[11]=e[14],e[14]=i,this}setPosition(e,i,r){const n=this.elements;return e.isVector3?(n[12]=e.x,n[13]=e.y,n[14]=e.z):(n[12]=e,n[13]=i,n[14]=r),this}invert(){const e=this.elements,i=e[0],r=e[1],n=e[2],s=e[3],a=e[4],o=e[5],l=e[6],c=e[7],u=e[8],h=e[9],d=e[10],f=e[11],p=e[12],g=e[13],m=e[14],y=e[15],b=h*m*c-g*d*c+g*l*f-o*m*f-h*l*y+o*d*y,w=p*d*c-u*m*c-p*l*f+a*m*f+u*l*y-a*d*y,E=u*g*c-p*h*c+p*o*f-a*g*f-u*o*y+a*h*y,M=p*h*l-u*g*l-p*o*d+a*g*d+u*o*m-a*h*m,A=i*b+r*w+n*E+s*M;if(A===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const P=1/A;return e[0]=b*P,e[1]=(g*d*s-h*m*s-g*n*f+r*m*f+h*n*y-r*d*y)*P,e[2]=(o*m*s-g*l*s+g*n*c-r*m*c-o*n*y+r*l*y)*P,e[3]=(h*l*s-o*d*s-h*n*c+r*d*c+o*n*f-r*l*f)*P,e[4]=w*P,e[5]=(u*m*s-p*d*s+p*n*f-i*m*f-u*n*y+i*d*y)*P,e[6]=(p*l*s-a*m*s-p*n*c+i*m*c+a*n*y-i*l*y)*P,e[7]=(a*d*s-u*l*s+u*n*c-i*d*c-a*n*f+i*l*f)*P,e[8]=E*P,e[9]=(p*h*s-u*g*s-p*r*f+i*g*f+u*r*y-i*h*y)*P,e[10]=(a*g*s-p*o*s+p*r*c-i*g*c-a*r*y+i*o*y)*P,e[11]=(u*o*s-a*h*s-u*r*c+i*h*c+a*r*f-i*o*f)*P,e[12]=M*P,e[13]=(u*g*n-p*h*n+p*r*d-i*g*d-u*r*m+i*h*m)*P,e[14]=(p*o*n-a*g*n-p*r*l+i*g*l+a*r*m-i*o*m)*P,e[15]=(a*h*n-u*o*n+u*r*l-i*h*l-a*r*d+i*o*d)*P,this}scale(e){const i=this.elements,r=e.x,n=e.y,s=e.z;return i[0]*=r,i[4]*=n,i[8]*=s,i[1]*=r,i[5]*=n,i[9]*=s,i[2]*=r,i[6]*=n,i[10]*=s,i[3]*=r,i[7]*=n,i[11]*=s,this}getMaxScaleOnAxis(){const e=this.elements,i=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],r=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],n=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(i,r,n))}makeTranslation(e,i,r){return e.isVector3?this.set(1,0,0,e.x,0,1,0,e.y,0,0,1,e.z,0,0,0,1):this.set(1,0,0,e,0,1,0,i,0,0,1,r,0,0,0,1),this}makeRotationX(e){const i=Math.cos(e),r=Math.sin(e);return this.set(1,0,0,0,0,i,-r,0,0,r,i,0,0,0,0,1),this}makeRotationY(e){const i=Math.cos(e),r=Math.sin(e);return this.set(i,0,r,0,0,1,0,0,-r,0,i,0,0,0,0,1),this}makeRotationZ(e){const i=Math.cos(e),r=Math.sin(e);return this.set(i,-r,0,0,r,i,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,i){const r=Math.cos(i),n=Math.sin(i),s=1-r,a=e.x,o=e.y,l=e.z,c=s*a,u=s*o;return this.set(c*a+r,c*o-n*l,c*l+n*o,0,c*o+n*l,u*o+r,u*l-n*a,0,c*l-n*o,u*l+n*a,s*l*l+r,0,0,0,0,1),this}makeScale(e,i,r){return this.set(e,0,0,0,0,i,0,0,0,0,r,0,0,0,0,1),this}makeShear(e,i,r,n,s,a){return this.set(1,r,s,0,e,1,a,0,i,n,1,0,0,0,0,1),this}compose(e,i,r){const n=this.elements,s=i._x,a=i._y,o=i._z,l=i._w,c=s+s,u=a+a,h=o+o,d=s*c,f=s*u,p=s*h,g=a*u,m=a*h,y=o*h,b=l*c,w=l*u,E=l*h,M=r.x,A=r.y,P=r.z;return n[0]=(1-(g+y))*M,n[1]=(f+E)*M,n[2]=(p-w)*M,n[3]=0,n[4]=(f-E)*A,n[5]=(1-(d+y))*A,n[6]=(m+b)*A,n[7]=0,n[8]=(p+w)*P,n[9]=(m-b)*P,n[10]=(1-(d+g))*P,n[11]=0,n[12]=e.x,n[13]=e.y,n[14]=e.z,n[15]=1,this}decompose(e,i,r){const n=this.elements;let s=pb.set(n[0],n[1],n[2]).length();const a=pb.set(n[4],n[5],n[6]).length(),o=pb.set(n[8],n[9],n[10]).length();this.determinant()<0&&(s=-s),e.x=n[12],e.y=n[13],e.z=n[14],Ju.copy(this);const c=1/s,u=1/a,h=1/o;return Ju.elements[0]*=c,Ju.elements[1]*=c,Ju.elements[2]*=c,Ju.elements[4]*=u,Ju.elements[5]*=u,Ju.elements[6]*=u,Ju.elements[8]*=h,Ju.elements[9]*=h,Ju.elements[10]*=h,i.setFromRotationMatrix(Ju),r.x=s,r.y=a,r.z=o,this}makePerspective(e,i,r,n,s,a,o=Cc,l=!1){const c=this.elements,u=2*s/(i-e),h=2*s/(r-n),d=(i+e)/(i-e),f=(r+n)/(r-n);let p,g;if(l)p=s/(a-s),g=a*s/(a-s);else if(o===Cc)p=-(a+s)/(a-s),g=-2*a*s/(a-s);else if(o===L1)p=-a/(a-s),g=-a*s/(a-s);else throw new Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+o);return c[0]=u,c[4]=0,c[8]=d,c[12]=0,c[1]=0,c[5]=h,c[9]=f,c[13]=0,c[2]=0,c[6]=0,c[10]=p,c[14]=g,c[3]=0,c[7]=0,c[11]=-1,c[15]=0,this}makeOrthographic(e,i,r,n,s,a,o=Cc,l=!1){const c=this.elements,u=2/(i-e),h=2/(r-n),d=-(i+e)/(i-e),f=-(r+n)/(r-n);let p,g;if(l)p=1/(a-s),g=a/(a-s);else if(o===Cc)p=-2/(a-s),g=-(a+s)/(a-s);else if(o===L1)p=-1/(a-s),g=-s/(a-s);else throw new Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+o);return c[0]=u,c[4]=0,c[8]=0,c[12]=d,c[1]=0,c[5]=h,c[9]=0,c[13]=f,c[2]=0,c[6]=0,c[10]=p,c[14]=g,c[3]=0,c[7]=0,c[11]=0,c[15]=1,this}equals(e){const i=this.elements,r=e.elements;for(let n=0;n<16;n++)if(i[n]!==r[n])return!1;return!0}fromArray(e,i=0){for(let r=0;r<16;r++)this.elements[r]=e[r+i];return this}toArray(e=[],i=0){const r=this.elements;return e[i]=r[0],e[i+1]=r[1],e[i+2]=r[2],e[i+3]=r[3],e[i+4]=r[4],e[i+5]=r[5],e[i+6]=r[6],e[i+7]=r[7],e[i+8]=r[8],e[i+9]=r[9],e[i+10]=r[10],e[i+11]=r[11],e[i+12]=r[12],e[i+13]=r[13],e[i+14]=r[14],e[i+15]=r[15],e}}const pb=new be,Ju=new zi,RDe=new be(0,0,0),IDe=new be(1,1,1),zm=new be,v2=new be,wc=new be,u$=new zi,h$=new sc;class kc{constructor(e=0,i=0,r=0,n=kc.DEFAULT_ORDER){this.isEuler=!0,this._x=e,this._y=i,this._z=r,this._order=n}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,i,r,n=this._order){return this._x=e,this._y=i,this._z=r,this._order=n,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e,i=this._order,r=!0){const n=e.elements,s=n[0],a=n[4],o=n[8],l=n[1],c=n[5],u=n[9],h=n[2],d=n[6],f=n[10];switch(i){case"XYZ":this._y=Math.asin(Fi(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(-u,f),this._z=Math.atan2(-a,s)):(this._x=Math.atan2(d,c),this._z=0);break;case"YXZ":this._x=Math.asin(-Fi(u,-1,1)),Math.abs(u)<.9999999?(this._y=Math.atan2(o,f),this._z=Math.atan2(l,c)):(this._y=Math.atan2(-h,s),this._z=0);break;case"ZXY":this._x=Math.asin(Fi(d,-1,1)),Math.abs(d)<.9999999?(this._y=Math.atan2(-h,f),this._z=Math.atan2(-a,c)):(this._y=0,this._z=Math.atan2(l,s));break;case"ZYX":this._y=Math.asin(-Fi(h,-1,1)),Math.abs(h)<.9999999?(this._x=Math.atan2(d,f),this._z=Math.atan2(l,s)):(this._x=0,this._z=Math.atan2(-a,c));break;case"YZX":this._z=Math.asin(Fi(l,-1,1)),Math.abs(l)<.9999999?(this._x=Math.atan2(-u,c),this._y=Math.atan2(-h,s)):(this._x=0,this._y=Math.atan2(o,f));break;case"XZY":this._z=Math.asin(-Fi(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(d,c),this._y=Math.atan2(o,s)):(this._x=Math.atan2(-u,f),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+i)}return this._order=i,r===!0&&this._onChangeCallback(),this}setFromQuaternion(e,i,r){return u$.makeRotationFromQuaternion(e),this.setFromRotationMatrix(u$,i,r)}setFromVector3(e,i=this._order){return this.set(e.x,e.y,e.z,i)}reorder(e){return h$.setFromEuler(this),this.setFromQuaternion(h$,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],e[3]!==void 0&&(this._order=e[3]),this._onChangeCallback(),this}toArray(e=[],i=0){return e[i]=this._x,e[i+1]=this._y,e[i+2]=this._z,e[i+3]=this._order,e}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}}kc.DEFAULT_ORDER="XYZ";class p0{constructor(){this.mask=1}set(e){this.mask=(1<<e|0)>>>0}enable(e){this.mask|=1<<e|0}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e|0}disable(e){this.mask&=~(1<<e|0)}disableAll(){this.mask=0}test(e){return(this.mask&e.mask)!==0}isEnabled(e){return(this.mask&(1<<e|0))!==0}}let DDe=0;const d$=new be,mb=new sc,Xf=new zi,y2=new be,WS=new be,ODe=new be,LDe=new sc,f$=new be(1,0,0),p$=new be(0,1,0),m$=new be(0,0,1),g$={type:"added"},kDe={type:"removed"},gb={type:"childadded",child:null},xU={type:"childremoved",child:null};class Br extends af{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:DDe++}),this.uuid=Rc(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=Br.DEFAULT_UP.clone();const e=new be,i=new kc,r=new sc,n=new be(1,1,1);function s(){r.setFromEuler(i,!1)}function a(){i.setFromQuaternion(r,void 0,!1)}i._onChange(s),r._onChange(a),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:i},quaternion:{configurable:!0,enumerable:!0,value:r},scale:{configurable:!0,enumerable:!0,value:n},modelViewMatrix:{value:new zi},normalMatrix:{value:new lr}}),this.matrix=new zi,this.matrixWorld=new zi,this.matrixAutoUpdate=Br.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldAutoUpdate=Br.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.layers=new p0,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.customDepthMaterial=void 0,this.customDistanceMaterial=void 0,this.userData={}}onBeforeShadow(){}onAfterShadow(){}onBeforeRender(){}onAfterRender(){}applyMatrix4(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(e){return this.quaternion.premultiply(e),this}setRotationFromAxisAngle(e,i){this.quaternion.setFromAxisAngle(e,i)}setRotationFromEuler(e){this.quaternion.setFromEuler(e,!0)}setRotationFromMatrix(e){this.quaternion.setFromRotationMatrix(e)}setRotationFromQuaternion(e){this.quaternion.copy(e)}rotateOnAxis(e,i){return mb.setFromAxisAngle(e,i),this.quaternion.multiply(mb),this}rotateOnWorldAxis(e,i){return mb.setFromAxisAngle(e,i),this.quaternion.premultiply(mb),this}rotateX(e){return this.rotateOnAxis(f$,e)}rotateY(e){return this.rotateOnAxis(p$,e)}rotateZ(e){return this.rotateOnAxis(m$,e)}translateOnAxis(e,i){return d$.copy(e).applyQuaternion(this.quaternion),this.position.add(d$.multiplyScalar(i)),this}translateX(e){return this.translateOnAxis(f$,e)}translateY(e){return this.translateOnAxis(p$,e)}translateZ(e){return this.translateOnAxis(m$,e)}localToWorld(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(this.matrixWorld)}worldToLocal(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(Xf.copy(this.matrixWorld).invert())}lookAt(e,i,r){e.isVector3?y2.copy(e):y2.set(e,i,r);const n=this.parent;this.updateWorldMatrix(!0,!1),WS.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?Xf.lookAt(WS,y2,this.up):Xf.lookAt(y2,WS,this.up),this.quaternion.setFromRotationMatrix(Xf),n&&(Xf.extractRotation(n.matrixWorld),mb.setFromRotationMatrix(Xf),this.quaternion.premultiply(mb.invert()))}add(e){if(arguments.length>1){for(let i=0;i<arguments.length;i++)this.add(arguments[i]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(e.removeFromParent(),e.parent=this,this.children.push(e),e.dispatchEvent(g$),gb.child=e,this.dispatchEvent(gb),gb.child=null):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)}remove(e){if(arguments.length>1){for(let r=0;r<arguments.length;r++)this.remove(arguments[r]);return this}const i=this.children.indexOf(e);return i!==-1&&(e.parent=null,this.children.splice(i,1),e.dispatchEvent(kDe),xU.child=e,this.dispatchEvent(xU),xU.child=null),this}removeFromParent(){const e=this.parent;return e!==null&&e.remove(this),this}clear(){return this.remove(...this.children)}attach(e){return this.updateWorldMatrix(!0,!1),Xf.copy(this.matrixWorld).invert(),e.parent!==null&&(e.parent.updateWorldMatrix(!0,!1),Xf.multiply(e.parent.matrixWorld)),e.applyMatrix4(Xf),e.removeFromParent(),e.parent=this,this.children.push(e),e.updateWorldMatrix(!1,!0),e.dispatchEvent(g$),gb.child=e,this.dispatchEvent(gb),gb.child=null,this}getObjectById(e){return this.getObjectByProperty("id",e)}getObjectByName(e){return this.getObjectByProperty("name",e)}getObjectByProperty(e,i){if(this[e]===i)return this;for(let r=0,n=this.children.length;r<n;r++){const a=this.children[r].getObjectByProperty(e,i);if(a!==void 0)return a}}getObjectsByProperty(e,i,r=[]){this[e]===i&&r.push(this);const n=this.children;for(let s=0,a=n.length;s<a;s++)n[s].getObjectsByProperty(e,i,r);return r}getWorldPosition(e){return this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(WS,e,ODe),e}getWorldScale(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(WS,LDe,e),e}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const i=this.matrixWorld.elements;return e.set(i[8],i[9],i[10]).normalize()}raycast(){}traverse(e){e(this);const i=this.children;for(let r=0,n=i.length;r<n;r++)i[r].traverse(e)}traverseVisible(e){if(this.visible===!1)return;e(this);const i=this.children;for(let r=0,n=i.length;r<n;r++)i[r].traverseVisible(e)}traverseAncestors(e){const i=this.parent;i!==null&&(e(i),i.traverseAncestors(e))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(this.matrixWorldAutoUpdate===!0&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),this.matrixWorldNeedsUpdate=!1,e=!0);const i=this.children;for(let r=0,n=i.length;r<n;r++)i[r].updateMatrixWorld(e)}updateWorldMatrix(e,i){const r=this.parent;if(e===!0&&r!==null&&r.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.matrixWorldAutoUpdate===!0&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),i===!0){const n=this.children;for(let s=0,a=n.length;s<a;s++)n[s].updateWorldMatrix(!1,!0)}}toJSON(e){const i=e===void 0||typeof e=="string",r={};i&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},r.metadata={version:4.7,type:"Object",generator:"Object3D.toJSON"});const n={};n.uuid=this.uuid,n.type=this.type,this.name!==""&&(n.name=this.name),this.castShadow===!0&&(n.castShadow=!0),this.receiveShadow===!0&&(n.receiveShadow=!0),this.visible===!1&&(n.visible=!1),this.frustumCulled===!1&&(n.frustumCulled=!1),this.renderOrder!==0&&(n.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(n.userData=this.userData),n.layers=this.layers.mask,n.matrix=this.matrix.toArray(),n.up=this.up.toArray(),this.matrixAutoUpdate===!1&&(n.matrixAutoUpdate=!1),this.isInstancedMesh&&(n.type="InstancedMesh",n.count=this.count,n.instanceMatrix=this.instanceMatrix.toJSON(),this.instanceColor!==null&&(n.instanceColor=this.instanceColor.toJSON())),this.isBatchedMesh&&(n.type="BatchedMesh",n.perObjectFrustumCulled=this.perObjectFrustumCulled,n.sortObjects=this.sortObjects,n.drawRanges=this._drawRanges,n.reservedRanges=this._reservedRanges,n.geometryInfo=this._geometryInfo.map(o=>({...o,boundingBox:o.boundingBox?o.boundingBox.toJSON():void 0,boundingSphere:o.boundingSphere?o.boundingSphere.toJSON():void 0})),n.instanceInfo=this._instanceInfo.map(o=>({...o})),n.availableInstanceIds=this._availableInstanceIds.slice(),n.availableGeometryIds=this._availableGeometryIds.slice(),n.nextIndexStart=this._nextIndexStart,n.nextVertexStart=this._nextVertexStart,n.geometryCount=this._geometryCount,n.maxInstanceCount=this._maxInstanceCount,n.maxVertexCount=this._maxVertexCount,n.maxIndexCount=this._maxIndexCount,n.geometryInitialized=this._geometryInitialized,n.matricesTexture=this._matricesTexture.toJSON(e),n.indirectTexture=this._indirectTexture.toJSON(e),this._colorsTexture!==null&&(n.colorsTexture=this._colorsTexture.toJSON(e)),this.boundingSphere!==null&&(n.boundingSphere=this.boundingSphere.toJSON()),this.boundingBox!==null&&(n.boundingBox=this.boundingBox.toJSON()));function s(o,l){return o[l.uuid]===void 0&&(o[l.uuid]=l.toJSON(e)),l.uuid}if(this.isScene)this.background&&(this.background.isColor?n.background=this.background.toJSON():this.background.isTexture&&(n.background=this.background.toJSON(e).uuid)),this.environment&&this.environment.isTexture&&this.environment.isRenderTargetTexture!==!0&&(n.environment=this.environment.toJSON(e).uuid);else if(this.isMesh||this.isLine||this.isPoints){n.geometry=s(e.geometries,this.geometry);const o=this.geometry.parameters;if(o!==void 0&&o.shapes!==void 0){const l=o.shapes;if(Array.isArray(l))for(let c=0,u=l.length;c<u;c++){const h=l[c];s(e.shapes,h)}else s(e.shapes,l)}}if(this.isSkinnedMesh&&(n.bindMode=this.bindMode,n.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(s(e.skeletons,this.skeleton),n.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){const o=[];for(let l=0,c=this.material.length;l<c;l++)o.push(s(e.materials,this.material[l]));n.material=o}else n.material=s(e.materials,this.material);if(this.children.length>0){n.children=[];for(let o=0;o<this.children.length;o++)n.children.push(this.children[o].toJSON(e).object)}if(this.animations.length>0){n.animations=[];for(let o=0;o<this.animations.length;o++){const l=this.animations[o];n.animations.push(s(e.animations,l))}}if(i){const o=a(e.geometries),l=a(e.materials),c=a(e.textures),u=a(e.images),h=a(e.shapes),d=a(e.skeletons),f=a(e.animations),p=a(e.nodes);o.length>0&&(r.geometries=o),l.length>0&&(r.materials=l),c.length>0&&(r.textures=c),u.length>0&&(r.images=u),h.length>0&&(r.shapes=h),d.length>0&&(r.skeletons=d),f.length>0&&(r.animations=f),p.length>0&&(r.nodes=p)}return r.object=n,r;function a(o){const l=[];for(const c in o){const u=o[c];delete u.metadata,l.push(u)}return l}}clone(e){return new this.constructor().copy(this,e)}copy(e,i=!0){if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldAutoUpdate=e.matrixWorldAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.animations=e.animations.slice(),this.userData=JSON.parse(JSON.stringify(e.userData)),i===!0)for(let r=0;r<e.children.length;r++){const n=e.children[r];this.add(n.clone())}return this}}Br.DEFAULT_UP=new be(0,1,0);Br.DEFAULT_MATRIX_AUTO_UPDATE=!0;Br.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;const eh=new be,$f=new be,bU=new be,Yf=new be,vb=new be,yb=new be,v$=new be,wU=new be,_U=new be,SU=new be,EU=new Ur,AU=new Ur,MU=new Ur;class Kl{constructor(e=new be,i=new be,r=new be){this.a=e,this.b=i,this.c=r}static getNormal(e,i,r,n){n.subVectors(r,i),eh.subVectors(e,i),n.cross(eh);const s=n.lengthSq();return s>0?n.multiplyScalar(1/Math.sqrt(s)):n.set(0,0,0)}static getBarycoord(e,i,r,n,s){eh.subVectors(n,i),$f.subVectors(r,i),bU.subVectors(e,i);const a=eh.dot(eh),o=eh.dot($f),l=eh.dot(bU),c=$f.dot($f),u=$f.dot(bU),h=a*c-o*o;if(h===0)return s.set(0,0,0),null;const d=1/h,f=(c*l-o*u)*d,p=(a*u-o*l)*d;return s.set(1-f-p,p,f)}static containsPoint(e,i,r,n){return this.getBarycoord(e,i,r,n,Yf)===null?!1:Yf.x>=0&&Yf.y>=0&&Yf.x+Yf.y<=1}static getInterpolation(e,i,r,n,s,a,o,l){return this.getBarycoord(e,i,r,n,Yf)===null?(l.x=0,l.y=0,"z"in l&&(l.z=0),"w"in l&&(l.w=0),null):(l.setScalar(0),l.addScaledVector(s,Yf.x),l.addScaledVector(a,Yf.y),l.addScaledVector(o,Yf.z),l)}static getInterpolatedAttribute(e,i,r,n,s,a){return EU.setScalar(0),AU.setScalar(0),MU.setScalar(0),EU.fromBufferAttribute(e,i),AU.fromBufferAttribute(e,r),MU.fromBufferAttribute(e,n),a.setScalar(0),a.addScaledVector(EU,s.x),a.addScaledVector(AU,s.y),a.addScaledVector(MU,s.z),a}static isFrontFacing(e,i,r,n){return eh.subVectors(r,i),$f.subVectors(e,i),eh.cross($f).dot(n)<0}set(e,i,r){return this.a.copy(e),this.b.copy(i),this.c.copy(r),this}setFromPointsAndIndices(e,i,r,n){return this.a.copy(e[i]),this.b.copy(e[r]),this.c.copy(e[n]),this}setFromAttributeAndIndices(e,i,r,n){return this.a.fromBufferAttribute(e,i),this.b.fromBufferAttribute(e,r),this.c.fromBufferAttribute(e,n),this}clone(){return new this.constructor().copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return eh.subVectors(this.c,this.b),$f.subVectors(this.a,this.b),eh.cross($f).length()*.5}getMidpoint(e){return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return Kl.getNormal(this.a,this.b,this.c,e)}getPlane(e){return e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,i){return Kl.getBarycoord(e,this.a,this.b,this.c,i)}getInterpolation(e,i,r,n,s){return Kl.getInterpolation(e,this.a,this.b,this.c,i,r,n,s)}containsPoint(e){return Kl.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return Kl.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,i){const r=this.a,n=this.b,s=this.c;let a,o;vb.subVectors(n,r),yb.subVectors(s,r),wU.subVectors(e,r);const l=vb.dot(wU),c=yb.dot(wU);if(l<=0&&c<=0)return i.copy(r);_U.subVectors(e,n);const u=vb.dot(_U),h=yb.dot(_U);if(u>=0&&h<=u)return i.copy(n);const d=l*h-u*c;if(d<=0&&l>=0&&u<=0)return a=l/(l-u),i.copy(r).addScaledVector(vb,a);SU.subVectors(e,s);const f=vb.dot(SU),p=yb.dot(SU);if(p>=0&&f<=p)return i.copy(s);const g=f*c-l*p;if(g<=0&&c>=0&&p<=0)return o=c/(c-p),i.copy(r).addScaledVector(yb,o);const m=u*p-f*h;if(m<=0&&h-u>=0&&f-p>=0)return v$.subVectors(s,n),o=(h-u)/(h-u+(f-p)),i.copy(n).addScaledVector(v$,o);const y=1/(m+g+d);return a=g*y,o=d*y,i.copy(r).addScaledVector(vb,a).addScaledVector(yb,o)}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}}const Hoe={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},jm={h:0,s:0,l:0},x2={h:0,s:0,l:0};function TU(t,e,i){return i<0&&(i+=1),i>1&&(i-=1),i<1/6?t+(e-t)*6*i:i<1/2?e:i<2/3?t+(e-t)*6*(2/3-i):t}class ii{constructor(e,i,r){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(e,i,r)}set(e,i,r){if(i===void 0&&r===void 0){const n=e;n&&n.isColor?this.copy(n):typeof n=="number"?this.setHex(n):typeof n=="string"&&this.setStyle(n)}else this.setRGB(e,i,r);return this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e,i=Wl){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(e&255)/255,Lr.colorSpaceToWorking(this,i),this}setRGB(e,i,r,n=Lr.workingColorSpace){return this.r=e,this.g=i,this.b=r,Lr.colorSpaceToWorking(this,n),this}setHSL(e,i,r,n=Lr.workingColorSpace){if(e=X6(e,1),i=Fi(i,0,1),r=Fi(r,0,1),i===0)this.r=this.g=this.b=r;else{const s=r<=.5?r*(1+i):r+i-r*i,a=2*r-s;this.r=TU(a,s,e+1/3),this.g=TU(a,s,e),this.b=TU(a,s,e-1/3)}return Lr.colorSpaceToWorking(this,n),this}setStyle(e,i=Wl){function r(s){s!==void 0&&parseFloat(s)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}let n;if(n=/^(\w+)\(([^\)]*)\)/.exec(e)){let s;const a=n[1],o=n[2];switch(a){case"rgb":case"rgba":if(s=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return r(s[4]),this.setRGB(Math.min(255,parseInt(s[1],10))/255,Math.min(255,parseInt(s[2],10))/255,Math.min(255,parseInt(s[3],10))/255,i);if(s=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return r(s[4]),this.setRGB(Math.min(100,parseInt(s[1],10))/100,Math.min(100,parseInt(s[2],10))/100,Math.min(100,parseInt(s[3],10))/100,i);break;case"hsl":case"hsla":if(s=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return r(s[4]),this.setHSL(parseFloat(s[1])/360,parseFloat(s[2])/100,parseFloat(s[3])/100,i);break;default:console.warn("THREE.Color: Unknown color model "+e)}}else if(n=/^\#([A-Fa-f\d]+)$/.exec(e)){const s=n[1],a=s.length;if(a===3)return this.setRGB(parseInt(s.charAt(0),16)/15,parseInt(s.charAt(1),16)/15,parseInt(s.charAt(2),16)/15,i);if(a===6)return this.setHex(parseInt(s,16),i);console.warn("THREE.Color: Invalid hex color "+e)}else if(e&&e.length>0)return this.setColorName(e,i);return this}setColorName(e,i=Wl){const r=Hoe[e.toLowerCase()];return r!==void 0?this.setHex(r,i):console.warn("THREE.Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copySRGBToLinear(e){return this.r=Op(e.r),this.g=Op(e.g),this.b=Op(e.b),this}copyLinearToSRGB(e){return this.r=t1(e.r),this.g=t1(e.g),this.b=t1(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(e=Wl){return Lr.workingToColorSpace(Oo.copy(this),e),Math.round(Fi(Oo.r*255,0,255))*65536+Math.round(Fi(Oo.g*255,0,255))*256+Math.round(Fi(Oo.b*255,0,255))}getHexString(e=Wl){return("000000"+this.getHex(e).toString(16)).slice(-6)}getHSL(e,i=Lr.workingColorSpace){Lr.workingToColorSpace(Oo.copy(this),i);const r=Oo.r,n=Oo.g,s=Oo.b,a=Math.max(r,n,s),o=Math.min(r,n,s);let l,c;const u=(o+a)/2;if(o===a)l=0,c=0;else{const h=a-o;switch(c=u<=.5?h/(a+o):h/(2-a-o),a){case r:l=(n-s)/h+(n<s?6:0);break;case n:l=(s-r)/h+2;break;case s:l=(r-n)/h+4;break}l/=6}return e.h=l,e.s=c,e.l=u,e}getRGB(e,i=Lr.workingColorSpace){return Lr.workingToColorSpace(Oo.copy(this),i),e.r=Oo.r,e.g=Oo.g,e.b=Oo.b,e}getStyle(e=Wl){Lr.workingToColorSpace(Oo.copy(this),e);const i=Oo.r,r=Oo.g,n=Oo.b;return e!==Wl?`color(${e} ${i.toFixed(3)} ${r.toFixed(3)} ${n.toFixed(3)})`:`rgb(${Math.round(i*255)},${Math.round(r*255)},${Math.round(n*255)})`}offsetHSL(e,i,r){return this.getHSL(jm),this.setHSL(jm.h+e,jm.s+i,jm.l+r)}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,i){return this.r=e.r+i.r,this.g=e.g+i.g,this.b=e.b+i.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,i){return this.r+=(e.r-this.r)*i,this.g+=(e.g-this.g)*i,this.b+=(e.b-this.b)*i,this}lerpColors(e,i,r){return this.r=e.r+(i.r-e.r)*r,this.g=e.g+(i.g-e.g)*r,this.b=e.b+(i.b-e.b)*r,this}lerpHSL(e,i){this.getHSL(jm),e.getHSL(x2);const r=SA(jm.h,x2.h,i),n=SA(jm.s,x2.s,i),s=SA(jm.l,x2.l,i);return this.setHSL(r,n,s),this}setFromVector3(e){return this.r=e.x,this.g=e.y,this.b=e.z,this}applyMatrix3(e){const i=this.r,r=this.g,n=this.b,s=e.elements;return this.r=s[0]*i+s[3]*r+s[6]*n,this.g=s[1]*i+s[4]*r+s[7]*n,this.b=s[2]*i+s[5]*r+s[8]*n,this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,i=0){return this.r=e[i],this.g=e[i+1],this.b=e[i+2],this}toArray(e=[],i=0){return e[i]=this.r,e[i+1]=this.g,e[i+2]=this.b,e}fromBufferAttribute(e,i){return this.r=e.getX(i),this.g=e.getY(i),this.b=e.getZ(i),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}const Oo=new ii;ii.NAMES=Hoe;let NDe=0;class Go extends af{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:NDe++}),this.uuid=Rc(),this.name="",this.type="Material",this.blending=h0,this.side=Fp,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.alphaHash=!1,this.blendSrc=VI,this.blendDst=HI,this.blendEquation=vg,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.blendColor=new ii(0,0,0),this.blendAlpha=0,this.depthFunc=M0,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=Xz,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=Ly,this.stencilZFail=Ly,this.stencilZPass=Ly,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.allowOverride=!0,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(e){this._alphaTest>0!=e>0&&this.version++,this._alphaTest=e}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(e){if(e!==void 0)for(const i in e){const r=e[i];if(r===void 0){console.warn(`THREE.Material: parameter '${i}' has value of undefined.`);continue}const n=this[i];if(n===void 0){console.warn(`THREE.Material: '${i}' is not a property of THREE.${this.type}.`);continue}n&&n.isColor?n.set(r):n&&n.isVector3&&r&&r.isVector3?n.copy(r):this[i]=r}}toJSON(e){const i=e===void 0||typeof e=="string";i&&(e={textures:{},images:{}});const r={metadata:{version:4.7,type:"Material",generator:"Material.toJSON"}};r.uuid=this.uuid,r.type=this.type,this.name!==""&&(r.name=this.name),this.color&&this.color.isColor&&(r.color=this.color.getHex()),this.roughness!==void 0&&(r.roughness=this.roughness),this.metalness!==void 0&&(r.metalness=this.metalness),this.sheen!==void 0&&(r.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(r.sheenColor=this.sheenColor.getHex()),this.sheenRoughness!==void 0&&(r.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(r.emissive=this.emissive.getHex()),this.emissiveIntensity!==void 0&&this.emissiveIntensity!==1&&(r.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(r.specular=this.specular.getHex()),this.specularIntensity!==void 0&&(r.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(r.specularColor=this.specularColor.getHex()),this.shininess!==void 0&&(r.shininess=this.shininess),this.clearcoat!==void 0&&(r.clearcoat=this.clearcoat),this.clearcoatRoughness!==void 0&&(r.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(r.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(r.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(r.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,r.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.sheenColorMap&&this.sheenColorMap.isTexture&&(r.sheenColorMap=this.sheenColorMap.toJSON(e).uuid),this.sheenRoughnessMap&&this.sheenRoughnessMap.isTexture&&(r.sheenRoughnessMap=this.sheenRoughnessMap.toJSON(e).uuid),this.dispersion!==void 0&&(r.dispersion=this.dispersion),this.iridescence!==void 0&&(r.iridescence=this.iridescence),this.iridescenceIOR!==void 0&&(r.iridescenceIOR=this.iridescenceIOR),this.iridescenceThicknessRange!==void 0&&(r.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(r.iridescenceMap=this.iridescenceMap.toJSON(e).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(r.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(e).uuid),this.anisotropy!==void 0&&(r.anisotropy=this.anisotropy),this.anisotropyRotation!==void 0&&(r.anisotropyRotation=this.anisotropyRotation),this.anisotropyMap&&this.anisotropyMap.isTexture&&(r.anisotropyMap=this.anisotropyMap.toJSON(e).uuid),this.map&&this.map.isTexture&&(r.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(r.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(r.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(r.lightMap=this.lightMap.toJSON(e).uuid,r.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(r.aoMap=this.aoMap.toJSON(e).uuid,r.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(r.bumpMap=this.bumpMap.toJSON(e).uuid,r.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(r.normalMap=this.normalMap.toJSON(e).uuid,r.normalMapType=this.normalMapType,r.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(r.displacementMap=this.displacementMap.toJSON(e).uuid,r.displacementScale=this.displacementScale,r.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(r.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(r.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(r.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(r.specularMap=this.specularMap.toJSON(e).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(r.specularIntensityMap=this.specularIntensityMap.toJSON(e).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(r.specularColorMap=this.specularColorMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(r.envMap=this.envMap.toJSON(e).uuid,this.combine!==void 0&&(r.combine=this.combine)),this.envMapRotation!==void 0&&(r.envMapRotation=this.envMapRotation.toArray()),this.envMapIntensity!==void 0&&(r.envMapIntensity=this.envMapIntensity),this.reflectivity!==void 0&&(r.reflectivity=this.reflectivity),this.refractionRatio!==void 0&&(r.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(r.gradientMap=this.gradientMap.toJSON(e).uuid),this.transmission!==void 0&&(r.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(r.transmissionMap=this.transmissionMap.toJSON(e).uuid),this.thickness!==void 0&&(r.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(r.thicknessMap=this.thicknessMap.toJSON(e).uuid),this.attenuationDistance!==void 0&&this.attenuationDistance!==1/0&&(r.attenuationDistance=this.attenuationDistance),this.attenuationColor!==void 0&&(r.attenuationColor=this.attenuationColor.getHex()),this.size!==void 0&&(r.size=this.size),this.shadowSide!==null&&(r.shadowSide=this.shadowSide),this.sizeAttenuation!==void 0&&(r.sizeAttenuation=this.sizeAttenuation),this.blending!==h0&&(r.blending=this.blending),this.side!==Fp&&(r.side=this.side),this.vertexColors===!0&&(r.vertexColors=!0),this.opacity<1&&(r.opacity=this.opacity),this.transparent===!0&&(r.transparent=!0),this.blendSrc!==VI&&(r.blendSrc=this.blendSrc),this.blendDst!==HI&&(r.blendDst=this.blendDst),this.blendEquation!==vg&&(r.blendEquation=this.blendEquation),this.blendSrcAlpha!==null&&(r.blendSrcAlpha=this.blendSrcAlpha),this.blendDstAlpha!==null&&(r.blendDstAlpha=this.blendDstAlpha),this.blendEquationAlpha!==null&&(r.blendEquationAlpha=this.blendEquationAlpha),this.blendColor&&this.blendColor.isColor&&(r.blendColor=this.blendColor.getHex()),this.blendAlpha!==0&&(r.blendAlpha=this.blendAlpha),this.depthFunc!==M0&&(r.depthFunc=this.depthFunc),this.depthTest===!1&&(r.depthTest=this.depthTest),this.depthWrite===!1&&(r.depthWrite=this.depthWrite),this.colorWrite===!1&&(r.colorWrite=this.colorWrite),this.stencilWriteMask!==255&&(r.stencilWriteMask=this.stencilWriteMask),this.stencilFunc!==Xz&&(r.stencilFunc=this.stencilFunc),this.stencilRef!==0&&(r.stencilRef=this.stencilRef),this.stencilFuncMask!==255&&(r.stencilFuncMask=this.stencilFuncMask),this.stencilFail!==Ly&&(r.stencilFail=this.stencilFail),this.stencilZFail!==Ly&&(r.stencilZFail=this.stencilZFail),this.stencilZPass!==Ly&&(r.stencilZPass=this.stencilZPass),this.stencilWrite===!0&&(r.stencilWrite=this.stencilWrite),this.rotation!==void 0&&this.rotation!==0&&(r.rotation=this.rotation),this.polygonOffset===!0&&(r.polygonOffset=!0),this.polygonOffsetFactor!==0&&(r.polygonOffsetFactor=this.polygonOffsetFactor),this.polygonOffsetUnits!==0&&(r.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth!==void 0&&this.linewidth!==1&&(r.linewidth=this.linewidth),this.dashSize!==void 0&&(r.dashSize=this.dashSize),this.gapSize!==void 0&&(r.gapSize=this.gapSize),this.scale!==void 0&&(r.scale=this.scale),this.dithering===!0&&(r.dithering=!0),this.alphaTest>0&&(r.alphaTest=this.alphaTest),this.alphaHash===!0&&(r.alphaHash=!0),this.alphaToCoverage===!0&&(r.alphaToCoverage=!0),this.premultipliedAlpha===!0&&(r.premultipliedAlpha=!0),this.forceSinglePass===!0&&(r.forceSinglePass=!0),this.wireframe===!0&&(r.wireframe=!0),this.wireframeLinewidth>1&&(r.wireframeLinewidth=this.wireframeLinewidth),this.wireframeLinecap!=="round"&&(r.wireframeLinecap=this.wireframeLinecap),this.wireframeLinejoin!=="round"&&(r.wireframeLinejoin=this.wireframeLinejoin),this.flatShading===!0&&(r.flatShading=!0),this.visible===!1&&(r.visible=!1),this.toneMapped===!1&&(r.toneMapped=!1),this.fog===!1&&(r.fog=!1),Object.keys(this.userData).length>0&&(r.userData=this.userData);function n(s){const a=[];for(const o in s){const l=s[o];delete l.metadata,a.push(l)}return a}if(i){const s=n(e.textures),a=n(e.images);s.length>0&&(r.textures=s),a.length>0&&(r.images=a)}return r}clone(){return new this.constructor().copy(this)}copy(e){this.name=e.name,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.blendColor.copy(e.blendColor),this.blendAlpha=e.blendAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;const i=e.clippingPlanes;let r=null;if(i!==null){const n=i.length;r=new Array(n);for(let s=0;s!==n;++s)r[s]=i[s].clone()}return this.clippingPlanes=r,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaHash=e.alphaHash,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.forceSinglePass=e.forceSinglePass,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(e){e===!0&&this.version++}}class uv extends Go{constructor(e){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new ii(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new kc,this.combine=gT,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}const bp=UDe();function UDe(){const t=new ArrayBuffer(4),e=new Float32Array(t),i=new Uint32Array(t),r=new Uint32Array(512),n=new Uint32Array(512);for(let l=0;l<256;++l){const c=l-127;c<-27?(r[l]=0,r[l|256]=32768,n[l]=24,n[l|256]=24):c<-14?(r[l]=1024>>-c-14,r[l|256]=1024>>-c-14|32768,n[l]=-c-1,n[l|256]=-c-1):c<=15?(r[l]=c+15<<10,r[l|256]=c+15<<10|32768,n[l]=13,n[l|256]=13):c<128?(r[l]=31744,r[l|256]=64512,n[l]=24,n[l|256]=24):(r[l]=31744,r[l|256]=64512,n[l]=13,n[l|256]=13)}const s=new Uint32Array(2048),a=new Uint32Array(64),o=new Uint32Array(64);for(let l=1;l<1024;++l){let c=l<<13,u=0;for(;(c&8388608)===0;)c<<=1,u-=8388608;c&=-8388609,u+=947912704,s[l]=c|u}for(let l=1024;l<2048;++l)s[l]=939524096+(l-1024<<13);for(let l=1;l<31;++l)a[l]=l<<23;a[31]=1199570944,a[32]=2147483648;for(let l=33;l<63;++l)a[l]=2147483648+(l-32<<23);a[63]=3347054592;for(let l=1;l<64;++l)l!==32&&(o[l]=1024);return{floatView:e,uint32View:i,baseTable:r,shiftTable:n,mantissaTable:s,exponentTable:a,offsetTable:o}}function jl(t){Math.abs(t)>65504&&console.warn("THREE.DataUtils.toHalfFloat(): Value out of range."),t=Fi(t,-65504,65504),bp.floatView[0]=t;const e=bp.uint32View[0],i=e>>23&511;return bp.baseTable[i]+((e&8388607)>>bp.shiftTable[i])}function BE(t){const e=t>>10;return bp.uint32View[0]=bp.mantissaTable[bp.offsetTable[e]+(t&1023)]+bp.exponentTable[e],bp.floatView[0]}class BDe{static toHalfFloat(e){return jl(e)}static fromHalfFloat(e){return BE(e)}}const Ds=new be,b2=new At;let FDe=0;class xn{constructor(e,i,r=!1){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,Object.defineProperty(this,"id",{value:FDe++}),this.name="",this.array=e,this.itemSize=i,this.count=e!==void 0?e.length/i:0,this.normalized=r,this.usage=mM,this.updateRanges=[],this.gpuType=tc,this.version=0}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}setUsage(e){return this.usage=e,this}addUpdateRange(e,i){this.updateRanges.push({start:e,count:i})}clearUpdateRanges(){this.updateRanges.length=0}copy(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this.gpuType=e.gpuType,this}copyAt(e,i,r){e*=this.itemSize,r*=i.itemSize;for(let n=0,s=this.itemSize;n<s;n++)this.array[e+n]=i.array[r+n];return this}copyArray(e){return this.array.set(e),this}applyMatrix3(e){if(this.itemSize===2)for(let i=0,r=this.count;i<r;i++)b2.fromBufferAttribute(this,i),b2.applyMatrix3(e),this.setXY(i,b2.x,b2.y);else if(this.itemSize===3)for(let i=0,r=this.count;i<r;i++)Ds.fromBufferAttribute(this,i),Ds.applyMatrix3(e),this.setXYZ(i,Ds.x,Ds.y,Ds.z);return this}applyMatrix4(e){for(let i=0,r=this.count;i<r;i++)Ds.fromBufferAttribute(this,i),Ds.applyMatrix4(e),this.setXYZ(i,Ds.x,Ds.y,Ds.z);return this}applyNormalMatrix(e){for(let i=0,r=this.count;i<r;i++)Ds.fromBufferAttribute(this,i),Ds.applyNormalMatrix(e),this.setXYZ(i,Ds.x,Ds.y,Ds.z);return this}transformDirection(e){for(let i=0,r=this.count;i<r;i++)Ds.fromBufferAttribute(this,i),Ds.transformDirection(e),this.setXYZ(i,Ds.x,Ds.y,Ds.z);return this}set(e,i=0){return this.array.set(e,i),this}getComponent(e,i){let r=this.array[e*this.itemSize+i];return this.normalized&&(r=pl(r,this.array)),r}setComponent(e,i,r){return this.normalized&&(r=hr(r,this.array)),this.array[e*this.itemSize+i]=r,this}getX(e){let i=this.array[e*this.itemSize];return this.normalized&&(i=pl(i,this.array)),i}setX(e,i){return this.normalized&&(i=hr(i,this.array)),this.array[e*this.itemSize]=i,this}getY(e){let i=this.array[e*this.itemSize+1];return this.normalized&&(i=pl(i,this.array)),i}setY(e,i){return this.normalized&&(i=hr(i,this.array)),this.array[e*this.itemSize+1]=i,this}getZ(e){let i=this.array[e*this.itemSize+2];return this.normalized&&(i=pl(i,this.array)),i}setZ(e,i){return this.normalized&&(i=hr(i,this.array)),this.array[e*this.itemSize+2]=i,this}getW(e){let i=this.array[e*this.itemSize+3];return this.normalized&&(i=pl(i,this.array)),i}setW(e,i){return this.normalized&&(i=hr(i,this.array)),this.array[e*this.itemSize+3]=i,this}setXY(e,i,r){return e*=this.itemSize,this.normalized&&(i=hr(i,this.array),r=hr(r,this.array)),this.array[e+0]=i,this.array[e+1]=r,this}setXYZ(e,i,r,n){return e*=this.itemSize,this.normalized&&(i=hr(i,this.array),r=hr(r,this.array),n=hr(n,this.array)),this.array[e+0]=i,this.array[e+1]=r,this.array[e+2]=n,this}setXYZW(e,i,r,n,s){return e*=this.itemSize,this.normalized&&(i=hr(i,this.array),r=hr(r,this.array),n=hr(n,this.array),s=hr(s,this.array)),this.array[e+0]=i,this.array[e+1]=r,this.array[e+2]=n,this.array[e+3]=s,this}onUpload(e){return this.onUploadCallback=e,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return this.name!==""&&(e.name=this.name),this.usage!==mM&&(e.usage=this.usage),e}}class zDe extends xn{constructor(e,i,r){super(new Int8Array(e),i,r)}}class jDe extends xn{constructor(e,i,r){super(new Uint8Array(e),i,r)}}class VDe extends xn{constructor(e,i,r){super(new Uint8ClampedArray(e),i,r)}}class HDe extends xn{constructor(e,i,r){super(new Int16Array(e),i,r)}}class Y6 extends xn{constructor(e,i,r){super(new Uint16Array(e),i,r)}}class GDe extends xn{constructor(e,i,r){super(new Int32Array(e),i,r)}}class K6 extends xn{constructor(e,i,r){super(new Uint32Array(e),i,r)}}class WDe extends xn{constructor(e,i,r){super(new Uint16Array(e),i,r),this.isFloat16BufferAttribute=!0}getX(e){let i=BE(this.array[e*this.itemSize]);return this.normalized&&(i=pl(i,this.array)),i}setX(e,i){return this.normalized&&(i=hr(i,this.array)),this.array[e*this.itemSize]=jl(i),this}getY(e){let i=BE(this.array[e*this.itemSize+1]);return this.normalized&&(i=pl(i,this.array)),i}setY(e,i){return this.normalized&&(i=hr(i,this.array)),this.array[e*this.itemSize+1]=jl(i),this}getZ(e){let i=BE(this.array[e*this.itemSize+2]);return this.normalized&&(i=pl(i,this.array)),i}setZ(e,i){return this.normalized&&(i=hr(i,this.array)),this.array[e*this.itemSize+2]=jl(i),this}getW(e){let i=BE(this.array[e*this.itemSize+3]);return this.normalized&&(i=pl(i,this.array)),i}setW(e,i){return this.normalized&&(i=hr(i,this.array)),this.array[e*this.itemSize+3]=jl(i),this}setXY(e,i,r){return e*=this.itemSize,this.normalized&&(i=hr(i,this.array),r=hr(r,this.array)),this.array[e+0]=jl(i),this.array[e+1]=jl(r),this}setXYZ(e,i,r,n){return e*=this.itemSize,this.normalized&&(i=hr(i,this.array),r=hr(r,this.array),n=hr(n,this.array)),this.array[e+0]=jl(i),this.array[e+1]=jl(r),this.array[e+2]=jl(n),this}setXYZW(e,i,r,n,s){return e*=this.itemSize,this.normalized&&(i=hr(i,this.array),r=hr(r,this.array),n=hr(n,this.array),s=hr(s,this.array)),this.array[e+0]=jl(i),this.array[e+1]=jl(r),this.array[e+2]=jl(n),this.array[e+3]=jl(s),this}}class hi extends xn{constructor(e,i,r){super(new Float32Array(e),i,r)}}let qDe=0;const Zc=new zi,CU=new Br,xb=new be,_c=new Vo,qS=new Vo,Oa=new be;class dr extends af{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:qDe++}),this.uuid=Rc(),this.name="",this.type="BufferGeometry",this.index=null,this.indirect=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(e){return Array.isArray(e)?this.index=new(zoe(e)?K6:Y6)(e,1):this.index=e,this}setIndirect(e){return this.indirect=e,this}getIndirect(){return this.indirect}getAttribute(e){return this.attributes[e]}setAttribute(e,i){return this.attributes[e]=i,this}deleteAttribute(e){return delete this.attributes[e],this}hasAttribute(e){return this.attributes[e]!==void 0}addGroup(e,i,r=0){this.groups.push({start:e,count:i,materialIndex:r})}clearGroups(){this.groups=[]}setDrawRange(e,i){this.drawRange.start=e,this.drawRange.count=i}applyMatrix4(e){const i=this.attributes.position;i!==void 0&&(i.applyMatrix4(e),i.needsUpdate=!0);const r=this.attributes.normal;if(r!==void 0){const s=new lr().getNormalMatrix(e);r.applyNormalMatrix(s),r.needsUpdate=!0}const n=this.attributes.tangent;return n!==void 0&&(n.transformDirection(e),n.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}applyQuaternion(e){return Zc.makeRotationFromQuaternion(e),this.applyMatrix4(Zc),this}rotateX(e){return Zc.makeRotationX(e),this.applyMatrix4(Zc),this}rotateY(e){return Zc.makeRotationY(e),this.applyMatrix4(Zc),this}rotateZ(e){return Zc.makeRotationZ(e),this.applyMatrix4(Zc),this}translate(e,i,r){return Zc.makeTranslation(e,i,r),this.applyMatrix4(Zc),this}scale(e,i,r){return Zc.makeScale(e,i,r),this.applyMatrix4(Zc),this}lookAt(e){return CU.lookAt(e),CU.updateMatrix(),this.applyMatrix4(CU.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(xb).negate(),this.translate(xb.x,xb.y,xb.z),this}setFromPoints(e){const i=this.getAttribute("position");if(i===void 0){const r=[];for(let n=0,s=e.length;n<s;n++){const a=e[n];r.push(a.x,a.y,a.z||0)}this.setAttribute("position",new hi(r,3))}else{const r=Math.min(e.length,i.count);for(let n=0;n<r;n++){const s=e[n];i.setXYZ(n,s.x,s.y,s.z||0)}e.length>i.count&&console.warn("THREE.BufferGeometry: Buffer size too small for points data. Use .dispose() and create a new geometry."),i.needsUpdate=!0}return this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new Vo);const e=this.attributes.position,i=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error("THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box.",this),this.boundingBox.set(new be(-1/0,-1/0,-1/0),new be(1/0,1/0,1/0));return}if(e!==void 0){if(this.boundingBox.setFromBufferAttribute(e),i)for(let r=0,n=i.length;r<n;r++){const s=i[r];_c.setFromBufferAttribute(s),this.morphTargetsRelative?(Oa.addVectors(this.boundingBox.min,_c.min),this.boundingBox.expandByPoint(Oa),Oa.addVectors(this.boundingBox.max,_c.max),this.boundingBox.expandByPoint(Oa)):(this.boundingBox.expandByPoint(_c.min),this.boundingBox.expandByPoint(_c.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new _o);const e=this.attributes.position,i=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error("THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere.",this),this.boundingSphere.set(new be,1/0);return}if(e){const r=this.boundingSphere.center;if(_c.setFromBufferAttribute(e),i)for(let s=0,a=i.length;s<a;s++){const o=i[s];qS.setFromBufferAttribute(o),this.morphTargetsRelative?(Oa.addVectors(_c.min,qS.min),_c.expandByPoint(Oa),Oa.addVectors(_c.max,qS.max),_c.expandByPoint(Oa)):(_c.expandByPoint(qS.min),_c.expandByPoint(qS.max))}_c.getCenter(r);let n=0;for(let s=0,a=e.count;s<a;s++)Oa.fromBufferAttribute(e,s),n=Math.max(n,r.distanceToSquared(Oa));if(i)for(let s=0,a=i.length;s<a;s++){const o=i[s],l=this.morphTargetsRelative;for(let c=0,u=o.count;c<u;c++)Oa.fromBufferAttribute(o,c),l&&(xb.fromBufferAttribute(e,c),Oa.add(xb)),n=Math.max(n,r.distanceToSquared(Oa))}this.boundingSphere.radius=Math.sqrt(n),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const e=this.index,i=this.attributes;if(e===null||i.position===void 0||i.normal===void 0||i.uv===void 0){console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");return}const r=i.position,n=i.normal,s=i.uv;this.hasAttribute("tangent")===!1&&this.setAttribute("tangent",new xn(new Float32Array(4*r.count),4));const a=this.getAttribute("tangent"),o=[],l=[];for(let C=0;C<r.count;C++)o[C]=new be,l[C]=new be;const c=new be,u=new be,h=new be,d=new At,f=new At,p=new At,g=new be,m=new be;function y(C,R,I){c.fromBufferAttribute(r,C),u.fromBufferAttribute(r,R),h.fromBufferAttribute(r,I),d.fromBufferAttribute(s,C),f.fromBufferAttribute(s,R),p.fromBufferAttribute(s,I),u.sub(c),h.sub(c),f.sub(d),p.sub(d);const k=1/(f.x*p.y-p.x*f.y);isFinite(k)&&(g.copy(u).multiplyScalar(p.y).addScaledVector(h,-f.y).multiplyScalar(k),m.copy(h).multiplyScalar(f.x).addScaledVector(u,-p.x).multiplyScalar(k),o[C].add(g),o[R].add(g),o[I].add(g),l[C].add(m),l[R].add(m),l[I].add(m))}let b=this.groups;b.length===0&&(b=[{start:0,count:e.count}]);for(let C=0,R=b.length;C<R;++C){const I=b[C],k=I.start,z=I.count;for(let V=k,F=k+z;V<F;V+=3)y(e.getX(V+0),e.getX(V+1),e.getX(V+2))}const w=new be,E=new be,M=new be,A=new be;function P(C){M.fromBufferAttribute(n,C),A.copy(M);const R=o[C];w.copy(R),w.sub(M.multiplyScalar(M.dot(R))).normalize(),E.crossVectors(A,R);const k=E.dot(l[C])<0?-1:1;a.setXYZW(C,w.x,w.y,w.z,k)}for(let C=0,R=b.length;C<R;++C){const I=b[C],k=I.start,z=I.count;for(let V=k,F=k+z;V<F;V+=3)P(e.getX(V+0)),P(e.getX(V+1)),P(e.getX(V+2))}}computeVertexNormals(){const e=this.index,i=this.getAttribute("position");if(i!==void 0){let r=this.getAttribute("normal");if(r===void 0)r=new xn(new Float32Array(i.count*3),3),this.setAttribute("normal",r);else for(let d=0,f=r.count;d<f;d++)r.setXYZ(d,0,0,0);const n=new be,s=new be,a=new be,o=new be,l=new be,c=new be,u=new be,h=new be;if(e)for(let d=0,f=e.count;d<f;d+=3){const p=e.getX(d+0),g=e.getX(d+1),m=e.getX(d+2);n.fromBufferAttribute(i,p),s.fromBufferAttribute(i,g),a.fromBufferAttribute(i,m),u.subVectors(a,s),h.subVectors(n,s),u.cross(h),o.fromBufferAttribute(r,p),l.fromBufferAttribute(r,g),c.fromBufferAttribute(r,m),o.add(u),l.add(u),c.add(u),r.setXYZ(p,o.x,o.y,o.z),r.setXYZ(g,l.x,l.y,l.z),r.setXYZ(m,c.x,c.y,c.z)}else for(let d=0,f=i.count;d<f;d+=3)n.fromBufferAttribute(i,d+0),s.fromBufferAttribute(i,d+1),a.fromBufferAttribute(i,d+2),u.subVectors(a,s),h.subVectors(n,s),u.cross(h),r.setXYZ(d+0,u.x,u.y,u.z),r.setXYZ(d+1,u.x,u.y,u.z),r.setXYZ(d+2,u.x,u.y,u.z);this.normalizeNormals(),r.needsUpdate=!0}}normalizeNormals(){const e=this.attributes.normal;for(let i=0,r=e.count;i<r;i++)Oa.fromBufferAttribute(e,i),Oa.normalize(),e.setXYZ(i,Oa.x,Oa.y,Oa.z)}toNonIndexed(){function e(o,l){const c=o.array,u=o.itemSize,h=o.normalized,d=new c.constructor(l.length*u);let f=0,p=0;for(let g=0,m=l.length;g<m;g++){o.isInterleavedBufferAttribute?f=l[g]*o.data.stride+o.offset:f=l[g]*u;for(let y=0;y<u;y++)d[p++]=c[f++]}return new xn(d,u,h)}if(this.index===null)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const i=new dr,r=this.index.array,n=this.attributes;for(const o in n){const l=n[o],c=e(l,r);i.setAttribute(o,c)}const s=this.morphAttributes;for(const o in s){const l=[],c=s[o];for(let u=0,h=c.length;u<h;u++){const d=c[u],f=e(d,r);l.push(f)}i.morphAttributes[o]=l}i.morphTargetsRelative=this.morphTargetsRelative;const a=this.groups;for(let o=0,l=a.length;o<l;o++){const c=a[o];i.addGroup(c.start,c.count,c.materialIndex)}return i}toJSON(){const e={metadata:{version:4.7,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,this.name!==""&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),this.parameters!==void 0){const l=this.parameters;for(const c in l)l[c]!==void 0&&(e[c]=l[c]);return e}e.data={attributes:{}};const i=this.index;i!==null&&(e.data.index={type:i.array.constructor.name,array:Array.prototype.slice.call(i.array)});const r=this.attributes;for(const l in r){const c=r[l];e.data.attributes[l]=c.toJSON(e.data)}const n={};let s=!1;for(const l in this.morphAttributes){const c=this.morphAttributes[l],u=[];for(let h=0,d=c.length;h<d;h++){const f=c[h];u.push(f.toJSON(e.data))}u.length>0&&(n[l]=u,s=!0)}s&&(e.data.morphAttributes=n,e.data.morphTargetsRelative=this.morphTargetsRelative);const a=this.groups;a.length>0&&(e.data.groups=JSON.parse(JSON.stringify(a)));const o=this.boundingSphere;return o!==null&&(e.data.boundingSphere=o.toJSON()),e}clone(){return new this.constructor().copy(this)}copy(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const i={};this.name=e.name;const r=e.index;r!==null&&this.setIndex(r.clone());const n=e.attributes;for(const c in n){const u=n[c];this.setAttribute(c,u.clone(i))}const s=e.morphAttributes;for(const c in s){const u=[],h=s[c];for(let d=0,f=h.length;d<f;d++)u.push(h[d].clone(i));this.morphAttributes[c]=u}this.morphTargetsRelative=e.morphTargetsRelative;const a=e.groups;for(let c=0,u=a.length;c<u;c++){const h=a[c];this.addGroup(h.start,h.count,h.materialIndex)}const o=e.boundingBox;o!==null&&(this.boundingBox=o.clone());const l=e.boundingSphere;return l!==null&&(this.boundingSphere=l.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}}const y$=new zi,hy=new g_,w2=new _o,x$=new be,_2=new be,S2=new be,E2=new be,PU=new be,A2=new be,b$=new be,M2=new be;class js extends Br{constructor(e=new dr,i=new uv){super(),this.isMesh=!0,this.type="Mesh",this.geometry=e,this.material=i,this.morphTargetDictionary=void 0,this.morphTargetInfluences=void 0,this.count=1,this.updateMorphTargets()}copy(e,i){return super.copy(e,i),e.morphTargetInfluences!==void 0&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),e.morphTargetDictionary!==void 0&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}updateMorphTargets(){const i=this.geometry.morphAttributes,r=Object.keys(i);if(r.length>0){const n=i[r[0]];if(n!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let s=0,a=n.length;s<a;s++){const o=n[s].name||String(s);this.morphTargetInfluences.push(0),this.morphTargetDictionary[o]=s}}}}getVertexPosition(e,i){const r=this.geometry,n=r.attributes.position,s=r.morphAttributes.position,a=r.morphTargetsRelative;i.fromBufferAttribute(n,e);const o=this.morphTargetInfluences;if(s&&o){A2.set(0,0,0);for(let l=0,c=s.length;l<c;l++){const u=o[l],h=s[l];u!==0&&(PU.fromBufferAttribute(h,e),a?A2.addScaledVector(PU,u):A2.addScaledVector(PU.sub(i),u))}i.add(A2)}return i}raycast(e,i){const r=this.geometry,n=this.material,s=this.matrixWorld;n!==void 0&&(r.boundingSphere===null&&r.computeBoundingSphere(),w2.copy(r.boundingSphere),w2.applyMatrix4(s),hy.copy(e.ray).recast(e.near),!(w2.containsPoint(hy.origin)===!1&&(hy.intersectSphere(w2,x$)===null||hy.origin.distanceToSquared(x$)>(e.far-e.near)**2))&&(y$.copy(s).invert(),hy.copy(e.ray).applyMatrix4(y$),!(r.boundingBox!==null&&hy.intersectsBox(r.boundingBox)===!1)&&this._computeIntersections(e,i,hy)))}_computeIntersections(e,i,r){let n;const s=this.geometry,a=this.material,o=s.index,l=s.attributes.position,c=s.attributes.uv,u=s.attributes.uv1,h=s.attributes.normal,d=s.groups,f=s.drawRange;if(o!==null)if(Array.isArray(a))for(let p=0,g=d.length;p<g;p++){const m=d[p],y=a[m.materialIndex],b=Math.max(m.start,f.start),w=Math.min(o.count,Math.min(m.start+m.count,f.start+f.count));for(let E=b,M=w;E<M;E+=3){const A=o.getX(E),P=o.getX(E+1),C=o.getX(E+2);n=T2(this,y,e,r,c,u,h,A,P,C),n&&(n.faceIndex=Math.floor(E/3),n.face.materialIndex=m.materialIndex,i.push(n))}}else{const p=Math.max(0,f.start),g=Math.min(o.count,f.start+f.count);for(let m=p,y=g;m<y;m+=3){const b=o.getX(m),w=o.getX(m+1),E=o.getX(m+2);n=T2(this,a,e,r,c,u,h,b,w,E),n&&(n.faceIndex=Math.floor(m/3),i.push(n))}}else if(l!==void 0)if(Array.isArray(a))for(let p=0,g=d.length;p<g;p++){const m=d[p],y=a[m.materialIndex],b=Math.max(m.start,f.start),w=Math.min(l.count,Math.min(m.start+m.count,f.start+f.count));for(let E=b,M=w;E<M;E+=3){const A=E,P=E+1,C=E+2;n=T2(this,y,e,r,c,u,h,A,P,C),n&&(n.faceIndex=Math.floor(E/3),n.face.materialIndex=m.materialIndex,i.push(n))}}else{const p=Math.max(0,f.start),g=Math.min(l.count,f.start+f.count);for(let m=p,y=g;m<y;m+=3){const b=m,w=m+1,E=m+2;n=T2(this,a,e,r,c,u,h,b,w,E),n&&(n.faceIndex=Math.floor(m/3),i.push(n))}}}}function XDe(t,e,i,r,n,s,a,o){let l;if(e.side===bl?l=r.intersectTriangle(a,s,n,!0,o):l=r.intersectTriangle(n,s,a,e.side===Fp,o),l===null)return null;M2.copy(o),M2.applyMatrix4(t.matrixWorld);const c=i.ray.origin.distanceTo(M2);return c<i.near||c>i.far?null:{distance:c,point:M2.clone(),object:t}}function T2(t,e,i,r,n,s,a,o,l,c){t.getVertexPosition(o,_2),t.getVertexPosition(l,S2),t.getVertexPosition(c,E2);const u=XDe(t,e,i,r,_2,S2,E2,b$);if(u){const h=new be;Kl.getBarycoord(b$,_2,S2,E2,h),n&&(u.uv=Kl.getInterpolatedAttribute(n,o,l,c,h,new At)),s&&(u.uv1=Kl.getInterpolatedAttribute(s,o,l,c,h,new At)),a&&(u.normal=Kl.getInterpolatedAttribute(a,o,l,c,h,new be),u.normal.dot(r.direction)>0&&u.normal.multiplyScalar(-1));const d={a:o,b:l,c,normal:new be,materialIndex:0};Kl.getNormal(_2,S2,E2,d.normal),u.face=d,u.barycoord=h}return u}class W0 extends dr{constructor(e=1,i=1,r=1,n=1,s=1,a=1){super(),this.type="BoxGeometry",this.parameters={width:e,height:i,depth:r,widthSegments:n,heightSegments:s,depthSegments:a};const o=this;n=Math.floor(n),s=Math.floor(s),a=Math.floor(a);const l=[],c=[],u=[],h=[];let d=0,f=0;p("z","y","x",-1,-1,r,i,e,a,s,0),p("z","y","x",1,-1,r,i,-e,a,s,1),p("x","z","y",1,1,e,r,i,n,a,2),p("x","z","y",1,-1,e,r,-i,n,a,3),p("x","y","z",1,-1,e,i,r,n,s,4),p("x","y","z",-1,-1,e,i,-r,n,s,5),this.setIndex(l),this.setAttribute("position",new hi(c,3)),this.setAttribute("normal",new hi(u,3)),this.setAttribute("uv",new hi(h,2));function p(g,m,y,b,w,E,M,A,P,C,R){const I=E/P,k=M/C,z=E/2,V=M/2,F=A/2,$=P+1,K=C+1;let X=0,U=0;const Y=new be;for(let Z=0;Z<K;Z++){const j=Z*k-V;for(let ee=0;ee<$;ee++){const pe=ee*I-z;Y[g]=pe*b,Y[m]=j*w,Y[y]=F,c.push(Y.x,Y.y,Y.z),Y[g]=0,Y[m]=0,Y[y]=A>0?1:-1,u.push(Y.x,Y.y,Y.z),h.push(ee/P),h.push(1-Z/C),X+=1}}for(let Z=0;Z<C;Z++)for(let j=0;j<P;j++){const ee=d+j+$*Z,pe=d+j+$*(Z+1),fe=d+(j+1)+$*(Z+1),se=d+(j+1)+$*Z;l.push(ee,pe,se),l.push(pe,fe,se),U+=6}o.addGroup(f,U,R),f+=U,d+=X}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new W0(e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments)}}function N1(t){const e={};for(const i in t){e[i]={};for(const r in t[i]){const n=t[i][r];n&&(n.isColor||n.isMatrix3||n.isMatrix4||n.isVector2||n.isVector3||n.isVector4||n.isTexture||n.isQuaternion)?n.isRenderTargetTexture?(console.warn("UniformsUtils: Textures of render targets cannot be cloned via cloneUniforms() or mergeUniforms()."),e[i][r]=null):e[i][r]=n.clone():Array.isArray(n)?e[i][r]=n.slice():e[i][r]=n}}return e}function cl(t){const e={};for(let i=0;i<t.length;i++){const r=N1(t[i]);for(const n in r)e[n]=r[n]}return e}function $De(t){const e=[];for(let i=0;i<t.length;i++)e.push(t[i].clone());return e}function Goe(t){const e=t.getRenderTarget();return e===null?t.outputColorSpace:e.isXRRenderTarget===!0?e.texture.colorSpace:Lr.workingColorSpace}const Woe={clone:N1,merge:cl};var YDe=`void main() {
	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,KDe=`void main() {
	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );
}`;class Ch extends Go{constructor(e){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader=YDe,this.fragmentShader=KDe,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.forceSinglePass=!0,this.extensions={clipCullDistance:!1,multiDraw:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv1:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,e!==void 0&&this.setValues(e)}copy(e){return super.copy(e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=N1(e.uniforms),this.uniformsGroups=$De(e.uniformsGroups),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.fog=e.fog,this.lights=e.lights,this.clipping=e.clipping,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this}toJSON(e){const i=super.toJSON(e);i.glslVersion=this.glslVersion,i.uniforms={};for(const n in this.uniforms){const a=this.uniforms[n].value;a&&a.isTexture?i.uniforms[n]={type:"t",value:a.toJSON(e).uuid}:a&&a.isColor?i.uniforms[n]={type:"c",value:a.getHex()}:a&&a.isVector2?i.uniforms[n]={type:"v2",value:a.toArray()}:a&&a.isVector3?i.uniforms[n]={type:"v3",value:a.toArray()}:a&&a.isVector4?i.uniforms[n]={type:"v4",value:a.toArray()}:a&&a.isMatrix3?i.uniforms[n]={type:"m3",value:a.toArray()}:a&&a.isMatrix4?i.uniforms[n]={type:"m4",value:a.toArray()}:i.uniforms[n]={value:a}}Object.keys(this.defines).length>0&&(i.defines=this.defines),i.vertexShader=this.vertexShader,i.fragmentShader=this.fragmentShader,i.lights=this.lights,i.clipping=this.clipping;const r={};for(const n in this.extensions)this.extensions[n]===!0&&(r[n]=!0);return Object.keys(r).length>0&&(i.extensions=r),i}}class yT extends Br{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new zi,this.projectionMatrix=new zi,this.projectionMatrixInverse=new zi,this.coordinateSystem=Cc,this._reversedDepth=!1}get reversedDepth(){return this._reversedDepth}copy(e,i){return super.copy(e,i),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this.coordinateSystem=e.coordinateSystem,this}getWorldDirection(e){return super.getWorldDirection(e).negate()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,i){super.updateWorldMatrix(e,i),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return new this.constructor().copy(this)}}const Vm=new be,w$=new At,_$=new At;class ja extends yT{constructor(e=50,i=1,r=.1,n=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=e,this.zoom=1,this.near=r,this.far=n,this.focus=10,this.aspect=i,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(e,i){return super.copy(e,i),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=e.view===null?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}setFocalLength(e){const i=.5*this.getFilmHeight()/e;this.fov=k1*2*Math.atan(i),this.updateProjectionMatrix()}getFocalLength(){const e=Math.tan(f0*.5*this.fov);return .5*this.getFilmHeight()/e}getEffectiveFOV(){return k1*2*Math.atan(Math.tan(f0*.5*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}getViewBounds(e,i,r){Vm.set(-1,-1,.5).applyMatrix4(this.projectionMatrixInverse),i.set(Vm.x,Vm.y).multiplyScalar(-e/Vm.z),Vm.set(1,1,.5).applyMatrix4(this.projectionMatrixInverse),r.set(Vm.x,Vm.y).multiplyScalar(-e/Vm.z)}getViewSize(e,i){return this.getViewBounds(e,w$,_$),i.subVectors(_$,w$)}setViewOffset(e,i,r,n,s,a){this.aspect=e/i,this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=i,this.view.offsetX=r,this.view.offsetY=n,this.view.width=s,this.view.height=a,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=this.near;let i=e*Math.tan(f0*.5*this.fov)/this.zoom,r=2*i,n=this.aspect*r,s=-.5*n;const a=this.view;if(this.view!==null&&this.view.enabled){const l=a.fullWidth,c=a.fullHeight;s+=a.offsetX*n/l,i-=a.offsetY*r/c,n*=a.width/l,r*=a.height/c}const o=this.filmOffset;o!==0&&(s+=e*o/this.getFilmWidth()),this.projectionMatrix.makePerspective(s,s+n,i,i-r,e,this.far,this.coordinateSystem,this.reversedDepth),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const i=super.toJSON(e);return i.object.fov=this.fov,i.object.zoom=this.zoom,i.object.near=this.near,i.object.far=this.far,i.object.focus=this.focus,i.object.aspect=this.aspect,this.view!==null&&(i.object.view=Object.assign({},this.view)),i.object.filmGauge=this.filmGauge,i.object.filmOffset=this.filmOffset,i}}const bb=-90,wb=1;class Z6 extends Br{constructor(e,i,r){super(),this.type="CubeCamera",this.renderTarget=r,this.coordinateSystem=null,this.activeMipmapLevel=0;const n=new ja(bb,wb,e,i);n.layers=this.layers,this.add(n);const s=new ja(bb,wb,e,i);s.layers=this.layers,this.add(s);const a=new ja(bb,wb,e,i);a.layers=this.layers,this.add(a);const o=new ja(bb,wb,e,i);o.layers=this.layers,this.add(o);const l=new ja(bb,wb,e,i);l.layers=this.layers,this.add(l);const c=new ja(bb,wb,e,i);c.layers=this.layers,this.add(c)}updateCoordinateSystem(){const e=this.coordinateSystem,i=this.children.concat(),[r,n,s,a,o,l]=i;for(const c of i)this.remove(c);if(e===Cc)r.up.set(0,1,0),r.lookAt(1,0,0),n.up.set(0,1,0),n.lookAt(-1,0,0),s.up.set(0,0,-1),s.lookAt(0,1,0),a.up.set(0,0,1),a.lookAt(0,-1,0),o.up.set(0,1,0),o.lookAt(0,0,1),l.up.set(0,1,0),l.lookAt(0,0,-1);else if(e===L1)r.up.set(0,-1,0),r.lookAt(-1,0,0),n.up.set(0,-1,0),n.lookAt(1,0,0),s.up.set(0,0,1),s.lookAt(0,1,0),a.up.set(0,0,-1),a.lookAt(0,-1,0),o.up.set(0,-1,0),o.lookAt(0,0,1),l.up.set(0,-1,0),l.lookAt(0,0,-1);else throw new Error("THREE.CubeCamera.updateCoordinateSystem(): Invalid coordinate system: "+e);for(const c of i)this.add(c),c.updateMatrixWorld()}update(e,i){this.parent===null&&this.updateMatrixWorld();const{renderTarget:r,activeMipmapLevel:n}=this;this.coordinateSystem!==e.coordinateSystem&&(this.coordinateSystem=e.coordinateSystem,this.updateCoordinateSystem());const[s,a,o,l,c,u]=this.children,h=e.getRenderTarget(),d=e.getActiveCubeFace(),f=e.getActiveMipmapLevel(),p=e.xr.enabled;e.xr.enabled=!1;const g=r.texture.generateMipmaps;r.texture.generateMipmaps=!1,e.setRenderTarget(r,0,n),e.render(i,s),e.setRenderTarget(r,1,n),e.render(i,a),e.setRenderTarget(r,2,n),e.render(i,o),e.setRenderTarget(r,3,n),e.render(i,l),e.setRenderTarget(r,4,n),e.render(i,c),r.texture.generateMipmaps=g,e.setRenderTarget(r,5,n),e.render(i,u),e.setRenderTarget(h,d,f),e.xr.enabled=p,r.texture.needsPMREMUpdate=!0}}class xT extends ls{constructor(e=[],i=zp,r,n,s,a,o,l,c,u){super(e,i,r,n,s,a,o,l,c,u),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(e){this.image=e}}class Q6 extends Qd{constructor(e=1,i={}){super(e,e,i),this.isWebGLCubeRenderTarget=!0;const r={width:e,height:e,depth:1},n=[r,r,r,r,r,r];this.texture=new xT(n),this._setTextureOptions(i),this.texture.isRenderTargetTexture=!0}fromEquirectangularTexture(e,i){this.texture.type=i.type,this.texture.colorSpace=i.colorSpace,this.texture.generateMipmaps=i.generateMipmaps,this.texture.minFilter=i.minFilter,this.texture.magFilter=i.magFilter;const r={uniforms:{tEquirect:{value:null}},vertexShader:`

				varying vec3 vWorldDirection;

				vec3 transformDirection( in vec3 dir, in mat4 matrix ) {

					return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );

				}

				void main() {

					vWorldDirection = transformDirection( position, modelMatrix );

					#include <begin_vertex>
					#include <project_vertex>

				}
			`,fragmentShader:`

				uniform sampler2D tEquirect;

				varying vec3 vWorldDirection;

				#include <common>

				void main() {

					vec3 direction = normalize( vWorldDirection );

					vec2 sampleUV = equirectUv( direction );

					gl_FragColor = texture2D( tEquirect, sampleUV );

				}
			`},n=new W0(5,5,5),s=new Ch({name:"CubemapFromEquirect",uniforms:N1(r.uniforms),vertexShader:r.vertexShader,fragmentShader:r.fragmentShader,side:bl,blending:Dp});s.uniforms.tEquirect.value=i;const a=new js(n,s),o=i.minFilter;return i.minFilter===Id&&(i.minFilter=ma),new Z6(1,10,this).update(e,a),i.minFilter=o,a.geometry.dispose(),a.material.dispose(),this}clear(e,i=!0,r=!0,n=!0){const s=e.getRenderTarget();for(let a=0;a<6;a++)e.setRenderTarget(this,a),e.clear(i,r,n);e.setRenderTarget(s)}}class Gw extends Br{constructor(){super(),this.isGroup=!0,this.type="Group"}}const ZDe={type:"move"};class $R{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return this._hand===null&&(this._hand=new Gw,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return this._targetRay===null&&(this._targetRay=new Gw,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new be,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new be),this._targetRay}getGripSpace(){return this._grip===null&&(this._grip=new Gw,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new be,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new be),this._grip}dispatchEvent(e){return this._targetRay!==null&&this._targetRay.dispatchEvent(e),this._grip!==null&&this._grip.dispatchEvent(e),this._hand!==null&&this._hand.dispatchEvent(e),this}connect(e){if(e&&e.hand){const i=this._hand;if(i)for(const r of e.hand.values())this._getHandJoint(i,r)}return this.dispatchEvent({type:"connected",data:e}),this}disconnect(e){return this.dispatchEvent({type:"disconnected",data:e}),this._targetRay!==null&&(this._targetRay.visible=!1),this._grip!==null&&(this._grip.visible=!1),this._hand!==null&&(this._hand.visible=!1),this}update(e,i,r){let n=null,s=null,a=null;const o=this._targetRay,l=this._grip,c=this._hand;if(e&&i.session.visibilityState!=="visible-blurred"){if(c&&e.hand){a=!0;for(const g of e.hand.values()){const m=i.getJointPose(g,r),y=this._getHandJoint(c,g);m!==null&&(y.matrix.fromArray(m.transform.matrix),y.matrix.decompose(y.position,y.rotation,y.scale),y.matrixWorldNeedsUpdate=!0,y.jointRadius=m.radius),y.visible=m!==null}const u=c.joints["index-finger-tip"],h=c.joints["thumb-tip"],d=u.position.distanceTo(h.position),f=.02,p=.005;c.inputState.pinching&&d>f+p?(c.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})):!c.inputState.pinching&&d<=f-p&&(c.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this}))}else l!==null&&e.gripSpace&&(s=i.getPose(e.gripSpace,r),s!==null&&(l.matrix.fromArray(s.transform.matrix),l.matrix.decompose(l.position,l.rotation,l.scale),l.matrixWorldNeedsUpdate=!0,s.linearVelocity?(l.hasLinearVelocity=!0,l.linearVelocity.copy(s.linearVelocity)):l.hasLinearVelocity=!1,s.angularVelocity?(l.hasAngularVelocity=!0,l.angularVelocity.copy(s.angularVelocity)):l.hasAngularVelocity=!1));o!==null&&(n=i.getPose(e.targetRaySpace,r),n===null&&s!==null&&(n=s),n!==null&&(o.matrix.fromArray(n.transform.matrix),o.matrix.decompose(o.position,o.rotation,o.scale),o.matrixWorldNeedsUpdate=!0,n.linearVelocity?(o.hasLinearVelocity=!0,o.linearVelocity.copy(n.linearVelocity)):o.hasLinearVelocity=!1,n.angularVelocity?(o.hasAngularVelocity=!0,o.angularVelocity.copy(n.angularVelocity)):o.hasAngularVelocity=!1,this.dispatchEvent(ZDe)))}return o!==null&&(o.visible=n!==null),l!==null&&(l.visible=s!==null),c!==null&&(c.visible=a!==null),this}_getHandJoint(e,i){if(e.joints[i.jointName]===void 0){const r=new Gw;r.matrixAutoUpdate=!1,r.visible=!1,e.joints[i.jointName]=r,e.add(r)}return e.joints[i.jointName]}}class MO{constructor(e,i=25e-5){this.isFogExp2=!0,this.name="",this.color=new ii(e),this.density=i}clone(){return new MO(this.color,this.density)}toJSON(){return{type:"FogExp2",name:this.name,color:this.color.getHex(),density:this.density}}}class TO{constructor(e,i=1,r=1e3){this.isFog=!0,this.name="",this.color=new ii(e),this.near=i,this.far=r}clone(){return new TO(this.color,this.near,this.far)}toJSON(){return{type:"Fog",name:this.name,color:this.color.getHex(),near:this.near,far:this.far}}}class J6 extends Br{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.backgroundBlurriness=0,this.backgroundIntensity=1,this.backgroundRotation=new kc,this.environmentIntensity=1,this.environmentRotation=new kc,this.overrideMaterial=null,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(e,i){return super.copy(e,i),e.background!==null&&(this.background=e.background.clone()),e.environment!==null&&(this.environment=e.environment.clone()),e.fog!==null&&(this.fog=e.fog.clone()),this.backgroundBlurriness=e.backgroundBlurriness,this.backgroundIntensity=e.backgroundIntensity,this.backgroundRotation.copy(e.backgroundRotation),this.environmentIntensity=e.environmentIntensity,this.environmentRotation.copy(e.environmentRotation),e.overrideMaterial!==null&&(this.overrideMaterial=e.overrideMaterial.clone()),this.matrixAutoUpdate=e.matrixAutoUpdate,this}toJSON(e){const i=super.toJSON(e);return this.fog!==null&&(i.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(i.object.backgroundBlurriness=this.backgroundBlurriness),this.backgroundIntensity!==1&&(i.object.backgroundIntensity=this.backgroundIntensity),i.object.backgroundRotation=this.backgroundRotation.toArray(),this.environmentIntensity!==1&&(i.object.environmentIntensity=this.environmentIntensity),i.object.environmentRotation=this.environmentRotation.toArray(),i}}class CO{constructor(e,i){this.isInterleavedBuffer=!0,this.array=e,this.stride=i,this.count=e!==void 0?e.length/i:0,this.usage=mM,this.updateRanges=[],this.version=0,this.uuid=Rc()}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}setUsage(e){return this.usage=e,this}addUpdateRange(e,i){this.updateRanges.push({start:e,count:i})}clearUpdateRanges(){this.updateRanges.length=0}copy(e){return this.array=new e.array.constructor(e.array),this.count=e.count,this.stride=e.stride,this.usage=e.usage,this}copyAt(e,i,r){e*=this.stride,r*=i.stride;for(let n=0,s=this.stride;n<s;n++)this.array[e+n]=i.array[r+n];return this}set(e,i=0){return this.array.set(e,i),this}clone(e){e.arrayBuffers===void 0&&(e.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=Rc()),e.arrayBuffers[this.array.buffer._uuid]===void 0&&(e.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const i=new this.array.constructor(e.arrayBuffers[this.array.buffer._uuid]),r=new this.constructor(i,this.stride);return r.setUsage(this.usage),r}onUpload(e){return this.onUploadCallback=e,this}toJSON(e){return e.arrayBuffers===void 0&&(e.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=Rc()),e.arrayBuffers[this.array.buffer._uuid]===void 0&&(e.arrayBuffers[this.array.buffer._uuid]=Array.from(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}const nl=new be;class C0{constructor(e,i,r,n=!1){this.isInterleavedBufferAttribute=!0,this.name="",this.data=e,this.itemSize=i,this.offset=r,this.normalized=n}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(e){this.data.needsUpdate=e}applyMatrix4(e){for(let i=0,r=this.data.count;i<r;i++)nl.fromBufferAttribute(this,i),nl.applyMatrix4(e),this.setXYZ(i,nl.x,nl.y,nl.z);return this}applyNormalMatrix(e){for(let i=0,r=this.count;i<r;i++)nl.fromBufferAttribute(this,i),nl.applyNormalMatrix(e),this.setXYZ(i,nl.x,nl.y,nl.z);return this}transformDirection(e){for(let i=0,r=this.count;i<r;i++)nl.fromBufferAttribute(this,i),nl.transformDirection(e),this.setXYZ(i,nl.x,nl.y,nl.z);return this}getComponent(e,i){let r=this.array[e*this.data.stride+this.offset+i];return this.normalized&&(r=pl(r,this.array)),r}setComponent(e,i,r){return this.normalized&&(r=hr(r,this.array)),this.data.array[e*this.data.stride+this.offset+i]=r,this}setX(e,i){return this.normalized&&(i=hr(i,this.array)),this.data.array[e*this.data.stride+this.offset]=i,this}setY(e,i){return this.normalized&&(i=hr(i,this.array)),this.data.array[e*this.data.stride+this.offset+1]=i,this}setZ(e,i){return this.normalized&&(i=hr(i,this.array)),this.data.array[e*this.data.stride+this.offset+2]=i,this}setW(e,i){return this.normalized&&(i=hr(i,this.array)),this.data.array[e*this.data.stride+this.offset+3]=i,this}getX(e){let i=this.data.array[e*this.data.stride+this.offset];return this.normalized&&(i=pl(i,this.array)),i}getY(e){let i=this.data.array[e*this.data.stride+this.offset+1];return this.normalized&&(i=pl(i,this.array)),i}getZ(e){let i=this.data.array[e*this.data.stride+this.offset+2];return this.normalized&&(i=pl(i,this.array)),i}getW(e){let i=this.data.array[e*this.data.stride+this.offset+3];return this.normalized&&(i=pl(i,this.array)),i}setXY(e,i,r){return e=e*this.data.stride+this.offset,this.normalized&&(i=hr(i,this.array),r=hr(r,this.array)),this.data.array[e+0]=i,this.data.array[e+1]=r,this}setXYZ(e,i,r,n){return e=e*this.data.stride+this.offset,this.normalized&&(i=hr(i,this.array),r=hr(r,this.array),n=hr(n,this.array)),this.data.array[e+0]=i,this.data.array[e+1]=r,this.data.array[e+2]=n,this}setXYZW(e,i,r,n,s){return e=e*this.data.stride+this.offset,this.normalized&&(i=hr(i,this.array),r=hr(r,this.array),n=hr(n,this.array),s=hr(s,this.array)),this.data.array[e+0]=i,this.data.array[e+1]=r,this.data.array[e+2]=n,this.data.array[e+3]=s,this}clone(e){if(e===void 0){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interleaved buffer attribute will de-interleave buffer data.");const i=[];for(let r=0;r<this.count;r++){const n=r*this.data.stride+this.offset;for(let s=0;s<this.itemSize;s++)i.push(this.data.array[n+s])}return new xn(new this.array.constructor(i),this.itemSize,this.normalized)}else return e.interleavedBuffers===void 0&&(e.interleavedBuffers={}),e.interleavedBuffers[this.data.uuid]===void 0&&(e.interleavedBuffers[this.data.uuid]=this.data.clone(e)),new C0(e.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(e){if(e===void 0){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interleaved buffer attribute will de-interleave buffer data.");const i=[];for(let r=0;r<this.count;r++){const n=r*this.data.stride+this.offset;for(let s=0;s<this.itemSize;s++)i.push(this.data.array[n+s])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:i,normalized:this.normalized}}else return e.interleavedBuffers===void 0&&(e.interleavedBuffers={}),e.interleavedBuffers[this.data.uuid]===void 0&&(e.interleavedBuffers[this.data.uuid]=this.data.toJSON(e)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}class eH extends Go{constructor(e){super(),this.isSpriteMaterial=!0,this.type="SpriteMaterial",this.color=new ii(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.rotation=e.rotation,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}}let _b;const XS=new be,Sb=new be,Eb=new be,Ab=new At,$S=new At,qoe=new zi,C2=new be,YS=new be,P2=new be,S$=new At,RU=new At,E$=new At;class Xoe extends Br{constructor(e=new eH){if(super(),this.isSprite=!0,this.type="Sprite",_b===void 0){_b=new dr;const i=new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),r=new CO(i,5);_b.setIndex([0,1,2,0,2,3]),_b.setAttribute("position",new C0(r,3,0,!1)),_b.setAttribute("uv",new C0(r,2,3,!1))}this.geometry=_b,this.material=e,this.center=new At(.5,.5),this.count=1}raycast(e,i){e.camera===null&&console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),Sb.setFromMatrixScale(this.matrixWorld),qoe.copy(e.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(e.camera.matrixWorldInverse,this.matrixWorld),Eb.setFromMatrixPosition(this.modelViewMatrix),e.camera.isPerspectiveCamera&&this.material.sizeAttenuation===!1&&Sb.multiplyScalar(-Eb.z);const r=this.material.rotation;let n,s;r!==0&&(s=Math.cos(r),n=Math.sin(r));const a=this.center;R2(C2.set(-.5,-.5,0),Eb,a,Sb,n,s),R2(YS.set(.5,-.5,0),Eb,a,Sb,n,s),R2(P2.set(.5,.5,0),Eb,a,Sb,n,s),S$.set(0,0),RU.set(1,0),E$.set(1,1);let o=e.ray.intersectTriangle(C2,YS,P2,!1,XS);if(o===null&&(R2(YS.set(-.5,.5,0),Eb,a,Sb,n,s),RU.set(0,1),o=e.ray.intersectTriangle(C2,P2,YS,!1,XS),o===null))return;const l=e.ray.origin.distanceTo(XS);l<e.near||l>e.far||i.push({distance:l,point:XS.clone(),uv:Kl.getInterpolation(XS,C2,YS,P2,S$,RU,E$,new At),face:null,object:this})}copy(e,i){return super.copy(e,i),e.center!==void 0&&this.center.copy(e.center),this.material=e.material,this}}function R2(t,e,i,r,n,s){Ab.subVectors(t,i).addScalar(.5).multiply(r),n!==void 0?($S.x=s*Ab.x-n*Ab.y,$S.y=n*Ab.x+s*Ab.y):$S.copy(Ab),t.copy(e),t.x+=$S.x,t.y+=$S.y,t.applyMatrix4(qoe)}const I2=new be,A$=new be;class $oe extends Br{constructor(){super(),this.isLOD=!0,this._currentLevel=0,this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]}}),this.autoUpdate=!0}copy(e){super.copy(e,!1);const i=e.levels;for(let r=0,n=i.length;r<n;r++){const s=i[r];this.addLevel(s.object.clone(),s.distance,s.hysteresis)}return this.autoUpdate=e.autoUpdate,this}addLevel(e,i=0,r=0){i=Math.abs(i);const n=this.levels;let s;for(s=0;s<n.length&&!(i<n[s].distance);s++);return n.splice(s,0,{distance:i,hysteresis:r,object:e}),this.add(e),this}removeLevel(e){const i=this.levels;for(let r=0;r<i.length;r++)if(i[r].distance===e){const n=i.splice(r,1);return this.remove(n[0].object),!0}return!1}getCurrentLevel(){return this._currentLevel}getObjectForDistance(e){const i=this.levels;if(i.length>0){let r,n;for(r=1,n=i.length;r<n;r++){let s=i[r].distance;if(i[r].object.visible&&(s-=s*i[r].hysteresis),e<s)break}return i[r-1].object}return null}raycast(e,i){if(this.levels.length>0){I2.setFromMatrixPosition(this.matrixWorld);const n=e.ray.origin.distanceTo(I2);this.getObjectForDistance(n).raycast(e,i)}}update(e){const i=this.levels;if(i.length>1){I2.setFromMatrixPosition(e.matrixWorld),A$.setFromMatrixPosition(this.matrixWorld);const r=I2.distanceTo(A$)/e.zoom;i[0].object.visible=!0;let n,s;for(n=1,s=i.length;n<s;n++){let a=i[n].distance;if(i[n].object.visible&&(a-=a*i[n].hysteresis),r>=a)i[n-1].object.visible=!1,i[n].object.visible=!0;else break}for(this._currentLevel=n-1;n<s;n++)i[n].object.visible=!1}}toJSON(e){const i=super.toJSON(e);this.autoUpdate===!1&&(i.object.autoUpdate=!1),i.object.levels=[];const r=this.levels;for(let n=0,s=r.length;n<s;n++){const a=r[n];i.object.levels.push({object:a.object.uuid,distance:a.distance,hysteresis:a.hysteresis})}return i}}const M$=new be,T$=new Ur,C$=new Ur,QDe=new be,P$=new zi,D2=new be,IU=new _o,R$=new zi,DU=new g_;class Yoe extends js{constructor(e,i){super(e,i),this.isSkinnedMesh=!0,this.type="SkinnedMesh",this.bindMode=qz,this.bindMatrix=new zi,this.bindMatrixInverse=new zi,this.boundingBox=null,this.boundingSphere=null}computeBoundingBox(){const e=this.geometry;this.boundingBox===null&&(this.boundingBox=new Vo),this.boundingBox.makeEmpty();const i=e.getAttribute("position");for(let r=0;r<i.count;r++)this.getVertexPosition(r,D2),this.boundingBox.expandByPoint(D2)}computeBoundingSphere(){const e=this.geometry;this.boundingSphere===null&&(this.boundingSphere=new _o),this.boundingSphere.makeEmpty();const i=e.getAttribute("position");for(let r=0;r<i.count;r++)this.getVertexPosition(r,D2),this.boundingSphere.expandByPoint(D2)}copy(e,i){return super.copy(e,i),this.bindMode=e.bindMode,this.bindMatrix.copy(e.bindMatrix),this.bindMatrixInverse.copy(e.bindMatrixInverse),this.skeleton=e.skeleton,e.boundingBox!==null&&(this.boundingBox=e.boundingBox.clone()),e.boundingSphere!==null&&(this.boundingSphere=e.boundingSphere.clone()),this}raycast(e,i){const r=this.material,n=this.matrixWorld;r!==void 0&&(this.boundingSphere===null&&this.computeBoundingSphere(),IU.copy(this.boundingSphere),IU.applyMatrix4(n),e.ray.intersectsSphere(IU)!==!1&&(R$.copy(n).invert(),DU.copy(e.ray).applyMatrix4(R$),!(this.boundingBox!==null&&DU.intersectsBox(this.boundingBox)===!1)&&this._computeIntersections(e,i,DU)))}getVertexPosition(e,i){return super.getVertexPosition(e,i),this.applyBoneTransform(e,i),i}bind(e,i){this.skeleton=e,i===void 0&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),i=this.matrixWorld),this.bindMatrix.copy(i),this.bindMatrixInverse.copy(i).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(){const e=new Ur,i=this.geometry.attributes.skinWeight;for(let r=0,n=i.count;r<n;r++){e.fromBufferAttribute(i,r);const s=1/e.manhattanLength();s!==1/0?e.multiplyScalar(s):e.set(1,0,0,0),i.setXYZW(r,e.x,e.y,e.z,e.w)}}updateMatrixWorld(e){super.updateMatrixWorld(e),this.bindMode===qz?this.bindMatrixInverse.copy(this.matrixWorld).invert():this.bindMode===Moe?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}applyBoneTransform(e,i){const r=this.skeleton,n=this.geometry;T$.fromBufferAttribute(n.attributes.skinIndex,e),C$.fromBufferAttribute(n.attributes.skinWeight,e),M$.copy(i).applyMatrix4(this.bindMatrix),i.set(0,0,0);for(let s=0;s<4;s++){const a=C$.getComponent(s);if(a!==0){const o=T$.getComponent(s);P$.multiplyMatrices(r.bones[o].matrixWorld,r.boneInverses[o]),i.addScaledVector(QDe.copy(M$).applyMatrix4(P$),a)}}return i.applyMatrix4(this.bindMatrixInverse)}}class tH extends Br{constructor(){super(),this.isBone=!0,this.type="Bone"}}class Vd extends ls{constructor(e=null,i=1,r=1,n,s,a,o,l,c=wo,u=wo,h,d){super(null,a,o,l,c,u,n,s,h,d),this.isDataTexture=!0,this.image={data:e,width:i,height:r},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}const I$=new zi,JDe=new zi;class PO{constructor(e=[],i=[]){this.uuid=Rc(),this.bones=e.slice(0),this.boneInverses=i,this.boneMatrices=null,this.boneTexture=null,this.init()}init(){const e=this.bones,i=this.boneInverses;if(this.boneMatrices=new Float32Array(e.length*16),i.length===0)this.calculateInverses();else if(e.length!==i.length){console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let r=0,n=this.bones.length;r<n;r++)this.boneInverses.push(new zi)}}calculateInverses(){this.boneInverses.length=0;for(let e=0,i=this.bones.length;e<i;e++){const r=new zi;this.bones[e]&&r.copy(this.bones[e].matrixWorld).invert(),this.boneInverses.push(r)}}pose(){for(let e=0,i=this.bones.length;e<i;e++){const r=this.bones[e];r&&r.matrixWorld.copy(this.boneInverses[e]).invert()}for(let e=0,i=this.bones.length;e<i;e++){const r=this.bones[e];r&&(r.parent&&r.parent.isBone?(r.matrix.copy(r.parent.matrixWorld).invert(),r.matrix.multiply(r.matrixWorld)):r.matrix.copy(r.matrixWorld),r.matrix.decompose(r.position,r.quaternion,r.scale))}}update(){const e=this.bones,i=this.boneInverses,r=this.boneMatrices,n=this.boneTexture;for(let s=0,a=e.length;s<a;s++){const o=e[s]?e[s].matrixWorld:JDe;I$.multiplyMatrices(o,i[s]),I$.toArray(r,s*16)}n!==null&&(n.needsUpdate=!0)}clone(){return new PO(this.bones,this.boneInverses)}computeBoneTexture(){let e=Math.sqrt(this.bones.length*4);e=Math.ceil(e/4)*4,e=Math.max(e,4);const i=new Float32Array(e*e*4);i.set(this.boneMatrices);const r=new Vd(i,e,e,zo,tc);return r.needsUpdate=!0,this.boneMatrices=i,this.boneTexture=r,this}getBoneByName(e){for(let i=0,r=this.bones.length;i<r;i++){const n=this.bones[i];if(n.name===e)return n}}dispose(){this.boneTexture!==null&&(this.boneTexture.dispose(),this.boneTexture=null)}fromJSON(e,i){this.uuid=e.uuid;for(let r=0,n=e.bones.length;r<n;r++){const s=e.bones[r];let a=i[s];a===void 0&&(console.warn("THREE.Skeleton: No bone found with UUID:",s),a=new tH),this.bones.push(a),this.boneInverses.push(new zi().fromArray(e.boneInverses[r]))}return this.init(),this}toJSON(){const e={metadata:{version:4.7,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};e.uuid=this.uuid;const i=this.bones,r=this.boneInverses;for(let n=0,s=i.length;n<s;n++){const a=i[n];e.bones.push(a.uuid);const o=r[n];e.boneInverses.push(o.toArray())}return e}}class U1 extends xn{constructor(e,i,r,n=1){super(e,i,r),this.isInstancedBufferAttribute=!0,this.meshPerAttribute=n}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}toJSON(){const e=super.toJSON();return e.meshPerAttribute=this.meshPerAttribute,e.isInstancedBufferAttribute=!0,e}}const Mb=new zi,D$=new zi,O2=[],O$=new Vo,e3e=new zi,KS=new js,ZS=new _o;class Koe extends js{constructor(e,i,r){super(e,i),this.isInstancedMesh=!0,this.instanceMatrix=new U1(new Float32Array(r*16),16),this.instanceColor=null,this.morphTexture=null,this.count=r,this.boundingBox=null,this.boundingSphere=null;for(let n=0;n<r;n++)this.setMatrixAt(n,e3e)}computeBoundingBox(){const e=this.geometry,i=this.count;this.boundingBox===null&&(this.boundingBox=new Vo),e.boundingBox===null&&e.computeBoundingBox(),this.boundingBox.makeEmpty();for(let r=0;r<i;r++)this.getMatrixAt(r,Mb),O$.copy(e.boundingBox).applyMatrix4(Mb),this.boundingBox.union(O$)}computeBoundingSphere(){const e=this.geometry,i=this.count;this.boundingSphere===null&&(this.boundingSphere=new _o),e.boundingSphere===null&&e.computeBoundingSphere(),this.boundingSphere.makeEmpty();for(let r=0;r<i;r++)this.getMatrixAt(r,Mb),ZS.copy(e.boundingSphere).applyMatrix4(Mb),this.boundingSphere.union(ZS)}copy(e,i){return super.copy(e,i),this.instanceMatrix.copy(e.instanceMatrix),e.morphTexture!==null&&(this.morphTexture=e.morphTexture.clone()),e.instanceColor!==null&&(this.instanceColor=e.instanceColor.clone()),this.count=e.count,e.boundingBox!==null&&(this.boundingBox=e.boundingBox.clone()),e.boundingSphere!==null&&(this.boundingSphere=e.boundingSphere.clone()),this}getColorAt(e,i){i.fromArray(this.instanceColor.array,e*3)}getMatrixAt(e,i){i.fromArray(this.instanceMatrix.array,e*16)}getMorphAt(e,i){const r=i.morphTargetInfluences,n=this.morphTexture.source.data.data,s=r.length+1,a=e*s+1;for(let o=0;o<r.length;o++)r[o]=n[a+o]}raycast(e,i){const r=this.matrixWorld,n=this.count;if(KS.geometry=this.geometry,KS.material=this.material,KS.material!==void 0&&(this.boundingSphere===null&&this.computeBoundingSphere(),ZS.copy(this.boundingSphere),ZS.applyMatrix4(r),e.ray.intersectsSphere(ZS)!==!1))for(let s=0;s<n;s++){this.getMatrixAt(s,Mb),D$.multiplyMatrices(r,Mb),KS.matrixWorld=D$,KS.raycast(e,O2);for(let a=0,o=O2.length;a<o;a++){const l=O2[a];l.instanceId=s,l.object=this,i.push(l)}O2.length=0}}setColorAt(e,i){this.instanceColor===null&&(this.instanceColor=new U1(new Float32Array(this.instanceMatrix.count*3).fill(1),3)),i.toArray(this.instanceColor.array,e*3)}setMatrixAt(e,i){i.toArray(this.instanceMatrix.array,e*16)}setMorphAt(e,i){const r=i.morphTargetInfluences,n=r.length+1;this.morphTexture===null&&(this.morphTexture=new Vd(new Float32Array(n*this.count),n,this.count,bO,tc));const s=this.morphTexture.source.data.data;let a=0;for(let c=0;c<r.length;c++)a+=r[c];const o=this.geometry.morphTargetsRelative?1:1-a,l=n*e;s[l]=o,s.set(r,l+1)}updateMorphTargets(){}dispose(){this.dispatchEvent({type:"dispose"}),this.morphTexture!==null&&(this.morphTexture.dispose(),this.morphTexture=null)}}const OU=new be,t3e=new be,i3e=new lr;class fg{constructor(e=new be(1,0,0),i=0){this.isPlane=!0,this.normal=e,this.constant=i}set(e,i){return this.normal.copy(e),this.constant=i,this}setComponents(e,i,r,n){return this.normal.set(e,i,r),this.constant=n,this}setFromNormalAndCoplanarPoint(e,i){return this.normal.copy(e),this.constant=-i.dot(this.normal),this}setFromCoplanarPoints(e,i,r){const n=OU.subVectors(r,i).cross(t3e.subVectors(e,i)).normalize();return this.setFromNormalAndCoplanarPoint(n,e),this}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}normalize(){const e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(e){return this.normal.dot(e)+this.constant}distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius}projectPoint(e,i){return i.copy(e).addScaledVector(this.normal,-this.distanceToPoint(e))}intersectLine(e,i){const r=e.delta(OU),n=this.normal.dot(r);if(n===0)return this.distanceToPoint(e.start)===0?i.copy(e.start):null;const s=-(e.start.dot(this.normal)+this.constant)/n;return s<0||s>1?null:i.copy(e.start).addScaledVector(r,s)}intersectsLine(e){const i=this.distanceToPoint(e.start),r=this.distanceToPoint(e.end);return i<0&&r>0||r<0&&i>0}intersectsBox(e){return e.intersectsPlane(this)}intersectsSphere(e){return e.intersectsPlane(this)}coplanarPoint(e){return e.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(e,i){const r=i||i3e.getNormalMatrix(e),n=this.coplanarPoint(OU).applyMatrix4(e),s=this.normal.applyMatrix3(r).normalize();return this.constant=-n.dot(s),this}translate(e){return this.constant-=e.dot(this.normal),this}equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}clone(){return new this.constructor().copy(this)}}const dy=new _o,r3e=new At(.5,.5),L2=new be;class v_{constructor(e=new fg,i=new fg,r=new fg,n=new fg,s=new fg,a=new fg){this.planes=[e,i,r,n,s,a]}set(e,i,r,n,s,a){const o=this.planes;return o[0].copy(e),o[1].copy(i),o[2].copy(r),o[3].copy(n),o[4].copy(s),o[5].copy(a),this}copy(e){const i=this.planes;for(let r=0;r<6;r++)i[r].copy(e.planes[r]);return this}setFromProjectionMatrix(e,i=Cc,r=!1){const n=this.planes,s=e.elements,a=s[0],o=s[1],l=s[2],c=s[3],u=s[4],h=s[5],d=s[6],f=s[7],p=s[8],g=s[9],m=s[10],y=s[11],b=s[12],w=s[13],E=s[14],M=s[15];if(n[0].setComponents(c-a,f-u,y-p,M-b).normalize(),n[1].setComponents(c+a,f+u,y+p,M+b).normalize(),n[2].setComponents(c+o,f+h,y+g,M+w).normalize(),n[3].setComponents(c-o,f-h,y-g,M-w).normalize(),r)n[4].setComponents(l,d,m,E).normalize(),n[5].setComponents(c-l,f-d,y-m,M-E).normalize();else if(n[4].setComponents(c-l,f-d,y-m,M-E).normalize(),i===Cc)n[5].setComponents(c+l,f+d,y+m,M+E).normalize();else if(i===L1)n[5].setComponents(l,d,m,E).normalize();else throw new Error("THREE.Frustum.setFromProjectionMatrix(): Invalid coordinate system: "+i);return this}intersectsObject(e){if(e.boundingSphere!==void 0)e.boundingSphere===null&&e.computeBoundingSphere(),dy.copy(e.boundingSphere).applyMatrix4(e.matrixWorld);else{const i=e.geometry;i.boundingSphere===null&&i.computeBoundingSphere(),dy.copy(i.boundingSphere).applyMatrix4(e.matrixWorld)}return this.intersectsSphere(dy)}intersectsSprite(e){dy.center.set(0,0,0);const i=r3e.distanceTo(e.center);return dy.radius=.7071067811865476+i,dy.applyMatrix4(e.matrixWorld),this.intersectsSphere(dy)}intersectsSphere(e){const i=this.planes,r=e.center,n=-e.radius;for(let s=0;s<6;s++)if(i[s].distanceToPoint(r)<n)return!1;return!0}intersectsBox(e){const i=this.planes;for(let r=0;r<6;r++){const n=i[r];if(L2.x=n.normal.x>0?e.max.x:e.min.x,L2.y=n.normal.y>0?e.max.y:e.min.y,L2.z=n.normal.z>0?e.max.z:e.min.z,n.distanceToPoint(L2)<0)return!1}return!0}containsPoint(e){const i=this.planes;for(let r=0;r<6;r++)if(i[r].distanceToPoint(e)<0)return!1;return!0}clone(){return new this.constructor().copy(this)}}const td=new zi,id=new v_;class RO{constructor(){this.coordinateSystem=Cc}intersectsObject(e,i){if(!i.isArrayCamera||i.cameras.length===0)return!1;for(let r=0;r<i.cameras.length;r++){const n=i.cameras[r];if(td.multiplyMatrices(n.projectionMatrix,n.matrixWorldInverse),id.setFromProjectionMatrix(td,n.coordinateSystem,n.reversedDepth),id.intersectsObject(e))return!0}return!1}intersectsSprite(e,i){if(!i||!i.cameras||i.cameras.length===0)return!1;for(let r=0;r<i.cameras.length;r++){const n=i.cameras[r];if(td.multiplyMatrices(n.projectionMatrix,n.matrixWorldInverse),id.setFromProjectionMatrix(td,n.coordinateSystem,n.reversedDepth),id.intersectsSprite(e))return!0}return!1}intersectsSphere(e,i){if(!i||!i.cameras||i.cameras.length===0)return!1;for(let r=0;r<i.cameras.length;r++){const n=i.cameras[r];if(td.multiplyMatrices(n.projectionMatrix,n.matrixWorldInverse),id.setFromProjectionMatrix(td,n.coordinateSystem,n.reversedDepth),id.intersectsSphere(e))return!0}return!1}intersectsBox(e,i){if(!i||!i.cameras||i.cameras.length===0)return!1;for(let r=0;r<i.cameras.length;r++){const n=i.cameras[r];if(td.multiplyMatrices(n.projectionMatrix,n.matrixWorldInverse),id.setFromProjectionMatrix(td,n.coordinateSystem,n.reversedDepth),id.intersectsBox(e))return!0}return!1}containsPoint(e,i){if(!i||!i.cameras||i.cameras.length===0)return!1;for(let r=0;r<i.cameras.length;r++){const n=i.cameras[r];if(td.multiplyMatrices(n.projectionMatrix,n.matrixWorldInverse),id.setFromProjectionMatrix(td,n.coordinateSystem,n.reversedDepth),id.containsPoint(e))return!0}return!1}clone(){return new RO}}function LU(t,e){return t-e}function n3e(t,e){return t.z-e.z}function s3e(t,e){return e.z-t.z}class a3e{constructor(){this.index=0,this.pool=[],this.list=[]}push(e,i,r,n){const s=this.pool,a=this.list;this.index>=s.length&&s.push({start:-1,count:-1,z:-1,index:-1});const o=s[this.index];a.push(o),this.index++,o.start=e,o.count=i,o.z=r,o.index=n}reset(){this.list.length=0,this.index=0}}const Fl=new zi,o3e=new ii(1,1,1),L$=new v_,l3e=new RO,k2=new Vo,fy=new _o,QS=new be,k$=new be,c3e=new be,kU=new a3e,Lo=new js,N2=[];function u3e(t,e,i=0){const r=e.itemSize;if(t.isInterleavedBufferAttribute||t.array.constructor!==e.array.constructor){const n=t.count;for(let s=0;s<n;s++)for(let a=0;a<r;a++)e.setComponent(s+i,a,t.getComponent(s,a))}else e.array.set(t.array,i*r);e.needsUpdate=!0}function py(t,e){if(t.constructor!==e.constructor){const i=Math.min(t.length,e.length);for(let r=0;r<i;r++)e[r]=t[r]}else{const i=Math.min(t.length,e.length);e.set(new t.constructor(t.buffer,0,i))}}class Zoe extends js{constructor(e,i,r=i*2,n){super(new dr,n),this.isBatchedMesh=!0,this.perObjectFrustumCulled=!0,this.sortObjects=!0,this.boundingBox=null,this.boundingSphere=null,this.customSort=null,this._instanceInfo=[],this._geometryInfo=[],this._availableInstanceIds=[],this._availableGeometryIds=[],this._nextIndexStart=0,this._nextVertexStart=0,this._geometryCount=0,this._visibilityChanged=!0,this._geometryInitialized=!1,this._maxInstanceCount=e,this._maxVertexCount=i,this._maxIndexCount=r,this._multiDrawCounts=new Int32Array(e),this._multiDrawStarts=new Int32Array(e),this._multiDrawCount=0,this._multiDrawInstances=null,this._matricesTexture=null,this._indirectTexture=null,this._colorsTexture=null,this._initMatricesTexture(),this._initIndirectTexture()}get maxInstanceCount(){return this._maxInstanceCount}get instanceCount(){return this._instanceInfo.length-this._availableInstanceIds.length}get unusedVertexCount(){return this._maxVertexCount-this._nextVertexStart}get unusedIndexCount(){return this._maxIndexCount-this._nextIndexStart}_initMatricesTexture(){let e=Math.sqrt(this._maxInstanceCount*4);e=Math.ceil(e/4)*4,e=Math.max(e,4);const i=new Float32Array(e*e*4),r=new Vd(i,e,e,zo,tc);this._matricesTexture=r}_initIndirectTexture(){let e=Math.sqrt(this._maxInstanceCount);e=Math.ceil(e);const i=new Uint32Array(e*e),r=new Vd(i,e,e,vT,jp);this._indirectTexture=r}_initColorsTexture(){let e=Math.sqrt(this._maxInstanceCount);e=Math.ceil(e);const i=new Float32Array(e*e*4).fill(1),r=new Vd(i,e,e,zo,tc);r.colorSpace=Lr.workingColorSpace,this._colorsTexture=r}_initializeGeometry(e){const i=this.geometry,r=this._maxVertexCount,n=this._maxIndexCount;if(this._geometryInitialized===!1){for(const s in e.attributes){const a=e.getAttribute(s),{array:o,itemSize:l,normalized:c}=a,u=new o.constructor(r*l),h=new xn(u,l,c);i.setAttribute(s,h)}if(e.getIndex()!==null){const s=r>65535?new Uint32Array(n):new Uint16Array(n);i.setIndex(new xn(s,1))}this._geometryInitialized=!0}}_validateGeometry(e){const i=this.geometry;if(!!e.getIndex()!=!!i.getIndex())throw new Error('THREE.BatchedMesh: All geometries must consistently have "index".');for(const r in i.attributes){if(!e.hasAttribute(r))throw new Error(`THREE.BatchedMesh: Added geometry missing "${r}". All geometries must have consistent attributes.`);const n=e.getAttribute(r),s=i.getAttribute(r);if(n.itemSize!==s.itemSize||n.normalized!==s.normalized)throw new Error("THREE.BatchedMesh: All attributes must have a consistent itemSize and normalized value.")}}validateInstanceId(e){const i=this._instanceInfo;if(e<0||e>=i.length||i[e].active===!1)throw new Error(`THREE.BatchedMesh: Invalid instanceId ${e}. Instance is either out of range or has been deleted.`)}validateGeometryId(e){const i=this._geometryInfo;if(e<0||e>=i.length||i[e].active===!1)throw new Error(`THREE.BatchedMesh: Invalid geometryId ${e}. Geometry is either out of range or has been deleted.`)}setCustomSort(e){return this.customSort=e,this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new Vo);const e=this.boundingBox,i=this._instanceInfo;e.makeEmpty();for(let r=0,n=i.length;r<n;r++){if(i[r].active===!1)continue;const s=i[r].geometryIndex;this.getMatrixAt(r,Fl),this.getBoundingBoxAt(s,k2).applyMatrix4(Fl),e.union(k2)}}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new _o);const e=this.boundingSphere,i=this._instanceInfo;e.makeEmpty();for(let r=0,n=i.length;r<n;r++){if(i[r].active===!1)continue;const s=i[r].geometryIndex;this.getMatrixAt(r,Fl),this.getBoundingSphereAt(s,fy).applyMatrix4(Fl),e.union(fy)}}addInstance(e){if(this._instanceInfo.length>=this.maxInstanceCount&&this._availableInstanceIds.length===0)throw new Error("THREE.BatchedMesh: Maximum item count reached.");const r={visible:!0,active:!0,geometryIndex:e};let n=null;this._availableInstanceIds.length>0?(this._availableInstanceIds.sort(LU),n=this._availableInstanceIds.shift(),this._instanceInfo[n]=r):(n=this._instanceInfo.length,this._instanceInfo.push(r));const s=this._matricesTexture;Fl.identity().toArray(s.image.data,n*16),s.needsUpdate=!0;const a=this._colorsTexture;return a&&(o3e.toArray(a.image.data,n*4),a.needsUpdate=!0),this._visibilityChanged=!0,n}addGeometry(e,i=-1,r=-1){this._initializeGeometry(e),this._validateGeometry(e);const n={vertexStart:-1,vertexCount:-1,reservedVertexCount:-1,indexStart:-1,indexCount:-1,reservedIndexCount:-1,start:-1,count:-1,boundingBox:null,boundingSphere:null,active:!0},s=this._geometryInfo;n.vertexStart=this._nextVertexStart,n.reservedVertexCount=i===-1?e.getAttribute("position").count:i;const a=e.getIndex();if(a!==null&&(n.indexStart=this._nextIndexStart,n.reservedIndexCount=r===-1?a.count:r),n.indexStart!==-1&&n.indexStart+n.reservedIndexCount>this._maxIndexCount||n.vertexStart+n.reservedVertexCount>this._maxVertexCount)throw new Error("THREE.BatchedMesh: Reserved space request exceeds the maximum buffer size.");let l;return this._availableGeometryIds.length>0?(this._availableGeometryIds.sort(LU),l=this._availableGeometryIds.shift(),s[l]=n):(l=this._geometryCount,this._geometryCount++,s.push(n)),this.setGeometryAt(l,e),this._nextIndexStart=n.indexStart+n.reservedIndexCount,this._nextVertexStart=n.vertexStart+n.reservedVertexCount,l}setGeometryAt(e,i){if(e>=this._geometryCount)throw new Error("THREE.BatchedMesh: Maximum geometry count reached.");this._validateGeometry(i);const r=this.geometry,n=r.getIndex()!==null,s=r.getIndex(),a=i.getIndex(),o=this._geometryInfo[e];if(n&&a.count>o.reservedIndexCount||i.attributes.position.count>o.reservedVertexCount)throw new Error("THREE.BatchedMesh: Reserved space not large enough for provided geometry.");const l=o.vertexStart,c=o.reservedVertexCount;o.vertexCount=i.getAttribute("position").count;for(const u in r.attributes){const h=i.getAttribute(u),d=r.getAttribute(u);u3e(h,d,l);const f=h.itemSize;for(let p=h.count,g=c;p<g;p++){const m=l+p;for(let y=0;y<f;y++)d.setComponent(m,y,0)}d.needsUpdate=!0,d.addUpdateRange(l*f,c*f)}if(n){const u=o.indexStart,h=o.reservedIndexCount;o.indexCount=i.getIndex().count;for(let d=0;d<a.count;d++)s.setX(u+d,l+a.getX(d));for(let d=a.count,f=h;d<f;d++)s.setX(u+d,l);s.needsUpdate=!0,s.addUpdateRange(u,o.reservedIndexCount)}return o.start=n?o.indexStart:o.vertexStart,o.count=n?o.indexCount:o.vertexCount,o.boundingBox=null,i.boundingBox!==null&&(o.boundingBox=i.boundingBox.clone()),o.boundingSphere=null,i.boundingSphere!==null&&(o.boundingSphere=i.boundingSphere.clone()),this._visibilityChanged=!0,e}deleteGeometry(e){const i=this._geometryInfo;if(e>=i.length||i[e].active===!1)return this;const r=this._instanceInfo;for(let n=0,s=r.length;n<s;n++)r[n].active&&r[n].geometryIndex===e&&this.deleteInstance(n);return i[e].active=!1,this._availableGeometryIds.push(e),this._visibilityChanged=!0,this}deleteInstance(e){return this.validateInstanceId(e),this._instanceInfo[e].active=!1,this._availableInstanceIds.push(e),this._visibilityChanged=!0,this}optimize(){let e=0,i=0;const r=this._geometryInfo,n=r.map((a,o)=>o).sort((a,o)=>r[a].vertexStart-r[o].vertexStart),s=this.geometry;for(let a=0,o=r.length;a<o;a++){const l=n[a],c=r[l];if(c.active!==!1){if(s.index!==null){if(c.indexStart!==i){const{indexStart:u,vertexStart:h,reservedIndexCount:d}=c,f=s.index,p=f.array,g=e-h;for(let m=u;m<u+d;m++)p[m]=p[m]+g;f.array.copyWithin(i,u,u+d),f.addUpdateRange(i,d),c.indexStart=i}i+=c.reservedIndexCount}if(c.vertexStart!==e){const{vertexStart:u,reservedVertexCount:h}=c,d=s.attributes;for(const f in d){const p=d[f],{array:g,itemSize:m}=p;g.copyWithin(e*m,u*m,(u+h)*m),p.addUpdateRange(e*m,h*m)}c.vertexStart=e}e+=c.reservedVertexCount,c.start=s.index?c.indexStart:c.vertexStart,this._nextIndexStart=s.index?c.indexStart+c.reservedIndexCount:0,this._nextVertexStart=c.vertexStart+c.reservedVertexCount}}return this}getBoundingBoxAt(e,i){if(e>=this._geometryCount)return null;const r=this.geometry,n=this._geometryInfo[e];if(n.boundingBox===null){const s=new Vo,a=r.index,o=r.attributes.position;for(let l=n.start,c=n.start+n.count;l<c;l++){let u=l;a&&(u=a.getX(u)),s.expandByPoint(QS.fromBufferAttribute(o,u))}n.boundingBox=s}return i.copy(n.boundingBox),i}getBoundingSphereAt(e,i){if(e>=this._geometryCount)return null;const r=this.geometry,n=this._geometryInfo[e];if(n.boundingSphere===null){const s=new _o;this.getBoundingBoxAt(e,k2),k2.getCenter(s.center);const a=r.index,o=r.attributes.position;let l=0;for(let c=n.start,u=n.start+n.count;c<u;c++){let h=c;a&&(h=a.getX(h)),QS.fromBufferAttribute(o,h),l=Math.max(l,s.center.distanceToSquared(QS))}s.radius=Math.sqrt(l),n.boundingSphere=s}return i.copy(n.boundingSphere),i}setMatrixAt(e,i){this.validateInstanceId(e);const r=this._matricesTexture,n=this._matricesTexture.image.data;return i.toArray(n,e*16),r.needsUpdate=!0,this}getMatrixAt(e,i){return this.validateInstanceId(e),i.fromArray(this._matricesTexture.image.data,e*16)}setColorAt(e,i){return this.validateInstanceId(e),this._colorsTexture===null&&this._initColorsTexture(),i.toArray(this._colorsTexture.image.data,e*4),this._colorsTexture.needsUpdate=!0,this}getColorAt(e,i){return this.validateInstanceId(e),i.fromArray(this._colorsTexture.image.data,e*4)}setVisibleAt(e,i){return this.validateInstanceId(e),this._instanceInfo[e].visible===i?this:(this._instanceInfo[e].visible=i,this._visibilityChanged=!0,this)}getVisibleAt(e){return this.validateInstanceId(e),this._instanceInfo[e].visible}setGeometryIdAt(e,i){return this.validateInstanceId(e),this.validateGeometryId(i),this._instanceInfo[e].geometryIndex=i,this}getGeometryIdAt(e){return this.validateInstanceId(e),this._instanceInfo[e].geometryIndex}getGeometryRangeAt(e,i={}){this.validateGeometryId(e);const r=this._geometryInfo[e];return i.vertexStart=r.vertexStart,i.vertexCount=r.vertexCount,i.reservedVertexCount=r.reservedVertexCount,i.indexStart=r.indexStart,i.indexCount=r.indexCount,i.reservedIndexCount=r.reservedIndexCount,i.start=r.start,i.count=r.count,i}setInstanceCount(e){const i=this._availableInstanceIds,r=this._instanceInfo;for(i.sort(LU);i[i.length-1]===r.length-1;)r.pop(),i.pop();if(e<r.length)throw new Error(`BatchedMesh: Instance ids outside the range ${e} are being used. Cannot shrink instance count.`);const n=new Int32Array(e),s=new Int32Array(e);py(this._multiDrawCounts,n),py(this._multiDrawStarts,s),this._multiDrawCounts=n,this._multiDrawStarts=s,this._maxInstanceCount=e;const a=this._indirectTexture,o=this._matricesTexture,l=this._colorsTexture;a.dispose(),this._initIndirectTexture(),py(a.image.data,this._indirectTexture.image.data),o.dispose(),this._initMatricesTexture(),py(o.image.data,this._matricesTexture.image.data),l&&(l.dispose(),this._initColorsTexture(),py(l.image.data,this._colorsTexture.image.data))}setGeometrySize(e,i){const r=[...this._geometryInfo].filter(o=>o.active);if(Math.max(...r.map(o=>o.vertexStart+o.reservedVertexCount))>e)throw new Error(`BatchedMesh: Geometry vertex values are being used outside the range ${i}. Cannot shrink further.`);if(this.geometry.index&&Math.max(...r.map(l=>l.indexStart+l.reservedIndexCount))>i)throw new Error(`BatchedMesh: Geometry index values are being used outside the range ${i}. Cannot shrink further.`);const s=this.geometry;s.dispose(),this._maxVertexCount=e,this._maxIndexCount=i,this._geometryInitialized&&(this._geometryInitialized=!1,this.geometry=new dr,this._initializeGeometry(s));const a=this.geometry;s.index&&py(s.index.array,a.index.array);for(const o in s.attributes)py(s.attributes[o].array,a.attributes[o].array)}raycast(e,i){const r=this._instanceInfo,n=this._geometryInfo,s=this.matrixWorld,a=this.geometry;Lo.material=this.material,Lo.geometry.index=a.index,Lo.geometry.attributes=a.attributes,Lo.geometry.boundingBox===null&&(Lo.geometry.boundingBox=new Vo),Lo.geometry.boundingSphere===null&&(Lo.geometry.boundingSphere=new _o);for(let o=0,l=r.length;o<l;o++){if(!r[o].visible||!r[o].active)continue;const c=r[o].geometryIndex,u=n[c];Lo.geometry.setDrawRange(u.start,u.count),this.getMatrixAt(o,Lo.matrixWorld).premultiply(s),this.getBoundingBoxAt(c,Lo.geometry.boundingBox),this.getBoundingSphereAt(c,Lo.geometry.boundingSphere),Lo.raycast(e,N2);for(let h=0,d=N2.length;h<d;h++){const f=N2[h];f.object=this,f.batchId=o,i.push(f)}N2.length=0}Lo.material=null,Lo.geometry.index=null,Lo.geometry.attributes={},Lo.geometry.setDrawRange(0,1/0)}copy(e){return super.copy(e),this.geometry=e.geometry.clone(),this.perObjectFrustumCulled=e.perObjectFrustumCulled,this.sortObjects=e.sortObjects,this.boundingBox=e.boundingBox!==null?e.boundingBox.clone():null,this.boundingSphere=e.boundingSphere!==null?e.boundingSphere.clone():null,this._geometryInfo=e._geometryInfo.map(i=>({...i,boundingBox:i.boundingBox!==null?i.boundingBox.clone():null,boundingSphere:i.boundingSphere!==null?i.boundingSphere.clone():null})),this._instanceInfo=e._instanceInfo.map(i=>({...i})),this._availableInstanceIds=e._availableInstanceIds.slice(),this._availableGeometryIds=e._availableGeometryIds.slice(),this._nextIndexStart=e._nextIndexStart,this._nextVertexStart=e._nextVertexStart,this._geometryCount=e._geometryCount,this._maxInstanceCount=e._maxInstanceCount,this._maxVertexCount=e._maxVertexCount,this._maxIndexCount=e._maxIndexCount,this._geometryInitialized=e._geometryInitialized,this._multiDrawCounts=e._multiDrawCounts.slice(),this._multiDrawStarts=e._multiDrawStarts.slice(),this._indirectTexture=e._indirectTexture.clone(),this._indirectTexture.image.data=this._indirectTexture.image.data.slice(),this._matricesTexture=e._matricesTexture.clone(),this._matricesTexture.image.data=this._matricesTexture.image.data.slice(),this._colorsTexture!==null&&(this._colorsTexture=e._colorsTexture.clone(),this._colorsTexture.image.data=this._colorsTexture.image.data.slice()),this}dispose(){this.geometry.dispose(),this._matricesTexture.dispose(),this._matricesTexture=null,this._indirectTexture.dispose(),this._indirectTexture=null,this._colorsTexture!==null&&(this._colorsTexture.dispose(),this._colorsTexture=null)}onBeforeRender(e,i,r,n,s){if(!this._visibilityChanged&&!this.perObjectFrustumCulled&&!this.sortObjects)return;const a=n.getIndex(),o=a===null?1:a.array.BYTES_PER_ELEMENT,l=this._instanceInfo,c=this._multiDrawStarts,u=this._multiDrawCounts,h=this._geometryInfo,d=this.perObjectFrustumCulled,f=this._indirectTexture,p=f.image.data,g=r.isArrayCamera?l3e:L$;d&&!r.isArrayCamera&&(Fl.multiplyMatrices(r.projectionMatrix,r.matrixWorldInverse).multiply(this.matrixWorld),L$.setFromProjectionMatrix(Fl,r.coordinateSystem,r.reversedDepth));let m=0;if(this.sortObjects){Fl.copy(this.matrixWorld).invert(),QS.setFromMatrixPosition(r.matrixWorld).applyMatrix4(Fl),k$.set(0,0,-1).transformDirection(r.matrixWorld).transformDirection(Fl);for(let w=0,E=l.length;w<E;w++)if(l[w].visible&&l[w].active){const M=l[w].geometryIndex;this.getMatrixAt(w,Fl),this.getBoundingSphereAt(M,fy).applyMatrix4(Fl);let A=!1;if(d&&(A=!g.intersectsSphere(fy,r)),!A){const P=h[M],C=c3e.subVectors(fy.center,QS).dot(k$);kU.push(P.start,P.count,C,w)}}const y=kU.list,b=this.customSort;b===null?y.sort(s.transparent?s3e:n3e):b.call(this,y,r);for(let w=0,E=y.length;w<E;w++){const M=y[w];c[m]=M.start*o,u[m]=M.count,p[m]=M.index,m++}kU.reset()}else for(let y=0,b=l.length;y<b;y++)if(l[y].visible&&l[y].active){const w=l[y].geometryIndex;let E=!1;if(d&&(this.getMatrixAt(y,Fl),this.getBoundingSphereAt(w,fy).applyMatrix4(Fl),E=!g.intersectsSphere(fy,r)),!E){const M=h[w];c[m]=M.start*o,u[m]=M.count,p[m]=y,m++}}f.needsUpdate=!0,this._multiDrawCount=m,this._visibilityChanged=!1}onBeforeShadow(e,i,r,n,s,a){this.onBeforeRender(e,null,n,s,a)}}class Sl extends Go{constructor(e){super(),this.isLineBasicMaterial=!0,this.type="LineBasicMaterial",this.color=new ii(16777215),this.map=null,this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this.fog=e.fog,this}}const MD=new be,TD=new be,N$=new zi,JS=new g_,U2=new _o,NU=new be,U$=new be;class ev extends Br{constructor(e=new dr,i=new Sl){super(),this.isLine=!0,this.type="Line",this.geometry=e,this.material=i,this.morphTargetDictionary=void 0,this.morphTargetInfluences=void 0,this.updateMorphTargets()}copy(e,i){return super.copy(e,i),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}computeLineDistances(){const e=this.geometry;if(e.index===null){const i=e.attributes.position,r=[0];for(let n=1,s=i.count;n<s;n++)MD.fromBufferAttribute(i,n-1),TD.fromBufferAttribute(i,n),r[n]=r[n-1],r[n]+=MD.distanceTo(TD);e.setAttribute("lineDistance",new hi(r,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}raycast(e,i){const r=this.geometry,n=this.matrixWorld,s=e.params.Line.threshold,a=r.drawRange;if(r.boundingSphere===null&&r.computeBoundingSphere(),U2.copy(r.boundingSphere),U2.applyMatrix4(n),U2.radius+=s,e.ray.intersectsSphere(U2)===!1)return;N$.copy(n).invert(),JS.copy(e.ray).applyMatrix4(N$);const o=s/((this.scale.x+this.scale.y+this.scale.z)/3),l=o*o,c=this.isLineSegments?2:1,u=r.index,d=r.attributes.position;if(u!==null){const f=Math.max(0,a.start),p=Math.min(u.count,a.start+a.count);for(let g=f,m=p-1;g<m;g+=c){const y=u.getX(g),b=u.getX(g+1),w=B2(this,e,JS,l,y,b,g);w&&i.push(w)}if(this.isLineLoop){const g=u.getX(p-1),m=u.getX(f),y=B2(this,e,JS,l,g,m,p-1);y&&i.push(y)}}else{const f=Math.max(0,a.start),p=Math.min(d.count,a.start+a.count);for(let g=f,m=p-1;g<m;g+=c){const y=B2(this,e,JS,l,g,g+1,g);y&&i.push(y)}if(this.isLineLoop){const g=B2(this,e,JS,l,p-1,f,p-1);g&&i.push(g)}}}updateMorphTargets(){const i=this.geometry.morphAttributes,r=Object.keys(i);if(r.length>0){const n=i[r[0]];if(n!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let s=0,a=n.length;s<a;s++){const o=n[s].name||String(s);this.morphTargetInfluences.push(0),this.morphTargetDictionary[o]=s}}}}}function B2(t,e,i,r,n,s,a){const o=t.geometry.attributes.position;if(MD.fromBufferAttribute(o,n),TD.fromBufferAttribute(o,s),i.distanceSqToSegment(MD,TD,NU,U$)>r)return;NU.applyMatrix4(t.matrixWorld);const c=e.ray.origin.distanceTo(NU);if(!(c<e.near||c>e.far))return{distance:c,point:U$.clone().applyMatrix4(t.matrixWorld),index:a,face:null,faceIndex:null,barycoord:null,object:t}}const B$=new be,F$=new be;class of extends ev{constructor(e,i){super(e,i),this.isLineSegments=!0,this.type="LineSegments"}computeLineDistances(){const e=this.geometry;if(e.index===null){const i=e.attributes.position,r=[];for(let n=0,s=i.count;n<s;n+=2)B$.fromBufferAttribute(i,n),F$.fromBufferAttribute(i,n+1),r[n]=n===0?0:r[n-1],r[n+1]=r[n]+B$.distanceTo(F$);e.setAttribute("lineDistance",new hi(r,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}}class Qoe extends ev{constructor(e,i){super(e,i),this.isLineLoop=!0,this.type="LineLoop"}}class IO extends Go{constructor(e){super(),this.isPointsMaterial=!0,this.type="PointsMaterial",this.color=new ii(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}}const z$=new zi,Yz=new g_,F2=new _o,z2=new be;let Joe=class extends Br{constructor(e=new dr,i=new IO){super(),this.isPoints=!0,this.type="Points",this.geometry=e,this.material=i,this.morphTargetDictionary=void 0,this.morphTargetInfluences=void 0,this.updateMorphTargets()}copy(e,i){return super.copy(e,i),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}raycast(e,i){const r=this.geometry,n=this.matrixWorld,s=e.params.Points.threshold,a=r.drawRange;if(r.boundingSphere===null&&r.computeBoundingSphere(),F2.copy(r.boundingSphere),F2.applyMatrix4(n),F2.radius+=s,e.ray.intersectsSphere(F2)===!1)return;z$.copy(n).invert(),Yz.copy(e.ray).applyMatrix4(z$);const o=s/((this.scale.x+this.scale.y+this.scale.z)/3),l=o*o,c=r.index,h=r.attributes.position;if(c!==null){const d=Math.max(0,a.start),f=Math.min(c.count,a.start+a.count);for(let p=d,g=f;p<g;p++){const m=c.getX(p);z2.fromBufferAttribute(h,m),j$(z2,m,l,n,e,i,this)}}else{const d=Math.max(0,a.start),f=Math.min(h.count,a.start+a.count);for(let p=d,g=f;p<g;p++)z2.fromBufferAttribute(h,p),j$(z2,p,l,n,e,i,this)}}updateMorphTargets(){const i=this.geometry.morphAttributes,r=Object.keys(i);if(r.length>0){const n=i[r[0]];if(n!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let s=0,a=n.length;s<a;s++){const o=n[s].name||String(s);this.morphTargetInfluences.push(0),this.morphTargetDictionary[o]=s}}}}};function j$(t,e,i,r,n,s,a){const o=Yz.distanceSqToPoint(t);if(o<i){const l=new be;Yz.closestPointToPoint(t,l),l.applyMatrix4(r);const c=n.ray.origin.distanceTo(l);if(c<n.near||c>n.far)return;s.push({distance:c,distanceToRay:Math.sqrt(o),point:l,index:e,face:null,faceIndex:null,barycoord:null,object:a})}}class ele extends ls{constructor(e,i,r,n,s=ma,a=ma,o,l,c){super(e,i,r,n,s,a,o,l,c),this.isVideoTexture=!0,this.generateMipmaps=!1,this._requestVideoFrameCallbackId=0;const u=this;function h(){u.needsUpdate=!0,u._requestVideoFrameCallbackId=e.requestVideoFrameCallback(h)}"requestVideoFrameCallback"in e&&(this._requestVideoFrameCallbackId=e.requestVideoFrameCallback(h))}clone(){return new this.constructor(this.image).copy(this)}update(){const e=this.image;"requestVideoFrameCallback"in e===!1&&e.readyState>=e.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}dispose(){this._requestVideoFrameCallbackId!==0&&this.source.data.cancelVideoFrameCallback(this._requestVideoFrameCallbackId),super.dispose()}}class h3e extends ele{constructor(e,i,r,n,s,a,o,l){super({},e,i,r,n,s,a,o,l),this.isVideoFrameTexture=!0}update(){}clone(){return new this.constructor().copy(this)}setFrame(e){this.image=e,this.needsUpdate=!0}}class d3e extends ls{constructor(e,i){super({width:e,height:i}),this.isFramebufferTexture=!0,this.magFilter=wo,this.minFilter=wo,this.generateMipmaps=!1,this.needsUpdate=!0}}class DO extends ls{constructor(e,i,r,n,s,a,o,l,c,u,h,d){super(null,a,o,l,c,u,n,s,h,d),this.isCompressedTexture=!0,this.image={width:i,height:r},this.mipmaps=e,this.flipY=!1,this.generateMipmaps=!1}}class f3e extends DO{constructor(e,i,r,n,s,a){super(e,i,r,s,a),this.isCompressedArrayTexture=!0,this.image.depth=n,this.wrapR=gu,this.layerUpdates=new Set}addLayerUpdate(e){this.layerUpdates.add(e)}clearLayerUpdates(){this.layerUpdates.clear()}}class p3e extends DO{constructor(e,i,r){super(void 0,e[0].width,e[0].height,i,r,zp),this.isCompressedCubeTexture=!0,this.isCubeTexture=!0,this.image=e}}class m3e extends ls{constructor(e,i,r,n,s,a,o,l,c){super(e,i,r,n,s,a,o,l,c),this.isCanvasTexture=!0,this.needsUpdate=!0}}class iH extends ls{constructor(e,i,r=jp,n,s,a,o=wo,l=wo,c,u=D1,h=1){if(u!==D1&&u!==O1)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");const d={width:e,height:i,depth:h};super(d,n,s,a,o,l,u,r,c),this.isDepthTexture=!0,this.flipY=!1,this.generateMipmaps=!1,this.compareFunction=null}copy(e){return super.copy(e),this.source=new Cg(Object.assign({},e.image)),this.compareFunction=e.compareFunction,this}toJSON(e){const i=super.toJSON(e);return this.compareFunction!==null&&(i.compareFunction=this.compareFunction),i}}class rH extends ls{constructor(e=null){super(),this.sourceTexture=e,this.isExternalTexture=!0}copy(e){return super.copy(e),this.sourceTexture=e.sourceTexture,this}}class OO extends dr{constructor(e=1,i=1,r=4,n=8,s=1){super(),this.type="CapsuleGeometry",this.parameters={radius:e,height:i,capSegments:r,radialSegments:n,heightSegments:s},i=Math.max(0,i),r=Math.max(1,Math.floor(r)),n=Math.max(3,Math.floor(n)),s=Math.max(1,Math.floor(s));const a=[],o=[],l=[],c=[],u=i/2,h=Math.PI/2*e,d=i,f=2*h+d,p=r*2+s,g=n+1,m=new be,y=new be;for(let b=0;b<=p;b++){let w=0,E=0,M=0,A=0;if(b<=r){const R=b/r,I=R*Math.PI/2;E=-u-e*Math.cos(I),M=e*Math.sin(I),A=-e*Math.cos(I),w=R*h}else if(b<=r+s){const R=(b-r)/s;E=-u+R*i,M=e,A=0,w=h+R*d}else{const R=(b-r-s)/r,I=R*Math.PI/2;E=u+e*Math.sin(I),M=e*Math.cos(I),A=e*Math.sin(I),w=h+d+R*h}const P=Math.max(0,Math.min(1,w/f));let C=0;b===0?C=.5/n:b===p&&(C=-.5/n);for(let R=0;R<=n;R++){const I=R/n,k=I*Math.PI*2,z=Math.sin(k),V=Math.cos(k);y.x=-M*V,y.y=E,y.z=M*z,o.push(y.x,y.y,y.z),m.set(-M*V,A,M*z),m.normalize(),l.push(m.x,m.y,m.z),c.push(I+C,P)}if(b>0){const R=(b-1)*g;for(let I=0;I<n;I++){const k=R+I,z=R+I+1,V=b*g+I,F=b*g+I+1;a.push(k,z,V),a.push(z,F,V)}}}this.setIndex(a),this.setAttribute("position",new hi(o,3)),this.setAttribute("normal",new hi(l,3)),this.setAttribute("uv",new hi(c,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new OO(e.radius,e.height,e.capSegments,e.radialSegments,e.heightSegments)}}class LO extends dr{constructor(e=1,i=32,r=0,n=Math.PI*2){super(),this.type="CircleGeometry",this.parameters={radius:e,segments:i,thetaStart:r,thetaLength:n},i=Math.max(3,i);const s=[],a=[],o=[],l=[],c=new be,u=new At;a.push(0,0,0),o.push(0,0,1),l.push(.5,.5);for(let h=0,d=3;h<=i;h++,d+=3){const f=r+h/i*n;c.x=e*Math.cos(f),c.y=e*Math.sin(f),a.push(c.x,c.y,c.z),o.push(0,0,1),u.x=(a[d]/e+1)/2,u.y=(a[d+1]/e+1)/2,l.push(u.x,u.y)}for(let h=1;h<=i;h++)s.push(h,h+1,0);this.setIndex(s),this.setAttribute("position",new hi(a,3)),this.setAttribute("normal",new hi(o,3)),this.setAttribute("uv",new hi(l,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new LO(e.radius,e.segments,e.thetaStart,e.thetaLength)}}class bT extends dr{constructor(e=1,i=1,r=1,n=32,s=1,a=!1,o=0,l=Math.PI*2){super(),this.type="CylinderGeometry",this.parameters={radiusTop:e,radiusBottom:i,height:r,radialSegments:n,heightSegments:s,openEnded:a,thetaStart:o,thetaLength:l};const c=this;n=Math.floor(n),s=Math.floor(s);const u=[],h=[],d=[],f=[];let p=0;const g=[],m=r/2;let y=0;b(),a===!1&&(e>0&&w(!0),i>0&&w(!1)),this.setIndex(u),this.setAttribute("position",new hi(h,3)),this.setAttribute("normal",new hi(d,3)),this.setAttribute("uv",new hi(f,2));function b(){const E=new be,M=new be;let A=0;const P=(i-e)/r;for(let C=0;C<=s;C++){const R=[],I=C/s,k=I*(i-e)+e;for(let z=0;z<=n;z++){const V=z/n,F=V*l+o,$=Math.sin(F),K=Math.cos(F);M.x=k*$,M.y=-I*r+m,M.z=k*K,h.push(M.x,M.y,M.z),E.set($,P,K).normalize(),d.push(E.x,E.y,E.z),f.push(V,1-I),R.push(p++)}g.push(R)}for(let C=0;C<n;C++)for(let R=0;R<s;R++){const I=g[R][C],k=g[R+1][C],z=g[R+1][C+1],V=g[R][C+1];(e>0||R!==0)&&(u.push(I,k,V),A+=3),(i>0||R!==s-1)&&(u.push(k,z,V),A+=3)}c.addGroup(y,A,0),y+=A}function w(E){const M=p,A=new At,P=new be;let C=0;const R=E===!0?e:i,I=E===!0?1:-1;for(let z=1;z<=n;z++)h.push(0,m*I,0),d.push(0,I,0),f.push(.5,.5),p++;const k=p;for(let z=0;z<=n;z++){const F=z/n*l+o,$=Math.cos(F),K=Math.sin(F);P.x=R*K,P.y=m*I,P.z=R*$,h.push(P.x,P.y,P.z),d.push(0,I,0),A.x=$*.5+.5,A.y=K*.5*I+.5,f.push(A.x,A.y),p++}for(let z=0;z<n;z++){const V=M+z,F=k+z;E===!0?u.push(F,F+1,V):u.push(F+1,F,V),C+=3}c.addGroup(y,C,E===!0?1:2),y+=C}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new bT(e.radiusTop,e.radiusBottom,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}class wT extends bT{constructor(e=1,i=1,r=32,n=1,s=!1,a=0,o=Math.PI*2){super(0,e,i,r,n,s,a,o),this.type="ConeGeometry",this.parameters={radius:e,height:i,radialSegments:r,heightSegments:n,openEnded:s,thetaStart:a,thetaLength:o}}static fromJSON(e){return new wT(e.radius,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}class hv extends dr{constructor(e=[],i=[],r=1,n=0){super(),this.type="PolyhedronGeometry",this.parameters={vertices:e,indices:i,radius:r,detail:n};const s=[],a=[];o(n),c(r),u(),this.setAttribute("position",new hi(s,3)),this.setAttribute("normal",new hi(s.slice(),3)),this.setAttribute("uv",new hi(a,2)),n===0?this.computeVertexNormals():this.normalizeNormals();function o(b){const w=new be,E=new be,M=new be;for(let A=0;A<i.length;A+=3)f(i[A+0],w),f(i[A+1],E),f(i[A+2],M),l(w,E,M,b)}function l(b,w,E,M){const A=M+1,P=[];for(let C=0;C<=A;C++){P[C]=[];const R=b.clone().lerp(E,C/A),I=w.clone().lerp(E,C/A),k=A-C;for(let z=0;z<=k;z++)z===0&&C===A?P[C][z]=R:P[C][z]=R.clone().lerp(I,z/k)}for(let C=0;C<A;C++)for(let R=0;R<2*(A-C)-1;R++){const I=Math.floor(R/2);R%2===0?(d(P[C][I+1]),d(P[C+1][I]),d(P[C][I])):(d(P[C][I+1]),d(P[C+1][I+1]),d(P[C+1][I]))}}function c(b){const w=new be;for(let E=0;E<s.length;E+=3)w.x=s[E+0],w.y=s[E+1],w.z=s[E+2],w.normalize().multiplyScalar(b),s[E+0]=w.x,s[E+1]=w.y,s[E+2]=w.z}function u(){const b=new be;for(let w=0;w<s.length;w+=3){b.x=s[w+0],b.y=s[w+1],b.z=s[w+2];const E=m(b)/2/Math.PI+.5,M=y(b)/Math.PI+.5;a.push(E,1-M)}p(),h()}function h(){for(let b=0;b<a.length;b+=6){const w=a[b+0],E=a[b+2],M=a[b+4],A=Math.max(w,E,M),P=Math.min(w,E,M);A>.9&&P<.1&&(w<.2&&(a[b+0]+=1),E<.2&&(a[b+2]+=1),M<.2&&(a[b+4]+=1))}}function d(b){s.push(b.x,b.y,b.z)}function f(b,w){const E=b*3;w.x=e[E+0],w.y=e[E+1],w.z=e[E+2]}function p(){const b=new be,w=new be,E=new be,M=new be,A=new At,P=new At,C=new At;for(let R=0,I=0;R<s.length;R+=9,I+=6){b.set(s[R+0],s[R+1],s[R+2]),w.set(s[R+3],s[R+4],s[R+5]),E.set(s[R+6],s[R+7],s[R+8]),A.set(a[I+0],a[I+1]),P.set(a[I+2],a[I+3]),C.set(a[I+4],a[I+5]),M.copy(b).add(w).add(E).divideScalar(3);const k=m(M);g(A,I+0,b,k),g(P,I+2,w,k),g(C,I+4,E,k)}}function g(b,w,E,M){M<0&&b.x===1&&(a[w]=b.x-1),E.x===0&&E.z===0&&(a[w]=M/2/Math.PI+.5)}function m(b){return Math.atan2(b.z,-b.x)}function y(b){return Math.atan2(-b.y,Math.sqrt(b.x*b.x+b.z*b.z))}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new hv(e.vertices,e.indices,e.radius,e.details)}}class kO extends hv{constructor(e=1,i=0){const r=(1+Math.sqrt(5))/2,n=1/r,s=[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-n,-r,0,-n,r,0,n,-r,0,n,r,-n,-r,0,-n,r,0,n,-r,0,n,r,0,-r,0,-n,r,0,-n,-r,0,n,r,0,n],a=[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9];super(s,a,e,i),this.type="DodecahedronGeometry",this.parameters={radius:e,detail:i}}static fromJSON(e){return new kO(e.radius,e.detail)}}const j2=new be,V2=new be,UU=new be,H2=new Kl;class tle extends dr{constructor(e=null,i=1){if(super(),this.type="EdgesGeometry",this.parameters={geometry:e,thresholdAngle:i},e!==null){const n=Math.pow(10,4),s=Math.cos(f0*i),a=e.getIndex(),o=e.getAttribute("position"),l=a?a.count:o.count,c=[0,0,0],u=["a","b","c"],h=new Array(3),d={},f=[];for(let p=0;p<l;p+=3){a?(c[0]=a.getX(p),c[1]=a.getX(p+1),c[2]=a.getX(p+2)):(c[0]=p,c[1]=p+1,c[2]=p+2);const{a:g,b:m,c:y}=H2;if(g.fromBufferAttribute(o,c[0]),m.fromBufferAttribute(o,c[1]),y.fromBufferAttribute(o,c[2]),H2.getNormal(UU),h[0]=`${Math.round(g.x*n)},${Math.round(g.y*n)},${Math.round(g.z*n)}`,h[1]=`${Math.round(m.x*n)},${Math.round(m.y*n)},${Math.round(m.z*n)}`,h[2]=`${Math.round(y.x*n)},${Math.round(y.y*n)},${Math.round(y.z*n)}`,!(h[0]===h[1]||h[1]===h[2]||h[2]===h[0]))for(let b=0;b<3;b++){const w=(b+1)%3,E=h[b],M=h[w],A=H2[u[b]],P=H2[u[w]],C=`${E}_${M}`,R=`${M}_${E}`;R in d&&d[R]?(UU.dot(d[R].normal)<=s&&(f.push(A.x,A.y,A.z),f.push(P.x,P.y,P.z)),d[R]=null):C in d||(d[C]={index0:c[b],index1:c[w],normal:UU.clone()})}}for(const p in d)if(d[p]){const{index0:g,index1:m}=d[p];j2.fromBufferAttribute(o,g),V2.fromBufferAttribute(o,m),f.push(j2.x,j2.y,j2.z),f.push(V2.x,V2.y,V2.z)}this.setAttribute("position",new hi(f,3))}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}}class Uh{constructor(){this.type="Curve",this.arcLengthDivisions=200,this.needsUpdate=!1,this.cacheArcLengths=null}getPoint(){console.warn("THREE.Curve: .getPoint() not implemented.")}getPointAt(e,i){const r=this.getUtoTmapping(e);return this.getPoint(r,i)}getPoints(e=5){const i=[];for(let r=0;r<=e;r++)i.push(this.getPoint(r/e));return i}getSpacedPoints(e=5){const i=[];for(let r=0;r<=e;r++)i.push(this.getPointAt(r/e));return i}getLength(){const e=this.getLengths();return e[e.length-1]}getLengths(e=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const i=[];let r,n=this.getPoint(0),s=0;i.push(0);for(let a=1;a<=e;a++)r=this.getPoint(a/e),s+=r.distanceTo(n),i.push(s),n=r;return this.cacheArcLengths=i,i}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(e,i=null){const r=this.getLengths();let n=0;const s=r.length;let a;i?a=i:a=e*r[s-1];let o=0,l=s-1,c;for(;o<=l;)if(n=Math.floor(o+(l-o)/2),c=r[n]-a,c<0)o=n+1;else if(c>0)l=n-1;else{l=n;break}if(n=l,r[n]===a)return n/(s-1);const u=r[n],d=r[n+1]-u,f=(a-u)/d;return(n+f)/(s-1)}getTangent(e,i){let n=e-1e-4,s=e+1e-4;n<0&&(n=0),s>1&&(s=1);const a=this.getPoint(n),o=this.getPoint(s),l=i||(a.isVector2?new At:new be);return l.copy(o).sub(a).normalize(),l}getTangentAt(e,i){const r=this.getUtoTmapping(e);return this.getTangent(r,i)}computeFrenetFrames(e,i=!1){const r=new be,n=[],s=[],a=[],o=new be,l=new zi;for(let f=0;f<=e;f++){const p=f/e;n[f]=this.getTangentAt(p,new be)}s[0]=new be,a[0]=new be;let c=Number.MAX_VALUE;const u=Math.abs(n[0].x),h=Math.abs(n[0].y),d=Math.abs(n[0].z);u<=c&&(c=u,r.set(1,0,0)),h<=c&&(c=h,r.set(0,1,0)),d<=c&&r.set(0,0,1),o.crossVectors(n[0],r).normalize(),s[0].crossVectors(n[0],o),a[0].crossVectors(n[0],s[0]);for(let f=1;f<=e;f++){if(s[f]=s[f-1].clone(),a[f]=a[f-1].clone(),o.crossVectors(n[f-1],n[f]),o.length()>Number.EPSILON){o.normalize();const p=Math.acos(Fi(n[f-1].dot(n[f]),-1,1));s[f].applyMatrix4(l.makeRotationAxis(o,p))}a[f].crossVectors(n[f],s[f])}if(i===!0){let f=Math.acos(Fi(s[0].dot(s[e]),-1,1));f/=e,n[0].dot(o.crossVectors(s[0],s[e]))>0&&(f=-f);for(let p=1;p<=e;p++)s[p].applyMatrix4(l.makeRotationAxis(n[p],f*p)),a[p].crossVectors(n[p],s[p])}return{tangents:n,normals:s,binormals:a}}clone(){return new this.constructor().copy(this)}copy(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}toJSON(){const e={metadata:{version:4.7,type:"Curve",generator:"Curve.toJSON"}};return e.arcLengthDivisions=this.arcLengthDivisions,e.type=this.type,e}fromJSON(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}}class NO extends Uh{constructor(e=0,i=0,r=1,n=1,s=0,a=Math.PI*2,o=!1,l=0){super(),this.isEllipseCurve=!0,this.type="EllipseCurve",this.aX=e,this.aY=i,this.xRadius=r,this.yRadius=n,this.aStartAngle=s,this.aEndAngle=a,this.aClockwise=o,this.aRotation=l}getPoint(e,i=new At){const r=i,n=Math.PI*2;let s=this.aEndAngle-this.aStartAngle;const a=Math.abs(s)<Number.EPSILON;for(;s<0;)s+=n;for(;s>n;)s-=n;s<Number.EPSILON&&(a?s=0:s=n),this.aClockwise===!0&&!a&&(s===n?s=-n:s=s-n);const o=this.aStartAngle+e*s;let l=this.aX+this.xRadius*Math.cos(o),c=this.aY+this.yRadius*Math.sin(o);if(this.aRotation!==0){const u=Math.cos(this.aRotation),h=Math.sin(this.aRotation),d=l-this.aX,f=c-this.aY;l=d*u-f*h+this.aX,c=d*h+f*u+this.aY}return r.set(l,c)}copy(e){return super.copy(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}toJSON(){const e=super.toJSON();return e.aX=this.aX,e.aY=this.aY,e.xRadius=this.xRadius,e.yRadius=this.yRadius,e.aStartAngle=this.aStartAngle,e.aEndAngle=this.aEndAngle,e.aClockwise=this.aClockwise,e.aRotation=this.aRotation,e}fromJSON(e){return super.fromJSON(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}}class ile extends NO{constructor(e,i,r,n,s,a){super(e,i,r,r,n,s,a),this.isArcCurve=!0,this.type="ArcCurve"}}function nH(){let t=0,e=0,i=0,r=0;function n(s,a,o,l){t=s,e=o,i=-3*s+3*a-2*o-l,r=2*s-2*a+o+l}return{initCatmullRom:function(s,a,o,l,c){n(a,o,c*(o-s),c*(l-a))},initNonuniformCatmullRom:function(s,a,o,l,c,u,h){let d=(a-s)/c-(o-s)/(c+u)+(o-a)/u,f=(o-a)/u-(l-a)/(u+h)+(l-o)/h;d*=u,f*=u,n(a,o,d,f)},calc:function(s){const a=s*s,o=a*s;return t+e*s+i*a+r*o}}}const G2=new be,BU=new nH,FU=new nH,zU=new nH;class rle extends Uh{constructor(e=[],i=!1,r="centripetal",n=.5){super(),this.isCatmullRomCurve3=!0,this.type="CatmullRomCurve3",this.points=e,this.closed=i,this.curveType=r,this.tension=n}getPoint(e,i=new be){const r=i,n=this.points,s=n.length,a=(s-(this.closed?0:1))*e;let o=Math.floor(a),l=a-o;this.closed?o+=o>0?0:(Math.floor(Math.abs(o)/s)+1)*s:l===0&&o===s-1&&(o=s-2,l=1);let c,u;this.closed||o>0?c=n[(o-1)%s]:(G2.subVectors(n[0],n[1]).add(n[0]),c=G2);const h=n[o%s],d=n[(o+1)%s];if(this.closed||o+2<s?u=n[(o+2)%s]:(G2.subVectors(n[s-1],n[s-2]).add(n[s-1]),u=G2),this.curveType==="centripetal"||this.curveType==="chordal"){const f=this.curveType==="chordal"?.5:.25;let p=Math.pow(c.distanceToSquared(h),f),g=Math.pow(h.distanceToSquared(d),f),m=Math.pow(d.distanceToSquared(u),f);g<1e-4&&(g=1),p<1e-4&&(p=g),m<1e-4&&(m=g),BU.initNonuniformCatmullRom(c.x,h.x,d.x,u.x,p,g,m),FU.initNonuniformCatmullRom(c.y,h.y,d.y,u.y,p,g,m),zU.initNonuniformCatmullRom(c.z,h.z,d.z,u.z,p,g,m)}else this.curveType==="catmullrom"&&(BU.initCatmullRom(c.x,h.x,d.x,u.x,this.tension),FU.initCatmullRom(c.y,h.y,d.y,u.y,this.tension),zU.initCatmullRom(c.z,h.z,d.z,u.z,this.tension));return r.set(BU.calc(l),FU.calc(l),zU.calc(l)),r}copy(e){super.copy(e),this.points=[];for(let i=0,r=e.points.length;i<r;i++){const n=e.points[i];this.points.push(n.clone())}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}toJSON(){const e=super.toJSON();e.points=[];for(let i=0,r=this.points.length;i<r;i++){const n=this.points[i];e.points.push(n.toArray())}return e.closed=this.closed,e.curveType=this.curveType,e.tension=this.tension,e}fromJSON(e){super.fromJSON(e),this.points=[];for(let i=0,r=e.points.length;i<r;i++){const n=e.points[i];this.points.push(new be().fromArray(n))}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}}function V$(t,e,i,r,n){const s=(r-e)*.5,a=(n-i)*.5,o=t*t,l=t*o;return(2*i-2*r+s+a)*l+(-3*i+3*r-2*s-a)*o+s*t+i}function g3e(t,e){const i=1-t;return i*i*e}function v3e(t,e){return 2*(1-t)*t*e}function y3e(t,e){return t*t*e}function EA(t,e,i,r){return g3e(t,e)+v3e(t,i)+y3e(t,r)}function x3e(t,e){const i=1-t;return i*i*i*e}function b3e(t,e){const i=1-t;return 3*i*i*t*e}function w3e(t,e){return 3*(1-t)*t*t*e}function _3e(t,e){return t*t*t*e}function AA(t,e,i,r,n){return x3e(t,e)+b3e(t,i)+w3e(t,r)+_3e(t,n)}class sH extends Uh{constructor(e=new At,i=new At,r=new At,n=new At){super(),this.isCubicBezierCurve=!0,this.type="CubicBezierCurve",this.v0=e,this.v1=i,this.v2=r,this.v3=n}getPoint(e,i=new At){const r=i,n=this.v0,s=this.v1,a=this.v2,o=this.v3;return r.set(AA(e,n.x,s.x,a.x,o.x),AA(e,n.y,s.y,a.y,o.y)),r}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}class nle extends Uh{constructor(e=new be,i=new be,r=new be,n=new be){super(),this.isCubicBezierCurve3=!0,this.type="CubicBezierCurve3",this.v0=e,this.v1=i,this.v2=r,this.v3=n}getPoint(e,i=new be){const r=i,n=this.v0,s=this.v1,a=this.v2,o=this.v3;return r.set(AA(e,n.x,s.x,a.x,o.x),AA(e,n.y,s.y,a.y,o.y),AA(e,n.z,s.z,a.z,o.z)),r}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}class aH extends Uh{constructor(e=new At,i=new At){super(),this.isLineCurve=!0,this.type="LineCurve",this.v1=e,this.v2=i}getPoint(e,i=new At){const r=i;return e===1?r.copy(this.v2):(r.copy(this.v2).sub(this.v1),r.multiplyScalar(e).add(this.v1)),r}getPointAt(e,i){return this.getPoint(e,i)}getTangent(e,i=new At){return i.subVectors(this.v2,this.v1).normalize()}getTangentAt(e,i){return this.getTangent(e,i)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class sle extends Uh{constructor(e=new be,i=new be){super(),this.isLineCurve3=!0,this.type="LineCurve3",this.v1=e,this.v2=i}getPoint(e,i=new be){const r=i;return e===1?r.copy(this.v2):(r.copy(this.v2).sub(this.v1),r.multiplyScalar(e).add(this.v1)),r}getPointAt(e,i){return this.getPoint(e,i)}getTangent(e,i=new be){return i.subVectors(this.v2,this.v1).normalize()}getTangentAt(e,i){return this.getTangent(e,i)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class oH extends Uh{constructor(e=new At,i=new At,r=new At){super(),this.isQuadraticBezierCurve=!0,this.type="QuadraticBezierCurve",this.v0=e,this.v1=i,this.v2=r}getPoint(e,i=new At){const r=i,n=this.v0,s=this.v1,a=this.v2;return r.set(EA(e,n.x,s.x,a.x),EA(e,n.y,s.y,a.y)),r}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class lH extends Uh{constructor(e=new be,i=new be,r=new be){super(),this.isQuadraticBezierCurve3=!0,this.type="QuadraticBezierCurve3",this.v0=e,this.v1=i,this.v2=r}getPoint(e,i=new be){const r=i,n=this.v0,s=this.v1,a=this.v2;return r.set(EA(e,n.x,s.x,a.x),EA(e,n.y,s.y,a.y),EA(e,n.z,s.z,a.z)),r}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class cH extends Uh{constructor(e=[]){super(),this.isSplineCurve=!0,this.type="SplineCurve",this.points=e}getPoint(e,i=new At){const r=i,n=this.points,s=(n.length-1)*e,a=Math.floor(s),o=s-a,l=n[a===0?a:a-1],c=n[a],u=n[a>n.length-2?n.length-1:a+1],h=n[a>n.length-3?n.length-1:a+2];return r.set(V$(o,l.x,c.x,u.x,h.x),V$(o,l.y,c.y,u.y,h.y)),r}copy(e){super.copy(e),this.points=[];for(let i=0,r=e.points.length;i<r;i++){const n=e.points[i];this.points.push(n.clone())}return this}toJSON(){const e=super.toJSON();e.points=[];for(let i=0,r=this.points.length;i<r;i++){const n=this.points[i];e.points.push(n.toArray())}return e}fromJSON(e){super.fromJSON(e),this.points=[];for(let i=0,r=e.points.length;i<r;i++){const n=e.points[i];this.points.push(new At().fromArray(n))}return this}}var CD=Object.freeze({__proto__:null,ArcCurve:ile,CatmullRomCurve3:rle,CubicBezierCurve:sH,CubicBezierCurve3:nle,EllipseCurve:NO,LineCurve:aH,LineCurve3:sle,QuadraticBezierCurve:oH,QuadraticBezierCurve3:lH,SplineCurve:cH});class ale extends Uh{constructor(){super(),this.type="CurvePath",this.curves=[],this.autoClose=!1}add(e){this.curves.push(e)}closePath(){const e=this.curves[0].getPoint(0),i=this.curves[this.curves.length-1].getPoint(1);if(!e.equals(i)){const r=e.isVector2===!0?"LineCurve":"LineCurve3";this.curves.push(new CD[r](i,e))}return this}getPoint(e,i){const r=e*this.getLength(),n=this.getCurveLengths();let s=0;for(;s<n.length;){if(n[s]>=r){const a=n[s]-r,o=this.curves[s],l=o.getLength(),c=l===0?0:1-a/l;return o.getPointAt(c,i)}s++}return null}getLength(){const e=this.getCurveLengths();return e[e.length-1]}updateArcLengths(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;const e=[];let i=0;for(let r=0,n=this.curves.length;r<n;r++)i+=this.curves[r].getLength(),e.push(i);return this.cacheLengths=e,e}getSpacedPoints(e=40){const i=[];for(let r=0;r<=e;r++)i.push(this.getPoint(r/e));return this.autoClose&&i.push(i[0]),i}getPoints(e=12){const i=[];let r;for(let n=0,s=this.curves;n<s.length;n++){const a=s[n],o=a.isEllipseCurve?e*2:a.isLineCurve||a.isLineCurve3?1:a.isSplineCurve?e*a.points.length:e,l=a.getPoints(o);for(let c=0;c<l.length;c++){const u=l[c];r&&r.equals(u)||(i.push(u),r=u)}}return this.autoClose&&i.length>1&&!i[i.length-1].equals(i[0])&&i.push(i[0]),i}copy(e){super.copy(e),this.curves=[];for(let i=0,r=e.curves.length;i<r;i++){const n=e.curves[i];this.curves.push(n.clone())}return this.autoClose=e.autoClose,this}toJSON(){const e=super.toJSON();e.autoClose=this.autoClose,e.curves=[];for(let i=0,r=this.curves.length;i<r;i++){const n=this.curves[i];e.curves.push(n.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.autoClose=e.autoClose,this.curves=[];for(let i=0,r=e.curves.length;i<r;i++){const n=e.curves[i];this.curves.push(new CD[n.type]().fromJSON(n))}return this}}class PD extends ale{constructor(e){super(),this.type="Path",this.currentPoint=new At,e&&this.setFromPoints(e)}setFromPoints(e){this.moveTo(e[0].x,e[0].y);for(let i=1,r=e.length;i<r;i++)this.lineTo(e[i].x,e[i].y);return this}moveTo(e,i){return this.currentPoint.set(e,i),this}lineTo(e,i){const r=new aH(this.currentPoint.clone(),new At(e,i));return this.curves.push(r),this.currentPoint.set(e,i),this}quadraticCurveTo(e,i,r,n){const s=new oH(this.currentPoint.clone(),new At(e,i),new At(r,n));return this.curves.push(s),this.currentPoint.set(r,n),this}bezierCurveTo(e,i,r,n,s,a){const o=new sH(this.currentPoint.clone(),new At(e,i),new At(r,n),new At(s,a));return this.curves.push(o),this.currentPoint.set(s,a),this}splineThru(e){const i=[this.currentPoint.clone()].concat(e),r=new cH(i);return this.curves.push(r),this.currentPoint.copy(e[e.length-1]),this}arc(e,i,r,n,s,a){const o=this.currentPoint.x,l=this.currentPoint.y;return this.absarc(e+o,i+l,r,n,s,a),this}absarc(e,i,r,n,s,a){return this.absellipse(e,i,r,r,n,s,a),this}ellipse(e,i,r,n,s,a,o,l){const c=this.currentPoint.x,u=this.currentPoint.y;return this.absellipse(e+c,i+u,r,n,s,a,o,l),this}absellipse(e,i,r,n,s,a,o,l){const c=new NO(e,i,r,n,s,a,o,l);if(this.curves.length>0){const h=c.getPoint(0);h.equals(this.currentPoint)||this.lineTo(h.x,h.y)}this.curves.push(c);const u=c.getPoint(1);return this.currentPoint.copy(u),this}copy(e){return super.copy(e),this.currentPoint.copy(e.currentPoint),this}toJSON(){const e=super.toJSON();return e.currentPoint=this.currentPoint.toArray(),e}fromJSON(e){return super.fromJSON(e),this.currentPoint.fromArray(e.currentPoint),this}}class m0 extends PD{constructor(e){super(e),this.uuid=Rc(),this.type="Shape",this.holes=[]}getPointsHoles(e){const i=[];for(let r=0,n=this.holes.length;r<n;r++)i[r]=this.holes[r].getPoints(e);return i}extractPoints(e){return{shape:this.getPoints(e),holes:this.getPointsHoles(e)}}copy(e){super.copy(e),this.holes=[];for(let i=0,r=e.holes.length;i<r;i++){const n=e.holes[i];this.holes.push(n.clone())}return this}toJSON(){const e=super.toJSON();e.uuid=this.uuid,e.holes=[];for(let i=0,r=this.holes.length;i<r;i++){const n=this.holes[i];e.holes.push(n.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.uuid=e.uuid,this.holes=[];for(let i=0,r=e.holes.length;i<r;i++){const n=e.holes[i];this.holes.push(new PD().fromJSON(n))}return this}}function S3e(t,e,i=2){const r=e&&e.length,n=r?e[0]*i:t.length;let s=ole(t,0,n,i,!0);const a=[];if(!s||s.next===s.prev)return a;let o,l,c;if(r&&(s=C3e(t,e,s,i)),t.length>80*i){o=1/0,l=1/0;let u=-1/0,h=-1/0;for(let d=i;d<n;d+=i){const f=t[d],p=t[d+1];f<o&&(o=f),p<l&&(l=p),f>u&&(u=f),p>h&&(h=p)}c=Math.max(u-o,h-l),c=c!==0?32767/c:0}return yM(s,a,i,o,l,c,0),a}function ole(t,e,i,r,n){let s;if(n===F3e(t,e,i,r)>0)for(let a=e;a<i;a+=r)s=H$(a/r|0,t[a],t[a+1],s);else for(let a=i-r;a>=e;a-=r)s=H$(a/r|0,t[a],t[a+1],s);return s&&B1(s,s.next)&&(bM(s),s=s.next),s}function P0(t,e){if(!t)return t;e||(e=t);let i=t,r;do if(r=!1,!i.steiner&&(B1(i,i.next)||$n(i.prev,i,i.next)===0)){if(bM(i),i=e=i.prev,i===i.next)break;r=!0}else i=i.next;while(r||i!==e);return e}function yM(t,e,i,r,n,s,a){if(!t)return;!a&&s&&O3e(t,r,n,s);let o=t;for(;t.prev!==t.next;){const l=t.prev,c=t.next;if(s?A3e(t,r,n,s):E3e(t)){e.push(l.i,t.i,c.i),bM(t),t=c.next,o=c.next;continue}if(t=c,t===o){a?a===1?(t=M3e(P0(t),e),yM(t,e,i,r,n,s,2)):a===2&&T3e(t,e,i,r,n,s):yM(P0(t),e,i,r,n,s,1);break}}}function E3e(t){const e=t.prev,i=t,r=t.next;if($n(e,i,r)>=0)return!1;const n=e.x,s=i.x,a=r.x,o=e.y,l=i.y,c=r.y,u=Math.min(n,s,a),h=Math.min(o,l,c),d=Math.max(n,s,a),f=Math.max(o,l,c);let p=r.next;for(;p!==e;){if(p.x>=u&&p.x<=d&&p.y>=h&&p.y<=f&&FE(n,o,s,l,a,c,p.x,p.y)&&$n(p.prev,p,p.next)>=0)return!1;p=p.next}return!0}function A3e(t,e,i,r){const n=t.prev,s=t,a=t.next;if($n(n,s,a)>=0)return!1;const o=n.x,l=s.x,c=a.x,u=n.y,h=s.y,d=a.y,f=Math.min(o,l,c),p=Math.min(u,h,d),g=Math.max(o,l,c),m=Math.max(u,h,d),y=Kz(f,p,e,i,r),b=Kz(g,m,e,i,r);let w=t.prevZ,E=t.nextZ;for(;w&&w.z>=y&&E&&E.z<=b;){if(w.x>=f&&w.x<=g&&w.y>=p&&w.y<=m&&w!==n&&w!==a&&FE(o,u,l,h,c,d,w.x,w.y)&&$n(w.prev,w,w.next)>=0||(w=w.prevZ,E.x>=f&&E.x<=g&&E.y>=p&&E.y<=m&&E!==n&&E!==a&&FE(o,u,l,h,c,d,E.x,E.y)&&$n(E.prev,E,E.next)>=0))return!1;E=E.nextZ}for(;w&&w.z>=y;){if(w.x>=f&&w.x<=g&&w.y>=p&&w.y<=m&&w!==n&&w!==a&&FE(o,u,l,h,c,d,w.x,w.y)&&$n(w.prev,w,w.next)>=0)return!1;w=w.prevZ}for(;E&&E.z<=b;){if(E.x>=f&&E.x<=g&&E.y>=p&&E.y<=m&&E!==n&&E!==a&&FE(o,u,l,h,c,d,E.x,E.y)&&$n(E.prev,E,E.next)>=0)return!1;E=E.nextZ}return!0}function M3e(t,e){let i=t;do{const r=i.prev,n=i.next.next;!B1(r,n)&&cle(r,i,i.next,n)&&xM(r,n)&&xM(n,r)&&(e.push(r.i,i.i,n.i),bM(i),bM(i.next),i=t=n),i=i.next}while(i!==t);return P0(i)}function T3e(t,e,i,r,n,s){let a=t;do{let o=a.next.next;for(;o!==a.prev;){if(a.i!==o.i&&N3e(a,o)){let l=ule(a,o);a=P0(a,a.next),l=P0(l,l.next),yM(a,e,i,r,n,s,0),yM(l,e,i,r,n,s,0);return}o=o.next}a=a.next}while(a!==t)}function C3e(t,e,i,r){const n=[];for(let s=0,a=e.length;s<a;s++){const o=e[s]*r,l=s<a-1?e[s+1]*r:t.length,c=ole(t,o,l,r,!1);c===c.next&&(c.steiner=!0),n.push(k3e(c))}n.sort(P3e);for(let s=0;s<n.length;s++)i=R3e(n[s],i);return i}function P3e(t,e){let i=t.x-e.x;if(i===0&&(i=t.y-e.y,i===0)){const r=(t.next.y-t.y)/(t.next.x-t.x),n=(e.next.y-e.y)/(e.next.x-e.x);i=r-n}return i}function R3e(t,e){const i=I3e(t,e);if(!i)return e;const r=ule(i,t);return P0(r,r.next),P0(i,i.next)}function I3e(t,e){let i=e;const r=t.x,n=t.y;let s=-1/0,a;if(B1(t,i))return i;do{if(B1(t,i.next))return i.next;if(n<=i.y&&n>=i.next.y&&i.next.y!==i.y){const h=i.x+(n-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(h<=r&&h>s&&(s=h,a=i.x<i.next.x?i:i.next,h===r))return a}i=i.next}while(i!==e);if(!a)return null;const o=a,l=a.x,c=a.y;let u=1/0;i=a;do{if(r>=i.x&&i.x>=l&&r!==i.x&&lle(n<c?r:s,n,l,c,n<c?s:r,n,i.x,i.y)){const h=Math.abs(n-i.y)/(r-i.x);xM(i,t)&&(h<u||h===u&&(i.x>a.x||i.x===a.x&&D3e(a,i)))&&(a=i,u=h)}i=i.next}while(i!==o);return a}function D3e(t,e){return $n(t.prev,t,e.prev)<0&&$n(e.next,t,t.next)<0}function O3e(t,e,i,r){let n=t;do n.z===0&&(n.z=Kz(n.x,n.y,e,i,r)),n.prevZ=n.prev,n.nextZ=n.next,n=n.next;while(n!==t);n.prevZ.nextZ=null,n.prevZ=null,L3e(n)}function L3e(t){let e,i=1;do{let r=t,n;t=null;let s=null;for(e=0;r;){e++;let a=r,o=0;for(let c=0;c<i&&(o++,a=a.nextZ,!!a);c++);let l=i;for(;o>0||l>0&&a;)o!==0&&(l===0||!a||r.z<=a.z)?(n=r,r=r.nextZ,o--):(n=a,a=a.nextZ,l--),s?s.nextZ=n:t=n,n.prevZ=s,s=n;r=a}s.nextZ=null,i*=2}while(e>1);return t}function Kz(t,e,i,r,n){return t=(t-i)*n|0,e=(e-r)*n|0,t=(t|t<<8)&16711935,t=(t|t<<4)&252645135,t=(t|t<<2)&858993459,t=(t|t<<1)&1431655765,e=(e|e<<8)&16711935,e=(e|e<<4)&252645135,e=(e|e<<2)&858993459,e=(e|e<<1)&1431655765,t|e<<1}function k3e(t){let e=t,i=t;do(e.x<i.x||e.x===i.x&&e.y<i.y)&&(i=e),e=e.next;while(e!==t);return i}function lle(t,e,i,r,n,s,a,o){return(n-a)*(e-o)>=(t-a)*(s-o)&&(t-a)*(r-o)>=(i-a)*(e-o)&&(i-a)*(s-o)>=(n-a)*(r-o)}function FE(t,e,i,r,n,s,a,o){return!(t===a&&e===o)&&lle(t,e,i,r,n,s,a,o)}function N3e(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!U3e(t,e)&&(xM(t,e)&&xM(e,t)&&B3e(t,e)&&($n(t.prev,t,e.prev)||$n(t,e.prev,e))||B1(t,e)&&$n(t.prev,t,t.next)>0&&$n(e.prev,e,e.next)>0)}function $n(t,e,i){return(e.y-t.y)*(i.x-e.x)-(e.x-t.x)*(i.y-e.y)}function B1(t,e){return t.x===e.x&&t.y===e.y}function cle(t,e,i,r){const n=q2($n(t,e,i)),s=q2($n(t,e,r)),a=q2($n(i,r,t)),o=q2($n(i,r,e));return!!(n!==s&&a!==o||n===0&&W2(t,i,e)||s===0&&W2(t,r,e)||a===0&&W2(i,t,r)||o===0&&W2(i,e,r))}function W2(t,e,i){return e.x<=Math.max(t.x,i.x)&&e.x>=Math.min(t.x,i.x)&&e.y<=Math.max(t.y,i.y)&&e.y>=Math.min(t.y,i.y)}function q2(t){return t>0?1:t<0?-1:0}function U3e(t,e){let i=t;do{if(i.i!==t.i&&i.next.i!==t.i&&i.i!==e.i&&i.next.i!==e.i&&cle(i,i.next,t,e))return!0;i=i.next}while(i!==t);return!1}function xM(t,e){return $n(t.prev,t,t.next)<0?$n(t,e,t.next)>=0&&$n(t,t.prev,e)>=0:$n(t,e,t.prev)<0||$n(t,t.next,e)<0}function B3e(t,e){let i=t,r=!1;const n=(t.x+e.x)/2,s=(t.y+e.y)/2;do i.y>s!=i.next.y>s&&i.next.y!==i.y&&n<(i.next.x-i.x)*(s-i.y)/(i.next.y-i.y)+i.x&&(r=!r),i=i.next;while(i!==t);return r}function ule(t,e){const i=Zz(t.i,t.x,t.y),r=Zz(e.i,e.x,e.y),n=t.next,s=e.prev;return t.next=e,e.prev=t,i.next=n,n.prev=i,r.next=i,i.prev=r,s.next=r,r.prev=s,r}function H$(t,e,i,r){const n=Zz(t,e,i);return r?(n.next=r.next,n.prev=r,r.next.prev=n,r.next=n):(n.prev=n,n.next=n),n}function bM(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function Zz(t,e,i){return{i:t,x:e,y:i,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function F3e(t,e,i,r){let n=0;for(let s=e,a=i-r;s<i;s+=r)n+=(t[a]-t[s])*(t[s+1]+t[a+1]),a=s;return n}class z3e{static triangulate(e,i,r=2){return S3e(e,i,r)}}class xh{static area(e){const i=e.length;let r=0;for(let n=i-1,s=0;s<i;n=s++)r+=e[n].x*e[s].y-e[s].x*e[n].y;return r*.5}static isClockWise(e){return xh.area(e)<0}static triangulateShape(e,i){const r=[],n=[],s=[];G$(e),W$(r,e);let a=e.length;i.forEach(G$);for(let l=0;l<i.length;l++)n.push(a),a+=i[l].length,W$(r,i[l]);const o=z3e.triangulate(r,n);for(let l=0;l<o.length;l+=3)s.push(o.slice(l,l+3));return s}}function G$(t){const e=t.length;e>2&&t[e-1].equals(t[0])&&t.pop()}function W$(t,e){for(let i=0;i<e.length;i++)t.push(e[i].x),t.push(e[i].y)}class UO extends dr{constructor(e=new m0([new At(.5,.5),new At(-.5,.5),new At(-.5,-.5),new At(.5,-.5)]),i={}){super(),this.type="ExtrudeGeometry",this.parameters={shapes:e,options:i},e=Array.isArray(e)?e:[e];const r=this,n=[],s=[];for(let o=0,l=e.length;o<l;o++){const c=e[o];a(c)}this.setAttribute("position",new hi(n,3)),this.setAttribute("uv",new hi(s,2)),this.computeVertexNormals();function a(o){const l=[],c=i.curveSegments!==void 0?i.curveSegments:12,u=i.steps!==void 0?i.steps:1,h=i.depth!==void 0?i.depth:1;let d=i.bevelEnabled!==void 0?i.bevelEnabled:!0,f=i.bevelThickness!==void 0?i.bevelThickness:.2,p=i.bevelSize!==void 0?i.bevelSize:f-.1,g=i.bevelOffset!==void 0?i.bevelOffset:0,m=i.bevelSegments!==void 0?i.bevelSegments:3;const y=i.extrudePath,b=i.UVGenerator!==void 0?i.UVGenerator:j3e;let w,E=!1,M,A,P,C;y&&(w=y.getSpacedPoints(u),E=!0,d=!1,M=y.computeFrenetFrames(u,!1),A=new be,P=new be,C=new be),d||(m=0,f=0,p=0,g=0);const R=o.extractPoints(c);let I=R.shape;const k=R.holes;if(!xh.isClockWise(I)){I=I.reverse();for(let Fe=0,De=k.length;Fe<De;Fe++){const He=k[Fe];xh.isClockWise(He)&&(k[Fe]=He.reverse())}}function V(Fe){const He=10000000000000001e-36;let Be=Fe[0];for(let $e=1;$e<=Fe.length;$e++){const ze=$e%Fe.length,it=Fe[ze],wt=it.x-Be.x,ge=it.y-Be.y,G=wt*wt+ge*ge,Q=Math.max(Math.abs(it.x),Math.abs(it.y),Math.abs(Be.x),Math.abs(Be.y)),we=He*Q*Q;if(G<=we){Fe.splice(ze,1),$e--;continue}Be=it}}V(I),k.forEach(V);const F=k.length,$=I;for(let Fe=0;Fe<F;Fe++){const De=k[Fe];I=I.concat(De)}function K(Fe,De,He){return De||console.error("THREE.ExtrudeGeometry: vec does not exist"),Fe.clone().addScaledVector(De,He)}const X=I.length;function U(Fe,De,He){let Be,$e,ze;const it=Fe.x-De.x,wt=Fe.y-De.y,ge=He.x-Fe.x,G=He.y-Fe.y,Q=it*it+wt*wt,we=it*G-wt*ge;if(Math.abs(we)>Number.EPSILON){const te=Math.sqrt(Q),Ne=Math.sqrt(ge*ge+G*G),Le=De.x-wt/te,at=De.y+it/te,Te=He.x-G/Ne,dt=He.y+ge/Ne,ot=((Te-Le)*G-(dt-at)*ge)/(it*G-wt*ge);Be=Le+it*ot-Fe.x,$e=at+wt*ot-Fe.y;const Qe=Be*Be+$e*$e;if(Qe<=2)return new At(Be,$e);ze=Math.sqrt(Qe/2)}else{let te=!1;it>Number.EPSILON?ge>Number.EPSILON&&(te=!0):it<-Number.EPSILON?ge<-Number.EPSILON&&(te=!0):Math.sign(wt)===Math.sign(G)&&(te=!0),te?(Be=-wt,$e=it,ze=Math.sqrt(Q)):(Be=it,$e=wt,ze=Math.sqrt(Q/2))}return new At(Be/ze,$e/ze)}const Y=[];for(let Fe=0,De=$.length,He=De-1,Be=Fe+1;Fe<De;Fe++,He++,Be++)He===De&&(He=0),Be===De&&(Be=0),Y[Fe]=U($[Fe],$[He],$[Be]);const Z=[];let j,ee=Y.concat();for(let Fe=0,De=F;Fe<De;Fe++){const He=k[Fe];j=[];for(let Be=0,$e=He.length,ze=$e-1,it=Be+1;Be<$e;Be++,ze++,it++)ze===$e&&(ze=0),it===$e&&(it=0),j[Be]=U(He[Be],He[ze],He[it]);Z.push(j),ee=ee.concat(j)}let pe;if(m===0)pe=xh.triangulateShape($,k);else{const Fe=[],De=[];for(let He=0;He<m;He++){const Be=He/m,$e=f*Math.cos(Be*Math.PI/2),ze=p*Math.sin(Be*Math.PI/2)+g;for(let it=0,wt=$.length;it<wt;it++){const ge=K($[it],Y[it],ze);ve(ge.x,ge.y,-$e),Be===0&&Fe.push(ge)}for(let it=0,wt=F;it<wt;it++){const ge=k[it];j=Z[it];const G=[];for(let Q=0,we=ge.length;Q<we;Q++){const te=K(ge[Q],j[Q],ze);ve(te.x,te.y,-$e),Be===0&&G.push(te)}Be===0&&De.push(G)}}pe=xh.triangulateShape(Fe,De)}const fe=pe.length,se=p+g;for(let Fe=0;Fe<X;Fe++){const De=d?K(I[Fe],ee[Fe],se):I[Fe];E?(P.copy(M.normals[0]).multiplyScalar(De.x),A.copy(M.binormals[0]).multiplyScalar(De.y),C.copy(w[0]).add(P).add(A),ve(C.x,C.y,C.z)):ve(De.x,De.y,0)}for(let Fe=1;Fe<=u;Fe++)for(let De=0;De<X;De++){const He=d?K(I[De],ee[De],se):I[De];E?(P.copy(M.normals[Fe]).multiplyScalar(He.x),A.copy(M.binormals[Fe]).multiplyScalar(He.y),C.copy(w[Fe]).add(P).add(A),ve(C.x,C.y,C.z)):ve(He.x,He.y,h/u*Fe)}for(let Fe=m-1;Fe>=0;Fe--){const De=Fe/m,He=f*Math.cos(De*Math.PI/2),Be=p*Math.sin(De*Math.PI/2)+g;for(let $e=0,ze=$.length;$e<ze;$e++){const it=K($[$e],Y[$e],Be);ve(it.x,it.y,h+He)}for(let $e=0,ze=k.length;$e<ze;$e++){const it=k[$e];j=Z[$e];for(let wt=0,ge=it.length;wt<ge;wt++){const G=K(it[wt],j[wt],Be);E?ve(G.x,G.y+w[u-1].y,w[u-1].x+He):ve(G.x,G.y,h+He)}}}re(),le();function re(){const Fe=n.length/3;if(d){let De=0,He=X*De;for(let Be=0;Be<fe;Be++){const $e=pe[Be];xe($e[2]+He,$e[1]+He,$e[0]+He)}De=u+m*2,He=X*De;for(let Be=0;Be<fe;Be++){const $e=pe[Be];xe($e[0]+He,$e[1]+He,$e[2]+He)}}else{for(let De=0;De<fe;De++){const He=pe[De];xe(He[2],He[1],He[0])}for(let De=0;De<fe;De++){const He=pe[De];xe(He[0]+X*u,He[1]+X*u,He[2]+X*u)}}r.addGroup(Fe,n.length/3-Fe,0)}function le(){const Fe=n.length/3;let De=0;he($,De),De+=$.length;for(let He=0,Be=k.length;He<Be;He++){const $e=k[He];he($e,De),De+=$e.length}r.addGroup(Fe,n.length/3-Fe,1)}function he(Fe,De){let He=Fe.length;for(;--He>=0;){const Be=He;let $e=He-1;$e<0&&($e=Fe.length-1);for(let ze=0,it=u+m*2;ze<it;ze++){const wt=X*ze,ge=X*(ze+1),G=De+Be+wt,Q=De+$e+wt,we=De+$e+ge,te=De+Be+ge;Se(G,Q,we,te)}}}function ve(Fe,De,He){l.push(Fe),l.push(De),l.push(He)}function xe(Fe,De,He){Ce(Fe),Ce(De),Ce(He);const Be=n.length/3,$e=b.generateTopUV(r,n,Be-3,Be-2,Be-1);ce($e[0]),ce($e[1]),ce($e[2])}function Se(Fe,De,He,Be){Ce(Fe),Ce(De),Ce(Be),Ce(De),Ce(He),Ce(Be);const $e=n.length/3,ze=b.generateSideWallUV(r,n,$e-6,$e-3,$e-2,$e-1);ce(ze[0]),ce(ze[1]),ce(ze[3]),ce(ze[1]),ce(ze[2]),ce(ze[3])}function Ce(Fe){n.push(l[Fe*3+0]),n.push(l[Fe*3+1]),n.push(l[Fe*3+2])}function ce(Fe){s.push(Fe.x),s.push(Fe.y)}}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}toJSON(){const e=super.toJSON(),i=this.parameters.shapes,r=this.parameters.options;return V3e(i,r,e)}static fromJSON(e,i){const r=[];for(let s=0,a=e.shapes.length;s<a;s++){const o=i[e.shapes[s]];r.push(o)}const n=e.options.extrudePath;return n!==void 0&&(e.options.extrudePath=new CD[n.type]().fromJSON(n)),new UO(r,e.options)}}const j3e={generateTopUV:function(t,e,i,r,n){const s=e[i*3],a=e[i*3+1],o=e[r*3],l=e[r*3+1],c=e[n*3],u=e[n*3+1];return[new At(s,a),new At(o,l),new At(c,u)]},generateSideWallUV:function(t,e,i,r,n,s){const a=e[i*3],o=e[i*3+1],l=e[i*3+2],c=e[r*3],u=e[r*3+1],h=e[r*3+2],d=e[n*3],f=e[n*3+1],p=e[n*3+2],g=e[s*3],m=e[s*3+1],y=e[s*3+2];return Math.abs(o-u)<Math.abs(a-c)?[new At(a,1-l),new At(c,1-h),new At(d,1-p),new At(g,1-y)]:[new At(o,1-l),new At(u,1-h),new At(f,1-p),new At(m,1-y)]}};function V3e(t,e,i){if(i.shapes=[],Array.isArray(t))for(let r=0,n=t.length;r<n;r++){const s=t[r];i.shapes.push(s.uuid)}else i.shapes.push(t.uuid);return i.options=Object.assign({},e),e.extrudePath!==void 0&&(i.options.extrudePath=e.extrudePath.toJSON()),i}class BO extends hv{constructor(e=1,i=0){const r=(1+Math.sqrt(5))/2,n=[-1,r,0,1,r,0,-1,-r,0,1,-r,0,0,-1,r,0,1,r,0,-1,-r,0,1,-r,r,0,-1,r,0,1,-r,0,-1,-r,0,1],s=[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1];super(n,s,e,i),this.type="IcosahedronGeometry",this.parameters={radius:e,detail:i}}static fromJSON(e){return new BO(e.radius,e.detail)}}class FO extends dr{constructor(e=[new At(0,-.5),new At(.5,0),new At(0,.5)],i=12,r=0,n=Math.PI*2){super(),this.type="LatheGeometry",this.parameters={points:e,segments:i,phiStart:r,phiLength:n},i=Math.floor(i),n=Fi(n,0,Math.PI*2);const s=[],a=[],o=[],l=[],c=[],u=1/i,h=new be,d=new At,f=new be,p=new be,g=new be;let m=0,y=0;for(let b=0;b<=e.length-1;b++)switch(b){case 0:m=e[b+1].x-e[b].x,y=e[b+1].y-e[b].y,f.x=y*1,f.y=-m,f.z=y*0,g.copy(f),f.normalize(),l.push(f.x,f.y,f.z);break;case e.length-1:l.push(g.x,g.y,g.z);break;default:m=e[b+1].x-e[b].x,y=e[b+1].y-e[b].y,f.x=y*1,f.y=-m,f.z=y*0,p.copy(f),f.x+=g.x,f.y+=g.y,f.z+=g.z,f.normalize(),l.push(f.x,f.y,f.z),g.copy(p)}for(let b=0;b<=i;b++){const w=r+b*u*n,E=Math.sin(w),M=Math.cos(w);for(let A=0;A<=e.length-1;A++){h.x=e[A].x*E,h.y=e[A].y,h.z=e[A].x*M,a.push(h.x,h.y,h.z),d.x=b/i,d.y=A/(e.length-1),o.push(d.x,d.y);const P=l[3*A+0]*E,C=l[3*A+1],R=l[3*A+0]*M;c.push(P,C,R)}}for(let b=0;b<i;b++)for(let w=0;w<e.length-1;w++){const E=w+b*e.length,M=E,A=E+e.length,P=E+e.length+1,C=E+1;s.push(M,A,C),s.push(P,C,A)}this.setIndex(s),this.setAttribute("position",new hi(a,3)),this.setAttribute("uv",new hi(o,2)),this.setAttribute("normal",new hi(c,3))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new FO(e.points,e.segments,e.phiStart,e.phiLength)}}class _T extends hv{constructor(e=1,i=0){const r=[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],n=[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2];super(r,n,e,i),this.type="OctahedronGeometry",this.parameters={radius:e,detail:i}}static fromJSON(e){return new _T(e.radius,e.detail)}}class y_ extends dr{constructor(e=1,i=1,r=1,n=1){super(),this.type="PlaneGeometry",this.parameters={width:e,height:i,widthSegments:r,heightSegments:n};const s=e/2,a=i/2,o=Math.floor(r),l=Math.floor(n),c=o+1,u=l+1,h=e/o,d=i/l,f=[],p=[],g=[],m=[];for(let y=0;y<u;y++){const b=y*d-a;for(let w=0;w<c;w++){const E=w*h-s;p.push(E,-b,0),g.push(0,0,1),m.push(w/o),m.push(1-y/l)}}for(let y=0;y<l;y++)for(let b=0;b<o;b++){const w=b+c*y,E=b+c*(y+1),M=b+1+c*(y+1),A=b+1+c*y;f.push(w,E,A),f.push(E,M,A)}this.setIndex(f),this.setAttribute("position",new hi(p,3)),this.setAttribute("normal",new hi(g,3)),this.setAttribute("uv",new hi(m,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new y_(e.width,e.height,e.widthSegments,e.heightSegments)}}class zO extends dr{constructor(e=.5,i=1,r=32,n=1,s=0,a=Math.PI*2){super(),this.type="RingGeometry",this.parameters={innerRadius:e,outerRadius:i,thetaSegments:r,phiSegments:n,thetaStart:s,thetaLength:a},r=Math.max(3,r),n=Math.max(1,n);const o=[],l=[],c=[],u=[];let h=e;const d=(i-e)/n,f=new be,p=new At;for(let g=0;g<=n;g++){for(let m=0;m<=r;m++){const y=s+m/r*a;f.x=h*Math.cos(y),f.y=h*Math.sin(y),l.push(f.x,f.y,f.z),c.push(0,0,1),p.x=(f.x/i+1)/2,p.y=(f.y/i+1)/2,u.push(p.x,p.y)}h+=d}for(let g=0;g<n;g++){const m=g*(r+1);for(let y=0;y<r;y++){const b=y+m,w=b,E=b+r+1,M=b+r+2,A=b+1;o.push(w,E,A),o.push(E,M,A)}}this.setIndex(o),this.setAttribute("position",new hi(l,3)),this.setAttribute("normal",new hi(c,3)),this.setAttribute("uv",new hi(u,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new zO(e.innerRadius,e.outerRadius,e.thetaSegments,e.phiSegments,e.thetaStart,e.thetaLength)}}class jO extends dr{constructor(e=new m0([new At(0,.5),new At(-.5,-.5),new At(.5,-.5)]),i=12){super(),this.type="ShapeGeometry",this.parameters={shapes:e,curveSegments:i};const r=[],n=[],s=[],a=[];let o=0,l=0;if(Array.isArray(e)===!1)c(e);else for(let u=0;u<e.length;u++)c(e[u]),this.addGroup(o,l,u),o+=l,l=0;this.setIndex(r),this.setAttribute("position",new hi(n,3)),this.setAttribute("normal",new hi(s,3)),this.setAttribute("uv",new hi(a,2));function c(u){const h=n.length/3,d=u.extractPoints(i);let f=d.shape;const p=d.holes;xh.isClockWise(f)===!1&&(f=f.reverse());for(let m=0,y=p.length;m<y;m++){const b=p[m];xh.isClockWise(b)===!0&&(p[m]=b.reverse())}const g=xh.triangulateShape(f,p);for(let m=0,y=p.length;m<y;m++){const b=p[m];f=f.concat(b)}for(let m=0,y=f.length;m<y;m++){const b=f[m];n.push(b.x,b.y,0),s.push(0,0,1),a.push(b.x,b.y)}for(let m=0,y=g.length;m<y;m++){const b=g[m],w=b[0]+h,E=b[1]+h,M=b[2]+h;r.push(w,E,M),l+=3}}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}toJSON(){const e=super.toJSON(),i=this.parameters.shapes;return H3e(i,e)}static fromJSON(e,i){const r=[];for(let n=0,s=e.shapes.length;n<s;n++){const a=i[e.shapes[n]];r.push(a)}return new jO(r,e.curveSegments)}}function H3e(t,e){if(e.shapes=[],Array.isArray(t))for(let i=0,r=t.length;i<r;i++){const n=t[i];e.shapes.push(n.uuid)}else e.shapes.push(t.uuid);return e}class ST extends dr{constructor(e=1,i=32,r=16,n=0,s=Math.PI*2,a=0,o=Math.PI){super(),this.type="SphereGeometry",this.parameters={radius:e,widthSegments:i,heightSegments:r,phiStart:n,phiLength:s,thetaStart:a,thetaLength:o},i=Math.max(3,Math.floor(i)),r=Math.max(2,Math.floor(r));const l=Math.min(a+o,Math.PI);let c=0;const u=[],h=new be,d=new be,f=[],p=[],g=[],m=[];for(let y=0;y<=r;y++){const b=[],w=y/r;let E=0;y===0&&a===0?E=.5/i:y===r&&l===Math.PI&&(E=-.5/i);for(let M=0;M<=i;M++){const A=M/i;h.x=-e*Math.cos(n+A*s)*Math.sin(a+w*o),h.y=e*Math.cos(a+w*o),h.z=e*Math.sin(n+A*s)*Math.sin(a+w*o),p.push(h.x,h.y,h.z),d.copy(h).normalize(),g.push(d.x,d.y,d.z),m.push(A+E,1-w),b.push(c++)}u.push(b)}for(let y=0;y<r;y++)for(let b=0;b<i;b++){const w=u[y][b+1],E=u[y][b],M=u[y+1][b],A=u[y+1][b+1];(y!==0||a>0)&&f.push(w,E,A),(y!==r-1||l<Math.PI)&&f.push(E,M,A)}this.setIndex(f),this.setAttribute("position",new hi(p,3)),this.setAttribute("normal",new hi(g,3)),this.setAttribute("uv",new hi(m,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new ST(e.radius,e.widthSegments,e.heightSegments,e.phiStart,e.phiLength,e.thetaStart,e.thetaLength)}}class VO extends hv{constructor(e=1,i=0){const r=[1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],n=[2,1,0,0,3,2,1,3,0,2,3,1];super(r,n,e,i),this.type="TetrahedronGeometry",this.parameters={radius:e,detail:i}}static fromJSON(e){return new VO(e.radius,e.detail)}}class HO extends dr{constructor(e=1,i=.4,r=12,n=48,s=Math.PI*2){super(),this.type="TorusGeometry",this.parameters={radius:e,tube:i,radialSegments:r,tubularSegments:n,arc:s},r=Math.floor(r),n=Math.floor(n);const a=[],o=[],l=[],c=[],u=new be,h=new be,d=new be;for(let f=0;f<=r;f++)for(let p=0;p<=n;p++){const g=p/n*s,m=f/r*Math.PI*2;h.x=(e+i*Math.cos(m))*Math.cos(g),h.y=(e+i*Math.cos(m))*Math.sin(g),h.z=i*Math.sin(m),o.push(h.x,h.y,h.z),u.x=e*Math.cos(g),u.y=e*Math.sin(g),d.subVectors(h,u).normalize(),l.push(d.x,d.y,d.z),c.push(p/n),c.push(f/r)}for(let f=1;f<=r;f++)for(let p=1;p<=n;p++){const g=(n+1)*f+p-1,m=(n+1)*(f-1)+p-1,y=(n+1)*(f-1)+p,b=(n+1)*f+p;a.push(g,m,b),a.push(m,y,b)}this.setIndex(a),this.setAttribute("position",new hi(o,3)),this.setAttribute("normal",new hi(l,3)),this.setAttribute("uv",new hi(c,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new HO(e.radius,e.tube,e.radialSegments,e.tubularSegments,e.arc)}}class GO extends dr{constructor(e=1,i=.4,r=64,n=8,s=2,a=3){super(),this.type="TorusKnotGeometry",this.parameters={radius:e,tube:i,tubularSegments:r,radialSegments:n,p:s,q:a},r=Math.floor(r),n=Math.floor(n);const o=[],l=[],c=[],u=[],h=new be,d=new be,f=new be,p=new be,g=new be,m=new be,y=new be;for(let w=0;w<=r;++w){const E=w/r*s*Math.PI*2;b(E,s,a,e,f),b(E+.01,s,a,e,p),m.subVectors(p,f),y.addVectors(p,f),g.crossVectors(m,y),y.crossVectors(g,m),g.normalize(),y.normalize();for(let M=0;M<=n;++M){const A=M/n*Math.PI*2,P=-i*Math.cos(A),C=i*Math.sin(A);h.x=f.x+(P*y.x+C*g.x),h.y=f.y+(P*y.y+C*g.y),h.z=f.z+(P*y.z+C*g.z),l.push(h.x,h.y,h.z),d.subVectors(h,f).normalize(),c.push(d.x,d.y,d.z),u.push(w/r),u.push(M/n)}}for(let w=1;w<=r;w++)for(let E=1;E<=n;E++){const M=(n+1)*(w-1)+(E-1),A=(n+1)*w+(E-1),P=(n+1)*w+E,C=(n+1)*(w-1)+E;o.push(M,A,C),o.push(A,P,C)}this.setIndex(o),this.setAttribute("position",new hi(l,3)),this.setAttribute("normal",new hi(c,3)),this.setAttribute("uv",new hi(u,2));function b(w,E,M,A,P){const C=Math.cos(w),R=Math.sin(w),I=M/E*w,k=Math.cos(I);P.x=A*(2+k)*.5*C,P.y=A*(2+k)*R*.5,P.z=A*Math.sin(I)*.5}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new GO(e.radius,e.tube,e.tubularSegments,e.radialSegments,e.p,e.q)}}class WO extends dr{constructor(e=new lH(new be(-1,-1,0),new be(-1,1,0),new be(1,1,0)),i=64,r=1,n=8,s=!1){super(),this.type="TubeGeometry",this.parameters={path:e,tubularSegments:i,radius:r,radialSegments:n,closed:s};const a=e.computeFrenetFrames(i,s);this.tangents=a.tangents,this.normals=a.normals,this.binormals=a.binormals;const o=new be,l=new be,c=new At;let u=new be;const h=[],d=[],f=[],p=[];g(),this.setIndex(p),this.setAttribute("position",new hi(h,3)),this.setAttribute("normal",new hi(d,3)),this.setAttribute("uv",new hi(f,2));function g(){for(let w=0;w<i;w++)m(w);m(s===!1?i:0),b(),y()}function m(w){u=e.getPointAt(w/i,u);const E=a.normals[w],M=a.binormals[w];for(let A=0;A<=n;A++){const P=A/n*Math.PI*2,C=Math.sin(P),R=-Math.cos(P);l.x=R*E.x+C*M.x,l.y=R*E.y+C*M.y,l.z=R*E.z+C*M.z,l.normalize(),d.push(l.x,l.y,l.z),o.x=u.x+r*l.x,o.y=u.y+r*l.y,o.z=u.z+r*l.z,h.push(o.x,o.y,o.z)}}function y(){for(let w=1;w<=i;w++)for(let E=1;E<=n;E++){const M=(n+1)*(w-1)+(E-1),A=(n+1)*w+(E-1),P=(n+1)*w+E,C=(n+1)*(w-1)+E;p.push(M,A,C),p.push(A,P,C)}}function b(){for(let w=0;w<=i;w++)for(let E=0;E<=n;E++)c.x=w/i,c.y=E/n,f.push(c.x,c.y)}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}toJSON(){const e=super.toJSON();return e.path=this.parameters.path.toJSON(),e}static fromJSON(e){return new WO(new CD[e.path.type]().fromJSON(e.path),e.tubularSegments,e.radius,e.radialSegments,e.closed)}}class hle extends dr{constructor(e=null){if(super(),this.type="WireframeGeometry",this.parameters={geometry:e},e!==null){const i=[],r=new Set,n=new be,s=new be;if(e.index!==null){const a=e.attributes.position,o=e.index;let l=e.groups;l.length===0&&(l=[{start:0,count:o.count,materialIndex:0}]);for(let c=0,u=l.length;c<u;++c){const h=l[c],d=h.start,f=h.count;for(let p=d,g=d+f;p<g;p+=3)for(let m=0;m<3;m++){const y=o.getX(p+m),b=o.getX(p+(m+1)%3);n.fromBufferAttribute(a,y),s.fromBufferAttribute(a,b),q$(n,s,r)===!0&&(i.push(n.x,n.y,n.z),i.push(s.x,s.y,s.z))}}}else{const a=e.attributes.position;for(let o=0,l=a.count/3;o<l;o++)for(let c=0;c<3;c++){const u=3*o+c,h=3*o+(c+1)%3;n.fromBufferAttribute(a,u),s.fromBufferAttribute(a,h),q$(n,s,r)===!0&&(i.push(n.x,n.y,n.z),i.push(s.x,s.y,s.z))}}this.setAttribute("position",new hi(i,3))}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}}function q$(t,e,i){const r=`${t.x},${t.y},${t.z}-${e.x},${e.y},${e.z}`,n=`${e.x},${e.y},${e.z}-${t.x},${t.y},${t.z}`;return i.has(r)===!0||i.has(n)===!0?!1:(i.add(r),i.add(n),!0)}var X$=Object.freeze({__proto__:null,BoxGeometry:W0,CapsuleGeometry:OO,CircleGeometry:LO,ConeGeometry:wT,CylinderGeometry:bT,DodecahedronGeometry:kO,EdgesGeometry:tle,ExtrudeGeometry:UO,IcosahedronGeometry:BO,LatheGeometry:FO,OctahedronGeometry:_T,PlaneGeometry:y_,PolyhedronGeometry:hv,RingGeometry:zO,ShapeGeometry:jO,SphereGeometry:ST,TetrahedronGeometry:VO,TorusGeometry:HO,TorusKnotGeometry:GO,TubeGeometry:WO,WireframeGeometry:hle});class dle extends Go{constructor(e){super(),this.isShadowMaterial=!0,this.type="ShadowMaterial",this.color=new ii(0),this.transparent=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.fog=e.fog,this}}class fle extends Ch{constructor(e){super(e),this.isRawShaderMaterial=!0,this.type="RawShaderMaterial"}}class uH extends Go{constructor(e){super(),this.isMeshStandardMaterial=!0,this.type="MeshStandardMaterial",this.defines={STANDARD:""},this.color=new ii(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new ii(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=cv,this.normalScale=new At(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new kc,this.envMapIntensity=1,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.defines={STANDARD:""},this.color.copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.envMapIntensity=e.envMapIntensity,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class ple extends uH{constructor(e){super(),this.isMeshPhysicalMaterial=!0,this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.anisotropyRotation=0,this.anisotropyMap=null,this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new At(1,1),this.clearcoatNormalMap=null,this.ior=1.5,Object.defineProperty(this,"reflectivity",{get:function(){return Fi(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(i){this.ior=(1+.4*i)/(1-.4*i)}}),this.iridescenceMap=null,this.iridescenceIOR=1.3,this.iridescenceThicknessRange=[100,400],this.iridescenceThicknessMap=null,this.sheenColor=new ii(0),this.sheenColorMap=null,this.sheenRoughness=1,this.sheenRoughnessMap=null,this.transmissionMap=null,this.thickness=0,this.thicknessMap=null,this.attenuationDistance=1/0,this.attenuationColor=new ii(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularColor=new ii(1,1,1),this.specularColorMap=null,this._anisotropy=0,this._clearcoat=0,this._dispersion=0,this._iridescence=0,this._sheen=0,this._transmission=0,this.setValues(e)}get anisotropy(){return this._anisotropy}set anisotropy(e){this._anisotropy>0!=e>0&&this.version++,this._anisotropy=e}get clearcoat(){return this._clearcoat}set clearcoat(e){this._clearcoat>0!=e>0&&this.version++,this._clearcoat=e}get iridescence(){return this._iridescence}set iridescence(e){this._iridescence>0!=e>0&&this.version++,this._iridescence=e}get dispersion(){return this._dispersion}set dispersion(e){this._dispersion>0!=e>0&&this.version++,this._dispersion=e}get sheen(){return this._sheen}set sheen(e){this._sheen>0!=e>0&&this.version++,this._sheen=e}get transmission(){return this._transmission}set transmission(e){this._transmission>0!=e>0&&this.version++,this._transmission=e}copy(e){return super.copy(e),this.defines={STANDARD:"",PHYSICAL:""},this.anisotropy=e.anisotropy,this.anisotropyRotation=e.anisotropyRotation,this.anisotropyMap=e.anisotropyMap,this.clearcoat=e.clearcoat,this.clearcoatMap=e.clearcoatMap,this.clearcoatRoughness=e.clearcoatRoughness,this.clearcoatRoughnessMap=e.clearcoatRoughnessMap,this.clearcoatNormalMap=e.clearcoatNormalMap,this.clearcoatNormalScale.copy(e.clearcoatNormalScale),this.dispersion=e.dispersion,this.ior=e.ior,this.iridescence=e.iridescence,this.iridescenceMap=e.iridescenceMap,this.iridescenceIOR=e.iridescenceIOR,this.iridescenceThicknessRange=[...e.iridescenceThicknessRange],this.iridescenceThicknessMap=e.iridescenceThicknessMap,this.sheen=e.sheen,this.sheenColor.copy(e.sheenColor),this.sheenColorMap=e.sheenColorMap,this.sheenRoughness=e.sheenRoughness,this.sheenRoughnessMap=e.sheenRoughnessMap,this.transmission=e.transmission,this.transmissionMap=e.transmissionMap,this.thickness=e.thickness,this.thicknessMap=e.thicknessMap,this.attenuationDistance=e.attenuationDistance,this.attenuationColor.copy(e.attenuationColor),this.specularIntensity=e.specularIntensity,this.specularIntensityMap=e.specularIntensityMap,this.specularColor.copy(e.specularColor),this.specularColorMap=e.specularColorMap,this}}class mle extends Go{constructor(e){super(),this.isMeshPhongMaterial=!0,this.type="MeshPhongMaterial",this.color=new ii(16777215),this.specular=new ii(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new ii(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=cv,this.normalScale=new At(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new kc,this.combine=gT,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.specular.copy(e.specular),this.shininess=e.shininess,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class gle extends Go{constructor(e){super(),this.isMeshToonMaterial=!0,this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new ii(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new ii(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=cv,this.normalScale=new At(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.gradientMap=e.gradientMap,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}class vle extends Go{constructor(e){super(),this.isMeshNormalMaterial=!0,this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=cv,this.normalScale=new At(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.flatShading=e.flatShading,this}}class yle extends Go{constructor(e){super(),this.isMeshLambertMaterial=!0,this.type="MeshLambertMaterial",this.color=new ii(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new ii(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=cv,this.normalScale=new At(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new kc,this.combine=gT,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class hH extends Go{constructor(e){super(),this.isMeshDepthMaterial=!0,this.type="MeshDepthMaterial",this.depthPacking=Roe,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(e)}copy(e){return super.copy(e),this.depthPacking=e.depthPacking,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this}}class dH extends Go{constructor(e){super(),this.isMeshDistanceMaterial=!0,this.type="MeshDistanceMaterial",this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(e)}copy(e){return super.copy(e),this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this}}class xle extends Go{constructor(e){super(),this.isMeshMatcapMaterial=!0,this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new ii(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=cv,this.normalScale=new At(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.defines={MATCAP:""},this.color.copy(e.color),this.matcap=e.matcap,this.map=e.map,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.flatShading=e.flatShading,this.fog=e.fog,this}}class ble extends Sl{constructor(e){super(),this.isLineDashedMaterial=!0,this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(e)}copy(e){return super.copy(e),this.scale=e.scale,this.dashSize=e.dashSize,this.gapSize=e.gapSize,this}}function Jy(t,e){return!t||t.constructor===e?t:typeof e.BYTES_PER_ELEMENT=="number"?new e(t):Array.prototype.slice.call(t)}function wle(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)}function _le(t){function e(n,s){return t[n]-t[s]}const i=t.length,r=new Array(i);for(let n=0;n!==i;++n)r[n]=n;return r.sort(e),r}function Qz(t,e,i){const r=t.length,n=new t.constructor(r);for(let s=0,a=0;a!==r;++s){const o=i[s]*e;for(let l=0;l!==e;++l)n[a++]=t[o+l]}return n}function fH(t,e,i,r){let n=1,s=t[0];for(;s!==void 0&&s[r]===void 0;)s=t[n++];if(s===void 0)return;let a=s[r];if(a!==void 0)if(Array.isArray(a))do a=s[r],a!==void 0&&(e.push(s.time),i.push(...a)),s=t[n++];while(s!==void 0);else if(a.toArray!==void 0)do a=s[r],a!==void 0&&(e.push(s.time),a.toArray(i,i.length)),s=t[n++];while(s!==void 0);else do a=s[r],a!==void 0&&(e.push(s.time),i.push(a)),s=t[n++];while(s!==void 0)}function G3e(t,e,i,r,n=30){const s=t.clone();s.name=e;const a=[];for(let l=0;l<s.tracks.length;++l){const c=s.tracks[l],u=c.getValueSize(),h=[],d=[];for(let f=0;f<c.times.length;++f){const p=c.times[f]*n;if(!(p<i||p>=r)){h.push(c.times[f]);for(let g=0;g<u;++g)d.push(c.values[f*u+g])}}h.length!==0&&(c.times=Jy(h,c.times.constructor),c.values=Jy(d,c.values.constructor),a.push(c))}s.tracks=a;let o=1/0;for(let l=0;l<s.tracks.length;++l)o>s.tracks[l].times[0]&&(o=s.tracks[l].times[0]);for(let l=0;l<s.tracks.length;++l)s.tracks[l].shift(-1*o);return s.resetDuration(),s}function W3e(t,e=0,i=t,r=30){r<=0&&(r=30);const n=i.tracks.length,s=e/r;for(let a=0;a<n;++a){const o=i.tracks[a],l=o.ValueTypeName;if(l==="bool"||l==="string")continue;const c=t.tracks.find(function(y){return y.name===o.name&&y.ValueTypeName===l});if(c===void 0)continue;let u=0;const h=o.getValueSize();o.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(u=h/3);let d=0;const f=c.getValueSize();c.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(d=f/3);const p=o.times.length-1;let g;if(s<=o.times[0]){const y=u,b=h-u;g=o.values.slice(y,b)}else if(s>=o.times[p]){const y=p*h+u,b=y+h-u;g=o.values.slice(y,b)}else{const y=o.createInterpolant(),b=u,w=h-u;y.evaluate(s),g=y.resultBuffer.slice(b,w)}l==="quaternion"&&new sc().fromArray(g).normalize().conjugate().toArray(g);const m=c.times.length;for(let y=0;y<m;++y){const b=y*f+d;if(l==="quaternion")sc.multiplyQuaternionsFlat(c.values,b,g,0,c.values,b);else{const w=f-d*2;for(let E=0;E<w;++E)c.values[b+E]-=g[E]}}}return t.blendMode=W6,t}class q3e{static convertArray(e,i){return Jy(e,i)}static isTypedArray(e){return wle(e)}static getKeyframeOrder(e){return _le(e)}static sortedArray(e,i,r){return Qz(e,i,r)}static flattenJSON(e,i,r,n){fH(e,i,r,n)}static subclip(e,i,r,n,s=30){return G3e(e,i,r,n,s)}static makeClipAdditive(e,i=0,r=e,n=30){return W3e(e,i,r,n)}}class ET{constructor(e,i,r,n){this.parameterPositions=e,this._cachedIndex=0,this.resultBuffer=n!==void 0?n:new i.constructor(r),this.sampleValues=i,this.valueSize=r,this.settings=null,this.DefaultSettings_={}}evaluate(e){const i=this.parameterPositions;let r=this._cachedIndex,n=i[r],s=i[r-1];e:{t:{let a;i:{r:if(!(e<n)){for(let o=r+2;;){if(n===void 0){if(e<s)break r;return r=i.length,this._cachedIndex=r,this.copySampleValue_(r-1)}if(r===o)break;if(s=n,n=i[++r],e<n)break t}a=i.length;break i}if(!(e>=s)){const o=i[1];e<o&&(r=2,s=o);for(let l=r-2;;){if(s===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(r===l)break;if(n=s,s=i[--r-1],e>=s)break t}a=r,r=0;break i}break e}for(;r<a;){const o=r+a>>>1;e<i[o]?a=o:r=o+1}if(n=i[r],s=i[r-1],s===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(n===void 0)return r=i.length,this._cachedIndex=r,this.copySampleValue_(r-1)}this._cachedIndex=r,this.intervalChanged_(r,s,n)}return this.interpolate_(r,s,e,n)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(e){const i=this.resultBuffer,r=this.sampleValues,n=this.valueSize,s=e*n;for(let a=0;a!==n;++a)i[a]=r[s+a];return i}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}}class Sle extends ET{constructor(e,i,r,n){super(e,i,r,n),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:Zy,endingEnd:Zy}}intervalChanged_(e,i,r){const n=this.parameterPositions;let s=e-2,a=e+1,o=n[s],l=n[a];if(o===void 0)switch(this.getSettings_().endingStart){case Qy:s=e,o=2*i-r;break;case fM:s=n.length-2,o=i+n[s]-n[s+1];break;default:s=e,o=r}if(l===void 0)switch(this.getSettings_().endingEnd){case Qy:a=e,l=2*r-i;break;case fM:a=1,l=r+n[1]-n[0];break;default:a=e-1,l=i}const c=(r-i)*.5,u=this.valueSize;this._weightPrev=c/(i-o),this._weightNext=c/(l-r),this._offsetPrev=s*u,this._offsetNext=a*u}interpolate_(e,i,r,n){const s=this.resultBuffer,a=this.sampleValues,o=this.valueSize,l=e*o,c=l-o,u=this._offsetPrev,h=this._offsetNext,d=this._weightPrev,f=this._weightNext,p=(r-i)/(n-i),g=p*p,m=g*p,y=-d*m+2*d*g-d*p,b=(1+d)*m+(-1.5-2*d)*g+(-.5+d)*p+1,w=(-1-f)*m+(1.5+f)*g+.5*p,E=f*m-f*g;for(let M=0;M!==o;++M)s[M]=y*a[u+M]+b*a[c+M]+w*a[l+M]+E*a[h+M];return s}}class pH extends ET{constructor(e,i,r,n){super(e,i,r,n)}interpolate_(e,i,r,n){const s=this.resultBuffer,a=this.sampleValues,o=this.valueSize,l=e*o,c=l-o,u=(r-i)/(n-i),h=1-u;for(let d=0;d!==o;++d)s[d]=a[c+d]*h+a[l+d]*u;return s}}class Ele extends ET{constructor(e,i,r,n){super(e,i,r,n)}interpolate_(e){return this.copySampleValue_(e-1)}}class Au{constructor(e,i,r,n){if(e===void 0)throw new Error("THREE.KeyframeTrack: track name is undefined");if(i===void 0||i.length===0)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+e);this.name=e,this.times=Jy(i,this.TimeBufferType),this.values=Jy(r,this.ValueBufferType),this.setInterpolation(n||this.DefaultInterpolation)}static toJSON(e){const i=e.constructor;let r;if(i.toJSON!==this.toJSON)r=i.toJSON(e);else{r={name:e.name,times:Jy(e.times,Array),values:Jy(e.values,Array)};const n=e.getInterpolation();n!==e.DefaultInterpolation&&(r.interpolation=n)}return r.type=e.ValueTypeName,r}InterpolantFactoryMethodDiscrete(e){return new Ele(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodLinear(e){return new pH(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodSmooth(e){return new Sle(this.times,this.values,this.getValueSize(),e)}setInterpolation(e){let i;switch(e){case dM:i=this.InterpolantFactoryMethodDiscrete;break;case AD:i=this.InterpolantFactoryMethodLinear;break;case XR:i=this.InterpolantFactoryMethodSmooth;break}if(i===void 0){const r="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(this.createInterpolant===void 0)if(e!==this.DefaultInterpolation)this.setInterpolation(this.DefaultInterpolation);else throw new Error(r);return console.warn("THREE.KeyframeTrack:",r),this}return this.createInterpolant=i,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return dM;case this.InterpolantFactoryMethodLinear:return AD;case this.InterpolantFactoryMethodSmooth:return XR}}getValueSize(){return this.values.length/this.times.length}shift(e){if(e!==0){const i=this.times;for(let r=0,n=i.length;r!==n;++r)i[r]+=e}return this}scale(e){if(e!==1){const i=this.times;for(let r=0,n=i.length;r!==n;++r)i[r]*=e}return this}trim(e,i){const r=this.times,n=r.length;let s=0,a=n-1;for(;s!==n&&r[s]<e;)++s;for(;a!==-1&&r[a]>i;)--a;if(++a,s!==0||a!==n){s>=a&&(a=Math.max(a,1),s=a-1);const o=this.getValueSize();this.times=r.slice(s,a),this.values=this.values.slice(s*o,a*o)}return this}validate(){let e=!0;const i=this.getValueSize();i-Math.floor(i)!==0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),e=!1);const r=this.times,n=this.values,s=r.length;s===0&&(console.error("THREE.KeyframeTrack: Track is empty.",this),e=!1);let a=null;for(let o=0;o!==s;o++){const l=r[o];if(typeof l=="number"&&isNaN(l)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,o,l),e=!1;break}if(a!==null&&a>l){console.error("THREE.KeyframeTrack: Out of order keys.",this,o,l,a),e=!1;break}a=l}if(n!==void 0&&wle(n))for(let o=0,l=n.length;o!==l;++o){const c=n[o];if(isNaN(c)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,o,c),e=!1;break}}return e}optimize(){const e=this.times.slice(),i=this.values.slice(),r=this.getValueSize(),n=this.getInterpolation()===XR,s=e.length-1;let a=1;for(let o=1;o<s;++o){let l=!1;const c=e[o],u=e[o+1];if(c!==u&&(o!==1||c!==e[0]))if(n)l=!0;else{const h=o*r,d=h-r,f=h+r;for(let p=0;p!==r;++p){const g=i[h+p];if(g!==i[d+p]||g!==i[f+p]){l=!0;break}}}if(l){if(o!==a){e[a]=e[o];const h=o*r,d=a*r;for(let f=0;f!==r;++f)i[d+f]=i[h+f]}++a}}if(s>0){e[a]=e[s];for(let o=s*r,l=a*r,c=0;c!==r;++c)i[l+c]=i[o+c];++a}return a!==e.length?(this.times=e.slice(0,a),this.values=i.slice(0,a*r)):(this.times=e,this.values=i),this}clone(){const e=this.times.slice(),i=this.values.slice(),r=this.constructor,n=new r(this.name,e,i);return n.createInterpolant=this.createInterpolant,n}}Au.prototype.ValueTypeName="";Au.prototype.TimeBufferType=Float32Array;Au.prototype.ValueBufferType=Float32Array;Au.prototype.DefaultInterpolation=AD;class q0 extends Au{constructor(e,i,r){super(e,i,r)}}q0.prototype.ValueTypeName="bool";q0.prototype.ValueBufferType=Array;q0.prototype.DefaultInterpolation=dM;q0.prototype.InterpolantFactoryMethodLinear=void 0;q0.prototype.InterpolantFactoryMethodSmooth=void 0;class mH extends Au{constructor(e,i,r,n){super(e,i,r,n)}}mH.prototype.ValueTypeName="color";class wM extends Au{constructor(e,i,r,n){super(e,i,r,n)}}wM.prototype.ValueTypeName="number";class Ale extends ET{constructor(e,i,r,n){super(e,i,r,n)}interpolate_(e,i,r,n){const s=this.resultBuffer,a=this.sampleValues,o=this.valueSize,l=(r-i)/(n-i);let c=e*o;for(let u=c+o;c!==u;c+=4)sc.slerpFlat(s,0,a,c-o,a,c,l);return s}}class AT extends Au{constructor(e,i,r,n){super(e,i,r,n)}InterpolantFactoryMethodLinear(e){return new Ale(this.times,this.values,this.getValueSize(),e)}}AT.prototype.ValueTypeName="quaternion";AT.prototype.InterpolantFactoryMethodSmooth=void 0;class X0 extends Au{constructor(e,i,r){super(e,i,r)}}X0.prototype.ValueTypeName="string";X0.prototype.ValueBufferType=Array;X0.prototype.DefaultInterpolation=dM;X0.prototype.InterpolantFactoryMethodLinear=void 0;X0.prototype.InterpolantFactoryMethodSmooth=void 0;class _M extends Au{constructor(e,i,r,n){super(e,i,r,n)}}_M.prototype.ValueTypeName="vector";class SM{constructor(e="",i=-1,r=[],n=SO){this.name=e,this.tracks=r,this.duration=i,this.blendMode=n,this.uuid=Rc(),this.userData={},this.duration<0&&this.resetDuration()}static parse(e){const i=[],r=e.tracks,n=1/(e.fps||1);for(let a=0,o=r.length;a!==o;++a)i.push($3e(r[a]).scale(n));const s=new this(e.name,e.duration,i,e.blendMode);return s.uuid=e.uuid,s.userData=JSON.parse(e.userData||"{}"),s}static toJSON(e){const i=[],r=e.tracks,n={name:e.name,duration:e.duration,tracks:i,uuid:e.uuid,blendMode:e.blendMode,userData:JSON.stringify(e.userData)};for(let s=0,a=r.length;s!==a;++s)i.push(Au.toJSON(r[s]));return n}static CreateFromMorphTargetSequence(e,i,r,n){const s=i.length,a=[];for(let o=0;o<s;o++){let l=[],c=[];l.push((o+s-1)%s,o,(o+1)%s),c.push(0,1,0);const u=_le(l);l=Qz(l,1,u),c=Qz(c,1,u),!n&&l[0]===0&&(l.push(s),c.push(c[0])),a.push(new wM(".morphTargetInfluences["+i[o].name+"]",l,c).scale(1/r))}return new this(e,-1,a)}static findByName(e,i){let r=e;if(!Array.isArray(e)){const n=e;r=n.geometry&&n.geometry.animations||n.animations}for(let n=0;n<r.length;n++)if(r[n].name===i)return r[n];return null}static CreateClipsFromMorphTargetSequences(e,i,r){const n={},s=/^([\w-]*?)([\d]+)$/;for(let o=0,l=e.length;o<l;o++){const c=e[o],u=c.name.match(s);if(u&&u.length>1){const h=u[1];let d=n[h];d||(n[h]=d=[]),d.push(c)}}const a=[];for(const o in n)a.push(this.CreateFromMorphTargetSequence(o,n[o],i,r));return a}static parseAnimation(e,i){if(console.warn("THREE.AnimationClip: parseAnimation() is deprecated and will be removed with r185"),!e)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;const r=function(h,d,f,p,g){if(f.length!==0){const m=[],y=[];fH(f,m,y,p),m.length!==0&&g.push(new h(d,m,y))}},n=[],s=e.name||"default",a=e.fps||30,o=e.blendMode;let l=e.length||-1;const c=e.hierarchy||[];for(let h=0;h<c.length;h++){const d=c[h].keys;if(!(!d||d.length===0))if(d[0].morphTargets){const f={};let p;for(p=0;p<d.length;p++)if(d[p].morphTargets)for(let g=0;g<d[p].morphTargets.length;g++)f[d[p].morphTargets[g]]=-1;for(const g in f){const m=[],y=[];for(let b=0;b!==d[p].morphTargets.length;++b){const w=d[p];m.push(w.time),y.push(w.morphTarget===g?1:0)}n.push(new wM(".morphTargetInfluence["+g+"]",m,y))}l=f.length*a}else{const f=".bones["+i[h].name+"]";r(_M,f+".position",d,"pos",n),r(AT,f+".quaternion",d,"rot",n),r(_M,f+".scale",d,"scl",n)}}return n.length===0?null:new this(s,l,n,o)}resetDuration(){const e=this.tracks;let i=0;for(let r=0,n=e.length;r!==n;++r){const s=this.tracks[r];i=Math.max(i,s.times[s.times.length-1])}return this.duration=i,this}trim(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].trim(0,this.duration);return this}validate(){let e=!0;for(let i=0;i<this.tracks.length;i++)e=e&&this.tracks[i].validate();return e}optimize(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].optimize();return this}clone(){const e=[];for(let r=0;r<this.tracks.length;r++)e.push(this.tracks[r].clone());const i=new this.constructor(this.name,this.duration,e,this.blendMode);return i.userData=JSON.parse(JSON.stringify(this.userData)),i}toJSON(){return this.constructor.toJSON(this)}}function X3e(t){switch(t.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return wM;case"vector":case"vector2":case"vector3":case"vector4":return _M;case"color":return mH;case"quaternion":return AT;case"bool":case"boolean":return q0;case"string":return X0}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+t)}function $3e(t){if(t.type===void 0)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");const e=X3e(t.type);if(t.times===void 0){const i=[],r=[];fH(t.keys,i,r,"value"),t.times=i,t.values=r}return e.parse!==void 0?e.parse(t):new e(t.name,t.times,t.values,t.interpolation)}const Dd={enabled:!1,files:{},add:function(t,e){this.enabled!==!1&&(this.files[t]=e)},get:function(t){if(this.enabled!==!1)return this.files[t]},remove:function(t){delete this.files[t]},clear:function(){this.files={}}};class gH{constructor(e,i,r){const n=this;let s=!1,a=0,o=0,l;const c=[];this.onStart=void 0,this.onLoad=e,this.onProgress=i,this.onError=r,this.abortController=new AbortController,this.itemStart=function(u){o++,s===!1&&n.onStart!==void 0&&n.onStart(u,a,o),s=!0},this.itemEnd=function(u){a++,n.onProgress!==void 0&&n.onProgress(u,a,o),a===o&&(s=!1,n.onLoad!==void 0&&n.onLoad())},this.itemError=function(u){n.onError!==void 0&&n.onError(u)},this.resolveURL=function(u){return l?l(u):u},this.setURLModifier=function(u){return l=u,this},this.addHandler=function(u,h){return c.push(u,h),this},this.removeHandler=function(u){const h=c.indexOf(u);return h!==-1&&c.splice(h,2),this},this.getHandler=function(u){for(let h=0,d=c.length;h<d;h+=2){const f=c[h],p=c[h+1];if(f.global&&(f.lastIndex=0),f.test(u))return p}return null},this.abort=function(){return this.abortController.abort(),this.abortController=new AbortController,this}}}const Mle=new gH;class cc{constructor(e){this.manager=e!==void 0?e:Mle,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(e,i){const r=this;return new Promise(function(n,s){r.load(e,n,i,s)})}parse(){}setCrossOrigin(e){return this.crossOrigin=e,this}setWithCredentials(e){return this.withCredentials=e,this}setPath(e){return this.path=e,this}setResourcePath(e){return this.resourcePath=e,this}setRequestHeader(e){return this.requestHeader=e,this}abort(){return this}}cc.DEFAULT_MATERIAL_NAME="__DEFAULT";const Kf={};class Y3e extends Error{constructor(e,i){super(e),this.response=i}}class Vp extends cc{constructor(e){super(e),this.mimeType="",this.responseType="",this._abortController=new AbortController}load(e,i,r,n){e===void 0&&(e=""),this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const s=Dd.get(`file:${e}`);if(s!==void 0)return this.manager.itemStart(e),setTimeout(()=>{i&&i(s),this.manager.itemEnd(e)},0),s;if(Kf[e]!==void 0){Kf[e].push({onLoad:i,onProgress:r,onError:n});return}Kf[e]=[],Kf[e].push({onLoad:i,onProgress:r,onError:n});const a=new Request(e,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin",signal:typeof AbortSignal.any=="function"?AbortSignal.any([this._abortController.signal,this.manager.abortController.signal]):this._abortController.signal}),o=this.mimeType,l=this.responseType;fetch(a).then(c=>{if(c.status===200||c.status===0){if(c.status===0&&console.warn("THREE.FileLoader: HTTP Status 0 received."),typeof ReadableStream>"u"||c.body===void 0||c.body.getReader===void 0)return c;const u=Kf[e],h=c.body.getReader(),d=c.headers.get("X-File-Size")||c.headers.get("Content-Length"),f=d?parseInt(d):0,p=f!==0;let g=0;const m=new ReadableStream({start(y){b();function b(){h.read().then(({done:w,value:E})=>{if(w)y.close();else{g+=E.byteLength;const M=new ProgressEvent("progress",{lengthComputable:p,loaded:g,total:f});for(let A=0,P=u.length;A<P;A++){const C=u[A];C.onProgress&&C.onProgress(M)}y.enqueue(E),b()}},w=>{y.error(w)})}}});return new Response(m)}else throw new Y3e(`fetch for "${c.url}" responded with ${c.status}: ${c.statusText}`,c)}).then(c=>{switch(l){case"arraybuffer":return c.arrayBuffer();case"blob":return c.blob();case"document":return c.text().then(u=>new DOMParser().parseFromString(u,o));case"json":return c.json();default:if(o==="")return c.text();{const h=/charset="?([^;"\s]*)"?/i.exec(o),d=h&&h[1]?h[1].toLowerCase():void 0,f=new TextDecoder(d);return c.arrayBuffer().then(p=>f.decode(p))}}}).then(c=>{Dd.add(`file:${e}`,c);const u=Kf[e];delete Kf[e];for(let h=0,d=u.length;h<d;h++){const f=u[h];f.onLoad&&f.onLoad(c)}}).catch(c=>{const u=Kf[e];if(u===void 0)throw this.manager.itemError(e),c;delete Kf[e];for(let h=0,d=u.length;h<d;h++){const f=u[h];f.onError&&f.onError(c)}this.manager.itemError(e)}).finally(()=>{this.manager.itemEnd(e)}),this.manager.itemStart(e)}setResponseType(e){return this.responseType=e,this}setMimeType(e){return this.mimeType=e,this}abort(){return this._abortController.abort(),this._abortController=new AbortController,this}}class K3e extends cc{constructor(e){super(e)}load(e,i,r,n){const s=this,a=new Vp(this.manager);a.setPath(this.path),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials),a.load(e,function(o){try{i(s.parse(JSON.parse(o)))}catch(l){n?n(l):console.error(l),s.manager.itemError(e)}},r,n)}parse(e){const i=[];for(let r=0;r<e.length;r++){const n=SM.parse(e[r]);i.push(n)}return i}}class Z3e extends cc{constructor(e){super(e)}load(e,i,r,n){const s=this,a=[],o=new DO,l=new Vp(this.manager);l.setPath(this.path),l.setResponseType("arraybuffer"),l.setRequestHeader(this.requestHeader),l.setWithCredentials(s.withCredentials);let c=0;function u(h){l.load(e[h],function(d){const f=s.parse(d,!0);a[h]={width:f.width,height:f.height,format:f.format,mipmaps:f.mipmaps},c+=1,c===6&&(f.mipmapCount===1&&(o.minFilter=ma),o.image=a,o.format=f.format,o.needsUpdate=!0,i&&i(o))},r,n)}if(Array.isArray(e))for(let h=0,d=e.length;h<d;++h)u(h);else l.load(e,function(h){const d=s.parse(h,!0);if(d.isCubemap){const f=d.mipmaps.length/d.mipmapCount;for(let p=0;p<f;p++){a[p]={mipmaps:[]};for(let g=0;g<d.mipmapCount;g++)a[p].mipmaps.push(d.mipmaps[p*d.mipmapCount+g]),a[p].format=d.format,a[p].width=d.width,a[p].height=d.height}o.image=a}else o.image.width=d.width,o.image.height=d.height,o.mipmaps=d.mipmaps;d.mipmapCount===1&&(o.minFilter=ma),o.format=d.format,o.needsUpdate=!0,i&&i(o)},r,n);return o}}const Tb=new WeakMap;class EM extends cc{constructor(e){super(e)}load(e,i,r,n){this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const s=this,a=Dd.get(`image:${e}`);if(a!==void 0){if(a.complete===!0)s.manager.itemStart(e),setTimeout(function(){i&&i(a),s.manager.itemEnd(e)},0);else{let h=Tb.get(a);h===void 0&&(h=[],Tb.set(a,h)),h.push({onLoad:i,onError:n})}return a}const o=gM("img");function l(){u(),i&&i(this);const h=Tb.get(this)||[];for(let d=0;d<h.length;d++){const f=h[d];f.onLoad&&f.onLoad(this)}Tb.delete(this),s.manager.itemEnd(e)}function c(h){u(),n&&n(h),Dd.remove(`image:${e}`);const d=Tb.get(this)||[];for(let f=0;f<d.length;f++){const p=d[f];p.onError&&p.onError(h)}Tb.delete(this),s.manager.itemError(e),s.manager.itemEnd(e)}function u(){o.removeEventListener("load",l,!1),o.removeEventListener("error",c,!1)}return o.addEventListener("load",l,!1),o.addEventListener("error",c,!1),e.slice(0,5)!=="data:"&&this.crossOrigin!==void 0&&(o.crossOrigin=this.crossOrigin),Dd.add(`image:${e}`,o),s.manager.itemStart(e),o.src=e,o}}class Q3e extends cc{constructor(e){super(e)}load(e,i,r,n){const s=new xT;s.colorSpace=Wl;const a=new EM(this.manager);a.setCrossOrigin(this.crossOrigin),a.setPath(this.path);let o=0;function l(c){a.load(e[c],function(u){s.images[c]=u,o++,o===6&&(s.needsUpdate=!0,i&&i(s))},void 0,n)}for(let c=0;c<e.length;++c)l(c);return s}}class J3e extends cc{constructor(e){super(e)}load(e,i,r,n){const s=this,a=new Vd,o=new Vp(this.manager);return o.setResponseType("arraybuffer"),o.setRequestHeader(this.requestHeader),o.setPath(this.path),o.setWithCredentials(s.withCredentials),o.load(e,function(l){let c;try{c=s.parse(l)}catch(u){if(n!==void 0)n(u);else{console.error(u);return}}c.image!==void 0?a.image=c.image:c.data!==void 0&&(a.image.width=c.width,a.image.height=c.height,a.image.data=c.data),a.wrapS=c.wrapS!==void 0?c.wrapS:gu,a.wrapT=c.wrapT!==void 0?c.wrapT:gu,a.magFilter=c.magFilter!==void 0?c.magFilter:ma,a.minFilter=c.minFilter!==void 0?c.minFilter:ma,a.anisotropy=c.anisotropy!==void 0?c.anisotropy:1,c.colorSpace!==void 0&&(a.colorSpace=c.colorSpace),c.flipY!==void 0&&(a.flipY=c.flipY),c.format!==void 0&&(a.format=c.format),c.type!==void 0&&(a.type=c.type),c.mipmaps!==void 0&&(a.mipmaps=c.mipmaps,a.minFilter=Id),c.mipmapCount===1&&(a.minFilter=ma),c.generateMipmaps!==void 0&&(a.generateMipmaps=c.generateMipmaps),a.needsUpdate=!0,i&&i(a,c)},r,n),a}}class eOe extends cc{constructor(e){super(e)}load(e,i,r,n){const s=new ls,a=new EM(this.manager);return a.setCrossOrigin(this.crossOrigin),a.setPath(this.path),a.load(e,function(o){s.image=o,s.needsUpdate=!0,i!==void 0&&i(s)},r,n),s}}class dv extends Br{constructor(e,i=1){super(),this.isLight=!0,this.type="Light",this.color=new ii(e),this.intensity=i}dispose(){}copy(e,i){return super.copy(e,i),this.color.copy(e.color),this.intensity=e.intensity,this}toJSON(e){const i=super.toJSON(e);return i.object.color=this.color.getHex(),i.object.intensity=this.intensity,this.groundColor!==void 0&&(i.object.groundColor=this.groundColor.getHex()),this.distance!==void 0&&(i.object.distance=this.distance),this.angle!==void 0&&(i.object.angle=this.angle),this.decay!==void 0&&(i.object.decay=this.decay),this.penumbra!==void 0&&(i.object.penumbra=this.penumbra),this.shadow!==void 0&&(i.object.shadow=this.shadow.toJSON()),this.target!==void 0&&(i.object.target=this.target.uuid),i}}class Tle extends dv{constructor(e,i,r){super(e,r),this.isHemisphereLight=!0,this.type="HemisphereLight",this.position.copy(Br.DEFAULT_UP),this.updateMatrix(),this.groundColor=new ii(i)}copy(e,i){return super.copy(e,i),this.groundColor.copy(e.groundColor),this}}const jU=new zi,$$=new be,Y$=new be;class vH{constructor(e){this.camera=e,this.intensity=1,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new At(512,512),this.mapType=_u,this.map=null,this.mapPass=null,this.matrix=new zi,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new v_,this._frameExtents=new At(1,1),this._viewportCount=1,this._viewports=[new Ur(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(e){const i=this.camera,r=this.matrix;$$.setFromMatrixPosition(e.matrixWorld),i.position.copy($$),Y$.setFromMatrixPosition(e.target.matrixWorld),i.lookAt(Y$),i.updateMatrixWorld(),jU.multiplyMatrices(i.projectionMatrix,i.matrixWorldInverse),this._frustum.setFromProjectionMatrix(jU,i.coordinateSystem,i.reversedDepth),i.reversedDepth?r.set(.5,0,0,.5,0,.5,0,.5,0,0,1,0,0,0,0,1):r.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),r.multiply(jU)}getViewport(e){return this._viewports[e]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(e){return this.camera=e.camera.clone(),this.intensity=e.intensity,this.bias=e.bias,this.radius=e.radius,this.autoUpdate=e.autoUpdate,this.needsUpdate=e.needsUpdate,this.normalBias=e.normalBias,this.blurSamples=e.blurSamples,this.mapSize.copy(e.mapSize),this}clone(){return new this.constructor().copy(this)}toJSON(){const e={};return this.intensity!==1&&(e.intensity=this.intensity),this.bias!==0&&(e.bias=this.bias),this.normalBias!==0&&(e.normalBias=this.normalBias),this.radius!==1&&(e.radius=this.radius),(this.mapSize.x!==512||this.mapSize.y!==512)&&(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}}class tOe extends vH{constructor(){super(new ja(50,1,.5,500)),this.isSpotLightShadow=!0,this.focus=1,this.aspect=1}updateMatrices(e){const i=this.camera,r=k1*2*e.angle*this.focus,n=this.mapSize.width/this.mapSize.height*this.aspect,s=e.distance||i.far;(r!==i.fov||n!==i.aspect||s!==i.far)&&(i.fov=r,i.aspect=n,i.far=s,i.updateProjectionMatrix()),super.updateMatrices(e)}copy(e){return super.copy(e),this.focus=e.focus,this}}class Cle extends dv{constructor(e,i,r=0,n=Math.PI/3,s=0,a=2){super(e,i),this.isSpotLight=!0,this.type="SpotLight",this.position.copy(Br.DEFAULT_UP),this.updateMatrix(),this.target=new Br,this.distance=r,this.angle=n,this.penumbra=s,this.decay=a,this.map=null,this.shadow=new tOe}get power(){return this.intensity*Math.PI}set power(e){this.intensity=e/Math.PI}dispose(){this.shadow.dispose()}copy(e,i){return super.copy(e,i),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}const K$=new zi,eE=new be,VU=new be;class iOe extends vH{constructor(){super(new ja(90,1,.5,500)),this.isPointLightShadow=!0,this._frameExtents=new At(4,2),this._viewportCount=6,this._viewports=[new Ur(2,1,1,1),new Ur(0,1,1,1),new Ur(3,1,1,1),new Ur(1,1,1,1),new Ur(3,0,1,1),new Ur(1,0,1,1)],this._cubeDirections=[new be(1,0,0),new be(-1,0,0),new be(0,0,1),new be(0,0,-1),new be(0,1,0),new be(0,-1,0)],this._cubeUps=[new be(0,1,0),new be(0,1,0),new be(0,1,0),new be(0,1,0),new be(0,0,1),new be(0,0,-1)]}updateMatrices(e,i=0){const r=this.camera,n=this.matrix,s=e.distance||r.far;s!==r.far&&(r.far=s,r.updateProjectionMatrix()),eE.setFromMatrixPosition(e.matrixWorld),r.position.copy(eE),VU.copy(r.position),VU.add(this._cubeDirections[i]),r.up.copy(this._cubeUps[i]),r.lookAt(VU),r.updateMatrixWorld(),n.makeTranslation(-eE.x,-eE.y,-eE.z),K$.multiplyMatrices(r.projectionMatrix,r.matrixWorldInverse),this._frustum.setFromProjectionMatrix(K$,r.coordinateSystem,r.reversedDepth)}}class Ple extends dv{constructor(e,i,r=0,n=2){super(e,i),this.isPointLight=!0,this.type="PointLight",this.distance=r,this.decay=n,this.shadow=new iOe}get power(){return this.intensity*4*Math.PI}set power(e){this.intensity=e/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(e,i){return super.copy(e,i),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}}class MT extends yT{constructor(e=-1,i=1,r=1,n=-1,s=.1,a=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=i,this.top=r,this.bottom=n,this.near=s,this.far=a,this.updateProjectionMatrix()}copy(e,i){return super.copy(e,i),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=e.view===null?null:Object.assign({},e.view),this}setViewOffset(e,i,r,n,s,a){this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=i,this.view.offsetX=r,this.view.offsetY=n,this.view.width=s,this.view.height=a,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=(this.right-this.left)/(2*this.zoom),i=(this.top-this.bottom)/(2*this.zoom),r=(this.right+this.left)/2,n=(this.top+this.bottom)/2;let s=r-e,a=r+e,o=n+i,l=n-i;if(this.view!==null&&this.view.enabled){const c=(this.right-this.left)/this.view.fullWidth/this.zoom,u=(this.top-this.bottom)/this.view.fullHeight/this.zoom;s+=c*this.view.offsetX,a=s+c*this.view.width,o-=u*this.view.offsetY,l=o-u*this.view.height}this.projectionMatrix.makeOrthographic(s,a,o,l,this.near,this.far,this.coordinateSystem,this.reversedDepth),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const i=super.toJSON(e);return i.object.zoom=this.zoom,i.object.left=this.left,i.object.right=this.right,i.object.top=this.top,i.object.bottom=this.bottom,i.object.near=this.near,i.object.far=this.far,this.view!==null&&(i.object.view=Object.assign({},this.view)),i}}class rOe extends vH{constructor(){super(new MT(-5,5,5,-5,.5,500)),this.isDirectionalLightShadow=!0}}class Rle extends dv{constructor(e,i){super(e,i),this.isDirectionalLight=!0,this.type="DirectionalLight",this.position.copy(Br.DEFAULT_UP),this.updateMatrix(),this.target=new Br,this.shadow=new rOe}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}class Ile extends dv{constructor(e,i){super(e,i),this.isAmbientLight=!0,this.type="AmbientLight"}}class Dle extends dv{constructor(e,i,r=10,n=10){super(e,i),this.isRectAreaLight=!0,this.type="RectAreaLight",this.width=r,this.height=n}get power(){return this.intensity*this.width*this.height*Math.PI}set power(e){this.intensity=e/(this.width*this.height*Math.PI)}copy(e){return super.copy(e),this.width=e.width,this.height=e.height,this}toJSON(e){const i=super.toJSON(e);return i.object.width=this.width,i.object.height=this.height,i}}class Ole{constructor(){this.isSphericalHarmonics3=!0,this.coefficients=[];for(let e=0;e<9;e++)this.coefficients.push(new be)}set(e){for(let i=0;i<9;i++)this.coefficients[i].copy(e[i]);return this}zero(){for(let e=0;e<9;e++)this.coefficients[e].set(0,0,0);return this}getAt(e,i){const r=e.x,n=e.y,s=e.z,a=this.coefficients;return i.copy(a[0]).multiplyScalar(.282095),i.addScaledVector(a[1],.488603*n),i.addScaledVector(a[2],.488603*s),i.addScaledVector(a[3],.488603*r),i.addScaledVector(a[4],1.092548*(r*n)),i.addScaledVector(a[5],1.092548*(n*s)),i.addScaledVector(a[6],.315392*(3*s*s-1)),i.addScaledVector(a[7],1.092548*(r*s)),i.addScaledVector(a[8],.546274*(r*r-n*n)),i}getIrradianceAt(e,i){const r=e.x,n=e.y,s=e.z,a=this.coefficients;return i.copy(a[0]).multiplyScalar(.886227),i.addScaledVector(a[1],2*.511664*n),i.addScaledVector(a[2],2*.511664*s),i.addScaledVector(a[3],2*.511664*r),i.addScaledVector(a[4],2*.429043*r*n),i.addScaledVector(a[5],2*.429043*n*s),i.addScaledVector(a[6],.743125*s*s-.247708),i.addScaledVector(a[7],2*.429043*r*s),i.addScaledVector(a[8],.429043*(r*r-n*n)),i}add(e){for(let i=0;i<9;i++)this.coefficients[i].add(e.coefficients[i]);return this}addScaledSH(e,i){for(let r=0;r<9;r++)this.coefficients[r].addScaledVector(e.coefficients[r],i);return this}scale(e){for(let i=0;i<9;i++)this.coefficients[i].multiplyScalar(e);return this}lerp(e,i){for(let r=0;r<9;r++)this.coefficients[r].lerp(e.coefficients[r],i);return this}equals(e){for(let i=0;i<9;i++)if(!this.coefficients[i].equals(e.coefficients[i]))return!1;return!0}copy(e){return this.set(e.coefficients)}clone(){return new this.constructor().copy(this)}fromArray(e,i=0){const r=this.coefficients;for(let n=0;n<9;n++)r[n].fromArray(e,i+n*3);return this}toArray(e=[],i=0){const r=this.coefficients;for(let n=0;n<9;n++)r[n].toArray(e,i+n*3);return e}static getBasisAt(e,i){const r=e.x,n=e.y,s=e.z;i[0]=.282095,i[1]=.488603*n,i[2]=.488603*s,i[3]=.488603*r,i[4]=1.092548*r*n,i[5]=1.092548*n*s,i[6]=.315392*(3*s*s-1),i[7]=1.092548*r*s,i[8]=.546274*(r*r-n*n)}}class Lle extends dv{constructor(e=new Ole,i=1){super(void 0,i),this.isLightProbe=!0,this.sh=e}copy(e){return super.copy(e),this.sh.copy(e.sh),this}fromJSON(e){return this.intensity=e.intensity,this.sh.fromArray(e.sh),this}toJSON(e){const i=super.toJSON(e);return i.object.sh=this.sh.toArray(),i}}class qO extends cc{constructor(e){super(e),this.textures={}}load(e,i,r,n){const s=this,a=new Vp(s.manager);a.setPath(s.path),a.setRequestHeader(s.requestHeader),a.setWithCredentials(s.withCredentials),a.load(e,function(o){try{i(s.parse(JSON.parse(o)))}catch(l){n?n(l):console.error(l),s.manager.itemError(e)}},r,n)}parse(e){const i=this.textures;function r(s){return i[s]===void 0&&console.warn("THREE.MaterialLoader: Undefined texture",s),i[s]}const n=this.createMaterialFromType(e.type);if(e.uuid!==void 0&&(n.uuid=e.uuid),e.name!==void 0&&(n.name=e.name),e.color!==void 0&&n.color!==void 0&&n.color.setHex(e.color),e.roughness!==void 0&&(n.roughness=e.roughness),e.metalness!==void 0&&(n.metalness=e.metalness),e.sheen!==void 0&&(n.sheen=e.sheen),e.sheenColor!==void 0&&(n.sheenColor=new ii().setHex(e.sheenColor)),e.sheenRoughness!==void 0&&(n.sheenRoughness=e.sheenRoughness),e.emissive!==void 0&&n.emissive!==void 0&&n.emissive.setHex(e.emissive),e.specular!==void 0&&n.specular!==void 0&&n.specular.setHex(e.specular),e.specularIntensity!==void 0&&(n.specularIntensity=e.specularIntensity),e.specularColor!==void 0&&n.specularColor!==void 0&&n.specularColor.setHex(e.specularColor),e.shininess!==void 0&&(n.shininess=e.shininess),e.clearcoat!==void 0&&(n.clearcoat=e.clearcoat),e.clearcoatRoughness!==void 0&&(n.clearcoatRoughness=e.clearcoatRoughness),e.dispersion!==void 0&&(n.dispersion=e.dispersion),e.iridescence!==void 0&&(n.iridescence=e.iridescence),e.iridescenceIOR!==void 0&&(n.iridescenceIOR=e.iridescenceIOR),e.iridescenceThicknessRange!==void 0&&(n.iridescenceThicknessRange=e.iridescenceThicknessRange),e.transmission!==void 0&&(n.transmission=e.transmission),e.thickness!==void 0&&(n.thickness=e.thickness),e.attenuationDistance!==void 0&&(n.attenuationDistance=e.attenuationDistance),e.attenuationColor!==void 0&&n.attenuationColor!==void 0&&n.attenuationColor.setHex(e.attenuationColor),e.anisotropy!==void 0&&(n.anisotropy=e.anisotropy),e.anisotropyRotation!==void 0&&(n.anisotropyRotation=e.anisotropyRotation),e.fog!==void 0&&(n.fog=e.fog),e.flatShading!==void 0&&(n.flatShading=e.flatShading),e.blending!==void 0&&(n.blending=e.blending),e.combine!==void 0&&(n.combine=e.combine),e.side!==void 0&&(n.side=e.side),e.shadowSide!==void 0&&(n.shadowSide=e.shadowSide),e.opacity!==void 0&&(n.opacity=e.opacity),e.transparent!==void 0&&(n.transparent=e.transparent),e.alphaTest!==void 0&&(n.alphaTest=e.alphaTest),e.alphaHash!==void 0&&(n.alphaHash=e.alphaHash),e.depthFunc!==void 0&&(n.depthFunc=e.depthFunc),e.depthTest!==void 0&&(n.depthTest=e.depthTest),e.depthWrite!==void 0&&(n.depthWrite=e.depthWrite),e.colorWrite!==void 0&&(n.colorWrite=e.colorWrite),e.blendSrc!==void 0&&(n.blendSrc=e.blendSrc),e.blendDst!==void 0&&(n.blendDst=e.blendDst),e.blendEquation!==void 0&&(n.blendEquation=e.blendEquation),e.blendSrcAlpha!==void 0&&(n.blendSrcAlpha=e.blendSrcAlpha),e.blendDstAlpha!==void 0&&(n.blendDstAlpha=e.blendDstAlpha),e.blendEquationAlpha!==void 0&&(n.blendEquationAlpha=e.blendEquationAlpha),e.blendColor!==void 0&&n.blendColor!==void 0&&n.blendColor.setHex(e.blendColor),e.blendAlpha!==void 0&&(n.blendAlpha=e.blendAlpha),e.stencilWriteMask!==void 0&&(n.stencilWriteMask=e.stencilWriteMask),e.stencilFunc!==void 0&&(n.stencilFunc=e.stencilFunc),e.stencilRef!==void 0&&(n.stencilRef=e.stencilRef),e.stencilFuncMask!==void 0&&(n.stencilFuncMask=e.stencilFuncMask),e.stencilFail!==void 0&&(n.stencilFail=e.stencilFail),e.stencilZFail!==void 0&&(n.stencilZFail=e.stencilZFail),e.stencilZPass!==void 0&&(n.stencilZPass=e.stencilZPass),e.stencilWrite!==void 0&&(n.stencilWrite=e.stencilWrite),e.wireframe!==void 0&&(n.wireframe=e.wireframe),e.wireframeLinewidth!==void 0&&(n.wireframeLinewidth=e.wireframeLinewidth),e.wireframeLinecap!==void 0&&(n.wireframeLinecap=e.wireframeLinecap),e.wireframeLinejoin!==void 0&&(n.wireframeLinejoin=e.wireframeLinejoin),e.rotation!==void 0&&(n.rotation=e.rotation),e.linewidth!==void 0&&(n.linewidth=e.linewidth),e.dashSize!==void 0&&(n.dashSize=e.dashSize),e.gapSize!==void 0&&(n.gapSize=e.gapSize),e.scale!==void 0&&(n.scale=e.scale),e.polygonOffset!==void 0&&(n.polygonOffset=e.polygonOffset),e.polygonOffsetFactor!==void 0&&(n.polygonOffsetFactor=e.polygonOffsetFactor),e.polygonOffsetUnits!==void 0&&(n.polygonOffsetUnits=e.polygonOffsetUnits),e.dithering!==void 0&&(n.dithering=e.dithering),e.alphaToCoverage!==void 0&&(n.alphaToCoverage=e.alphaToCoverage),e.premultipliedAlpha!==void 0&&(n.premultipliedAlpha=e.premultipliedAlpha),e.forceSinglePass!==void 0&&(n.forceSinglePass=e.forceSinglePass),e.visible!==void 0&&(n.visible=e.visible),e.toneMapped!==void 0&&(n.toneMapped=e.toneMapped),e.userData!==void 0&&(n.userData=e.userData),e.vertexColors!==void 0&&(typeof e.vertexColors=="number"?n.vertexColors=e.vertexColors>0:n.vertexColors=e.vertexColors),e.uniforms!==void 0)for(const s in e.uniforms){const a=e.uniforms[s];switch(n.uniforms[s]={},a.type){case"t":n.uniforms[s].value=r(a.value);break;case"c":n.uniforms[s].value=new ii().setHex(a.value);break;case"v2":n.uniforms[s].value=new At().fromArray(a.value);break;case"v3":n.uniforms[s].value=new be().fromArray(a.value);break;case"v4":n.uniforms[s].value=new Ur().fromArray(a.value);break;case"m3":n.uniforms[s].value=new lr().fromArray(a.value);break;case"m4":n.uniforms[s].value=new zi().fromArray(a.value);break;default:n.uniforms[s].value=a.value}}if(e.defines!==void 0&&(n.defines=e.defines),e.vertexShader!==void 0&&(n.vertexShader=e.vertexShader),e.fragmentShader!==void 0&&(n.fragmentShader=e.fragmentShader),e.glslVersion!==void 0&&(n.glslVersion=e.glslVersion),e.extensions!==void 0)for(const s in e.extensions)n.extensions[s]=e.extensions[s];if(e.lights!==void 0&&(n.lights=e.lights),e.clipping!==void 0&&(n.clipping=e.clipping),e.size!==void 0&&(n.size=e.size),e.sizeAttenuation!==void 0&&(n.sizeAttenuation=e.sizeAttenuation),e.map!==void 0&&(n.map=r(e.map)),e.matcap!==void 0&&(n.matcap=r(e.matcap)),e.alphaMap!==void 0&&(n.alphaMap=r(e.alphaMap)),e.bumpMap!==void 0&&(n.bumpMap=r(e.bumpMap)),e.bumpScale!==void 0&&(n.bumpScale=e.bumpScale),e.normalMap!==void 0&&(n.normalMap=r(e.normalMap)),e.normalMapType!==void 0&&(n.normalMapType=e.normalMapType),e.normalScale!==void 0){let s=e.normalScale;Array.isArray(s)===!1&&(s=[s,s]),n.normalScale=new At().fromArray(s)}return e.displacementMap!==void 0&&(n.displacementMap=r(e.displacementMap)),e.displacementScale!==void 0&&(n.displacementScale=e.displacementScale),e.displacementBias!==void 0&&(n.displacementBias=e.displacementBias),e.roughnessMap!==void 0&&(n.roughnessMap=r(e.roughnessMap)),e.metalnessMap!==void 0&&(n.metalnessMap=r(e.metalnessMap)),e.emissiveMap!==void 0&&(n.emissiveMap=r(e.emissiveMap)),e.emissiveIntensity!==void 0&&(n.emissiveIntensity=e.emissiveIntensity),e.specularMap!==void 0&&(n.specularMap=r(e.specularMap)),e.specularIntensityMap!==void 0&&(n.specularIntensityMap=r(e.specularIntensityMap)),e.specularColorMap!==void 0&&(n.specularColorMap=r(e.specularColorMap)),e.envMap!==void 0&&(n.envMap=r(e.envMap)),e.envMapRotation!==void 0&&n.envMapRotation.fromArray(e.envMapRotation),e.envMapIntensity!==void 0&&(n.envMapIntensity=e.envMapIntensity),e.reflectivity!==void 0&&(n.reflectivity=e.reflectivity),e.refractionRatio!==void 0&&(n.refractionRatio=e.refractionRatio),e.lightMap!==void 0&&(n.lightMap=r(e.lightMap)),e.lightMapIntensity!==void 0&&(n.lightMapIntensity=e.lightMapIntensity),e.aoMap!==void 0&&(n.aoMap=r(e.aoMap)),e.aoMapIntensity!==void 0&&(n.aoMapIntensity=e.aoMapIntensity),e.gradientMap!==void 0&&(n.gradientMap=r(e.gradientMap)),e.clearcoatMap!==void 0&&(n.clearcoatMap=r(e.clearcoatMap)),e.clearcoatRoughnessMap!==void 0&&(n.clearcoatRoughnessMap=r(e.clearcoatRoughnessMap)),e.clearcoatNormalMap!==void 0&&(n.clearcoatNormalMap=r(e.clearcoatNormalMap)),e.clearcoatNormalScale!==void 0&&(n.clearcoatNormalScale=new At().fromArray(e.clearcoatNormalScale)),e.iridescenceMap!==void 0&&(n.iridescenceMap=r(e.iridescenceMap)),e.iridescenceThicknessMap!==void 0&&(n.iridescenceThicknessMap=r(e.iridescenceThicknessMap)),e.transmissionMap!==void 0&&(n.transmissionMap=r(e.transmissionMap)),e.thicknessMap!==void 0&&(n.thicknessMap=r(e.thicknessMap)),e.anisotropyMap!==void 0&&(n.anisotropyMap=r(e.anisotropyMap)),e.sheenColorMap!==void 0&&(n.sheenColorMap=r(e.sheenColorMap)),e.sheenRoughnessMap!==void 0&&(n.sheenRoughnessMap=r(e.sheenRoughnessMap)),n}setTextures(e){return this.textures=e,this}createMaterialFromType(e){return qO.createMaterialFromType(e)}static createMaterialFromType(e){const i={ShadowMaterial:dle,SpriteMaterial:eH,RawShaderMaterial:fle,ShaderMaterial:Ch,PointsMaterial:IO,MeshPhysicalMaterial:ple,MeshStandardMaterial:uH,MeshPhongMaterial:mle,MeshToonMaterial:gle,MeshNormalMaterial:vle,MeshLambertMaterial:yle,MeshDepthMaterial:hH,MeshDistanceMaterial:dH,MeshBasicMaterial:uv,MeshMatcapMaterial:xle,LineDashedMaterial:ble,LineBasicMaterial:Sl,Material:Go};return new i[e]}}class Jz{static extractUrlBase(e){const i=e.lastIndexOf("/");return i===-1?"./":e.slice(0,i+1)}static resolveURL(e,i){return typeof e!="string"||e===""?"":(/^https?:\/\//i.test(i)&&/^\//.test(e)&&(i=i.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(e)||/^data:.*,.*$/i.test(e)||/^blob:.*$/i.test(e)?e:i+e)}}class kle extends dr{constructor(){super(),this.isInstancedBufferGeometry=!0,this.type="InstancedBufferGeometry",this.instanceCount=1/0}copy(e){return super.copy(e),this.instanceCount=e.instanceCount,this}toJSON(){const e=super.toJSON();return e.instanceCount=this.instanceCount,e.isInstancedBufferGeometry=!0,e}}class Nle extends cc{constructor(e){super(e)}load(e,i,r,n){const s=this,a=new Vp(s.manager);a.setPath(s.path),a.setRequestHeader(s.requestHeader),a.setWithCredentials(s.withCredentials),a.load(e,function(o){try{i(s.parse(JSON.parse(o)))}catch(l){n?n(l):console.error(l),s.manager.itemError(e)}},r,n)}parse(e){const i={},r={};function n(f,p){if(i[p]!==void 0)return i[p];const m=f.interleavedBuffers[p],y=s(f,m.buffer),b=Hw(m.type,y),w=new CO(b,m.stride);return w.uuid=m.uuid,i[p]=w,w}function s(f,p){if(r[p]!==void 0)return r[p];const m=f.arrayBuffers[p],y=new Uint32Array(m).buffer;return r[p]=y,y}const a=e.isInstancedBufferGeometry?new kle:new dr,o=e.data.index;if(o!==void 0){const f=Hw(o.type,o.array);a.setIndex(new xn(f,1))}const l=e.data.attributes;for(const f in l){const p=l[f];let g;if(p.isInterleavedBufferAttribute){const m=n(e.data,p.data);g=new C0(m,p.itemSize,p.offset,p.normalized)}else{const m=Hw(p.type,p.array),y=p.isInstancedBufferAttribute?U1:xn;g=new y(m,p.itemSize,p.normalized)}p.name!==void 0&&(g.name=p.name),p.usage!==void 0&&g.setUsage(p.usage),a.setAttribute(f,g)}const c=e.data.morphAttributes;if(c)for(const f in c){const p=c[f],g=[];for(let m=0,y=p.length;m<y;m++){const b=p[m];let w;if(b.isInterleavedBufferAttribute){const E=n(e.data,b.data);w=new C0(E,b.itemSize,b.offset,b.normalized)}else{const E=Hw(b.type,b.array);w=new xn(E,b.itemSize,b.normalized)}b.name!==void 0&&(w.name=b.name),g.push(w)}a.morphAttributes[f]=g}e.data.morphTargetsRelative&&(a.morphTargetsRelative=!0);const h=e.data.groups||e.data.drawcalls||e.data.offsets;if(h!==void 0)for(let f=0,p=h.length;f!==p;++f){const g=h[f];a.addGroup(g.start,g.count,g.materialIndex)}const d=e.data.boundingSphere;return d!==void 0&&(a.boundingSphere=new _o().fromJSON(d)),e.name&&(a.name=e.name),e.userData&&(a.userData=e.userData),a}}class nOe extends cc{constructor(e){super(e)}load(e,i,r,n){const s=this,a=this.path===""?Jz.extractUrlBase(e):this.path;this.resourcePath=this.resourcePath||a;const o=new Vp(this.manager);o.setPath(this.path),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials),o.load(e,function(l){let c=null;try{c=JSON.parse(l)}catch(h){n!==void 0&&n(h),console.error("THREE:ObjectLoader: Can't parse "+e+".",h.message);return}const u=c.metadata;if(u===void 0||u.type===void 0||u.type.toLowerCase()==="geometry"){n!==void 0&&n(new Error("THREE.ObjectLoader: Can't load "+e)),console.error("THREE.ObjectLoader: Can't load "+e);return}s.parse(c,i)},r,n)}async loadAsync(e,i){const r=this,n=this.path===""?Jz.extractUrlBase(e):this.path;this.resourcePath=this.resourcePath||n;const s=new Vp(this.manager);s.setPath(this.path),s.setRequestHeader(this.requestHeader),s.setWithCredentials(this.withCredentials);const a=await s.loadAsync(e,i),o=JSON.parse(a),l=o.metadata;if(l===void 0||l.type===void 0||l.type.toLowerCase()==="geometry")throw new Error("THREE.ObjectLoader: Can't load "+e);return await r.parseAsync(o)}parse(e,i){const r=this.parseAnimations(e.animations),n=this.parseShapes(e.shapes),s=this.parseGeometries(e.geometries,n),a=this.parseImages(e.images,function(){i!==void 0&&i(c)}),o=this.parseTextures(e.textures,a),l=this.parseMaterials(e.materials,o),c=this.parseObject(e.object,s,l,o,r),u=this.parseSkeletons(e.skeletons,c);if(this.bindSkeletons(c,u),this.bindLightTargets(c),i!==void 0){let h=!1;for(const d in a)if(a[d].data instanceof HTMLImageElement){h=!0;break}h===!1&&i(c)}return c}async parseAsync(e){const i=this.parseAnimations(e.animations),r=this.parseShapes(e.shapes),n=this.parseGeometries(e.geometries,r),s=await this.parseImagesAsync(e.images),a=this.parseTextures(e.textures,s),o=this.parseMaterials(e.materials,a),l=this.parseObject(e.object,n,o,a,i),c=this.parseSkeletons(e.skeletons,l);return this.bindSkeletons(l,c),this.bindLightTargets(l),l}parseShapes(e){const i={};if(e!==void 0)for(let r=0,n=e.length;r<n;r++){const s=new m0().fromJSON(e[r]);i[s.uuid]=s}return i}parseSkeletons(e,i){const r={},n={};if(i.traverse(function(s){s.isBone&&(n[s.uuid]=s)}),e!==void 0)for(let s=0,a=e.length;s<a;s++){const o=new PO().fromJSON(e[s],n);r[o.uuid]=o}return r}parseGeometries(e,i){const r={};if(e!==void 0){const n=new Nle;for(let s=0,a=e.length;s<a;s++){let o;const l=e[s];switch(l.type){case"BufferGeometry":case"InstancedBufferGeometry":o=n.parse(l);break;default:l.type in X$?o=X$[l.type].fromJSON(l,i):console.warn(`THREE.ObjectLoader: Unsupported geometry type "${l.type}"`)}o.uuid=l.uuid,l.name!==void 0&&(o.name=l.name),l.userData!==void 0&&(o.userData=l.userData),r[l.uuid]=o}}return r}parseMaterials(e,i){const r={},n={};if(e!==void 0){const s=new qO;s.setTextures(i);for(let a=0,o=e.length;a<o;a++){const l=e[a];r[l.uuid]===void 0&&(r[l.uuid]=s.parse(l)),n[l.uuid]=r[l.uuid]}}return n}parseAnimations(e){const i={};if(e!==void 0)for(let r=0;r<e.length;r++){const n=e[r],s=SM.parse(n);i[s.uuid]=s}return i}parseImages(e,i){const r=this,n={};let s;function a(l){return r.manager.itemStart(l),s.load(l,function(){r.manager.itemEnd(l)},void 0,function(){r.manager.itemError(l),r.manager.itemEnd(l)})}function o(l){if(typeof l=="string"){const c=l,u=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(c)?c:r.resourcePath+c;return a(u)}else return l.data?{data:Hw(l.type,l.data),width:l.width,height:l.height}:null}if(e!==void 0&&e.length>0){const l=new gH(i);s=new EM(l),s.setCrossOrigin(this.crossOrigin);for(let c=0,u=e.length;c<u;c++){const h=e[c],d=h.url;if(Array.isArray(d)){const f=[];for(let p=0,g=d.length;p<g;p++){const m=d[p],y=o(m);y!==null&&(y instanceof HTMLImageElement?f.push(y):f.push(new Vd(y.data,y.width,y.height)))}n[h.uuid]=new Cg(f)}else{const f=o(h.url);n[h.uuid]=new Cg(f)}}}return n}async parseImagesAsync(e){const i=this,r={};let n;async function s(a){if(typeof a=="string"){const o=a,l=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(o)?o:i.resourcePath+o;return await n.loadAsync(l)}else return a.data?{data:Hw(a.type,a.data),width:a.width,height:a.height}:null}if(e!==void 0&&e.length>0){n=new EM(this.manager),n.setCrossOrigin(this.crossOrigin);for(let a=0,o=e.length;a<o;a++){const l=e[a],c=l.url;if(Array.isArray(c)){const u=[];for(let h=0,d=c.length;h<d;h++){const f=c[h],p=await s(f);p!==null&&(p instanceof HTMLImageElement?u.push(p):u.push(new Vd(p.data,p.width,p.height)))}r[l.uuid]=new Cg(u)}else{const u=await s(l.url);r[l.uuid]=new Cg(u)}}}return r}parseTextures(e,i){function r(s,a){return typeof s=="number"?s:(console.warn("THREE.ObjectLoader.parseTexture: Constant should be in numeric form.",s),a[s])}const n={};if(e!==void 0)for(let s=0,a=e.length;s<a;s++){const o=e[s];o.image===void 0&&console.warn('THREE.ObjectLoader: No "image" specified for',o.uuid),i[o.image]===void 0&&console.warn("THREE.ObjectLoader: Undefined image",o.image);const l=i[o.image],c=l.data;let u;Array.isArray(c)?(u=new xT,c.length===6&&(u.needsUpdate=!0)):(c&&c.data?u=new Vd:u=new ls,c&&(u.needsUpdate=!0)),u.source=l,u.uuid=o.uuid,o.name!==void 0&&(u.name=o.name),o.mapping!==void 0&&(u.mapping=r(o.mapping,sOe)),o.channel!==void 0&&(u.channel=o.channel),o.offset!==void 0&&u.offset.fromArray(o.offset),o.repeat!==void 0&&u.repeat.fromArray(o.repeat),o.center!==void 0&&u.center.fromArray(o.center),o.rotation!==void 0&&(u.rotation=o.rotation),o.wrap!==void 0&&(u.wrapS=r(o.wrap[0],Z$),u.wrapT=r(o.wrap[1],Z$)),o.format!==void 0&&(u.format=o.format),o.internalFormat!==void 0&&(u.internalFormat=o.internalFormat),o.type!==void 0&&(u.type=o.type),o.colorSpace!==void 0&&(u.colorSpace=o.colorSpace),o.minFilter!==void 0&&(u.minFilter=r(o.minFilter,Q$)),o.magFilter!==void 0&&(u.magFilter=r(o.magFilter,Q$)),o.anisotropy!==void 0&&(u.anisotropy=o.anisotropy),o.flipY!==void 0&&(u.flipY=o.flipY),o.generateMipmaps!==void 0&&(u.generateMipmaps=o.generateMipmaps),o.premultiplyAlpha!==void 0&&(u.premultiplyAlpha=o.premultiplyAlpha),o.unpackAlignment!==void 0&&(u.unpackAlignment=o.unpackAlignment),o.compareFunction!==void 0&&(u.compareFunction=o.compareFunction),o.userData!==void 0&&(u.userData=o.userData),n[o.uuid]=u}return n}parseObject(e,i,r,n,s){let a;function o(d){return i[d]===void 0&&console.warn("THREE.ObjectLoader: Undefined geometry",d),i[d]}function l(d){if(d!==void 0){if(Array.isArray(d)){const f=[];for(let p=0,g=d.length;p<g;p++){const m=d[p];r[m]===void 0&&console.warn("THREE.ObjectLoader: Undefined material",m),f.push(r[m])}return f}return r[d]===void 0&&console.warn("THREE.ObjectLoader: Undefined material",d),r[d]}}function c(d){return n[d]===void 0&&console.warn("THREE.ObjectLoader: Undefined texture",d),n[d]}let u,h;switch(e.type){case"Scene":a=new J6,e.background!==void 0&&(Number.isInteger(e.background)?a.background=new ii(e.background):a.background=c(e.background)),e.environment!==void 0&&(a.environment=c(e.environment)),e.fog!==void 0&&(e.fog.type==="Fog"?a.fog=new TO(e.fog.color,e.fog.near,e.fog.far):e.fog.type==="FogExp2"&&(a.fog=new MO(e.fog.color,e.fog.density)),e.fog.name!==""&&(a.fog.name=e.fog.name)),e.backgroundBlurriness!==void 0&&(a.backgroundBlurriness=e.backgroundBlurriness),e.backgroundIntensity!==void 0&&(a.backgroundIntensity=e.backgroundIntensity),e.backgroundRotation!==void 0&&a.backgroundRotation.fromArray(e.backgroundRotation),e.environmentIntensity!==void 0&&(a.environmentIntensity=e.environmentIntensity),e.environmentRotation!==void 0&&a.environmentRotation.fromArray(e.environmentRotation);break;case"PerspectiveCamera":a=new ja(e.fov,e.aspect,e.near,e.far),e.focus!==void 0&&(a.focus=e.focus),e.zoom!==void 0&&(a.zoom=e.zoom),e.filmGauge!==void 0&&(a.filmGauge=e.filmGauge),e.filmOffset!==void 0&&(a.filmOffset=e.filmOffset),e.view!==void 0&&(a.view=Object.assign({},e.view));break;case"OrthographicCamera":a=new MT(e.left,e.right,e.top,e.bottom,e.near,e.far),e.zoom!==void 0&&(a.zoom=e.zoom),e.view!==void 0&&(a.view=Object.assign({},e.view));break;case"AmbientLight":a=new Ile(e.color,e.intensity);break;case"DirectionalLight":a=new Rle(e.color,e.intensity),a.target=e.target||"";break;case"PointLight":a=new Ple(e.color,e.intensity,e.distance,e.decay);break;case"RectAreaLight":a=new Dle(e.color,e.intensity,e.width,e.height);break;case"SpotLight":a=new Cle(e.color,e.intensity,e.distance,e.angle,e.penumbra,e.decay),a.target=e.target||"";break;case"HemisphereLight":a=new Tle(e.color,e.groundColor,e.intensity);break;case"LightProbe":a=new Lle().fromJSON(e);break;case"SkinnedMesh":u=o(e.geometry),h=l(e.material),a=new Yoe(u,h),e.bindMode!==void 0&&(a.bindMode=e.bindMode),e.bindMatrix!==void 0&&a.bindMatrix.fromArray(e.bindMatrix),e.skeleton!==void 0&&(a.skeleton=e.skeleton);break;case"Mesh":u=o(e.geometry),h=l(e.material),a=new js(u,h);break;case"InstancedMesh":u=o(e.geometry),h=l(e.material);const d=e.count,f=e.instanceMatrix,p=e.instanceColor;a=new Koe(u,h,d),a.instanceMatrix=new U1(new Float32Array(f.array),16),p!==void 0&&(a.instanceColor=new U1(new Float32Array(p.array),p.itemSize));break;case"BatchedMesh":u=o(e.geometry),h=l(e.material),a=new Zoe(e.maxInstanceCount,e.maxVertexCount,e.maxIndexCount,h),a.geometry=u,a.perObjectFrustumCulled=e.perObjectFrustumCulled,a.sortObjects=e.sortObjects,a._drawRanges=e.drawRanges,a._reservedRanges=e.reservedRanges,a._geometryInfo=e.geometryInfo.map(g=>{let m=null,y=null;return g.boundingBox!==void 0&&(m=new Vo().fromJSON(g.boundingBox)),g.boundingSphere!==void 0&&(y=new _o().fromJSON(g.boundingSphere)),{...g,boundingBox:m,boundingSphere:y}}),a._instanceInfo=e.instanceInfo,a._availableInstanceIds=e._availableInstanceIds,a._availableGeometryIds=e._availableGeometryIds,a._nextIndexStart=e.nextIndexStart,a._nextVertexStart=e.nextVertexStart,a._geometryCount=e.geometryCount,a._maxInstanceCount=e.maxInstanceCount,a._maxVertexCount=e.maxVertexCount,a._maxIndexCount=e.maxIndexCount,a._geometryInitialized=e.geometryInitialized,a._matricesTexture=c(e.matricesTexture.uuid),a._indirectTexture=c(e.indirectTexture.uuid),e.colorsTexture!==void 0&&(a._colorsTexture=c(e.colorsTexture.uuid)),e.boundingSphere!==void 0&&(a.boundingSphere=new _o().fromJSON(e.boundingSphere)),e.boundingBox!==void 0&&(a.boundingBox=new Vo().fromJSON(e.boundingBox));break;case"LOD":a=new $oe;break;case"Line":a=new ev(o(e.geometry),l(e.material));break;case"LineLoop":a=new Qoe(o(e.geometry),l(e.material));break;case"LineSegments":a=new of(o(e.geometry),l(e.material));break;case"PointCloud":case"Points":a=new Joe(o(e.geometry),l(e.material));break;case"Sprite":a=new Xoe(l(e.material));break;case"Group":a=new Gw;break;case"Bone":a=new tH;break;default:a=new Br}if(a.uuid=e.uuid,e.name!==void 0&&(a.name=e.name),e.matrix!==void 0?(a.matrix.fromArray(e.matrix),e.matrixAutoUpdate!==void 0&&(a.matrixAutoUpdate=e.matrixAutoUpdate),a.matrixAutoUpdate&&a.matrix.decompose(a.position,a.quaternion,a.scale)):(e.position!==void 0&&a.position.fromArray(e.position),e.rotation!==void 0&&a.rotation.fromArray(e.rotation),e.quaternion!==void 0&&a.quaternion.fromArray(e.quaternion),e.scale!==void 0&&a.scale.fromArray(e.scale)),e.up!==void 0&&a.up.fromArray(e.up),e.castShadow!==void 0&&(a.castShadow=e.castShadow),e.receiveShadow!==void 0&&(a.receiveShadow=e.receiveShadow),e.shadow&&(e.shadow.intensity!==void 0&&(a.shadow.intensity=e.shadow.intensity),e.shadow.bias!==void 0&&(a.shadow.bias=e.shadow.bias),e.shadow.normalBias!==void 0&&(a.shadow.normalBias=e.shadow.normalBias),e.shadow.radius!==void 0&&(a.shadow.radius=e.shadow.radius),e.shadow.mapSize!==void 0&&a.shadow.mapSize.fromArray(e.shadow.mapSize),e.shadow.camera!==void 0&&(a.shadow.camera=this.parseObject(e.shadow.camera))),e.visible!==void 0&&(a.visible=e.visible),e.frustumCulled!==void 0&&(a.frustumCulled=e.frustumCulled),e.renderOrder!==void 0&&(a.renderOrder=e.renderOrder),e.userData!==void 0&&(a.userData=e.userData),e.layers!==void 0&&(a.layers.mask=e.layers),e.children!==void 0){const d=e.children;for(let f=0;f<d.length;f++)a.add(this.parseObject(d[f],i,r,n,s))}if(e.animations!==void 0){const d=e.animations;for(let f=0;f<d.length;f++){const p=d[f];a.animations.push(s[p])}}if(e.type==="LOD"){e.autoUpdate!==void 0&&(a.autoUpdate=e.autoUpdate);const d=e.levels;for(let f=0;f<d.length;f++){const p=d[f],g=a.getObjectByProperty("uuid",p.object);g!==void 0&&a.addLevel(g,p.distance,p.hysteresis)}}return a}bindSkeletons(e,i){Object.keys(i).length!==0&&e.traverse(function(r){if(r.isSkinnedMesh===!0&&r.skeleton!==void 0){const n=i[r.skeleton];n===void 0?console.warn("THREE.ObjectLoader: No skeleton found with UUID:",r.skeleton):r.bind(n,r.bindMatrix)}})}bindLightTargets(e){e.traverse(function(i){if(i.isDirectionalLight||i.isSpotLight){const r=i.target,n=e.getObjectByProperty("uuid",r);n!==void 0?i.target=n:i.target=new Br}})}}const sOe={UVMapping:gO,CubeReflectionMapping:zp,CubeRefractionMapping:Jg,EquirectangularReflectionMapping:lM,EquirectangularRefractionMapping:cM,CubeUVReflectionMapping:p_},Z$={RepeatWrapping:uM,ClampToEdgeWrapping:gu,MirroredRepeatWrapping:hM},Q$={NearestFilter:wo,NearestMipmapNearestFilter:U6,NearestMipmapLinearFilter:Vw,LinearFilter:ma,LinearMipmapNearestFilter:yA,LinearMipmapLinearFilter:Id},HU=new WeakMap;class aOe extends cc{constructor(e){super(e),this.isImageBitmapLoader=!0,typeof createImageBitmap>"u"&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),typeof fetch>"u"&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),this.options={premultiplyAlpha:"none"},this._abortController=new AbortController}setOptions(e){return this.options=e,this}load(e,i,r,n){e===void 0&&(e=""),this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const s=this,a=Dd.get(`image-bitmap:${e}`);if(a!==void 0){if(s.manager.itemStart(e),a.then){a.then(c=>{if(HU.has(a)===!0)n&&n(HU.get(a)),s.manager.itemError(e),s.manager.itemEnd(e);else return i&&i(c),s.manager.itemEnd(e),c});return}return setTimeout(function(){i&&i(a),s.manager.itemEnd(e)},0),a}const o={};o.credentials=this.crossOrigin==="anonymous"?"same-origin":"include",o.headers=this.requestHeader,o.signal=typeof AbortSignal.any=="function"?AbortSignal.any([this._abortController.signal,this.manager.abortController.signal]):this._abortController.signal;const l=fetch(e,o).then(function(c){return c.blob()}).then(function(c){return createImageBitmap(c,Object.assign(s.options,{colorSpaceConversion:"none"}))}).then(function(c){return Dd.add(`image-bitmap:${e}`,c),i&&i(c),s.manager.itemEnd(e),c}).catch(function(c){n&&n(c),HU.set(l,c),Dd.remove(`image-bitmap:${e}`),s.manager.itemError(e),s.manager.itemEnd(e)});Dd.add(`image-bitmap:${e}`,l),s.manager.itemStart(e)}abort(){return this._abortController.abort(),this._abortController=new AbortController,this}}let X2,yH=class{static getContext(){return X2===void 0&&(X2=new(window.AudioContext||window.webkitAudioContext)),X2}static setContext(e){X2=e}};class oOe extends cc{constructor(e){super(e)}load(e,i,r,n){const s=this,a=new Vp(this.manager);a.setResponseType("arraybuffer"),a.setPath(this.path),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials),a.load(e,function(l){try{const c=l.slice(0);yH.getContext().decodeAudioData(c,function(h){i(h)}).catch(o)}catch(c){o(c)}},r,n);function o(l){n?n(l):console.error(l),s.manager.itemError(e)}}}const J$=new zi,eY=new zi,my=new zi;class lOe{constructor(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new ja,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new ja,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1,this._cache={focus:null,fov:null,aspect:null,near:null,far:null,zoom:null,eyeSep:null}}update(e){const i=this._cache;if(i.focus!==e.focus||i.fov!==e.fov||i.aspect!==e.aspect*this.aspect||i.near!==e.near||i.far!==e.far||i.zoom!==e.zoom||i.eyeSep!==this.eyeSep){i.focus=e.focus,i.fov=e.fov,i.aspect=e.aspect*this.aspect,i.near=e.near,i.far=e.far,i.zoom=e.zoom,i.eyeSep=this.eyeSep,my.copy(e.projectionMatrix);const n=i.eyeSep/2,s=n*i.near/i.focus,a=i.near*Math.tan(f0*i.fov*.5)/i.zoom;let o,l;eY.elements[12]=-n,J$.elements[12]=n,o=-a*i.aspect+s,l=a*i.aspect+s,my.elements[0]=2*i.near/(l-o),my.elements[8]=(l+o)/(l-o),this.cameraL.projectionMatrix.copy(my),o=-a*i.aspect-s,l=a*i.aspect-s,my.elements[0]=2*i.near/(l-o),my.elements[8]=(l+o)/(l-o),this.cameraR.projectionMatrix.copy(my)}this.cameraL.matrixWorld.copy(e.matrixWorld).multiply(eY),this.cameraR.matrixWorld.copy(e.matrixWorld).multiply(J$)}}class Ule extends ja{constructor(e=[]){super(),this.isArrayCamera=!0,this.isMultiViewCamera=!1,this.cameras=e}}class xH{constructor(e=!0){this.autoStart=e,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=performance.now(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let e=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){const i=performance.now();e=(i-this.oldTime)/1e3,this.oldTime=i,this.elapsedTime+=e}return e}}const gy=new be,GU=new sc,cOe=new be,vy=new be,yy=new be;class uOe extends Br{constructor(){super(),this.type="AudioListener",this.context=yH.getContext(),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null,this.timeDelta=0,this._clock=new xH}getInput(){return this.gain}removeFilter(){return this.filter!==null&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null),this}getFilter(){return this.filter}setFilter(e){return this.filter!==null?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=e,this.gain.connect(this.filter),this.filter.connect(this.context.destination),this}getMasterVolume(){return this.gain.gain.value}setMasterVolume(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}updateMatrixWorld(e){super.updateMatrixWorld(e);const i=this.context.listener;if(this.timeDelta=this._clock.getDelta(),this.matrixWorld.decompose(gy,GU,cOe),vy.set(0,0,-1).applyQuaternion(GU),yy.set(0,1,0).applyQuaternion(GU),i.positionX){const r=this.context.currentTime+this.timeDelta;i.positionX.linearRampToValueAtTime(gy.x,r),i.positionY.linearRampToValueAtTime(gy.y,r),i.positionZ.linearRampToValueAtTime(gy.z,r),i.forwardX.linearRampToValueAtTime(vy.x,r),i.forwardY.linearRampToValueAtTime(vy.y,r),i.forwardZ.linearRampToValueAtTime(vy.z,r),i.upX.linearRampToValueAtTime(yy.x,r),i.upY.linearRampToValueAtTime(yy.y,r),i.upZ.linearRampToValueAtTime(yy.z,r)}else i.setPosition(gy.x,gy.y,gy.z),i.setOrientation(vy.x,vy.y,vy.z,yy.x,yy.y,yy.z)}}class Ble extends Br{constructor(e){super(),this.type="Audio",this.listener=e,this.context=e.context,this.gain=this.context.createGain(),this.gain.connect(e.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.loopStart=0,this.loopEnd=0,this.offset=0,this.duration=void 0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.source=null,this.sourceType="empty",this._startedAt=0,this._progress=0,this._connected=!1,this.filters=[]}getOutput(){return this.gain}setNodeSource(e){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=e,this.connect(),this}setMediaElementSource(e){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(e),this.connect(),this}setMediaStreamSource(e){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(e),this.connect(),this}setBuffer(e){return this.buffer=e,this.sourceType="buffer",this.autoplay&&this.play(),this}play(e=0){if(this.isPlaying===!0){console.warn("THREE.Audio: Audio is already playing.");return}if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}this._startedAt=this.context.currentTime+e;const i=this.context.createBufferSource();return i.buffer=this.buffer,i.loop=this.loop,i.loopStart=this.loopStart,i.loopEnd=this.loopEnd,i.onended=this.onEnded.bind(this),i.start(this._startedAt,this._progress+this.offset,this.duration),this.isPlaying=!0,this.source=i,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()}pause(){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.isPlaying===!0&&(this._progress+=Math.max(this.context.currentTime-this._startedAt,0)*this.playbackRate,this.loop===!0&&(this._progress=this._progress%(this.duration||this.buffer.duration)),this.source.stop(),this.source.onended=null,this.isPlaying=!1),this}stop(e=0){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this._progress=0,this.source!==null&&(this.source.stop(this.context.currentTime+e),this.source.onended=null),this.isPlaying=!1,this}connect(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(let e=1,i=this.filters.length;e<i;e++)this.filters[e-1].connect(this.filters[e]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this._connected=!0,this}disconnect(){if(this._connected!==!1){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(let e=1,i=this.filters.length;e<i;e++)this.filters[e-1].disconnect(this.filters[e]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this._connected=!1,this}}getFilters(){return this.filters}setFilters(e){return e||(e=[]),this._connected===!0?(this.disconnect(),this.filters=e.slice(),this.connect()):this.filters=e.slice(),this}setDetune(e){return this.detune=e,this.isPlaying===!0&&this.source.detune!==void 0&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this}getDetune(){return this.detune}getFilter(){return this.getFilters()[0]}setFilter(e){return this.setFilters(e?[e]:[])}setPlaybackRate(e){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.playbackRate=e,this.isPlaying===!0&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this}getPlaybackRate(){return this.playbackRate}onEnded(){this.isPlaying=!1,this._progress=0}getLoop(){return this.hasPlaybackControl===!1?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop}setLoop(e){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.loop=e,this.isPlaying===!0&&(this.source.loop=this.loop),this}setLoopStart(e){return this.loopStart=e,this}setLoopEnd(e){return this.loopEnd=e,this}getVolume(){return this.gain.gain.value}setVolume(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}copy(e,i){return super.copy(e,i),e.sourceType!=="buffer"?(console.warn("THREE.Audio: Audio source type cannot be copied."),this):(this.autoplay=e.autoplay,this.buffer=e.buffer,this.detune=e.detune,this.loop=e.loop,this.loopStart=e.loopStart,this.loopEnd=e.loopEnd,this.offset=e.offset,this.duration=e.duration,this.playbackRate=e.playbackRate,this.hasPlaybackControl=e.hasPlaybackControl,this.sourceType=e.sourceType,this.filters=e.filters.slice(),this)}clone(e){return new this.constructor(this.listener).copy(this,e)}}const xy=new be,tY=new sc,hOe=new be,by=new be;class dOe extends Ble{constructor(e){super(e),this.panner=this.context.createPanner(),this.panner.panningModel="HRTF",this.panner.connect(this.gain)}connect(){return super.connect(),this.panner.connect(this.gain),this}disconnect(){return super.disconnect(),this.panner.disconnect(this.gain),this}getOutput(){return this.panner}getRefDistance(){return this.panner.refDistance}setRefDistance(e){return this.panner.refDistance=e,this}getRolloffFactor(){return this.panner.rolloffFactor}setRolloffFactor(e){return this.panner.rolloffFactor=e,this}getDistanceModel(){return this.panner.distanceModel}setDistanceModel(e){return this.panner.distanceModel=e,this}getMaxDistance(){return this.panner.maxDistance}setMaxDistance(e){return this.panner.maxDistance=e,this}setDirectionalCone(e,i,r){return this.panner.coneInnerAngle=e,this.panner.coneOuterAngle=i,this.panner.coneOuterGain=r,this}updateMatrixWorld(e){if(super.updateMatrixWorld(e),this.hasPlaybackControl===!0&&this.isPlaying===!1)return;this.matrixWorld.decompose(xy,tY,hOe),by.set(0,0,1).applyQuaternion(tY);const i=this.panner;if(i.positionX){const r=this.context.currentTime+this.listener.timeDelta;i.positionX.linearRampToValueAtTime(xy.x,r),i.positionY.linearRampToValueAtTime(xy.y,r),i.positionZ.linearRampToValueAtTime(xy.z,r),i.orientationX.linearRampToValueAtTime(by.x,r),i.orientationY.linearRampToValueAtTime(by.y,r),i.orientationZ.linearRampToValueAtTime(by.z,r)}else i.setPosition(xy.x,xy.y,xy.z),i.setOrientation(by.x,by.y,by.z)}}class fOe{constructor(e,i=2048){this.analyser=e.context.createAnalyser(),this.analyser.fftSize=i,this.data=new Uint8Array(this.analyser.frequencyBinCount),e.getOutput().connect(this.analyser)}getFrequencyData(){return this.analyser.getByteFrequencyData(this.data),this.data}getAverageFrequency(){let e=0;const i=this.getFrequencyData();for(let r=0;r<i.length;r++)e+=i[r];return e/i.length}}class Fle{constructor(e,i,r){this.binding=e,this.valueSize=r;let n,s,a;switch(i){case"quaternion":n=this._slerp,s=this._slerpAdditive,a=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(r*6),this._workIndex=5;break;case"string":case"bool":n=this._select,s=this._select,a=this._setAdditiveIdentityOther,this.buffer=new Array(r*5);break;default:n=this._lerp,s=this._lerpAdditive,a=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(r*5)}this._mixBufferRegion=n,this._mixBufferRegionAdditive=s,this._setIdentity=a,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}accumulate(e,i){const r=this.buffer,n=this.valueSize,s=e*n+n;let a=this.cumulativeWeight;if(a===0){for(let o=0;o!==n;++o)r[s+o]=r[o];a=i}else{a+=i;const o=i/a;this._mixBufferRegion(r,s,0,o,n)}this.cumulativeWeight=a}accumulateAdditive(e){const i=this.buffer,r=this.valueSize,n=r*this._addIndex;this.cumulativeWeightAdditive===0&&this._setIdentity(),this._mixBufferRegionAdditive(i,n,0,e,r),this.cumulativeWeightAdditive+=e}apply(e){const i=this.valueSize,r=this.buffer,n=e*i+i,s=this.cumulativeWeight,a=this.cumulativeWeightAdditive,o=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,s<1){const l=i*this._origIndex;this._mixBufferRegion(r,n,l,1-s,i)}a>0&&this._mixBufferRegionAdditive(r,n,this._addIndex*i,1,i);for(let l=i,c=i+i;l!==c;++l)if(r[l]!==r[l+i]){o.setValue(r,n);break}}saveOriginalState(){const e=this.binding,i=this.buffer,r=this.valueSize,n=r*this._origIndex;e.getValue(i,n);for(let s=r,a=n;s!==a;++s)i[s]=i[n+s%r];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0}restoreOriginalState(){const e=this.valueSize*3;this.binding.setValue(this.buffer,e)}_setAdditiveIdentityNumeric(){const e=this._addIndex*this.valueSize,i=e+this.valueSize;for(let r=e;r<i;r++)this.buffer[r]=0}_setAdditiveIdentityQuaternion(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1}_setAdditiveIdentityOther(){const e=this._origIndex*this.valueSize,i=this._addIndex*this.valueSize;for(let r=0;r<this.valueSize;r++)this.buffer[i+r]=this.buffer[e+r]}_select(e,i,r,n,s){if(n>=.5)for(let a=0;a!==s;++a)e[i+a]=e[r+a]}_slerp(e,i,r,n){sc.slerpFlat(e,i,e,i,e,r,n)}_slerpAdditive(e,i,r,n,s){const a=this._workIndex*s;sc.multiplyQuaternionsFlat(e,a,e,i,e,r),sc.slerpFlat(e,i,e,i,e,a,n)}_lerp(e,i,r,n,s){const a=1-n;for(let o=0;o!==s;++o){const l=i+o;e[l]=e[l]*a+e[r+o]*n}}_lerpAdditive(e,i,r,n,s){for(let a=0;a!==s;++a){const o=i+a;e[o]=e[o]+e[r+a]*n}}}const bH="\\[\\]\\.:\\/",pOe=new RegExp("["+bH+"]","g"),wH="[^"+bH+"]",mOe="[^"+bH.replace("\\.","")+"]",gOe=/((?:WC+[\/:])*)/.source.replace("WC",wH),vOe=/(WCOD+)?/.source.replace("WCOD",mOe),yOe=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",wH),xOe=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",wH),bOe=new RegExp("^"+gOe+vOe+yOe+xOe+"$"),wOe=["material","materials","bones","map"];class _Oe{constructor(e,i,r){const n=r||Nr.parseTrackName(i);this._targetGroup=e,this._bindings=e.subscribe_(i,n)}getValue(e,i){this.bind();const r=this._targetGroup.nCachedObjects_,n=this._bindings[r];n!==void 0&&n.getValue(e,i)}setValue(e,i){const r=this._bindings;for(let n=this._targetGroup.nCachedObjects_,s=r.length;n!==s;++n)r[n].setValue(e,i)}bind(){const e=this._bindings;for(let i=this._targetGroup.nCachedObjects_,r=e.length;i!==r;++i)e[i].bind()}unbind(){const e=this._bindings;for(let i=this._targetGroup.nCachedObjects_,r=e.length;i!==r;++i)e[i].unbind()}}class Nr{constructor(e,i,r){this.path=i,this.parsedPath=r||Nr.parseTrackName(i),this.node=Nr.findNode(e,this.parsedPath.nodeName),this.rootNode=e,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(e,i,r){return e&&e.isAnimationObjectGroup?new Nr.Composite(e,i,r):new Nr(e,i,r)}static sanitizeNodeName(e){return e.replace(/\s/g,"_").replace(pOe,"")}static parseTrackName(e){const i=bOe.exec(e);if(i===null)throw new Error("PropertyBinding: Cannot parse trackName: "+e);const r={nodeName:i[2],objectName:i[3],objectIndex:i[4],propertyName:i[5],propertyIndex:i[6]},n=r.nodeName&&r.nodeName.lastIndexOf(".");if(n!==void 0&&n!==-1){const s=r.nodeName.substring(n+1);wOe.indexOf(s)!==-1&&(r.nodeName=r.nodeName.substring(0,n),r.objectName=s)}if(r.propertyName===null||r.propertyName.length===0)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+e);return r}static findNode(e,i){if(i===void 0||i===""||i==="."||i===-1||i===e.name||i===e.uuid)return e;if(e.skeleton){const r=e.skeleton.getBoneByName(i);if(r!==void 0)return r}if(e.children){const r=function(s){for(let a=0;a<s.length;a++){const o=s[a];if(o.name===i||o.uuid===i)return o;const l=r(o.children);if(l)return l}return null},n=r(e.children);if(n)return n}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(e,i){e[i]=this.targetObject[this.propertyName]}_getValue_array(e,i){const r=this.resolvedProperty;for(let n=0,s=r.length;n!==s;++n)e[i++]=r[n]}_getValue_arrayElement(e,i){e[i]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(e,i){this.resolvedProperty.toArray(e,i)}_setValue_direct(e,i){this.targetObject[this.propertyName]=e[i]}_setValue_direct_setNeedsUpdate(e,i){this.targetObject[this.propertyName]=e[i],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(e,i){this.targetObject[this.propertyName]=e[i],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(e,i){const r=this.resolvedProperty;for(let n=0,s=r.length;n!==s;++n)r[n]=e[i++]}_setValue_array_setNeedsUpdate(e,i){const r=this.resolvedProperty;for(let n=0,s=r.length;n!==s;++n)r[n]=e[i++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(e,i){const r=this.resolvedProperty;for(let n=0,s=r.length;n!==s;++n)r[n]=e[i++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(e,i){this.resolvedProperty[this.propertyIndex]=e[i]}_setValue_arrayElement_setNeedsUpdate(e,i){this.resolvedProperty[this.propertyIndex]=e[i],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(e,i){this.resolvedProperty[this.propertyIndex]=e[i],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(e,i){this.resolvedProperty.fromArray(e,i)}_setValue_fromArray_setNeedsUpdate(e,i){this.resolvedProperty.fromArray(e,i),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(e,i){this.resolvedProperty.fromArray(e,i),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(e,i){this.bind(),this.getValue(e,i)}_setValue_unbound(e,i){this.bind(),this.setValue(e,i)}bind(){let e=this.node;const i=this.parsedPath,r=i.objectName,n=i.propertyName;let s=i.propertyIndex;if(e||(e=Nr.findNode(this.rootNode,i.nodeName),this.node=e),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!e){console.warn("THREE.PropertyBinding: No target node found for track: "+this.path+".");return}if(r){let c=i.objectIndex;switch(r){case"materials":if(!e.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!e.material.materials){console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);return}e=e.material.materials;break;case"bones":if(!e.skeleton){console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);return}e=e.skeleton.bones;for(let u=0;u<e.length;u++)if(e[u].name===c){c=u;break}break;case"map":if("map"in e){e=e.map;break}if(!e.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!e.material.map){console.error("THREE.PropertyBinding: Can not bind to material.map as node.material does not have a map.",this);return}e=e.material.map;break;default:if(e[r]===void 0){console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);return}e=e[r]}if(c!==void 0){if(e[c]===void 0){console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,e);return}e=e[c]}}const a=e[n];if(a===void 0){const c=i.nodeName;console.error("THREE.PropertyBinding: Trying to update property for track: "+c+"."+n+" but it wasn't found.",e);return}let o=this.Versioning.None;this.targetObject=e,e.isMaterial===!0?o=this.Versioning.NeedsUpdate:e.isObject3D===!0&&(o=this.Versioning.MatrixWorldNeedsUpdate);let l=this.BindingType.Direct;if(s!==void 0){if(n==="morphTargetInfluences"){if(!e.geometry){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);return}if(!e.geometry.morphAttributes){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);return}e.morphTargetDictionary[s]!==void 0&&(s=e.morphTargetDictionary[s])}l=this.BindingType.ArrayElement,this.resolvedProperty=a,this.propertyIndex=s}else a.fromArray!==void 0&&a.toArray!==void 0?(l=this.BindingType.HasFromToArray,this.resolvedProperty=a):Array.isArray(a)?(l=this.BindingType.EntireArray,this.resolvedProperty=a):this.propertyName=n;this.getValue=this.GetterByBindingType[l],this.setValue=this.SetterByBindingTypeAndVersioning[l][o]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}Nr.Composite=_Oe;Nr.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3};Nr.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2};Nr.prototype.GetterByBindingType=[Nr.prototype._getValue_direct,Nr.prototype._getValue_array,Nr.prototype._getValue_arrayElement,Nr.prototype._getValue_toArray];Nr.prototype.SetterByBindingTypeAndVersioning=[[Nr.prototype._setValue_direct,Nr.prototype._setValue_direct_setNeedsUpdate,Nr.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[Nr.prototype._setValue_array,Nr.prototype._setValue_array_setNeedsUpdate,Nr.prototype._setValue_array_setMatrixWorldNeedsUpdate],[Nr.prototype._setValue_arrayElement,Nr.prototype._setValue_arrayElement_setNeedsUpdate,Nr.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[Nr.prototype._setValue_fromArray,Nr.prototype._setValue_fromArray_setNeedsUpdate,Nr.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];class SOe{constructor(){this.isAnimationObjectGroup=!0,this.uuid=Rc(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;const e={};this._indicesByUUID=e;for(let r=0,n=arguments.length;r!==n;++r)e[arguments[r].uuid]=r;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};const i=this;this.stats={objects:{get total(){return i._objects.length},get inUse(){return this.total-i.nCachedObjects_}},get bindingsPerObject(){return i._bindings.length}}}add(){const e=this._objects,i=this._indicesByUUID,r=this._paths,n=this._parsedPaths,s=this._bindings,a=s.length;let o,l=e.length,c=this.nCachedObjects_;for(let u=0,h=arguments.length;u!==h;++u){const d=arguments[u],f=d.uuid;let p=i[f];if(p===void 0){p=l++,i[f]=p,e.push(d);for(let g=0,m=a;g!==m;++g)s[g].push(new Nr(d,r[g],n[g]))}else if(p<c){o=e[p];const g=--c,m=e[g];i[m.uuid]=p,e[p]=m,i[f]=g,e[g]=d;for(let y=0,b=a;y!==b;++y){const w=s[y],E=w[g];let M=w[p];w[p]=E,M===void 0&&(M=new Nr(d,r[y],n[y])),w[g]=M}}else e[p]!==o&&console.error("THREE.AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.")}this.nCachedObjects_=c}remove(){const e=this._objects,i=this._indicesByUUID,r=this._bindings,n=r.length;let s=this.nCachedObjects_;for(let a=0,o=arguments.length;a!==o;++a){const l=arguments[a],c=l.uuid,u=i[c];if(u!==void 0&&u>=s){const h=s++,d=e[h];i[d.uuid]=u,e[u]=d,i[c]=h,e[h]=l;for(let f=0,p=n;f!==p;++f){const g=r[f],m=g[h],y=g[u];g[u]=m,g[h]=y}}}this.nCachedObjects_=s}uncache(){const e=this._objects,i=this._indicesByUUID,r=this._bindings,n=r.length;let s=this.nCachedObjects_,a=e.length;for(let o=0,l=arguments.length;o!==l;++o){const c=arguments[o],u=c.uuid,h=i[u];if(h!==void 0)if(delete i[u],h<s){const d=--s,f=e[d],p=--a,g=e[p];i[f.uuid]=h,e[h]=f,i[g.uuid]=d,e[d]=g,e.pop();for(let m=0,y=n;m!==y;++m){const b=r[m],w=b[d],E=b[p];b[h]=w,b[d]=E,b.pop()}}else{const d=--a,f=e[d];d>0&&(i[f.uuid]=h),e[h]=f,e.pop();for(let p=0,g=n;p!==g;++p){const m=r[p];m[h]=m[d],m.pop()}}}this.nCachedObjects_=s}subscribe_(e,i){const r=this._bindingsIndicesByPath;let n=r[e];const s=this._bindings;if(n!==void 0)return s[n];const a=this._paths,o=this._parsedPaths,l=this._objects,c=l.length,u=this.nCachedObjects_,h=new Array(c);n=s.length,r[e]=n,a.push(e),o.push(i),s.push(h);for(let d=u,f=l.length;d!==f;++d){const p=l[d];h[d]=new Nr(p,e,i)}return h}unsubscribe_(e){const i=this._bindingsIndicesByPath,r=i[e];if(r!==void 0){const n=this._paths,s=this._parsedPaths,a=this._bindings,o=a.length-1,l=a[o],c=e[o];i[c]=r,a[r]=l,a.pop(),s[r]=s[o],s.pop(),n[r]=n[o],n.pop()}}}class zle{constructor(e,i,r=null,n=i.blendMode){this._mixer=e,this._clip=i,this._localRoot=r,this.blendMode=n;const s=i.tracks,a=s.length,o=new Array(a),l={endingStart:Zy,endingEnd:Zy};for(let c=0;c!==a;++c){const u=s[c].createInterpolant(null);o[c]=u,u.settings=l}this._interpolantSettings=l,this._interpolants=o,this._propertyBindings=new Array(a),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=Coe,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}play(){return this._mixer._activateAction(this),this}stop(){return this._mixer._deactivateAction(this),this.reset()}reset(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}isRunning(){return this.enabled&&!this.paused&&this.timeScale!==0&&this._startTime===null&&this._mixer._isActiveAction(this)}isScheduled(){return this._mixer._isActiveAction(this)}startAt(e){return this._startTime=e,this}setLoop(e,i){return this.loop=e,this.repetitions=i,this}setEffectiveWeight(e){return this.weight=e,this._effectiveWeight=this.enabled?e:0,this.stopFading()}getEffectiveWeight(){return this._effectiveWeight}fadeIn(e){return this._scheduleFading(e,0,1)}fadeOut(e){return this._scheduleFading(e,1,0)}crossFadeFrom(e,i,r=!1){if(e.fadeOut(i),this.fadeIn(i),r===!0){const n=this._clip.duration,s=e._clip.duration,a=s/n,o=n/s;e.warp(1,a,i),this.warp(o,1,i)}return this}crossFadeTo(e,i,r=!1){return e.crossFadeFrom(this,i,r)}stopFading(){const e=this._weightInterpolant;return e!==null&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}setEffectiveTimeScale(e){return this.timeScale=e,this._effectiveTimeScale=this.paused?0:e,this.stopWarping()}getEffectiveTimeScale(){return this._effectiveTimeScale}setDuration(e){return this.timeScale=this._clip.duration/e,this.stopWarping()}syncWith(e){return this.time=e.time,this.timeScale=e.timeScale,this.stopWarping()}halt(e){return this.warp(this._effectiveTimeScale,0,e)}warp(e,i,r){const n=this._mixer,s=n.time,a=this.timeScale;let o=this._timeScaleInterpolant;o===null&&(o=n._lendControlInterpolant(),this._timeScaleInterpolant=o);const l=o.parameterPositions,c=o.sampleValues;return l[0]=s,l[1]=s+r,c[0]=e/a,c[1]=i/a,this}stopWarping(){const e=this._timeScaleInterpolant;return e!==null&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}getMixer(){return this._mixer}getClip(){return this._clip}getRoot(){return this._localRoot||this._mixer._root}_update(e,i,r,n){if(!this.enabled){this._updateWeight(e);return}const s=this._startTime;if(s!==null){const l=(e-s)*r;l<0||r===0?i=0:(this._startTime=null,i=r*l)}i*=this._updateTimeScale(e);const a=this._updateTime(i),o=this._updateWeight(e);if(o>0){const l=this._interpolants,c=this._propertyBindings;switch(this.blendMode){case W6:for(let u=0,h=l.length;u!==h;++u)l[u].evaluate(a),c[u].accumulateAdditive(o);break;case SO:default:for(let u=0,h=l.length;u!==h;++u)l[u].evaluate(a),c[u].accumulate(n,o)}}}_updateWeight(e){let i=0;if(this.enabled){i=this.weight;const r=this._weightInterpolant;if(r!==null){const n=r.evaluate(e)[0];i*=n,e>r.parameterPositions[1]&&(this.stopFading(),n===0&&(this.enabled=!1))}}return this._effectiveWeight=i,i}_updateTimeScale(e){let i=0;if(!this.paused){i=this.timeScale;const r=this._timeScaleInterpolant;if(r!==null){const n=r.evaluate(e)[0];i*=n,e>r.parameterPositions[1]&&(this.stopWarping(),i===0?this.paused=!0:this.timeScale=i)}}return this._effectiveTimeScale=i,i}_updateTime(e){const i=this._clip.duration,r=this.loop;let n=this.time+e,s=this._loopCount;const a=r===Poe;if(e===0)return s===-1?n:a&&(s&1)===1?i-n:n;if(r===Toe){s===-1&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(n>=i)n=i;else if(n<0)n=0;else{this.time=n;break e}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=n,this._mixer.dispatchEvent({type:"finished",action:this,direction:e<0?-1:1})}}else{if(s===-1&&(e>=0?(s=0,this._setEndings(!0,this.repetitions===0,a)):this._setEndings(this.repetitions===0,!0,a)),n>=i||n<0){const o=Math.floor(n/i);n-=i*o,s+=Math.abs(o);const l=this.repetitions-s;if(l<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,n=e>0?i:0,this.time=n,this._mixer.dispatchEvent({type:"finished",action:this,direction:e>0?1:-1});else{if(l===1){const c=e<0;this._setEndings(c,!c,a)}else this._setEndings(!1,!1,a);this._loopCount=s,this.time=n,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:o})}}else this.time=n;if(a&&(s&1)===1)return i-n}return n}_setEndings(e,i,r){const n=this._interpolantSettings;r?(n.endingStart=Qy,n.endingEnd=Qy):(e?n.endingStart=this.zeroSlopeAtStart?Qy:Zy:n.endingStart=fM,i?n.endingEnd=this.zeroSlopeAtEnd?Qy:Zy:n.endingEnd=fM)}_scheduleFading(e,i,r){const n=this._mixer,s=n.time;let a=this._weightInterpolant;a===null&&(a=n._lendControlInterpolant(),this._weightInterpolant=a);const o=a.parameterPositions,l=a.sampleValues;return o[0]=s,l[0]=i,o[1]=s+e,l[1]=r,this}}const EOe=new Float32Array(1);class AOe extends af{constructor(e){super(),this._root=e,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}_bindAction(e,i){const r=e._localRoot||this._root,n=e._clip.tracks,s=n.length,a=e._propertyBindings,o=e._interpolants,l=r.uuid,c=this._bindingsByRootAndName;let u=c[l];u===void 0&&(u={},c[l]=u);for(let h=0;h!==s;++h){const d=n[h],f=d.name;let p=u[f];if(p!==void 0)++p.referenceCount,a[h]=p;else{if(p=a[h],p!==void 0){p._cacheIndex===null&&(++p.referenceCount,this._addInactiveBinding(p,l,f));continue}const g=i&&i._propertyBindings[h].binding.parsedPath;p=new Fle(Nr.create(r,f,g),d.ValueTypeName,d.getValueSize()),++p.referenceCount,this._addInactiveBinding(p,l,f),a[h]=p}o[h].resultBuffer=p.buffer}}_activateAction(e){if(!this._isActiveAction(e)){if(e._cacheIndex===null){const r=(e._localRoot||this._root).uuid,n=e._clip.uuid,s=this._actionsByClip[n];this._bindAction(e,s&&s.knownActions[0]),this._addInactiveAction(e,n,r)}const i=e._propertyBindings;for(let r=0,n=i.length;r!==n;++r){const s=i[r];s.useCount++===0&&(this._lendBinding(s),s.saveOriginalState())}this._lendAction(e)}}_deactivateAction(e){if(this._isActiveAction(e)){const i=e._propertyBindings;for(let r=0,n=i.length;r!==n;++r){const s=i[r];--s.useCount===0&&(s.restoreOriginalState(),this._takeBackBinding(s))}this._takeBackAction(e)}}_initMemoryManager(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;const e=this;this.stats={actions:{get total(){return e._actions.length},get inUse(){return e._nActiveActions}},bindings:{get total(){return e._bindings.length},get inUse(){return e._nActiveBindings}},controlInterpolants:{get total(){return e._controlInterpolants.length},get inUse(){return e._nActiveControlInterpolants}}}}_isActiveAction(e){const i=e._cacheIndex;return i!==null&&i<this._nActiveActions}_addInactiveAction(e,i,r){const n=this._actions,s=this._actionsByClip;let a=s[i];if(a===void 0)a={knownActions:[e],actionByRoot:{}},e._byClipCacheIndex=0,s[i]=a;else{const o=a.knownActions;e._byClipCacheIndex=o.length,o.push(e)}e._cacheIndex=n.length,n.push(e),a.actionByRoot[r]=e}_removeInactiveAction(e){const i=this._actions,r=i[i.length-1],n=e._cacheIndex;r._cacheIndex=n,i[n]=r,i.pop(),e._cacheIndex=null;const s=e._clip.uuid,a=this._actionsByClip,o=a[s],l=o.knownActions,c=l[l.length-1],u=e._byClipCacheIndex;c._byClipCacheIndex=u,l[u]=c,l.pop(),e._byClipCacheIndex=null;const h=o.actionByRoot,d=(e._localRoot||this._root).uuid;delete h[d],l.length===0&&delete a[s],this._removeInactiveBindingsForAction(e)}_removeInactiveBindingsForAction(e){const i=e._propertyBindings;for(let r=0,n=i.length;r!==n;++r){const s=i[r];--s.referenceCount===0&&this._removeInactiveBinding(s)}}_lendAction(e){const i=this._actions,r=e._cacheIndex,n=this._nActiveActions++,s=i[n];e._cacheIndex=n,i[n]=e,s._cacheIndex=r,i[r]=s}_takeBackAction(e){const i=this._actions,r=e._cacheIndex,n=--this._nActiveActions,s=i[n];e._cacheIndex=n,i[n]=e,s._cacheIndex=r,i[r]=s}_addInactiveBinding(e,i,r){const n=this._bindingsByRootAndName,s=this._bindings;let a=n[i];a===void 0&&(a={},n[i]=a),a[r]=e,e._cacheIndex=s.length,s.push(e)}_removeInactiveBinding(e){const i=this._bindings,r=e.binding,n=r.rootNode.uuid,s=r.path,a=this._bindingsByRootAndName,o=a[n],l=i[i.length-1],c=e._cacheIndex;l._cacheIndex=c,i[c]=l,i.pop(),delete o[s],Object.keys(o).length===0&&delete a[n]}_lendBinding(e){const i=this._bindings,r=e._cacheIndex,n=this._nActiveBindings++,s=i[n];e._cacheIndex=n,i[n]=e,s._cacheIndex=r,i[r]=s}_takeBackBinding(e){const i=this._bindings,r=e._cacheIndex,n=--this._nActiveBindings,s=i[n];e._cacheIndex=n,i[n]=e,s._cacheIndex=r,i[r]=s}_lendControlInterpolant(){const e=this._controlInterpolants,i=this._nActiveControlInterpolants++;let r=e[i];return r===void 0&&(r=new pH(new Float32Array(2),new Float32Array(2),1,EOe),r.__cacheIndex=i,e[i]=r),r}_takeBackControlInterpolant(e){const i=this._controlInterpolants,r=e.__cacheIndex,n=--this._nActiveControlInterpolants,s=i[n];e.__cacheIndex=n,i[n]=e,s.__cacheIndex=r,i[r]=s}clipAction(e,i,r){const n=i||this._root,s=n.uuid;let a=typeof e=="string"?SM.findByName(n,e):e;const o=a!==null?a.uuid:e,l=this._actionsByClip[o];let c=null;if(r===void 0&&(a!==null?r=a.blendMode:r=SO),l!==void 0){const h=l.actionByRoot[s];if(h!==void 0&&h.blendMode===r)return h;c=l.knownActions[0],a===null&&(a=c._clip)}if(a===null)return null;const u=new zle(this,a,i,r);return this._bindAction(u,c),this._addInactiveAction(u,o,s),u}existingAction(e,i){const r=i||this._root,n=r.uuid,s=typeof e=="string"?SM.findByName(r,e):e,a=s?s.uuid:e,o=this._actionsByClip[a];return o!==void 0&&o.actionByRoot[n]||null}stopAllAction(){const e=this._actions,i=this._nActiveActions;for(let r=i-1;r>=0;--r)e[r].stop();return this}update(e){e*=this.timeScale;const i=this._actions,r=this._nActiveActions,n=this.time+=e,s=Math.sign(e),a=this._accuIndex^=1;for(let c=0;c!==r;++c)i[c]._update(n,e,s,a);const o=this._bindings,l=this._nActiveBindings;for(let c=0;c!==l;++c)o[c].apply(a);return this}setTime(e){this.time=0;for(let i=0;i<this._actions.length;i++)this._actions[i].time=0;return this.update(e)}getRoot(){return this._root}uncacheClip(e){const i=this._actions,r=e.uuid,n=this._actionsByClip,s=n[r];if(s!==void 0){const a=s.knownActions;for(let o=0,l=a.length;o!==l;++o){const c=a[o];this._deactivateAction(c);const u=c._cacheIndex,h=i[i.length-1];c._cacheIndex=null,c._byClipCacheIndex=null,h._cacheIndex=u,i[u]=h,i.pop(),this._removeInactiveBindingsForAction(c)}delete n[r]}}uncacheRoot(e){const i=e.uuid,r=this._actionsByClip;for(const a in r){const o=r[a].actionByRoot,l=o[i];l!==void 0&&(this._deactivateAction(l),this._removeInactiveAction(l))}const n=this._bindingsByRootAndName,s=n[i];if(s!==void 0)for(const a in s){const o=s[a];o.restoreOriginalState(),this._removeInactiveBinding(o)}}uncacheAction(e,i){const r=this.existingAction(e,i);r!==null&&(this._deactivateAction(r),this._removeInactiveAction(r))}}class MOe extends $6{constructor(e=1,i=1,r=1,n={}){super(e,i,n),this.isRenderTarget3D=!0,this.depth=r,this.texture=new AO(null,e,i,r),this._setTextureOptions(n),this.texture.isRenderTargetTexture=!0}}class _H{constructor(e){this.value=e}clone(){return new _H(this.value.clone===void 0?this.value:this.value.clone())}}let TOe=0;class COe extends af{constructor(){super(),this.isUniformsGroup=!0,Object.defineProperty(this,"id",{value:TOe++}),this.name="",this.usage=mM,this.uniforms=[]}add(e){return this.uniforms.push(e),this}remove(e){const i=this.uniforms.indexOf(e);return i!==-1&&this.uniforms.splice(i,1),this}setName(e){return this.name=e,this}setUsage(e){return this.usage=e,this}dispose(){this.dispatchEvent({type:"dispose"})}copy(e){this.name=e.name,this.usage=e.usage;const i=e.uniforms;this.uniforms.length=0;for(let r=0,n=i.length;r<n;r++){const s=Array.isArray(i[r])?i[r]:[i[r]];for(let a=0;a<s.length;a++)this.uniforms.push(s[a].clone())}return this}clone(){return new this.constructor().copy(this)}}class POe extends CO{constructor(e,i,r=1){super(e,i),this.isInstancedInterleavedBuffer=!0,this.meshPerAttribute=r}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}clone(e){const i=super.clone(e);return i.meshPerAttribute=this.meshPerAttribute,i}toJSON(e){const i=super.toJSON(e);return i.isInstancedInterleavedBuffer=!0,i.meshPerAttribute=this.meshPerAttribute,i}}class ROe{constructor(e,i,r,n,s,a=!1){this.isGLBufferAttribute=!0,this.name="",this.buffer=e,this.type=i,this.itemSize=r,this.elementSize=n,this.count=s,this.normalized=a,this.version=0}set needsUpdate(e){e===!0&&this.version++}setBuffer(e){return this.buffer=e,this}setType(e,i){return this.type=e,this.elementSize=i,this}setItemSize(e){return this.itemSize=e,this}setCount(e){return this.count=e,this}}const iY=new zi;class jle{constructor(e,i,r=0,n=1/0){this.ray=new g_(e,i),this.near=r,this.far=n,this.camera=null,this.layers=new p0,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(e,i){this.ray.set(e,i)}setFromCamera(e,i){i.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(i.matrixWorld),this.ray.direction.set(e.x,e.y,.5).unproject(i).sub(this.ray.origin).normalize(),this.camera=i):i.isOrthographicCamera?(this.ray.origin.set(e.x,e.y,(i.near+i.far)/(i.near-i.far)).unproject(i),this.ray.direction.set(0,0,-1).transformDirection(i.matrixWorld),this.camera=i):console.error("THREE.Raycaster: Unsupported camera type: "+i.type)}setFromXRController(e){return iY.identity().extractRotation(e.matrixWorld),this.ray.origin.setFromMatrixPosition(e.matrixWorld),this.ray.direction.set(0,0,-1).applyMatrix4(iY),this}intersectObject(e,i=!0,r=[]){return ej(e,this,r,i),r.sort(rY),r}intersectObjects(e,i=!0,r=[]){for(let n=0,s=e.length;n<s;n++)ej(e[n],this,r,i);return r.sort(rY),r}}function rY(t,e){return t.distance-e.distance}function ej(t,e,i,r){let n=!0;if(t.layers.test(e.layers)&&t.raycast(e,i)===!1&&(n=!1),n===!0&&r===!0){const s=t.children;for(let a=0,o=s.length;a<o;a++)ej(s[a],e,i,!0)}}class IOe{constructor(){this._previousTime=0,this._currentTime=0,this._startTime=performance.now(),this._delta=0,this._elapsed=0,this._timescale=1,this._document=null,this._pageVisibilityHandler=null}connect(e){this._document=e,e.hidden!==void 0&&(this._pageVisibilityHandler=DOe.bind(this),e.addEventListener("visibilitychange",this._pageVisibilityHandler,!1))}disconnect(){this._pageVisibilityHandler!==null&&(this._document.removeEventListener("visibilitychange",this._pageVisibilityHandler),this._pageVisibilityHandler=null),this._document=null}getDelta(){return this._delta/1e3}getElapsed(){return this._elapsed/1e3}getTimescale(){return this._timescale}setTimescale(e){return this._timescale=e,this}reset(){return this._currentTime=performance.now()-this._startTime,this}dispose(){this.disconnect()}update(e){return this._pageVisibilityHandler!==null&&this._document.hidden===!0?this._delta=0:(this._previousTime=this._currentTime,this._currentTime=(e!==void 0?e:performance.now())-this._startTime,this._delta=(this._currentTime-this._previousTime)*this._timescale,this._elapsed+=this._delta),this}}function DOe(){this._document.hidden===!1&&this.reset()}class OOe{constructor(e=1,i=0,r=0){this.radius=e,this.phi=i,this.theta=r}set(e,i,r){return this.radius=e,this.phi=i,this.theta=r,this}copy(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this}makeSafe(){return this.phi=Fi(this.phi,1e-6,Math.PI-1e-6),this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,i,r){return this.radius=Math.sqrt(e*e+i*i+r*r),this.radius===0?(this.theta=0,this.phi=0):(this.theta=Math.atan2(e,r),this.phi=Math.acos(Fi(i/this.radius,-1,1))),this}clone(){return new this.constructor().copy(this)}}class LOe{constructor(e=1,i=0,r=0){this.radius=e,this.theta=i,this.y=r}set(e,i,r){return this.radius=e,this.theta=i,this.y=r,this}copy(e){return this.radius=e.radius,this.theta=e.theta,this.y=e.y,this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,i,r){return this.radius=Math.sqrt(e*e+r*r),this.theta=Math.atan2(e,r),this.y=i,this}clone(){return new this.constructor().copy(this)}}class SH{constructor(e,i,r,n){SH.prototype.isMatrix2=!0,this.elements=[1,0,0,1],e!==void 0&&this.set(e,i,r,n)}identity(){return this.set(1,0,0,1),this}fromArray(e,i=0){for(let r=0;r<4;r++)this.elements[r]=e[r+i];return this}set(e,i,r,n){const s=this.elements;return s[0]=e,s[2]=i,s[1]=r,s[3]=n,this}}const nY=new At;class kOe{constructor(e=new At(1/0,1/0),i=new At(-1/0,-1/0)){this.isBox2=!0,this.min=e,this.max=i}set(e,i){return this.min.copy(e),this.max.copy(i),this}setFromPoints(e){this.makeEmpty();for(let i=0,r=e.length;i<r;i++)this.expandByPoint(e[i]);return this}setFromCenterAndSize(e,i){const r=nY.copy(i).multiplyScalar(.5);return this.min.copy(e).sub(r),this.max.copy(e).add(r),this}clone(){return new this.constructor().copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y}getCenter(e){return this.isEmpty()?e.set(0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}containsPoint(e){return e.x>=this.min.x&&e.x<=this.max.x&&e.y>=this.min.y&&e.y<=this.max.y}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y}getParameter(e,i){return i.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y))}intersectsBox(e){return e.max.x>=this.min.x&&e.min.x<=this.max.x&&e.max.y>=this.min.y&&e.min.y<=this.max.y}clampPoint(e,i){return i.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return this.clampPoint(e,nY).distanceTo(e)}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}const sY=new be,$2=new be,Cb=new be,Pb=new be,WU=new be,NOe=new be,UOe=new be;class BOe{constructor(e=new be,i=new be){this.start=e,this.end=i}set(e,i){return this.start.copy(e),this.end.copy(i),this}copy(e){return this.start.copy(e.start),this.end.copy(e.end),this}getCenter(e){return e.addVectors(this.start,this.end).multiplyScalar(.5)}delta(e){return e.subVectors(this.end,this.start)}distanceSq(){return this.start.distanceToSquared(this.end)}distance(){return this.start.distanceTo(this.end)}at(e,i){return this.delta(i).multiplyScalar(e).add(this.start)}closestPointToPointParameter(e,i){sY.subVectors(e,this.start),$2.subVectors(this.end,this.start);const r=$2.dot($2);let s=$2.dot(sY)/r;return i&&(s=Fi(s,0,1)),s}closestPointToPoint(e,i,r){const n=this.closestPointToPointParameter(e,i);return this.delta(r).multiplyScalar(n).add(this.start)}distanceSqToLine3(e,i=NOe,r=UOe){const n=10000000000000001e-32;let s,a;const o=this.start,l=e.start,c=this.end,u=e.end;Cb.subVectors(c,o),Pb.subVectors(u,l),WU.subVectors(o,l);const h=Cb.dot(Cb),d=Pb.dot(Pb),f=Pb.dot(WU);if(h<=n&&d<=n)return i.copy(o),r.copy(l),i.sub(r),i.dot(i);if(h<=n)s=0,a=f/d,a=Fi(a,0,1);else{const p=Cb.dot(WU);if(d<=n)a=0,s=Fi(-p/h,0,1);else{const g=Cb.dot(Pb),m=h*d-g*g;m!==0?s=Fi((g*f-p*d)/m,0,1):s=0,a=(g*s+f)/d,a<0?(a=0,s=Fi(-p/h,0,1)):a>1&&(a=1,s=Fi((g-p)/h,0,1))}}return i.copy(o).add(Cb.multiplyScalar(s)),r.copy(l).add(Pb.multiplyScalar(a)),i.sub(r),i.dot(i)}applyMatrix4(e){return this.start.applyMatrix4(e),this.end.applyMatrix4(e),this}equals(e){return e.start.equals(this.start)&&e.end.equals(this.end)}clone(){return new this.constructor().copy(this)}}const aY=new be;class FOe extends Br{constructor(e,i){super(),this.light=e,this.matrixAutoUpdate=!1,this.color=i,this.type="SpotLightHelper";const r=new dr,n=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1];for(let a=0,o=1,l=32;a<l;a++,o++){const c=a/l*Math.PI*2,u=o/l*Math.PI*2;n.push(Math.cos(c),Math.sin(c),1,Math.cos(u),Math.sin(u),1)}r.setAttribute("position",new hi(n,3));const s=new Sl({fog:!1,toneMapped:!1});this.cone=new of(r,s),this.add(this.cone),this.update()}dispose(){this.cone.geometry.dispose(),this.cone.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1),this.parent?(this.parent.updateWorldMatrix(!0),this.matrix.copy(this.parent.matrixWorld).invert().multiply(this.light.matrixWorld)):this.matrix.copy(this.light.matrixWorld),this.matrixWorld.copy(this.light.matrixWorld);const e=this.light.distance?this.light.distance:1e3,i=e*Math.tan(this.light.angle);this.cone.scale.set(i,i,e),aY.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(aY),this.color!==void 0?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)}}const Hm=new be,Y2=new zi,qU=new zi;class zOe extends of{constructor(e){const i=Vle(e),r=new dr,n=[],s=[];for(let c=0;c<i.length;c++){const u=i[c];u.parent&&u.parent.isBone&&(n.push(0,0,0),n.push(0,0,0),s.push(0,0,0),s.push(0,0,0))}r.setAttribute("position",new hi(n,3)),r.setAttribute("color",new hi(s,3));const a=new Sl({vertexColors:!0,depthTest:!1,depthWrite:!1,toneMapped:!1,transparent:!0});super(r,a),this.isSkeletonHelper=!0,this.type="SkeletonHelper",this.root=e,this.bones=i,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1;const o=new ii(255),l=new ii(65280);this.setColors(o,l)}updateMatrixWorld(e){const i=this.bones,r=this.geometry,n=r.getAttribute("position");qU.copy(this.root.matrixWorld).invert();for(let s=0,a=0;s<i.length;s++){const o=i[s];o.parent&&o.parent.isBone&&(Y2.multiplyMatrices(qU,o.matrixWorld),Hm.setFromMatrixPosition(Y2),n.setXYZ(a,Hm.x,Hm.y,Hm.z),Y2.multiplyMatrices(qU,o.parent.matrixWorld),Hm.setFromMatrixPosition(Y2),n.setXYZ(a+1,Hm.x,Hm.y,Hm.z),a+=2)}r.getAttribute("position").needsUpdate=!0,super.updateMatrixWorld(e)}setColors(e,i){const n=this.geometry.getAttribute("color");for(let s=0;s<n.count;s+=2)n.setXYZ(s,e.r,e.g,e.b),n.setXYZ(s+1,i.r,i.g,i.b);return n.needsUpdate=!0,this}dispose(){this.geometry.dispose(),this.material.dispose()}}function Vle(t){const e=[];t.isBone===!0&&e.push(t);for(let i=0;i<t.children.length;i++)e.push(...Vle(t.children[i]));return e}class jOe extends js{constructor(e,i,r){const n=new ST(i,4,2),s=new uv({wireframe:!0,fog:!1,toneMapped:!1});super(n,s),this.light=e,this.color=r,this.type="PointLightHelper",this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}dispose(){this.geometry.dispose(),this.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.color!==void 0?this.material.color.set(this.color):this.material.color.copy(this.light.color)}}const VOe=new be,oY=new ii,lY=new ii;class HOe extends Br{constructor(e,i,r){super(),this.light=e,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=r,this.type="HemisphereLightHelper";const n=new _T(i);n.rotateY(Math.PI*.5),this.material=new uv({wireframe:!0,fog:!1,toneMapped:!1}),this.color===void 0&&(this.material.vertexColors=!0);const s=n.getAttribute("position"),a=new Float32Array(s.count*3);n.setAttribute("color",new xn(a,3)),this.add(new js(n,this.material)),this.update()}dispose(){this.children[0].geometry.dispose(),this.children[0].material.dispose()}update(){const e=this.children[0];if(this.color!==void 0)this.material.color.set(this.color);else{const i=e.geometry.getAttribute("color");oY.copy(this.light.color),lY.copy(this.light.groundColor);for(let r=0,n=i.count;r<n;r++){const s=r<n/2?oY:lY;i.setXYZ(r,s.r,s.g,s.b)}i.needsUpdate=!0}this.light.updateWorldMatrix(!0,!1),e.lookAt(VOe.setFromMatrixPosition(this.light.matrixWorld).negate())}}class GOe extends of{constructor(e=10,i=10,r=4473924,n=8947848){r=new ii(r),n=new ii(n);const s=i/2,a=e/i,o=e/2,l=[],c=[];for(let d=0,f=0,p=-o;d<=i;d++,p+=a){l.push(-o,0,p,o,0,p),l.push(p,0,-o,p,0,o);const g=d===s?r:n;g.toArray(c,f),f+=3,g.toArray(c,f),f+=3,g.toArray(c,f),f+=3,g.toArray(c,f),f+=3}const u=new dr;u.setAttribute("position",new hi(l,3)),u.setAttribute("color",new hi(c,3));const h=new Sl({vertexColors:!0,toneMapped:!1});super(u,h),this.type="GridHelper"}dispose(){this.geometry.dispose(),this.material.dispose()}}class WOe extends of{constructor(e=10,i=16,r=8,n=64,s=4473924,a=8947848){s=new ii(s),a=new ii(a);const o=[],l=[];if(i>1)for(let h=0;h<i;h++){const d=h/i*(Math.PI*2),f=Math.sin(d)*e,p=Math.cos(d)*e;o.push(0,0,0),o.push(f,0,p);const g=h&1?s:a;l.push(g.r,g.g,g.b),l.push(g.r,g.g,g.b)}for(let h=0;h<r;h++){const d=h&1?s:a,f=e-e/r*h;for(let p=0;p<n;p++){let g=p/n*(Math.PI*2),m=Math.sin(g)*f,y=Math.cos(g)*f;o.push(m,0,y),l.push(d.r,d.g,d.b),g=(p+1)/n*(Math.PI*2),m=Math.sin(g)*f,y=Math.cos(g)*f,o.push(m,0,y),l.push(d.r,d.g,d.b)}}const c=new dr;c.setAttribute("position",new hi(o,3)),c.setAttribute("color",new hi(l,3));const u=new Sl({vertexColors:!0,toneMapped:!1});super(c,u),this.type="PolarGridHelper"}dispose(){this.geometry.dispose(),this.material.dispose()}}const cY=new be,K2=new be,uY=new be;class qOe extends Br{constructor(e,i,r){super(),this.light=e,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=r,this.type="DirectionalLightHelper",i===void 0&&(i=1);let n=new dr;n.setAttribute("position",new hi([-i,i,0,i,i,0,i,-i,0,-i,-i,0,-i,i,0],3));const s=new Sl({fog:!1,toneMapped:!1});this.lightPlane=new ev(n,s),this.add(this.lightPlane),n=new dr,n.setAttribute("position",new hi([0,0,0,0,0,1],3)),this.targetLine=new ev(n,s),this.add(this.targetLine),this.update()}dispose(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1),cY.setFromMatrixPosition(this.light.matrixWorld),K2.setFromMatrixPosition(this.light.target.matrixWorld),uY.subVectors(K2,cY),this.lightPlane.lookAt(K2),this.color!==void 0?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(K2),this.targetLine.scale.z=uY.length()}}const Z2=new be,es=new yT;class XOe extends of{constructor(e){const i=new dr,r=new Sl({color:16777215,vertexColors:!0,toneMapped:!1}),n=[],s=[],a={};o("n1","n2"),o("n2","n4"),o("n4","n3"),o("n3","n1"),o("f1","f2"),o("f2","f4"),o("f4","f3"),o("f3","f1"),o("n1","f1"),o("n2","f2"),o("n3","f3"),o("n4","f4"),o("p","n1"),o("p","n2"),o("p","n3"),o("p","n4"),o("u1","u2"),o("u2","u3"),o("u3","u1"),o("c","t"),o("p","c"),o("cn1","cn2"),o("cn3","cn4"),o("cf1","cf2"),o("cf3","cf4");function o(p,g){l(p),l(g)}function l(p){n.push(0,0,0),s.push(0,0,0),a[p]===void 0&&(a[p]=[]),a[p].push(n.length/3-1)}i.setAttribute("position",new hi(n,3)),i.setAttribute("color",new hi(s,3)),super(i,r),this.type="CameraHelper",this.camera=e,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=a,this.update();const c=new ii(16755200),u=new ii(16711680),h=new ii(43775),d=new ii(16777215),f=new ii(3355443);this.setColors(c,u,h,d,f)}setColors(e,i,r,n,s){const o=this.geometry.getAttribute("color");return o.setXYZ(0,e.r,e.g,e.b),o.setXYZ(1,e.r,e.g,e.b),o.setXYZ(2,e.r,e.g,e.b),o.setXYZ(3,e.r,e.g,e.b),o.setXYZ(4,e.r,e.g,e.b),o.setXYZ(5,e.r,e.g,e.b),o.setXYZ(6,e.r,e.g,e.b),o.setXYZ(7,e.r,e.g,e.b),o.setXYZ(8,e.r,e.g,e.b),o.setXYZ(9,e.r,e.g,e.b),o.setXYZ(10,e.r,e.g,e.b),o.setXYZ(11,e.r,e.g,e.b),o.setXYZ(12,e.r,e.g,e.b),o.setXYZ(13,e.r,e.g,e.b),o.setXYZ(14,e.r,e.g,e.b),o.setXYZ(15,e.r,e.g,e.b),o.setXYZ(16,e.r,e.g,e.b),o.setXYZ(17,e.r,e.g,e.b),o.setXYZ(18,e.r,e.g,e.b),o.setXYZ(19,e.r,e.g,e.b),o.setXYZ(20,e.r,e.g,e.b),o.setXYZ(21,e.r,e.g,e.b),o.setXYZ(22,e.r,e.g,e.b),o.setXYZ(23,e.r,e.g,e.b),o.setXYZ(24,i.r,i.g,i.b),o.setXYZ(25,i.r,i.g,i.b),o.setXYZ(26,i.r,i.g,i.b),o.setXYZ(27,i.r,i.g,i.b),o.setXYZ(28,i.r,i.g,i.b),o.setXYZ(29,i.r,i.g,i.b),o.setXYZ(30,i.r,i.g,i.b),o.setXYZ(31,i.r,i.g,i.b),o.setXYZ(32,r.r,r.g,r.b),o.setXYZ(33,r.r,r.g,r.b),o.setXYZ(34,r.r,r.g,r.b),o.setXYZ(35,r.r,r.g,r.b),o.setXYZ(36,r.r,r.g,r.b),o.setXYZ(37,r.r,r.g,r.b),o.setXYZ(38,n.r,n.g,n.b),o.setXYZ(39,n.r,n.g,n.b),o.setXYZ(40,s.r,s.g,s.b),o.setXYZ(41,s.r,s.g,s.b),o.setXYZ(42,s.r,s.g,s.b),o.setXYZ(43,s.r,s.g,s.b),o.setXYZ(44,s.r,s.g,s.b),o.setXYZ(45,s.r,s.g,s.b),o.setXYZ(46,s.r,s.g,s.b),o.setXYZ(47,s.r,s.g,s.b),o.setXYZ(48,s.r,s.g,s.b),o.setXYZ(49,s.r,s.g,s.b),o.needsUpdate=!0,this}update(){const e=this.geometry,i=this.pointMap,r=1,n=1;let s,a;if(es.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse),this.camera.reversedDepth===!0)s=1,a=0;else if(this.camera.coordinateSystem===Cc)s=-1,a=1;else if(this.camera.coordinateSystem===L1)s=0,a=1;else throw new Error("THREE.CameraHelper.update(): Invalid coordinate system: "+this.camera.coordinateSystem);ps("c",i,e,es,0,0,s),ps("t",i,e,es,0,0,a),ps("n1",i,e,es,-r,-n,s),ps("n2",i,e,es,r,-n,s),ps("n3",i,e,es,-r,n,s),ps("n4",i,e,es,r,n,s),ps("f1",i,e,es,-r,-n,a),ps("f2",i,e,es,r,-n,a),ps("f3",i,e,es,-r,n,a),ps("f4",i,e,es,r,n,a),ps("u1",i,e,es,r*.7,n*1.1,s),ps("u2",i,e,es,-r*.7,n*1.1,s),ps("u3",i,e,es,0,n*2,s),ps("cf1",i,e,es,-r,0,a),ps("cf2",i,e,es,r,0,a),ps("cf3",i,e,es,0,-n,a),ps("cf4",i,e,es,0,n,a),ps("cn1",i,e,es,-r,0,s),ps("cn2",i,e,es,r,0,s),ps("cn3",i,e,es,0,-n,s),ps("cn4",i,e,es,0,n,s),e.getAttribute("position").needsUpdate=!0}dispose(){this.geometry.dispose(),this.material.dispose()}}function ps(t,e,i,r,n,s,a){Z2.set(n,s,a).unproject(r);const o=e[t];if(o!==void 0){const l=i.getAttribute("position");for(let c=0,u=o.length;c<u;c++)l.setXYZ(o[c],Z2.x,Z2.y,Z2.z)}}const Q2=new Vo;class $Oe extends of{constructor(e,i=16776960){const r=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),n=new Float32Array(24),s=new dr;s.setIndex(new xn(r,1)),s.setAttribute("position",new xn(n,3)),super(s,new Sl({color:i,toneMapped:!1})),this.object=e,this.type="BoxHelper",this.matrixAutoUpdate=!1,this.update()}update(){if(this.object!==void 0&&Q2.setFromObject(this.object),Q2.isEmpty())return;const e=Q2.min,i=Q2.max,r=this.geometry.attributes.position,n=r.array;n[0]=i.x,n[1]=i.y,n[2]=i.z,n[3]=e.x,n[4]=i.y,n[5]=i.z,n[6]=e.x,n[7]=e.y,n[8]=i.z,n[9]=i.x,n[10]=e.y,n[11]=i.z,n[12]=i.x,n[13]=i.y,n[14]=e.z,n[15]=e.x,n[16]=i.y,n[17]=e.z,n[18]=e.x,n[19]=e.y,n[20]=e.z,n[21]=i.x,n[22]=e.y,n[23]=e.z,r.needsUpdate=!0,this.geometry.computeBoundingSphere()}setFromObject(e){return this.object=e,this.update(),this}copy(e,i){return super.copy(e,i),this.object=e.object,this}dispose(){this.geometry.dispose(),this.material.dispose()}}class YOe extends of{constructor(e,i=16776960){const r=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),n=[1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],s=new dr;s.setIndex(new xn(r,1)),s.setAttribute("position",new hi(n,3)),super(s,new Sl({color:i,toneMapped:!1})),this.box=e,this.type="Box3Helper",this.geometry.computeBoundingSphere()}updateMatrixWorld(e){const i=this.box;i.isEmpty()||(i.getCenter(this.position),i.getSize(this.scale),this.scale.multiplyScalar(.5),super.updateMatrixWorld(e))}dispose(){this.geometry.dispose(),this.material.dispose()}}class KOe extends ev{constructor(e,i=1,r=16776960){const n=r,s=[1,-1,0,-1,1,0,-1,-1,0,1,1,0,-1,1,0,-1,-1,0,1,-1,0,1,1,0],a=new dr;a.setAttribute("position",new hi(s,3)),a.computeBoundingSphere(),super(a,new Sl({color:n,toneMapped:!1})),this.type="PlaneHelper",this.plane=e,this.size=i;const o=[1,1,0,-1,1,0,-1,-1,0,1,1,0,-1,-1,0,1,-1,0],l=new dr;l.setAttribute("position",new hi(o,3)),l.computeBoundingSphere(),this.add(new js(l,new uv({color:n,opacity:.2,transparent:!0,depthWrite:!1,toneMapped:!1})))}updateMatrixWorld(e){this.position.set(0,0,0),this.scale.set(.5*this.size,.5*this.size,1),this.lookAt(this.plane.normal),this.translateZ(-this.plane.constant),super.updateMatrixWorld(e)}dispose(){this.geometry.dispose(),this.material.dispose(),this.children[0].geometry.dispose(),this.children[0].material.dispose()}}const hY=new be;let J2,XU;class ZOe extends Br{constructor(e=new be(0,0,1),i=new be(0,0,0),r=1,n=16776960,s=r*.2,a=s*.2){super(),this.type="ArrowHelper",J2===void 0&&(J2=new dr,J2.setAttribute("position",new hi([0,0,0,0,1,0],3)),XU=new wT(.5,1,5,1),XU.translate(0,-.5,0)),this.position.copy(i),this.line=new ev(J2,new Sl({color:n,toneMapped:!1})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new js(XU,new uv({color:n,toneMapped:!1})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(e),this.setLength(r,s,a)}setDirection(e){if(e.y>.99999)this.quaternion.set(0,0,0,1);else if(e.y<-.99999)this.quaternion.set(1,0,0,0);else{hY.set(e.z,0,-e.x).normalize();const i=Math.acos(e.y);this.quaternion.setFromAxisAngle(hY,i)}}setLength(e,i=e*.2,r=i*.2){this.line.scale.set(1,Math.max(1e-4,e-i),1),this.line.updateMatrix(),this.cone.scale.set(r,i,r),this.cone.position.y=e,this.cone.updateMatrix()}setColor(e){this.line.material.color.set(e),this.cone.material.color.set(e)}copy(e){return super.copy(e,!1),this.line.copy(e.line),this.cone.copy(e.cone),this}dispose(){this.line.geometry.dispose(),this.line.material.dispose(),this.cone.geometry.dispose(),this.cone.material.dispose()}}class QOe extends of{constructor(e=1){const i=[0,0,0,e,0,0,0,0,0,0,e,0,0,0,0,0,0,e],r=[1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],n=new dr;n.setAttribute("position",new hi(i,3)),n.setAttribute("color",new hi(r,3));const s=new Sl({vertexColors:!0,toneMapped:!1});super(n,s),this.type="AxesHelper"}setColors(e,i,r){const n=new ii,s=this.geometry.attributes.color.array;return n.set(e),n.toArray(s,0),n.toArray(s,3),n.set(i),n.toArray(s,6),n.toArray(s,9),n.set(r),n.toArray(s,12),n.toArray(s,15),this.geometry.attributes.color.needsUpdate=!0,this}dispose(){this.geometry.dispose(),this.material.dispose()}}class JOe{constructor(){this.type="ShapePath",this.color=new ii,this.subPaths=[],this.currentPath=null}moveTo(e,i){return this.currentPath=new PD,this.subPaths.push(this.currentPath),this.currentPath.moveTo(e,i),this}lineTo(e,i){return this.currentPath.lineTo(e,i),this}quadraticCurveTo(e,i,r,n){return this.currentPath.quadraticCurveTo(e,i,r,n),this}bezierCurveTo(e,i,r,n,s,a){return this.currentPath.bezierCurveTo(e,i,r,n,s,a),this}splineThru(e){return this.currentPath.splineThru(e),this}toShapes(e){function i(y){const b=[];for(let w=0,E=y.length;w<E;w++){const M=y[w],A=new m0;A.curves=M.curves,b.push(A)}return b}function r(y,b){const w=b.length;let E=!1;for(let M=w-1,A=0;A<w;M=A++){let P=b[M],C=b[A],R=C.x-P.x,I=C.y-P.y;if(Math.abs(I)>Number.EPSILON){if(I<0&&(P=b[A],R=-R,C=b[M],I=-I),y.y<P.y||y.y>C.y)continue;if(y.y===P.y){if(y.x===P.x)return!0}else{const k=I*(y.x-P.x)-R*(y.y-P.y);if(k===0)return!0;if(k<0)continue;E=!E}}else{if(y.y!==P.y)continue;if(C.x<=y.x&&y.x<=P.x||P.x<=y.x&&y.x<=C.x)return!0}}return E}const n=xh.isClockWise,s=this.subPaths;if(s.length===0)return[];let a,o,l;const c=[];if(s.length===1)return o=s[0],l=new m0,l.curves=o.curves,c.push(l),c;let u=!n(s[0].getPoints());u=e?!u:u;const h=[],d=[];let f=[],p=0,g;d[p]=void 0,f[p]=[];for(let y=0,b=s.length;y<b;y++)o=s[y],g=o.getPoints(),a=n(g),a=e?!a:a,a?(!u&&d[p]&&p++,d[p]={s:new m0,p:g},d[p].s.curves=o.curves,u&&p++,f[p]=[]):f[p].push({h:o,p:g[0]});if(!d[0])return i(s);if(d.length>1){let y=!1,b=0;for(let w=0,E=d.length;w<E;w++)h[w]=[];for(let w=0,E=d.length;w<E;w++){const M=f[w];for(let A=0;A<M.length;A++){const P=M[A];let C=!0;for(let R=0;R<d.length;R++)r(P.p,d[R].p)&&(w!==R&&b++,C?(C=!1,h[R].push(P)):y=!0);C&&h[w].push(P)}}b>0&&y===!1&&(f=h)}let m;for(let y=0,b=d.length;y<b;y++){l=d[y].s,c.push(l),m=f[y];for(let w=0,E=m.length;w<E;w++)l.holes.push(m[w].h)}return c}}class eLe extends af{constructor(e,i=null){super(),this.object=e,this.domElement=i,this.enabled=!0,this.state=-1,this.keys={},this.mouseButtons={LEFT:null,MIDDLE:null,RIGHT:null},this.touches={ONE:null,TWO:null}}connect(e){if(e===void 0){console.warn("THREE.Controls: connect() now requires an element.");return}this.domElement!==null&&this.disconnect(),this.domElement=e}disconnect(){}dispose(){}update(){}}function tLe(t,e){const i=t.image&&t.image.width?t.image.width/t.image.height:1;return i>e?(t.repeat.x=1,t.repeat.y=i/e,t.offset.x=0,t.offset.y=(1-t.repeat.y)/2):(t.repeat.x=e/i,t.repeat.y=1,t.offset.x=(1-t.repeat.x)/2,t.offset.y=0),t}function iLe(t,e){const i=t.image&&t.image.width?t.image.width/t.image.height:1;return i>e?(t.repeat.x=e/i,t.repeat.y=1,t.offset.x=(1-t.repeat.x)/2,t.offset.y=0):(t.repeat.x=1,t.repeat.y=i/e,t.offset.x=0,t.offset.y=(1-t.repeat.y)/2),t}function rLe(t){return t.repeat.x=1,t.repeat.y=1,t.offset.x=0,t.offset.y=0,t}function tj(t,e,i,r){const n=nLe(r);switch(i){case V6:return t*e;case bO:return t*e/n.components*n.byteLength;case vT:return t*e/n.components*n.byteLength;case G6:return t*e*2/n.components*n.byteLength;case wO:return t*e*2/n.components*n.byteLength;case H6:return t*e*3/n.components*n.byteLength;case zo:return t*e*4/n.components*n.byteLength;case _O:return t*e*4/n.components*n.byteLength;case xA:case bA:return Math.floor((t+3)/4)*Math.floor((e+3)/4)*8;case wA:case _A:return Math.floor((t+3)/4)*Math.floor((e+3)/4)*16;case QI:case eD:return Math.max(t,16)*Math.max(e,8)/4;case ZI:case JI:return Math.max(t,8)*Math.max(e,8)/2;case tD:case iD:return Math.floor((t+3)/4)*Math.floor((e+3)/4)*8;case rD:return Math.floor((t+3)/4)*Math.floor((e+3)/4)*16;case nD:return Math.floor((t+3)/4)*Math.floor((e+3)/4)*16;case sD:return Math.floor((t+4)/5)*Math.floor((e+3)/4)*16;case aD:return Math.floor((t+4)/5)*Math.floor((e+4)/5)*16;case oD:return Math.floor((t+5)/6)*Math.floor((e+4)/5)*16;case lD:return Math.floor((t+5)/6)*Math.floor((e+5)/6)*16;case cD:return Math.floor((t+7)/8)*Math.floor((e+4)/5)*16;case uD:return Math.floor((t+7)/8)*Math.floor((e+5)/6)*16;case hD:return Math.floor((t+7)/8)*Math.floor((e+7)/8)*16;case dD:return Math.floor((t+9)/10)*Math.floor((e+4)/5)*16;case fD:return Math.floor((t+9)/10)*Math.floor((e+5)/6)*16;case pD:return Math.floor((t+9)/10)*Math.floor((e+7)/8)*16;case mD:return Math.floor((t+9)/10)*Math.floor((e+9)/10)*16;case gD:return Math.floor((t+11)/12)*Math.floor((e+9)/10)*16;case vD:return Math.floor((t+11)/12)*Math.floor((e+11)/12)*16;case yD:case xD:case bD:return Math.ceil(t/4)*Math.ceil(e/4)*16;case wD:case _D:return Math.ceil(t/4)*Math.ceil(e/4)*8;case SD:case ED:return Math.ceil(t/4)*Math.ceil(e/4)*16}throw new Error(`Unable to determine texture byte length for ${i} format.`)}function nLe(t){switch(t){case _u:case B6:return{byteLength:1,components:1};case R1:case F6:case m_:return{byteLength:2,components:1};case yO:case xO:return{byteLength:2,components:4};case jp:case vO:case tc:return{byteLength:4,components:1};case z6:case j6:return{byteLength:4,components:3}}throw new Error(`Unknown texture type ${t}.`)}class sLe{static contain(e,i){return tLe(e,i)}static cover(e,i){return iLe(e,i)}static fill(e){return rLe(e)}static getByteLength(e,i,r,n){return tj(e,i,r,n)}}typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:mT}}));typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=mT);/**
 * @license
 * Copyright 2010-2025 Three.js Authors
 * SPDX-License-Identifier: MIT
 */function Hle(){let t=null,e=!1,i=null,r=null;function n(s,a){i(s,a),r=t.requestAnimationFrame(n)}return{start:function(){e!==!0&&i!==null&&(r=t.requestAnimationFrame(n),e=!0)},stop:function(){t.cancelAnimationFrame(r),e=!1},setAnimationLoop:function(s){i=s},setContext:function(s){t=s}}}function aLe(t){const e=new WeakMap;function i(o,l){const c=o.array,u=o.usage,h=c.byteLength,d=t.createBuffer();t.bindBuffer(l,d),t.bufferData(l,c,u),o.onUploadCallback();let f;if(c instanceof Float32Array)f=t.FLOAT;else if(typeof Float16Array<"u"&&c instanceof Float16Array)f=t.HALF_FLOAT;else if(c instanceof Uint16Array)o.isFloat16BufferAttribute?f=t.HALF_FLOAT:f=t.UNSIGNED_SHORT;else if(c instanceof Int16Array)f=t.SHORT;else if(c instanceof Uint32Array)f=t.UNSIGNED_INT;else if(c instanceof Int32Array)f=t.INT;else if(c instanceof Int8Array)f=t.BYTE;else if(c instanceof Uint8Array)f=t.UNSIGNED_BYTE;else if(c instanceof Uint8ClampedArray)f=t.UNSIGNED_BYTE;else throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+c);return{buffer:d,type:f,bytesPerElement:c.BYTES_PER_ELEMENT,version:o.version,size:h}}function r(o,l,c){const u=l.array,h=l.updateRanges;if(t.bindBuffer(c,o),h.length===0)t.bufferSubData(c,0,u);else{h.sort((f,p)=>f.start-p.start);let d=0;for(let f=1;f<h.length;f++){const p=h[d],g=h[f];g.start<=p.start+p.count+1?p.count=Math.max(p.count,g.start+g.count-p.start):(++d,h[d]=g)}h.length=d+1;for(let f=0,p=h.length;f<p;f++){const g=h[f];t.bufferSubData(c,g.start*u.BYTES_PER_ELEMENT,u,g.start,g.count)}l.clearUpdateRanges()}l.onUploadCallback()}function n(o){return o.isInterleavedBufferAttribute&&(o=o.data),e.get(o)}function s(o){o.isInterleavedBufferAttribute&&(o=o.data);const l=e.get(o);l&&(t.deleteBuffer(l.buffer),e.delete(o))}function a(o,l){if(o.isInterleavedBufferAttribute&&(o=o.data),o.isGLBufferAttribute){const u=e.get(o);(!u||u.version<o.version)&&e.set(o,{buffer:o.buffer,type:o.type,bytesPerElement:o.elementSize,version:o.version});return}const c=e.get(o);if(c===void 0)e.set(o,i(o,l));else if(c.version<o.version){if(c.size!==o.array.byteLength)throw new Error("THREE.WebGLAttributes: The size of the buffer attribute's array buffer does not match the original size. Resizing buffer attributes is not supported.");r(c.buffer,o,l),c.version=o.version}}return{get:n,remove:s,update:a}}var oLe=`#ifdef USE_ALPHAHASH
	if ( diffuseColor.a < getAlphaHashThreshold( vPosition ) ) discard;
#endif`,lLe=`#ifdef USE_ALPHAHASH
	const float ALPHA_HASH_SCALE = 0.05;
	float hash2D( vec2 value ) {
		return fract( 1.0e4 * sin( 17.0 * value.x + 0.1 * value.y ) * ( 0.1 + abs( sin( 13.0 * value.y + value.x ) ) ) );
	}
	float hash3D( vec3 value ) {
		return hash2D( vec2( hash2D( value.xy ), value.z ) );
	}
	float getAlphaHashThreshold( vec3 position ) {
		float maxDeriv = max(
			length( dFdx( position.xyz ) ),
			length( dFdy( position.xyz ) )
		);
		float pixScale = 1.0 / ( ALPHA_HASH_SCALE * maxDeriv );
		vec2 pixScales = vec2(
			exp2( floor( log2( pixScale ) ) ),
			exp2( ceil( log2( pixScale ) ) )
		);
		vec2 alpha = vec2(
			hash3D( floor( pixScales.x * position.xyz ) ),
			hash3D( floor( pixScales.y * position.xyz ) )
		);
		float lerpFactor = fract( log2( pixScale ) );
		float x = ( 1.0 - lerpFactor ) * alpha.x + lerpFactor * alpha.y;
		float a = min( lerpFactor, 1.0 - lerpFactor );
		vec3 cases = vec3(
			x * x / ( 2.0 * a * ( 1.0 - a ) ),
			( x - 0.5 * a ) / ( 1.0 - a ),
			1.0 - ( ( 1.0 - x ) * ( 1.0 - x ) / ( 2.0 * a * ( 1.0 - a ) ) )
		);
		float threshold = ( x < ( 1.0 - a ) )
			? ( ( x < a ) ? cases.x : cases.y )
			: cases.z;
		return clamp( threshold , 1.0e-6, 1.0 );
	}
#endif`,cLe=`#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, vAlphaMapUv ).g;
#endif`,uLe=`#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,hLe=`#ifdef USE_ALPHATEST
	#ifdef ALPHA_TO_COVERAGE
	diffuseColor.a = smoothstep( alphaTest, alphaTest + fwidth( diffuseColor.a ), diffuseColor.a );
	if ( diffuseColor.a == 0.0 ) discard;
	#else
	if ( diffuseColor.a < alphaTest ) discard;
	#endif
#endif`,dLe=`#ifdef USE_ALPHATEST
	uniform float alphaTest;
#endif`,fLe=`#ifdef USE_AOMAP
	float ambientOcclusion = ( texture2D( aoMap, vAoMapUv ).r - 1.0 ) * aoMapIntensity + 1.0;
	reflectedLight.indirectDiffuse *= ambientOcclusion;
	#if defined( USE_CLEARCOAT ) 
		clearcoatSpecularIndirect *= ambientOcclusion;
	#endif
	#if defined( USE_SHEEN ) 
		sheenSpecularIndirect *= ambientOcclusion;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD )
		float dotNV = saturate( dot( geometryNormal, geometryViewDir ) );
		reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );
	#endif
#endif`,pLe=`#ifdef USE_AOMAP
	uniform sampler2D aoMap;
	uniform float aoMapIntensity;
#endif`,mLe=`#ifdef USE_BATCHING
	#if ! defined( GL_ANGLE_multi_draw )
	#define gl_DrawID _gl_DrawID
	uniform int _gl_DrawID;
	#endif
	uniform highp sampler2D batchingTexture;
	uniform highp usampler2D batchingIdTexture;
	mat4 getBatchingMatrix( const in float i ) {
		int size = textureSize( batchingTexture, 0 ).x;
		int j = int( i ) * 4;
		int x = j % size;
		int y = j / size;
		vec4 v1 = texelFetch( batchingTexture, ivec2( x, y ), 0 );
		vec4 v2 = texelFetch( batchingTexture, ivec2( x + 1, y ), 0 );
		vec4 v3 = texelFetch( batchingTexture, ivec2( x + 2, y ), 0 );
		vec4 v4 = texelFetch( batchingTexture, ivec2( x + 3, y ), 0 );
		return mat4( v1, v2, v3, v4 );
	}
	float getIndirectIndex( const in int i ) {
		int size = textureSize( batchingIdTexture, 0 ).x;
		int x = i % size;
		int y = i / size;
		return float( texelFetch( batchingIdTexture, ivec2( x, y ), 0 ).r );
	}
#endif
#ifdef USE_BATCHING_COLOR
	uniform sampler2D batchingColorTexture;
	vec3 getBatchingColor( const in float i ) {
		int size = textureSize( batchingColorTexture, 0 ).x;
		int j = int( i );
		int x = j % size;
		int y = j / size;
		return texelFetch( batchingColorTexture, ivec2( x, y ), 0 ).rgb;
	}
#endif`,gLe=`#ifdef USE_BATCHING
	mat4 batchingMatrix = getBatchingMatrix( getIndirectIndex( gl_DrawID ) );
#endif`,vLe=`vec3 transformed = vec3( position );
#ifdef USE_ALPHAHASH
	vPosition = vec3( position );
#endif`,yLe=`vec3 objectNormal = vec3( normal );
#ifdef USE_TANGENT
	vec3 objectTangent = vec3( tangent.xyz );
#endif`,xLe=`float G_BlinnPhong_Implicit( ) {
	return 0.25;
}
float D_BlinnPhong( const in float shininess, const in float dotNH ) {
	return RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );
}
vec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( specularColor, 1.0, dotVH );
	float G = G_BlinnPhong_Implicit( );
	float D = D_BlinnPhong( shininess, dotNH );
	return F * ( G * D );
} // validated`,bLe=`#ifdef USE_IRIDESCENCE
	const mat3 XYZ_TO_REC709 = mat3(
		 3.2404542, -0.9692660,  0.0556434,
		-1.5371385,  1.8760108, -0.2040259,
		-0.4985314,  0.0415560,  1.0572252
	);
	vec3 Fresnel0ToIor( vec3 fresnel0 ) {
		vec3 sqrtF0 = sqrt( fresnel0 );
		return ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );
	}
	vec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );
	}
	float IorToFresnel0( float transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));
	}
	vec3 evalSensitivity( float OPD, vec3 shift ) {
		float phase = 2.0 * PI * OPD * 1.0e-9;
		vec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );
		vec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );
		vec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );
		vec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );
		xyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );
		xyz /= 1.0685e-7;
		vec3 rgb = XYZ_TO_REC709 * xyz;
		return rgb;
	}
	vec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {
		vec3 I;
		float iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );
		float sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );
		float cosTheta2Sq = 1.0 - sinTheta2Sq;
		if ( cosTheta2Sq < 0.0 ) {
			return vec3( 1.0 );
		}
		float cosTheta2 = sqrt( cosTheta2Sq );
		float R0 = IorToFresnel0( iridescenceIOR, outsideIOR );
		float R12 = F_Schlick( R0, 1.0, cosTheta1 );
		float T121 = 1.0 - R12;
		float phi12 = 0.0;
		if ( iridescenceIOR < outsideIOR ) phi12 = PI;
		float phi21 = PI - phi12;
		vec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );		vec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );
		vec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );
		vec3 phi23 = vec3( 0.0 );
		if ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;
		if ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;
		if ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;
		float OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;
		vec3 phi = vec3( phi21 ) + phi23;
		vec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );
		vec3 r123 = sqrt( R123 );
		vec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );
		vec3 C0 = R12 + Rs;
		I = C0;
		vec3 Cm = Rs - T121;
		for ( int m = 1; m <= 2; ++ m ) {
			Cm *= r123;
			vec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );
			I += Cm * Sm;
		}
		return max( I, vec3( 0.0 ) );
	}
#endif`,wLe=`#ifdef USE_BUMPMAP
	uniform sampler2D bumpMap;
	uniform float bumpScale;
	vec2 dHdxy_fwd() {
		vec2 dSTdx = dFdx( vBumpMapUv );
		vec2 dSTdy = dFdy( vBumpMapUv );
		float Hll = bumpScale * texture2D( bumpMap, vBumpMapUv ).x;
		float dBx = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdx ).x - Hll;
		float dBy = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdy ).x - Hll;
		return vec2( dBx, dBy );
	}
	vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {
		vec3 vSigmaX = normalize( dFdx( surf_pos.xyz ) );
		vec3 vSigmaY = normalize( dFdy( surf_pos.xyz ) );
		vec3 vN = surf_norm;
		vec3 R1 = cross( vSigmaY, vN );
		vec3 R2 = cross( vN, vSigmaX );
		float fDet = dot( vSigmaX, R1 ) * faceDirection;
		vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );
		return normalize( abs( fDet ) * surf_norm - vGrad );
	}
#endif`,_Le=`#if NUM_CLIPPING_PLANES > 0
	vec4 plane;
	#ifdef ALPHA_TO_COVERAGE
		float distanceToPlane, distanceGradient;
		float clipOpacity = 1.0;
		#pragma unroll_loop_start
		for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			distanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;
			distanceGradient = fwidth( distanceToPlane ) / 2.0;
			clipOpacity *= smoothstep( - distanceGradient, distanceGradient, distanceToPlane );
			if ( clipOpacity == 0.0 ) discard;
		}
		#pragma unroll_loop_end
		#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
			float unionClipOpacity = 1.0;
			#pragma unroll_loop_start
			for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
				plane = clippingPlanes[ i ];
				distanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;
				distanceGradient = fwidth( distanceToPlane ) / 2.0;
				unionClipOpacity *= 1.0 - smoothstep( - distanceGradient, distanceGradient, distanceToPlane );
			}
			#pragma unroll_loop_end
			clipOpacity *= 1.0 - unionClipOpacity;
		#endif
		diffuseColor.a *= clipOpacity;
		if ( diffuseColor.a == 0.0 ) discard;
	#else
		#pragma unroll_loop_start
		for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			if ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;
		}
		#pragma unroll_loop_end
		#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
			bool clipped = true;
			#pragma unroll_loop_start
			for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
				plane = clippingPlanes[ i ];
				clipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;
			}
			#pragma unroll_loop_end
			if ( clipped ) discard;
		#endif
	#endif
#endif`,SLe=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
	uniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];
#endif`,ELe=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
#endif`,ALe=`#if NUM_CLIPPING_PLANES > 0
	vClipPosition = - mvPosition.xyz;
#endif`,MLe=`#if defined( USE_COLOR_ALPHA )
	diffuseColor *= vColor;
#elif defined( USE_COLOR )
	diffuseColor.rgb *= vColor;
#endif`,TLe=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR )
	varying vec3 vColor;
#endif`,CLe=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR ) || defined( USE_BATCHING_COLOR )
	varying vec3 vColor;
#endif`,PLe=`#if defined( USE_COLOR_ALPHA )
	vColor = vec4( 1.0 );
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR ) || defined( USE_BATCHING_COLOR )
	vColor = vec3( 1.0 );
#endif
#ifdef USE_COLOR
	vColor *= color;
#endif
#ifdef USE_INSTANCING_COLOR
	vColor.xyz *= instanceColor.xyz;
#endif
#ifdef USE_BATCHING_COLOR
	vec3 batchingColor = getBatchingColor( getIndirectIndex( gl_DrawID ) );
	vColor.xyz *= batchingColor.xyz;
#endif`,RLe=`#define PI 3.141592653589793
#define PI2 6.283185307179586
#define PI_HALF 1.5707963267948966
#define RECIPROCAL_PI 0.3183098861837907
#define RECIPROCAL_PI2 0.15915494309189535
#define EPSILON 1e-6
#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
#define whiteComplement( a ) ( 1.0 - saturate( a ) )
float pow2( const in float x ) { return x*x; }
vec3 pow2( const in vec3 x ) { return x*x; }
float pow3( const in float x ) { return x*x*x; }
float pow4( const in float x ) { float x2 = x*x; return x2*x2; }
float max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }
float average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }
highp float rand( const in vec2 uv ) {
	const highp float a = 12.9898, b = 78.233, c = 43758.5453;
	highp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );
	return fract( sin( sn ) * c );
}
#ifdef HIGH_PRECISION
	float precisionSafeLength( vec3 v ) { return length( v ); }
#else
	float precisionSafeLength( vec3 v ) {
		float maxComponent = max3( abs( v ) );
		return length( v / maxComponent ) * maxComponent;
	}
#endif
struct IncidentLight {
	vec3 color;
	vec3 direction;
	bool visible;
};
struct ReflectedLight {
	vec3 directDiffuse;
	vec3 directSpecular;
	vec3 indirectDiffuse;
	vec3 indirectSpecular;
};
#ifdef USE_ALPHAHASH
	varying vec3 vPosition;
#endif
vec3 transformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );
}
vec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );
}
mat3 transposeMat3( const in mat3 m ) {
	mat3 tmp;
	tmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );
	tmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );
	tmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );
	return tmp;
}
bool isPerspectiveMatrix( mat4 m ) {
	return m[ 2 ][ 3 ] == - 1.0;
}
vec2 equirectUv( in vec3 dir ) {
	float u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;
	float v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;
	return vec2( u, v );
}
vec3 BRDF_Lambert( const in vec3 diffuseColor ) {
	return RECIPROCAL_PI * diffuseColor;
}
vec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
}
float F_Schlick( const in float f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
} // validated`,ILe=`#ifdef ENVMAP_TYPE_CUBE_UV
	#define cubeUV_minMipLevel 4.0
	#define cubeUV_minTileSize 16.0
	float getFace( vec3 direction ) {
		vec3 absDirection = abs( direction );
		float face = - 1.0;
		if ( absDirection.x > absDirection.z ) {
			if ( absDirection.x > absDirection.y )
				face = direction.x > 0.0 ? 0.0 : 3.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		} else {
			if ( absDirection.z > absDirection.y )
				face = direction.z > 0.0 ? 2.0 : 5.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		}
		return face;
	}
	vec2 getUV( vec3 direction, float face ) {
		vec2 uv;
		if ( face == 0.0 ) {
			uv = vec2( direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 1.0 ) {
			uv = vec2( - direction.x, - direction.z ) / abs( direction.y );
		} else if ( face == 2.0 ) {
			uv = vec2( - direction.x, direction.y ) / abs( direction.z );
		} else if ( face == 3.0 ) {
			uv = vec2( - direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 4.0 ) {
			uv = vec2( - direction.x, direction.z ) / abs( direction.y );
		} else {
			uv = vec2( direction.x, direction.y ) / abs( direction.z );
		}
		return 0.5 * ( uv + 1.0 );
	}
	vec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {
		float face = getFace( direction );
		float filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );
		mipInt = max( mipInt, cubeUV_minMipLevel );
		float faceSize = exp2( mipInt );
		highp vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;
		if ( face > 2.0 ) {
			uv.y += faceSize;
			face -= 3.0;
		}
		uv.x += face * faceSize;
		uv.x += filterInt * 3.0 * cubeUV_minTileSize;
		uv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );
		uv.x *= CUBEUV_TEXEL_WIDTH;
		uv.y *= CUBEUV_TEXEL_HEIGHT;
		#ifdef texture2DGradEXT
			return texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;
		#else
			return texture2D( envMap, uv ).rgb;
		#endif
	}
	#define cubeUV_r0 1.0
	#define cubeUV_m0 - 2.0
	#define cubeUV_r1 0.8
	#define cubeUV_m1 - 1.0
	#define cubeUV_r4 0.4
	#define cubeUV_m4 2.0
	#define cubeUV_r5 0.305
	#define cubeUV_m5 3.0
	#define cubeUV_r6 0.21
	#define cubeUV_m6 4.0
	float roughnessToMip( float roughness ) {
		float mip = 0.0;
		if ( roughness >= cubeUV_r1 ) {
			mip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;
		} else if ( roughness >= cubeUV_r4 ) {
			mip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;
		} else if ( roughness >= cubeUV_r5 ) {
			mip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;
		} else if ( roughness >= cubeUV_r6 ) {
			mip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;
		} else {
			mip = - 2.0 * log2( 1.16 * roughness );		}
		return mip;
	}
	vec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {
		float mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );
		float mipF = fract( mip );
		float mipInt = floor( mip );
		vec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );
		if ( mipF == 0.0 ) {
			return vec4( color0, 1.0 );
		} else {
			vec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );
			return vec4( mix( color0, color1, mipF ), 1.0 );
		}
	}
#endif`,DLe=`vec3 transformedNormal = objectNormal;
#ifdef USE_TANGENT
	vec3 transformedTangent = objectTangent;
#endif
#ifdef USE_BATCHING
	mat3 bm = mat3( batchingMatrix );
	transformedNormal /= vec3( dot( bm[ 0 ], bm[ 0 ] ), dot( bm[ 1 ], bm[ 1 ] ), dot( bm[ 2 ], bm[ 2 ] ) );
	transformedNormal = bm * transformedNormal;
	#ifdef USE_TANGENT
		transformedTangent = bm * transformedTangent;
	#endif
#endif
#ifdef USE_INSTANCING
	mat3 im = mat3( instanceMatrix );
	transformedNormal /= vec3( dot( im[ 0 ], im[ 0 ] ), dot( im[ 1 ], im[ 1 ] ), dot( im[ 2 ], im[ 2 ] ) );
	transformedNormal = im * transformedNormal;
	#ifdef USE_TANGENT
		transformedTangent = im * transformedTangent;
	#endif
#endif
transformedNormal = normalMatrix * transformedNormal;
#ifdef FLIP_SIDED
	transformedNormal = - transformedNormal;
#endif
#ifdef USE_TANGENT
	transformedTangent = ( modelViewMatrix * vec4( transformedTangent, 0.0 ) ).xyz;
	#ifdef FLIP_SIDED
		transformedTangent = - transformedTangent;
	#endif
#endif`,OLe=`#ifdef USE_DISPLACEMENTMAP
	uniform sampler2D displacementMap;
	uniform float displacementScale;
	uniform float displacementBias;
#endif`,LLe=`#ifdef USE_DISPLACEMENTMAP
	transformed += normalize( objectNormal ) * ( texture2D( displacementMap, vDisplacementMapUv ).x * displacementScale + displacementBias );
#endif`,kLe=`#ifdef USE_EMISSIVEMAP
	vec4 emissiveColor = texture2D( emissiveMap, vEmissiveMapUv );
	#ifdef DECODE_VIDEO_TEXTURE_EMISSIVE
		emissiveColor = sRGBTransferEOTF( emissiveColor );
	#endif
	totalEmissiveRadiance *= emissiveColor.rgb;
#endif`,NLe=`#ifdef USE_EMISSIVEMAP
	uniform sampler2D emissiveMap;
#endif`,ULe="gl_FragColor = linearToOutputTexel( gl_FragColor );",BLe=`vec4 LinearTransferOETF( in vec4 value ) {
	return value;
}
vec4 sRGBTransferEOTF( in vec4 value ) {
	return vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );
}
vec4 sRGBTransferOETF( in vec4 value ) {
	return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );
}`,FLe=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vec3 cameraToFrag;
		if ( isOrthographic ) {
			cameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToFrag = normalize( vWorldPosition - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vec3 reflectVec = reflect( cameraToFrag, worldNormal );
		#else
			vec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );
		#endif
	#else
		vec3 reflectVec = vReflect;
	#endif
	#ifdef ENVMAP_TYPE_CUBE
		vec4 envColor = textureCube( envMap, envMapRotation * vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );
	#else
		vec4 envColor = vec4( 0.0 );
	#endif
	#ifdef ENVMAP_BLENDING_MULTIPLY
		outgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_MIX )
		outgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_ADD )
		outgoingLight += envColor.xyz * specularStrength * reflectivity;
	#endif
#endif`,zLe=`#ifdef USE_ENVMAP
	uniform float envMapIntensity;
	uniform float flipEnvMap;
	uniform mat3 envMapRotation;
	#ifdef ENVMAP_TYPE_CUBE
		uniform samplerCube envMap;
	#else
		uniform sampler2D envMap;
	#endif
	
#endif`,jLe=`#ifdef USE_ENVMAP
	uniform float reflectivity;
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		varying vec3 vWorldPosition;
		uniform float refractionRatio;
	#else
		varying vec3 vReflect;
	#endif
#endif`,VLe=`#ifdef USE_ENVMAP
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		
		varying vec3 vWorldPosition;
	#else
		varying vec3 vReflect;
		uniform float refractionRatio;
	#endif
#endif`,HLe=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vWorldPosition = worldPosition.xyz;
	#else
		vec3 cameraToVertex;
		if ( isOrthographic ) {
			cameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToVertex = normalize( worldPosition.xyz - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vReflect = reflect( cameraToVertex, worldNormal );
		#else
			vReflect = refract( cameraToVertex, worldNormal, refractionRatio );
		#endif
	#endif
#endif`,GLe=`#ifdef USE_FOG
	vFogDepth = - mvPosition.z;
#endif`,WLe=`#ifdef USE_FOG
	varying float vFogDepth;
#endif`,qLe=`#ifdef USE_FOG
	#ifdef FOG_EXP2
		float fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );
	#else
		float fogFactor = smoothstep( fogNear, fogFar, vFogDepth );
	#endif
	gl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );
#endif`,XLe=`#ifdef USE_FOG
	uniform vec3 fogColor;
	varying float vFogDepth;
	#ifdef FOG_EXP2
		uniform float fogDensity;
	#else
		uniform float fogNear;
		uniform float fogFar;
	#endif
#endif`,$Le=`#ifdef USE_GRADIENTMAP
	uniform sampler2D gradientMap;
#endif
vec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {
	float dotNL = dot( normal, lightDirection );
	vec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );
	#ifdef USE_GRADIENTMAP
		return vec3( texture2D( gradientMap, coord ).r );
	#else
		vec2 fw = fwidth( coord ) * 0.5;
		return mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );
	#endif
}`,YLe=`#ifdef USE_LIGHTMAP
	uniform sampler2D lightMap;
	uniform float lightMapIntensity;
#endif`,KLe=`LambertMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularStrength = specularStrength;`,ZLe=`varying vec3 vViewPosition;
struct LambertMaterial {
	vec3 diffuseColor;
	float specularStrength;
};
void RE_Direct_Lambert( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Lambert
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Lambert`,QLe=`uniform bool receiveShadow;
uniform vec3 ambientLightColor;
#if defined( USE_LIGHT_PROBES )
	uniform vec3 lightProbe[ 9 ];
#endif
vec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {
	float x = normal.x, y = normal.y, z = normal.z;
	vec3 result = shCoefficients[ 0 ] * 0.886227;
	result += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;
	result += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;
	result += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;
	result += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;
	result += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;
	result += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );
	result += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;
	result += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );
	return result;
}
vec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {
	vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
	vec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );
	return irradiance;
}
vec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {
	vec3 irradiance = ambientLightColor;
	return irradiance;
}
float getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {
	float distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );
	if ( cutoffDistance > 0.0 ) {
		distanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );
	}
	return distanceFalloff;
}
float getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {
	return smoothstep( coneCosine, penumbraCosine, angleCosine );
}
#if NUM_DIR_LIGHTS > 0
	struct DirectionalLight {
		vec3 direction;
		vec3 color;
	};
	uniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];
	void getDirectionalLightInfo( const in DirectionalLight directionalLight, out IncidentLight light ) {
		light.color = directionalLight.color;
		light.direction = directionalLight.direction;
		light.visible = true;
	}
#endif
#if NUM_POINT_LIGHTS > 0
	struct PointLight {
		vec3 position;
		vec3 color;
		float distance;
		float decay;
	};
	uniform PointLight pointLights[ NUM_POINT_LIGHTS ];
	void getPointLightInfo( const in PointLight pointLight, const in vec3 geometryPosition, out IncidentLight light ) {
		vec3 lVector = pointLight.position - geometryPosition;
		light.direction = normalize( lVector );
		float lightDistance = length( lVector );
		light.color = pointLight.color;
		light.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );
		light.visible = ( light.color != vec3( 0.0 ) );
	}
#endif
#if NUM_SPOT_LIGHTS > 0
	struct SpotLight {
		vec3 position;
		vec3 direction;
		vec3 color;
		float distance;
		float decay;
		float coneCos;
		float penumbraCos;
	};
	uniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];
	void getSpotLightInfo( const in SpotLight spotLight, const in vec3 geometryPosition, out IncidentLight light ) {
		vec3 lVector = spotLight.position - geometryPosition;
		light.direction = normalize( lVector );
		float angleCos = dot( light.direction, spotLight.direction );
		float spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );
		if ( spotAttenuation > 0.0 ) {
			float lightDistance = length( lVector );
			light.color = spotLight.color * spotAttenuation;
			light.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );
			light.visible = ( light.color != vec3( 0.0 ) );
		} else {
			light.color = vec3( 0.0 );
			light.visible = false;
		}
	}
#endif
#if NUM_RECT_AREA_LIGHTS > 0
	struct RectAreaLight {
		vec3 color;
		vec3 position;
		vec3 halfWidth;
		vec3 halfHeight;
	};
	uniform sampler2D ltc_1;	uniform sampler2D ltc_2;
	uniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];
#endif
#if NUM_HEMI_LIGHTS > 0
	struct HemisphereLight {
		vec3 direction;
		vec3 skyColor;
		vec3 groundColor;
	};
	uniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];
	vec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {
		float dotNL = dot( normal, hemiLight.direction );
		float hemiDiffuseWeight = 0.5 * dotNL + 0.5;
		vec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );
		return irradiance;
	}
#endif`,JLe=`#ifdef USE_ENVMAP
	vec3 getIBLIrradiance( const in vec3 normal ) {
		#ifdef ENVMAP_TYPE_CUBE_UV
			vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, envMapRotation * worldNormal, 1.0 );
			return PI * envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	vec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {
		#ifdef ENVMAP_TYPE_CUBE_UV
			vec3 reflectVec = reflect( - viewDir, normal );
			reflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );
			reflectVec = inverseTransformDirection( reflectVec, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, envMapRotation * reflectVec, roughness );
			return envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	#ifdef USE_ANISOTROPY
		vec3 getIBLAnisotropyRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in vec3 bitangent, const in float anisotropy ) {
			#ifdef ENVMAP_TYPE_CUBE_UV
				vec3 bentNormal = cross( bitangent, viewDir );
				bentNormal = normalize( cross( bentNormal, bitangent ) );
				bentNormal = normalize( mix( bentNormal, normal, pow2( pow2( 1.0 - anisotropy * ( 1.0 - roughness ) ) ) ) );
				return getIBLRadiance( viewDir, bentNormal, roughness );
			#else
				return vec3( 0.0 );
			#endif
		}
	#endif
#endif`,eke=`ToonMaterial material;
material.diffuseColor = diffuseColor.rgb;`,tke=`varying vec3 vViewPosition;
struct ToonMaterial {
	vec3 diffuseColor;
};
void RE_Direct_Toon( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	vec3 irradiance = getGradientIrradiance( geometryNormal, directLight.direction ) * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Toon
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Toon`,ike=`BlinnPhongMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularColor = specular;
material.specularShininess = shininess;
material.specularStrength = specularStrength;`,rke=`varying vec3 vViewPosition;
struct BlinnPhongMaterial {
	vec3 diffuseColor;
	vec3 specularColor;
	float specularShininess;
	float specularStrength;
};
void RE_Direct_BlinnPhong( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
	reflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometryViewDir, geometryNormal, material.specularColor, material.specularShininess ) * material.specularStrength;
}
void RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_BlinnPhong
#define RE_IndirectDiffuse		RE_IndirectDiffuse_BlinnPhong`,nke=`PhysicalMaterial material;
material.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );
vec3 dxy = max( abs( dFdx( nonPerturbedNormal ) ), abs( dFdy( nonPerturbedNormal ) ) );
float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );
material.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;
material.roughness = min( material.roughness, 1.0 );
#ifdef IOR
	material.ior = ior;
	#ifdef USE_SPECULAR
		float specularIntensityFactor = specularIntensity;
		vec3 specularColorFactor = specularColor;
		#ifdef USE_SPECULAR_COLORMAP
			specularColorFactor *= texture2D( specularColorMap, vSpecularColorMapUv ).rgb;
		#endif
		#ifdef USE_SPECULAR_INTENSITYMAP
			specularIntensityFactor *= texture2D( specularIntensityMap, vSpecularIntensityMapUv ).a;
		#endif
		material.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );
	#else
		float specularIntensityFactor = 1.0;
		vec3 specularColorFactor = vec3( 1.0 );
		material.specularF90 = 1.0;
	#endif
	material.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );
#else
	material.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );
	material.specularF90 = 1.0;
#endif
#ifdef USE_CLEARCOAT
	material.clearcoat = clearcoat;
	material.clearcoatRoughness = clearcoatRoughness;
	material.clearcoatF0 = vec3( 0.04 );
	material.clearcoatF90 = 1.0;
	#ifdef USE_CLEARCOATMAP
		material.clearcoat *= texture2D( clearcoatMap, vClearcoatMapUv ).x;
	#endif
	#ifdef USE_CLEARCOAT_ROUGHNESSMAP
		material.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vClearcoatRoughnessMapUv ).y;
	#endif
	material.clearcoat = saturate( material.clearcoat );	material.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );
	material.clearcoatRoughness += geometryRoughness;
	material.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );
#endif
#ifdef USE_DISPERSION
	material.dispersion = dispersion;
#endif
#ifdef USE_IRIDESCENCE
	material.iridescence = iridescence;
	material.iridescenceIOR = iridescenceIOR;
	#ifdef USE_IRIDESCENCEMAP
		material.iridescence *= texture2D( iridescenceMap, vIridescenceMapUv ).r;
	#endif
	#ifdef USE_IRIDESCENCE_THICKNESSMAP
		material.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vIridescenceThicknessMapUv ).g + iridescenceThicknessMinimum;
	#else
		material.iridescenceThickness = iridescenceThicknessMaximum;
	#endif
#endif
#ifdef USE_SHEEN
	material.sheenColor = sheenColor;
	#ifdef USE_SHEEN_COLORMAP
		material.sheenColor *= texture2D( sheenColorMap, vSheenColorMapUv ).rgb;
	#endif
	material.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );
	#ifdef USE_SHEEN_ROUGHNESSMAP
		material.sheenRoughness *= texture2D( sheenRoughnessMap, vSheenRoughnessMapUv ).a;
	#endif
#endif
#ifdef USE_ANISOTROPY
	#ifdef USE_ANISOTROPYMAP
		mat2 anisotropyMat = mat2( anisotropyVector.x, anisotropyVector.y, - anisotropyVector.y, anisotropyVector.x );
		vec3 anisotropyPolar = texture2D( anisotropyMap, vAnisotropyMapUv ).rgb;
		vec2 anisotropyV = anisotropyMat * normalize( 2.0 * anisotropyPolar.rg - vec2( 1.0 ) ) * anisotropyPolar.b;
	#else
		vec2 anisotropyV = anisotropyVector;
	#endif
	material.anisotropy = length( anisotropyV );
	if( material.anisotropy == 0.0 ) {
		anisotropyV = vec2( 1.0, 0.0 );
	} else {
		anisotropyV /= material.anisotropy;
		material.anisotropy = saturate( material.anisotropy );
	}
	material.alphaT = mix( pow2( material.roughness ), 1.0, pow2( material.anisotropy ) );
	material.anisotropyT = tbn[ 0 ] * anisotropyV.x + tbn[ 1 ] * anisotropyV.y;
	material.anisotropyB = tbn[ 1 ] * anisotropyV.x - tbn[ 0 ] * anisotropyV.y;
#endif`,ske=`struct PhysicalMaterial {
	vec3 diffuseColor;
	float roughness;
	vec3 specularColor;
	float specularF90;
	float dispersion;
	#ifdef USE_CLEARCOAT
		float clearcoat;
		float clearcoatRoughness;
		vec3 clearcoatF0;
		float clearcoatF90;
	#endif
	#ifdef USE_IRIDESCENCE
		float iridescence;
		float iridescenceIOR;
		float iridescenceThickness;
		vec3 iridescenceFresnel;
		vec3 iridescenceF0;
	#endif
	#ifdef USE_SHEEN
		vec3 sheenColor;
		float sheenRoughness;
	#endif
	#ifdef IOR
		float ior;
	#endif
	#ifdef USE_TRANSMISSION
		float transmission;
		float transmissionAlpha;
		float thickness;
		float attenuationDistance;
		vec3 attenuationColor;
	#endif
	#ifdef USE_ANISOTROPY
		float anisotropy;
		float alphaT;
		vec3 anisotropyT;
		vec3 anisotropyB;
	#endif
};
vec3 clearcoatSpecularDirect = vec3( 0.0 );
vec3 clearcoatSpecularIndirect = vec3( 0.0 );
vec3 sheenSpecularDirect = vec3( 0.0 );
vec3 sheenSpecularIndirect = vec3(0.0 );
vec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {
    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );
    float x2 = x * x;
    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );
    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );
}
float V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {
	float a2 = pow2( alpha );
	float gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );
	float gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );
	return 0.5 / max( gv + gl, EPSILON );
}
float D_GGX( const in float alpha, const in float dotNH ) {
	float a2 = pow2( alpha );
	float denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;
	return RECIPROCAL_PI * a2 / pow2( denom );
}
#ifdef USE_ANISOTROPY
	float V_GGX_SmithCorrelated_Anisotropic( const in float alphaT, const in float alphaB, const in float dotTV, const in float dotBV, const in float dotTL, const in float dotBL, const in float dotNV, const in float dotNL ) {
		float gv = dotNL * length( vec3( alphaT * dotTV, alphaB * dotBV, dotNV ) );
		float gl = dotNV * length( vec3( alphaT * dotTL, alphaB * dotBL, dotNL ) );
		float v = 0.5 / ( gv + gl );
		return saturate(v);
	}
	float D_GGX_Anisotropic( const in float alphaT, const in float alphaB, const in float dotNH, const in float dotTH, const in float dotBH ) {
		float a2 = alphaT * alphaB;
		highp vec3 v = vec3( alphaB * dotTH, alphaT * dotBH, a2 * dotNH );
		highp float v2 = dot( v, v );
		float w2 = a2 / v2;
		return RECIPROCAL_PI * a2 * pow2 ( w2 );
	}
#endif
#ifdef USE_CLEARCOAT
	vec3 BRDF_GGX_Clearcoat( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material) {
		vec3 f0 = material.clearcoatF0;
		float f90 = material.clearcoatF90;
		float roughness = material.clearcoatRoughness;
		float alpha = pow2( roughness );
		vec3 halfDir = normalize( lightDir + viewDir );
		float dotNL = saturate( dot( normal, lightDir ) );
		float dotNV = saturate( dot( normal, viewDir ) );
		float dotNH = saturate( dot( normal, halfDir ) );
		float dotVH = saturate( dot( viewDir, halfDir ) );
		vec3 F = F_Schlick( f0, f90, dotVH );
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
		return F * ( V * D );
	}
#endif
vec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material ) {
	vec3 f0 = material.specularColor;
	float f90 = material.specularF90;
	float roughness = material.roughness;
	float alpha = pow2( roughness );
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( f0, f90, dotVH );
	#ifdef USE_IRIDESCENCE
		F = mix( F, material.iridescenceFresnel, material.iridescence );
	#endif
	#ifdef USE_ANISOTROPY
		float dotTL = dot( material.anisotropyT, lightDir );
		float dotTV = dot( material.anisotropyT, viewDir );
		float dotTH = dot( material.anisotropyT, halfDir );
		float dotBL = dot( material.anisotropyB, lightDir );
		float dotBV = dot( material.anisotropyB, viewDir );
		float dotBH = dot( material.anisotropyB, halfDir );
		float V = V_GGX_SmithCorrelated_Anisotropic( material.alphaT, alpha, dotTV, dotBV, dotTL, dotBL, dotNV, dotNL );
		float D = D_GGX_Anisotropic( material.alphaT, alpha, dotNH, dotTH, dotBH );
	#else
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
	#endif
	return F * ( V * D );
}
vec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {
	const float LUT_SIZE = 64.0;
	const float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;
	const float LUT_BIAS = 0.5 / LUT_SIZE;
	float dotNV = saturate( dot( N, V ) );
	vec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );
	uv = uv * LUT_SCALE + LUT_BIAS;
	return uv;
}
float LTC_ClippedSphereFormFactor( const in vec3 f ) {
	float l = length( f );
	return max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );
}
vec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {
	float x = dot( v1, v2 );
	float y = abs( x );
	float a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;
	float b = 3.4175940 + ( 4.1616724 + y ) * y;
	float v = a / b;
	float theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;
	return cross( v1, v2 ) * theta_sintheta;
}
vec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {
	vec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];
	vec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];
	vec3 lightNormal = cross( v1, v2 );
	if( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );
	vec3 T1, T2;
	T1 = normalize( V - N * dot( V, N ) );
	T2 = - cross( N, T1 );
	mat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );
	vec3 coords[ 4 ];
	coords[ 0 ] = mat * ( rectCoords[ 0 ] - P );
	coords[ 1 ] = mat * ( rectCoords[ 1 ] - P );
	coords[ 2 ] = mat * ( rectCoords[ 2 ] - P );
	coords[ 3 ] = mat * ( rectCoords[ 3 ] - P );
	coords[ 0 ] = normalize( coords[ 0 ] );
	coords[ 1 ] = normalize( coords[ 1 ] );
	coords[ 2 ] = normalize( coords[ 2 ] );
	coords[ 3 ] = normalize( coords[ 3 ] );
	vec3 vectorFormFactor = vec3( 0.0 );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );
	float result = LTC_ClippedSphereFormFactor( vectorFormFactor );
	return vec3( result );
}
#if defined( USE_SHEEN )
float D_Charlie( float roughness, float dotNH ) {
	float alpha = pow2( roughness );
	float invAlpha = 1.0 / alpha;
	float cos2h = dotNH * dotNH;
	float sin2h = max( 1.0 - cos2h, 0.0078125 );
	return ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );
}
float V_Neubelt( float dotNV, float dotNL ) {
	return saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );
}
vec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float D = D_Charlie( sheenRoughness, dotNH );
	float V = V_Neubelt( dotNV, dotNL );
	return sheenColor * ( D * V );
}
#endif
float IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	float r2 = roughness * roughness;
	float a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;
	float b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;
	float DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );
	return saturate( DG * RECIPROCAL_PI );
}
vec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	const vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );
	const vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );
	vec4 r = roughness * c0 + c1;
	float a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;
	vec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;
	return fab;
}
vec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	return specularColor * fab.x + specularF90 * fab.y;
}
#ifdef USE_IRIDESCENCE
void computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#else
void computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#endif
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	#ifdef USE_IRIDESCENCE
		vec3 Fr = mix( specularColor, iridescenceF0, iridescence );
	#else
		vec3 Fr = specularColor;
	#endif
	vec3 FssEss = Fr * fab.x + specularF90 * fab.y;
	float Ess = fab.x + fab.y;
	float Ems = 1.0 - Ess;
	vec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;	vec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );
	singleScatter += FssEss;
	multiScatter += Fms * Ems;
}
#if NUM_RECT_AREA_LIGHTS > 0
	void RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
		vec3 normal = geometryNormal;
		vec3 viewDir = geometryViewDir;
		vec3 position = geometryPosition;
		vec3 lightPos = rectAreaLight.position;
		vec3 halfWidth = rectAreaLight.halfWidth;
		vec3 halfHeight = rectAreaLight.halfHeight;
		vec3 lightColor = rectAreaLight.color;
		float roughness = material.roughness;
		vec3 rectCoords[ 4 ];
		rectCoords[ 0 ] = lightPos + halfWidth - halfHeight;		rectCoords[ 1 ] = lightPos - halfWidth - halfHeight;
		rectCoords[ 2 ] = lightPos - halfWidth + halfHeight;
		rectCoords[ 3 ] = lightPos + halfWidth + halfHeight;
		vec2 uv = LTC_Uv( normal, viewDir, roughness );
		vec4 t1 = texture2D( ltc_1, uv );
		vec4 t2 = texture2D( ltc_2, uv );
		mat3 mInv = mat3(
			vec3( t1.x, 0, t1.y ),
			vec3(    0, 1,    0 ),
			vec3( t1.z, 0, t1.w )
		);
		vec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );
		reflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );
		reflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );
	}
#endif
void RE_Direct_Physical( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	#ifdef USE_CLEARCOAT
		float dotNLcc = saturate( dot( geometryClearcoatNormal, directLight.direction ) );
		vec3 ccIrradiance = dotNLcc * directLight.color;
		clearcoatSpecularDirect += ccIrradiance * BRDF_GGX_Clearcoat( directLight.direction, geometryViewDir, geometryClearcoatNormal, material );
	#endif
	#ifdef USE_SHEEN
		sheenSpecularDirect += irradiance * BRDF_Sheen( directLight.direction, geometryViewDir, geometryNormal, material.sheenColor, material.sheenRoughness );
	#endif
	reflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometryViewDir, geometryNormal, material );
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {
	#ifdef USE_CLEARCOAT
		clearcoatSpecularIndirect += clearcoatRadiance * EnvironmentBRDF( geometryClearcoatNormal, geometryViewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );
	#endif
	#ifdef USE_SHEEN
		sheenSpecularIndirect += irradiance * material.sheenColor * IBLSheenBRDF( geometryNormal, geometryViewDir, material.sheenRoughness );
	#endif
	vec3 singleScattering = vec3( 0.0 );
	vec3 multiScattering = vec3( 0.0 );
	vec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;
	#ifdef USE_IRIDESCENCE
		computeMultiscatteringIridescence( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );
	#else
		computeMultiscattering( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );
	#endif
	vec3 totalScattering = singleScattering + multiScattering;
	vec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );
	reflectedLight.indirectSpecular += radiance * singleScattering;
	reflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;
	reflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;
}
#define RE_Direct				RE_Direct_Physical
#define RE_Direct_RectArea		RE_Direct_RectArea_Physical
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Physical
#define RE_IndirectSpecular		RE_IndirectSpecular_Physical
float computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {
	return saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );
}`,ake=`
vec3 geometryPosition = - vViewPosition;
vec3 geometryNormal = normal;
vec3 geometryViewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );
vec3 geometryClearcoatNormal = vec3( 0.0 );
#ifdef USE_CLEARCOAT
	geometryClearcoatNormal = clearcoatNormal;
#endif
#ifdef USE_IRIDESCENCE
	float dotNVi = saturate( dot( normal, geometryViewDir ) );
	if ( material.iridescenceThickness == 0.0 ) {
		material.iridescence = 0.0;
	} else {
		material.iridescence = saturate( material.iridescence );
	}
	if ( material.iridescence > 0.0 ) {
		material.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );
		material.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );
	}
#endif
IncidentLight directLight;
#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )
	PointLight pointLight;
	#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		pointLight = pointLights[ i ];
		getPointLightInfo( pointLight, geometryPosition, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )
		pointLightShadow = pointLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowIntensity, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )
	SpotLight spotLight;
	vec4 spotColor;
	vec3 spotLightCoord;
	bool inSpotLightMap;
	#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		spotLight = spotLights[ i ];
		getSpotLightInfo( spotLight, geometryPosition, directLight );
		#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX
		#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS
		#else
		#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#endif
		#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )
			spotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;
			inSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );
			spotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );
			directLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;
		#endif
		#undef SPOT_LIGHT_MAP_INDEX
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		spotLightShadow = spotLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowIntensity, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )
	DirectionalLight directionalLight;
	#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		directionalLight = directionalLights[ i ];
		getDirectionalLightInfo( directionalLight, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )
		directionalLightShadow = directionalLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowIntensity, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )
	RectAreaLight rectAreaLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {
		rectAreaLight = rectAreaLights[ i ];
		RE_Direct_RectArea( rectAreaLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if defined( RE_IndirectDiffuse )
	vec3 iblIrradiance = vec3( 0.0 );
	vec3 irradiance = getAmbientLightIrradiance( ambientLightColor );
	#if defined( USE_LIGHT_PROBES )
		irradiance += getLightProbeIrradiance( lightProbe, geometryNormal );
	#endif
	#if ( NUM_HEMI_LIGHTS > 0 )
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
			irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometryNormal );
		}
		#pragma unroll_loop_end
	#endif
#endif
#if defined( RE_IndirectSpecular )
	vec3 radiance = vec3( 0.0 );
	vec3 clearcoatRadiance = vec3( 0.0 );
#endif`,oke=`#if defined( RE_IndirectDiffuse )
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
		irradiance += lightMapIrradiance;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )
		iblIrradiance += getIBLIrradiance( geometryNormal );
	#endif
#endif
#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )
	#ifdef USE_ANISOTROPY
		radiance += getIBLAnisotropyRadiance( geometryViewDir, geometryNormal, material.roughness, material.anisotropyB, material.anisotropy );
	#else
		radiance += getIBLRadiance( geometryViewDir, geometryNormal, material.roughness );
	#endif
	#ifdef USE_CLEARCOAT
		clearcoatRadiance += getIBLRadiance( geometryViewDir, geometryClearcoatNormal, material.clearcoatRoughness );
	#endif
#endif`,lke=`#if defined( RE_IndirectDiffuse )
	RE_IndirectDiffuse( irradiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
#endif
#if defined( RE_IndirectSpecular )
	RE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
#endif`,cke=`#if defined( USE_LOGARITHMIC_DEPTH_BUFFER )
	gl_FragDepth = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;
#endif`,uke=`#if defined( USE_LOGARITHMIC_DEPTH_BUFFER )
	uniform float logDepthBufFC;
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,hke=`#ifdef USE_LOGARITHMIC_DEPTH_BUFFER
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,dke=`#ifdef USE_LOGARITHMIC_DEPTH_BUFFER
	vFragDepth = 1.0 + gl_Position.w;
	vIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );
#endif`,fke=`#ifdef USE_MAP
	vec4 sampledDiffuseColor = texture2D( map, vMapUv );
	#ifdef DECODE_VIDEO_TEXTURE
		sampledDiffuseColor = sRGBTransferEOTF( sampledDiffuseColor );
	#endif
	diffuseColor *= sampledDiffuseColor;
#endif`,pke=`#ifdef USE_MAP
	uniform sampler2D map;
#endif`,mke=`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	#if defined( USE_POINTS_UV )
		vec2 uv = vUv;
	#else
		vec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;
	#endif
#endif
#ifdef USE_MAP
	diffuseColor *= texture2D( map, uv );
#endif
#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, uv ).g;
#endif`,gke=`#if defined( USE_POINTS_UV )
	varying vec2 vUv;
#else
	#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
		uniform mat3 uvTransform;
	#endif
#endif
#ifdef USE_MAP
	uniform sampler2D map;
#endif
#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,vke=`float metalnessFactor = metalness;
#ifdef USE_METALNESSMAP
	vec4 texelMetalness = texture2D( metalnessMap, vMetalnessMapUv );
	metalnessFactor *= texelMetalness.b;
#endif`,yke=`#ifdef USE_METALNESSMAP
	uniform sampler2D metalnessMap;
#endif`,xke=`#ifdef USE_INSTANCING_MORPH
	float morphTargetInfluences[ MORPHTARGETS_COUNT ];
	float morphTargetBaseInfluence = texelFetch( morphTexture, ivec2( 0, gl_InstanceID ), 0 ).r;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		morphTargetInfluences[i] =  texelFetch( morphTexture, ivec2( i + 1, gl_InstanceID ), 0 ).r;
	}
#endif`,bke=`#if defined( USE_MORPHCOLORS )
	vColor *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		#if defined( USE_COLOR_ALPHA )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];
		#elif defined( USE_COLOR )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];
		#endif
	}
#endif`,wke=`#ifdef USE_MORPHNORMALS
	objectNormal *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		if ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];
	}
#endif`,_ke=`#ifdef USE_MORPHTARGETS
	#ifndef USE_INSTANCING_MORPH
		uniform float morphTargetBaseInfluence;
		uniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];
	#endif
	uniform sampler2DArray morphTargetsTexture;
	uniform ivec2 morphTargetsTextureSize;
	vec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {
		int texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;
		int y = texelIndex / morphTargetsTextureSize.x;
		int x = texelIndex - y * morphTargetsTextureSize.x;
		ivec3 morphUV = ivec3( x, y, morphTargetIndex );
		return texelFetch( morphTargetsTexture, morphUV, 0 );
	}
#endif`,Ske=`#ifdef USE_MORPHTARGETS
	transformed *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		if ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];
	}
#endif`,Eke=`float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;
#ifdef FLAT_SHADED
	vec3 fdx = dFdx( vViewPosition );
	vec3 fdy = dFdy( vViewPosition );
	vec3 normal = normalize( cross( fdx, fdy ) );
#else
	vec3 normal = normalize( vNormal );
	#ifdef DOUBLE_SIDED
		normal *= faceDirection;
	#endif
#endif
#if defined( USE_NORMALMAP_TANGENTSPACE ) || defined( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY )
	#ifdef USE_TANGENT
		mat3 tbn = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn = getTangentFrame( - vViewPosition, normal,
		#if defined( USE_NORMALMAP )
			vNormalMapUv
		#elif defined( USE_CLEARCOAT_NORMALMAP )
			vClearcoatNormalMapUv
		#else
			vUv
		#endif
		);
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn[0] *= faceDirection;
		tbn[1] *= faceDirection;
	#endif
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	#ifdef USE_TANGENT
		mat3 tbn2 = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn2 = getTangentFrame( - vViewPosition, normal, vClearcoatNormalMapUv );
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn2[0] *= faceDirection;
		tbn2[1] *= faceDirection;
	#endif
#endif
vec3 nonPerturbedNormal = normal;`,Ake=`#ifdef USE_NORMALMAP_OBJECTSPACE
	normal = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	#ifdef FLIP_SIDED
		normal = - normal;
	#endif
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	normal = normalize( normalMatrix * normal );
#elif defined( USE_NORMALMAP_TANGENTSPACE )
	vec3 mapN = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	mapN.xy *= normalScale;
	normal = normalize( tbn * mapN );
#elif defined( USE_BUMPMAP )
	normal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );
#endif`,Mke=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,Tke=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,Cke=`#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
	#ifdef USE_TANGENT
		vTangent = normalize( transformedTangent );
		vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );
	#endif
#endif`,Pke=`#ifdef USE_NORMALMAP
	uniform sampler2D normalMap;
	uniform vec2 normalScale;
#endif
#ifdef USE_NORMALMAP_OBJECTSPACE
	uniform mat3 normalMatrix;
#endif
#if ! defined ( USE_TANGENT ) && ( defined ( USE_NORMALMAP_TANGENTSPACE ) || defined ( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY ) )
	mat3 getTangentFrame( vec3 eye_pos, vec3 surf_norm, vec2 uv ) {
		vec3 q0 = dFdx( eye_pos.xyz );
		vec3 q1 = dFdy( eye_pos.xyz );
		vec2 st0 = dFdx( uv.st );
		vec2 st1 = dFdy( uv.st );
		vec3 N = surf_norm;
		vec3 q1perp = cross( q1, N );
		vec3 q0perp = cross( N, q0 );
		vec3 T = q1perp * st0.x + q0perp * st1.x;
		vec3 B = q1perp * st0.y + q0perp * st1.y;
		float det = max( dot( T, T ), dot( B, B ) );
		float scale = ( det == 0.0 ) ? 0.0 : inversesqrt( det );
		return mat3( T * scale, B * scale, N );
	}
#endif`,Rke=`#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal = nonPerturbedNormal;
#endif`,Ike=`#ifdef USE_CLEARCOAT_NORMALMAP
	vec3 clearcoatMapN = texture2D( clearcoatNormalMap, vClearcoatNormalMapUv ).xyz * 2.0 - 1.0;
	clearcoatMapN.xy *= clearcoatNormalScale;
	clearcoatNormal = normalize( tbn2 * clearcoatMapN );
#endif`,Dke=`#ifdef USE_CLEARCOATMAP
	uniform sampler2D clearcoatMap;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform sampler2D clearcoatNormalMap;
	uniform vec2 clearcoatNormalScale;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform sampler2D clearcoatRoughnessMap;
#endif`,Oke=`#ifdef USE_IRIDESCENCEMAP
	uniform sampler2D iridescenceMap;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform sampler2D iridescenceThicknessMap;
#endif`,Lke=`#ifdef OPAQUE
diffuseColor.a = 1.0;
#endif
#ifdef USE_TRANSMISSION
diffuseColor.a *= material.transmissionAlpha;
#endif
gl_FragColor = vec4( outgoingLight, diffuseColor.a );`,kke=`vec3 packNormalToRGB( const in vec3 normal ) {
	return normalize( normal ) * 0.5 + 0.5;
}
vec3 unpackRGBToNormal( const in vec3 rgb ) {
	return 2.0 * rgb.xyz - 1.0;
}
const float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;const float ShiftRight8 = 1. / 256.;
const float Inv255 = 1. / 255.;
const vec4 PackFactors = vec4( 1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0 );
const vec2 UnpackFactors2 = vec2( UnpackDownscale, 1.0 / PackFactors.g );
const vec3 UnpackFactors3 = vec3( UnpackDownscale / PackFactors.rg, 1.0 / PackFactors.b );
const vec4 UnpackFactors4 = vec4( UnpackDownscale / PackFactors.rgb, 1.0 / PackFactors.a );
vec4 packDepthToRGBA( const in float v ) {
	if( v <= 0.0 )
		return vec4( 0., 0., 0., 0. );
	if( v >= 1.0 )
		return vec4( 1., 1., 1., 1. );
	float vuf;
	float af = modf( v * PackFactors.a, vuf );
	float bf = modf( vuf * ShiftRight8, vuf );
	float gf = modf( vuf * ShiftRight8, vuf );
	return vec4( vuf * Inv255, gf * PackUpscale, bf * PackUpscale, af );
}
vec3 packDepthToRGB( const in float v ) {
	if( v <= 0.0 )
		return vec3( 0., 0., 0. );
	if( v >= 1.0 )
		return vec3( 1., 1., 1. );
	float vuf;
	float bf = modf( v * PackFactors.b, vuf );
	float gf = modf( vuf * ShiftRight8, vuf );
	return vec3( vuf * Inv255, gf * PackUpscale, bf );
}
vec2 packDepthToRG( const in float v ) {
	if( v <= 0.0 )
		return vec2( 0., 0. );
	if( v >= 1.0 )
		return vec2( 1., 1. );
	float vuf;
	float gf = modf( v * 256., vuf );
	return vec2( vuf * Inv255, gf );
}
float unpackRGBAToDepth( const in vec4 v ) {
	return dot( v, UnpackFactors4 );
}
float unpackRGBToDepth( const in vec3 v ) {
	return dot( v, UnpackFactors3 );
}
float unpackRGToDepth( const in vec2 v ) {
	return v.r * UnpackFactors2.r + v.g * UnpackFactors2.g;
}
vec4 pack2HalfToRGBA( const in vec2 v ) {
	vec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );
	return vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );
}
vec2 unpackRGBATo2Half( const in vec4 v ) {
	return vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );
}
float viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {
	return ( viewZ + near ) / ( near - far );
}
float orthographicDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return depth * ( near - far ) - near;
}
float viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {
	return ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );
}
float perspectiveDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return ( near * far ) / ( ( far - near ) * depth - far );
}`,Nke=`#ifdef PREMULTIPLIED_ALPHA
	gl_FragColor.rgb *= gl_FragColor.a;
#endif`,Uke=`vec4 mvPosition = vec4( transformed, 1.0 );
#ifdef USE_BATCHING
	mvPosition = batchingMatrix * mvPosition;
#endif
#ifdef USE_INSTANCING
	mvPosition = instanceMatrix * mvPosition;
#endif
mvPosition = modelViewMatrix * mvPosition;
gl_Position = projectionMatrix * mvPosition;`,Bke=`#ifdef DITHERING
	gl_FragColor.rgb = dithering( gl_FragColor.rgb );
#endif`,Fke=`#ifdef DITHERING
	vec3 dithering( vec3 color ) {
		float grid_position = rand( gl_FragCoord.xy );
		vec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );
		dither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );
		return color + dither_shift_RGB;
	}
#endif`,zke=`float roughnessFactor = roughness;
#ifdef USE_ROUGHNESSMAP
	vec4 texelRoughness = texture2D( roughnessMap, vRoughnessMapUv );
	roughnessFactor *= texelRoughness.g;
#endif`,jke=`#ifdef USE_ROUGHNESSMAP
	uniform sampler2D roughnessMap;
#endif`,Vke=`#if NUM_SPOT_LIGHT_COORDS > 0
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#if NUM_SPOT_LIGHT_MAPS > 0
	uniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];
		struct SpotLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
	float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {
		float depth = unpackRGBAToDepth( texture2D( depths, uv ) );
		#ifdef USE_REVERSED_DEPTH_BUFFER
			return step( depth, compare );
		#else
			return step( compare, depth );
		#endif
	}
	vec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {
		return unpackRGBATo2Half( texture2D( shadow, uv ) );
	}
	float VSMShadow( sampler2D shadow, vec2 uv, float compare ) {
		float occlusion = 1.0;
		vec2 distribution = texture2DDistribution( shadow, uv );
		#ifdef USE_REVERSED_DEPTH_BUFFER
			float hard_shadow = step( distribution.x, compare );
		#else
			float hard_shadow = step( compare, distribution.x );
		#endif
		if ( hard_shadow != 1.0 ) {
			float distance = compare - distribution.x;
			float variance = max( 0.00000, distribution.y * distribution.y );
			float softness_probability = variance / (variance + distance * distance );			softness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );			occlusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );
		}
		return occlusion;
	}
	float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowIntensity, float shadowBias, float shadowRadius, vec4 shadowCoord ) {
		float shadow = 1.0;
		shadowCoord.xyz /= shadowCoord.w;
		shadowCoord.z += shadowBias;
		bool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;
		bool frustumTest = inFrustum && shadowCoord.z <= 1.0;
		if ( frustumTest ) {
		#if defined( SHADOWMAP_TYPE_PCF )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx0 = - texelSize.x * shadowRadius;
			float dy0 = - texelSize.y * shadowRadius;
			float dx1 = + texelSize.x * shadowRadius;
			float dy1 = + texelSize.y * shadowRadius;
			float dx2 = dx0 / 2.0;
			float dy2 = dy0 / 2.0;
			float dx3 = dx1 / 2.0;
			float dy3 = dy1 / 2.0;
			shadow = (
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )
			) * ( 1.0 / 17.0 );
		#elif defined( SHADOWMAP_TYPE_PCF_SOFT )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx = texelSize.x;
			float dy = texelSize.y;
			vec2 uv = shadowCoord.xy;
			vec2 f = fract( uv * shadowMapSize + 0.5 );
			uv -= f * texelSize;
			shadow = (
				texture2DCompare( shadowMap, uv, shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),
						  f.x ),
					 mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),
						  f.x ),
					 f.y )
			) * ( 1.0 / 9.0 );
		#elif defined( SHADOWMAP_TYPE_VSM )
			shadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );
		#else
			shadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );
		#endif
		}
		return mix( 1.0, shadow, shadowIntensity );
	}
	vec2 cubeToUV( vec3 v, float texelSizeY ) {
		vec3 absV = abs( v );
		float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );
		absV *= scaleToCube;
		v *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );
		vec2 planar = v.xy;
		float almostATexel = 1.5 * texelSizeY;
		float almostOne = 1.0 - almostATexel;
		if ( absV.z >= almostOne ) {
			if ( v.z > 0.0 )
				planar.x = 4.0 - v.x;
		} else if ( absV.x >= almostOne ) {
			float signX = sign( v.x );
			planar.x = v.z * signX + 2.0 * signX;
		} else if ( absV.y >= almostOne ) {
			float signY = sign( v.y );
			planar.x = v.x + 2.0 * signY + 2.0;
			planar.y = v.z * signY - 2.0;
		}
		return vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );
	}
	float getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowIntensity, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {
		float shadow = 1.0;
		vec3 lightToPosition = shadowCoord.xyz;
		
		float lightToPositionLength = length( lightToPosition );
		if ( lightToPositionLength - shadowCameraFar <= 0.0 && lightToPositionLength - shadowCameraNear >= 0.0 ) {
			float dp = ( lightToPositionLength - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );			dp += shadowBias;
			vec3 bd3D = normalize( lightToPosition );
			vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );
			#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )
				vec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;
				shadow = (
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )
				) * ( 1.0 / 9.0 );
			#else
				shadow = texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );
			#endif
		}
		return mix( 1.0, shadow, shadowIntensity );
	}
#endif`,Hke=`#if NUM_SPOT_LIGHT_COORDS > 0
	uniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		struct SpotLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
#endif`,Gke=`#if ( defined( USE_SHADOWMAP ) && ( NUM_DIR_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0 ) ) || ( NUM_SPOT_LIGHT_COORDS > 0 )
	vec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
	vec4 shadowWorldPosition;
#endif
#if defined( USE_SHADOWMAP )
	#if NUM_DIR_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );
			vDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );
			vPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
#endif
#if NUM_SPOT_LIGHT_COORDS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {
		shadowWorldPosition = worldPosition;
		#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
			shadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;
		#endif
		vSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
#endif`,Wke=`float getShadowMask() {
	float shadow = 1.0;
	#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		directionalLight = directionalLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowIntensity, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		spotLight = spotLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowIntensity, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		pointLight = pointLightShadows[ i ];
		shadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowIntensity, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#endif
	return shadow;
}`,qke=`#ifdef USE_SKINNING
	mat4 boneMatX = getBoneMatrix( skinIndex.x );
	mat4 boneMatY = getBoneMatrix( skinIndex.y );
	mat4 boneMatZ = getBoneMatrix( skinIndex.z );
	mat4 boneMatW = getBoneMatrix( skinIndex.w );
#endif`,Xke=`#ifdef USE_SKINNING
	uniform mat4 bindMatrix;
	uniform mat4 bindMatrixInverse;
	uniform highp sampler2D boneTexture;
	mat4 getBoneMatrix( const in float i ) {
		int size = textureSize( boneTexture, 0 ).x;
		int j = int( i ) * 4;
		int x = j % size;
		int y = j / size;
		vec4 v1 = texelFetch( boneTexture, ivec2( x, y ), 0 );
		vec4 v2 = texelFetch( boneTexture, ivec2( x + 1, y ), 0 );
		vec4 v3 = texelFetch( boneTexture, ivec2( x + 2, y ), 0 );
		vec4 v4 = texelFetch( boneTexture, ivec2( x + 3, y ), 0 );
		return mat4( v1, v2, v3, v4 );
	}
#endif`,$ke=`#ifdef USE_SKINNING
	vec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );
	vec4 skinned = vec4( 0.0 );
	skinned += boneMatX * skinVertex * skinWeight.x;
	skinned += boneMatY * skinVertex * skinWeight.y;
	skinned += boneMatZ * skinVertex * skinWeight.z;
	skinned += boneMatW * skinVertex * skinWeight.w;
	transformed = ( bindMatrixInverse * skinned ).xyz;
#endif`,Yke=`#ifdef USE_SKINNING
	mat4 skinMatrix = mat4( 0.0 );
	skinMatrix += skinWeight.x * boneMatX;
	skinMatrix += skinWeight.y * boneMatY;
	skinMatrix += skinWeight.z * boneMatZ;
	skinMatrix += skinWeight.w * boneMatW;
	skinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;
	objectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;
	#ifdef USE_TANGENT
		objectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#endif
#endif`,Kke=`float specularStrength;
#ifdef USE_SPECULARMAP
	vec4 texelSpecular = texture2D( specularMap, vSpecularMapUv );
	specularStrength = texelSpecular.r;
#else
	specularStrength = 1.0;
#endif`,Zke=`#ifdef USE_SPECULARMAP
	uniform sampler2D specularMap;
#endif`,Qke=`#if defined( TONE_MAPPING )
	gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );
#endif`,Jke=`#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
uniform float toneMappingExposure;
vec3 LinearToneMapping( vec3 color ) {
	return saturate( toneMappingExposure * color );
}
vec3 ReinhardToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	return saturate( color / ( vec3( 1.0 ) + color ) );
}
vec3 CineonToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	color = max( vec3( 0.0 ), color - 0.004 );
	return pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );
}
vec3 RRTAndODTFit( vec3 v ) {
	vec3 a = v * ( v + 0.0245786 ) - 0.000090537;
	vec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;
	return a / b;
}
vec3 ACESFilmicToneMapping( vec3 color ) {
	const mat3 ACESInputMat = mat3(
		vec3( 0.59719, 0.07600, 0.02840 ),		vec3( 0.35458, 0.90834, 0.13383 ),
		vec3( 0.04823, 0.01566, 0.83777 )
	);
	const mat3 ACESOutputMat = mat3(
		vec3(  1.60475, -0.10208, -0.00327 ),		vec3( -0.53108,  1.10813, -0.07276 ),
		vec3( -0.07367, -0.00605,  1.07602 )
	);
	color *= toneMappingExposure / 0.6;
	color = ACESInputMat * color;
	color = RRTAndODTFit( color );
	color = ACESOutputMat * color;
	return saturate( color );
}
const mat3 LINEAR_REC2020_TO_LINEAR_SRGB = mat3(
	vec3( 1.6605, - 0.1246, - 0.0182 ),
	vec3( - 0.5876, 1.1329, - 0.1006 ),
	vec3( - 0.0728, - 0.0083, 1.1187 )
);
const mat3 LINEAR_SRGB_TO_LINEAR_REC2020 = mat3(
	vec3( 0.6274, 0.0691, 0.0164 ),
	vec3( 0.3293, 0.9195, 0.0880 ),
	vec3( 0.0433, 0.0113, 0.8956 )
);
vec3 agxDefaultContrastApprox( vec3 x ) {
	vec3 x2 = x * x;
	vec3 x4 = x2 * x2;
	return + 15.5 * x4 * x2
		- 40.14 * x4 * x
		+ 31.96 * x4
		- 6.868 * x2 * x
		+ 0.4298 * x2
		+ 0.1191 * x
		- 0.00232;
}
vec3 AgXToneMapping( vec3 color ) {
	const mat3 AgXInsetMatrix = mat3(
		vec3( 0.856627153315983, 0.137318972929847, 0.11189821299995 ),
		vec3( 0.0951212405381588, 0.761241990602591, 0.0767994186031903 ),
		vec3( 0.0482516061458583, 0.101439036467562, 0.811302368396859 )
	);
	const mat3 AgXOutsetMatrix = mat3(
		vec3( 1.1271005818144368, - 0.1413297634984383, - 0.14132976349843826 ),
		vec3( - 0.11060664309660323, 1.157823702216272, - 0.11060664309660294 ),
		vec3( - 0.016493938717834573, - 0.016493938717834257, 1.2519364065950405 )
	);
	const float AgxMinEv = - 12.47393;	const float AgxMaxEv = 4.026069;
	color *= toneMappingExposure;
	color = LINEAR_SRGB_TO_LINEAR_REC2020 * color;
	color = AgXInsetMatrix * color;
	color = max( color, 1e-10 );	color = log2( color );
	color = ( color - AgxMinEv ) / ( AgxMaxEv - AgxMinEv );
	color = clamp( color, 0.0, 1.0 );
	color = agxDefaultContrastApprox( color );
	color = AgXOutsetMatrix * color;
	color = pow( max( vec3( 0.0 ), color ), vec3( 2.2 ) );
	color = LINEAR_REC2020_TO_LINEAR_SRGB * color;
	color = clamp( color, 0.0, 1.0 );
	return color;
}
vec3 NeutralToneMapping( vec3 color ) {
	const float StartCompression = 0.8 - 0.04;
	const float Desaturation = 0.15;
	color *= toneMappingExposure;
	float x = min( color.r, min( color.g, color.b ) );
	float offset = x < 0.08 ? x - 6.25 * x * x : 0.04;
	color -= offset;
	float peak = max( color.r, max( color.g, color.b ) );
	if ( peak < StartCompression ) return color;
	float d = 1. - StartCompression;
	float newPeak = 1. - d * d / ( peak + d - StartCompression );
	color *= newPeak / peak;
	float g = 1. - 1. / ( Desaturation * ( peak - newPeak ) + 1. );
	return mix( color, vec3( newPeak ), g );
}
vec3 CustomToneMapping( vec3 color ) { return color; }`,eNe=`#ifdef USE_TRANSMISSION
	material.transmission = transmission;
	material.transmissionAlpha = 1.0;
	material.thickness = thickness;
	material.attenuationDistance = attenuationDistance;
	material.attenuationColor = attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		material.transmission *= texture2D( transmissionMap, vTransmissionMapUv ).r;
	#endif
	#ifdef USE_THICKNESSMAP
		material.thickness *= texture2D( thicknessMap, vThicknessMapUv ).g;
	#endif
	vec3 pos = vWorldPosition;
	vec3 v = normalize( cameraPosition - pos );
	vec3 n = inverseTransformDirection( normal, viewMatrix );
	vec4 transmitted = getIBLVolumeRefraction(
		n, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,
		pos, modelMatrix, viewMatrix, projectionMatrix, material.dispersion, material.ior, material.thickness,
		material.attenuationColor, material.attenuationDistance );
	material.transmissionAlpha = mix( material.transmissionAlpha, transmitted.a, material.transmission );
	totalDiffuse = mix( totalDiffuse, transmitted.rgb, material.transmission );
#endif`,tNe=`#ifdef USE_TRANSMISSION
	uniform float transmission;
	uniform float thickness;
	uniform float attenuationDistance;
	uniform vec3 attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		uniform sampler2D transmissionMap;
	#endif
	#ifdef USE_THICKNESSMAP
		uniform sampler2D thicknessMap;
	#endif
	uniform vec2 transmissionSamplerSize;
	uniform sampler2D transmissionSamplerMap;
	uniform mat4 modelMatrix;
	uniform mat4 projectionMatrix;
	varying vec3 vWorldPosition;
	float w0( float a ) {
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - a + 3.0 ) - 3.0 ) + 1.0 );
	}
	float w1( float a ) {
		return ( 1.0 / 6.0 ) * ( a *  a * ( 3.0 * a - 6.0 ) + 4.0 );
	}
	float w2( float a ){
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - 3.0 * a + 3.0 ) + 3.0 ) + 1.0 );
	}
	float w3( float a ) {
		return ( 1.0 / 6.0 ) * ( a * a * a );
	}
	float g0( float a ) {
		return w0( a ) + w1( a );
	}
	float g1( float a ) {
		return w2( a ) + w3( a );
	}
	float h0( float a ) {
		return - 1.0 + w1( a ) / ( w0( a ) + w1( a ) );
	}
	float h1( float a ) {
		return 1.0 + w3( a ) / ( w2( a ) + w3( a ) );
	}
	vec4 bicubic( sampler2D tex, vec2 uv, vec4 texelSize, float lod ) {
		uv = uv * texelSize.zw + 0.5;
		vec2 iuv = floor( uv );
		vec2 fuv = fract( uv );
		float g0x = g0( fuv.x );
		float g1x = g1( fuv.x );
		float h0x = h0( fuv.x );
		float h1x = h1( fuv.x );
		float h0y = h0( fuv.y );
		float h1y = h1( fuv.y );
		vec2 p0 = ( vec2( iuv.x + h0x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p1 = ( vec2( iuv.x + h1x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p2 = ( vec2( iuv.x + h0x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		vec2 p3 = ( vec2( iuv.x + h1x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		return g0( fuv.y ) * ( g0x * textureLod( tex, p0, lod ) + g1x * textureLod( tex, p1, lod ) ) +
			g1( fuv.y ) * ( g0x * textureLod( tex, p2, lod ) + g1x * textureLod( tex, p3, lod ) );
	}
	vec4 textureBicubic( sampler2D sampler, vec2 uv, float lod ) {
		vec2 fLodSize = vec2( textureSize( sampler, int( lod ) ) );
		vec2 cLodSize = vec2( textureSize( sampler, int( lod + 1.0 ) ) );
		vec2 fLodSizeInv = 1.0 / fLodSize;
		vec2 cLodSizeInv = 1.0 / cLodSize;
		vec4 fSample = bicubic( sampler, uv, vec4( fLodSizeInv, fLodSize ), floor( lod ) );
		vec4 cSample = bicubic( sampler, uv, vec4( cLodSizeInv, cLodSize ), ceil( lod ) );
		return mix( fSample, cSample, fract( lod ) );
	}
	vec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {
		vec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );
		vec3 modelScale;
		modelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );
		modelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );
		modelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );
		return normalize( refractionVector ) * thickness * modelScale;
	}
	float applyIorToRoughness( const in float roughness, const in float ior ) {
		return roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );
	}
	vec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {
		float lod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );
		return textureBicubic( transmissionSamplerMap, fragCoord.xy, lod );
	}
	vec3 volumeAttenuation( const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {
		if ( isinf( attenuationDistance ) ) {
			return vec3( 1.0 );
		} else {
			vec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;
			vec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );			return transmittance;
		}
	}
	vec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,
		const in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,
		const in mat4 viewMatrix, const in mat4 projMatrix, const in float dispersion, const in float ior, const in float thickness,
		const in vec3 attenuationColor, const in float attenuationDistance ) {
		vec4 transmittedLight;
		vec3 transmittance;
		#ifdef USE_DISPERSION
			float halfSpread = ( ior - 1.0 ) * 0.025 * dispersion;
			vec3 iors = vec3( ior - halfSpread, ior, ior + halfSpread );
			for ( int i = 0; i < 3; i ++ ) {
				vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, iors[ i ], modelMatrix );
				vec3 refractedRayExit = position + transmissionRay;
				vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
				vec2 refractionCoords = ndcPos.xy / ndcPos.w;
				refractionCoords += 1.0;
				refractionCoords /= 2.0;
				vec4 transmissionSample = getTransmissionSample( refractionCoords, roughness, iors[ i ] );
				transmittedLight[ i ] = transmissionSample[ i ];
				transmittedLight.a += transmissionSample.a;
				transmittance[ i ] = diffuseColor[ i ] * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance )[ i ];
			}
			transmittedLight.a /= 3.0;
		#else
			vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );
			vec3 refractedRayExit = position + transmissionRay;
			vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
			vec2 refractionCoords = ndcPos.xy / ndcPos.w;
			refractionCoords += 1.0;
			refractionCoords /= 2.0;
			transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );
			transmittance = diffuseColor * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance );
		#endif
		vec3 attenuatedColor = transmittance * transmittedLight.rgb;
		vec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );
		float transmittanceFactor = ( transmittance.r + transmittance.g + transmittance.b ) / 3.0;
		return vec4( ( 1.0 - F ) * attenuatedColor, 1.0 - ( 1.0 - transmittedLight.a ) * transmittanceFactor );
	}
#endif`,iNe=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_ANISOTROPYMAP
	varying vec2 vAnisotropyMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_SPECULARMAP
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,rNe=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	uniform mat3 mapTransform;
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	uniform mat3 alphaMapTransform;
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	uniform mat3 lightMapTransform;
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	uniform mat3 aoMapTransform;
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	uniform mat3 bumpMapTransform;
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	uniform mat3 normalMapTransform;
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_DISPLACEMENTMAP
	uniform mat3 displacementMapTransform;
	varying vec2 vDisplacementMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	uniform mat3 emissiveMapTransform;
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	uniform mat3 metalnessMapTransform;
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	uniform mat3 roughnessMapTransform;
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_ANISOTROPYMAP
	uniform mat3 anisotropyMapTransform;
	varying vec2 vAnisotropyMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	uniform mat3 clearcoatMapTransform;
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform mat3 clearcoatNormalMapTransform;
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform mat3 clearcoatRoughnessMapTransform;
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	uniform mat3 sheenColorMapTransform;
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	uniform mat3 sheenRoughnessMapTransform;
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	uniform mat3 iridescenceMapTransform;
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform mat3 iridescenceThicknessMapTransform;
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SPECULARMAP
	uniform mat3 specularMapTransform;
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	uniform mat3 specularColorMapTransform;
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	uniform mat3 specularIntensityMapTransform;
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,nNe=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	vUv = vec3( uv, 1 ).xy;
#endif
#ifdef USE_MAP
	vMapUv = ( mapTransform * vec3( MAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ALPHAMAP
	vAlphaMapUv = ( alphaMapTransform * vec3( ALPHAMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_LIGHTMAP
	vLightMapUv = ( lightMapTransform * vec3( LIGHTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_AOMAP
	vAoMapUv = ( aoMapTransform * vec3( AOMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_BUMPMAP
	vBumpMapUv = ( bumpMapTransform * vec3( BUMPMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_NORMALMAP
	vNormalMapUv = ( normalMapTransform * vec3( NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_DISPLACEMENTMAP
	vDisplacementMapUv = ( displacementMapTransform * vec3( DISPLACEMENTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_EMISSIVEMAP
	vEmissiveMapUv = ( emissiveMapTransform * vec3( EMISSIVEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_METALNESSMAP
	vMetalnessMapUv = ( metalnessMapTransform * vec3( METALNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ROUGHNESSMAP
	vRoughnessMapUv = ( roughnessMapTransform * vec3( ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ANISOTROPYMAP
	vAnisotropyMapUv = ( anisotropyMapTransform * vec3( ANISOTROPYMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOATMAP
	vClearcoatMapUv = ( clearcoatMapTransform * vec3( CLEARCOATMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	vClearcoatNormalMapUv = ( clearcoatNormalMapTransform * vec3( CLEARCOAT_NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	vClearcoatRoughnessMapUv = ( clearcoatRoughnessMapTransform * vec3( CLEARCOAT_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCEMAP
	vIridescenceMapUv = ( iridescenceMapTransform * vec3( IRIDESCENCEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	vIridescenceThicknessMapUv = ( iridescenceThicknessMapTransform * vec3( IRIDESCENCE_THICKNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_COLORMAP
	vSheenColorMapUv = ( sheenColorMapTransform * vec3( SHEEN_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	vSheenRoughnessMapUv = ( sheenRoughnessMapTransform * vec3( SHEEN_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULARMAP
	vSpecularMapUv = ( specularMapTransform * vec3( SPECULARMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_COLORMAP
	vSpecularColorMapUv = ( specularColorMapTransform * vec3( SPECULAR_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	vSpecularIntensityMapUv = ( specularIntensityMapTransform * vec3( SPECULAR_INTENSITYMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_TRANSMISSIONMAP
	vTransmissionMapUv = ( transmissionMapTransform * vec3( TRANSMISSIONMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_THICKNESSMAP
	vThicknessMapUv = ( thicknessMapTransform * vec3( THICKNESSMAP_UV, 1 ) ).xy;
#endif`,sNe=`#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0
	vec4 worldPosition = vec4( transformed, 1.0 );
	#ifdef USE_BATCHING
		worldPosition = batchingMatrix * worldPosition;
	#endif
	#ifdef USE_INSTANCING
		worldPosition = instanceMatrix * worldPosition;
	#endif
	worldPosition = modelMatrix * worldPosition;
#endif`;const aNe=`varying vec2 vUv;
uniform mat3 uvTransform;
void main() {
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	gl_Position = vec4( position.xy, 1.0, 1.0 );
}`,oNe=`uniform sampler2D t2D;
uniform float backgroundIntensity;
varying vec2 vUv;
void main() {
	vec4 texColor = texture2D( t2D, vUv );
	#ifdef DECODE_VIDEO_TEXTURE
		texColor = vec4( mix( pow( texColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), texColor.rgb * 0.0773993808, vec3( lessThanEqual( texColor.rgb, vec3( 0.04045 ) ) ) ), texColor.w );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,lNe=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,cNe=`#ifdef ENVMAP_TYPE_CUBE
	uniform samplerCube envMap;
#elif defined( ENVMAP_TYPE_CUBE_UV )
	uniform sampler2D envMap;
#endif
uniform float flipEnvMap;
uniform float backgroundBlurriness;
uniform float backgroundIntensity;
uniform mat3 backgroundRotation;
varying vec3 vWorldDirection;
#include <cube_uv_reflection_fragment>
void main() {
	#ifdef ENVMAP_TYPE_CUBE
		vec4 texColor = textureCube( envMap, backgroundRotation * vec3( flipEnvMap * vWorldDirection.x, vWorldDirection.yz ) );
	#elif defined( ENVMAP_TYPE_CUBE_UV )
		vec4 texColor = textureCubeUV( envMap, backgroundRotation * vWorldDirection, backgroundBlurriness );
	#else
		vec4 texColor = vec4( 0.0, 0.0, 0.0, 1.0 );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,uNe=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,hNe=`uniform samplerCube tCube;
uniform float tFlip;
uniform float opacity;
varying vec3 vWorldDirection;
void main() {
	vec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );
	gl_FragColor = texColor;
	gl_FragColor.a *= opacity;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,dNe=`#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
varying vec2 vHighPrecisionZW;
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <skinbase_vertex>
	#include <morphinstance_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vHighPrecisionZW = gl_Position.zw;
}`,fNe=`#if DEPTH_PACKING == 3200
	uniform float opacity;
#endif
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
varying vec2 vHighPrecisionZW;
void main() {
	vec4 diffuseColor = vec4( 1.0 );
	#include <clipping_planes_fragment>
	#if DEPTH_PACKING == 3200
		diffuseColor.a = opacity;
	#endif
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <logdepthbuf_fragment>
	#ifdef USE_REVERSED_DEPTH_BUFFER
		float fragCoordZ = vHighPrecisionZW[ 0 ] / vHighPrecisionZW[ 1 ];
	#else
		float fragCoordZ = 0.5 * vHighPrecisionZW[ 0 ] / vHighPrecisionZW[ 1 ] + 0.5;
	#endif
	#if DEPTH_PACKING == 3200
		gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );
	#elif DEPTH_PACKING == 3201
		gl_FragColor = packDepthToRGBA( fragCoordZ );
	#elif DEPTH_PACKING == 3202
		gl_FragColor = vec4( packDepthToRGB( fragCoordZ ), 1.0 );
	#elif DEPTH_PACKING == 3203
		gl_FragColor = vec4( packDepthToRG( fragCoordZ ), 0.0, 1.0 );
	#endif
}`,pNe=`#define DISTANCE
varying vec3 vWorldPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <skinbase_vertex>
	#include <morphinstance_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <clipping_planes_vertex>
	vWorldPosition = worldPosition.xyz;
}`,mNe=`#define DISTANCE
uniform vec3 referencePosition;
uniform float nearDistance;
uniform float farDistance;
varying vec3 vWorldPosition;
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <clipping_planes_pars_fragment>
void main () {
	vec4 diffuseColor = vec4( 1.0 );
	#include <clipping_planes_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	float dist = length( vWorldPosition - referencePosition );
	dist = ( dist - nearDistance ) / ( farDistance - nearDistance );
	dist = saturate( dist );
	gl_FragColor = packDepthToRGBA( dist );
}`,gNe=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
}`,vNe=`uniform sampler2D tEquirect;
varying vec3 vWorldDirection;
#include <common>
void main() {
	vec3 direction = normalize( vWorldDirection );
	vec2 sampleUV = equirectUv( direction );
	gl_FragColor = texture2D( tEquirect, sampleUV );
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,yNe=`uniform float scale;
attribute float lineDistance;
varying float vLineDistance;
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	vLineDistance = scale * lineDistance;
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,xNe=`uniform vec3 diffuse;
uniform float opacity;
uniform float dashSize;
uniform float totalSize;
varying float vLineDistance;
#include <common>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	if ( mod( vLineDistance, totalSize ) > dashSize ) {
		discard;
	}
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,bNe=`#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinbase_vertex>
		#include <skinnormal_vertex>
		#include <defaultnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <fog_vertex>
}`,wNe=`uniform vec3 diffuse;
uniform float opacity;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		reflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;
	#else
		reflectedLight.indirectDiffuse += vec3( 1.0 );
	#endif
	#include <aomap_fragment>
	reflectedLight.indirectDiffuse *= diffuseColor.rgb;
	vec3 outgoingLight = reflectedLight.indirectDiffuse;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,_Ne=`#define LAMBERT
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,SNe=`#define LAMBERT
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_lambert_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_lambert_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,ENe=`#define MATCAP
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <displacementmap_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
	vViewPosition = - mvPosition.xyz;
}`,ANe=`#define MATCAP
uniform vec3 diffuse;
uniform float opacity;
uniform sampler2D matcap;
varying vec3 vViewPosition;
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	vec3 viewDir = normalize( vViewPosition );
	vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );
	vec3 y = cross( viewDir, x );
	vec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;
	#ifdef USE_MATCAP
		vec4 matcapColor = texture2D( matcap, uv );
	#else
		vec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );
	#endif
	vec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,MNe=`#define NORMAL
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	vViewPosition = - mvPosition.xyz;
#endif
}`,TNe=`#define NORMAL
uniform float opacity;
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <packing>
#include <uv_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( 0.0, 0.0, 0.0, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	gl_FragColor = vec4( packNormalToRGB( normal ), diffuseColor.a );
	#ifdef OPAQUE
		gl_FragColor.a = 1.0;
	#endif
}`,CNe=`#define PHONG
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,PNe=`#define PHONG
uniform vec3 diffuse;
uniform vec3 emissive;
uniform vec3 specular;
uniform float shininess;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_phong_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_phong_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,RNe=`#define STANDARD
varying vec3 vViewPosition;
#ifdef USE_TRANSMISSION
	varying vec3 vWorldPosition;
#endif
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
#ifdef USE_TRANSMISSION
	vWorldPosition = worldPosition.xyz;
#endif
}`,INe=`#define STANDARD
#ifdef PHYSICAL
	#define IOR
	#define USE_SPECULAR
#endif
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float roughness;
uniform float metalness;
uniform float opacity;
#ifdef IOR
	uniform float ior;
#endif
#ifdef USE_SPECULAR
	uniform float specularIntensity;
	uniform vec3 specularColor;
	#ifdef USE_SPECULAR_COLORMAP
		uniform sampler2D specularColorMap;
	#endif
	#ifdef USE_SPECULAR_INTENSITYMAP
		uniform sampler2D specularIntensityMap;
	#endif
#endif
#ifdef USE_CLEARCOAT
	uniform float clearcoat;
	uniform float clearcoatRoughness;
#endif
#ifdef USE_DISPERSION
	uniform float dispersion;
#endif
#ifdef USE_IRIDESCENCE
	uniform float iridescence;
	uniform float iridescenceIOR;
	uniform float iridescenceThicknessMinimum;
	uniform float iridescenceThicknessMaximum;
#endif
#ifdef USE_SHEEN
	uniform vec3 sheenColor;
	uniform float sheenRoughness;
	#ifdef USE_SHEEN_COLORMAP
		uniform sampler2D sheenColorMap;
	#endif
	#ifdef USE_SHEEN_ROUGHNESSMAP
		uniform sampler2D sheenRoughnessMap;
	#endif
#endif
#ifdef USE_ANISOTROPY
	uniform vec2 anisotropyVector;
	#ifdef USE_ANISOTROPYMAP
		uniform sampler2D anisotropyMap;
	#endif
#endif
varying vec3 vViewPosition;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <iridescence_fragment>
#include <cube_uv_reflection_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_physical_pars_fragment>
#include <fog_pars_fragment>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_physical_pars_fragment>
#include <transmission_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <clearcoat_pars_fragment>
#include <iridescence_pars_fragment>
#include <roughnessmap_pars_fragment>
#include <metalnessmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <roughnessmap_fragment>
	#include <metalnessmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <clearcoat_normal_fragment_begin>
	#include <clearcoat_normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_physical_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;
	vec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;
	#include <transmission_fragment>
	vec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;
	#ifdef USE_SHEEN
		float sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );
		outgoingLight = outgoingLight * sheenEnergyComp + sheenSpecularDirect + sheenSpecularIndirect;
	#endif
	#ifdef USE_CLEARCOAT
		float dotNVcc = saturate( dot( geometryClearcoatNormal, geometryViewDir ) );
		vec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );
		outgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + ( clearcoatSpecularDirect + clearcoatSpecularIndirect ) * material.clearcoat;
	#endif
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,DNe=`#define TOON
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,ONe=`#define TOON
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <gradientmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_toon_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_toon_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,LNe=`uniform float size;
uniform float scale;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
#ifdef USE_POINTS_UV
	varying vec2 vUv;
	uniform mat3 uvTransform;
#endif
void main() {
	#ifdef USE_POINTS_UV
		vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	#endif
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	gl_PointSize = size;
	#ifdef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );
	#endif
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <fog_vertex>
}`,kNe=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <color_pars_fragment>
#include <map_particle_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_particle_fragment>
	#include <color_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,NNe=`#include <common>
#include <batching_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <shadowmap_pars_vertex>
void main() {
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,UNe=`uniform vec3 color;
uniform float opacity;
#include <common>
#include <packing>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <logdepthbuf_pars_fragment>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
void main() {
	#include <logdepthbuf_fragment>
	gl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
}`,BNe=`uniform float rotation;
uniform vec2 center;
#include <common>
#include <uv_pars_vertex>
#include <fog_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	vec4 mvPosition = modelViewMatrix[ 3 ];
	vec2 scale = vec2( length( modelMatrix[ 0 ].xyz ), length( modelMatrix[ 1 ].xyz ) );
	#ifndef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) scale *= - mvPosition.z;
	#endif
	vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;
	vec2 rotatedPosition;
	rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
	rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
	mvPosition.xy += rotatedPosition;
	gl_Position = projectionMatrix * mvPosition;
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,FNe=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
}`,pr={alphahash_fragment:oLe,alphahash_pars_fragment:lLe,alphamap_fragment:cLe,alphamap_pars_fragment:uLe,alphatest_fragment:hLe,alphatest_pars_fragment:dLe,aomap_fragment:fLe,aomap_pars_fragment:pLe,batching_pars_vertex:mLe,batching_vertex:gLe,begin_vertex:vLe,beginnormal_vertex:yLe,bsdfs:xLe,iridescence_fragment:bLe,bumpmap_pars_fragment:wLe,clipping_planes_fragment:_Le,clipping_planes_pars_fragment:SLe,clipping_planes_pars_vertex:ELe,clipping_planes_vertex:ALe,color_fragment:MLe,color_pars_fragment:TLe,color_pars_vertex:CLe,color_vertex:PLe,common:RLe,cube_uv_reflection_fragment:ILe,defaultnormal_vertex:DLe,displacementmap_pars_vertex:OLe,displacementmap_vertex:LLe,emissivemap_fragment:kLe,emissivemap_pars_fragment:NLe,colorspace_fragment:ULe,colorspace_pars_fragment:BLe,envmap_fragment:FLe,envmap_common_pars_fragment:zLe,envmap_pars_fragment:jLe,envmap_pars_vertex:VLe,envmap_physical_pars_fragment:JLe,envmap_vertex:HLe,fog_vertex:GLe,fog_pars_vertex:WLe,fog_fragment:qLe,fog_pars_fragment:XLe,gradientmap_pars_fragment:$Le,lightmap_pars_fragment:YLe,lights_lambert_fragment:KLe,lights_lambert_pars_fragment:ZLe,lights_pars_begin:QLe,lights_toon_fragment:eke,lights_toon_pars_fragment:tke,lights_phong_fragment:ike,lights_phong_pars_fragment:rke,lights_physical_fragment:nke,lights_physical_pars_fragment:ske,lights_fragment_begin:ake,lights_fragment_maps:oke,lights_fragment_end:lke,logdepthbuf_fragment:cke,logdepthbuf_pars_fragment:uke,logdepthbuf_pars_vertex:hke,logdepthbuf_vertex:dke,map_fragment:fke,map_pars_fragment:pke,map_particle_fragment:mke,map_particle_pars_fragment:gke,metalnessmap_fragment:vke,metalnessmap_pars_fragment:yke,morphinstance_vertex:xke,morphcolor_vertex:bke,morphnormal_vertex:wke,morphtarget_pars_vertex:_ke,morphtarget_vertex:Ske,normal_fragment_begin:Eke,normal_fragment_maps:Ake,normal_pars_fragment:Mke,normal_pars_vertex:Tke,normal_vertex:Cke,normalmap_pars_fragment:Pke,clearcoat_normal_fragment_begin:Rke,clearcoat_normal_fragment_maps:Ike,clearcoat_pars_fragment:Dke,iridescence_pars_fragment:Oke,opaque_fragment:Lke,packing:kke,premultiplied_alpha_fragment:Nke,project_vertex:Uke,dithering_fragment:Bke,dithering_pars_fragment:Fke,roughnessmap_fragment:zke,roughnessmap_pars_fragment:jke,shadowmap_pars_fragment:Vke,shadowmap_pars_vertex:Hke,shadowmap_vertex:Gke,shadowmask_pars_fragment:Wke,skinbase_vertex:qke,skinning_pars_vertex:Xke,skinning_vertex:$ke,skinnormal_vertex:Yke,specularmap_fragment:Kke,specularmap_pars_fragment:Zke,tonemapping_fragment:Qke,tonemapping_pars_fragment:Jke,transmission_fragment:eNe,transmission_pars_fragment:tNe,uv_pars_fragment:iNe,uv_pars_vertex:rNe,uv_vertex:nNe,worldpos_vertex:sNe,background_vert:aNe,background_frag:oNe,backgroundCube_vert:lNe,backgroundCube_frag:cNe,cube_vert:uNe,cube_frag:hNe,depth_vert:dNe,depth_frag:fNe,distanceRGBA_vert:pNe,distanceRGBA_frag:mNe,equirect_vert:gNe,equirect_frag:vNe,linedashed_vert:yNe,linedashed_frag:xNe,meshbasic_vert:bNe,meshbasic_frag:wNe,meshlambert_vert:_Ne,meshlambert_frag:SNe,meshmatcap_vert:ENe,meshmatcap_frag:ANe,meshnormal_vert:MNe,meshnormal_frag:TNe,meshphong_vert:CNe,meshphong_frag:PNe,meshphysical_vert:RNe,meshphysical_frag:INe,meshtoon_vert:DNe,meshtoon_frag:ONe,points_vert:LNe,points_frag:kNe,shadow_vert:NNe,shadow_frag:UNe,sprite_vert:BNe,sprite_frag:FNe},Xt={common:{diffuse:{value:new ii(16777215)},opacity:{value:1},map:{value:null},mapTransform:{value:new lr},alphaMap:{value:null},alphaMapTransform:{value:new lr},alphaTest:{value:0}},specularmap:{specularMap:{value:null},specularMapTransform:{value:new lr}},envmap:{envMap:{value:null},envMapRotation:{value:new lr},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1},aoMapTransform:{value:new lr}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1},lightMapTransform:{value:new lr}},bumpmap:{bumpMap:{value:null},bumpMapTransform:{value:new lr},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalMapTransform:{value:new lr},normalScale:{value:new At(1,1)}},displacementmap:{displacementMap:{value:null},displacementMapTransform:{value:new lr},displacementScale:{value:1},displacementBias:{value:0}},emissivemap:{emissiveMap:{value:null},emissiveMapTransform:{value:new lr}},metalnessmap:{metalnessMap:{value:null},metalnessMapTransform:{value:new lr}},roughnessmap:{roughnessMap:{value:null},roughnessMapTransform:{value:new lr}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new ii(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new ii(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaMapTransform:{value:new lr},alphaTest:{value:0},uvTransform:{value:new lr}},sprite:{diffuse:{value:new ii(16777215)},opacity:{value:1},center:{value:new At(.5,.5)},rotation:{value:0},map:{value:null},mapTransform:{value:new lr},alphaMap:{value:null},alphaMapTransform:{value:new lr},alphaTest:{value:0}}},gh={basic:{uniforms:cl([Xt.common,Xt.specularmap,Xt.envmap,Xt.aomap,Xt.lightmap,Xt.fog]),vertexShader:pr.meshbasic_vert,fragmentShader:pr.meshbasic_frag},lambert:{uniforms:cl([Xt.common,Xt.specularmap,Xt.envmap,Xt.aomap,Xt.lightmap,Xt.emissivemap,Xt.bumpmap,Xt.normalmap,Xt.displacementmap,Xt.fog,Xt.lights,{emissive:{value:new ii(0)}}]),vertexShader:pr.meshlambert_vert,fragmentShader:pr.meshlambert_frag},phong:{uniforms:cl([Xt.common,Xt.specularmap,Xt.envmap,Xt.aomap,Xt.lightmap,Xt.emissivemap,Xt.bumpmap,Xt.normalmap,Xt.displacementmap,Xt.fog,Xt.lights,{emissive:{value:new ii(0)},specular:{value:new ii(1118481)},shininess:{value:30}}]),vertexShader:pr.meshphong_vert,fragmentShader:pr.meshphong_frag},standard:{uniforms:cl([Xt.common,Xt.envmap,Xt.aomap,Xt.lightmap,Xt.emissivemap,Xt.bumpmap,Xt.normalmap,Xt.displacementmap,Xt.roughnessmap,Xt.metalnessmap,Xt.fog,Xt.lights,{emissive:{value:new ii(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:pr.meshphysical_vert,fragmentShader:pr.meshphysical_frag},toon:{uniforms:cl([Xt.common,Xt.aomap,Xt.lightmap,Xt.emissivemap,Xt.bumpmap,Xt.normalmap,Xt.displacementmap,Xt.gradientmap,Xt.fog,Xt.lights,{emissive:{value:new ii(0)}}]),vertexShader:pr.meshtoon_vert,fragmentShader:pr.meshtoon_frag},matcap:{uniforms:cl([Xt.common,Xt.bumpmap,Xt.normalmap,Xt.displacementmap,Xt.fog,{matcap:{value:null}}]),vertexShader:pr.meshmatcap_vert,fragmentShader:pr.meshmatcap_frag},points:{uniforms:cl([Xt.points,Xt.fog]),vertexShader:pr.points_vert,fragmentShader:pr.points_frag},dashed:{uniforms:cl([Xt.common,Xt.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:pr.linedashed_vert,fragmentShader:pr.linedashed_frag},depth:{uniforms:cl([Xt.common,Xt.displacementmap]),vertexShader:pr.depth_vert,fragmentShader:pr.depth_frag},normal:{uniforms:cl([Xt.common,Xt.bumpmap,Xt.normalmap,Xt.displacementmap,{opacity:{value:1}}]),vertexShader:pr.meshnormal_vert,fragmentShader:pr.meshnormal_frag},sprite:{uniforms:cl([Xt.sprite,Xt.fog]),vertexShader:pr.sprite_vert,fragmentShader:pr.sprite_frag},background:{uniforms:{uvTransform:{value:new lr},t2D:{value:null},backgroundIntensity:{value:1}},vertexShader:pr.background_vert,fragmentShader:pr.background_frag},backgroundCube:{uniforms:{envMap:{value:null},flipEnvMap:{value:-1},backgroundBlurriness:{value:0},backgroundIntensity:{value:1},backgroundRotation:{value:new lr}},vertexShader:pr.backgroundCube_vert,fragmentShader:pr.backgroundCube_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:pr.cube_vert,fragmentShader:pr.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:pr.equirect_vert,fragmentShader:pr.equirect_frag},distanceRGBA:{uniforms:cl([Xt.common,Xt.displacementmap,{referencePosition:{value:new be},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:pr.distanceRGBA_vert,fragmentShader:pr.distanceRGBA_frag},shadow:{uniforms:cl([Xt.lights,Xt.fog,{color:{value:new ii(0)},opacity:{value:1}}]),vertexShader:pr.shadow_vert,fragmentShader:pr.shadow_frag}};gh.physical={uniforms:cl([gh.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatMapTransform:{value:new lr},clearcoatNormalMap:{value:null},clearcoatNormalMapTransform:{value:new lr},clearcoatNormalScale:{value:new At(1,1)},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatRoughnessMapTransform:{value:new lr},dispersion:{value:0},iridescence:{value:0},iridescenceMap:{value:null},iridescenceMapTransform:{value:new lr},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},iridescenceThicknessMapTransform:{value:new lr},sheen:{value:0},sheenColor:{value:new ii(0)},sheenColorMap:{value:null},sheenColorMapTransform:{value:new lr},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},sheenRoughnessMapTransform:{value:new lr},transmission:{value:0},transmissionMap:{value:null},transmissionMapTransform:{value:new lr},transmissionSamplerSize:{value:new At},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},thicknessMapTransform:{value:new lr},attenuationDistance:{value:0},attenuationColor:{value:new ii(0)},specularColor:{value:new ii(1,1,1)},specularColorMap:{value:null},specularColorMapTransform:{value:new lr},specularIntensity:{value:1},specularIntensityMap:{value:null},specularIntensityMapTransform:{value:new lr},anisotropyVector:{value:new At},anisotropyMap:{value:null},anisotropyMapTransform:{value:new lr}}]),vertexShader:pr.meshphysical_vert,fragmentShader:pr.meshphysical_frag};const eP={r:0,b:0,g:0},wy=new kc,zNe=new zi;function jNe(t,e,i,r,n,s,a){const o=new ii(0);let l=s===!0?0:1,c,u,h=null,d=0,f=null;function p(w){let E=w.isScene===!0?w.background:null;return E&&E.isTexture&&(E=(w.backgroundBlurriness>0?i:e).get(E)),E}function g(w){let E=!1;const M=p(w);M===null?y(o,l):M&&M.isColor&&(y(M,1),E=!0);const A=t.xr.getEnvironmentBlendMode();A==="additive"?r.buffers.color.setClear(0,0,0,1,a):A==="alpha-blend"&&r.buffers.color.setClear(0,0,0,0,a),(t.autoClear||E)&&(r.buffers.depth.setTest(!0),r.buffers.depth.setMask(!0),r.buffers.color.setMask(!0),t.clear(t.autoClearColor,t.autoClearDepth,t.autoClearStencil))}function m(w,E){const M=p(E);M&&(M.isCubeTexture||M.mapping===p_)?(u===void 0&&(u=new js(new W0(1,1,1),new Ch({name:"BackgroundCubeMaterial",uniforms:N1(gh.backgroundCube.uniforms),vertexShader:gh.backgroundCube.vertexShader,fragmentShader:gh.backgroundCube.fragmentShader,side:bl,depthTest:!1,depthWrite:!1,fog:!1,allowOverride:!1})),u.geometry.deleteAttribute("normal"),u.geometry.deleteAttribute("uv"),u.onBeforeRender=function(A,P,C){this.matrixWorld.copyPosition(C.matrixWorld)},Object.defineProperty(u.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),n.update(u)),wy.copy(E.backgroundRotation),wy.x*=-1,wy.y*=-1,wy.z*=-1,M.isCubeTexture&&M.isRenderTargetTexture===!1&&(wy.y*=-1,wy.z*=-1),u.material.uniforms.envMap.value=M,u.material.uniforms.flipEnvMap.value=M.isCubeTexture&&M.isRenderTargetTexture===!1?-1:1,u.material.uniforms.backgroundBlurriness.value=E.backgroundBlurriness,u.material.uniforms.backgroundIntensity.value=E.backgroundIntensity,u.material.uniforms.backgroundRotation.value.setFromMatrix4(zNe.makeRotationFromEuler(wy)),u.material.toneMapped=Lr.getTransfer(M.colorSpace)!==on,(h!==M||d!==M.version||f!==t.toneMapping)&&(u.material.needsUpdate=!0,h=M,d=M.version,f=t.toneMapping),u.layers.enableAll(),w.unshift(u,u.geometry,u.material,0,0,null)):M&&M.isTexture&&(c===void 0&&(c=new js(new y_(2,2),new Ch({name:"BackgroundMaterial",uniforms:N1(gh.background.uniforms),vertexShader:gh.background.vertexShader,fragmentShader:gh.background.fragmentShader,side:Fp,depthTest:!1,depthWrite:!1,fog:!1,allowOverride:!1})),c.geometry.deleteAttribute("normal"),Object.defineProperty(c.material,"map",{get:function(){return this.uniforms.t2D.value}}),n.update(c)),c.material.uniforms.t2D.value=M,c.material.uniforms.backgroundIntensity.value=E.backgroundIntensity,c.material.toneMapped=Lr.getTransfer(M.colorSpace)!==on,M.matrixAutoUpdate===!0&&M.updateMatrix(),c.material.uniforms.uvTransform.value.copy(M.matrix),(h!==M||d!==M.version||f!==t.toneMapping)&&(c.material.needsUpdate=!0,h=M,d=M.version,f=t.toneMapping),c.layers.enableAll(),w.unshift(c,c.geometry,c.material,0,0,null))}function y(w,E){w.getRGB(eP,Goe(t)),r.buffers.color.setClear(eP.r,eP.g,eP.b,E,a)}function b(){u!==void 0&&(u.geometry.dispose(),u.material.dispose(),u=void 0),c!==void 0&&(c.geometry.dispose(),c.material.dispose(),c=void 0)}return{getClearColor:function(){return o},setClearColor:function(w,E=1){o.set(w),l=E,y(o,l)},getClearAlpha:function(){return l},setClearAlpha:function(w){l=w,y(o,l)},render:g,addToRenderList:m,dispose:b}}function VNe(t,e){const i=t.getParameter(t.MAX_VERTEX_ATTRIBS),r={},n=d(null);let s=n,a=!1;function o(I,k,z,V,F){let $=!1;const K=h(V,z,k);s!==K&&(s=K,c(s.object)),$=f(I,V,z,F),$&&p(I,V,z,F),F!==null&&e.update(F,t.ELEMENT_ARRAY_BUFFER),($||a)&&(a=!1,E(I,k,z,V),F!==null&&t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,e.get(F).buffer))}function l(){return t.createVertexArray()}function c(I){return t.bindVertexArray(I)}function u(I){return t.deleteVertexArray(I)}function h(I,k,z){const V=z.wireframe===!0;let F=r[I.id];F===void 0&&(F={},r[I.id]=F);let $=F[k.id];$===void 0&&($={},F[k.id]=$);let K=$[V];return K===void 0&&(K=d(l()),$[V]=K),K}function d(I){const k=[],z=[],V=[];for(let F=0;F<i;F++)k[F]=0,z[F]=0,V[F]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:k,enabledAttributes:z,attributeDivisors:V,object:I,attributes:{},index:null}}function f(I,k,z,V){const F=s.attributes,$=k.attributes;let K=0;const X=z.getAttributes();for(const U in X)if(X[U].location>=0){const Z=F[U];let j=$[U];if(j===void 0&&(U==="instanceMatrix"&&I.instanceMatrix&&(j=I.instanceMatrix),U==="instanceColor"&&I.instanceColor&&(j=I.instanceColor)),Z===void 0||Z.attribute!==j||j&&Z.data!==j.data)return!0;K++}return s.attributesNum!==K||s.index!==V}function p(I,k,z,V){const F={},$=k.attributes;let K=0;const X=z.getAttributes();for(const U in X)if(X[U].location>=0){let Z=$[U];Z===void 0&&(U==="instanceMatrix"&&I.instanceMatrix&&(Z=I.instanceMatrix),U==="instanceColor"&&I.instanceColor&&(Z=I.instanceColor));const j={};j.attribute=Z,Z&&Z.data&&(j.data=Z.data),F[U]=j,K++}s.attributes=F,s.attributesNum=K,s.index=V}function g(){const I=s.newAttributes;for(let k=0,z=I.length;k<z;k++)I[k]=0}function m(I){y(I,0)}function y(I,k){const z=s.newAttributes,V=s.enabledAttributes,F=s.attributeDivisors;z[I]=1,V[I]===0&&(t.enableVertexAttribArray(I),V[I]=1),F[I]!==k&&(t.vertexAttribDivisor(I,k),F[I]=k)}function b(){const I=s.newAttributes,k=s.enabledAttributes;for(let z=0,V=k.length;z<V;z++)k[z]!==I[z]&&(t.disableVertexAttribArray(z),k[z]=0)}function w(I,k,z,V,F,$,K){K===!0?t.vertexAttribIPointer(I,k,z,F,$):t.vertexAttribPointer(I,k,z,V,F,$)}function E(I,k,z,V){g();const F=V.attributes,$=z.getAttributes(),K=k.defaultAttributeValues;for(const X in $){const U=$[X];if(U.location>=0){let Y=F[X];if(Y===void 0&&(X==="instanceMatrix"&&I.instanceMatrix&&(Y=I.instanceMatrix),X==="instanceColor"&&I.instanceColor&&(Y=I.instanceColor)),Y!==void 0){const Z=Y.normalized,j=Y.itemSize,ee=e.get(Y);if(ee===void 0)continue;const pe=ee.buffer,fe=ee.type,se=ee.bytesPerElement,re=fe===t.INT||fe===t.UNSIGNED_INT||Y.gpuType===vO;if(Y.isInterleavedBufferAttribute){const le=Y.data,he=le.stride,ve=Y.offset;if(le.isInstancedInterleavedBuffer){for(let xe=0;xe<U.locationSize;xe++)y(U.location+xe,le.meshPerAttribute);I.isInstancedMesh!==!0&&V._maxInstanceCount===void 0&&(V._maxInstanceCount=le.meshPerAttribute*le.count)}else for(let xe=0;xe<U.locationSize;xe++)m(U.location+xe);t.bindBuffer(t.ARRAY_BUFFER,pe);for(let xe=0;xe<U.locationSize;xe++)w(U.location+xe,j/U.locationSize,fe,Z,he*se,(ve+j/U.locationSize*xe)*se,re)}else{if(Y.isInstancedBufferAttribute){for(let le=0;le<U.locationSize;le++)y(U.location+le,Y.meshPerAttribute);I.isInstancedMesh!==!0&&V._maxInstanceCount===void 0&&(V._maxInstanceCount=Y.meshPerAttribute*Y.count)}else for(let le=0;le<U.locationSize;le++)m(U.location+le);t.bindBuffer(t.ARRAY_BUFFER,pe);for(let le=0;le<U.locationSize;le++)w(U.location+le,j/U.locationSize,fe,Z,j*se,j/U.locationSize*le*se,re)}}else if(K!==void 0){const Z=K[X];if(Z!==void 0)switch(Z.length){case 2:t.vertexAttrib2fv(U.location,Z);break;case 3:t.vertexAttrib3fv(U.location,Z);break;case 4:t.vertexAttrib4fv(U.location,Z);break;default:t.vertexAttrib1fv(U.location,Z)}}}}b()}function M(){C();for(const I in r){const k=r[I];for(const z in k){const V=k[z];for(const F in V)u(V[F].object),delete V[F];delete k[z]}delete r[I]}}function A(I){if(r[I.id]===void 0)return;const k=r[I.id];for(const z in k){const V=k[z];for(const F in V)u(V[F].object),delete V[F];delete k[z]}delete r[I.id]}function P(I){for(const k in r){const z=r[k];if(z[I.id]===void 0)continue;const V=z[I.id];for(const F in V)u(V[F].object),delete V[F];delete z[I.id]}}function C(){R(),a=!0,s!==n&&(s=n,c(s.object))}function R(){n.geometry=null,n.program=null,n.wireframe=!1}return{setup:o,reset:C,resetDefaultState:R,dispose:M,releaseStatesOfGeometry:A,releaseStatesOfProgram:P,initAttributes:g,enableAttribute:m,disableUnusedAttributes:b}}function HNe(t,e,i){let r;function n(c){r=c}function s(c,u){t.drawArrays(r,c,u),i.update(u,r,1)}function a(c,u,h){h!==0&&(t.drawArraysInstanced(r,c,u,h),i.update(u,r,h))}function o(c,u,h){if(h===0)return;e.get("WEBGL_multi_draw").multiDrawArraysWEBGL(r,c,0,u,0,h);let f=0;for(let p=0;p<h;p++)f+=u[p];i.update(f,r,1)}function l(c,u,h,d){if(h===0)return;const f=e.get("WEBGL_multi_draw");if(f===null)for(let p=0;p<c.length;p++)a(c[p],u[p],d[p]);else{f.multiDrawArraysInstancedWEBGL(r,c,0,u,0,d,0,h);let p=0;for(let g=0;g<h;g++)p+=u[g]*d[g];i.update(p,r,1)}}this.setMode=n,this.render=s,this.renderInstances=a,this.renderMultiDraw=o,this.renderMultiDrawInstances=l}function GNe(t,e,i,r){let n;function s(){if(n!==void 0)return n;if(e.has("EXT_texture_filter_anisotropic")===!0){const P=e.get("EXT_texture_filter_anisotropic");n=t.getParameter(P.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else n=0;return n}function a(P){return!(P!==zo&&r.convert(P)!==t.getParameter(t.IMPLEMENTATION_COLOR_READ_FORMAT))}function o(P){const C=P===m_&&(e.has("EXT_color_buffer_half_float")||e.has("EXT_color_buffer_float"));return!(P!==_u&&r.convert(P)!==t.getParameter(t.IMPLEMENTATION_COLOR_READ_TYPE)&&P!==tc&&!C)}function l(P){if(P==="highp"){if(t.getShaderPrecisionFormat(t.VERTEX_SHADER,t.HIGH_FLOAT).precision>0&&t.getShaderPrecisionFormat(t.FRAGMENT_SHADER,t.HIGH_FLOAT).precision>0)return"highp";P="mediump"}return P==="mediump"&&t.getShaderPrecisionFormat(t.VERTEX_SHADER,t.MEDIUM_FLOAT).precision>0&&t.getShaderPrecisionFormat(t.FRAGMENT_SHADER,t.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}let c=i.precision!==void 0?i.precision:"highp";const u=l(c);u!==c&&(console.warn("THREE.WebGLRenderer:",c,"not supported, using",u,"instead."),c=u);const h=i.logarithmicDepthBuffer===!0,d=i.reversedDepthBuffer===!0&&e.has("EXT_clip_control"),f=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS),p=t.getParameter(t.MAX_VERTEX_TEXTURE_IMAGE_UNITS),g=t.getParameter(t.MAX_TEXTURE_SIZE),m=t.getParameter(t.MAX_CUBE_MAP_TEXTURE_SIZE),y=t.getParameter(t.MAX_VERTEX_ATTRIBS),b=t.getParameter(t.MAX_VERTEX_UNIFORM_VECTORS),w=t.getParameter(t.MAX_VARYING_VECTORS),E=t.getParameter(t.MAX_FRAGMENT_UNIFORM_VECTORS),M=p>0,A=t.getParameter(t.MAX_SAMPLES);return{isWebGL2:!0,getMaxAnisotropy:s,getMaxPrecision:l,textureFormatReadable:a,textureTypeReadable:o,precision:c,logarithmicDepthBuffer:h,reversedDepthBuffer:d,maxTextures:f,maxVertexTextures:p,maxTextureSize:g,maxCubemapSize:m,maxAttributes:y,maxVertexUniforms:b,maxVaryings:w,maxFragmentUniforms:E,vertexTextures:M,maxSamples:A}}function WNe(t){const e=this;let i=null,r=0,n=!1,s=!1;const a=new fg,o=new lr,l={value:null,needsUpdate:!1};this.uniform=l,this.numPlanes=0,this.numIntersection=0,this.init=function(h,d){const f=h.length!==0||d||r!==0||n;return n=d,r=h.length,f},this.beginShadows=function(){s=!0,u(null)},this.endShadows=function(){s=!1},this.setGlobalState=function(h,d){i=u(h,d,0)},this.setState=function(h,d,f){const p=h.clippingPlanes,g=h.clipIntersection,m=h.clipShadows,y=t.get(h);if(!n||p===null||p.length===0||s&&!m)s?u(null):c();else{const b=s?0:r,w=b*4;let E=y.clippingState||null;l.value=E,E=u(p,d,w,f);for(let M=0;M!==w;++M)E[M]=i[M];y.clippingState=E,this.numIntersection=g?this.numPlanes:0,this.numPlanes+=b}};function c(){l.value!==i&&(l.value=i,l.needsUpdate=r>0),e.numPlanes=r,e.numIntersection=0}function u(h,d,f,p){const g=h!==null?h.length:0;let m=null;if(g!==0){if(m=l.value,p!==!0||m===null){const y=f+g*4,b=d.matrixWorldInverse;o.getNormalMatrix(b),(m===null||m.length<y)&&(m=new Float32Array(y));for(let w=0,E=f;w!==g;++w,E+=4)a.copy(h[w]).applyMatrix4(b,o),a.normal.toArray(m,E),m[E+3]=a.constant}l.value=m,l.needsUpdate=!0}return e.numPlanes=g,e.numIntersection=0,m}}function qNe(t){let e=new WeakMap;function i(a,o){return o===lM?a.mapping=zp:o===cM&&(a.mapping=Jg),a}function r(a){if(a&&a.isTexture){const o=a.mapping;if(o===lM||o===cM)if(e.has(a)){const l=e.get(a).texture;return i(l,a.mapping)}else{const l=a.image;if(l&&l.height>0){const c=new Q6(l.height);return c.fromEquirectangularTexture(t,a),e.set(a,c),a.addEventListener("dispose",n),i(c.texture,a.mapping)}else return null}}return a}function n(a){const o=a.target;o.removeEventListener("dispose",n);const l=e.get(o);l!==void 0&&(e.delete(o),l.dispose())}function s(){e=new WeakMap}return{get:r,dispose:s}}const Ww=4,dY=[.125,.215,.35,.446,.526,.582],jy=20,$U=new MT,fY=new ii;let YU=null,KU=0,ZU=0,QU=!1;const ky=(1+Math.sqrt(5))/2,Rb=1/ky,pY=[new be(-ky,Rb,0),new be(ky,Rb,0),new be(-Rb,0,ky),new be(Rb,0,ky),new be(0,ky,-Rb),new be(0,ky,Rb),new be(-1,1,-1),new be(1,1,-1),new be(-1,1,1),new be(1,1,1)],XNe=new be;class ij{constructor(e){this._renderer=e,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(e,i=0,r=.1,n=100,s={}){const{size:a=256,position:o=XNe}=s;YU=this._renderer.getRenderTarget(),KU=this._renderer.getActiveCubeFace(),ZU=this._renderer.getActiveMipmapLevel(),QU=this._renderer.xr.enabled,this._renderer.xr.enabled=!1,this._setSize(a);const l=this._allocateTargets();return l.depthBuffer=!0,this._sceneToCubeUV(e,r,n,l,o),i>0&&this._blur(l,0,0,i),this._applyPMREM(l),this._cleanup(l),l}fromEquirectangular(e,i=null){return this._fromTexture(e,i)}fromCubemap(e,i=null){return this._fromTexture(e,i)}compileCubemapShader(){this._cubemapMaterial===null&&(this._cubemapMaterial=vY(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){this._equirectMaterial===null&&(this._equirectMaterial=gY(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),this._cubemapMaterial!==null&&this._cubemapMaterial.dispose(),this._equirectMaterial!==null&&this._equirectMaterial.dispose()}_setSize(e){this._lodMax=Math.floor(Math.log2(e)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){this._blurMaterial!==null&&this._blurMaterial.dispose(),this._pingPongRenderTarget!==null&&this._pingPongRenderTarget.dispose();for(let e=0;e<this._lodPlanes.length;e++)this._lodPlanes[e].dispose()}_cleanup(e){this._renderer.setRenderTarget(YU,KU,ZU),this._renderer.xr.enabled=QU,e.scissorTest=!1,tP(e,0,0,e.width,e.height)}_fromTexture(e,i){e.mapping===zp||e.mapping===Jg?this._setSize(e.image.length===0?16:e.image[0].width||e.image[0].image.width):this._setSize(e.image.width/4),YU=this._renderer.getRenderTarget(),KU=this._renderer.getActiveCubeFace(),ZU=this._renderer.getActiveMipmapLevel(),QU=this._renderer.xr.enabled,this._renderer.xr.enabled=!1;const r=i||this._allocateTargets();return this._textureToCubeUV(e,r),this._applyPMREM(r),this._cleanup(r),r}_allocateTargets(){const e=3*Math.max(this._cubeSize,112),i=4*this._cubeSize,r={magFilter:ma,minFilter:ma,generateMipmaps:!1,type:m_,format:zo,colorSpace:T0,depthBuffer:!1},n=mY(e,i,r);if(this._pingPongRenderTarget===null||this._pingPongRenderTarget.width!==e||this._pingPongRenderTarget.height!==i){this._pingPongRenderTarget!==null&&this._dispose(),this._pingPongRenderTarget=mY(e,i,r);const{_lodMax:s}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=$Ne(s)),this._blurMaterial=YNe(s,e,i)}return n}_compileMaterial(e){const i=new js(this._lodPlanes[0],e);this._renderer.compile(i,$U)}_sceneToCubeUV(e,i,r,n,s){const l=new ja(90,1,i,r),c=[1,-1,1,1,1,1],u=[1,1,1,-1,-1,-1],h=this._renderer,d=h.autoClear,f=h.toneMapping;h.getClearColor(fY),h.toneMapping=jd,h.autoClear=!1,h.state.buffers.depth.getReversed()&&(h.setRenderTarget(n),h.clearDepth(),h.setRenderTarget(null));const g=new uv({name:"PMREM.Background",side:bl,depthWrite:!1,depthTest:!1}),m=new js(new W0,g);let y=!1;const b=e.background;b?b.isColor&&(g.color.copy(b),e.background=null,y=!0):(g.color.copy(fY),y=!0);for(let w=0;w<6;w++){const E=w%3;E===0?(l.up.set(0,c[w],0),l.position.set(s.x,s.y,s.z),l.lookAt(s.x+u[w],s.y,s.z)):E===1?(l.up.set(0,0,c[w]),l.position.set(s.x,s.y,s.z),l.lookAt(s.x,s.y+u[w],s.z)):(l.up.set(0,c[w],0),l.position.set(s.x,s.y,s.z),l.lookAt(s.x,s.y,s.z+u[w]));const M=this._cubeSize;tP(n,E*M,w>2?M:0,M,M),h.setRenderTarget(n),y&&h.render(m,l),h.render(e,l)}m.geometry.dispose(),m.material.dispose(),h.toneMapping=f,h.autoClear=d,e.background=b}_textureToCubeUV(e,i){const r=this._renderer,n=e.mapping===zp||e.mapping===Jg;n?(this._cubemapMaterial===null&&(this._cubemapMaterial=vY()),this._cubemapMaterial.uniforms.flipEnvMap.value=e.isRenderTargetTexture===!1?-1:1):this._equirectMaterial===null&&(this._equirectMaterial=gY());const s=n?this._cubemapMaterial:this._equirectMaterial,a=new js(this._lodPlanes[0],s),o=s.uniforms;o.envMap.value=e;const l=this._cubeSize;tP(i,0,0,3*l,2*l),r.setRenderTarget(i),r.render(a,$U)}_applyPMREM(e){const i=this._renderer,r=i.autoClear;i.autoClear=!1;const n=this._lodPlanes.length;for(let s=1;s<n;s++){const a=Math.sqrt(this._sigmas[s]*this._sigmas[s]-this._sigmas[s-1]*this._sigmas[s-1]),o=pY[(n-s-1)%pY.length];this._blur(e,s-1,s,a,o)}i.autoClear=r}_blur(e,i,r,n,s){const a=this._pingPongRenderTarget;this._halfBlur(e,a,i,r,n,"latitudinal",s),this._halfBlur(a,e,r,r,n,"longitudinal",s)}_halfBlur(e,i,r,n,s,a,o){const l=this._renderer,c=this._blurMaterial;a!=="latitudinal"&&a!=="longitudinal"&&console.error("blur direction must be either latitudinal or longitudinal!");const u=3,h=new js(this._lodPlanes[n],c),d=c.uniforms,f=this._sizeLods[r]-1,p=isFinite(s)?Math.PI/(2*f):2*Math.PI/(2*jy-1),g=s/p,m=isFinite(s)?1+Math.floor(u*g):jy;m>jy&&console.warn(`sigmaRadians, ${s}, is too large and will clip, as it requested ${m} samples when the maximum is set to ${jy}`);const y=[];let b=0;for(let P=0;P<jy;++P){const C=P/g,R=Math.exp(-C*C/2);y.push(R),P===0?b+=R:P<m&&(b+=2*R)}for(let P=0;P<y.length;P++)y[P]=y[P]/b;d.envMap.value=e.texture,d.samples.value=m,d.weights.value=y,d.latitudinal.value=a==="latitudinal",o&&(d.poleAxis.value=o);const{_lodMax:w}=this;d.dTheta.value=p,d.mipInt.value=w-r;const E=this._sizeLods[n],M=3*E*(n>w-Ww?n-w+Ww:0),A=4*(this._cubeSize-E);tP(i,M,A,3*E,2*E),l.setRenderTarget(i),l.render(h,$U)}}function $Ne(t){const e=[],i=[],r=[];let n=t;const s=t-Ww+1+dY.length;for(let a=0;a<s;a++){const o=Math.pow(2,n);i.push(o);let l=1/o;a>t-Ww?l=dY[a-t+Ww-1]:a===0&&(l=0),r.push(l);const c=1/(o-2),u=-c,h=1+c,d=[u,u,h,u,h,h,u,u,h,h,u,h],f=6,p=6,g=3,m=2,y=1,b=new Float32Array(g*p*f),w=new Float32Array(m*p*f),E=new Float32Array(y*p*f);for(let A=0;A<f;A++){const P=A%3*2/3-1,C=A>2?0:-1,R=[P,C,0,P+2/3,C,0,P+2/3,C+1,0,P,C,0,P+2/3,C+1,0,P,C+1,0];b.set(R,g*p*A),w.set(d,m*p*A);const I=[A,A,A,A,A,A];E.set(I,y*p*A)}const M=new dr;M.setAttribute("position",new xn(b,g)),M.setAttribute("uv",new xn(w,m)),M.setAttribute("faceIndex",new xn(E,y)),e.push(M),n>Ww&&n--}return{lodPlanes:e,sizeLods:i,sigmas:r}}function mY(t,e,i){const r=new Qd(t,e,i);return r.texture.mapping=p_,r.texture.name="PMREM.cubeUv",r.scissorTest=!0,r}function tP(t,e,i,r,n){t.viewport.set(e,i,r,n),t.scissor.set(e,i,r,n)}function YNe(t,e,i){const r=new Float32Array(jy),n=new be(0,1,0);return new Ch({name:"SphericalGaussianBlur",defines:{n:jy,CUBEUV_TEXEL_WIDTH:1/e,CUBEUV_TEXEL_HEIGHT:1/i,CUBEUV_MAX_MIP:`${t}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:r},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:n}},vertexShader:EH(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;
			uniform int samples;
			uniform float weights[ n ];
			uniform bool latitudinal;
			uniform float dTheta;
			uniform float mipInt;
			uniform vec3 poleAxis;

			#define ENVMAP_TYPE_CUBE_UV
			#include <cube_uv_reflection_fragment>

			vec3 getSample( float theta, vec3 axis ) {

				float cosTheta = cos( theta );
				// Rodrigues' axis-angle rotation
				vec3 sampleDirection = vOutputDirection * cosTheta
					+ cross( axis, vOutputDirection ) * sin( theta )
					+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );

				return bilinearCubeUV( envMap, sampleDirection, mipInt );

			}

			void main() {

				vec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );

				if ( all( equal( axis, vec3( 0.0 ) ) ) ) {

					axis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );

				}

				axis = normalize( axis );

				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );
				gl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );

				for ( int i = 1; i < n; i++ ) {

					if ( i >= samples ) {

						break;

					}

					float theta = dTheta * float( i );
					gl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );
					gl_FragColor.rgb += weights[ i ] * getSample( theta, axis );

				}

			}
		`,blending:Dp,depthTest:!1,depthWrite:!1})}function gY(){return new Ch({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:EH(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;

			#include <common>

			void main() {

				vec3 outputDirection = normalize( vOutputDirection );
				vec2 uv = equirectUv( outputDirection );

				gl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );

			}
		`,blending:Dp,depthTest:!1,depthWrite:!1})}function vY(){return new Ch({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:EH(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			uniform float flipEnvMap;

			varying vec3 vOutputDirection;

			uniform samplerCube envMap;

			void main() {

				gl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );

			}
		`,blending:Dp,depthTest:!1,depthWrite:!1})}function EH(){return`

		precision mediump float;
		precision mediump int;

		attribute float faceIndex;

		varying vec3 vOutputDirection;

		// RH coordinate system; PMREM face-indexing convention
		vec3 getDirection( vec2 uv, float face ) {

			uv = 2.0 * uv - 1.0;

			vec3 direction = vec3( uv, 1.0 );

			if ( face == 0.0 ) {

				direction = direction.zyx; // ( 1, v, u ) pos x

			} else if ( face == 1.0 ) {

				direction = direction.xzy;
				direction.xz *= -1.0; // ( -u, 1, -v ) pos y

			} else if ( face == 2.0 ) {

				direction.x *= -1.0; // ( -u, v, 1 ) pos z

			} else if ( face == 3.0 ) {

				direction = direction.zyx;
				direction.xz *= -1.0; // ( -1, v, -u ) neg x

			} else if ( face == 4.0 ) {

				direction = direction.xzy;
				direction.xy *= -1.0; // ( -u, -1, v ) neg y

			} else if ( face == 5.0 ) {

				direction.z *= -1.0; // ( u, v, -1 ) neg z

			}

			return direction;

		}

		void main() {

			vOutputDirection = getDirection( uv, faceIndex );
			gl_Position = vec4( position, 1.0 );

		}
	`}function KNe(t){let e=new WeakMap,i=null;function r(o){if(o&&o.isTexture){const l=o.mapping,c=l===lM||l===cM,u=l===zp||l===Jg;if(c||u){let h=e.get(o);const d=h!==void 0?h.texture.pmremVersion:0;if(o.isRenderTargetTexture&&o.pmremVersion!==d)return i===null&&(i=new ij(t)),h=c?i.fromEquirectangular(o,h):i.fromCubemap(o,h),h.texture.pmremVersion=o.pmremVersion,e.set(o,h),h.texture;if(h!==void 0)return h.texture;{const f=o.image;return c&&f&&f.height>0||u&&f&&n(f)?(i===null&&(i=new ij(t)),h=c?i.fromEquirectangular(o):i.fromCubemap(o),h.texture.pmremVersion=o.pmremVersion,e.set(o,h),o.addEventListener("dispose",s),h.texture):null}}}return o}function n(o){let l=0;const c=6;for(let u=0;u<c;u++)o[u]!==void 0&&l++;return l===c}function s(o){const l=o.target;l.removeEventListener("dispose",s);const c=e.get(l);c!==void 0&&(e.delete(l),c.dispose())}function a(){e=new WeakMap,i!==null&&(i.dispose(),i=null)}return{get:r,dispose:a}}function ZNe(t){const e={};function i(r){if(e[r]!==void 0)return e[r];let n;switch(r){case"WEBGL_depth_texture":n=t.getExtension("WEBGL_depth_texture")||t.getExtension("MOZ_WEBGL_depth_texture")||t.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":n=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":n=t.getExtension("WEBGL_compressed_texture_s3tc")||t.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":n=t.getExtension("WEBGL_compressed_texture_pvrtc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:n=t.getExtension(r)}return e[r]=n,n}return{has:function(r){return i(r)!==null},init:function(){i("EXT_color_buffer_float"),i("WEBGL_clip_cull_distance"),i("OES_texture_float_linear"),i("EXT_color_buffer_half_float"),i("WEBGL_multisampled_render_to_texture"),i("WEBGL_render_shared_exponent")},get:function(r){const n=i(r);return n===null&&vM("THREE.WebGLRenderer: "+r+" extension not supported."),n}}}function QNe(t,e,i,r){const n={},s=new WeakMap;function a(h){const d=h.target;d.index!==null&&e.remove(d.index);for(const p in d.attributes)e.remove(d.attributes[p]);d.removeEventListener("dispose",a),delete n[d.id];const f=s.get(d);f&&(e.remove(f),s.delete(d)),r.releaseStatesOfGeometry(d),d.isInstancedBufferGeometry===!0&&delete d._maxInstanceCount,i.memory.geometries--}function o(h,d){return n[d.id]===!0||(d.addEventListener("dispose",a),n[d.id]=!0,i.memory.geometries++),d}function l(h){const d=h.attributes;for(const f in d)e.update(d[f],t.ARRAY_BUFFER)}function c(h){const d=[],f=h.index,p=h.attributes.position;let g=0;if(f!==null){const b=f.array;g=f.version;for(let w=0,E=b.length;w<E;w+=3){const M=b[w+0],A=b[w+1],P=b[w+2];d.push(M,A,A,P,P,M)}}else if(p!==void 0){const b=p.array;g=p.version;for(let w=0,E=b.length/3-1;w<E;w+=3){const M=w+0,A=w+1,P=w+2;d.push(M,A,A,P,P,M)}}else return;const m=new(zoe(d)?K6:Y6)(d,1);m.version=g;const y=s.get(h);y&&e.remove(y),s.set(h,m)}function u(h){const d=s.get(h);if(d){const f=h.index;f!==null&&d.version<f.version&&c(h)}else c(h);return s.get(h)}return{get:o,update:l,getWireframeAttribute:u}}function JNe(t,e,i){let r;function n(d){r=d}let s,a;function o(d){s=d.type,a=d.bytesPerElement}function l(d,f){t.drawElements(r,f,s,d*a),i.update(f,r,1)}function c(d,f,p){p!==0&&(t.drawElementsInstanced(r,f,s,d*a,p),i.update(f,r,p))}function u(d,f,p){if(p===0)return;e.get("WEBGL_multi_draw").multiDrawElementsWEBGL(r,f,0,s,d,0,p);let m=0;for(let y=0;y<p;y++)m+=f[y];i.update(m,r,1)}function h(d,f,p,g){if(p===0)return;const m=e.get("WEBGL_multi_draw");if(m===null)for(let y=0;y<d.length;y++)c(d[y]/a,f[y],g[y]);else{m.multiDrawElementsInstancedWEBGL(r,f,0,s,d,0,g,0,p);let y=0;for(let b=0;b<p;b++)y+=f[b]*g[b];i.update(y,r,1)}}this.setMode=n,this.setIndex=o,this.render=l,this.renderInstances=c,this.renderMultiDraw=u,this.renderMultiDrawInstances=h}function eUe(t){const e={geometries:0,textures:0},i={frame:0,calls:0,triangles:0,points:0,lines:0};function r(s,a,o){switch(i.calls++,a){case t.TRIANGLES:i.triangles+=o*(s/3);break;case t.LINES:i.lines+=o*(s/2);break;case t.LINE_STRIP:i.lines+=o*(s-1);break;case t.LINE_LOOP:i.lines+=o*s;break;case t.POINTS:i.points+=o*s;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",a);break}}function n(){i.calls=0,i.triangles=0,i.points=0,i.lines=0}return{memory:e,render:i,programs:null,autoReset:!0,reset:n,update:r}}function tUe(t,e,i){const r=new WeakMap,n=new Ur;function s(a,o,l){const c=a.morphTargetInfluences,u=o.morphAttributes.position||o.morphAttributes.normal||o.morphAttributes.color,h=u!==void 0?u.length:0;let d=r.get(o);if(d===void 0||d.count!==h){let R=function(){P.dispose(),r.delete(o),o.removeEventListener("dispose",R)};d!==void 0&&d.texture.dispose();const f=o.morphAttributes.position!==void 0,p=o.morphAttributes.normal!==void 0,g=o.morphAttributes.color!==void 0,m=o.morphAttributes.position||[],y=o.morphAttributes.normal||[],b=o.morphAttributes.color||[];let w=0;f===!0&&(w=1),p===!0&&(w=2),g===!0&&(w=3);let E=o.attributes.position.count*w,M=1;E>e.maxTextureSize&&(M=Math.ceil(E/e.maxTextureSize),E=e.maxTextureSize);const A=new Float32Array(E*M*4*h),P=new EO(A,E,M,h);P.type=tc,P.needsUpdate=!0;const C=w*4;for(let I=0;I<h;I++){const k=m[I],z=y[I],V=b[I],F=E*M*4*I;for(let $=0;$<k.count;$++){const K=$*C;f===!0&&(n.fromBufferAttribute(k,$),A[F+K+0]=n.x,A[F+K+1]=n.y,A[F+K+2]=n.z,A[F+K+3]=0),p===!0&&(n.fromBufferAttribute(z,$),A[F+K+4]=n.x,A[F+K+5]=n.y,A[F+K+6]=n.z,A[F+K+7]=0),g===!0&&(n.fromBufferAttribute(V,$),A[F+K+8]=n.x,A[F+K+9]=n.y,A[F+K+10]=n.z,A[F+K+11]=V.itemSize===4?n.w:1)}}d={count:h,texture:P,size:new At(E,M)},r.set(o,d),o.addEventListener("dispose",R)}if(a.isInstancedMesh===!0&&a.morphTexture!==null)l.getUniforms().setValue(t,"morphTexture",a.morphTexture,i);else{let f=0;for(let g=0;g<c.length;g++)f+=c[g];const p=o.morphTargetsRelative?1:1-f;l.getUniforms().setValue(t,"morphTargetBaseInfluence",p),l.getUniforms().setValue(t,"morphTargetInfluences",c)}l.getUniforms().setValue(t,"morphTargetsTexture",d.texture,i),l.getUniforms().setValue(t,"morphTargetsTextureSize",d.size)}return{update:s}}function iUe(t,e,i,r){let n=new WeakMap;function s(l){const c=r.render.frame,u=l.geometry,h=e.get(l,u);if(n.get(h)!==c&&(e.update(h),n.set(h,c)),l.isInstancedMesh&&(l.hasEventListener("dispose",o)===!1&&l.addEventListener("dispose",o),n.get(l)!==c&&(i.update(l.instanceMatrix,t.ARRAY_BUFFER),l.instanceColor!==null&&i.update(l.instanceColor,t.ARRAY_BUFFER),n.set(l,c))),l.isSkinnedMesh){const d=l.skeleton;n.get(d)!==c&&(d.update(),n.set(d,c))}return h}function a(){n=new WeakMap}function o(l){const c=l.target;c.removeEventListener("dispose",o),i.remove(c.instanceMatrix),c.instanceColor!==null&&i.remove(c.instanceColor)}return{update:s,dispose:a}}const Gle=new ls,yY=new iH(1,1),Wle=new EO,qle=new AO,Xle=new xT,xY=[],bY=[],wY=new Float32Array(16),_Y=new Float32Array(9),SY=new Float32Array(4);function x_(t,e,i){const r=t[0];if(r<=0||r>0)return t;const n=e*i;let s=xY[n];if(s===void 0&&(s=new Float32Array(n),xY[n]=s),e!==0){r.toArray(s,0);for(let a=1,o=0;a!==e;++a)o+=i,t[a].toArray(s,o)}return s}function ya(t,e){if(t.length!==e.length)return!1;for(let i=0,r=t.length;i<r;i++)if(t[i]!==e[i])return!1;return!0}function xa(t,e){for(let i=0,r=e.length;i<r;i++)t[i]=e[i]}function XO(t,e){let i=bY[e];i===void 0&&(i=new Int32Array(e),bY[e]=i);for(let r=0;r!==e;++r)i[r]=t.allocateTextureUnit();return i}function rUe(t,e){const i=this.cache;i[0]!==e&&(t.uniform1f(this.addr,e),i[0]=e)}function nUe(t,e){const i=this.cache;if(e.x!==void 0)(i[0]!==e.x||i[1]!==e.y)&&(t.uniform2f(this.addr,e.x,e.y),i[0]=e.x,i[1]=e.y);else{if(ya(i,e))return;t.uniform2fv(this.addr,e),xa(i,e)}}function sUe(t,e){const i=this.cache;if(e.x!==void 0)(i[0]!==e.x||i[1]!==e.y||i[2]!==e.z)&&(t.uniform3f(this.addr,e.x,e.y,e.z),i[0]=e.x,i[1]=e.y,i[2]=e.z);else if(e.r!==void 0)(i[0]!==e.r||i[1]!==e.g||i[2]!==e.b)&&(t.uniform3f(this.addr,e.r,e.g,e.b),i[0]=e.r,i[1]=e.g,i[2]=e.b);else{if(ya(i,e))return;t.uniform3fv(this.addr,e),xa(i,e)}}function aUe(t,e){const i=this.cache;if(e.x!==void 0)(i[0]!==e.x||i[1]!==e.y||i[2]!==e.z||i[3]!==e.w)&&(t.uniform4f(this.addr,e.x,e.y,e.z,e.w),i[0]=e.x,i[1]=e.y,i[2]=e.z,i[3]=e.w);else{if(ya(i,e))return;t.uniform4fv(this.addr,e),xa(i,e)}}function oUe(t,e){const i=this.cache,r=e.elements;if(r===void 0){if(ya(i,e))return;t.uniformMatrix2fv(this.addr,!1,e),xa(i,e)}else{if(ya(i,r))return;SY.set(r),t.uniformMatrix2fv(this.addr,!1,SY),xa(i,r)}}function lUe(t,e){const i=this.cache,r=e.elements;if(r===void 0){if(ya(i,e))return;t.uniformMatrix3fv(this.addr,!1,e),xa(i,e)}else{if(ya(i,r))return;_Y.set(r),t.uniformMatrix3fv(this.addr,!1,_Y),xa(i,r)}}function cUe(t,e){const i=this.cache,r=e.elements;if(r===void 0){if(ya(i,e))return;t.uniformMatrix4fv(this.addr,!1,e),xa(i,e)}else{if(ya(i,r))return;wY.set(r),t.uniformMatrix4fv(this.addr,!1,wY),xa(i,r)}}function uUe(t,e){const i=this.cache;i[0]!==e&&(t.uniform1i(this.addr,e),i[0]=e)}function hUe(t,e){const i=this.cache;if(e.x!==void 0)(i[0]!==e.x||i[1]!==e.y)&&(t.uniform2i(this.addr,e.x,e.y),i[0]=e.x,i[1]=e.y);else{if(ya(i,e))return;t.uniform2iv(this.addr,e),xa(i,e)}}function dUe(t,e){const i=this.cache;if(e.x!==void 0)(i[0]!==e.x||i[1]!==e.y||i[2]!==e.z)&&(t.uniform3i(this.addr,e.x,e.y,e.z),i[0]=e.x,i[1]=e.y,i[2]=e.z);else{if(ya(i,e))return;t.uniform3iv(this.addr,e),xa(i,e)}}function fUe(t,e){const i=this.cache;if(e.x!==void 0)(i[0]!==e.x||i[1]!==e.y||i[2]!==e.z||i[3]!==e.w)&&(t.uniform4i(this.addr,e.x,e.y,e.z,e.w),i[0]=e.x,i[1]=e.y,i[2]=e.z,i[3]=e.w);else{if(ya(i,e))return;t.uniform4iv(this.addr,e),xa(i,e)}}function pUe(t,e){const i=this.cache;i[0]!==e&&(t.uniform1ui(this.addr,e),i[0]=e)}function mUe(t,e){const i=this.cache;if(e.x!==void 0)(i[0]!==e.x||i[1]!==e.y)&&(t.uniform2ui(this.addr,e.x,e.y),i[0]=e.x,i[1]=e.y);else{if(ya(i,e))return;t.uniform2uiv(this.addr,e),xa(i,e)}}function gUe(t,e){const i=this.cache;if(e.x!==void 0)(i[0]!==e.x||i[1]!==e.y||i[2]!==e.z)&&(t.uniform3ui(this.addr,e.x,e.y,e.z),i[0]=e.x,i[1]=e.y,i[2]=e.z);else{if(ya(i,e))return;t.uniform3uiv(this.addr,e),xa(i,e)}}function vUe(t,e){const i=this.cache;if(e.x!==void 0)(i[0]!==e.x||i[1]!==e.y||i[2]!==e.z||i[3]!==e.w)&&(t.uniform4ui(this.addr,e.x,e.y,e.z,e.w),i[0]=e.x,i[1]=e.y,i[2]=e.z,i[3]=e.w);else{if(ya(i,e))return;t.uniform4uiv(this.addr,e),xa(i,e)}}function yUe(t,e,i){const r=this.cache,n=i.allocateTextureUnit();r[0]!==n&&(t.uniform1i(this.addr,n),r[0]=n);let s;this.type===t.SAMPLER_2D_SHADOW?(yY.compareFunction=q6,s=yY):s=Gle,i.setTexture2D(e||s,n)}function xUe(t,e,i){const r=this.cache,n=i.allocateTextureUnit();r[0]!==n&&(t.uniform1i(this.addr,n),r[0]=n),i.setTexture3D(e||qle,n)}function bUe(t,e,i){const r=this.cache,n=i.allocateTextureUnit();r[0]!==n&&(t.uniform1i(this.addr,n),r[0]=n),i.setTextureCube(e||Xle,n)}function wUe(t,e,i){const r=this.cache,n=i.allocateTextureUnit();r[0]!==n&&(t.uniform1i(this.addr,n),r[0]=n),i.setTexture2DArray(e||Wle,n)}function _Ue(t){switch(t){case 5126:return rUe;case 35664:return nUe;case 35665:return sUe;case 35666:return aUe;case 35674:return oUe;case 35675:return lUe;case 35676:return cUe;case 5124:case 35670:return uUe;case 35667:case 35671:return hUe;case 35668:case 35672:return dUe;case 35669:case 35673:return fUe;case 5125:return pUe;case 36294:return mUe;case 36295:return gUe;case 36296:return vUe;case 35678:case 36198:case 36298:case 36306:case 35682:return yUe;case 35679:case 36299:case 36307:return xUe;case 35680:case 36300:case 36308:case 36293:return bUe;case 36289:case 36303:case 36311:case 36292:return wUe}}function SUe(t,e){t.uniform1fv(this.addr,e)}function EUe(t,e){const i=x_(e,this.size,2);t.uniform2fv(this.addr,i)}function AUe(t,e){const i=x_(e,this.size,3);t.uniform3fv(this.addr,i)}function MUe(t,e){const i=x_(e,this.size,4);t.uniform4fv(this.addr,i)}function TUe(t,e){const i=x_(e,this.size,4);t.uniformMatrix2fv(this.addr,!1,i)}function CUe(t,e){const i=x_(e,this.size,9);t.uniformMatrix3fv(this.addr,!1,i)}function PUe(t,e){const i=x_(e,this.size,16);t.uniformMatrix4fv(this.addr,!1,i)}function RUe(t,e){t.uniform1iv(this.addr,e)}function IUe(t,e){t.uniform2iv(this.addr,e)}function DUe(t,e){t.uniform3iv(this.addr,e)}function OUe(t,e){t.uniform4iv(this.addr,e)}function LUe(t,e){t.uniform1uiv(this.addr,e)}function kUe(t,e){t.uniform2uiv(this.addr,e)}function NUe(t,e){t.uniform3uiv(this.addr,e)}function UUe(t,e){t.uniform4uiv(this.addr,e)}function BUe(t,e,i){const r=this.cache,n=e.length,s=XO(i,n);ya(r,s)||(t.uniform1iv(this.addr,s),xa(r,s));for(let a=0;a!==n;++a)i.setTexture2D(e[a]||Gle,s[a])}function FUe(t,e,i){const r=this.cache,n=e.length,s=XO(i,n);ya(r,s)||(t.uniform1iv(this.addr,s),xa(r,s));for(let a=0;a!==n;++a)i.setTexture3D(e[a]||qle,s[a])}function zUe(t,e,i){const r=this.cache,n=e.length,s=XO(i,n);ya(r,s)||(t.uniform1iv(this.addr,s),xa(r,s));for(let a=0;a!==n;++a)i.setTextureCube(e[a]||Xle,s[a])}function jUe(t,e,i){const r=this.cache,n=e.length,s=XO(i,n);ya(r,s)||(t.uniform1iv(this.addr,s),xa(r,s));for(let a=0;a!==n;++a)i.setTexture2DArray(e[a]||Wle,s[a])}function VUe(t){switch(t){case 5126:return SUe;case 35664:return EUe;case 35665:return AUe;case 35666:return MUe;case 35674:return TUe;case 35675:return CUe;case 35676:return PUe;case 5124:case 35670:return RUe;case 35667:case 35671:return IUe;case 35668:case 35672:return DUe;case 35669:case 35673:return OUe;case 5125:return LUe;case 36294:return kUe;case 36295:return NUe;case 36296:return UUe;case 35678:case 36198:case 36298:case 36306:case 35682:return BUe;case 35679:case 36299:case 36307:return FUe;case 35680:case 36300:case 36308:case 36293:return zUe;case 36289:case 36303:case 36311:case 36292:return jUe}}class HUe{constructor(e,i,r){this.id=e,this.addr=r,this.cache=[],this.type=i.type,this.setValue=_Ue(i.type)}}class GUe{constructor(e,i,r){this.id=e,this.addr=r,this.cache=[],this.type=i.type,this.size=i.size,this.setValue=VUe(i.type)}}class WUe{constructor(e){this.id=e,this.seq=[],this.map={}}setValue(e,i,r){const n=this.seq;for(let s=0,a=n.length;s!==a;++s){const o=n[s];o.setValue(e,i[o.id],r)}}}const JU=/(\w+)(\])?(\[|\.)?/g;function EY(t,e){t.seq.push(e),t.map[e.id]=e}function qUe(t,e,i){const r=t.name,n=r.length;for(JU.lastIndex=0;;){const s=JU.exec(r),a=JU.lastIndex;let o=s[1];const l=s[2]==="]",c=s[3];if(l&&(o=o|0),c===void 0||c==="["&&a+2===n){EY(i,c===void 0?new HUe(o,t,e):new GUe(o,t,e));break}else{let h=i.map[o];h===void 0&&(h=new WUe(o),EY(i,h)),i=h}}}class YR{constructor(e,i){this.seq=[],this.map={};const r=e.getProgramParameter(i,e.ACTIVE_UNIFORMS);for(let n=0;n<r;++n){const s=e.getActiveUniform(i,n),a=e.getUniformLocation(i,s.name);qUe(s,a,this)}}setValue(e,i,r,n){const s=this.map[i];s!==void 0&&s.setValue(e,r,n)}setOptional(e,i,r){const n=i[r];n!==void 0&&this.setValue(e,r,n)}static upload(e,i,r,n){for(let s=0,a=i.length;s!==a;++s){const o=i[s],l=r[o.id];l.needsUpdate!==!1&&o.setValue(e,l.value,n)}}static seqWithValue(e,i){const r=[];for(let n=0,s=e.length;n!==s;++n){const a=e[n];a.id in i&&r.push(a)}return r}}function AY(t,e,i){const r=t.createShader(e);return t.shaderSource(r,i),t.compileShader(r),r}const XUe=37297;let $Ue=0;function YUe(t,e){const i=t.split(`
`),r=[],n=Math.max(e-6,0),s=Math.min(e+6,i.length);for(let a=n;a<s;a++){const o=a+1;r.push(`${o===e?">":" "} ${o}: ${i[a]}`)}return r.join(`
`)}const MY=new lr;function KUe(t){Lr._getMatrix(MY,Lr.workingColorSpace,t);const e=`mat3( ${MY.elements.map(i=>i.toFixed(4))} )`;switch(Lr.getTransfer(t)){case pM:return[e,"LinearTransferOETF"];case on:return[e,"sRGBTransferOETF"];default:return console.warn("THREE.WebGLProgram: Unsupported color space: ",t),[e,"LinearTransferOETF"]}}function TY(t,e,i){const r=t.getShaderParameter(e,t.COMPILE_STATUS),s=(t.getShaderInfoLog(e)||"").trim();if(r&&s==="")return"";const a=/ERROR: 0:(\d+)/.exec(s);if(a){const o=parseInt(a[1]);return i.toUpperCase()+`

`+s+`

`+YUe(t.getShaderSource(e),o)}else return s}function ZUe(t,e){const i=KUe(e);return[`vec4 ${t}( vec4 value ) {`,`	return ${i[1]}( vec4( value.rgb * ${i[0]}, value.a ) );`,"}"].join(`
`)}function QUe(t,e){let i;switch(e){case boe:i="Linear";break;case woe:i="Reinhard";break;case _oe:i="Cineon";break;case N6:i="ACESFilmic";break;case Eoe:i="AgX";break;case Aoe:i="Neutral";break;case Soe:i="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",e),i="Linear"}return"vec3 "+t+"( vec3 color ) { return "+i+"ToneMapping( color ); }"}const iP=new be;function JUe(){Lr.getLuminanceCoefficients(iP);const t=iP.x.toFixed(4),e=iP.y.toFixed(4),i=iP.z.toFixed(4);return["float luminance( const in vec3 rgb ) {",`	const vec3 weights = vec3( ${t}, ${e}, ${i} );`,"	return dot( weights, rgb );","}"].join(`
`)}function eBe(t){return[t.extensionClipCullDistance?"#extension GL_ANGLE_clip_cull_distance : require":"",t.extensionMultiDraw?"#extension GL_ANGLE_multi_draw : require":""].filter(zE).join(`
`)}function tBe(t){const e=[];for(const i in t){const r=t[i];r!==!1&&e.push("#define "+i+" "+r)}return e.join(`
`)}function iBe(t,e){const i={},r=t.getProgramParameter(e,t.ACTIVE_ATTRIBUTES);for(let n=0;n<r;n++){const s=t.getActiveAttrib(e,n),a=s.name;let o=1;s.type===t.FLOAT_MAT2&&(o=2),s.type===t.FLOAT_MAT3&&(o=3),s.type===t.FLOAT_MAT4&&(o=4),i[a]={type:s.type,location:t.getAttribLocation(e,a),locationSize:o}}return i}function zE(t){return t!==""}function CY(t,e){const i=e.numSpotLightShadows+e.numSpotLightMaps-e.numSpotLightShadowsWithMaps;return t.replace(/NUM_DIR_LIGHTS/g,e.numDirLights).replace(/NUM_SPOT_LIGHTS/g,e.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,e.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,i).replace(/NUM_RECT_AREA_LIGHTS/g,e.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,e.numPointLights).replace(/NUM_HEMI_LIGHTS/g,e.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,e.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,e.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,e.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,e.numPointLightShadows)}function PY(t,e){return t.replace(/NUM_CLIPPING_PLANES/g,e.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,e.numClippingPlanes-e.numClipIntersection)}const rBe=/^[ \t]*#include +<([\w\d./]+)>/gm;function rj(t){return t.replace(rBe,sBe)}const nBe=new Map;function sBe(t,e){let i=pr[e];if(i===void 0){const r=nBe.get(e);if(r!==void 0)i=pr[r],console.warn('THREE.WebGLRenderer: Shader chunk "%s" has been deprecated. Use "%s" instead.',e,r);else throw new Error("Can not resolve #include <"+e+">")}return rj(i)}const aBe=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function RY(t){return t.replace(aBe,oBe)}function oBe(t,e,i,r){let n="";for(let s=parseInt(e);s<parseInt(i);s++)n+=r.replace(/\[\s*i\s*\]/g,"[ "+s+" ]").replace(/UNROLLED_LOOP_INDEX/g,s);return n}function IY(t){let e=`precision ${t.precision} float;
	precision ${t.precision} int;
	precision ${t.precision} sampler2D;
	precision ${t.precision} samplerCube;
	precision ${t.precision} sampler3D;
	precision ${t.precision} sampler2DArray;
	precision ${t.precision} sampler2DShadow;
	precision ${t.precision} samplerCubeShadow;
	precision ${t.precision} sampler2DArrayShadow;
	precision ${t.precision} isampler2D;
	precision ${t.precision} isampler3D;
	precision ${t.precision} isamplerCube;
	precision ${t.precision} isampler2DArray;
	precision ${t.precision} usampler2D;
	precision ${t.precision} usampler3D;
	precision ${t.precision} usamplerCube;
	precision ${t.precision} usampler2DArray;
	`;return t.precision==="highp"?e+=`
#define HIGH_PRECISION`:t.precision==="mediump"?e+=`
#define MEDIUM_PRECISION`:t.precision==="lowp"&&(e+=`
#define LOW_PRECISION`),e}function lBe(t){let e="SHADOWMAP_TYPE_BASIC";return t.shadowMapType===mO?e="SHADOWMAP_TYPE_PCF":t.shadowMapType===vA?e="SHADOWMAP_TYPE_PCF_SOFT":t.shadowMapType===ph&&(e="SHADOWMAP_TYPE_VSM"),e}function cBe(t){let e="ENVMAP_TYPE_CUBE";if(t.envMap)switch(t.envMapMode){case zp:case Jg:e="ENVMAP_TYPE_CUBE";break;case p_:e="ENVMAP_TYPE_CUBE_UV";break}return e}function uBe(t){let e="ENVMAP_MODE_REFLECTION";if(t.envMap)switch(t.envMapMode){case Jg:e="ENVMAP_MODE_REFRACTION";break}return e}function hBe(t){let e="ENVMAP_BLENDING_NONE";if(t.envMap)switch(t.combine){case gT:e="ENVMAP_BLENDING_MULTIPLY";break;case yoe:e="ENVMAP_BLENDING_MIX";break;case xoe:e="ENVMAP_BLENDING_ADD";break}return e}function dBe(t){const e=t.envMapCubeUVHeight;if(e===null)return null;const i=Math.log2(e)-2,r=1/e;return{texelWidth:1/(3*Math.max(Math.pow(2,i),112)),texelHeight:r,maxMip:i}}function fBe(t,e,i,r){const n=t.getContext(),s=i.defines;let a=i.vertexShader,o=i.fragmentShader;const l=lBe(i),c=cBe(i),u=uBe(i),h=hBe(i),d=dBe(i),f=eBe(i),p=tBe(s),g=n.createProgram();let m,y,b=i.glslVersion?"#version "+i.glslVersion+`
`:"";i.isRawShaderMaterial?(m=["#define SHADER_TYPE "+i.shaderType,"#define SHADER_NAME "+i.shaderName,p].filter(zE).join(`
`),m.length>0&&(m+=`
`),y=["#define SHADER_TYPE "+i.shaderType,"#define SHADER_NAME "+i.shaderName,p].filter(zE).join(`
`),y.length>0&&(y+=`
`)):(m=[IY(i),"#define SHADER_TYPE "+i.shaderType,"#define SHADER_NAME "+i.shaderName,p,i.extensionClipCullDistance?"#define USE_CLIP_DISTANCE":"",i.batching?"#define USE_BATCHING":"",i.batchingColor?"#define USE_BATCHING_COLOR":"",i.instancing?"#define USE_INSTANCING":"",i.instancingColor?"#define USE_INSTANCING_COLOR":"",i.instancingMorph?"#define USE_INSTANCING_MORPH":"",i.useFog&&i.fog?"#define USE_FOG":"",i.useFog&&i.fogExp2?"#define FOG_EXP2":"",i.map?"#define USE_MAP":"",i.envMap?"#define USE_ENVMAP":"",i.envMap?"#define "+u:"",i.lightMap?"#define USE_LIGHTMAP":"",i.aoMap?"#define USE_AOMAP":"",i.bumpMap?"#define USE_BUMPMAP":"",i.normalMap?"#define USE_NORMALMAP":"",i.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",i.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",i.displacementMap?"#define USE_DISPLACEMENTMAP":"",i.emissiveMap?"#define USE_EMISSIVEMAP":"",i.anisotropy?"#define USE_ANISOTROPY":"",i.anisotropyMap?"#define USE_ANISOTROPYMAP":"",i.clearcoatMap?"#define USE_CLEARCOATMAP":"",i.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",i.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",i.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",i.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",i.specularMap?"#define USE_SPECULARMAP":"",i.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",i.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",i.roughnessMap?"#define USE_ROUGHNESSMAP":"",i.metalnessMap?"#define USE_METALNESSMAP":"",i.alphaMap?"#define USE_ALPHAMAP":"",i.alphaHash?"#define USE_ALPHAHASH":"",i.transmission?"#define USE_TRANSMISSION":"",i.transmissionMap?"#define USE_TRANSMISSIONMAP":"",i.thicknessMap?"#define USE_THICKNESSMAP":"",i.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",i.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",i.mapUv?"#define MAP_UV "+i.mapUv:"",i.alphaMapUv?"#define ALPHAMAP_UV "+i.alphaMapUv:"",i.lightMapUv?"#define LIGHTMAP_UV "+i.lightMapUv:"",i.aoMapUv?"#define AOMAP_UV "+i.aoMapUv:"",i.emissiveMapUv?"#define EMISSIVEMAP_UV "+i.emissiveMapUv:"",i.bumpMapUv?"#define BUMPMAP_UV "+i.bumpMapUv:"",i.normalMapUv?"#define NORMALMAP_UV "+i.normalMapUv:"",i.displacementMapUv?"#define DISPLACEMENTMAP_UV "+i.displacementMapUv:"",i.metalnessMapUv?"#define METALNESSMAP_UV "+i.metalnessMapUv:"",i.roughnessMapUv?"#define ROUGHNESSMAP_UV "+i.roughnessMapUv:"",i.anisotropyMapUv?"#define ANISOTROPYMAP_UV "+i.anisotropyMapUv:"",i.clearcoatMapUv?"#define CLEARCOATMAP_UV "+i.clearcoatMapUv:"",i.clearcoatNormalMapUv?"#define CLEARCOAT_NORMALMAP_UV "+i.clearcoatNormalMapUv:"",i.clearcoatRoughnessMapUv?"#define CLEARCOAT_ROUGHNESSMAP_UV "+i.clearcoatRoughnessMapUv:"",i.iridescenceMapUv?"#define IRIDESCENCEMAP_UV "+i.iridescenceMapUv:"",i.iridescenceThicknessMapUv?"#define IRIDESCENCE_THICKNESSMAP_UV "+i.iridescenceThicknessMapUv:"",i.sheenColorMapUv?"#define SHEEN_COLORMAP_UV "+i.sheenColorMapUv:"",i.sheenRoughnessMapUv?"#define SHEEN_ROUGHNESSMAP_UV "+i.sheenRoughnessMapUv:"",i.specularMapUv?"#define SPECULARMAP_UV "+i.specularMapUv:"",i.specularColorMapUv?"#define SPECULAR_COLORMAP_UV "+i.specularColorMapUv:"",i.specularIntensityMapUv?"#define SPECULAR_INTENSITYMAP_UV "+i.specularIntensityMapUv:"",i.transmissionMapUv?"#define TRANSMISSIONMAP_UV "+i.transmissionMapUv:"",i.thicknessMapUv?"#define THICKNESSMAP_UV "+i.thicknessMapUv:"",i.vertexTangents&&i.flatShading===!1?"#define USE_TANGENT":"",i.vertexColors?"#define USE_COLOR":"",i.vertexAlphas?"#define USE_COLOR_ALPHA":"",i.vertexUv1s?"#define USE_UV1":"",i.vertexUv2s?"#define USE_UV2":"",i.vertexUv3s?"#define USE_UV3":"",i.pointsUvs?"#define USE_POINTS_UV":"",i.flatShading?"#define FLAT_SHADED":"",i.skinning?"#define USE_SKINNING":"",i.morphTargets?"#define USE_MORPHTARGETS":"",i.morphNormals&&i.flatShading===!1?"#define USE_MORPHNORMALS":"",i.morphColors?"#define USE_MORPHCOLORS":"",i.morphTargetsCount>0?"#define MORPHTARGETS_TEXTURE_STRIDE "+i.morphTextureStride:"",i.morphTargetsCount>0?"#define MORPHTARGETS_COUNT "+i.morphTargetsCount:"",i.doubleSided?"#define DOUBLE_SIDED":"",i.flipSided?"#define FLIP_SIDED":"",i.shadowMapEnabled?"#define USE_SHADOWMAP":"",i.shadowMapEnabled?"#define "+l:"",i.sizeAttenuation?"#define USE_SIZEATTENUATION":"",i.numLightProbes>0?"#define USE_LIGHT_PROBES":"",i.logarithmicDepthBuffer?"#define USE_LOGARITHMIC_DEPTH_BUFFER":"",i.reversedDepthBuffer?"#define USE_REVERSED_DEPTH_BUFFER":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","	attribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","	attribute vec3 instanceColor;","#endif","#ifdef USE_INSTANCING_MORPH","	uniform sampler2D morphTexture;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_UV1","	attribute vec2 uv1;","#endif","#ifdef USE_UV2","	attribute vec2 uv2;","#endif","#ifdef USE_UV3","	attribute vec2 uv3;","#endif","#ifdef USE_TANGENT","	attribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","	attribute vec4 color;","#elif defined( USE_COLOR )","	attribute vec3 color;","#endif","#ifdef USE_SKINNING","	attribute vec4 skinIndex;","	attribute vec4 skinWeight;","#endif",`
`].filter(zE).join(`
`),y=[IY(i),"#define SHADER_TYPE "+i.shaderType,"#define SHADER_NAME "+i.shaderName,p,i.useFog&&i.fog?"#define USE_FOG":"",i.useFog&&i.fogExp2?"#define FOG_EXP2":"",i.alphaToCoverage?"#define ALPHA_TO_COVERAGE":"",i.map?"#define USE_MAP":"",i.matcap?"#define USE_MATCAP":"",i.envMap?"#define USE_ENVMAP":"",i.envMap?"#define "+c:"",i.envMap?"#define "+u:"",i.envMap?"#define "+h:"",d?"#define CUBEUV_TEXEL_WIDTH "+d.texelWidth:"",d?"#define CUBEUV_TEXEL_HEIGHT "+d.texelHeight:"",d?"#define CUBEUV_MAX_MIP "+d.maxMip+".0":"",i.lightMap?"#define USE_LIGHTMAP":"",i.aoMap?"#define USE_AOMAP":"",i.bumpMap?"#define USE_BUMPMAP":"",i.normalMap?"#define USE_NORMALMAP":"",i.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",i.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",i.emissiveMap?"#define USE_EMISSIVEMAP":"",i.anisotropy?"#define USE_ANISOTROPY":"",i.anisotropyMap?"#define USE_ANISOTROPYMAP":"",i.clearcoat?"#define USE_CLEARCOAT":"",i.clearcoatMap?"#define USE_CLEARCOATMAP":"",i.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",i.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",i.dispersion?"#define USE_DISPERSION":"",i.iridescence?"#define USE_IRIDESCENCE":"",i.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",i.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",i.specularMap?"#define USE_SPECULARMAP":"",i.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",i.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",i.roughnessMap?"#define USE_ROUGHNESSMAP":"",i.metalnessMap?"#define USE_METALNESSMAP":"",i.alphaMap?"#define USE_ALPHAMAP":"",i.alphaTest?"#define USE_ALPHATEST":"",i.alphaHash?"#define USE_ALPHAHASH":"",i.sheen?"#define USE_SHEEN":"",i.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",i.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",i.transmission?"#define USE_TRANSMISSION":"",i.transmissionMap?"#define USE_TRANSMISSIONMAP":"",i.thicknessMap?"#define USE_THICKNESSMAP":"",i.vertexTangents&&i.flatShading===!1?"#define USE_TANGENT":"",i.vertexColors||i.instancingColor||i.batchingColor?"#define USE_COLOR":"",i.vertexAlphas?"#define USE_COLOR_ALPHA":"",i.vertexUv1s?"#define USE_UV1":"",i.vertexUv2s?"#define USE_UV2":"",i.vertexUv3s?"#define USE_UV3":"",i.pointsUvs?"#define USE_POINTS_UV":"",i.gradientMap?"#define USE_GRADIENTMAP":"",i.flatShading?"#define FLAT_SHADED":"",i.doubleSided?"#define DOUBLE_SIDED":"",i.flipSided?"#define FLIP_SIDED":"",i.shadowMapEnabled?"#define USE_SHADOWMAP":"",i.shadowMapEnabled?"#define "+l:"",i.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",i.numLightProbes>0?"#define USE_LIGHT_PROBES":"",i.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",i.decodeVideoTextureEmissive?"#define DECODE_VIDEO_TEXTURE_EMISSIVE":"",i.logarithmicDepthBuffer?"#define USE_LOGARITHMIC_DEPTH_BUFFER":"",i.reversedDepthBuffer?"#define USE_REVERSED_DEPTH_BUFFER":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",i.toneMapping!==jd?"#define TONE_MAPPING":"",i.toneMapping!==jd?pr.tonemapping_pars_fragment:"",i.toneMapping!==jd?QUe("toneMapping",i.toneMapping):"",i.dithering?"#define DITHERING":"",i.opaque?"#define OPAQUE":"",pr.colorspace_pars_fragment,ZUe("linearToOutputTexel",i.outputColorSpace),JUe(),i.useDepthPacking?"#define DEPTH_PACKING "+i.depthPacking:"",`
`].filter(zE).join(`
`)),a=rj(a),a=CY(a,i),a=PY(a,i),o=rj(o),o=CY(o,i),o=PY(o,i),a=RY(a),o=RY(o),i.isRawShaderMaterial!==!0&&(b=`#version 300 es
`,m=[f,"#define attribute in","#define varying out","#define texture2D texture"].join(`
`)+`
`+m,y=["#define varying in",i.glslVersion===$z?"":"layout(location = 0) out highp vec4 pc_fragColor;",i.glslVersion===$z?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join(`
`)+`
`+y);const w=b+m+a,E=b+y+o,M=AY(n,n.VERTEX_SHADER,w),A=AY(n,n.FRAGMENT_SHADER,E);n.attachShader(g,M),n.attachShader(g,A),i.index0AttributeName!==void 0?n.bindAttribLocation(g,0,i.index0AttributeName):i.morphTargets===!0&&n.bindAttribLocation(g,0,"position"),n.linkProgram(g);function P(k){if(t.debug.checkShaderErrors){const z=n.getProgramInfoLog(g)||"",V=n.getShaderInfoLog(M)||"",F=n.getShaderInfoLog(A)||"",$=z.trim(),K=V.trim(),X=F.trim();let U=!0,Y=!0;if(n.getProgramParameter(g,n.LINK_STATUS)===!1)if(U=!1,typeof t.debug.onShaderError=="function")t.debug.onShaderError(n,g,M,A);else{const Z=TY(n,M,"vertex"),j=TY(n,A,"fragment");console.error("THREE.WebGLProgram: Shader Error "+n.getError()+" - VALIDATE_STATUS "+n.getProgramParameter(g,n.VALIDATE_STATUS)+`

Material Name: `+k.name+`
Material Type: `+k.type+`

Program Info Log: `+$+`
`+Z+`
`+j)}else $!==""?console.warn("THREE.WebGLProgram: Program Info Log:",$):(K===""||X==="")&&(Y=!1);Y&&(k.diagnostics={runnable:U,programLog:$,vertexShader:{log:K,prefix:m},fragmentShader:{log:X,prefix:y}})}n.deleteShader(M),n.deleteShader(A),C=new YR(n,g),R=iBe(n,g)}let C;this.getUniforms=function(){return C===void 0&&P(this),C};let R;this.getAttributes=function(){return R===void 0&&P(this),R};let I=i.rendererExtensionParallelShaderCompile===!1;return this.isReady=function(){return I===!1&&(I=n.getProgramParameter(g,XUe)),I},this.destroy=function(){r.releaseStatesOfProgram(this),n.deleteProgram(g),this.program=void 0},this.type=i.shaderType,this.name=i.shaderName,this.id=$Ue++,this.cacheKey=e,this.usedTimes=1,this.program=g,this.vertexShader=M,this.fragmentShader=A,this}let pBe=0;class mBe{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(e){const i=e.vertexShader,r=e.fragmentShader,n=this._getShaderStage(i),s=this._getShaderStage(r),a=this._getShaderCacheForMaterial(e);return a.has(n)===!1&&(a.add(n),n.usedTimes++),a.has(s)===!1&&(a.add(s),s.usedTimes++),this}remove(e){const i=this.materialCache.get(e);for(const r of i)r.usedTimes--,r.usedTimes===0&&this.shaderCache.delete(r.code);return this.materialCache.delete(e),this}getVertexShaderID(e){return this._getShaderStage(e.vertexShader).id}getFragmentShaderID(e){return this._getShaderStage(e.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(e){const i=this.materialCache;let r=i.get(e);return r===void 0&&(r=new Set,i.set(e,r)),r}_getShaderStage(e){const i=this.shaderCache;let r=i.get(e);return r===void 0&&(r=new gBe(e),i.set(e,r)),r}}class gBe{constructor(e){this.id=pBe++,this.code=e,this.usedTimes=0}}function vBe(t,e,i,r,n,s,a){const o=new p0,l=new mBe,c=new Set,u=[],h=n.logarithmicDepthBuffer,d=n.vertexTextures;let f=n.precision;const p={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};function g(R){return c.add(R),R===0?"uv":`uv${R}`}function m(R,I,k,z,V){const F=z.fog,$=V.geometry,K=R.isMeshStandardMaterial?z.environment:null,X=(R.isMeshStandardMaterial?i:e).get(R.envMap||K),U=X&&X.mapping===p_?X.image.height:null,Y=p[R.type];R.precision!==null&&(f=n.getMaxPrecision(R.precision),f!==R.precision&&console.warn("THREE.WebGLProgram.getParameters:",R.precision,"not supported, using",f,"instead."));const Z=$.morphAttributes.position||$.morphAttributes.normal||$.morphAttributes.color,j=Z!==void 0?Z.length:0;let ee=0;$.morphAttributes.position!==void 0&&(ee=1),$.morphAttributes.normal!==void 0&&(ee=2),$.morphAttributes.color!==void 0&&(ee=3);let pe,fe,se,re;if(Y){const ti=gh[Y];pe=ti.vertexShader,fe=ti.fragmentShader}else pe=R.vertexShader,fe=R.fragmentShader,l.update(R),se=l.getVertexShaderID(R),re=l.getFragmentShaderID(R);const le=t.getRenderTarget(),he=t.state.buffers.depth.getReversed(),ve=V.isInstancedMesh===!0,xe=V.isBatchedMesh===!0,Se=!!R.map,Ce=!!R.matcap,ce=!!X,Fe=!!R.aoMap,De=!!R.lightMap,He=!!R.bumpMap,Be=!!R.normalMap,$e=!!R.displacementMap,ze=!!R.emissiveMap,it=!!R.metalnessMap,wt=!!R.roughnessMap,ge=R.anisotropy>0,G=R.clearcoat>0,Q=R.dispersion>0,we=R.iridescence>0,te=R.sheen>0,Ne=R.transmission>0,Le=ge&&!!R.anisotropyMap,at=G&&!!R.clearcoatMap,Te=G&&!!R.clearcoatNormalMap,dt=G&&!!R.clearcoatRoughnessMap,ot=we&&!!R.iridescenceMap,Qe=we&&!!R.iridescenceThicknessMap,pt=te&&!!R.sheenColorMap,_t=te&&!!R.sheenRoughnessMap,yt=!!R.specularMap,Et=!!R.specularColorMap,$t=!!R.specularIntensityMap,oe=Ne&&!!R.transmissionMap,Re=Ne&&!!R.thicknessMap,ke=!!R.gradientMap,st=!!R.alphaMap,rt=R.alphaTest>0,je=!!R.alphaHash,Tt=!!R.extensions;let Ft=jd;R.toneMapped&&(le===null||le.isXRRenderTarget===!0)&&(Ft=t.toneMapping);const wi={shaderID:Y,shaderType:R.type,shaderName:R.name,vertexShader:pe,fragmentShader:fe,defines:R.defines,customVertexShaderID:se,customFragmentShaderID:re,isRawShaderMaterial:R.isRawShaderMaterial===!0,glslVersion:R.glslVersion,precision:f,batching:xe,batchingColor:xe&&V._colorsTexture!==null,instancing:ve,instancingColor:ve&&V.instanceColor!==null,instancingMorph:ve&&V.morphTexture!==null,supportsVertexTextures:d,outputColorSpace:le===null?t.outputColorSpace:le.isXRRenderTarget===!0?le.texture.colorSpace:T0,alphaToCoverage:!!R.alphaToCoverage,map:Se,matcap:Ce,envMap:ce,envMapMode:ce&&X.mapping,envMapCubeUVHeight:U,aoMap:Fe,lightMap:De,bumpMap:He,normalMap:Be,displacementMap:d&&$e,emissiveMap:ze,normalMapObjectSpace:Be&&R.normalMapType===Doe,normalMapTangentSpace:Be&&R.normalMapType===cv,metalnessMap:it,roughnessMap:wt,anisotropy:ge,anisotropyMap:Le,clearcoat:G,clearcoatMap:at,clearcoatNormalMap:Te,clearcoatRoughnessMap:dt,dispersion:Q,iridescence:we,iridescenceMap:ot,iridescenceThicknessMap:Qe,sheen:te,sheenColorMap:pt,sheenRoughnessMap:_t,specularMap:yt,specularColorMap:Et,specularIntensityMap:$t,transmission:Ne,transmissionMap:oe,thicknessMap:Re,gradientMap:ke,opaque:R.transparent===!1&&R.blending===h0&&R.alphaToCoverage===!1,alphaMap:st,alphaTest:rt,alphaHash:je,combine:R.combine,mapUv:Se&&g(R.map.channel),aoMapUv:Fe&&g(R.aoMap.channel),lightMapUv:De&&g(R.lightMap.channel),bumpMapUv:He&&g(R.bumpMap.channel),normalMapUv:Be&&g(R.normalMap.channel),displacementMapUv:$e&&g(R.displacementMap.channel),emissiveMapUv:ze&&g(R.emissiveMap.channel),metalnessMapUv:it&&g(R.metalnessMap.channel),roughnessMapUv:wt&&g(R.roughnessMap.channel),anisotropyMapUv:Le&&g(R.anisotropyMap.channel),clearcoatMapUv:at&&g(R.clearcoatMap.channel),clearcoatNormalMapUv:Te&&g(R.clearcoatNormalMap.channel),clearcoatRoughnessMapUv:dt&&g(R.clearcoatRoughnessMap.channel),iridescenceMapUv:ot&&g(R.iridescenceMap.channel),iridescenceThicknessMapUv:Qe&&g(R.iridescenceThicknessMap.channel),sheenColorMapUv:pt&&g(R.sheenColorMap.channel),sheenRoughnessMapUv:_t&&g(R.sheenRoughnessMap.channel),specularMapUv:yt&&g(R.specularMap.channel),specularColorMapUv:Et&&g(R.specularColorMap.channel),specularIntensityMapUv:$t&&g(R.specularIntensityMap.channel),transmissionMapUv:oe&&g(R.transmissionMap.channel),thicknessMapUv:Re&&g(R.thicknessMap.channel),alphaMapUv:st&&g(R.alphaMap.channel),vertexTangents:!!$.attributes.tangent&&(Be||ge),vertexColors:R.vertexColors,vertexAlphas:R.vertexColors===!0&&!!$.attributes.color&&$.attributes.color.itemSize===4,pointsUvs:V.isPoints===!0&&!!$.attributes.uv&&(Se||st),fog:!!F,useFog:R.fog===!0,fogExp2:!!F&&F.isFogExp2,flatShading:R.flatShading===!0&&R.wireframe===!1,sizeAttenuation:R.sizeAttenuation===!0,logarithmicDepthBuffer:h,reversedDepthBuffer:he,skinning:V.isSkinnedMesh===!0,morphTargets:$.morphAttributes.position!==void 0,morphNormals:$.morphAttributes.normal!==void 0,morphColors:$.morphAttributes.color!==void 0,morphTargetsCount:j,morphTextureStride:ee,numDirLights:I.directional.length,numPointLights:I.point.length,numSpotLights:I.spot.length,numSpotLightMaps:I.spotLightMap.length,numRectAreaLights:I.rectArea.length,numHemiLights:I.hemi.length,numDirLightShadows:I.directionalShadowMap.length,numPointLightShadows:I.pointShadowMap.length,numSpotLightShadows:I.spotShadowMap.length,numSpotLightShadowsWithMaps:I.numSpotLightShadowsWithMaps,numLightProbes:I.numLightProbes,numClippingPlanes:a.numPlanes,numClipIntersection:a.numIntersection,dithering:R.dithering,shadowMapEnabled:t.shadowMap.enabled&&k.length>0,shadowMapType:t.shadowMap.type,toneMapping:Ft,decodeVideoTexture:Se&&R.map.isVideoTexture===!0&&Lr.getTransfer(R.map.colorSpace)===on,decodeVideoTextureEmissive:ze&&R.emissiveMap.isVideoTexture===!0&&Lr.getTransfer(R.emissiveMap.colorSpace)===on,premultipliedAlpha:R.premultipliedAlpha,doubleSided:R.side===Sd,flipSided:R.side===bl,useDepthPacking:R.depthPacking>=0,depthPacking:R.depthPacking||0,index0AttributeName:R.index0AttributeName,extensionClipCullDistance:Tt&&R.extensions.clipCullDistance===!0&&r.has("WEBGL_clip_cull_distance"),extensionMultiDraw:(Tt&&R.extensions.multiDraw===!0||xe)&&r.has("WEBGL_multi_draw"),rendererExtensionParallelShaderCompile:r.has("KHR_parallel_shader_compile"),customProgramCacheKey:R.customProgramCacheKey()};return wi.vertexUv1s=c.has(1),wi.vertexUv2s=c.has(2),wi.vertexUv3s=c.has(3),c.clear(),wi}function y(R){const I=[];if(R.shaderID?I.push(R.shaderID):(I.push(R.customVertexShaderID),I.push(R.customFragmentShaderID)),R.defines!==void 0)for(const k in R.defines)I.push(k),I.push(R.defines[k]);return R.isRawShaderMaterial===!1&&(b(I,R),w(I,R),I.push(t.outputColorSpace)),I.push(R.customProgramCacheKey),I.join()}function b(R,I){R.push(I.precision),R.push(I.outputColorSpace),R.push(I.envMapMode),R.push(I.envMapCubeUVHeight),R.push(I.mapUv),R.push(I.alphaMapUv),R.push(I.lightMapUv),R.push(I.aoMapUv),R.push(I.bumpMapUv),R.push(I.normalMapUv),R.push(I.displacementMapUv),R.push(I.emissiveMapUv),R.push(I.metalnessMapUv),R.push(I.roughnessMapUv),R.push(I.anisotropyMapUv),R.push(I.clearcoatMapUv),R.push(I.clearcoatNormalMapUv),R.push(I.clearcoatRoughnessMapUv),R.push(I.iridescenceMapUv),R.push(I.iridescenceThicknessMapUv),R.push(I.sheenColorMapUv),R.push(I.sheenRoughnessMapUv),R.push(I.specularMapUv),R.push(I.specularColorMapUv),R.push(I.specularIntensityMapUv),R.push(I.transmissionMapUv),R.push(I.thicknessMapUv),R.push(I.combine),R.push(I.fogExp2),R.push(I.sizeAttenuation),R.push(I.morphTargetsCount),R.push(I.morphAttributeCount),R.push(I.numDirLights),R.push(I.numPointLights),R.push(I.numSpotLights),R.push(I.numSpotLightMaps),R.push(I.numHemiLights),R.push(I.numRectAreaLights),R.push(I.numDirLightShadows),R.push(I.numPointLightShadows),R.push(I.numSpotLightShadows),R.push(I.numSpotLightShadowsWithMaps),R.push(I.numLightProbes),R.push(I.shadowMapType),R.push(I.toneMapping),R.push(I.numClippingPlanes),R.push(I.numClipIntersection),R.push(I.depthPacking)}function w(R,I){o.disableAll(),I.supportsVertexTextures&&o.enable(0),I.instancing&&o.enable(1),I.instancingColor&&o.enable(2),I.instancingMorph&&o.enable(3),I.matcap&&o.enable(4),I.envMap&&o.enable(5),I.normalMapObjectSpace&&o.enable(6),I.normalMapTangentSpace&&o.enable(7),I.clearcoat&&o.enable(8),I.iridescence&&o.enable(9),I.alphaTest&&o.enable(10),I.vertexColors&&o.enable(11),I.vertexAlphas&&o.enable(12),I.vertexUv1s&&o.enable(13),I.vertexUv2s&&o.enable(14),I.vertexUv3s&&o.enable(15),I.vertexTangents&&o.enable(16),I.anisotropy&&o.enable(17),I.alphaHash&&o.enable(18),I.batching&&o.enable(19),I.dispersion&&o.enable(20),I.batchingColor&&o.enable(21),I.gradientMap&&o.enable(22),R.push(o.mask),o.disableAll(),I.fog&&o.enable(0),I.useFog&&o.enable(1),I.flatShading&&o.enable(2),I.logarithmicDepthBuffer&&o.enable(3),I.reversedDepthBuffer&&o.enable(4),I.skinning&&o.enable(5),I.morphTargets&&o.enable(6),I.morphNormals&&o.enable(7),I.morphColors&&o.enable(8),I.premultipliedAlpha&&o.enable(9),I.shadowMapEnabled&&o.enable(10),I.doubleSided&&o.enable(11),I.flipSided&&o.enable(12),I.useDepthPacking&&o.enable(13),I.dithering&&o.enable(14),I.transmission&&o.enable(15),I.sheen&&o.enable(16),I.opaque&&o.enable(17),I.pointsUvs&&o.enable(18),I.decodeVideoTexture&&o.enable(19),I.decodeVideoTextureEmissive&&o.enable(20),I.alphaToCoverage&&o.enable(21),R.push(o.mask)}function E(R){const I=p[R.type];let k;if(I){const z=gh[I];k=Woe.clone(z.uniforms)}else k=R.uniforms;return k}function M(R,I){let k;for(let z=0,V=u.length;z<V;z++){const F=u[z];if(F.cacheKey===I){k=F,++k.usedTimes;break}}return k===void 0&&(k=new fBe(t,I,R,s),u.push(k)),k}function A(R){if(--R.usedTimes===0){const I=u.indexOf(R);u[I]=u[u.length-1],u.pop(),R.destroy()}}function P(R){l.remove(R)}function C(){l.dispose()}return{getParameters:m,getProgramCacheKey:y,getUniforms:E,acquireProgram:M,releaseProgram:A,releaseShaderCache:P,programs:u,dispose:C}}function yBe(){let t=new WeakMap;function e(a){return t.has(a)}function i(a){let o=t.get(a);return o===void 0&&(o={},t.set(a,o)),o}function r(a){t.delete(a)}function n(a,o,l){t.get(a)[o]=l}function s(){t=new WeakMap}return{has:e,get:i,remove:r,update:n,dispose:s}}function xBe(t,e){return t.groupOrder!==e.groupOrder?t.groupOrder-e.groupOrder:t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.material.id!==e.material.id?t.material.id-e.material.id:t.z!==e.z?t.z-e.z:t.id-e.id}function DY(t,e){return t.groupOrder!==e.groupOrder?t.groupOrder-e.groupOrder:t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.z!==e.z?e.z-t.z:t.id-e.id}function OY(){const t=[];let e=0;const i=[],r=[],n=[];function s(){e=0,i.length=0,r.length=0,n.length=0}function a(h,d,f,p,g,m){let y=t[e];return y===void 0?(y={id:h.id,object:h,geometry:d,material:f,groupOrder:p,renderOrder:h.renderOrder,z:g,group:m},t[e]=y):(y.id=h.id,y.object=h,y.geometry=d,y.material=f,y.groupOrder=p,y.renderOrder=h.renderOrder,y.z=g,y.group=m),e++,y}function o(h,d,f,p,g,m){const y=a(h,d,f,p,g,m);f.transmission>0?r.push(y):f.transparent===!0?n.push(y):i.push(y)}function l(h,d,f,p,g,m){const y=a(h,d,f,p,g,m);f.transmission>0?r.unshift(y):f.transparent===!0?n.unshift(y):i.unshift(y)}function c(h,d){i.length>1&&i.sort(h||xBe),r.length>1&&r.sort(d||DY),n.length>1&&n.sort(d||DY)}function u(){for(let h=e,d=t.length;h<d;h++){const f=t[h];if(f.id===null)break;f.id=null,f.object=null,f.geometry=null,f.material=null,f.group=null}}return{opaque:i,transmissive:r,transparent:n,init:s,push:o,unshift:l,finish:u,sort:c}}function bBe(){let t=new WeakMap;function e(r,n){const s=t.get(r);let a;return s===void 0?(a=new OY,t.set(r,[a])):n>=s.length?(a=new OY,s.push(a)):a=s[n],a}function i(){t=new WeakMap}return{get:e,dispose:i}}function wBe(){const t={};return{get:function(e){if(t[e.id]!==void 0)return t[e.id];let i;switch(e.type){case"DirectionalLight":i={direction:new be,color:new ii};break;case"SpotLight":i={position:new be,direction:new be,color:new ii,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":i={position:new be,color:new ii,distance:0,decay:0};break;case"HemisphereLight":i={direction:new be,skyColor:new ii,groundColor:new ii};break;case"RectAreaLight":i={color:new ii,position:new be,halfWidth:new be,halfHeight:new be};break}return t[e.id]=i,i}}}function _Be(){const t={};return{get:function(e){if(t[e.id]!==void 0)return t[e.id];let i;switch(e.type){case"DirectionalLight":i={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new At};break;case"SpotLight":i={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new At};break;case"PointLight":i={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new At,shadowCameraNear:1,shadowCameraFar:1e3};break}return t[e.id]=i,i}}}let SBe=0;function EBe(t,e){return(e.castShadow?2:0)-(t.castShadow?2:0)+(e.map?1:0)-(t.map?1:0)}function ABe(t){const e=new wBe,i=_Be(),r={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1,numLightProbes:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0,numLightProbes:0};for(let c=0;c<9;c++)r.probe.push(new be);const n=new be,s=new zi,a=new zi;function o(c){let u=0,h=0,d=0;for(let R=0;R<9;R++)r.probe[R].set(0,0,0);let f=0,p=0,g=0,m=0,y=0,b=0,w=0,E=0,M=0,A=0,P=0;c.sort(EBe);for(let R=0,I=c.length;R<I;R++){const k=c[R],z=k.color,V=k.intensity,F=k.distance,$=k.shadow&&k.shadow.map?k.shadow.map.texture:null;if(k.isAmbientLight)u+=z.r*V,h+=z.g*V,d+=z.b*V;else if(k.isLightProbe){for(let K=0;K<9;K++)r.probe[K].addScaledVector(k.sh.coefficients[K],V);P++}else if(k.isDirectionalLight){const K=e.get(k);if(K.color.copy(k.color).multiplyScalar(k.intensity),k.castShadow){const X=k.shadow,U=i.get(k);U.shadowIntensity=X.intensity,U.shadowBias=X.bias,U.shadowNormalBias=X.normalBias,U.shadowRadius=X.radius,U.shadowMapSize=X.mapSize,r.directionalShadow[f]=U,r.directionalShadowMap[f]=$,r.directionalShadowMatrix[f]=k.shadow.matrix,b++}r.directional[f]=K,f++}else if(k.isSpotLight){const K=e.get(k);K.position.setFromMatrixPosition(k.matrixWorld),K.color.copy(z).multiplyScalar(V),K.distance=F,K.coneCos=Math.cos(k.angle),K.penumbraCos=Math.cos(k.angle*(1-k.penumbra)),K.decay=k.decay,r.spot[g]=K;const X=k.shadow;if(k.map&&(r.spotLightMap[M]=k.map,M++,X.updateMatrices(k),k.castShadow&&A++),r.spotLightMatrix[g]=X.matrix,k.castShadow){const U=i.get(k);U.shadowIntensity=X.intensity,U.shadowBias=X.bias,U.shadowNormalBias=X.normalBias,U.shadowRadius=X.radius,U.shadowMapSize=X.mapSize,r.spotShadow[g]=U,r.spotShadowMap[g]=$,E++}g++}else if(k.isRectAreaLight){const K=e.get(k);K.color.copy(z).multiplyScalar(V),K.halfWidth.set(k.width*.5,0,0),K.halfHeight.set(0,k.height*.5,0),r.rectArea[m]=K,m++}else if(k.isPointLight){const K=e.get(k);if(K.color.copy(k.color).multiplyScalar(k.intensity),K.distance=k.distance,K.decay=k.decay,k.castShadow){const X=k.shadow,U=i.get(k);U.shadowIntensity=X.intensity,U.shadowBias=X.bias,U.shadowNormalBias=X.normalBias,U.shadowRadius=X.radius,U.shadowMapSize=X.mapSize,U.shadowCameraNear=X.camera.near,U.shadowCameraFar=X.camera.far,r.pointShadow[p]=U,r.pointShadowMap[p]=$,r.pointShadowMatrix[p]=k.shadow.matrix,w++}r.point[p]=K,p++}else if(k.isHemisphereLight){const K=e.get(k);K.skyColor.copy(k.color).multiplyScalar(V),K.groundColor.copy(k.groundColor).multiplyScalar(V),r.hemi[y]=K,y++}}m>0&&(t.has("OES_texture_float_linear")===!0?(r.rectAreaLTC1=Xt.LTC_FLOAT_1,r.rectAreaLTC2=Xt.LTC_FLOAT_2):(r.rectAreaLTC1=Xt.LTC_HALF_1,r.rectAreaLTC2=Xt.LTC_HALF_2)),r.ambient[0]=u,r.ambient[1]=h,r.ambient[2]=d;const C=r.hash;(C.directionalLength!==f||C.pointLength!==p||C.spotLength!==g||C.rectAreaLength!==m||C.hemiLength!==y||C.numDirectionalShadows!==b||C.numPointShadows!==w||C.numSpotShadows!==E||C.numSpotMaps!==M||C.numLightProbes!==P)&&(r.directional.length=f,r.spot.length=g,r.rectArea.length=m,r.point.length=p,r.hemi.length=y,r.directionalShadow.length=b,r.directionalShadowMap.length=b,r.pointShadow.length=w,r.pointShadowMap.length=w,r.spotShadow.length=E,r.spotShadowMap.length=E,r.directionalShadowMatrix.length=b,r.pointShadowMatrix.length=w,r.spotLightMatrix.length=E+M-A,r.spotLightMap.length=M,r.numSpotLightShadowsWithMaps=A,r.numLightProbes=P,C.directionalLength=f,C.pointLength=p,C.spotLength=g,C.rectAreaLength=m,C.hemiLength=y,C.numDirectionalShadows=b,C.numPointShadows=w,C.numSpotShadows=E,C.numSpotMaps=M,C.numLightProbes=P,r.version=SBe++)}function l(c,u){let h=0,d=0,f=0,p=0,g=0;const m=u.matrixWorldInverse;for(let y=0,b=c.length;y<b;y++){const w=c[y];if(w.isDirectionalLight){const E=r.directional[h];E.direction.setFromMatrixPosition(w.matrixWorld),n.setFromMatrixPosition(w.target.matrixWorld),E.direction.sub(n),E.direction.transformDirection(m),h++}else if(w.isSpotLight){const E=r.spot[f];E.position.setFromMatrixPosition(w.matrixWorld),E.position.applyMatrix4(m),E.direction.setFromMatrixPosition(w.matrixWorld),n.setFromMatrixPosition(w.target.matrixWorld),E.direction.sub(n),E.direction.transformDirection(m),f++}else if(w.isRectAreaLight){const E=r.rectArea[p];E.position.setFromMatrixPosition(w.matrixWorld),E.position.applyMatrix4(m),a.identity(),s.copy(w.matrixWorld),s.premultiply(m),a.extractRotation(s),E.halfWidth.set(w.width*.5,0,0),E.halfHeight.set(0,w.height*.5,0),E.halfWidth.applyMatrix4(a),E.halfHeight.applyMatrix4(a),p++}else if(w.isPointLight){const E=r.point[d];E.position.setFromMatrixPosition(w.matrixWorld),E.position.applyMatrix4(m),d++}else if(w.isHemisphereLight){const E=r.hemi[g];E.direction.setFromMatrixPosition(w.matrixWorld),E.direction.transformDirection(m),g++}}}return{setup:o,setupView:l,state:r}}function LY(t){const e=new ABe(t),i=[],r=[];function n(u){c.camera=u,i.length=0,r.length=0}function s(u){i.push(u)}function a(u){r.push(u)}function o(){e.setup(i)}function l(u){e.setupView(i,u)}const c={lightsArray:i,shadowsArray:r,camera:null,lights:e,transmissionRenderTarget:{}};return{init:n,state:c,setupLights:o,setupLightsView:l,pushLight:s,pushShadow:a}}function MBe(t){let e=new WeakMap;function i(n,s=0){const a=e.get(n);let o;return a===void 0?(o=new LY(t),e.set(n,[o])):s>=a.length?(o=new LY(t),a.push(o)):o=a[s],o}function r(){e=new WeakMap}return{get:i,dispose:r}}const TBe=`void main() {
	gl_Position = vec4( position, 1.0 );
}`,CBe=`uniform sampler2D shadow_pass;
uniform vec2 resolution;
uniform float radius;
#include <packing>
void main() {
	const float samples = float( VSM_SAMPLES );
	float mean = 0.0;
	float squared_mean = 0.0;
	float uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );
	float uvStart = samples <= 1.0 ? 0.0 : - 1.0;
	for ( float i = 0.0; i < samples; i ++ ) {
		float uvOffset = uvStart + i * uvStride;
		#ifdef HORIZONTAL_PASS
			vec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );
			mean += distribution.x;
			squared_mean += distribution.y * distribution.y + distribution.x * distribution.x;
		#else
			float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );
			mean += depth;
			squared_mean += depth * depth;
		#endif
	}
	mean = mean / samples;
	squared_mean = squared_mean / samples;
	float std_dev = sqrt( squared_mean - mean * mean );
	gl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );
}`;function PBe(t,e,i){let r=new v_;const n=new At,s=new At,a=new Ur,o=new hH({depthPacking:Ioe}),l=new dH,c={},u=i.maxTextureSize,h={[Fp]:bl,[bl]:Fp,[Sd]:Sd},d=new Ch({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new At},radius:{value:4}},vertexShader:TBe,fragmentShader:CBe}),f=d.clone();f.defines.HORIZONTAL_PASS=1;const p=new dr;p.setAttribute("position",new xn(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const g=new js(p,d),m=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=mO;let y=this.type;this.render=function(A,P,C){if(m.enabled===!1||m.autoUpdate===!1&&m.needsUpdate===!1||A.length===0)return;const R=t.getRenderTarget(),I=t.getActiveCubeFace(),k=t.getActiveMipmapLevel(),z=t.state;z.setBlending(Dp),z.buffers.depth.getReversed()===!0?z.buffers.color.setClear(0,0,0,0):z.buffers.color.setClear(1,1,1,1),z.buffers.depth.setTest(!0),z.setScissorTest(!1);const V=y!==ph&&this.type===ph,F=y===ph&&this.type!==ph;for(let $=0,K=A.length;$<K;$++){const X=A[$],U=X.shadow;if(U===void 0){console.warn("THREE.WebGLShadowMap:",X,"has no shadow.");continue}if(U.autoUpdate===!1&&U.needsUpdate===!1)continue;n.copy(U.mapSize);const Y=U.getFrameExtents();if(n.multiply(Y),s.copy(U.mapSize),(n.x>u||n.y>u)&&(n.x>u&&(s.x=Math.floor(u/Y.x),n.x=s.x*Y.x,U.mapSize.x=s.x),n.y>u&&(s.y=Math.floor(u/Y.y),n.y=s.y*Y.y,U.mapSize.y=s.y)),U.map===null||V===!0||F===!0){const j=this.type!==ph?{minFilter:wo,magFilter:wo}:{};U.map!==null&&U.map.dispose(),U.map=new Qd(n.x,n.y,j),U.map.texture.name=X.name+".shadowMap",U.camera.updateProjectionMatrix()}t.setRenderTarget(U.map),t.clear();const Z=U.getViewportCount();for(let j=0;j<Z;j++){const ee=U.getViewport(j);a.set(s.x*ee.x,s.y*ee.y,s.x*ee.z,s.y*ee.w),z.viewport(a),U.updateMatrices(X,j),r=U.getFrustum(),E(P,C,U.camera,X,this.type)}U.isPointLightShadow!==!0&&this.type===ph&&b(U,C),U.needsUpdate=!1}y=this.type,m.needsUpdate=!1,t.setRenderTarget(R,I,k)};function b(A,P){const C=e.update(g);d.defines.VSM_SAMPLES!==A.blurSamples&&(d.defines.VSM_SAMPLES=A.blurSamples,f.defines.VSM_SAMPLES=A.blurSamples,d.needsUpdate=!0,f.needsUpdate=!0),A.mapPass===null&&(A.mapPass=new Qd(n.x,n.y)),d.uniforms.shadow_pass.value=A.map.texture,d.uniforms.resolution.value=A.mapSize,d.uniforms.radius.value=A.radius,t.setRenderTarget(A.mapPass),t.clear(),t.renderBufferDirect(P,null,C,d,g,null),f.uniforms.shadow_pass.value=A.mapPass.texture,f.uniforms.resolution.value=A.mapSize,f.uniforms.radius.value=A.radius,t.setRenderTarget(A.map),t.clear(),t.renderBufferDirect(P,null,C,f,g,null)}function w(A,P,C,R){let I=null;const k=C.isPointLight===!0?A.customDistanceMaterial:A.customDepthMaterial;if(k!==void 0)I=k;else if(I=C.isPointLight===!0?l:o,t.localClippingEnabled&&P.clipShadows===!0&&Array.isArray(P.clippingPlanes)&&P.clippingPlanes.length!==0||P.displacementMap&&P.displacementScale!==0||P.alphaMap&&P.alphaTest>0||P.map&&P.alphaTest>0||P.alphaToCoverage===!0){const z=I.uuid,V=P.uuid;let F=c[z];F===void 0&&(F={},c[z]=F);let $=F[V];$===void 0&&($=I.clone(),F[V]=$,P.addEventListener("dispose",M)),I=$}if(I.visible=P.visible,I.wireframe=P.wireframe,R===ph?I.side=P.shadowSide!==null?P.shadowSide:P.side:I.side=P.shadowSide!==null?P.shadowSide:h[P.side],I.alphaMap=P.alphaMap,I.alphaTest=P.alphaToCoverage===!0?.5:P.alphaTest,I.map=P.map,I.clipShadows=P.clipShadows,I.clippingPlanes=P.clippingPlanes,I.clipIntersection=P.clipIntersection,I.displacementMap=P.displacementMap,I.displacementScale=P.displacementScale,I.displacementBias=P.displacementBias,I.wireframeLinewidth=P.wireframeLinewidth,I.linewidth=P.linewidth,C.isPointLight===!0&&I.isMeshDistanceMaterial===!0){const z=t.properties.get(I);z.light=C}return I}function E(A,P,C,R,I){if(A.visible===!1)return;if(A.layers.test(P.layers)&&(A.isMesh||A.isLine||A.isPoints)&&(A.castShadow||A.receiveShadow&&I===ph)&&(!A.frustumCulled||r.intersectsObject(A))){A.modelViewMatrix.multiplyMatrices(C.matrixWorldInverse,A.matrixWorld);const V=e.update(A),F=A.material;if(Array.isArray(F)){const $=V.groups;for(let K=0,X=$.length;K<X;K++){const U=$[K],Y=F[U.materialIndex];if(Y&&Y.visible){const Z=w(A,Y,R,I);A.onBeforeShadow(t,A,P,C,V,Z,U),t.renderBufferDirect(C,null,V,Z,A,U),A.onAfterShadow(t,A,P,C,V,Z,U)}}}else if(F.visible){const $=w(A,F,R,I);A.onBeforeShadow(t,A,P,C,V,$,null),t.renderBufferDirect(C,null,V,$,A,null),A.onAfterShadow(t,A,P,C,V,$,null)}}const z=A.children;for(let V=0,F=z.length;V<F;V++)E(z[V],P,C,R,I)}function M(A){A.target.removeEventListener("dispose",M);for(const C in c){const R=c[C],I=A.target.uuid;I in R&&(R[I].dispose(),delete R[I])}}}const RBe={[GI]:WI,[qI]:YI,[XI]:KI,[M0]:$I,[WI]:GI,[YI]:qI,[KI]:XI,[$I]:M0};function IBe(t,e){function i(){let oe=!1;const Re=new Ur;let ke=null;const st=new Ur(0,0,0,0);return{setMask:function(rt){ke!==rt&&!oe&&(t.colorMask(rt,rt,rt,rt),ke=rt)},setLocked:function(rt){oe=rt},setClear:function(rt,je,Tt,Ft,wi){wi===!0&&(rt*=Ft,je*=Ft,Tt*=Ft),Re.set(rt,je,Tt,Ft),st.equals(Re)===!1&&(t.clearColor(rt,je,Tt,Ft),st.copy(Re))},reset:function(){oe=!1,ke=null,st.set(-1,0,0,0)}}}function r(){let oe=!1,Re=!1,ke=null,st=null,rt=null;return{setReversed:function(je){if(Re!==je){const Tt=e.get("EXT_clip_control");je?Tt.clipControlEXT(Tt.LOWER_LEFT_EXT,Tt.ZERO_TO_ONE_EXT):Tt.clipControlEXT(Tt.LOWER_LEFT_EXT,Tt.NEGATIVE_ONE_TO_ONE_EXT),Re=je;const Ft=rt;rt=null,this.setClear(Ft)}},getReversed:function(){return Re},setTest:function(je){je?le(t.DEPTH_TEST):he(t.DEPTH_TEST)},setMask:function(je){ke!==je&&!oe&&(t.depthMask(je),ke=je)},setFunc:function(je){if(Re&&(je=RBe[je]),st!==je){switch(je){case GI:t.depthFunc(t.NEVER);break;case WI:t.depthFunc(t.ALWAYS);break;case qI:t.depthFunc(t.LESS);break;case M0:t.depthFunc(t.LEQUAL);break;case XI:t.depthFunc(t.EQUAL);break;case $I:t.depthFunc(t.GEQUAL);break;case YI:t.depthFunc(t.GREATER);break;case KI:t.depthFunc(t.NOTEQUAL);break;default:t.depthFunc(t.LEQUAL)}st=je}},setLocked:function(je){oe=je},setClear:function(je){rt!==je&&(Re&&(je=1-je),t.clearDepth(je),rt=je)},reset:function(){oe=!1,ke=null,st=null,rt=null,Re=!1}}}function n(){let oe=!1,Re=null,ke=null,st=null,rt=null,je=null,Tt=null,Ft=null,wi=null;return{setTest:function(ti){oe||(ti?le(t.STENCIL_TEST):he(t.STENCIL_TEST))},setMask:function(ti){Re!==ti&&!oe&&(t.stencilMask(ti),Re=ti)},setFunc:function(ti,Zi,Xi){(ke!==ti||st!==Zi||rt!==Xi)&&(t.stencilFunc(ti,Zi,Xi),ke=ti,st=Zi,rt=Xi)},setOp:function(ti,Zi,Xi){(je!==ti||Tt!==Zi||Ft!==Xi)&&(t.stencilOp(ti,Zi,Xi),je=ti,Tt=Zi,Ft=Xi)},setLocked:function(ti){oe=ti},setClear:function(ti){wi!==ti&&(t.clearStencil(ti),wi=ti)},reset:function(){oe=!1,Re=null,ke=null,st=null,rt=null,je=null,Tt=null,Ft=null,wi=null}}}const s=new i,a=new r,o=new n,l=new WeakMap,c=new WeakMap;let u={},h={},d=new WeakMap,f=[],p=null,g=!1,m=null,y=null,b=null,w=null,E=null,M=null,A=null,P=new ii(0,0,0),C=0,R=!1,I=null,k=null,z=null,V=null,F=null;const $=t.getParameter(t.MAX_COMBINED_TEXTURE_IMAGE_UNITS);let K=!1,X=0;const U=t.getParameter(t.VERSION);U.indexOf("WebGL")!==-1?(X=parseFloat(/^WebGL (\d)/.exec(U)[1]),K=X>=1):U.indexOf("OpenGL ES")!==-1&&(X=parseFloat(/^OpenGL ES (\d)/.exec(U)[1]),K=X>=2);let Y=null,Z={};const j=t.getParameter(t.SCISSOR_BOX),ee=t.getParameter(t.VIEWPORT),pe=new Ur().fromArray(j),fe=new Ur().fromArray(ee);function se(oe,Re,ke,st){const rt=new Uint8Array(4),je=t.createTexture();t.bindTexture(oe,je),t.texParameteri(oe,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(oe,t.TEXTURE_MAG_FILTER,t.NEAREST);for(let Tt=0;Tt<ke;Tt++)oe===t.TEXTURE_3D||oe===t.TEXTURE_2D_ARRAY?t.texImage3D(Re,0,t.RGBA,1,1,st,0,t.RGBA,t.UNSIGNED_BYTE,rt):t.texImage2D(Re+Tt,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,rt);return je}const re={};re[t.TEXTURE_2D]=se(t.TEXTURE_2D,t.TEXTURE_2D,1),re[t.TEXTURE_CUBE_MAP]=se(t.TEXTURE_CUBE_MAP,t.TEXTURE_CUBE_MAP_POSITIVE_X,6),re[t.TEXTURE_2D_ARRAY]=se(t.TEXTURE_2D_ARRAY,t.TEXTURE_2D_ARRAY,1,1),re[t.TEXTURE_3D]=se(t.TEXTURE_3D,t.TEXTURE_3D,1,1),s.setClear(0,0,0,1),a.setClear(1),o.setClear(0),le(t.DEPTH_TEST),a.setFunc(M0),He(!1),Be(Vz),le(t.CULL_FACE),Fe(Dp);function le(oe){u[oe]!==!0&&(t.enable(oe),u[oe]=!0)}function he(oe){u[oe]!==!1&&(t.disable(oe),u[oe]=!1)}function ve(oe,Re){return h[oe]!==Re?(t.bindFramebuffer(oe,Re),h[oe]=Re,oe===t.DRAW_FRAMEBUFFER&&(h[t.FRAMEBUFFER]=Re),oe===t.FRAMEBUFFER&&(h[t.DRAW_FRAMEBUFFER]=Re),!0):!1}function xe(oe,Re){let ke=f,st=!1;if(oe){ke=d.get(Re),ke===void 0&&(ke=[],d.set(Re,ke));const rt=oe.textures;if(ke.length!==rt.length||ke[0]!==t.COLOR_ATTACHMENT0){for(let je=0,Tt=rt.length;je<Tt;je++)ke[je]=t.COLOR_ATTACHMENT0+je;ke.length=rt.length,st=!0}}else ke[0]!==t.BACK&&(ke[0]=t.BACK,st=!0);st&&t.drawBuffers(ke)}function Se(oe){return p!==oe?(t.useProgram(oe),p=oe,!0):!1}const Ce={[vg]:t.FUNC_ADD,[toe]:t.FUNC_SUBTRACT,[ioe]:t.FUNC_REVERSE_SUBTRACT};Ce[roe]=t.MIN,Ce[noe]=t.MAX;const ce={[soe]:t.ZERO,[aoe]:t.ONE,[ooe]:t.SRC_COLOR,[VI]:t.SRC_ALPHA,[foe]:t.SRC_ALPHA_SATURATE,[hoe]:t.DST_COLOR,[coe]:t.DST_ALPHA,[loe]:t.ONE_MINUS_SRC_COLOR,[HI]:t.ONE_MINUS_SRC_ALPHA,[doe]:t.ONE_MINUS_DST_COLOR,[uoe]:t.ONE_MINUS_DST_ALPHA,[poe]:t.CONSTANT_COLOR,[moe]:t.ONE_MINUS_CONSTANT_COLOR,[goe]:t.CONSTANT_ALPHA,[voe]:t.ONE_MINUS_CONSTANT_ALPHA};function Fe(oe,Re,ke,st,rt,je,Tt,Ft,wi,ti){if(oe===Dp){g===!0&&(he(t.BLEND),g=!1);return}if(g===!1&&(le(t.BLEND),g=!0),oe!==eoe){if(oe!==m||ti!==R){if((y!==vg||E!==vg)&&(t.blendEquation(t.FUNC_ADD),y=vg,E=vg),ti)switch(oe){case h0:t.blendFuncSeparate(t.ONE,t.ONE_MINUS_SRC_ALPHA,t.ONE,t.ONE_MINUS_SRC_ALPHA);break;case Hz:t.blendFunc(t.ONE,t.ONE);break;case Gz:t.blendFuncSeparate(t.ZERO,t.ONE_MINUS_SRC_COLOR,t.ZERO,t.ONE);break;case Wz:t.blendFuncSeparate(t.DST_COLOR,t.ONE_MINUS_SRC_ALPHA,t.ZERO,t.ONE);break;default:console.error("THREE.WebGLState: Invalid blending: ",oe);break}else switch(oe){case h0:t.blendFuncSeparate(t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA,t.ONE,t.ONE_MINUS_SRC_ALPHA);break;case Hz:t.blendFuncSeparate(t.SRC_ALPHA,t.ONE,t.ONE,t.ONE);break;case Gz:console.error("THREE.WebGLState: SubtractiveBlending requires material.premultipliedAlpha = true");break;case Wz:console.error("THREE.WebGLState: MultiplyBlending requires material.premultipliedAlpha = true");break;default:console.error("THREE.WebGLState: Invalid blending: ",oe);break}b=null,w=null,M=null,A=null,P.set(0,0,0),C=0,m=oe,R=ti}return}rt=rt||Re,je=je||ke,Tt=Tt||st,(Re!==y||rt!==E)&&(t.blendEquationSeparate(Ce[Re],Ce[rt]),y=Re,E=rt),(ke!==b||st!==w||je!==M||Tt!==A)&&(t.blendFuncSeparate(ce[ke],ce[st],ce[je],ce[Tt]),b=ke,w=st,M=je,A=Tt),(Ft.equals(P)===!1||wi!==C)&&(t.blendColor(Ft.r,Ft.g,Ft.b,wi),P.copy(Ft),C=wi),m=oe,R=!1}function De(oe,Re){oe.side===Sd?he(t.CULL_FACE):le(t.CULL_FACE);let ke=oe.side===bl;Re&&(ke=!ke),He(ke),oe.blending===h0&&oe.transparent===!1?Fe(Dp):Fe(oe.blending,oe.blendEquation,oe.blendSrc,oe.blendDst,oe.blendEquationAlpha,oe.blendSrcAlpha,oe.blendDstAlpha,oe.blendColor,oe.blendAlpha,oe.premultipliedAlpha),a.setFunc(oe.depthFunc),a.setTest(oe.depthTest),a.setMask(oe.depthWrite),s.setMask(oe.colorWrite);const st=oe.stencilWrite;o.setTest(st),st&&(o.setMask(oe.stencilWriteMask),o.setFunc(oe.stencilFunc,oe.stencilRef,oe.stencilFuncMask),o.setOp(oe.stencilFail,oe.stencilZFail,oe.stencilZPass)),ze(oe.polygonOffset,oe.polygonOffsetFactor,oe.polygonOffsetUnits),oe.alphaToCoverage===!0?le(t.SAMPLE_ALPHA_TO_COVERAGE):he(t.SAMPLE_ALPHA_TO_COVERAGE)}function He(oe){I!==oe&&(oe?t.frontFace(t.CW):t.frontFace(t.CCW),I=oe)}function Be(oe){oe!==Zae?(le(t.CULL_FACE),oe!==k&&(oe===Vz?t.cullFace(t.BACK):oe===Qae?t.cullFace(t.FRONT):t.cullFace(t.FRONT_AND_BACK))):he(t.CULL_FACE),k=oe}function $e(oe){oe!==z&&(K&&t.lineWidth(oe),z=oe)}function ze(oe,Re,ke){oe?(le(t.POLYGON_OFFSET_FILL),(V!==Re||F!==ke)&&(t.polygonOffset(Re,ke),V=Re,F=ke)):he(t.POLYGON_OFFSET_FILL)}function it(oe){oe?le(t.SCISSOR_TEST):he(t.SCISSOR_TEST)}function wt(oe){oe===void 0&&(oe=t.TEXTURE0+$-1),Y!==oe&&(t.activeTexture(oe),Y=oe)}function ge(oe,Re,ke){ke===void 0&&(Y===null?ke=t.TEXTURE0+$-1:ke=Y);let st=Z[ke];st===void 0&&(st={type:void 0,texture:void 0},Z[ke]=st),(st.type!==oe||st.texture!==Re)&&(Y!==ke&&(t.activeTexture(ke),Y=ke),t.bindTexture(oe,Re||re[oe]),st.type=oe,st.texture=Re)}function G(){const oe=Z[Y];oe!==void 0&&oe.type!==void 0&&(t.bindTexture(oe.type,null),oe.type=void 0,oe.texture=void 0)}function Q(){try{t.compressedTexImage2D(...arguments)}catch(oe){console.error("THREE.WebGLState:",oe)}}function we(){try{t.compressedTexImage3D(...arguments)}catch(oe){console.error("THREE.WebGLState:",oe)}}function te(){try{t.texSubImage2D(...arguments)}catch(oe){console.error("THREE.WebGLState:",oe)}}function Ne(){try{t.texSubImage3D(...arguments)}catch(oe){console.error("THREE.WebGLState:",oe)}}function Le(){try{t.compressedTexSubImage2D(...arguments)}catch(oe){console.error("THREE.WebGLState:",oe)}}function at(){try{t.compressedTexSubImage3D(...arguments)}catch(oe){console.error("THREE.WebGLState:",oe)}}function Te(){try{t.texStorage2D(...arguments)}catch(oe){console.error("THREE.WebGLState:",oe)}}function dt(){try{t.texStorage3D(...arguments)}catch(oe){console.error("THREE.WebGLState:",oe)}}function ot(){try{t.texImage2D(...arguments)}catch(oe){console.error("THREE.WebGLState:",oe)}}function Qe(){try{t.texImage3D(...arguments)}catch(oe){console.error("THREE.WebGLState:",oe)}}function pt(oe){pe.equals(oe)===!1&&(t.scissor(oe.x,oe.y,oe.z,oe.w),pe.copy(oe))}function _t(oe){fe.equals(oe)===!1&&(t.viewport(oe.x,oe.y,oe.z,oe.w),fe.copy(oe))}function yt(oe,Re){let ke=c.get(Re);ke===void 0&&(ke=new WeakMap,c.set(Re,ke));let st=ke.get(oe);st===void 0&&(st=t.getUniformBlockIndex(Re,oe.name),ke.set(oe,st))}function Et(oe,Re){const st=c.get(Re).get(oe);l.get(Re)!==st&&(t.uniformBlockBinding(Re,st,oe.__bindingPointIndex),l.set(Re,st))}function $t(){t.disable(t.BLEND),t.disable(t.CULL_FACE),t.disable(t.DEPTH_TEST),t.disable(t.POLYGON_OFFSET_FILL),t.disable(t.SCISSOR_TEST),t.disable(t.STENCIL_TEST),t.disable(t.SAMPLE_ALPHA_TO_COVERAGE),t.blendEquation(t.FUNC_ADD),t.blendFunc(t.ONE,t.ZERO),t.blendFuncSeparate(t.ONE,t.ZERO,t.ONE,t.ZERO),t.blendColor(0,0,0,0),t.colorMask(!0,!0,!0,!0),t.clearColor(0,0,0,0),t.depthMask(!0),t.depthFunc(t.LESS),a.setReversed(!1),t.clearDepth(1),t.stencilMask(4294967295),t.stencilFunc(t.ALWAYS,0,4294967295),t.stencilOp(t.KEEP,t.KEEP,t.KEEP),t.clearStencil(0),t.cullFace(t.BACK),t.frontFace(t.CCW),t.polygonOffset(0,0),t.activeTexture(t.TEXTURE0),t.bindFramebuffer(t.FRAMEBUFFER,null),t.bindFramebuffer(t.DRAW_FRAMEBUFFER,null),t.bindFramebuffer(t.READ_FRAMEBUFFER,null),t.useProgram(null),t.lineWidth(1),t.scissor(0,0,t.canvas.width,t.canvas.height),t.viewport(0,0,t.canvas.width,t.canvas.height),u={},Y=null,Z={},h={},d=new WeakMap,f=[],p=null,g=!1,m=null,y=null,b=null,w=null,E=null,M=null,A=null,P=new ii(0,0,0),C=0,R=!1,I=null,k=null,z=null,V=null,F=null,pe.set(0,0,t.canvas.width,t.canvas.height),fe.set(0,0,t.canvas.width,t.canvas.height),s.reset(),a.reset(),o.reset()}return{buffers:{color:s,depth:a,stencil:o},enable:le,disable:he,bindFramebuffer:ve,drawBuffers:xe,useProgram:Se,setBlending:Fe,setMaterial:De,setFlipSided:He,setCullFace:Be,setLineWidth:$e,setPolygonOffset:ze,setScissorTest:it,activeTexture:wt,bindTexture:ge,unbindTexture:G,compressedTexImage2D:Q,compressedTexImage3D:we,texImage2D:ot,texImage3D:Qe,updateUBOMapping:yt,uniformBlockBinding:Et,texStorage2D:Te,texStorage3D:dt,texSubImage2D:te,texSubImage3D:Ne,compressedTexSubImage2D:Le,compressedTexSubImage3D:at,scissor:pt,viewport:_t,reset:$t}}function DBe(t,e,i,r,n,s,a){const o=e.has("WEBGL_multisampled_render_to_texture")?e.get("WEBGL_multisampled_render_to_texture"):null,l=typeof navigator>"u"?!1:/OculusBrowser/g.test(navigator.userAgent),c=new At,u=new WeakMap;let h;const d=new WeakMap;let f=!1;try{f=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")!==null}catch{}function p(G,Q){return f?new OffscreenCanvas(G,Q):gM("canvas")}function g(G,Q,we){let te=1;const Ne=ge(G);if((Ne.width>we||Ne.height>we)&&(te=we/Math.max(Ne.width,Ne.height)),te<1)if(typeof HTMLImageElement<"u"&&G instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&G instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&G instanceof ImageBitmap||typeof VideoFrame<"u"&&G instanceof VideoFrame){const Le=Math.floor(te*Ne.width),at=Math.floor(te*Ne.height);h===void 0&&(h=p(Le,at));const Te=Q?p(Le,at):h;return Te.width=Le,Te.height=at,Te.getContext("2d").drawImage(G,0,0,Le,at),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+Ne.width+"x"+Ne.height+") to ("+Le+"x"+at+")."),Te}else return"data"in G&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+Ne.width+"x"+Ne.height+")."),G;return G}function m(G){return G.generateMipmaps}function y(G){t.generateMipmap(G)}function b(G){return G.isWebGLCubeRenderTarget?t.TEXTURE_CUBE_MAP:G.isWebGL3DRenderTarget?t.TEXTURE_3D:G.isWebGLArrayRenderTarget||G.isCompressedArrayTexture?t.TEXTURE_2D_ARRAY:t.TEXTURE_2D}function w(G,Q,we,te,Ne=!1){if(G!==null){if(t[G]!==void 0)return t[G];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+G+"'")}let Le=Q;if(Q===t.RED&&(we===t.FLOAT&&(Le=t.R32F),we===t.HALF_FLOAT&&(Le=t.R16F),we===t.UNSIGNED_BYTE&&(Le=t.R8)),Q===t.RED_INTEGER&&(we===t.UNSIGNED_BYTE&&(Le=t.R8UI),we===t.UNSIGNED_SHORT&&(Le=t.R16UI),we===t.UNSIGNED_INT&&(Le=t.R32UI),we===t.BYTE&&(Le=t.R8I),we===t.SHORT&&(Le=t.R16I),we===t.INT&&(Le=t.R32I)),Q===t.RG&&(we===t.FLOAT&&(Le=t.RG32F),we===t.HALF_FLOAT&&(Le=t.RG16F),we===t.UNSIGNED_BYTE&&(Le=t.RG8)),Q===t.RG_INTEGER&&(we===t.UNSIGNED_BYTE&&(Le=t.RG8UI),we===t.UNSIGNED_SHORT&&(Le=t.RG16UI),we===t.UNSIGNED_INT&&(Le=t.RG32UI),we===t.BYTE&&(Le=t.RG8I),we===t.SHORT&&(Le=t.RG16I),we===t.INT&&(Le=t.RG32I)),Q===t.RGB_INTEGER&&(we===t.UNSIGNED_BYTE&&(Le=t.RGB8UI),we===t.UNSIGNED_SHORT&&(Le=t.RGB16UI),we===t.UNSIGNED_INT&&(Le=t.RGB32UI),we===t.BYTE&&(Le=t.RGB8I),we===t.SHORT&&(Le=t.RGB16I),we===t.INT&&(Le=t.RGB32I)),Q===t.RGBA_INTEGER&&(we===t.UNSIGNED_BYTE&&(Le=t.RGBA8UI),we===t.UNSIGNED_SHORT&&(Le=t.RGBA16UI),we===t.UNSIGNED_INT&&(Le=t.RGBA32UI),we===t.BYTE&&(Le=t.RGBA8I),we===t.SHORT&&(Le=t.RGBA16I),we===t.INT&&(Le=t.RGBA32I)),Q===t.RGB&&(we===t.UNSIGNED_INT_5_9_9_9_REV&&(Le=t.RGB9_E5),we===t.UNSIGNED_INT_10F_11F_11F_REV&&(Le=t.R11F_G11F_B10F)),Q===t.RGBA){const at=Ne?pM:Lr.getTransfer(te);we===t.FLOAT&&(Le=t.RGBA32F),we===t.HALF_FLOAT&&(Le=t.RGBA16F),we===t.UNSIGNED_BYTE&&(Le=at===on?t.SRGB8_ALPHA8:t.RGBA8),we===t.UNSIGNED_SHORT_4_4_4_4&&(Le=t.RGBA4),we===t.UNSIGNED_SHORT_5_5_5_1&&(Le=t.RGB5_A1)}return(Le===t.R16F||Le===t.R32F||Le===t.RG16F||Le===t.RG32F||Le===t.RGBA16F||Le===t.RGBA32F)&&e.get("EXT_color_buffer_float"),Le}function E(G,Q){let we;return G?Q===null||Q===jp||Q===I1?we=t.DEPTH24_STENCIL8:Q===tc?we=t.DEPTH32F_STENCIL8:Q===R1&&(we=t.DEPTH24_STENCIL8,console.warn("DepthTexture: 16 bit depth attachment is not supported with stencil. Using 24-bit attachment.")):Q===null||Q===jp||Q===I1?we=t.DEPTH_COMPONENT24:Q===tc?we=t.DEPTH_COMPONENT32F:Q===R1&&(we=t.DEPTH_COMPONENT16),we}function M(G,Q){return m(G)===!0||G.isFramebufferTexture&&G.minFilter!==wo&&G.minFilter!==ma?Math.log2(Math.max(Q.width,Q.height))+1:G.mipmaps!==void 0&&G.mipmaps.length>0?G.mipmaps.length:G.isCompressedTexture&&Array.isArray(G.image)?Q.mipmaps.length:1}function A(G){const Q=G.target;Q.removeEventListener("dispose",A),C(Q),Q.isVideoTexture&&u.delete(Q)}function P(G){const Q=G.target;Q.removeEventListener("dispose",P),I(Q)}function C(G){const Q=r.get(G);if(Q.__webglInit===void 0)return;const we=G.source,te=d.get(we);if(te){const Ne=te[Q.__cacheKey];Ne.usedTimes--,Ne.usedTimes===0&&R(G),Object.keys(te).length===0&&d.delete(we)}r.remove(G)}function R(G){const Q=r.get(G);t.deleteTexture(Q.__webglTexture);const we=G.source,te=d.get(we);delete te[Q.__cacheKey],a.memory.textures--}function I(G){const Q=r.get(G);if(G.depthTexture&&(G.depthTexture.dispose(),r.remove(G.depthTexture)),G.isWebGLCubeRenderTarget)for(let te=0;te<6;te++){if(Array.isArray(Q.__webglFramebuffer[te]))for(let Ne=0;Ne<Q.__webglFramebuffer[te].length;Ne++)t.deleteFramebuffer(Q.__webglFramebuffer[te][Ne]);else t.deleteFramebuffer(Q.__webglFramebuffer[te]);Q.__webglDepthbuffer&&t.deleteRenderbuffer(Q.__webglDepthbuffer[te])}else{if(Array.isArray(Q.__webglFramebuffer))for(let te=0;te<Q.__webglFramebuffer.length;te++)t.deleteFramebuffer(Q.__webglFramebuffer[te]);else t.deleteFramebuffer(Q.__webglFramebuffer);if(Q.__webglDepthbuffer&&t.deleteRenderbuffer(Q.__webglDepthbuffer),Q.__webglMultisampledFramebuffer&&t.deleteFramebuffer(Q.__webglMultisampledFramebuffer),Q.__webglColorRenderbuffer)for(let te=0;te<Q.__webglColorRenderbuffer.length;te++)Q.__webglColorRenderbuffer[te]&&t.deleteRenderbuffer(Q.__webglColorRenderbuffer[te]);Q.__webglDepthRenderbuffer&&t.deleteRenderbuffer(Q.__webglDepthRenderbuffer)}const we=G.textures;for(let te=0,Ne=we.length;te<Ne;te++){const Le=r.get(we[te]);Le.__webglTexture&&(t.deleteTexture(Le.__webglTexture),a.memory.textures--),r.remove(we[te])}r.remove(G)}let k=0;function z(){k=0}function V(){const G=k;return G>=n.maxTextures&&console.warn("THREE.WebGLTextures: Trying to use "+G+" texture units while this GPU supports only "+n.maxTextures),k+=1,G}function F(G){const Q=[];return Q.push(G.wrapS),Q.push(G.wrapT),Q.push(G.wrapR||0),Q.push(G.magFilter),Q.push(G.minFilter),Q.push(G.anisotropy),Q.push(G.internalFormat),Q.push(G.format),Q.push(G.type),Q.push(G.generateMipmaps),Q.push(G.premultiplyAlpha),Q.push(G.flipY),Q.push(G.unpackAlignment),Q.push(G.colorSpace),Q.join()}function $(G,Q){const we=r.get(G);if(G.isVideoTexture&&it(G),G.isRenderTargetTexture===!1&&G.isExternalTexture!==!0&&G.version>0&&we.__version!==G.version){const te=G.image;if(te===null)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else if(te.complete===!1)console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete");else{re(we,G,Q);return}}else G.isExternalTexture&&(we.__webglTexture=G.sourceTexture?G.sourceTexture:null);i.bindTexture(t.TEXTURE_2D,we.__webglTexture,t.TEXTURE0+Q)}function K(G,Q){const we=r.get(G);if(G.isRenderTargetTexture===!1&&G.version>0&&we.__version!==G.version){re(we,G,Q);return}i.bindTexture(t.TEXTURE_2D_ARRAY,we.__webglTexture,t.TEXTURE0+Q)}function X(G,Q){const we=r.get(G);if(G.isRenderTargetTexture===!1&&G.version>0&&we.__version!==G.version){re(we,G,Q);return}i.bindTexture(t.TEXTURE_3D,we.__webglTexture,t.TEXTURE0+Q)}function U(G,Q){const we=r.get(G);if(G.version>0&&we.__version!==G.version){le(we,G,Q);return}i.bindTexture(t.TEXTURE_CUBE_MAP,we.__webglTexture,t.TEXTURE0+Q)}const Y={[uM]:t.REPEAT,[gu]:t.CLAMP_TO_EDGE,[hM]:t.MIRRORED_REPEAT},Z={[wo]:t.NEAREST,[U6]:t.NEAREST_MIPMAP_NEAREST,[Vw]:t.NEAREST_MIPMAP_LINEAR,[ma]:t.LINEAR,[yA]:t.LINEAR_MIPMAP_NEAREST,[Id]:t.LINEAR_MIPMAP_LINEAR},j={[Ooe]:t.NEVER,[Foe]:t.ALWAYS,[Loe]:t.LESS,[q6]:t.LEQUAL,[koe]:t.EQUAL,[Boe]:t.GEQUAL,[Noe]:t.GREATER,[Uoe]:t.NOTEQUAL};function ee(G,Q){if(Q.type===tc&&e.has("OES_texture_float_linear")===!1&&(Q.magFilter===ma||Q.magFilter===yA||Q.magFilter===Vw||Q.magFilter===Id||Q.minFilter===ma||Q.minFilter===yA||Q.minFilter===Vw||Q.minFilter===Id)&&console.warn("THREE.WebGLRenderer: Unable to use linear filtering with floating point textures. OES_texture_float_linear not supported on this device."),t.texParameteri(G,t.TEXTURE_WRAP_S,Y[Q.wrapS]),t.texParameteri(G,t.TEXTURE_WRAP_T,Y[Q.wrapT]),(G===t.TEXTURE_3D||G===t.TEXTURE_2D_ARRAY)&&t.texParameteri(G,t.TEXTURE_WRAP_R,Y[Q.wrapR]),t.texParameteri(G,t.TEXTURE_MAG_FILTER,Z[Q.magFilter]),t.texParameteri(G,t.TEXTURE_MIN_FILTER,Z[Q.minFilter]),Q.compareFunction&&(t.texParameteri(G,t.TEXTURE_COMPARE_MODE,t.COMPARE_REF_TO_TEXTURE),t.texParameteri(G,t.TEXTURE_COMPARE_FUNC,j[Q.compareFunction])),e.has("EXT_texture_filter_anisotropic")===!0){if(Q.magFilter===wo||Q.minFilter!==Vw&&Q.minFilter!==Id||Q.type===tc&&e.has("OES_texture_float_linear")===!1)return;if(Q.anisotropy>1||r.get(Q).__currentAnisotropy){const we=e.get("EXT_texture_filter_anisotropic");t.texParameterf(G,we.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(Q.anisotropy,n.getMaxAnisotropy())),r.get(Q).__currentAnisotropy=Q.anisotropy}}}function pe(G,Q){let we=!1;G.__webglInit===void 0&&(G.__webglInit=!0,Q.addEventListener("dispose",A));const te=Q.source;let Ne=d.get(te);Ne===void 0&&(Ne={},d.set(te,Ne));const Le=F(Q);if(Le!==G.__cacheKey){Ne[Le]===void 0&&(Ne[Le]={texture:t.createTexture(),usedTimes:0},a.memory.textures++,we=!0),Ne[Le].usedTimes++;const at=Ne[G.__cacheKey];at!==void 0&&(Ne[G.__cacheKey].usedTimes--,at.usedTimes===0&&R(Q)),G.__cacheKey=Le,G.__webglTexture=Ne[Le].texture}return we}function fe(G,Q,we){return Math.floor(Math.floor(G/we)/Q)}function se(G,Q,we,te){const Le=G.updateRanges;if(Le.length===0)i.texSubImage2D(t.TEXTURE_2D,0,0,0,Q.width,Q.height,we,te,Q.data);else{Le.sort((Qe,pt)=>Qe.start-pt.start);let at=0;for(let Qe=1;Qe<Le.length;Qe++){const pt=Le[at],_t=Le[Qe],yt=pt.start+pt.count,Et=fe(_t.start,Q.width,4),$t=fe(pt.start,Q.width,4);_t.start<=yt+1&&Et===$t&&fe(_t.start+_t.count-1,Q.width,4)===Et?pt.count=Math.max(pt.count,_t.start+_t.count-pt.start):(++at,Le[at]=_t)}Le.length=at+1;const Te=t.getParameter(t.UNPACK_ROW_LENGTH),dt=t.getParameter(t.UNPACK_SKIP_PIXELS),ot=t.getParameter(t.UNPACK_SKIP_ROWS);t.pixelStorei(t.UNPACK_ROW_LENGTH,Q.width);for(let Qe=0,pt=Le.length;Qe<pt;Qe++){const _t=Le[Qe],yt=Math.floor(_t.start/4),Et=Math.ceil(_t.count/4),$t=yt%Q.width,oe=Math.floor(yt/Q.width),Re=Et,ke=1;t.pixelStorei(t.UNPACK_SKIP_PIXELS,$t),t.pixelStorei(t.UNPACK_SKIP_ROWS,oe),i.texSubImage2D(t.TEXTURE_2D,0,$t,oe,Re,ke,we,te,Q.data)}G.clearUpdateRanges(),t.pixelStorei(t.UNPACK_ROW_LENGTH,Te),t.pixelStorei(t.UNPACK_SKIP_PIXELS,dt),t.pixelStorei(t.UNPACK_SKIP_ROWS,ot)}}function re(G,Q,we){let te=t.TEXTURE_2D;(Q.isDataArrayTexture||Q.isCompressedArrayTexture)&&(te=t.TEXTURE_2D_ARRAY),Q.isData3DTexture&&(te=t.TEXTURE_3D);const Ne=pe(G,Q),Le=Q.source;i.bindTexture(te,G.__webglTexture,t.TEXTURE0+we);const at=r.get(Le);if(Le.version!==at.__version||Ne===!0){i.activeTexture(t.TEXTURE0+we);const Te=Lr.getPrimaries(Lr.workingColorSpace),dt=Q.colorSpace===xp?null:Lr.getPrimaries(Q.colorSpace),ot=Q.colorSpace===xp||Te===dt?t.NONE:t.BROWSER_DEFAULT_WEBGL;t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,Q.flipY),t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,Q.premultiplyAlpha),t.pixelStorei(t.UNPACK_ALIGNMENT,Q.unpackAlignment),t.pixelStorei(t.UNPACK_COLORSPACE_CONVERSION_WEBGL,ot);let Qe=g(Q.image,!1,n.maxTextureSize);Qe=wt(Q,Qe);const pt=s.convert(Q.format,Q.colorSpace),_t=s.convert(Q.type);let yt=w(Q.internalFormat,pt,_t,Q.colorSpace,Q.isVideoTexture);ee(te,Q);let Et;const $t=Q.mipmaps,oe=Q.isVideoTexture!==!0,Re=at.__version===void 0||Ne===!0,ke=Le.dataReady,st=M(Q,Qe);if(Q.isDepthTexture)yt=E(Q.format===O1,Q.type),Re&&(oe?i.texStorage2D(t.TEXTURE_2D,1,yt,Qe.width,Qe.height):i.texImage2D(t.TEXTURE_2D,0,yt,Qe.width,Qe.height,0,pt,_t,null));else if(Q.isDataTexture)if($t.length>0){oe&&Re&&i.texStorage2D(t.TEXTURE_2D,st,yt,$t[0].width,$t[0].height);for(let rt=0,je=$t.length;rt<je;rt++)Et=$t[rt],oe?ke&&i.texSubImage2D(t.TEXTURE_2D,rt,0,0,Et.width,Et.height,pt,_t,Et.data):i.texImage2D(t.TEXTURE_2D,rt,yt,Et.width,Et.height,0,pt,_t,Et.data);Q.generateMipmaps=!1}else oe?(Re&&i.texStorage2D(t.TEXTURE_2D,st,yt,Qe.width,Qe.height),ke&&se(Q,Qe,pt,_t)):i.texImage2D(t.TEXTURE_2D,0,yt,Qe.width,Qe.height,0,pt,_t,Qe.data);else if(Q.isCompressedTexture)if(Q.isCompressedArrayTexture){oe&&Re&&i.texStorage3D(t.TEXTURE_2D_ARRAY,st,yt,$t[0].width,$t[0].height,Qe.depth);for(let rt=0,je=$t.length;rt<je;rt++)if(Et=$t[rt],Q.format!==zo)if(pt!==null)if(oe){if(ke)if(Q.layerUpdates.size>0){const Tt=tj(Et.width,Et.height,Q.format,Q.type);for(const Ft of Q.layerUpdates){const wi=Et.data.subarray(Ft*Tt/Et.data.BYTES_PER_ELEMENT,(Ft+1)*Tt/Et.data.BYTES_PER_ELEMENT);i.compressedTexSubImage3D(t.TEXTURE_2D_ARRAY,rt,0,0,Ft,Et.width,Et.height,1,pt,wi)}Q.clearLayerUpdates()}else i.compressedTexSubImage3D(t.TEXTURE_2D_ARRAY,rt,0,0,0,Et.width,Et.height,Qe.depth,pt,Et.data)}else i.compressedTexImage3D(t.TEXTURE_2D_ARRAY,rt,yt,Et.width,Et.height,Qe.depth,0,Et.data,0,0);else console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()");else oe?ke&&i.texSubImage3D(t.TEXTURE_2D_ARRAY,rt,0,0,0,Et.width,Et.height,Qe.depth,pt,_t,Et.data):i.texImage3D(t.TEXTURE_2D_ARRAY,rt,yt,Et.width,Et.height,Qe.depth,0,pt,_t,Et.data)}else{oe&&Re&&i.texStorage2D(t.TEXTURE_2D,st,yt,$t[0].width,$t[0].height);for(let rt=0,je=$t.length;rt<je;rt++)Et=$t[rt],Q.format!==zo?pt!==null?oe?ke&&i.compressedTexSubImage2D(t.TEXTURE_2D,rt,0,0,Et.width,Et.height,pt,Et.data):i.compressedTexImage2D(t.TEXTURE_2D,rt,yt,Et.width,Et.height,0,Et.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):oe?ke&&i.texSubImage2D(t.TEXTURE_2D,rt,0,0,Et.width,Et.height,pt,_t,Et.data):i.texImage2D(t.TEXTURE_2D,rt,yt,Et.width,Et.height,0,pt,_t,Et.data)}else if(Q.isDataArrayTexture)if(oe){if(Re&&i.texStorage3D(t.TEXTURE_2D_ARRAY,st,yt,Qe.width,Qe.height,Qe.depth),ke)if(Q.layerUpdates.size>0){const rt=tj(Qe.width,Qe.height,Q.format,Q.type);for(const je of Q.layerUpdates){const Tt=Qe.data.subarray(je*rt/Qe.data.BYTES_PER_ELEMENT,(je+1)*rt/Qe.data.BYTES_PER_ELEMENT);i.texSubImage3D(t.TEXTURE_2D_ARRAY,0,0,0,je,Qe.width,Qe.height,1,pt,_t,Tt)}Q.clearLayerUpdates()}else i.texSubImage3D(t.TEXTURE_2D_ARRAY,0,0,0,0,Qe.width,Qe.height,Qe.depth,pt,_t,Qe.data)}else i.texImage3D(t.TEXTURE_2D_ARRAY,0,yt,Qe.width,Qe.height,Qe.depth,0,pt,_t,Qe.data);else if(Q.isData3DTexture)oe?(Re&&i.texStorage3D(t.TEXTURE_3D,st,yt,Qe.width,Qe.height,Qe.depth),ke&&i.texSubImage3D(t.TEXTURE_3D,0,0,0,0,Qe.width,Qe.height,Qe.depth,pt,_t,Qe.data)):i.texImage3D(t.TEXTURE_3D,0,yt,Qe.width,Qe.height,Qe.depth,0,pt,_t,Qe.data);else if(Q.isFramebufferTexture){if(Re)if(oe)i.texStorage2D(t.TEXTURE_2D,st,yt,Qe.width,Qe.height);else{let rt=Qe.width,je=Qe.height;for(let Tt=0;Tt<st;Tt++)i.texImage2D(t.TEXTURE_2D,Tt,yt,rt,je,0,pt,_t,null),rt>>=1,je>>=1}}else if($t.length>0){if(oe&&Re){const rt=ge($t[0]);i.texStorage2D(t.TEXTURE_2D,st,yt,rt.width,rt.height)}for(let rt=0,je=$t.length;rt<je;rt++)Et=$t[rt],oe?ke&&i.texSubImage2D(t.TEXTURE_2D,rt,0,0,pt,_t,Et):i.texImage2D(t.TEXTURE_2D,rt,yt,pt,_t,Et);Q.generateMipmaps=!1}else if(oe){if(Re){const rt=ge(Qe);i.texStorage2D(t.TEXTURE_2D,st,yt,rt.width,rt.height)}ke&&i.texSubImage2D(t.TEXTURE_2D,0,0,0,pt,_t,Qe)}else i.texImage2D(t.TEXTURE_2D,0,yt,pt,_t,Qe);m(Q)&&y(te),at.__version=Le.version,Q.onUpdate&&Q.onUpdate(Q)}G.__version=Q.version}function le(G,Q,we){if(Q.image.length!==6)return;const te=pe(G,Q),Ne=Q.source;i.bindTexture(t.TEXTURE_CUBE_MAP,G.__webglTexture,t.TEXTURE0+we);const Le=r.get(Ne);if(Ne.version!==Le.__version||te===!0){i.activeTexture(t.TEXTURE0+we);const at=Lr.getPrimaries(Lr.workingColorSpace),Te=Q.colorSpace===xp?null:Lr.getPrimaries(Q.colorSpace),dt=Q.colorSpace===xp||at===Te?t.NONE:t.BROWSER_DEFAULT_WEBGL;t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,Q.flipY),t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,Q.premultiplyAlpha),t.pixelStorei(t.UNPACK_ALIGNMENT,Q.unpackAlignment),t.pixelStorei(t.UNPACK_COLORSPACE_CONVERSION_WEBGL,dt);const ot=Q.isCompressedTexture||Q.image[0].isCompressedTexture,Qe=Q.image[0]&&Q.image[0].isDataTexture,pt=[];for(let je=0;je<6;je++)!ot&&!Qe?pt[je]=g(Q.image[je],!0,n.maxCubemapSize):pt[je]=Qe?Q.image[je].image:Q.image[je],pt[je]=wt(Q,pt[je]);const _t=pt[0],yt=s.convert(Q.format,Q.colorSpace),Et=s.convert(Q.type),$t=w(Q.internalFormat,yt,Et,Q.colorSpace),oe=Q.isVideoTexture!==!0,Re=Le.__version===void 0||te===!0,ke=Ne.dataReady;let st=M(Q,_t);ee(t.TEXTURE_CUBE_MAP,Q);let rt;if(ot){oe&&Re&&i.texStorage2D(t.TEXTURE_CUBE_MAP,st,$t,_t.width,_t.height);for(let je=0;je<6;je++){rt=pt[je].mipmaps;for(let Tt=0;Tt<rt.length;Tt++){const Ft=rt[Tt];Q.format!==zo?yt!==null?oe?ke&&i.compressedTexSubImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+je,Tt,0,0,Ft.width,Ft.height,yt,Ft.data):i.compressedTexImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+je,Tt,$t,Ft.width,Ft.height,0,Ft.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):oe?ke&&i.texSubImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+je,Tt,0,0,Ft.width,Ft.height,yt,Et,Ft.data):i.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+je,Tt,$t,Ft.width,Ft.height,0,yt,Et,Ft.data)}}}else{if(rt=Q.mipmaps,oe&&Re){rt.length>0&&st++;const je=ge(pt[0]);i.texStorage2D(t.TEXTURE_CUBE_MAP,st,$t,je.width,je.height)}for(let je=0;je<6;je++)if(Qe){oe?ke&&i.texSubImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+je,0,0,0,pt[je].width,pt[je].height,yt,Et,pt[je].data):i.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+je,0,$t,pt[je].width,pt[je].height,0,yt,Et,pt[je].data);for(let Tt=0;Tt<rt.length;Tt++){const wi=rt[Tt].image[je].image;oe?ke&&i.texSubImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+je,Tt+1,0,0,wi.width,wi.height,yt,Et,wi.data):i.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+je,Tt+1,$t,wi.width,wi.height,0,yt,Et,wi.data)}}else{oe?ke&&i.texSubImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+je,0,0,0,yt,Et,pt[je]):i.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+je,0,$t,yt,Et,pt[je]);for(let Tt=0;Tt<rt.length;Tt++){const Ft=rt[Tt];oe?ke&&i.texSubImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+je,Tt+1,0,0,yt,Et,Ft.image[je]):i.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+je,Tt+1,$t,yt,Et,Ft.image[je])}}}m(Q)&&y(t.TEXTURE_CUBE_MAP),Le.__version=Ne.version,Q.onUpdate&&Q.onUpdate(Q)}G.__version=Q.version}function he(G,Q,we,te,Ne,Le){const at=s.convert(we.format,we.colorSpace),Te=s.convert(we.type),dt=w(we.internalFormat,at,Te,we.colorSpace),ot=r.get(Q),Qe=r.get(we);if(Qe.__renderTarget=Q,!ot.__hasExternalTextures){const pt=Math.max(1,Q.width>>Le),_t=Math.max(1,Q.height>>Le);Ne===t.TEXTURE_3D||Ne===t.TEXTURE_2D_ARRAY?i.texImage3D(Ne,Le,dt,pt,_t,Q.depth,0,at,Te,null):i.texImage2D(Ne,Le,dt,pt,_t,0,at,Te,null)}i.bindFramebuffer(t.FRAMEBUFFER,G),ze(Q)?o.framebufferTexture2DMultisampleEXT(t.FRAMEBUFFER,te,Ne,Qe.__webglTexture,0,$e(Q)):(Ne===t.TEXTURE_2D||Ne>=t.TEXTURE_CUBE_MAP_POSITIVE_X&&Ne<=t.TEXTURE_CUBE_MAP_NEGATIVE_Z)&&t.framebufferTexture2D(t.FRAMEBUFFER,te,Ne,Qe.__webglTexture,Le),i.bindFramebuffer(t.FRAMEBUFFER,null)}function ve(G,Q,we){if(t.bindRenderbuffer(t.RENDERBUFFER,G),Q.depthBuffer){const te=Q.depthTexture,Ne=te&&te.isDepthTexture?te.type:null,Le=E(Q.stencilBuffer,Ne),at=Q.stencilBuffer?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT,Te=$e(Q);ze(Q)?o.renderbufferStorageMultisampleEXT(t.RENDERBUFFER,Te,Le,Q.width,Q.height):we?t.renderbufferStorageMultisample(t.RENDERBUFFER,Te,Le,Q.width,Q.height):t.renderbufferStorage(t.RENDERBUFFER,Le,Q.width,Q.height),t.framebufferRenderbuffer(t.FRAMEBUFFER,at,t.RENDERBUFFER,G)}else{const te=Q.textures;for(let Ne=0;Ne<te.length;Ne++){const Le=te[Ne],at=s.convert(Le.format,Le.colorSpace),Te=s.convert(Le.type),dt=w(Le.internalFormat,at,Te,Le.colorSpace),ot=$e(Q);we&&ze(Q)===!1?t.renderbufferStorageMultisample(t.RENDERBUFFER,ot,dt,Q.width,Q.height):ze(Q)?o.renderbufferStorageMultisampleEXT(t.RENDERBUFFER,ot,dt,Q.width,Q.height):t.renderbufferStorage(t.RENDERBUFFER,dt,Q.width,Q.height)}}t.bindRenderbuffer(t.RENDERBUFFER,null)}function xe(G,Q){if(Q&&Q.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(i.bindFramebuffer(t.FRAMEBUFFER,G),!(Q.depthTexture&&Q.depthTexture.isDepthTexture))throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");const te=r.get(Q.depthTexture);te.__renderTarget=Q,(!te.__webglTexture||Q.depthTexture.image.width!==Q.width||Q.depthTexture.image.height!==Q.height)&&(Q.depthTexture.image.width=Q.width,Q.depthTexture.image.height=Q.height,Q.depthTexture.needsUpdate=!0),$(Q.depthTexture,0);const Ne=te.__webglTexture,Le=$e(Q);if(Q.depthTexture.format===D1)ze(Q)?o.framebufferTexture2DMultisampleEXT(t.FRAMEBUFFER,t.DEPTH_ATTACHMENT,t.TEXTURE_2D,Ne,0,Le):t.framebufferTexture2D(t.FRAMEBUFFER,t.DEPTH_ATTACHMENT,t.TEXTURE_2D,Ne,0);else if(Q.depthTexture.format===O1)ze(Q)?o.framebufferTexture2DMultisampleEXT(t.FRAMEBUFFER,t.DEPTH_STENCIL_ATTACHMENT,t.TEXTURE_2D,Ne,0,Le):t.framebufferTexture2D(t.FRAMEBUFFER,t.DEPTH_STENCIL_ATTACHMENT,t.TEXTURE_2D,Ne,0);else throw new Error("Unknown depthTexture format")}function Se(G){const Q=r.get(G),we=G.isWebGLCubeRenderTarget===!0;if(Q.__boundDepthTexture!==G.depthTexture){const te=G.depthTexture;if(Q.__depthDisposeCallback&&Q.__depthDisposeCallback(),te){const Ne=()=>{delete Q.__boundDepthTexture,delete Q.__depthDisposeCallback,te.removeEventListener("dispose",Ne)};te.addEventListener("dispose",Ne),Q.__depthDisposeCallback=Ne}Q.__boundDepthTexture=te}if(G.depthTexture&&!Q.__autoAllocateDepthBuffer){if(we)throw new Error("target.depthTexture not supported in Cube render targets");const te=G.texture.mipmaps;te&&te.length>0?xe(Q.__webglFramebuffer[0],G):xe(Q.__webglFramebuffer,G)}else if(we){Q.__webglDepthbuffer=[];for(let te=0;te<6;te++)if(i.bindFramebuffer(t.FRAMEBUFFER,Q.__webglFramebuffer[te]),Q.__webglDepthbuffer[te]===void 0)Q.__webglDepthbuffer[te]=t.createRenderbuffer(),ve(Q.__webglDepthbuffer[te],G,!1);else{const Ne=G.stencilBuffer?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT,Le=Q.__webglDepthbuffer[te];t.bindRenderbuffer(t.RENDERBUFFER,Le),t.framebufferRenderbuffer(t.FRAMEBUFFER,Ne,t.RENDERBUFFER,Le)}}else{const te=G.texture.mipmaps;if(te&&te.length>0?i.bindFramebuffer(t.FRAMEBUFFER,Q.__webglFramebuffer[0]):i.bindFramebuffer(t.FRAMEBUFFER,Q.__webglFramebuffer),Q.__webglDepthbuffer===void 0)Q.__webglDepthbuffer=t.createRenderbuffer(),ve(Q.__webglDepthbuffer,G,!1);else{const Ne=G.stencilBuffer?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT,Le=Q.__webglDepthbuffer;t.bindRenderbuffer(t.RENDERBUFFER,Le),t.framebufferRenderbuffer(t.FRAMEBUFFER,Ne,t.RENDERBUFFER,Le)}}i.bindFramebuffer(t.FRAMEBUFFER,null)}function Ce(G,Q,we){const te=r.get(G);Q!==void 0&&he(te.__webglFramebuffer,G,G.texture,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,0),we!==void 0&&Se(G)}function ce(G){const Q=G.texture,we=r.get(G),te=r.get(Q);G.addEventListener("dispose",P);const Ne=G.textures,Le=G.isWebGLCubeRenderTarget===!0,at=Ne.length>1;if(at||(te.__webglTexture===void 0&&(te.__webglTexture=t.createTexture()),te.__version=Q.version,a.memory.textures++),Le){we.__webglFramebuffer=[];for(let Te=0;Te<6;Te++)if(Q.mipmaps&&Q.mipmaps.length>0){we.__webglFramebuffer[Te]=[];for(let dt=0;dt<Q.mipmaps.length;dt++)we.__webglFramebuffer[Te][dt]=t.createFramebuffer()}else we.__webglFramebuffer[Te]=t.createFramebuffer()}else{if(Q.mipmaps&&Q.mipmaps.length>0){we.__webglFramebuffer=[];for(let Te=0;Te<Q.mipmaps.length;Te++)we.__webglFramebuffer[Te]=t.createFramebuffer()}else we.__webglFramebuffer=t.createFramebuffer();if(at)for(let Te=0,dt=Ne.length;Te<dt;Te++){const ot=r.get(Ne[Te]);ot.__webglTexture===void 0&&(ot.__webglTexture=t.createTexture(),a.memory.textures++)}if(G.samples>0&&ze(G)===!1){we.__webglMultisampledFramebuffer=t.createFramebuffer(),we.__webglColorRenderbuffer=[],i.bindFramebuffer(t.FRAMEBUFFER,we.__webglMultisampledFramebuffer);for(let Te=0;Te<Ne.length;Te++){const dt=Ne[Te];we.__webglColorRenderbuffer[Te]=t.createRenderbuffer(),t.bindRenderbuffer(t.RENDERBUFFER,we.__webglColorRenderbuffer[Te]);const ot=s.convert(dt.format,dt.colorSpace),Qe=s.convert(dt.type),pt=w(dt.internalFormat,ot,Qe,dt.colorSpace,G.isXRRenderTarget===!0),_t=$e(G);t.renderbufferStorageMultisample(t.RENDERBUFFER,_t,pt,G.width,G.height),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0+Te,t.RENDERBUFFER,we.__webglColorRenderbuffer[Te])}t.bindRenderbuffer(t.RENDERBUFFER,null),G.depthBuffer&&(we.__webglDepthRenderbuffer=t.createRenderbuffer(),ve(we.__webglDepthRenderbuffer,G,!0)),i.bindFramebuffer(t.FRAMEBUFFER,null)}}if(Le){i.bindTexture(t.TEXTURE_CUBE_MAP,te.__webglTexture),ee(t.TEXTURE_CUBE_MAP,Q);for(let Te=0;Te<6;Te++)if(Q.mipmaps&&Q.mipmaps.length>0)for(let dt=0;dt<Q.mipmaps.length;dt++)he(we.__webglFramebuffer[Te][dt],G,Q,t.COLOR_ATTACHMENT0,t.TEXTURE_CUBE_MAP_POSITIVE_X+Te,dt);else he(we.__webglFramebuffer[Te],G,Q,t.COLOR_ATTACHMENT0,t.TEXTURE_CUBE_MAP_POSITIVE_X+Te,0);m(Q)&&y(t.TEXTURE_CUBE_MAP),i.unbindTexture()}else if(at){for(let Te=0,dt=Ne.length;Te<dt;Te++){const ot=Ne[Te],Qe=r.get(ot);let pt=t.TEXTURE_2D;(G.isWebGL3DRenderTarget||G.isWebGLArrayRenderTarget)&&(pt=G.isWebGL3DRenderTarget?t.TEXTURE_3D:t.TEXTURE_2D_ARRAY),i.bindTexture(pt,Qe.__webglTexture),ee(pt,ot),he(we.__webglFramebuffer,G,ot,t.COLOR_ATTACHMENT0+Te,pt,0),m(ot)&&y(pt)}i.unbindTexture()}else{let Te=t.TEXTURE_2D;if((G.isWebGL3DRenderTarget||G.isWebGLArrayRenderTarget)&&(Te=G.isWebGL3DRenderTarget?t.TEXTURE_3D:t.TEXTURE_2D_ARRAY),i.bindTexture(Te,te.__webglTexture),ee(Te,Q),Q.mipmaps&&Q.mipmaps.length>0)for(let dt=0;dt<Q.mipmaps.length;dt++)he(we.__webglFramebuffer[dt],G,Q,t.COLOR_ATTACHMENT0,Te,dt);else he(we.__webglFramebuffer,G,Q,t.COLOR_ATTACHMENT0,Te,0);m(Q)&&y(Te),i.unbindTexture()}G.depthBuffer&&Se(G)}function Fe(G){const Q=G.textures;for(let we=0,te=Q.length;we<te;we++){const Ne=Q[we];if(m(Ne)){const Le=b(G),at=r.get(Ne).__webglTexture;i.bindTexture(Le,at),y(Le),i.unbindTexture()}}}const De=[],He=[];function Be(G){if(G.samples>0){if(ze(G)===!1){const Q=G.textures,we=G.width,te=G.height;let Ne=t.COLOR_BUFFER_BIT;const Le=G.stencilBuffer?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT,at=r.get(G),Te=Q.length>1;if(Te)for(let ot=0;ot<Q.length;ot++)i.bindFramebuffer(t.FRAMEBUFFER,at.__webglMultisampledFramebuffer),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0+ot,t.RENDERBUFFER,null),i.bindFramebuffer(t.FRAMEBUFFER,at.__webglFramebuffer),t.framebufferTexture2D(t.DRAW_FRAMEBUFFER,t.COLOR_ATTACHMENT0+ot,t.TEXTURE_2D,null,0);i.bindFramebuffer(t.READ_FRAMEBUFFER,at.__webglMultisampledFramebuffer);const dt=G.texture.mipmaps;dt&&dt.length>0?i.bindFramebuffer(t.DRAW_FRAMEBUFFER,at.__webglFramebuffer[0]):i.bindFramebuffer(t.DRAW_FRAMEBUFFER,at.__webglFramebuffer);for(let ot=0;ot<Q.length;ot++){if(G.resolveDepthBuffer&&(G.depthBuffer&&(Ne|=t.DEPTH_BUFFER_BIT),G.stencilBuffer&&G.resolveStencilBuffer&&(Ne|=t.STENCIL_BUFFER_BIT)),Te){t.framebufferRenderbuffer(t.READ_FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.RENDERBUFFER,at.__webglColorRenderbuffer[ot]);const Qe=r.get(Q[ot]).__webglTexture;t.framebufferTexture2D(t.DRAW_FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,Qe,0)}t.blitFramebuffer(0,0,we,te,0,0,we,te,Ne,t.NEAREST),l===!0&&(De.length=0,He.length=0,De.push(t.COLOR_ATTACHMENT0+ot),G.depthBuffer&&G.resolveDepthBuffer===!1&&(De.push(Le),He.push(Le),t.invalidateFramebuffer(t.DRAW_FRAMEBUFFER,He)),t.invalidateFramebuffer(t.READ_FRAMEBUFFER,De))}if(i.bindFramebuffer(t.READ_FRAMEBUFFER,null),i.bindFramebuffer(t.DRAW_FRAMEBUFFER,null),Te)for(let ot=0;ot<Q.length;ot++){i.bindFramebuffer(t.FRAMEBUFFER,at.__webglMultisampledFramebuffer),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0+ot,t.RENDERBUFFER,at.__webglColorRenderbuffer[ot]);const Qe=r.get(Q[ot]).__webglTexture;i.bindFramebuffer(t.FRAMEBUFFER,at.__webglFramebuffer),t.framebufferTexture2D(t.DRAW_FRAMEBUFFER,t.COLOR_ATTACHMENT0+ot,t.TEXTURE_2D,Qe,0)}i.bindFramebuffer(t.DRAW_FRAMEBUFFER,at.__webglMultisampledFramebuffer)}else if(G.depthBuffer&&G.resolveDepthBuffer===!1&&l){const Q=G.stencilBuffer?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT;t.invalidateFramebuffer(t.DRAW_FRAMEBUFFER,[Q])}}}function $e(G){return Math.min(n.maxSamples,G.samples)}function ze(G){const Q=r.get(G);return G.samples>0&&e.has("WEBGL_multisampled_render_to_texture")===!0&&Q.__useRenderToTexture!==!1}function it(G){const Q=a.render.frame;u.get(G)!==Q&&(u.set(G,Q),G.update())}function wt(G,Q){const we=G.colorSpace,te=G.format,Ne=G.type;return G.isCompressedTexture===!0||G.isVideoTexture===!0||we!==T0&&we!==xp&&(Lr.getTransfer(we)===on?(te!==zo||Ne!==_u)&&console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):console.error("THREE.WebGLTextures: Unsupported texture color space:",we)),Q}function ge(G){return typeof HTMLImageElement<"u"&&G instanceof HTMLImageElement?(c.width=G.naturalWidth||G.width,c.height=G.naturalHeight||G.height):typeof VideoFrame<"u"&&G instanceof VideoFrame?(c.width=G.displayWidth,c.height=G.displayHeight):(c.width=G.width,c.height=G.height),c}this.allocateTextureUnit=V,this.resetTextureUnits=z,this.setTexture2D=$,this.setTexture2DArray=K,this.setTexture3D=X,this.setTextureCube=U,this.rebindTextures=Ce,this.setupRenderTarget=ce,this.updateRenderTargetMipmap=Fe,this.updateMultisampleRenderTarget=Be,this.setupDepthRenderbuffer=Se,this.setupFrameBufferTexture=he,this.useMultisampledRTT=ze}function $le(t,e){function i(r,n=xp){let s;const a=Lr.getTransfer(n);if(r===_u)return t.UNSIGNED_BYTE;if(r===yO)return t.UNSIGNED_SHORT_4_4_4_4;if(r===xO)return t.UNSIGNED_SHORT_5_5_5_1;if(r===z6)return t.UNSIGNED_INT_5_9_9_9_REV;if(r===j6)return t.UNSIGNED_INT_10F_11F_11F_REV;if(r===B6)return t.BYTE;if(r===F6)return t.SHORT;if(r===R1)return t.UNSIGNED_SHORT;if(r===vO)return t.INT;if(r===jp)return t.UNSIGNED_INT;if(r===tc)return t.FLOAT;if(r===m_)return t.HALF_FLOAT;if(r===V6)return t.ALPHA;if(r===H6)return t.RGB;if(r===zo)return t.RGBA;if(r===D1)return t.DEPTH_COMPONENT;if(r===O1)return t.DEPTH_STENCIL;if(r===bO)return t.RED;if(r===vT)return t.RED_INTEGER;if(r===G6)return t.RG;if(r===wO)return t.RG_INTEGER;if(r===_O)return t.RGBA_INTEGER;if(r===xA||r===bA||r===wA||r===_A)if(a===on)if(s=e.get("WEBGL_compressed_texture_s3tc_srgb"),s!==null){if(r===xA)return s.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(r===bA)return s.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(r===wA)return s.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(r===_A)return s.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else return null;else if(s=e.get("WEBGL_compressed_texture_s3tc"),s!==null){if(r===xA)return s.COMPRESSED_RGB_S3TC_DXT1_EXT;if(r===bA)return s.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(r===wA)return s.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(r===_A)return s.COMPRESSED_RGBA_S3TC_DXT5_EXT}else return null;if(r===ZI||r===QI||r===JI||r===eD)if(s=e.get("WEBGL_compressed_texture_pvrtc"),s!==null){if(r===ZI)return s.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(r===QI)return s.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(r===JI)return s.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(r===eD)return s.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}else return null;if(r===tD||r===iD||r===rD)if(s=e.get("WEBGL_compressed_texture_etc"),s!==null){if(r===tD||r===iD)return a===on?s.COMPRESSED_SRGB8_ETC2:s.COMPRESSED_RGB8_ETC2;if(r===rD)return a===on?s.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:s.COMPRESSED_RGBA8_ETC2_EAC}else return null;if(r===nD||r===sD||r===aD||r===oD||r===lD||r===cD||r===uD||r===hD||r===dD||r===fD||r===pD||r===mD||r===gD||r===vD)if(s=e.get("WEBGL_compressed_texture_astc"),s!==null){if(r===nD)return a===on?s.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:s.COMPRESSED_RGBA_ASTC_4x4_KHR;if(r===sD)return a===on?s.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:s.COMPRESSED_RGBA_ASTC_5x4_KHR;if(r===aD)return a===on?s.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:s.COMPRESSED_RGBA_ASTC_5x5_KHR;if(r===oD)return a===on?s.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:s.COMPRESSED_RGBA_ASTC_6x5_KHR;if(r===lD)return a===on?s.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:s.COMPRESSED_RGBA_ASTC_6x6_KHR;if(r===cD)return a===on?s.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:s.COMPRESSED_RGBA_ASTC_8x5_KHR;if(r===uD)return a===on?s.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:s.COMPRESSED_RGBA_ASTC_8x6_KHR;if(r===hD)return a===on?s.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:s.COMPRESSED_RGBA_ASTC_8x8_KHR;if(r===dD)return a===on?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:s.COMPRESSED_RGBA_ASTC_10x5_KHR;if(r===fD)return a===on?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:s.COMPRESSED_RGBA_ASTC_10x6_KHR;if(r===pD)return a===on?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:s.COMPRESSED_RGBA_ASTC_10x8_KHR;if(r===mD)return a===on?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:s.COMPRESSED_RGBA_ASTC_10x10_KHR;if(r===gD)return a===on?s.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:s.COMPRESSED_RGBA_ASTC_12x10_KHR;if(r===vD)return a===on?s.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:s.COMPRESSED_RGBA_ASTC_12x12_KHR}else return null;if(r===yD||r===xD||r===bD)if(s=e.get("EXT_texture_compression_bptc"),s!==null){if(r===yD)return a===on?s.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:s.COMPRESSED_RGBA_BPTC_UNORM_EXT;if(r===xD)return s.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT;if(r===bD)return s.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT}else return null;if(r===wD||r===_D||r===SD||r===ED)if(s=e.get("EXT_texture_compression_rgtc"),s!==null){if(r===wD)return s.COMPRESSED_RED_RGTC1_EXT;if(r===_D)return s.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(r===SD)return s.COMPRESSED_RED_GREEN_RGTC2_EXT;if(r===ED)return s.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}else return null;return r===I1?t.UNSIGNED_INT_24_8:t[r]!==void 0?t[r]:null}return{convert:i}}const OBe=`
void main() {

	gl_Position = vec4( position, 1.0 );

}`,LBe=`
uniform sampler2DArray depthColor;
uniform float depthWidth;
uniform float depthHeight;

void main() {

	vec2 coord = vec2( gl_FragCoord.x / depthWidth, gl_FragCoord.y / depthHeight );

	if ( coord.x >= 1.0 ) {

		gl_FragDepth = texture( depthColor, vec3( coord.x - 1.0, coord.y, 1 ) ).r;

	} else {

		gl_FragDepth = texture( depthColor, vec3( coord.x, coord.y, 0 ) ).r;

	}

}`;class kBe{constructor(){this.texture=null,this.mesh=null,this.depthNear=0,this.depthFar=0}init(e,i){if(this.texture===null){const r=new rH(e.texture);(e.depthNear!==i.depthNear||e.depthFar!==i.depthFar)&&(this.depthNear=e.depthNear,this.depthFar=e.depthFar),this.texture=r}}getMesh(e){if(this.texture!==null&&this.mesh===null){const i=e.cameras[0].viewport,r=new Ch({vertexShader:OBe,fragmentShader:LBe,uniforms:{depthColor:{value:this.texture},depthWidth:{value:i.z},depthHeight:{value:i.w}}});this.mesh=new js(new y_(20,20),r)}return this.mesh}reset(){this.texture=null,this.mesh=null}getDepthTexture(){return this.texture}}class NBe extends af{constructor(e,i){super();const r=this;let n=null,s=1,a=null,o="local-floor",l=1,c=null,u=null,h=null,d=null,f=null,p=null;const g=typeof XRWebGLBinding<"u",m=new kBe,y={},b=i.getContextAttributes();let w=null,E=null;const M=[],A=[],P=new At;let C=null;const R=new ja;R.viewport=new Ur;const I=new ja;I.viewport=new Ur;const k=[R,I],z=new Ule;let V=null,F=null;this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(re){let le=M[re];return le===void 0&&(le=new $R,M[re]=le),le.getTargetRaySpace()},this.getControllerGrip=function(re){let le=M[re];return le===void 0&&(le=new $R,M[re]=le),le.getGripSpace()},this.getHand=function(re){let le=M[re];return le===void 0&&(le=new $R,M[re]=le),le.getHandSpace()};function $(re){const le=A.indexOf(re.inputSource);if(le===-1)return;const he=M[le];he!==void 0&&(he.update(re.inputSource,re.frame,c||a),he.dispatchEvent({type:re.type,data:re.inputSource}))}function K(){n.removeEventListener("select",$),n.removeEventListener("selectstart",$),n.removeEventListener("selectend",$),n.removeEventListener("squeeze",$),n.removeEventListener("squeezestart",$),n.removeEventListener("squeezeend",$),n.removeEventListener("end",K),n.removeEventListener("inputsourceschange",X);for(let re=0;re<M.length;re++){const le=A[re];le!==null&&(A[re]=null,M[re].disconnect(le))}V=null,F=null,m.reset();for(const re in y)delete y[re];e.setRenderTarget(w),f=null,d=null,h=null,n=null,E=null,se.stop(),r.isPresenting=!1,e.setPixelRatio(C),e.setSize(P.width,P.height,!1),r.dispatchEvent({type:"sessionend"})}this.setFramebufferScaleFactor=function(re){s=re,r.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(re){o=re,r.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return c||a},this.setReferenceSpace=function(re){c=re},this.getBaseLayer=function(){return d!==null?d:f},this.getBinding=function(){return h===null&&g&&(h=new XRWebGLBinding(n,i)),h},this.getFrame=function(){return p},this.getSession=function(){return n},this.setSession=async function(re){if(n=re,n!==null){if(w=e.getRenderTarget(),n.addEventListener("select",$),n.addEventListener("selectstart",$),n.addEventListener("selectend",$),n.addEventListener("squeeze",$),n.addEventListener("squeezestart",$),n.addEventListener("squeezeend",$),n.addEventListener("end",K),n.addEventListener("inputsourceschange",X),b.xrCompatible!==!0&&await i.makeXRCompatible(),C=e.getPixelRatio(),e.getSize(P),g&&"createProjectionLayer"in XRWebGLBinding.prototype){let he=null,ve=null,xe=null;b.depth&&(xe=b.stencil?i.DEPTH24_STENCIL8:i.DEPTH_COMPONENT24,he=b.stencil?O1:D1,ve=b.stencil?I1:jp);const Se={colorFormat:i.RGBA8,depthFormat:xe,scaleFactor:s};h=this.getBinding(),d=h.createProjectionLayer(Se),n.updateRenderState({layers:[d]}),e.setPixelRatio(1),e.setSize(d.textureWidth,d.textureHeight,!1),E=new Qd(d.textureWidth,d.textureHeight,{format:zo,type:_u,depthTexture:new iH(d.textureWidth,d.textureHeight,ve,void 0,void 0,void 0,void 0,void 0,void 0,he),stencilBuffer:b.stencil,colorSpace:e.outputColorSpace,samples:b.antialias?4:0,resolveDepthBuffer:d.ignoreDepthValues===!1,resolveStencilBuffer:d.ignoreDepthValues===!1})}else{const he={antialias:b.antialias,alpha:!0,depth:b.depth,stencil:b.stencil,framebufferScaleFactor:s};f=new XRWebGLLayer(n,i,he),n.updateRenderState({baseLayer:f}),e.setPixelRatio(1),e.setSize(f.framebufferWidth,f.framebufferHeight,!1),E=new Qd(f.framebufferWidth,f.framebufferHeight,{format:zo,type:_u,colorSpace:e.outputColorSpace,stencilBuffer:b.stencil,resolveDepthBuffer:f.ignoreDepthValues===!1,resolveStencilBuffer:f.ignoreDepthValues===!1})}E.isXRRenderTarget=!0,this.setFoveation(l),c=null,a=await n.requestReferenceSpace(o),se.setContext(n),se.start(),r.isPresenting=!0,r.dispatchEvent({type:"sessionstart"})}},this.getEnvironmentBlendMode=function(){if(n!==null)return n.environmentBlendMode},this.getDepthTexture=function(){return m.getDepthTexture()};function X(re){for(let le=0;le<re.removed.length;le++){const he=re.removed[le],ve=A.indexOf(he);ve>=0&&(A[ve]=null,M[ve].disconnect(he))}for(let le=0;le<re.added.length;le++){const he=re.added[le];let ve=A.indexOf(he);if(ve===-1){for(let Se=0;Se<M.length;Se++)if(Se>=A.length){A.push(he),ve=Se;break}else if(A[Se]===null){A[Se]=he,ve=Se;break}if(ve===-1)break}const xe=M[ve];xe&&xe.connect(he)}}const U=new be,Y=new be;function Z(re,le,he){U.setFromMatrixPosition(le.matrixWorld),Y.setFromMatrixPosition(he.matrixWorld);const ve=U.distanceTo(Y),xe=le.projectionMatrix.elements,Se=he.projectionMatrix.elements,Ce=xe[14]/(xe[10]-1),ce=xe[14]/(xe[10]+1),Fe=(xe[9]+1)/xe[5],De=(xe[9]-1)/xe[5],He=(xe[8]-1)/xe[0],Be=(Se[8]+1)/Se[0],$e=Ce*He,ze=Ce*Be,it=ve/(-He+Be),wt=it*-He;if(le.matrixWorld.decompose(re.position,re.quaternion,re.scale),re.translateX(wt),re.translateZ(it),re.matrixWorld.compose(re.position,re.quaternion,re.scale),re.matrixWorldInverse.copy(re.matrixWorld).invert(),xe[10]===-1)re.projectionMatrix.copy(le.projectionMatrix),re.projectionMatrixInverse.copy(le.projectionMatrixInverse);else{const ge=Ce+it,G=ce+it,Q=$e-wt,we=ze+(ve-wt),te=Fe*ce/G*ge,Ne=De*ce/G*ge;re.projectionMatrix.makePerspective(Q,we,te,Ne,ge,G),re.projectionMatrixInverse.copy(re.projectionMatrix).invert()}}function j(re,le){le===null?re.matrixWorld.copy(re.matrix):re.matrixWorld.multiplyMatrices(le.matrixWorld,re.matrix),re.matrixWorldInverse.copy(re.matrixWorld).invert()}this.updateCamera=function(re){if(n===null)return;let le=re.near,he=re.far;m.texture!==null&&(m.depthNear>0&&(le=m.depthNear),m.depthFar>0&&(he=m.depthFar)),z.near=I.near=R.near=le,z.far=I.far=R.far=he,(V!==z.near||F!==z.far)&&(n.updateRenderState({depthNear:z.near,depthFar:z.far}),V=z.near,F=z.far),z.layers.mask=re.layers.mask|6,R.layers.mask=z.layers.mask&3,I.layers.mask=z.layers.mask&5;const ve=re.parent,xe=z.cameras;j(z,ve);for(let Se=0;Se<xe.length;Se++)j(xe[Se],ve);xe.length===2?Z(z,R,I):z.projectionMatrix.copy(R.projectionMatrix),ee(re,z,ve)};function ee(re,le,he){he===null?re.matrix.copy(le.matrixWorld):(re.matrix.copy(he.matrixWorld),re.matrix.invert(),re.matrix.multiply(le.matrixWorld)),re.matrix.decompose(re.position,re.quaternion,re.scale),re.updateMatrixWorld(!0),re.projectionMatrix.copy(le.projectionMatrix),re.projectionMatrixInverse.copy(le.projectionMatrixInverse),re.isPerspectiveCamera&&(re.fov=k1*2*Math.atan(1/re.projectionMatrix.elements[5]),re.zoom=1)}this.getCamera=function(){return z},this.getFoveation=function(){if(!(d===null&&f===null))return l},this.setFoveation=function(re){l=re,d!==null&&(d.fixedFoveation=re),f!==null&&f.fixedFoveation!==void 0&&(f.fixedFoveation=re)},this.hasDepthSensing=function(){return m.texture!==null},this.getDepthSensingMesh=function(){return m.getMesh(z)},this.getCameraTexture=function(re){return y[re]};let pe=null;function fe(re,le){if(u=le.getViewerPose(c||a),p=le,u!==null){const he=u.views;f!==null&&(e.setRenderTargetFramebuffer(E,f.framebuffer),e.setRenderTarget(E));let ve=!1;he.length!==z.cameras.length&&(z.cameras.length=0,ve=!0);for(let ce=0;ce<he.length;ce++){const Fe=he[ce];let De=null;if(f!==null)De=f.getViewport(Fe);else{const Be=h.getViewSubImage(d,Fe);De=Be.viewport,ce===0&&(e.setRenderTargetTextures(E,Be.colorTexture,Be.depthStencilTexture),e.setRenderTarget(E))}let He=k[ce];He===void 0&&(He=new ja,He.layers.enable(ce),He.viewport=new Ur,k[ce]=He),He.matrix.fromArray(Fe.transform.matrix),He.matrix.decompose(He.position,He.quaternion,He.scale),He.projectionMatrix.fromArray(Fe.projectionMatrix),He.projectionMatrixInverse.copy(He.projectionMatrix).invert(),He.viewport.set(De.x,De.y,De.width,De.height),ce===0&&(z.matrix.copy(He.matrix),z.matrix.decompose(z.position,z.quaternion,z.scale)),ve===!0&&z.cameras.push(He)}const xe=n.enabledFeatures;if(xe&&xe.includes("depth-sensing")&&n.depthUsage=="gpu-optimized"&&g){h=r.getBinding();const ce=h.getDepthInformation(he[0]);ce&&ce.isValid&&ce.texture&&m.init(ce,n.renderState)}if(xe&&xe.includes("camera-access")&&g){e.state.unbindTexture(),h=r.getBinding();for(let ce=0;ce<he.length;ce++){const Fe=he[ce].camera;if(Fe){let De=y[Fe];De||(De=new rH,y[Fe]=De);const He=h.getCameraImage(Fe);De.sourceTexture=He}}}}for(let he=0;he<M.length;he++){const ve=A[he],xe=M[he];ve!==null&&xe!==void 0&&xe.update(ve,le,c||a)}pe&&pe(re,le),le.detectedPlanes&&r.dispatchEvent({type:"planesdetected",data:le}),p=null}const se=new Hle;se.setAnimationLoop(fe),this.setAnimationLoop=function(re){pe=re},this.dispose=function(){}}}const _y=new kc,UBe=new zi;function BBe(t,e){function i(m,y){m.matrixAutoUpdate===!0&&m.updateMatrix(),y.value.copy(m.matrix)}function r(m,y){y.color.getRGB(m.fogColor.value,Goe(t)),y.isFog?(m.fogNear.value=y.near,m.fogFar.value=y.far):y.isFogExp2&&(m.fogDensity.value=y.density)}function n(m,y,b,w,E){y.isMeshBasicMaterial||y.isMeshLambertMaterial?s(m,y):y.isMeshToonMaterial?(s(m,y),h(m,y)):y.isMeshPhongMaterial?(s(m,y),u(m,y)):y.isMeshStandardMaterial?(s(m,y),d(m,y),y.isMeshPhysicalMaterial&&f(m,y,E)):y.isMeshMatcapMaterial?(s(m,y),p(m,y)):y.isMeshDepthMaterial?s(m,y):y.isMeshDistanceMaterial?(s(m,y),g(m,y)):y.isMeshNormalMaterial?s(m,y):y.isLineBasicMaterial?(a(m,y),y.isLineDashedMaterial&&o(m,y)):y.isPointsMaterial?l(m,y,b,w):y.isSpriteMaterial?c(m,y):y.isShadowMaterial?(m.color.value.copy(y.color),m.opacity.value=y.opacity):y.isShaderMaterial&&(y.uniformsNeedUpdate=!1)}function s(m,y){m.opacity.value=y.opacity,y.color&&m.diffuse.value.copy(y.color),y.emissive&&m.emissive.value.copy(y.emissive).multiplyScalar(y.emissiveIntensity),y.map&&(m.map.value=y.map,i(y.map,m.mapTransform)),y.alphaMap&&(m.alphaMap.value=y.alphaMap,i(y.alphaMap,m.alphaMapTransform)),y.bumpMap&&(m.bumpMap.value=y.bumpMap,i(y.bumpMap,m.bumpMapTransform),m.bumpScale.value=y.bumpScale,y.side===bl&&(m.bumpScale.value*=-1)),y.normalMap&&(m.normalMap.value=y.normalMap,i(y.normalMap,m.normalMapTransform),m.normalScale.value.copy(y.normalScale),y.side===bl&&m.normalScale.value.negate()),y.displacementMap&&(m.displacementMap.value=y.displacementMap,i(y.displacementMap,m.displacementMapTransform),m.displacementScale.value=y.displacementScale,m.displacementBias.value=y.displacementBias),y.emissiveMap&&(m.emissiveMap.value=y.emissiveMap,i(y.emissiveMap,m.emissiveMapTransform)),y.specularMap&&(m.specularMap.value=y.specularMap,i(y.specularMap,m.specularMapTransform)),y.alphaTest>0&&(m.alphaTest.value=y.alphaTest);const b=e.get(y),w=b.envMap,E=b.envMapRotation;w&&(m.envMap.value=w,_y.copy(E),_y.x*=-1,_y.y*=-1,_y.z*=-1,w.isCubeTexture&&w.isRenderTargetTexture===!1&&(_y.y*=-1,_y.z*=-1),m.envMapRotation.value.setFromMatrix4(UBe.makeRotationFromEuler(_y)),m.flipEnvMap.value=w.isCubeTexture&&w.isRenderTargetTexture===!1?-1:1,m.reflectivity.value=y.reflectivity,m.ior.value=y.ior,m.refractionRatio.value=y.refractionRatio),y.lightMap&&(m.lightMap.value=y.lightMap,m.lightMapIntensity.value=y.lightMapIntensity,i(y.lightMap,m.lightMapTransform)),y.aoMap&&(m.aoMap.value=y.aoMap,m.aoMapIntensity.value=y.aoMapIntensity,i(y.aoMap,m.aoMapTransform))}function a(m,y){m.diffuse.value.copy(y.color),m.opacity.value=y.opacity,y.map&&(m.map.value=y.map,i(y.map,m.mapTransform))}function o(m,y){m.dashSize.value=y.dashSize,m.totalSize.value=y.dashSize+y.gapSize,m.scale.value=y.scale}function l(m,y,b,w){m.diffuse.value.copy(y.color),m.opacity.value=y.opacity,m.size.value=y.size*b,m.scale.value=w*.5,y.map&&(m.map.value=y.map,i(y.map,m.uvTransform)),y.alphaMap&&(m.alphaMap.value=y.alphaMap,i(y.alphaMap,m.alphaMapTransform)),y.alphaTest>0&&(m.alphaTest.value=y.alphaTest)}function c(m,y){m.diffuse.value.copy(y.color),m.opacity.value=y.opacity,m.rotation.value=y.rotation,y.map&&(m.map.value=y.map,i(y.map,m.mapTransform)),y.alphaMap&&(m.alphaMap.value=y.alphaMap,i(y.alphaMap,m.alphaMapTransform)),y.alphaTest>0&&(m.alphaTest.value=y.alphaTest)}function u(m,y){m.specular.value.copy(y.specular),m.shininess.value=Math.max(y.shininess,1e-4)}function h(m,y){y.gradientMap&&(m.gradientMap.value=y.gradientMap)}function d(m,y){m.metalness.value=y.metalness,y.metalnessMap&&(m.metalnessMap.value=y.metalnessMap,i(y.metalnessMap,m.metalnessMapTransform)),m.roughness.value=y.roughness,y.roughnessMap&&(m.roughnessMap.value=y.roughnessMap,i(y.roughnessMap,m.roughnessMapTransform)),y.envMap&&(m.envMapIntensity.value=y.envMapIntensity)}function f(m,y,b){m.ior.value=y.ior,y.sheen>0&&(m.sheenColor.value.copy(y.sheenColor).multiplyScalar(y.sheen),m.sheenRoughness.value=y.sheenRoughness,y.sheenColorMap&&(m.sheenColorMap.value=y.sheenColorMap,i(y.sheenColorMap,m.sheenColorMapTransform)),y.sheenRoughnessMap&&(m.sheenRoughnessMap.value=y.sheenRoughnessMap,i(y.sheenRoughnessMap,m.sheenRoughnessMapTransform))),y.clearcoat>0&&(m.clearcoat.value=y.clearcoat,m.clearcoatRoughness.value=y.clearcoatRoughness,y.clearcoatMap&&(m.clearcoatMap.value=y.clearcoatMap,i(y.clearcoatMap,m.clearcoatMapTransform)),y.clearcoatRoughnessMap&&(m.clearcoatRoughnessMap.value=y.clearcoatRoughnessMap,i(y.clearcoatRoughnessMap,m.clearcoatRoughnessMapTransform)),y.clearcoatNormalMap&&(m.clearcoatNormalMap.value=y.clearcoatNormalMap,i(y.clearcoatNormalMap,m.clearcoatNormalMapTransform),m.clearcoatNormalScale.value.copy(y.clearcoatNormalScale),y.side===bl&&m.clearcoatNormalScale.value.negate())),y.dispersion>0&&(m.dispersion.value=y.dispersion),y.iridescence>0&&(m.iridescence.value=y.iridescence,m.iridescenceIOR.value=y.iridescenceIOR,m.iridescenceThicknessMinimum.value=y.iridescenceThicknessRange[0],m.iridescenceThicknessMaximum.value=y.iridescenceThicknessRange[1],y.iridescenceMap&&(m.iridescenceMap.value=y.iridescenceMap,i(y.iridescenceMap,m.iridescenceMapTransform)),y.iridescenceThicknessMap&&(m.iridescenceThicknessMap.value=y.iridescenceThicknessMap,i(y.iridescenceThicknessMap,m.iridescenceThicknessMapTransform))),y.transmission>0&&(m.transmission.value=y.transmission,m.transmissionSamplerMap.value=b.texture,m.transmissionSamplerSize.value.set(b.width,b.height),y.transmissionMap&&(m.transmissionMap.value=y.transmissionMap,i(y.transmissionMap,m.transmissionMapTransform)),m.thickness.value=y.thickness,y.thicknessMap&&(m.thicknessMap.value=y.thicknessMap,i(y.thicknessMap,m.thicknessMapTransform)),m.attenuationDistance.value=y.attenuationDistance,m.attenuationColor.value.copy(y.attenuationColor)),y.anisotropy>0&&(m.anisotropyVector.value.set(y.anisotropy*Math.cos(y.anisotropyRotation),y.anisotropy*Math.sin(y.anisotropyRotation)),y.anisotropyMap&&(m.anisotropyMap.value=y.anisotropyMap,i(y.anisotropyMap,m.anisotropyMapTransform))),m.specularIntensity.value=y.specularIntensity,m.specularColor.value.copy(y.specularColor),y.specularColorMap&&(m.specularColorMap.value=y.specularColorMap,i(y.specularColorMap,m.specularColorMapTransform)),y.specularIntensityMap&&(m.specularIntensityMap.value=y.specularIntensityMap,i(y.specularIntensityMap,m.specularIntensityMapTransform))}function p(m,y){y.matcap&&(m.matcap.value=y.matcap)}function g(m,y){const b=e.get(y).light;m.referencePosition.value.setFromMatrixPosition(b.matrixWorld),m.nearDistance.value=b.shadow.camera.near,m.farDistance.value=b.shadow.camera.far}return{refreshFogUniforms:r,refreshMaterialUniforms:n}}function FBe(t,e,i,r){let n={},s={},a=[];const o=t.getParameter(t.MAX_UNIFORM_BUFFER_BINDINGS);function l(b,w){const E=w.program;r.uniformBlockBinding(b,E)}function c(b,w){let E=n[b.id];E===void 0&&(p(b),E=u(b),n[b.id]=E,b.addEventListener("dispose",m));const M=w.program;r.updateUBOMapping(b,M);const A=e.render.frame;s[b.id]!==A&&(d(b),s[b.id]=A)}function u(b){const w=h();b.__bindingPointIndex=w;const E=t.createBuffer(),M=b.__size,A=b.usage;return t.bindBuffer(t.UNIFORM_BUFFER,E),t.bufferData(t.UNIFORM_BUFFER,M,A),t.bindBuffer(t.UNIFORM_BUFFER,null),t.bindBufferBase(t.UNIFORM_BUFFER,w,E),E}function h(){for(let b=0;b<o;b++)if(a.indexOf(b)===-1)return a.push(b),b;return console.error("THREE.WebGLRenderer: Maximum number of simultaneously usable uniforms groups reached."),0}function d(b){const w=n[b.id],E=b.uniforms,M=b.__cache;t.bindBuffer(t.UNIFORM_BUFFER,w);for(let A=0,P=E.length;A<P;A++){const C=Array.isArray(E[A])?E[A]:[E[A]];for(let R=0,I=C.length;R<I;R++){const k=C[R];if(f(k,A,R,M)===!0){const z=k.__offset,V=Array.isArray(k.value)?k.value:[k.value];let F=0;for(let $=0;$<V.length;$++){const K=V[$],X=g(K);typeof K=="number"||typeof K=="boolean"?(k.__data[0]=K,t.bufferSubData(t.UNIFORM_BUFFER,z+F,k.__data)):K.isMatrix3?(k.__data[0]=K.elements[0],k.__data[1]=K.elements[1],k.__data[2]=K.elements[2],k.__data[3]=0,k.__data[4]=K.elements[3],k.__data[5]=K.elements[4],k.__data[6]=K.elements[5],k.__data[7]=0,k.__data[8]=K.elements[6],k.__data[9]=K.elements[7],k.__data[10]=K.elements[8],k.__data[11]=0):(K.toArray(k.__data,F),F+=X.storage/Float32Array.BYTES_PER_ELEMENT)}t.bufferSubData(t.UNIFORM_BUFFER,z,k.__data)}}}t.bindBuffer(t.UNIFORM_BUFFER,null)}function f(b,w,E,M){const A=b.value,P=w+"_"+E;if(M[P]===void 0)return typeof A=="number"||typeof A=="boolean"?M[P]=A:M[P]=A.clone(),!0;{const C=M[P];if(typeof A=="number"||typeof A=="boolean"){if(C!==A)return M[P]=A,!0}else if(C.equals(A)===!1)return C.copy(A),!0}return!1}function p(b){const w=b.uniforms;let E=0;const M=16;for(let P=0,C=w.length;P<C;P++){const R=Array.isArray(w[P])?w[P]:[w[P]];for(let I=0,k=R.length;I<k;I++){const z=R[I],V=Array.isArray(z.value)?z.value:[z.value];for(let F=0,$=V.length;F<$;F++){const K=V[F],X=g(K),U=E%M,Y=U%X.boundary,Z=U+Y;E+=Y,Z!==0&&M-Z<X.storage&&(E+=M-Z),z.__data=new Float32Array(X.storage/Float32Array.BYTES_PER_ELEMENT),z.__offset=E,E+=X.storage}}}const A=E%M;return A>0&&(E+=M-A),b.__size=E,b.__cache={},this}function g(b){const w={boundary:0,storage:0};return typeof b=="number"||typeof b=="boolean"?(w.boundary=4,w.storage=4):b.isVector2?(w.boundary=8,w.storage=8):b.isVector3||b.isColor?(w.boundary=16,w.storage=12):b.isVector4?(w.boundary=16,w.storage=16):b.isMatrix3?(w.boundary=48,w.storage=48):b.isMatrix4?(w.boundary=64,w.storage=64):b.isTexture?console.warn("THREE.WebGLRenderer: Texture samplers can not be part of an uniforms group."):console.warn("THREE.WebGLRenderer: Unsupported uniform value type.",b),w}function m(b){const w=b.target;w.removeEventListener("dispose",m);const E=a.indexOf(w.__bindingPointIndex);a.splice(E,1),t.deleteBuffer(n[w.id]),delete n[w.id],delete s[w.id]}function y(){for(const b in n)t.deleteBuffer(n[b]);a=[],n={},s={}}return{bind:l,update:c,dispose:y}}class Yle{constructor(e={}){const{canvas:i=joe(),context:r=null,depth:n=!0,stencil:s=!1,alpha:a=!1,antialias:o=!1,premultipliedAlpha:l=!0,preserveDrawingBuffer:c=!1,powerPreference:u="default",failIfMajorPerformanceCaveat:h=!1,reversedDepthBuffer:d=!1}=e;this.isWebGLRenderer=!0;let f;if(r!==null){if(typeof WebGLRenderingContext<"u"&&r instanceof WebGLRenderingContext)throw new Error("THREE.WebGLRenderer: WebGL 1 is not supported since r163.");f=r.getContextAttributes().alpha}else f=a;const p=new Uint32Array(4),g=new Int32Array(4);let m=null,y=null;const b=[],w=[];this.domElement=i,this.debug={checkShaderErrors:!0,onShaderError:null},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.toneMapping=jd,this.toneMappingExposure=1,this.transmissionResolutionScale=1;const E=this;let M=!1;this._outputColorSpace=Wl;let A=0,P=0,C=null,R=-1,I=null;const k=new Ur,z=new Ur;let V=null;const F=new ii(0);let $=0,K=i.width,X=i.height,U=1,Y=null,Z=null;const j=new Ur(0,0,K,X),ee=new Ur(0,0,K,X);let pe=!1;const fe=new v_;let se=!1,re=!1;const le=new zi,he=new be,ve=new Ur,xe={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};let Se=!1;function Ce(){return C===null?U:1}let ce=r;function Fe(de,Ue){return i.getContext(de,Ue)}try{const de={alpha:!0,depth:n,stencil:s,antialias:o,premultipliedAlpha:l,preserveDrawingBuffer:c,powerPreference:u,failIfMajorPerformanceCaveat:h};if("setAttribute"in i&&i.setAttribute("data-engine",`three.js r${mT}`),i.addEventListener("webglcontextlost",ke,!1),i.addEventListener("webglcontextrestored",st,!1),i.addEventListener("webglcontextcreationerror",rt,!1),ce===null){const Ue="webgl2";if(ce=Fe(Ue,de),ce===null)throw Fe(Ue)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}}catch(de){throw console.error("THREE.WebGLRenderer: "+de.message),de}let De,He,Be,$e,ze,it,wt,ge,G,Q,we,te,Ne,Le,at,Te,dt,ot,Qe,pt,_t,yt,Et,$t;function oe(){De=new ZNe(ce),De.init(),yt=new $le(ce,De),He=new GNe(ce,De,e,yt),Be=new IBe(ce,De),He.reversedDepthBuffer&&d&&Be.buffers.depth.setReversed(!0),$e=new eUe(ce),ze=new yBe,it=new DBe(ce,De,Be,ze,He,yt,$e),wt=new qNe(E),ge=new KNe(E),G=new aLe(ce),Et=new VNe(ce,G),Q=new QNe(ce,G,$e,Et),we=new iUe(ce,Q,G,$e),Qe=new tUe(ce,He,it),Te=new WNe(ze),te=new vBe(E,wt,ge,De,He,Et,Te),Ne=new BBe(E,ze),Le=new bBe,at=new MBe(De),ot=new jNe(E,wt,ge,Be,we,f,l),dt=new PBe(E,we,He),$t=new FBe(ce,$e,He,Be),pt=new HNe(ce,De,$e),_t=new JNe(ce,De,$e),$e.programs=te.programs,E.capabilities=He,E.extensions=De,E.properties=ze,E.renderLists=Le,E.shadowMap=dt,E.state=Be,E.info=$e}oe();const Re=new NBe(E,ce);this.xr=Re,this.getContext=function(){return ce},this.getContextAttributes=function(){return ce.getContextAttributes()},this.forceContextLoss=function(){const de=De.get("WEBGL_lose_context");de&&de.loseContext()},this.forceContextRestore=function(){const de=De.get("WEBGL_lose_context");de&&de.restoreContext()},this.getPixelRatio=function(){return U},this.setPixelRatio=function(de){de!==void 0&&(U=de,this.setSize(K,X,!1))},this.getSize=function(de){return de.set(K,X)},this.setSize=function(de,Ue,Je=!0){if(Re.isPresenting){console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting.");return}K=de,X=Ue,i.width=Math.floor(de*U),i.height=Math.floor(Ue*U),Je===!0&&(i.style.width=de+"px",i.style.height=Ue+"px"),this.setViewport(0,0,de,Ue)},this.getDrawingBufferSize=function(de){return de.set(K*U,X*U).floor()},this.setDrawingBufferSize=function(de,Ue,Je){K=de,X=Ue,U=Je,i.width=Math.floor(de*Je),i.height=Math.floor(Ue*Je),this.setViewport(0,0,de,Ue)},this.getCurrentViewport=function(de){return de.copy(k)},this.getViewport=function(de){return de.copy(j)},this.setViewport=function(de,Ue,Je,nt){de.isVector4?j.set(de.x,de.y,de.z,de.w):j.set(de,Ue,Je,nt),Be.viewport(k.copy(j).multiplyScalar(U).round())},this.getScissor=function(de){return de.copy(ee)},this.setScissor=function(de,Ue,Je,nt){de.isVector4?ee.set(de.x,de.y,de.z,de.w):ee.set(de,Ue,Je,nt),Be.scissor(z.copy(ee).multiplyScalar(U).round())},this.getScissorTest=function(){return pe},this.setScissorTest=function(de){Be.setScissorTest(pe=de)},this.setOpaqueSort=function(de){Y=de},this.setTransparentSort=function(de){Z=de},this.getClearColor=function(de){return de.copy(ot.getClearColor())},this.setClearColor=function(){ot.setClearColor(...arguments)},this.getClearAlpha=function(){return ot.getClearAlpha()},this.setClearAlpha=function(){ot.setClearAlpha(...arguments)},this.clear=function(de=!0,Ue=!0,Je=!0){let nt=0;if(de){let Ie=!1;if(C!==null){const ft=C.texture.format;Ie=ft===_O||ft===wO||ft===vT}if(Ie){const ft=C.texture.type,Dt=ft===_u||ft===jp||ft===R1||ft===I1||ft===yO||ft===xO,Mt=ot.getClearColor(),Vt=ot.getClearAlpha(),di=Mt.r,si=Mt.g,Wt=Mt.b;Dt?(p[0]=di,p[1]=si,p[2]=Wt,p[3]=Vt,ce.clearBufferuiv(ce.COLOR,0,p)):(g[0]=di,g[1]=si,g[2]=Wt,g[3]=Vt,ce.clearBufferiv(ce.COLOR,0,g))}else nt|=ce.COLOR_BUFFER_BIT}Ue&&(nt|=ce.DEPTH_BUFFER_BIT),Je&&(nt|=ce.STENCIL_BUFFER_BIT,this.state.buffers.stencil.setMask(4294967295)),ce.clear(nt)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){i.removeEventListener("webglcontextlost",ke,!1),i.removeEventListener("webglcontextrestored",st,!1),i.removeEventListener("webglcontextcreationerror",rt,!1),ot.dispose(),Le.dispose(),at.dispose(),ze.dispose(),wt.dispose(),ge.dispose(),we.dispose(),Et.dispose(),$t.dispose(),te.dispose(),Re.dispose(),Re.removeEventListener("sessionstart",Xi),Re.removeEventListener("sessionend",As),Gr.stop()};function ke(de){de.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),M=!0}function st(){console.log("THREE.WebGLRenderer: Context Restored."),M=!1;const de=$e.autoReset,Ue=dt.enabled,Je=dt.autoUpdate,nt=dt.needsUpdate,Ie=dt.type;oe(),$e.autoReset=de,dt.enabled=Ue,dt.autoUpdate=Je,dt.needsUpdate=nt,dt.type=Ie}function rt(de){console.error("THREE.WebGLRenderer: A WebGL context could not be created. Reason: ",de.statusMessage)}function je(de){const Ue=de.target;Ue.removeEventListener("dispose",je),Tt(Ue)}function Tt(de){Ft(de),ze.remove(de)}function Ft(de){const Ue=ze.get(de).programs;Ue!==void 0&&(Ue.forEach(function(Je){te.releaseProgram(Je)}),de.isShaderMaterial&&te.releaseShaderCache(de))}this.renderBufferDirect=function(de,Ue,Je,nt,Ie,ft){Ue===null&&(Ue=xe);const Dt=Ie.isMesh&&Ie.matrixWorld.determinant()<0,Mt=yi(de,Ue,Je,nt,Ie);Be.setMaterial(nt,Dt);let Vt=Je.index,di=1;if(nt.wireframe===!0){if(Vt=Q.getWireframeAttribute(Je),Vt===void 0)return;di=2}const si=Je.drawRange,Wt=Je.attributes.position;let ne=si.start*di,ae=(si.start+si.count)*di;ft!==null&&(ne=Math.max(ne,ft.start*di),ae=Math.min(ae,(ft.start+ft.count)*di)),Vt!==null?(ne=Math.max(ne,0),ae=Math.min(ae,Vt.count)):Wt!=null&&(ne=Math.max(ne,0),ae=Math.min(ae,Wt.count));const _e=ae-ne;if(_e<0||_e===1/0)return;Et.setup(Ie,nt,Mt,Je,Vt);let me,Pe=pt;if(Vt!==null&&(me=G.get(Vt),Pe=_t,Pe.setIndex(me)),Ie.isMesh)nt.wireframe===!0?(Be.setLineWidth(nt.wireframeLinewidth*Ce()),Pe.setMode(ce.LINES)):Pe.setMode(ce.TRIANGLES);else if(Ie.isLine){let Ze=nt.linewidth;Ze===void 0&&(Ze=1),Be.setLineWidth(Ze*Ce()),Ie.isLineSegments?Pe.setMode(ce.LINES):Ie.isLineLoop?Pe.setMode(ce.LINE_LOOP):Pe.setMode(ce.LINE_STRIP)}else Ie.isPoints?Pe.setMode(ce.POINTS):Ie.isSprite&&Pe.setMode(ce.TRIANGLES);if(Ie.isBatchedMesh)if(Ie._multiDrawInstances!==null)vM("THREE.WebGLRenderer: renderMultiDrawInstances has been deprecated and will be removed in r184. Append to renderMultiDraw arguments and use indirection."),Pe.renderMultiDrawInstances(Ie._multiDrawStarts,Ie._multiDrawCounts,Ie._multiDrawCount,Ie._multiDrawInstances);else if(De.get("WEBGL_multi_draw"))Pe.renderMultiDraw(Ie._multiDrawStarts,Ie._multiDrawCounts,Ie._multiDrawCount);else{const Ze=Ie._multiDrawStarts,Qi=Ie._multiDrawCounts,_i=Ie._multiDrawCount,nn=Vt?G.get(Vt).bytesPerElement:1,Sa=ze.get(nt).currentProgram.getUniforms();for(let Hn=0;Hn<_i;Hn++)Sa.setValue(ce,"_gl_DrawID",Hn),Pe.render(Ze[Hn]/nn,Qi[Hn])}else if(Ie.isInstancedMesh)Pe.renderInstances(ne,_e,Ie.count);else if(Je.isInstancedBufferGeometry){const Ze=Je._maxInstanceCount!==void 0?Je._maxInstanceCount:1/0,Qi=Math.min(Je.instanceCount,Ze);Pe.renderInstances(ne,_e,Qi)}else Pe.render(ne,_e)};function wi(de,Ue,Je){de.transparent===!0&&de.side===Sd&&de.forceSinglePass===!1?(de.side=bl,de.needsUpdate=!0,qe(de,Ue,Je),de.side=Fp,de.needsUpdate=!0,qe(de,Ue,Je),de.side=Sd):qe(de,Ue,Je)}this.compile=function(de,Ue,Je=null){Je===null&&(Je=de),y=at.get(Je),y.init(Ue),w.push(y),Je.traverseVisible(function(Ie){Ie.isLight&&Ie.layers.test(Ue.layers)&&(y.pushLight(Ie),Ie.castShadow&&y.pushShadow(Ie))}),de!==Je&&de.traverseVisible(function(Ie){Ie.isLight&&Ie.layers.test(Ue.layers)&&(y.pushLight(Ie),Ie.castShadow&&y.pushShadow(Ie))}),y.setupLights();const nt=new Set;return de.traverse(function(Ie){if(!(Ie.isMesh||Ie.isPoints||Ie.isLine||Ie.isSprite))return;const ft=Ie.material;if(ft)if(Array.isArray(ft))for(let Dt=0;Dt<ft.length;Dt++){const Mt=ft[Dt];wi(Mt,Je,Ie),nt.add(Mt)}else wi(ft,Je,Ie),nt.add(ft)}),y=w.pop(),nt},this.compileAsync=function(de,Ue,Je=null){const nt=this.compile(de,Ue,Je);return new Promise(Ie=>{function ft(){if(nt.forEach(function(Dt){ze.get(Dt).currentProgram.isReady()&&nt.delete(Dt)}),nt.size===0){Ie(de);return}setTimeout(ft,10)}De.get("KHR_parallel_shader_compile")!==null?ft():setTimeout(ft,10)})};let ti=null;function Zi(de){ti&&ti(de)}function Xi(){Gr.stop()}function As(){Gr.start()}const Gr=new Hle;Gr.setAnimationLoop(Zi),typeof self<"u"&&Gr.setContext(self),this.setAnimationLoop=function(de){ti=de,Re.setAnimationLoop(de),de===null?Gr.stop():Gr.start()},Re.addEventListener("sessionstart",Xi),Re.addEventListener("sessionend",As),this.render=function(de,Ue){if(Ue!==void 0&&Ue.isCamera!==!0){console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");return}if(M===!0)return;if(de.matrixWorldAutoUpdate===!0&&de.updateMatrixWorld(),Ue.parent===null&&Ue.matrixWorldAutoUpdate===!0&&Ue.updateMatrixWorld(),Re.enabled===!0&&Re.isPresenting===!0&&(Re.cameraAutoUpdate===!0&&Re.updateCamera(Ue),Ue=Re.getCamera()),de.isScene===!0&&de.onBeforeRender(E,de,Ue,C),y=at.get(de,w.length),y.init(Ue),w.push(y),le.multiplyMatrices(Ue.projectionMatrix,Ue.matrixWorldInverse),fe.setFromProjectionMatrix(le,Cc,Ue.reversedDepth),re=this.localClippingEnabled,se=Te.init(this.clippingPlanes,re),m=Le.get(de,b.length),m.init(),b.push(m),Re.enabled===!0&&Re.isPresenting===!0){const ft=E.xr.getDepthSensingMesh();ft!==null&&Nn(ft,Ue,-1/0,E.sortObjects)}Nn(de,Ue,0,E.sortObjects),m.finish(),E.sortObjects===!0&&m.sort(Y,Z),Se=Re.enabled===!1||Re.isPresenting===!1||Re.hasDepthSensing()===!1,Se&&ot.addToRenderList(m,de),this.info.render.frame++,se===!0&&Te.beginShadows();const Je=y.state.shadowsArray;dt.render(Je,de,Ue),se===!0&&Te.endShadows(),this.info.autoReset===!0&&this.info.reset();const nt=m.opaque,Ie=m.transmissive;if(y.setupLights(),Ue.isArrayCamera){const ft=Ue.cameras;if(Ie.length>0)for(let Dt=0,Mt=ft.length;Dt<Mt;Dt++){const Vt=ft[Dt];ye(nt,Ie,de,Vt)}Se&&ot.render(de);for(let Dt=0,Mt=ft.length;Dt<Mt;Dt++){const Vt=ft[Dt];us(m,de,Vt,Vt.viewport)}}else Ie.length>0&&ye(nt,Ie,de,Ue),Se&&ot.render(de),us(m,de,Ue);C!==null&&P===0&&(it.updateMultisampleRenderTarget(C),it.updateRenderTargetMipmap(C)),de.isScene===!0&&de.onAfterRender(E,de,Ue),Et.resetDefaultState(),R=-1,I=null,w.pop(),w.length>0?(y=w[w.length-1],se===!0&&Te.setGlobalState(E.clippingPlanes,y.state.camera)):y=null,b.pop(),b.length>0?m=b[b.length-1]:m=null};function Nn(de,Ue,Je,nt){if(de.visible===!1)return;if(de.layers.test(Ue.layers)){if(de.isGroup)Je=de.renderOrder;else if(de.isLOD)de.autoUpdate===!0&&de.update(Ue);else if(de.isLight)y.pushLight(de),de.castShadow&&y.pushShadow(de);else if(de.isSprite){if(!de.frustumCulled||fe.intersectsSprite(de)){nt&&ve.setFromMatrixPosition(de.matrixWorld).applyMatrix4(le);const Dt=we.update(de),Mt=de.material;Mt.visible&&m.push(de,Dt,Mt,Je,ve.z,null)}}else if((de.isMesh||de.isLine||de.isPoints)&&(!de.frustumCulled||fe.intersectsObject(de))){const Dt=we.update(de),Mt=de.material;if(nt&&(de.boundingSphere!==void 0?(de.boundingSphere===null&&de.computeBoundingSphere(),ve.copy(de.boundingSphere.center)):(Dt.boundingSphere===null&&Dt.computeBoundingSphere(),ve.copy(Dt.boundingSphere.center)),ve.applyMatrix4(de.matrixWorld).applyMatrix4(le)),Array.isArray(Mt)){const Vt=Dt.groups;for(let di=0,si=Vt.length;di<si;di++){const Wt=Vt[di],ne=Mt[Wt.materialIndex];ne&&ne.visible&&m.push(de,Dt,ne,Je,ve.z,Wt)}}else Mt.visible&&m.push(de,Dt,Mt,Je,ve.z,null)}}const ft=de.children;for(let Dt=0,Mt=ft.length;Dt<Mt;Dt++)Nn(ft[Dt],Ue,Je,nt)}function us(de,Ue,Je,nt){const Ie=de.opaque,ft=de.transmissive,Dt=de.transparent;y.setupLightsView(Je),se===!0&&Te.setGlobalState(E.clippingPlanes,Je),nt&&Be.viewport(k.copy(nt)),Ie.length>0&&Xe(Ie,Ue,Je),ft.length>0&&Xe(ft,Ue,Je),Dt.length>0&&Xe(Dt,Ue,Je),Be.buffers.depth.setTest(!0),Be.buffers.depth.setMask(!0),Be.buffers.color.setMask(!0),Be.setPolygonOffset(!1)}function ye(de,Ue,Je,nt){if((Je.isScene===!0?Je.overrideMaterial:null)!==null)return;y.state.transmissionRenderTarget[nt.id]===void 0&&(y.state.transmissionRenderTarget[nt.id]=new Qd(1,1,{generateMipmaps:!0,type:De.has("EXT_color_buffer_half_float")||De.has("EXT_color_buffer_float")?m_:_u,minFilter:Id,samples:4,stencilBuffer:s,resolveDepthBuffer:!1,resolveStencilBuffer:!1,colorSpace:Lr.workingColorSpace}));const ft=y.state.transmissionRenderTarget[nt.id],Dt=nt.viewport||k;ft.setSize(Dt.z*E.transmissionResolutionScale,Dt.w*E.transmissionResolutionScale);const Mt=E.getRenderTarget(),Vt=E.getActiveCubeFace(),di=E.getActiveMipmapLevel();E.setRenderTarget(ft),E.getClearColor(F),$=E.getClearAlpha(),$<1&&E.setClearColor(16777215,.5),E.clear(),Se&&ot.render(Je);const si=E.toneMapping;E.toneMapping=jd;const Wt=nt.viewport;if(nt.viewport!==void 0&&(nt.viewport=void 0),y.setupLightsView(nt),se===!0&&Te.setGlobalState(E.clippingPlanes,nt),Xe(de,Je,nt),it.updateMultisampleRenderTarget(ft),it.updateRenderTargetMipmap(ft),De.has("WEBGL_multisampled_render_to_texture")===!1){let ne=!1;for(let ae=0,_e=Ue.length;ae<_e;ae++){const me=Ue[ae],Pe=me.object,Ze=me.geometry,Qi=me.material,_i=me.group;if(Qi.side===Sd&&Pe.layers.test(nt.layers)){const nn=Qi.side;Qi.side=bl,Qi.needsUpdate=!0,ht(Pe,Je,nt,Ze,Qi,_i),Qi.side=nn,Qi.needsUpdate=!0,ne=!0}}ne===!0&&(it.updateMultisampleRenderTarget(ft),it.updateRenderTargetMipmap(ft))}E.setRenderTarget(Mt,Vt,di),E.setClearColor(F,$),Wt!==void 0&&(nt.viewport=Wt),E.toneMapping=si}function Xe(de,Ue,Je){const nt=Ue.isScene===!0?Ue.overrideMaterial:null;for(let Ie=0,ft=de.length;Ie<ft;Ie++){const Dt=de[Ie],Mt=Dt.object,Vt=Dt.geometry,di=Dt.group;let si=Dt.material;si.allowOverride===!0&&nt!==null&&(si=nt),Mt.layers.test(Je.layers)&&ht(Mt,Ue,Je,Vt,si,di)}}function ht(de,Ue,Je,nt,Ie,ft){de.onBeforeRender(E,Ue,Je,nt,Ie,ft),de.modelViewMatrix.multiplyMatrices(Je.matrixWorldInverse,de.matrixWorld),de.normalMatrix.getNormalMatrix(de.modelViewMatrix),Ie.onBeforeRender(E,Ue,Je,nt,de,ft),Ie.transparent===!0&&Ie.side===Sd&&Ie.forceSinglePass===!1?(Ie.side=bl,Ie.needsUpdate=!0,E.renderBufferDirect(Je,Ue,nt,Ie,de,ft),Ie.side=Fp,Ie.needsUpdate=!0,E.renderBufferDirect(Je,Ue,nt,Ie,de,ft),Ie.side=Sd):E.renderBufferDirect(Je,Ue,nt,Ie,de,ft),de.onAfterRender(E,Ue,Je,nt,Ie,ft)}function qe(de,Ue,Je){Ue.isScene!==!0&&(Ue=xe);const nt=ze.get(de),Ie=y.state.lights,ft=y.state.shadowsArray,Dt=Ie.state.version,Mt=te.getParameters(de,Ie.state,ft,Ue,Je),Vt=te.getProgramCacheKey(Mt);let di=nt.programs;nt.environment=de.isMeshStandardMaterial?Ue.environment:null,nt.fog=Ue.fog,nt.envMap=(de.isMeshStandardMaterial?ge:wt).get(de.envMap||nt.environment),nt.envMapRotation=nt.environment!==null&&de.envMap===null?Ue.environmentRotation:de.envMapRotation,di===void 0&&(de.addEventListener("dispose",je),di=new Map,nt.programs=di);let si=di.get(Vt);if(si!==void 0){if(nt.currentProgram===si&&nt.lightsStateVersion===Dt)return Zt(de,Mt),si}else Mt.uniforms=te.getUniforms(de),de.onBeforeCompile(Mt,E),si=te.acquireProgram(Mt,Vt),di.set(Vt,si),nt.uniforms=Mt.uniforms;const Wt=nt.uniforms;return(!de.isShaderMaterial&&!de.isRawShaderMaterial||de.clipping===!0)&&(Wt.clippingPlanes=Te.uniform),Zt(de,Mt),nt.needsLights=fi(de),nt.lightsStateVersion=Dt,nt.needsLights&&(Wt.ambientLightColor.value=Ie.state.ambient,Wt.lightProbe.value=Ie.state.probe,Wt.directionalLights.value=Ie.state.directional,Wt.directionalLightShadows.value=Ie.state.directionalShadow,Wt.spotLights.value=Ie.state.spot,Wt.spotLightShadows.value=Ie.state.spotShadow,Wt.rectAreaLights.value=Ie.state.rectArea,Wt.ltc_1.value=Ie.state.rectAreaLTC1,Wt.ltc_2.value=Ie.state.rectAreaLTC2,Wt.pointLights.value=Ie.state.point,Wt.pointLightShadows.value=Ie.state.pointShadow,Wt.hemisphereLights.value=Ie.state.hemi,Wt.directionalShadowMap.value=Ie.state.directionalShadowMap,Wt.directionalShadowMatrix.value=Ie.state.directionalShadowMatrix,Wt.spotShadowMap.value=Ie.state.spotShadowMap,Wt.spotLightMatrix.value=Ie.state.spotLightMatrix,Wt.spotLightMap.value=Ie.state.spotLightMap,Wt.pointShadowMap.value=Ie.state.pointShadowMap,Wt.pointShadowMatrix.value=Ie.state.pointShadowMatrix),nt.currentProgram=si,nt.uniformsList=null,si}function gt(de){if(de.uniformsList===null){const Ue=de.currentProgram.getUniforms();de.uniformsList=YR.seqWithValue(Ue.seq,de.uniforms)}return de.uniformsList}function Zt(de,Ue){const Je=ze.get(de);Je.outputColorSpace=Ue.outputColorSpace,Je.batching=Ue.batching,Je.batchingColor=Ue.batchingColor,Je.instancing=Ue.instancing,Je.instancingColor=Ue.instancingColor,Je.instancingMorph=Ue.instancingMorph,Je.skinning=Ue.skinning,Je.morphTargets=Ue.morphTargets,Je.morphNormals=Ue.morphNormals,Je.morphColors=Ue.morphColors,Je.morphTargetsCount=Ue.morphTargetsCount,Je.numClippingPlanes=Ue.numClippingPlanes,Je.numIntersection=Ue.numClipIntersection,Je.vertexAlphas=Ue.vertexAlphas,Je.vertexTangents=Ue.vertexTangents,Je.toneMapping=Ue.toneMapping}function yi(de,Ue,Je,nt,Ie){Ue.isScene!==!0&&(Ue=xe),it.resetTextureUnits();const ft=Ue.fog,Dt=nt.isMeshStandardMaterial?Ue.environment:null,Mt=C===null?E.outputColorSpace:C.isXRRenderTarget===!0?C.texture.colorSpace:T0,Vt=(nt.isMeshStandardMaterial?ge:wt).get(nt.envMap||Dt),di=nt.vertexColors===!0&&!!Je.attributes.color&&Je.attributes.color.itemSize===4,si=!!Je.attributes.tangent&&(!!nt.normalMap||nt.anisotropy>0),Wt=!!Je.morphAttributes.position,ne=!!Je.morphAttributes.normal,ae=!!Je.morphAttributes.color;let _e=jd;nt.toneMapped&&(C===null||C.isXRRenderTarget===!0)&&(_e=E.toneMapping);const me=Je.morphAttributes.position||Je.morphAttributes.normal||Je.morphAttributes.color,Pe=me!==void 0?me.length:0,Ze=ze.get(nt),Qi=y.state.lights;if(se===!0&&(re===!0||de!==I)){const Gn=de===I&&nt.id===R;Te.setState(nt,de,Gn)}let _i=!1;nt.version===Ze.__version?(Ze.needsLights&&Ze.lightsStateVersion!==Qi.state.version||Ze.outputColorSpace!==Mt||Ie.isBatchedMesh&&Ze.batching===!1||!Ie.isBatchedMesh&&Ze.batching===!0||Ie.isBatchedMesh&&Ze.batchingColor===!0&&Ie.colorTexture===null||Ie.isBatchedMesh&&Ze.batchingColor===!1&&Ie.colorTexture!==null||Ie.isInstancedMesh&&Ze.instancing===!1||!Ie.isInstancedMesh&&Ze.instancing===!0||Ie.isSkinnedMesh&&Ze.skinning===!1||!Ie.isSkinnedMesh&&Ze.skinning===!0||Ie.isInstancedMesh&&Ze.instancingColor===!0&&Ie.instanceColor===null||Ie.isInstancedMesh&&Ze.instancingColor===!1&&Ie.instanceColor!==null||Ie.isInstancedMesh&&Ze.instancingMorph===!0&&Ie.morphTexture===null||Ie.isInstancedMesh&&Ze.instancingMorph===!1&&Ie.morphTexture!==null||Ze.envMap!==Vt||nt.fog===!0&&Ze.fog!==ft||Ze.numClippingPlanes!==void 0&&(Ze.numClippingPlanes!==Te.numPlanes||Ze.numIntersection!==Te.numIntersection)||Ze.vertexAlphas!==di||Ze.vertexTangents!==si||Ze.morphTargets!==Wt||Ze.morphNormals!==ne||Ze.morphColors!==ae||Ze.toneMapping!==_e||Ze.morphTargetsCount!==Pe)&&(_i=!0):(_i=!0,Ze.__version=nt.version);let nn=Ze.currentProgram;_i===!0&&(nn=qe(nt,Ue,Ie));let Sa=!1,Hn=!1,Eo=!1;const $r=nn.getUniforms(),bn=Ze.uniforms;if(Be.useProgram(nn.program)&&(Sa=!0,Hn=!0,Eo=!0),nt.id!==R&&(R=nt.id,Hn=!0),Sa||I!==de){Be.buffers.depth.getReversed()&&de.reversedDepth!==!0&&(de._reversedDepth=!0,de.updateProjectionMatrix()),$r.setValue(ce,"projectionMatrix",de.projectionMatrix),$r.setValue(ce,"viewMatrix",de.matrixWorldInverse);const Aa=$r.map.cameraPosition;Aa!==void 0&&Aa.setValue(ce,he.setFromMatrixPosition(de.matrixWorld)),He.logarithmicDepthBuffer&&$r.setValue(ce,"logDepthBufFC",2/(Math.log(de.far+1)/Math.LN2)),(nt.isMeshPhongMaterial||nt.isMeshToonMaterial||nt.isMeshLambertMaterial||nt.isMeshBasicMaterial||nt.isMeshStandardMaterial||nt.isShaderMaterial)&&$r.setValue(ce,"isOrthographic",de.isOrthographicCamera===!0),I!==de&&(I=de,Hn=!0,Eo=!0)}if(Ie.isSkinnedMesh){$r.setOptional(ce,Ie,"bindMatrix"),$r.setOptional(ce,Ie,"bindMatrixInverse");const Gn=Ie.skeleton;Gn&&(Gn.boneTexture===null&&Gn.computeBoneTexture(),$r.setValue(ce,"boneTexture",Gn.boneTexture,it))}Ie.isBatchedMesh&&($r.setOptional(ce,Ie,"batchingTexture"),$r.setValue(ce,"batchingTexture",Ie._matricesTexture,it),$r.setOptional(ce,Ie,"batchingIdTexture"),$r.setValue(ce,"batchingIdTexture",Ie._indirectTexture,it),$r.setOptional(ce,Ie,"batchingColorTexture"),Ie._colorsTexture!==null&&$r.setValue(ce,"batchingColorTexture",Ie._colorsTexture,it));const Ea=Je.morphAttributes;if((Ea.position!==void 0||Ea.normal!==void 0||Ea.color!==void 0)&&Qe.update(Ie,Je,nn),(Hn||Ze.receiveShadow!==Ie.receiveShadow)&&(Ze.receiveShadow=Ie.receiveShadow,$r.setValue(ce,"receiveShadow",Ie.receiveShadow)),nt.isMeshGouraudMaterial&&nt.envMap!==null&&(bn.envMap.value=Vt,bn.flipEnvMap.value=Vt.isCubeTexture&&Vt.isRenderTargetTexture===!1?-1:1),nt.isMeshStandardMaterial&&nt.envMap===null&&Ue.environment!==null&&(bn.envMapIntensity.value=Ue.environmentIntensity),Hn&&($r.setValue(ce,"toneMappingExposure",E.toneMappingExposure),Ze.needsLights&&Ti(bn,Eo),ft&&nt.fog===!0&&Ne.refreshFogUniforms(bn,ft),Ne.refreshMaterialUniforms(bn,nt,U,X,y.state.transmissionRenderTarget[de.id]),YR.upload(ce,gt(Ze),bn,it)),nt.isShaderMaterial&&nt.uniformsNeedUpdate===!0&&(YR.upload(ce,gt(Ze),bn,it),nt.uniformsNeedUpdate=!1),nt.isSpriteMaterial&&$r.setValue(ce,"center",Ie.center),$r.setValue(ce,"modelViewMatrix",Ie.modelViewMatrix),$r.setValue(ce,"normalMatrix",Ie.normalMatrix),$r.setValue(ce,"modelMatrix",Ie.matrixWorld),nt.isShaderMaterial||nt.isRawShaderMaterial){const Gn=nt.uniformsGroups;for(let Aa=0,Fc=Gn.length;Aa<Fc;Aa++){const cr=Gn[Aa];$t.update(cr,nn),$t.bind(cr,nn)}}return nn}function Ti(de,Ue){de.ambientLightColor.needsUpdate=Ue,de.lightProbe.needsUpdate=Ue,de.directionalLights.needsUpdate=Ue,de.directionalLightShadows.needsUpdate=Ue,de.pointLights.needsUpdate=Ue,de.pointLightShadows.needsUpdate=Ue,de.spotLights.needsUpdate=Ue,de.spotLightShadows.needsUpdate=Ue,de.rectAreaLights.needsUpdate=Ue,de.hemisphereLights.needsUpdate=Ue}function fi(de){return de.isMeshLambertMaterial||de.isMeshToonMaterial||de.isMeshPhongMaterial||de.isMeshStandardMaterial||de.isShadowMaterial||de.isShaderMaterial&&de.lights===!0}this.getActiveCubeFace=function(){return A},this.getActiveMipmapLevel=function(){return P},this.getRenderTarget=function(){return C},this.setRenderTargetTextures=function(de,Ue,Je){const nt=ze.get(de);nt.__autoAllocateDepthBuffer=de.resolveDepthBuffer===!1,nt.__autoAllocateDepthBuffer===!1&&(nt.__useRenderToTexture=!1),ze.get(de.texture).__webglTexture=Ue,ze.get(de.depthTexture).__webglTexture=nt.__autoAllocateDepthBuffer?void 0:Je,nt.__hasExternalTextures=!0},this.setRenderTargetFramebuffer=function(de,Ue){const Je=ze.get(de);Je.__webglFramebuffer=Ue,Je.__useDefaultFramebuffer=Ue===void 0};const vr=ce.createFramebuffer();this.setRenderTarget=function(de,Ue=0,Je=0){C=de,A=Ue,P=Je;let nt=!0,Ie=null,ft=!1,Dt=!1;if(de){const Vt=ze.get(de);if(Vt.__useDefaultFramebuffer!==void 0)Be.bindFramebuffer(ce.FRAMEBUFFER,null),nt=!1;else if(Vt.__webglFramebuffer===void 0)it.setupRenderTarget(de);else if(Vt.__hasExternalTextures)it.rebindTextures(de,ze.get(de.texture).__webglTexture,ze.get(de.depthTexture).__webglTexture);else if(de.depthBuffer){const Wt=de.depthTexture;if(Vt.__boundDepthTexture!==Wt){if(Wt!==null&&ze.has(Wt)&&(de.width!==Wt.image.width||de.height!==Wt.image.height))throw new Error("WebGLRenderTarget: Attached DepthTexture is initialized to the incorrect size.");it.setupDepthRenderbuffer(de)}}const di=de.texture;(di.isData3DTexture||di.isDataArrayTexture||di.isCompressedArrayTexture)&&(Dt=!0);const si=ze.get(de).__webglFramebuffer;de.isWebGLCubeRenderTarget?(Array.isArray(si[Ue])?Ie=si[Ue][Je]:Ie=si[Ue],ft=!0):de.samples>0&&it.useMultisampledRTT(de)===!1?Ie=ze.get(de).__webglMultisampledFramebuffer:Array.isArray(si)?Ie=si[Je]:Ie=si,k.copy(de.viewport),z.copy(de.scissor),V=de.scissorTest}else k.copy(j).multiplyScalar(U).floor(),z.copy(ee).multiplyScalar(U).floor(),V=pe;if(Je!==0&&(Ie=vr),Be.bindFramebuffer(ce.FRAMEBUFFER,Ie)&&nt&&Be.drawBuffers(de,Ie),Be.viewport(k),Be.scissor(z),Be.setScissorTest(V),ft){const Vt=ze.get(de.texture);ce.framebufferTexture2D(ce.FRAMEBUFFER,ce.COLOR_ATTACHMENT0,ce.TEXTURE_CUBE_MAP_POSITIVE_X+Ue,Vt.__webglTexture,Je)}else if(Dt){const Vt=Ue;for(let di=0;di<de.textures.length;di++){const si=ze.get(de.textures[di]);ce.framebufferTextureLayer(ce.FRAMEBUFFER,ce.COLOR_ATTACHMENT0+di,si.__webglTexture,Je,Vt)}}else if(de!==null&&Je!==0){const Vt=ze.get(de.texture);ce.framebufferTexture2D(ce.FRAMEBUFFER,ce.COLOR_ATTACHMENT0,ce.TEXTURE_2D,Vt.__webglTexture,Je)}R=-1},this.readRenderTargetPixels=function(de,Ue,Je,nt,Ie,ft,Dt,Mt=0){if(!(de&&de.isWebGLRenderTarget)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");return}let Vt=ze.get(de).__webglFramebuffer;if(de.isWebGLCubeRenderTarget&&Dt!==void 0&&(Vt=Vt[Dt]),Vt){Be.bindFramebuffer(ce.FRAMEBUFFER,Vt);try{const di=de.textures[Mt],si=di.format,Wt=di.type;if(!He.textureFormatReadable(si)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");return}if(!He.textureTypeReadable(Wt)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");return}Ue>=0&&Ue<=de.width-nt&&Je>=0&&Je<=de.height-Ie&&(de.textures.length>1&&ce.readBuffer(ce.COLOR_ATTACHMENT0+Mt),ce.readPixels(Ue,Je,nt,Ie,yt.convert(si),yt.convert(Wt),ft))}finally{const di=C!==null?ze.get(C).__webglFramebuffer:null;Be.bindFramebuffer(ce.FRAMEBUFFER,di)}}},this.readRenderTargetPixelsAsync=async function(de,Ue,Je,nt,Ie,ft,Dt,Mt=0){if(!(de&&de.isWebGLRenderTarget))throw new Error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let Vt=ze.get(de).__webglFramebuffer;if(de.isWebGLCubeRenderTarget&&Dt!==void 0&&(Vt=Vt[Dt]),Vt)if(Ue>=0&&Ue<=de.width-nt&&Je>=0&&Je<=de.height-Ie){Be.bindFramebuffer(ce.FRAMEBUFFER,Vt);const di=de.textures[Mt],si=di.format,Wt=di.type;if(!He.textureFormatReadable(si))throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: renderTarget is not in RGBA or implementation defined format.");if(!He.textureTypeReadable(Wt))throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: renderTarget is not in UnsignedByteType or implementation defined type.");const ne=ce.createBuffer();ce.bindBuffer(ce.PIXEL_PACK_BUFFER,ne),ce.bufferData(ce.PIXEL_PACK_BUFFER,ft.byteLength,ce.STREAM_READ),de.textures.length>1&&ce.readBuffer(ce.COLOR_ATTACHMENT0+Mt),ce.readPixels(Ue,Je,nt,Ie,yt.convert(si),yt.convert(Wt),0);const ae=C!==null?ze.get(C).__webglFramebuffer:null;Be.bindFramebuffer(ce.FRAMEBUFFER,ae);const _e=ce.fenceSync(ce.SYNC_GPU_COMMANDS_COMPLETE,0);return ce.flush(),await SDe(ce,_e,4),ce.bindBuffer(ce.PIXEL_PACK_BUFFER,ne),ce.getBufferSubData(ce.PIXEL_PACK_BUFFER,0,ft),ce.deleteBuffer(ne),ce.deleteSync(_e),ft}else throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: requested read bounds are out of range.")},this.copyFramebufferToTexture=function(de,Ue=null,Je=0){const nt=Math.pow(2,-Je),Ie=Math.floor(de.image.width*nt),ft=Math.floor(de.image.height*nt),Dt=Ue!==null?Ue.x:0,Mt=Ue!==null?Ue.y:0;it.setTexture2D(de,0),ce.copyTexSubImage2D(ce.TEXTURE_2D,Je,0,0,Dt,Mt,Ie,ft),Be.unbindTexture()};const ji=ce.createFramebuffer(),Vi=ce.createFramebuffer();this.copyTextureToTexture=function(de,Ue,Je=null,nt=null,Ie=0,ft=null){ft===null&&(Ie!==0?(vM("WebGLRenderer: copyTextureToTexture function signature has changed to support src and dst mipmap levels."),ft=Ie,Ie=0):ft=0);let Dt,Mt,Vt,di,si,Wt,ne,ae,_e;const me=de.isCompressedTexture?de.mipmaps[ft]:de.image;if(Je!==null)Dt=Je.max.x-Je.min.x,Mt=Je.max.y-Je.min.y,Vt=Je.isBox3?Je.max.z-Je.min.z:1,di=Je.min.x,si=Je.min.y,Wt=Je.isBox3?Je.min.z:0;else{const Ea=Math.pow(2,-Ie);Dt=Math.floor(me.width*Ea),Mt=Math.floor(me.height*Ea),de.isDataArrayTexture?Vt=me.depth:de.isData3DTexture?Vt=Math.floor(me.depth*Ea):Vt=1,di=0,si=0,Wt=0}nt!==null?(ne=nt.x,ae=nt.y,_e=nt.z):(ne=0,ae=0,_e=0);const Pe=yt.convert(Ue.format),Ze=yt.convert(Ue.type);let Qi;Ue.isData3DTexture?(it.setTexture3D(Ue,0),Qi=ce.TEXTURE_3D):Ue.isDataArrayTexture||Ue.isCompressedArrayTexture?(it.setTexture2DArray(Ue,0),Qi=ce.TEXTURE_2D_ARRAY):(it.setTexture2D(Ue,0),Qi=ce.TEXTURE_2D),ce.pixelStorei(ce.UNPACK_FLIP_Y_WEBGL,Ue.flipY),ce.pixelStorei(ce.UNPACK_PREMULTIPLY_ALPHA_WEBGL,Ue.premultiplyAlpha),ce.pixelStorei(ce.UNPACK_ALIGNMENT,Ue.unpackAlignment);const _i=ce.getParameter(ce.UNPACK_ROW_LENGTH),nn=ce.getParameter(ce.UNPACK_IMAGE_HEIGHT),Sa=ce.getParameter(ce.UNPACK_SKIP_PIXELS),Hn=ce.getParameter(ce.UNPACK_SKIP_ROWS),Eo=ce.getParameter(ce.UNPACK_SKIP_IMAGES);ce.pixelStorei(ce.UNPACK_ROW_LENGTH,me.width),ce.pixelStorei(ce.UNPACK_IMAGE_HEIGHT,me.height),ce.pixelStorei(ce.UNPACK_SKIP_PIXELS,di),ce.pixelStorei(ce.UNPACK_SKIP_ROWS,si),ce.pixelStorei(ce.UNPACK_SKIP_IMAGES,Wt);const $r=de.isDataArrayTexture||de.isData3DTexture,bn=Ue.isDataArrayTexture||Ue.isData3DTexture;if(de.isDepthTexture){const Ea=ze.get(de),Gn=ze.get(Ue),Aa=ze.get(Ea.__renderTarget),Fc=ze.get(Gn.__renderTarget);Be.bindFramebuffer(ce.READ_FRAMEBUFFER,Aa.__webglFramebuffer),Be.bindFramebuffer(ce.DRAW_FRAMEBUFFER,Fc.__webglFramebuffer);for(let cr=0;cr<Vt;cr++)$r&&(ce.framebufferTextureLayer(ce.READ_FRAMEBUFFER,ce.COLOR_ATTACHMENT0,ze.get(de).__webglTexture,Ie,Wt+cr),ce.framebufferTextureLayer(ce.DRAW_FRAMEBUFFER,ce.COLOR_ATTACHMENT0,ze.get(Ue).__webglTexture,ft,_e+cr)),ce.blitFramebuffer(di,si,Dt,Mt,ne,ae,Dt,Mt,ce.DEPTH_BUFFER_BIT,ce.NEAREST);Be.bindFramebuffer(ce.READ_FRAMEBUFFER,null),Be.bindFramebuffer(ce.DRAW_FRAMEBUFFER,null)}else if(Ie!==0||de.isRenderTargetTexture||ze.has(de)){const Ea=ze.get(de),Gn=ze.get(Ue);Be.bindFramebuffer(ce.READ_FRAMEBUFFER,ji),Be.bindFramebuffer(ce.DRAW_FRAMEBUFFER,Vi);for(let Aa=0;Aa<Vt;Aa++)$r?ce.framebufferTextureLayer(ce.READ_FRAMEBUFFER,ce.COLOR_ATTACHMENT0,Ea.__webglTexture,Ie,Wt+Aa):ce.framebufferTexture2D(ce.READ_FRAMEBUFFER,ce.COLOR_ATTACHMENT0,ce.TEXTURE_2D,Ea.__webglTexture,Ie),bn?ce.framebufferTextureLayer(ce.DRAW_FRAMEBUFFER,ce.COLOR_ATTACHMENT0,Gn.__webglTexture,ft,_e+Aa):ce.framebufferTexture2D(ce.DRAW_FRAMEBUFFER,ce.COLOR_ATTACHMENT0,ce.TEXTURE_2D,Gn.__webglTexture,ft),Ie!==0?ce.blitFramebuffer(di,si,Dt,Mt,ne,ae,Dt,Mt,ce.COLOR_BUFFER_BIT,ce.NEAREST):bn?ce.copyTexSubImage3D(Qi,ft,ne,ae,_e+Aa,di,si,Dt,Mt):ce.copyTexSubImage2D(Qi,ft,ne,ae,di,si,Dt,Mt);Be.bindFramebuffer(ce.READ_FRAMEBUFFER,null),Be.bindFramebuffer(ce.DRAW_FRAMEBUFFER,null)}else bn?de.isDataTexture||de.isData3DTexture?ce.texSubImage3D(Qi,ft,ne,ae,_e,Dt,Mt,Vt,Pe,Ze,me.data):Ue.isCompressedArrayTexture?ce.compressedTexSubImage3D(Qi,ft,ne,ae,_e,Dt,Mt,Vt,Pe,me.data):ce.texSubImage3D(Qi,ft,ne,ae,_e,Dt,Mt,Vt,Pe,Ze,me):de.isDataTexture?ce.texSubImage2D(ce.TEXTURE_2D,ft,ne,ae,Dt,Mt,Pe,Ze,me.data):de.isCompressedTexture?ce.compressedTexSubImage2D(ce.TEXTURE_2D,ft,ne,ae,me.width,me.height,Pe,me.data):ce.texSubImage2D(ce.TEXTURE_2D,ft,ne,ae,Dt,Mt,Pe,Ze,me);ce.pixelStorei(ce.UNPACK_ROW_LENGTH,_i),ce.pixelStorei(ce.UNPACK_IMAGE_HEIGHT,nn),ce.pixelStorei(ce.UNPACK_SKIP_PIXELS,Sa),ce.pixelStorei(ce.UNPACK_SKIP_ROWS,Hn),ce.pixelStorei(ce.UNPACK_SKIP_IMAGES,Eo),ft===0&&Ue.generateMipmaps&&ce.generateMipmap(Qi),Be.unbindTexture()},this.initRenderTarget=function(de){ze.get(de).__webglFramebuffer===void 0&&it.setupRenderTarget(de)},this.initTexture=function(de){de.isCubeTexture?it.setTextureCube(de,0):de.isData3DTexture?it.setTexture3D(de,0):de.isDataArrayTexture||de.isCompressedArrayTexture?it.setTexture2DArray(de,0):it.setTexture2D(de,0),Be.unbindTexture()},this.resetState=function(){A=0,P=0,C=null,Be.reset(),Et.reset()},typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}get coordinateSystem(){return Cc}get outputColorSpace(){return this._outputColorSpace}set outputColorSpace(e){this._outputColorSpace=e;const i=this.getContext();i.drawingBufferColorSpace=Lr._getDrawingBufferColorSpace(e),i.unpackColorSpace=Lr._getUnpackColorSpace()}}const zBe=Object.freeze(Object.defineProperty({__proto__:null,ACESFilmicToneMapping:N6,AddEquation:vg,AddOperation:xoe,AdditiveAnimationBlendMode:W6,AdditiveBlending:Hz,AgXToneMapping:Eoe,AlphaFormat:V6,AlwaysCompare:Foe,AlwaysDepth:WI,AlwaysStencilFunc:Xz,AmbientLight:Ile,AnimationAction:zle,AnimationClip:SM,AnimationLoader:K3e,AnimationMixer:AOe,AnimationObjectGroup:SOe,AnimationUtils:q3e,ArcCurve:ile,ArrayCamera:Ule,ArrowHelper:ZOe,AttachedBindMode:qz,Audio:Ble,AudioAnalyser:fOe,AudioContext:yH,AudioListener:uOe,AudioLoader:oOe,AxesHelper:QOe,BackSide:bl,BasicDepthPacking:Roe,BasicShadowMap:Jae,BatchedMesh:Zoe,Bone:tH,BooleanKeyframeTrack:q0,Box2:kOe,Box3:Vo,Box3Helper:YOe,BoxGeometry:W0,BoxHelper:$Oe,BufferAttribute:xn,BufferGeometry:dr,BufferGeometryLoader:Nle,ByteType:B6,Cache:Dd,Camera:yT,CameraHelper:XOe,CanvasTexture:m3e,CapsuleGeometry:OO,CatmullRomCurve3:rle,CineonToneMapping:_oe,CircleGeometry:LO,ClampToEdgeWrapping:gu,Clock:xH,Color:ii,ColorKeyframeTrack:mH,ColorManagement:Lr,CompressedArrayTexture:f3e,CompressedCubeTexture:p3e,CompressedTexture:DO,CompressedTextureLoader:Z3e,ConeGeometry:wT,ConstantAlphaFactor:goe,ConstantColorFactor:poe,Controls:eLe,CubeCamera:Z6,CubeReflectionMapping:zp,CubeRefractionMapping:Jg,CubeTexture:xT,CubeTextureLoader:Q3e,CubeUVReflectionMapping:p_,CubicBezierCurve:sH,CubicBezierCurve3:nle,CubicInterpolant:Sle,CullFaceBack:Vz,CullFaceFront:Qae,CullFaceFrontBack:SIe,CullFaceNone:Zae,Curve:Uh,CurvePath:ale,CustomBlending:eoe,CustomToneMapping:Soe,CylinderGeometry:bT,Cylindrical:LOe,Data3DTexture:AO,DataArrayTexture:EO,DataTexture:Vd,DataTextureLoader:J3e,DataUtils:BDe,DecrementStencilOp:UIe,DecrementWrapStencilOp:FIe,DefaultLoadingManager:Mle,DepthFormat:D1,DepthStencilFormat:O1,DepthTexture:iH,DetachedBindMode:Moe,DirectionalLight:Rle,DirectionalLightHelper:qOe,DiscreteInterpolant:Ele,DodecahedronGeometry:kO,DoubleSide:Sd,DstAlphaFactor:coe,DstColorFactor:hoe,DynamicCopyUsage:JIe,DynamicDrawUsage:d0,DynamicReadUsage:KIe,EdgesGeometry:tle,EllipseCurve:NO,EqualCompare:koe,EqualDepth:XI,EqualStencilFunc:HIe,EquirectangularReflectionMapping:lM,EquirectangularRefractionMapping:cM,Euler:kc,EventDispatcher:af,ExternalTexture:rH,ExtrudeGeometry:UO,FileLoader:Vp,Float16BufferAttribute:WDe,Float32BufferAttribute:hi,FloatType:tc,Fog:TO,FogExp2:MO,FramebufferTexture:d3e,FrontSide:Fp,Frustum:v_,FrustumArray:RO,GLBufferAttribute:ROe,GLSL1:tDe,GLSL3:$z,GreaterCompare:Noe,GreaterDepth:YI,GreaterEqualCompare:Boe,GreaterEqualDepth:$I,GreaterEqualStencilFunc:XIe,GreaterStencilFunc:WIe,GridHelper:GOe,Group:Gw,HalfFloatType:m_,HemisphereLight:Tle,HemisphereLightHelper:HOe,IcosahedronGeometry:BO,ImageBitmapLoader:aOe,ImageLoader:EM,ImageUtils:Voe,IncrementStencilOp:NIe,IncrementWrapStencilOp:BIe,InstancedBufferAttribute:U1,InstancedBufferGeometry:kle,InstancedInterleavedBuffer:POe,InstancedMesh:Koe,Int16BufferAttribute:HDe,Int32BufferAttribute:GDe,Int8BufferAttribute:zDe,IntType:vO,InterleavedBuffer:CO,InterleavedBufferAttribute:C0,Interpolant:ET,InterpolateDiscrete:dM,InterpolateLinear:AD,InterpolateSmooth:XR,InterpolationSamplingMode:nDe,InterpolationSamplingType:rDe,InvertStencilOp:zIe,KeepStencilOp:Ly,KeyframeTrack:Au,LOD:$oe,LatheGeometry:FO,Layers:p0,LessCompare:Loe,LessDepth:qI,LessEqualCompare:q6,LessEqualDepth:M0,LessEqualStencilFunc:GIe,LessStencilFunc:VIe,Light:dv,LightProbe:Lle,Line:ev,Line3:BOe,LineBasicMaterial:Sl,LineCurve:aH,LineCurve3:sle,LineDashedMaterial:ble,LineLoop:Qoe,LineSegments:of,LinearFilter:ma,LinearInterpolant:pH,LinearMipMapLinearFilter:TIe,LinearMipMapNearestFilter:MIe,LinearMipmapLinearFilter:Id,LinearMipmapNearestFilter:yA,LinearSRGBColorSpace:T0,LinearToneMapping:boe,LinearTransfer:pM,Loader:cc,LoaderUtils:Jz,LoadingManager:gH,LoopOnce:Toe,LoopPingPong:Poe,LoopRepeat:Coe,MOUSE:wIe,Material:Go,MaterialLoader:qO,MathUtils:wDe,Matrix2:SH,Matrix3:lr,Matrix4:zi,MaxEquation:noe,Mesh:js,MeshBasicMaterial:uv,MeshDepthMaterial:hH,MeshDistanceMaterial:dH,MeshLambertMaterial:yle,MeshMatcapMaterial:xle,MeshNormalMaterial:vle,MeshPhongMaterial:mle,MeshPhysicalMaterial:ple,MeshStandardMaterial:uH,MeshToonMaterial:gle,MinEquation:roe,MirroredRepeatWrapping:hM,MixOperation:yoe,MultiplyBlending:Wz,MultiplyOperation:gT,NearestFilter:wo,NearestMipMapLinearFilter:AIe,NearestMipMapNearestFilter:EIe,NearestMipmapLinearFilter:Vw,NearestMipmapNearestFilter:U6,NeutralToneMapping:Aoe,NeverCompare:Ooe,NeverDepth:GI,NeverStencilFunc:jIe,NoBlending:Dp,NoColorSpace:xp,NoToneMapping:jd,NormalAnimationBlendMode:SO,NormalBlending:h0,NotEqualCompare:Uoe,NotEqualDepth:KI,NotEqualStencilFunc:qIe,NumberKeyframeTrack:wM,Object3D:Br,ObjectLoader:nOe,ObjectSpaceNormalMap:Doe,OctahedronGeometry:_T,OneFactor:aoe,OneMinusConstantAlphaFactor:voe,OneMinusConstantColorFactor:moe,OneMinusDstAlphaFactor:uoe,OneMinusDstColorFactor:doe,OneMinusSrcAlphaFactor:HI,OneMinusSrcColorFactor:loe,OrthographicCamera:MT,PCFShadowMap:mO,PCFSoftShadowMap:vA,PMREMGenerator:ij,Path:PD,PerspectiveCamera:ja,Plane:fg,PlaneGeometry:y_,PlaneHelper:KOe,PointLight:Ple,PointLightHelper:jOe,Points:Joe,PointsMaterial:IO,PolarGridHelper:WOe,PolyhedronGeometry:hv,PositionalAudio:dOe,PropertyBinding:Nr,PropertyMixer:Fle,QuadraticBezierCurve:oH,QuadraticBezierCurve3:lH,Quaternion:sc,QuaternionKeyframeTrack:AT,QuaternionLinearInterpolant:Ale,RED_GREEN_RGTC2_Format:SD,RED_RGTC1_Format:wD,REVISION:mT,RGBADepthPacking:Ioe,RGBAFormat:zo,RGBAIntegerFormat:_O,RGBA_ASTC_10x10_Format:mD,RGBA_ASTC_10x5_Format:dD,RGBA_ASTC_10x6_Format:fD,RGBA_ASTC_10x8_Format:pD,RGBA_ASTC_12x10_Format:gD,RGBA_ASTC_12x12_Format:vD,RGBA_ASTC_4x4_Format:nD,RGBA_ASTC_5x4_Format:sD,RGBA_ASTC_5x5_Format:aD,RGBA_ASTC_6x5_Format:oD,RGBA_ASTC_6x6_Format:lD,RGBA_ASTC_8x5_Format:cD,RGBA_ASTC_8x6_Format:uD,RGBA_ASTC_8x8_Format:hD,RGBA_BPTC_Format:yD,RGBA_ETC2_EAC_Format:rD,RGBA_PVRTC_2BPPV1_Format:eD,RGBA_PVRTC_4BPPV1_Format:JI,RGBA_S3TC_DXT1_Format:bA,RGBA_S3TC_DXT3_Format:wA,RGBA_S3TC_DXT5_Format:_A,RGBDepthPacking:DIe,RGBFormat:H6,RGBIntegerFormat:CIe,RGB_BPTC_SIGNED_Format:xD,RGB_BPTC_UNSIGNED_Format:bD,RGB_ETC1_Format:tD,RGB_ETC2_Format:iD,RGB_PVRTC_2BPPV1_Format:QI,RGB_PVRTC_4BPPV1_Format:ZI,RGB_S3TC_DXT1_Format:xA,RGDepthPacking:OIe,RGFormat:G6,RGIntegerFormat:wO,RawShaderMaterial:fle,Ray:g_,Raycaster:jle,RectAreaLight:Dle,RedFormat:bO,RedIntegerFormat:vT,ReinhardToneMapping:woe,RenderTarget:$6,RenderTarget3D:MOe,RepeatWrapping:uM,ReplaceStencilOp:kIe,ReverseSubtractEquation:ioe,RingGeometry:zO,SIGNED_RED_GREEN_RGTC2_Format:ED,SIGNED_RED_RGTC1_Format:_D,SRGBColorSpace:Wl,SRGBTransfer:on,Scene:J6,ShaderChunk:pr,ShaderLib:gh,ShaderMaterial:Ch,ShadowMaterial:dle,Shape:m0,ShapeGeometry:jO,ShapePath:JOe,ShapeUtils:xh,ShortType:F6,Skeleton:PO,SkeletonHelper:zOe,SkinnedMesh:Yoe,Source:Cg,Sphere:_o,SphereGeometry:ST,Spherical:OOe,SphericalHarmonics3:Ole,SplineCurve:cH,SpotLight:Cle,SpotLightHelper:FOe,Sprite:Xoe,SpriteMaterial:eH,SrcAlphaFactor:VI,SrcAlphaSaturateFactor:foe,SrcColorFactor:ooe,StaticCopyUsage:QIe,StaticDrawUsage:mM,StaticReadUsage:YIe,StereoCamera:lOe,StreamCopyUsage:eDe,StreamDrawUsage:$Ie,StreamReadUsage:ZIe,StringKeyframeTrack:X0,SubtractEquation:toe,SubtractiveBlending:Gz,TOUCH:_Ie,TangentSpaceNormalMap:cv,TetrahedronGeometry:VO,Texture:ls,TextureLoader:eOe,TextureUtils:sLe,Timer:IOe,TimestampQuery:iDe,TorusGeometry:HO,TorusKnotGeometry:GO,Triangle:Kl,TriangleFanDrawMode:IIe,TriangleStripDrawMode:RIe,TrianglesDrawMode:PIe,TubeGeometry:WO,UVMapping:gO,Uint16BufferAttribute:Y6,Uint32BufferAttribute:K6,Uint8BufferAttribute:jDe,Uint8ClampedBufferAttribute:VDe,Uniform:_H,UniformsGroup:COe,UniformsLib:Xt,UniformsUtils:Woe,UnsignedByteType:_u,UnsignedInt101111Type:j6,UnsignedInt248Type:I1,UnsignedInt5999Type:z6,UnsignedIntType:jp,UnsignedShort4444Type:yO,UnsignedShort5551Type:xO,UnsignedShortType:R1,VSMShadowMap:ph,Vector2:At,Vector3:be,Vector4:Ur,VectorKeyframeTrack:_M,VideoFrameTexture:h3e,VideoTexture:ele,WebGL3DRenderTarget:CDe,WebGLArrayRenderTarget:TDe,WebGLCoordinateSystem:Cc,WebGLCubeRenderTarget:Q6,WebGLRenderTarget:Qd,WebGLRenderer:Yle,WebGLUtils:$le,WebGPUCoordinateSystem:L1,WebXRController:$R,WireframeGeometry:hle,WrapAroundEnding:fM,ZeroCurvatureEnding:Zy,ZeroFactor:soe,ZeroSlopeEnding:Qy,ZeroStencilOp:LIe,createCanvasElement:joe},Symbol.toStringTag,{value:"Module"}));var eB={exports:{}},Gm={};/**
 * @license React
 * react-reconciler-constants.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var kY;function jBe(){return kY||(kY=1,Gm.ConcurrentRoot=1,Gm.ContinuousEventPriority=4,Gm.DefaultEventPriority=16,Gm.DiscreteEventPriority=1,Gm.IdleEventPriority=536870912,Gm.LegacyRoot=0),Gm}var NY;function VBe(){return NY||(NY=1,eB.exports=jBe()),eB.exports}var qw=VBe();function HBe(t){let e;const i=new Set,r=(c,u)=>{const h=typeof c=="function"?c(e):c;if(h!==e){const d=e;e=u?h:Object.assign({},e,h),i.forEach(f=>f(e,d))}},n=()=>e,s=(c,u=n,h=Object.is)=>{console.warn("[DEPRECATED] Please use `subscribeWithSelector` middleware");let d=u(e);function f(){const p=u(e);if(!h(d,p)){const g=d;c(d=p,g)}}return i.add(f),()=>i.delete(f)},l={setState:r,getState:n,subscribe:(c,u,h)=>u||h?s(c,u,h):(i.add(c),()=>i.delete(c)),destroy:()=>i.clear()};return e=t(r,n,l),l}const GBe=typeof window>"u"||!window.navigator||/ServerSideRendering|^Deno\//.test(window.navigator.userAgent),UY=GBe?J.useEffect:J.useLayoutEffect;function WBe(t){const e=typeof t=="function"?HBe(t):t,i=(r=e.getState,n=Object.is)=>{const[,s]=J.useReducer(m=>m+1,0),a=e.getState(),o=J.useRef(a),l=J.useRef(r),c=J.useRef(n),u=J.useRef(!1),h=J.useRef();h.current===void 0&&(h.current=r(a));let d,f=!1;(o.current!==a||l.current!==r||c.current!==n||u.current)&&(d=r(a),f=!n(h.current,d)),UY(()=>{f&&(h.current=d),o.current=a,l.current=r,c.current=n,u.current=!1});const p=J.useRef(a);UY(()=>{const m=()=>{try{const b=e.getState(),w=l.current(b);c.current(h.current,w)||(o.current=b,h.current=w,s())}catch{u.current=!0,s()}},y=e.subscribe(m);return e.getState()!==p.current&&m(),y},[]);const g=f?d:h.current;return J.useDebugValue(g),g};return Object.assign(i,e),i[Symbol.iterator]=function(){console.warn("[useStore, api] = create() is deprecated and will be removed in v4");const r=[i,e];return{next(){const n=r.length<=0;return{value:r.shift(),done:n}}}},i}var tB={exports:{}},iB={exports:{}},rB={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var BY;function qBe(){return BY||(BY=1,(function(t){function e(U,Y){var Z=U.length;U.push(Y);e:for(;0<Z;){var j=Z-1>>>1,ee=U[j];if(0<n(ee,Y))U[j]=Y,U[Z]=ee,Z=j;else break e}}function i(U){return U.length===0?null:U[0]}function r(U){if(U.length===0)return null;var Y=U[0],Z=U.pop();if(Z!==Y){U[0]=Z;e:for(var j=0,ee=U.length,pe=ee>>>1;j<pe;){var fe=2*(j+1)-1,se=U[fe],re=fe+1,le=U[re];if(0>n(se,Z))re<ee&&0>n(le,se)?(U[j]=le,U[re]=Z,j=re):(U[j]=se,U[fe]=Z,j=fe);else if(re<ee&&0>n(le,Z))U[j]=le,U[re]=Z,j=re;else break e}}return Y}function n(U,Y){var Z=U.sortIndex-Y.sortIndex;return Z!==0?Z:U.id-Y.id}if(typeof performance=="object"&&typeof performance.now=="function"){var s=performance;t.unstable_now=function(){return s.now()}}else{var a=Date,o=a.now();t.unstable_now=function(){return a.now()-o}}var l=[],c=[],u=1,h=null,d=3,f=!1,p=!1,g=!1,m=typeof setTimeout=="function"?setTimeout:null,y=typeof clearTimeout=="function"?clearTimeout:null,b=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function w(U){for(var Y=i(c);Y!==null;){if(Y.callback===null)r(c);else if(Y.startTime<=U)r(c),Y.sortIndex=Y.expirationTime,e(l,Y);else break;Y=i(c)}}function E(U){if(g=!1,w(U),!p)if(i(l)!==null)p=!0,K(M);else{var Y=i(c);Y!==null&&X(E,Y.startTime-U)}}function M(U,Y){p=!1,g&&(g=!1,y(C),C=-1),f=!0;var Z=d;try{for(w(Y),h=i(l);h!==null&&(!(h.expirationTime>Y)||U&&!k());){var j=h.callback;if(typeof j=="function"){h.callback=null,d=h.priorityLevel;var ee=j(h.expirationTime<=Y);Y=t.unstable_now(),typeof ee=="function"?h.callback=ee:h===i(l)&&r(l),w(Y)}else r(l);h=i(l)}if(h!==null)var pe=!0;else{var fe=i(c);fe!==null&&X(E,fe.startTime-Y),pe=!1}return pe}finally{h=null,d=Z,f=!1}}var A=!1,P=null,C=-1,R=5,I=-1;function k(){return!(t.unstable_now()-I<R)}function z(){if(P!==null){var U=t.unstable_now();I=U;var Y=!0;try{Y=P(!0,U)}finally{Y?V():(A=!1,P=null)}}else A=!1}var V;if(typeof b=="function")V=function(){b(z)};else if(typeof MessageChannel<"u"){var F=new MessageChannel,$=F.port2;F.port1.onmessage=z,V=function(){$.postMessage(null)}}else V=function(){m(z,0)};function K(U){P=U,A||(A=!0,V())}function X(U,Y){C=m(function(){U(t.unstable_now())},Y)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(U){U.callback=null},t.unstable_continueExecution=function(){p||f||(p=!0,K(M))},t.unstable_forceFrameRate=function(U){0>U||125<U?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):R=0<U?Math.floor(1e3/U):5},t.unstable_getCurrentPriorityLevel=function(){return d},t.unstable_getFirstCallbackNode=function(){return i(l)},t.unstable_next=function(U){switch(d){case 1:case 2:case 3:var Y=3;break;default:Y=d}var Z=d;d=Y;try{return U()}finally{d=Z}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(U,Y){switch(U){case 1:case 2:case 3:case 4:case 5:break;default:U=3}var Z=d;d=U;try{return Y()}finally{d=Z}},t.unstable_scheduleCallback=function(U,Y,Z){var j=t.unstable_now();switch(typeof Z=="object"&&Z!==null?(Z=Z.delay,Z=typeof Z=="number"&&0<Z?j+Z:j):Z=j,U){case 1:var ee=-1;break;case 2:ee=250;break;case 5:ee=1073741823;break;case 4:ee=1e4;break;default:ee=5e3}return ee=Z+ee,U={id:u++,callback:Y,priorityLevel:U,startTime:Z,expirationTime:ee,sortIndex:-1},Z>j?(U.sortIndex=Z,e(c,U),i(l)===null&&U===i(c)&&(g?(y(C),C=-1):g=!0,X(E,Z-j))):(U.sortIndex=ee,e(l,U),p||f||(p=!0,K(M))),U},t.unstable_shouldYield=k,t.unstable_wrapCallback=function(U){var Y=d;return function(){var Z=d;d=Y;try{return U.apply(this,arguments)}finally{d=Z}}}})(rB)),rB}var FY;function XBe(){return FY||(FY=1,iB.exports=qBe()),iB.exports}/**
 * @license React
 * react-reconciler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var nB,zY;function $Be(){return zY||(zY=1,nB=function(e){var i={},r=ZM(),n=XBe(),s=Object.assign;function a(_){for(var S="https://reactjs.org/docs/error-decoder.html?invariant="+_,D=1;D<arguments.length;D++)S+="&args[]="+encodeURIComponent(arguments[D]);return"Minified React error #"+_+"; visit "+S+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var o=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,l=Symbol.for("react.element"),c=Symbol.for("react.portal"),u=Symbol.for("react.fragment"),h=Symbol.for("react.strict_mode"),d=Symbol.for("react.profiler"),f=Symbol.for("react.provider"),p=Symbol.for("react.context"),g=Symbol.for("react.forward_ref"),m=Symbol.for("react.suspense"),y=Symbol.for("react.suspense_list"),b=Symbol.for("react.memo"),w=Symbol.for("react.lazy"),E=Symbol.for("react.offscreen"),M=Symbol.iterator;function A(_){return _===null||typeof _!="object"?null:(_=M&&_[M]||_["@@iterator"],typeof _=="function"?_:null)}function P(_){if(_==null)return null;if(typeof _=="function")return _.displayName||_.name||null;if(typeof _=="string")return _;switch(_){case u:return"Fragment";case c:return"Portal";case d:return"Profiler";case h:return"StrictMode";case m:return"Suspense";case y:return"SuspenseList"}if(typeof _=="object")switch(_.$$typeof){case p:return(_.displayName||"Context")+".Consumer";case f:return(_._context.displayName||"Context")+".Provider";case g:var S=_.render;return _=_.displayName,_||(_=S.displayName||S.name||"",_=_!==""?"ForwardRef("+_+")":"ForwardRef"),_;case b:return S=_.displayName||null,S!==null?S:P(_.type)||"Memo";case w:S=_._payload,_=_._init;try{return P(_(S))}catch{}}return null}function C(_){var S=_.type;switch(_.tag){case 24:return"Cache";case 9:return(S.displayName||"Context")+".Consumer";case 10:return(S._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return _=S.render,_=_.displayName||_.name||"",S.displayName||(_!==""?"ForwardRef("+_+")":"ForwardRef");case 7:return"Fragment";case 5:return S;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return P(S);case 8:return S===h?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof S=="function")return S.displayName||S.name||null;if(typeof S=="string")return S}return null}function R(_){var S=_,D=_;if(_.alternate)for(;S.return;)S=S.return;else{_=S;do S=_,(S.flags&4098)!==0&&(D=S.return),_=S.return;while(_)}return S.tag===3?D:null}function I(_){if(R(_)!==_)throw Error(a(188))}function k(_){var S=_.alternate;if(!S){if(S=R(_),S===null)throw Error(a(188));return S!==_?null:_}for(var D=_,N=S;;){var H=D.return;if(H===null)break;var ie=H.alternate;if(ie===null){if(N=H.return,N!==null){D=N;continue}break}if(H.child===ie.child){for(ie=H.child;ie;){if(ie===D)return I(H),_;if(ie===N)return I(H),S;ie=ie.sibling}throw Error(a(188))}if(D.return!==N.return)D=H,N=ie;else{for(var Ee=!1,Ge=H.child;Ge;){if(Ge===D){Ee=!0,D=H,N=ie;break}if(Ge===N){Ee=!0,N=H,D=ie;break}Ge=Ge.sibling}if(!Ee){for(Ge=ie.child;Ge;){if(Ge===D){Ee=!0,D=ie,N=H;break}if(Ge===N){Ee=!0,N=ie,D=H;break}Ge=Ge.sibling}if(!Ee)throw Error(a(189))}}if(D.alternate!==N)throw Error(a(190))}if(D.tag!==3)throw Error(a(188));return D.stateNode.current===D?_:S}function z(_){return _=k(_),_!==null?V(_):null}function V(_){if(_.tag===5||_.tag===6)return _;for(_=_.child;_!==null;){var S=V(_);if(S!==null)return S;_=_.sibling}return null}function F(_){if(_.tag===5||_.tag===6)return _;for(_=_.child;_!==null;){if(_.tag!==4){var S=F(_);if(S!==null)return S}_=_.sibling}return null}var $=Array.isArray,K=e.getPublicInstance,X=e.getRootHostContext,U=e.getChildHostContext,Y=e.prepareForCommit,Z=e.resetAfterCommit,j=e.createInstance,ee=e.appendInitialChild,pe=e.finalizeInitialChildren,fe=e.prepareUpdate,se=e.shouldSetTextContent,re=e.createTextInstance,le=e.scheduleTimeout,he=e.cancelTimeout,ve=e.noTimeout,xe=e.isPrimaryRenderer,Se=e.supportsMutation,Ce=e.supportsPersistence,ce=e.supportsHydration,Fe=e.getInstanceFromNode,De=e.preparePortalMount,He=e.getCurrentEventPriority,Be=e.detachDeletedInstance,$e=e.supportsMicrotasks,ze=e.scheduleMicrotask,it=e.supportsTestSelectors,wt=e.findFiberRoot,ge=e.getBoundingRect,G=e.getTextContent,Q=e.isHiddenSubtree,we=e.matchAccessibilityRole,te=e.setFocusIfFocusable,Ne=e.setupIntersectionObserver,Le=e.appendChild,at=e.appendChildToContainer,Te=e.commitTextUpdate,dt=e.commitMount,ot=e.commitUpdate,Qe=e.insertBefore,pt=e.insertInContainerBefore,_t=e.removeChild,yt=e.removeChildFromContainer,Et=e.resetTextContent,$t=e.hideInstance,oe=e.hideTextInstance,Re=e.unhideInstance,ke=e.unhideTextInstance,st=e.clearContainer,rt=e.cloneInstance,je=e.createContainerChildSet,Tt=e.appendChildToContainerChildSet,Ft=e.finalizeContainerChildren,wi=e.replaceContainerChildren,ti=e.cloneHiddenInstance,Zi=e.cloneHiddenTextInstance,Xi=e.canHydrateInstance,As=e.canHydrateTextInstance,Gr=e.canHydrateSuspenseInstance,Nn=e.isSuspenseInstancePending,us=e.isSuspenseInstanceFallback,ye=e.registerSuspenseInstanceRetry,Xe=e.getNextHydratableSibling,ht=e.getFirstHydratableChild,qe=e.getFirstHydratableChildWithinContainer,gt=e.getFirstHydratableChildWithinSuspenseInstance,Zt=e.hydrateInstance,yi=e.hydrateTextInstance,Ti=e.hydrateSuspenseInstance,fi=e.getNextHydratableInstanceAfterSuspenseInstance,vr=e.commitHydratedContainer,ji=e.commitHydratedSuspenseInstance,Vi=e.clearSuspenseBoundary,de=e.clearSuspenseBoundaryFromContainer,Ue=e.shouldDeleteUnhydratedTailInstances,Je=e.didNotMatchHydratedContainerTextInstance,nt=e.didNotMatchHydratedTextInstance,Ie;function ft(_){if(Ie===void 0)try{throw Error()}catch(D){var S=D.stack.trim().match(/\n( *(at )?)/);Ie=S&&S[1]||""}return`
`+Ie+_}var Dt=!1;function Mt(_,S){if(!_||Dt)return"";Dt=!0;var D=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(S)if(S=function(){throw Error()},Object.defineProperty(S.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(S,[])}catch(Ot){var N=Ot}Reflect.construct(_,[],S)}else{try{S.call()}catch(Ot){N=Ot}_.call(S.prototype)}else{try{throw Error()}catch(Ot){N=Ot}_()}}catch(Ot){if(Ot&&N&&typeof Ot.stack=="string"){for(var H=Ot.stack.split(`
`),ie=N.stack.split(`
`),Ee=H.length-1,Ge=ie.length-1;1<=Ee&&0<=Ge&&H[Ee]!==ie[Ge];)Ge--;for(;1<=Ee&&0<=Ge;Ee--,Ge--)if(H[Ee]!==ie[Ge]){if(Ee!==1||Ge!==1)do if(Ee--,Ge--,0>Ge||H[Ee]!==ie[Ge]){var vt=`
`+H[Ee].replace(" at new "," at ");return _.displayName&&vt.includes("<anonymous>")&&(vt=vt.replace("<anonymous>",_.displayName)),vt}while(1<=Ee&&0<=Ge);break}}}finally{Dt=!1,Error.prepareStackTrace=D}return(_=_?_.displayName||_.name:"")?ft(_):""}var Vt=Object.prototype.hasOwnProperty,di=[],si=-1;function Wt(_){return{current:_}}function ne(_){0>si||(_.current=di[si],di[si]=null,si--)}function ae(_,S){si++,di[si]=_.current,_.current=S}var _e={},me=Wt(_e),Pe=Wt(!1),Ze=_e;function Qi(_,S){var D=_.type.contextTypes;if(!D)return _e;var N=_.stateNode;if(N&&N.__reactInternalMemoizedUnmaskedChildContext===S)return N.__reactInternalMemoizedMaskedChildContext;var H={},ie;for(ie in D)H[ie]=S[ie];return N&&(_=_.stateNode,_.__reactInternalMemoizedUnmaskedChildContext=S,_.__reactInternalMemoizedMaskedChildContext=H),H}function _i(_){return _=_.childContextTypes,_!=null}function nn(){ne(Pe),ne(me)}function Sa(_,S,D){if(me.current!==_e)throw Error(a(168));ae(me,S),ae(Pe,D)}function Hn(_,S,D){var N=_.stateNode;if(S=S.childContextTypes,typeof N.getChildContext!="function")return D;N=N.getChildContext();for(var H in N)if(!(H in S))throw Error(a(108,C(_)||"Unknown",H));return s({},D,N)}function Eo(_){return _=(_=_.stateNode)&&_.__reactInternalMemoizedMergedChildContext||_e,Ze=me.current,ae(me,_),ae(Pe,Pe.current),!0}function $r(_,S,D){var N=_.stateNode;if(!N)throw Error(a(169));D?(_=Hn(_,S,Ze),N.__reactInternalMemoizedMergedChildContext=_,ne(Pe),ne(me),ae(me,_)):ne(Pe),ae(Pe,D)}var bn=Math.clz32?Math.clz32:Aa,Ea=Math.log,Gn=Math.LN2;function Aa(_){return _>>>=0,_===0?32:31-(Ea(_)/Gn|0)|0}var Fc=64,cr=4194304;function im(_){switch(_&-_){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return _&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return _&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return _}}function bv(_,S){var D=_.pendingLanes;if(D===0)return 0;var N=0,H=_.suspendedLanes,ie=_.pingedLanes,Ee=D&268435455;if(Ee!==0){var Ge=Ee&~H;Ge!==0?N=im(Ge):(ie&=Ee,ie!==0&&(N=im(ie)))}else Ee=D&~H,Ee!==0?N=im(Ee):ie!==0&&(N=im(ie));if(N===0)return 0;if(S!==0&&S!==N&&(S&H)===0&&(H=N&-N,ie=S&-S,H>=ie||H===16&&(ie&4194240)!==0))return S;if((N&4)!==0&&(N|=D&16),S=_.entangledLanes,S!==0)for(_=_.entanglements,S&=N;0<S;)D=31-bn(S),H=1<<D,N|=_[D],S&=~H;return N}function z_(_,S){switch(_){case 1:case 2:case 4:return S+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return S+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function $T(_,S){for(var D=_.suspendedLanes,N=_.pingedLanes,H=_.expirationTimes,ie=_.pendingLanes;0<ie;){var Ee=31-bn(ie),Ge=1<<Ee,vt=H[Ee];vt===-1?((Ge&D)===0||(Ge&N)!==0)&&(H[Ee]=z_(Ge,S)):vt<=S&&(_.expiredLanes|=Ge),ie&=~Ge}}function ex(_){return _=_.pendingLanes&-1073741825,_!==0?_:_&1073741824?1073741824:0}function tx(_){for(var S=[],D=0;31>D;D++)S.push(_);return S}function df(_,S,D){_.pendingLanes|=S,S!==536870912&&(_.suspendedLanes=0,_.pingedLanes=0),_=_.eventTimes,S=31-bn(S),_[S]=D}function ix(_,S){var D=_.pendingLanes&~S;_.pendingLanes=S,_.suspendedLanes=0,_.pingedLanes=0,_.expiredLanes&=S,_.mutableReadLanes&=S,_.entangledLanes&=S,S=_.entanglements;var N=_.eventTimes;for(_=_.expirationTimes;0<D;){var H=31-bn(D),ie=1<<H;S[H]=0,N[H]=-1,_[H]=-1,D&=~ie}}function zc(_,S){var D=_.entangledLanes|=S;for(_=_.entanglements;D;){var N=31-bn(D),H=1<<N;H&S|_[N]&S&&(_[N]|=S),D&=~H}}var fr=0;function Mu(_){return _&=-_,1<_?4<_?(_&268435455)!==0?16:536870912:4:1}var ff=n.unstable_scheduleCallback,rm=n.unstable_cancelCallback,zh=n.unstable_shouldYield,kL=n.unstable_requestPaint,hs=n.unstable_now,pf=n.unstable_ImmediatePriority,NL=n.unstable_UserBlockingPriority,rx=n.unstable_NormalPriority,nx=n.unstable_IdlePriority,wv=null,jc=null;function _v(_){if(jc&&typeof jc.onCommitFiberRoot=="function")try{jc.onCommitFiberRoot(wv,_,void 0,(_.current.flags&128)===128)}catch{}}function Sv(_,S){return _===S&&(_!==0||1/_===1/S)||_!==_&&S!==S}var Ja=typeof Object.is=="function"?Object.is:Sv,Al=null,sx=!1,j_=!1;function ax(_){Al===null?Al=[_]:Al.push(_)}function ox(_){sx=!0,ax(_)}function Ml(){if(!j_&&Al!==null){j_=!0;var _=0,S=fr;try{var D=Al;for(fr=1;_<D.length;_++){var N=D[_];do N=N(!0);while(N!==null)}Al=null,sx=!1}catch(H){throw Al!==null&&(Al=Al.slice(_+1)),ff(pf,Ml),H}finally{fr=S,j_=!1}}return null}var YT=o.ReactCurrentBatchConfig;function hc(_,S){if(Ja(_,S))return!0;if(typeof _!="object"||_===null||typeof S!="object"||S===null)return!1;var D=Object.keys(_),N=Object.keys(S);if(D.length!==N.length)return!1;for(N=0;N<D.length;N++){var H=D[N];if(!Vt.call(S,H)||!Ja(_[H],S[H]))return!1}return!0}function V_(_){switch(_.tag){case 5:return ft(_.type);case 16:return ft("Lazy");case 13:return ft("Suspense");case 19:return ft("SuspenseList");case 0:case 2:case 15:return _=Mt(_.type,!1),_;case 11:return _=Mt(_.type.render,!1),_;case 1:return _=Mt(_.type,!0),_;default:return""}}function Ao(_,S){if(_&&_.defaultProps){S=s({},S),_=_.defaultProps;for(var D in _)S[D]===void 0&&(S[D]=_[D]);return S}return S}var Ev=Wt(null),mf=null,Tu=null,lx=null;function eo(){lx=Tu=mf=null}function gf(_,S,D){xe?(ae(Ev,S._currentValue),S._currentValue=D):(ae(Ev,S._currentValue2),S._currentValue2=D)}function Av(_){var S=Ev.current;ne(Ev),xe?_._currentValue=S:_._currentValue2=S}function vf(_,S,D){for(;_!==null;){var N=_.alternate;if((_.childLanes&S)!==S?(_.childLanes|=S,N!==null&&(N.childLanes|=S)):N!==null&&(N.childLanes&S)!==S&&(N.childLanes|=S),_===D)break;_=_.return}}function nm(_,S){mf=_,lx=Tu=null,_=_.dependencies,_!==null&&_.firstContext!==null&&((_.lanes&S)!==0&&(Ps=!0),_.firstContext=null)}function Mo(_){var S=xe?_._currentValue:_._currentValue2;if(lx!==_)if(_={context:_,memoizedValue:S,next:null},Tu===null){if(mf===null)throw Error(a(308));Tu=_,mf.dependencies={lanes:0,firstContext:_}}else Tu=Tu.next=_;return S}var Tl=null,Cl=!1;function sm(_){_.updateQueue={baseState:_.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function H_(_,S){_=_.updateQueue,S.updateQueue===_&&(S.updateQueue={baseState:_.baseState,firstBaseUpdate:_.firstBaseUpdate,lastBaseUpdate:_.lastBaseUpdate,shared:_.shared,effects:_.effects})}function Cu(_,S){return{eventTime:_,lane:S,tag:0,payload:null,callback:null,next:null}}function jh(_,S){var D=_.updateQueue;D!==null&&(D=D.shared,qn!==null&&(_.mode&1)!==0&&(sr&2)===0?(_=D.interleaved,_===null?(S.next=S,Tl===null?Tl=[D]:Tl.push(D)):(S.next=_.next,_.next=S),D.interleaved=S):(_=D.pending,_===null?S.next=S:(S.next=_.next,_.next=S),D.pending=S))}function cx(_,S,D){if(S=S.updateQueue,S!==null&&(S=S.shared,(D&4194240)!==0)){var N=S.lanes;N&=_.pendingLanes,D|=N,S.lanes=D,zc(_,D)}}function ux(_,S){var D=_.updateQueue,N=_.alternate;if(N!==null&&(N=N.updateQueue,D===N)){var H=null,ie=null;if(D=D.firstBaseUpdate,D!==null){do{var Ee={eventTime:D.eventTime,lane:D.lane,tag:D.tag,payload:D.payload,callback:D.callback,next:null};ie===null?H=ie=Ee:ie=ie.next=Ee,D=D.next}while(D!==null);ie===null?H=ie=S:ie=ie.next=S}else H=ie=S;D={baseState:N.baseState,firstBaseUpdate:H,lastBaseUpdate:ie,shared:N.shared,effects:N.effects},_.updateQueue=D;return}_=D.lastBaseUpdate,_===null?D.firstBaseUpdate=S:_.next=S,D.lastBaseUpdate=S}function hx(_,S,D,N){var H=_.updateQueue;Cl=!1;var ie=H.firstBaseUpdate,Ee=H.lastBaseUpdate,Ge=H.shared.pending;if(Ge!==null){H.shared.pending=null;var vt=Ge,Ot=vt.next;vt.next=null,Ee===null?ie=Ot:Ee.next=Ot,Ee=vt;var ri=_.alternate;ri!==null&&(ri=ri.updateQueue,Ge=ri.lastBaseUpdate,Ge!==Ee&&(Ge===null?ri.firstBaseUpdate=Ot:Ge.next=Ot,ri.lastBaseUpdate=vt))}if(ie!==null){var $i=H.baseState;Ee=0,ri=Ot=vt=null,Ge=ie;do{var Ci=Ge.lane,ur=Ge.eventTime;if((N&Ci)===Ci){ri!==null&&(ri=ri.next={eventTime:ur,lane:0,tag:Ge.tag,payload:Ge.payload,callback:Ge.callback,next:null});e:{var Yt=_,Js=Ge;switch(Ci=S,ur=D,Js.tag){case 1:if(Yt=Js.payload,typeof Yt=="function"){$i=Yt.call(ur,$i,Ci);break e}$i=Yt;break e;case 3:Yt.flags=Yt.flags&-65537|128;case 0:if(Yt=Js.payload,Ci=typeof Yt=="function"?Yt.call(ur,$i,Ci):Yt,Ci==null)break e;$i=s({},$i,Ci);break e;case 2:Cl=!0}}Ge.callback!==null&&Ge.lane!==0&&(_.flags|=64,Ci=H.effects,Ci===null?H.effects=[Ge]:Ci.push(Ge))}else ur={eventTime:ur,lane:Ci,tag:Ge.tag,payload:Ge.payload,callback:Ge.callback,next:null},ri===null?(Ot=ri=ur,vt=$i):ri=ri.next=ur,Ee|=Ci;if(Ge=Ge.next,Ge===null){if(Ge=H.shared.pending,Ge===null)break;Ci=Ge,Ge=Ci.next,Ci.next=null,H.lastBaseUpdate=Ci,H.shared.pending=null}}while(!0);if(ri===null&&(vt=$i),H.baseState=vt,H.firstBaseUpdate=Ot,H.lastBaseUpdate=ri,S=H.shared.interleaved,S!==null){H=S;do Ee|=H.lane,H=H.next;while(H!==S)}else ie===null&&(H.shared.lanes=0);Wc|=Ee,_.lanes=Ee,_.memoizedState=$i}}function KT(_,S,D){if(_=S.effects,S.effects=null,_!==null)for(S=0;S<_.length;S++){var N=_[S],H=N.callback;if(H!==null){if(N.callback=null,N=D,typeof H!="function")throw Error(a(191,H));H.call(N)}}}var ZT=new r.Component().refs;function G_(_,S,D,N){S=_.memoizedState,D=D(N,S),D=D==null?S:s({},S,D),_.memoizedState=D,_.lanes===0&&(_.updateQueue.baseState=D)}var dx={isMounted:function(_){return(_=_._reactInternals)?R(_)===_:!1},enqueueSetState:function(_,S,D){_=_._reactInternals;var N=Ir(),H=yc(_),ie=Cu(N,H);ie.payload=S,D!=null&&(ie.callback=D),jh(_,ie),S=Ca(_,H,N),S!==null&&cx(S,_,H)},enqueueReplaceState:function(_,S,D){_=_._reactInternals;var N=Ir(),H=yc(_),ie=Cu(N,H);ie.tag=1,ie.payload=S,D!=null&&(ie.callback=D),jh(_,ie),S=Ca(_,H,N),S!==null&&cx(S,_,H)},enqueueForceUpdate:function(_,S){_=_._reactInternals;var D=Ir(),N=yc(_),H=Cu(D,N);H.tag=2,S!=null&&(H.callback=S),jh(_,H),S=Ca(_,N,D),S!==null&&cx(S,_,N)}};function W_(_,S,D,N,H,ie,Ee){return _=_.stateNode,typeof _.shouldComponentUpdate=="function"?_.shouldComponentUpdate(N,ie,Ee):S.prototype&&S.prototype.isPureReactComponent?!hc(D,N)||!hc(H,ie):!0}function QT(_,S,D){var N=!1,H=_e,ie=S.contextType;return typeof ie=="object"&&ie!==null?ie=Mo(ie):(H=_i(S)?Ze:me.current,N=S.contextTypes,ie=(N=N!=null)?Qi(_,H):_e),S=new S(D,ie),_.memoizedState=S.state!==null&&S.state!==void 0?S.state:null,S.updater=dx,_.stateNode=S,S._reactInternals=_,N&&(_=_.stateNode,_.__reactInternalMemoizedUnmaskedChildContext=H,_.__reactInternalMemoizedMaskedChildContext=ie),S}function JT(_,S,D,N){_=S.state,typeof S.componentWillReceiveProps=="function"&&S.componentWillReceiveProps(D,N),typeof S.UNSAFE_componentWillReceiveProps=="function"&&S.UNSAFE_componentWillReceiveProps(D,N),S.state!==_&&dx.enqueueReplaceState(S,S.state,null)}function q_(_,S,D,N){var H=_.stateNode;H.props=D,H.state=_.memoizedState,H.refs=ZT,sm(_);var ie=S.contextType;typeof ie=="object"&&ie!==null?H.context=Mo(ie):(ie=_i(S)?Ze:me.current,H.context=Qi(_,ie)),H.state=_.memoizedState,ie=S.getDerivedStateFromProps,typeof ie=="function"&&(G_(_,S,ie,D),H.state=_.memoizedState),typeof S.getDerivedStateFromProps=="function"||typeof H.getSnapshotBeforeUpdate=="function"||typeof H.UNSAFE_componentWillMount!="function"&&typeof H.componentWillMount!="function"||(S=H.state,typeof H.componentWillMount=="function"&&H.componentWillMount(),typeof H.UNSAFE_componentWillMount=="function"&&H.UNSAFE_componentWillMount(),S!==H.state&&dx.enqueueReplaceState(H,H.state,null),hx(_,D,H,N),H.state=_.memoizedState),typeof H.componentDidMount=="function"&&(_.flags|=4194308)}var am=[],Vh=0,fx=null,px=0,Pl=[],qo=0,yf=null,Pu=1,Ru="";function xf(_,S){am[Vh++]=px,am[Vh++]=fx,fx=_,px=S}function eC(_,S,D){Pl[qo++]=Pu,Pl[qo++]=Ru,Pl[qo++]=yf,yf=_;var N=Pu;_=Ru;var H=32-bn(N)-1;N&=~(1<<H),D+=1;var ie=32-bn(S)+H;if(30<ie){var Ee=H-H%5;ie=(N&(1<<Ee)-1).toString(32),N>>=Ee,H-=Ee,Pu=1<<32-bn(S)+H|D<<H|N,Ru=ie+_}else Pu=1<<ie|D<<H|N,Ru=_}function X_(_){_.return!==null&&(xf(_,1),eC(_,1,0))}function $_(_){for(;_===fx;)fx=am[--Vh],am[Vh]=null,px=am[--Vh],am[Vh]=null;for(;_===yf;)yf=Pl[--qo],Pl[qo]=null,Ru=Pl[--qo],Pl[qo]=null,Pu=Pl[--qo],Pl[qo]=null}var to=null,$s=null,An=!1,om=!1,Rl=null;function Y_(_,S){var D=Jo(5,null,null,0);D.elementType="DELETED",D.stateNode=S,D.return=_,S=_.deletions,S===null?(_.deletions=[D],_.flags|=16):S.push(D)}function K_(_,S){switch(_.tag){case 5:return S=Xi(S,_.type,_.pendingProps),S!==null?(_.stateNode=S,to=_,$s=ht(S),!0):!1;case 6:return S=As(S,_.pendingProps),S!==null?(_.stateNode=S,to=_,$s=null,!0):!1;case 13:if(S=Gr(S),S!==null){var D=yf!==null?{id:Pu,overflow:Ru}:null;return _.memoizedState={dehydrated:S,treeContext:D,retryLane:1073741824},D=Jo(18,null,null,0),D.stateNode=S,D.return=_,_.child=D,to=_,$s=null,!0}return!1;default:return!1}}function mx(_){return(_.mode&1)!==0&&(_.flags&128)===0}function Hh(_){if(An){var S=$s;if(S){var D=S;if(!K_(_,S)){if(mx(_))throw Error(a(418));S=Xe(D);var N=to;S&&K_(_,S)?Y_(N,D):(_.flags=_.flags&-4097|2,An=!1,to=_)}}else{if(mx(_))throw Error(a(418));_.flags=_.flags&-4097|2,An=!1,to=_}}}function tC(_){for(_=_.return;_!==null&&_.tag!==5&&_.tag!==3&&_.tag!==13;)_=_.return;to=_}function Mv(_){if(!ce||_!==to)return!1;if(!An)return tC(_),An=!0,!1;if(_.tag!==3&&(_.tag!==5||Ue(_.type)&&!se(_.type,_.memoizedProps))){var S=$s;if(S){if(mx(_)){for(_=$s;_;)_=Xe(_);throw Error(a(418))}for(;S;)Y_(_,S),S=Xe(S)}}if(tC(_),_.tag===13){if(!ce)throw Error(a(316));if(_=_.memoizedState,_=_!==null?_.dehydrated:null,!_)throw Error(a(317));$s=fi(_)}else $s=to?Xe(_.stateNode):null;return!0}function lm(){ce&&($s=to=null,om=An=!1)}function gx(_){Rl===null?Rl=[_]:Rl.push(_)}function cm(_,S,D){if(_=D.ref,_!==null&&typeof _!="function"&&typeof _!="object"){if(D._owner){if(D=D._owner,D){if(D.tag!==1)throw Error(a(309));var N=D.stateNode}if(!N)throw Error(a(147,_));var H=N,ie=""+_;return S!==null&&S.ref!==null&&typeof S.ref=="function"&&S.ref._stringRef===ie?S.ref:(S=function(Ee){var Ge=H.refs;Ge===ZT&&(Ge=H.refs={}),Ee===null?delete Ge[ie]:Ge[ie]=Ee},S._stringRef=ie,S)}if(typeof _!="string")throw Error(a(284));if(!D._owner)throw Error(a(290,_))}return _}function Gh(_,S){throw _=Object.prototype.toString.call(S),Error(a(31,_==="[object Object]"?"object with keys {"+Object.keys(S).join(", ")+"}":_))}function um(_){var S=_._init;return S(_._payload)}function iC(_){function S(tt,We){if(_){var ut=tt.deletions;ut===null?(tt.deletions=[We],tt.flags|=16):ut.push(We)}}function D(tt,We){if(!_)return null;for(;We!==null;)S(tt,We),We=We.sibling;return null}function N(tt,We){for(tt=new Map;We!==null;)We.key!==null?tt.set(We.key,We):tt.set(We.index,We),We=We.sibling;return tt}function H(tt,We){return tt=Gu(tt,We),tt.index=0,tt.sibling=null,tt}function ie(tt,We,ut){return tt.index=ut,_?(ut=tt.alternate,ut!==null?(ut=ut.index,ut<We?(tt.flags|=2,We):ut):(tt.flags|=2,We)):(tt.flags|=1048576,We)}function Ee(tt){return _&&tt.alternate===null&&(tt.flags|=2),tt}function Ge(tt,We,ut,qt){return We===null||We.tag!==6?(We=Hx(ut,tt.mode,qt),We.return=tt,We):(We=H(We,ut),We.return=tt,We)}function vt(tt,We,ut,qt){var vi=ut.type;return vi===u?ri(tt,We,ut.props.children,qt,ut.key):We!==null&&(We.elementType===vi||typeof vi=="object"&&vi!==null&&vi.$$typeof===w&&um(vi)===We.type)?(qt=H(We,ut.props),qt.ref=cm(tt,We,ut),qt.return=tt,qt):(qt=Vx(ut.type,ut.key,ut.props,null,tt.mode,qt),qt.ref=cm(tt,We,ut),qt.return=tt,qt)}function Ot(tt,We,ut,qt){return We===null||We.tag!==4||We.stateNode.containerInfo!==ut.containerInfo||We.stateNode.implementation!==ut.implementation?(We=Gx(ut,tt.mode,qt),We.return=tt,We):(We=H(We,ut.children||[]),We.return=tt,We)}function ri(tt,We,ut,qt,vi){return We===null||We.tag!==7?(We=jf(ut,tt.mode,qt,vi),We.return=tt,We):(We=H(We,ut),We.return=tt,We)}function $i(tt,We,ut){if(typeof We=="string"&&We!==""||typeof We=="number")return We=Hx(""+We,tt.mode,ut),We.return=tt,We;if(typeof We=="object"&&We!==null){switch(We.$$typeof){case l:return ut=Vx(We.type,We.key,We.props,null,tt.mode,ut),ut.ref=cm(tt,null,We),ut.return=tt,ut;case c:return We=Gx(We,tt.mode,ut),We.return=tt,We;case w:var qt=We._init;return $i(tt,qt(We._payload),ut)}if($(We)||A(We))return We=jf(We,tt.mode,ut,null),We.return=tt,We;Gh(tt,We)}return null}function Ci(tt,We,ut,qt){var vi=We!==null?We.key:null;if(typeof ut=="string"&&ut!==""||typeof ut=="number")return vi!==null?null:Ge(tt,We,""+ut,qt);if(typeof ut=="object"&&ut!==null){switch(ut.$$typeof){case l:return ut.key===vi?vt(tt,We,ut,qt):null;case c:return ut.key===vi?Ot(tt,We,ut,qt):null;case w:return vi=ut._init,Ci(tt,We,vi(ut._payload),qt)}if($(ut)||A(ut))return vi!==null?null:ri(tt,We,ut,qt,null);Gh(tt,ut)}return null}function ur(tt,We,ut,qt,vi){if(typeof qt=="string"&&qt!==""||typeof qt=="number")return tt=tt.get(ut)||null,Ge(We,tt,""+qt,vi);if(typeof qt=="object"&&qt!==null){switch(qt.$$typeof){case l:return tt=tt.get(qt.key===null?ut:qt.key)||null,vt(We,tt,qt,vi);case c:return tt=tt.get(qt.key===null?ut:qt.key)||null,Ot(We,tt,qt,vi);case w:var tr=qt._init;return ur(tt,We,ut,tr(qt._payload),vi)}if($(qt)||A(qt))return tt=tt.get(ut)||null,ri(We,tt,qt,vi,null);Gh(We,qt)}return null}function Yt(tt,We,ut,qt){for(var vi=null,tr=null,Yi=We,Cr=We=0,Qn=null;Yi!==null&&Cr<ut.length;Cr++){Yi.index>Cr?(Qn=Yi,Yi=null):Qn=Yi.sibling;var Ar=Ci(tt,Yi,ut[Cr],qt);if(Ar===null){Yi===null&&(Yi=Qn);break}_&&Yi&&Ar.alternate===null&&S(tt,Yi),We=ie(Ar,We,Cr),tr===null?vi=Ar:tr.sibling=Ar,tr=Ar,Yi=Qn}if(Cr===ut.length)return D(tt,Yi),An&&xf(tt,Cr),vi;if(Yi===null){for(;Cr<ut.length;Cr++)Yi=$i(tt,ut[Cr],qt),Yi!==null&&(We=ie(Yi,We,Cr),tr===null?vi=Yi:tr.sibling=Yi,tr=Yi);return An&&xf(tt,Cr),vi}for(Yi=N(tt,Yi);Cr<ut.length;Cr++)Qn=ur(Yi,tt,Cr,ut[Cr],qt),Qn!==null&&(_&&Qn.alternate!==null&&Yi.delete(Qn.key===null?Cr:Qn.key),We=ie(Qn,We,Cr),tr===null?vi=Qn:tr.sibling=Qn,tr=Qn);return _&&Yi.forEach(function(Wu){return S(tt,Wu)}),An&&xf(tt,Cr),vi}function Js(tt,We,ut,qt){var vi=A(ut);if(typeof vi!="function")throw Error(a(150));if(ut=vi.call(ut),ut==null)throw Error(a(151));for(var tr=vi=null,Yi=We,Cr=We=0,Qn=null,Ar=ut.next();Yi!==null&&!Ar.done;Cr++,Ar=ut.next()){Yi.index>Cr?(Qn=Yi,Yi=null):Qn=Yi.sibling;var Wu=Ci(tt,Yi,Ar.value,qt);if(Wu===null){Yi===null&&(Yi=Qn);break}_&&Yi&&Wu.alternate===null&&S(tt,Yi),We=ie(Wu,We,Cr),tr===null?vi=Wu:tr.sibling=Wu,tr=Wu,Yi=Qn}if(Ar.done)return D(tt,Yi),An&&xf(tt,Cr),vi;if(Yi===null){for(;!Ar.done;Cr++,Ar=ut.next())Ar=$i(tt,Ar.value,qt),Ar!==null&&(We=ie(Ar,We,Cr),tr===null?vi=Ar:tr.sibling=Ar,tr=Ar);return An&&xf(tt,Cr),vi}for(Yi=N(tt,Yi);!Ar.done;Cr++,Ar=ut.next())Ar=ur(Yi,tt,Cr,Ar.value,qt),Ar!==null&&(_&&Ar.alternate!==null&&Yi.delete(Ar.key===null?Cr:Ar.key),We=ie(Ar,We,Cr),tr===null?vi=Ar:tr.sibling=Ar,tr=Ar);return _&&Yi.forEach(function(TS){return S(tt,TS)}),An&&xf(tt,Cr),vi}function el(tt,We,ut,qt){if(typeof ut=="object"&&ut!==null&&ut.type===u&&ut.key===null&&(ut=ut.props.children),typeof ut=="object"&&ut!==null){switch(ut.$$typeof){case l:e:{for(var vi=ut.key,tr=We;tr!==null;){if(tr.key===vi){if(vi=ut.type,vi===u){if(tr.tag===7){D(tt,tr.sibling),We=H(tr,ut.props.children),We.return=tt,tt=We;break e}}else if(tr.elementType===vi||typeof vi=="object"&&vi!==null&&vi.$$typeof===w&&um(vi)===tr.type){D(tt,tr.sibling),We=H(tr,ut.props),We.ref=cm(tt,tr,ut),We.return=tt,tt=We;break e}D(tt,tr);break}else S(tt,tr);tr=tr.sibling}ut.type===u?(We=jf(ut.props.children,tt.mode,qt,ut.key),We.return=tt,tt=We):(qt=Vx(ut.type,ut.key,ut.props,null,tt.mode,qt),qt.ref=cm(tt,We,ut),qt.return=tt,tt=qt)}return Ee(tt);case c:e:{for(tr=ut.key;We!==null;){if(We.key===tr)if(We.tag===4&&We.stateNode.containerInfo===ut.containerInfo&&We.stateNode.implementation===ut.implementation){D(tt,We.sibling),We=H(We,ut.children||[]),We.return=tt,tt=We;break e}else{D(tt,We);break}else S(tt,We);We=We.sibling}We=Gx(ut,tt.mode,qt),We.return=tt,tt=We}return Ee(tt);case w:return tr=ut._init,el(tt,We,tr(ut._payload),qt)}if($(ut))return Yt(tt,We,ut,qt);if(A(ut))return Js(tt,We,ut,qt);Gh(tt,ut)}return typeof ut=="string"&&ut!==""||typeof ut=="number"?(ut=""+ut,We!==null&&We.tag===6?(D(tt,We.sibling),We=H(We,ut),We.return=tt,tt=We):(D(tt,We),We=Hx(ut,tt.mode,qt),We.return=tt,tt=We),Ee(tt)):D(tt,We)}return el}var Iu=iC(!0),rC=iC(!1),hm={},To=Wt(hm),bf=Wt(hm),wf=Wt(hm);function dc(_){if(_===hm)throw Error(a(174));return _}function vx(_,S){ae(wf,S),ae(bf,_),ae(To,hm),_=X(S),ne(To),ae(To,_)}function dm(){ne(To),ne(bf),ne(wf)}function nC(_){var S=dc(wf.current),D=dc(To.current);S=U(D,_.type,S),D!==S&&(ae(bf,_),ae(To,S))}function Z_(_){bf.current===_&&(ne(To),ne(bf))}var In=Wt(0);function yx(_){for(var S=_;S!==null;){if(S.tag===13){var D=S.memoizedState;if(D!==null&&(D=D.dehydrated,D===null||Nn(D)||us(D)))return S}else if(S.tag===19&&S.memoizedProps.revealOrder!==void 0){if((S.flags&128)!==0)return S}else if(S.child!==null){S.child.return=S,S=S.child;continue}if(S===_)break;for(;S.sibling===null;){if(S.return===null||S.return===_)return null;S=S.return}S.sibling.return=S.return,S=S.sibling}return null}var Xo=[];function _f(){for(var _=0;_<Xo.length;_++){var S=Xo[_];xe?S._workInProgressVersionPrimary=null:S._workInProgressVersionSecondary=null}Xo.length=0}var Tv=o.ReactCurrentDispatcher,$o=o.ReactCurrentBatchConfig,Sf=0,Dn=null,Ms=null,Ts=null,xx=!1,Vc=!1,Ef=0,Cv=0;function Cs(){throw Error(a(321))}function bx(_,S){if(S===null)return!1;for(var D=0;D<S.length&&D<_.length;D++)if(!Ja(_[D],S[D]))return!1;return!0}function fm(_,S,D,N,H,ie){if(Sf=ie,Dn=S,S.memoizedState=null,S.updateQueue=null,S.lanes=0,Tv.current=_===null||_.memoizedState===null?rS:nS,_=D(N,H),Vc){ie=0;do{if(Vc=!1,Ef=0,25<=ie)throw Error(a(301));ie+=1,Ts=Ms=null,S.updateQueue=null,Tv.current=sS,_=D(N,H)}while(Vc)}if(Tv.current=vm,S=Ms!==null&&Ms.next!==null,Sf=0,Ts=Ms=Dn=null,xx=!1,S)throw Error(a(300));return _}function Wh(){var _=Ef!==0;return Ef=0,_}function fc(){var _={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Ts===null?Dn.memoizedState=Ts=_:Ts=Ts.next=_,Ts}function pc(){if(Ms===null){var _=Dn.alternate;_=_!==null?_.memoizedState:null}else _=Ms.next;var S=Ts===null?Dn.memoizedState:Ts.next;if(S!==null)Ts=S,Ms=_;else{if(_===null)throw Error(a(310));Ms=_,_={memoizedState:Ms.memoizedState,baseState:Ms.baseState,baseQueue:Ms.baseQueue,queue:Ms.queue,next:null},Ts===null?Dn.memoizedState=Ts=_:Ts=Ts.next=_}return Ts}function Hc(_,S){return typeof S=="function"?S(_):S}function Pv(_){var S=pc(),D=S.queue;if(D===null)throw Error(a(311));D.lastRenderedReducer=_;var N=Ms,H=N.baseQueue,ie=D.pending;if(ie!==null){if(H!==null){var Ee=H.next;H.next=ie.next,ie.next=Ee}N.baseQueue=H=ie,D.pending=null}if(H!==null){ie=H.next,N=N.baseState;var Ge=Ee=null,vt=null,Ot=ie;do{var ri=Ot.lane;if((Sf&ri)===ri)vt!==null&&(vt=vt.next={lane:0,action:Ot.action,hasEagerState:Ot.hasEagerState,eagerState:Ot.eagerState,next:null}),N=Ot.hasEagerState?Ot.eagerState:_(N,Ot.action);else{var $i={lane:ri,action:Ot.action,hasEagerState:Ot.hasEagerState,eagerState:Ot.eagerState,next:null};vt===null?(Ge=vt=$i,Ee=N):vt=vt.next=$i,Dn.lanes|=ri,Wc|=ri}Ot=Ot.next}while(Ot!==null&&Ot!==ie);vt===null?Ee=N:vt.next=Ge,Ja(N,S.memoizedState)||(Ps=!0),S.memoizedState=N,S.baseState=Ee,S.baseQueue=vt,D.lastRenderedState=N}if(_=D.interleaved,_!==null){H=_;do ie=H.lane,Dn.lanes|=ie,Wc|=ie,H=H.next;while(H!==_)}else H===null&&(D.lanes=0);return[S.memoizedState,D.dispatch]}function Rv(_){var S=pc(),D=S.queue;if(D===null)throw Error(a(311));D.lastRenderedReducer=_;var N=D.dispatch,H=D.pending,ie=S.memoizedState;if(H!==null){D.pending=null;var Ee=H=H.next;do ie=_(ie,Ee.action),Ee=Ee.next;while(Ee!==H);Ja(ie,S.memoizedState)||(Ps=!0),S.memoizedState=ie,S.baseQueue===null&&(S.baseState=ie),D.lastRenderedState=ie}return[ie,N]}function Q_(){}function J_(_,S){var D=Dn,N=pc(),H=S(),ie=!Ja(N.memoizedState,H);if(ie&&(N.memoizedState=H,Ps=!0),N=N.queue,pm(Du.bind(null,D,N,_),[_]),N.getSnapshot!==S||ie||Ts!==null&&Ts.memoizedState.tag&1){if(D.flags|=2048,Dv(9,tS.bind(null,D,N,H,S),void 0,null),qn===null)throw Error(a(349));(Sf&30)!==0||eS(D,S,H)}return H}function eS(_,S,D){_.flags|=16384,_={getSnapshot:S,value:D},S=Dn.updateQueue,S===null?(S={lastEffect:null,stores:null},Dn.updateQueue=S,S.stores=[_]):(D=S.stores,D===null?S.stores=[_]:D.push(_))}function tS(_,S,D,N){S.value=D,S.getSnapshot=N,wx(S)&&Ca(_,1,-1)}function Du(_,S,D){return D(function(){wx(S)&&Ca(_,1,-1)})}function wx(_){var S=_.getSnapshot;_=_.value;try{var D=S();return!Ja(_,D)}catch{return!0}}function Iv(_){var S=fc();return typeof _=="function"&&(_=_()),S.memoizedState=S.baseState=_,_={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Hc,lastRenderedState:_},S.queue=_,_=_.dispatch=UL.bind(null,Dn,_),[S.memoizedState,_]}function Dv(_,S,D,N){return _={tag:_,create:S,destroy:D,deps:N,next:null},S=Dn.updateQueue,S===null?(S={lastEffect:null,stores:null},Dn.updateQueue=S,S.lastEffect=_.next=_):(D=S.lastEffect,D===null?S.lastEffect=_.next=_:(N=D.next,D.next=_,_.next=N,S.lastEffect=_)),_}function sC(){return pc().memoizedState}function qh(_,S,D,N){var H=fc();Dn.flags|=_,H.memoizedState=Dv(1|S,D,void 0,N===void 0?null:N)}function _x(_,S,D,N){var H=pc();N=N===void 0?null:N;var ie=void 0;if(Ms!==null){var Ee=Ms.memoizedState;if(ie=Ee.destroy,N!==null&&bx(N,Ee.deps)){H.memoizedState=Dv(S,D,ie,N);return}}Dn.flags|=_,H.memoizedState=Dv(1|S,D,ie,N)}function Sx(_,S){return qh(8390656,8,_,S)}function pm(_,S){return _x(2048,8,_,S)}function fn(_,S){return _x(4,2,_,S)}function Ex(_,S){return _x(4,4,_,S)}function Ov(_,S){if(typeof S=="function")return _=_(),S(_),function(){S(null)};if(S!=null)return _=_(),S.current=_,function(){S.current=null}}function mm(_,S,D){return D=D!=null?D.concat([_]):null,_x(4,4,Ov.bind(null,S,_),D)}function Ax(){}function Mx(_,S){var D=pc();S=S===void 0?null:S;var N=D.memoizedState;return N!==null&&S!==null&&bx(S,N[1])?N[0]:(D.memoizedState=[_,S],_)}function gm(_,S){var D=pc();S=S===void 0?null:S;var N=D.memoizedState;return N!==null&&S!==null&&bx(S,N[1])?N[0]:(_=_(),D.memoizedState=[_,S],_)}function Tx(_,S){var D=fr;fr=D!==0&&4>D?D:4,_(!0);var N=$o.transition;$o.transition={};try{_(!1),S()}finally{fr=D,$o.transition=N}}function Af(){return pc().memoizedState}function aC(_,S,D){var N=yc(_);D={lane:N,action:D,hasEagerState:!1,eagerState:null,next:null},oC(_)?iS(S,D):(Lv(_,S,D),D=Ir(),_=Ca(_,N,D),_!==null&&kv(_,S,N))}function UL(_,S,D){var N=yc(_),H={lane:N,action:D,hasEagerState:!1,eagerState:null,next:null};if(oC(_))iS(S,H);else{Lv(_,S,H);var ie=_.alternate;if(_.lanes===0&&(ie===null||ie.lanes===0)&&(ie=S.lastRenderedReducer,ie!==null))try{var Ee=S.lastRenderedState,Ge=ie(Ee,D);if(H.hasEagerState=!0,H.eagerState=Ge,Ja(Ge,Ee))return}catch{}finally{}D=Ir(),_=Ca(_,N,D),_!==null&&kv(_,S,N)}}function oC(_){var S=_.alternate;return _===Dn||S!==null&&S===Dn}function iS(_,S){Vc=xx=!0;var D=_.pending;D===null?S.next=S:(S.next=D.next,D.next=S),_.pending=S}function Lv(_,S,D){qn!==null&&(_.mode&1)!==0&&(sr&2)===0?(_=S.interleaved,_===null?(D.next=D,Tl===null?Tl=[S]:Tl.push(S)):(D.next=_.next,_.next=D),S.interleaved=D):(_=S.pending,_===null?D.next=D:(D.next=_.next,_.next=D),S.pending=D)}function kv(_,S,D){if((D&4194240)!==0){var N=S.lanes;N&=_.pendingLanes,D|=N,S.lanes=D,zc(_,D)}}var vm={readContext:Mo,useCallback:Cs,useContext:Cs,useEffect:Cs,useImperativeHandle:Cs,useInsertionEffect:Cs,useLayoutEffect:Cs,useMemo:Cs,useReducer:Cs,useRef:Cs,useState:Cs,useDebugValue:Cs,useDeferredValue:Cs,useTransition:Cs,useMutableSource:Cs,useSyncExternalStore:Cs,useId:Cs,unstable_isNewReconciler:!1},rS={readContext:Mo,useCallback:function(_,S){return fc().memoizedState=[_,S===void 0?null:S],_},useContext:Mo,useEffect:Sx,useImperativeHandle:function(_,S,D){return D=D!=null?D.concat([_]):null,qh(4194308,4,Ov.bind(null,S,_),D)},useLayoutEffect:function(_,S){return qh(4194308,4,_,S)},useInsertionEffect:function(_,S){return qh(4,2,_,S)},useMemo:function(_,S){var D=fc();return S=S===void 0?null:S,_=_(),D.memoizedState=[_,S],_},useReducer:function(_,S,D){var N=fc();return S=D!==void 0?D(S):S,N.memoizedState=N.baseState=S,_={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:_,lastRenderedState:S},N.queue=_,_=_.dispatch=aC.bind(null,Dn,_),[N.memoizedState,_]},useRef:function(_){var S=fc();return _={current:_},S.memoizedState=_},useState:Iv,useDebugValue:Ax,useDeferredValue:function(_){var S=Iv(_),D=S[0],N=S[1];return Sx(function(){var H=$o.transition;$o.transition={};try{N(_)}finally{$o.transition=H}},[_]),D},useTransition:function(){var _=Iv(!1),S=_[0];return _=Tx.bind(null,_[1]),fc().memoizedState=_,[S,_]},useMutableSource:function(){},useSyncExternalStore:function(_,S,D){var N=Dn,H=fc();if(An){if(D===void 0)throw Error(a(407));D=D()}else{if(D=S(),qn===null)throw Error(a(349));(Sf&30)!==0||eS(N,S,D)}H.memoizedState=D;var ie={value:D,getSnapshot:S};return H.queue=ie,Sx(Du.bind(null,N,ie,_),[_]),N.flags|=2048,Dv(9,tS.bind(null,N,ie,D,S),void 0,null),D},useId:function(){var _=fc(),S=qn.identifierPrefix;if(An){var D=Ru,N=Pu;D=(N&~(1<<32-bn(N)-1)).toString(32)+D,S=":"+S+"R"+D,D=Ef++,0<D&&(S+="H"+D.toString(32)),S+=":"}else D=Cv++,S=":"+S+"r"+D.toString(32)+":";return _.memoizedState=S},unstable_isNewReconciler:!1},nS={readContext:Mo,useCallback:Mx,useContext:Mo,useEffect:pm,useImperativeHandle:mm,useInsertionEffect:fn,useLayoutEffect:Ex,useMemo:gm,useReducer:Pv,useRef:sC,useState:function(){return Pv(Hc)},useDebugValue:Ax,useDeferredValue:function(_){var S=Pv(Hc),D=S[0],N=S[1];return pm(function(){var H=$o.transition;$o.transition={};try{N(_)}finally{$o.transition=H}},[_]),D},useTransition:function(){var _=Pv(Hc)[0],S=pc().memoizedState;return[_,S]},useMutableSource:Q_,useSyncExternalStore:J_,useId:Af,unstable_isNewReconciler:!1},sS={readContext:Mo,useCallback:Mx,useContext:Mo,useEffect:pm,useImperativeHandle:mm,useInsertionEffect:fn,useLayoutEffect:Ex,useMemo:gm,useReducer:Rv,useRef:sC,useState:function(){return Rv(Hc)},useDebugValue:Ax,useDeferredValue:function(_){var S=Rv(Hc),D=S[0],N=S[1];return pm(function(){var H=$o.transition;$o.transition={};try{N(_)}finally{$o.transition=H}},[_]),D},useTransition:function(){var _=Rv(Hc)[0],S=pc().memoizedState;return[_,S]},useMutableSource:Q_,useSyncExternalStore:J_,useId:Af,unstable_isNewReconciler:!1};function aS(_,S){try{var D="",N=S;do D+=V_(N),N=N.return;while(N);var H=D}catch(ie){H=`
Error generating stack: `+ie.message+`
`+ie.stack}return{value:_,source:S,stack:H}}function Cx(_,S){try{console.error(S.value)}catch(D){setTimeout(function(){throw D})}}var BL=typeof WeakMap=="function"?WeakMap:Map;function lC(_,S,D){D=Cu(-1,D),D.tag=3,D.payload={element:null};var N=S.value;return D.callback=function(){Sm||(Sm=!0,_n=N),Cx(_,S)},D}function Px(_,S,D){D=Cu(-1,D),D.tag=3;var N=_.type.getDerivedStateFromError;if(typeof N=="function"){var H=S.value;D.payload=function(){return N(H)},D.callback=function(){Cx(_,S)}}var ie=_.stateNode;return ie!==null&&typeof ie.componentDidCatch=="function"&&(D.callback=function(){Cx(_,S),typeof N!="function"&&(vc===null?vc=new Set([this]):vc.add(this));var Ee=S.stack;this.componentDidCatch(S.value,{componentStack:Ee!==null?Ee:""})}),D}function Ou(_,S,D){var N=_.pingCache;if(N===null){N=_.pingCache=new BL;var H=new Set;N.set(S,H)}else H=N.get(S),H===void 0&&(H=new Set,N.set(S,H));H.has(D)||(H.add(D),_=ES.bind(null,_,S,D),S.then(_,_))}function oS(_){do{var S;if((S=_.tag===13)&&(S=_.memoizedState,S=S!==null?S.dehydrated!==null:!0),S)return _;_=_.return}while(_!==null);return null}function Mf(_,S,D,N,H){return(_.mode&1)===0?(_===S?_.flags|=65536:(_.flags|=128,D.flags|=131072,D.flags&=-52805,D.tag===1&&(D.alternate===null?D.tag=17:(S=Cu(-1,1),S.tag=2,jh(D,S))),D.lanes|=1),_):(_.flags|=65536,_.lanes=H,_)}function ds(_){_.flags|=4}function ym(_,S){if(_!==null&&_.child===S.child)return!0;if((S.flags&16)!==0)return!1;for(_=S.child;_!==null;){if((_.flags&12854)!==0||(_.subtreeFlags&12854)!==0)return!1;_=_.sibling}return!0}var Yo,Tf,Rx,Ix;if(Se)Yo=function(_,S){for(var D=S.child;D!==null;){if(D.tag===5||D.tag===6)ee(_,D.stateNode);else if(D.tag!==4&&D.child!==null){D.child.return=D,D=D.child;continue}if(D===S)break;for(;D.sibling===null;){if(D.return===null||D.return===S)return;D=D.return}D.sibling.return=D.return,D=D.sibling}},Tf=function(){},Rx=function(_,S,D,N,H){if(_=_.memoizedProps,_!==N){var ie=S.stateNode,Ee=dc(To.current);D=fe(ie,D,_,N,H,Ee),(S.updateQueue=D)&&ds(S)}},Ix=function(_,S,D,N){D!==N&&ds(S)};else if(Ce){Yo=function(_,S,D,N){for(var H=S.child;H!==null;){if(H.tag===5){var ie=H.stateNode;D&&N&&(ie=ti(ie,H.type,H.memoizedProps,H)),ee(_,ie)}else if(H.tag===6)ie=H.stateNode,D&&N&&(ie=Zi(ie,H.memoizedProps,H)),ee(_,ie);else if(H.tag!==4){if(H.tag===22&&H.memoizedState!==null)ie=H.child,ie!==null&&(ie.return=H),Yo(_,H,!0,!0);else if(H.child!==null){H.child.return=H,H=H.child;continue}}if(H===S)break;for(;H.sibling===null;){if(H.return===null||H.return===S)return;H=H.return}H.sibling.return=H.return,H=H.sibling}};var Xh=function(_,S,D,N){for(var H=S.child;H!==null;){if(H.tag===5){var ie=H.stateNode;D&&N&&(ie=ti(ie,H.type,H.memoizedProps,H)),Tt(_,ie)}else if(H.tag===6)ie=H.stateNode,D&&N&&(ie=Zi(ie,H.memoizedProps,H)),Tt(_,ie);else if(H.tag!==4){if(H.tag===22&&H.memoizedState!==null)ie=H.child,ie!==null&&(ie.return=H),Xh(_,H,!0,!0);else if(H.child!==null){H.child.return=H,H=H.child;continue}}if(H===S)break;for(;H.sibling===null;){if(H.return===null||H.return===S)return;H=H.return}H.sibling.return=H.return,H=H.sibling}};Tf=function(_,S){var D=S.stateNode;if(!ym(_,S)){_=D.containerInfo;var N=je(_);Xh(N,S,!1,!1),D.pendingChildren=N,ds(S),Ft(_,N)}},Rx=function(_,S,D,N,H){var ie=_.stateNode,Ee=_.memoizedProps;if((_=ym(_,S))&&Ee===N)S.stateNode=ie;else{var Ge=S.stateNode,vt=dc(To.current),Ot=null;Ee!==N&&(Ot=fe(Ge,D,Ee,N,H,vt)),_&&Ot===null?S.stateNode=ie:(ie=rt(ie,Ot,D,Ee,N,S,_,Ge),pe(ie,D,N,H,vt)&&ds(S),S.stateNode=ie,_?ds(S):Yo(ie,S,!1,!1))}},Ix=function(_,S,D,N){D!==N?(_=dc(wf.current),D=dc(To.current),S.stateNode=re(N,_,D,S),ds(S)):S.stateNode=_.stateNode}}else Tf=function(){},Rx=function(){},Ix=function(){};function Lu(_,S){if(!An)switch(_.tailMode){case"hidden":S=_.tail;for(var D=null;S!==null;)S.alternate!==null&&(D=S),S=S.sibling;D===null?_.tail=null:D.sibling=null;break;case"collapsed":D=_.tail;for(var N=null;D!==null;)D.alternate!==null&&(N=D),D=D.sibling;N===null?S||_.tail===null?_.tail=null:_.tail.sibling=null:N.sibling=null}}function Wn(_){var S=_.alternate!==null&&_.alternate.child===_.child,D=0,N=0;if(S)for(var H=_.child;H!==null;)D|=H.lanes|H.childLanes,N|=H.subtreeFlags&14680064,N|=H.flags&14680064,H.return=_,H=H.sibling;else for(H=_.child;H!==null;)D|=H.lanes|H.childLanes,N|=H.subtreeFlags,N|=H.flags,H.return=_,H=H.sibling;return _.subtreeFlags|=N,_.childLanes=D,S}function Dx(_,S,D){var N=S.pendingProps;switch($_(S),S.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Wn(S),null;case 1:return _i(S.type)&&nn(),Wn(S),null;case 3:return N=S.stateNode,dm(),ne(Pe),ne(me),_f(),N.pendingContext&&(N.context=N.pendingContext,N.pendingContext=null),(_===null||_.child===null)&&(Mv(S)?ds(S):_===null||_.memoizedState.isDehydrated&&(S.flags&256)===0||(S.flags|=1024,Rl!==null&&($v(Rl),Rl=null))),Tf(_,S),Wn(S),null;case 5:Z_(S),D=dc(wf.current);var H=S.type;if(_!==null&&S.stateNode!=null)Rx(_,S,H,N,D),_.ref!==S.ref&&(S.flags|=512,S.flags|=2097152);else{if(!N){if(S.stateNode===null)throw Error(a(166));return Wn(S),null}if(_=dc(To.current),Mv(S)){if(!ce)throw Error(a(175));_=Zt(S.stateNode,S.type,S.memoizedProps,D,_,S,!om),S.updateQueue=_,_!==null&&ds(S)}else{var ie=j(H,N,D,_,S);Yo(ie,S,!1,!1),S.stateNode=ie,pe(ie,H,N,D,_)&&ds(S)}S.ref!==null&&(S.flags|=512,S.flags|=2097152)}return Wn(S),null;case 6:if(_&&S.stateNode!=null)Ix(_,S,_.memoizedProps,N);else{if(typeof N!="string"&&S.stateNode===null)throw Error(a(166));if(_=dc(wf.current),D=dc(To.current),Mv(S)){if(!ce)throw Error(a(176));if(_=S.stateNode,N=S.memoizedProps,(D=yi(_,N,S,!om))&&(H=to,H!==null))switch(ie=(H.mode&1)!==0,H.tag){case 3:Je(H.stateNode.containerInfo,_,N,ie);break;case 5:nt(H.type,H.memoizedProps,H.stateNode,_,N,ie)}D&&ds(S)}else S.stateNode=re(N,_,D,S)}return Wn(S),null;case 13:if(ne(In),N=S.memoizedState,An&&$s!==null&&(S.mode&1)!==0&&(S.flags&128)===0){for(_=$s;_;)_=Xe(_);return lm(),S.flags|=98560,S}if(N!==null&&N.dehydrated!==null){if(N=Mv(S),_===null){if(!N)throw Error(a(318));if(!ce)throw Error(a(344));if(_=S.memoizedState,_=_!==null?_.dehydrated:null,!_)throw Error(a(317));Ti(_,S)}else lm(),(S.flags&128)===0&&(S.memoizedState=null),S.flags|=4;return Wn(S),null}return Rl!==null&&($v(Rl),Rl=null),(S.flags&128)!==0?(S.lanes=D,S):(N=N!==null,D=!1,_===null?Mv(S):D=_.memoizedState!==null,N&&!D&&(S.child.flags|=8192,(S.mode&1)!==0&&(_===null||(In.current&1)!==0?Bn===0&&(Bn=3):Fx())),S.updateQueue!==null&&(S.flags|=4),Wn(S),null);case 4:return dm(),Tf(_,S),_===null&&De(S.stateNode.containerInfo),Wn(S),null;case 10:return Av(S.type._context),Wn(S),null;case 17:return _i(S.type)&&nn(),Wn(S),null;case 19:if(ne(In),H=S.memoizedState,H===null)return Wn(S),null;if(N=(S.flags&128)!==0,ie=H.rendering,ie===null)if(N)Lu(H,!1);else{if(Bn!==0||_!==null&&(_.flags&128)!==0)for(_=S.child;_!==null;){if(ie=yx(_),ie!==null){for(S.flags|=128,Lu(H,!1),_=ie.updateQueue,_!==null&&(S.updateQueue=_,S.flags|=4),S.subtreeFlags=0,_=D,N=S.child;N!==null;)D=N,H=_,D.flags&=14680066,ie=D.alternate,ie===null?(D.childLanes=0,D.lanes=H,D.child=null,D.subtreeFlags=0,D.memoizedProps=null,D.memoizedState=null,D.updateQueue=null,D.dependencies=null,D.stateNode=null):(D.childLanes=ie.childLanes,D.lanes=ie.lanes,D.child=ie.child,D.subtreeFlags=0,D.deletions=null,D.memoizedProps=ie.memoizedProps,D.memoizedState=ie.memoizedState,D.updateQueue=ie.updateQueue,D.type=ie.type,H=ie.dependencies,D.dependencies=H===null?null:{lanes:H.lanes,firstContext:H.firstContext}),N=N.sibling;return ae(In,In.current&1|2),S.child}_=_.sibling}H.tail!==null&&hs()>Kh&&(S.flags|=128,N=!0,Lu(H,!1),S.lanes=4194304)}else{if(!N)if(_=yx(ie),_!==null){if(S.flags|=128,N=!0,_=_.updateQueue,_!==null&&(S.updateQueue=_,S.flags|=4),Lu(H,!0),H.tail===null&&H.tailMode==="hidden"&&!ie.alternate&&!An)return Wn(S),null}else 2*hs()-H.renderingStartTime>Kh&&D!==1073741824&&(S.flags|=128,N=!0,Lu(H,!1),S.lanes=4194304);H.isBackwards?(ie.sibling=S.child,S.child=ie):(_=H.last,_!==null?_.sibling=ie:S.child=ie,H.last=ie)}return H.tail!==null?(S=H.tail,H.rendering=S,H.tail=S.sibling,H.renderingStartTime=hs(),S.sibling=null,_=In.current,ae(In,N?_&1|2:_&1),S):(Wn(S),null);case 22:case 23:return Yv(),N=S.memoizedState!==null,_!==null&&_.memoizedState!==null!==N&&(S.flags|=8192),N&&(S.mode&1)!==0?(Ta&1073741824)!==0&&(Wn(S),Se&&S.subtreeFlags&6&&(S.flags|=8192)):Wn(S),null;case 24:return null;case 25:return null}throw Error(a(156,S.tag))}var lS=o.ReactCurrentOwner,Ps=!1;function Un(_,S,D,N){S.child=_===null?rC(S,null,D,N):Iu(S,_.child,D,N)}function pn(_,S,D,N,H){D=D.render;var ie=S.ref;return nm(S,H),N=fm(_,S,D,N,ie,H),D=Wh(),_!==null&&!Ps?(S.updateQueue=_.updateQueue,S.flags&=-2053,_.lanes&=~H,Co(_,S,H)):(An&&D&&X_(S),S.flags|=1,Un(_,S,N,H),S.child)}function sn(_,S,D,N,H){if(_===null){var ie=D.type;return typeof ie=="function"&&!jx(ie)&&ie.defaultProps===void 0&&D.compare===null&&D.defaultProps===void 0?(S.tag=15,S.type=ie,ku(_,S,ie,N,H)):(_=Vx(D.type,null,N,S,S.mode,H),_.ref=S.ref,_.return=S,S.child=_)}if(ie=_.child,(_.lanes&H)===0){var Ee=ie.memoizedProps;if(D=D.compare,D=D!==null?D:hc,D(Ee,N)&&_.ref===S.ref)return Co(_,S,H)}return S.flags|=1,_=Gu(ie,N),_.ref=S.ref,_.return=S,S.child=_}function ku(_,S,D,N,H){if(_!==null&&hc(_.memoizedProps,N)&&_.ref===S.ref)if(Ps=!1,(_.lanes&H)!==0)(_.flags&131072)!==0&&(Ps=!0);else return S.lanes=_.lanes,Co(_,S,H);return Nu(_,S,D,N,H)}function Ys(_,S,D){var N=S.pendingProps,H=N.children,ie=_!==null?_.memoizedState:null;if(N.mode==="hidden")if((S.mode&1)===0)S.memoizedState={baseLanes:0,cachePool:null},ae(Nf,Ta),Ta|=D;else if((D&1073741824)!==0)S.memoizedState={baseLanes:0,cachePool:null},N=ie!==null?ie.baseLanes:D,ae(Nf,Ta),Ta|=N;else return _=ie!==null?ie.baseLanes|D:D,S.lanes=S.childLanes=1073741824,S.memoizedState={baseLanes:_,cachePool:null},S.updateQueue=null,ae(Nf,Ta),Ta|=_,null;else ie!==null?(N=ie.baseLanes|D,S.memoizedState=null):N=D,ae(Nf,Ta),Ta|=N;return Un(_,S,H,D),S.child}function io(_,S){var D=S.ref;(_===null&&D!==null||_!==null&&_.ref!==D)&&(S.flags|=512,S.flags|=2097152)}function Nu(_,S,D,N,H){var ie=_i(D)?Ze:me.current;return ie=Qi(S,ie),nm(S,H),D=fm(_,S,D,N,ie,H),N=Wh(),_!==null&&!Ps?(S.updateQueue=_.updateQueue,S.flags&=-2053,_.lanes&=~H,Co(_,S,H)):(An&&N&&X_(S),S.flags|=1,Un(_,S,D,H),S.child)}function Cf(_,S,D,N,H){if(_i(D)){var ie=!0;Eo(S)}else ie=!1;if(nm(S,H),S.stateNode===null)_!==null&&(_.alternate=null,S.alternate=null,S.flags|=2),QT(S,D,N),q_(S,D,N,H),N=!0;else if(_===null){var Ee=S.stateNode,Ge=S.memoizedProps;Ee.props=Ge;var vt=Ee.context,Ot=D.contextType;typeof Ot=="object"&&Ot!==null?Ot=Mo(Ot):(Ot=_i(D)?Ze:me.current,Ot=Qi(S,Ot));var ri=D.getDerivedStateFromProps,$i=typeof ri=="function"||typeof Ee.getSnapshotBeforeUpdate=="function";$i||typeof Ee.UNSAFE_componentWillReceiveProps!="function"&&typeof Ee.componentWillReceiveProps!="function"||(Ge!==N||vt!==Ot)&&JT(S,Ee,N,Ot),Cl=!1;var Ci=S.memoizedState;Ee.state=Ci,hx(S,N,Ee,H),vt=S.memoizedState,Ge!==N||Ci!==vt||Pe.current||Cl?(typeof ri=="function"&&(G_(S,D,ri,N),vt=S.memoizedState),(Ge=Cl||W_(S,D,Ge,N,Ci,vt,Ot))?($i||typeof Ee.UNSAFE_componentWillMount!="function"&&typeof Ee.componentWillMount!="function"||(typeof Ee.componentWillMount=="function"&&Ee.componentWillMount(),typeof Ee.UNSAFE_componentWillMount=="function"&&Ee.UNSAFE_componentWillMount()),typeof Ee.componentDidMount=="function"&&(S.flags|=4194308)):(typeof Ee.componentDidMount=="function"&&(S.flags|=4194308),S.memoizedProps=N,S.memoizedState=vt),Ee.props=N,Ee.state=vt,Ee.context=Ot,N=Ge):(typeof Ee.componentDidMount=="function"&&(S.flags|=4194308),N=!1)}else{Ee=S.stateNode,H_(_,S),Ge=S.memoizedProps,Ot=S.type===S.elementType?Ge:Ao(S.type,Ge),Ee.props=Ot,$i=S.pendingProps,Ci=Ee.context,vt=D.contextType,typeof vt=="object"&&vt!==null?vt=Mo(vt):(vt=_i(D)?Ze:me.current,vt=Qi(S,vt));var ur=D.getDerivedStateFromProps;(ri=typeof ur=="function"||typeof Ee.getSnapshotBeforeUpdate=="function")||typeof Ee.UNSAFE_componentWillReceiveProps!="function"&&typeof Ee.componentWillReceiveProps!="function"||(Ge!==$i||Ci!==vt)&&JT(S,Ee,N,vt),Cl=!1,Ci=S.memoizedState,Ee.state=Ci,hx(S,N,Ee,H);var Yt=S.memoizedState;Ge!==$i||Ci!==Yt||Pe.current||Cl?(typeof ur=="function"&&(G_(S,D,ur,N),Yt=S.memoizedState),(Ot=Cl||W_(S,D,Ot,N,Ci,Yt,vt)||!1)?(ri||typeof Ee.UNSAFE_componentWillUpdate!="function"&&typeof Ee.componentWillUpdate!="function"||(typeof Ee.componentWillUpdate=="function"&&Ee.componentWillUpdate(N,Yt,vt),typeof Ee.UNSAFE_componentWillUpdate=="function"&&Ee.UNSAFE_componentWillUpdate(N,Yt,vt)),typeof Ee.componentDidUpdate=="function"&&(S.flags|=4),typeof Ee.getSnapshotBeforeUpdate=="function"&&(S.flags|=1024)):(typeof Ee.componentDidUpdate!="function"||Ge===_.memoizedProps&&Ci===_.memoizedState||(S.flags|=4),typeof Ee.getSnapshotBeforeUpdate!="function"||Ge===_.memoizedProps&&Ci===_.memoizedState||(S.flags|=1024),S.memoizedProps=N,S.memoizedState=Yt),Ee.props=N,Ee.state=Yt,Ee.context=vt,N=Ot):(typeof Ee.componentDidUpdate!="function"||Ge===_.memoizedProps&&Ci===_.memoizedState||(S.flags|=4),typeof Ee.getSnapshotBeforeUpdate!="function"||Ge===_.memoizedProps&&Ci===_.memoizedState||(S.flags|=1024),N=!1)}return Ma(_,S,D,N,ie,H)}function Ma(_,S,D,N,H,ie){io(_,S);var Ee=(S.flags&128)!==0;if(!N&&!Ee)return H&&$r(S,D,!1),Co(_,S,ie);N=S.stateNode,lS.current=S;var Ge=Ee&&typeof D.getDerivedStateFromError!="function"?null:N.render();return S.flags|=1,_!==null&&Ee?(S.child=Iu(S,_.child,null,ie),S.child=Iu(S,null,Ge,ie)):Un(_,S,Ge,ie),S.memoizedState=N.state,H&&$r(S,D,!0),S.child}function Nv(_){var S=_.stateNode;S.pendingContext?Sa(_,S.pendingContext,S.pendingContext!==S.context):S.context&&Sa(_,S.context,!1),vx(_,S.containerInfo)}function cS(_,S,D,N,H){return lm(),gx(H),S.flags|=256,Un(_,S,D,N),S.child}var Uv={dehydrated:null,treeContext:null,retryLane:0};function Pf(_){return{baseLanes:_,cachePool:null}}function uS(_,S,D){var N=S.pendingProps,H=In.current,ie=!1,Ee=(S.flags&128)!==0,Ge;if((Ge=Ee)||(Ge=_!==null&&_.memoizedState===null?!1:(H&2)!==0),Ge?(ie=!0,S.flags&=-129):(_===null||_.memoizedState!==null)&&(H|=1),ae(In,H&1),_===null)return Hh(S),_=S.memoizedState,_!==null&&(_=_.dehydrated,_!==null)?((S.mode&1)===0?S.lanes=1:us(_)?S.lanes=8:S.lanes=1073741824,null):(H=N.children,_=N.fallback,ie?(N=S.mode,ie=S.child,H={mode:"hidden",children:H},(N&1)===0&&ie!==null?(ie.childLanes=0,ie.pendingProps=H):ie=Qv(H,N,0,null),_=jf(_,N,D,null),ie.return=S,_.return=S,ie.sibling=_,S.child=ie,S.child.memoizedState=Pf(D),S.memoizedState=Uv,_):mc(S,H));if(H=_.memoizedState,H!==null){if(Ge=H.dehydrated,Ge!==null){if(Ee)return S.flags&256?(S.flags&=-257,Fv(_,S,D,Error(a(422)))):S.memoizedState!==null?(S.child=_.child,S.flags|=128,null):(ie=N.fallback,H=S.mode,N=Qv({mode:"visible",children:N.children},H,0,null),ie=jf(ie,H,D,null),ie.flags|=2,N.return=S,ie.return=S,N.sibling=ie,S.child=N,(S.mode&1)!==0&&Iu(S,_.child,null,D),S.child.memoizedState=Pf(D),S.memoizedState=Uv,ie);if((S.mode&1)===0)S=Fv(_,S,D,null);else if(us(Ge))S=Fv(_,S,D,Error(a(419)));else if(N=(D&_.childLanes)!==0,Ps||N){if(N=qn,N!==null){switch(D&-D){case 4:ie=2;break;case 16:ie=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:ie=32;break;case 536870912:ie=268435456;break;default:ie=0}N=(ie&(N.suspendedLanes|D))!==0?0:ie,N!==0&&N!==H.retryLane&&(H.retryLane=N,Ca(_,N,-1))}Fx(),S=Fv(_,S,D,Error(a(421)))}else Nn(Ge)?(S.flags|=128,S.child=_.child,S=fC.bind(null,_),ye(Ge,S),S=null):(D=H.treeContext,ce&&($s=gt(Ge),to=S,An=!0,Rl=null,om=!1,D!==null&&(Pl[qo++]=Pu,Pl[qo++]=Ru,Pl[qo++]=yf,Pu=D.id,Ru=D.overflow,yf=S)),S=mc(S,S.pendingProps.children),S.flags|=4096);return S}return ie?(N=Ox(_,S,N.children,N.fallback,D),ie=S.child,H=_.child.memoizedState,ie.memoizedState=H===null?Pf(D):{baseLanes:H.baseLanes|D,cachePool:null},ie.childLanes=_.childLanes&~D,S.memoizedState=Uv,N):(D=Bv(_,S,N.children,D),S.memoizedState=null,D)}return ie?(N=Ox(_,S,N.children,N.fallback,D),ie=S.child,H=_.child.memoizedState,ie.memoizedState=H===null?Pf(D):{baseLanes:H.baseLanes|D,cachePool:null},ie.childLanes=_.childLanes&~D,S.memoizedState=Uv,N):(D=Bv(_,S,N.children,D),S.memoizedState=null,D)}function mc(_,S){return S=Qv({mode:"visible",children:S},_.mode,0,null),S.return=_,_.child=S}function Bv(_,S,D,N){var H=_.child;return _=H.sibling,D=Gu(H,{mode:"visible",children:D}),(S.mode&1)===0&&(D.lanes=N),D.return=S,D.sibling=null,_!==null&&(N=S.deletions,N===null?(S.deletions=[_],S.flags|=16):N.push(_)),S.child=D}function Ox(_,S,D,N,H){var ie=S.mode;_=_.child;var Ee=_.sibling,Ge={mode:"hidden",children:D};return(ie&1)===0&&S.child!==_?(D=S.child,D.childLanes=0,D.pendingProps=Ge,S.deletions=null):(D=Gu(_,Ge),D.subtreeFlags=_.subtreeFlags&14680064),Ee!==null?N=Gu(Ee,N):(N=jf(N,ie,H,null),N.flags|=2),N.return=S,D.return=S,D.sibling=N,S.child=D,N}function Fv(_,S,D,N){return N!==null&&gx(N),Iu(S,_.child,null,D),_=mc(S,S.pendingProps.children),_.flags|=2,S.memoizedState=null,_}function cC(_,S,D){_.lanes|=S;var N=_.alternate;N!==null&&(N.lanes|=S),vf(_.return,S,D)}function Gc(_,S,D,N,H){var ie=_.memoizedState;ie===null?_.memoizedState={isBackwards:S,rendering:null,renderingStartTime:0,last:N,tail:D,tailMode:H}:(ie.isBackwards=S,ie.rendering=null,ie.renderingStartTime=0,ie.last=N,ie.tail=D,ie.tailMode=H)}function Rf(_,S,D){var N=S.pendingProps,H=N.revealOrder,ie=N.tail;if(Un(_,S,N.children,D),N=In.current,(N&2)!==0)N=N&1|2,S.flags|=128;else{if(_!==null&&(_.flags&128)!==0)e:for(_=S.child;_!==null;){if(_.tag===13)_.memoizedState!==null&&cC(_,D,S);else if(_.tag===19)cC(_,D,S);else if(_.child!==null){_.child.return=_,_=_.child;continue}if(_===S)break e;for(;_.sibling===null;){if(_.return===null||_.return===S)break e;_=_.return}_.sibling.return=_.return,_=_.sibling}N&=1}if(ae(In,N),(S.mode&1)===0)S.memoizedState=null;else switch(H){case"forwards":for(D=S.child,H=null;D!==null;)_=D.alternate,_!==null&&yx(_)===null&&(H=D),D=D.sibling;D=H,D===null?(H=S.child,S.child=null):(H=D.sibling,D.sibling=null),Gc(S,!1,H,D,ie);break;case"backwards":for(D=null,H=S.child,S.child=null;H!==null;){if(_=H.alternate,_!==null&&yx(_)===null){S.child=H;break}_=H.sibling,H.sibling=D,D=H,H=_}Gc(S,!0,D,null,ie);break;case"together":Gc(S,!1,null,null,void 0);break;default:S.memoizedState=null}return S.child}function Co(_,S,D){if(_!==null&&(S.dependencies=_.dependencies),Wc|=S.lanes,(D&S.childLanes)===0)return null;if(_!==null&&S.child!==_.child)throw Error(a(153));if(S.child!==null){for(_=S.child,D=Gu(_,_.pendingProps),S.child=D,D.return=S;_.sibling!==null;)_=_.sibling,D=D.sibling=Gu(_,_.pendingProps),D.return=S;D.sibling=null}return S.child}function Lx(_,S,D){switch(S.tag){case 3:Nv(S),lm();break;case 5:nC(S);break;case 1:_i(S.type)&&Eo(S);break;case 4:vx(S,S.stateNode.containerInfo);break;case 10:gf(S,S.type._context,S.memoizedProps.value);break;case 13:var N=S.memoizedState;if(N!==null)return N.dehydrated!==null?(ae(In,In.current&1),S.flags|=128,null):(D&S.child.childLanes)!==0?uS(_,S,D):(ae(In,In.current&1),_=Co(_,S,D),_!==null?_.sibling:null);ae(In,In.current&1);break;case 19:if(N=(D&S.childLanes)!==0,(_.flags&128)!==0){if(N)return Rf(_,S,D);S.flags|=128}var H=S.memoizedState;if(H!==null&&(H.rendering=null,H.tail=null,H.lastEffect=null),ae(In,In.current),N)break;return null;case 22:case 23:return S.lanes=0,Ys(_,S,D)}return Co(_,S,D)}function kx(_,S){switch($_(S),S.tag){case 1:return _i(S.type)&&nn(),_=S.flags,_&65536?(S.flags=_&-65537|128,S):null;case 3:return dm(),ne(Pe),ne(me),_f(),_=S.flags,(_&65536)!==0&&(_&128)===0?(S.flags=_&-65537|128,S):null;case 5:return Z_(S),null;case 13:if(ne(In),_=S.memoizedState,_!==null&&_.dehydrated!==null){if(S.alternate===null)throw Error(a(340));lm()}return _=S.flags,_&65536?(S.flags=_&-65537|128,S):null;case 19:return ne(In),null;case 4:return dm(),null;case 10:return Av(S.type._context),null;case 22:case 23:return Yv(),null;case 24:return null;default:return null}}var ro=!1,Rs=!1,If=typeof WeakSet=="function"?WeakSet:Set,zt=null;function Il(_,S){var D=_.ref;if(D!==null)if(typeof D=="function")try{D(null)}catch(N){so(_,S,N)}else D.current=null}function Uu(_,S,D){try{D()}catch(N){so(_,S,N)}}var hS=!1;function dS(_,S){for(Y(_.containerInfo),zt=S;zt!==null;)if(_=zt,S=_.child,(_.subtreeFlags&1028)!==0&&S!==null)S.return=_,zt=S;else for(;zt!==null;){_=zt;try{var D=_.alternate;if((_.flags&1024)!==0)switch(_.tag){case 0:case 11:case 15:break;case 1:if(D!==null){var N=D.memoizedProps,H=D.memoizedState,ie=_.stateNode,Ee=ie.getSnapshotBeforeUpdate(_.elementType===_.type?N:Ao(_.type,N),H);ie.__reactInternalSnapshotBeforeUpdate=Ee}break;case 3:Se&&st(_.stateNode.containerInfo);break;case 5:case 6:case 4:case 17:break;default:throw Error(a(163))}}catch(Ge){so(_,_.return,Ge)}if(S=_.sibling,S!==null){S.return=_.return,zt=S;break}zt=_.return}return D=hS,hS=!1,D}function Bu(_,S,D){var N=S.updateQueue;if(N=N!==null?N.lastEffect:null,N!==null){var H=N=N.next;do{if((H.tag&_)===_){var ie=H.destroy;H.destroy=void 0,ie!==void 0&&Uu(S,D,ie)}H=H.next}while(H!==N)}}function Ks(_,S){if(S=S.updateQueue,S=S!==null?S.lastEffect:null,S!==null){var D=S=S.next;do{if((D.tag&_)===_){var N=D.create;D.destroy=N()}D=D.next}while(D!==S)}}function no(_){var S=_.ref;if(S!==null){var D=_.stateNode;switch(_.tag){case 5:_=K(D);break;default:_=D}typeof S=="function"?S(_):S.current=_}}function wn(_,S,D){if(jc&&typeof jc.onCommitFiberUnmount=="function")try{jc.onCommitFiberUnmount(wv,S)}catch{}switch(S.tag){case 0:case 11:case 14:case 15:if(_=S.updateQueue,_!==null&&(_=_.lastEffect,_!==null)){var N=_=_.next;do{var H=N,ie=H.destroy;H=H.tag,ie!==void 0&&((H&2)!==0||(H&4)!==0)&&Uu(S,D,ie),N=N.next}while(N!==_)}break;case 1:if(Il(S,D),_=S.stateNode,typeof _.componentWillUnmount=="function")try{_.props=S.memoizedProps,_.state=S.memoizedState,_.componentWillUnmount()}catch(Ee){so(S,D,Ee)}break;case 5:Il(S,D);break;case 4:Se?mS(_,S,D):Ce&&Ce&&(S=S.stateNode.containerInfo,D=je(S),wi(S,D))}}function Dl(_,S,D){for(var N=S;;)if(wn(_,N,D),N.child===null||Se&&N.tag===4){if(N===S)break;for(;N.sibling===null;){if(N.return===null||N.return===S)return;N=N.return}N.sibling.return=N.return,N=N.sibling}else N.child.return=N,N=N.child}function fS(_){var S=_.alternate;S!==null&&(_.alternate=null,fS(S)),_.child=null,_.deletions=null,_.sibling=null,_.tag===5&&(S=_.stateNode,S!==null&&Be(S)),_.stateNode=null,_.return=null,_.dependencies=null,_.memoizedProps=null,_.memoizedState=null,_.pendingProps=null,_.stateNode=null,_.updateQueue=null}function pS(_){return _.tag===5||_.tag===3||_.tag===4}function Nx(_){e:for(;;){for(;_.sibling===null;){if(_.return===null||pS(_.return))return null;_=_.return}for(_.sibling.return=_.return,_=_.sibling;_.tag!==5&&_.tag!==6&&_.tag!==18;){if(_.flags&2||_.child===null||_.tag===4)continue e;_.child.return=_,_=_.child}if(!(_.flags&2))return _.stateNode}}function Ux(_){if(Se){e:{for(var S=_.return;S!==null;){if(pS(S))break e;S=S.return}throw Error(a(160))}var D=S;switch(D.tag){case 5:S=D.stateNode,D.flags&32&&(Et(S),D.flags&=-33),D=Nx(_),xm(_,D,S);break;case 3:case 4:S=D.stateNode.containerInfo,D=Nx(_),Bx(_,D,S);break;default:throw Error(a(161))}}}function Bx(_,S,D){var N=_.tag;if(N===5||N===6)_=_.stateNode,S?pt(D,_,S):at(D,_);else if(N!==4&&(_=_.child,_!==null))for(Bx(_,S,D),_=_.sibling;_!==null;)Bx(_,S,D),_=_.sibling}function xm(_,S,D){var N=_.tag;if(N===5||N===6)_=_.stateNode,S?Qe(D,_,S):Le(D,_);else if(N!==4&&(_=_.child,_!==null))for(xm(_,S,D),_=_.sibling;_!==null;)xm(_,S,D),_=_.sibling}function mS(_,S,D){for(var N=S,H=!1,ie,Ee;;){if(!H){H=N.return;e:for(;;){if(H===null)throw Error(a(160));switch(ie=H.stateNode,H.tag){case 5:Ee=!1;break e;case 3:ie=ie.containerInfo,Ee=!0;break e;case 4:ie=ie.containerInfo,Ee=!0;break e}H=H.return}H=!0}if(N.tag===5||N.tag===6)Dl(_,N,D),Ee?yt(ie,N.stateNode):_t(ie,N.stateNode);else if(N.tag===18)Ee?de(ie,N.stateNode):Vi(ie,N.stateNode);else if(N.tag===4){if(N.child!==null){ie=N.stateNode.containerInfo,Ee=!0,N.child.return=N,N=N.child;continue}}else if(wn(_,N,D),N.child!==null){N.child.return=N,N=N.child;continue}if(N===S)break;for(;N.sibling===null;){if(N.return===null||N.return===S)return;N=N.return,N.tag===4&&(H=!1)}N.sibling.return=N.return,N=N.sibling}}function $h(_,S){if(Se){switch(S.tag){case 0:case 11:case 14:case 15:Bu(3,S,S.return),Ks(3,S),Bu(5,S,S.return);return;case 1:return;case 5:var D=S.stateNode;if(D!=null){var N=S.memoizedProps;_=_!==null?_.memoizedProps:N;var H=S.type,ie=S.updateQueue;S.updateQueue=null,ie!==null&&ot(D,ie,H,_,N,S)}return;case 6:if(S.stateNode===null)throw Error(a(162));D=S.memoizedProps,Te(S.stateNode,_!==null?_.memoizedProps:D,D);return;case 3:ce&&_!==null&&_.memoizedState.isDehydrated&&vr(S.stateNode.containerInfo);return;case 12:return;case 13:bm(S);return;case 19:bm(S);return;case 17:return}throw Error(a(163))}switch(S.tag){case 0:case 11:case 14:case 15:Bu(3,S,S.return),Ks(3,S),Bu(5,S,S.return);return;case 12:return;case 13:bm(S);return;case 19:bm(S);return;case 3:ce&&_!==null&&_.memoizedState.isDehydrated&&vr(S.stateNode.containerInfo);break;case 22:case 23:return}e:if(Ce){switch(S.tag){case 1:case 5:case 6:break e;case 3:case 4:S=S.stateNode,wi(S.containerInfo,S.pendingChildren);break e}throw Error(a(163))}}function bm(_){var S=_.updateQueue;if(S!==null){_.updateQueue=null;var D=_.stateNode;D===null&&(D=_.stateNode=new If),S.forEach(function(N){var H=pC.bind(null,_,N);D.has(N)||(D.add(N),N.then(H,H))})}}function FL(_,S){for(zt=S;zt!==null;){S=zt;var D=S.deletions;if(D!==null)for(var N=0;N<D.length;N++){var H=D[N];try{var ie=_;Se?mS(ie,H,S):Dl(ie,H,S);var Ee=H.alternate;Ee!==null&&(Ee.return=null),H.return=null}catch(vi){so(H,S,vi)}}if(D=S.child,(S.subtreeFlags&12854)!==0&&D!==null)D.return=S,zt=D;else for(;zt!==null;){S=zt;try{var Ge=S.flags;if(Ge&32&&Se&&Et(S.stateNode),Ge&512){var vt=S.alternate;if(vt!==null){var Ot=vt.ref;Ot!==null&&(typeof Ot=="function"?Ot(null):Ot.current=null)}}if(Ge&8192)switch(S.tag){case 13:if(S.memoizedState!==null){var ri=S.alternate;(ri===null||ri.memoizedState===null)&&(qv=hs())}break;case 22:var $i=S.memoizedState!==null,Ci=S.alternate,ur=Ci!==null&&Ci.memoizedState!==null;if(D=S,Se){e:if(N=D,H=$i,ie=null,Se)for(var Yt=N;;){if(Yt.tag===5){if(ie===null){ie=Yt;var Js=Yt.stateNode;H?$t(Js):Re(Yt.stateNode,Yt.memoizedProps)}}else if(Yt.tag===6){if(ie===null){var el=Yt.stateNode;H?oe(el):ke(el,Yt.memoizedProps)}}else if((Yt.tag!==22&&Yt.tag!==23||Yt.memoizedState===null||Yt===N)&&Yt.child!==null){Yt.child.return=Yt,Yt=Yt.child;continue}if(Yt===N)break;for(;Yt.sibling===null;){if(Yt.return===null||Yt.return===N)break e;ie===Yt&&(ie=null),Yt=Yt.return}ie===Yt&&(ie=null),Yt.sibling.return=Yt.return,Yt=Yt.sibling}}if($i&&!ur&&(D.mode&1)!==0){zt=D;for(var tt=D.child;tt!==null;){for(D=zt=tt;zt!==null;){N=zt;var We=N.child;switch(N.tag){case 0:case 11:case 14:case 15:Bu(4,N,N.return);break;case 1:Il(N,N.return);var ut=N.stateNode;if(typeof ut.componentWillUnmount=="function"){var qt=N.return;try{ut.props=N.memoizedProps,ut.state=N.memoizedState,ut.componentWillUnmount()}catch(vi){so(N,qt,vi)}}break;case 5:Il(N,N.return);break;case 22:if(N.memoizedState!==null){vS(D);continue}}We!==null?(We.return=N,zt=We):vS(D)}tt=tt.sibling}}}switch(Ge&4102){case 2:Ux(S),S.flags&=-3;break;case 6:Ux(S),S.flags&=-3,$h(S.alternate,S);break;case 4096:S.flags&=-4097;break;case 4100:S.flags&=-4097,$h(S.alternate,S);break;case 4:$h(S.alternate,S)}}catch(vi){so(S,S.return,vi)}if(D=S.sibling,D!==null){D.return=S.return,zt=D;break}zt=S.return}}}function zv(_,S,D){zt=_,jv(_)}function jv(_,S,D){for(var N=(_.mode&1)!==0;zt!==null;){var H=zt,ie=H.child;if(H.tag===22&&N){var Ee=H.memoizedState!==null||ro;if(!Ee){var Ge=H.alternate,vt=Ge!==null&&Ge.memoizedState!==null||Rs;Ge=ro;var Ot=Rs;if(ro=Ee,(Rs=vt)&&!Ot)for(zt=H;zt!==null;)Ee=zt,vt=Ee.child,Ee.tag===22&&Ee.memoizedState!==null?Df(H):vt!==null?(vt.return=Ee,zt=vt):Df(H);for(;ie!==null;)zt=ie,jv(ie),ie=ie.sibling;zt=H,ro=Ge,Rs=Ot}gS(_)}else(H.subtreeFlags&8772)!==0&&ie!==null?(ie.return=H,zt=ie):gS(_)}}function gS(_){for(;zt!==null;){var S=zt;if((S.flags&8772)!==0){var D=S.alternate;try{if((S.flags&8772)!==0)switch(S.tag){case 0:case 11:case 15:Rs||Ks(5,S);break;case 1:var N=S.stateNode;if(S.flags&4&&!Rs)if(D===null)N.componentDidMount();else{var H=S.elementType===S.type?D.memoizedProps:Ao(S.type,D.memoizedProps);N.componentDidUpdate(H,D.memoizedState,N.__reactInternalSnapshotBeforeUpdate)}var ie=S.updateQueue;ie!==null&&KT(S,ie,N);break;case 3:var Ee=S.updateQueue;if(Ee!==null){if(D=null,S.child!==null)switch(S.child.tag){case 5:D=K(S.child.stateNode);break;case 1:D=S.child.stateNode}KT(S,Ee,D)}break;case 5:var Ge=S.stateNode;D===null&&S.flags&4&&dt(Ge,S.type,S.memoizedProps,S);break;case 6:break;case 4:break;case 12:break;case 13:if(ce&&S.memoizedState===null){var vt=S.alternate;if(vt!==null){var Ot=vt.memoizedState;if(Ot!==null){var ri=Ot.dehydrated;ri!==null&&ji(ri)}}}break;case 19:case 17:case 21:case 22:case 23:break;default:throw Error(a(163))}Rs||S.flags&512&&no(S)}catch($i){so(S,S.return,$i)}}if(S===_){zt=null;break}if(D=S.sibling,D!==null){D.return=S.return,zt=D;break}zt=S.return}}function vS(_){for(;zt!==null;){var S=zt;if(S===_){zt=null;break}var D=S.sibling;if(D!==null){D.return=S.return,zt=D;break}zt=S.return}}function Df(_){for(;zt!==null;){var S=zt;try{switch(S.tag){case 0:case 11:case 15:var D=S.return;try{Ks(4,S)}catch(vt){so(S,D,vt)}break;case 1:var N=S.stateNode;if(typeof N.componentDidMount=="function"){var H=S.return;try{N.componentDidMount()}catch(vt){so(S,H,vt)}}var ie=S.return;try{no(S)}catch(vt){so(S,ie,vt)}break;case 5:var Ee=S.return;try{no(S)}catch(vt){so(S,Ee,vt)}}}catch(vt){so(S,S.return,vt)}if(S===_){zt=null;break}var Ge=S.sibling;if(Ge!==null){Ge.return=S.return,zt=Ge;break}zt=S.return}}var Vv=0,Of=1,Lf=2,Fu=3,wm=4;if(typeof Symbol=="function"&&Symbol.for){var kf=Symbol.for;Vv=kf("selector.component"),Of=kf("selector.has_pseudo_class"),Lf=kf("selector.role"),Fu=kf("selector.test_id"),wm=kf("selector.text")}function Hv(_){var S=Fe(_);if(S!=null){if(typeof S.memoizedProps["data-testname"]!="string")throw Error(a(364));return S}if(_=wt(_),_===null)throw Error(a(362));return _.stateNode.current}function Gv(_,S){switch(S.$$typeof){case Vv:if(_.type===S.value)return!0;break;case Of:e:{S=S.value,_=[_,0];for(var D=0;D<_.length;){var N=_[D++],H=_[D++],ie=S[H];if(N.tag!==5||!Q(N)){for(;ie!=null&&Gv(N,ie);)H++,ie=S[H];if(H===S.length){S=!0;break e}else for(N=N.child;N!==null;)_.push(N,H),N=N.sibling}}S=!1}return S;case Lf:if(_.tag===5&&we(_.stateNode,S.value))return!0;break;case wm:if((_.tag===5||_.tag===6)&&(_=G(_),_!==null&&0<=_.indexOf(S.value)))return!0;break;case Fu:if(_.tag===5&&(_=_.memoizedProps["data-testname"],typeof _=="string"&&_.toLowerCase()===S.value.toLowerCase()))return!0;break;default:throw Error(a(365))}return!1}function Yh(_){switch(_.$$typeof){case Vv:return"<"+(P(_.value)||"Unknown")+">";case Of:return":has("+(Yh(_)||"")+")";case Lf:return'[role="'+_.value+'"]';case wm:return'"'+_.value+'"';case Fu:return'[data-testname="'+_.value+'"]';default:throw Error(a(365))}}function Ko(_,S){var D=[];_=[_,0];for(var N=0;N<_.length;){var H=_[N++],ie=_[N++],Ee=S[ie];if(H.tag!==5||!Q(H)){for(;Ee!=null&&Gv(H,Ee);)ie++,Ee=S[ie];if(ie===S.length)D.push(H);else for(H=H.child;H!==null;)_.push(H,ie),H=H.sibling}}return D}function zu(_,S){if(!it)throw Error(a(363));_=Hv(_),_=Ko(_,S),S=[],_=Array.from(_);for(var D=0;D<_.length;){var N=_[D++];if(N.tag===5)Q(N)||S.push(N.stateNode);else for(N=N.child;N!==null;)_.push(N),N=N.sibling}return S}var yS=Math.ceil,Wv=o.ReactCurrentDispatcher,gc=o.ReactCurrentOwner,Yr=o.ReactCurrentBatchConfig,sr=0,qn=null,Kr=null,Mn=0,Ta=0,Nf=Wt(0),Bn=0,_m=null,Wc=0,Zo=0,Uf=0,ju=null,Zn=null,qv=0,Kh=1/0;function Bf(){Kh=hs()+500}var Sm=!1,_n=null,vc=null,Em=!1,qc=null,Ff=0,zf=0,Vu=null,mn=-1,Fn=0;function Ir(){return(sr&6)!==0?hs():mn!==-1?mn:mn=hs()}function yc(_){return(_.mode&1)===0?1:(sr&2)!==0&&Mn!==0?Mn&-Mn:YT.transition!==null?(Fn===0&&(_=Fc,Fc<<=1,(Fc&4194240)===0&&(Fc=64),Fn=_),Fn):(_=fr,_!==0?_:He())}function Ca(_,S,D){if(50<zf)throw zf=0,Vu=null,Error(a(185));var N=Zh(_,S);return N===null?null:(df(N,S,D),((sr&2)===0||N!==qn)&&(N===qn&&((sr&2)===0&&(Zo|=S),Bn===4&&Qs(N,Mn)),Po(N,D),S===1&&sr===0&&(_.mode&1)===0&&(Bf(),sx&&Ml())),N)}function Zh(_,S){_.lanes|=S;var D=_.alternate;for(D!==null&&(D.lanes|=S),D=_,_=_.return;_!==null;)_.childLanes|=S,D=_.alternate,D!==null&&(D.childLanes|=S),D=_,_=_.return;return D.tag===3?D.stateNode:null}function Po(_,S){var D=_.callbackNode;$T(_,S);var N=bv(_,_===qn?Mn:0);if(N===0)D!==null&&rm(D),_.callbackNode=null,_.callbackPriority=0;else if(S=N&-N,_.callbackPriority!==S){if(D!=null&&rm(D),S===1)_.tag===0?ox(Qo.bind(null,_)):ax(Qo.bind(null,_)),$e?ze(function(){sr===0&&Ml()}):ff(pf,Ml),D=null;else{switch(Mu(N)){case 1:D=pf;break;case 4:D=NL;break;case 16:D=rx;break;case 536870912:D=nx;break;default:D=rx}D=zx(D,Zs.bind(null,_))}_.callbackPriority=S,_.callbackNode=D}}function Zs(_,S){if(mn=-1,Fn=0,(sr&6)!==0)throw Error(a(327));var D=_.callbackNode;if(Xc()&&_.callbackNode!==D)return null;var N=bv(_,_===qn?Mn:0);if(N===0)return null;if((N&30)!==0||(N&_.expiredLanes)!==0||S)S=Kv(_,N);else{S=N;var H=sr;sr|=2;var ie=wS();(qn!==_||Mn!==S)&&(Bf(),Hu(_,S));do try{hC();break}catch(Ge){bS(_,Ge)}while(!0);eo(),Wv.current=ie,sr=H,Kr!==null?S=0:(qn=null,Mn=0,S=Bn)}if(S!==0){if(S===2&&(H=ex(_),H!==0&&(N=H,S=Xv(_,H))),S===1)throw D=_m,Hu(_,0),Qs(_,N),Po(_,hs()),D;if(S===6)Qs(_,N);else{if(H=_.current.alternate,(N&30)===0&&!xS(H)&&(S=Kv(_,N),S===2&&(ie=ex(_),ie!==0&&(N=ie,S=Xv(_,ie))),S===1))throw D=_m,Hu(_,0),Qs(_,N),Po(_,hs()),D;switch(_.finishedWork=H,_.finishedLanes=N,S){case 0:case 1:throw Error(a(345));case 2:xc(_,Zn);break;case 3:if(Qs(_,N),(N&130023424)===N&&(S=qv+500-hs(),10<S)){if(bv(_,0)!==0)break;if(H=_.suspendedLanes,(H&N)!==N){Ir(),_.pingedLanes|=_.suspendedLanes&H;break}_.timeoutHandle=le(xc.bind(null,_,Zn),S);break}xc(_,Zn);break;case 4:if(Qs(_,N),(N&4194240)===N)break;for(S=_.eventTimes,H=-1;0<N;){var Ee=31-bn(N);ie=1<<Ee,Ee=S[Ee],Ee>H&&(H=Ee),N&=~ie}if(N=H,N=hs()-N,N=(120>N?120:480>N?480:1080>N?1080:1920>N?1920:3e3>N?3e3:4320>N?4320:1960*yS(N/1960))-N,10<N){_.timeoutHandle=le(xc.bind(null,_,Zn),N);break}xc(_,Zn);break;case 5:xc(_,Zn);break;default:throw Error(a(329))}}}return Po(_,hs()),_.callbackNode===D?Zs.bind(null,_):null}function Xv(_,S){var D=ju;return _.current.memoizedState.isDehydrated&&(Hu(_,S).flags|=256),_=Kv(_,S),_!==2&&(S=Zn,Zn=D,S!==null&&$v(S)),_}function $v(_){Zn===null?Zn=_:Zn.push.apply(Zn,_)}function xS(_){for(var S=_;;){if(S.flags&16384){var D=S.updateQueue;if(D!==null&&(D=D.stores,D!==null))for(var N=0;N<D.length;N++){var H=D[N],ie=H.getSnapshot;H=H.value;try{if(!Ja(ie(),H))return!1}catch{return!1}}}if(D=S.child,S.subtreeFlags&16384&&D!==null)D.return=S,S=D;else{if(S===_)break;for(;S.sibling===null;){if(S.return===null||S.return===_)return!0;S=S.return}S.sibling.return=S.return,S=S.sibling}}return!0}function Qs(_,S){for(S&=~Uf,S&=~Zo,_.suspendedLanes|=S,_.pingedLanes&=~S,_=_.expirationTimes;0<S;){var D=31-bn(S),N=1<<D;_[D]=-1,S&=~N}}function Qo(_){if((sr&6)!==0)throw Error(a(327));Xc();var S=bv(_,0);if((S&1)===0)return Po(_,hs()),null;var D=Kv(_,S);if(_.tag!==0&&D===2){var N=ex(_);N!==0&&(S=N,D=Xv(_,N))}if(D===1)throw D=_m,Hu(_,0),Qs(_,S),Po(_,hs()),D;if(D===6)throw Error(a(345));return _.finishedWork=_.current.alternate,_.finishedLanes=S,xc(_,Zn),Po(_,hs()),null}function Am(_){qc!==null&&qc.tag===0&&(sr&6)===0&&Xc();var S=sr;sr|=1;var D=Yr.transition,N=fr;try{if(Yr.transition=null,fr=1,_)return _()}finally{fr=N,Yr.transition=D,sr=S,(sr&6)===0&&Ml()}}function Yv(){Ta=Nf.current,ne(Nf)}function Hu(_,S){_.finishedWork=null,_.finishedLanes=0;var D=_.timeoutHandle;if(D!==ve&&(_.timeoutHandle=ve,he(D)),Kr!==null)for(D=Kr.return;D!==null;){var N=D;switch($_(N),N.tag){case 1:N=N.type.childContextTypes,N!=null&&nn();break;case 3:dm(),ne(Pe),ne(me),_f();break;case 5:Z_(N);break;case 4:dm();break;case 13:ne(In);break;case 19:ne(In);break;case 10:Av(N.type._context);break;case 22:case 23:Yv()}D=D.return}if(qn=_,Kr=_=Gu(_.current,null),Mn=Ta=S,Bn=0,_m=null,Uf=Zo=Wc=0,Zn=ju=null,Tl!==null){for(S=0;S<Tl.length;S++)if(D=Tl[S],N=D.interleaved,N!==null){D.interleaved=null;var H=N.next,ie=D.pending;if(ie!==null){var Ee=ie.next;ie.next=H,N.next=Ee}D.pending=N}Tl=null}return _}function bS(_,S){do{var D=Kr;try{if(eo(),Tv.current=vm,xx){for(var N=Dn.memoizedState;N!==null;){var H=N.queue;H!==null&&(H.pending=null),N=N.next}xx=!1}if(Sf=0,Ts=Ms=Dn=null,Vc=!1,Ef=0,gc.current=null,D===null||D.return===null){Bn=1,_m=S,Kr=null;break}e:{var ie=_,Ee=D.return,Ge=D,vt=S;if(S=Mn,Ge.flags|=32768,vt!==null&&typeof vt=="object"&&typeof vt.then=="function"){var Ot=vt,ri=Ge,$i=ri.tag;if((ri.mode&1)===0&&($i===0||$i===11||$i===15)){var Ci=ri.alternate;Ci?(ri.updateQueue=Ci.updateQueue,ri.memoizedState=Ci.memoizedState,ri.lanes=Ci.lanes):(ri.updateQueue=null,ri.memoizedState=null)}var ur=oS(Ee);if(ur!==null){ur.flags&=-257,Mf(ur,Ee,Ge,ie,S),ur.mode&1&&Ou(ie,Ot,S),S=ur,vt=Ot;var Yt=S.updateQueue;if(Yt===null){var Js=new Set;Js.add(vt),S.updateQueue=Js}else Yt.add(vt);break e}else{if((S&1)===0){Ou(ie,Ot,S),Fx();break e}vt=Error(a(426))}}else if(An&&Ge.mode&1){var el=oS(Ee);if(el!==null){(el.flags&65536)===0&&(el.flags|=256),Mf(el,Ee,Ge,ie,S),gx(vt);break e}}ie=vt,Bn!==4&&(Bn=2),ju===null?ju=[ie]:ju.push(ie),vt=aS(vt,Ge),Ge=Ee;do{switch(Ge.tag){case 3:Ge.flags|=65536,S&=-S,Ge.lanes|=S;var tt=lC(Ge,vt,S);ux(Ge,tt);break e;case 1:ie=vt;var We=Ge.type,ut=Ge.stateNode;if((Ge.flags&128)===0&&(typeof We.getDerivedStateFromError=="function"||ut!==null&&typeof ut.componentDidCatch=="function"&&(vc===null||!vc.has(ut)))){Ge.flags|=65536,S&=-S,Ge.lanes|=S;var qt=Px(Ge,ie,S);ux(Ge,qt);break e}}Ge=Ge.return}while(Ge!==null)}SS(D)}catch(vi){S=vi,Kr===D&&D!==null&&(Kr=D=D.return);continue}break}while(!0)}function wS(){var _=Wv.current;return Wv.current=vm,_===null?vm:_}function Fx(){(Bn===0||Bn===3||Bn===2)&&(Bn=4),qn===null||(Wc&268435455)===0&&(Zo&268435455)===0||Qs(qn,Mn)}function Kv(_,S){var D=sr;sr|=2;var N=wS();qn===_&&Mn===S||Hu(_,S);do try{uC();break}catch(H){bS(_,H)}while(!0);if(eo(),sr=D,Wv.current=N,Kr!==null)throw Error(a(261));return qn=null,Mn=0,Bn}function uC(){for(;Kr!==null;)_S(Kr)}function hC(){for(;Kr!==null&&!zh();)_S(Kr)}function _S(_){var S=MS(_.alternate,_,Ta);_.memoizedProps=_.pendingProps,S===null?SS(_):Kr=S,gc.current=null}function SS(_){var S=_;do{var D=S.alternate;if(_=S.return,(S.flags&32768)===0){if(D=Dx(D,S,Ta),D!==null){Kr=D;return}}else{if(D=kx(D,S),D!==null){D.flags&=32767,Kr=D;return}if(_!==null)_.flags|=32768,_.subtreeFlags=0,_.deletions=null;else{Bn=6,Kr=null;return}}if(S=S.sibling,S!==null){Kr=S;return}Kr=S=_}while(S!==null);Bn===0&&(Bn=5)}function xc(_,S){var D=fr,N=Yr.transition;try{Yr.transition=null,fr=1,dC(_,S,D)}finally{Yr.transition=N,fr=D}return null}function dC(_,S,D){do Xc();while(qc!==null);if((sr&6)!==0)throw Error(a(327));var N=_.finishedWork,H=_.finishedLanes;if(N===null)return null;if(_.finishedWork=null,_.finishedLanes=0,N===_.current)throw Error(a(177));_.callbackNode=null,_.callbackPriority=0;var ie=N.lanes|N.childLanes;if(ix(_,ie),_===qn&&(Kr=qn=null,Mn=0),(N.subtreeFlags&2064)===0&&(N.flags&2064)===0||Em||(Em=!0,zx(rx,function(){return Xc(),null})),ie=(N.flags&15990)!==0,(N.subtreeFlags&15990)!==0||ie){ie=Yr.transition,Yr.transition=null;var Ee=fr;fr=1;var Ge=sr;sr|=4,gc.current=null,dS(_,N),FL(_,N),Z(_.containerInfo),_.current=N,zv(N),kL(),sr=Ge,fr=Ee,Yr.transition=ie}else _.current=N;if(Em&&(Em=!1,qc=_,Ff=H),ie=_.pendingLanes,ie===0&&(vc=null),_v(N.stateNode),Po(_,hs()),S!==null)for(D=_.onRecoverableError,N=0;N<S.length;N++)D(S[N]);if(Sm)throw Sm=!1,_=_n,_n=null,_;return(Ff&1)!==0&&_.tag!==0&&Xc(),ie=_.pendingLanes,(ie&1)!==0?_===Vu?zf++:(zf=0,Vu=_):zf=0,Ml(),null}function Xc(){if(qc!==null){var _=Mu(Ff),S=Yr.transition,D=fr;try{if(Yr.transition=null,fr=16>_?16:_,qc===null)var N=!1;else{if(_=qc,qc=null,Ff=0,(sr&6)!==0)throw Error(a(331));var H=sr;for(sr|=4,zt=_.current;zt!==null;){var ie=zt,Ee=ie.child;if((zt.flags&16)!==0){var Ge=ie.deletions;if(Ge!==null){for(var vt=0;vt<Ge.length;vt++){var Ot=Ge[vt];for(zt=Ot;zt!==null;){var ri=zt;switch(ri.tag){case 0:case 11:case 15:Bu(8,ri,ie)}var $i=ri.child;if($i!==null)$i.return=ri,zt=$i;else for(;zt!==null;){ri=zt;var Ci=ri.sibling,ur=ri.return;if(fS(ri),ri===Ot){zt=null;break}if(Ci!==null){Ci.return=ur,zt=Ci;break}zt=ur}}}var Yt=ie.alternate;if(Yt!==null){var Js=Yt.child;if(Js!==null){Yt.child=null;do{var el=Js.sibling;Js.sibling=null,Js=el}while(Js!==null)}}zt=ie}}if((ie.subtreeFlags&2064)!==0&&Ee!==null)Ee.return=ie,zt=Ee;else e:for(;zt!==null;){if(ie=zt,(ie.flags&2048)!==0)switch(ie.tag){case 0:case 11:case 15:Bu(9,ie,ie.return)}var tt=ie.sibling;if(tt!==null){tt.return=ie.return,zt=tt;break e}zt=ie.return}}var We=_.current;for(zt=We;zt!==null;){Ee=zt;var ut=Ee.child;if((Ee.subtreeFlags&2064)!==0&&ut!==null)ut.return=Ee,zt=ut;else e:for(Ee=We;zt!==null;){if(Ge=zt,(Ge.flags&2048)!==0)try{switch(Ge.tag){case 0:case 11:case 15:Ks(9,Ge)}}catch(vi){so(Ge,Ge.return,vi)}if(Ge===Ee){zt=null;break e}var qt=Ge.sibling;if(qt!==null){qt.return=Ge.return,zt=qt;break e}zt=Ge.return}}if(sr=H,Ml(),jc&&typeof jc.onPostCommitFiberRoot=="function")try{jc.onPostCommitFiberRoot(wv,_)}catch{}N=!0}return N}finally{fr=D,Yr.transition=S}}return!1}function Zv(_,S,D){S=aS(D,S),S=lC(_,S,1),jh(_,S),S=Ir(),_=Zh(_,1),_!==null&&(df(_,1,S),Po(_,S))}function so(_,S,D){if(_.tag===3)Zv(_,_,D);else for(;S!==null;){if(S.tag===3){Zv(S,_,D);break}else if(S.tag===1){var N=S.stateNode;if(typeof S.type.getDerivedStateFromError=="function"||typeof N.componentDidCatch=="function"&&(vc===null||!vc.has(N))){_=aS(D,_),_=Px(S,_,1),jh(S,_),_=Ir(),S=Zh(S,1),S!==null&&(df(S,1,_),Po(S,_));break}}S=S.return}}function ES(_,S,D){var N=_.pingCache;N!==null&&N.delete(S),S=Ir(),_.pingedLanes|=_.suspendedLanes&D,qn===_&&(Mn&D)===D&&(Bn===4||Bn===3&&(Mn&130023424)===Mn&&500>hs()-qv?Hu(_,0):Uf|=D),Po(_,S)}function AS(_,S){S===0&&((_.mode&1)===0?S=1:(S=cr,cr<<=1,(cr&130023424)===0&&(cr=4194304)));var D=Ir();_=Zh(_,S),_!==null&&(df(_,S,D),Po(_,D))}function fC(_){var S=_.memoizedState,D=0;S!==null&&(D=S.retryLane),AS(_,D)}function pC(_,S){var D=0;switch(_.tag){case 13:var N=_.stateNode,H=_.memoizedState;H!==null&&(D=H.retryLane);break;case 19:N=_.stateNode;break;default:throw Error(a(314))}N!==null&&N.delete(S),AS(_,D)}var MS;MS=function(_,S,D){if(_!==null)if(_.memoizedProps!==S.pendingProps||Pe.current)Ps=!0;else{if((_.lanes&D)===0&&(S.flags&128)===0)return Ps=!1,Lx(_,S,D);Ps=(_.flags&131072)!==0}else Ps=!1,An&&(S.flags&1048576)!==0&&eC(S,px,S.index);switch(S.lanes=0,S.tag){case 2:var N=S.type;_!==null&&(_.alternate=null,S.alternate=null,S.flags|=2),_=S.pendingProps;var H=Qi(S,me.current);nm(S,D),H=fm(null,S,N,_,H,D);var ie=Wh();return S.flags|=1,typeof H=="object"&&H!==null&&typeof H.render=="function"&&H.$$typeof===void 0?(S.tag=1,S.memoizedState=null,S.updateQueue=null,_i(N)?(ie=!0,Eo(S)):ie=!1,S.memoizedState=H.state!==null&&H.state!==void 0?H.state:null,sm(S),H.updater=dx,S.stateNode=H,H._reactInternals=S,q_(S,N,_,D),S=Ma(null,S,N,!0,ie,D)):(S.tag=0,An&&ie&&X_(S),Un(null,S,H,D),S=S.child),S;case 16:N=S.elementType;e:{switch(_!==null&&(_.alternate=null,S.alternate=null,S.flags|=2),_=S.pendingProps,H=N._init,N=H(N._payload),S.type=N,H=S.tag=zL(N),_=Ao(N,_),H){case 0:S=Nu(null,S,N,_,D);break e;case 1:S=Cf(null,S,N,_,D);break e;case 11:S=pn(null,S,N,_,D);break e;case 14:S=sn(null,S,N,Ao(N.type,_),D);break e}throw Error(a(306,N,""))}return S;case 0:return N=S.type,H=S.pendingProps,H=S.elementType===N?H:Ao(N,H),Nu(_,S,N,H,D);case 1:return N=S.type,H=S.pendingProps,H=S.elementType===N?H:Ao(N,H),Cf(_,S,N,H,D);case 3:e:{if(Nv(S),_===null)throw Error(a(387));N=S.pendingProps,ie=S.memoizedState,H=ie.element,H_(_,S),hx(S,N,null,D);var Ee=S.memoizedState;if(N=Ee.element,ce&&ie.isDehydrated)if(ie={element:N,isDehydrated:!1,cache:Ee.cache,transitions:Ee.transitions},S.updateQueue.baseState=ie,S.memoizedState=ie,S.flags&256){H=Error(a(423)),S=cS(_,S,N,D,H);break e}else if(N!==H){H=Error(a(424)),S=cS(_,S,N,D,H);break e}else for(ce&&($s=qe(S.stateNode.containerInfo),to=S,An=!0,Rl=null,om=!1),D=rC(S,null,N,D),S.child=D;D;)D.flags=D.flags&-3|4096,D=D.sibling;else{if(lm(),N===H){S=Co(_,S,D);break e}Un(_,S,N,D)}S=S.child}return S;case 5:return nC(S),_===null&&Hh(S),N=S.type,H=S.pendingProps,ie=_!==null?_.memoizedProps:null,Ee=H.children,se(N,H)?Ee=null:ie!==null&&se(N,ie)&&(S.flags|=32),io(_,S),Un(_,S,Ee,D),S.child;case 6:return _===null&&Hh(S),null;case 13:return uS(_,S,D);case 4:return vx(S,S.stateNode.containerInfo),N=S.pendingProps,_===null?S.child=Iu(S,null,N,D):Un(_,S,N,D),S.child;case 11:return N=S.type,H=S.pendingProps,H=S.elementType===N?H:Ao(N,H),pn(_,S,N,H,D);case 7:return Un(_,S,S.pendingProps,D),S.child;case 8:return Un(_,S,S.pendingProps.children,D),S.child;case 12:return Un(_,S,S.pendingProps.children,D),S.child;case 10:e:{if(N=S.type._context,H=S.pendingProps,ie=S.memoizedProps,Ee=H.value,gf(S,N,Ee),ie!==null)if(Ja(ie.value,Ee)){if(ie.children===H.children&&!Pe.current){S=Co(_,S,D);break e}}else for(ie=S.child,ie!==null&&(ie.return=S);ie!==null;){var Ge=ie.dependencies;if(Ge!==null){Ee=ie.child;for(var vt=Ge.firstContext;vt!==null;){if(vt.context===N){if(ie.tag===1){vt=Cu(-1,D&-D),vt.tag=2;var Ot=ie.updateQueue;if(Ot!==null){Ot=Ot.shared;var ri=Ot.pending;ri===null?vt.next=vt:(vt.next=ri.next,ri.next=vt),Ot.pending=vt}}ie.lanes|=D,vt=ie.alternate,vt!==null&&(vt.lanes|=D),vf(ie.return,D,S),Ge.lanes|=D;break}vt=vt.next}}else if(ie.tag===10)Ee=ie.type===S.type?null:ie.child;else if(ie.tag===18){if(Ee=ie.return,Ee===null)throw Error(a(341));Ee.lanes|=D,Ge=Ee.alternate,Ge!==null&&(Ge.lanes|=D),vf(Ee,D,S),Ee=ie.sibling}else Ee=ie.child;if(Ee!==null)Ee.return=ie;else for(Ee=ie;Ee!==null;){if(Ee===S){Ee=null;break}if(ie=Ee.sibling,ie!==null){ie.return=Ee.return,Ee=ie;break}Ee=Ee.return}ie=Ee}Un(_,S,H.children,D),S=S.child}return S;case 9:return H=S.type,N=S.pendingProps.children,nm(S,D),H=Mo(H),N=N(H),S.flags|=1,Un(_,S,N,D),S.child;case 14:return N=S.type,H=Ao(N,S.pendingProps),H=Ao(N.type,H),sn(_,S,N,H,D);case 15:return ku(_,S,S.type,S.pendingProps,D);case 17:return N=S.type,H=S.pendingProps,H=S.elementType===N?H:Ao(N,H),_!==null&&(_.alternate=null,S.alternate=null,S.flags|=2),S.tag=1,_i(N)?(_=!0,Eo(S)):_=!1,nm(S,D),QT(S,N,H),q_(S,N,H,D),Ma(null,S,N,!0,_,D);case 19:return Rf(_,S,D);case 22:return Ys(_,S,D)}throw Error(a(156,S.tag))};function zx(_,S){return ff(_,S)}function mC(_,S,D,N){this.tag=_,this.key=D,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=S,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=N,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Jo(_,S,D,N){return new mC(_,S,D,N)}function jx(_){return _=_.prototype,!(!_||!_.isReactComponent)}function zL(_){if(typeof _=="function")return jx(_)?1:0;if(_!=null){if(_=_.$$typeof,_===g)return 11;if(_===b)return 14}return 2}function Gu(_,S){var D=_.alternate;return D===null?(D=Jo(_.tag,S,_.key,_.mode),D.elementType=_.elementType,D.type=_.type,D.stateNode=_.stateNode,D.alternate=_,_.alternate=D):(D.pendingProps=S,D.type=_.type,D.flags=0,D.subtreeFlags=0,D.deletions=null),D.flags=_.flags&14680064,D.childLanes=_.childLanes,D.lanes=_.lanes,D.child=_.child,D.memoizedProps=_.memoizedProps,D.memoizedState=_.memoizedState,D.updateQueue=_.updateQueue,S=_.dependencies,D.dependencies=S===null?null:{lanes:S.lanes,firstContext:S.firstContext},D.sibling=_.sibling,D.index=_.index,D.ref=_.ref,D}function Vx(_,S,D,N,H,ie){var Ee=2;if(N=_,typeof _=="function")jx(_)&&(Ee=1);else if(typeof _=="string")Ee=5;else e:switch(_){case u:return jf(D.children,H,ie,S);case h:Ee=8,H|=8;break;case d:return _=Jo(12,D,S,H|2),_.elementType=d,_.lanes=ie,_;case m:return _=Jo(13,D,S,H),_.elementType=m,_.lanes=ie,_;case y:return _=Jo(19,D,S,H),_.elementType=y,_.lanes=ie,_;case E:return Qv(D,H,ie,S);default:if(typeof _=="object"&&_!==null)switch(_.$$typeof){case f:Ee=10;break e;case p:Ee=9;break e;case g:Ee=11;break e;case b:Ee=14;break e;case w:Ee=16,N=null;break e}throw Error(a(130,_==null?_:typeof _,""))}return S=Jo(Ee,D,S,H),S.elementType=_,S.type=N,S.lanes=ie,S}function jf(_,S,D,N){return _=Jo(7,_,N,S),_.lanes=D,_}function Qv(_,S,D,N){return _=Jo(22,_,N,S),_.elementType=E,_.lanes=D,_.stateNode={},_}function Hx(_,S,D){return _=Jo(6,_,null,S),_.lanes=D,_}function Gx(_,S,D){return S=Jo(4,_.children!==null?_.children:[],_.key,S),S.lanes=D,S.stateNode={containerInfo:_.containerInfo,pendingChildren:null,implementation:_.implementation},S}function Wx(_,S,D,N,H){this.tag=S,this.containerInfo=_,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=ve,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=tx(0),this.expirationTimes=tx(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=tx(0),this.identifierPrefix=N,this.onRecoverableError=H,ce&&(this.mutableSourceEagerHydrationData=null)}function gC(_,S,D,N,H,ie,Ee,Ge,vt){return _=new Wx(_,S,D,Ge,vt),S===1?(S=1,ie===!0&&(S|=8)):S=0,ie=Jo(3,null,null,S),_.current=ie,ie.stateNode=_,ie.memoizedState={element:N,isDehydrated:D,cache:null,transitions:null},sm(ie),_}function vC(_){if(!_)return _e;_=_._reactInternals;e:{if(R(_)!==_||_.tag!==1)throw Error(a(170));var S=_;do{switch(S.tag){case 3:S=S.stateNode.context;break e;case 1:if(_i(S.type)){S=S.stateNode.__reactInternalMemoizedMergedChildContext;break e}}S=S.return}while(S!==null);throw Error(a(171))}if(_.tag===1){var D=_.type;if(_i(D))return Hn(_,D,S)}return S}function yC(_){var S=_._reactInternals;if(S===void 0)throw typeof _.render=="function"?Error(a(188)):(_=Object.keys(_).join(","),Error(a(268,_)));return _=z(S),_===null?null:_.stateNode}function Ol(_,S){if(_=_.memoizedState,_!==null&&_.dehydrated!==null){var D=_.retryLane;_.retryLane=D!==0&&D<S?D:S}}function Jv(_,S){Ol(_,S),(_=_.alternate)&&Ol(_,S)}function qx(_){return _=z(_),_===null?null:_.stateNode}function xC(){return null}return i.attemptContinuousHydration=function(_){if(_.tag===13){var S=Ir();Ca(_,134217728,S),Jv(_,134217728)}},i.attemptHydrationAtCurrentPriority=function(_){if(_.tag===13){var S=Ir(),D=yc(_);Ca(_,D,S),Jv(_,D)}},i.attemptSynchronousHydration=function(_){switch(_.tag){case 3:var S=_.stateNode;if(S.current.memoizedState.isDehydrated){var D=im(S.pendingLanes);D!==0&&(zc(S,D|1),Po(S,hs()),(sr&6)===0&&(Bf(),Ml()))}break;case 13:var N=Ir();Am(function(){return Ca(_,1,N)}),Jv(_,1)}},i.batchedUpdates=function(_,S){var D=sr;sr|=1;try{return _(S)}finally{sr=D,sr===0&&(Bf(),sx&&Ml())}},i.createComponentSelector=function(_){return{$$typeof:Vv,value:_}},i.createContainer=function(_,S,D,N,H,ie,Ee){return gC(_,S,!1,null,D,N,H,ie,Ee)},i.createHasPseudoClassSelector=function(_){return{$$typeof:Of,value:_}},i.createHydrationContainer=function(_,S,D,N,H,ie,Ee,Ge,vt){return _=gC(D,N,!0,_,H,ie,Ee,Ge,vt),_.context=vC(null),D=_.current,N=Ir(),H=yc(D),ie=Cu(N,H),ie.callback=S??null,jh(D,ie),_.current.lanes=H,df(_,H,N),Po(_,N),_},i.createPortal=function(_,S,D){var N=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:c,key:N==null?null:""+N,children:_,containerInfo:S,implementation:D}},i.createRoleSelector=function(_){return{$$typeof:Lf,value:_}},i.createTestNameSelector=function(_){return{$$typeof:Fu,value:_}},i.createTextSelector=function(_){return{$$typeof:wm,value:_}},i.deferredUpdates=function(_){var S=fr,D=Yr.transition;try{return Yr.transition=null,fr=16,_()}finally{fr=S,Yr.transition=D}},i.discreteUpdates=function(_,S,D,N,H){var ie=fr,Ee=Yr.transition;try{return Yr.transition=null,fr=1,_(S,D,N,H)}finally{fr=ie,Yr.transition=Ee,sr===0&&Bf()}},i.findAllNodes=zu,i.findBoundingRects=function(_,S){if(!it)throw Error(a(363));S=zu(_,S),_=[];for(var D=0;D<S.length;D++)_.push(ge(S[D]));for(S=_.length-1;0<S;S--){D=_[S];for(var N=D.x,H=N+D.width,ie=D.y,Ee=ie+D.height,Ge=S-1;0<=Ge;Ge--)if(S!==Ge){var vt=_[Ge],Ot=vt.x,ri=Ot+vt.width,$i=vt.y,Ci=$i+vt.height;if(N>=Ot&&ie>=$i&&H<=ri&&Ee<=Ci){_.splice(S,1);break}else if(N!==Ot||D.width!==vt.width||Ci<ie||$i>Ee){if(!(ie!==$i||D.height!==vt.height||ri<N||Ot>H)){Ot>N&&(vt.width+=Ot-N,vt.x=N),ri<H&&(vt.width=H-Ot),_.splice(S,1);break}}else{$i>ie&&(vt.height+=$i-ie,vt.y=ie),Ci<Ee&&(vt.height=Ee-$i),_.splice(S,1);break}}}return _},i.findHostInstance=yC,i.findHostInstanceWithNoPortals=function(_){return _=k(_),_=_!==null?F(_):null,_===null?null:_.stateNode},i.findHostInstanceWithWarning=function(_){return yC(_)},i.flushControlled=function(_){var S=sr;sr|=1;var D=Yr.transition,N=fr;try{Yr.transition=null,fr=1,_()}finally{fr=N,Yr.transition=D,sr=S,sr===0&&(Bf(),Ml())}},i.flushPassiveEffects=Xc,i.flushSync=Am,i.focusWithin=function(_,S){if(!it)throw Error(a(363));for(_=Hv(_),S=Ko(_,S),S=Array.from(S),_=0;_<S.length;){var D=S[_++];if(!Q(D)){if(D.tag===5&&te(D.stateNode))return!0;for(D=D.child;D!==null;)S.push(D),D=D.sibling}}return!1},i.getCurrentUpdatePriority=function(){return fr},i.getFindAllNodesFailureDescription=function(_,S){if(!it)throw Error(a(363));var D=0,N=[];_=[Hv(_),0];for(var H=0;H<_.length;){var ie=_[H++],Ee=_[H++],Ge=S[Ee];if((ie.tag!==5||!Q(ie))&&(Gv(ie,Ge)&&(N.push(Yh(Ge)),Ee++,Ee>D&&(D=Ee)),Ee<S.length))for(ie=ie.child;ie!==null;)_.push(ie,Ee),ie=ie.sibling}if(D<S.length){for(_=[];D<S.length;D++)_.push(Yh(S[D]));return`findAllNodes was able to match part of the selector:
  `+(N.join(" > ")+`

No matching component was found for:
  `)+_.join(" > ")}return null},i.getPublicRootInstance=function(_){if(_=_.current,!_.child)return null;switch(_.child.tag){case 5:return K(_.child.stateNode);default:return _.child.stateNode}},i.injectIntoDevTools=function(_){if(_={bundleType:_.bundleType,version:_.version,rendererPackageName:_.rendererPackageName,rendererConfig:_.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:o.ReactCurrentDispatcher,findHostInstanceByFiber:qx,findFiberByHostInstance:_.findFiberByHostInstance||xC,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.0.0-fc46dba67-20220329"},typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u")_=!1;else{var S=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(S.isDisabled||!S.supportsFiber)_=!0;else{try{wv=S.inject(_),jc=S}catch{}_=!!S.checkDCE}}return _},i.isAlreadyRendering=function(){return!1},i.observeVisibleRects=function(_,S,D,N){if(!it)throw Error(a(363));_=zu(_,S);var H=Ne(_,D,N).disconnect;return{disconnect:function(){H()}}},i.registerMutableSourceForHydration=function(_,S){var D=S._getVersion;D=D(S._source),_.mutableSourceEagerHydrationData==null?_.mutableSourceEagerHydrationData=[S,D]:_.mutableSourceEagerHydrationData.push(S,D)},i.runWithPriority=function(_,S){var D=fr;try{return fr=_,S()}finally{fr=D}},i.shouldError=function(){return null},i.shouldSuspend=function(){return!1},i.updateContainer=function(_,S,D,N){var H=S.current,ie=Ir(),Ee=yc(H);return D=vC(D),S.context===null?S.context=D:S.pendingContext=D,S=Cu(ie,Ee),S.payload={element:_},N=N===void 0?null:N,N!==null&&(S.callback=N),jh(H,S),_=Ca(H,Ee,ie),_!==null&&cx(_,H,Ee),Ee},i}),nB}var jY;function YBe(){return jY||(jY=1,tB.exports=$Be()),tB.exports}var KBe=YBe();const ZBe=Lh(KBe);var sB={exports:{}},aB={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var VY;function QBe(){return VY||(VY=1,(function(t){function e(U,Y){var Z=U.length;U.push(Y);e:for(;0<Z;){var j=Z-1>>>1,ee=U[j];if(0<n(ee,Y))U[j]=Y,U[Z]=ee,Z=j;else break e}}function i(U){return U.length===0?null:U[0]}function r(U){if(U.length===0)return null;var Y=U[0],Z=U.pop();if(Z!==Y){U[0]=Z;e:for(var j=0,ee=U.length,pe=ee>>>1;j<pe;){var fe=2*(j+1)-1,se=U[fe],re=fe+1,le=U[re];if(0>n(se,Z))re<ee&&0>n(le,se)?(U[j]=le,U[re]=Z,j=re):(U[j]=se,U[fe]=Z,j=fe);else if(re<ee&&0>n(le,Z))U[j]=le,U[re]=Z,j=re;else break e}}return Y}function n(U,Y){var Z=U.sortIndex-Y.sortIndex;return Z!==0?Z:U.id-Y.id}if(typeof performance=="object"&&typeof performance.now=="function"){var s=performance;t.unstable_now=function(){return s.now()}}else{var a=Date,o=a.now();t.unstable_now=function(){return a.now()-o}}var l=[],c=[],u=1,h=null,d=3,f=!1,p=!1,g=!1,m=typeof setTimeout=="function"?setTimeout:null,y=typeof clearTimeout=="function"?clearTimeout:null,b=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function w(U){for(var Y=i(c);Y!==null;){if(Y.callback===null)r(c);else if(Y.startTime<=U)r(c),Y.sortIndex=Y.expirationTime,e(l,Y);else break;Y=i(c)}}function E(U){if(g=!1,w(U),!p)if(i(l)!==null)p=!0,K(M);else{var Y=i(c);Y!==null&&X(E,Y.startTime-U)}}function M(U,Y){p=!1,g&&(g=!1,y(C),C=-1),f=!0;var Z=d;try{for(w(Y),h=i(l);h!==null&&(!(h.expirationTime>Y)||U&&!k());){var j=h.callback;if(typeof j=="function"){h.callback=null,d=h.priorityLevel;var ee=j(h.expirationTime<=Y);Y=t.unstable_now(),typeof ee=="function"?h.callback=ee:h===i(l)&&r(l),w(Y)}else r(l);h=i(l)}if(h!==null)var pe=!0;else{var fe=i(c);fe!==null&&X(E,fe.startTime-Y),pe=!1}return pe}finally{h=null,d=Z,f=!1}}var A=!1,P=null,C=-1,R=5,I=-1;function k(){return!(t.unstable_now()-I<R)}function z(){if(P!==null){var U=t.unstable_now();I=U;var Y=!0;try{Y=P(!0,U)}finally{Y?V():(A=!1,P=null)}}else A=!1}var V;if(typeof b=="function")V=function(){b(z)};else if(typeof MessageChannel<"u"){var F=new MessageChannel,$=F.port2;F.port1.onmessage=z,V=function(){$.postMessage(null)}}else V=function(){m(z,0)};function K(U){P=U,A||(A=!0,V())}function X(U,Y){C=m(function(){U(t.unstable_now())},Y)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(U){U.callback=null},t.unstable_continueExecution=function(){p||f||(p=!0,K(M))},t.unstable_forceFrameRate=function(U){0>U||125<U?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):R=0<U?Math.floor(1e3/U):5},t.unstable_getCurrentPriorityLevel=function(){return d},t.unstable_getFirstCallbackNode=function(){return i(l)},t.unstable_next=function(U){switch(d){case 1:case 2:case 3:var Y=3;break;default:Y=d}var Z=d;d=Y;try{return U()}finally{d=Z}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(U,Y){switch(U){case 1:case 2:case 3:case 4:case 5:break;default:U=3}var Z=d;d=U;try{return Y()}finally{d=Z}},t.unstable_scheduleCallback=function(U,Y,Z){var j=t.unstable_now();switch(typeof Z=="object"&&Z!==null?(Z=Z.delay,Z=typeof Z=="number"&&0<Z?j+Z:j):Z=j,U){case 1:var ee=-1;break;case 2:ee=250;break;case 5:ee=1073741823;break;case 4:ee=1e4;break;default:ee=5e3}return ee=Z+ee,U={id:u++,callback:Y,priorityLevel:U,startTime:Z,expirationTime:ee,sortIndex:-1},Z>j?(U.sortIndex=Z,e(c,U),i(l)===null&&U===i(c)&&(g?(y(C),C=-1):g=!0,X(E,Z-j))):(U.sortIndex=ee,e(l,U),p||f||(p=!0,K(M))),U},t.unstable_shouldYield=k,t.unstable_wrapCallback=function(U){var Y=d;return function(){var Z=d;d=Y;try{return U.apply(this,arguments)}finally{d=Z}}}})(aB)),aB}var HY;function JBe(){return HY||(HY=1,sB.exports=QBe()),sB.exports}var GY=JBe();const AH={},eFe=t=>void Object.assign(AH,t);function tFe(t,e){function i(u,{args:h=[],attach:d,...f},p){let g=`${u[0].toUpperCase()}${u.slice(1)}`,m;if(u==="primitive"){if(f.object===void 0)throw new Error("R3F: Primitives without 'object' are invalid!");const y=f.object;m=Sw(y,{type:u,root:p,attach:d,primitive:!0})}else{const y=AH[g];if(!y)throw new Error(`R3F: ${g} is not part of the THREE namespace! Did you forget to extend? See: https://docs.pmnd.rs/react-three-fiber/api/objects#using-3rd-party-objects-declaratively`);if(!Array.isArray(h))throw new Error("R3F: The args prop must be an array!");m=Sw(new y(...h),{type:u,root:p,attach:d,memoizedProps:{args:h}})}return m.__r3f.attach===void 0&&(m.isBufferGeometry?m.__r3f.attach="geometry":m.isMaterial&&(m.__r3f.attach="material")),g!=="inject"&&cB(m,f),m}function r(u,h){let d=!1;if(h){var f,p;(f=h.__r3f)!=null&&f.attach?lB(u,h,h.__r3f.attach):h.isObject3D&&u.isObject3D&&(u.add(h),d=!0),d||(p=u.__r3f)==null||p.objects.push(h),h.__r3f||Sw(h,{}),h.__r3f.parent=u,sj(h),Ew(h)}}function n(u,h,d){let f=!1;if(h){var p,g;if((p=h.__r3f)!=null&&p.attach)lB(u,h,h.__r3f.attach);else if(h.isObject3D&&u.isObject3D){h.parent=u,h.dispatchEvent({type:"added"}),u.dispatchEvent({type:"childadded",child:h});const m=u.children.filter(b=>b!==h),y=m.indexOf(d);u.children=[...m.slice(0,y),h,...m.slice(y)],f=!0}f||(g=u.__r3f)==null||g.objects.push(h),h.__r3f||Sw(h,{}),h.__r3f.parent=u,sj(h),Ew(h)}}function s(u,h,d=!1){u&&[...u].forEach(f=>a(h,f,d))}function a(u,h,d){if(h){var f,p,g;if(h.__r3f&&(h.__r3f.parent=null),(f=u.__r3f)!=null&&f.objects&&(u.__r3f.objects=u.__r3f.objects.filter(E=>E!==h)),(p=h.__r3f)!=null&&p.attach)YY(u,h,h.__r3f.attach);else if(h.isObject3D&&u.isObject3D){var m;u.remove(h),(m=h.__r3f)!=null&&m.root&&lFe(KR(h),h)}const b=(g=h.__r3f)==null?void 0:g.primitive,w=!b&&(d===void 0?h.dispose!==null:d);if(!b){var y;s((y=h.__r3f)==null?void 0:y.objects,h,w),s(h.children,h,w)}if(delete h.__r3f,w&&h.dispose&&h.type!=="Scene"){const E=()=>{try{h.dispose()}catch{}};typeof IS_REACT_ACT_ENVIRONMENT>"u"?GY.unstable_scheduleCallback(GY.unstable_IdlePriority,E):E()}Ew(u)}}function o(u,h,d,f){var p;const g=(p=u.__r3f)==null?void 0:p.parent;if(!g)return;const m=i(h,d,u.__r3f.root);if(u.children){for(const y of u.children)y.__r3f&&r(m,y);u.children=u.children.filter(y=>!y.__r3f)}u.__r3f.objects.forEach(y=>r(m,y)),u.__r3f.objects=[],u.__r3f.autoRemovedBeforeAppend||a(g,u),m.parent&&(m.__r3f.autoRemovedBeforeAppend=!0),r(g,m),m.raycast&&m.__r3f.eventCount&&KR(m).getState().internal.interaction.push(m),[f,f.alternate].forEach(y=>{y!==null&&(y.stateNode=m,y.ref&&(typeof y.ref=="function"?y.ref(m):y.ref.current=m))})}const l=()=>{};return{reconciler:ZBe({createInstance:i,removeChild:a,appendChild:r,appendInitialChild:r,insertBefore:n,supportsMutation:!0,isPrimaryRenderer:!1,supportsPersistence:!1,supportsHydration:!1,noTimeout:-1,appendChildToContainer:(u,h)=>{if(!h)return;const d=u.getState().scene;d.__r3f&&(d.__r3f.root=u,r(d,h))},removeChildFromContainer:(u,h)=>{h&&a(u.getState().scene,h)},insertInContainerBefore:(u,h,d)=>{if(!h||!d)return;const f=u.getState().scene;f.__r3f&&n(f,h,d)},getRootHostContext:()=>null,getChildHostContext:u=>u,finalizeInitialChildren(u){var h;return!!((h=u?.__r3f)!=null?h:{}).handlers},prepareUpdate(u,h,d,f){var p;if(((p=u?.__r3f)!=null?p:{}).primitive&&f.object&&f.object!==u)return[!0];{const{args:m=[],children:y,...b}=f,{args:w=[],children:E,...M}=d;if(!Array.isArray(m))throw new Error("R3F: the args prop must be an array!");if(m.some((P,C)=>P!==w[C]))return[!0];const A=ice(u,b,M,!0);return A.changes.length?[!1,A]:null}},commitUpdate(u,[h,d],f,p,g,m){h?o(u,f,g,m):cB(u,d)},commitMount(u,h,d,f){var p;const g=(p=u.__r3f)!=null?p:{};u.raycast&&g.handlers&&g.eventCount&&KR(u).getState().internal.interaction.push(u)},getPublicInstance:u=>u,prepareForCommit:()=>null,preparePortalMount:u=>Sw(u.getState().scene),resetAfterCommit:()=>{},shouldSetTextContent:()=>!1,clearContainer:()=>!1,hideInstance(u){var h;const{attach:d,parent:f}=(h=u.__r3f)!=null?h:{};d&&f&&YY(f,u,d),u.isObject3D&&(u.visible=!1),Ew(u)},unhideInstance(u,h){var d;const{attach:f,parent:p}=(d=u.__r3f)!=null?d:{};f&&p&&lB(p,u,f),(u.isObject3D&&h.visible==null||h.visible)&&(u.visible=!0),Ew(u)},createTextInstance:l,hideTextInstance:l,unhideTextInstance:l,getCurrentEventPriority:()=>e?e():qw.DefaultEventPriority,beforeActiveInstanceBlur:()=>{},afterActiveInstanceBlur:()=>{},detachDeletedInstance:()=>{},now:typeof performance<"u"&&Ln.fun(performance.now)?performance.now:Ln.fun(Date.now)?Date.now:()=>0,scheduleTimeout:Ln.fun(setTimeout)?setTimeout:void 0,cancelTimeout:Ln.fun(clearTimeout)?clearTimeout:void 0}),applyProps:cB}}var WY,qY;const oB=t=>"colorSpace"in t||"outputColorSpace"in t,Kle=()=>{var t;return(t=AH.ColorManagement)!=null?t:null},Zle=t=>t&&t.isOrthographicCamera,iFe=t=>t&&t.hasOwnProperty("current"),TT=typeof window<"u"&&((WY=window.document)!=null&&WY.createElement||((qY=window.navigator)==null?void 0:qY.product)==="ReactNative")?J.useLayoutEffect:J.useEffect;function Qle(t){const e=J.useRef(t);return TT(()=>void(e.current=t),[t]),e}function rFe({set:t}){return TT(()=>(t(new Promise(()=>null)),()=>t(!1)),[t]),null}class Jle extends J.Component{constructor(...e){super(...e),this.state={error:!1}}componentDidCatch(e){this.props.set(e)}render(){return this.state.error?null:this.props.children}}Jle.getDerivedStateFromError=()=>({error:!0});const ece="__default",XY=new Map,nFe=t=>t&&!!t.memoized&&!!t.changes;function tce(t){var e;const i=typeof window<"u"?(e=window.devicePixelRatio)!=null?e:2:1;return Array.isArray(t)?Math.min(Math.max(t[0],i),t[1]):t}const tE=t=>{var e;return(e=t.__r3f)==null?void 0:e.root.getState()};function KR(t){let e=t.__r3f.root;for(;e.getState().previousRoot;)e=e.getState().previousRoot;return e}const Ln={obj:t=>t===Object(t)&&!Ln.arr(t)&&typeof t!="function",fun:t=>typeof t=="function",str:t=>typeof t=="string",num:t=>typeof t=="number",boo:t=>typeof t=="boolean",und:t=>t===void 0,arr:t=>Array.isArray(t),equ(t,e,{arrays:i="shallow",objects:r="reference",strict:n=!0}={}){if(typeof t!=typeof e||!!t!=!!e)return!1;if(Ln.str(t)||Ln.num(t)||Ln.boo(t))return t===e;const s=Ln.obj(t);if(s&&r==="reference")return t===e;const a=Ln.arr(t);if(a&&i==="reference")return t===e;if((a||s)&&t===e)return!0;let o;for(o in t)if(!(o in e))return!1;if(s&&i==="shallow"&&r==="shallow"){for(o in n?e:t)if(!Ln.equ(t[o],e[o],{strict:n,objects:"reference"}))return!1}else for(o in n?e:t)if(t[o]!==e[o])return!1;if(Ln.und(o)){if(a&&t.length===0&&e.length===0||s&&Object.keys(t).length===0&&Object.keys(e).length===0)return!0;if(t!==e)return!1}return!0}};function sFe(t){t.dispose&&t.type!=="Scene"&&t.dispose();for(const e in t)e.dispose==null||e.dispose(),delete t[e]}function Sw(t,e){const i=t;return i.__r3f={type:"",root:null,previousAttach:null,memoizedProps:{},eventCount:0,handlers:{},objects:[],parent:null,...e},t}function nj(t,e){let i=t;if(e.includes("-")){const r=e.split("-"),n=r.pop();return i=r.reduce((s,a)=>s[a],t),{target:i,key:n}}else return{target:i,key:e}}const $Y=/-\d+$/;function lB(t,e,i){if(Ln.str(i)){if($Y.test(i)){const s=i.replace($Y,""),{target:a,key:o}=nj(t,s);Array.isArray(a[o])||(a[o]=[])}const{target:r,key:n}=nj(t,i);e.__r3f.previousAttach=r[n],r[n]=e}else e.__r3f.previousAttach=i(t,e)}function YY(t,e,i){var r,n;if(Ln.str(i)){const{target:s,key:a}=nj(t,i),o=e.__r3f.previousAttach;o===void 0?delete s[a]:s[a]=o}else(r=e.__r3f)==null||r.previousAttach==null||r.previousAttach(t,e);(n=e.__r3f)==null||delete n.previousAttach}function ice(t,{children:e,key:i,ref:r,...n},{children:s,key:a,ref:o,...l}={},c=!1){const u=t.__r3f,h=Object.entries(n),d=[];if(c){const p=Object.keys(l);for(let g=0;g<p.length;g++)n.hasOwnProperty(p[g])||h.unshift([p[g],ece+"remove"])}h.forEach(([p,g])=>{var m;if((m=t.__r3f)!=null&&m.primitive&&p==="object"||Ln.equ(g,l[p]))return;if(/^on(Pointer|Click|DoubleClick|ContextMenu|Wheel)/.test(p))return d.push([p,g,!0,[]]);let y=[];p.includes("-")&&(y=p.split("-")),d.push([p,g,!1,y]);for(const b in n){const w=n[b];b.startsWith(`${p}-`)&&d.push([b,w,!1,b.split("-")])}});const f={...n};return u!=null&&u.memoizedProps&&u!=null&&u.memoizedProps.args&&(f.args=u.memoizedProps.args),u!=null&&u.memoizedProps&&u!=null&&u.memoizedProps.attach&&(f.attach=u.memoizedProps.attach),{memoized:f,changes:d}}function cB(t,e){var i;const r=t.__r3f,n=r?.root,s=n==null||n.getState==null?void 0:n.getState(),{memoized:a,changes:o}=nFe(e)?e:ice(t,e),l=r?.eventCount;t.__r3f&&(t.__r3f.memoizedProps=a);for(let d=0;d<o.length;d++){let[f,p,g,m]=o[d];if(oB(t)){const E="srgb",M="srgb-linear";f==="encoding"?(f="colorSpace",p=p===3001?E:M):f==="outputEncoding"&&(f="outputColorSpace",p=p===3001?E:M)}let y=t,b=y[f];if(m.length&&(b=m.reduce((w,E)=>w[E],t),!(b&&b.set))){const[w,...E]=m.reverse();y=E.reverse().reduce((M,A)=>M[A],t),f=w}if(p===ece+"remove")if(y.constructor){let w=XY.get(y.constructor);w||(w=new y.constructor,XY.set(y.constructor,w)),p=w[f]}else p=0;if(g&&r)p?r.handlers[f]=p:delete r.handlers[f],r.eventCount=Object.keys(r.handlers).length;else if(b&&b.set&&(b.copy||b instanceof p0)){if(Array.isArray(p))b.fromArray?b.fromArray(p):b.set(...p);else if(b.copy&&p&&p.constructor&&b.constructor===p.constructor)b.copy(p);else if(p!==void 0){var c;const w=(c=b)==null?void 0:c.isColor;!w&&b.setScalar?b.setScalar(p):b instanceof p0&&p instanceof p0?b.mask=p.mask:b.set(p),!Kle()&&s&&!s.linear&&w&&b.convertSRGBToLinear()}}else{var u;if(y[f]=p,(u=y[f])!=null&&u.isTexture&&y[f].format===zo&&y[f].type===_u&&s){const w=y[f];oB(w)&&oB(s.gl)?w.colorSpace=s.gl.outputColorSpace:w.encoding=s.gl.outputEncoding}}Ew(t)}if(r&&r.parent&&t.raycast&&l!==r.eventCount){const d=KR(t).getState().internal,f=d.interaction.indexOf(t);f>-1&&d.interaction.splice(f,1),r.eventCount&&d.interaction.push(t)}return!(o.length===1&&o[0][0]==="onUpdate")&&o.length&&(i=t.__r3f)!=null&&i.parent&&sj(t),t}function Ew(t){var e,i;const r=(e=t.__r3f)==null||(i=e.root)==null||i.getState==null?void 0:i.getState();r&&r.internal.frames===0&&r.invalidate()}function sj(t){t.onUpdate==null||t.onUpdate(t)}function aFe(t,e){t.manual||(Zle(t)?(t.left=e.width/-2,t.right=e.width/2,t.top=e.height/2,t.bottom=e.height/-2):t.aspect=e.width/e.height,t.updateProjectionMatrix(),t.updateMatrixWorld())}function rP(t){return(t.eventObject||t.object).uuid+"/"+t.index+t.instanceId}function oFe(){var t;const e=typeof self<"u"&&self||typeof window<"u"&&window;if(!e)return qw.DefaultEventPriority;switch((t=e.event)==null?void 0:t.type){case"click":case"contextmenu":case"dblclick":case"pointercancel":case"pointerdown":case"pointerup":return qw.DiscreteEventPriority;case"pointermove":case"pointerout":case"pointerover":case"pointerenter":case"pointerleave":case"wheel":return qw.ContinuousEventPriority;default:return qw.DefaultEventPriority}}function rce(t,e,i,r){const n=i.get(e);n&&(i.delete(e),i.size===0&&(t.delete(r),n.target.releasePointerCapture(r)))}function lFe(t,e){const{internal:i}=t.getState();i.interaction=i.interaction.filter(r=>r!==e),i.initialHits=i.initialHits.filter(r=>r!==e),i.hovered.forEach((r,n)=>{(r.eventObject===e||r.object===e)&&i.hovered.delete(n)}),i.capturedMap.forEach((r,n)=>{rce(i.capturedMap,e,r,n)})}function cFe(t){function e(l){const{internal:c}=t.getState(),u=l.offsetX-c.initialClick[0],h=l.offsetY-c.initialClick[1];return Math.round(Math.sqrt(u*u+h*h))}function i(l){return l.filter(c=>["Move","Over","Enter","Out","Leave"].some(u=>{var h;return(h=c.__r3f)==null?void 0:h.handlers["onPointer"+u]}))}function r(l,c){const u=t.getState(),h=new Set,d=[],f=c?c(u.internal.interaction):u.internal.interaction;for(let y=0;y<f.length;y++){const b=tE(f[y]);b&&(b.raycaster.camera=void 0)}u.previousRoot||u.events.compute==null||u.events.compute(l,u);function p(y){const b=tE(y);if(!b||!b.events.enabled||b.raycaster.camera===null)return[];if(b.raycaster.camera===void 0){var w;b.events.compute==null||b.events.compute(l,b,(w=b.previousRoot)==null?void 0:w.getState()),b.raycaster.camera===void 0&&(b.raycaster.camera=null)}return b.raycaster.camera?b.raycaster.intersectObject(y,!0):[]}let g=f.flatMap(p).sort((y,b)=>{const w=tE(y.object),E=tE(b.object);return!w||!E?y.distance-b.distance:E.events.priority-w.events.priority||y.distance-b.distance}).filter(y=>{const b=rP(y);return h.has(b)?!1:(h.add(b),!0)});u.events.filter&&(g=u.events.filter(g,u));for(const y of g){let b=y.object;for(;b;){var m;(m=b.__r3f)!=null&&m.eventCount&&d.push({...y,eventObject:b}),b=b.parent}}if("pointerId"in l&&u.internal.capturedMap.has(l.pointerId))for(let y of u.internal.capturedMap.get(l.pointerId).values())h.has(rP(y.intersection))||d.push(y.intersection);return d}function n(l,c,u,h){const d=t.getState();if(l.length){const f={stopped:!1};for(const p of l){const g=tE(p.object)||d,{raycaster:m,pointer:y,camera:b,internal:w}=g,E=new be(y.x,y.y,0).unproject(b),M=I=>{var k,z;return(k=(z=w.capturedMap.get(I))==null?void 0:z.has(p.eventObject))!=null?k:!1},A=I=>{const k={intersection:p,target:c.target};w.capturedMap.has(I)?w.capturedMap.get(I).set(p.eventObject,k):w.capturedMap.set(I,new Map([[p.eventObject,k]])),c.target.setPointerCapture(I)},P=I=>{const k=w.capturedMap.get(I);k&&rce(w.capturedMap,p.eventObject,k,I)};let C={};for(let I in c){let k=c[I];typeof k!="function"&&(C[I]=k)}let R={...p,...C,pointer:y,intersections:l,stopped:f.stopped,delta:u,unprojectedPoint:E,ray:m.ray,camera:b,stopPropagation(){const I="pointerId"in c&&w.capturedMap.get(c.pointerId);if((!I||I.has(p.eventObject))&&(R.stopped=f.stopped=!0,w.hovered.size&&Array.from(w.hovered.values()).find(k=>k.eventObject===p.eventObject))){const k=l.slice(0,l.indexOf(p));s([...k,p])}},target:{hasPointerCapture:M,setPointerCapture:A,releasePointerCapture:P},currentTarget:{hasPointerCapture:M,setPointerCapture:A,releasePointerCapture:P},nativeEvent:c};if(h(R),f.stopped===!0)break}}return l}function s(l){const{internal:c}=t.getState();for(const u of c.hovered.values())if(!l.length||!l.find(h=>h.object===u.object&&h.index===u.index&&h.instanceId===u.instanceId)){const d=u.eventObject.__r3f,f=d?.handlers;if(c.hovered.delete(rP(u)),d!=null&&d.eventCount){const p={...u,intersections:l};f.onPointerOut==null||f.onPointerOut(p),f.onPointerLeave==null||f.onPointerLeave(p)}}}function a(l,c){for(let u=0;u<c.length;u++){const h=c[u].__r3f;h==null||h.handlers.onPointerMissed==null||h.handlers.onPointerMissed(l)}}function o(l){switch(l){case"onPointerLeave":case"onPointerCancel":return()=>s([]);case"onLostPointerCapture":return c=>{const{internal:u}=t.getState();"pointerId"in c&&u.capturedMap.has(c.pointerId)&&requestAnimationFrame(()=>{u.capturedMap.has(c.pointerId)&&(u.capturedMap.delete(c.pointerId),s([]))})}}return function(u){const{onPointerMissed:h,internal:d}=t.getState();d.lastEvent.current=u;const f=l==="onPointerMove",p=l==="onClick"||l==="onContextMenu"||l==="onDoubleClick",m=r(u,f?i:void 0),y=p?e(u):0;l==="onPointerDown"&&(d.initialClick=[u.offsetX,u.offsetY],d.initialHits=m.map(w=>w.eventObject)),p&&!m.length&&y<=2&&(a(u,d.interaction),h&&h(u)),f&&s(m);function b(w){const E=w.eventObject,M=E.__r3f,A=M?.handlers;if(M!=null&&M.eventCount)if(f){if(A.onPointerOver||A.onPointerEnter||A.onPointerOut||A.onPointerLeave){const P=rP(w),C=d.hovered.get(P);C?C.stopped&&w.stopPropagation():(d.hovered.set(P,w),A.onPointerOver==null||A.onPointerOver(w),A.onPointerEnter==null||A.onPointerEnter(w))}A.onPointerMove==null||A.onPointerMove(w)}else{const P=A[l];P?(!p||d.initialHits.includes(E))&&(a(u,d.interaction.filter(C=>!d.initialHits.includes(C))),P(w)):p&&d.initialHits.includes(E)&&a(u,d.interaction.filter(C=>!d.initialHits.includes(C)))}}n(m,u,y,b)}}return{handlePointer:o}}const nce=t=>!!(t!=null&&t.render),sce=J.createContext(null),uFe=(t,e)=>{const i=WBe((o,l)=>{const c=new be,u=new be,h=new be;function d(y=l().camera,b=u,w=l().size){const{width:E,height:M,top:A,left:P}=w,C=E/M;b.isVector3?h.copy(b):h.set(...b);const R=y.getWorldPosition(c).distanceTo(h);if(Zle(y))return{width:E/y.zoom,height:M/y.zoom,top:A,left:P,factor:1,distance:R,aspect:C};{const I=y.fov*Math.PI/180,k=2*Math.tan(I/2)*R,z=k*(E/M);return{width:z,height:k,top:A,left:P,factor:E/z,distance:R,aspect:C}}}let f;const p=y=>o(b=>({performance:{...b.performance,current:y}})),g=new At;return{set:o,get:l,gl:null,camera:null,raycaster:null,events:{priority:1,enabled:!0,connected:!1},xr:null,scene:null,invalidate:(y=1)=>t(l(),y),advance:(y,b)=>e(y,b,l()),legacy:!1,linear:!1,flat:!1,controls:null,clock:new xH,pointer:g,mouse:g,frameloop:"always",onPointerMissed:void 0,performance:{current:1,min:.5,max:1,debounce:200,regress:()=>{const y=l();f&&clearTimeout(f),y.performance.current!==y.performance.min&&p(y.performance.min),f=setTimeout(()=>p(l().performance.max),y.performance.debounce)}},size:{width:0,height:0,top:0,left:0,updateStyle:!1},viewport:{initialDpr:0,dpr:0,width:0,height:0,top:0,left:0,aspect:0,distance:0,factor:0,getCurrentViewport:d},setEvents:y=>o(b=>({...b,events:{...b.events,...y}})),setSize:(y,b,w,E,M)=>{const A=l().camera,P={width:y,height:b,top:E||0,left:M||0,updateStyle:w};o(C=>({size:P,viewport:{...C.viewport,...d(A,u,P)}}))},setDpr:y=>o(b=>{const w=tce(y);return{viewport:{...b.viewport,dpr:w,initialDpr:b.viewport.initialDpr||w}}}),setFrameloop:(y="always")=>{const b=l().clock;b.stop(),b.elapsedTime=0,y!=="never"&&(b.start(),b.elapsedTime=0),o(()=>({frameloop:y}))},previousRoot:void 0,internal:{active:!1,priority:0,frames:0,lastEvent:J.createRef(),interaction:[],hovered:new Map,subscribers:[],initialClick:[0,0],initialHits:[],capturedMap:new Map,subscribe:(y,b,w)=>{const E=l().internal;return E.priority=E.priority+(b>0?1:0),E.subscribers.push({ref:y,priority:b,store:w}),E.subscribers=E.subscribers.sort((M,A)=>M.priority-A.priority),()=>{const M=l().internal;M!=null&&M.subscribers&&(M.priority=M.priority-(b>0?1:0),M.subscribers=M.subscribers.filter(A=>A.ref!==y))}}}}}),r=i.getState();let n=r.size,s=r.viewport.dpr,a=r.camera;return i.subscribe(()=>{const{camera:o,size:l,viewport:c,gl:u,set:h}=i.getState();if(l.width!==n.width||l.height!==n.height||c.dpr!==s){var d;n=l,s=c.dpr,aFe(o,l),u.setPixelRatio(c.dpr);const f=(d=l.updateStyle)!=null?d:typeof HTMLCanvasElement<"u"&&u.domElement instanceof HTMLCanvasElement;u.setSize(l.width,l.height,f)}o!==a&&(a=o,h(f=>({viewport:{...f.viewport,...f.viewport.getCurrentViewport(o)}})))}),i.subscribe(o=>t(o)),i};let nP,hFe=new Set,dFe=new Set,fFe=new Set;function uB(t,e){if(t.size)for(const{callback:i}of t.values())i(e)}function iE(t,e){switch(t){case"before":return uB(hFe,e);case"after":return uB(dFe,e);case"tail":return uB(fFe,e)}}let hB,dB;function fB(t,e,i){let r=e.clock.getDelta();for(e.frameloop==="never"&&typeof t=="number"&&(r=t-e.clock.elapsedTime,e.clock.oldTime=e.clock.elapsedTime,e.clock.elapsedTime=t),hB=e.internal.subscribers,nP=0;nP<hB.length;nP++)dB=hB[nP],dB.ref.current(dB.store.getState(),r,i);return!e.internal.priority&&e.gl.render&&e.gl.render(e.scene,e.camera),e.internal.frames=Math.max(0,e.internal.frames-1),e.frameloop==="always"?1:e.internal.frames}function pFe(t){let e=!1,i=!1,r,n,s;function a(c){n=requestAnimationFrame(a),e=!0,r=0,iE("before",c),i=!0;for(const h of t.values()){var u;s=h.store.getState(),s.internal.active&&(s.frameloop==="always"||s.internal.frames>0)&&!((u=s.gl.xr)!=null&&u.isPresenting)&&(r+=fB(c,s))}if(i=!1,iE("after",c),r===0)return iE("tail",c),e=!1,cancelAnimationFrame(n)}function o(c,u=1){var h;if(!c)return t.forEach(d=>o(d.store.getState(),u));(h=c.gl.xr)!=null&&h.isPresenting||!c.internal.active||c.frameloop==="never"||(u>1?c.internal.frames=Math.min(60,c.internal.frames+u):i?c.internal.frames=2:c.internal.frames=1,e||(e=!0,requestAnimationFrame(a)))}function l(c,u=!0,h,d){if(u&&iE("before",c),h)fB(c,h,d);else for(const f of t.values())fB(c,f.store.getState());u&&iE("after",c)}return{loop:a,invalidate:o,advance:l}}function ace(){const t=J.useContext(sce);if(!t)throw new Error("R3F: Hooks can only be used within the Canvas component!");return t}function pB(t=i=>i,e){return ace()(t,e)}function MH(t,e=0){const i=ace(),r=i.getState().internal.subscribe,n=Qle(t);return TT(()=>r(n,e,i),[e,r,i]),null}const F1=new Map,{invalidate:KY,advance:ZY}=pFe(F1),{reconciler:RD,applyProps:Ib}=tFe(F1,oFe),Db={objects:"shallow",strict:!1},mFe=(t,e)=>{const i=typeof t=="function"?t(e):t;return nce(i)?i:new Yle({powerPreference:"high-performance",canvas:e,antialias:!0,alpha:!0,...t})};function gFe(t,e){const i=typeof HTMLCanvasElement<"u"&&t instanceof HTMLCanvasElement;if(e){const{width:r,height:n,top:s,left:a,updateStyle:o=i}=e;return{width:r,height:n,top:s,left:a,updateStyle:o}}else if(typeof HTMLCanvasElement<"u"&&t instanceof HTMLCanvasElement&&t.parentElement){const{width:r,height:n,top:s,left:a}=t.parentElement.getBoundingClientRect();return{width:r,height:n,top:s,left:a,updateStyle:i}}else if(typeof OffscreenCanvas<"u"&&t instanceof OffscreenCanvas)return{width:t.width,height:t.height,top:0,left:0,updateStyle:i};return{width:0,height:0,top:0,left:0}}function vFe(t){const e=F1.get(t),i=e?.fiber,r=e?.store;e&&console.warn("R3F.createRoot should only be called once!");const n=typeof reportError=="function"?reportError:console.error,s=r||uFe(KY,ZY),a=i||RD.createContainer(s,qw.ConcurrentRoot,null,!1,null,"",n,null);e||F1.set(t,{fiber:a,store:s});let o,l=!1,c;return{configure(u={}){let{gl:h,size:d,scene:f,events:p,onCreated:g,shadows:m=!1,linear:y=!1,flat:b=!1,legacy:w=!1,orthographic:E=!1,frameloop:M="always",dpr:A=[1,2],performance:P,raycaster:C,camera:R,onPointerMissed:I}=u,k=s.getState(),z=k.gl;k.gl||k.set({gl:z=mFe(h,t)});let V=k.raycaster;V||k.set({raycaster:V=new jle});const{params:F,...$}=C||{};if(Ln.equ($,V,Db)||Ib(V,{...$}),Ln.equ(F,V.params,Db)||Ib(V,{params:{...V.params,...F}}),!k.camera||k.camera===c&&!Ln.equ(c,R,Db)){c=R;const Z=R instanceof yT,j=Z?R:E?new MT(0,0,0,0,.1,1e3):new ja(75,0,.1,1e3);Z||(j.position.z=5,R&&(Ib(j,R),("aspect"in R||"left"in R||"right"in R||"bottom"in R||"top"in R)&&(j.manual=!0,j.updateProjectionMatrix())),!k.camera&&!(R!=null&&R.rotation)&&j.lookAt(0,0,0)),k.set({camera:j}),V.camera=j}if(!k.scene){let Z;f!=null&&f.isScene?Z=f:(Z=new J6,f&&Ib(Z,f)),k.set({scene:Sw(Z)})}if(!k.xr){var K;const Z=(pe,fe)=>{const se=s.getState();se.frameloop!=="never"&&ZY(pe,!0,se,fe)},j=()=>{const pe=s.getState();pe.gl.xr.enabled=pe.gl.xr.isPresenting,pe.gl.xr.setAnimationLoop(pe.gl.xr.isPresenting?Z:null),pe.gl.xr.isPresenting||KY(pe)},ee={connect(){const pe=s.getState().gl;pe.xr.addEventListener("sessionstart",j),pe.xr.addEventListener("sessionend",j)},disconnect(){const pe=s.getState().gl;pe.xr.removeEventListener("sessionstart",j),pe.xr.removeEventListener("sessionend",j)}};typeof((K=z.xr)==null?void 0:K.addEventListener)=="function"&&ee.connect(),k.set({xr:ee})}if(z.shadowMap){const Z=z.shadowMap.enabled,j=z.shadowMap.type;if(z.shadowMap.enabled=!!m,Ln.boo(m))z.shadowMap.type=vA;else if(Ln.str(m)){var X;const ee={basic:Jae,percentage:mO,soft:vA,variance:ph};z.shadowMap.type=(X=ee[m])!=null?X:vA}else Ln.obj(m)&&Object.assign(z.shadowMap,m);(Z!==z.shadowMap.enabled||j!==z.shadowMap.type)&&(z.shadowMap.needsUpdate=!0)}const U=Kle();U&&("enabled"in U?U.enabled=!w:"legacyMode"in U&&(U.legacyMode=w)),l||Ib(z,{outputEncoding:y?3e3:3001,toneMapping:b?jd:N6}),k.legacy!==w&&k.set(()=>({legacy:w})),k.linear!==y&&k.set(()=>({linear:y})),k.flat!==b&&k.set(()=>({flat:b})),h&&!Ln.fun(h)&&!nce(h)&&!Ln.equ(h,z,Db)&&Ib(z,h),p&&!k.events.handlers&&k.set({events:p(s)});const Y=gFe(t,d);return Ln.equ(Y,k.size,Db)||k.setSize(Y.width,Y.height,Y.updateStyle,Y.top,Y.left),A&&k.viewport.dpr!==tce(A)&&k.setDpr(A),k.frameloop!==M&&k.setFrameloop(M),k.onPointerMissed||k.set({onPointerMissed:I}),P&&!Ln.equ(P,k.performance,Db)&&k.set(Z=>({performance:{...Z.performance,...P}})),o=g,l=!0,this},render(u){return l||this.configure(),RD.updateContainer(O.jsx(yFe,{store:s,children:u,onCreated:o,rootElement:t}),a,null,()=>{}),s},unmount(){oce(t)}}}function yFe({store:t,children:e,onCreated:i,rootElement:r}){return TT(()=>{const n=t.getState();n.set(s=>({internal:{...s.internal,active:!0}})),i&&i(n),t.getState().events.connected||n.events.connect==null||n.events.connect(r)},[]),O.jsx(sce.Provider,{value:t,children:e})}function oce(t,e){const i=F1.get(t),r=i?.fiber;if(r){const n=i?.store.getState();n&&(n.internal.active=!1),RD.updateContainer(null,r,null,()=>{n&&setTimeout(()=>{try{var s,a,o,l;n.events.disconnect==null||n.events.disconnect(),(s=n.gl)==null||(a=s.renderLists)==null||a.dispose==null||a.dispose(),(o=n.gl)==null||o.forceContextLoss==null||o.forceContextLoss(),(l=n.gl)!=null&&l.xr&&n.xr.disconnect(),sFe(n),F1.delete(t)}catch{}},500)})}}RD.injectIntoDevTools({bundleType:0,rendererPackageName:"@react-three/fiber",version:J.version});const mB={onClick:["click",!1],onContextMenu:["contextmenu",!1],onDoubleClick:["dblclick",!1],onWheel:["wheel",!0],onPointerDown:["pointerdown",!0],onPointerUp:["pointerup",!0],onPointerLeave:["pointerleave",!0],onPointerMove:["pointermove",!0],onPointerCancel:["pointercancel",!0],onLostPointerCapture:["lostpointercapture",!0]};function xFe(t){const{handlePointer:e}=cFe(t);return{priority:1,enabled:!0,compute(i,r,n){r.pointer.set(i.offsetX/r.size.width*2-1,-(i.offsetY/r.size.height)*2+1),r.raycaster.setFromCamera(r.pointer,r.camera)},connected:void 0,handlers:Object.keys(mB).reduce((i,r)=>({...i,[r]:e(r)}),{}),update:()=>{var i;const{events:r,internal:n}=t.getState();(i=n.lastEvent)!=null&&i.current&&r.handlers&&r.handlers.onPointerMove(n.lastEvent.current)},connect:i=>{var r;const{set:n,events:s}=t.getState();s.disconnect==null||s.disconnect(),n(a=>({events:{...a.events,connected:i}})),Object.entries((r=s.handlers)!=null?r:[]).forEach(([a,o])=>{const[l,c]=mB[a];i.addEventListener(l,o,{passive:c})})},disconnect:()=>{const{set:i,events:r}=t.getState();if(r.connected){var n;Object.entries((n=r.handlers)!=null?n:[]).forEach(([s,a])=>{if(r&&r.connected instanceof HTMLElement){const[o]=mB[s];r.connected.removeEventListener(o,a)}}),i(s=>({events:{...s.events,connected:void 0}}))}}}}function QY(t,e){let i;return(...r)=>{window.clearTimeout(i),i=window.setTimeout(()=>t(...r),e)}}function bFe({debounce:t,scroll:e,polyfill:i,offsetSize:r}={debounce:0,scroll:!1,offsetSize:!1}){const n=i||(typeof window>"u"?class{}:window.ResizeObserver);if(!n)throw new Error("This browser does not support ResizeObserver out of the box. See: https://github.com/react-spring/react-use-measure/#resize-observer-polyfills");const[s,a]=J.useState({left:0,top:0,width:0,height:0,bottom:0,right:0,x:0,y:0}),o=J.useRef({element:null,scrollContainers:null,resizeObserver:null,lastBounds:s,orientationHandler:null}),l=t?typeof t=="number"?t:t.scroll:null,c=t?typeof t=="number"?t:t.resize:null,u=J.useRef(!1);J.useEffect(()=>(u.current=!0,()=>void(u.current=!1)));const[h,d,f]=J.useMemo(()=>{const y=()=>{if(!o.current.element)return;const{left:b,top:w,width:E,height:M,bottom:A,right:P,x:C,y:R}=o.current.element.getBoundingClientRect(),I={left:b,top:w,width:E,height:M,bottom:A,right:P,x:C,y:R};o.current.element instanceof HTMLElement&&r&&(I.height=o.current.element.offsetHeight,I.width=o.current.element.offsetWidth),Object.freeze(I),u.current&&!EFe(o.current.lastBounds,I)&&a(o.current.lastBounds=I)};return[y,c?QY(y,c):y,l?QY(y,l):y]},[a,r,l,c]);function p(){o.current.scrollContainers&&(o.current.scrollContainers.forEach(y=>y.removeEventListener("scroll",f,!0)),o.current.scrollContainers=null),o.current.resizeObserver&&(o.current.resizeObserver.disconnect(),o.current.resizeObserver=null),o.current.orientationHandler&&("orientation"in screen&&"removeEventListener"in screen.orientation?screen.orientation.removeEventListener("change",o.current.orientationHandler):"onorientationchange"in window&&window.removeEventListener("orientationchange",o.current.orientationHandler))}function g(){o.current.element&&(o.current.resizeObserver=new n(f),o.current.resizeObserver.observe(o.current.element),e&&o.current.scrollContainers&&o.current.scrollContainers.forEach(y=>y.addEventListener("scroll",f,{capture:!0,passive:!0})),o.current.orientationHandler=()=>{f()},"orientation"in screen&&"addEventListener"in screen.orientation?screen.orientation.addEventListener("change",o.current.orientationHandler):"onorientationchange"in window&&window.addEventListener("orientationchange",o.current.orientationHandler))}const m=y=>{!y||y===o.current.element||(p(),o.current.element=y,o.current.scrollContainers=lce(y),g())};return _Fe(f,!!e),wFe(d),J.useEffect(()=>{p(),g()},[e,f,d]),J.useEffect(()=>p,[]),[m,s,h]}function wFe(t){J.useEffect(()=>{const e=t;return window.addEventListener("resize",e),()=>void window.removeEventListener("resize",e)},[t])}function _Fe(t,e){J.useEffect(()=>{if(e){const i=t;return window.addEventListener("scroll",i,{capture:!0,passive:!0}),()=>void window.removeEventListener("scroll",i,!0)}},[t,e])}function lce(t){const e=[];if(!t||t===document.body)return e;const{overflow:i,overflowX:r,overflowY:n}=window.getComputedStyle(t);return[i,r,n].some(s=>s==="auto"||s==="scroll")&&e.push(t),[...e,...lce(t.parentElement)]}const SFe=["x","y","top","bottom","left","right","width","height"],EFe=(t,e)=>SFe.every(i=>t[i]===e[i]);var AFe=Object.defineProperty,MFe=Object.defineProperties,TFe=Object.getOwnPropertyDescriptors,JY=Object.getOwnPropertySymbols,CFe=Object.prototype.hasOwnProperty,PFe=Object.prototype.propertyIsEnumerable,eK=(t,e,i)=>e in t?AFe(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i,tK=(t,e)=>{for(var i in e||(e={}))CFe.call(e,i)&&eK(t,i,e[i]);if(JY)for(var i of JY(e))PFe.call(e,i)&&eK(t,i,e[i]);return t},RFe=(t,e)=>MFe(t,TFe(e)),iK,rK;typeof window<"u"&&((iK=window.document)!=null&&iK.createElement||((rK=window.navigator)==null?void 0:rK.product)==="ReactNative")?J.useLayoutEffect:J.useEffect;function cce(t,e,i){if(!t)return;if(i(t)===!0)return t;let r=t.child;for(;r;){const n=cce(r,e,i);if(n)return n;r=r.sibling}}function uce(t){try{return Object.defineProperties(t,{_currentRenderer:{get(){return null},set(){}},_currentRenderer2:{get(){return null},set(){}}})}catch{return t}}const nK=console.error;console.error=function(){const t=[...arguments].join("");if(t?.startsWith("Warning:")&&t.includes("useContext")){console.error=nK;return}return nK.apply(this,arguments)};const TH=uce(J.createContext(null));class hce extends J.Component{render(){return J.createElement(TH.Provider,{value:this._reactInternals},this.props.children)}}function IFe(){const t=J.useContext(TH);if(t===null)throw new Error("its-fine: useFiber must be called within a <FiberProvider />!");const e=J.useId();return J.useMemo(()=>{for(const r of[t,t?.alternate]){if(!r)continue;const n=cce(r,!1,s=>{let a=s.memoizedState;for(;a;){if(a.memoizedState===e)return!0;a=a.next}});if(n)return n}},[t,e])}function DFe(){const t=IFe(),[e]=J.useState(()=>new Map);e.clear();let i=t;for(;i;){if(i.type&&typeof i.type=="object"){const n=i.type._context===void 0&&i.type.Provider===i.type?i.type:i.type._context;n&&n!==TH&&!e.has(n)&&e.set(n,J.useContext(uce(n)))}i=i.return}return e}function OFe(){const t=DFe();return J.useMemo(()=>Array.from(t.keys()).reduce((e,i)=>r=>J.createElement(e,null,J.createElement(i.Provider,RFe(tK({},r),{value:t.get(i)}))),e=>J.createElement(hce,tK({},e))),[t])}const LFe=J.forwardRef(function({children:e,fallback:i,resize:r,style:n,gl:s,events:a=xFe,eventSource:o,eventPrefix:l,shadows:c,linear:u,flat:h,legacy:d,orthographic:f,frameloop:p,dpr:g,performance:m,raycaster:y,camera:b,scene:w,onPointerMissed:E,onCreated:M,...A},P){J.useMemo(()=>eFe(zBe),[]);const C=OFe(),[R,I]=bFe({scroll:!0,debounce:{scroll:50,resize:0},...r}),k=J.useRef(null),z=J.useRef(null);J.useImperativeHandle(P,()=>k.current);const V=Qle(E),[F,$]=J.useState(!1),[K,X]=J.useState(!1);if(F)throw F;if(K)throw K;const U=J.useRef(null);TT(()=>{const Z=k.current;I.width>0&&I.height>0&&Z&&(U.current||(U.current=vFe(Z)),U.current.configure({gl:s,events:a,shadows:c,linear:u,flat:h,legacy:d,orthographic:f,frameloop:p,dpr:g,performance:m,raycaster:y,camera:b,scene:w,size:I,onPointerMissed:(...j)=>V.current==null?void 0:V.current(...j),onCreated:j=>{j.events.connect==null||j.events.connect(o?iFe(o)?o.current:o:z.current),l&&j.setEvents({compute:(ee,pe)=>{const fe=ee[l+"X"],se=ee[l+"Y"];pe.pointer.set(fe/pe.size.width*2-1,-(se/pe.size.height)*2+1),pe.raycaster.setFromCamera(pe.pointer,pe.camera)}}),M?.(j)}}),U.current.render(O.jsx(C,{children:O.jsx(Jle,{set:X,children:O.jsx(J.Suspense,{fallback:O.jsx(rFe,{set:$}),children:e??null})})})))}),J.useEffect(()=>{const Z=k.current;if(Z)return()=>oce(Z)},[]);const Y=o?"none":"auto";return O.jsx("div",{ref:z,style:{position:"relative",width:"100%",height:"100%",overflow:"hidden",pointerEvents:Y,...n},...A,children:O.jsx("div",{ref:R,style:{width:"100%",height:"100%"},children:O.jsx("canvas",{ref:k,style:{display:"block"},children:i})})})}),kFe=J.forwardRef(function(e,i){return O.jsx(hce,{children:O.jsx(LFe,{...e,ref:i})})});function R0(){return R0=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var r in i)({}).hasOwnProperty.call(i,r)&&(t[r]=i[r])}return t},R0.apply(null,arguments)}function i1(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function sK(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(t,n).enumerable})),i.push.apply(i,r)}return i}function aK(t){for(var e=1;e<arguments.length;e++){var i=arguments[e]!=null?arguments[e]:{};e%2?sK(Object(i),!0).forEach(function(r){i1(t,r,i[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):sK(Object(i)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(i,r))})}return t}new At;new At;function dce(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var Qc=function t(e,i,r){var n=this;dce(this,t),i1(this,"dot2",function(s,a){return n.x*s+n.y*a}),i1(this,"dot3",function(s,a,o){return n.x*s+n.y*a+n.z*o}),this.x=e,this.y=i,this.z=r},NFe=[new Qc(1,1,0),new Qc(-1,1,0),new Qc(1,-1,0),new Qc(-1,-1,0),new Qc(1,0,1),new Qc(-1,0,1),new Qc(1,0,-1),new Qc(-1,0,-1),new Qc(0,1,1),new Qc(0,-1,1),new Qc(0,1,-1),new Qc(0,-1,-1)],oK=[151,160,137,91,90,15,131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23,190,6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,88,237,149,56,87,174,20,125,136,171,168,68,175,74,165,71,134,139,48,27,166,77,146,158,231,83,111,229,122,60,211,133,230,220,105,92,41,55,46,245,40,244,102,143,54,65,25,63,161,1,216,80,73,209,76,132,187,208,89,18,169,200,196,135,130,116,188,159,86,164,100,109,198,173,186,3,64,52,217,226,250,124,123,5,202,38,147,118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,223,183,170,213,119,248,152,2,44,154,163,70,221,153,101,155,167,43,172,9,129,22,39,253,19,98,108,110,79,113,224,232,178,185,112,104,218,246,97,228,251,34,242,193,238,210,144,12,191,179,162,241,81,51,145,235,249,14,239,107,49,192,214,31,181,199,106,157,184,84,204,176,115,121,50,45,127,4,150,254,138,236,205,93,222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180],lK=new Array(512),cK=new Array(512),UFe=function(e){e>0&&e<1&&(e*=65536),e=Math.floor(e),e<256&&(e|=e<<8);for(var i=0;i<256;i++){var r;i&1?r=oK[i]^e&255:r=oK[i]^e>>8&255,lK[i]=lK[i+256]=r,cK[i]=cK[i+256]=NFe[r%12]}};UFe(0);function BFe(t){if(typeof t=="number")t=Math.abs(t);else if(typeof t=="string"){var e=t;t=0;for(var i=0;i<e.length;i++)t=(t+(i+1)*(e.charCodeAt(i)%96))%2147483647}return t===0&&(t=311),t}function uK(t){var e=BFe(t);return function(){var i=e*48271%2147483647;return e=i,i/2147483647}}var FFe=function t(e){var i=this;dce(this,t),i1(this,"seed",0),i1(this,"init",function(r){i.seed=r,i.value=uK(r)}),i1(this,"value",uK(this.seed)),this.init(e)},zFe=new FFe(Math.random()),jFe={radius:1,center:[0,0,0]};function VFe(t,e){for(var i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:zFe,r=aK(aK({},jFe),e),n=r.radius,s=r.center,a=0;a<t.length;a+=3){var o=Math.pow(i.value(),.3333333333333333),l=i.value()*2-1,c=i.value()*2-1,u=i.value()*2-1,h=Math.sqrt(l*l+c*c+u*u);l=o*l/h,c=o*c/h,u=o*u/h,t[a]=l*n+s[0],t[a+1]=c*n+s[1],t[a+2]=u*n+s[2]}return t}const HFe=()=>parseInt(mT.replace(/\D+/g,"")),fce=HFe(),gB=fce>=154?"opaque_fragment":"output_fragment";class GFe extends IO{constructor(e){super(e),this.onBeforeCompile=(i,r)=>{const{isWebGL2:n}=r.capabilities;i.fragmentShader=i.fragmentShader.replace(`#include <${gB}>`,`
        ${n?`#include <${gB}>`:`#extension GL_OES_standard_derivatives : enable
#include <${gB}>`}
      vec2 cxy = 2.0 * gl_PointCoord - 1.0;
      float r = dot(cxy, cxy);
      float delta = fwidth(r);     
      float mask = 1.0 - smoothstep(1.0 - delta, 1.0 + delta, r);
      gl_FragColor = vec4(gl_FragColor.rgb, mask * gl_FragColor.a );
      #include <tonemapping_fragment>
      #include <${fce>=154?"colorspace_fragment":"encodings_fragment"}>
      `)}}}const WFe=J.forwardRef((t,e)=>{const[i]=J.useState(()=>new GFe(null));return J.createElement("primitive",R0({},t,{object:i,ref:e,attach:"material"}))});let Sy,rE;const qFe=J.createContext(null),hK=new zi,dK=new be,XFe=J.forwardRef(({children:t,range:e,limit:i=1e3,...r},n)=>{const s=J.useRef(null);J.useImperativeHandle(n,()=>s.current,[]);const[a,o]=J.useState([]),[[l,c,u]]=J.useState(()=>[new Float32Array(i*3),Float32Array.from({length:i*3},()=>1),Float32Array.from({length:i},()=>1)]);J.useEffect(()=>{s.current.geometry.attributes.position.needsUpdate=!0}),MH(()=>{for(s.current.updateMatrix(),s.current.updateMatrixWorld(),hK.copy(s.current.matrixWorld).invert(),s.current.geometry.drawRange.count=Math.min(i,e!==void 0?e:i,a.length),Sy=0;Sy<a.length;Sy++)rE=a[Sy].current,rE.getWorldPosition(dK).applyMatrix4(hK),dK.toArray(l,Sy*3),s.current.geometry.attributes.position.needsUpdate=!0,rE.matrixWorldNeedsUpdate=!0,rE.color.toArray(c,Sy*3),s.current.geometry.attributes.color.needsUpdate=!0,u.set([rE.size],Sy),s.current.geometry.attributes.size.needsUpdate=!0});const h=J.useMemo(()=>({getParent:()=>s,subscribe:d=>(o(f=>[...f,d]),()=>o(f=>f.filter(p=>p.current!==d.current)))}),[]);return J.createElement("points",R0({userData:{instances:a},matrixAutoUpdate:!1,ref:s,raycast:()=>null},r),J.createElement("bufferGeometry",null,J.createElement("bufferAttribute",{attach:"attributes-position",count:l.length/3,array:l,itemSize:3,usage:d0}),J.createElement("bufferAttribute",{attach:"attributes-color",count:c.length/3,array:c,itemSize:3,usage:d0}),J.createElement("bufferAttribute",{attach:"attributes-size",count:u.length,array:u,itemSize:1,usage:d0})),J.createElement(qFe.Provider,{value:h},t))}),$Fe=J.forwardRef(({children:t,positions:e,colors:i,sizes:r,stride:n=3,...s},a)=>{const o=J.useRef(null);return J.useImperativeHandle(a,()=>o.current,[]),MH(()=>{const l=o.current.geometry.attributes;l.position.needsUpdate=!0,i&&(l.color.needsUpdate=!0),r&&(l.size.needsUpdate=!0)}),J.createElement("points",R0({ref:o},s),J.createElement("bufferGeometry",null,J.createElement("bufferAttribute",{attach:"attributes-position",count:e.length/n,array:e,itemSize:n,usage:d0}),i&&J.createElement("bufferAttribute",{attach:"attributes-color",count:i.length/n,array:i,itemSize:3,usage:d0}),r&&J.createElement("bufferAttribute",{attach:"attributes-size",count:r.length/n,array:r,itemSize:1,usage:d0})),t)}),YFe=J.forwardRef((t,e)=>t.positions instanceof Float32Array?J.createElement($Fe,R0({},t,{ref:e})):J.createElement(XFe,R0({},t,{ref:e})));function KFe({all:t,scene:e,camera:i}){const r=pB(({gl:a})=>a),n=pB(({camera:a})=>a),s=pB(({scene:a})=>a);return J.useLayoutEffect(()=>{const a=[];t&&(e||s).traverse(c=>{c.visible===!1&&(a.push(c),c.visible=!0)}),r.compile(e||s,i||n);const o=new Q6(128);new Z6(.01,1e5,o).update(r,e||s),o.dispose(),a.forEach(c=>c.visible=!1)},[]),null}const ZFe=t=>{const e=J.useRef(),[i]=J.useState(()=>VFe(new Float32Array(5e3),{radius:1.2}));return MH((r,n)=>{e.current&&(e.current.rotation.x-=n/10,e.current.rotation.y-=n/15)}),O.jsx("group",{rotation:[0,0,Math.PI/4],children:O.jsx(YFe,{ref:e,positions:i,stride:3,frustumCulled:!0,...t,children:O.jsx(WFe,{transparent:!0,color:"#FFFFFF",size:.002,sizeAttenuation:!0,depthWrite:!1})})})},jE=()=>O.jsx("div",{className:"w-full h-full fixed inset-0 z-0",style:{pointerEvents:"none"},children:O.jsxs(kFe,{camera:{position:[0,0,1]},style:{pointerEvents:"none"},children:[O.jsx(J.Suspense,{fallback:null,children:O.jsx(ZFe,{})}),O.jsx(KFe,{all:!0})]})});function fK(t,[e,i]){return Math.min(i,Math.max(e,t))}function ln(t,e,{checkForDefaultPrevented:i=!0}={}){return function(n){if(t?.(n),i===!1||!n.defaultPrevented)return e?.(n)}}function pce(t){const e=t+"CollectionProvider",[i,r]=c_(e),[n,s]=i(e,{collectionRef:{current:null},itemMap:new Map}),a=g=>{const{scope:m,children:y}=g,b=kt.useRef(null),w=kt.useRef(new Map).current;return O.jsx(n,{scope:m,itemMap:w,collectionRef:b,children:y})};a.displayName=e;const o=t+"CollectionSlot",l=$A(o),c=kt.forwardRef((g,m)=>{const{scope:y,children:b}=g,w=s(o,y),E=ga(m,w.collectionRef);return O.jsx(l,{ref:E,children:b})});c.displayName=o;const u=t+"CollectionItemSlot",h="data-radix-collection-item",d=$A(u),f=kt.forwardRef((g,m)=>{const{scope:y,children:b,...w}=g,E=kt.useRef(null),M=ga(m,E),A=s(u,y);return kt.useEffect(()=>(A.itemMap.set(E,{ref:E,...w}),()=>void A.itemMap.delete(E))),O.jsx(d,{[h]:"",ref:M,children:b})});f.displayName=u;function p(g){const m=s(t+"CollectionConsumer",g);return kt.useCallback(()=>{const b=m.collectionRef.current;if(!b)return[];const w=Array.from(b.querySelectorAll(`[${h}]`));return Array.from(m.itemMap.values()).sort((A,P)=>w.indexOf(A.ref.current)-w.indexOf(P.ref.current))},[m.collectionRef,m.itemMap])}return[{Provider:a,Slot:c,ItemSlot:f},p,r]}var QFe=J.createContext(void 0);function CH(t){const e=J.useContext(QFe);return t||e||"ltr"}function JFe(t,e=globalThis?.document){const i=Up(t);J.useEffect(()=>{const r=n=>{n.key==="Escape"&&i(n)};return e.addEventListener("keydown",r,{capture:!0}),()=>e.removeEventListener("keydown",r,{capture:!0})},[i,e])}var e4e="DismissableLayer",aj="dismissableLayer.update",t4e="dismissableLayer.pointerDownOutside",i4e="dismissableLayer.focusOutside",pK,mce=J.createContext({layers:new Set,layersWithOutsidePointerEventsDisabled:new Set,branches:new Set}),gce=J.forwardRef((t,e)=>{const{disableOutsidePointerEvents:i=!1,onEscapeKeyDown:r,onPointerDownOutside:n,onFocusOutside:s,onInteractOutside:a,onDismiss:o,...l}=t,c=J.useContext(mce),[u,h]=J.useState(null),d=u?.ownerDocument??globalThis?.document,[,f]=J.useState({}),p=ga(e,P=>h(P)),g=Array.from(c.layers),[m]=[...c.layersWithOutsidePointerEventsDisabled].slice(-1),y=g.indexOf(m),b=u?g.indexOf(u):-1,w=c.layersWithOutsidePointerEventsDisabled.size>0,E=b>=y,M=s4e(P=>{const C=P.target,R=[...c.branches].some(I=>I.contains(C));!E||R||(n?.(P),a?.(P),P.defaultPrevented||o?.())},d),A=a4e(P=>{const C=P.target;[...c.branches].some(I=>I.contains(C))||(s?.(P),a?.(P),P.defaultPrevented||o?.())},d);return JFe(P=>{b===c.layers.size-1&&(r?.(P),!P.defaultPrevented&&o&&(P.preventDefault(),o()))},d),J.useEffect(()=>{if(u)return i&&(c.layersWithOutsidePointerEventsDisabled.size===0&&(pK=d.body.style.pointerEvents,d.body.style.pointerEvents="none"),c.layersWithOutsidePointerEventsDisabled.add(u)),c.layers.add(u),mK(),()=>{i&&c.layersWithOutsidePointerEventsDisabled.size===1&&(d.body.style.pointerEvents=pK)}},[u,d,i,c]),J.useEffect(()=>()=>{u&&(c.layers.delete(u),c.layersWithOutsidePointerEventsDisabled.delete(u),mK())},[u,c]),J.useEffect(()=>{const P=()=>f({});return document.addEventListener(aj,P),()=>document.removeEventListener(aj,P)},[]),O.jsx(rn.div,{...l,ref:p,style:{pointerEvents:w?E?"auto":"none":void 0,...t.style},onFocusCapture:ln(t.onFocusCapture,A.onFocusCapture),onBlurCapture:ln(t.onBlurCapture,A.onBlurCapture),onPointerDownCapture:ln(t.onPointerDownCapture,M.onPointerDownCapture)})});gce.displayName=e4e;var r4e="DismissableLayerBranch",n4e=J.forwardRef((t,e)=>{const i=J.useContext(mce),r=J.useRef(null),n=ga(e,r);return J.useEffect(()=>{const s=r.current;if(s)return i.branches.add(s),()=>{i.branches.delete(s)}},[i.branches]),O.jsx(rn.div,{...t,ref:n})});n4e.displayName=r4e;function s4e(t,e=globalThis?.document){const i=Up(t),r=J.useRef(!1),n=J.useRef(()=>{});return J.useEffect(()=>{const s=o=>{if(o.target&&!r.current){let l=function(){vce(t4e,i,c,{discrete:!0})};const c={originalEvent:o};o.pointerType==="touch"?(e.removeEventListener("click",n.current),n.current=l,e.addEventListener("click",n.current,{once:!0})):l()}else e.removeEventListener("click",n.current);r.current=!1},a=window.setTimeout(()=>{e.addEventListener("pointerdown",s)},0);return()=>{window.clearTimeout(a),e.removeEventListener("pointerdown",s),e.removeEventListener("click",n.current)}},[e,i]),{onPointerDownCapture:()=>r.current=!0}}function a4e(t,e=globalThis?.document){const i=Up(t),r=J.useRef(!1);return J.useEffect(()=>{const n=s=>{s.target&&!r.current&&vce(i4e,i,{originalEvent:s},{discrete:!1})};return e.addEventListener("focusin",n),()=>e.removeEventListener("focusin",n)},[e,i]),{onFocusCapture:()=>r.current=!0,onBlurCapture:()=>r.current=!1}}function mK(){const t=new CustomEvent(aj);document.dispatchEvent(t)}function vce(t,e,i,{discrete:r}){const n=i.originalEvent.target,s=new CustomEvent(t,{bubbles:!1,cancelable:!0,detail:i});e&&n.addEventListener(t,e,{once:!0}),r?ZEe(n,s):n.dispatchEvent(s)}var vB=0;function o4e(){J.useEffect(()=>{const t=document.querySelectorAll("[data-radix-focus-guard]");return document.body.insertAdjacentElement("afterbegin",t[0]??gK()),document.body.insertAdjacentElement("beforeend",t[1]??gK()),vB++,()=>{vB===1&&document.querySelectorAll("[data-radix-focus-guard]").forEach(e=>e.remove()),vB--}},[])}function gK(){const t=document.createElement("span");return t.setAttribute("data-radix-focus-guard",""),t.tabIndex=0,t.style.outline="none",t.style.opacity="0",t.style.position="fixed",t.style.pointerEvents="none",t}var yB="focusScope.autoFocusOnMount",xB="focusScope.autoFocusOnUnmount",vK={bubbles:!1,cancelable:!0},l4e="FocusScope",yce=J.forwardRef((t,e)=>{const{loop:i=!1,trapped:r=!1,onMountAutoFocus:n,onUnmountAutoFocus:s,...a}=t,[o,l]=J.useState(null),c=Up(n),u=Up(s),h=J.useRef(null),d=ga(e,g=>l(g)),f=J.useRef({paused:!1,pause(){this.paused=!0},resume(){this.paused=!1}}).current;J.useEffect(()=>{if(r){let g=function(w){if(f.paused||!o)return;const E=w.target;o.contains(E)?h.current=E:lg(h.current,{select:!0})},m=function(w){if(f.paused||!o)return;const E=w.relatedTarget;E!==null&&(o.contains(E)||lg(h.current,{select:!0}))},y=function(w){if(document.activeElement===document.body)for(const M of w)M.removedNodes.length>0&&lg(o)};document.addEventListener("focusin",g),document.addEventListener("focusout",m);const b=new MutationObserver(y);return o&&b.observe(o,{childList:!0,subtree:!0}),()=>{document.removeEventListener("focusin",g),document.removeEventListener("focusout",m),b.disconnect()}}},[r,o,f.paused]),J.useEffect(()=>{if(o){xK.add(f);const g=document.activeElement;if(!o.contains(g)){const y=new CustomEvent(yB,vK);o.addEventListener(yB,c),o.dispatchEvent(y),y.defaultPrevented||(c4e(p4e(xce(o)),{select:!0}),document.activeElement===g&&lg(o))}return()=>{o.removeEventListener(yB,c),setTimeout(()=>{const y=new CustomEvent(xB,vK);o.addEventListener(xB,u),o.dispatchEvent(y),y.defaultPrevented||lg(g??document.body,{select:!0}),o.removeEventListener(xB,u),xK.remove(f)},0)}}},[o,c,u,f]);const p=J.useCallback(g=>{if(!i&&!r||f.paused)return;const m=g.key==="Tab"&&!g.altKey&&!g.ctrlKey&&!g.metaKey,y=document.activeElement;if(m&&y){const b=g.currentTarget,[w,E]=u4e(b);w&&E?!g.shiftKey&&y===E?(g.preventDefault(),i&&lg(w,{select:!0})):g.shiftKey&&y===w&&(g.preventDefault(),i&&lg(E,{select:!0})):y===b&&g.preventDefault()}},[i,r,f.paused]);return O.jsx(rn.div,{tabIndex:-1,...a,ref:d,onKeyDown:p})});yce.displayName=l4e;function c4e(t,{select:e=!1}={}){const i=document.activeElement;for(const r of t)if(lg(r,{select:e}),document.activeElement!==i)return}function u4e(t){const e=xce(t),i=yK(e,t),r=yK(e.reverse(),t);return[i,r]}function xce(t){const e=[],i=document.createTreeWalker(t,NodeFilter.SHOW_ELEMENT,{acceptNode:r=>{const n=r.tagName==="INPUT"&&r.type==="hidden";return r.disabled||r.hidden||n?NodeFilter.FILTER_SKIP:r.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;i.nextNode();)e.push(i.currentNode);return e}function yK(t,e){for(const i of t)if(!h4e(i,{upTo:e}))return i}function h4e(t,{upTo:e}){if(getComputedStyle(t).visibility==="hidden")return!0;for(;t;){if(e!==void 0&&t===e)return!1;if(getComputedStyle(t).display==="none")return!0;t=t.parentElement}return!1}function d4e(t){return t instanceof HTMLInputElement&&"select"in t}function lg(t,{select:e=!1}={}){if(t&&t.focus){const i=document.activeElement;t.focus({preventScroll:!0}),t!==i&&d4e(t)&&e&&t.select()}}var xK=f4e();function f4e(){let t=[];return{add(e){const i=t[0];e!==i&&i?.pause(),t=bK(t,e),t.unshift(e)},remove(e){t=bK(t,e),t[0]?.resume()}}}function bK(t,e){const i=[...t],r=i.indexOf(e);return r!==-1&&i.splice(r,1),i}function p4e(t){return t.filter(e=>e.tagName!=="A")}var m4e=cre[" useId ".trim().toString()]||(()=>{}),g4e=0;function CT(t){const[e,i]=J.useState(m4e());return va(()=>{i(r=>r??String(g4e++))},[t]),t||(e?`radix-${e}`:"")}const v4e=["top","right","bottom","left"],tv=Math.min,Tc=Math.max,ID=Math.round,sP=Math.floor,Hd=t=>({x:t,y:t}),y4e={left:"right",right:"left",bottom:"top",top:"bottom"},x4e={start:"end",end:"start"};function oj(t,e,i){return Tc(t,tv(e,i))}function Hp(t,e){return typeof t=="function"?t(e):t}function Gp(t){return t.split("-")[0]}function b_(t){return t.split("-")[1]}function PH(t){return t==="x"?"y":"x"}function RH(t){return t==="y"?"height":"width"}const b4e=new Set(["top","bottom"]);function Od(t){return b4e.has(Gp(t))?"y":"x"}function IH(t){return PH(Od(t))}function w4e(t,e,i){i===void 0&&(i=!1);const r=b_(t),n=IH(t),s=RH(n);let a=n==="x"?r===(i?"end":"start")?"right":"left":r==="start"?"bottom":"top";return e.reference[s]>e.floating[s]&&(a=DD(a)),[a,DD(a)]}function _4e(t){const e=DD(t);return[lj(t),e,lj(e)]}function lj(t){return t.replace(/start|end/g,e=>x4e[e])}const wK=["left","right"],_K=["right","left"],S4e=["top","bottom"],E4e=["bottom","top"];function A4e(t,e,i){switch(t){case"top":case"bottom":return i?e?_K:wK:e?wK:_K;case"left":case"right":return e?S4e:E4e;default:return[]}}function M4e(t,e,i,r){const n=b_(t);let s=A4e(Gp(t),i==="start",r);return n&&(s=s.map(a=>a+"-"+n),e&&(s=s.concat(s.map(lj)))),s}function DD(t){return t.replace(/left|right|bottom|top/g,e=>y4e[e])}function T4e(t){return{top:0,right:0,bottom:0,left:0,...t}}function bce(t){return typeof t!="number"?T4e(t):{top:t,right:t,bottom:t,left:t}}function OD(t){const{x:e,y:i,width:r,height:n}=t;return{width:r,height:n,top:i,left:e,right:e+r,bottom:i+n,x:e,y:i}}function SK(t,e,i){let{reference:r,floating:n}=t;const s=Od(e),a=IH(e),o=RH(a),l=Gp(e),c=s==="y",u=r.x+r.width/2-n.width/2,h=r.y+r.height/2-n.height/2,d=r[o]/2-n[o]/2;let f;switch(l){case"top":f={x:u,y:r.y-n.height};break;case"bottom":f={x:u,y:r.y+r.height};break;case"right":f={x:r.x+r.width,y:h};break;case"left":f={x:r.x-n.width,y:h};break;default:f={x:r.x,y:r.y}}switch(b_(e)){case"start":f[a]-=d*(i&&c?-1:1);break;case"end":f[a]+=d*(i&&c?-1:1);break}return f}const C4e=async(t,e,i)=>{const{placement:r="bottom",strategy:n="absolute",middleware:s=[],platform:a}=i,o=s.filter(Boolean),l=await(a.isRTL==null?void 0:a.isRTL(e));let c=await a.getElementRects({reference:t,floating:e,strategy:n}),{x:u,y:h}=SK(c,r,l),d=r,f={},p=0;for(let g=0;g<o.length;g++){const{name:m,fn:y}=o[g],{x:b,y:w,data:E,reset:M}=await y({x:u,y:h,initialPlacement:r,placement:d,strategy:n,middlewareData:f,rects:c,platform:a,elements:{reference:t,floating:e}});u=b??u,h=w??h,f={...f,[m]:{...f[m],...E}},M&&p<=50&&(p++,typeof M=="object"&&(M.placement&&(d=M.placement),M.rects&&(c=M.rects===!0?await a.getElementRects({reference:t,floating:e,strategy:n}):M.rects),{x:u,y:h}=SK(c,d,l)),g=-1)}return{x:u,y:h,placement:d,strategy:n,middlewareData:f}};async function AM(t,e){var i;e===void 0&&(e={});const{x:r,y:n,platform:s,rects:a,elements:o,strategy:l}=t,{boundary:c="clippingAncestors",rootBoundary:u="viewport",elementContext:h="floating",altBoundary:d=!1,padding:f=0}=Hp(e,t),p=bce(f),m=o[d?h==="floating"?"reference":"floating":h],y=OD(await s.getClippingRect({element:(i=await(s.isElement==null?void 0:s.isElement(m)))==null||i?m:m.contextElement||await(s.getDocumentElement==null?void 0:s.getDocumentElement(o.floating)),boundary:c,rootBoundary:u,strategy:l})),b=h==="floating"?{x:r,y:n,width:a.floating.width,height:a.floating.height}:a.reference,w=await(s.getOffsetParent==null?void 0:s.getOffsetParent(o.floating)),E=await(s.isElement==null?void 0:s.isElement(w))?await(s.getScale==null?void 0:s.getScale(w))||{x:1,y:1}:{x:1,y:1},M=OD(s.convertOffsetParentRelativeRectToViewportRelativeRect?await s.convertOffsetParentRelativeRectToViewportRelativeRect({elements:o,rect:b,offsetParent:w,strategy:l}):b);return{top:(y.top-M.top+p.top)/E.y,bottom:(M.bottom-y.bottom+p.bottom)/E.y,left:(y.left-M.left+p.left)/E.x,right:(M.right-y.right+p.right)/E.x}}const P4e=t=>({name:"arrow",options:t,async fn(e){const{x:i,y:r,placement:n,rects:s,platform:a,elements:o,middlewareData:l}=e,{element:c,padding:u=0}=Hp(t,e)||{};if(c==null)return{};const h=bce(u),d={x:i,y:r},f=IH(n),p=RH(f),g=await a.getDimensions(c),m=f==="y",y=m?"top":"left",b=m?"bottom":"right",w=m?"clientHeight":"clientWidth",E=s.reference[p]+s.reference[f]-d[f]-s.floating[p],M=d[f]-s.reference[f],A=await(a.getOffsetParent==null?void 0:a.getOffsetParent(c));let P=A?A[w]:0;(!P||!await(a.isElement==null?void 0:a.isElement(A)))&&(P=o.floating[w]||s.floating[p]);const C=E/2-M/2,R=P/2-g[p]/2-1,I=tv(h[y],R),k=tv(h[b],R),z=I,V=P-g[p]-k,F=P/2-g[p]/2+C,$=oj(z,F,V),K=!l.arrow&&b_(n)!=null&&F!==$&&s.reference[p]/2-(F<z?I:k)-g[p]/2<0,X=K?F<z?F-z:F-V:0;return{[f]:d[f]+X,data:{[f]:$,centerOffset:F-$-X,...K&&{alignmentOffset:X}},reset:K}}}),R4e=function(t){return t===void 0&&(t={}),{name:"flip",options:t,async fn(e){var i,r;const{placement:n,middlewareData:s,rects:a,initialPlacement:o,platform:l,elements:c}=e,{mainAxis:u=!0,crossAxis:h=!0,fallbackPlacements:d,fallbackStrategy:f="bestFit",fallbackAxisSideDirection:p="none",flipAlignment:g=!0,...m}=Hp(t,e);if((i=s.arrow)!=null&&i.alignmentOffset)return{};const y=Gp(n),b=Od(o),w=Gp(o)===o,E=await(l.isRTL==null?void 0:l.isRTL(c.floating)),M=d||(w||!g?[DD(o)]:_4e(o)),A=p!=="none";!d&&A&&M.push(...M4e(o,g,p,E));const P=[o,...M],C=await AM(e,m),R=[];let I=((r=s.flip)==null?void 0:r.overflows)||[];if(u&&R.push(C[y]),h){const F=w4e(n,a,E);R.push(C[F[0]],C[F[1]])}if(I=[...I,{placement:n,overflows:R}],!R.every(F=>F<=0)){var k,z;const F=(((k=s.flip)==null?void 0:k.index)||0)+1,$=P[F];if($&&(!(h==="alignment"?b!==Od($):!1)||I.every(U=>Od(U.placement)===b?U.overflows[0]>0:!0)))return{data:{index:F,overflows:I},reset:{placement:$}};let K=(z=I.filter(X=>X.overflows[0]<=0).sort((X,U)=>X.overflows[1]-U.overflows[1])[0])==null?void 0:z.placement;if(!K)switch(f){case"bestFit":{var V;const X=(V=I.filter(U=>{if(A){const Y=Od(U.placement);return Y===b||Y==="y"}return!0}).map(U=>[U.placement,U.overflows.filter(Y=>Y>0).reduce((Y,Z)=>Y+Z,0)]).sort((U,Y)=>U[1]-Y[1])[0])==null?void 0:V[0];X&&(K=X);break}case"initialPlacement":K=o;break}if(n!==K)return{reset:{placement:K}}}return{}}}};function EK(t,e){return{top:t.top-e.height,right:t.right-e.width,bottom:t.bottom-e.height,left:t.left-e.width}}function AK(t){return v4e.some(e=>t[e]>=0)}const I4e=function(t){return t===void 0&&(t={}),{name:"hide",options:t,async fn(e){const{rects:i}=e,{strategy:r="referenceHidden",...n}=Hp(t,e);switch(r){case"referenceHidden":{const s=await AM(e,{...n,elementContext:"reference"}),a=EK(s,i.reference);return{data:{referenceHiddenOffsets:a,referenceHidden:AK(a)}}}case"escaped":{const s=await AM(e,{...n,altBoundary:!0}),a=EK(s,i.floating);return{data:{escapedOffsets:a,escaped:AK(a)}}}default:return{}}}}},wce=new Set(["left","top"]);async function D4e(t,e){const{placement:i,platform:r,elements:n}=t,s=await(r.isRTL==null?void 0:r.isRTL(n.floating)),a=Gp(i),o=b_(i),l=Od(i)==="y",c=wce.has(a)?-1:1,u=s&&l?-1:1,h=Hp(e,t);let{mainAxis:d,crossAxis:f,alignmentAxis:p}=typeof h=="number"?{mainAxis:h,crossAxis:0,alignmentAxis:null}:{mainAxis:h.mainAxis||0,crossAxis:h.crossAxis||0,alignmentAxis:h.alignmentAxis};return o&&typeof p=="number"&&(f=o==="end"?p*-1:p),l?{x:f*u,y:d*c}:{x:d*c,y:f*u}}const O4e=function(t){return t===void 0&&(t=0),{name:"offset",options:t,async fn(e){var i,r;const{x:n,y:s,placement:a,middlewareData:o}=e,l=await D4e(e,t);return a===((i=o.offset)==null?void 0:i.placement)&&(r=o.arrow)!=null&&r.alignmentOffset?{}:{x:n+l.x,y:s+l.y,data:{...l,placement:a}}}}},L4e=function(t){return t===void 0&&(t={}),{name:"shift",options:t,async fn(e){const{x:i,y:r,placement:n}=e,{mainAxis:s=!0,crossAxis:a=!1,limiter:o={fn:m=>{let{x:y,y:b}=m;return{x:y,y:b}}},...l}=Hp(t,e),c={x:i,y:r},u=await AM(e,l),h=Od(Gp(n)),d=PH(h);let f=c[d],p=c[h];if(s){const m=d==="y"?"top":"left",y=d==="y"?"bottom":"right",b=f+u[m],w=f-u[y];f=oj(b,f,w)}if(a){const m=h==="y"?"top":"left",y=h==="y"?"bottom":"right",b=p+u[m],w=p-u[y];p=oj(b,p,w)}const g=o.fn({...e,[d]:f,[h]:p});return{...g,data:{x:g.x-i,y:g.y-r,enabled:{[d]:s,[h]:a}}}}}},k4e=function(t){return t===void 0&&(t={}),{options:t,fn(e){const{x:i,y:r,placement:n,rects:s,middlewareData:a}=e,{offset:o=0,mainAxis:l=!0,crossAxis:c=!0}=Hp(t,e),u={x:i,y:r},h=Od(n),d=PH(h);let f=u[d],p=u[h];const g=Hp(o,e),m=typeof g=="number"?{mainAxis:g,crossAxis:0}:{mainAxis:0,crossAxis:0,...g};if(l){const w=d==="y"?"height":"width",E=s.reference[d]-s.floating[w]+m.mainAxis,M=s.reference[d]+s.reference[w]-m.mainAxis;f<E?f=E:f>M&&(f=M)}if(c){var y,b;const w=d==="y"?"width":"height",E=wce.has(Gp(n)),M=s.reference[h]-s.floating[w]+(E&&((y=a.offset)==null?void 0:y[h])||0)+(E?0:m.crossAxis),A=s.reference[h]+s.reference[w]+(E?0:((b=a.offset)==null?void 0:b[h])||0)-(E?m.crossAxis:0);p<M?p=M:p>A&&(p=A)}return{[d]:f,[h]:p}}}},N4e=function(t){return t===void 0&&(t={}),{name:"size",options:t,async fn(e){var i,r;const{placement:n,rects:s,platform:a,elements:o}=e,{apply:l=()=>{},...c}=Hp(t,e),u=await AM(e,c),h=Gp(n),d=b_(n),f=Od(n)==="y",{width:p,height:g}=s.floating;let m,y;h==="top"||h==="bottom"?(m=h,y=d===(await(a.isRTL==null?void 0:a.isRTL(o.floating))?"start":"end")?"left":"right"):(y=h,m=d==="end"?"top":"bottom");const b=g-u.top-u.bottom,w=p-u.left-u.right,E=tv(g-u[m],b),M=tv(p-u[y],w),A=!e.middlewareData.shift;let P=E,C=M;if((i=e.middlewareData.shift)!=null&&i.enabled.x&&(C=w),(r=e.middlewareData.shift)!=null&&r.enabled.y&&(P=b),A&&!d){const I=Tc(u.left,0),k=Tc(u.right,0),z=Tc(u.top,0),V=Tc(u.bottom,0);f?C=p-2*(I!==0||k!==0?I+k:Tc(u.left,u.right)):P=g-2*(z!==0||V!==0?z+V:Tc(u.top,u.bottom))}await l({...e,availableWidth:C,availableHeight:P});const R=await a.getDimensions(o.floating);return p!==R.width||g!==R.height?{reset:{rects:!0}}:{}}}};function $O(){return typeof window<"u"}function w_(t){return _ce(t)?(t.nodeName||"").toLowerCase():"#document"}function Ic(t){var e;return(t==null||(e=t.ownerDocument)==null?void 0:e.defaultView)||window}function lf(t){var e;return(e=(_ce(t)?t.ownerDocument:t.document)||window.document)==null?void 0:e.documentElement}function _ce(t){return $O()?t instanceof Node||t instanceof Ic(t).Node:!1}function Ph(t){return $O()?t instanceof Element||t instanceof Ic(t).Element:!1}function Jd(t){return $O()?t instanceof HTMLElement||t instanceof Ic(t).HTMLElement:!1}function MK(t){return!$O()||typeof ShadowRoot>"u"?!1:t instanceof ShadowRoot||t instanceof Ic(t).ShadowRoot}const U4e=new Set(["inline","contents"]);function PT(t){const{overflow:e,overflowX:i,overflowY:r,display:n}=Rh(t);return/auto|scroll|overlay|hidden|clip/.test(e+r+i)&&!U4e.has(n)}const B4e=new Set(["table","td","th"]);function F4e(t){return B4e.has(w_(t))}const z4e=[":popover-open",":modal"];function YO(t){return z4e.some(e=>{try{return t.matches(e)}catch{return!1}})}const j4e=["transform","translate","scale","rotate","perspective"],V4e=["transform","translate","scale","rotate","perspective","filter"],H4e=["paint","layout","strict","content"];function DH(t){const e=OH(),i=Ph(t)?Rh(t):t;return j4e.some(r=>i[r]?i[r]!=="none":!1)||(i.containerType?i.containerType!=="normal":!1)||!e&&(i.backdropFilter?i.backdropFilter!=="none":!1)||!e&&(i.filter?i.filter!=="none":!1)||V4e.some(r=>(i.willChange||"").includes(r))||H4e.some(r=>(i.contain||"").includes(r))}function G4e(t){let e=iv(t);for(;Jd(e)&&!z1(e);){if(DH(e))return e;if(YO(e))return null;e=iv(e)}return null}function OH(){return typeof CSS>"u"||!CSS.supports?!1:CSS.supports("-webkit-backdrop-filter","none")}const W4e=new Set(["html","body","#document"]);function z1(t){return W4e.has(w_(t))}function Rh(t){return Ic(t).getComputedStyle(t)}function KO(t){return Ph(t)?{scrollLeft:t.scrollLeft,scrollTop:t.scrollTop}:{scrollLeft:t.scrollX,scrollTop:t.scrollY}}function iv(t){if(w_(t)==="html")return t;const e=t.assignedSlot||t.parentNode||MK(t)&&t.host||lf(t);return MK(e)?e.host:e}function Sce(t){const e=iv(t);return z1(e)?t.ownerDocument?t.ownerDocument.body:t.body:Jd(e)&&PT(e)?e:Sce(e)}function MM(t,e,i){var r;e===void 0&&(e=[]),i===void 0&&(i=!0);const n=Sce(t),s=n===((r=t.ownerDocument)==null?void 0:r.body),a=Ic(n);if(s){const o=cj(a);return e.concat(a,a.visualViewport||[],PT(n)?n:[],o&&i?MM(o):[])}return e.concat(n,MM(n,[],i))}function cj(t){return t.parent&&Object.getPrototypeOf(t.parent)?t.frameElement:null}function Ece(t){const e=Rh(t);let i=parseFloat(e.width)||0,r=parseFloat(e.height)||0;const n=Jd(t),s=n?t.offsetWidth:i,a=n?t.offsetHeight:r,o=ID(i)!==s||ID(r)!==a;return o&&(i=s,r=a),{width:i,height:r,$:o}}function LH(t){return Ph(t)?t:t.contextElement}function r1(t){const e=LH(t);if(!Jd(e))return Hd(1);const i=e.getBoundingClientRect(),{width:r,height:n,$:s}=Ece(e);let a=(s?ID(i.width):i.width)/r,o=(s?ID(i.height):i.height)/n;return(!a||!Number.isFinite(a))&&(a=1),(!o||!Number.isFinite(o))&&(o=1),{x:a,y:o}}const q4e=Hd(0);function Ace(t){const e=Ic(t);return!OH()||!e.visualViewport?q4e:{x:e.visualViewport.offsetLeft,y:e.visualViewport.offsetTop}}function X4e(t,e,i){return e===void 0&&(e=!1),!i||e&&i!==Ic(t)?!1:e}function I0(t,e,i,r){e===void 0&&(e=!1),i===void 0&&(i=!1);const n=t.getBoundingClientRect(),s=LH(t);let a=Hd(1);e&&(r?Ph(r)&&(a=r1(r)):a=r1(t));const o=X4e(s,i,r)?Ace(s):Hd(0);let l=(n.left+o.x)/a.x,c=(n.top+o.y)/a.y,u=n.width/a.x,h=n.height/a.y;if(s){const d=Ic(s),f=r&&Ph(r)?Ic(r):r;let p=d,g=cj(p);for(;g&&r&&f!==p;){const m=r1(g),y=g.getBoundingClientRect(),b=Rh(g),w=y.left+(g.clientLeft+parseFloat(b.paddingLeft))*m.x,E=y.top+(g.clientTop+parseFloat(b.paddingTop))*m.y;l*=m.x,c*=m.y,u*=m.x,h*=m.y,l+=w,c+=E,p=Ic(g),g=cj(p)}}return OD({width:u,height:h,x:l,y:c})}function ZO(t,e){const i=KO(t).scrollLeft;return e?e.left+i:I0(lf(t)).left+i}function Mce(t,e){const i=t.getBoundingClientRect(),r=i.left+e.scrollLeft-ZO(t,i),n=i.top+e.scrollTop;return{x:r,y:n}}function $4e(t){let{elements:e,rect:i,offsetParent:r,strategy:n}=t;const s=n==="fixed",a=lf(r),o=e?YO(e.floating):!1;if(r===a||o&&s)return i;let l={scrollLeft:0,scrollTop:0},c=Hd(1);const u=Hd(0),h=Jd(r);if((h||!h&&!s)&&((w_(r)!=="body"||PT(a))&&(l=KO(r)),Jd(r))){const f=I0(r);c=r1(r),u.x=f.x+r.clientLeft,u.y=f.y+r.clientTop}const d=a&&!h&&!s?Mce(a,l):Hd(0);return{width:i.width*c.x,height:i.height*c.y,x:i.x*c.x-l.scrollLeft*c.x+u.x+d.x,y:i.y*c.y-l.scrollTop*c.y+u.y+d.y}}function Y4e(t){return Array.from(t.getClientRects())}function K4e(t){const e=lf(t),i=KO(t),r=t.ownerDocument.body,n=Tc(e.scrollWidth,e.clientWidth,r.scrollWidth,r.clientWidth),s=Tc(e.scrollHeight,e.clientHeight,r.scrollHeight,r.clientHeight);let a=-i.scrollLeft+ZO(t);const o=-i.scrollTop;return Rh(r).direction==="rtl"&&(a+=Tc(e.clientWidth,r.clientWidth)-n),{width:n,height:s,x:a,y:o}}const TK=25;function Z4e(t,e){const i=Ic(t),r=lf(t),n=i.visualViewport;let s=r.clientWidth,a=r.clientHeight,o=0,l=0;if(n){s=n.width,a=n.height;const u=OH();(!u||u&&e==="fixed")&&(o=n.offsetLeft,l=n.offsetTop)}const c=ZO(r);if(c<=0){const u=r.ownerDocument,h=u.body,d=getComputedStyle(h),f=u.compatMode==="CSS1Compat"&&parseFloat(d.marginLeft)+parseFloat(d.marginRight)||0,p=Math.abs(r.clientWidth-h.clientWidth-f);p<=TK&&(s-=p)}else c<=TK&&(s+=c);return{width:s,height:a,x:o,y:l}}const Q4e=new Set(["absolute","fixed"]);function J4e(t,e){const i=I0(t,!0,e==="fixed"),r=i.top+t.clientTop,n=i.left+t.clientLeft,s=Jd(t)?r1(t):Hd(1),a=t.clientWidth*s.x,o=t.clientHeight*s.y,l=n*s.x,c=r*s.y;return{width:a,height:o,x:l,y:c}}function CK(t,e,i){let r;if(e==="viewport")r=Z4e(t,i);else if(e==="document")r=K4e(lf(t));else if(Ph(e))r=J4e(e,i);else{const n=Ace(t);r={x:e.x-n.x,y:e.y-n.y,width:e.width,height:e.height}}return OD(r)}function Tce(t,e){const i=iv(t);return i===e||!Ph(i)||z1(i)?!1:Rh(i).position==="fixed"||Tce(i,e)}function eze(t,e){const i=e.get(t);if(i)return i;let r=MM(t,[],!1).filter(o=>Ph(o)&&w_(o)!=="body"),n=null;const s=Rh(t).position==="fixed";let a=s?iv(t):t;for(;Ph(a)&&!z1(a);){const o=Rh(a),l=DH(a);!l&&o.position==="fixed"&&(n=null),(s?!l&&!n:!l&&o.position==="static"&&!!n&&Q4e.has(n.position)||PT(a)&&!l&&Tce(t,a))?r=r.filter(u=>u!==a):n=o,a=iv(a)}return e.set(t,r),r}function tze(t){let{element:e,boundary:i,rootBoundary:r,strategy:n}=t;const a=[...i==="clippingAncestors"?YO(e)?[]:eze(e,this._c):[].concat(i),r],o=a[0],l=a.reduce((c,u)=>{const h=CK(e,u,n);return c.top=Tc(h.top,c.top),c.right=tv(h.right,c.right),c.bottom=tv(h.bottom,c.bottom),c.left=Tc(h.left,c.left),c},CK(e,o,n));return{width:l.right-l.left,height:l.bottom-l.top,x:l.left,y:l.top}}function ize(t){const{width:e,height:i}=Ece(t);return{width:e,height:i}}function rze(t,e,i){const r=Jd(e),n=lf(e),s=i==="fixed",a=I0(t,!0,s,e);let o={scrollLeft:0,scrollTop:0};const l=Hd(0);function c(){l.x=ZO(n)}if(r||!r&&!s)if((w_(e)!=="body"||PT(n))&&(o=KO(e)),r){const f=I0(e,!0,s,e);l.x=f.x+e.clientLeft,l.y=f.y+e.clientTop}else n&&c();s&&!r&&n&&c();const u=n&&!r&&!s?Mce(n,o):Hd(0),h=a.left+o.scrollLeft-l.x-u.x,d=a.top+o.scrollTop-l.y-u.y;return{x:h,y:d,width:a.width,height:a.height}}function bB(t){return Rh(t).position==="static"}function PK(t,e){if(!Jd(t)||Rh(t).position==="fixed")return null;if(e)return e(t);let i=t.offsetParent;return lf(t)===i&&(i=i.ownerDocument.body),i}function Cce(t,e){const i=Ic(t);if(YO(t))return i;if(!Jd(t)){let n=iv(t);for(;n&&!z1(n);){if(Ph(n)&&!bB(n))return n;n=iv(n)}return i}let r=PK(t,e);for(;r&&F4e(r)&&bB(r);)r=PK(r,e);return r&&z1(r)&&bB(r)&&!DH(r)?i:r||G4e(t)||i}const nze=async function(t){const e=this.getOffsetParent||Cce,i=this.getDimensions,r=await i(t.floating);return{reference:rze(t.reference,await e(t.floating),t.strategy),floating:{x:0,y:0,width:r.width,height:r.height}}};function sze(t){return Rh(t).direction==="rtl"}const aze={convertOffsetParentRelativeRectToViewportRelativeRect:$4e,getDocumentElement:lf,getClippingRect:tze,getOffsetParent:Cce,getElementRects:nze,getClientRects:Y4e,getDimensions:ize,getScale:r1,isElement:Ph,isRTL:sze};function Pce(t,e){return t.x===e.x&&t.y===e.y&&t.width===e.width&&t.height===e.height}function oze(t,e){let i=null,r;const n=lf(t);function s(){var o;clearTimeout(r),(o=i)==null||o.disconnect(),i=null}function a(o,l){o===void 0&&(o=!1),l===void 0&&(l=1),s();const c=t.getBoundingClientRect(),{left:u,top:h,width:d,height:f}=c;if(o||e(),!d||!f)return;const p=sP(h),g=sP(n.clientWidth-(u+d)),m=sP(n.clientHeight-(h+f)),y=sP(u),w={rootMargin:-p+"px "+-g+"px "+-m+"px "+-y+"px",threshold:Tc(0,tv(1,l))||1};let E=!0;function M(A){const P=A[0].intersectionRatio;if(P!==l){if(!E)return a();P?a(!1,P):r=setTimeout(()=>{a(!1,1e-7)},1e3)}P===1&&!Pce(c,t.getBoundingClientRect())&&a(),E=!1}try{i=new IntersectionObserver(M,{...w,root:n.ownerDocument})}catch{i=new IntersectionObserver(M,w)}i.observe(t)}return a(!0),s}function lze(t,e,i,r){r===void 0&&(r={});const{ancestorScroll:n=!0,ancestorResize:s=!0,elementResize:a=typeof ResizeObserver=="function",layoutShift:o=typeof IntersectionObserver=="function",animationFrame:l=!1}=r,c=LH(t),u=n||s?[...c?MM(c):[],...MM(e)]:[];u.forEach(y=>{n&&y.addEventListener("scroll",i,{passive:!0}),s&&y.addEventListener("resize",i)});const h=c&&o?oze(c,i):null;let d=-1,f=null;a&&(f=new ResizeObserver(y=>{let[b]=y;b&&b.target===c&&f&&(f.unobserve(e),cancelAnimationFrame(d),d=requestAnimationFrame(()=>{var w;(w=f)==null||w.observe(e)})),i()}),c&&!l&&f.observe(c),f.observe(e));let p,g=l?I0(t):null;l&&m();function m(){const y=I0(t);g&&!Pce(g,y)&&i(),g=y,p=requestAnimationFrame(m)}return i(),()=>{var y;u.forEach(b=>{n&&b.removeEventListener("scroll",i),s&&b.removeEventListener("resize",i)}),h?.(),(y=f)==null||y.disconnect(),f=null,l&&cancelAnimationFrame(p)}}const cze=O4e,uze=L4e,hze=R4e,dze=N4e,fze=I4e,RK=P4e,pze=k4e,mze=(t,e,i)=>{const r=new Map,n={platform:aze,...i},s={...n.platform,_c:r};return C4e(t,e,{...n,platform:s})};var gze=typeof document<"u",vze=function(){},ZR=gze?J.useLayoutEffect:vze;function LD(t,e){if(t===e)return!0;if(typeof t!=typeof e)return!1;if(typeof t=="function"&&t.toString()===e.toString())return!0;let i,r,n;if(t&&e&&typeof t=="object"){if(Array.isArray(t)){if(i=t.length,i!==e.length)return!1;for(r=i;r--!==0;)if(!LD(t[r],e[r]))return!1;return!0}if(n=Object.keys(t),i=n.length,i!==Object.keys(e).length)return!1;for(r=i;r--!==0;)if(!{}.hasOwnProperty.call(e,n[r]))return!1;for(r=i;r--!==0;){const s=n[r];if(!(s==="_owner"&&t.$$typeof)&&!LD(t[s],e[s]))return!1}return!0}return t!==t&&e!==e}function Rce(t){return typeof window>"u"?1:(t.ownerDocument.defaultView||window).devicePixelRatio||1}function IK(t,e){const i=Rce(t);return Math.round(e*i)/i}function wB(t){const e=J.useRef(t);return ZR(()=>{e.current=t}),e}function yze(t){t===void 0&&(t={});const{placement:e="bottom",strategy:i="absolute",middleware:r=[],platform:n,elements:{reference:s,floating:a}={},transform:o=!0,whileElementsMounted:l,open:c}=t,[u,h]=J.useState({x:0,y:0,strategy:i,placement:e,middlewareData:{},isPositioned:!1}),[d,f]=J.useState(r);LD(d,r)||f(r);const[p,g]=J.useState(null),[m,y]=J.useState(null),b=J.useCallback(U=>{U!==A.current&&(A.current=U,g(U))},[]),w=J.useCallback(U=>{U!==P.current&&(P.current=U,y(U))},[]),E=s||p,M=a||m,A=J.useRef(null),P=J.useRef(null),C=J.useRef(u),R=l!=null,I=wB(l),k=wB(n),z=wB(c),V=J.useCallback(()=>{if(!A.current||!P.current)return;const U={placement:e,strategy:i,middleware:d};k.current&&(U.platform=k.current),mze(A.current,P.current,U).then(Y=>{const Z={...Y,isPositioned:z.current!==!1};F.current&&!LD(C.current,Z)&&(C.current=Z,sT.flushSync(()=>{h(Z)}))})},[d,e,i,k,z]);ZR(()=>{c===!1&&C.current.isPositioned&&(C.current.isPositioned=!1,h(U=>({...U,isPositioned:!1})))},[c]);const F=J.useRef(!1);ZR(()=>(F.current=!0,()=>{F.current=!1}),[]),ZR(()=>{if(E&&(A.current=E),M&&(P.current=M),E&&M){if(I.current)return I.current(E,M,V);V()}},[E,M,V,I,R]);const $=J.useMemo(()=>({reference:A,floating:P,setReference:b,setFloating:w}),[b,w]),K=J.useMemo(()=>({reference:E,floating:M}),[E,M]),X=J.useMemo(()=>{const U={position:i,left:0,top:0};if(!K.floating)return U;const Y=IK(K.floating,u.x),Z=IK(K.floating,u.y);return o?{...U,transform:"translate("+Y+"px, "+Z+"px)",...Rce(K.floating)>=1.5&&{willChange:"transform"}}:{position:i,left:Y,top:Z}},[i,o,K.floating,u.x,u.y]);return J.useMemo(()=>({...u,update:V,refs:$,elements:K,floatingStyles:X}),[u,V,$,K,X])}const xze=t=>{function e(i){return{}.hasOwnProperty.call(i,"current")}return{name:"arrow",options:t,fn(i){const{element:r,padding:n}=typeof t=="function"?t(i):t;return r&&e(r)?r.current!=null?RK({element:r.current,padding:n}).fn(i):{}:r?RK({element:r,padding:n}).fn(i):{}}}},bze=(t,e)=>({...cze(t),options:[t,e]}),wze=(t,e)=>({...uze(t),options:[t,e]}),_ze=(t,e)=>({...pze(t),options:[t,e]}),Sze=(t,e)=>({...hze(t),options:[t,e]}),Eze=(t,e)=>({...dze(t),options:[t,e]}),Aze=(t,e)=>({...fze(t),options:[t,e]}),Mze=(t,e)=>({...xze(t),options:[t,e]});var Tze="Arrow",Ice=J.forwardRef((t,e)=>{const{children:i,width:r=10,height:n=5,...s}=t;return O.jsx(rn.svg,{...s,ref:e,width:r,height:n,viewBox:"0 0 30 10",preserveAspectRatio:"none",children:t.asChild?i:O.jsx("polygon",{points:"0,0 30,0 15,10"})})});Ice.displayName=Tze;var Cze=Ice;function Pze(t){const[e,i]=J.useState(void 0);return va(()=>{if(t){i({width:t.offsetWidth,height:t.offsetHeight});const r=new ResizeObserver(n=>{if(!Array.isArray(n)||!n.length)return;const s=n[0];let a,o;if("borderBoxSize"in s){const l=s.borderBoxSize,c=Array.isArray(l)?l[0]:l;a=c.inlineSize,o=c.blockSize}else a=t.offsetWidth,o=t.offsetHeight;i({width:a,height:o})});return r.observe(t,{box:"border-box"}),()=>r.unobserve(t)}else i(void 0)},[t]),e}var kH="Popper",[Dce,Oce]=c_(kH),[Rze,Lce]=Dce(kH),kce=t=>{const{__scopePopper:e,children:i}=t,[r,n]=J.useState(null);return O.jsx(Rze,{scope:e,anchor:r,onAnchorChange:n,children:i})};kce.displayName=kH;var Nce="PopperAnchor",Uce=J.forwardRef((t,e)=>{const{__scopePopper:i,virtualRef:r,...n}=t,s=Lce(Nce,i),a=J.useRef(null),o=ga(e,a),l=J.useRef(null);return J.useEffect(()=>{const c=l.current;l.current=r?.current||a.current,c!==l.current&&s.onAnchorChange(l.current)}),r?null:O.jsx(rn.div,{...n,ref:o})});Uce.displayName=Nce;var NH="PopperContent",[Ize,Dze]=Dce(NH),Bce=J.forwardRef((t,e)=>{const{__scopePopper:i,side:r="bottom",sideOffset:n=0,align:s="center",alignOffset:a=0,arrowPadding:o=0,avoidCollisions:l=!0,collisionBoundary:c=[],collisionPadding:u=0,sticky:h="partial",hideWhenDetached:d=!1,updatePositionStrategy:f="optimized",onPlaced:p,...g}=t,m=Lce(NH,i),[y,b]=J.useState(null),w=ga(e,le=>b(le)),[E,M]=J.useState(null),A=Pze(E),P=A?.width??0,C=A?.height??0,R=r+(s!=="center"?"-"+s:""),I=typeof u=="number"?u:{top:0,right:0,bottom:0,left:0,...u},k=Array.isArray(c)?c:[c],z=k.length>0,V={padding:I,boundary:k.filter(Lze),altBoundary:z},{refs:F,floatingStyles:$,placement:K,isPositioned:X,middlewareData:U}=yze({strategy:"fixed",placement:R,whileElementsMounted:(...le)=>lze(...le,{animationFrame:f==="always"}),elements:{reference:m.anchor},middleware:[bze({mainAxis:n+C,alignmentAxis:a}),l&&wze({mainAxis:!0,crossAxis:!1,limiter:h==="partial"?_ze():void 0,...V}),l&&Sze({...V}),Eze({...V,apply:({elements:le,rects:he,availableWidth:ve,availableHeight:xe})=>{const{width:Se,height:Ce}=he.reference,ce=le.floating.style;ce.setProperty("--radix-popper-available-width",`${ve}px`),ce.setProperty("--radix-popper-available-height",`${xe}px`),ce.setProperty("--radix-popper-anchor-width",`${Se}px`),ce.setProperty("--radix-popper-anchor-height",`${Ce}px`)}}),E&&Mze({element:E,padding:o}),kze({arrowWidth:P,arrowHeight:C}),d&&Aze({strategy:"referenceHidden",...V})]}),[Y,Z]=jce(K),j=Up(p);va(()=>{X&&j?.()},[X,j]);const ee=U.arrow?.x,pe=U.arrow?.y,fe=U.arrow?.centerOffset!==0,[se,re]=J.useState();return va(()=>{y&&re(window.getComputedStyle(y).zIndex)},[y]),O.jsx("div",{ref:F.setFloating,"data-radix-popper-content-wrapper":"",style:{...$,transform:X?$.transform:"translate(0, -200%)",minWidth:"max-content",zIndex:se,"--radix-popper-transform-origin":[U.transformOrigin?.x,U.transformOrigin?.y].join(" "),...U.hide?.referenceHidden&&{visibility:"hidden",pointerEvents:"none"}},dir:t.dir,children:O.jsx(Ize,{scope:i,placedSide:Y,onArrowChange:M,arrowX:ee,arrowY:pe,shouldHideArrow:fe,children:O.jsx(rn.div,{"data-side":Y,"data-align":Z,...g,ref:w,style:{...g.style,animation:X?void 0:"none"}})})})});Bce.displayName=NH;var Fce="PopperArrow",Oze={top:"bottom",right:"left",bottom:"top",left:"right"},zce=J.forwardRef(function(e,i){const{__scopePopper:r,...n}=e,s=Dze(Fce,r),a=Oze[s.placedSide];return O.jsx("span",{ref:s.onArrowChange,style:{position:"absolute",left:s.arrowX,top:s.arrowY,[a]:0,transformOrigin:{top:"",right:"0 0",bottom:"center 0",left:"100% 0"}[s.placedSide],transform:{top:"translateY(100%)",right:"translateY(50%) rotate(90deg) translateX(-50%)",bottom:"rotate(180deg)",left:"translateY(50%) rotate(-90deg) translateX(50%)"}[s.placedSide],visibility:s.shouldHideArrow?"hidden":void 0},children:O.jsx(Cze,{...n,ref:i,style:{...n.style,display:"block"}})})});zce.displayName=Fce;function Lze(t){return t!==null}var kze=t=>({name:"transformOrigin",options:t,fn(e){const{placement:i,rects:r,middlewareData:n}=e,a=n.arrow?.centerOffset!==0,o=a?0:t.arrowWidth,l=a?0:t.arrowHeight,[c,u]=jce(i),h={start:"0%",center:"50%",end:"100%"}[u],d=(n.arrow?.x??0)+o/2,f=(n.arrow?.y??0)+l/2;let p="",g="";return c==="bottom"?(p=a?h:`${d}px`,g=`${-l}px`):c==="top"?(p=a?h:`${d}px`,g=`${r.floating.height+l}px`):c==="right"?(p=`${-l}px`,g=a?h:`${f}px`):c==="left"&&(p=`${r.floating.width+l}px`,g=a?h:`${f}px`),{data:{x:p,y:g}}}});function jce(t){const[e,i="center"]=t.split("-");return[e,i]}var Nze=kce,Uze=Uce,Bze=Bce,Fze=zce,zze="Portal",Vce=J.forwardRef((t,e)=>{const{container:i,...r}=t,[n,s]=J.useState(!1);va(()=>s(!0),[]);const a=i||n&&globalThis?.document?.body;return a?Fse.createPortal(O.jsx(rn.div,{...r,ref:e}),a):null});Vce.displayName=zze;var jze=cre[" useInsertionEffect ".trim().toString()]||va;function kD({prop:t,defaultProp:e,onChange:i=()=>{},caller:r}){const[n,s,a]=Vze({defaultProp:e,onChange:i}),o=t!==void 0,l=o?t:n;{const u=J.useRef(t!==void 0);J.useEffect(()=>{const h=u.current;h!==o&&console.warn(`${r} is changing from ${h?"controlled":"uncontrolled"} to ${o?"controlled":"uncontrolled"}. Components should not switch from controlled to uncontrolled (or vice versa). Decide between using a controlled or uncontrolled value for the lifetime of the component.`),u.current=o},[o,r])}const c=J.useCallback(u=>{if(o){const h=Hze(u)?u(t):u;h!==t&&a.current?.(h)}else s(u)},[o,t,s,a]);return[l,c]}function Vze({defaultProp:t,onChange:e}){const[i,r]=J.useState(t),n=J.useRef(i),s=J.useRef(e);return jze(()=>{s.current=e},[e]),J.useEffect(()=>{n.current!==i&&(s.current?.(i),n.current=i)},[i,n]),[i,r,s]}function Hze(t){return typeof t=="function"}function Gze(t){const e=J.useRef({value:t,previous:t});return J.useMemo(()=>(e.current.value!==t&&(e.current.previous=e.current.value,e.current.value=t),e.current.previous),[t])}var Hce=Object.freeze({position:"absolute",border:0,width:1,height:1,padding:0,margin:-1,overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",wordWrap:"normal"}),Wze="VisuallyHidden",qze=J.forwardRef((t,e)=>O.jsx(rn.span,{...t,ref:e,style:{...Hce,...t.style}}));qze.displayName=Wze;var Xze=function(t){if(typeof document>"u")return null;var e=Array.isArray(t)?t[0]:t;return e.ownerDocument.body},Ob=new WeakMap,aP=new WeakMap,oP={},_B=0,Gce=function(t){return t&&(t.host||Gce(t.parentNode))},$ze=function(t,e){return e.map(function(i){if(t.contains(i))return i;var r=Gce(i);return r&&t.contains(r)?r:(console.error("aria-hidden",i,"in not contained inside",t,". Doing nothing"),null)}).filter(function(i){return!!i})},Yze=function(t,e,i,r){var n=$ze(e,Array.isArray(t)?t:[t]);oP[i]||(oP[i]=new WeakMap);var s=oP[i],a=[],o=new Set,l=new Set(n),c=function(h){!h||o.has(h)||(o.add(h),c(h.parentNode))};n.forEach(c);var u=function(h){!h||l.has(h)||Array.prototype.forEach.call(h.children,function(d){if(o.has(d))u(d);else try{var f=d.getAttribute(r),p=f!==null&&f!=="false",g=(Ob.get(d)||0)+1,m=(s.get(d)||0)+1;Ob.set(d,g),s.set(d,m),a.push(d),g===1&&p&&aP.set(d,!0),m===1&&d.setAttribute(i,"true"),p||d.setAttribute(r,"true")}catch(y){console.error("aria-hidden: cannot operate on ",d,y)}})};return u(e),o.clear(),_B++,function(){a.forEach(function(h){var d=Ob.get(h)-1,f=s.get(h)-1;Ob.set(h,d),s.set(h,f),d||(aP.has(h)||h.removeAttribute(r),aP.delete(h)),f||h.removeAttribute(i)}),_B--,_B||(Ob=new WeakMap,Ob=new WeakMap,aP=new WeakMap,oP={})}},Kze=function(t,e,i){i===void 0&&(i="data-aria-hidden");var r=Array.from(Array.isArray(t)?t:[t]),n=Xze(t);return n?(r.push.apply(r,Array.from(n.querySelectorAll("[aria-live], script"))),Yze(r,n,i,"aria-hidden")):function(){return null}},Ed=function(){return Ed=Object.assign||function(e){for(var i,r=1,n=arguments.length;r<n;r++){i=arguments[r];for(var s in i)Object.prototype.hasOwnProperty.call(i,s)&&(e[s]=i[s])}return e},Ed.apply(this,arguments)};function Wce(t,e){var i={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0&&(i[r]=t[r]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var n=0,r=Object.getOwnPropertySymbols(t);n<r.length;n++)e.indexOf(r[n])<0&&Object.prototype.propertyIsEnumerable.call(t,r[n])&&(i[r[n]]=t[r[n]]);return i}function Zze(t,e,i){if(i||arguments.length===2)for(var r=0,n=e.length,s;r<n;r++)(s||!(r in e))&&(s||(s=Array.prototype.slice.call(e,0,r)),s[r]=e[r]);return t.concat(s||Array.prototype.slice.call(e))}var QR="right-scroll-bar-position",JR="width-before-scroll-bar",Qze="with-scroll-bars-hidden",Jze="--removed-body-scroll-bar-size";function SB(t,e){return typeof t=="function"?t(e):t&&(t.current=e),t}function eje(t,e){var i=J.useState(function(){return{value:t,callback:e,facade:{get current(){return i.value},set current(r){var n=i.value;n!==r&&(i.value=r,i.callback(r,n))}}}})[0];return i.callback=e,i.facade}var tje=typeof window<"u"?J.useLayoutEffect:J.useEffect,DK=new WeakMap;function ije(t,e){var i=eje(null,function(r){return t.forEach(function(n){return SB(n,r)})});return tje(function(){var r=DK.get(i);if(r){var n=new Set(r),s=new Set(t),a=i.current;n.forEach(function(o){s.has(o)||SB(o,null)}),s.forEach(function(o){n.has(o)||SB(o,a)})}DK.set(i,t)},[t]),i}function rje(t){return t}function nje(t,e){e===void 0&&(e=rje);var i=[],r=!1,n={read:function(){if(r)throw new Error("Sidecar: could not `read` from an `assigned` medium. `read` could be used only with `useMedium`.");return i.length?i[i.length-1]:t},useMedium:function(s){var a=e(s,r);return i.push(a),function(){i=i.filter(function(o){return o!==a})}},assignSyncMedium:function(s){for(r=!0;i.length;){var a=i;i=[],a.forEach(s)}i={push:function(o){return s(o)},filter:function(){return i}}},assignMedium:function(s){r=!0;var a=[];if(i.length){var o=i;i=[],o.forEach(s),a=i}var l=function(){var u=a;a=[],u.forEach(s)},c=function(){return Promise.resolve().then(l)};c(),i={push:function(u){a.push(u),c()},filter:function(u){return a=a.filter(u),i}}}};return n}function sje(t){t===void 0&&(t={});var e=nje(null);return e.options=Ed({async:!0,ssr:!1},t),e}var qce=function(t){var e=t.sideCar,i=Wce(t,["sideCar"]);if(!e)throw new Error("Sidecar: please provide `sideCar` property to import the right car");var r=e.read();if(!r)throw new Error("Sidecar medium not found");return J.createElement(r,Ed({},i))};qce.isSideCarExport=!0;function aje(t,e){return t.useMedium(e),qce}var Xce=sje(),EB=function(){},QO=J.forwardRef(function(t,e){var i=J.useRef(null),r=J.useState({onScrollCapture:EB,onWheelCapture:EB,onTouchMoveCapture:EB}),n=r[0],s=r[1],a=t.forwardProps,o=t.children,l=t.className,c=t.removeScrollBar,u=t.enabled,h=t.shards,d=t.sideCar,f=t.noRelative,p=t.noIsolation,g=t.inert,m=t.allowPinchZoom,y=t.as,b=y===void 0?"div":y,w=t.gapMode,E=Wce(t,["forwardProps","children","className","removeScrollBar","enabled","shards","sideCar","noRelative","noIsolation","inert","allowPinchZoom","as","gapMode"]),M=d,A=ije([i,e]),P=Ed(Ed({},E),n);return J.createElement(J.Fragment,null,u&&J.createElement(M,{sideCar:Xce,removeScrollBar:c,shards:h,noRelative:f,noIsolation:p,inert:g,setCallbacks:s,allowPinchZoom:!!m,lockRef:i,gapMode:w}),a?J.cloneElement(J.Children.only(o),Ed(Ed({},P),{ref:A})):J.createElement(b,Ed({},P,{className:l,ref:A}),o))});QO.defaultProps={enabled:!0,removeScrollBar:!0,inert:!1};QO.classNames={fullWidth:JR,zeroRight:QR};var oje=function(){if(typeof __webpack_nonce__<"u")return __webpack_nonce__};function lje(){if(!document)return null;var t=document.createElement("style");t.type="text/css";var e=oje();return e&&t.setAttribute("nonce",e),t}function cje(t,e){t.styleSheet?t.styleSheet.cssText=e:t.appendChild(document.createTextNode(e))}function uje(t){var e=document.head||document.getElementsByTagName("head")[0];e.appendChild(t)}var hje=function(){var t=0,e=null;return{add:function(i){t==0&&(e=lje())&&(cje(e,i),uje(e)),t++},remove:function(){t--,!t&&e&&(e.parentNode&&e.parentNode.removeChild(e),e=null)}}},dje=function(){var t=hje();return function(e,i){J.useEffect(function(){return t.add(e),function(){t.remove()}},[e&&i])}},$ce=function(){var t=dje(),e=function(i){var r=i.styles,n=i.dynamic;return t(r,n),null};return e},fje={left:0,top:0,right:0,gap:0},AB=function(t){return parseInt(t||"",10)||0},pje=function(t){var e=window.getComputedStyle(document.body),i=e[t==="padding"?"paddingLeft":"marginLeft"],r=e[t==="padding"?"paddingTop":"marginTop"],n=e[t==="padding"?"paddingRight":"marginRight"];return[AB(i),AB(r),AB(n)]},mje=function(t){if(t===void 0&&(t="margin"),typeof window>"u")return fje;var e=pje(t),i=document.documentElement.clientWidth,r=window.innerWidth;return{left:e[0],top:e[1],right:e[2],gap:Math.max(0,r-i+e[2]-e[0])}},gje=$ce(),n1="data-scroll-locked",vje=function(t,e,i,r){var n=t.left,s=t.top,a=t.right,o=t.gap;return i===void 0&&(i="margin"),`
  .`.concat(Qze,` {
   overflow: hidden `).concat(r,`;
   padding-right: `).concat(o,"px ").concat(r,`;
  }
  body[`).concat(n1,`] {
    overflow: hidden `).concat(r,`;
    overscroll-behavior: contain;
    `).concat([e&&"position: relative ".concat(r,";"),i==="margin"&&`
    padding-left: `.concat(n,`px;
    padding-top: `).concat(s,`px;
    padding-right: `).concat(a,`px;
    margin-left:0;
    margin-top:0;
    margin-right: `).concat(o,"px ").concat(r,`;
    `),i==="padding"&&"padding-right: ".concat(o,"px ").concat(r,";")].filter(Boolean).join(""),`
  }
  
  .`).concat(QR,` {
    right: `).concat(o,"px ").concat(r,`;
  }
  
  .`).concat(JR,` {
    margin-right: `).concat(o,"px ").concat(r,`;
  }
  
  .`).concat(QR," .").concat(QR,` {
    right: 0 `).concat(r,`;
  }
  
  .`).concat(JR," .").concat(JR,` {
    margin-right: 0 `).concat(r,`;
  }
  
  body[`).concat(n1,`] {
    `).concat(Jze,": ").concat(o,`px;
  }
`)},OK=function(){var t=parseInt(document.body.getAttribute(n1)||"0",10);return isFinite(t)?t:0},yje=function(){J.useEffect(function(){return document.body.setAttribute(n1,(OK()+1).toString()),function(){var t=OK()-1;t<=0?document.body.removeAttribute(n1):document.body.setAttribute(n1,t.toString())}},[])},xje=function(t){var e=t.noRelative,i=t.noImportant,r=t.gapMode,n=r===void 0?"margin":r;yje();var s=J.useMemo(function(){return mje(n)},[n]);return J.createElement(gje,{styles:vje(s,!e,n,i?"":"!important")})},uj=!1;if(typeof window<"u")try{var lP=Object.defineProperty({},"passive",{get:function(){return uj=!0,!0}});window.addEventListener("test",lP,lP),window.removeEventListener("test",lP,lP)}catch{uj=!1}var Lb=uj?{passive:!1}:!1,bje=function(t){return t.tagName==="TEXTAREA"},Yce=function(t,e){if(!(t instanceof Element))return!1;var i=window.getComputedStyle(t);return i[e]!=="hidden"&&!(i.overflowY===i.overflowX&&!bje(t)&&i[e]==="visible")},wje=function(t){return Yce(t,"overflowY")},_je=function(t){return Yce(t,"overflowX")},LK=function(t,e){var i=e.ownerDocument,r=e;do{typeof ShadowRoot<"u"&&r instanceof ShadowRoot&&(r=r.host);var n=Kce(t,r);if(n){var s=Zce(t,r),a=s[1],o=s[2];if(a>o)return!0}r=r.parentNode}while(r&&r!==i.body);return!1},Sje=function(t){var e=t.scrollTop,i=t.scrollHeight,r=t.clientHeight;return[e,i,r]},Eje=function(t){var e=t.scrollLeft,i=t.scrollWidth,r=t.clientWidth;return[e,i,r]},Kce=function(t,e){return t==="v"?wje(e):_je(e)},Zce=function(t,e){return t==="v"?Sje(e):Eje(e)},Aje=function(t,e){return t==="h"&&e==="rtl"?-1:1},Mje=function(t,e,i,r,n){var s=Aje(t,window.getComputedStyle(e).direction),a=s*r,o=i.target,l=e.contains(o),c=!1,u=a>0,h=0,d=0;do{if(!o)break;var f=Zce(t,o),p=f[0],g=f[1],m=f[2],y=g-m-s*p;(p||y)&&Kce(t,o)&&(h+=y,d+=p);var b=o.parentNode;o=b&&b.nodeType===Node.DOCUMENT_FRAGMENT_NODE?b.host:b}while(!l&&o!==document.body||l&&(e.contains(o)||e===o));return(u&&Math.abs(h)<1||!u&&Math.abs(d)<1)&&(c=!0),c},cP=function(t){return"changedTouches"in t?[t.changedTouches[0].clientX,t.changedTouches[0].clientY]:[0,0]},kK=function(t){return[t.deltaX,t.deltaY]},NK=function(t){return t&&"current"in t?t.current:t},Tje=function(t,e){return t[0]===e[0]&&t[1]===e[1]},Cje=function(t){return`
  .block-interactivity-`.concat(t,` {pointer-events: none;}
  .allow-interactivity-`).concat(t,` {pointer-events: all;}
`)},Pje=0,kb=[];function Rje(t){var e=J.useRef([]),i=J.useRef([0,0]),r=J.useRef(),n=J.useState(Pje++)[0],s=J.useState($ce)[0],a=J.useRef(t);J.useEffect(function(){a.current=t},[t]),J.useEffect(function(){if(t.inert){document.body.classList.add("block-interactivity-".concat(n));var g=Zze([t.lockRef.current],(t.shards||[]).map(NK),!0).filter(Boolean);return g.forEach(function(m){return m.classList.add("allow-interactivity-".concat(n))}),function(){document.body.classList.remove("block-interactivity-".concat(n)),g.forEach(function(m){return m.classList.remove("allow-interactivity-".concat(n))})}}},[t.inert,t.lockRef.current,t.shards]);var o=J.useCallback(function(g,m){if("touches"in g&&g.touches.length===2||g.type==="wheel"&&g.ctrlKey)return!a.current.allowPinchZoom;var y=cP(g),b=i.current,w="deltaX"in g?g.deltaX:b[0]-y[0],E="deltaY"in g?g.deltaY:b[1]-y[1],M,A=g.target,P=Math.abs(w)>Math.abs(E)?"h":"v";if("touches"in g&&P==="h"&&A.type==="range")return!1;var C=LK(P,A);if(!C)return!0;if(C?M=P:(M=P==="v"?"h":"v",C=LK(P,A)),!C)return!1;if(!r.current&&"changedTouches"in g&&(w||E)&&(r.current=M),!M)return!0;var R=r.current||M;return Mje(R,m,g,R==="h"?w:E)},[]),l=J.useCallback(function(g){var m=g;if(!(!kb.length||kb[kb.length-1]!==s)){var y="deltaY"in m?kK(m):cP(m),b=e.current.filter(function(M){return M.name===m.type&&(M.target===m.target||m.target===M.shadowParent)&&Tje(M.delta,y)})[0];if(b&&b.should){m.cancelable&&m.preventDefault();return}if(!b){var w=(a.current.shards||[]).map(NK).filter(Boolean).filter(function(M){return M.contains(m.target)}),E=w.length>0?o(m,w[0]):!a.current.noIsolation;E&&m.cancelable&&m.preventDefault()}}},[]),c=J.useCallback(function(g,m,y,b){var w={name:g,delta:m,target:y,should:b,shadowParent:Ije(y)};e.current.push(w),setTimeout(function(){e.current=e.current.filter(function(E){return E!==w})},1)},[]),u=J.useCallback(function(g){i.current=cP(g),r.current=void 0},[]),h=J.useCallback(function(g){c(g.type,kK(g),g.target,o(g,t.lockRef.current))},[]),d=J.useCallback(function(g){c(g.type,cP(g),g.target,o(g,t.lockRef.current))},[]);J.useEffect(function(){return kb.push(s),t.setCallbacks({onScrollCapture:h,onWheelCapture:h,onTouchMoveCapture:d}),document.addEventListener("wheel",l,Lb),document.addEventListener("touchmove",l,Lb),document.addEventListener("touchstart",u,Lb),function(){kb=kb.filter(function(g){return g!==s}),document.removeEventListener("wheel",l,Lb),document.removeEventListener("touchmove",l,Lb),document.removeEventListener("touchstart",u,Lb)}},[]);var f=t.removeScrollBar,p=t.inert;return J.createElement(J.Fragment,null,p?J.createElement(s,{styles:Cje(n)}):null,f?J.createElement(xje,{noRelative:t.noRelative,gapMode:t.gapMode}):null)}function Ije(t){for(var e=null;t!==null;)t instanceof ShadowRoot&&(e=t.host,t=t.host),t=t.parentNode;return e}const Dje=aje(Xce,Rje);var Qce=J.forwardRef(function(t,e){return J.createElement(QO,Ed({},t,{ref:e,sideCar:Dje}))});Qce.classNames=QO.classNames;var Oje=[" ","Enter","ArrowUp","ArrowDown"],Lje=[" ","Enter"],D0="Select",[JO,eL,kje]=pce(D0),[__]=c_(D0,[kje,Oce]),tL=Oce(),[Nje,fv]=__(D0),[Uje,Bje]=__(D0),Jce=t=>{const{__scopeSelect:e,children:i,open:r,defaultOpen:n,onOpenChange:s,value:a,defaultValue:o,onValueChange:l,dir:c,name:u,autoComplete:h,disabled:d,required:f,form:p}=t,g=tL(e),[m,y]=J.useState(null),[b,w]=J.useState(null),[E,M]=J.useState(!1),A=CH(c),[P,C]=kD({prop:r,defaultProp:n??!1,onChange:s,caller:D0}),[R,I]=kD({prop:a,defaultProp:o,onChange:l,caller:D0}),k=J.useRef(null),z=m?p||!!m.closest("form"):!0,[V,F]=J.useState(new Set),$=Array.from(V).map(K=>K.props.value).join(";");return O.jsx(Nze,{...g,children:O.jsxs(Nje,{required:f,scope:e,trigger:m,onTriggerChange:y,valueNode:b,onValueNodeChange:w,valueNodeHasChildren:E,onValueNodeHasChildrenChange:M,contentId:CT(),value:R,onValueChange:I,open:P,onOpenChange:C,dir:A,triggerPointerDownPosRef:k,disabled:d,children:[O.jsx(JO.Provider,{scope:e,children:O.jsx(Uje,{scope:t.__scopeSelect,onNativeOptionAdd:J.useCallback(K=>{F(X=>new Set(X).add(K))},[]),onNativeOptionRemove:J.useCallback(K=>{F(X=>{const U=new Set(X);return U.delete(K),U})},[]),children:i})}),z?O.jsxs(wue,{"aria-hidden":!0,required:f,tabIndex:-1,name:u,autoComplete:h,value:R,onChange:K=>I(K.target.value),disabled:d,form:p,children:[R===void 0?O.jsx("option",{value:""}):null,Array.from(V)]},$):null]})})};Jce.displayName=D0;var eue="SelectTrigger",tue=J.forwardRef((t,e)=>{const{__scopeSelect:i,disabled:r=!1,...n}=t,s=tL(i),a=fv(eue,i),o=a.disabled||r,l=ga(e,a.onTriggerChange),c=eL(i),u=J.useRef("touch"),[h,d,f]=Sue(g=>{const m=c().filter(w=>!w.disabled),y=m.find(w=>w.value===a.value),b=Eue(m,g,y);b!==void 0&&a.onValueChange(b.value)}),p=g=>{o||(a.onOpenChange(!0),f()),g&&(a.triggerPointerDownPosRef.current={x:Math.round(g.pageX),y:Math.round(g.pageY)})};return O.jsx(Uze,{asChild:!0,...s,children:O.jsx(rn.button,{type:"button",role:"combobox","aria-controls":a.contentId,"aria-expanded":a.open,"aria-required":a.required,"aria-autocomplete":"none",dir:a.dir,"data-state":a.open?"open":"closed",disabled:o,"data-disabled":o?"":void 0,"data-placeholder":_ue(a.value)?"":void 0,...n,ref:l,onClick:ln(n.onClick,g=>{g.currentTarget.focus(),u.current!=="mouse"&&p(g)}),onPointerDown:ln(n.onPointerDown,g=>{u.current=g.pointerType;const m=g.target;m.hasPointerCapture(g.pointerId)&&m.releasePointerCapture(g.pointerId),g.button===0&&g.ctrlKey===!1&&g.pointerType==="mouse"&&(p(g),g.preventDefault())}),onKeyDown:ln(n.onKeyDown,g=>{const m=h.current!=="";!(g.ctrlKey||g.altKey||g.metaKey)&&g.key.length===1&&d(g.key),!(m&&g.key===" ")&&Oje.includes(g.key)&&(p(),g.preventDefault())})})})});tue.displayName=eue;var iue="SelectValue",rue=J.forwardRef((t,e)=>{const{__scopeSelect:i,className:r,style:n,children:s,placeholder:a="",...o}=t,l=fv(iue,i),{onValueNodeHasChildrenChange:c}=l,u=s!==void 0,h=ga(e,l.onValueNodeChange);return va(()=>{c(u)},[c,u]),O.jsx(rn.span,{...o,ref:h,style:{pointerEvents:"none"},children:_ue(l.value)?O.jsx(O.Fragment,{children:a}):s})});rue.displayName=iue;var Fje="SelectIcon",nue=J.forwardRef((t,e)=>{const{__scopeSelect:i,children:r,...n}=t;return O.jsx(rn.span,{"aria-hidden":!0,...n,ref:e,children:r||""})});nue.displayName=Fje;var zje="SelectPortal",sue=t=>O.jsx(Vce,{asChild:!0,...t});sue.displayName=zje;var O0="SelectContent",aue=J.forwardRef((t,e)=>{const i=fv(O0,t.__scopeSelect),[r,n]=J.useState();if(va(()=>{n(new DocumentFragment)},[]),!i.open){const s=r;return s?sT.createPortal(O.jsx(oue,{scope:t.__scopeSelect,children:O.jsx(JO.Slot,{scope:t.__scopeSelect,children:O.jsx("div",{children:t.children})})}),s):null}return O.jsx(lue,{...t,ref:e})});aue.displayName=O0;var fh=10,[oue,pv]=__(O0),jje="SelectContentImpl",Vje=$A("SelectContent.RemoveScroll"),lue=J.forwardRef((t,e)=>{const{__scopeSelect:i,position:r="item-aligned",onCloseAutoFocus:n,onEscapeKeyDown:s,onPointerDownOutside:a,side:o,sideOffset:l,align:c,alignOffset:u,arrowPadding:h,collisionBoundary:d,collisionPadding:f,sticky:p,hideWhenDetached:g,avoidCollisions:m,...y}=t,b=fv(O0,i),[w,E]=J.useState(null),[M,A]=J.useState(null),P=ga(e,le=>E(le)),[C,R]=J.useState(null),[I,k]=J.useState(null),z=eL(i),[V,F]=J.useState(!1),$=J.useRef(!1);J.useEffect(()=>{if(w)return Kze(w)},[w]),o4e();const K=J.useCallback(le=>{const[he,...ve]=z().map(Ce=>Ce.ref.current),[xe]=ve.slice(-1),Se=document.activeElement;for(const Ce of le)if(Ce===Se||(Ce?.scrollIntoView({block:"nearest"}),Ce===he&&M&&(M.scrollTop=0),Ce===xe&&M&&(M.scrollTop=M.scrollHeight),Ce?.focus(),document.activeElement!==Se))return},[z,M]),X=J.useCallback(()=>K([C,w]),[K,C,w]);J.useEffect(()=>{V&&X()},[V,X]);const{onOpenChange:U,triggerPointerDownPosRef:Y}=b;J.useEffect(()=>{if(w){let le={x:0,y:0};const he=xe=>{le={x:Math.abs(Math.round(xe.pageX)-(Y.current?.x??0)),y:Math.abs(Math.round(xe.pageY)-(Y.current?.y??0))}},ve=xe=>{le.x<=10&&le.y<=10?xe.preventDefault():w.contains(xe.target)||U(!1),document.removeEventListener("pointermove",he),Y.current=null};return Y.current!==null&&(document.addEventListener("pointermove",he),document.addEventListener("pointerup",ve,{capture:!0,once:!0})),()=>{document.removeEventListener("pointermove",he),document.removeEventListener("pointerup",ve,{capture:!0})}}},[w,U,Y]),J.useEffect(()=>{const le=()=>U(!1);return window.addEventListener("blur",le),window.addEventListener("resize",le),()=>{window.removeEventListener("blur",le),window.removeEventListener("resize",le)}},[U]);const[Z,j]=Sue(le=>{const he=z().filter(Se=>!Se.disabled),ve=he.find(Se=>Se.ref.current===document.activeElement),xe=Eue(he,le,ve);xe&&setTimeout(()=>xe.ref.current.focus())}),ee=J.useCallback((le,he,ve)=>{const xe=!$.current&&!ve;(b.value!==void 0&&b.value===he||xe)&&(R(le),xe&&($.current=!0))},[b.value]),pe=J.useCallback(()=>w?.focus(),[w]),fe=J.useCallback((le,he,ve)=>{const xe=!$.current&&!ve;(b.value!==void 0&&b.value===he||xe)&&k(le)},[b.value]),se=r==="popper"?hj:cue,re=se===hj?{side:o,sideOffset:l,align:c,alignOffset:u,arrowPadding:h,collisionBoundary:d,collisionPadding:f,sticky:p,hideWhenDetached:g,avoidCollisions:m}:{};return O.jsx(oue,{scope:i,content:w,viewport:M,onViewportChange:A,itemRefCallback:ee,selectedItem:C,onItemLeave:pe,itemTextRefCallback:fe,focusSelectedItem:X,selectedItemText:I,position:r,isPositioned:V,searchRef:Z,children:O.jsx(Qce,{as:Vje,allowPinchZoom:!0,children:O.jsx(yce,{asChild:!0,trapped:b.open,onMountAutoFocus:le=>{le.preventDefault()},onUnmountAutoFocus:ln(n,le=>{b.trigger?.focus({preventScroll:!0}),le.preventDefault()}),children:O.jsx(gce,{asChild:!0,disableOutsidePointerEvents:!0,onEscapeKeyDown:s,onPointerDownOutside:a,onFocusOutside:le=>le.preventDefault(),onDismiss:()=>b.onOpenChange(!1),children:O.jsx(se,{role:"listbox",id:b.contentId,"data-state":b.open?"open":"closed",dir:b.dir,onContextMenu:le=>le.preventDefault(),...y,...re,onPlaced:()=>F(!0),ref:P,style:{display:"flex",flexDirection:"column",outline:"none",...y.style},onKeyDown:ln(y.onKeyDown,le=>{const he=le.ctrlKey||le.altKey||le.metaKey;if(le.key==="Tab"&&le.preventDefault(),!he&&le.key.length===1&&j(le.key),["ArrowUp","ArrowDown","Home","End"].includes(le.key)){let xe=z().filter(Se=>!Se.disabled).map(Se=>Se.ref.current);if(["ArrowUp","End"].includes(le.key)&&(xe=xe.slice().reverse()),["ArrowUp","ArrowDown"].includes(le.key)){const Se=le.target,Ce=xe.indexOf(Se);xe=xe.slice(Ce+1)}setTimeout(()=>K(xe)),le.preventDefault()}})})})})})})});lue.displayName=jje;var Hje="SelectItemAlignedPosition",cue=J.forwardRef((t,e)=>{const{__scopeSelect:i,onPlaced:r,...n}=t,s=fv(O0,i),a=pv(O0,i),[o,l]=J.useState(null),[c,u]=J.useState(null),h=ga(e,P=>u(P)),d=eL(i),f=J.useRef(!1),p=J.useRef(!0),{viewport:g,selectedItem:m,selectedItemText:y,focusSelectedItem:b}=a,w=J.useCallback(()=>{if(s.trigger&&s.valueNode&&o&&c&&g&&m&&y){const P=s.trigger.getBoundingClientRect(),C=c.getBoundingClientRect(),R=s.valueNode.getBoundingClientRect(),I=y.getBoundingClientRect();if(s.dir!=="rtl"){const Se=I.left-C.left,Ce=R.left-Se,ce=P.left-Ce,Fe=P.width+ce,De=Math.max(Fe,C.width),He=window.innerWidth-fh,Be=fK(Ce,[fh,Math.max(fh,He-De)]);o.style.minWidth=Fe+"px",o.style.left=Be+"px"}else{const Se=C.right-I.right,Ce=window.innerWidth-R.right-Se,ce=window.innerWidth-P.right-Ce,Fe=P.width+ce,De=Math.max(Fe,C.width),He=window.innerWidth-fh,Be=fK(Ce,[fh,Math.max(fh,He-De)]);o.style.minWidth=Fe+"px",o.style.right=Be+"px"}const k=d(),z=window.innerHeight-fh*2,V=g.scrollHeight,F=window.getComputedStyle(c),$=parseInt(F.borderTopWidth,10),K=parseInt(F.paddingTop,10),X=parseInt(F.borderBottomWidth,10),U=parseInt(F.paddingBottom,10),Y=$+K+V+U+X,Z=Math.min(m.offsetHeight*5,Y),j=window.getComputedStyle(g),ee=parseInt(j.paddingTop,10),pe=parseInt(j.paddingBottom,10),fe=P.top+P.height/2-fh,se=z-fe,re=m.offsetHeight/2,le=m.offsetTop+re,he=$+K+le,ve=Y-he;if(he<=fe){const Se=k.length>0&&m===k[k.length-1].ref.current;o.style.bottom="0px";const Ce=c.clientHeight-g.offsetTop-g.offsetHeight,ce=Math.max(se,re+(Se?pe:0)+Ce+X),Fe=he+ce;o.style.height=Fe+"px"}else{const Se=k.length>0&&m===k[0].ref.current;o.style.top="0px";const ce=Math.max(fe,$+g.offsetTop+(Se?ee:0)+re)+ve;o.style.height=ce+"px",g.scrollTop=he-fe+g.offsetTop}o.style.margin=`${fh}px 0`,o.style.minHeight=Z+"px",o.style.maxHeight=z+"px",r?.(),requestAnimationFrame(()=>f.current=!0)}},[d,s.trigger,s.valueNode,o,c,g,m,y,s.dir,r]);va(()=>w(),[w]);const[E,M]=J.useState();va(()=>{c&&M(window.getComputedStyle(c).zIndex)},[c]);const A=J.useCallback(P=>{P&&p.current===!0&&(w(),b?.(),p.current=!1)},[w,b]);return O.jsx(Wje,{scope:i,contentWrapper:o,shouldExpandOnScrollRef:f,onScrollButtonChange:A,children:O.jsx("div",{ref:l,style:{display:"flex",flexDirection:"column",position:"fixed",zIndex:E},children:O.jsx(rn.div,{...n,ref:h,style:{boxSizing:"border-box",maxHeight:"100%",...n.style}})})})});cue.displayName=Hje;var Gje="SelectPopperPosition",hj=J.forwardRef((t,e)=>{const{__scopeSelect:i,align:r="start",collisionPadding:n=fh,...s}=t,a=tL(i);return O.jsx(Bze,{...a,...s,ref:e,align:r,collisionPadding:n,style:{boxSizing:"border-box",...s.style,"--radix-select-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-select-content-available-width":"var(--radix-popper-available-width)","--radix-select-content-available-height":"var(--radix-popper-available-height)","--radix-select-trigger-width":"var(--radix-popper-anchor-width)","--radix-select-trigger-height":"var(--radix-popper-anchor-height)"}})});hj.displayName=Gje;var[Wje,UH]=__(O0,{}),dj="SelectViewport",uue=J.forwardRef((t,e)=>{const{__scopeSelect:i,nonce:r,...n}=t,s=pv(dj,i),a=UH(dj,i),o=ga(e,s.onViewportChange),l=J.useRef(0);return O.jsxs(O.Fragment,{children:[O.jsx("style",{dangerouslySetInnerHTML:{__html:"[data-radix-select-viewport]{scrollbar-width:none;-ms-overflow-style:none;-webkit-overflow-scrolling:touch;}[data-radix-select-viewport]::-webkit-scrollbar{display:none}"},nonce:r}),O.jsx(JO.Slot,{scope:i,children:O.jsx(rn.div,{"data-radix-select-viewport":"",role:"presentation",...n,ref:o,style:{position:"relative",flex:1,overflow:"hidden auto",...n.style},onScroll:ln(n.onScroll,c=>{const u=c.currentTarget,{contentWrapper:h,shouldExpandOnScrollRef:d}=a;if(d?.current&&h){const f=Math.abs(l.current-u.scrollTop);if(f>0){const p=window.innerHeight-fh*2,g=parseFloat(h.style.minHeight),m=parseFloat(h.style.height),y=Math.max(g,m);if(y<p){const b=y+f,w=Math.min(p,b),E=b-w;h.style.height=w+"px",h.style.bottom==="0px"&&(u.scrollTop=E>0?E:0,h.style.justifyContent="flex-end")}}}l.current=u.scrollTop})})})]})});uue.displayName=dj;var hue="SelectGroup",[qje,Xje]=__(hue),$je=J.forwardRef((t,e)=>{const{__scopeSelect:i,...r}=t,n=CT();return O.jsx(qje,{scope:i,id:n,children:O.jsx(rn.div,{role:"group","aria-labelledby":n,...r,ref:e})})});$je.displayName=hue;var due="SelectLabel",Yje=J.forwardRef((t,e)=>{const{__scopeSelect:i,...r}=t,n=Xje(due,i);return O.jsx(rn.div,{id:n.id,...r,ref:e})});Yje.displayName=due;var ND="SelectItem",[Kje,fue]=__(ND),pue=J.forwardRef((t,e)=>{const{__scopeSelect:i,value:r,disabled:n=!1,textValue:s,...a}=t,o=fv(ND,i),l=pv(ND,i),c=o.value===r,[u,h]=J.useState(s??""),[d,f]=J.useState(!1),p=ga(e,b=>l.itemRefCallback?.(b,r,n)),g=CT(),m=J.useRef("touch"),y=()=>{n||(o.onValueChange(r),o.onOpenChange(!1))};if(r==="")throw new Error("A <Select.Item /> must have a value prop that is not an empty string. This is because the Select value can be set to an empty string to clear the selection and show the placeholder.");return O.jsx(Kje,{scope:i,value:r,disabled:n,textId:g,isSelected:c,onItemTextChange:J.useCallback(b=>{h(w=>w||(b?.textContent??"").trim())},[]),children:O.jsx(JO.ItemSlot,{scope:i,value:r,disabled:n,textValue:u,children:O.jsx(rn.div,{role:"option","aria-labelledby":g,"data-highlighted":d?"":void 0,"aria-selected":c&&d,"data-state":c?"checked":"unchecked","aria-disabled":n||void 0,"data-disabled":n?"":void 0,tabIndex:n?void 0:-1,...a,ref:p,onFocus:ln(a.onFocus,()=>f(!0)),onBlur:ln(a.onBlur,()=>f(!1)),onClick:ln(a.onClick,()=>{m.current!=="mouse"&&y()}),onPointerUp:ln(a.onPointerUp,()=>{m.current==="mouse"&&y()}),onPointerDown:ln(a.onPointerDown,b=>{m.current=b.pointerType}),onPointerMove:ln(a.onPointerMove,b=>{m.current=b.pointerType,n?l.onItemLeave?.():m.current==="mouse"&&b.currentTarget.focus({preventScroll:!0})}),onPointerLeave:ln(a.onPointerLeave,b=>{b.currentTarget===document.activeElement&&l.onItemLeave?.()}),onKeyDown:ln(a.onKeyDown,b=>{l.searchRef?.current!==""&&b.key===" "||(Lje.includes(b.key)&&y(),b.key===" "&&b.preventDefault())})})})})});pue.displayName=ND;var VE="SelectItemText",mue=J.forwardRef((t,e)=>{const{__scopeSelect:i,className:r,style:n,...s}=t,a=fv(VE,i),o=pv(VE,i),l=fue(VE,i),c=Bje(VE,i),[u,h]=J.useState(null),d=ga(e,y=>h(y),l.onItemTextChange,y=>o.itemTextRefCallback?.(y,l.value,l.disabled)),f=u?.textContent,p=J.useMemo(()=>O.jsx("option",{value:l.value,disabled:l.disabled,children:f},l.value),[l.disabled,l.value,f]),{onNativeOptionAdd:g,onNativeOptionRemove:m}=c;return va(()=>(g(p),()=>m(p)),[g,m,p]),O.jsxs(O.Fragment,{children:[O.jsx(rn.span,{id:l.textId,...s,ref:d}),l.isSelected&&a.valueNode&&!a.valueNodeHasChildren?sT.createPortal(s.children,a.valueNode):null]})});mue.displayName=VE;var gue="SelectItemIndicator",vue=J.forwardRef((t,e)=>{const{__scopeSelect:i,...r}=t;return fue(gue,i).isSelected?O.jsx(rn.span,{"aria-hidden":!0,...r,ref:e}):null});vue.displayName=gue;var fj="SelectScrollUpButton",yue=J.forwardRef((t,e)=>{const i=pv(fj,t.__scopeSelect),r=UH(fj,t.__scopeSelect),[n,s]=J.useState(!1),a=ga(e,r.onScrollButtonChange);return va(()=>{if(i.viewport&&i.isPositioned){let o=function(){const c=l.scrollTop>0;s(c)};const l=i.viewport;return o(),l.addEventListener("scroll",o),()=>l.removeEventListener("scroll",o)}},[i.viewport,i.isPositioned]),n?O.jsx(bue,{...t,ref:a,onAutoScroll:()=>{const{viewport:o,selectedItem:l}=i;o&&l&&(o.scrollTop=o.scrollTop-l.offsetHeight)}}):null});yue.displayName=fj;var pj="SelectScrollDownButton",xue=J.forwardRef((t,e)=>{const i=pv(pj,t.__scopeSelect),r=UH(pj,t.__scopeSelect),[n,s]=J.useState(!1),a=ga(e,r.onScrollButtonChange);return va(()=>{if(i.viewport&&i.isPositioned){let o=function(){const c=l.scrollHeight-l.clientHeight,u=Math.ceil(l.scrollTop)<c;s(u)};const l=i.viewport;return o(),l.addEventListener("scroll",o),()=>l.removeEventListener("scroll",o)}},[i.viewport,i.isPositioned]),n?O.jsx(bue,{...t,ref:a,onAutoScroll:()=>{const{viewport:o,selectedItem:l}=i;o&&l&&(o.scrollTop=o.scrollTop+l.offsetHeight)}}):null});xue.displayName=pj;var bue=J.forwardRef((t,e)=>{const{__scopeSelect:i,onAutoScroll:r,...n}=t,s=pv("SelectScrollButton",i),a=J.useRef(null),o=eL(i),l=J.useCallback(()=>{a.current!==null&&(window.clearInterval(a.current),a.current=null)},[]);return J.useEffect(()=>()=>l(),[l]),va(()=>{o().find(u=>u.ref.current===document.activeElement)?.ref.current?.scrollIntoView({block:"nearest"})},[o]),O.jsx(rn.div,{"aria-hidden":!0,...n,ref:e,style:{flexShrink:0,...n.style},onPointerDown:ln(n.onPointerDown,()=>{a.current===null&&(a.current=window.setInterval(r,50))}),onPointerMove:ln(n.onPointerMove,()=>{s.onItemLeave?.(),a.current===null&&(a.current=window.setInterval(r,50))}),onPointerLeave:ln(n.onPointerLeave,()=>{l()})})}),Zje="SelectSeparator",Qje=J.forwardRef((t,e)=>{const{__scopeSelect:i,...r}=t;return O.jsx(rn.div,{"aria-hidden":!0,...r,ref:e})});Qje.displayName=Zje;var mj="SelectArrow",Jje=J.forwardRef((t,e)=>{const{__scopeSelect:i,...r}=t,n=tL(i),s=fv(mj,i),a=pv(mj,i);return s.open&&a.position==="popper"?O.jsx(Fze,{...n,...r,ref:e}):null});Jje.displayName=mj;var e5e="SelectBubbleInput",wue=J.forwardRef(({__scopeSelect:t,value:e,...i},r)=>{const n=J.useRef(null),s=ga(r,n),a=Gze(e);return J.useEffect(()=>{const o=n.current;if(!o)return;const l=window.HTMLSelectElement.prototype,u=Object.getOwnPropertyDescriptor(l,"value").set;if(a!==e&&u){const h=new Event("change",{bubbles:!0});u.call(o,e),o.dispatchEvent(h)}},[a,e]),O.jsx(rn.select,{...i,style:{...Hce,...i.style},ref:s,defaultValue:e})});wue.displayName=e5e;function _ue(t){return t===""||t===void 0}function Sue(t){const e=Up(t),i=J.useRef(""),r=J.useRef(0),n=J.useCallback(a=>{const o=i.current+a;e(o),(function l(c){i.current=c,window.clearTimeout(r.current),c!==""&&(r.current=window.setTimeout(()=>l(""),1e3))})(o)},[e]),s=J.useCallback(()=>{i.current="",window.clearTimeout(r.current)},[]);return J.useEffect(()=>()=>window.clearTimeout(r.current),[]),[i,n,s]}function Eue(t,e,i){const n=e.length>1&&Array.from(e).every(c=>c===e[0])?e[0]:e,s=i?t.indexOf(i):-1;let a=t5e(t,Math.max(s,0));n.length===1&&(a=a.filter(c=>c!==i));const l=a.find(c=>c.textValue.toLowerCase().startsWith(n.toLowerCase()));return l!==i?l:void 0}function t5e(t,e){return t.map((i,r)=>t[(e+r)%t.length])}var i5e=Jce,r5e=tue,n5e=rue,s5e=nue,a5e=sue,o5e=aue,l5e=uue,c5e=pue,u5e=mue,h5e=vue,d5e=yue,f5e=xue;function Nb({...t}){return O.jsx(i5e,{"data-slot":"select",...t})}function Ub({...t}){return O.jsx(n5e,{"data-slot":"select-value",...t})}function Bb({className:t,size:e="default",children:i,...r}){return O.jsxs(r5e,{"data-slot":"select-trigger","data-size":e,className:Ws("border-input data-[placeholder]:text-muted-foreground [&_svg:not([class*='text-'])]:text-muted-foreground focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 dark:hover:bg-input/50 flex w-full items-center justify-between gap-2 rounded-md border bg-input-background px-3 py-2 text-sm whitespace-nowrap transition-[color,box-shadow] outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50 data-[size=default]:h-9 data-[size=sm]:h-8 *:data-[slot=select-value]:line-clamp-1 *:data-[slot=select-value]:flex *:data-[slot=select-value]:items-center *:data-[slot=select-value]:gap-2 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",t),...r,children:[i,O.jsx(s5e,{asChild:!0,children:O.jsx(rT,{className:"size-4 opacity-50"})})]})}function Fb({className:t,children:e,position:i="popper",...r}){return O.jsx(a5e,{children:O.jsxs(o5e,{"data-slot":"select-content",className:Ws("bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 relative z-50 max-h-(--radix-select-content-available-height) min-w-[8rem] origin-(--radix-select-content-transform-origin) overflow-x-hidden overflow-y-auto rounded-md border shadow-md",i==="popper"&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",t),position:i,...r,children:[O.jsx(p5e,{}),O.jsx(l5e,{className:Ws("p-1",i==="popper"&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)] scroll-my-1"),children:e}),O.jsx(m5e,{})]})})}function Hi({className:t,children:e,...i}){return O.jsxs(c5e,{"data-slot":"select-item",className:Ws("focus:bg-accent focus:text-accent-foreground [&_svg:not([class*='text-'])]:text-muted-foreground relative flex w-full cursor-default items-center gap-2 rounded-sm py-1.5 pr-8 pl-2 text-sm outline-hidden select-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4 *:[span]:last:flex *:[span]:last:items-center *:[span]:last:gap-2",t),...i,children:[O.jsx("span",{className:"absolute right-2 flex size-3.5 items-center justify-center",children:O.jsx(h5e,{children:O.jsx(c1e,{className:"size-4"})})}),O.jsx(u5e,{children:e})]})}function p5e({className:t,...e}){return O.jsx(d5e,{"data-slot":"select-scroll-up-button",className:Ws("flex cursor-default items-center justify-center py-1",t),...e,children:O.jsx(s6,{className:"size-4"})})}function m5e({className:t,...e}){return O.jsx(f5e,{"data-slot":"select-scroll-down-button",className:Ws("flex cursor-default items-center justify-center py-1",t),...e,children:O.jsx(rT,{className:"size-4"})})}var MB="rovingFocusGroup.onEntryFocus",g5e={bubbles:!1,cancelable:!0},RT="RovingFocusGroup",[gj,Aue,v5e]=pce(RT),[y5e,Mue]=c_(RT,[v5e]),[x5e,b5e]=y5e(RT),Tue=J.forwardRef((t,e)=>O.jsx(gj.Provider,{scope:t.__scopeRovingFocusGroup,children:O.jsx(gj.Slot,{scope:t.__scopeRovingFocusGroup,children:O.jsx(w5e,{...t,ref:e})})}));Tue.displayName=RT;var w5e=J.forwardRef((t,e)=>{const{__scopeRovingFocusGroup:i,orientation:r,loop:n=!1,dir:s,currentTabStopId:a,defaultCurrentTabStopId:o,onCurrentTabStopIdChange:l,onEntryFocus:c,preventScrollOnEntryFocus:u=!1,...h}=t,d=J.useRef(null),f=ga(e,d),p=CH(s),[g,m]=kD({prop:a,defaultProp:o??null,onChange:l,caller:RT}),[y,b]=J.useState(!1),w=Up(c),E=Aue(i),M=J.useRef(!1),[A,P]=J.useState(0);return J.useEffect(()=>{const C=d.current;if(C)return C.addEventListener(MB,w),()=>C.removeEventListener(MB,w)},[w]),O.jsx(x5e,{scope:i,orientation:r,dir:p,loop:n,currentTabStopId:g,onItemFocus:J.useCallback(C=>m(C),[m]),onItemShiftTab:J.useCallback(()=>b(!0),[]),onFocusableItemAdd:J.useCallback(()=>P(C=>C+1),[]),onFocusableItemRemove:J.useCallback(()=>P(C=>C-1),[]),children:O.jsx(rn.div,{tabIndex:y||A===0?-1:0,"data-orientation":r,...h,ref:f,style:{outline:"none",...t.style},onMouseDown:ln(t.onMouseDown,()=>{M.current=!0}),onFocus:ln(t.onFocus,C=>{const R=!M.current;if(C.target===C.currentTarget&&R&&!y){const I=new CustomEvent(MB,g5e);if(C.currentTarget.dispatchEvent(I),!I.defaultPrevented){const k=E().filter(K=>K.focusable),z=k.find(K=>K.active),V=k.find(K=>K.id===g),$=[z,V,...k].filter(Boolean).map(K=>K.ref.current);Rue($,u)}}M.current=!1}),onBlur:ln(t.onBlur,()=>b(!1))})})}),Cue="RovingFocusGroupItem",Pue=J.forwardRef((t,e)=>{const{__scopeRovingFocusGroup:i,focusable:r=!0,active:n=!1,tabStopId:s,children:a,...o}=t,l=CT(),c=s||l,u=b5e(Cue,i),h=u.currentTabStopId===c,d=Aue(i),{onFocusableItemAdd:f,onFocusableItemRemove:p,currentTabStopId:g}=u;return J.useEffect(()=>{if(r)return f(),()=>p()},[r,f,p]),O.jsx(gj.ItemSlot,{scope:i,id:c,focusable:r,active:n,children:O.jsx(rn.span,{tabIndex:h?0:-1,"data-orientation":u.orientation,...o,ref:e,onMouseDown:ln(t.onMouseDown,m=>{r?u.onItemFocus(c):m.preventDefault()}),onFocus:ln(t.onFocus,()=>u.onItemFocus(c)),onKeyDown:ln(t.onKeyDown,m=>{if(m.key==="Tab"&&m.shiftKey){u.onItemShiftTab();return}if(m.target!==m.currentTarget)return;const y=E5e(m,u.orientation,u.dir);if(y!==void 0){if(m.metaKey||m.ctrlKey||m.altKey||m.shiftKey)return;m.preventDefault();let w=d().filter(E=>E.focusable).map(E=>E.ref.current);if(y==="last")w.reverse();else if(y==="prev"||y==="next"){y==="prev"&&w.reverse();const E=w.indexOf(m.currentTarget);w=u.loop?A5e(w,E+1):w.slice(E+1)}setTimeout(()=>Rue(w))}}),children:typeof a=="function"?a({isCurrentTabStop:h,hasTabStop:g!=null}):a})})});Pue.displayName=Cue;var _5e={ArrowLeft:"prev",ArrowUp:"prev",ArrowRight:"next",ArrowDown:"next",PageUp:"first",Home:"first",PageDown:"last",End:"last"};function S5e(t,e){return e!=="rtl"?t:t==="ArrowLeft"?"ArrowRight":t==="ArrowRight"?"ArrowLeft":t}function E5e(t,e,i){const r=S5e(t.key,i);if(!(e==="vertical"&&["ArrowLeft","ArrowRight"].includes(r))&&!(e==="horizontal"&&["ArrowUp","ArrowDown"].includes(r)))return _5e[r]}function Rue(t,e=!1){const i=document.activeElement;for(const r of t)if(r===i||(r.focus({preventScroll:e}),document.activeElement!==i))return}function A5e(t,e){return t.map((i,r)=>t[(e+r)%t.length])}var M5e=Tue,T5e=Pue;function C5e(t,e){return J.useReducer((i,r)=>e[i][r]??i,t)}var Iue=t=>{const{present:e,children:i}=t,r=P5e(e),n=typeof i=="function"?i({present:r.isPresent}):J.Children.only(i),s=ga(r.ref,R5e(n));return typeof i=="function"||r.isPresent?J.cloneElement(n,{ref:s}):null};Iue.displayName="Presence";function P5e(t){const[e,i]=J.useState(),r=J.useRef(null),n=J.useRef(t),s=J.useRef("none"),a=t?"mounted":"unmounted",[o,l]=C5e(a,{mounted:{UNMOUNT:"unmounted",ANIMATION_OUT:"unmountSuspended"},unmountSuspended:{MOUNT:"mounted",ANIMATION_END:"unmounted"},unmounted:{MOUNT:"mounted"}});return J.useEffect(()=>{const c=uP(r.current);s.current=o==="mounted"?c:"none"},[o]),va(()=>{const c=r.current,u=n.current;if(u!==t){const d=s.current,f=uP(c);t?l("MOUNT"):f==="none"||c?.display==="none"?l("UNMOUNT"):l(u&&d!==f?"ANIMATION_OUT":"UNMOUNT"),n.current=t}},[t,l]),va(()=>{if(e){let c;const u=e.ownerDocument.defaultView??window,h=f=>{const g=uP(r.current).includes(CSS.escape(f.animationName));if(f.target===e&&g&&(l("ANIMATION_END"),!n.current)){const m=e.style.animationFillMode;e.style.animationFillMode="forwards",c=u.setTimeout(()=>{e.style.animationFillMode==="forwards"&&(e.style.animationFillMode=m)})}},d=f=>{f.target===e&&(s.current=uP(r.current))};return e.addEventListener("animationstart",d),e.addEventListener("animationcancel",h),e.addEventListener("animationend",h),()=>{u.clearTimeout(c),e.removeEventListener("animationstart",d),e.removeEventListener("animationcancel",h),e.removeEventListener("animationend",h)}}else l("ANIMATION_END")},[e,l]),{isPresent:["mounted","unmountSuspended"].includes(o),ref:J.useCallback(c=>{r.current=c?getComputedStyle(c):null,i(c)},[])}}function uP(t){return t?.animationName||"none"}function R5e(t){let e=Object.getOwnPropertyDescriptor(t.props,"ref")?.get,i=e&&"isReactWarning"in e&&e.isReactWarning;return i?t.ref:(e=Object.getOwnPropertyDescriptor(t,"ref")?.get,i=e&&"isReactWarning"in e&&e.isReactWarning,i?t.props.ref:t.props.ref||t.ref)}var iL="Tabs",[I5e]=c_(iL,[Mue]),Due=Mue(),[D5e,BH]=I5e(iL),Oue=J.forwardRef((t,e)=>{const{__scopeTabs:i,value:r,onValueChange:n,defaultValue:s,orientation:a="horizontal",dir:o,activationMode:l="automatic",...c}=t,u=CH(o),[h,d]=kD({prop:r,onChange:n,defaultProp:s??"",caller:iL});return O.jsx(D5e,{scope:i,baseId:CT(),value:h,onValueChange:d,orientation:a,dir:u,activationMode:l,children:O.jsx(rn.div,{dir:u,"data-orientation":a,...c,ref:e})})});Oue.displayName=iL;var Lue="TabsList",kue=J.forwardRef((t,e)=>{const{__scopeTabs:i,loop:r=!0,...n}=t,s=BH(Lue,i),a=Due(i);return O.jsx(M5e,{asChild:!0,...a,orientation:s.orientation,dir:s.dir,loop:r,children:O.jsx(rn.div,{role:"tablist","aria-orientation":s.orientation,...n,ref:e})})});kue.displayName=Lue;var Nue="TabsTrigger",Uue=J.forwardRef((t,e)=>{const{__scopeTabs:i,value:r,disabled:n=!1,...s}=t,a=BH(Nue,i),o=Due(i),l=zue(a.baseId,r),c=jue(a.baseId,r),u=r===a.value;return O.jsx(T5e,{asChild:!0,...o,focusable:!n,active:u,children:O.jsx(rn.button,{type:"button",role:"tab","aria-selected":u,"aria-controls":c,"data-state":u?"active":"inactive","data-disabled":n?"":void 0,disabled:n,id:l,...s,ref:e,onMouseDown:ln(t.onMouseDown,h=>{!n&&h.button===0&&h.ctrlKey===!1?a.onValueChange(r):h.preventDefault()}),onKeyDown:ln(t.onKeyDown,h=>{[" ","Enter"].includes(h.key)&&a.onValueChange(r)}),onFocus:ln(t.onFocus,()=>{const h=a.activationMode!=="manual";!u&&!n&&h&&a.onValueChange(r)})})})});Uue.displayName=Nue;var Bue="TabsContent",Fue=J.forwardRef((t,e)=>{const{__scopeTabs:i,value:r,forceMount:n,children:s,...a}=t,o=BH(Bue,i),l=zue(o.baseId,r),c=jue(o.baseId,r),u=r===o.value,h=J.useRef(u);return J.useEffect(()=>{const d=requestAnimationFrame(()=>h.current=!1);return()=>cancelAnimationFrame(d)},[]),O.jsx(Iue,{present:n||u,children:({present:d})=>O.jsx(rn.div,{"data-state":u?"active":"inactive","data-orientation":o.orientation,role:"tabpanel","aria-labelledby":l,hidden:!d,id:c,tabIndex:0,...a,ref:e,style:{...t.style,animationDuration:h.current?"0s":void 0},children:d&&s})})});Fue.displayName=Bue;function zue(t,e){return`${t}-trigger-${e}`}function jue(t,e){return`${t}-content-${e}`}var O5e=Oue,L5e=kue,k5e=Uue,N5e=Fue;function U5e({className:t,...e}){return O.jsx(O5e,{"data-slot":"tabs",className:Ws("flex flex-col gap-2",t),...e})}function B5e({className:t,...e}){return O.jsx(L5e,{"data-slot":"tabs-list",className:Ws("bg-muted text-muted-foreground inline-flex h-9 w-fit items-center justify-center rounded-xl p-[3px] flex",t),...e})}function UK({className:t,...e}){return O.jsx(k5e,{"data-slot":"tabs-trigger",className:Ws("data-[state=active]:bg-card dark:data-[state=active]:text-foreground focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:outline-ring dark:data-[state=active]:border-input dark:data-[state=active]:bg-input/30 text-foreground dark:text-muted-foreground inline-flex h-[calc(100%-1px)] flex-1 items-center justify-center gap-1.5 rounded-xl border border-transparent px-2 py-1 text-sm font-medium whitespace-nowrap transition-[color,box-shadow] focus-visible:ring-[3px] focus-visible:outline-1 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",t),...e})}function BK({className:t,...e}){return O.jsx(N5e,{"data-slot":"tabs-content",className:Ws("flex-1 outline-none",t),...e})}function TB({userType:t}){const i=(()=>{switch(t){case"scientist":return[{icon:Pd,text:"Scanning research papers...",color:"text-blue-400"},{icon:ss,text:"Analyzing methodologies...",color:"text-cyan-400"},{icon:cse,text:"Processing scientific data...",color:"text-blue-300"},{icon:mu,text:"Generating insights...",color:"text-blue-500"}];case"investor":return[{icon:Pd,text:"Evaluating market potential...",color:"text-green-400"},{icon:Mh,text:"Analyzing commercial applications...",color:"text-emerald-400"},{icon:ss,text:"Processing investment data...",color:"text-green-300"},{icon:mu,text:"Generating opportunities...",color:"text-green-500"}];case"mission-architect":return[{icon:Pd,text:"Reviewing mission parameters...",color:"text-red-400"},{icon:ZA,text:"Assessing safety protocols...",color:"text-orange-400"},{icon:ss,text:"Planning mission architecture...",color:"text-red-300"},{icon:mu,text:"Optimizing efficiency...",color:"text-red-500"}];default:return[{icon:Pd,text:"Searching knowledge base...",color:"text-purple-400"},{icon:ss,text:"Processing information...",color:"text-pink-400"},{icon:Mh,text:"Analyzing patterns...",color:"text-purple-300"},{icon:mu,text:"Generating response...",color:"text-purple-500"}]}})();return O.jsx(zn,{className:"bg-white/5 backdrop-blur-sm border-white/10",children:O.jsx(jn,{className:"p-6",children:O.jsxs("div",{className:"space-y-6",children:[O.jsx("div",{className:"flex items-center justify-center",children:O.jsxs(Rt.div,{animate:{rotate:360},transition:{duration:3,repeat:1/0,ease:"linear"},className:"relative",children:[O.jsx("div",{className:"w-24 h-24 border-4 border-white/20 rounded-full"}),O.jsx(Rt.div,{animate:{rotate:-360},transition:{duration:2,repeat:1/0,ease:"linear"},className:"absolute inset-2 border-4 border-transparent border-t-white border-r-white rounded-full"}),O.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:O.jsx(Rt.div,{animate:{scale:[1,1.2,1]},transition:{duration:1.5,repeat:1/0},children:O.jsx(ss,{className:"w-8 h-8 text-white"})})})]})}),O.jsx("div",{className:"space-y-4",children:i.map((r,n)=>{const s=r.icon;return O.jsxs(Rt.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:n*.8,duration:.5},className:"flex items-center gap-4 p-3 bg-white/5 rounded-lg border border-white/10",children:[O.jsx(Rt.div,{animate:{rotate:360,scale:[1,1.1,1]},transition:{rotate:{duration:2,repeat:1/0,ease:"linear"},scale:{duration:1,repeat:1/0,delay:n*.2}},children:O.jsx(s,{className:`w-5 h-5 ${r.color}`})}),O.jsx("span",{className:"text-white",children:r.text}),O.jsx(Rt.div,{initial:{width:0},animate:{width:"100%"},transition:{delay:n*.8+.5,duration:2},className:"flex-1 h-1 bg-white/20 rounded-full overflow-hidden ml-auto max-w-32",children:O.jsx(Rt.div,{initial:{x:"-100%"},animate:{x:"100%"},transition:{delay:n*.8+.5,duration:2,repeat:1/0,ease:"linear"},className:`h-full w-1/3 bg-gradient-to-r ${t==="scientist"?"from-blue-500 to-cyan-500":t==="investor"?"from-green-500 to-emerald-500":t==="mission-architect"?"from-red-500 to-orange-500":"from-purple-500 to-pink-500"}`})})]},n)})}),O.jsx("div",{className:"flex justify-center",children:O.jsx("div",{className:"flex gap-2",children:[...Array(5)].map((r,n)=>O.jsx(Rt.div,{animate:{scale:[1,1.5,1],opacity:[.5,1,.5]},transition:{duration:1,repeat:1/0,delay:n*.1},className:"w-2 h-2 bg-white rounded-full"},n))})}),O.jsxs("div",{className:"text-center",children:[O.jsx(Rt.p,{animate:{opacity:[.5,1,.5]},transition:{duration:2,repeat:1/0},className:"text-white/80",children:"AI Agent is analyzing your request..."}),O.jsx("p",{className:"text-gray-400 text-sm mt-2",children:"This may take a few moments for complex analyses"})]})]})})})}const F5e=t=>t.some(e=>["microgravity","radiation","space medicine"].includes(e.toLowerCase()))?O.jsx(J1e,{className:"w-5 h-5 text-yellow-400"}):t.some(e=>["biology","plants","animals","life sciences"].includes(e.toLowerCase()))?O.jsx(k1e,{className:"w-5 h-5 text-green-400"}):t.some(e=>["experiments","methodology","research"].includes(e.toLowerCase()))?O.jsx(E1e,{className:"w-5 h-5 text-blue-400"}):O.jsx(oA,{className:"w-5 h-5 text-gray-400"}),hP=({paper:t,theme:e,onPaperClick:i,onDownload:r})=>O.jsx(Rt.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},whileHover:{scale:1.03,boxShadow:"0 0 25px rgba(255, 255, 255, 0.2), 0 0 50px rgba(0, 123, 255, 0.1)",transition:{duration:.2}},transition:{duration:.3},className:"h-full",children:O.jsxs(zn,{className:"cursor-pointer bg-white/5 backdrop-blur-sm border-white/10 hover:border-white/40 transition-all h-full flex flex-col",onClick:()=>i(t),children:[O.jsxs(Yd,{className:"pb-3 flex-grow",children:[O.jsxs("div",{className:"flex items-start justify-between gap-3 mb-2",children:[O.jsxs("div",{className:"flex items-center gap-2",children:[F5e(t.tags),O.jsx(Kd,{className:"text-white text-lg leading-tight line-clamp-2",children:t.title})]}),t.type==="recommended"&&O.jsxs(Ip,{className:`bg-gradient-to-r ${e.primary} text-white shrink-0`,children:[O.jsx(Sparkles,{className:"w-3 h-3 mr-1"}),"Recommended"]})]}),O.jsx("div",{className:"flex flex-wrap gap-2 mb-2",children:t.tags?.slice(0,3).map((n,s)=>O.jsx(Ip,{variant:"outline",className:"text-xs border-white/20 text-gray-300",children:n},s))}),O.jsx("p",{className:"text-gray-300 text-sm line-clamp-3 mb-2",children:t.abstract}),O.jsxs("div",{className:"text-gray-400 text-xs mt-auto",children:[O.jsxs("p",{children:[t.authors?.slice(0,2).join(", "),t.authors?.length>2?" et al.":""]}),O.jsxs("p",{children:[t.institution,", ",t.publicationYear]})]})]}),O.jsxs(jn,{className:"pt-0",children:[t.reason&&t.type==="recommended"&&O.jsx("div",{className:"mb-3 pt-3 border-t border-white/10",children:O.jsx("p",{className:"text-xs text-gray-400 italic",children:t.reason})}),O.jsxs("div",{className:"flex justify-between items-center mt-auto",children:[O.jsxs("div",{className:"flex gap-2",children:[t.downloadUrl&&O.jsxs(jr,{size:"sm",variant:"outline",onClick:n=>r(t,n),className:"text-gray-300 hover:text-white border-white/20",children:[O.jsx(use,{className:"w-4 h-4 mr-1"})," PDF"]}),t.externalUrl&&O.jsxs(jr,{size:"sm",variant:"outline",onClick:n=>{n.stopPropagation(),window.open(t.externalUrl,"_blank")},className:"text-gray-300 hover:text-white border-white/20",children:[O.jsx(a6,{className:"w-4 h-4 mr-1"})," View"]})]}),t.relevanceScore&&O.jsxs("div",{className:"flex items-center gap-1 text-sm text-gray-400",children:[O.jsx(oz,{className:"w-4 h-4 text-yellow-400"}),O.jsxs("span",{children:[(t.relevanceScore*100).toFixed(0),"%"]})]})]})]})]})});let z5e={data:""},j5e=t=>{if(typeof window=="object"){let e=(t?t.querySelector("#_goober"):window._goober)||Object.assign(document.createElement("style"),{innerHTML:" ",id:"_goober"});return e.nonce=window.__nonce__,e.parentNode||(t||document.head).appendChild(e),e.firstChild}return t||z5e},V5e=/(?:([\u0080-\uFFFF\w-%@]+) *:? *([^{;]+?);|([^;}{]*?) *{)|(}\s*)/g,H5e=/\/\*[^]*?\*\/|  +/g,FK=/\n+/g,yg=(t,e)=>{let i="",r="",n="";for(let s in t){let a=t[s];s[0]=="@"?s[1]=="i"?i=s+" "+a+";":r+=s[1]=="f"?yg(a,s):s+"{"+yg(a,s[1]=="k"?"":e)+"}":typeof a=="object"?r+=yg(a,e?e.replace(/([^,])+/g,o=>s.replace(/([^,]*:\S+\([^)]*\))|([^,])+/g,l=>/&/.test(l)?l.replace(/&/g,o):o?o+" "+l:l)):s):a!=null&&(s=/^--/.test(s)?s:s.replace(/[A-Z]/g,"-$&").toLowerCase(),n+=yg.p?yg.p(s,a):s+":"+a+";")}return i+(e&&n?e+"{"+n+"}":n)+r},Zf={},Vue=t=>{if(typeof t=="object"){let e="";for(let i in t)e+=i+Vue(t[i]);return e}return t},G5e=(t,e,i,r,n)=>{let s=Vue(t),a=Zf[s]||(Zf[s]=(l=>{let c=0,u=11;for(;c<l.length;)u=101*u+l.charCodeAt(c++)>>>0;return"go"+u})(s));if(!Zf[a]){let l=s!==t?t:(c=>{let u,h,d=[{}];for(;u=V5e.exec(c.replace(H5e,""));)u[4]?d.shift():u[3]?(h=u[3].replace(FK," ").trim(),d.unshift(d[0][h]=d[0][h]||{})):d[0][u[1]]=u[2].replace(FK," ").trim();return d[0]})(t);Zf[a]=yg(n?{["@keyframes "+a]:l}:l,i?"":"."+a)}let o=i&&Zf.g?Zf.g:null;return i&&(Zf.g=Zf[a]),((l,c,u,h)=>{h?c.data=c.data.replace(h,l):c.data.indexOf(l)===-1&&(c.data=u?l+c.data:c.data+l)})(Zf[a],e,r,o),a},W5e=(t,e,i)=>t.reduce((r,n,s)=>{let a=e[s];if(a&&a.call){let o=a(i),l=o&&o.props&&o.props.className||/^go/.test(o)&&o;a=l?"."+l:o&&typeof o=="object"?o.props?"":yg(o,""):o===!1?"":o}return r+n+(a??"")},"");function rL(t){let e=this||{},i=t.call?t(e.p):t;return G5e(i.unshift?i.raw?W5e(i,[].slice.call(arguments,1),e.p):i.reduce((r,n)=>Object.assign(r,n&&n.call?n(e.p):n),{}):i,j5e(e.target),e.g,e.o,e.k)}let Hue,vj,yj;rL.bind({g:1});let Wp=rL.bind({k:1});function q5e(t,e,i,r){yg.p=e,Hue=t,vj=i,yj=r}function mv(t,e){let i=this||{};return function(){let r=arguments;function n(s,a){let o=Object.assign({},s),l=o.className||n.className;i.p=Object.assign({theme:vj&&vj()},o),i.o=/ *go\d+/.test(l),o.className=rL.apply(i,r)+(l?" "+l:"");let c=t;return t[0]&&(c=o.as||t,delete o.as),yj&&c[0]&&yj(o),Hue(c,o)}return n}}var X5e=t=>typeof t=="function",UD=(t,e)=>X5e(t)?t(e):t,$5e=(()=>{let t=0;return()=>(++t).toString()})(),Gue=(()=>{let t;return()=>{if(t===void 0&&typeof window<"u"){let e=matchMedia("(prefers-reduced-motion: reduce)");t=!e||e.matches}return t}})(),Y5e=20,FH="default",Wue=(t,e)=>{let{toastLimit:i}=t.settings;switch(e.type){case 0:return{...t,toasts:[e.toast,...t.toasts].slice(0,i)};case 1:return{...t,toasts:t.toasts.map(a=>a.id===e.toast.id?{...a,...e.toast}:a)};case 2:let{toast:r}=e;return Wue(t,{type:t.toasts.find(a=>a.id===r.id)?1:0,toast:r});case 3:let{toastId:n}=e;return{...t,toasts:t.toasts.map(a=>a.id===n||n===void 0?{...a,dismissed:!0,visible:!1}:a)};case 4:return e.toastId===void 0?{...t,toasts:[]}:{...t,toasts:t.toasts.filter(a=>a.id!==e.toastId)};case 5:return{...t,pausedAt:e.time};case 6:let s=e.time-(t.pausedAt||0);return{...t,pausedAt:void 0,toasts:t.toasts.map(a=>({...a,pauseDuration:a.pauseDuration+s}))}}},eI=[],que={toasts:[],pausedAt:void 0,settings:{toastLimit:Y5e}},Ld={},Xue=(t,e=FH)=>{Ld[e]=Wue(Ld[e]||que,t),eI.forEach(([i,r])=>{i===e&&r(Ld[e])})},$ue=t=>Object.keys(Ld).forEach(e=>Xue(t,e)),K5e=t=>Object.keys(Ld).find(e=>Ld[e].toasts.some(i=>i.id===t)),nL=(t=FH)=>e=>{Xue(e,t)},Z5e={blank:4e3,error:4e3,success:2e3,loading:1/0,custom:4e3},Q5e=(t={},e=FH)=>{let[i,r]=J.useState(Ld[e]||que),n=J.useRef(Ld[e]);J.useEffect(()=>(n.current!==Ld[e]&&r(Ld[e]),eI.push([e,r]),()=>{let a=eI.findIndex(([o])=>o===e);a>-1&&eI.splice(a,1)}),[e]);let s=i.toasts.map(a=>{var o,l,c;return{...t,...t[a.type],...a,removeDelay:a.removeDelay||((o=t[a.type])==null?void 0:o.removeDelay)||t?.removeDelay,duration:a.duration||((l=t[a.type])==null?void 0:l.duration)||t?.duration||Z5e[a.type],style:{...t.style,...(c=t[a.type])==null?void 0:c.style,...a.style}}});return{...i,toasts:s}},J5e=(t,e="blank",i)=>({createdAt:Date.now(),visible:!0,dismissed:!1,type:e,ariaProps:{role:"status","aria-live":"polite"},message:t,pauseDuration:0,...i,id:i?.id||$5e()}),IT=t=>(e,i)=>{let r=J5e(e,t,i);return nL(r.toasterId||K5e(r.id))({type:2,toast:r}),r.id},ha=(t,e)=>IT("blank")(t,e);ha.error=IT("error");ha.success=IT("success");ha.loading=IT("loading");ha.custom=IT("custom");ha.dismiss=(t,e)=>{let i={type:3,toastId:t};e?nL(e)(i):$ue(i)};ha.dismissAll=t=>ha.dismiss(void 0,t);ha.remove=(t,e)=>{let i={type:4,toastId:t};e?nL(e)(i):$ue(i)};ha.removeAll=t=>ha.remove(void 0,t);ha.promise=(t,e,i)=>{let r=ha.loading(e.loading,{...i,...i?.loading});return typeof t=="function"&&(t=t()),t.then(n=>{let s=e.success?UD(e.success,n):void 0;return s?ha.success(s,{id:r,...i,...i?.success}):ha.dismiss(r),n}).catch(n=>{let s=e.error?UD(e.error,n):void 0;s?ha.error(s,{id:r,...i,...i?.error}):ha.dismiss(r)}),t};var eVe=1e3,tVe=(t,e="default")=>{let{toasts:i,pausedAt:r}=Q5e(t,e),n=J.useRef(new Map).current,s=J.useCallback((h,d=eVe)=>{if(n.has(h))return;let f=setTimeout(()=>{n.delete(h),a({type:4,toastId:h})},d);n.set(h,f)},[]);J.useEffect(()=>{if(r)return;let h=Date.now(),d=i.map(f=>{if(f.duration===1/0)return;let p=(f.duration||0)+f.pauseDuration-(h-f.createdAt);if(p<0){f.visible&&ha.dismiss(f.id);return}return setTimeout(()=>ha.dismiss(f.id,e),p)});return()=>{d.forEach(f=>f&&clearTimeout(f))}},[i,r,e]);let a=J.useCallback(nL(e),[e]),o=J.useCallback(()=>{a({type:5,time:Date.now()})},[a]),l=J.useCallback((h,d)=>{a({type:1,toast:{id:h,height:d}})},[a]),c=J.useCallback(()=>{r&&a({type:6,time:Date.now()})},[r,a]),u=J.useCallback((h,d)=>{let{reverseOrder:f=!1,gutter:p=8,defaultPosition:g}=d||{},m=i.filter(w=>(w.position||g)===(h.position||g)&&w.height),y=m.findIndex(w=>w.id===h.id),b=m.filter((w,E)=>E<y&&w.visible).length;return m.filter(w=>w.visible).slice(...f?[b+1]:[0,b]).reduce((w,E)=>w+(E.height||0)+p,0)},[i]);return J.useEffect(()=>{i.forEach(h=>{if(h.dismissed)s(h.id,h.removeDelay);else{let d=n.get(h.id);d&&(clearTimeout(d),n.delete(h.id))}})},[i,s]),{toasts:i,handlers:{updateHeight:l,startPause:o,endPause:c,calculateOffset:u}}},iVe=Wp`
from {
  transform: scale(0) rotate(45deg);
	opacity: 0;
}
to {
 transform: scale(1) rotate(45deg);
  opacity: 1;
}`,rVe=Wp`
from {
  transform: scale(0);
  opacity: 0;
}
to {
  transform: scale(1);
  opacity: 1;
}`,nVe=Wp`
from {
  transform: scale(0) rotate(90deg);
	opacity: 0;
}
to {
  transform: scale(1) rotate(90deg);
	opacity: 1;
}`,sVe=mv("div")`
  width: 20px;
  opacity: 0;
  height: 20px;
  border-radius: 10px;
  background: ${t=>t.primary||"#ff4b4b"};
  position: relative;
  transform: rotate(45deg);

  animation: ${iVe} 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275)
    forwards;
  animation-delay: 100ms;

  &:after,
  &:before {
    content: '';
    animation: ${rVe} 0.15s ease-out forwards;
    animation-delay: 150ms;
    position: absolute;
    border-radius: 3px;
    opacity: 0;
    background: ${t=>t.secondary||"#fff"};
    bottom: 9px;
    left: 4px;
    height: 2px;
    width: 12px;
  }

  &:before {
    animation: ${nVe} 0.15s ease-out forwards;
    animation-delay: 180ms;
    transform: rotate(90deg);
  }
`,aVe=Wp`
  from {
    transform: rotate(0deg);
  }
  to {
    transform: rotate(360deg);
  }
`,oVe=mv("div")`
  width: 12px;
  height: 12px;
  box-sizing: border-box;
  border: 2px solid;
  border-radius: 100%;
  border-color: ${t=>t.secondary||"#e0e0e0"};
  border-right-color: ${t=>t.primary||"#616161"};
  animation: ${aVe} 1s linear infinite;
`,lVe=Wp`
from {
  transform: scale(0) rotate(45deg);
	opacity: 0;
}
to {
  transform: scale(1) rotate(45deg);
	opacity: 1;
}`,cVe=Wp`
0% {
	height: 0;
	width: 0;
	opacity: 0;
}
40% {
  height: 0;
	width: 6px;
	opacity: 1;
}
100% {
  opacity: 1;
  height: 10px;
}`,uVe=mv("div")`
  width: 20px;
  opacity: 0;
  height: 20px;
  border-radius: 10px;
  background: ${t=>t.primary||"#61d345"};
  position: relative;
  transform: rotate(45deg);

  animation: ${lVe} 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275)
    forwards;
  animation-delay: 100ms;
  &:after {
    content: '';
    box-sizing: border-box;
    animation: ${cVe} 0.2s ease-out forwards;
    opacity: 0;
    animation-delay: 200ms;
    position: absolute;
    border-right: 2px solid;
    border-bottom: 2px solid;
    border-color: ${t=>t.secondary||"#fff"};
    bottom: 6px;
    left: 6px;
    height: 10px;
    width: 6px;
  }
`,hVe=mv("div")`
  position: absolute;
`,dVe=mv("div")`
  position: relative;
  display: flex;
  justify-content: center;
  align-items: center;
  min-width: 20px;
  min-height: 20px;
`,fVe=Wp`
from {
  transform: scale(0.6);
  opacity: 0.4;
}
to {
  transform: scale(1);
  opacity: 1;
}`,pVe=mv("div")`
  position: relative;
  transform: scale(0.6);
  opacity: 0.4;
  min-width: 20px;
  animation: ${fVe} 0.3s 0.12s cubic-bezier(0.175, 0.885, 0.32, 1.275)
    forwards;
`,mVe=({toast:t})=>{let{icon:e,type:i,iconTheme:r}=t;return e!==void 0?typeof e=="string"?J.createElement(pVe,null,e):e:i==="blank"?null:J.createElement(dVe,null,J.createElement(oVe,{...r}),i!=="loading"&&J.createElement(hVe,null,i==="error"?J.createElement(sVe,{...r}):J.createElement(uVe,{...r})))},gVe=t=>`
0% {transform: translate3d(0,${t*-200}%,0) scale(.6); opacity:.5;}
100% {transform: translate3d(0,0,0) scale(1); opacity:1;}
`,vVe=t=>`
0% {transform: translate3d(0,0,-1px) scale(1); opacity:1;}
100% {transform: translate3d(0,${t*-150}%,-1px) scale(.6); opacity:0;}
`,yVe="0%{opacity:0;} 100%{opacity:1;}",xVe="0%{opacity:1;} 100%{opacity:0;}",bVe=mv("div")`
  display: flex;
  align-items: center;
  background: #fff;
  color: #363636;
  line-height: 1.3;
  will-change: transform;
  box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1), 0 3px 3px rgba(0, 0, 0, 0.05);
  max-width: 350px;
  pointer-events: auto;
  padding: 8px 10px;
  border-radius: 8px;
`,wVe=mv("div")`
  display: flex;
  justify-content: center;
  margin: 4px 10px;
  color: inherit;
  flex: 1 1 auto;
  white-space: pre-line;
`,_Ve=(t,e)=>{let i=t.includes("top")?1:-1,[r,n]=Gue()?[yVe,xVe]:[gVe(i),vVe(i)];return{animation:e?`${Wp(r)} 0.35s cubic-bezier(.21,1.02,.73,1) forwards`:`${Wp(n)} 0.4s forwards cubic-bezier(.06,.71,.55,1)`}},SVe=J.memo(({toast:t,position:e,style:i,children:r})=>{let n=t.height?_Ve(t.position||e||"top-center",t.visible):{opacity:0},s=J.createElement(mVe,{toast:t}),a=J.createElement(wVe,{...t.ariaProps},UD(t.message,t));return J.createElement(bVe,{className:t.className,style:{...n,...i,...t.style}},typeof r=="function"?r({icon:s,message:a}):J.createElement(J.Fragment,null,s,a))});q5e(J.createElement);var EVe=({id:t,className:e,style:i,onHeightUpdate:r,children:n})=>{let s=J.useCallback(a=>{if(a){let o=()=>{let l=a.getBoundingClientRect().height;r(t,l)};o(),new MutationObserver(o).observe(a,{subtree:!0,childList:!0,characterData:!0})}},[t,r]);return J.createElement("div",{ref:s,className:e,style:i},n)},AVe=(t,e)=>{let i=t.includes("top"),r=i?{top:0}:{bottom:0},n=t.includes("center")?{justifyContent:"center"}:t.includes("right")?{justifyContent:"flex-end"}:{};return{left:0,right:0,display:"flex",position:"absolute",transition:Gue()?void 0:"all 230ms cubic-bezier(.21,1.02,.73,1)",transform:`translateY(${e*(i?1:-1)}px)`,...r,...n}},MVe=rL`
  z-index: 9999;
  > * {
    pointer-events: auto;
  }
`,dP=16,TVe=({reverseOrder:t,position:e="top-center",toastOptions:i,gutter:r,children:n,toasterId:s,containerStyle:a,containerClassName:o})=>{let{toasts:l,handlers:c}=tVe(i,s);return J.createElement("div",{"data-rht-toaster":s||"",style:{position:"fixed",zIndex:9999,top:dP,left:dP,right:dP,bottom:dP,pointerEvents:"none",...a},className:o,onMouseEnter:c.startPause,onMouseLeave:c.endPause},l.map(u=>{let h=u.position||e,d=c.calculateOffset(u,{reverseOrder:t,gutter:r,defaultPosition:e}),f=AVe(h,d);return J.createElement(EVe,{id:u.id,key:u.id,onHeightUpdate:c.updateHeight,className:u.visible?MVe:"",style:f},u.type==="custom"?UD(u.message,u):n?n(u):J.createElement(SVe,{toast:u,position:h}))}))},CVe=ha;const zK="ykgoaspqqyolkzonuvud",jK="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InlrZ29hc3BxcXlvbGt6b251dnVkIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTg4ODMyMDksImV4cCI6MjA3NDQ1OTIwOX0.rickWLm4Q3-6JJnPlTmAtGmcM0MwMu9zYCEA8vGt9I4",PVe=JSON.parse(`[{"id":"paper_recent_1","title":"CRISPR-Cas9 Gene Editing for Plant Adaptation to Space Environments","authors":["Sarah Johnson","Michael Chen","Priya Patel"],"institution":"NASA Ames Research Center","publicationYear":2024,"abstract":"This groundbreaking study demonstrates the application of CRISPR-Cas9 gene editing technology to enhance plant resilience in space environments. By targeting specific genes related to radiation resistance and reduced gravity adaptation, researchers have developed Arabidopsis thaliana variants that show 43% improved growth in simulated space conditions.","tags":["CRISPR","gene editing","plant biology","space agriculture","radiation resistance"],"citationCount":12,"relevanceScore":0.95,"downloadUrl":"https://www.ncbi.nlm.nih.gov/pmc/articles/PMC9876543/pdf/","externalUrl":"https://www.ncbi.nlm.nih.gov/pmc/articles/PMC9876543/"},{"id":"paper_recent_2","title":"Microbiome Dynamics in Long-Duration Space Missions: Implications for Astronaut Health","authors":["David Rodriguez","Emma Wilson","Takashi Yamamoto"],"institution":"International Space Station Research Laboratory","publicationYear":2024,"abstract":"This comprehensive analysis of microbiome changes during 12-month space missions reveals significant alterations in gut, skin, and respiratory microbiota compositions. The study identifies key bacterial species shifts correlated with immune function changes and proposes targeted probiotic interventions to maintain astronaut health during extended missions.","tags":["microbiome","astronaut health","long-duration missions","probiotics","immune function"],"citationCount":8,"relevanceScore":0.92,"downloadUrl":"https://www.ncbi.nlm.nih.gov/pmc/articles/PMC9876544/pdf/","externalUrl":"https://www.ncbi.nlm.nih.gov/pmc/articles/PMC9876544/"},{"id":"paper_recent_3","title":"Synthetic Biology Approaches for Sustainable Life Support Systems in Space Habitats","authors":["Alexandra Kim","Marcus Blackwell","Sophia Nguyen"],"institution":"MIT Space Systems Laboratory","publicationYear":2024,"abstract":"This paper presents novel synthetic biology frameworks for creating closed-loop life support systems in space habitats. Engineered microorganisms capable of efficient carbon dioxide conversion, nitrogen fixation, and water purification demonstrate potential for reducing resupply requirements by up to 65% while improving habitat sustainability for long-term space exploration.","tags":["synthetic biology","life support systems","space habitats","bioengineering","sustainability"],"citationCount":15,"relevanceScore":0.97,"downloadUrl":"https://www.ncbi.nlm.nih.gov/pmc/articles/PMC9876545/pdf/","externalUrl":"https://www.ncbi.nlm.nih.gov/pmc/articles/PMC9876545/"},{"id":"paper_1","title":"Mice in Bion-M 1 space mission: training and selection","authors":["E. V. Sychova","T. G. Anokhina"],"institution":"Institute of Biomedical Problems, Russian Academy of Sciences","publicationYear":2014,"abstract":"This study details the criteria and methods used for the training and selection of mice for the Bion-M 1 biosatellite mission. It focuses on behavioral and physiological assessments to ensure the suitability of animal subjects for long-duration spaceflight experiments.","tags":["mice","bion-m 1","space mission","animal training","selection"],"citationCount":23,"relevanceScore":0.91,"downloadUrl":"https://www.ncbi.nlm.nih.gov/pmc/articles/PMC4136787/pdf/","externalUrl":"https://www.ncbi.nlm.nih.gov/pmc/articles/PMC4136787/"},{"id":"paper_2","title":"Microgravity induces pelvic bone loss through osteoclastic activity, osteocytic osteolysis, and osteoblastic cell cycle inhibition by CDKN1a/p21","authors":["Yasuhiro Nabeshima","Takahiro Abe"],"institution":"Tokyo Medical and Dental University","publicationYear":2013,"abstract":"Investigates the cellular mechanisms of bone loss in microgravity, showing that it results from increased osteoclastic activity and osteocytic osteolysis, alongside inhibition of osteoblast proliferation due to the upregulation of CDKN1a/p21.","tags":["microgravity","bone loss","osteoclasts","osteoblasts","cdkn1a"],"citationCount":158,"relevanceScore":0.98,"downloadUrl":"https://www.ncbi.nlm.nih.gov/pmc/articles/PMC3630201/pdf/","externalUrl":"https://www.ncbi.nlm.nih.gov/pmc/articles/PMC3630201/"},{"id":"paper_4","title":"Microgravity Reduces the Differentiation and Regenerative Potential of Embryonic Stem Cells","authors":["Elizabeth A. Blaber","Siobhan K. O'Brien"],"institution":"Rensselaer Polytechnic Institute","publicationYear":2021,"abstract":"This research demonstrates that exposure to simulated microgravity impairs the ability of embryonic stem cells to differentiate into various cell types, thereby reducing their potential for tissue regeneration.","tags":["embryonic stem cells","microgravity","cell differentiation","regenerative potential"],"citationCount":31,"relevanceScore":0.94,"downloadUrl":"https://www.ncbi.nlm.nih.gov/pmc/articles/PMC7998608/pdf/","externalUrl":"https://www.ncbi.nlm.nih.gov/pmc/articles/PMC7998608/"},{"id":"paper_5","title":"Spaceflight Modulates the Expression of Key Oxidative Stress and Cell Cycle Related Genes in Heart","authors":["Xiao W. Mao","Arina V. Tsvetkova"],"institution":"Loma Linda University","publicationYear":2021,"abstract":"Analyzes transcriptomic data from mouse hearts exposed to spaceflight, revealing significant modulation of genes related to oxidative stress and cell cycle regulation, which could contribute to cardiac risks during space missions.","tags":["spaceflight","cardiac health","oxidative stress","gene expression","heart"],"citationCount":19,"relevanceScore":0.92,"downloadUrl":"https://www.ncbi.nlm.nih.gov/pmc/articles/PMC8396460/pdf/","externalUrl":"https://www.ncbi.nlm.nih.gov/pmc/articles/PMC8396460/"},{"id":"paper_6","title":"Dose- and Ion-Dependent Effects in the Oxidative Stress Response to Space-Like Radiation Exposure in the Skeletal System","authors":["Eloise C. Miller","Jason T. Lee"],"institution":"University of California, Irvine","publicationYear":2017,"abstract":"Examines the impact of different types and doses of space-like radiation on the skeletal system, focusing on the oxidative stress response and its role in radiation-induced bone damage.","tags":["space radiation","skeletal system","oxidative stress","bone loss"],"citationCount":42,"relevanceScore":0.89,"downloadUrl":"https://www.ncbi.nlm.nih.gov/pmc/articles/PMC5666799/pdf/","externalUrl":"https://www.ncbi.nlm.nih.gov/pmc/articles/PMC5666799/"},{"id":"paper_7","title":"From the bench to exploration medicine: NASA life sciences translational research for human exploration and habitation missions.","authors":["Serina L. Diniega","Mark J. Shelhamer"],"institution":"NASA Johnson Space Center","publicationYear":2017,"abstract":"A review of how fundamental life sciences research conducted by NASA is translated into practical applications for ensuring astronaut health and performance during long-duration exploration missions.","tags":["nasa","translational research","space medicine","human exploration"],"citationCount":35,"relevanceScore":0.96,"downloadUrl":"https://www.ncbi.nlm.nih.gov/pmc/articles/PMC5460236/pdf/","externalUrl":"https://www.ncbi.nlm.nih.gov/pmc/articles/PMC5460236/"},{"id":"paper_8","title":"Toll mediated infection response is altered by gravity and spaceflight in Drosophila","authors":["A. S. F. Marques","S. C. R. de Lemos"],"institution":"Universidade Federal do Rio de Janeiro","publicationYear":2014,"abstract":"This study uses Drosophila melanogaster as a model organism to investigate how altered gravity and spaceflight conditions affect the Toll signaling pathway, a crucial component of the innate immune response to infection.","tags":["drosophila","spaceflight","immunology","toll pathway","gravity"],"citationCount":54,"relevanceScore":0.9,"downloadUrl":"https://www.ncbi.nlm.nih.gov/pmc/articles/PMC3901686/pdf/","externalUrl":"https://www.ncbi.nlm.nih.gov/pmc/articles/PMC3901686/"},{"id":"paper_9","title":"Multi-omics analysis of multiple missions to space reveal a theme of lipid dysregulation in mouse liver","authors":["Karen S. Sfanos","Afshin Beheshti"],"institution":"Johns Hopkins School of Medicine","publicationYear":2020,"abstract":"A comprehensive multi-omics analysis of liver samples from mice flown on multiple space missions identifies a consistent pattern of lipid metabolism dysregulation, suggesting a risk of liver disease during long-term space travel.","tags":["multi-omics","spaceflight","liver","lipid metabolism","mouse model"],"citationCount":97,"relevanceScore":0.97,"downloadUrl":"https://www.ncbi.nlm.nih.gov/pmc/articles/PMC6985101/pdf/","externalUrl":"https://www.ncbi.nlm.nih.gov/pmc/articles/PMC6985101/"},{"id":"paper_10","title":"NASA GeneLab platform utilized for biological response to space radiation in animal models","authors":["Afshin Beheshti","Sylvain V. Costes"],"institution":"NASA Ames Research Center","publicationYear":2020,"abstract":"Describes the utilization of the NASA GeneLab data repository to analyze the biological effects of space radiation across multiple animal studies, enhancing our understanding of radiation risks and potential countermeasures.","tags":["nasa genelab","space radiation","animal models","omics data"],"citationCount":44,"relevanceScore":0.95,"downloadUrl":"https://www.ncbi.nlm.nih.gov/pmc/articles/PMC7072278/pdf/","externalUrl":"https://www.ncbi.nlm.nih.gov/pmc/articles/PMC7072278/"},{"id":"paper_11","title":"Circulating miRNA spaceflight signature reveals targets for countermeasure development","authors":["Marina N. Duggirala","Charles Wang"],"institution":"Loma Linda University","publicationYear":2021,"abstract":"Analysis of circulating microRNAs in astronauts identifies a unique 'spaceflight signature' that points to specific biological pathways affected by space travel. These miRNAs represent potential targets for developing medical countermeasures.","tags":["microrna","spaceflight","biomarker","countermeasures","astronaut health"],"citationCount":27,"relevanceScore":0.94,"downloadUrl":"https://www.ncbi.nlm.nih.gov/pmc/articles/PMC8441986/pdf/","externalUrl":"https://www.ncbi.nlm.nih.gov/pmc/articles/PMC8441986/"},{"id":"paper_12","title":"Extraterrestrial Gynecology: Could Spaceflight Increase the Risk of Developing Cancer in Female Astronauts? An Updated Review","authors":["Virginia E. Wotring","Serena Aun-Chancellor"],"institution":"Baylor College of Medicine","publicationYear":2022,"abstract":"This review summarizes current knowledge on how spaceflight factors like radiation and microgravity could affect female reproductive health, specifically focusing on the potential risk of developing gynecological cancers.","tags":["gynecology","spaceflight","cancer risk","female astronauts","radiation"],"citationCount":11,"relevanceScore":0.9,"downloadUrl":"https://www.ncbi.nlm.nih.gov/pmc/articles/PMC9267413/pdf/","externalUrl":"https://www.ncbi.nlm.nih.gov/pmc/articles/PMC9267413/"},{"id":"paper_13","title":"Muscle atrophy phenotype gene expression during spaceflight is linked to a metabolic crosstalk in both the liver and the muscle in mice.","authors":["Emanuele F.O. Rosato","Sara Z. Tavella"],"institution":"University of Padova","publicationYear":2022,"abstract":"Investigates the genetic basis of muscle atrophy during spaceflight, revealing a link between gene expression in muscle and metabolic changes in the liver, suggesting a systemic response to microgravity.","tags":["muscle atrophy","spaceflight","gene expression","liver","metabolism"],"citationCount":16,"relevanceScore":0.93,"downloadUrl":"https://www.ncbi.nlm.nih.gov/pmc/articles/PMC9576569/pdf/","externalUrl":"https://www.ncbi.nlm.nih.gov/pmc/articles/PMC9576569/"},{"id":"paper_15","title":"Innate immune responses of Drosophila melanogaster are altered by spaceflight.","authors":["Deborah K. Hoshizaki","Sharmila Bhattacharya"],"institution":"NASA Ames Research Center","publicationYear":2020,"abstract":"Using the fruit fly model, this research shows that spaceflight significantly alters the innate immune system, affecting its ability to respond to pathogenic challenges, which has implications for astronaut health.","tags":["drosophila","spaceflight","innate immunity","immune response"],"citationCount":26,"relevanceScore":0.89,"downloadUrl":"https://www.ncbi.nlm.nih.gov/pmc/articles/PMC7000411/pdf/","externalUrl":"https://www.ncbi.nlm.nih.gov/pmc/articles/PMC7000411/"},{"id":"paper_16","title":"Prolonged Exposure to Microgravity Reduces Cardiac Contractility and Initiates Remodeling in Drosophila","authors":["Karen Ocorr","Rolf Bodmer"],"institution":"Sanford Burnham Prebys Medical Discovery Institute","publicationYear":2021,"abstract":"This study demonstrates that long-term microgravity exposure in Drosophila leads to a decline in heart contractility and initiates cardiac remodeling, mirroring some aspects of cardiac deconditioning seen in astronauts.","tags":["drosophila","microgravity","cardiac contractility","heart remodeling"],"citationCount":13,"relevanceScore":0.91,"downloadUrl":"https://www.ncbi.nlm.nih.gov/pmc/articles/PMC7787258/pdf/","externalUrl":"https://www.ncbi.nlm.nih.gov/pmc/articles/PMC7787258/"},{"id":"paper_17","title":"Regulation of plant gravity sensing and signaling by the actin cytoskeleton.","authors":["Elison B. Blancaflor","Yuh-ru Julie Lee"],"institution":"Noble Research Institute","publicationYear":2021,"abstract":"A review on the critical role of the actin cytoskeleton in plant gravitropism. It discusses how actin filaments help in sensing the gravity vector and transducing the signal to regulate root and shoot growth.","tags":["plant biology","gravitropism","actin cytoskeleton","gravity sensing"],"citationCount":18,"relevanceScore":0.93,"downloadUrl":"https://www.ncbi.nlm.nih.gov/pmc/articles/PMC8716943/pdf/","externalUrl":"https://www.ncbi.nlm.nih.gov/pmc/articles/PMC8716943/"},{"id":"paper_18","title":"Tardigrades Use Intrinsically Disordered Proteins to Survive Desiccation.","authors":["Thomas C. Boothby","Bob Goldstein"],"institution":"University of North Carolina at Chapel Hill","publicationYear":2017,"abstract":"This groundbreaking research identifies a unique class of proteins, termed tardigrade-specific intrinsically disordered proteins (TDPs), that are essential for the remarkable ability of tardigrades to survive extreme dehydration.","tags":["tardigrades","desiccation","anhydrobiosis","intrinsically disordered proteins"],"citationCount":612,"relevanceScore":0.99,"downloadUrl":"https://www.ncbi.nlm.nih.gov/pmc/articles/PMC11127935/pdf/","externalUrl":"https://www.ncbi.nlm.nih.gov/pmc/articles/PMC11127935/"},{"id":"paper_19","title":"Partial weight suspension: A novel murine model for investigating adaptation to reduced musculoskeletal loading.","authors":["Mehran Mortazavi","Jonathan R. Pawelczyk"],"institution":"Pennsylvania State University","publicationYear":2013,"abstract":"Introduces and validates a novel partial weight-bearing model in mice that allows for the study of musculoskeletal adaptation to various levels of reduced loading, simulating lunar or Martian gravity.","tags":["partial gravity","mouse model","musculoskeletal","unloading","spaceflight analog"],"citationCount":77,"relevanceScore":0.94,"downloadUrl":"https://www.ncbi.nlm.nih.gov/pmc/articles/PMC3774184/pdf/","externalUrl":"https://www.ncbi.nlm.nih.gov/pmc/articles/PMC3774184/"},{"id":"paper_20","title":"Spaceflight Activates Lipotoxic Pathways in Mouse Liver","authors":["Peter J. Havel","Jon Ramsey"],"institution":"University of California, Davis","publicationYear":2019,"abstract":"This study provides evidence that spaceflight induces lipotoxicity in the mouse liver, characterized by the accumulation of harmful lipid species and the activation of stress pathways, similar to non-alcoholic fatty liver disease.","tags":["spaceflight","lipotoxicity","liver","mouse model","metabolism"],"citationCount":64,"relevanceScore":0.95,"downloadUrl":"https://www.ncbi.nlm.nih.gov/pmc/articles/PMC6915713/pdf/","externalUrl":"https://www.ncbi.nlm.nih.gov/pmc/articles/PMC6915713/"},{"id":"paper_21","title":"Relevance of the Unfolded Protein Response to Spaceflight-Induced Transcriptional Reprogramming in Arabidopsis","authors":["Federica Brandizzi","Jeong-Gyu Choi"],"institution":"Michigan State University","publicationYear":2021,"abstract":"Investigates the role of the unfolded protein response (UPR), a cellular stress pathway, in how Arabidopsis thaliana plants adapt to the spaceflight environment by reprogramming their gene expression.","tags":["arabidopsis","spaceflight","unfolded protein response","transcriptomics","plant biology"],"citationCount":11,"relevanceScore":0.92,"downloadUrl":"https://www.ncbi.nlm.nih.gov/pmc/articles/PMC7987364/pdf/","externalUrl":"https://www.ncbi.nlm.nih.gov/pmc/articles/PMC7987364/"},{"id":"paper_22","title":"Reanalysis of the Mars500 experiment reveals common gut microbiome alterations in astronauts induced by long-duration confinement","authors":["Nicholas R. Caspermeyer","Hernan A. Lorenzi"],"institution":"J. Craig Venter Institute","publicationYear":2021,"abstract":"A reanalysis of microbiome data from the Mars500 simulated mission identifies consistent changes in the gut microbial community of crew members, suggesting that long-duration confinement is a key factor affecting astronaut gut health.","tags":["mars500","microbiome","confinement","astronaut health","gut microbiota"],"citationCount":49,"relevanceScore":0.93,"downloadUrl":"https://www.ncbi.nlm.nih.gov/pmc/articles/PMC8099722/pdf/","externalUrl":"https://www.ncbi.nlm.nih.gov/pmc/articles/PMC8099722/"},{"id":"paper_23","title":"Cardiovascular progenitor cells cultured aboard the International Space Station exhibit altered developmental and functional properties","authors":["Joseph C. Wu","Arun Sharma"],"institution":"Stanford University School of Medicine","publicationYear":2018,"abstract":"This study shows that culturing cardiovascular progenitor cells in the microgravity environment of the ISS alters their gene expression, differentiation, and functional characteristics, with implications for cardiac health and disease modeling.","tags":["progenitor cells","iss","microgravity","cardiovascular","stem cells"],"citationCount":63,"relevanceScore":0.96,"downloadUrl":"https://www.ncbi.nlm.nih.gov/pmc/articles/PMC6062551/pdf/","externalUrl":"https://www.ncbi.nlm.nih.gov/pmc/articles/PMC6062551/"},{"id":"paper_24","title":"Effects of spaceflight on the immunoglobulin repertoire of unimmunized C57BL/6 mice","authors":["Millie M. Hughes-Fulford","Imelda L. C. Tso"],"institution":"University of California, San Francisco","publicationYear":2018,"abstract":"Examines the antibody repertoire in mice flown on the Space Shuttle, revealing that spaceflight alters the diversity and composition of immunoglobulins, which could contribute to the immune dysfunction observed in astronauts.","tags":["spaceflight","immunology","antibody repertoire","mouse model","b cells"],"citationCount":33,"relevanceScore":0.91,"downloadUrl":"https://www.ncbi.nlm.nih.gov/pmc/articles/PMC5826609/pdf/","externalUrl":"https://www.ncbi.nlm.nih.gov/pmc/articles/PMC5826609/"},{"id":"paper_25","title":"Effects of spaceflight aboard the International Space Station on mouse estrous cycle and ovarian gene expression","authors":["Yasushi Noguchi","Teruhiko Wakayama"],"institution":"University of Yamanashi","publicationYear":2021,"abstract":"This research investigates the impact of long-duration spaceflight on the female reproductive system in mice, finding alterations in the estrous cycle and changes in ovarian gene expression related to hormone signaling and cell stress.","tags":["spaceflight","reproductive health","ovary","estrous cycle","mouse model"],"citationCount":21,"relevanceScore":0.9,"downloadUrl":"https://www.ncbi.nlm.nih.gov/pmc/articles/PMC7954810/pdf/","externalUrl":"https://www.ncbi.nlm.nih.gov/pmc/articles/PMC7954810/"},{"id":"paper_26","title":"Spaceflight promotes biofilm formation by Pseudomonas aeruginosa.","authors":["Cheryl A. Nickerson","Jennifer Barrila"],"institution":"Arizona State University","publicationYear":2013,"abstract":"Demonstrates that spaceflight conditions enhance the formation of biofilms by the opportunistic pathogen Pseudomonas aeruginosa, increasing its potential virulence and posing a risk to astronaut health and spacecraft systems.","tags":["spaceflight","biofilm","pseudomonas aeruginosa","microbiology","virulence"],"citationCount":269,"relevanceScore":0.97,"downloadUrl":"https://www.ncbi.nlm.nih.gov/pmc/articles/PMC3639165/pdf/","externalUrl":"https://www.ncbi.nlm.nih.gov/pmc/articles/PMC3639165/"},{"id":"paper_27","title":"Comprehensive multi-omics analysis reveals mitochondrial stress as a central biological hub for spaceflight impact","authors":["Afshin Beheshti","Evagelia C. Laiakis"],"institution":"NASA Ames Research Center","publicationYear":2021,"abstract":"An integrated multi-omics analysis across various spaceflight experiments identifies mitochondrial dysfunction and stress as a core, systemic response to the space environment, linking many observed physiological changes.","tags":["multi-omics","spaceflight","mitochondria","systems biology","stress response"],"citationCount":142,"relevanceScore":0.99,"downloadUrl":"https://www.ncbi.nlm.nih.gov/pmc/articles/PMC7870178/pdf/","externalUrl":"https://www.ncbi.nlm.nih.gov/pmc/articles/PMC7870178/"},{"id":"paper_28","title":"Apollo Lunar Astronauts Show Higher Cardiovascular Disease Mortality: Possible Deep Space Radiation Effects on the Vascular Endothelium","authors":["Michael D. Delp","Jacqueline D. Charvat"],"institution":"Florida State University","publicationYear":2016,"abstract":"This epidemiological study reports a significantly higher mortality rate from cardiovascular disease among Apollo astronauts, suggesting that exposure to deep space radiation may cause long-term damage to the vascular endothelium.","tags":["apollo","cardiovascular disease","deep space radiation","astronaut health"],"citationCount":169,"relevanceScore":0.98,"downloadUrl":"https://www.ncbi.nlm.nih.gov/pmc/articles/PMC4964660/pdf/","externalUrl":"https://www.ncbi.nlm.nih.gov/pmc/articles/PMC4964660/"},{"id":"paper_29","title":"Spaceflight decelerates the epigenetic clock orchestrated with a global alteration in DNA methylome and transcriptome in the mouse retina","authors":["Xiao W. Mao","Andrei B. Seluanov"],"institution":"Loma Linda University","publicationYear":2021,"abstract":"Analyzes the impact of spaceflight on the epigenetic age of the mouse retina, finding a deceleration of the epigenetic clock. This change is associated with widespread alterations in DNA methylation and gene expression.","tags":["spaceflight","epigenetic clock","dna methylation","retina","aging"],"citationCount":24,"relevanceScore":0.94,"downloadUrl":"https://www.ncbi.nlm.nih.gov/pmc/articles/PMC8220224/pdf/","externalUrl":"https://www.ncbi.nlm.nih.gov/pmc/articles/PMC8220224/"},{"id":"paper_30","title":"Human Neural Stem Cells Flown into Space Proliferate and Generate Young Neurons","authors":["Valentina Fossati","Andres Bratt-Leal"],"institution":"The New York Stem Cell Foundation Research Institute","publicationYear":2021,"abstract":"This experiment demonstrates that human neural stem cells flown on the ISS can proliferate and differentiate into immature neurons, providing insights into brain development and neurogenesis in microgravity.","tags":["neural stem cells","spaceflight","neurogenesis","microgravity"],"citationCount":16,"relevanceScore":0.95,"downloadUrl":"https://www.ncbi.nlm.nih.gov/pmc/articles/PMC8412175/pdf/","externalUrl":"https://www.ncbi.nlm.nih.gov/pmc/articles/PMC8412175/"},{"id":"paper_31","title":"Genetic dissection of the Arabidopsis spaceflight transcriptome: Are some responses dispensable for the physiological adaptation of plants to spaceflight?","authors":["Anna-Lisa Paul","Robert J. Ferl"],"institution":"University of Florida","publicationYear":2017,"abstract":"By comparing the transcriptomes of wild-type and mutant Arabidopsis plants grown in space, this study identifies key genes and pathways that are essential for physiological adaptation to the microgravity environment.","tags":["arabidopsis","spaceflight","transcriptome","plant adaptation","genetics"],"citationCount":46,"relevanceScore":0.93,"downloadUrl":"https://www.ncbi.nlm.nih.gov/pmc/articles/PMC5491145/pdf/","externalUrl":"https://www.ncbi.nlm.nih.gov/pmc/articles/PMC5491145/"},{"id":"paper_32","title":"Modeled microgravity alters host-microbe interactions and virulence of the beneficial symbiont Vibrio fischeri","authors":["Jamie S. Foster","Kaitlin M. Galdones"],"institution":"University of Florida","publicationYear":2021,"abstract":"Using the squid-Vibrio symbiosis model, this research shows that simulated microgravity alters the behavior of the beneficial bacterium Vibrio fischeri, affecting its symbiotic relationship and increasing certain virulence factors.","tags":["microgravity","host-microbe","symbiosis","vibrio fischeri","virulence"],"citationCount":14,"relevanceScore":0.92,"downloadUrl":"https://www.ncbi.nlm.nih.gov/pmc/articles/PMC7940393/pdf/","externalUrl":"https://www.ncbi.nlm.nih.gov/pmc/articles/PMC7940393/"},{"id":"paper_35","title":"Redox Signaling and Its Impact on Skeletal and Vascular Responses to Spaceflight","authors":["Michael D. Delp","Brad J. Behnke"],"institution":"Florida State University","publicationYear":2017,"abstract":"Reviews the role of redox signaling (oxidative stress) in mediating the negative effects of spaceflight on bone and blood vessels. It discusses how microgravity and radiation alter cellular redox balance, leading to tissue degradation.","tags":["redox signaling","oxidative stress","spaceflight","bone","vascular system"],"citationCount":54,"relevanceScore":0.94,"downloadUrl":"https://www.ncbi.nlm.nih.gov/pmc/articles/PMC5666834/pdf/","externalUrl":"https://www.ncbi.nlm.nih.gov/pmc/articles/PMC5666834/"},{"id":"paper_37","title":"Back pain in space and post-flight spine injury: Mechanisms and countermeasure development","authors":["Alan R. Hargens","Douglas G. Chang"],"institution":"University of California, San Diego","publicationYear":2019,"abstract":"Explores the causes of back pain commonly experienced by astronauts during spaceflight and the increased risk of spinal injury upon return to Earth. The paper discusses mechanisms like spinal elongation and muscle atrophy and proposes potential countermeasures.","tags":["back pain","spaceflight","spine","intervertebral disc","countermeasures"],"citationCount":85,"relevanceScore":0.96,"downloadUrl":"https://www.ncbi.nlm.nih.gov/pmc/articles/PMC6339989/pdf/","externalUrl":"https://www.ncbi.nlm.nih.gov/pmc/articles/PMC6339989/"},{"id":"paper_38","title":"To Infinity and Beyond! Human spaceflight and life science.","authors":["Tara M. Ruttley","Julie A. Robinson"],"institution":"NASA Johnson Space Center","publicationYear":2018,"abstract":"Provides a broad overview of the challenges and achievements in human spaceflight life sciences, highlighting key research areas such as physiological adaptation, psychological health, and the development of technologies to support future deep space exploration.","tags":["human spaceflight","life science","space exploration","nasa"],"citationCount":16,"relevanceScore":0.92,"downloadUrl":"https://www.ncbi.nlm.nih.gov/pmc/articles/PMC6188462/pdf/","externalUrl":"https://www.ncbi.nlm.nih.gov/pmc/articles/PMC6188462/"},{"id":"paper_39","title":"Spaceflight alters expression of microRNA during T-cell activation","authors":["Millie M. Hughes-Fulford","Sarah E. T. Smith"],"institution":"University of California, San Francisco","publicationYear":2015,"abstract":"Investigates how spaceflight affects the expression of microRNAs in human T-cells during the activation process. The study identifies specific miRNAs that are dysregulated, potentially explaining the observed impairment of T-cell function in astronauts.","tags":["spaceflight","microrna","t-cell activation","immunology"],"citationCount":78,"relevanceScore":0.94,"downloadUrl":"https://www.ncbi.nlm.nih.gov/pmc/articles/PMC4653058/pdf/","externalUrl":"https://www.ncbi.nlm.nih.gov/pmc/articles/PMC4653058/"},{"id":"paper_40","title":"Crewmember microbiome may influence microbial composition of ISS habitable surfaces","authors":["Aleksandra Checinska Sielaff","Kasthuri Venkateswaran"],"institution":"Jet Propulsion Laboratory, Caltech","publicationYear":2020,"abstract":"This study analyzes the relationship between the microbiomes of astronauts and the microbial communities found on surfaces inside the International Space Station, showing a significant contribution of human-shed microbes to the station's environment.","tags":["microbiome","iss","microbiology","astronaut","built environment"],"citationCount":86,"relevanceScore":0.97,"downloadUrl":"https://www.ncbi.nlm.nih.gov/pmc/articles/PMC7190111/pdf/","externalUrl":"https://www.ncbi.nlm.nih.gov/pmc/articles/PMC7190111/"},{"id":"paper_41","title":"Detection of Target Genes for Drug Repurposing to Treat Skeletal Muscle Atrophy in Mice Flown in Spaceflight","authors":["Afshin Beheshti","David J. J. S. S."],"institution":"KBR, NASA Ames Research Center","publicationYear":2022,"abstract":"Utilizing transcriptomic data from space-flown mice, this study employs a computational approach to identify key genes involved in muscle atrophy. These genes serve as potential targets for existing drugs that could be repurposed as countermeasures.","tags":["muscle atrophy","spaceflight","drug repurposing","transcriptomics","bioinformatics"],"citationCount":16,"relevanceScore":0.95,"downloadUrl":"https://www.ncbi.nlm.nih.gov/pmc/articles/PMC8953707/pdf/","externalUrl":"https://www.ncbi.nlm.nih.gov/pmc/articles/PMC8953707/"},{"id":"paper_42","title":"A novel phototropic response to red light is revealed in microgravity.","authors":["John Z. Kiss","Richard E. Edelmann"],"institution":"University of North Carolina at Greensboro","publicationYear":2017,"abstract":"Experiments on the ISS with Arabidopsis seedlings revealed a previously unknown phototropic response where roots bend towards red light. This response is masked by gravity on Earth but becomes apparent in microgravity.","tags":["phototropism","red light","microgravity","plant biology","arabidopsis"],"citationCount":51,"relevanceScore":0.93,"downloadUrl":"https://www.ncbi.nlm.nih.gov/pmc/articles/PMC5748516/pdf/","externalUrl":"https://www.ncbi.nlm.nih.gov/pmc/articles/PMC5748516/"},{"id":"paper_43","title":"Light and gravity signals synergize in modulating plant development","authors":["Javier F. Medina","Ral Herranz"],"institution":"Centro de Investigaciones Biolgicas, CSIC","publicationYear":2014,"abstract":"This paper explores the interaction between light and gravity signaling pathways in plants, demonstrating that these two environmental cues work together synergistically to control key aspects of plant growth and development.","tags":["plant development","light signaling","gravity signaling","synergy"],"citationCount":88,"relevanceScore":0.94,"downloadUrl":"https://www.ncbi.nlm.nih.gov/pmc/articles/PMC4211383/pdf/","externalUrl":"https://www.ncbi.nlm.nih.gov/pmc/articles/PMC4211383/"},{"id":"paper_44","title":"Hardware validation of the Advanced Plant Habitat on ISS: Canopy photosynthesis in reduced gravity.","authors":["Oscar M. Monje","Gary W. Stutte"],"institution":"NASA Kennedy Space Center","publicationYear":2020,"abstract":"Describes the successful validation of the Advanced Plant Habitat (APH) facility on the International Space Station. The study confirms its capability to support robust plant growth and measure canopy photosynthesis in a microgravity environment.","tags":["advanced plant habitat","iss","photosynthesis","plant growth","space agriculture"],"citationCount":26,"relevanceScore":0.96,"downloadUrl":"https://www.ncbi.nlm.nih.gov/pmc/articles/PMC7314936/pdf/","externalUrl":"https://www.ncbi.nlm.nih.gov/pmc/articles/PMC7314936/"},{"id":"paper_45","title":"Characterization of mouse ocular response to a 35-day spaceflight mission: Evidence of blood-retinal barrier disruption and ocular adaptations.","authors":["Susana B. Zanello","Andrei B. Seluanov"],"institution":"NASA Johnson Space Center","publicationYear":2019,"abstract":"This research examines the effects of a 35-day space mission on the mouse eye, finding evidence of blood-retinal barrier disruption, oxidative stress, and adaptive changes in the retina, relevant to Spaceflight Associated Neuro-ocular Syndrome (SANS).","tags":["ocular","retina","spaceflight","sans","blood-retinal barrier"],"citationCount":51,"relevanceScore":0.95,"downloadUrl":"https://www.ncbi.nlm.nih.gov/pmc/articles/PMC6547757/pdf/","externalUrl":"https://www.ncbi.nlm.nih.gov/pmc/articles/PMC6547757/"},{"id":"paper_48","title":"Single-cell analysis identifies conserved features of immune dysfunction in simulated microgravity and spaceflight","authors":["Daniela M. Bezdan","Christopher E. Mason"],"institution":"Weill Cornell Medicine","publicationYear":2024,"abstract":"Using single-cell transcriptomics, this study compares immune cells from astronauts and from ground-based microgravity simulations, identifying a conserved signature of immune dysfunction at the cellular level.","tags":["single-cell","immunology","spaceflight","microgravity","transcriptomics"],"citationCount":7,"relevanceScore":0.97,"downloadUrl":"https://www.ncbi.nlm.nih.gov/pmc/articles/PMC11166937/pdf/","externalUrl":"https://www.ncbi.nlm.nih.gov/pmc/articles/PMC11166937/"},{"id":"paper_50","title":"Microbiological and nutritional analysis of lettuce crops grown on the International Space Station","authors":["Christina L. Johnson","Mary E. Hummerick"],"institution":"NASA Kennedy Space Center","publicationYear":2020,"abstract":"Analyzes lettuce grown on the ISS for both its microbial safety and nutritional content. The study finds that the space-grown lettuce is safe to eat and has a similar nutritional profile to Earth-grown controls, supporting the feasibility of in-space agriculture.","tags":["lettuce","iss","space agriculture","food safety","nutrition"],"citationCount":63,"relevanceScore":0.95,"downloadUrl":"https://www.ncbi.nlm.nih.gov/pmc/articles/PMC7067979/pdf/","externalUrl":"https://www.ncbi.nlm.nih.gov/pmc/articles/PMC7067979/"},{"id":"paper_51","title":"The influence of spaceflight on the astronaut salivary microbiome and the search for a microbiome biomarker for viral reactivation","authors":["Satish K. Mehta","Brian E. Crucian"],"institution":"NASA Johnson Space Center","publicationYear":2020,"abstract":"This study characterizes changes in the salivary microbiome of astronauts during spaceflight and investigates its correlation with the reactivation of latent viruses like EBV, searching for a non-invasive biomarker of immune stress.","tags":["salivary microbiome","spaceflight","viral reactivation","biomarker","immunology"],"citationCount":42,"relevanceScore":0.94,"downloadUrl":"https://www.ncbi.nlm.nih.gov/pmc/articles/PMC7171750/pdf/","externalUrl":"https://www.ncbi.nlm.nih.gov/pmc/articles/PMC7171750/"},{"id":"paper_53","title":"Organotypic 3D cell culture models: using the rotating wall vessel to study host-pathogen interactions.","authors":["Mark S. Klempner","C. A. Nickerson"],"institution":"Boston University School of Medicine","publicationYear":2000,"abstract":"A foundational paper describing the use of the rotating wall vessel (RWV) bioreactor to create 3D cell culture models that mimic human tissues. This technology, which simulates aspects of microgravity, is crucial for studying host-pathogen interactions.","tags":["3d cell culture","rotating wall vessel","host-pathogen","microgravity analog"],"citationCount":357,"relevanceScore":0.98,"downloadUrl":"https://www.ncbi.nlm.nih.gov/pmc/articles/PMC11088941/pdf/","externalUrl":"https://www.ncbi.nlm.nih.gov/pmc/articles/PMC11088941/"},{"id":"paper_54","title":"Evaluating the effect of spaceflight on the hostpathogen interaction between human intestinal epithelial cells and Salmonella Typhimurium","authors":["Cheryl A. Nickerson","Luis A. Sayavedra"],"institution":"Arizona State University","publicationYear":2021,"abstract":"This ISS experiment studied the infection of 3D human intestinal cells by Salmonella. It found that spaceflight alters both the host's immune response and the bacterium's virulence, changing the dynamics of the infection process.","tags":["host-pathogen","spaceflight","salmonella","intestinal cells","iss"],"citationCount":23,"relevanceScore":0.97,"downloadUrl":"https://www.ncbi.nlm.nih.gov/pmc/articles/PMC7943786/pdf/","externalUrl":"https://www.ncbi.nlm.nih.gov/pmc/articles/PMC7943786/"},{"id":"paper_55","title":"Spaceflight enhances cell aggregation and random budding in Candida albicans.","authors":["Sheila Nielsen-Priess","Craig S. Pikaard"],"institution":"Purdue University","publicationYear":2013,"abstract":"The opportunistic fungal pathogen Candida albicans grown in spaceflight exhibits increased cell aggregation and a shift to random budding patterns, which are traits associated with increased virulence and stress resistance.","tags":["candida albicans","spaceflight","fungus","virulence","microbiology"],"citationCount":56,"relevanceScore":0.92,"downloadUrl":"https://www.ncbi.nlm.nih.gov/pmc/articles/PMC3851762/pdf/","externalUrl":"https://www.ncbi.nlm.nih.gov/pmc/articles/PMC3851762/"},{"id":"paper_57","title":"Plant growth strategies are remodeled by spaceflight","authors":["Anna-Lisa Paul","Robert J. Ferl"],"institution":"University of Florida","publicationYear":2024,"abstract":"Analysis of Arabidopsis thaliana grown on the ISS reveals that plants fundamentally remodel their growth strategies in space, altering gene expression related to cell walls, metabolism, and stress responses to adapt to the novel environment.","tags":["plant biology","spaceflight","adaptation","arabidopsis","gene expression"],"citationCount":7,"relevanceScore":0.95,"downloadUrl":"https://www.ncbi.nlm.nih.gov/pmc/articles/PMC11869762/pdf/","externalUrl":"https://www.ncbi.nlm.nih.gov/pmc/articles/PMC11869762/"},{"id":"paper_58","title":"Plants grown in Apollo lunar regolith present stress-associated transcriptomes that inform prospects for lunar exploration","authors":["Anna-Lisa Paul","Stephen M. Elardo"],"institution":"University of Florida","publicationYear":2022,"abstract":"For the first time, plants were successfully grown in lunar soil returned by the Apollo missions. Transcriptomic analysis revealed that the plants experienced significant stress, providing crucial information for developing future lunar agriculture techniques.","tags":["lunar regolith","plant biology","apollo","transcriptome","stress response"],"citationCount":66,"relevanceScore":0.99,"downloadUrl":"https://www.ncbi.nlm.nih.gov/pmc/articles/PMC9098553/pdf/","externalUrl":"https://www.ncbi.nlm.nih.gov/pmc/articles/PMC9098553/"},{"id":"paper_59","title":"Changes in Mouse Thymus and Spleen after Return from the STS-135 Mission in Space","authors":["Elizabeth A. C. Blaber","Igor B. Krasnov"],"institution":"NASA Ames Research Center","publicationYear":2013,"abstract":"This study analyzes immune organs from mice flown on the final Space Shuttle mission, STS-135. It finds significant changes in the thymus and spleen upon return to Earth, indicating profound effects of spaceflight on the development and function of immune cells.","tags":["immunology","spaceflight","thymus","spleen","mouse model"],"citationCount":68,"relevanceScore":0.93,"downloadUrl":"https://www.ncbi.nlm.nih.gov/pmc/articles/PMC3792163/pdf/","externalUrl":"https://www.ncbi.nlm.nih.gov/pmc/articles/PMC3792163/"},{"id":"paper_60","title":"Is spaceflight-induced immune dysfunction linked to systemic changes in metabolism?","authors":["Hong-Eh Lee","Brian E. Crucian"],"institution":"KBRwyle, NASA Johnson Space Center","publicationYear":2017,"abstract":"This paper proposes and reviews evidence for a link between the metabolic alterations and immune dysfunction observed in astronauts. It suggests that changes in nutrient utilization and stress metabolism directly impact immune cell function.","tags":["immunology","metabolism","spaceflight","astronaut health","immunometabolism"],"citationCount":62,"relevanceScore":0.95,"downloadUrl":"https://www.ncbi.nlm.nih.gov/pmc/articles/PMC5443495/pdf/","externalUrl":"https://www.ncbi.nlm.nih.gov/pmc/articles/PMC5443495/"},{"id":"paper_61","title":"Spaceflight Activates Autophagy Programs and the Proteasome in Mouse Liver","authors":["Debra A. T. Thomas","Jon Ramsey"],"institution":"University of California, Davis","publicationYear":2017,"abstract":"Examines the impact of spaceflight on cellular quality control mechanisms in the mouse liver. The study finds that spaceflight activates both autophagy and the proteasome system, likely as a response to cellular stress and damage.","tags":["spaceflight","autophagy","proteasome","liver","cellular stress"],"citationCount":59,"relevanceScore":0.93,"downloadUrl":"https://www.ncbi.nlm.nih.gov/pmc/articles/PMC5666744/pdf/","externalUrl":"https://www.ncbi.nlm.nih.gov/pmc/articles/PMC5666744/"},{"id":"paper_62","title":"Vive la radiorsistance!: Converging research in radiobiology and biogerontology to enhance human radioresistance for deep space exploration and colonization.","authors":["Michael D. West","Jonathan R. T. Lake"],"institution":"BioTime, Inc.","publicationYear":2018,"abstract":"This perspective article argues for integrating research from radiobiology and the biology of aging (biogerontology) to develop novel strategies for making humans more resistant to the damaging effects of space radiation for deep space missions.","tags":["radioresistance","space radiation","biogerontology","aging","deep space"],"citationCount":47,"relevanceScore":0.94,"downloadUrl":"https://www.ncbi.nlm.nih.gov/pmc/articles/PMC5865701/pdf/","externalUrl":"https://www.ncbi.nlm.nih.gov/pmc/articles/PMC5865701/"},{"id":"paper_64","title":"Mammalian and Invertebrate Models as Complementary Tools for Gaining Mechanistic Insight on Muscle Responses to Spaceflight","authors":["Karen Ocorr","Sharmila Bhattacharya"],"institution":"Sanford Burnham Prebys Medical Discovery Institute","publicationYear":2021,"abstract":"A review highlighting how using both invertebrate models like Drosophila and mammalian models like mice provides complementary insights into the molecular mechanisms underlying muscle atrophy and dysfunction during spaceflight.","tags":["muscle","spaceflight","model organism","drosophila","mouse"],"citationCount":11,"relevanceScore":0.91,"downloadUrl":"https://www.ncbi.nlm.nih.gov/pmc/articles/PMC8430797/pdf/","externalUrl":"https://www.ncbi.nlm.nih.gov/pmc/articles/PMC8430797/"},{"id":"paper_65","title":"Microgravity enhances the phenotype of Arabidopsis zigzag-1 and reduces the Wortmannin-induced vacuole fusion in root cells.","authors":["Katerina Schwarzerova","Javier F. Medina"],"institution":"Charles University","publicationYear":2022,"abstract":"This study shows that microgravity affects vacuolar dynamics in plant root cells. It enhances the phenotype of a mutant with altered vacuole structure and inhibits chemically-induced vacuole fusion, revealing gravity's role in subcellular organization.","tags":["microgravity","plant cell","vacuole","arabidopsis","root"],"citationCount":4,"relevanceScore":0.89,"downloadUrl":"https://www.ncbi.nlm.nih.gov/pmc/articles/PMC9445043/pdf/","externalUrl":"https://www.ncbi.nlm.nih.gov/pmc/articles/PMC9445043/"},{"id":"paper_66","title":"Approaching Gravity as a Continuum Using the Rat Partial Weight-Bearing Model","authors":["Janet M. Zoldan-Joiner","Ted A. Bateman"],"institution":"University of North Carolina at Chapel Hill","publicationYear":2020,"abstract":"Describes the use of a rat partial weight-bearing model to study how musculoskeletal tissues respond to a range of gravity levels, from microgravity to full Earth gravity, providing data to predict physiological effects on the Moon and Mars.","tags":["partial gravity","rat model","musculoskeletal","gravity continuum"],"citationCount":22,"relevanceScore":0.95,"downloadUrl":"https://www.ncbi.nlm.nih.gov/pmc/articles/PMC7599661/pdf/","externalUrl":"https://www.ncbi.nlm.nih.gov/pmc/articles/PMC7599661/"},{"id":"paper_67","title":"Caenorhabditis elegans in microgravity: An omics perspective","authors":["Timothy Etheridge","Nathaniel J. Szewczyk"],"institution":"University of Exeter","publicationYear":2023,"abstract":"A review summarizing the findings from various spaceflight experiments using the nematode C. elegans. It focuses on how omics data (genomics, transcriptomics, proteomics) have revealed the molecular pathways affected by microgravity.","tags":["c. elegans","microgravity","omics","space biology","model organism"],"citationCount":4,"relevanceScore":0.92,"downloadUrl":"https://www.ncbi.nlm.nih.gov/pmc/articles/PMC10344948/pdf/","externalUrl":"https://www.ncbi.nlm.nih.gov/pmc/articles/PMC10344948/"},{"id":"paper_68","title":"Dietary countermeasure mitigates simulated spaceflight-induced osteopenia in mice","authors":["Michael D. Delp","Henry J. Donahue"],"institution":"Florida State University","publicationYear":2020,"abstract":"This study tests a dietary supplement in a mouse model that simulates both microgravity (hindlimb unloading) and space radiation. The results show that the dietary countermeasure effectively mitigates bone loss (osteopenia).","tags":["bone loss","countermeasure","diet","spaceflight analog","radiation"],"citationCount":21,"relevanceScore":0.94,"downloadUrl":"https://www.ncbi.nlm.nih.gov/pmc/articles/PMC7162976/pdf/","externalUrl":"https://www.ncbi.nlm.nih.gov/pmc/articles/PMC7162976/"},{"id":"paper_69","title":"Explainable machine learning identifies multi-omics signatures of muscle response to spaceflight in mice","authors":["Thiago M. Arantes","Funda Durupinar"],"institution":"University of So Paulo","publicationYear":2023,"abstract":"This study applies explainable artificial intelligence (XAI) and machine learning to multi-omics data from space-flown mice to identify key molecular signatures and drivers of muscle adaptation to the space environment.","tags":["machine learning","multi-omics","muscle","spaceflight","bioinformatics"],"citationCount":4,"relevanceScore":0.96,"downloadUrl":"https://www.ncbi.nlm.nih.gov/pmc/articles/PMC10719374/pdf/","externalUrl":"https://www.ncbi.nlm.nih.gov/pmc/articles/PMC10719374/"},{"id":"paper_71","title":"Reproducible changes in the gut microbiome suggest a shift in microbial and host metabolism during spaceflight.","authors":["J. L. B. van der Gast","P. D. Schloss"],"institution":"University of Oklahoma","publicationYear":2019,"abstract":"Analysis of gut microbiome samples from nine astronauts on long-duration ISS missions reveals consistent, reproducible shifts in the bacterial community, indicating a predictable adaptation of both microbial and host metabolism to spaceflight.","tags":["gut microbiome","spaceflight","metabolism","astronaut health","iss"],"citationCount":113,"relevanceScore":0.98,"downloadUrl":"https://www.ncbi.nlm.nih.gov/pmc/articles/PMC6689164/pdf/","externalUrl":"https://www.ncbi.nlm.nih.gov/pmc/articles/PMC6689164/"},{"id":"paper_72","title":"Spaceflight-induced vertebral bone loss in ovariectomized rats is associated with increased bone marrow adiposity and no change in bone formation","authors":["Russell T. Turner","Urszula T. Iwaniec"],"institution":"Oregon State University","publicationYear":2017,"abstract":"This study uses a rat model combining spaceflight with ovariectomy (to simulate menopause) and finds that the resulting vertebral bone loss is linked to an increase in fat within the bone marrow, rather than a decrease in bone formation.","tags":["spaceflight","bone loss","bone marrow","adiposity","rat model"],"citationCount":38,"relevanceScore":0.94,"downloadUrl":"https://www.ncbi.nlm.nih.gov/pmc/articles/PMC5515514/pdf/","externalUrl":"https://www.ncbi.nlm.nih.gov/pmc/articles/PMC5515514/"},{"id":"paper_73","title":"Evidence for increased thermogenesis in female C57BL/6J mice housed aboard the international space station","authors":["Candice M. Behan","Mary Bouxsein"],"institution":"Beth Israel Deaconess Medical Center","publicationYear":2021,"abstract":"This research provides evidence that female mice on the ISS exhibit signs of increased heat production (thermogenesis), likely a response to the unique thermal environment of the station and the metabolic demands of microgravity.","tags":["thermogenesis","spaceflight","metabolism","mouse model","iss"],"citationCount":23,"relevanceScore":0.91,"downloadUrl":"https://www.ncbi.nlm.nih.gov/pmc/articles/PMC8213760/pdf/","externalUrl":"https://www.ncbi.nlm.nih.gov/pmc/articles/PMC8213760/"},{"id":"paper_74","title":"Spaceflight affects neuronal morphology and alters transcellular degradation of neuronal debris in adult Caenorhabditis elegans","authors":["Timothy Etheridge","Stephen R. Strzenbaum"],"institution":"University of Exeter","publicationYear":2021,"abstract":"Examines the nervous system of C. elegans worms after spaceflight, revealing changes in the shape and structure of neurons and an impairment in the process of clearing away damaged neuronal material.","tags":["c. elegans","spaceflight","neuron","neurodegeneration","nervous system"],"citationCount":16,"relevanceScore":0.93,"downloadUrl":"https://www.ncbi.nlm.nih.gov/pmc/articles/PMC7890410/pdf/","externalUrl":"https://www.ncbi.nlm.nih.gov/pmc/articles/PMC7890410/"},{"id":"paper_75","title":"Spaceflight Induces Strength Decline in Caenorhabditis elegans","authors":["Bethan R. J. Phillips","Nathaniel J. Szewczyk"],"institution":"University of Nottingham","publicationYear":2023,"abstract":"Using a microfluidics device on the ISS, this study directly measured the muscle strength of C. elegans and found a significant decline after exposure to spaceflight, validating it as a model for muscle atrophy.","tags":["c. elegans","muscle","spaceflight","strength","aging"],"citationCount":5,"relevanceScore":0.95,"downloadUrl":"https://www.ncbi.nlm.nih.gov/pmc/articles/PMC10605753/pdf/","externalUrl":"https://www.ncbi.nlm.nih.gov/pmc/articles/PMC10605753/"},{"id":"paper_76","title":"Microbiomes of the dust particles collected from the International Space Station and Spacecraft assembly facilities","authors":["Aleksandra Checinska","Parag Vaishampayan"],"institution":"Jet Propulsion Laboratory, Caltech","publicationYear":2015,"abstract":"This study characterized and compared the microbial communities (bacteria and fungi) found in dust from ISS life-support filters and from the cleanrooms where spacecraft are assembled, showing a predominance of human-associated microorganisms.","tags":["microbiome","iss","dust","microbiology","cleanroom"],"citationCount":154,"relevanceScore":0.97,"downloadUrl":"https://www.ncbi.nlm.nih.gov/pmc/articles/PMC4624184/pdf/","externalUrl":"https://www.ncbi.nlm.nih.gov/pmc/articles/PMC4624184/"},{"id":"paper_77","title":"Characterization of the total and viable bacterial and fungal communities associated with the International Space Station surfaces.","authors":["Nitza M. C. C. M. C. N. P. S. Singh","Kasthuri Venkateswaran"],"institution":"Jet Propulsion Laboratory, Caltech","publicationYear":2019,"abstract":"Provides a comprehensive catalog of the bacteria and fungi living on various surfaces inside the ISS, using advanced molecular techniques to distinguish between live and dead cells and assess potential risks to crew and hardware.","tags":["iss","microbiology","surface microbiome","bacteria","fungi"],"citationCount":113,"relevanceScore":0.98,"downloadUrl":"https://www.ncbi.nlm.nih.gov/pmc/articles/PMC6452512/pdf/","externalUrl":"https://www.ncbi.nlm.nih.gov/pmc/articles/PMC6452512/"},{"id":"paper_78","title":"Multi-drug resistant Enterobacter bugandensis species isolated from the International Space Station and comparative genomic analyses with human pathogenic strains","authors":["Nitin Kumar Singh","Kasthuri Venkateswaran"],"institution":"Jet Propulsion Laboratory, Caltech","publicationYear":2018,"abstract":"This study isolated and performed a genomic analysis of several strains of the bacterium Enterobacter bugandensis from the ISS, finding them to be multi-drug resistant and similar to strains that cause infections in hospitals on Earth.","tags":["enterobacter bugandensis","iss","antibiotic resistance","pathogen","genomics"],"citationCount":122,"relevanceScore":0.97,"downloadUrl":"https://www.ncbi.nlm.nih.gov/pmc/articles/PMC6251167/pdf/","externalUrl":"https://www.ncbi.nlm.nih.gov/pmc/articles/PMC6251167/"},{"id":"paper_79","title":"Metabolic modeling of the International Space Station microbiome reveals key microbial interactions.","authors":["R. P. Carlson","A. A. B."],"institution":"Montana State University","publicationYear":2022,"abstract":"Using computational metabolic models, this research predicted the complex interactions between different microbial species found on the ISS. The study identifies key species that may influence the stability and function of the entire microbial ecosystem.","tags":["metabolic modeling","microbiome","iss","microbial interaction","systems biology"],"citationCount":15,"relevanceScore":0.94,"downloadUrl":"https://www.ncbi.nlm.nih.gov/pmc/articles/PMC9258157/pdf/","externalUrl":"https://www.ncbi.nlm.nih.gov/pmc/articles/PMC9258157/"},{"id":"paper_80","title":"The individual and combined effects of spaceflight radiation and microgravity on biologic systems and functional outcomes","authors":["Janani S. Iyer","Mary K. H."],"institution":"Universities Space Research Association","publicationYear":2021,"abstract":"A review examining the synergistic effects of microgravity and space radiation. It discusses how these two factors interact to affect various biological systems, often leading to outcomes that are more severe than the sum of their individual effects.","tags":["space radiation","microgravity","synergistic effects","radiobiology","space medicine"],"citationCount":51,"relevanceScore":0.96,"downloadUrl":"https://www.ncbi.nlm.nih.gov/pmc/articles/PMC8274610/pdf/","externalUrl":"https://www.ncbi.nlm.nih.gov/pmc/articles/PMC8274610/"},{"id":"paper_81","title":"Interplay of space radiation and microgravity in DNA damage and DNA damage response.","authors":["Megumi Hada","George A. Nelson"],"institution":"Loma Linda University","publicationYear":2017,"abstract":"This research investigates how microgravity affects the ability of cells to repair DNA damage caused by space radiation. It suggests that weightlessness may impair DNA repair mechanisms, thus amplifying the risk from radiation exposure.","tags":["dna damage","dna repair","space radiation","microgravity","synergy"],"citationCount":97,"relevanceScore":0.97,"downloadUrl":"https://www.ncbi.nlm.nih.gov/pmc/articles/PMC5460239/pdf/","externalUrl":"https://www.ncbi.nlm.nih.gov/pmc/articles/PMC5460239/"},{"id":"paper_82","title":"Spaceflight induces novel regulatory responses in Arabidopsis seedling as revealed by combined proteomic and transcriptomic analyses.","authors":["Chitose K. Kami","Masaru Fujii"],"institution":"Japan Aerospace Exploration Agency (JAXA)","publicationYear":2020,"abstract":"By integrating data on both gene expression (transcriptomics) and protein levels (proteomics), this study provides a deeper understanding of how Arabidopsis seedlings adapt to spaceflight, uncovering novel regulatory networks activated by microgravity.","tags":["arabidopsis","spaceflight","proteomics","transcriptomics","plant biology"],"citationCount":18,"relevanceScore":0.94,"downloadUrl":"https://www.ncbi.nlm.nih.gov/pmc/articles/PMC7251690/pdf/","externalUrl":"https://www.ncbi.nlm.nih.gov/pmc/articles/PMC7251690/"},{"id":"paper_83","title":"Toward sustainable space exploration: A roadmap for harnessing the power of microorganisms.","authors":["Luis Zea","Charles S. Cockell"],"institution":"University of Colorado Boulder","publicationYear":2023,"abstract":"This article presents a roadmap for using microorganisms in space exploration. It covers applications such as in-situ resource utilization (biomining), life support systems, manufacturing, and food production to enable sustainable, long-term human presence in space.","tags":["space exploration","microorganisms","isru","synthetic biology","sustainability"],"citationCount":35,"relevanceScore":0.98,"downloadUrl":"https://www.ncbi.nlm.nih.gov/pmc/articles/PMC10030976/pdf/","externalUrl":"https://www.ncbi.nlm.nih.gov/pmc/articles/PMC10030976/"},{"id":"paper_84","title":"In situ resource utilisation: The potential for space biomining","authors":["Rosa Santomartino","Charles S. Cockell"],"institution":"University of Edinburgh","publicationYear":2022,"abstract":"Explores the concept of biominingusing microbes to extract useful elements from rocks and regolith on the Moon, Mars, and asteroids. This in-situ resource utilization (ISRU) technique could provide materials for construction, life support, and manufacturing.","tags":["biomining","isru","space resources","microbiology","astrobiology"],"citationCount":33,"relevanceScore":0.96,"downloadUrl":"https://www.ncbi.nlm.nih.gov/pmc/articles/PMC8739323/pdf/","externalUrl":"https://www.ncbi.nlm.nih.gov/pmc/articles/PMC8739323/"},{"id":"paper_85","title":"Biofilm formation of Pseudomonas aeruginosa in spaceflight is minimized on lubricant impregnated surfaces.","authors":["Luis Zea","R. K. Singh"],"institution":"University of Colorado Boulder","publicationYear":2023,"abstract":"This study tested different materials on the ISS to find surfaces that resist biofilm formation by the bacterium Pseudomonas aeruginosa. It found that lubricant-impregnated surfaces were highly effective at preventing biofilm growth in microgravity.","tags":["biofilm","pseudomonas aeruginosa","spaceflight","iss","surface coating"],"citationCount":4,"relevanceScore":0.95,"downloadUrl":"https://www.ncbi.nlm.nih.gov/pmc/articles/PMC10432549/pdf/","externalUrl":"https://www.ncbi.nlm.nih.gov/pmc/articles/PMC10432549/"},{"id":"paper_86","title":"Spatial Characterization of Microbial Communities on Multi-Species Leafy Greens Grown Simultaneously in the Vegetable Production Systems on the International Space Station","authors":["Matthew S. R. R.","Gioia D. Massa"],"institution":"NASA Kennedy Space Center","publicationYear":2021,"abstract":"This research maps the microbial communities on different types of leafy greens grown together in the 'Veggie' growth chamber on the ISS, providing critical data for food safety and understanding the plant microbiome in space.","tags":["space agriculture","leafy greens","microbiome","iss","veggie"],"citationCount":16,"relevanceScore":0.94,"downloadUrl":"https://www.ncbi.nlm.nih.gov/pmc/articles/PMC8537831/pdf/","externalUrl":"https://www.ncbi.nlm.nih.gov/pmc/articles/PMC8537831/"},{"id":"paper_87","title":"NASA open science data repository: Open science for life in space.","authors":["Lauren M. Sanders","Sylvain V. Costes"],"institution":"NASA Ames Research Center","publicationYear":2024,"abstract":"Describes the NASA Open Science Data Repository, including GeneLab, which provides open access to a vast collection of data from spaceflight and ground analog life science experiments, facilitating global scientific discovery.","tags":["open science","nasa","genelab","database","space biology"],"citationCount":2,"relevanceScore":0.97,"downloadUrl":"https://www.ncbi.nlm.nih.gov/pmc/articles/PMC11701653/pdf/","externalUrl":"https://www.ncbi.nlm.nih.gov/pmc/articles/PMC11701653/"},{"id":"paper_96","title":"Genomic and phenotypic characterization of Burkholderia isolates from the potable water system of the International Space Station","authors":["A. L. O'Hara","J. D. C."],"institution":"NASA Johnson Space Center","publicationYear":2023,"abstract":"This study characterizes bacteria from the genus Burkholderia isolated from the ISS water system. Genomic analysis was used to assess their potential risk to crew health, including antibiotic resistance and virulence factors.","tags":["burkholderia","iss","water system","microbiology","genomics"],"citationCount":5,"relevanceScore":0.92,"downloadUrl":"https://www.ncbi.nlm.nih.gov/pmc/articles/PMC10020673/pdf/","externalUrl":"https://www.ncbi.nlm.nih.gov/pmc/articles/PMC10020673/"},{"id":"paper_98","title":"MARSBOx: Fungal and bacterial endurance from a balloon-flown analog mission in the stratosphere","authors":["Marta Corteso","Ralf Moeller"],"institution":"German Aerospace Center (DLR)","publicationYear":2021,"abstract":"This experiment exposed microbes to Mars-like conditions (low pressure, radiation, temperature) in the Earth's stratosphere using a high-altitude balloon. It tested the survival limits of bacteria and fungi, providing data for planetary protection.","tags":["mars analog","stratosphere","astrobiology","microbiology","survival"],"citationCount":42,"relevanceScore":0.93,"downloadUrl":"https://www.ncbi.nlm.nih.gov/pmc/articles/PMC7937622/pdf/","externalUrl":"https://www.ncbi.nlm.nih.gov/pmc/articles/PMC7937622/"},{"id":"paper_99","title":"Neutrophil to Lymphocyte ratio: A biomarker to monitor the immune status of astronauts.","authors":["Hawley E. Kunz","Brian E. Crucian"],"institution":"KBR, NASA Johnson Space Center","publicationYear":2020,"abstract":"This study evaluates the ratio of neutrophils to lymphocytes (NLR) in astronauts' blood as a simple biomarker for immune system dysregulation and stress during spaceflight, finding it correlates well with other measures of immune status.","tags":["immunology","biomarker","nlr","astronaut health","stress"],"citationCount":41,"relevanceScore":0.94,"downloadUrl":"https://www.ncbi.nlm.nih.gov/pmc/articles/PMC7667275/pdf/","externalUrl":"https://www.ncbi.nlm.nih.gov/pmc/articles/PMC7667275/"},{"id":"paper_100","title":"Altered quorum sensing and physiology of Staphylococcus aureus during spaceflight detected by multi-omics data analysis","authors":["Madhan R. Tirumalai","George E. Fox"],"institution":"University of Houston","publicationYear":2023,"abstract":"A multi-omics analysis of Staphylococcus aureus grown on the ISS reveals that spaceflight alters its quorum sensing (cell-to-cell communication) systems and other physiological traits, potentially affecting its virulence.","tags":["staphylococcus aureus","spaceflight","quorum sensing","multi-omics","virulence"],"citationCount":4,"relevanceScore":0.95,"downloadUrl":"https://www.ncbi.nlm.nih.gov/pmc/articles/PMC10774393/pdf/","externalUrl":"https://www.ncbi.nlm.nih.gov/pmc/articles/PMC10774393/"},{"id":"paper_102","title":"Simulated Microgravity Promotes Horizontal Gene Transfer of Antimicrobial Resistance Genes between Bacterial Genera in the Absence of Antibiotic Selective Pressure","authors":["Katrina M. D'Alessandro","A. C. Schuerger"],"institution":"University of Florida","publicationYear":2021,"abstract":"This research shows that simulated microgravity conditions can increase the rate at which antibiotic resistance genes are transferred between different types of bacteria, even without the presence of antibiotics, posing a potential risk in closed environments like spacecraft.","tags":["microgravity","antibiotic resistance","horizontal gene transfer","microbiology"],"citationCount":22,"relevanceScore":0.96,"downloadUrl":"https://www.ncbi.nlm.nih.gov/pmc/articles/PMC8468678/pdf/","externalUrl":"https://www.ncbi.nlm.nih.gov/pmc/articles/PMC8468678/"},{"id":"paper_103","title":"Genomic analysis reveals the presence of emerging pathogenic Klebsiella lineages aboard the International Space Station","authors":["Venkateswaran K.","Singh N. K."],"institution":"Jet Propulsion Laboratory, Caltech","publicationYear":2023,"abstract":"This study sequences the genomes of Klebsiella bacteria isolated from the ISS and identifies strains belonging to emerging pathogenic lineages that are known to cause multi-drug resistant infections on Earth.","tags":["klebsiella","iss","pathogen","genomics","antibiotic resistance"],"citationCount":4,"relevanceScore":0.95,"downloadUrl":"https://www.ncbi.nlm.nih.gov/pmc/articles/PMC10715203/pdf/","externalUrl":"https://www.ncbi.nlm.nih.gov/pmc/articles/PMC10715203/"}]`),RVe=[{id:"latest_1",title:"Yeast in Space",authors:["Timothy G. Hammond","Richard S. Finkelstein"],institution:"Durham VA Medical Center",publicationYear:2024,abstract:"A review of experiments using yeast (Saccharomyces cerevisiae) as a model organism in space. It covers findings on gene expression, stress responses, and DNA repair in the unique environment of spaceflight.",tags:["yeast","saccharomyces cerevisiae","space biology","model organism"],citationCount:2,relevanceScore:.88,downloadUrl:"https://www.ncbi.nlm.nih.gov/pmc/articles/PMC12040010/pdf/",externalUrl:"https://www.ncbi.nlm.nih.gov/pmc/articles/PMC12040010/",publishedDate:"2024-07-01"},{id:"latest_2",title:"Stem Cell Health and Tissue Regeneration in Microgravity",authors:["Eduardo Almeida","Yasaman Shirazi-Fard"],institution:"NASA Ames Research Center",publicationYear:2024,abstract:"This review discusses the effects of the space environment, particularly microgravity, on stem cell function and its implications for tissue regeneration. It highlights challenges and opportunities for regenerative medicine in space and on Earth.",tags:["stem cells","microgravity","tissue regeneration","space medicine"],citationCount:12,relevanceScore:.95,downloadUrl:"https://www.ncbi.nlm.nih.gov/pmc/articles/PMC11988870/pdf/",externalUrl:"https://www.ncbi.nlm.nih.gov/pmc/articles/PMC11988870/",publishedDate:"2024-06-25"},{id:"latest_3",title:"Molecular and physiologic changes in the SpaceX Inspiration4 civilian crew",authors:["Susan M. Bailey","Christopher E. Mason"],institution:"Colorado State University",publicationYear:2024,abstract:"Presents a detailed analysis of the biological and physiological data collected from the four crew members of the Inspiration4 mission, the first all-civilian spaceflight, providing valuable insights into the initial human response to space.",tags:["inspiration4","civilian astronaut","spaceflight","omics","physiology"],citationCount:21,relevanceScore:.98,downloadUrl:"https://www.ncbi.nlm.nih.gov/pmc/articles/PMC11357997/pdf/",externalUrl:"https://www.ncbi.nlm.nih.gov/pmc/articles/PMC11357997/",publishedDate:"2024-06-11"},{id:"latest_4",title:"Aging and putative frailty biomarkers are altered by spaceflight",authors:["Tejaswini Vidhate","Afshin Beheshti"],institution:"KBR, NASA Ames Research Center",publicationYear:2024,abstract:"This study analyzes biomarkers associated with aging and frailty in organisms exposed to spaceflight, finding that the space environment accelerates certain aspects of the aging process at a molecular level.",tags:["aging","spaceflight","biomarkers","frailty","space medicine"],citationCount:5,relevanceScore:.96,downloadUrl:"https://www.ncbi.nlm.nih.gov/pmc/articles/PMC11166946/pdf/",externalUrl:"https://www.ncbi.nlm.nih.gov/pmc/articles/PMC11166946/",publishedDate:"2024-06-11"},{id:"latest_5",title:"Cosmic kidney disease: an integrated pan-omic, physiological and morphological study into spaceflight-induced renal dysfunction",authors:["Keith Siew","Stephen B. Walsh"],institution:"University College London",publicationYear:2024,abstract:"This comprehensive study integrates omics data with physiological and anatomical measurements to characterize kidney damage caused by spaceflight. It reveals pathways related to oxidative stress and tissue remodeling, defining a 'cosmic kidney disease' profile.",tags:["kidney","spaceflight","renal dysfunction","omics","astronaut health"],citationCount:8,relevanceScore:.96,downloadUrl:"https://www.ncbi.nlm.nih.gov/pmc/articles/PMC11167060/pdf/",externalUrl:"https://www.ncbi.nlm.nih.gov/pmc/articles/PMC11167060/",publishedDate:"2024-06-11"}],zb={papers:PVe,latestPapers:RVe};function IVe({userType:t,theme:e,user:i}){const[r,n]=J.useState(""),[s,a]=J.useState([]),[o,l]=J.useState([]),[c,u]=J.useState([]),[h,d]=J.useState([]),[f,p]=J.useState(!1),[g,m]=J.useState(!1),[y,b]=J.useState(null),[w,E]=J.useState("search"),[M,A]=J.useState(!1),[P,C]=J.useState({category:"",experimentType:"",dataFile:""}),[R,I]=J.useState({year:"",institution:"",topic:"",minCitations:""}),k=[{id:"rec_1",title:"Breakthrough Discoveries in Space Radiation Protection",reason:"Based on your interest in space medicine",relevanceScore:.85,type:"recommended",abstract:"Recent advances in radiation shielding technologies for long-duration space missions, including novel composite materials and active magnetic shielding systems. This paper also explores the biological impact of different radiation types.",authors:["Dr. Alex Kim","Dr. Maria Santos"],institution:"NASA Ames Research Center",publicationYear:2024,tags:["radiation protection","space medicine","shielding","materials science"],citationCount:156,downloadUrl:"https://example.com/papers/rec_1.pdf",externalUrl:"https://nasa.gov/papers/rec_1"},{id:"rec_2",title:"AI Applications in Mission Control Systems",reason:"Popular among researchers this month",relevanceScore:.82,type:"recommended",abstract:"Integration of artificial intelligence in autonomous mission control and decision-making systems for enhanced efficiency and safety. Covers topics such as predictive maintenance and intelligent anomaly detection.",authors:["Dr. Robert Chen","Dr. Jennifer Lee"],institution:"Stanford University",publicationYear:2024,tags:["artificial intelligence","mission control","automation","software engineering"],citationCount:98,downloadUrl:"https://example.com/papers/rec_2.pdf",externalUrl:"https://nasa.gov/papers/rec_2"}],z=async()=>{try{const se=`https://${zK}.supabase.co/functions/v1/make-server-0a8c168d/health`,re=await fetch(se,{headers:{Authorization:`Bearer ${jK}`}});re.ok&&console.log("Server health check:",await re.json())}catch(se){console.error("Server connection error:",se)}};J.useEffect(()=>{z(),a(zb.papers.map(se=>({...se,type:"search"}))),V(),i?.id&&F(),$()},[i]);const V=async()=>{p(!0);try{const se=zb.papers.filter(re=>re.publicationYear===2024).map(re=>({...re,type:"recentlyPublished"}));u(se)}catch(se){console.error("Failed to load recently published papers:",se)}finally{p(!1)}},F=async()=>{try{if(l(k),!i?.id)return;const se=`https://${zK}.supabase.co/functions/v1/make-server-0a8c168d/recommendations/${i.id}`,re=await fetch(se,{headers:{Authorization:`Bearer ${jK}`,"Content-Type":"application/json"}});if(re.ok){const le=await re.json();le.recommendations?.length>0&&l(le.recommendations.map(he=>({...he,type:"recommended"})))}}catch(se){console.error("Failed to load recommendations:",se)}},$=async(se=P)=>{p(!0);try{const re=zb.papers.filter(le=>{const he=se.category&&se.category!=="all_categories"?le.tags.some(Se=>Se.toLowerCase().includes(se.category.toLowerCase())):!0,ve=se.experimentType&&se.experimentType!=="all_experiment_types"?le.tags.some(Se=>Se.toLowerCase().includes(se.experimentType.toLowerCase())):!0,xe=se.dataFile&&se.dataFile!=="all_data_files"?le.tags.some(Se=>Se.toLowerCase().includes(se.dataFile.toLowerCase())):!0;return he&&ve&&xe}).map(le=>({...le,type:"topicBased"}));await new Promise(le=>setTimeout(le,500)),d(re)}catch(re){console.error("Failed to load topic-based papers:",re)}finally{p(!1)}};J.useEffect(()=>{$()},[P]);const K=async()=>{if(!r.trim()&&!Object.values(R).some(se=>se!==""&&se!=="all_years"&&se!=="all_institutions"&&se!=="all_topics")){a(zb.papers.map(se=>({...se,type:"search"}))),m(!1);return}p(!0),m(!0);try{const se=zb.papers.filter(re=>{const le=r.trim()===""||re.title.toLowerCase().includes(r.toLowerCase())||re.abstract.toLowerCase().includes(r.toLowerCase())||re.tags.some(Ce=>Ce.toLowerCase().includes(r.toLowerCase())),he=R.year&&R.year!=="all_years"?re.publicationYear===parseInt(R.year):!0,ve=R.institution&&R.institution!=="all_institutions"?re.institution.toLowerCase().includes(R.institution.toLowerCase()):!0,xe=R.topic&&R.topic!=="all_topics"?re.tags.some(Ce=>Ce.toLowerCase().includes(R.topic.toLowerCase())):!0,Se=R.minCitations?re.citationCount>=parseInt(R.minCitations):!0;return le&&he&&ve&&xe&&Se});await new Promise(re=>setTimeout(re,1e3)),a(se.map(re=>({...re,type:"search"}))),E("search")}catch(se){console.error("Search error:",se)}finally{p(!1)}},X=async(se,re,le={})=>{try{console.log(`Tracking interaction: ${re} for paper ${se}`)}catch(he){console.error("Failed to track interaction:",he)}},U=se=>{b(se),X(se.id,"view")},Y=(se,re)=>{re&&re.stopPropagation(),X(se.id,"download"),console.log("Downloading paper:",se.title),se.downloadUrl&&window.open(se.downloadUrl,"_blank")},Z=se=>{se.key==="Enter"&&K()},j=()=>{n(""),I({year:"",institution:"",topic:"",minCitations:""}),m(!1),a(zb.papers.map(se=>({...se,type:"search"})))},ee=()=>{C({category:"",experimentType:"",dataFile:""})},pe=()=>{A(!0),CVe.success("You'll be notified of new research! ",{position:"top-right",style:{background:"#333",color:"#fff"},iconTheme:{primary:e.primaryColor,secondary:"#fff"}}),setTimeout(()=>{A(!1)},2e3)},fe=({type:se})=>{const le={search:{icon:Pd,title:"Discover Research Papers",description:"Use semantic search to find relevant NASA research papers and space life sciences studies.",action:"Start by typing your research query or using the filters above"},results:{icon:YA,title:"No Results Found",description:"Try adjusting your search terms or filters to find relevant papers.",action:"Modify your search or explore recommendations"},recommendations:{icon:mu,title:"No Recommendations Yet",description:"Your personalized recommendations will appear here based on your activity.",action:"Start searching and interacting with papers to get recommendations"},recent:{icon:X9,title:"No Recently Published Papers",description:"Check back later for the latest research papers.",action:"Stay tuned for new publications"},topic:{icon:Y9,title:"No Papers for this Topic",description:"Adjust your topic filters or explore other categories.",action:"Try different filters or browse all topics"}}[se],he=le.icon;return O.jsxs(Rt.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"text-center py-16",children:[O.jsx("div",{className:`w-20 h-20 rounded-full bg-gradient-to-r ${e.primary} mx-auto mb-6 flex items-center justify-center`,children:O.jsx(he,{className:"w-10 h-10 text-white"})}),O.jsx("h3",{className:"text-xl text-white mb-3",children:le.title}),O.jsx("p",{className:"text-gray-400 mb-4 max-w-md mx-auto",children:le.description}),O.jsx("p",{className:"text-sm text-gray-500",children:le.action})]})};return O.jsxs("div",{className:"h-full overflow-auto custom-scrollbar relative",children:[O.jsx(TVe,{}),O.jsxs("div",{className:"max-w-7xl mx-auto p-6 relative z-10",children:[O.jsx(Rt.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},className:"mb-8",children:O.jsxs("div",{className:"flex items-center justify-between mb-4",children:[O.jsxs("div",{className:"flex items-center gap-3",children:[O.jsx("div",{className:`p-3 rounded-full bg-gradient-to-r ${e.primary}`,children:O.jsx(Mh,{className:"w-6 h-6 text-white"})}),O.jsxs("div",{children:[O.jsx("h1",{className:"text-3xl text-white",children:"Data Gallery"}),O.jsx("p",{className:"text-gray-400",children:"Search and explore NASA research papers and space life sciences data"})]})]}),O.jsx(jr,{onClick:pe,className:`bg-gradient-to-r ${e.primary} hover:opacity-90 px-6 relative overflow-hidden`,disabled:M,children:O.jsx(ql,{children:M?O.jsxs(Rt.div,{initial:{scale:.5,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.5,opacity:0},transition:{duration:.3},className:"flex items-center",children:[O.jsx(q9,{className:"w-4 h-4 mr-2"}),"Notifying..."]}):O.jsxs(Rt.div,{initial:{scale:1,opacity:1},exit:{scale:.5,opacity:0},transition:{duration:.3},className:"flex items-center",children:[O.jsx(q9,{className:"w-4 h-4 mr-2"}),"Get Notified"]})})})]})}),O.jsx(Rt.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"mb-8 relative",children:O.jsx(zn,{className:"bg-white/[0.02] backdrop-blur-sm border-white/10",children:O.jsxs(jn,{className:"p-6",children:[O.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 mb-4",children:[O.jsx("div",{className:"flex-1",children:O.jsx(aA,{placeholder:"Search research papers using semantic search...",value:r,onChange:se=>n(se.target.value),onKeyPress:Z,className:"bg-white/10 border-white/20 text-white placeholder-gray-400"})}),O.jsx(jr,{onClick:K,disabled:f,className:`bg-gradient-to-r ${e.primary} hover:opacity-90 px-8`,children:f?O.jsx(Rt.div,{animate:{rotate:360},transition:{duration:2,repeat:1/0,ease:"linear"},className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full"}):O.jsxs(O.Fragment,{children:[O.jsx(Pd,{className:"w-4 h-4 mr-2"}),"Search"]})})]}),O.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mt-4",children:[O.jsxs(Nb,{value:R.year,onValueChange:se=>I({...R,year:se}),children:[O.jsx(Bb,{className:"bg-white/10 border-white/20 text-white",children:O.jsx(Ub,{placeholder:"Publication Year"})}),O.jsxs(Fb,{className:"bg-slate-800 border-slate-700 text-white z-[9999]",children:[O.jsx(Hi,{value:"all_years",children:"All Years"}),O.jsx(Hi,{value:"2024",children:"2024"}),O.jsx(Hi,{value:"2023",children:"2023"}),O.jsx(Hi,{value:"2022",children:"2022"}),O.jsx(Hi,{value:"2021",children:"2021"}),O.jsx(Hi,{value:"2020",children:"2020"})]})]}),O.jsxs(Nb,{value:R.institution,onValueChange:se=>I({...R,institution:se}),children:[O.jsx(Bb,{className:"bg-white/10 border-white/20 text-white",children:O.jsx(Ub,{placeholder:"Institution"})}),O.jsxs(Fb,{className:"bg-slate-800 border-slate-700 text-white z-[9999]",children:[O.jsx(Hi,{value:"all_institutions",children:"All Institutions"}),O.jsx(Hi,{value:"nasa_johnson",children:"NASA Johnson Space Center"}),O.jsx(Hi,{value:"kennedy_space_center",children:"Kennedy Space Center"}),O.jsx(Hi,{value:"jpl",children:"Jet Propulsion Laboratory"}),O.jsx(Hi,{value:"baylor_medicine",children:"Baylor College of Medicine"}),O.jsx(Hi,{value:"ut_austin",children:"University of Texas at Austin"}),O.jsx(Hi,{value:"upenn",children:"University of Pennsylvania"}),O.jsx(Hi,{value:"georgia_tech",children:"Georgia Tech"}),O.jsx(Hi,{value:"cmu",children:"Carnegie Mellon University"}),O.jsx(Hi,{value:"uc_boulder",children:"University of Colorado Boulder"}),O.jsx(Hi,{value:"uc_davis",children:"University of California, Davis"}),O.jsx(Hi,{value:"nasa_ames",children:"NASA Ames Research Center"}),O.jsx(Hi,{value:"stanford",children:"Stanford University"})]})]}),O.jsxs(Nb,{value:R.topic,onValueChange:se=>I({...R,topic:se}),children:[O.jsx(Bb,{className:"bg-white/10 border-white/20 text-white",children:O.jsx(Ub,{placeholder:"Research Topic"})}),O.jsxs(Fb,{className:"bg-slate-800 border-slate-700 text-white z-[9999]",children:[O.jsx(Hi,{value:"all_topics",children:"All Topics"}),O.jsx(Hi,{value:"microgravity",children:"Microgravity"}),O.jsx(Hi,{value:"space medicine",children:"Space Medicine"}),O.jsx(Hi,{value:"astrobiology",children:"Astrobiology"}),O.jsx(Hi,{value:"life support",children:"Life Support"}),O.jsx(Hi,{value:"radiation",children:"Radiation"}),O.jsx(Hi,{value:"plants",children:"Plants"}),O.jsx(Hi,{value:"animals",children:"Animals"}),O.jsx(Hi,{value:"biology",children:"Biology"}),O.jsx(Hi,{value:"engineering",children:"Engineering"}),O.jsx(Hi,{value:"immunology",children:"Immunology"}),O.jsx(Hi,{value:"robotics",children:"Robotics"}),O.jsx(Hi,{value:"materials science",children:"Materials Science"}),O.jsx(Hi,{value:"behavioral health",children:"Behavioral Health"})]})]}),O.jsxs("div",{className:"flex gap-2",children:[O.jsx(aA,{type:"number",placeholder:"Min Citations",value:R.minCitations,onChange:se=>I({...R,minCitations:se.target.value}),className:"bg-white/10 border-white/20 text-white placeholder-gray-400"}),O.jsx(jr,{variant:"ghost",onClick:j,className:"text-gray-400 hover:text-white px-3",title:"Clear Search Filters",children:O.jsx($9,{className:"w-4 h-4"})})]})]})]})})}),O.jsxs(Rt.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1},className:"mb-10",children:[O.jsxs("div",{className:"flex items-center gap-3 mb-5",children:[O.jsx("div",{className:`p-2 rounded-full bg-gradient-to-r ${e.primary} text-white`,children:O.jsx(X9,{className:"w-5 h-5"})}),O.jsx("h2",{className:"text-2xl text-white",children:"Recently Published Papers"})]}),f&&c.length===0?O.jsx("div",{className:"py-10",children:O.jsx(TB,{userType:t,theme:e})}):c.length>0?O.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:O.jsx(ql,{children:c.map(se=>O.jsx(hP,{paper:se,theme:e,onPaperClick:U,onDownload:Y},se.id))})}):O.jsx(fe,{type:"recent"})]}),O.jsxs(Rt.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2},className:"mb-10",children:[O.jsxs("div",{className:"flex items-center gap-3 mb-5",children:[O.jsx("div",{className:`p-2 z-20 rounded-full bg-gradient-to-r ${e.primary} text-white`,children:O.jsx(Y9,{className:"w-5 h-5"})}),O.jsx("h2",{className:"text-2xl text-white",children:"Research Papers by Topic"})]}),O.jsx(zn,{className:"relative bg-white/[0.02] backdrop-blur-sm border-white/10 mb-6 z-10 overflow-visible",children:O.jsx(jn,{className:"p-6 overflow-visible",children:O.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 overflow-visible",children:[O.jsxs(Nb,{value:P.category,onValueChange:se=>C({...P,category:se}),children:[O.jsx(Bb,{className:"bg-white/10 border-white/20 text-white",children:O.jsx(Ub,{placeholder:"Category"})}),O.jsxs(Fb,{className:"!z-[99999] bg-slate-900 border border-white/20 text-white shadow-lg backdrop-blur-none",position:"popper",side:"bottom",align:"start",avoidCollisions:!1,portal:!0,children:[O.jsx(Hi,{value:"all_categories",children:"All Categories"}),O.jsx(Hi,{value:"biology",children:"Biological"}),O.jsx(Hi,{value:"engineering",children:"Engineering"}),O.jsx(Hi,{value:"medicine",children:"Space Medicine"}),O.jsx(Hi,{value:"astrobiology",children:"Astrobiology"})]})]}),O.jsxs(Nb,{value:P.experimentType,onValueChange:se=>C({...P,experimentType:se}),children:[O.jsx(Bb,{className:"bg-white/10 border-white/20 text-white",children:O.jsx(Ub,{placeholder:"Experiment Type"})}),O.jsxs(Fb,{className:"!z-[99999] bg-slate-900 top-2/3 border border-white/20 text-white shadow-lg backdrop-blur-none",position:"popper",side:"bottom",align:"start",avoidCollisions:!1,portal:!0,children:[O.jsx(Hi,{value:"all_experiment_types",children:"All Experiment Types"}),O.jsx(Hi,{value:"plants",children:"Plants Research"}),O.jsx(Hi,{value:"animals",children:"Animals Research"}),O.jsx(Hi,{value:"human",children:"Human Studies"}),O.jsx(Hi,{value:"environmental",children:"Environmental Experiments"})]})]}),O.jsxs("div",{className:"flex gap-2",children:[O.jsxs(Nb,{value:P.dataFile,onValueChange:se=>C({...P,dataFile:se}),children:[O.jsx(Bb,{className:"bg-white/10 border-white/20 text-white",children:O.jsx(Ub,{placeholder:"Data Filter"})}),O.jsxs(Fb,{className:"!z-[99999] bg-slate-900 py-30px border border-white/20 text-white shadow-lg backdrop-blur-none",position:"popper",side:"bottom",sideOffset:30,align:"start",avoidCollisions:!1,portal:!0,children:[O.jsx(Hi,{value:"all_data_files",children:"All Data Files"}),O.jsx(Hi,{value:"genomics",children:"Genomics Data"}),O.jsx(Hi,{value:"proteomics",children:"Proteomics Data"}),O.jsx(Hi,{value:"imaging",children:"Imaging Data"}),O.jsx(Hi,{value:"sensor",children:"Sensor Data"})]})]}),O.jsx(jr,{variant:"ghost",onClick:ee,className:"text-gray-400 hover:text-white px-3",title:"Clear Topic Filters",children:O.jsx($9,{className:"w-4 h-4"})})]})]})})}),f&&h.length===0?O.jsx("div",{className:"py-10",children:O.jsx(TB,{userType:t,theme:e})}):h.length>0?O.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:O.jsx(ql,{children:h.map(se=>O.jsx(hP,{paper:se,theme:e,onPaperClick:U,onDownload:Y},se.id))})}):O.jsx(fe,{type:"topic"})]}),O.jsxs(U5e,{value:w,onValueChange:E,className:"w-full mt-10",children:[O.jsxs(B5e,{className:"grid w-full grid-cols-2 bg-white/10 border border-white/20",children:[O.jsxs(UK,{value:"search",className:"data-[state=active]:bg-white/20",children:[O.jsx(Pd,{className:"w-4 h-4 mr-2"}),"Search Results"]}),O.jsxs(UK,{value:"recommendations",className:"data-[state=active]:bg-white/20",children:[O.jsx(mu,{className:"w-4 h-4 mr-2"}),"Recommendations"]})]}),O.jsx(BK,{value:"search",className:"mt-6",children:f&&g&&s.length===0?O.jsx("div",{className:"py-16",children:O.jsx(TB,{userType:t,theme:e})}):s.length===0?O.jsx(fe,{type:"results"}):O.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:O.jsx(ql,{children:s.map(se=>O.jsx(hP,{paper:se,theme:e,onPaperClick:U,onDownload:Y},se.id))})})}),O.jsx(BK,{value:"recommendations",className:"mt-6",children:o.length>0?O.jsxs("div",{className:"space-y-6",children:[O.jsxs("div",{className:"text-center mb-6",children:[O.jsx("h3",{className:"text-xl text-white mb-2",children:"Personalized for You"}),O.jsx("p",{className:"text-gray-400",children:"Based on your search history and research interests"})]}),O.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:O.jsx(ql,{children:o.map(se=>O.jsx(hP,{paper:se,theme:e,onPaperClick:U,onDownload:Y},se.id))})})]}):O.jsx(fe,{type:"recommendations"})})]}),O.jsx(ql,{children:y&&O.jsxs(Rt.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 z-[9999] flex items-center justify-center p-4",onClick:()=>b(null),children:[O.jsx("div",{className:"absolute inset-0 bg-black/80 backdrop-blur-lg"}),O.jsxs(Rt.div,{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.9,opacity:0},className:"relative bg-slate-900/95 backdrop-blur-xl border border-blue-400/20 rounded-lg p-8 max-w-4xl w-full max-h-[90vh] overflow-auto custom-scrollbar shadow-2xl text-white",onClick:se=>se.stopPropagation(),style:{background:"linear-gradient(135deg, rgba(30, 58, 138, 0.2) 0%, rgba(29, 78, 216, 0.15) 50%, rgba(37, 99, 235, 0.2) 100%), rgba(15, 23, 42, 0.95)"},children:[O.jsxs("div",{className:"flex items-start justify-between mb-6",children:[O.jsx("h2",{className:"text-3xl font-bold pr-8 leading-tight",children:y.title}),O.jsx(jr,{variant:"ghost",onClick:()=>b(null),className:"text-white hover:bg-white/10 p-2 rounded-full","aria-label":"Close",children:O.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:O.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),O.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-8",children:[O.jsxs("div",{className:"md:col-span-2",children:[O.jsxs("div",{className:"mb-6",children:[O.jsx("h3",{className:"text-xl font-semibold mb-3",children:"Abstract"}),O.jsx("p",{className:"text-blue-100 leading-relaxed",children:y.abstract})]}),y.id==="mock_paper_1"&&O.jsxs("div",{className:"mb-6",children:[O.jsx("h3",{className:"text-xl font-semibold mb-3",children:"Key Findings"}),O.jsxs("ul",{className:"space-y-2 text-blue-100",children:[O.jsxs("li",{className:"flex items-start gap-2",children:[O.jsx("span",{className:"text-blue-300 mt-1",children:""}),"Cardiac output decreased by 15% after 30 days in microgravity"]}),O.jsxs("li",{className:"flex items-start gap-2",children:[O.jsx("span",{className:"text-blue-300 mt-1",children:""}),"Blood pressure regulation mechanisms adapted within 60 days"]})]})]})]}),O.jsxs("div",{className:"space-y-5",children:[O.jsxs("div",{children:[O.jsx("h4",{className:"font-semibold mb-2",children:"Authors"}),O.jsx("p",{className:"text-blue-100 text-sm",children:y.authors?.join(", ")})]}),O.jsxs("div",{children:[O.jsx("h4",{className:"font-semibold mb-2",children:"Publication Year"}),O.jsx("p",{className:"text-blue-100 text-sm",children:y.publicationYear})]}),O.jsxs("div",{children:[O.jsx("h4",{className:"font-semibold mb-2",children:"Institution"}),O.jsx("p",{className:"text-blue-100 text-sm",children:y.institution})]}),O.jsxs("div",{children:[O.jsx("h4",{className:"font-semibold mb-2",children:"Citations"}),O.jsx("p",{className:"text-blue-100 text-sm",children:y.citationCount})]}),y.tags&&O.jsxs("div",{children:[O.jsx("h4",{className:"font-semibold mb-2",children:"Tags"}),O.jsx("div",{className:"flex flex-wrap gap-2",children:y.tags.map((se,re)=>O.jsx(Ip,{className:"text-xs bg-blue-700/50 text-blue-100 border-blue-400/30",children:se},re))})]}),O.jsxs("div",{className:"pt-6 space-y-3",children:[y.downloadUrl&&O.jsxs(jr,{onClick:()=>window.open(y.externalUrl,"_blank"),className:"w-full bg-blue-600 hover:bg-blue-700 text-white shadow-lg",children:[O.jsx(use,{className:"w-4 h-4 mr-2"}),"View Online"]}),y.externalUrl&&O.jsxs(jr,{variant:"outline",onClick:()=>window.open(y.externalUrl,"_blank"),className:"w-full border-blue-400/50 text-blue-100 hover:bg-blue-700/30 transition-colors",children:[O.jsx(a6,{className:"w-4 h-4 mr-2"}),"Download from website"]})]})]})]})]})]})})]})]})}function DVe({user:t,userType:e,onUserTypeChange:i,onSignOut:r}){const[n,s]=J.useState("main"),[a,o]=J.useState(!0),[l,c]=J.useState(null),h=(()=>{switch(e){case"scientist":return{primary:"from-blue-500 to-cyan-500",background:"from-slate-900 via-black-900 to-slate-900",accent:"blue"};case"investor":return{primary:"from-green-500 to-emerald-500",background:"from-slate-900 via-black-900 to-slate-900",accent:"green"};case"mission-architect":return{primary:"from-red-500 to-orange-500",background:"from-slate-900 via-amber-900 to-slate-900",accent:"amber"};default:return{primary:"from-purple-500 to-pink-500",background:"from-slate-900 via-purple-900 to-slate-900",accent:"purple"}}})(),d=()=>{switch(n){case"main":return O.jsx(n$,{userType:e,theme:h,initialResponse:l});case"how-it-works":return O.jsx(xIe,{theme:h});case"about":return O.jsx(bIe,{theme:h});case"data-gallery":return O.jsx(IVe,{userType:e,theme:h,user:t});default:return O.jsx(n$,{userType:e,theme:h,initialResponse:l})}};return O.jsxs("div",{className:"min-h-screen relative overflow-hidden",children:[O.jsx("div",{className:"fixed inset-0 -z-10",children:O.jsx(jE,{})}),O.jsx("div",{className:"absolute inset-0 overflow-hidden pointer-events-none",children:[...Array(15)].map((f,p)=>O.jsx(Rt.div,{className:`absolute w-1 h-1 bg-${h.accent}-400 rounded-full opacity-30`,animate:{x:[0,Math.random()*200-100],y:[0,Math.random()*200-100],scale:[0,1,0]},transition:{duration:Math.random()*15+10,repeat:1/0,delay:Math.random()*5},style:{left:`${Math.random()*100}%`,top:`${Math.random()*100}%`}},p))}),O.jsxs("div",{className:"flex h-screen relative z-10",children:[O.jsx(ql,{mode:"wait",children:a&&O.jsx(Rt.div,{initial:{x:-300,opacity:0},animate:{x:0,opacity:1},exit:{x:-300,opacity:0},transition:{duration:.3},className:"flex-shrink-0",children:O.jsx(dAe,{user:t,userType:e,currentPage:n,onPageChange:s,onUserTypeChange:i,onSignOut:r,theme:h,onToggle:()=>o(!1),onSelectHistory:f=>{c(f),s("main")}})})}),O.jsxs("div",{className:"flex-1 flex flex-col",children:[!a&&O.jsx(Rt.button,{initial:{opacity:0},animate:{opacity:1},onClick:()=>o(!0),className:`fixed top-4 left-4 z-20 p-2 bg-gradient-to-r ${h.primary} rounded-lg text-white hover:scale-105 transition-transform`,children:O.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:O.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 6h16M4 12h16M4 18h16"})})}),O.jsx("main",{className:"flex-1 overflow-auto",children:O.jsx(ql,{mode:"wait",children:O.jsx(Rt.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{duration:.3},className:"h-full",children:d()},n)})})]})]})]})}var OVe=Object.create,sL=Object.defineProperty,LVe=Object.getOwnPropertyDescriptor,kVe=Object.getOwnPropertyNames,NVe=Object.getPrototypeOf,UVe=Object.prototype.hasOwnProperty,BVe=(t,e,i)=>e in t?sL(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i,$0=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports),FVe=(t,e)=>{for(var i in e)sL(t,i,{get:e[i],enumerable:!0})},zVe=(t,e,i,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let n of kVe(e))!UVe.call(t,n)&&n!==i&&sL(t,n,{get:()=>e[n],enumerable:!(r=LVe(e,n))||r.enumerable});return t},gv=(t,e,i)=>(i=t!=null?OVe(NVe(t)):{},zVe(e||!t||!t.__esModule?sL(i,"default",{value:t,enumerable:!0}):i,t)),HE=(t,e,i)=>(BVe(t,typeof e!="symbol"?e+"":e,i),i),jVe=$0((t,e)=>{(function(i,r){typeof t=="object"?e.exports=r():typeof define=="function"&&define.amd?define(r):i.Alea=r()})(t,function(){return i.importState=function(n){var s=new i;return s.importState(n),s},i;function i(){return(function(n){var s=0,a=0,o=0,l=1;n.length==0&&(n=[+new Date]);var c=r();s=c(" "),a=c(" "),o=c(" ");for(var u=0;u<n.length;u++)s-=c(n[u]),s<0&&(s+=1),a-=c(n[u]),a<0&&(a+=1),o-=c(n[u]),o<0&&(o+=1);c=null;var h=function(){var d=2091639*s+l*23283064365386963e-26;return s=a,a=o,o=d-(l=d|0)};return h.next=h,h.uint32=function(){return h()*4294967296},h.fract53=function(){return h()+(h()*2097152|0)*11102230246251565e-32},h.version="Alea 0.9",h.args=n,h.exportState=function(){return[s,a,o,l]},h.importState=function(d){s=+d[0]||0,a=+d[1]||0,o=+d[2]||0,l=+d[3]||0},h})(Array.prototype.slice.call(arguments))}function r(){var n=4022871197,s=function(a){a=a.toString();for(var o=0;o<a.length;o++){n+=a.charCodeAt(o);var l=.02519603282416938*n;n=l>>>0,l-=n,l*=n,n=l>>>0,l-=n,n+=l*4294967296}return(n>>>0)*23283064365386963e-26};return s.version="Mash 0.9",s}})}),Yue=$0((t,e)=>{(function(i,r){typeof t=="object"&&typeof e<"u"?r(t):typeof define=="function"&&define.amd?define(["exports"],r):r((i=typeof globalThis<"u"?globalThis:i||self).SVDJS={})})(t,function(i){i.SVD=function(r,n,s,a,o){if(n=n===void 0||n,s=s===void 0||s,o=1e-64/(a=a||Math.pow(2,-52)),!r)throw new TypeError("Matrix a is not defined");var l,c,u,h,d,f,p,g,m,y,b,w,E=r[0].length,M=r.length;if(M<E)throw new TypeError("Invalid matrix: m < n");for(var A=[],P=[],C=[],R=n==="f"?M:E,I=y=p=0;I<M;I++)P[I]=new Array(R).fill(0);for(I=0;I<E;I++)C[I]=new Array(E).fill(0);var k,z=new Array(E).fill(0);for(I=0;I<M;I++)for(l=0;l<E;l++)P[I][l]=r[I][l];for(I=0;I<E;I++){for(A[I]=p,m=0,u=I+1,l=I;l<M;l++)m+=Math.pow(P[l][I],2);if(m<o)p=0;else for(g=(f=P[I][I])*(p=f<0?Math.sqrt(m):-Math.sqrt(m))-m,P[I][I]=f-p,l=u;l<E;l++){for(m=0,c=I;c<M;c++)m+=P[c][I]*P[c][l];for(f=m/g,c=I;c<M;c++)P[c][l]=P[c][l]+f*P[c][I]}for(z[I]=p,m=0,l=u;l<E;l++)m+=Math.pow(P[I][l],2);if(m<o)p=0;else{for(g=(f=P[I][I+1])*(p=f<0?Math.sqrt(m):-Math.sqrt(m))-m,P[I][I+1]=f-p,l=u;l<E;l++)A[l]=P[I][l]/g;for(l=u;l<M;l++){for(m=0,c=u;c<E;c++)m+=P[l][c]*P[I][c];for(c=u;c<E;c++)P[l][c]=P[l][c]+m*A[c]}}y<(b=Math.abs(z[I])+Math.abs(A[I]))&&(y=b)}if(s)for(I=E-1;0<=I;I--){if(p!==0){for(g=P[I][I+1]*p,l=u;l<E;l++)C[l][I]=P[I][l]/g;for(l=u;l<E;l++){for(m=0,c=u;c<E;c++)m+=P[I][c]*C[c][l];for(c=u;c<E;c++)C[c][l]=C[c][l]+m*C[c][I]}}for(l=u;l<E;l++)C[I][l]=0,C[l][I]=0;C[I][I]=1,p=A[I],u=I}if(n){if(n==="f")for(I=E;I<M;I++){for(l=E;l<M;l++)P[I][l]=0;P[I][I]=1}for(I=E-1;0<=I;I--){for(u=I+1,p=z[I],l=u;l<R;l++)P[I][l]=0;if(p!==0){for(g=P[I][I]*p,l=u;l<R;l++){for(m=0,c=u;c<M;c++)m+=P[c][I]*P[c][l];for(f=m/g,c=I;c<M;c++)P[c][l]=P[c][l]+f*P[c][I]}for(l=I;l<M;l++)P[l][I]=P[l][I]/p}else for(l=I;l<M;l++)P[l][I]=0;P[I][I]=P[I][I]+1}}for(a*=y,c=E-1;0<=c;c--)for(var V=0;V<50;V++){for(k=!1,u=c;0<=u;u--){if(Math.abs(A[u])<=a){k=!0;break}if(Math.abs(z[u-1])<=a)break}if(!k){for(d=0,h=u-(m=1),I=u;I<c+1&&(f=m*A[I],A[I]=d*A[I],!(Math.abs(f)<=a));I++)if(p=z[I],z[I]=Math.sqrt(f*f+p*p),d=p/(g=z[I]),m=-f/g,n)for(l=0;l<M;l++)b=P[l][h],w=P[l][I],P[l][h]=b*d+w*m,P[l][I]=-b*m+w*d}if(w=z[c],u===c){if(w<0&&(z[c]=-w,s))for(l=0;l<E;l++)C[l][c]=-C[l][c];break}for(y=z[u],f=(((b=z[c-1])-w)*(b+w)+((p=A[c-1])-(g=A[c]))*(p+g))/(2*g*b),p=Math.sqrt(f*f+1),f=((y-w)*(y+w)+g*(b/(f<0?f-p:f+p)-g))/y,I=u+(m=d=1);I<c+1;I++){if(p=A[I],b=z[I],g=m*p,p*=d,w=Math.sqrt(f*f+g*g),f=y*(d=f/(A[I-1]=w))+p*(m=g/w),p=-y*m+p*d,g=b*m,b*=d,s)for(l=0;l<E;l++)y=C[l][I-1],w=C[l][I],C[l][I-1]=y*d+w*m,C[l][I]=-y*m+w*d;if(w=Math.sqrt(f*f+g*g),f=(d=f/(z[I-1]=w))*p+(m=g/w)*b,y=-m*p+d*b,n)for(l=0;l<M;l++)b=P[l][I-1],w=P[l][I],P[l][I-1]=b*d+w*m,P[l][I]=-b*m+w*d}A[u]=0,A[c]=f,z[c]=y}for(I=0;I<E;I++)z[I]<a&&(z[I]=0);return{u:P,q:z,v:C}},i.VERSION="1.1.1",Object.defineProperty(i,"__esModule",{value:!0})})}),VVe=$0((t,e)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=i;function i(r){if(r===null||r===!0||r===!1)return NaN;var n=Number(r);return isNaN(n)?n:n<0?Math.ceil(n):Math.floor(n)}e.exports=t.default}),HVe=$0((t,e)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=i;function i(r){var n=new Date(Date.UTC(r.getFullYear(),r.getMonth(),r.getDate(),r.getHours(),r.getMinutes(),r.getSeconds(),r.getMilliseconds()));return n.setUTCFullYear(r.getFullYear()),r.getTime()-n.getTime()}e.exports=t.default}),GVe=$0((t,e)=>{function i(s,a){function o(){this.constructor=s}o.prototype=a.prototype,s.prototype=new o}function r(s,a,o,l){this.message=s,this.expected=a,this.found=o,this.location=l,this.name="SyntaxError",typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,r)}i(r,Error),r.buildMessage=function(s,a){var o={literal:function(p){return'"'+c(p.text)+'"'},class:function(p){var g="",m;for(m=0;m<p.parts.length;m++)g+=p.parts[m]instanceof Array?u(p.parts[m][0])+"-"+u(p.parts[m][1]):u(p.parts[m]);return"["+(p.inverted?"^":"")+g+"]"},any:function(p){return"any character"},end:function(p){return"end of input"},other:function(p){return p.description}};function l(p){return p.charCodeAt(0).toString(16).toUpperCase()}function c(p){return p.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(g){return"\\x0"+l(g)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(g){return"\\x"+l(g)})}function u(p){return p.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(g){return"\\x0"+l(g)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(g){return"\\x"+l(g)})}function h(p){return o[p.type](p)}function d(p){var g=new Array(p.length),m,y;for(m=0;m<p.length;m++)g[m]=h(p[m]);if(g.sort(),g.length>0){for(m=1,y=1;m<g.length;m++)g[m-1]!==g[m]&&(g[y]=g[m],y++);g.length=y}switch(g.length){case 1:return g[0];case 2:return g[0]+" or "+g[1];default:return g.slice(0,-1).join(", ")+", or "+g[g.length-1]}}function f(p){return p?'"'+c(p)+'"':"end of input"}return"Expected "+d(s)+" but "+f(a)+" found."};function n(s,a){a=a!==void 0?a:{};var o={},l={svg_path:$t},c=$t,u=function(ne){if(!ne)return[];for(var ae=[],_e=0;_e<ne.length;_e++)ae=ae.concat.apply(ae,ne[_e]);var me=ae[0];return me&&me.code=="m"&&(delete me.relative,me.code="M"),ae},h=function(ne,ae){return Vt(ne,ae)},d=/^[Mm]/,f=ot(["M","m"],!1,!1),p=function(ne,ae,_e){var me=Wt(ne,[ae]);return _e&&(me=me.concat(Wt(ne=="M"?"L":"l",_e[1]))),me},g=/^[Zz]/,m=ot(["Z","z"],!1,!1),y=function(){return Wt("Z")},b=/^[Ll]/,w=ot(["L","l"],!1,!1),E=function(ne,ae){return Wt(ne,ae)},M=/^[Hh]/,A=ot(["H","h"],!1,!1),P=function(ne,ae){return Wt(ne,ae.map(function(_e){return{x:_e}}))},C=/^[Vv]/,R=ot(["V","v"],!1,!1),I=function(ne,ae){return Wt(ne,ae.map(function(_e){return{y:_e}}))},k=/^[Cc]/,z=ot(["C","c"],!1,!1),V=function(ne,ae,_e){return{x1:ne.x,y1:ne.y,x2:ae.x,y2:ae.y,x:_e.x,y:_e.y}},F=/^[Ss]/,$=ot(["S","s"],!1,!1),K=function(ne,ae){return{x2:ne.x,y2:ne.y,x:ae.x,y:ae.y}},X=/^[Qq]/,U=ot(["Q","q"],!1,!1),Y=function(ne,ae){return{x1:ne.x,y1:ne.y,x:ae.x,y:ae.y}},Z=/^[Tt]/,j=ot(["T","t"],!1,!1),ee=/^[Aa]/,pe=ot(["A","a"],!1,!1),fe=function(ne,ae,_e,me,Pe,Ze){return{rx:ne,ry:ae,xAxisRotation:_e,largeArc:me,sweep:Pe,x:Ze.x,y:Ze.y}},se=function(ne,ae){return{x:ne,y:ae}},re=function(ne){return ne*1},le=function(ne){return ne.join("")*1},he=/^[01]/,ve=ot(["0","1"],!1,!1),xe=function(ne){return ne=="1"},Se=function(){return""},Ce=",",ce=dt(",",!1),Fe=function(ne){return ne.join("")},De=".",He=dt(".",!1),Be=/^[eE]/,$e=ot(["e","E"],!1,!1),ze=/^[+\-]/,it=ot(["+","-"],!1,!1),wt=/^[0-9]/,ge=ot([["0","9"]],!1,!1),G=function(ne){return ne.join("")},Q=/^[ \t\n\r]/,we=ot([" ","	",`
`,"\r"],!1,!1),te=0,Ne=[{line:1,column:1}],Le=0,at=[],Te;if("startRule"in a){if(!(a.startRule in l))throw new Error(`Can't start parsing from rule "`+a.startRule+'".');c=l[a.startRule]}function dt(ne,ae){return{type:"literal",text:ne,ignoreCase:ae}}function ot(ne,ae,_e){return{type:"class",parts:ne,inverted:ae,ignoreCase:_e}}function Qe(){return{type:"end"}}function pt(ne){var ae=Ne[ne],_e;if(ae)return ae;for(_e=ne-1;!Ne[_e];)_e--;for(ae=Ne[_e],ae={line:ae.line,column:ae.column};_e<ne;)s.charCodeAt(_e)===10?(ae.line++,ae.column=1):ae.column++,_e++;return Ne[ne]=ae,ae}function _t(ne,ae){var _e=pt(ne),me=pt(ae);return{start:{offset:ne,line:_e.line,column:_e.column},end:{offset:ae,line:me.line,column:me.column}}}function yt(ne){te<Le||(te>Le&&(Le=te,at=[]),at.push(ne))}function Et(ne,ae,_e){return new r(r.buildMessage(ne,ae),ne,ae,_e)}function $t(){var ne,ae,_e,me,Pe;for(ne=te,ae=[],_e=Mt();_e!==o;)ae.push(_e),_e=Mt();if(ae!==o)if(_e=oe(),_e===o&&(_e=null),_e!==o){for(me=[],Pe=Mt();Pe!==o;)me.push(Pe),Pe=Mt();me!==o?(ae=u(_e),ne=ae):(te=ne,ne=o)}else te=ne,ne=o;else te=ne,ne=o;return ne}function oe(){var ne,ae,_e,me,Pe,Ze;if(ne=te,ae=Re(),ae!==o){for(_e=[],me=te,Pe=[],Ze=Mt();Ze!==o;)Pe.push(Ze),Ze=Mt();for(Pe!==o?(Ze=Re(),Ze!==o?(Pe=[Pe,Ze],me=Pe):(te=me,me=o)):(te=me,me=o);me!==o;){for(_e.push(me),me=te,Pe=[],Ze=Mt();Ze!==o;)Pe.push(Ze),Ze=Mt();Pe!==o?(Ze=Re(),Ze!==o?(Pe=[Pe,Ze],me=Pe):(te=me,me=o)):(te=me,me=o)}_e!==o?(ae=h(ae,_e),ne=ae):(te=ne,ne=o)}else te=ne,ne=o;return ne}function Re(){var ne,ae,_e,me,Pe,Ze;if(ne=te,ae=st(),ae!==o){for(_e=[],me=te,Pe=[],Ze=Mt();Ze!==o;)Pe.push(Ze),Ze=Mt();for(Pe!==o?(Ze=ke(),Ze!==o?(Pe=[Pe,Ze],me=Pe):(te=me,me=o)):(te=me,me=o);me!==o;){for(_e.push(me),me=te,Pe=[],Ze=Mt();Ze!==o;)Pe.push(Ze),Ze=Mt();Pe!==o?(Ze=ke(),Ze!==o?(Pe=[Pe,Ze],me=Pe):(te=me,me=o)):(te=me,me=o)}_e!==o?(ae=h(ae,_e),ne=ae):(te=ne,ne=o)}else te=ne,ne=o;return ne}function ke(){var ne;return ne=rt(),ne===o&&(ne=je(),ne===o&&(ne=Ft(),ne===o&&(ne=ti(),ne===o&&(ne=Zi(),ne===o&&(ne=Gr(),ne===o&&(ne=ye(),ne===o&&(ne=qe(),ne===o&&(ne=Zt())))))))),ne}function st(){var ne,ae,_e,me,Pe,Ze,Qi;if(ne=te,d.test(s.charAt(te))?(ae=s.charAt(te),te++):(ae=o,yt(f)),ae!==o){for(_e=[],me=Mt();me!==o;)_e.push(me),me=Mt();_e!==o?(me=fi(),me!==o?(Pe=te,Ze=de(),Ze===o&&(Ze=null),Ze!==o?(Qi=Tt(),Qi!==o?(Ze=[Ze,Qi],Pe=Ze):(te=Pe,Pe=o)):(te=Pe,Pe=o),Pe===o&&(Pe=null),Pe!==o?(ae=p(ae,me,Pe),ne=ae):(te=ne,ne=o)):(te=ne,ne=o)):(te=ne,ne=o)}else te=ne,ne=o;return ne}function rt(){var ne,ae;return ne=te,g.test(s.charAt(te))?(ae=s.charAt(te),te++):(ae=o,yt(m)),ae!==o&&(ae=y()),ne=ae,ne}function je(){var ne,ae,_e,me;if(ne=te,b.test(s.charAt(te))?(ae=s.charAt(te),te++):(ae=o,yt(w)),ae!==o){for(_e=[],me=Mt();me!==o;)_e.push(me),me=Mt();_e!==o?(me=Tt(),me!==o?(ae=E(ae,me),ne=ae):(te=ne,ne=o)):(te=ne,ne=o)}else te=ne,ne=o;return ne}function Tt(){var ne,ae,_e,me,Pe,Ze;if(ne=te,ae=fi(),ae!==o){for(_e=[],me=te,Pe=de(),Pe===o&&(Pe=null),Pe!==o?(Ze=fi(),Ze!==o?(Pe=[Pe,Ze],me=Pe):(te=me,me=o)):(te=me,me=o);me!==o;)_e.push(me),me=te,Pe=de(),Pe===o&&(Pe=null),Pe!==o?(Ze=fi(),Ze!==o?(Pe=[Pe,Ze],me=Pe):(te=me,me=o)):(te=me,me=o);_e!==o?(ae=h(ae,_e),ne=ae):(te=ne,ne=o)}else te=ne,ne=o;return ne}function Ft(){var ne,ae,_e,me;if(ne=te,M.test(s.charAt(te))?(ae=s.charAt(te),te++):(ae=o,yt(A)),ae!==o){for(_e=[],me=Mt();me!==o;)_e.push(me),me=Mt();_e!==o?(me=wi(),me!==o?(ae=P(ae,me),ne=ae):(te=ne,ne=o)):(te=ne,ne=o)}else te=ne,ne=o;return ne}function wi(){var ne,ae,_e,me,Pe,Ze;if(ne=te,ae=ji(),ae!==o){for(_e=[],me=te,Pe=de(),Pe===o&&(Pe=null),Pe!==o?(Ze=ji(),Ze!==o?(Pe=[Pe,Ze],me=Pe):(te=me,me=o)):(te=me,me=o);me!==o;)_e.push(me),me=te,Pe=de(),Pe===o&&(Pe=null),Pe!==o?(Ze=ji(),Ze!==o?(Pe=[Pe,Ze],me=Pe):(te=me,me=o)):(te=me,me=o);_e!==o?(ae=h(ae,_e),ne=ae):(te=ne,ne=o)}else te=ne,ne=o;return ne}function ti(){var ne,ae,_e,me;if(ne=te,C.test(s.charAt(te))?(ae=s.charAt(te),te++):(ae=o,yt(R)),ae!==o){for(_e=[],me=Mt();me!==o;)_e.push(me),me=Mt();_e!==o?(me=wi(),me!==o?(ae=I(ae,me),ne=ae):(te=ne,ne=o)):(te=ne,ne=o)}else te=ne,ne=o;return ne}function Zi(){var ne,ae,_e,me;if(ne=te,k.test(s.charAt(te))?(ae=s.charAt(te),te++):(ae=o,yt(z)),ae!==o){for(_e=[],me=Mt();me!==o;)_e.push(me),me=Mt();_e!==o?(me=Xi(),me!==o?(ae=E(ae,me),ne=ae):(te=ne,ne=o)):(te=ne,ne=o)}else te=ne,ne=o;return ne}function Xi(){var ne,ae,_e,me,Pe,Ze;if(ne=te,ae=As(),ae!==o){for(_e=[],me=te,Pe=de(),Pe===o&&(Pe=null),Pe!==o?(Ze=As(),Ze!==o?(Pe=[Pe,Ze],me=Pe):(te=me,me=o)):(te=me,me=o);me!==o;)_e.push(me),me=te,Pe=de(),Pe===o&&(Pe=null),Pe!==o?(Ze=As(),Ze!==o?(Pe=[Pe,Ze],me=Pe):(te=me,me=o)):(te=me,me=o);_e!==o?(ae=h(ae,_e),ne=ae):(te=ne,ne=o)}else te=ne,ne=o;return ne}function As(){var ne,ae,_e,me,Pe,Ze;return ne=te,ae=fi(),ae!==o?(_e=de(),_e===o&&(_e=null),_e!==o?(me=fi(),me!==o?(Pe=de(),Pe===o&&(Pe=null),Pe!==o?(Ze=fi(),Ze!==o?(ae=V(ae,me,Ze),ne=ae):(te=ne,ne=o)):(te=ne,ne=o)):(te=ne,ne=o)):(te=ne,ne=o)):(te=ne,ne=o),ne}function Gr(){var ne,ae,_e,me;if(ne=te,F.test(s.charAt(te))?(ae=s.charAt(te),te++):(ae=o,yt($)),ae!==o){for(_e=[],me=Mt();me!==o;)_e.push(me),me=Mt();_e!==o?(me=Nn(),me!==o?(ae=E(ae,me),ne=ae):(te=ne,ne=o)):(te=ne,ne=o)}else te=ne,ne=o;return ne}function Nn(){var ne,ae,_e,me,Pe,Ze;if(ne=te,ae=us(),ae!==o){for(_e=[],me=te,Pe=de(),Pe===o&&(Pe=null),Pe!==o?(Ze=us(),Ze!==o?(Pe=[Pe,Ze],me=Pe):(te=me,me=o)):(te=me,me=o);me!==o;)_e.push(me),me=te,Pe=de(),Pe===o&&(Pe=null),Pe!==o?(Ze=us(),Ze!==o?(Pe=[Pe,Ze],me=Pe):(te=me,me=o)):(te=me,me=o);_e!==o?(ae=h(ae,_e),ne=ae):(te=ne,ne=o)}else te=ne,ne=o;return ne}function us(){var ne,ae,_e,me;return ne=te,ae=fi(),ae!==o?(_e=de(),_e===o&&(_e=null),_e!==o?(me=fi(),me!==o?(ae=K(ae,me),ne=ae):(te=ne,ne=o)):(te=ne,ne=o)):(te=ne,ne=o),ne}function ye(){var ne,ae,_e,me;if(ne=te,X.test(s.charAt(te))?(ae=s.charAt(te),te++):(ae=o,yt(U)),ae!==o){for(_e=[],me=Mt();me!==o;)_e.push(me),me=Mt();_e!==o?(me=Xe(),me!==o?(ae=E(ae,me),ne=ae):(te=ne,ne=o)):(te=ne,ne=o)}else te=ne,ne=o;return ne}function Xe(){var ne,ae,_e,me,Pe,Ze;if(ne=te,ae=ht(),ae!==o){for(_e=[],me=te,Pe=de(),Pe===o&&(Pe=null),Pe!==o?(Ze=ht(),Ze!==o?(Pe=[Pe,Ze],me=Pe):(te=me,me=o)):(te=me,me=o);me!==o;)_e.push(me),me=te,Pe=de(),Pe===o&&(Pe=null),Pe!==o?(Ze=ht(),Ze!==o?(Pe=[Pe,Ze],me=Pe):(te=me,me=o)):(te=me,me=o);_e!==o?(ae=h(ae,_e),ne=ae):(te=ne,ne=o)}else te=ne,ne=o;return ne}function ht(){var ne,ae,_e,me;return ne=te,ae=fi(),ae!==o?(_e=de(),_e===o&&(_e=null),_e!==o?(me=fi(),me!==o?(ae=Y(ae,me),ne=ae):(te=ne,ne=o)):(te=ne,ne=o)):(te=ne,ne=o),ne}function qe(){var ne,ae,_e,me;if(ne=te,Z.test(s.charAt(te))?(ae=s.charAt(te),te++):(ae=o,yt(j)),ae!==o){for(_e=[],me=Mt();me!==o;)_e.push(me),me=Mt();_e!==o?(me=gt(),me!==o?(ae=E(ae,me),ne=ae):(te=ne,ne=o)):(te=ne,ne=o)}else te=ne,ne=o;return ne}function gt(){var ne,ae,_e,me,Pe,Ze;if(ne=te,ae=fi(),ae!==o){for(_e=[],me=te,Pe=de(),Pe===o&&(Pe=null),Pe!==o?(Ze=fi(),Ze!==o?(Pe=[Pe,Ze],me=Pe):(te=me,me=o)):(te=me,me=o);me!==o;)_e.push(me),me=te,Pe=de(),Pe===o&&(Pe=null),Pe!==o?(Ze=fi(),Ze!==o?(Pe=[Pe,Ze],me=Pe):(te=me,me=o)):(te=me,me=o);_e!==o?(ae=h(ae,_e),ne=ae):(te=ne,ne=o)}else te=ne,ne=o;return ne}function Zt(){var ne,ae,_e,me;if(ne=te,ee.test(s.charAt(te))?(ae=s.charAt(te),te++):(ae=o,yt(pe)),ae!==o){for(_e=[],me=Mt();me!==o;)_e.push(me),me=Mt();_e!==o?(me=yi(),me!==o?(ae=E(ae,me),ne=ae):(te=ne,ne=o)):(te=ne,ne=o)}else te=ne,ne=o;return ne}function yi(){var ne,ae,_e,me,Pe,Ze;if(ne=te,ae=Ti(),ae!==o){for(_e=[],me=te,Pe=de(),Pe===o&&(Pe=null),Pe!==o?(Ze=Ti(),Ze!==o?(Pe=[Pe,Ze],me=Pe):(te=me,me=o)):(te=me,me=o);me!==o;)_e.push(me),me=te,Pe=de(),Pe===o&&(Pe=null),Pe!==o?(Ze=Ti(),Ze!==o?(Pe=[Pe,Ze],me=Pe):(te=me,me=o)):(te=me,me=o);_e!==o?(ae=h(ae,_e),ne=ae):(te=ne,ne=o)}else te=ne,ne=o;return ne}function Ti(){var ne,ae,_e,me,Pe,Ze,Qi,_i,nn,Sa,Hn,Eo;return ne=te,ae=vr(),ae!==o?(_e=de(),_e===o&&(_e=null),_e!==o?(me=vr(),me!==o?(Pe=de(),Pe===o&&(Pe=null),Pe!==o?(Ze=ji(),Ze!==o?(Qi=de(),Qi!==o?(_i=Vi(),_i!==o?(nn=de(),nn===o&&(nn=null),nn!==o?(Sa=Vi(),Sa!==o?(Hn=de(),Hn===o&&(Hn=null),Hn!==o?(Eo=fi(),Eo!==o?(ae=fe(ae,me,Ze,_i,Sa,Eo),ne=ae):(te=ne,ne=o)):(te=ne,ne=o)):(te=ne,ne=o)):(te=ne,ne=o)):(te=ne,ne=o)):(te=ne,ne=o)):(te=ne,ne=o)):(te=ne,ne=o)):(te=ne,ne=o)):(te=ne,ne=o)):(te=ne,ne=o),ne}function fi(){var ne,ae,_e,me;return ne=te,ae=ji(),ae!==o?(_e=de(),_e===o&&(_e=null),_e!==o?(me=ji(),me!==o?(ae=se(ae,me),ne=ae):(te=ne,ne=o)):(te=ne,ne=o)):(te=ne,ne=o),ne}function vr(){var ne,ae;return ne=te,ae=Je(),ae===o&&(ae=Dt()),ae!==o&&(ae=re(ae)),ne=ae,ne}function ji(){var ne,ae,_e,me;return ne=te,ae=te,_e=ft(),_e===o&&(_e=null),_e!==o?(me=Je(),me!==o?(_e=[_e,me],ae=_e):(te=ae,ae=o)):(te=ae,ae=o),ae===o&&(ae=te,_e=ft(),_e===o&&(_e=null),_e!==o?(me=Dt(),me!==o?(_e=[_e,me],ae=_e):(te=ae,ae=o)):(te=ae,ae=o)),ae!==o&&(ae=le(ae)),ne=ae,ne}function Vi(){var ne,ae;return ne=te,he.test(s.charAt(te))?(ae=s.charAt(te),te++):(ae=o,yt(ve)),ae!==o&&(ae=xe(ae)),ne=ae,ne}function de(){var ne,ae,_e,me,Pe;if(ne=te,ae=[],_e=Mt(),_e!==o)for(;_e!==o;)ae.push(_e),_e=Mt();else ae=o;if(ae!==o)if(_e=Ue(),_e===o&&(_e=null),_e!==o){for(me=[],Pe=Mt();Pe!==o;)me.push(Pe),Pe=Mt();me!==o?(ae=[ae,_e,me],ne=ae):(te=ne,ne=o)}else te=ne,ne=o;else te=ne,ne=o;if(ne===o){if(ne=te,ae=te,_e=Ue(),_e!==o){for(me=[],Pe=Mt();Pe!==o;)me.push(Pe),Pe=Mt();me!==o?(_e=[_e,me],ae=_e):(te=ae,ae=o)}else te=ae,ae=o;ae!==o&&(ae=Se()),ne=ae}return ne}function Ue(){var ne;return s.charCodeAt(te)===44?(ne=Ce,te++):(ne=o,yt(ce)),ne}function Je(){var ne,ae,_e,me;return ne=te,ae=te,_e=nt(),_e!==o?(me=Ie(),me===o&&(me=null),me!==o?(_e=[_e,me],ae=_e):(te=ae,ae=o)):(te=ae,ae=o),ae===o&&(ae=te,_e=Dt(),_e!==o?(me=Ie(),me!==o?(_e=[_e,me],ae=_e):(te=ae,ae=o)):(te=ae,ae=o)),ae!==o&&(ae=Fe(ae)),ne=ae,ne}function nt(){var ne,ae,_e,me,Pe;return ne=te,ae=te,_e=Dt(),_e===o&&(_e=null),_e!==o?(s.charCodeAt(te)===46?(me=De,te++):(me=o,yt(He)),me!==o?(Pe=Dt(),Pe!==o?(_e=[_e,me,Pe],ae=_e):(te=ae,ae=o)):(te=ae,ae=o)):(te=ae,ae=o),ae===o&&(ae=te,_e=Dt(),_e!==o?(s.charCodeAt(te)===46?(me=De,te++):(me=o,yt(He)),me!==o?(_e=[_e,me],ae=_e):(te=ae,ae=o)):(te=ae,ae=o)),ae!==o&&(ae=Fe(ae)),ne=ae,ne}function Ie(){var ne,ae,_e,me,Pe;return ne=te,ae=te,Be.test(s.charAt(te))?(_e=s.charAt(te),te++):(_e=o,yt($e)),_e!==o?(me=ft(),me===o&&(me=null),me!==o?(Pe=Dt(),Pe!==o?(_e=[_e,me,Pe],ae=_e):(te=ae,ae=o)):(te=ae,ae=o)):(te=ae,ae=o),ae!==o&&(ae=Fe(ae)),ne=ae,ne}function ft(){var ne;return ze.test(s.charAt(te))?(ne=s.charAt(te),te++):(ne=o,yt(it)),ne}function Dt(){var ne,ae,_e;if(ne=te,ae=[],wt.test(s.charAt(te))?(_e=s.charAt(te),te++):(_e=o,yt(ge)),_e!==o)for(;_e!==o;)ae.push(_e),wt.test(s.charAt(te))?(_e=s.charAt(te),te++):(_e=o,yt(ge));else ae=o;return ae!==o&&(ae=G(ae)),ne=ae,ne}function Mt(){var ne,ae;return ne=te,Q.test(s.charAt(te))?(ae=s.charAt(te),te++):(ae=o,yt(we)),ae!==o&&(ae=Se()),ne=ae,ne}function Vt(ne,ae){if(!ae)return[ne];for(var _e=[ne],me=0,Pe=ae.length;me<Pe;me++)_e[me+1]=ae[me][1];return _e}var di={m:"moveto",l:"lineto",h:"horizontal lineto",v:"vertical lineto",c:"curveto",s:"smooth curveto",q:"quadratic curveto",t:"smooth quadratic curveto",a:"elliptical arc",z:"closepath"};for(var si in di)di[si.toUpperCase()]=di[si];function Wt(ne,ae){ae||(ae=[{}]);for(var _e=ae.length;_e--;){var me={code:ne,command:di[ne]};ne==ne.toLowerCase()&&(me.relative=!0);for(var Pe in ae[_e])me[Pe]=ae[_e][Pe];ae[_e]=me}return ae}if(Te=c(),Te!==o&&te===s.length)return Te;throw Te!==o&&te<s.length&&yt(Qe()),Et(at,Le<s.length?s.charAt(Le):null,Le<s.length?_t(Le,Le+1):_t(Le,Le))}e.exports={SyntaxError:r,parse:n}}),Kue=$0((t,e)=>{var i=GVe().parse;i.parseSVG=i,i.makeAbsolute=r,e.exports=i;function r(n){var s,a={x:0,y:0},o={x:"x0",y:"y0",x1:"x0",y1:"y0",x2:"x0",y2:"y0"};return n.forEach(function(l){l.command==="moveto"&&(s=l),l.x0=a.x,l.y0=a.y;for(var c in o)c in l&&(l[c]+=l.relative?l[o[c]]:0);"x"in l||(l.x=a.x),"y"in l||(l.y=a.y),l.relative=!1,l.code=l.code.toUpperCase(),l.command=="closepath"&&(l.x=s.x,l.y=s.y),a=l}),n}}),WVe=$0((t,e)=>{e.exports=function(i,r){for(var n=i.split("."),s=r.split("."),a=0;a<3;a++){var o=Number(n[a]),l=Number(s[a]);if(o>l)return 1;if(l>o)return-1;if(!isNaN(o)&&isNaN(l))return 1;if(isNaN(o)&&!isNaN(l))return-1}return 0}}),S_="149",Jc={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},qVe=0,VK=1,XVe=2,zH=1,$Ve=2,GE=3,Ih=0,qa=1,jo=2,Hs=0,g0=1,HK=2,GK=3,WK=4,YVe=5,Aw=100,KVe=101,ZVe=102,qK=103,XK=104,QVe=200,JVe=201,e6e=202,t6e=203,Zue=204,Que=205,i6e=206,r6e=207,n6e=208,s6e=209,a6e=210,o6e=0,l6e=1,c6e=2,xj=3,u6e=4,h6e=5,d6e=6,f6e=7,Jue=0,p6e=1,m6e=2,Gd=0,g6e=1,v6e=2,y6e=3,x6e=4,b6e=5,ehe=300,L0=301,k0=302,bj=303,wj=304,DT=306,Ep=1e3,kn=1001,_j=1002,mr=1003,$K=1004,CB=1005,nr=1006,w6e=1007,j1=1008,Ho=1009,_6e=1010,S6e=1011,the=1012,E6e=1013,Ap=1014,cn=1015,qp=1016,A6e=1017,M6e=1018,v0=1020,T6e=1021,Vn=1023,C6e=1024,P6e=1025,y0=1026,N0=1027,tI=1028,R6e=1029,BD=1030,I6e=1031,ihe=1033,PB=33776,RB=33777,IB=33778,DB=33779,YK=35840,KK=35841,ZK=35842,QK=35843,D6e=36196,JK=37492,eZ=37496,tZ=37808,iZ=37809,rZ=37810,nZ=37811,sZ=37812,aZ=37813,oZ=37814,lZ=37815,cZ=37816,uZ=37817,hZ=37818,dZ=37819,fZ=37820,pZ=37821,OB=36492,O6e=36283,mZ=36284,gZ=36285,vZ=36286,rhe=2200,nhe=2201,jH=2202,FD=2300,zD=2301,LB=2302,Xw=2400,$w=2401,jD=2402,VH=2500,L6e=2501,Dh=3e3,er=3001,em=3200,she=3201,k6e=0,N6e=1,yd="srgb",VD="srgb-linear",kB=7680,U6e=519,Sj=35044,B6e=35048,Ej="300 es",Aj=1035,Qa=class{addEventListener(t,e){this._listeners===void 0&&(this._listeners={});let i=this._listeners;i[t]===void 0&&(i[t]=[]),i[t].indexOf(e)===-1&&i[t].push(e)}hasEventListener(t,e){if(this._listeners===void 0)return!1;let i=this._listeners;return i[t]!==void 0&&i[t].indexOf(e)!==-1}removeEventListener(t,e){if(this._listeners===void 0)return;let i=this._listeners[t];if(i!==void 0){let r=i.indexOf(e);r!==-1&&i.splice(r,1)}}dispatchEvent(t){if(this._listeners===void 0)return;let e=this._listeners[t.type];if(e!==void 0){t.target=this;let i=e.slice(0);for(let r=0,n=i.length;r<n;r++)i[r].call(this,t);t.target=null}}},ko=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"],yZ=1234567,MA=Math.PI/180,TM=180/Math.PI;function yu(){let t=Math.random()*4294967295|0,e=Math.random()*4294967295|0,i=Math.random()*4294967295|0,r=Math.random()*4294967295|0;return(ko[t&255]+ko[t>>8&255]+ko[t>>16&255]+ko[t>>24&255]+"-"+ko[e&255]+ko[e>>8&255]+"-"+ko[e>>16&15|64]+ko[e>>24&255]+"-"+ko[i&63|128]+ko[i>>8&255]+"-"+ko[i>>16&255]+ko[i>>24&255]+ko[r&255]+ko[r>>8&255]+ko[r>>16&255]+ko[r>>24&255]).toLowerCase()}function Fs(t,e,i){return Math.max(e,Math.min(i,t))}function HH(t,e){return(t%e+e)%e}function F6e(t,e,i,r,n){return r+(t-e)*(n-r)/(i-e)}function z6e(t,e,i){return t!==e?(i-t)/(e-t):0}function TA(t,e,i){return(1-i)*t+i*e}function j6e(t,e,i,r){return TA(t,e,1-Math.exp(-i*r))}function V6e(t,e=1){return e-Math.abs(HH(t,e*2)-e)}function H6e(t,e,i){return t<=e?0:t>=i?1:(t=(t-e)/(i-e),t*t*(3-2*t))}function G6e(t,e,i){return t<=e?0:t>=i?1:(t=(t-e)/(i-e),t*t*t*(t*(t*6-15)+10))}function W6e(t,e){return t+Math.floor(Math.random()*(e-t+1))}function q6e(t,e){return t+Math.random()*(e-t)}function X6e(t){return t*(.5-Math.random())}function $6e(t){t!==void 0&&(yZ=t);let e=yZ+=1831565813;return e=Math.imul(e^e>>>15,e|1),e^=e+Math.imul(e^e>>>7,e|61),((e^e>>>14)>>>0)/4294967296}function Y6e(t){return t*MA}function K6e(t){return t*TM}function Mj(t){return(t&t-1)===0&&t!==0}function ahe(t){return Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))}function HD(t){return Math.pow(2,Math.floor(Math.log(t)/Math.LN2))}function Z6e(t,e,i,r,n){let s=Math.cos,a=Math.sin,o=s(i/2),l=a(i/2),c=s((e+r)/2),u=a((e+r)/2),h=s((e-r)/2),d=a((e-r)/2),f=s((r-e)/2),p=a((r-e)/2);switch(n){case"XYX":t.set(o*u,l*h,l*d,o*c);break;case"YZY":t.set(l*d,o*u,l*h,o*c);break;case"ZXZ":t.set(l*h,l*d,o*u,o*c);break;case"XZX":t.set(o*u,l*p,l*f,o*c);break;case"YXY":t.set(l*f,o*u,l*p,o*c);break;case"ZYZ":t.set(l*p,l*f,o*u,o*c);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+n)}}function Mp(t,e){switch(e.constructor){case Float32Array:return t;case Uint16Array:return t/65535;case Uint8Array:return t/255;case Int16Array:return Math.max(t/32767,-1);case Int8Array:return Math.max(t/127,-1);default:throw new Error("Invalid component type.")}}function Sn(t,e){switch(e.constructor){case Float32Array:return t;case Uint16Array:return Math.round(t*65535);case Uint8Array:return Math.round(t*255);case Int16Array:return Math.round(t*32767);case Int8Array:return Math.round(t*127);default:throw new Error("Invalid component type.")}}var Ht=Object.freeze({__proto__:null,DEG2RAD:MA,RAD2DEG:TM,ceilPowerOfTwo:ahe,clamp:Fs,damp:j6e,degToRad:Y6e,denormalize:Mp,euclideanModulo:HH,floorPowerOfTwo:HD,generateUUID:yu,inverseLerp:z6e,isPowerOfTwo:Mj,lerp:TA,mapLinear:F6e,normalize:Sn,pingpong:V6e,radToDeg:K6e,randFloat:q6e,randFloatSpread:X6e,randInt:W6e,seededRandom:$6e,setQuaternionFromProperEuler:Z6e,smootherstep:G6e,smoothstep:H6e}),Ae=class{constructor(t=0,e=0){Ae.prototype.isVector2=!0,this.x=t,this.y=e}get width(){return this.x}set width(t){this.x=t}get height(){return this.y}set height(t){this.y=t}set(t,e){return this.x=t,this.y=e,this}setScalar(t){return this.x=t,this.y=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y)}copy(t){return this.x=t.x,this.y=t.y,this}add(t){return this.x+=t.x,this.y+=t.y,this}addScalar(t){return this.x+=t,this.y+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this}sub(t){return this.x-=t.x,this.y-=t.y,this}subScalar(t){return this.x-=t,this.y-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this}multiply(t){return this.x*=t.x,this.y*=t.y,this}multiplyScalar(t){return this.x*=t,this.y*=t,this}divide(t){return this.x/=t.x,this.y/=t.y,this}divideScalar(t){return this.multiplyScalar(1/t)}applyMatrix3(t){let e=this.x,i=this.y,r=t.elements;return this.x=r[0]*e+r[3]*i+r[6],this.y=r[1]*e+r[4]*i+r[7],this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this}clampLength(t,e){let i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(t,Math.min(e,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(t){return this.x*t.x+this.y*t.y}cross(t){return this.x*t.y-this.y*t.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){let e=this.x-t.x,i=this.y-t.y;return e*e+i*i}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this}lerpVectors(t,e,i){return this.x=t.x+(e.x-t.x)*i,this.y=t.y+(e.y-t.y)*i,this}equals(t){return t.x===this.x&&t.y===this.y}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t}fromBufferAttribute(t,e){return this.x=t.getX(e),this.y=t.getY(e),this}rotateAround(t,e){let i=Math.cos(e),r=Math.sin(e),n=this.x-t.x,s=this.y-t.y;return this.x=n*i-s*r+t.x,this.y=n*r+s*i+t.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}},Vs=class{constructor(){Vs.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1]}set(t,e,i,r,n,s,a,o,l){let c=this.elements;return c[0]=t,c[1]=r,c[2]=a,c[3]=e,c[4]=n,c[5]=o,c[6]=i,c[7]=s,c[8]=l,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(t){let e=this.elements,i=t.elements;return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],this}extractBasis(t,e,i){return t.setFromMatrix3Column(this,0),e.setFromMatrix3Column(this,1),i.setFromMatrix3Column(this,2),this}setFromMatrix4(t){let e=t.elements;return this.set(e[0],e[4],e[8],e[1],e[5],e[9],e[2],e[6],e[10]),this}multiply(t){return this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,e){let i=t.elements,r=e.elements,n=this.elements,s=i[0],a=i[3],o=i[6],l=i[1],c=i[4],u=i[7],h=i[2],d=i[5],f=i[8],p=r[0],g=r[3],m=r[6],y=r[1],b=r[4],w=r[7],E=r[2],M=r[5],A=r[8];return n[0]=s*p+a*y+o*E,n[3]=s*g+a*b+o*M,n[6]=s*m+a*w+o*A,n[1]=l*p+c*y+u*E,n[4]=l*g+c*b+u*M,n[7]=l*m+c*w+u*A,n[2]=h*p+d*y+f*E,n[5]=h*g+d*b+f*M,n[8]=h*m+d*w+f*A,this}multiplyScalar(t){let e=this.elements;return e[0]*=t,e[3]*=t,e[6]*=t,e[1]*=t,e[4]*=t,e[7]*=t,e[2]*=t,e[5]*=t,e[8]*=t,this}determinant(){let t=this.elements,e=t[0],i=t[1],r=t[2],n=t[3],s=t[4],a=t[5],o=t[6],l=t[7],c=t[8];return e*s*c-e*a*l-i*n*c+i*a*o+r*n*l-r*s*o}invert(){let t=this.elements,e=t[0],i=t[1],r=t[2],n=t[3],s=t[4],a=t[5],o=t[6],l=t[7],c=t[8],u=c*s-a*l,h=a*o-c*n,d=l*n-s*o,f=e*u+i*h+r*d;if(f===0)return this.set(0,0,0,0,0,0,0,0,0);let p=1/f;return t[0]=u*p,t[1]=(r*l-c*i)*p,t[2]=(a*i-r*s)*p,t[3]=h*p,t[4]=(c*e-r*o)*p,t[5]=(r*n-a*e)*p,t[6]=d*p,t[7]=(i*o-l*e)*p,t[8]=(s*e-i*n)*p,this}transpose(){let t,e=this.elements;return t=e[1],e[1]=e[3],e[3]=t,t=e[2],e[2]=e[6],e[6]=t,t=e[5],e[5]=e[7],e[7]=t,this}getNormalMatrix(t){return this.setFromMatrix4(t).invert().transpose()}transposeIntoArray(t){let e=this.elements;return t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8],this}setUvTransform(t,e,i,r,n,s,a){let o=Math.cos(n),l=Math.sin(n);return this.set(i*o,i*l,-i*(o*s+l*a)+s+t,-r*l,r*o,-r*(-l*s+o*a)+a+e,0,0,1),this}scale(t,e){return this.premultiply(NB.makeScale(t,e)),this}rotate(t){return this.premultiply(NB.makeRotation(-t)),this}translate(t,e){return this.premultiply(NB.makeTranslation(t,e)),this}makeTranslation(t,e){return this.set(1,0,t,0,1,e,0,0,1),this}makeRotation(t){let e=Math.cos(t),i=Math.sin(t);return this.set(e,-i,0,i,e,0,0,0,1),this}makeScale(t,e){return this.set(t,0,0,0,e,0,0,0,1),this}equals(t){let e=this.elements,i=t.elements;for(let r=0;r<9;r++)if(e[r]!==i[r])return!1;return!0}fromArray(t,e=0){for(let i=0;i<9;i++)this.elements[i]=t[i+e];return this}toArray(t=[],e=0){let i=this.elements;return t[e]=i[0],t[e+1]=i[1],t[e+2]=i[2],t[e+3]=i[3],t[e+4]=i[4],t[e+5]=i[5],t[e+6]=i[6],t[e+7]=i[7],t[e+8]=i[8],t}clone(){return new this.constructor().fromArray(this.elements)}},NB=new Vs;function ohe(t){for(let e=t.length-1;e>=0;--e)if(t[e]>=65535)return!0;return!1}var Q6e={Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array};function fP(t,e){return new Q6e[t](e)}function CM(t){return document.createElementNS("http://www.w3.org/1999/xhtml",t)}function J6e(t,e,i){return new Promise(function(r,n){function s(){switch(t.clientWaitSync(e,t.SYNC_FLUSH_COMMANDS_BIT,0)){case t.WAIT_FAILED:n();break;case t.TIMEOUT_EXPIRED:setTimeout(s,i);break;default:r()}}setTimeout(s,i)})}function x0(t){return t<.04045?t*.0773993808:Math.pow(t*.9478672986+.0521327014,2.4)}function iI(t){return t<.0031308?t*12.92:1.055*Math.pow(t,.41666)-.055}var UB={[yd]:{[VD]:x0},[VD]:{[yd]:iI}},sl={legacyMode:!0,get workingColorSpace(){return VD},set workingColorSpace(t){console.warn("THREE.ColorManagement: .workingColorSpace is readonly.")},convert:function(t,e,i){if(this.legacyMode||e===i||!e||!i)return t;if(UB[e]&&UB[e][i]!==void 0){let r=UB[e][i];return t.r=r(t.r),t.g=r(t.g),t.b=r(t.b),t}throw new Error("Unsupported color space conversion.")},fromWorkingColorSpace:function(t,e){return this.convert(t,this.workingColorSpace,e)},toWorkingColorSpace:function(t,e){return this.convert(t,e,this.workingColorSpace)}},lhe={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},ia={r:0,g:0,b:0},th={h:0,s:0,l:0},pP={h:0,s:0,l:0};function BB(t,e,i){return i<0&&(i+=1),i>1&&(i-=1),i<1/6?t+(e-t)*6*i:i<1/2?e:i<2/3?t+(e-t)*6*(2/3-i):t}function mP(t,e){return e.r=t.r,e.g=t.g,e.b=t.b,e}var Ai=class{constructor(t,e,i){return this.isColor=!0,this.r=1,this.g=1,this.b=1,e===void 0&&i===void 0?this.set(t):this.setRGB(t,e,i)}set(t){return t&&t.isColor?this.copy(t):typeof t=="number"?this.setHex(t):typeof t=="string"&&this.setStyle(t),this}setScalar(t){return this.r=t,this.g=t,this.b=t,this}setHex(t,e=yd){return t=Math.floor(t),this.r=(t>>16&255)/255,this.g=(t>>8&255)/255,this.b=(t&255)/255,sl.toWorkingColorSpace(this,e),this}setRGB(t,e,i,r=sl.workingColorSpace){return this.r=t,this.g=e,this.b=i,sl.toWorkingColorSpace(this,r),this}setHSL(t,e,i,r=sl.workingColorSpace){if(t=HH(t,1),e=Fs(e,0,1),i=Fs(i,0,1),e===0)this.r=this.g=this.b=i;else{let n=i<=.5?i*(1+e):i+e-i*e,s=2*i-n;this.r=BB(s,n,t+1/3),this.g=BB(s,n,t),this.b=BB(s,n,t-1/3)}return sl.toWorkingColorSpace(this,r),this}setStyle(t,e=yd){function i(n){n!==void 0&&parseFloat(n)<1&&console.warn("THREE.Color: Alpha component of "+t+" will be ignored.")}let r;if(r=/^((?:rgb|hsl)a?)\(([^\)]*)\)/.exec(t)){let n,s=r[1],a=r[2];switch(s){case"rgb":case"rgba":if(n=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return this.r=Math.min(255,parseInt(n[1],10))/255,this.g=Math.min(255,parseInt(n[2],10))/255,this.b=Math.min(255,parseInt(n[3],10))/255,sl.toWorkingColorSpace(this,e),i(n[4]),this;if(n=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return this.r=Math.min(100,parseInt(n[1],10))/100,this.g=Math.min(100,parseInt(n[2],10))/100,this.b=Math.min(100,parseInt(n[3],10))/100,sl.toWorkingColorSpace(this,e),i(n[4]),this;break;case"hsl":case"hsla":if(n=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a)){let o=parseFloat(n[1])/360,l=parseFloat(n[2])/100,c=parseFloat(n[3])/100;return i(n[4]),this.setHSL(o,l,c,e)}break}}else if(r=/^\#([A-Fa-f\d]+)$/.exec(t)){let n=r[1],s=n.length;if(s===3)return this.r=parseInt(n.charAt(0)+n.charAt(0),16)/255,this.g=parseInt(n.charAt(1)+n.charAt(1),16)/255,this.b=parseInt(n.charAt(2)+n.charAt(2),16)/255,sl.toWorkingColorSpace(this,e),this;if(s===6)return this.r=parseInt(n.charAt(0)+n.charAt(1),16)/255,this.g=parseInt(n.charAt(2)+n.charAt(3),16)/255,this.b=parseInt(n.charAt(4)+n.charAt(5),16)/255,sl.toWorkingColorSpace(this,e),this}return t&&t.length>0?this.setColorName(t,e):this}setColorName(t,e=yd){let i=lhe[t.toLowerCase()];return i!==void 0?this.setHex(i,e):console.warn("THREE.Color: Unknown color "+t),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(t){return this.r=t.r,this.g=t.g,this.b=t.b,this}copySRGBToLinear(t){return this.r=x0(t.r),this.g=x0(t.g),this.b=x0(t.b),this}copyLinearToSRGB(t){return this.r=iI(t.r),this.g=iI(t.g),this.b=iI(t.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(t=yd){return sl.fromWorkingColorSpace(mP(this,ia),t),Fs(ia.r*255,0,255)<<16^Fs(ia.g*255,0,255)<<8^Fs(ia.b*255,0,255)<<0}getHexString(t=yd){return("000000"+this.getHex(t).toString(16)).slice(-6)}getHSL(t,e=sl.workingColorSpace){sl.fromWorkingColorSpace(mP(this,ia),e);let i=ia.r,r=ia.g,n=ia.b,s=Math.max(i,r,n),a=Math.min(i,r,n),o,l,c=(a+s)/2;if(a===s)o=0,l=0;else{let u=s-a;switch(l=c<=.5?u/(s+a):u/(2-s-a),s){case i:o=(r-n)/u+(r<n?6:0);break;case r:o=(n-i)/u+2;break;case n:o=(i-r)/u+4;break}o/=6}return t.h=o,t.s=l,t.l=c,t}getRGB(t,e=sl.workingColorSpace){return sl.fromWorkingColorSpace(mP(this,ia),e),t.r=ia.r,t.g=ia.g,t.b=ia.b,t}getStyle(t=yd){return sl.fromWorkingColorSpace(mP(this,ia),t),t!==yd?`color(${t} ${ia.r} ${ia.g} ${ia.b})`:`rgb(${ia.r*255|0},${ia.g*255|0},${ia.b*255|0})`}offsetHSL(t,e,i){return this.getHSL(th),th.h+=t,th.s+=e,th.l+=i,this.setHSL(th.h,th.s,th.l),this}add(t){return this.r+=t.r,this.g+=t.g,this.b+=t.b,this}addColors(t,e){return this.r=t.r+e.r,this.g=t.g+e.g,this.b=t.b+e.b,this}addScalar(t){return this.r+=t,this.g+=t,this.b+=t,this}sub(t){return this.r=Math.max(0,this.r-t.r),this.g=Math.max(0,this.g-t.g),this.b=Math.max(0,this.b-t.b),this}multiply(t){return this.r*=t.r,this.g*=t.g,this.b*=t.b,this}multiplyScalar(t){return this.r*=t,this.g*=t,this.b*=t,this}lerp(t,e){return this.r+=(t.r-this.r)*e,this.g+=(t.g-this.g)*e,this.b+=(t.b-this.b)*e,this}lerpColors(t,e,i){return this.r=t.r+(e.r-t.r)*i,this.g=t.g+(e.g-t.g)*i,this.b=t.b+(e.b-t.b)*i,this}lerpHSL(t,e){this.getHSL(th),t.getHSL(pP);let i=TA(th.h,pP.h,e),r=TA(th.s,pP.s,e),n=TA(th.l,pP.l,e);return this.setHSL(i,r,n),this}equals(t){return t.r===this.r&&t.g===this.g&&t.b===this.b}fromArray(t,e=0){return this.r=t[e],this.g=t[e+1],this.b=t[e+2],this}toArray(t=[],e=0){return t[e]=this.r,t[e+1]=this.g,t[e+2]=this.b,t}fromBufferAttribute(t,e){return this.r=t.getX(e),this.g=t.getY(e),this.b=t.getZ(e),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}};Ai.NAMES=lhe;var jb,che=class{static getDataURL(t){if(/^data:/i.test(t.src)||typeof HTMLCanvasElement>"u")return t.src;let e;if(t instanceof HTMLCanvasElement)e=t;else{jb===void 0&&(jb=CM("canvas")),jb.width=t.width,jb.height=t.height;let i=jb.getContext("2d");t instanceof ImageData?i.putImageData(t,0,0):i.drawImage(t,0,0,t.width,t.height),e=jb}return e.width>2048||e.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",t),e.toDataURL("image/jpeg",.6)):e.toDataURL("image/png")}static sRGBToLinear(t){if(typeof HTMLImageElement<"u"&&t instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&t instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&t instanceof ImageBitmap){let e=CM("canvas");e.width=t.width,e.height=t.height;let i=e.getContext("2d");i.drawImage(t,0,0,t.width,t.height);let r=i.getImageData(0,0,t.width,t.height),n=r.data;for(let s=0;s<n.length;s++)n[s]=x0(n[s]/255)*255;return i.putImageData(r,0,0),e}else if(t.data){let e=t.data.slice(0);for(let i=0;i<e.length;i++)e instanceof Uint8Array||e instanceof Uint8ClampedArray?e[i]=Math.floor(x0(e[i]/255)*255):e[i]=x0(e[i]);return{data:e,width:t.width,height:t.height}}else return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),t}},uhe=class{constructor(t=null){this.isSource=!0,this.uuid=yu(),this.data=t,this.version=0}set needsUpdate(t){t===!0&&this.version++}toJSON(t){let e=t===void 0||typeof t=="string";if(!e&&t.images[this.uuid]!==void 0)return t.images[this.uuid];let i={uuid:this.uuid,url:""},r=this.data;if(r!==null){let n;if(Array.isArray(r)){n=[];for(let s=0,a=r.length;s<a;s++)r[s].isDataTexture?n.push(FB(r[s].image)):n.push(FB(r[s]))}else n=FB(r);i.url=n}return e||(t.images[this.uuid]=i),i}};function FB(t){return typeof HTMLImageElement<"u"&&t instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&t instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&t instanceof ImageBitmap?che.getDataURL(t):t.data?{data:Array.from(t.data),width:t.width,height:t.height,type:t.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}var eHe=0,Kn=class extends Qa{constructor(t=Kn.DEFAULT_IMAGE,e=Kn.DEFAULT_MAPPING,i=kn,r=kn,n=nr,s=j1,a=Vn,o=Ho,l=Kn.DEFAULT_ANISOTROPY,c=Dh){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:eHe++}),this.uuid=yu(),this.name="",this.source=new uhe(t),this.mipmaps=[],this.mapping=e,this.wrapS=i,this.wrapT=r,this.magFilter=n,this.minFilter=s,this.anisotropy=l,this.format=a,this.internalFormat=null,this.type=o,this.offset=new Ae(0,0),this.repeat=new Ae(1,1),this.center=new Ae(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new Vs,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=c,this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.needsPMREMUpdate=!1}get image(){return this.source.data}set image(t){this.source.data=t}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return new this.constructor().copy(this)}copy(t){return this.name=t.name,this.source=t.source,this.mipmaps=t.mipmaps.slice(0),this.mapping=t.mapping,this.wrapS=t.wrapS,this.wrapT=t.wrapT,this.magFilter=t.magFilter,this.minFilter=t.minFilter,this.anisotropy=t.anisotropy,this.format=t.format,this.internalFormat=t.internalFormat,this.type=t.type,this.offset.copy(t.offset),this.repeat.copy(t.repeat),this.center.copy(t.center),this.rotation=t.rotation,this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrix.copy(t.matrix),this.generateMipmaps=t.generateMipmaps,this.premultiplyAlpha=t.premultiplyAlpha,this.flipY=t.flipY,this.unpackAlignment=t.unpackAlignment,this.encoding=t.encoding,this.userData=JSON.parse(JSON.stringify(t.userData)),this.needsUpdate=!0,this}toJSON(t){let e=t===void 0||typeof t=="string";if(!e&&t.textures[this.uuid]!==void 0)return t.textures[this.uuid];let i={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(t).uuid,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,type:this.type,encoding:this.encoding,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(i.userData=this.userData),e||(t.textures[this.uuid]=i),i}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(t){if(this.mapping!==ehe)return t;if(t.applyMatrix3(this.matrix),t.x<0||t.x>1)switch(this.wrapS){case Ep:t.x=t.x-Math.floor(t.x);break;case kn:t.x=t.x<0?0:1;break;case _j:Math.abs(Math.floor(t.x)%2)===1?t.x=Math.ceil(t.x)-t.x:t.x=t.x-Math.floor(t.x);break}if(t.y<0||t.y>1)switch(this.wrapT){case Ep:t.y=t.y-Math.floor(t.y);break;case kn:t.y=t.y<0?0:1;break;case _j:Math.abs(Math.floor(t.y)%2)===1?t.y=Math.ceil(t.y)-t.y:t.y=t.y-Math.floor(t.y);break}return this.flipY&&(t.y=1-t.y),t}set needsUpdate(t){t===!0&&(this.version++,this.source.needsUpdate=!0)}};Kn.DEFAULT_IMAGE=null;Kn.DEFAULT_MAPPING=ehe;Kn.DEFAULT_ANISOTROPY=1;var Ui=class{constructor(t=0,e=0,i=0,r=1){Ui.prototype.isVector4=!0,this.x=t,this.y=e,this.z=i,this.w=r}get width(){return this.z}set width(t){this.z=t}get height(){return this.w}set height(t){this.w=t}set(t,e,i,r){return this.x=t,this.y=e,this.z=i,this.w=r,this}setScalar(t){return this.x=t,this.y=t,this.z=t,this.w=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setW(t){return this.w=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;case 3:this.w=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w!==void 0?t.w:1,this}add(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this.w+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this.w=t.w+e.w,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this.w+=t.w*e,this}sub(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this.w-=t.w,this}subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this.w-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this.w=t.w-e.w,this}multiply(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this.w*=t.w,this}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this}applyMatrix4(t){let e=this.x,i=this.y,r=this.z,n=this.w,s=t.elements;return this.x=s[0]*e+s[4]*i+s[8]*r+s[12]*n,this.y=s[1]*e+s[5]*i+s[9]*r+s[13]*n,this.z=s[2]*e+s[6]*i+s[10]*r+s[14]*n,this.w=s[3]*e+s[7]*i+s[11]*r+s[15]*n,this}divideScalar(t){return this.multiplyScalar(1/t)}setAxisAngleFromQuaternion(t){this.w=2*Math.acos(t.w);let e=Math.sqrt(1-t.w*t.w);return e<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=t.x/e,this.y=t.y/e,this.z=t.z/e),this}setAxisAngleFromRotationMatrix(t){let e,i,r,n,s=t.elements,a=s[0],o=s[4],l=s[8],c=s[1],u=s[5],h=s[9],d=s[2],f=s[6],p=s[10];if(Math.abs(o-c)<.01&&Math.abs(l-d)<.01&&Math.abs(h-f)<.01){if(Math.abs(o+c)<.1&&Math.abs(l+d)<.1&&Math.abs(h+f)<.1&&Math.abs(a+u+p-3)<.1)return this.set(1,0,0,0),this;e=Math.PI;let m=(a+1)/2,y=(u+1)/2,b=(p+1)/2,w=(o+c)/4,E=(l+d)/4,M=(h+f)/4;return m>y&&m>b?m<.01?(i=0,r=.707106781,n=.707106781):(i=Math.sqrt(m),r=w/i,n=E/i):y>b?y<.01?(i=.707106781,r=0,n=.707106781):(r=Math.sqrt(y),i=w/r,n=M/r):b<.01?(i=.707106781,r=.707106781,n=0):(n=Math.sqrt(b),i=E/n,r=M/n),this.set(i,r,n,e),this}let g=Math.sqrt((f-h)*(f-h)+(l-d)*(l-d)+(c-o)*(c-o));return Math.abs(g)<.001&&(g=1),this.x=(f-h)/g,this.y=(l-d)/g,this.z=(c-o)/g,this.w=Math.acos((a+u+p-1)/2),this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this.w=Math.min(this.w,t.w),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this.w=Math.max(this.w,t.w),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this.w=Math.max(t.w,Math.min(e.w,this.w)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this.z=Math.max(t,Math.min(e,this.z)),this.w=Math.max(t,Math.min(e,this.w)),this}clampLength(t,e){let i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(t,Math.min(e,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this.w+=(t.w-this.w)*e,this}lerpVectors(t,e,i){return this.x=t.x+(e.x-t.x)*i,this.y=t.y+(e.y-t.y)*i,this.z=t.z+(e.z-t.z)*i,this.w=t.w+(e.w-t.w)*i,this}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z&&t.w===this.w}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this.z=t[e+2],this.w=t[e+3],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t[e+3]=this.w,t}fromBufferAttribute(t,e){return this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this.w=t.getW(e),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}},Mr=class extends Qa{constructor(t=1,e=1,i={}){super(),this.isWebGLRenderTarget=!0,this.width=t,this.height=e,this.depth=1,this.scissor=new Ui(0,0,t,e),this.scissorTest=!1,this.viewport=new Ui(0,0,t,e);let r={width:t,height:e,depth:1};this.texture=new Kn(r,i.mapping,i.wrapS,i.wrapT,i.magFilter,i.minFilter,i.format,i.type,i.anisotropy,i.encoding),this.texture.isRenderTargetTexture=!0,this.texture.flipY=!1,this.texture.generateMipmaps=i.generateMipmaps!==void 0?i.generateMipmaps:!1,this.texture.internalFormat=i.internalFormat!==void 0?i.internalFormat:null,this.texture.minFilter=i.minFilter!==void 0?i.minFilter:nr,this.depthBuffer=i.depthBuffer!==void 0?i.depthBuffer:!0,this.stencilBuffer=i.stencilBuffer!==void 0?i.stencilBuffer:!1,this.depthTexture=i.depthTexture!==void 0?i.depthTexture:null,this.samples=i.samples!==void 0?i.samples:0}setSize(t,e,i=1){(this.width!==t||this.height!==e||this.depth!==i)&&(this.width=t,this.height=e,this.depth=i,this.texture.image.width=t,this.texture.image.height=e,this.texture.image.depth=i,this.dispose()),this.viewport.set(0,0,t,e),this.scissor.set(0,0,t,e)}clone(){return new this.constructor().copy(this)}copy(t){this.width=t.width,this.height=t.height,this.depth=t.depth,this.viewport.copy(t.viewport),this.texture=t.texture.clone(),this.texture.isRenderTargetTexture=!0;let e=Object.assign({},t.texture.image);return this.texture.source=new uhe(e),this.depthBuffer=t.depthBuffer,this.stencilBuffer=t.stencilBuffer,t.depthTexture!==null&&(this.depthTexture=t.depthTexture.clone()),this.samples=t.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}},hhe=class extends Kn{constructor(t=null,e=1,i=1,r=1){super(null),this.isDataArrayTexture=!0,this.image={data:t,width:e,height:i,depth:r},this.magFilter=mr,this.minFilter=mr,this.wrapR=kn,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}},tHe=class extends Kn{constructor(t=null,e=1,i=1,r=1){super(null),this.isData3DTexture=!0,this.image={data:t,width:e,height:i,depth:r},this.magFilter=mr,this.minFilter=mr,this.wrapR=kn,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}},dhe=class extends Mr{constructor(t=1,e=1,i=1,r={}){super(t,e,r),this.isWebGLMultipleRenderTargets=!0;let n=this.texture;this.texture=[];for(let s=0;s<i;s++)this.texture[s]=n.clone(),this.texture[s].isRenderTargetTexture=!0}setSize(t,e,i=1){if(this.width!==t||this.height!==e||this.depth!==i){this.width=t,this.height=e,this.depth=i;for(let r=0,n=this.texture.length;r<n;r++)this.texture[r].image.width=t,this.texture[r].image.height=e,this.texture[r].image.depth=i;this.dispose()}return this.viewport.set(0,0,t,e),this.scissor.set(0,0,t,e),this}copy(t){this.dispose(),this.width=t.width,this.height=t.height,this.depth=t.depth,this.viewport.set(0,0,this.width,this.height),this.scissor.set(0,0,this.width,this.height),this.depthBuffer=t.depthBuffer,this.stencilBuffer=t.stencilBuffer,t.depthTexture!==null&&(this.depthTexture=t.depthTexture.clone()),this.texture.length=0;for(let e=0,i=t.texture.length;e<i;e++)this.texture[e]=t.texture[e].clone(),this.texture[e].isRenderTargetTexture=!0;return this}},Ii=class{constructor(t=0,e=0,i=0,r=1){this.isQuaternion=!0,this._x=t,this._y=e,this._z=i,this._w=r}static slerpFlat(t,e,i,r,n,s,a){let o=i[r+0],l=i[r+1],c=i[r+2],u=i[r+3],h=n[s+0],d=n[s+1],f=n[s+2],p=n[s+3];if(a===0){t[e+0]=o,t[e+1]=l,t[e+2]=c,t[e+3]=u;return}if(a===1){t[e+0]=h,t[e+1]=d,t[e+2]=f,t[e+3]=p;return}if(u!==p||o!==h||l!==d||c!==f){let g=1-a,m=o*h+l*d+c*f+u*p,y=m>=0?1:-1,b=1-m*m;if(b>Number.EPSILON){let E=Math.sqrt(b),M=Math.atan2(E,m*y);g=Math.sin(g*M)/E,a=Math.sin(a*M)/E}let w=a*y;if(o=o*g+h*w,l=l*g+d*w,c=c*g+f*w,u=u*g+p*w,g===1-a){let E=1/Math.sqrt(o*o+l*l+c*c+u*u);o*=E,l*=E,c*=E,u*=E}}t[e]=o,t[e+1]=l,t[e+2]=c,t[e+3]=u}static multiplyQuaternionsFlat(t,e,i,r,n,s){let a=i[r],o=i[r+1],l=i[r+2],c=i[r+3],u=n[s],h=n[s+1],d=n[s+2],f=n[s+3];return t[e]=a*f+c*u+o*d-l*h,t[e+1]=o*f+c*h+l*u-a*d,t[e+2]=l*f+c*d+a*h-o*u,t[e+3]=c*f-a*u-o*h-l*d,t}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get w(){return this._w}set w(t){this._w=t,this._onChangeCallback()}set(t,e,i,r){return this._x=t,this._y=e,this._z=i,this._w=r,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(t){return this._x=t.x,this._y=t.y,this._z=t.z,this._w=t.w,this._onChangeCallback(),this}setFromEuler(t,e){let i=t._x,r=t._y,n=t._z,s=t._order,a=Math.cos,o=Math.sin,l=a(i/2),c=a(r/2),u=a(n/2),h=o(i/2),d=o(r/2),f=o(n/2);switch(s){case"XYZ":this._x=h*c*u+l*d*f,this._y=l*d*u-h*c*f,this._z=l*c*f+h*d*u,this._w=l*c*u-h*d*f;break;case"YXZ":this._x=h*c*u+l*d*f,this._y=l*d*u-h*c*f,this._z=l*c*f-h*d*u,this._w=l*c*u+h*d*f;break;case"ZXY":this._x=h*c*u-l*d*f,this._y=l*d*u+h*c*f,this._z=l*c*f+h*d*u,this._w=l*c*u-h*d*f;break;case"ZYX":this._x=h*c*u-l*d*f,this._y=l*d*u+h*c*f,this._z=l*c*f-h*d*u,this._w=l*c*u+h*d*f;break;case"YZX":this._x=h*c*u+l*d*f,this._y=l*d*u+h*c*f,this._z=l*c*f-h*d*u,this._w=l*c*u-h*d*f;break;case"XZY":this._x=h*c*u-l*d*f,this._y=l*d*u-h*c*f,this._z=l*c*f+h*d*u,this._w=l*c*u+h*d*f;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+s)}return e!==!1&&this._onChangeCallback(),this}setFromAxisAngle(t,e){let i=e/2,r=Math.sin(i);return this._x=t.x*r,this._y=t.y*r,this._z=t.z*r,this._w=Math.cos(i),this._onChangeCallback(),this}setFromRotationMatrix(t){let e=t.elements,i=e[0],r=e[4],n=e[8],s=e[1],a=e[5],o=e[9],l=e[2],c=e[6],u=e[10],h=i+a+u;if(h>0){let d=.5/Math.sqrt(h+1);this._w=.25/d,this._x=(c-o)*d,this._y=(n-l)*d,this._z=(s-r)*d}else if(i>a&&i>u){let d=2*Math.sqrt(1+i-a-u);this._w=(c-o)/d,this._x=.25*d,this._y=(r+s)/d,this._z=(n+l)/d}else if(a>u){let d=2*Math.sqrt(1+a-i-u);this._w=(n-l)/d,this._x=(r+s)/d,this._y=.25*d,this._z=(o+c)/d}else{let d=2*Math.sqrt(1+u-i-a);this._w=(s-r)/d,this._x=(n+l)/d,this._y=(o+c)/d,this._z=.25*d}return this._onChangeCallback(),this}setFromUnitVectors(t,e){let i=t.dot(e)+1;return i<Number.EPSILON?(i=0,Math.abs(t.x)>Math.abs(t.z)?(this._x=-t.y,this._y=t.x,this._z=0,this._w=i):(this._x=0,this._y=-t.z,this._z=t.y,this._w=i)):(this._x=t.y*e.z-t.z*e.y,this._y=t.z*e.x-t.x*e.z,this._z=t.x*e.y-t.y*e.x,this._w=i),this.normalize()}angleTo(t){return 2*Math.acos(Math.abs(Fs(this.dot(t),-1,1)))}rotateTowards(t,e){let i=this.angleTo(t);if(i===0)return this;let r=Math.min(1,e/i);return this.slerp(t,r),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(t){return this._x*t._x+this._y*t._y+this._z*t._z+this._w*t._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let t=this.length();return t===0?(this._x=0,this._y=0,this._z=0,this._w=1):(t=1/t,this._x=this._x*t,this._y=this._y*t,this._z=this._z*t,this._w=this._w*t),this._onChangeCallback(),this}multiply(t){return this.multiplyQuaternions(this,t)}premultiply(t){return this.multiplyQuaternions(t,this)}multiplyQuaternions(t,e){let i=t._x,r=t._y,n=t._z,s=t._w,a=e._x,o=e._y,l=e._z,c=e._w;return this._x=i*c+s*a+r*l-n*o,this._y=r*c+s*o+n*a-i*l,this._z=n*c+s*l+i*o-r*a,this._w=s*c-i*a-r*o-n*l,this._onChangeCallback(),this}slerp(t,e){if(e===0)return this;if(e===1)return this.copy(t);let i=this._x,r=this._y,n=this._z,s=this._w,a=s*t._w+i*t._x+r*t._y+n*t._z;if(a<0?(this._w=-t._w,this._x=-t._x,this._y=-t._y,this._z=-t._z,a=-a):this.copy(t),a>=1)return this._w=s,this._x=i,this._y=r,this._z=n,this;let o=1-a*a;if(o<=Number.EPSILON){let d=1-e;return this._w=d*s+e*this._w,this._x=d*i+e*this._x,this._y=d*r+e*this._y,this._z=d*n+e*this._z,this.normalize(),this._onChangeCallback(),this}let l=Math.sqrt(o),c=Math.atan2(l,a),u=Math.sin((1-e)*c)/l,h=Math.sin(e*c)/l;return this._w=s*u+this._w*h,this._x=i*u+this._x*h,this._y=r*u+this._y*h,this._z=n*u+this._z*h,this._onChangeCallback(),this}slerpQuaternions(t,e,i){return this.copy(t).slerp(e,i)}random(){let t=Math.random(),e=Math.sqrt(1-t),i=Math.sqrt(t),r=2*Math.PI*Math.random(),n=2*Math.PI*Math.random();return this.set(e*Math.cos(r),i*Math.sin(n),i*Math.cos(n),e*Math.sin(r))}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._w===this._w}fromArray(t,e=0){return this._x=t[e],this._y=t[e+1],this._z=t[e+2],this._w=t[e+3],this._onChangeCallback(),this}toArray(t=[],e=0){return t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._w,t}fromBufferAttribute(t,e){return this._x=t.getX(e),this._y=t.getY(e),this._z=t.getZ(e),this._w=t.getW(e),this}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}},W=class{constructor(t=0,e=0,i=0){W.prototype.isVector3=!0,this.x=t,this.y=e,this.z=i}set(t,e,i){return i===void 0&&(i=this.z),this.x=t,this.y=e,this.z=i,this}setScalar(t){return this.x=t,this.y=t,this.z=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this}add(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this}sub(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this}subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this}multiply(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this}multiplyVectors(t,e){return this.x=t.x*e.x,this.y=t.y*e.y,this.z=t.z*e.z,this}applyEuler(t){return this.applyQuaternion(xZ.setFromEuler(t))}applyAxisAngle(t,e){return this.applyQuaternion(xZ.setFromAxisAngle(t,e))}applyMatrix3(t){let e=this.x,i=this.y,r=this.z,n=t.elements;return this.x=n[0]*e+n[3]*i+n[6]*r,this.y=n[1]*e+n[4]*i+n[7]*r,this.z=n[2]*e+n[5]*i+n[8]*r,this}applyNormalMatrix(t){return this.applyMatrix3(t).normalize()}applyMatrix4(t){let e=this.x,i=this.y,r=this.z,n=t.elements,s=1/(n[3]*e+n[7]*i+n[11]*r+n[15]);return this.x=(n[0]*e+n[4]*i+n[8]*r+n[12])*s,this.y=(n[1]*e+n[5]*i+n[9]*r+n[13])*s,this.z=(n[2]*e+n[6]*i+n[10]*r+n[14])*s,this}applyQuaternion(t){let e=this.x,i=this.y,r=this.z,n=t.x,s=t.y,a=t.z,o=t.w,l=o*e+s*r-a*i,c=o*i+a*e-n*r,u=o*r+n*i-s*e,h=-n*e-s*i-a*r;return this.x=l*o+h*-n+c*-a-u*-s,this.y=c*o+h*-s+u*-n-l*-a,this.z=u*o+h*-a+l*-s-c*-n,this}project(t){return this.applyMatrix4(t.matrixWorldInverse).applyMatrix4(t.projectionMatrix)}unproject(t){return this.applyMatrix4(t.projectionMatrixInverse).applyMatrix4(t.matrixWorld)}transformDirection(t){let e=this.x,i=this.y,r=this.z,n=t.elements;return this.x=n[0]*e+n[4]*i+n[8]*r,this.y=n[1]*e+n[5]*i+n[9]*r,this.z=n[2]*e+n[6]*i+n[10]*r,this.normalize()}divide(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this}divideScalar(t){return this.multiplyScalar(1/t)}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this.z=Math.max(t,Math.min(e,this.z)),this}clampLength(t,e){let i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(t,Math.min(e,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this}lerpVectors(t,e,i){return this.x=t.x+(e.x-t.x)*i,this.y=t.y+(e.y-t.y)*i,this.z=t.z+(e.z-t.z)*i,this}cross(t){return this.crossVectors(this,t)}crossVectors(t,e){let i=t.x,r=t.y,n=t.z,s=e.x,a=e.y,o=e.z;return this.x=r*o-n*a,this.y=n*s-i*o,this.z=i*a-r*s,this}projectOnVector(t){let e=t.lengthSq();if(e===0)return this.set(0,0,0);let i=t.dot(this)/e;return this.copy(t).multiplyScalar(i)}projectOnPlane(t){return zB.copy(this).projectOnVector(t),this.sub(zB)}reflect(t){return this.sub(zB.copy(t).multiplyScalar(2*this.dot(t)))}angleTo(t){let e=Math.sqrt(this.lengthSq()*t.lengthSq());if(e===0)return Math.PI/2;let i=this.dot(t)/e;return Math.acos(Fs(i,-1,1))}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){let e=this.x-t.x,i=this.y-t.y,r=this.z-t.z;return e*e+i*i+r*r}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)+Math.abs(this.z-t.z)}setFromSpherical(t){return this.setFromSphericalCoords(t.radius,t.phi,t.theta)}setFromSphericalCoords(t,e,i){let r=Math.sin(e)*t;return this.x=r*Math.sin(i),this.y=Math.cos(e)*t,this.z=r*Math.cos(i),this}setFromCylindrical(t){return this.setFromCylindricalCoords(t.radius,t.theta,t.y)}setFromCylindricalCoords(t,e,i){return this.x=t*Math.sin(e),this.y=i,this.z=t*Math.cos(e),this}setFromMatrixPosition(t){let e=t.elements;return this.x=e[12],this.y=e[13],this.z=e[14],this}setFromMatrixScale(t){let e=this.setFromMatrixColumn(t,0).length(),i=this.setFromMatrixColumn(t,1).length(),r=this.setFromMatrixColumn(t,2).length();return this.x=e,this.y=i,this.z=r,this}setFromMatrixColumn(t,e){return this.fromArray(t.elements,e*4)}setFromMatrix3Column(t,e){return this.fromArray(t.elements,e*3)}setFromEuler(t){return this.x=t._x,this.y=t._y,this.z=t._z,this}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this.z=t[e+2],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t}fromBufferAttribute(t,e){return this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){let t=(Math.random()-.5)*2,e=Math.random()*Math.PI*2,i=Math.sqrt(1-t**2);return this.x=i*Math.cos(e),this.y=i*Math.sin(e),this.z=t,this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}},zB=new W,xZ=new Ii,Ss=class{constructor(t=new W(1/0,1/0,1/0),e=new W(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=t,this.max=e}set(t,e){return this.min.copy(t),this.max.copy(e),this}setFromArray(t){let e=1/0,i=1/0,r=1/0,n=-1/0,s=-1/0,a=-1/0;for(let o=0,l=t.length;o<l;o+=3){let c=t[o],u=t[o+1],h=t[o+2];c<e&&(e=c),u<i&&(i=u),h<r&&(r=h),c>n&&(n=c),u>s&&(s=u),h>a&&(a=h)}return this.min.set(e,i,r),this.max.set(n,s,a),this}setFromBufferAttribute(t){let e=1/0,i=1/0,r=1/0,n=-1/0,s=-1/0,a=-1/0;for(let o=0,l=t.count;o<l;o++){let c=t.getX(o),u=t.getY(o),h=t.getZ(o);c<e&&(e=c),u<i&&(i=u),h<r&&(r=h),c>n&&(n=c),u>s&&(s=u),h>a&&(a=h)}return this.min.set(e,i,r),this.max.set(n,s,a),this}setFromPoints(t){this.makeEmpty();for(let e=0,i=t.length;e<i;e++)this.expandByPoint(t[e]);return this}setFromCenterAndSize(t,e){let i=Ey.copy(e).multiplyScalar(.5);return this.min.copy(t).sub(i),this.max.copy(t).add(i),this}setFromObject(t,e=!1){return this.makeEmpty(),this.expandByObject(t,e)}clone(){return new this.constructor().copy(this)}copy(t){return this.min.copy(t.min),this.max.copy(t.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(t){return this.isEmpty()?t.set(0,0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(t){return this.isEmpty()?t.set(0,0,0):t.subVectors(this.max,this.min)}expandByPoint(t){return this.min.min(t),this.max.max(t),this}expandByVector(t){return this.min.sub(t),this.max.add(t),this}expandByScalar(t){return this.min.addScalar(-t),this.max.addScalar(t),this}expandByObject(t,e=!1){t.updateWorldMatrix(!1,!1);let i=t.geometry;if(i!==void 0)if(e&&i.attributes!=null&&i.attributes.position!==void 0){let n=i.attributes.position;for(let s=0,a=n.count;s<a;s++)Ey.fromBufferAttribute(n,s).applyMatrix4(t.matrixWorld),this.expandByPoint(Ey)}else i.boundingBox===null&&i.computeBoundingBox(),jB.copy(i.boundingBox),jB.applyMatrix4(t.matrixWorld),this.union(jB);let r=t.children;for(let n=0,s=r.length;n<s;n++)this.expandByObject(r[n],e);return this}containsPoint(t){return!(t.x<this.min.x||t.x>this.max.x||t.y<this.min.y||t.y>this.max.y||t.z<this.min.z||t.z>this.max.z)}containsBox(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y&&this.min.z<=t.min.z&&t.max.z<=this.max.z}getParameter(t,e){return e.set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y),(t.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(t){return!(t.max.x<this.min.x||t.min.x>this.max.x||t.max.y<this.min.y||t.min.y>this.max.y||t.max.z<this.min.z||t.min.z>this.max.z)}intersectsSphere(t){return this.clampPoint(t.center,Ey),Ey.distanceToSquared(t.center)<=t.radius*t.radius}intersectsPlane(t){let e,i;return t.normal.x>0?(e=t.normal.x*this.min.x,i=t.normal.x*this.max.x):(e=t.normal.x*this.max.x,i=t.normal.x*this.min.x),t.normal.y>0?(e+=t.normal.y*this.min.y,i+=t.normal.y*this.max.y):(e+=t.normal.y*this.max.y,i+=t.normal.y*this.min.y),t.normal.z>0?(e+=t.normal.z*this.min.z,i+=t.normal.z*this.max.z):(e+=t.normal.z*this.max.z,i+=t.normal.z*this.min.z),e<=-t.constant&&i>=-t.constant}intersectsTriangle(t){if(this.isEmpty())return!1;this.getCenter(nE),gP.subVectors(this.max,nE),Vb.subVectors(t.a,nE),Hb.subVectors(t.b,nE),Gb.subVectors(t.c,nE),Wm.subVectors(Hb,Vb),qm.subVectors(Gb,Hb),Ay.subVectors(Vb,Gb);let e=[0,-Wm.z,Wm.y,0,-qm.z,qm.y,0,-Ay.z,Ay.y,Wm.z,0,-Wm.x,qm.z,0,-qm.x,Ay.z,0,-Ay.x,-Wm.y,Wm.x,0,-qm.y,qm.x,0,-Ay.y,Ay.x,0];return!VB(e,Vb,Hb,Gb,gP)||(e=[1,0,0,0,1,0,0,0,1],!VB(e,Vb,Hb,Gb,gP))?!1:(vP.crossVectors(Wm,qm),e=[vP.x,vP.y,vP.z],VB(e,Vb,Hb,Gb,gP))}clampPoint(t,e){return e.copy(t).clamp(this.min,this.max)}distanceToPoint(t){return Ey.copy(t).clamp(this.min,this.max).sub(t).length()}getBoundingSphere(t){return this.getCenter(t.center),t.radius=this.getSize(Ey).length()*.5,t}intersect(t){return this.min.max(t.min),this.max.min(t.max),this.isEmpty()&&this.makeEmpty(),this}union(t){return this.min.min(t.min),this.max.max(t.max),this}applyMatrix4(t){return this.isEmpty()?this:(Qf[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(t),Qf[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(t),Qf[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(t),Qf[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(t),Qf[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(t),Qf[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(t),Qf[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(t),Qf[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(t),this.setFromPoints(Qf),this)}translate(t){return this.min.add(t),this.max.add(t),this}equals(t){return t.min.equals(this.min)&&t.max.equals(this.max)}},Qf=[new W,new W,new W,new W,new W,new W,new W,new W],Ey=new W,jB=new Ss,Vb=new W,Hb=new W,Gb=new W,Wm=new W,qm=new W,Ay=new W,nE=new W,gP=new W,vP=new W,My=new W;function VB(t,e,i,r,n){for(let s=0,a=t.length-3;s<=a;s+=3){My.fromArray(t,s);let o=n.x*Math.abs(My.x)+n.y*Math.abs(My.y)+n.z*Math.abs(My.z),l=e.dot(My),c=i.dot(My),u=r.dot(My);if(Math.max(-Math.max(l,c,u),Math.min(l,c,u))>o)return!1}return!0}var iHe=new Ss,sE=new W,HB=new W,oc=class{constructor(t=new W,e=-1){this.center=t,this.radius=e}set(t,e){return this.center.copy(t),this.radius=e,this}setFromPoints(t,e){let i=this.center;e!==void 0?i.copy(e):iHe.setFromPoints(t).getCenter(i);let r=0;for(let n=0,s=t.length;n<s;n++)r=Math.max(r,i.distanceToSquared(t[n]));return this.radius=Math.sqrt(r),this}copy(t){return this.center.copy(t.center),this.radius=t.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(t){return t.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(t){return t.distanceTo(this.center)-this.radius}intersectsSphere(t){let e=this.radius+t.radius;return t.center.distanceToSquared(this.center)<=e*e}intersectsBox(t){return t.intersectsSphere(this)}intersectsPlane(t){return Math.abs(t.distanceToPoint(this.center))<=this.radius}clampPoint(t,e){let i=this.center.distanceToSquared(t);return e.copy(t),i>this.radius*this.radius&&(e.sub(this.center).normalize(),e.multiplyScalar(this.radius).add(this.center)),e}getBoundingBox(t){return this.isEmpty()?(t.makeEmpty(),t):(t.set(this.center,this.center),t.expandByScalar(this.radius),t)}applyMatrix4(t){return this.center.applyMatrix4(t),this.radius=this.radius*t.getMaxScaleOnAxis(),this}translate(t){return this.center.add(t),this}expandByPoint(t){if(this.isEmpty())return this.center.copy(t),this.radius=0,this;sE.subVectors(t,this.center);let e=sE.lengthSq();if(e>this.radius*this.radius){let i=Math.sqrt(e),r=(i-this.radius)*.5;this.center.addScaledVector(sE,r/i),this.radius+=r}return this}union(t){return t.isEmpty()?this:this.isEmpty()?(this.copy(t),this):(this.center.equals(t.center)===!0?this.radius=Math.max(this.radius,t.radius):(HB.subVectors(t.center,this.center).setLength(t.radius),this.expandByPoint(sE.copy(t.center).add(HB)),this.expandByPoint(sE.copy(t.center).sub(HB))),this)}equals(t){return t.center.equals(this.center)&&t.radius===this.radius}clone(){return new this.constructor().copy(this)}},Jf=new W,GB=new W,yP=new W,Xm=new W,WB=new W,xP=new W,qB=new W,E_=class{constructor(t=new W,e=new W(0,0,-1)){this.origin=t,this.direction=e}set(t,e){return this.origin.copy(t),this.direction.copy(e),this}copy(t){return this.origin.copy(t.origin),this.direction.copy(t.direction),this}at(t,e){return e.copy(this.direction).multiplyScalar(t).add(this.origin)}lookAt(t){return this.direction.copy(t).sub(this.origin).normalize(),this}recast(t){return this.origin.copy(this.at(t,Jf)),this}closestPointToPoint(t,e){e.subVectors(t,this.origin);let i=e.dot(this.direction);return i<0?e.copy(this.origin):e.copy(this.direction).multiplyScalar(i).add(this.origin)}distanceToPoint(t){return Math.sqrt(this.distanceSqToPoint(t))}distanceSqToPoint(t){let e=Jf.subVectors(t,this.origin).dot(this.direction);return e<0?this.origin.distanceToSquared(t):(Jf.copy(this.direction).multiplyScalar(e).add(this.origin),Jf.distanceToSquared(t))}distanceSqToSegment(t,e,i,r){GB.copy(t).add(e).multiplyScalar(.5),yP.copy(e).sub(t).normalize(),Xm.copy(this.origin).sub(GB);let n=t.distanceTo(e)*.5,s=-this.direction.dot(yP),a=Xm.dot(this.direction),o=-Xm.dot(yP),l=Xm.lengthSq(),c=Math.abs(1-s*s),u,h,d,f;if(c>0)if(u=s*o-a,h=s*a-o,f=n*c,u>=0)if(h>=-f)if(h<=f){let p=1/c;u*=p,h*=p,d=u*(u+s*h+2*a)+h*(s*u+h+2*o)+l}else h=n,u=Math.max(0,-(s*h+a)),d=-u*u+h*(h+2*o)+l;else h=-n,u=Math.max(0,-(s*h+a)),d=-u*u+h*(h+2*o)+l;else h<=-f?(u=Math.max(0,-(-s*n+a)),h=u>0?-n:Math.min(Math.max(-n,-o),n),d=-u*u+h*(h+2*o)+l):h<=f?(u=0,h=Math.min(Math.max(-n,-o),n),d=h*(h+2*o)+l):(u=Math.max(0,-(s*n+a)),h=u>0?n:Math.min(Math.max(-n,-o),n),d=-u*u+h*(h+2*o)+l);else h=s>0?-n:n,u=Math.max(0,-(s*h+a)),d=-u*u+h*(h+2*o)+l;return i&&i.copy(this.direction).multiplyScalar(u).add(this.origin),r&&r.copy(yP).multiplyScalar(h).add(GB),d}intersectSphere(t,e){Jf.subVectors(t.center,this.origin);let i=Jf.dot(this.direction),r=Jf.dot(Jf)-i*i,n=t.radius*t.radius;if(r>n)return null;let s=Math.sqrt(n-r),a=i-s,o=i+s;return a<0&&o<0?null:a<0?this.at(o,e):this.at(a,e)}intersectsSphere(t){return this.distanceSqToPoint(t.center)<=t.radius*t.radius}distanceToPlane(t){let e=t.normal.dot(this.direction);if(e===0)return t.distanceToPoint(this.origin)===0?0:null;let i=-(this.origin.dot(t.normal)+t.constant)/e;return i>=0?i:null}intersectPlane(t,e){let i=this.distanceToPlane(t);return i===null?null:this.at(i,e)}intersectsPlane(t){let e=t.distanceToPoint(this.origin);return e===0||t.normal.dot(this.direction)*e<0}intersectBox(t,e){let i,r,n,s,a,o,l=1/this.direction.x,c=1/this.direction.y,u=1/this.direction.z,h=this.origin;return l>=0?(i=(t.min.x-h.x)*l,r=(t.max.x-h.x)*l):(i=(t.max.x-h.x)*l,r=(t.min.x-h.x)*l),c>=0?(n=(t.min.y-h.y)*c,s=(t.max.y-h.y)*c):(n=(t.max.y-h.y)*c,s=(t.min.y-h.y)*c),i>s||n>r||((n>i||isNaN(i))&&(i=n),(s<r||isNaN(r))&&(r=s),u>=0?(a=(t.min.z-h.z)*u,o=(t.max.z-h.z)*u):(a=(t.max.z-h.z)*u,o=(t.min.z-h.z)*u),i>o||a>r)||((a>i||i!==i)&&(i=a),(o<r||r!==r)&&(r=o),r<0)?null:this.at(i>=0?i:r,e)}intersectsBox(t){return this.intersectBox(t,Jf)!==null}intersectTriangle(t,e,i,r,n){WB.subVectors(e,t),xP.subVectors(i,t),qB.crossVectors(WB,xP);let s=this.direction.dot(qB),a;if(s>0){if(r)return null;a=1}else if(s<0)a=-1,s=-s;else return null;Xm.subVectors(this.origin,t);let o=a*this.direction.dot(xP.crossVectors(Xm,xP));if(o<0)return null;let l=a*this.direction.dot(WB.cross(Xm));if(l<0||o+l>s)return null;let c=-a*Xm.dot(qB);return c<0?null:this.at(c/s,n)}applyMatrix4(t){return this.origin.applyMatrix4(t),this.direction.transformDirection(t),this}equals(t){return t.origin.equals(this.origin)&&t.direction.equals(this.direction)}clone(){return new this.constructor().copy(this)}},St=class{constructor(){St.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}set(t,e,i,r,n,s,a,o,l,c,u,h,d,f,p,g){let m=this.elements;return m[0]=t,m[4]=e,m[8]=i,m[12]=r,m[1]=n,m[5]=s,m[9]=a,m[13]=o,m[2]=l,m[6]=c,m[10]=u,m[14]=h,m[3]=d,m[7]=f,m[11]=p,m[15]=g,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new St().fromArray(this.elements)}copy(t){let e=this.elements,i=t.elements;return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],e[9]=i[9],e[10]=i[10],e[11]=i[11],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15],this}copyPosition(t){let e=this.elements,i=t.elements;return e[12]=i[12],e[13]=i[13],e[14]=i[14],this}setFromMatrix3(t){let e=t.elements;return this.set(e[0],e[3],e[6],0,e[1],e[4],e[7],0,e[2],e[5],e[8],0,0,0,0,1),this}extractBasis(t,e,i){return t.setFromMatrixColumn(this,0),e.setFromMatrixColumn(this,1),i.setFromMatrixColumn(this,2),this}makeBasis(t,e,i){return this.set(t.x,e.x,i.x,0,t.y,e.y,i.y,0,t.z,e.z,i.z,0,0,0,0,1),this}extractRotation(t){let e=this.elements,i=t.elements,r=1/Wb.setFromMatrixColumn(t,0).length(),n=1/Wb.setFromMatrixColumn(t,1).length(),s=1/Wb.setFromMatrixColumn(t,2).length();return e[0]=i[0]*r,e[1]=i[1]*r,e[2]=i[2]*r,e[3]=0,e[4]=i[4]*n,e[5]=i[5]*n,e[6]=i[6]*n,e[7]=0,e[8]=i[8]*s,e[9]=i[9]*s,e[10]=i[10]*s,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this}makeRotationFromEuler(t){let e=this.elements,i=t.x,r=t.y,n=t.z,s=Math.cos(i),a=Math.sin(i),o=Math.cos(r),l=Math.sin(r),c=Math.cos(n),u=Math.sin(n);if(t.order==="XYZ"){let h=s*c,d=s*u,f=a*c,p=a*u;e[0]=o*c,e[4]=-o*u,e[8]=l,e[1]=d+f*l,e[5]=h-p*l,e[9]=-a*o,e[2]=p-h*l,e[6]=f+d*l,e[10]=s*o}else if(t.order==="YXZ"){let h=o*c,d=o*u,f=l*c,p=l*u;e[0]=h+p*a,e[4]=f*a-d,e[8]=s*l,e[1]=s*u,e[5]=s*c,e[9]=-a,e[2]=d*a-f,e[6]=p+h*a,e[10]=s*o}else if(t.order==="ZXY"){let h=o*c,d=o*u,f=l*c,p=l*u;e[0]=h-p*a,e[4]=-s*u,e[8]=f+d*a,e[1]=d+f*a,e[5]=s*c,e[9]=p-h*a,e[2]=-s*l,e[6]=a,e[10]=s*o}else if(t.order==="ZYX"){let h=s*c,d=s*u,f=a*c,p=a*u;e[0]=o*c,e[4]=f*l-d,e[8]=h*l+p,e[1]=o*u,e[5]=p*l+h,e[9]=d*l-f,e[2]=-l,e[6]=a*o,e[10]=s*o}else if(t.order==="YZX"){let h=s*o,d=s*l,f=a*o,p=a*l;e[0]=o*c,e[4]=p-h*u,e[8]=f*u+d,e[1]=u,e[5]=s*c,e[9]=-a*c,e[2]=-l*c,e[6]=d*u+f,e[10]=h-p*u}else if(t.order==="XZY"){let h=s*o,d=s*l,f=a*o,p=a*l;e[0]=o*c,e[4]=-u,e[8]=l*c,e[1]=h*u+p,e[5]=s*c,e[9]=d*u-f,e[2]=f*u-d,e[6]=a*c,e[10]=p*u+h}return e[3]=0,e[7]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this}makeRotationFromQuaternion(t){return this.compose(rHe,t,nHe)}lookAt(t,e,i){let r=this.elements;return Sc.subVectors(t,e),Sc.lengthSq()===0&&(Sc.z=1),Sc.normalize(),$m.crossVectors(i,Sc),$m.lengthSq()===0&&(Math.abs(i.z)===1?Sc.x+=1e-4:Sc.z+=1e-4,Sc.normalize(),$m.crossVectors(i,Sc)),$m.normalize(),bP.crossVectors(Sc,$m),r[0]=$m.x,r[4]=bP.x,r[8]=Sc.x,r[1]=$m.y,r[5]=bP.y,r[9]=Sc.y,r[2]=$m.z,r[6]=bP.z,r[10]=Sc.z,this}multiply(t){return this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,e){let i=t.elements,r=e.elements,n=this.elements,s=i[0],a=i[4],o=i[8],l=i[12],c=i[1],u=i[5],h=i[9],d=i[13],f=i[2],p=i[6],g=i[10],m=i[14],y=i[3],b=i[7],w=i[11],E=i[15],M=r[0],A=r[4],P=r[8],C=r[12],R=r[1],I=r[5],k=r[9],z=r[13],V=r[2],F=r[6],$=r[10],K=r[14],X=r[3],U=r[7],Y=r[11],Z=r[15];return n[0]=s*M+a*R+o*V+l*X,n[4]=s*A+a*I+o*F+l*U,n[8]=s*P+a*k+o*$+l*Y,n[12]=s*C+a*z+o*K+l*Z,n[1]=c*M+u*R+h*V+d*X,n[5]=c*A+u*I+h*F+d*U,n[9]=c*P+u*k+h*$+d*Y,n[13]=c*C+u*z+h*K+d*Z,n[2]=f*M+p*R+g*V+m*X,n[6]=f*A+p*I+g*F+m*U,n[10]=f*P+p*k+g*$+m*Y,n[14]=f*C+p*z+g*K+m*Z,n[3]=y*M+b*R+w*V+E*X,n[7]=y*A+b*I+w*F+E*U,n[11]=y*P+b*k+w*$+E*Y,n[15]=y*C+b*z+w*K+E*Z,this}multiplyScalar(t){let e=this.elements;return e[0]*=t,e[4]*=t,e[8]*=t,e[12]*=t,e[1]*=t,e[5]*=t,e[9]*=t,e[13]*=t,e[2]*=t,e[6]*=t,e[10]*=t,e[14]*=t,e[3]*=t,e[7]*=t,e[11]*=t,e[15]*=t,this}determinant(){let t=this.elements,e=t[0],i=t[4],r=t[8],n=t[12],s=t[1],a=t[5],o=t[9],l=t[13],c=t[2],u=t[6],h=t[10],d=t[14],f=t[3],p=t[7],g=t[11],m=t[15];return f*(+n*o*u-r*l*u-n*a*h+i*l*h+r*a*d-i*o*d)+p*(+e*o*d-e*l*h+n*s*h-r*s*d+r*l*c-n*o*c)+g*(+e*l*u-e*a*d-n*s*u+i*s*d+n*a*c-i*l*c)+m*(-r*a*c-e*o*u+e*a*h+r*s*u-i*s*h+i*o*c)}transpose(){let t=this.elements,e;return e=t[1],t[1]=t[4],t[4]=e,e=t[2],t[2]=t[8],t[8]=e,e=t[6],t[6]=t[9],t[9]=e,e=t[3],t[3]=t[12],t[12]=e,e=t[7],t[7]=t[13],t[13]=e,e=t[11],t[11]=t[14],t[14]=e,this}setPosition(t,e,i){let r=this.elements;return t.isVector3?(r[12]=t.x,r[13]=t.y,r[14]=t.z):(r[12]=t,r[13]=e,r[14]=i),this}invert(){let t=this.elements,e=t[0],i=t[1],r=t[2],n=t[3],s=t[4],a=t[5],o=t[6],l=t[7],c=t[8],u=t[9],h=t[10],d=t[11],f=t[12],p=t[13],g=t[14],m=t[15],y=u*g*l-p*h*l+p*o*d-a*g*d-u*o*m+a*h*m,b=f*h*l-c*g*l-f*o*d+s*g*d+c*o*m-s*h*m,w=c*p*l-f*u*l+f*a*d-s*p*d-c*a*m+s*u*m,E=f*u*o-c*p*o-f*a*h+s*p*h+c*a*g-s*u*g,M=e*y+i*b+r*w+n*E;if(M===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);let A=1/M;return t[0]=y*A,t[1]=(p*h*n-u*g*n-p*r*d+i*g*d+u*r*m-i*h*m)*A,t[2]=(a*g*n-p*o*n+p*r*l-i*g*l-a*r*m+i*o*m)*A,t[3]=(u*o*n-a*h*n-u*r*l+i*h*l+a*r*d-i*o*d)*A,t[4]=b*A,t[5]=(c*g*n-f*h*n+f*r*d-e*g*d-c*r*m+e*h*m)*A,t[6]=(f*o*n-s*g*n-f*r*l+e*g*l+s*r*m-e*o*m)*A,t[7]=(s*h*n-c*o*n+c*r*l-e*h*l-s*r*d+e*o*d)*A,t[8]=w*A,t[9]=(f*u*n-c*p*n-f*i*d+e*p*d+c*i*m-e*u*m)*A,t[10]=(s*p*n-f*a*n+f*i*l-e*p*l-s*i*m+e*a*m)*A,t[11]=(c*a*n-s*u*n-c*i*l+e*u*l+s*i*d-e*a*d)*A,t[12]=E*A,t[13]=(c*p*r-f*u*r+f*i*h-e*p*h-c*i*g+e*u*g)*A,t[14]=(f*a*r-s*p*r-f*i*o+e*p*o+s*i*g-e*a*g)*A,t[15]=(s*u*r-c*a*r+c*i*o-e*u*o-s*i*h+e*a*h)*A,this}scale(t){let e=this.elements,i=t.x,r=t.y,n=t.z;return e[0]*=i,e[4]*=r,e[8]*=n,e[1]*=i,e[5]*=r,e[9]*=n,e[2]*=i,e[6]*=r,e[10]*=n,e[3]*=i,e[7]*=r,e[11]*=n,this}getMaxScaleOnAxis(){let t=this.elements,e=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],i=t[4]*t[4]+t[5]*t[5]+t[6]*t[6],r=t[8]*t[8]+t[9]*t[9]+t[10]*t[10];return Math.sqrt(Math.max(e,i,r))}makeTranslation(t,e,i){return this.set(1,0,0,t,0,1,0,e,0,0,1,i,0,0,0,1),this}makeRotationX(t){let e=Math.cos(t),i=Math.sin(t);return this.set(1,0,0,0,0,e,-i,0,0,i,e,0,0,0,0,1),this}makeRotationY(t){let e=Math.cos(t),i=Math.sin(t);return this.set(e,0,i,0,0,1,0,0,-i,0,e,0,0,0,0,1),this}makeRotationZ(t){let e=Math.cos(t),i=Math.sin(t);return this.set(e,-i,0,0,i,e,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(t,e){let i=Math.cos(e),r=Math.sin(e),n=1-i,s=t.x,a=t.y,o=t.z,l=n*s,c=n*a;return this.set(l*s+i,l*a-r*o,l*o+r*a,0,l*a+r*o,c*a+i,c*o-r*s,0,l*o-r*a,c*o+r*s,n*o*o+i,0,0,0,0,1),this}makeScale(t,e,i){return this.set(t,0,0,0,0,e,0,0,0,0,i,0,0,0,0,1),this}makeShear(t,e,i,r,n,s){return this.set(1,i,n,0,t,1,s,0,e,r,1,0,0,0,0,1),this}compose(t,e,i){let r=this.elements,n=e._x,s=e._y,a=e._z,o=e._w,l=n+n,c=s+s,u=a+a,h=n*l,d=n*c,f=n*u,p=s*c,g=s*u,m=a*u,y=o*l,b=o*c,w=o*u,E=i.x,M=i.y,A=i.z;return r[0]=(1-(p+m))*E,r[1]=(d+w)*E,r[2]=(f-b)*E,r[3]=0,r[4]=(d-w)*M,r[5]=(1-(h+m))*M,r[6]=(g+y)*M,r[7]=0,r[8]=(f+b)*A,r[9]=(g-y)*A,r[10]=(1-(h+p))*A,r[11]=0,r[12]=t.x,r[13]=t.y,r[14]=t.z,r[15]=1,this}decompose(t,e,i){let r=this.elements,n=Wb.set(r[0],r[1],r[2]).length(),s=Wb.set(r[4],r[5],r[6]).length(),a=Wb.set(r[8],r[9],r[10]).length();this.determinant()<0&&(n=-n),t.x=r[12],t.y=r[13],t.z=r[14],ih.copy(this);let o=1/n,l=1/s,c=1/a;return ih.elements[0]*=o,ih.elements[1]*=o,ih.elements[2]*=o,ih.elements[4]*=l,ih.elements[5]*=l,ih.elements[6]*=l,ih.elements[8]*=c,ih.elements[9]*=c,ih.elements[10]*=c,e.setFromRotationMatrix(ih),i.x=n,i.y=s,i.z=a,this}makePerspective(t,e,i,r,n,s){let a=this.elements,o=2*n/(e-t),l=2*n/(i-r),c=(e+t)/(e-t),u=(i+r)/(i-r),h=-(s+n)/(s-n),d=-2*s*n/(s-n);return a[0]=o,a[4]=0,a[8]=c,a[12]=0,a[1]=0,a[5]=l,a[9]=u,a[13]=0,a[2]=0,a[6]=0,a[10]=h,a[14]=d,a[3]=0,a[7]=0,a[11]=-1,a[15]=0,this}makeOrthographic(t,e,i,r,n,s){let a=this.elements,o=1/(e-t),l=1/(i-r),c=1/(s-n),u=(e+t)*o,h=(i+r)*l,d=(s+n)*c;return a[0]=2*o,a[4]=0,a[8]=0,a[12]=-u,a[1]=0,a[5]=2*l,a[9]=0,a[13]=-h,a[2]=0,a[6]=0,a[10]=-2*c,a[14]=-d,a[3]=0,a[7]=0,a[11]=0,a[15]=1,this}equals(t){let e=this.elements,i=t.elements;for(let r=0;r<16;r++)if(e[r]!==i[r])return!1;return!0}fromArray(t,e=0){for(let i=0;i<16;i++)this.elements[i]=t[i+e];return this}toArray(t=[],e=0){let i=this.elements;return t[e]=i[0],t[e+1]=i[1],t[e+2]=i[2],t[e+3]=i[3],t[e+4]=i[4],t[e+5]=i[5],t[e+6]=i[6],t[e+7]=i[7],t[e+8]=i[8],t[e+9]=i[9],t[e+10]=i[10],t[e+11]=i[11],t[e+12]=i[12],t[e+13]=i[13],t[e+14]=i[14],t[e+15]=i[15],t}},Wb=new W,ih=new St,rHe=new W(0,0,0),nHe=new W(1,1,1),$m=new W,bP=new W,Sc=new W,bZ=new St,wZ=new Ii,xs=class{constructor(t=0,e=0,i=0,r=xs.DEFAULT_ORDER){this.isEuler=!0,this._x=t,this._y=e,this._z=i,this._order=r}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get order(){return this._order}set order(t){this._order=t,this._onChangeCallback()}set(t,e,i,r=this._order){return this._x=t,this._y=e,this._z=i,this._order=r,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(t){return this._x=t._x,this._y=t._y,this._z=t._z,this._order=t._order,this._onChangeCallback(),this}setFromRotationMatrix(t,e=this._order,i=!0){let r=t.elements,n=r[0],s=r[4],a=r[8],o=r[1],l=r[5],c=r[9],u=r[2],h=r[6],d=r[10];switch(e){case"XYZ":this._y=Math.asin(Fs(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(-c,d),this._z=Math.atan2(-s,n)):(this._x=Math.atan2(h,l),this._z=0);break;case"YXZ":this._x=Math.asin(-Fs(c,-1,1)),Math.abs(c)<.9999999?(this._y=Math.atan2(a,d),this._z=Math.atan2(o,l)):(this._y=Math.atan2(-u,n),this._z=0);break;case"ZXY":this._x=Math.asin(Fs(h,-1,1)),Math.abs(h)<.9999999?(this._y=Math.atan2(-u,d),this._z=Math.atan2(-s,l)):(this._y=0,this._z=Math.atan2(o,n));break;case"ZYX":this._y=Math.asin(-Fs(u,-1,1)),Math.abs(u)<.9999999?(this._x=Math.atan2(h,d),this._z=Math.atan2(o,n)):(this._x=0,this._z=Math.atan2(-s,l));break;case"YZX":this._z=Math.asin(Fs(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(-c,l),this._y=Math.atan2(-u,n)):(this._x=0,this._y=Math.atan2(a,d));break;case"XZY":this._z=Math.asin(-Fs(s,-1,1)),Math.abs(s)<.9999999?(this._x=Math.atan2(h,l),this._y=Math.atan2(a,n)):(this._x=Math.atan2(-c,d),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+e)}return this._order=e,i===!0&&this._onChangeCallback(),this}setFromQuaternion(t,e,i){return bZ.makeRotationFromQuaternion(t),this.setFromRotationMatrix(bZ,e,i)}setFromVector3(t,e=this._order){return this.set(t.x,t.y,t.z,e)}reorder(t){return wZ.setFromEuler(this),this.setFromQuaternion(wZ,t)}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._order===this._order}fromArray(t){return this._x=t[0],this._y=t[1],this._z=t[2],t[3]!==void 0&&(this._order=t[3]),this._onChangeCallback(),this}toArray(t=[],e=0){return t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._order,t}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}};xs.DEFAULT_ORDER="XYZ";var GH=class{constructor(){this.mask=1}set(t){this.mask=(1<<t|0)>>>0}enable(t){this.mask|=1<<t|0}enableAll(){this.mask=-1}toggle(t){this.mask^=1<<t|0}disable(t){this.mask&=~(1<<t|0)}disableAll(){this.mask=0}test(t){return(this.mask&t.mask)!==0}isEnabled(t){return(this.mask&(1<<t|0))!==0}},sHe=0,_Z=new W,qb=new Ii,ep=new St,wP=new W,aE=new W,aHe=new W,oHe=new Ii,SZ=new W(1,0,0),EZ=new W(0,1,0),AZ=new W(0,0,1),lHe={type:"added"},MZ={type:"removed"},tn=class extends Qa{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:sHe++}),this.uuid=yu(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=tn.DEFAULT_UP.clone();let t=new W,e=new xs,i=new Ii,r=new W(1,1,1);function n(){i.setFromEuler(e,!1)}function s(){e.setFromQuaternion(i,void 0,!1)}e._onChange(n),i._onChange(s),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:t},rotation:{configurable:!0,enumerable:!0,value:e},quaternion:{configurable:!0,enumerable:!0,value:i},scale:{configurable:!0,enumerable:!0,value:r},modelViewMatrix:{value:new St},normalMatrix:{value:new Vs}}),this.matrix=new St,this.matrixWorld=new St,this.matrixAutoUpdate=tn.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.matrixWorldAutoUpdate=tn.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.layers=new GH,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeRender(){}onAfterRender(){}applyMatrix4(t){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(t),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(t){return this.quaternion.premultiply(t),this}setRotationFromAxisAngle(t,e){this.quaternion.setFromAxisAngle(t,e)}setRotationFromEuler(t){this.quaternion.setFromEuler(t,!0)}setRotationFromMatrix(t){this.quaternion.setFromRotationMatrix(t)}setRotationFromQuaternion(t){this.quaternion.copy(t)}rotateOnAxis(t,e){return qb.setFromAxisAngle(t,e),this.quaternion.multiply(qb),this}rotateOnWorldAxis(t,e){return qb.setFromAxisAngle(t,e),this.quaternion.premultiply(qb),this}rotateX(t){return this.rotateOnAxis(SZ,t)}rotateY(t){return this.rotateOnAxis(EZ,t)}rotateZ(t){return this.rotateOnAxis(AZ,t)}translateOnAxis(t,e){return _Z.copy(t).applyQuaternion(this.quaternion),this.position.add(_Z.multiplyScalar(e)),this}translateX(t){return this.translateOnAxis(SZ,t)}translateY(t){return this.translateOnAxis(EZ,t)}translateZ(t){return this.translateOnAxis(AZ,t)}localToWorld(t){return this.updateWorldMatrix(!0,!1),t.applyMatrix4(this.matrixWorld)}worldToLocal(t){return this.updateWorldMatrix(!0,!1),t.applyMatrix4(ep.copy(this.matrixWorld).invert())}lookAt(t,e,i){t.isVector3?wP.copy(t):wP.set(t,e,i);let r=this.parent;this.updateWorldMatrix(!0,!1),aE.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?ep.lookAt(aE,wP,this.up):ep.lookAt(wP,aE,this.up),this.quaternion.setFromRotationMatrix(ep),r&&(ep.extractRotation(r.matrixWorld),qb.setFromRotationMatrix(ep),this.quaternion.premultiply(qb.invert()))}add(t){if(arguments.length>1){for(let e=0;e<arguments.length;e++)this.add(arguments[e]);return this}return t===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",t),this):(t&&t.isObject3D?(t.parent!==null&&t.parent.remove(t),t.parent=this,this.children.push(t),t.dispatchEvent(lHe)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",t),this)}remove(t){if(arguments.length>1){for(let i=0;i<arguments.length;i++)this.remove(arguments[i]);return this}let e=this.children.indexOf(t);return e!==-1&&(t.parent=null,this.children.splice(e,1),t.dispatchEvent(MZ)),this}removeFromParent(){let t=this.parent;return t!==null&&t.remove(this),this}clear(){for(let t=0;t<this.children.length;t++){let e=this.children[t];e.parent=null,e.dispatchEvent(MZ)}return this.children.length=0,this}attach(t){return this.updateWorldMatrix(!0,!1),ep.copy(this.matrixWorld).invert(),t.parent!==null&&(t.parent.updateWorldMatrix(!0,!1),ep.multiply(t.parent.matrixWorld)),t.applyMatrix4(ep),this.add(t),t.updateWorldMatrix(!1,!0),this}getObjectById(t){return this.getObjectByProperty("id",t)}getObjectByName(t){return this.getObjectByProperty("name",t)}getObjectByProperty(t,e){if(this[t]===e)return this;for(let i=0,r=this.children.length;i<r;i++){let n=this.children[i].getObjectByProperty(t,e);if(n!==void 0)return n}}getObjectsByProperty(t,e){let i=[];this[t]===e&&i.push(this);for(let r=0,n=this.children.length;r<n;r++){let s=this.children[r].getObjectsByProperty(t,e);s.length>0&&(i=i.concat(s))}return i}getWorldPosition(t){return this.updateWorldMatrix(!0,!1),t.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(t){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(aE,t,aHe),t}getWorldScale(t){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(aE,oHe,t),t}getWorldDirection(t){this.updateWorldMatrix(!0,!1);let e=this.matrixWorld.elements;return t.set(e[8],e[9],e[10]).normalize()}raycast(){}traverse(t){t(this);let e=this.children;for(let i=0,r=e.length;i<r;i++)e[i].traverse(t)}traverseVisible(t){if(this.visible===!1)return;t(this);let e=this.children;for(let i=0,r=e.length;i<r;i++)e[i].traverseVisible(t)}traverseAncestors(t){let e=this.parent;e!==null&&(t(e),e.traverseAncestors(t))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(t){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||t)&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,t=!0);let e=this.children;for(let i=0,r=e.length;i<r;i++){let n=e[i];(n.matrixWorldAutoUpdate===!0||t===!0)&&n.updateMatrixWorld(t)}}updateWorldMatrix(t,e){let i=this.parent;if(t===!0&&i!==null&&i.matrixWorldAutoUpdate===!0&&i.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),e===!0){let r=this.children;for(let n=0,s=r.length;n<s;n++){let a=r[n];a.matrixWorldAutoUpdate===!0&&a.updateWorldMatrix(!1,!0)}}}toJSON(t){let e=t===void 0||typeof t=="string",i={};e&&(t={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},i.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});let r={};r.uuid=this.uuid,r.type=this.type,this.name!==""&&(r.name=this.name),this.castShadow===!0&&(r.castShadow=!0),this.receiveShadow===!0&&(r.receiveShadow=!0),this.visible===!1&&(r.visible=!1),this.frustumCulled===!1&&(r.frustumCulled=!1),this.renderOrder!==0&&(r.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(r.userData=this.userData),r.layers=this.layers.mask,r.matrix=this.matrix.toArray(),this.matrixAutoUpdate===!1&&(r.matrixAutoUpdate=!1),this.isInstancedMesh&&(r.type="InstancedMesh",r.count=this.count,r.instanceMatrix=this.instanceMatrix.toJSON(),this.instanceColor!==null&&(r.instanceColor=this.instanceColor.toJSON()));function n(a,o){return a[o.uuid]===void 0&&(a[o.uuid]=o.toJSON(t)),o.uuid}if(this.isScene)this.background&&(this.background.isColor?r.background=this.background.toJSON():this.background.isTexture&&(r.background=this.background.toJSON(t).uuid)),this.environment&&this.environment.isTexture&&this.environment.isRenderTargetTexture!==!0&&(r.environment=this.environment.toJSON(t).uuid);else if(this.isMesh||this.isLine||this.isPoints){r.geometry=n(t.geometries,this.geometry);let a=this.geometry.parameters;if(a!==void 0&&a.shapes!==void 0){let o=a.shapes;if(Array.isArray(o))for(let l=0,c=o.length;l<c;l++){let u=o[l];n(t.shapes,u)}else n(t.shapes,o)}}if(this.isSkinnedMesh&&(r.bindMode=this.bindMode,r.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(n(t.skeletons,this.skeleton),r.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){let a=[];for(let o=0,l=this.material.length;o<l;o++)a.push(n(t.materials,this.material[o]));r.material=a}else r.material=n(t.materials,this.material);if(this.children.length>0){r.children=[];for(let a=0;a<this.children.length;a++)r.children.push(this.children[a].toJSON(t).object)}if(this.animations.length>0){r.animations=[];for(let a=0;a<this.animations.length;a++){let o=this.animations[a];r.animations.push(n(t.animations,o))}}if(e){let a=s(t.geometries),o=s(t.materials),l=s(t.textures),c=s(t.images),u=s(t.shapes),h=s(t.skeletons),d=s(t.animations),f=s(t.nodes);a.length>0&&(i.geometries=a),o.length>0&&(i.materials=o),l.length>0&&(i.textures=l),c.length>0&&(i.images=c),u.length>0&&(i.shapes=u),h.length>0&&(i.skeletons=h),d.length>0&&(i.animations=d),f.length>0&&(i.nodes=f)}return i.object=r,i;function s(a){let o=[];for(let l in a){let c=a[l];delete c.metadata,o.push(c)}return o}}clone(t){return new this.constructor().copy(this,t)}copy(t,e=!0){if(this.name=t.name,this.up.copy(t.up),this.position.copy(t.position),this.rotation.order=t.rotation.order,this.quaternion.copy(t.quaternion),this.scale.copy(t.scale),this.matrix.copy(t.matrix),this.matrixWorld.copy(t.matrixWorld),this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrixWorldNeedsUpdate=t.matrixWorldNeedsUpdate,this.matrixWorldAutoUpdate=t.matrixWorldAutoUpdate,this.layers.mask=t.layers.mask,this.visible=t.visible,this.castShadow=t.castShadow,this.receiveShadow=t.receiveShadow,this.frustumCulled=t.frustumCulled,this.renderOrder=t.renderOrder,this.userData=JSON.parse(JSON.stringify(t.userData)),e===!0)for(let i=0;i<t.children.length;i++){let r=t.children[i];this.add(r.clone())}return this}};tn.DEFAULT_UP=new W(0,1,0);tn.DEFAULT_MATRIX_AUTO_UPDATE=!0;tn.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;var rh=new W,tp=new W,XB=new W,ip=new W,Xb=new W,$b=new W,TZ=new W,$B=new W,YB=new W,KB=new W,vo=class{constructor(t=new W,e=new W,i=new W){this.a=t,this.b=e,this.c=i}static getNormal(t,e,i,r){r.subVectors(i,e),rh.subVectors(t,e),r.cross(rh);let n=r.lengthSq();return n>0?r.multiplyScalar(1/Math.sqrt(n)):r.set(0,0,0)}static getBarycoord(t,e,i,r,n){rh.subVectors(r,e),tp.subVectors(i,e),XB.subVectors(t,e);let s=rh.dot(rh),a=rh.dot(tp),o=rh.dot(XB),l=tp.dot(tp),c=tp.dot(XB),u=s*l-a*a;if(u===0)return n.set(-2,-1,-1);let h=1/u,d=(l*o-a*c)*h,f=(s*c-a*o)*h;return n.set(1-d-f,f,d)}static containsPoint(t,e,i,r){return this.getBarycoord(t,e,i,r,ip),ip.x>=0&&ip.y>=0&&ip.x+ip.y<=1}static getUV(t,e,i,r,n,s,a,o){return this.getBarycoord(t,e,i,r,ip),o.set(0,0),o.addScaledVector(n,ip.x),o.addScaledVector(s,ip.y),o.addScaledVector(a,ip.z),o}static isFrontFacing(t,e,i,r){return rh.subVectors(i,e),tp.subVectors(t,e),rh.cross(tp).dot(r)<0}set(t,e,i){return this.a.copy(t),this.b.copy(e),this.c.copy(i),this}setFromPointsAndIndices(t,e,i,r){return this.a.copy(t[e]),this.b.copy(t[i]),this.c.copy(t[r]),this}setFromAttributeAndIndices(t,e,i,r){return this.a.fromBufferAttribute(t,e),this.b.fromBufferAttribute(t,i),this.c.fromBufferAttribute(t,r),this}clone(){return new this.constructor().copy(this)}copy(t){return this.a.copy(t.a),this.b.copy(t.b),this.c.copy(t.c),this}getArea(){return rh.subVectors(this.c,this.b),tp.subVectors(this.a,this.b),rh.cross(tp).length()*.5}getMidpoint(t){return t.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(t){return vo.getNormal(this.a,this.b,this.c,t)}getPlane(t){return t.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(t,e){return vo.getBarycoord(t,this.a,this.b,this.c,e)}getUV(t,e,i,r,n){return vo.getUV(t,this.a,this.b,this.c,e,i,r,n)}containsPoint(t){return vo.containsPoint(t,this.a,this.b,this.c)}isFrontFacing(t){return vo.isFrontFacing(this.a,this.b,this.c,t)}intersectsBox(t){return t.intersectsTriangle(this)}closestPointToPoint(t,e){let i=this.a,r=this.b,n=this.c,s,a;Xb.subVectors(r,i),$b.subVectors(n,i),$B.subVectors(t,i);let o=Xb.dot($B),l=$b.dot($B);if(o<=0&&l<=0)return e.copy(i);YB.subVectors(t,r);let c=Xb.dot(YB),u=$b.dot(YB);if(c>=0&&u<=c)return e.copy(r);let h=o*u-c*l;if(h<=0&&o>=0&&c<=0)return s=o/(o-c),e.copy(i).addScaledVector(Xb,s);KB.subVectors(t,n);let d=Xb.dot(KB),f=$b.dot(KB);if(f>=0&&d<=f)return e.copy(n);let p=d*l-o*f;if(p<=0&&l>=0&&f<=0)return a=l/(l-f),e.copy(i).addScaledVector($b,a);let g=c*f-d*u;if(g<=0&&u-c>=0&&d-f>=0)return TZ.subVectors(n,r),a=(u-c)/(u-c+(d-f)),e.copy(r).addScaledVector(TZ,a);let m=1/(g+p+h);return s=p*m,a=h*m,e.copy(i).addScaledVector(Xb,s).addScaledVector($b,a)}equals(t){return t.a.equals(this.a)&&t.b.equals(this.b)&&t.c.equals(this.c)}},cHe=0,OT=class extends Qa{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:cHe++}),this.uuid=yu(),this.name="",this.type="Material",this.blending=g0,this.side=Ih,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.blendSrc=Zue,this.blendDst=Que,this.blendEquation=Aw,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=xj,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=U6e,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=kB,this.stencilZFail=kB,this.stencilZPass=kB,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(t){this._alphaTest>0!=t>0&&this.version++,this._alphaTest=t}onBuild(){}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(t){if(t!==void 0)for(let e in t){let i=t[e];if(i===void 0){console.warn("THREE.Material: '"+e+"' parameter is undefined.");continue}let r=this[e];if(r===void 0){console.warn("THREE."+this.type+": '"+e+"' is not a property of this material.");continue}r&&r.isColor?r.set(i):r&&r.isVector3&&i&&i.isVector3?r.copy(i):this[e]=i}}toJSON(t){let e=t===void 0||typeof t=="string";e&&(t={textures:{},images:{}});let i={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};i.uuid=this.uuid,i.type=this.type,this.name!==""&&(i.name=this.name),this.color&&this.color.isColor&&(i.color=this.color.getHex()),this.roughness!==void 0&&(i.roughness=this.roughness),this.metalness!==void 0&&(i.metalness=this.metalness),this.sheen!==void 0&&(i.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(i.sheenColor=this.sheenColor.getHex()),this.sheenRoughness!==void 0&&(i.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(i.emissive=this.emissive.getHex()),this.emissiveIntensity&&this.emissiveIntensity!==1&&(i.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(i.specular=this.specular.getHex()),this.specularIntensity!==void 0&&(i.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(i.specularColor=this.specularColor.getHex()),this.shininess!==void 0&&(i.shininess=this.shininess),this.clearcoat!==void 0&&(i.clearcoat=this.clearcoat),this.clearcoatRoughness!==void 0&&(i.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(i.clearcoatMap=this.clearcoatMap.toJSON(t).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(i.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(t).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(i.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(t).uuid,i.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.iridescence!==void 0&&(i.iridescence=this.iridescence),this.iridescenceIOR!==void 0&&(i.iridescenceIOR=this.iridescenceIOR),this.iridescenceThicknessRange!==void 0&&(i.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(i.iridescenceMap=this.iridescenceMap.toJSON(t).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(i.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(t).uuid),this.map&&this.map.isTexture&&(i.map=this.map.toJSON(t).uuid),this.matcap&&this.matcap.isTexture&&(i.matcap=this.matcap.toJSON(t).uuid),this.alphaMap&&this.alphaMap.isTexture&&(i.alphaMap=this.alphaMap.toJSON(t).uuid),this.lightMap&&this.lightMap.isTexture&&(i.lightMap=this.lightMap.toJSON(t).uuid,i.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(i.aoMap=this.aoMap.toJSON(t).uuid,i.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(i.bumpMap=this.bumpMap.toJSON(t).uuid,i.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(i.normalMap=this.normalMap.toJSON(t).uuid,i.normalMapType=this.normalMapType,i.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(i.displacementMap=this.displacementMap.toJSON(t).uuid,i.displacementScale=this.displacementScale,i.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(i.roughnessMap=this.roughnessMap.toJSON(t).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(i.metalnessMap=this.metalnessMap.toJSON(t).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(i.emissiveMap=this.emissiveMap.toJSON(t).uuid),this.specularMap&&this.specularMap.isTexture&&(i.specularMap=this.specularMap.toJSON(t).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(i.specularIntensityMap=this.specularIntensityMap.toJSON(t).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(i.specularColorMap=this.specularColorMap.toJSON(t).uuid),this.envMap&&this.envMap.isTexture&&(i.envMap=this.envMap.toJSON(t).uuid,this.combine!==void 0&&(i.combine=this.combine)),this.envMapIntensity!==void 0&&(i.envMapIntensity=this.envMapIntensity),this.reflectivity!==void 0&&(i.reflectivity=this.reflectivity),this.refractionRatio!==void 0&&(i.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(i.gradientMap=this.gradientMap.toJSON(t).uuid),this.transmission!==void 0&&(i.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(i.transmissionMap=this.transmissionMap.toJSON(t).uuid),this.thickness!==void 0&&(i.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(i.thicknessMap=this.thicknessMap.toJSON(t).uuid),this.attenuationDistance!==void 0&&this.attenuationDistance!==1/0&&(i.attenuationDistance=this.attenuationDistance),this.attenuationColor!==void 0&&(i.attenuationColor=this.attenuationColor.getHex()),this.size!==void 0&&(i.size=this.size),this.shadowSide!==null&&(i.shadowSide=this.shadowSide),this.sizeAttenuation!==void 0&&(i.sizeAttenuation=this.sizeAttenuation),this.blending!==g0&&(i.blending=this.blending),this.side!==Ih&&(i.side=this.side),this.vertexColors&&(i.vertexColors=!0),this.opacity<1&&(i.opacity=this.opacity),this.transparent===!0&&(i.transparent=this.transparent),i.depthFunc=this.depthFunc,i.depthTest=this.depthTest,i.depthWrite=this.depthWrite,i.colorWrite=this.colorWrite,i.stencilWrite=this.stencilWrite,i.stencilWriteMask=this.stencilWriteMask,i.stencilFunc=this.stencilFunc,i.stencilRef=this.stencilRef,i.stencilFuncMask=this.stencilFuncMask,i.stencilFail=this.stencilFail,i.stencilZFail=this.stencilZFail,i.stencilZPass=this.stencilZPass,this.rotation!==void 0&&this.rotation!==0&&(i.rotation=this.rotation),this.polygonOffset===!0&&(i.polygonOffset=!0),this.polygonOffsetFactor!==0&&(i.polygonOffsetFactor=this.polygonOffsetFactor),this.polygonOffsetUnits!==0&&(i.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth!==void 0&&this.linewidth!==1&&(i.linewidth=this.linewidth),this.dashSize!==void 0&&(i.dashSize=this.dashSize),this.gapSize!==void 0&&(i.gapSize=this.gapSize),this.scale!==void 0&&(i.scale=this.scale),this.dithering===!0&&(i.dithering=!0),this.alphaTest>0&&(i.alphaTest=this.alphaTest),this.alphaToCoverage===!0&&(i.alphaToCoverage=this.alphaToCoverage),this.premultipliedAlpha===!0&&(i.premultipliedAlpha=this.premultipliedAlpha),this.forceSinglePass===!0&&(i.forceSinglePass=this.forceSinglePass),this.wireframe===!0&&(i.wireframe=this.wireframe),this.wireframeLinewidth>1&&(i.wireframeLinewidth=this.wireframeLinewidth),this.wireframeLinecap!=="round"&&(i.wireframeLinecap=this.wireframeLinecap),this.wireframeLinejoin!=="round"&&(i.wireframeLinejoin=this.wireframeLinejoin),this.flatShading===!0&&(i.flatShading=this.flatShading),this.visible===!1&&(i.visible=!1),this.toneMapped===!1&&(i.toneMapped=!1),this.fog===!1&&(i.fog=!1),Object.keys(this.userData).length>0&&(i.userData=this.userData);function r(n){let s=[];for(let a in n){let o=n[a];delete o.metadata,s.push(o)}return s}if(e){let n=r(t.textures),s=r(t.images);n.length>0&&(i.textures=n),s.length>0&&(i.images=s)}return i}clone(){return new this.constructor().copy(this)}copy(t){this.name=t.name,this.blending=t.blending,this.side=t.side,this.vertexColors=t.vertexColors,this.opacity=t.opacity,this.transparent=t.transparent,this.blendSrc=t.blendSrc,this.blendDst=t.blendDst,this.blendEquation=t.blendEquation,this.blendSrcAlpha=t.blendSrcAlpha,this.blendDstAlpha=t.blendDstAlpha,this.blendEquationAlpha=t.blendEquationAlpha,this.depthFunc=t.depthFunc,this.depthTest=t.depthTest,this.depthWrite=t.depthWrite,this.stencilWriteMask=t.stencilWriteMask,this.stencilFunc=t.stencilFunc,this.stencilRef=t.stencilRef,this.stencilFuncMask=t.stencilFuncMask,this.stencilFail=t.stencilFail,this.stencilZFail=t.stencilZFail,this.stencilZPass=t.stencilZPass,this.stencilWrite=t.stencilWrite;let e=t.clippingPlanes,i=null;if(e!==null){let r=e.length;i=new Array(r);for(let n=0;n!==r;++n)i[n]=e[n].clone()}return this.clippingPlanes=i,this.clipIntersection=t.clipIntersection,this.clipShadows=t.clipShadows,this.shadowSide=t.shadowSide,this.colorWrite=t.colorWrite,this.precision=t.precision,this.polygonOffset=t.polygonOffset,this.polygonOffsetFactor=t.polygonOffsetFactor,this.polygonOffsetUnits=t.polygonOffsetUnits,this.dithering=t.dithering,this.alphaTest=t.alphaTest,this.alphaToCoverage=t.alphaToCoverage,this.premultipliedAlpha=t.premultipliedAlpha,this.forceSinglePass=t.forceSinglePass,this.visible=t.visible,this.toneMapped=t.toneMapped,this.userData=JSON.parse(JSON.stringify(t.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(t){t===!0&&this.version++}},Xp=class extends OT{constructor(t){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new Ai(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=Jue,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.fog=t.fog,this}},Os=new W,_P=new Ae,Mi=class{constructor(t,e,i=!1){if(Array.isArray(t))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,this.name="",this.array=t,this.itemSize=e,this.count=t!==void 0?t.length/e:0,this.normalized=i,this.usage=Sj,this.updateRange={offset:0,count:-1},this.version=0}onUploadCallback(){}set needsUpdate(t){t===!0&&this.version++}setUsage(t){return this.usage=t,this}copy(t){return this.name=t.name,this.array=new t.array.constructor(t.array),this.itemSize=t.itemSize,this.count=t.count,this.normalized=t.normalized,this.usage=t.usage,this}copyAt(t,e,i){t*=this.itemSize,i*=e.itemSize;for(let r=0,n=this.itemSize;r<n;r++)this.array[t+r]=e.array[i+r];return this}copyArray(t){return this.array.set(t),this}applyMatrix3(t){if(this.itemSize===2)for(let e=0,i=this.count;e<i;e++)_P.fromBufferAttribute(this,e),_P.applyMatrix3(t),this.setXY(e,_P.x,_P.y);else if(this.itemSize===3)for(let e=0,i=this.count;e<i;e++)Os.fromBufferAttribute(this,e),Os.applyMatrix3(t),this.setXYZ(e,Os.x,Os.y,Os.z);return this}applyMatrix4(t){for(let e=0,i=this.count;e<i;e++)Os.fromBufferAttribute(this,e),Os.applyMatrix4(t),this.setXYZ(e,Os.x,Os.y,Os.z);return this}applyNormalMatrix(t){for(let e=0,i=this.count;e<i;e++)Os.fromBufferAttribute(this,e),Os.applyNormalMatrix(t),this.setXYZ(e,Os.x,Os.y,Os.z);return this}transformDirection(t){for(let e=0,i=this.count;e<i;e++)Os.fromBufferAttribute(this,e),Os.transformDirection(t),this.setXYZ(e,Os.x,Os.y,Os.z);return this}set(t,e=0){return this.array.set(t,e),this}getX(t){let e=this.array[t*this.itemSize];return this.normalized&&(e=Mp(e,this.array)),e}setX(t,e){return this.normalized&&(e=Sn(e,this.array)),this.array[t*this.itemSize]=e,this}getY(t){let e=this.array[t*this.itemSize+1];return this.normalized&&(e=Mp(e,this.array)),e}setY(t,e){return this.normalized&&(e=Sn(e,this.array)),this.array[t*this.itemSize+1]=e,this}getZ(t){let e=this.array[t*this.itemSize+2];return this.normalized&&(e=Mp(e,this.array)),e}setZ(t,e){return this.normalized&&(e=Sn(e,this.array)),this.array[t*this.itemSize+2]=e,this}getW(t){let e=this.array[t*this.itemSize+3];return this.normalized&&(e=Mp(e,this.array)),e}setW(t,e){return this.normalized&&(e=Sn(e,this.array)),this.array[t*this.itemSize+3]=e,this}setXY(t,e,i){return t*=this.itemSize,this.normalized&&(e=Sn(e,this.array),i=Sn(i,this.array)),this.array[t+0]=e,this.array[t+1]=i,this}setXYZ(t,e,i,r){return t*=this.itemSize,this.normalized&&(e=Sn(e,this.array),i=Sn(i,this.array),r=Sn(r,this.array)),this.array[t+0]=e,this.array[t+1]=i,this.array[t+2]=r,this}setXYZW(t,e,i,r,n){return t*=this.itemSize,this.normalized&&(e=Sn(e,this.array),i=Sn(i,this.array),r=Sn(r,this.array),n=Sn(n,this.array)),this.array[t+0]=e,this.array[t+1]=i,this.array[t+2]=r,this.array[t+3]=n,this}onUpload(t){return this.onUploadCallback=t,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){let t={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return this.name!==""&&(t.name=this.name),this.usage!==Sj&&(t.usage=this.usage),(this.updateRange.offset!==0||this.updateRange.count!==-1)&&(t.updateRange=this.updateRange),t}copyColorsArray(){console.error("THREE.BufferAttribute: copyColorsArray() was removed in r144.")}copyVector2sArray(){console.error("THREE.BufferAttribute: copyVector2sArray() was removed in r144.")}copyVector3sArray(){console.error("THREE.BufferAttribute: copyVector3sArray() was removed in r144.")}copyVector4sArray(){console.error("THREE.BufferAttribute: copyVector4sArray() was removed in r144.")}},fhe=class extends Mi{constructor(t,e,i){super(new Uint16Array(t),e,i)}},s1=class extends Mi{constructor(t,e,i){super(new Uint32Array(t),e,i)}},Gt=class extends Mi{constructor(t,e,i){super(new Float32Array(t),e,i)}},uHe=0,eu=new St,ZB=new tn,Yb=new W,Ec=new Ss,oE=new Ss,La=new W,oi=class extends Qa{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:uHe++}),this.uuid=yu(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(t){return Array.isArray(t)?this.index=new(ohe(t)?s1:fhe)(t,1):this.index=t,this}getAttribute(t){return this.attributes[t]}setAttribute(t,e){return this.attributes[t]=e,this}deleteAttribute(t){return delete this.attributes[t],this}hasAttribute(t){return this.attributes[t]!==void 0}addGroup(t,e,i=0){this.groups.push({start:t,count:e,materialIndex:i})}clearGroups(){this.groups=[]}setDrawRange(t,e){this.drawRange.start=t,this.drawRange.count=e}applyMatrix4(t){let e=this.attributes.position;e!==void 0&&(e.applyMatrix4(t),e.needsUpdate=!0);let i=this.attributes.normal;if(i!==void 0){let n=new Vs().getNormalMatrix(t);i.applyNormalMatrix(n),i.needsUpdate=!0}let r=this.attributes.tangent;return r!==void 0&&(r.transformDirection(t),r.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}applyQuaternion(t){return eu.makeRotationFromQuaternion(t),this.applyMatrix4(eu),this}rotateX(t){return eu.makeRotationX(t),this.applyMatrix4(eu),this}rotateY(t){return eu.makeRotationY(t),this.applyMatrix4(eu),this}rotateZ(t){return eu.makeRotationZ(t),this.applyMatrix4(eu),this}translate(t,e,i){return eu.makeTranslation(t,e,i),this.applyMatrix4(eu),this}scale(t,e,i){return eu.makeScale(t,e,i),this.applyMatrix4(eu),this}lookAt(t){return ZB.lookAt(t),ZB.updateMatrix(),this.applyMatrix4(ZB.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(Yb).negate(),this.translate(Yb.x,Yb.y,Yb.z),this}setFromPoints(t){let e=[];for(let i=0,r=t.length;i<r;i++){let n=t[i];e.push(n.x,n.y,n.z||0)}return this.setAttribute("position",new Gt(e,3)),this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new Ss);let t=this.attributes.position,e=this.morphAttributes.position;if(t&&t.isGLBufferAttribute){console.error('THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set "mesh.frustumCulled" to "false".',this),this.boundingBox.set(new W(-1/0,-1/0,-1/0),new W(1/0,1/0,1/0));return}if(t!==void 0){if(this.boundingBox.setFromBufferAttribute(t),e)for(let i=0,r=e.length;i<r;i++){let n=e[i];Ec.setFromBufferAttribute(n),this.morphTargetsRelative?(La.addVectors(this.boundingBox.min,Ec.min),this.boundingBox.expandByPoint(La),La.addVectors(this.boundingBox.max,Ec.max),this.boundingBox.expandByPoint(La)):(this.boundingBox.expandByPoint(Ec.min),this.boundingBox.expandByPoint(Ec.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new oc);let t=this.attributes.position,e=this.morphAttributes.position;if(t&&t.isGLBufferAttribute){console.error('THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set "mesh.frustumCulled" to "false".',this),this.boundingSphere.set(new W,1/0);return}if(t){let i=this.boundingSphere.center;if(Ec.setFromBufferAttribute(t),e)for(let n=0,s=e.length;n<s;n++){let a=e[n];oE.setFromBufferAttribute(a),this.morphTargetsRelative?(La.addVectors(Ec.min,oE.min),Ec.expandByPoint(La),La.addVectors(Ec.max,oE.max),Ec.expandByPoint(La)):(Ec.expandByPoint(oE.min),Ec.expandByPoint(oE.max))}Ec.getCenter(i);let r=0;for(let n=0,s=t.count;n<s;n++)La.fromBufferAttribute(t,n),r=Math.max(r,i.distanceToSquared(La));if(e)for(let n=0,s=e.length;n<s;n++){let a=e[n],o=this.morphTargetsRelative;for(let l=0,c=a.count;l<c;l++)La.fromBufferAttribute(a,l),o&&(Yb.fromBufferAttribute(t,l),La.add(Yb)),r=Math.max(r,i.distanceToSquared(La))}this.boundingSphere.radius=Math.sqrt(r),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){let t=this.index,e=this.attributes;if(t===null||e.position===void 0||e.normal===void 0||e.uv===void 0){console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");return}let i=t.array,r=e.position.array,n=e.normal.array,s=e.uv.array,a=r.length/3;this.hasAttribute("tangent")===!1&&this.setAttribute("tangent",new Mi(new Float32Array(4*a),4));let o=this.getAttribute("tangent").array,l=[],c=[];for(let R=0;R<a;R++)l[R]=new W,c[R]=new W;let u=new W,h=new W,d=new W,f=new Ae,p=new Ae,g=new Ae,m=new W,y=new W;function b(R,I,k){u.fromArray(r,R*3),h.fromArray(r,I*3),d.fromArray(r,k*3),f.fromArray(s,R*2),p.fromArray(s,I*2),g.fromArray(s,k*2),h.sub(u),d.sub(u),p.sub(f),g.sub(f);let z=1/(p.x*g.y-g.x*p.y);!isFinite(z)||(m.copy(h).multiplyScalar(g.y).addScaledVector(d,-p.y).multiplyScalar(z),y.copy(d).multiplyScalar(p.x).addScaledVector(h,-g.x).multiplyScalar(z),l[R].add(m),l[I].add(m),l[k].add(m),c[R].add(y),c[I].add(y),c[k].add(y))}let w=this.groups;w.length===0&&(w=[{start:0,count:i.length}]);for(let R=0,I=w.length;R<I;++R){let k=w[R],z=k.start,V=k.count;for(let F=z,$=z+V;F<$;F+=3)b(i[F+0],i[F+1],i[F+2])}let E=new W,M=new W,A=new W,P=new W;function C(R){A.fromArray(n,R*3),P.copy(A);let I=l[R];E.copy(I),E.sub(A.multiplyScalar(A.dot(I))).normalize(),M.crossVectors(P,I);let k=M.dot(c[R])<0?-1:1;o[R*4]=E.x,o[R*4+1]=E.y,o[R*4+2]=E.z,o[R*4+3]=k}for(let R=0,I=w.length;R<I;++R){let k=w[R],z=k.start,V=k.count;for(let F=z,$=z+V;F<$;F+=3)C(i[F+0]),C(i[F+1]),C(i[F+2])}}computeVertexNormals(){let t=this.index,e=this.getAttribute("position");if(e!==void 0){let i=this.getAttribute("normal");if(i===void 0)i=new Mi(new Float32Array(e.count*3),3),this.setAttribute("normal",i);else for(let h=0,d=i.count;h<d;h++)i.setXYZ(h,0,0,0);let r=new W,n=new W,s=new W,a=new W,o=new W,l=new W,c=new W,u=new W;if(t)for(let h=0,d=t.count;h<d;h+=3){let f=t.getX(h+0),p=t.getX(h+1),g=t.getX(h+2);r.fromBufferAttribute(e,f),n.fromBufferAttribute(e,p),s.fromBufferAttribute(e,g),c.subVectors(s,n),u.subVectors(r,n),c.cross(u),a.fromBufferAttribute(i,f),o.fromBufferAttribute(i,p),l.fromBufferAttribute(i,g),a.add(c),o.add(c),l.add(c),i.setXYZ(f,a.x,a.y,a.z),i.setXYZ(p,o.x,o.y,o.z),i.setXYZ(g,l.x,l.y,l.z)}else for(let h=0,d=e.count;h<d;h+=3)r.fromBufferAttribute(e,h+0),n.fromBufferAttribute(e,h+1),s.fromBufferAttribute(e,h+2),c.subVectors(s,n),u.subVectors(r,n),c.cross(u),i.setXYZ(h+0,c.x,c.y,c.z),i.setXYZ(h+1,c.x,c.y,c.z),i.setXYZ(h+2,c.x,c.y,c.z);this.normalizeNormals(),i.needsUpdate=!0}}merge(){return console.error("THREE.BufferGeometry.merge() has been removed. Use THREE.BufferGeometryUtils.mergeBufferGeometries() instead."),this}normalizeNormals(){let t=this.attributes.normal;for(let e=0,i=t.count;e<i;e++)La.fromBufferAttribute(t,e),La.normalize(),t.setXYZ(e,La.x,La.y,La.z)}toNonIndexed(){function t(a,o){let l=a.array,c=a.itemSize,u=a.normalized,h=new l.constructor(o.length*c),d=0,f=0;for(let p=0,g=o.length;p<g;p++){a.isInterleavedBufferAttribute?d=o[p]*a.data.stride+a.offset:d=o[p]*c;for(let m=0;m<c;m++)h[f++]=l[d++]}return new Mi(h,c,u)}if(this.index===null)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;let e=new oi,i=this.index.array,r=this.attributes;for(let a in r){let o=r[a],l=t(o,i);e.setAttribute(a,l)}let n=this.morphAttributes;for(let a in n){let o=[],l=n[a];for(let c=0,u=l.length;c<u;c++){let h=l[c],d=t(h,i);o.push(d)}e.morphAttributes[a]=o}e.morphTargetsRelative=this.morphTargetsRelative;let s=this.groups;for(let a=0,o=s.length;a<o;a++){let l=s[a];e.addGroup(l.start,l.count,l.materialIndex)}return e}toJSON(){let t={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(t.uuid=this.uuid,t.type=this.type,this.name!==""&&(t.name=this.name),Object.keys(this.userData).length>0&&(t.userData=this.userData),this.parameters!==void 0){let o=this.parameters;for(let l in o)o[l]!==void 0&&(t[l]=o[l]);return t}t.data={attributes:{}};let e=this.index;e!==null&&(t.data.index={type:e.array.constructor.name,array:Array.prototype.slice.call(e.array)});let i=this.attributes;for(let o in i){let l=i[o];t.data.attributes[o]=l.toJSON(t.data)}let r={},n=!1;for(let o in this.morphAttributes){let l=this.morphAttributes[o],c=[];for(let u=0,h=l.length;u<h;u++){let d=l[u];c.push(d.toJSON(t.data))}c.length>0&&(r[o]=c,n=!0)}n&&(t.data.morphAttributes=r,t.data.morphTargetsRelative=this.morphTargetsRelative);let s=this.groups;s.length>0&&(t.data.groups=JSON.parse(JSON.stringify(s)));let a=this.boundingSphere;return a!==null&&(t.data.boundingSphere={center:a.center.toArray(),radius:a.radius}),t}clone(){return new this.constructor().copy(this)}copy(t){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;let e={};this.name=t.name;let i=t.index;i!==null&&this.setIndex(i.clone(e));let r=t.attributes;for(let l in r){let c=r[l];this.setAttribute(l,c.clone(e))}let n=t.morphAttributes;for(let l in n){let c=[],u=n[l];for(let h=0,d=u.length;h<d;h++)c.push(u[h].clone(e));this.morphAttributes[l]=c}this.morphTargetsRelative=t.morphTargetsRelative;let s=t.groups;for(let l=0,c=s.length;l<c;l++){let u=s[l];this.addGroup(u.start,u.count,u.materialIndex)}let a=t.boundingBox;a!==null&&(this.boundingBox=a.clone());let o=t.boundingSphere;return o!==null&&(this.boundingSphere=o.clone()),this.drawRange.start=t.drawRange.start,this.drawRange.count=t.drawRange.count,this.userData=t.userData,t.parameters!==void 0&&(this.parameters=Object.assign({},t.parameters)),this}dispose(){this.dispatchEvent({type:"dispose"})}},CZ=new St,Kb=new E_,QB=new oc,lE=new W,cE=new W,uE=new W,JB=new W,SP=new W,EP=new Ae,AP=new Ae,MP=new Ae,eF=new W,TP=new W,En=class extends tn{constructor(t=new oi,e=new Xp){super(),this.isMesh=!0,this.type="Mesh",this.geometry=t,this.material=e,this.updateMorphTargets()}copy(t,e){return super.copy(t,e),t.morphTargetInfluences!==void 0&&(this.morphTargetInfluences=t.morphTargetInfluences.slice()),t.morphTargetDictionary!==void 0&&(this.morphTargetDictionary=Object.assign({},t.morphTargetDictionary)),this.material=t.material,this.geometry=t.geometry,this}updateMorphTargets(){let t=this.geometry.morphAttributes,e=Object.keys(t);if(e.length>0){let i=t[e[0]];if(i!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let r=0,n=i.length;r<n;r++){let s=i[r].name||String(r);this.morphTargetInfluences.push(0),this.morphTargetDictionary[s]=r}}}}getVertexPosition(t,e){let i=this.geometry,r=i.attributes.position,n=i.morphAttributes.position,s=i.morphTargetsRelative;e.fromBufferAttribute(r,t);let a=this.morphTargetInfluences;if(n&&a){SP.set(0,0,0);for(let o=0,l=n.length;o<l;o++){let c=a[o],u=n[o];c!==0&&(JB.fromBufferAttribute(u,t),s?SP.addScaledVector(JB,c):SP.addScaledVector(JB.sub(e),c))}e.add(SP)}return this.isSkinnedMesh&&this.boneTransform(t,e),e}raycast(t,e){let i=this.geometry,r=this.material,n=this.matrixWorld;if(r===void 0||(i.boundingSphere===null&&i.computeBoundingSphere(),QB.copy(i.boundingSphere),QB.applyMatrix4(n),t.ray.intersectsSphere(QB)===!1)||(CZ.copy(n).invert(),Kb.copy(t.ray).applyMatrix4(CZ),i.boundingBox!==null&&Kb.intersectsBox(i.boundingBox)===!1))return;let s,a=i.index,o=i.attributes.position,l=i.attributes.uv,c=i.attributes.uv2,u=i.groups,h=i.drawRange;if(a!==null)if(Array.isArray(r))for(let d=0,f=u.length;d<f;d++){let p=u[d],g=r[p.materialIndex],m=Math.max(p.start,h.start),y=Math.min(a.count,Math.min(p.start+p.count,h.start+h.count));for(let b=m,w=y;b<w;b+=3){let E=a.getX(b),M=a.getX(b+1),A=a.getX(b+2);s=CP(this,g,t,Kb,l,c,E,M,A),s&&(s.faceIndex=Math.floor(b/3),s.face.materialIndex=p.materialIndex,e.push(s))}}else{let d=Math.max(0,h.start),f=Math.min(a.count,h.start+h.count);for(let p=d,g=f;p<g;p+=3){let m=a.getX(p),y=a.getX(p+1),b=a.getX(p+2);s=CP(this,r,t,Kb,l,c,m,y,b),s&&(s.faceIndex=Math.floor(p/3),e.push(s))}}else if(o!==void 0)if(Array.isArray(r))for(let d=0,f=u.length;d<f;d++){let p=u[d],g=r[p.materialIndex],m=Math.max(p.start,h.start),y=Math.min(o.count,Math.min(p.start+p.count,h.start+h.count));for(let b=m,w=y;b<w;b+=3){let E=b,M=b+1,A=b+2;s=CP(this,g,t,Kb,l,c,E,M,A),s&&(s.faceIndex=Math.floor(b/3),s.face.materialIndex=p.materialIndex,e.push(s))}}else{let d=Math.max(0,h.start),f=Math.min(o.count,h.start+h.count);for(let p=d,g=f;p<g;p+=3){let m=p,y=p+1,b=p+2;s=CP(this,r,t,Kb,l,c,m,y,b),s&&(s.faceIndex=Math.floor(p/3),e.push(s))}}}};function hHe(t,e,i,r,n,s,a,o){let l;if(e.side===qa?l=r.intersectTriangle(a,s,n,!0,o):l=r.intersectTriangle(n,s,a,e.side===Ih,o),l===null)return null;TP.copy(o),TP.applyMatrix4(t.matrixWorld);let c=i.ray.origin.distanceTo(TP);return c<i.near||c>i.far?null:{distance:c,point:TP.clone(),object:t}}function CP(t,e,i,r,n,s,a,o,l){t.getVertexPosition(a,lE),t.getVertexPosition(o,cE),t.getVertexPosition(l,uE);let c=hHe(t,e,i,r,lE,cE,uE,eF);if(c){n&&(EP.fromBufferAttribute(n,a),AP.fromBufferAttribute(n,o),MP.fromBufferAttribute(n,l),c.uv=vo.getUV(eF,lE,cE,uE,EP,AP,MP,new Ae)),s&&(EP.fromBufferAttribute(s,a),AP.fromBufferAttribute(s,o),MP.fromBufferAttribute(s,l),c.uv2=vo.getUV(eF,lE,cE,uE,EP,AP,MP,new Ae));let u={a,b:o,c:l,normal:new W,materialIndex:0};vo.getNormal(lE,cE,uE,u.normal),c.face=u}return c}var Oh=class extends oi{constructor(t=1,e=1,i=1,r=1,n=1,s=1){super(),this.type="BoxGeometry",this.parameters={width:t,height:e,depth:i,widthSegments:r,heightSegments:n,depthSegments:s};let a=this;r=Math.floor(r),n=Math.floor(n),s=Math.floor(s);let o=[],l=[],c=[],u=[],h=0,d=0;f("z","y","x",-1,-1,i,e,t,s,n,0),f("z","y","x",1,-1,i,e,-t,s,n,1),f("x","z","y",1,1,t,i,e,r,s,2),f("x","z","y",1,-1,t,i,-e,r,s,3),f("x","y","z",1,-1,t,e,i,r,n,4),f("x","y","z",-1,-1,t,e,-i,r,n,5),this.setIndex(o),this.setAttribute("position",new Gt(l,3)),this.setAttribute("normal",new Gt(c,3)),this.setAttribute("uv",new Gt(u,2));function f(p,g,m,y,b,w,E,M,A,P,C){let R=w/A,I=E/P,k=w/2,z=E/2,V=M/2,F=A+1,$=P+1,K=0,X=0,U=new W;for(let Y=0;Y<$;Y++){let Z=Y*I-z;for(let j=0;j<F;j++){let ee=j*R-k;U[p]=ee*y,U[g]=Z*b,U[m]=V,l.push(U.x,U.y,U.z),U[p]=0,U[g]=0,U[m]=M>0?1:-1,c.push(U.x,U.y,U.z),u.push(j/A),u.push(1-Y/P),K+=1}}for(let Y=0;Y<P;Y++)for(let Z=0;Z<A;Z++){let j=h+Z+F*Y,ee=h+Z+F*(Y+1),pe=h+(Z+1)+F*(Y+1),fe=h+(Z+1)+F*Y;o.push(j,ee,fe),o.push(ee,pe,fe),X+=6}a.addGroup(d,X,C),d+=X,h+=K}}static fromJSON(t){return new Oh(t.width,t.height,t.depth,t.widthSegments,t.heightSegments,t.depthSegments)}};function V1(t){let e={};for(let i in t){e[i]={};for(let r in t[i]){let n=t[i][r];n&&(n.isColor||n.isMatrix3||n.isMatrix4||n.isVector2||n.isVector3||n.isVector4||n.isTexture||n.isQuaternion)?e[i][r]=n.clone():Array.isArray(n)?e[i][r]=n.slice():e[i][r]=n}}return e}function ul(t){let e={};for(let i=0;i<t.length;i++){let r=V1(t[i]);for(let n in r)e[n]=r[n]}return e}function dHe(t){let e=[];for(let i=0;i<t.length;i++)e.push(t[i].clone());return e}function phe(t){return t.getRenderTarget()===null&&t.outputEncoding===er?yd:VD}var A_={clone:V1,merge:ul},fHe=`void main() {
	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,pHe=`void main() {
	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );
}`,Tr=class extends OT{constructor(t){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader=fHe,this.fragmentShader=pHe,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,t!==void 0&&this.setValues(t)}copy(t){return super.copy(t),this.fragmentShader=t.fragmentShader,this.vertexShader=t.vertexShader,this.uniforms=V1(t.uniforms),this.uniformsGroups=dHe(t.uniformsGroups),this.defines=Object.assign({},t.defines),this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.fog=t.fog,this.lights=t.lights,this.clipping=t.clipping,this.extensions=Object.assign({},t.extensions),this.glslVersion=t.glslVersion,this}toJSON(t){let e=super.toJSON(t);e.glslVersion=this.glslVersion,e.uniforms={};for(let r in this.uniforms){let n=this.uniforms[r].value;n&&n.isTexture?e.uniforms[r]={type:"t",value:n.toJSON(t).uuid}:n&&n.isColor?e.uniforms[r]={type:"c",value:n.getHex()}:n&&n.isVector2?e.uniforms[r]={type:"v2",value:n.toArray()}:n&&n.isVector3?e.uniforms[r]={type:"v3",value:n.toArray()}:n&&n.isVector4?e.uniforms[r]={type:"v4",value:n.toArray()}:n&&n.isMatrix3?e.uniforms[r]={type:"m3",value:n.toArray()}:n&&n.isMatrix4?e.uniforms[r]={type:"m4",value:n.toArray()}:e.uniforms[r]={value:n}}Object.keys(this.defines).length>0&&(e.defines=this.defines),e.vertexShader=this.vertexShader,e.fragmentShader=this.fragmentShader;let i={};for(let r in this.extensions)this.extensions[r]===!0&&(i[r]=!0);return Object.keys(i).length>0&&(e.extensions=i),e}},vv=class extends tn{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new St,this.projectionMatrix=new St,this.projectionMatrixInverse=new St}copy(t,e){return super.copy(t,e),this.matrixWorldInverse.copy(t.matrixWorldInverse),this.projectionMatrix.copy(t.projectionMatrix),this.projectionMatrixInverse.copy(t.projectionMatrixInverse),this}getWorldDirection(t){this.updateWorldMatrix(!0,!1);let e=this.matrixWorld.elements;return t.set(-e[8],-e[9],-e[10]).normalize()}updateMatrixWorld(t){super.updateMatrixWorld(t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(t,e){super.updateWorldMatrix(t,e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return new this.constructor().copy(this)}},No=class extends vv{constructor(t=50,e=1,i=.1,r=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=t,this.zoom=1,this.near=i,this.far=r,this.focus=10,this.aspect=e,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(t,e){return super.copy(t,e),this.fov=t.fov,this.zoom=t.zoom,this.near=t.near,this.far=t.far,this.focus=t.focus,this.aspect=t.aspect,this.view=t.view===null?null:Object.assign({},t.view),this.filmGauge=t.filmGauge,this.filmOffset=t.filmOffset,this}setFocalLength(t){let e=.5*this.getFilmHeight()/t;this.fov=TM*2*Math.atan(e),this.updateProjectionMatrix()}getFocalLength(){let t=Math.tan(MA*.5*this.fov);return .5*this.getFilmHeight()/t}getEffectiveFOV(){return TM*2*Math.atan(Math.tan(MA*.5*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}setViewOffset(t,e,i,r,n,s){this.aspect=t/e,this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=e,this.view.offsetX=i,this.view.offsetY=r,this.view.width=n,this.view.height=s,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){let t=this.near,e=t*Math.tan(MA*.5*this.fov)/this.zoom,i=2*e,r=this.aspect*i,n=-.5*r,s=this.view;if(this.view!==null&&this.view.enabled){let o=s.fullWidth,l=s.fullHeight;n+=s.offsetX*r/o,e-=s.offsetY*i/l,r*=s.width/o,i*=s.height/l}let a=this.filmOffset;a!==0&&(n+=t*a/this.getFilmWidth()),this.projectionMatrix.makePerspective(n,n+r,e,e-i,t,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(t){let e=super.toJSON(t);return e.object.fov=this.fov,e.object.zoom=this.zoom,e.object.near=this.near,e.object.far=this.far,e.object.focus=this.focus,e.object.aspect=this.aspect,this.view!==null&&(e.object.view=Object.assign({},this.view)),e.object.filmGauge=this.filmGauge,e.object.filmOffset=this.filmOffset,e}},Zb=-90,Qb=1,mHe=class extends tn{constructor(t,e,i){super(),this.type="CubeCamera",this.renderTarget=i;let r=new No(Zb,Qb,t,e);r.layers=this.layers,r.up.set(0,1,0),r.lookAt(1,0,0),this.add(r);let n=new No(Zb,Qb,t,e);n.layers=this.layers,n.up.set(0,1,0),n.lookAt(-1,0,0),this.add(n);let s=new No(Zb,Qb,t,e);s.layers=this.layers,s.up.set(0,0,-1),s.lookAt(0,1,0),this.add(s);let a=new No(Zb,Qb,t,e);a.layers=this.layers,a.up.set(0,0,1),a.lookAt(0,-1,0),this.add(a);let o=new No(Zb,Qb,t,e);o.layers=this.layers,o.up.set(0,1,0),o.lookAt(0,0,1),this.add(o);let l=new No(Zb,Qb,t,e);l.layers=this.layers,l.up.set(0,1,0),l.lookAt(0,0,-1),this.add(l)}update(t,e){this.parent===null&&this.updateMatrixWorld();let i=this.renderTarget,[r,n,s,a,o,l]=this.children,c=t.getRenderTarget(),u=t.toneMapping,h=t.xr.enabled;t.toneMapping=Gd,t.xr.enabled=!1;let d=i.texture.generateMipmaps;i.texture.generateMipmaps=!1,t.setRenderTarget(i,0),t.render(e,r),t.setRenderTarget(i,1),t.render(e,n),t.setRenderTarget(i,2),t.render(e,s),t.setRenderTarget(i,3),t.render(e,a),t.setRenderTarget(i,4),t.render(e,o),i.texture.generateMipmaps=d,t.setRenderTarget(i,5),t.render(e,l),t.setRenderTarget(c),t.toneMapping=u,t.xr.enabled=h,i.texture.needsPMREMUpdate=!0}},WH=class extends Kn{constructor(t,e,i,r,n,s,a,o,l,c){t=t!==void 0?t:[],e=e!==void 0?e:L0,super(t,e,i,r,n,s,a,o,l,c),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(t){this.image=t}},gHe=class extends Mr{constructor(t=1,e={}){super(t,t,e),this.isWebGLCubeRenderTarget=!0;let i={width:t,height:t,depth:1},r=[i,i,i,i,i,i];this.texture=new WH(r,e.mapping,e.wrapS,e.wrapT,e.magFilter,e.minFilter,e.format,e.type,e.anisotropy,e.encoding),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=e.generateMipmaps!==void 0?e.generateMipmaps:!1,this.texture.minFilter=e.minFilter!==void 0?e.minFilter:nr}fromEquirectangularTexture(t,e){this.texture.type=e.type,this.texture.encoding=e.encoding,this.texture.generateMipmaps=e.generateMipmaps,this.texture.minFilter=e.minFilter,this.texture.magFilter=e.magFilter;let i={uniforms:{tEquirect:{value:null}},vertexShader:`

				varying vec3 vWorldDirection;

				vec3 transformDirection( in vec3 dir, in mat4 matrix ) {

					return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );

				}

				void main() {

					vWorldDirection = transformDirection( position, modelMatrix );

					#include <begin_vertex>
					#include <project_vertex>

				}
			`,fragmentShader:`

				uniform sampler2D tEquirect;

				varying vec3 vWorldDirection;

				#include <common>

				void main() {

					vec3 direction = normalize( vWorldDirection );

					vec2 sampleUV = equirectUv( direction );

					gl_FragColor = texture2D( tEquirect, sampleUV );

				}
			`},r=new Oh(5,5,5),n=new Tr({name:"CubemapFromEquirect",uniforms:V1(i.uniforms),vertexShader:i.vertexShader,fragmentShader:i.fragmentShader,side:qa,blending:Hs});n.uniforms.tEquirect.value=e;let s=new En(r,n),a=e.minFilter;return e.minFilter===j1&&(e.minFilter=nr),new mHe(1,10,this).update(t,s),e.minFilter=a,s.geometry.dispose(),s.material.dispose(),this}clear(t,e,i,r){let n=t.getRenderTarget();for(let s=0;s<6;s++)t.setRenderTarget(this,s),t.clear(e,i,r);t.setRenderTarget(n)}},tF=new W,vHe=new W,yHe=new Vs,$l=class{constructor(t=new W(1,0,0),e=0){this.isPlane=!0,this.normal=t,this.constant=e}set(t,e){return this.normal.copy(t),this.constant=e,this}setComponents(t,e,i,r){return this.normal.set(t,e,i),this.constant=r,this}setFromNormalAndCoplanarPoint(t,e){return this.normal.copy(t),this.constant=-e.dot(this.normal),this}setFromCoplanarPoints(t,e,i){let r=tF.subVectors(i,e).cross(vHe.subVectors(t,e)).normalize();return this.setFromNormalAndCoplanarPoint(r,t),this}copy(t){return this.normal.copy(t.normal),this.constant=t.constant,this}normalize(){let t=1/this.normal.length();return this.normal.multiplyScalar(t),this.constant*=t,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(t){return this.normal.dot(t)+this.constant}distanceToSphere(t){return this.distanceToPoint(t.center)-t.radius}projectPoint(t,e){return e.copy(this.normal).multiplyScalar(-this.distanceToPoint(t)).add(t)}intersectLine(t,e){let i=t.delta(tF),r=this.normal.dot(i);if(r===0)return this.distanceToPoint(t.start)===0?e.copy(t.start):null;let n=-(t.start.dot(this.normal)+this.constant)/r;return n<0||n>1?null:e.copy(i).multiplyScalar(n).add(t.start)}intersectsLine(t){let e=this.distanceToPoint(t.start),i=this.distanceToPoint(t.end);return e<0&&i>0||i<0&&e>0}intersectsBox(t){return t.intersectsPlane(this)}intersectsSphere(t){return t.intersectsPlane(this)}coplanarPoint(t){return t.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(t,e){let i=e||yHe.getNormalMatrix(t),r=this.coplanarPoint(tF).applyMatrix4(t),n=this.normal.applyMatrix3(i).normalize();return this.constant=-r.dot(n),this}translate(t){return this.constant-=t.dot(this.normal),this}equals(t){return t.normal.equals(this.normal)&&t.constant===this.constant}clone(){return new this.constructor().copy(this)}},Jb=new oc,PP=new W,qH=class{constructor(t=new $l,e=new $l,i=new $l,r=new $l,n=new $l,s=new $l){this.planes=[t,e,i,r,n,s]}set(t,e,i,r,n,s){let a=this.planes;return a[0].copy(t),a[1].copy(e),a[2].copy(i),a[3].copy(r),a[4].copy(n),a[5].copy(s),this}copy(t){let e=this.planes;for(let i=0;i<6;i++)e[i].copy(t.planes[i]);return this}setFromProjectionMatrix(t){let e=this.planes,i=t.elements,r=i[0],n=i[1],s=i[2],a=i[3],o=i[4],l=i[5],c=i[6],u=i[7],h=i[8],d=i[9],f=i[10],p=i[11],g=i[12],m=i[13],y=i[14],b=i[15];return e[0].setComponents(a-r,u-o,p-h,b-g).normalize(),e[1].setComponents(a+r,u+o,p+h,b+g).normalize(),e[2].setComponents(a+n,u+l,p+d,b+m).normalize(),e[3].setComponents(a-n,u-l,p-d,b-m).normalize(),e[4].setComponents(a-s,u-c,p-f,b-y).normalize(),e[5].setComponents(a+s,u+c,p+f,b+y).normalize(),this}intersectsObject(t){let e=t.geometry;return e.boundingSphere===null&&e.computeBoundingSphere(),Jb.copy(e.boundingSphere).applyMatrix4(t.matrixWorld),this.intersectsSphere(Jb)}intersectsSprite(t){return Jb.center.set(0,0,0),Jb.radius=.7071067811865476,Jb.applyMatrix4(t.matrixWorld),this.intersectsSphere(Jb)}intersectsSphere(t){let e=this.planes,i=t.center,r=-t.radius;for(let n=0;n<6;n++)if(e[n].distanceToPoint(i)<r)return!1;return!0}intersectsBox(t){let e=this.planes;for(let i=0;i<6;i++){let r=e[i];if(PP.x=r.normal.x>0?t.max.x:t.min.x,PP.y=r.normal.y>0?t.max.y:t.min.y,PP.z=r.normal.z>0?t.max.z:t.min.z,r.distanceToPoint(PP)<0)return!1}return!0}containsPoint(t){let e=this.planes;for(let i=0;i<6;i++)if(e[i].distanceToPoint(t)<0)return!1;return!0}clone(){return new this.constructor().copy(this)}};function mhe(){let t=null,e=!1,i=null,r=null;function n(s,a){i(s,a),r=t.requestAnimationFrame(n)}return{start:function(){e!==!0&&i!==null&&(r=t.requestAnimationFrame(n),e=!0)},stop:function(){t.cancelAnimationFrame(r),e=!1},setAnimationLoop:function(s){i=s},setContext:function(s){t=s}}}function xHe(t,e){let i=e.isWebGL2,r=new WeakMap;function n(c,u){let h=c.array,d=c.usage,f=t.createBuffer();t.bindBuffer(u,f),t.bufferData(u,h,d),c.onUploadCallback();let p;if(h instanceof Float32Array)p=5126;else if(h instanceof Uint16Array)if(c.isFloat16BufferAttribute)if(i)p=5131;else throw new Error("THREE.WebGLAttributes: Usage of Float16BufferAttribute requires WebGL2.");else p=5123;else if(h instanceof Int16Array)p=5122;else if(h instanceof Uint32Array)p=5125;else if(h instanceof Int32Array)p=5124;else if(h instanceof Int8Array)p=5120;else if(h instanceof Uint8Array)p=5121;else if(h instanceof Uint8ClampedArray)p=5121;else throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+h);return{buffer:f,type:p,bytesPerElement:h.BYTES_PER_ELEMENT,version:c.version}}function s(c,u,h){let d=u.array,f=u.updateRange;t.bindBuffer(h,c),f.count===-1?t.bufferSubData(h,0,d):(i?t.bufferSubData(h,f.offset*d.BYTES_PER_ELEMENT,d,f.offset,f.count):t.bufferSubData(h,f.offset*d.BYTES_PER_ELEMENT,d.subarray(f.offset,f.offset+f.count)),f.count=-1),u.onUploadCallback()}function a(c){return c.isInterleavedBufferAttribute&&(c=c.data),r.get(c)}function o(c){c.isInterleavedBufferAttribute&&(c=c.data);let u=r.get(c);u&&(t.deleteBuffer(u.buffer),r.delete(c))}function l(c,u){if(c.isGLBufferAttribute){let d=r.get(c);(!d||d.version<c.version)&&r.set(c,{buffer:c.buffer,type:c.type,bytesPerElement:c.elementSize,version:c.version});return}c.isInterleavedBufferAttribute&&(c=c.data);let h=r.get(c);h===void 0?r.set(c,n(c,u)):h.version<c.version&&(s(h.buffer,c,u),h.version=c.version)}return{get:a,remove:o,update:l}}var ef=class extends oi{constructor(t=1,e=1,i=1,r=1){super(),this.type="PlaneGeometry",this.parameters={width:t,height:e,widthSegments:i,heightSegments:r};let n=t/2,s=e/2,a=Math.floor(i),o=Math.floor(r),l=a+1,c=o+1,u=t/a,h=e/o,d=[],f=[],p=[],g=[];for(let m=0;m<c;m++){let y=m*h-s;for(let b=0;b<l;b++){let w=b*u-n;f.push(w,-y,0),p.push(0,0,1),g.push(b/a),g.push(1-m/o)}}for(let m=0;m<o;m++)for(let y=0;y<a;y++){let b=y+l*m,w=y+l*(m+1),E=y+1+l*(m+1),M=y+1+l*m;d.push(b,w,M),d.push(w,E,M)}this.setIndex(d),this.setAttribute("position",new Gt(f,3)),this.setAttribute("normal",new Gt(p,3)),this.setAttribute("uv",new Gt(g,2))}static fromJSON(t){return new ef(t.width,t.height,t.widthSegments,t.heightSegments)}},bHe=`#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, vUv ).g;
#endif`,wHe=`#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,_He=`#ifdef USE_ALPHATEST
	if ( diffuseColor.a < alphaTest ) discard;
#endif`,SHe=`#ifdef USE_ALPHATEST
	uniform float alphaTest;
#endif`,EHe=`#ifdef USE_AOMAP
	float ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;
	reflectedLight.indirectDiffuse *= ambientOcclusion;
	#if defined( USE_ENVMAP ) && defined( STANDARD )
		float dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );
		reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );
	#endif
#endif`,AHe=`#ifdef USE_AOMAP
	uniform sampler2D aoMap;
	uniform float aoMapIntensity;
#endif`,MHe="vec3 transformed = vec3( position );",THe=`vec3 objectNormal = vec3( normal );
#ifdef USE_TANGENT
	vec3 objectTangent = vec3( tangent.xyz );
#endif`,CHe=`vec3 BRDF_Lambert( const in vec3 diffuseColor ) {
	return RECIPROCAL_PI * diffuseColor;
}
vec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
}
float F_Schlick( const in float f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
}
vec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {
    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );
    float x2 = x * x;
    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );
    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );
}
float V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {
	float a2 = pow2( alpha );
	float gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );
	float gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );
	return 0.5 / max( gv + gl, EPSILON );
}
float D_GGX( const in float alpha, const in float dotNH ) {
	float a2 = pow2( alpha );
	float denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;
	return RECIPROCAL_PI * a2 / pow2( denom );
}
vec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 f0, const in float f90, const in float roughness ) {
	float alpha = pow2( roughness );
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( f0, f90, dotVH );
	float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
	float D = D_GGX( alpha, dotNH );
	return F * ( V * D );
}
#ifdef USE_IRIDESCENCE
	vec3 BRDF_GGX_Iridescence( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 f0, const in float f90, const in float iridescence, const in vec3 iridescenceFresnel, const in float roughness ) {
		float alpha = pow2( roughness );
		vec3 halfDir = normalize( lightDir + viewDir );
		float dotNL = saturate( dot( normal, lightDir ) );
		float dotNV = saturate( dot( normal, viewDir ) );
		float dotNH = saturate( dot( normal, halfDir ) );
		float dotVH = saturate( dot( viewDir, halfDir ) );
		vec3 F = mix( F_Schlick( f0, f90, dotVH ), iridescenceFresnel, iridescence );
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
		return F * ( V * D );
	}
#endif
vec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {
	const float LUT_SIZE = 64.0;
	const float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;
	const float LUT_BIAS = 0.5 / LUT_SIZE;
	float dotNV = saturate( dot( N, V ) );
	vec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );
	uv = uv * LUT_SCALE + LUT_BIAS;
	return uv;
}
float LTC_ClippedSphereFormFactor( const in vec3 f ) {
	float l = length( f );
	return max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );
}
vec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {
	float x = dot( v1, v2 );
	float y = abs( x );
	float a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;
	float b = 3.4175940 + ( 4.1616724 + y ) * y;
	float v = a / b;
	float theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;
	return cross( v1, v2 ) * theta_sintheta;
}
vec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {
	vec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];
	vec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];
	vec3 lightNormal = cross( v1, v2 );
	if( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );
	vec3 T1, T2;
	T1 = normalize( V - N * dot( V, N ) );
	T2 = - cross( N, T1 );
	mat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );
	vec3 coords[ 4 ];
	coords[ 0 ] = mat * ( rectCoords[ 0 ] - P );
	coords[ 1 ] = mat * ( rectCoords[ 1 ] - P );
	coords[ 2 ] = mat * ( rectCoords[ 2 ] - P );
	coords[ 3 ] = mat * ( rectCoords[ 3 ] - P );
	coords[ 0 ] = normalize( coords[ 0 ] );
	coords[ 1 ] = normalize( coords[ 1 ] );
	coords[ 2 ] = normalize( coords[ 2 ] );
	coords[ 3 ] = normalize( coords[ 3 ] );
	vec3 vectorFormFactor = vec3( 0.0 );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );
	float result = LTC_ClippedSphereFormFactor( vectorFormFactor );
	return vec3( result );
}
float G_BlinnPhong_Implicit( ) {
	return 0.25;
}
float D_BlinnPhong( const in float shininess, const in float dotNH ) {
	return RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );
}
vec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( specularColor, 1.0, dotVH );
	float G = G_BlinnPhong_Implicit( );
	float D = D_BlinnPhong( shininess, dotNH );
	return F * ( G * D );
}
#if defined( USE_SHEEN )
float D_Charlie( float roughness, float dotNH ) {
	float alpha = pow2( roughness );
	float invAlpha = 1.0 / alpha;
	float cos2h = dotNH * dotNH;
	float sin2h = max( 1.0 - cos2h, 0.0078125 );
	return ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );
}
float V_Neubelt( float dotNV, float dotNL ) {
	return saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );
}
vec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float D = D_Charlie( sheenRoughness, dotNH );
	float V = V_Neubelt( dotNV, dotNL );
	return sheenColor * ( D * V );
}
#endif`,PHe=`#ifdef USE_IRIDESCENCE
	const mat3 XYZ_TO_REC709 = mat3(
		 3.2404542, -0.9692660,  0.0556434,
		-1.5371385,  1.8760108, -0.2040259,
		-0.4985314,  0.0415560,  1.0572252
	);
	vec3 Fresnel0ToIor( vec3 fresnel0 ) {
		vec3 sqrtF0 = sqrt( fresnel0 );
		return ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );
	}
	vec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );
	}
	float IorToFresnel0( float transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));
	}
	vec3 evalSensitivity( float OPD, vec3 shift ) {
		float phase = 2.0 * PI * OPD * 1.0e-9;
		vec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );
		vec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );
		vec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );
		vec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );
		xyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );
		xyz /= 1.0685e-7;
		vec3 rgb = XYZ_TO_REC709 * xyz;
		return rgb;
	}
	vec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {
		vec3 I;
		float iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );
		float sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );
		float cosTheta2Sq = 1.0 - sinTheta2Sq;
		if ( cosTheta2Sq < 0.0 ) {
			 return vec3( 1.0 );
		}
		float cosTheta2 = sqrt( cosTheta2Sq );
		float R0 = IorToFresnel0( iridescenceIOR, outsideIOR );
		float R12 = F_Schlick( R0, 1.0, cosTheta1 );
		float R21 = R12;
		float T121 = 1.0 - R12;
		float phi12 = 0.0;
		if ( iridescenceIOR < outsideIOR ) phi12 = PI;
		float phi21 = PI - phi12;
		vec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );		vec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );
		vec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );
		vec3 phi23 = vec3( 0.0 );
		if ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;
		if ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;
		if ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;
		float OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;
		vec3 phi = vec3( phi21 ) + phi23;
		vec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );
		vec3 r123 = sqrt( R123 );
		vec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );
		vec3 C0 = R12 + Rs;
		I = C0;
		vec3 Cm = Rs - T121;
		for ( int m = 1; m <= 2; ++ m ) {
			Cm *= r123;
			vec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );
			I += Cm * Sm;
		}
		return max( I, vec3( 0.0 ) );
	}
#endif`,RHe=`#ifdef USE_BUMPMAP
	uniform sampler2D bumpMap;
	uniform float bumpScale;
	vec2 dHdxy_fwd() {
		vec2 dSTdx = dFdx( vUv );
		vec2 dSTdy = dFdy( vUv );
		float Hll = bumpScale * texture2D( bumpMap, vUv ).x;
		float dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;
		float dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;
		return vec2( dBx, dBy );
	}
	vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {
		vec3 vSigmaX = dFdx( surf_pos.xyz );
		vec3 vSigmaY = dFdy( surf_pos.xyz );
		vec3 vN = surf_norm;
		vec3 R1 = cross( vSigmaY, vN );
		vec3 R2 = cross( vN, vSigmaX );
		float fDet = dot( vSigmaX, R1 ) * faceDirection;
		vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );
		return normalize( abs( fDet ) * surf_norm - vGrad );
	}
#endif`,IHe=`#if NUM_CLIPPING_PLANES > 0
	vec4 plane;
	#pragma unroll_loop_start
	for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
		plane = clippingPlanes[ i ];
		if ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;
	}
	#pragma unroll_loop_end
	#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
		bool clipped = true;
		#pragma unroll_loop_start
		for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			clipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;
		}
		#pragma unroll_loop_end
		if ( clipped ) discard;
	#endif
#endif`,DHe=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
	uniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];
#endif`,OHe=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
#endif`,LHe=`#if NUM_CLIPPING_PLANES > 0
	vClipPosition = - mvPosition.xyz;
#endif`,kHe=`#if defined( USE_COLOR_ALPHA )
	diffuseColor *= vColor;
#elif defined( USE_COLOR )
	diffuseColor.rgb *= vColor;
#endif`,NHe=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR )
	varying vec3 vColor;
#endif`,UHe=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	varying vec3 vColor;
#endif`,BHe=`#if defined( USE_COLOR_ALPHA )
	vColor = vec4( 1.0 );
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	vColor = vec3( 1.0 );
#endif
#ifdef USE_COLOR
	vColor *= color;
#endif
#ifdef USE_INSTANCING_COLOR
	vColor.xyz *= instanceColor.xyz;
#endif`,FHe=`#define PI 3.141592653589793
#define PI2 6.283185307179586
#define PI_HALF 1.5707963267948966
#define RECIPROCAL_PI 0.3183098861837907
#define RECIPROCAL_PI2 0.15915494309189535
#define EPSILON 1e-6
#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
#define whiteComplement( a ) ( 1.0 - saturate( a ) )
float pow2( const in float x ) { return x*x; }
vec3 pow2( const in vec3 x ) { return x*x; }
float pow3( const in float x ) { return x*x*x; }
float pow4( const in float x ) { float x2 = x*x; return x2*x2; }
float max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }
float average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }
highp float rand( const in vec2 uv ) {
	const highp float a = 12.9898, b = 78.233, c = 43758.5453;
	highp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );
	return fract( sin( sn ) * c );
}
#ifdef HIGH_PRECISION
	float precisionSafeLength( vec3 v ) { return length( v ); }
#else
	float precisionSafeLength( vec3 v ) {
		float maxComponent = max3( abs( v ) );
		return length( v / maxComponent ) * maxComponent;
	}
#endif
struct IncidentLight {
	vec3 color;
	vec3 direction;
	bool visible;
};
struct ReflectedLight {
	vec3 directDiffuse;
	vec3 directSpecular;
	vec3 indirectDiffuse;
	vec3 indirectSpecular;
};
struct GeometricContext {
	vec3 position;
	vec3 normal;
	vec3 viewDir;
#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal;
#endif
};
vec3 transformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );
}
vec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );
}
mat3 transposeMat3( const in mat3 m ) {
	mat3 tmp;
	tmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );
	tmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );
	tmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );
	return tmp;
}
float luminance( const in vec3 rgb ) {
	const vec3 weights = vec3( 0.2126729, 0.7151522, 0.0721750 );
	return dot( weights, rgb );
}
bool isPerspectiveMatrix( mat4 m ) {
	return m[ 2 ][ 3 ] == - 1.0;
}
vec2 equirectUv( in vec3 dir ) {
	float u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;
	float v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;
	return vec2( u, v );
}`,zHe=`#ifdef ENVMAP_TYPE_CUBE_UV
	#define cubeUV_minMipLevel 4.0
	#define cubeUV_minTileSize 16.0
	float getFace( vec3 direction ) {
		vec3 absDirection = abs( direction );
		float face = - 1.0;
		if ( absDirection.x > absDirection.z ) {
			if ( absDirection.x > absDirection.y )
				face = direction.x > 0.0 ? 0.0 : 3.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		} else {
			if ( absDirection.z > absDirection.y )
				face = direction.z > 0.0 ? 2.0 : 5.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		}
		return face;
	}
	vec2 getUV( vec3 direction, float face ) {
		vec2 uv;
		if ( face == 0.0 ) {
			uv = vec2( direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 1.0 ) {
			uv = vec2( - direction.x, - direction.z ) / abs( direction.y );
		} else if ( face == 2.0 ) {
			uv = vec2( - direction.x, direction.y ) / abs( direction.z );
		} else if ( face == 3.0 ) {
			uv = vec2( - direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 4.0 ) {
			uv = vec2( - direction.x, direction.z ) / abs( direction.y );
		} else {
			uv = vec2( direction.x, direction.y ) / abs( direction.z );
		}
		return 0.5 * ( uv + 1.0 );
	}
	vec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {
		float face = getFace( direction );
		float filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );
		mipInt = max( mipInt, cubeUV_minMipLevel );
		float faceSize = exp2( mipInt );
		highp vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;
		if ( face > 2.0 ) {
			uv.y += faceSize;
			face -= 3.0;
		}
		uv.x += face * faceSize;
		uv.x += filterInt * 3.0 * cubeUV_minTileSize;
		uv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );
		uv.x *= CUBEUV_TEXEL_WIDTH;
		uv.y *= CUBEUV_TEXEL_HEIGHT;
		#ifdef texture2DGradEXT
			return texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;
		#else
			return texture2D( envMap, uv ).rgb;
		#endif
	}
	#define cubeUV_r0 1.0
	#define cubeUV_v0 0.339
	#define cubeUV_m0 - 2.0
	#define cubeUV_r1 0.8
	#define cubeUV_v1 0.276
	#define cubeUV_m1 - 1.0
	#define cubeUV_r4 0.4
	#define cubeUV_v4 0.046
	#define cubeUV_m4 2.0
	#define cubeUV_r5 0.305
	#define cubeUV_v5 0.016
	#define cubeUV_m5 3.0
	#define cubeUV_r6 0.21
	#define cubeUV_v6 0.0038
	#define cubeUV_m6 4.0
	float roughnessToMip( float roughness ) {
		float mip = 0.0;
		if ( roughness >= cubeUV_r1 ) {
			mip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;
		} else if ( roughness >= cubeUV_r4 ) {
			mip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;
		} else if ( roughness >= cubeUV_r5 ) {
			mip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;
		} else if ( roughness >= cubeUV_r6 ) {
			mip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;
		} else {
			mip = - 2.0 * log2( 1.16 * roughness );		}
		return mip;
	}
	vec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {
		float mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );
		float mipF = fract( mip );
		float mipInt = floor( mip );
		vec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );
		if ( mipF == 0.0 ) {
			return vec4( color0, 1.0 );
		} else {
			vec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );
			return vec4( mix( color0, color1, mipF ), 1.0 );
		}
	}
#endif`,jHe=`vec3 transformedNormal = objectNormal;
#ifdef USE_INSTANCING
	mat3 m = mat3( instanceMatrix );
	transformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );
	transformedNormal = m * transformedNormal;
#endif
transformedNormal = normalMatrix * transformedNormal;
#ifdef FLIP_SIDED
	transformedNormal = - transformedNormal;
#endif
#ifdef USE_TANGENT
	vec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#ifdef FLIP_SIDED
		transformedTangent = - transformedTangent;
	#endif
#endif`,VHe=`#ifdef USE_DISPLACEMENTMAP
	uniform sampler2D displacementMap;
	uniform float displacementScale;
	uniform float displacementBias;
#endif`,HHe=`#ifdef USE_DISPLACEMENTMAP
	transformed += normalize( objectNormal ) * ( texture2D( displacementMap, vUv ).x * displacementScale + displacementBias );
#endif`,GHe=`#ifdef USE_EMISSIVEMAP
	vec4 emissiveColor = texture2D( emissiveMap, vUv );
	totalEmissiveRadiance *= emissiveColor.rgb;
#endif`,WHe=`#ifdef USE_EMISSIVEMAP
	uniform sampler2D emissiveMap;
#endif`,qHe="gl_FragColor = linearToOutputTexel( gl_FragColor );",XHe=`vec4 LinearToLinear( in vec4 value ) {
	return value;
}
vec4 LinearTosRGB( in vec4 value ) {
	return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );
}`,$He=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vec3 cameraToFrag;
		if ( isOrthographic ) {
			cameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToFrag = normalize( vWorldPosition - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vec3 reflectVec = reflect( cameraToFrag, worldNormal );
		#else
			vec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );
		#endif
	#else
		vec3 reflectVec = vReflect;
	#endif
	#ifdef ENVMAP_TYPE_CUBE
		vec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );
	#else
		vec4 envColor = vec4( 0.0 );
	#endif
	#ifdef ENVMAP_BLENDING_MULTIPLY
		outgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_MIX )
		outgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_ADD )
		outgoingLight += envColor.xyz * specularStrength * reflectivity;
	#endif
#endif`,YHe=`#ifdef USE_ENVMAP
	uniform float envMapIntensity;
	uniform float flipEnvMap;
	#ifdef ENVMAP_TYPE_CUBE
		uniform samplerCube envMap;
	#else
		uniform sampler2D envMap;
	#endif
	
#endif`,KHe=`#ifdef USE_ENVMAP
	uniform float reflectivity;
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		varying vec3 vWorldPosition;
		uniform float refractionRatio;
	#else
		varying vec3 vReflect;
	#endif
#endif`,ZHe=`#ifdef USE_ENVMAP
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		
		varying vec3 vWorldPosition;
	#else
		varying vec3 vReflect;
		uniform float refractionRatio;
	#endif
#endif`,QHe=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vWorldPosition = worldPosition.xyz;
	#else
		vec3 cameraToVertex;
		if ( isOrthographic ) {
			cameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToVertex = normalize( worldPosition.xyz - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vReflect = reflect( cameraToVertex, worldNormal );
		#else
			vReflect = refract( cameraToVertex, worldNormal, refractionRatio );
		#endif
	#endif
#endif`,JHe=`#ifdef USE_FOG
	vFogDepth = - mvPosition.z;
#endif`,eGe=`#ifdef USE_FOG
	varying float vFogDepth;
#endif`,tGe=`#ifdef USE_FOG
	#ifdef FOG_EXP2
		float fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );
	#else
		float fogFactor = smoothstep( fogNear, fogFar, vFogDepth );
	#endif
	gl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );
#endif`,iGe=`#ifdef USE_FOG
	uniform vec3 fogColor;
	varying float vFogDepth;
	#ifdef FOG_EXP2
		uniform float fogDensity;
	#else
		uniform float fogNear;
		uniform float fogFar;
	#endif
#endif`,rGe=`#ifdef USE_GRADIENTMAP
	uniform sampler2D gradientMap;
#endif
vec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {
	float dotNL = dot( normal, lightDirection );
	vec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );
	#ifdef USE_GRADIENTMAP
		return vec3( texture2D( gradientMap, coord ).r );
	#else
		vec2 fw = fwidth( coord ) * 0.5;
		return mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );
	#endif
}`,nGe=`#ifdef USE_LIGHTMAP
	vec4 lightMapTexel = texture2D( lightMap, vUv2 );
	vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
	reflectedLight.indirectDiffuse += lightMapIrradiance;
#endif`,sGe=`#ifdef USE_LIGHTMAP
	uniform sampler2D lightMap;
	uniform float lightMapIntensity;
#endif`,aGe=`LambertMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularStrength = specularStrength;`,oGe=`varying vec3 vViewPosition;
struct LambertMaterial {
	vec3 diffuseColor;
	float specularStrength;
};
void RE_Direct_Lambert( const in IncidentLight directLight, const in GeometricContext geometry, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in GeometricContext geometry, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Lambert
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Lambert`,lGe=`uniform bool receiveShadow;
uniform vec3 ambientLightColor;
uniform vec3 lightProbe[ 9 ];
vec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {
	float x = normal.x, y = normal.y, z = normal.z;
	vec3 result = shCoefficients[ 0 ] * 0.886227;
	result += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;
	result += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;
	result += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;
	result += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;
	result += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;
	result += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );
	result += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;
	result += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );
	return result;
}
vec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {
	vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
	vec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );
	return irradiance;
}
vec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {
	vec3 irradiance = ambientLightColor;
	return irradiance;
}
float getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {
	#if defined ( PHYSICALLY_CORRECT_LIGHTS )
		float distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );
		if ( cutoffDistance > 0.0 ) {
			distanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );
		}
		return distanceFalloff;
	#else
		if ( cutoffDistance > 0.0 && decayExponent > 0.0 ) {
			return pow( saturate( - lightDistance / cutoffDistance + 1.0 ), decayExponent );
		}
		return 1.0;
	#endif
}
float getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {
	return smoothstep( coneCosine, penumbraCosine, angleCosine );
}
#if NUM_DIR_LIGHTS > 0
	struct DirectionalLight {
		vec3 direction;
		vec3 color;
	};
	uniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];
	void getDirectionalLightInfo( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight light ) {
		light.color = directionalLight.color;
		light.direction = directionalLight.direction;
		light.visible = true;
	}
#endif
#if NUM_POINT_LIGHTS > 0
	struct PointLight {
		vec3 position;
		vec3 color;
		float distance;
		float decay;
	};
	uniform PointLight pointLights[ NUM_POINT_LIGHTS ];
	void getPointLightInfo( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight light ) {
		vec3 lVector = pointLight.position - geometry.position;
		light.direction = normalize( lVector );
		float lightDistance = length( lVector );
		light.color = pointLight.color;
		light.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );
		light.visible = ( light.color != vec3( 0.0 ) );
	}
#endif
#if NUM_SPOT_LIGHTS > 0
	struct SpotLight {
		vec3 position;
		vec3 direction;
		vec3 color;
		float distance;
		float decay;
		float coneCos;
		float penumbraCos;
	};
	uniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];
	void getSpotLightInfo( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight light ) {
		vec3 lVector = spotLight.position - geometry.position;
		light.direction = normalize( lVector );
		float angleCos = dot( light.direction, spotLight.direction );
		float spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );
		if ( spotAttenuation > 0.0 ) {
			float lightDistance = length( lVector );
			light.color = spotLight.color * spotAttenuation;
			light.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );
			light.visible = ( light.color != vec3( 0.0 ) );
		} else {
			light.color = vec3( 0.0 );
			light.visible = false;
		}
	}
#endif
#if NUM_RECT_AREA_LIGHTS > 0
	struct RectAreaLight {
		vec3 color;
		vec3 position;
		vec3 halfWidth;
		vec3 halfHeight;
	};
	uniform sampler2D ltc_1;	uniform sampler2D ltc_2;
	uniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];
#endif
#if NUM_HEMI_LIGHTS > 0
	struct HemisphereLight {
		vec3 direction;
		vec3 skyColor;
		vec3 groundColor;
	};
	uniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];
	vec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {
		float dotNL = dot( normal, hemiLight.direction );
		float hemiDiffuseWeight = 0.5 * dotNL + 0.5;
		vec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );
		return irradiance;
	}
#endif`,cGe=`#if defined( USE_ENVMAP )
	vec3 getIBLIrradiance( const in vec3 normal ) {
		#if defined( ENVMAP_TYPE_CUBE_UV )
			vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );
			return PI * envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	vec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {
		#if defined( ENVMAP_TYPE_CUBE_UV )
			vec3 reflectVec = reflect( - viewDir, normal );
			reflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );
			reflectVec = inverseTransformDirection( reflectVec, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );
			return envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
#endif`,uGe=`ToonMaterial material;
material.diffuseColor = diffuseColor.rgb;`,hGe=`varying vec3 vViewPosition;
struct ToonMaterial {
	vec3 diffuseColor;
};
void RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	vec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Toon
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Toon`,dGe=`BlinnPhongMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularColor = specular;
material.specularShininess = shininess;
material.specularStrength = specularStrength;`,fGe=`varying vec3 vViewPosition;
struct BlinnPhongMaterial {
	vec3 diffuseColor;
	vec3 specularColor;
	float specularShininess;
	float specularStrength;
};
void RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
	reflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularShininess ) * material.specularStrength;
}
void RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_BlinnPhong
#define RE_IndirectDiffuse		RE_IndirectDiffuse_BlinnPhong`,pGe=`PhysicalMaterial material;
material.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );
vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );
float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );
material.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;
material.roughness = min( material.roughness, 1.0 );
#ifdef IOR
	material.ior = ior;
	#ifdef SPECULAR
		float specularIntensityFactor = specularIntensity;
		vec3 specularColorFactor = specularColor;
		#ifdef USE_SPECULARINTENSITYMAP
			specularIntensityFactor *= texture2D( specularIntensityMap, vUv ).a;
		#endif
		#ifdef USE_SPECULARCOLORMAP
			specularColorFactor *= texture2D( specularColorMap, vUv ).rgb;
		#endif
		material.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );
	#else
		float specularIntensityFactor = 1.0;
		vec3 specularColorFactor = vec3( 1.0 );
		material.specularF90 = 1.0;
	#endif
	material.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );
#else
	material.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );
	material.specularF90 = 1.0;
#endif
#ifdef USE_CLEARCOAT
	material.clearcoat = clearcoat;
	material.clearcoatRoughness = clearcoatRoughness;
	material.clearcoatF0 = vec3( 0.04 );
	material.clearcoatF90 = 1.0;
	#ifdef USE_CLEARCOATMAP
		material.clearcoat *= texture2D( clearcoatMap, vUv ).x;
	#endif
	#ifdef USE_CLEARCOAT_ROUGHNESSMAP
		material.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vUv ).y;
	#endif
	material.clearcoat = saturate( material.clearcoat );	material.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );
	material.clearcoatRoughness += geometryRoughness;
	material.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );
#endif
#ifdef USE_IRIDESCENCE
	material.iridescence = iridescence;
	material.iridescenceIOR = iridescenceIOR;
	#ifdef USE_IRIDESCENCEMAP
		material.iridescence *= texture2D( iridescenceMap, vUv ).r;
	#endif
	#ifdef USE_IRIDESCENCE_THICKNESSMAP
		material.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vUv ).g + iridescenceThicknessMinimum;
	#else
		material.iridescenceThickness = iridescenceThicknessMaximum;
	#endif
#endif
#ifdef USE_SHEEN
	material.sheenColor = sheenColor;
	#ifdef USE_SHEENCOLORMAP
		material.sheenColor *= texture2D( sheenColorMap, vUv ).rgb;
	#endif
	material.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );
	#ifdef USE_SHEENROUGHNESSMAP
		material.sheenRoughness *= texture2D( sheenRoughnessMap, vUv ).a;
	#endif
#endif`,mGe=`struct PhysicalMaterial {
	vec3 diffuseColor;
	float roughness;
	vec3 specularColor;
	float specularF90;
	#ifdef USE_CLEARCOAT
		float clearcoat;
		float clearcoatRoughness;
		vec3 clearcoatF0;
		float clearcoatF90;
	#endif
	#ifdef USE_IRIDESCENCE
		float iridescence;
		float iridescenceIOR;
		float iridescenceThickness;
		vec3 iridescenceFresnel;
		vec3 iridescenceF0;
	#endif
	#ifdef USE_SHEEN
		vec3 sheenColor;
		float sheenRoughness;
	#endif
	#ifdef IOR
		float ior;
	#endif
	#ifdef USE_TRANSMISSION
		float transmission;
		float transmissionAlpha;
		float thickness;
		float attenuationDistance;
		vec3 attenuationColor;
	#endif
};
vec3 clearcoatSpecular = vec3( 0.0 );
vec3 sheenSpecular = vec3( 0.0 );
float IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	float r2 = roughness * roughness;
	float a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;
	float b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;
	float DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );
	return saturate( DG * RECIPROCAL_PI );
}
vec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	const vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );
	const vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );
	vec4 r = roughness * c0 + c1;
	float a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;
	vec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;
	return fab;
}
vec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	return specularColor * fab.x + specularF90 * fab.y;
}
#ifdef USE_IRIDESCENCE
void computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#else
void computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#endif
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	#ifdef USE_IRIDESCENCE
		vec3 Fr = mix( specularColor, iridescenceF0, iridescence );
	#else
		vec3 Fr = specularColor;
	#endif
	vec3 FssEss = Fr * fab.x + specularF90 * fab.y;
	float Ess = fab.x + fab.y;
	float Ems = 1.0 - Ess;
	vec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;	vec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );
	singleScatter += FssEss;
	multiScatter += Fms * Ems;
}
#if NUM_RECT_AREA_LIGHTS > 0
	void RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
		vec3 normal = geometry.normal;
		vec3 viewDir = geometry.viewDir;
		vec3 position = geometry.position;
		vec3 lightPos = rectAreaLight.position;
		vec3 halfWidth = rectAreaLight.halfWidth;
		vec3 halfHeight = rectAreaLight.halfHeight;
		vec3 lightColor = rectAreaLight.color;
		float roughness = material.roughness;
		vec3 rectCoords[ 4 ];
		rectCoords[ 0 ] = lightPos + halfWidth - halfHeight;		rectCoords[ 1 ] = lightPos - halfWidth - halfHeight;
		rectCoords[ 2 ] = lightPos - halfWidth + halfHeight;
		rectCoords[ 3 ] = lightPos + halfWidth + halfHeight;
		vec2 uv = LTC_Uv( normal, viewDir, roughness );
		vec4 t1 = texture2D( ltc_1, uv );
		vec4 t2 = texture2D( ltc_2, uv );
		mat3 mInv = mat3(
			vec3( t1.x, 0, t1.y ),
			vec3(    0, 1,    0 ),
			vec3( t1.z, 0, t1.w )
		);
		vec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );
		reflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );
		reflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );
	}
#endif
void RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	#ifdef USE_CLEARCOAT
		float dotNLcc = saturate( dot( geometry.clearcoatNormal, directLight.direction ) );
		vec3 ccIrradiance = dotNLcc * directLight.color;
		clearcoatSpecular += ccIrradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.clearcoatNormal, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );
	#endif
	#ifdef USE_SHEEN
		sheenSpecular += irradiance * BRDF_Sheen( directLight.direction, geometry.viewDir, geometry.normal, material.sheenColor, material.sheenRoughness );
	#endif
	#ifdef USE_IRIDESCENCE
		reflectedLight.directSpecular += irradiance * BRDF_GGX_Iridescence( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness );
	#else
		reflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularF90, material.roughness );
	#endif
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {
	#ifdef USE_CLEARCOAT
		clearcoatSpecular += clearcoatRadiance * EnvironmentBRDF( geometry.clearcoatNormal, geometry.viewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );
	#endif
	#ifdef USE_SHEEN
		sheenSpecular += irradiance * material.sheenColor * IBLSheenBRDF( geometry.normal, geometry.viewDir, material.sheenRoughness );
	#endif
	vec3 singleScattering = vec3( 0.0 );
	vec3 multiScattering = vec3( 0.0 );
	vec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;
	#ifdef USE_IRIDESCENCE
		computeMultiscatteringIridescence( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );
	#else
		computeMultiscattering( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );
	#endif
	vec3 totalScattering = singleScattering + multiScattering;
	vec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );
	reflectedLight.indirectSpecular += radiance * singleScattering;
	reflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;
	reflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;
}
#define RE_Direct				RE_Direct_Physical
#define RE_Direct_RectArea		RE_Direct_RectArea_Physical
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Physical
#define RE_IndirectSpecular		RE_IndirectSpecular_Physical
float computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {
	return saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );
}`,gGe=`
GeometricContext geometry;
geometry.position = - vViewPosition;
geometry.normal = normal;
geometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );
#ifdef USE_CLEARCOAT
	geometry.clearcoatNormal = clearcoatNormal;
#endif
#ifdef USE_IRIDESCENCE
	float dotNVi = saturate( dot( normal, geometry.viewDir ) );
	if ( material.iridescenceThickness == 0.0 ) {
		material.iridescence = 0.0;
	} else {
		material.iridescence = saturate( material.iridescence );
	}
	if ( material.iridescence > 0.0 ) {
		material.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );
		material.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );
	}
#endif
IncidentLight directLight;
#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )
	PointLight pointLight;
	#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		pointLight = pointLights[ i ];
		getPointLightInfo( pointLight, geometry, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )
		pointLightShadow = pointLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )
	SpotLight spotLight;
	vec4 spotColor;
	vec3 spotLightCoord;
	bool inSpotLightMap;
	#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		spotLight = spotLights[ i ];
		getSpotLightInfo( spotLight, geometry, directLight );
		#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX
		#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS
		#else
		#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#endif
		#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )
			spotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;
			inSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );
			spotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );
			directLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;
		#endif
		#undef SPOT_LIGHT_MAP_INDEX
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		spotLightShadow = spotLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )
	DirectionalLight directionalLight;
	#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		directionalLight = directionalLights[ i ];
		getDirectionalLightInfo( directionalLight, geometry, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )
		directionalLightShadow = directionalLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )
	RectAreaLight rectAreaLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {
		rectAreaLight = rectAreaLights[ i ];
		RE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if defined( RE_IndirectDiffuse )
	vec3 iblIrradiance = vec3( 0.0 );
	vec3 irradiance = getAmbientLightIrradiance( ambientLightColor );
	irradiance += getLightProbeIrradiance( lightProbe, geometry.normal );
	#if ( NUM_HEMI_LIGHTS > 0 )
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
			irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );
		}
		#pragma unroll_loop_end
	#endif
#endif
#if defined( RE_IndirectSpecular )
	vec3 radiance = vec3( 0.0 );
	vec3 clearcoatRadiance = vec3( 0.0 );
#endif`,vGe=`#if defined( RE_IndirectDiffuse )
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vUv2 );
		vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
		irradiance += lightMapIrradiance;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )
		iblIrradiance += getIBLIrradiance( geometry.normal );
	#endif
#endif
#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )
	radiance += getIBLRadiance( geometry.viewDir, geometry.normal, material.roughness );
	#ifdef USE_CLEARCOAT
		clearcoatRadiance += getIBLRadiance( geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness );
	#endif
#endif`,yGe=`#if defined( RE_IndirectDiffuse )
	RE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );
#endif
#if defined( RE_IndirectSpecular )
	RE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );
#endif`,xGe=`#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )
	gl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;
#endif`,bGe=`#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )
	uniform float logDepthBufFC;
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,wGe=`#ifdef USE_LOGDEPTHBUF
	#ifdef USE_LOGDEPTHBUF_EXT
		varying float vFragDepth;
		varying float vIsPerspective;
	#else
		uniform float logDepthBufFC;
	#endif
#endif`,_Ge=`#ifdef USE_LOGDEPTHBUF
	#ifdef USE_LOGDEPTHBUF_EXT
		vFragDepth = 1.0 + gl_Position.w;
		vIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );
	#else
		if ( isPerspectiveMatrix( projectionMatrix ) ) {
			gl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;
			gl_Position.z *= gl_Position.w;
		}
	#endif
#endif`,SGe=`#ifdef USE_MAP
	vec4 sampledDiffuseColor = texture2D( map, vUv );
	#ifdef DECODE_VIDEO_TEXTURE
		sampledDiffuseColor = vec4( mix( pow( sampledDiffuseColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), sampledDiffuseColor.rgb * 0.0773993808, vec3( lessThanEqual( sampledDiffuseColor.rgb, vec3( 0.04045 ) ) ) ), sampledDiffuseColor.w );
	#endif
	diffuseColor *= sampledDiffuseColor;
#endif`,EGe=`#ifdef USE_MAP
	uniform sampler2D map;
#endif`,AGe=`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	vec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;
#endif
#ifdef USE_MAP
	diffuseColor *= texture2D( map, uv );
#endif
#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, uv ).g;
#endif`,MGe=`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	uniform mat3 uvTransform;
#endif
#ifdef USE_MAP
	uniform sampler2D map;
#endif
#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,TGe=`float metalnessFactor = metalness;
#ifdef USE_METALNESSMAP
	vec4 texelMetalness = texture2D( metalnessMap, vUv );
	metalnessFactor *= texelMetalness.b;
#endif`,CGe=`#ifdef USE_METALNESSMAP
	uniform sampler2D metalnessMap;
#endif`,PGe=`#if defined( USE_MORPHCOLORS ) && defined( MORPHTARGETS_TEXTURE )
	vColor *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		#if defined( USE_COLOR_ALPHA )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];
		#elif defined( USE_COLOR )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];
		#endif
	}
#endif`,RGe=`#ifdef USE_MORPHNORMALS
	objectNormal *= morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
			if ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];
		}
	#else
		objectNormal += morphNormal0 * morphTargetInfluences[ 0 ];
		objectNormal += morphNormal1 * morphTargetInfluences[ 1 ];
		objectNormal += morphNormal2 * morphTargetInfluences[ 2 ];
		objectNormal += morphNormal3 * morphTargetInfluences[ 3 ];
	#endif
#endif`,IGe=`#ifdef USE_MORPHTARGETS
	uniform float morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		uniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];
		uniform sampler2DArray morphTargetsTexture;
		uniform ivec2 morphTargetsTextureSize;
		vec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {
			int texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;
			int y = texelIndex / morphTargetsTextureSize.x;
			int x = texelIndex - y * morphTargetsTextureSize.x;
			ivec3 morphUV = ivec3( x, y, morphTargetIndex );
			return texelFetch( morphTargetsTexture, morphUV, 0 );
		}
	#else
		#ifndef USE_MORPHNORMALS
			uniform float morphTargetInfluences[ 8 ];
		#else
			uniform float morphTargetInfluences[ 4 ];
		#endif
	#endif
#endif`,DGe=`#ifdef USE_MORPHTARGETS
	transformed *= morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
			if ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];
		}
	#else
		transformed += morphTarget0 * morphTargetInfluences[ 0 ];
		transformed += morphTarget1 * morphTargetInfluences[ 1 ];
		transformed += morphTarget2 * morphTargetInfluences[ 2 ];
		transformed += morphTarget3 * morphTargetInfluences[ 3 ];
		#ifndef USE_MORPHNORMALS
			transformed += morphTarget4 * morphTargetInfluences[ 4 ];
			transformed += morphTarget5 * morphTargetInfluences[ 5 ];
			transformed += morphTarget6 * morphTargetInfluences[ 6 ];
			transformed += morphTarget7 * morphTargetInfluences[ 7 ];
		#endif
	#endif
#endif`,OGe=`float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;
#ifdef FLAT_SHADED
	vec3 fdx = dFdx( vViewPosition );
	vec3 fdy = dFdy( vViewPosition );
	vec3 normal = normalize( cross( fdx, fdy ) );
#else
	vec3 normal = normalize( vNormal );
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	#ifdef USE_TANGENT
		vec3 tangent = normalize( vTangent );
		vec3 bitangent = normalize( vBitangent );
		#ifdef DOUBLE_SIDED
			tangent = tangent * faceDirection;
			bitangent = bitangent * faceDirection;
		#endif
		#if defined( TANGENTSPACE_NORMALMAP ) || defined( USE_CLEARCOAT_NORMALMAP )
			mat3 vTBN = mat3( tangent, bitangent, normal );
		#endif
	#endif
#endif
vec3 geometryNormal = normal;`,LGe=`#ifdef OBJECTSPACE_NORMALMAP
	normal = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;
	#ifdef FLIP_SIDED
		normal = - normal;
	#endif
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	normal = normalize( normalMatrix * normal );
#elif defined( TANGENTSPACE_NORMALMAP )
	vec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;
	mapN.xy *= normalScale;
	#ifdef USE_TANGENT
		normal = normalize( vTBN * mapN );
	#else
		normal = perturbNormal2Arb( - vViewPosition, normal, mapN, faceDirection );
	#endif
#elif defined( USE_BUMPMAP )
	normal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );
#endif`,kGe=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,NGe=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,UGe=`#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
	#ifdef USE_TANGENT
		vTangent = normalize( transformedTangent );
		vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );
	#endif
#endif`,BGe=`#ifdef USE_NORMALMAP
	uniform sampler2D normalMap;
	uniform vec2 normalScale;
#endif
#ifdef OBJECTSPACE_NORMALMAP
	uniform mat3 normalMatrix;
#endif
#if ! defined ( USE_TANGENT ) && ( defined ( TANGENTSPACE_NORMALMAP ) || defined ( USE_CLEARCOAT_NORMALMAP ) )
	vec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm, vec3 mapN, float faceDirection ) {
		vec3 q0 = dFdx( eye_pos.xyz );
		vec3 q1 = dFdy( eye_pos.xyz );
		vec2 st0 = dFdx( vUv.st );
		vec2 st1 = dFdy( vUv.st );
		vec3 N = surf_norm;
		vec3 q1perp = cross( q1, N );
		vec3 q0perp = cross( N, q0 );
		vec3 T = q1perp * st0.x + q0perp * st1.x;
		vec3 B = q1perp * st0.y + q0perp * st1.y;
		float det = max( dot( T, T ), dot( B, B ) );
		float scale = ( det == 0.0 ) ? 0.0 : faceDirection * inversesqrt( det );
		return normalize( T * ( mapN.x * scale ) + B * ( mapN.y * scale ) + N * mapN.z );
	}
#endif`,FGe=`#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal = geometryNormal;
#endif`,zGe=`#ifdef USE_CLEARCOAT_NORMALMAP
	vec3 clearcoatMapN = texture2D( clearcoatNormalMap, vUv ).xyz * 2.0 - 1.0;
	clearcoatMapN.xy *= clearcoatNormalScale;
	#ifdef USE_TANGENT
		clearcoatNormal = normalize( vTBN * clearcoatMapN );
	#else
		clearcoatNormal = perturbNormal2Arb( - vViewPosition, clearcoatNormal, clearcoatMapN, faceDirection );
	#endif
#endif`,jGe=`#ifdef USE_CLEARCOATMAP
	uniform sampler2D clearcoatMap;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform sampler2D clearcoatRoughnessMap;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform sampler2D clearcoatNormalMap;
	uniform vec2 clearcoatNormalScale;
#endif`,VGe=`#ifdef USE_IRIDESCENCEMAP
	uniform sampler2D iridescenceMap;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform sampler2D iridescenceThicknessMap;
#endif`,HGe=`#ifdef OPAQUE
diffuseColor.a = 1.0;
#endif
#ifdef USE_TRANSMISSION
diffuseColor.a *= material.transmissionAlpha + 0.1;
#endif
gl_FragColor = vec4( outgoingLight, diffuseColor.a );`,GGe=`vec3 packNormalToRGB( const in vec3 normal ) {
	return normalize( normal ) * 0.5 + 0.5;
}
vec3 unpackRGBToNormal( const in vec3 rgb ) {
	return 2.0 * rgb.xyz - 1.0;
}
const float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;
const vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );
const vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );
const float ShiftRight8 = 1. / 256.;
vec4 packDepthToRGBA( const in float v ) {
	vec4 r = vec4( fract( v * PackFactors ), v );
	r.yzw -= r.xyz * ShiftRight8;	return r * PackUpscale;
}
float unpackRGBAToDepth( const in vec4 v ) {
	return dot( v, UnpackFactors );
}
vec2 packDepthToRG( in highp float v ) {
	return packDepthToRGBA( v ).yx;
}
float unpackRGToDepth( const in highp vec2 v ) {
	return unpackRGBAToDepth( vec4( v.xy, 0.0, 0.0 ) );
}
vec4 pack2HalfToRGBA( vec2 v ) {
	vec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );
	return vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );
}
vec2 unpackRGBATo2Half( vec4 v ) {
	return vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );
}
float viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {
	return ( viewZ + near ) / ( near - far );
}
float orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {
	return linearClipZ * ( near - far ) - near;
}
float viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {
	return ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );
}
float perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {
	return ( near * far ) / ( ( far - near ) * invClipZ - far );
}`,WGe=`#ifdef PREMULTIPLIED_ALPHA
	gl_FragColor.rgb *= gl_FragColor.a;
#endif`,qGe=`vec4 mvPosition = vec4( transformed, 1.0 );
#ifdef USE_INSTANCING
	mvPosition = instanceMatrix * mvPosition;
#endif
mvPosition = modelViewMatrix * mvPosition;
gl_Position = projectionMatrix * mvPosition;`,XGe=`#ifdef DITHERING
	gl_FragColor.rgb = dithering( gl_FragColor.rgb );
#endif`,$Ge=`#ifdef DITHERING
	vec3 dithering( vec3 color ) {
		float grid_position = rand( gl_FragCoord.xy );
		vec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );
		dither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );
		return color + dither_shift_RGB;
	}
#endif`,YGe=`float roughnessFactor = roughness;
#ifdef USE_ROUGHNESSMAP
	vec4 texelRoughness = texture2D( roughnessMap, vUv );
	roughnessFactor *= texelRoughness.g;
#endif`,KGe=`#ifdef USE_ROUGHNESSMAP
	uniform sampler2D roughnessMap;
#endif`,ZGe=`#if NUM_SPOT_LIGHT_COORDS > 0
  varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#if NUM_SPOT_LIGHT_MAPS > 0
  uniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
	float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {
		return step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );
	}
	vec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {
		return unpackRGBATo2Half( texture2D( shadow, uv ) );
	}
	float VSMShadow (sampler2D shadow, vec2 uv, float compare ){
		float occlusion = 1.0;
		vec2 distribution = texture2DDistribution( shadow, uv );
		float hard_shadow = step( compare , distribution.x );
		if (hard_shadow != 1.0 ) {
			float distance = compare - distribution.x ;
			float variance = max( 0.00000, distribution.y * distribution.y );
			float softness_probability = variance / (variance + distance * distance );			softness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );			occlusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );
		}
		return occlusion;
	}
	float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {
		float shadow = 1.0;
		shadowCoord.xyz /= shadowCoord.w;
		shadowCoord.z += shadowBias;
		bool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;
		bool frustumTest = inFrustum && shadowCoord.z <= 1.0;
		if ( frustumTest ) {
		#if defined( SHADOWMAP_TYPE_PCF )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx0 = - texelSize.x * shadowRadius;
			float dy0 = - texelSize.y * shadowRadius;
			float dx1 = + texelSize.x * shadowRadius;
			float dy1 = + texelSize.y * shadowRadius;
			float dx2 = dx0 / 2.0;
			float dy2 = dy0 / 2.0;
			float dx3 = dx1 / 2.0;
			float dy3 = dy1 / 2.0;
			shadow = (
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )
			) * ( 1.0 / 17.0 );
		#elif defined( SHADOWMAP_TYPE_PCF_SOFT )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx = texelSize.x;
			float dy = texelSize.y;
			vec2 uv = shadowCoord.xy;
			vec2 f = fract( uv * shadowMapSize + 0.5 );
			uv -= f * texelSize;
			shadow = (
				texture2DCompare( shadowMap, uv, shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),
						  f.x ),
					 mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),
						  f.x ),
					 f.y )
			) * ( 1.0 / 9.0 );
		#elif defined( SHADOWMAP_TYPE_VSM )
			shadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );
		#else
			shadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );
		#endif
		}
		return shadow;
	}
	vec2 cubeToUV( vec3 v, float texelSizeY ) {
		vec3 absV = abs( v );
		float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );
		absV *= scaleToCube;
		v *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );
		vec2 planar = v.xy;
		float almostATexel = 1.5 * texelSizeY;
		float almostOne = 1.0 - almostATexel;
		if ( absV.z >= almostOne ) {
			if ( v.z > 0.0 )
				planar.x = 4.0 - v.x;
		} else if ( absV.x >= almostOne ) {
			float signX = sign( v.x );
			planar.x = v.z * signX + 2.0 * signX;
		} else if ( absV.y >= almostOne ) {
			float signY = sign( v.y );
			planar.x = v.x + 2.0 * signY + 2.0;
			planar.y = v.z * signY - 2.0;
		}
		return vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );
	}
	float getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {
		vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );
		vec3 lightToPosition = shadowCoord.xyz;
		float dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );		dp += shadowBias;
		vec3 bd3D = normalize( lightToPosition );
		#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )
			vec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;
			return (
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )
			) * ( 1.0 / 9.0 );
		#else
			return texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );
		#endif
	}
#endif`,QGe=`#if NUM_SPOT_LIGHT_COORDS > 0
  uniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];
  varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
#endif`,JGe=`#if ( defined( USE_SHADOWMAP ) && ( NUM_DIR_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0 ) ) || ( NUM_SPOT_LIGHT_COORDS > 0 )
	vec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
	vec4 shadowWorldPosition;
#endif
#if defined( USE_SHADOWMAP )
	#if NUM_DIR_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );
			vDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );
			vPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
#endif
#if NUM_SPOT_LIGHT_COORDS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {
		shadowWorldPosition = worldPosition;
		#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
			shadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;
		#endif
		vSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
#endif`,e8e=`float getShadowMask() {
	float shadow = 1.0;
	#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		directionalLight = directionalLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		spotLight = spotLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		pointLight = pointLightShadows[ i ];
		shadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#endif
	return shadow;
}`,t8e=`#ifdef USE_SKINNING
	mat4 boneMatX = getBoneMatrix( skinIndex.x );
	mat4 boneMatY = getBoneMatrix( skinIndex.y );
	mat4 boneMatZ = getBoneMatrix( skinIndex.z );
	mat4 boneMatW = getBoneMatrix( skinIndex.w );
#endif`,i8e=`#ifdef USE_SKINNING
	uniform mat4 bindMatrix;
	uniform mat4 bindMatrixInverse;
	uniform highp sampler2D boneTexture;
	uniform int boneTextureSize;
	mat4 getBoneMatrix( const in float i ) {
		float j = i * 4.0;
		float x = mod( j, float( boneTextureSize ) );
		float y = floor( j / float( boneTextureSize ) );
		float dx = 1.0 / float( boneTextureSize );
		float dy = 1.0 / float( boneTextureSize );
		y = dy * ( y + 0.5 );
		vec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );
		vec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );
		vec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );
		vec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );
		mat4 bone = mat4( v1, v2, v3, v4 );
		return bone;
	}
#endif`,r8e=`#ifdef USE_SKINNING
	vec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );
	vec4 skinned = vec4( 0.0 );
	skinned += boneMatX * skinVertex * skinWeight.x;
	skinned += boneMatY * skinVertex * skinWeight.y;
	skinned += boneMatZ * skinVertex * skinWeight.z;
	skinned += boneMatW * skinVertex * skinWeight.w;
	transformed = ( bindMatrixInverse * skinned ).xyz;
#endif`,n8e=`#ifdef USE_SKINNING
	mat4 skinMatrix = mat4( 0.0 );
	skinMatrix += skinWeight.x * boneMatX;
	skinMatrix += skinWeight.y * boneMatY;
	skinMatrix += skinWeight.z * boneMatZ;
	skinMatrix += skinWeight.w * boneMatW;
	skinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;
	objectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;
	#ifdef USE_TANGENT
		objectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#endif
#endif`,s8e=`float specularStrength;
#ifdef USE_SPECULARMAP
	vec4 texelSpecular = texture2D( specularMap, vUv );
	specularStrength = texelSpecular.r;
#else
	specularStrength = 1.0;
#endif`,a8e=`#ifdef USE_SPECULARMAP
	uniform sampler2D specularMap;
#endif`,o8e=`#if defined( TONE_MAPPING )
	gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );
#endif`,l8e=`#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
uniform float toneMappingExposure;
vec3 LinearToneMapping( vec3 color ) {
	return toneMappingExposure * color;
}
vec3 ReinhardToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	return saturate( color / ( vec3( 1.0 ) + color ) );
}
vec3 OptimizedCineonToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	color = max( vec3( 0.0 ), color - 0.004 );
	return pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );
}
vec3 RRTAndODTFit( vec3 v ) {
	vec3 a = v * ( v + 0.0245786 ) - 0.000090537;
	vec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;
	return a / b;
}
vec3 ACESFilmicToneMapping( vec3 color ) {
	const mat3 ACESInputMat = mat3(
		vec3( 0.59719, 0.07600, 0.02840 ),		vec3( 0.35458, 0.90834, 0.13383 ),
		vec3( 0.04823, 0.01566, 0.83777 )
	);
	const mat3 ACESOutputMat = mat3(
		vec3(  1.60475, -0.10208, -0.00327 ),		vec3( -0.53108,  1.10813, -0.07276 ),
		vec3( -0.07367, -0.00605,  1.07602 )
	);
	color *= toneMappingExposure / 0.6;
	color = ACESInputMat * color;
	color = RRTAndODTFit( color );
	color = ACESOutputMat * color;
	return saturate( color );
}
vec3 CustomToneMapping( vec3 color ) { return color; }`,c8e=`#ifdef USE_TRANSMISSION
	material.transmission = transmission;
	material.transmissionAlpha = 1.0;
	material.thickness = thickness;
	material.attenuationDistance = attenuationDistance;
	material.attenuationColor = attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		material.transmission *= texture2D( transmissionMap, vUv ).r;
	#endif
	#ifdef USE_THICKNESSMAP
		material.thickness *= texture2D( thicknessMap, vUv ).g;
	#endif
	vec3 pos = vWorldPosition;
	vec3 v = normalize( cameraPosition - pos );
	vec3 n = inverseTransformDirection( normal, viewMatrix );
	vec4 transmission = getIBLVolumeRefraction(
		n, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,
		pos, modelMatrix, viewMatrix, projectionMatrix, material.ior, material.thickness,
		material.attenuationColor, material.attenuationDistance );
	material.transmissionAlpha = mix( material.transmissionAlpha, transmission.a, material.transmission );
	totalDiffuse = mix( totalDiffuse, transmission.rgb, material.transmission );
#endif`,u8e=`#ifdef USE_TRANSMISSION
	uniform float transmission;
	uniform float thickness;
	uniform float attenuationDistance;
	uniform vec3 attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		uniform sampler2D transmissionMap;
	#endif
	#ifdef USE_THICKNESSMAP
		uniform sampler2D thicknessMap;
	#endif
	uniform vec2 transmissionSamplerSize;
	uniform sampler2D transmissionSamplerMap;
	uniform mat4 modelMatrix;
	uniform mat4 projectionMatrix;
	varying vec3 vWorldPosition;
	vec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {
		vec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );
		vec3 modelScale;
		modelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );
		modelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );
		modelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );
		return normalize( refractionVector ) * thickness * modelScale;
	}
	float applyIorToRoughness( const in float roughness, const in float ior ) {
		return roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );
	}
	vec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {
		float framebufferLod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );
		#ifdef texture2DLodEXT
			return texture2DLodEXT( transmissionSamplerMap, fragCoord.xy, framebufferLod );
		#else
			return texture2D( transmissionSamplerMap, fragCoord.xy, framebufferLod );
		#endif
	}
	vec3 applyVolumeAttenuation( const in vec3 radiance, const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {
		if ( isinf( attenuationDistance ) ) {
			return radiance;
		} else {
			vec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;
			vec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );			return transmittance * radiance;
		}
	}
	vec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,
		const in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,
		const in mat4 viewMatrix, const in mat4 projMatrix, const in float ior, const in float thickness,
		const in vec3 attenuationColor, const in float attenuationDistance ) {
		vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );
		vec3 refractedRayExit = position + transmissionRay;
		vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
		vec2 refractionCoords = ndcPos.xy / ndcPos.w;
		refractionCoords += 1.0;
		refractionCoords /= 2.0;
		vec4 transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );
		vec3 attenuatedColor = applyVolumeAttenuation( transmittedLight.rgb, length( transmissionRay ), attenuationColor, attenuationDistance );
		vec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );
		return vec4( ( 1.0 - F ) * attenuatedColor * diffuseColor, transmittedLight.a );
	}
#endif`,h8e=`#if ( defined( USE_UV ) && ! defined( UVS_VERTEX_ONLY ) )
	varying vec2 vUv;
#endif`,d8e=`#ifdef USE_UV
	#ifdef UVS_VERTEX_ONLY
		vec2 vUv;
	#else
		varying vec2 vUv;
	#endif
	uniform mat3 uvTransform;
#endif`,f8e=`#ifdef USE_UV
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
#endif`,p8e=`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	varying vec2 vUv2;
#endif`,m8e=`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	attribute vec2 uv2;
	varying vec2 vUv2;
	uniform mat3 uv2Transform;
#endif`,g8e=`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	vUv2 = ( uv2Transform * vec3( uv2, 1 ) ).xy;
#endif`,v8e=`#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0
	vec4 worldPosition = vec4( transformed, 1.0 );
	#ifdef USE_INSTANCING
		worldPosition = instanceMatrix * worldPosition;
	#endif
	worldPosition = modelMatrix * worldPosition;
#endif`,y8e=`varying vec2 vUv;
uniform mat3 uvTransform;
void main() {
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	gl_Position = vec4( position.xy, 1.0, 1.0 );
}`,x8e=`uniform sampler2D t2D;
uniform float backgroundIntensity;
varying vec2 vUv;
void main() {
	vec4 texColor = texture2D( t2D, vUv );
	#ifdef DECODE_VIDEO_TEXTURE
		texColor = vec4( mix( pow( texColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), texColor.rgb * 0.0773993808, vec3( lessThanEqual( texColor.rgb, vec3( 0.04045 ) ) ) ), texColor.w );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,b8e=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,w8e=`#ifdef ENVMAP_TYPE_CUBE
	uniform samplerCube envMap;
#elif defined( ENVMAP_TYPE_CUBE_UV )
	uniform sampler2D envMap;
#endif
uniform float flipEnvMap;
uniform float backgroundBlurriness;
uniform float backgroundIntensity;
varying vec3 vWorldDirection;
#include <cube_uv_reflection_fragment>
void main() {
	#ifdef ENVMAP_TYPE_CUBE
		vec4 texColor = textureCube( envMap, vec3( flipEnvMap * vWorldDirection.x, vWorldDirection.yz ) );
	#elif defined( ENVMAP_TYPE_CUBE_UV )
		vec4 texColor = textureCubeUV( envMap, vWorldDirection, backgroundBlurriness );
	#else
		vec4 texColor = vec4( 0.0, 0.0, 0.0, 1.0 );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,_8e=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,S8e=`uniform samplerCube tCube;
uniform float tFlip;
uniform float opacity;
varying vec3 vWorldDirection;
void main() {
	vec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );
	gl_FragColor = texColor;
	gl_FragColor.a *= opacity;
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,E8e=`#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
varying vec2 vHighPrecisionZW;
void main() {
	#include <uv_vertex>
	#include <skinbase_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vHighPrecisionZW = gl_Position.zw;
}`,A8e=`#if DEPTH_PACKING == 3200
	uniform float opacity;
#endif
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
varying vec2 vHighPrecisionZW;
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( 1.0 );
	#if DEPTH_PACKING == 3200
		diffuseColor.a = opacity;
	#endif
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <logdepthbuf_fragment>
	float fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;
	#if DEPTH_PACKING == 3200
		gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );
	#elif DEPTH_PACKING == 3201
		gl_FragColor = packDepthToRGBA( fragCoordZ );
	#endif
}`,M8e=`#define DISTANCE
varying vec3 vWorldPosition;
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <skinbase_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <clipping_planes_vertex>
	vWorldPosition = worldPosition.xyz;
}`,T8e=`#define DISTANCE
uniform vec3 referencePosition;
uniform float nearDistance;
uniform float farDistance;
varying vec3 vWorldPosition;
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <clipping_planes_pars_fragment>
void main () {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( 1.0 );
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	float dist = length( vWorldPosition - referencePosition );
	dist = ( dist - nearDistance ) / ( farDistance - nearDistance );
	dist = saturate( dist );
	gl_FragColor = packDepthToRGBA( dist );
}`,C8e=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
}`,P8e=`uniform sampler2D tEquirect;
varying vec3 vWorldDirection;
#include <common>
void main() {
	vec3 direction = normalize( vWorldDirection );
	vec2 sampleUV = equirectUv( direction );
	gl_FragColor = texture2D( tEquirect, sampleUV );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,R8e=`uniform float scale;
attribute float lineDistance;
varying float vLineDistance;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	vLineDistance = scale * lineDistance;
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,I8e=`uniform vec3 diffuse;
uniform float opacity;
uniform float dashSize;
uniform float totalSize;
varying float vLineDistance;
#include <common>
#include <color_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	if ( mod( vLineDistance, totalSize ) > dashSize ) {
		discard;
	}
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <color_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,D8e=`#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinbase_vertex>
		#include <skinnormal_vertex>
		#include <defaultnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <fog_vertex>
}`,O8e=`uniform vec3 diffuse;
uniform float opacity;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vUv2 );
		reflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;
	#else
		reflectedLight.indirectDiffuse += vec3( 1.0 );
	#endif
	#include <aomap_fragment>
	reflectedLight.indirectDiffuse *= diffuseColor.rgb;
	vec3 outgoingLight = reflectedLight.indirectDiffuse;
	#include <envmap_fragment>
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,L8e=`#define LAMBERT
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,k8e=`#define LAMBERT
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_lambert_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_lambert_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,N8e=`#define MATCAP
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <displacementmap_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
	vViewPosition = - mvPosition.xyz;
}`,U8e=`#define MATCAP
uniform vec3 diffuse;
uniform float opacity;
uniform sampler2D matcap;
varying vec3 vViewPosition;
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <fog_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	vec3 viewDir = normalize( vViewPosition );
	vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );
	vec3 y = cross( viewDir, x );
	vec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;
	#ifdef USE_MATCAP
		vec4 matcapColor = texture2D( matcap, uv );
	#else
		vec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );
	#endif
	vec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,B8e=`#define NORMAL
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )
	varying vec3 vViewPosition;
#endif
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )
	vViewPosition = - mvPosition.xyz;
#endif
}`,F8e=`#define NORMAL
uniform float opacity;
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )
	varying vec3 vViewPosition;
#endif
#include <packing>
#include <uv_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	gl_FragColor = vec4( packNormalToRGB( normal ), opacity );
	#ifdef OPAQUE
		gl_FragColor.a = 1.0;
	#endif
}`,z8e=`#define PHONG
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,j8e=`#define PHONG
uniform vec3 diffuse;
uniform vec3 emissive;
uniform vec3 specular;
uniform float shininess;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_phong_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_phong_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,V8e=`#define STANDARD
varying vec3 vViewPosition;
#ifdef USE_TRANSMISSION
	varying vec3 vWorldPosition;
#endif
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
#ifdef USE_TRANSMISSION
	vWorldPosition = worldPosition.xyz;
#endif
}`,H8e=`#define STANDARD
#ifdef PHYSICAL
	#define IOR
	#define SPECULAR
#endif
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float roughness;
uniform float metalness;
uniform float opacity;
#ifdef IOR
	uniform float ior;
#endif
#ifdef SPECULAR
	uniform float specularIntensity;
	uniform vec3 specularColor;
	#ifdef USE_SPECULARINTENSITYMAP
		uniform sampler2D specularIntensityMap;
	#endif
	#ifdef USE_SPECULARCOLORMAP
		uniform sampler2D specularColorMap;
	#endif
#endif
#ifdef USE_CLEARCOAT
	uniform float clearcoat;
	uniform float clearcoatRoughness;
#endif
#ifdef USE_IRIDESCENCE
	uniform float iridescence;
	uniform float iridescenceIOR;
	uniform float iridescenceThicknessMinimum;
	uniform float iridescenceThicknessMaximum;
#endif
#ifdef USE_SHEEN
	uniform vec3 sheenColor;
	uniform float sheenRoughness;
	#ifdef USE_SHEENCOLORMAP
		uniform sampler2D sheenColorMap;
	#endif
	#ifdef USE_SHEENROUGHNESSMAP
		uniform sampler2D sheenRoughnessMap;
	#endif
#endif
varying vec3 vViewPosition;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <bsdfs>
#include <iridescence_fragment>
#include <cube_uv_reflection_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_physical_pars_fragment>
#include <fog_pars_fragment>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_physical_pars_fragment>
#include <transmission_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <clearcoat_pars_fragment>
#include <iridescence_pars_fragment>
#include <roughnessmap_pars_fragment>
#include <metalnessmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <roughnessmap_fragment>
	#include <metalnessmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <clearcoat_normal_fragment_begin>
	#include <clearcoat_normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_physical_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;
	vec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;
	#include <transmission_fragment>
	vec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;
	#ifdef USE_SHEEN
		float sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );
		outgoingLight = outgoingLight * sheenEnergyComp + sheenSpecular;
	#endif
	#ifdef USE_CLEARCOAT
		float dotNVcc = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );
		vec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );
		outgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + clearcoatSpecular * material.clearcoat;
	#endif
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,G8e=`#define TOON
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,W8e=`#define TOON
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <gradientmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_toon_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_toon_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,q8e=`uniform float size;
uniform float scale;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	gl_PointSize = size;
	#ifdef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );
	#endif
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <fog_vertex>
}`,X8e=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <color_pars_fragment>
#include <map_particle_pars_fragment>
#include <alphatest_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_particle_fragment>
	#include <color_fragment>
	#include <alphatest_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,$8e=`#include <common>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
void main() {
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,Y8e=`uniform vec3 color;
uniform float opacity;
#include <common>
#include <packing>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
void main() {
	gl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
}`,K8e=`uniform float rotation;
uniform vec2 center;
#include <common>
#include <uv_pars_vertex>
#include <fog_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	vec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );
	vec2 scale;
	scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );
	scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );
	#ifndef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) scale *= - mvPosition.z;
	#endif
	vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;
	vec2 rotatedPosition;
	rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
	rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
	mvPosition.xy += rotatedPosition;
	gl_Position = projectionMatrix * mvPosition;
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,Z8e=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
}`,ir={alphamap_fragment:bHe,alphamap_pars_fragment:wHe,alphatest_fragment:_He,alphatest_pars_fragment:SHe,aomap_fragment:EHe,aomap_pars_fragment:AHe,begin_vertex:MHe,beginnormal_vertex:THe,bsdfs:CHe,iridescence_fragment:PHe,bumpmap_pars_fragment:RHe,clipping_planes_fragment:IHe,clipping_planes_pars_fragment:DHe,clipping_planes_pars_vertex:OHe,clipping_planes_vertex:LHe,color_fragment:kHe,color_pars_fragment:NHe,color_pars_vertex:UHe,color_vertex:BHe,common:FHe,cube_uv_reflection_fragment:zHe,defaultnormal_vertex:jHe,displacementmap_pars_vertex:VHe,displacementmap_vertex:HHe,emissivemap_fragment:GHe,emissivemap_pars_fragment:WHe,encodings_fragment:qHe,encodings_pars_fragment:XHe,envmap_fragment:$He,envmap_common_pars_fragment:YHe,envmap_pars_fragment:KHe,envmap_pars_vertex:ZHe,envmap_physical_pars_fragment:cGe,envmap_vertex:QHe,fog_vertex:JHe,fog_pars_vertex:eGe,fog_fragment:tGe,fog_pars_fragment:iGe,gradientmap_pars_fragment:rGe,lightmap_fragment:nGe,lightmap_pars_fragment:sGe,lights_lambert_fragment:aGe,lights_lambert_pars_fragment:oGe,lights_pars_begin:lGe,lights_toon_fragment:uGe,lights_toon_pars_fragment:hGe,lights_phong_fragment:dGe,lights_phong_pars_fragment:fGe,lights_physical_fragment:pGe,lights_physical_pars_fragment:mGe,lights_fragment_begin:gGe,lights_fragment_maps:vGe,lights_fragment_end:yGe,logdepthbuf_fragment:xGe,logdepthbuf_pars_fragment:bGe,logdepthbuf_pars_vertex:wGe,logdepthbuf_vertex:_Ge,map_fragment:SGe,map_pars_fragment:EGe,map_particle_fragment:AGe,map_particle_pars_fragment:MGe,metalnessmap_fragment:TGe,metalnessmap_pars_fragment:CGe,morphcolor_vertex:PGe,morphnormal_vertex:RGe,morphtarget_pars_vertex:IGe,morphtarget_vertex:DGe,normal_fragment_begin:OGe,normal_fragment_maps:LGe,normal_pars_fragment:kGe,normal_pars_vertex:NGe,normal_vertex:UGe,normalmap_pars_fragment:BGe,clearcoat_normal_fragment_begin:FGe,clearcoat_normal_fragment_maps:zGe,clearcoat_pars_fragment:jGe,iridescence_pars_fragment:VGe,output_fragment:HGe,packing:GGe,premultiplied_alpha_fragment:WGe,project_vertex:qGe,dithering_fragment:XGe,dithering_pars_fragment:$Ge,roughnessmap_fragment:YGe,roughnessmap_pars_fragment:KGe,shadowmap_pars_fragment:ZGe,shadowmap_pars_vertex:QGe,shadowmap_vertex:JGe,shadowmask_pars_fragment:e8e,skinbase_vertex:t8e,skinning_pars_vertex:i8e,skinning_vertex:r8e,skinnormal_vertex:n8e,specularmap_fragment:s8e,specularmap_pars_fragment:a8e,tonemapping_fragment:o8e,tonemapping_pars_fragment:l8e,transmission_fragment:c8e,transmission_pars_fragment:u8e,uv_pars_fragment:h8e,uv_pars_vertex:d8e,uv_vertex:f8e,uv2_pars_fragment:p8e,uv2_pars_vertex:m8e,uv2_vertex:g8e,worldpos_vertex:v8e,background_vert:y8e,background_frag:x8e,backgroundCube_vert:b8e,backgroundCube_frag:w8e,cube_vert:_8e,cube_frag:S8e,depth_vert:E8e,depth_frag:A8e,distanceRGBA_vert:M8e,distanceRGBA_frag:T8e,equirect_vert:C8e,equirect_frag:P8e,linedashed_vert:R8e,linedashed_frag:I8e,meshbasic_vert:D8e,meshbasic_frag:O8e,meshlambert_vert:L8e,meshlambert_frag:k8e,meshmatcap_vert:N8e,meshmatcap_frag:U8e,meshnormal_vert:B8e,meshnormal_frag:F8e,meshphong_vert:z8e,meshphong_frag:j8e,meshphysical_vert:V8e,meshphysical_frag:H8e,meshtoon_vert:G8e,meshtoon_frag:W8e,points_vert:q8e,points_frag:X8e,shadow_vert:$8e,shadow_frag:Y8e,sprite_vert:K8e,sprite_frag:Z8e},Bt={common:{diffuse:{value:new Ai(16777215)},opacity:{value:1},map:{value:null},uvTransform:{value:new Vs},uv2Transform:{value:new Vs},alphaMap:{value:null},alphaTest:{value:0}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new Ae(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new Ai(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new Ai(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new Vs}},sprite:{diffuse:{value:new Ai(16777215)},opacity:{value:1},center:{value:new Ae(.5,.5)},rotation:{value:0},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new Vs}}},wd={basic:{uniforms:ul([Bt.common,Bt.specularmap,Bt.envmap,Bt.aomap,Bt.lightmap,Bt.fog]),vertexShader:ir.meshbasic_vert,fragmentShader:ir.meshbasic_frag},lambert:{uniforms:ul([Bt.common,Bt.specularmap,Bt.envmap,Bt.aomap,Bt.lightmap,Bt.emissivemap,Bt.bumpmap,Bt.normalmap,Bt.displacementmap,Bt.fog,Bt.lights,{emissive:{value:new Ai(0)}}]),vertexShader:ir.meshlambert_vert,fragmentShader:ir.meshlambert_frag},phong:{uniforms:ul([Bt.common,Bt.specularmap,Bt.envmap,Bt.aomap,Bt.lightmap,Bt.emissivemap,Bt.bumpmap,Bt.normalmap,Bt.displacementmap,Bt.fog,Bt.lights,{emissive:{value:new Ai(0)},specular:{value:new Ai(1118481)},shininess:{value:30}}]),vertexShader:ir.meshphong_vert,fragmentShader:ir.meshphong_frag},standard:{uniforms:ul([Bt.common,Bt.envmap,Bt.aomap,Bt.lightmap,Bt.emissivemap,Bt.bumpmap,Bt.normalmap,Bt.displacementmap,Bt.roughnessmap,Bt.metalnessmap,Bt.fog,Bt.lights,{emissive:{value:new Ai(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:ir.meshphysical_vert,fragmentShader:ir.meshphysical_frag},toon:{uniforms:ul([Bt.common,Bt.aomap,Bt.lightmap,Bt.emissivemap,Bt.bumpmap,Bt.normalmap,Bt.displacementmap,Bt.gradientmap,Bt.fog,Bt.lights,{emissive:{value:new Ai(0)}}]),vertexShader:ir.meshtoon_vert,fragmentShader:ir.meshtoon_frag},matcap:{uniforms:ul([Bt.common,Bt.bumpmap,Bt.normalmap,Bt.displacementmap,Bt.fog,{matcap:{value:null}}]),vertexShader:ir.meshmatcap_vert,fragmentShader:ir.meshmatcap_frag},points:{uniforms:ul([Bt.points,Bt.fog]),vertexShader:ir.points_vert,fragmentShader:ir.points_frag},dashed:{uniforms:ul([Bt.common,Bt.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:ir.linedashed_vert,fragmentShader:ir.linedashed_frag},depth:{uniforms:ul([Bt.common,Bt.displacementmap]),vertexShader:ir.depth_vert,fragmentShader:ir.depth_frag},normal:{uniforms:ul([Bt.common,Bt.bumpmap,Bt.normalmap,Bt.displacementmap,{opacity:{value:1}}]),vertexShader:ir.meshnormal_vert,fragmentShader:ir.meshnormal_frag},sprite:{uniforms:ul([Bt.sprite,Bt.fog]),vertexShader:ir.sprite_vert,fragmentShader:ir.sprite_frag},background:{uniforms:{uvTransform:{value:new Vs},t2D:{value:null},backgroundIntensity:{value:1}},vertexShader:ir.background_vert,fragmentShader:ir.background_frag},backgroundCube:{uniforms:{envMap:{value:null},flipEnvMap:{value:-1},backgroundBlurriness:{value:0},backgroundIntensity:{value:1}},vertexShader:ir.backgroundCube_vert,fragmentShader:ir.backgroundCube_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:ir.cube_vert,fragmentShader:ir.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:ir.equirect_vert,fragmentShader:ir.equirect_frag},distanceRGBA:{uniforms:ul([Bt.common,Bt.displacementmap,{referencePosition:{value:new W},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:ir.distanceRGBA_vert,fragmentShader:ir.distanceRGBA_frag},shadow:{uniforms:ul([Bt.lights,Bt.fog,{color:{value:new Ai(0)},opacity:{value:1}}]),vertexShader:ir.shadow_vert,fragmentShader:ir.shadow_frag}};wd.physical={uniforms:ul([wd.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatNormalScale:{value:new Ae(1,1)},clearcoatNormalMap:{value:null},iridescence:{value:0},iridescenceMap:{value:null},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},sheen:{value:0},sheenColor:{value:new Ai(0)},sheenColorMap:{value:null},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},transmission:{value:0},transmissionMap:{value:null},transmissionSamplerSize:{value:new Ae},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},attenuationDistance:{value:0},attenuationColor:{value:new Ai(0)},specularIntensity:{value:1},specularIntensityMap:{value:null},specularColor:{value:new Ai(1,1,1)},specularColorMap:{value:null}}]),vertexShader:ir.meshphysical_vert,fragmentShader:ir.meshphysical_frag};var RP={r:0,b:0,g:0};function Q8e(t,e,i,r,n,s,a){let o=new Ai(0),l=s===!0?0:1,c,u,h=null,d=0,f=null;function p(m,y){let b=!1,w=y.isScene===!0?y.background:null;w&&w.isTexture&&(w=(y.backgroundBlurriness>0?i:e).get(w));let E=t.xr,M=E.getSession&&E.getSession();M&&M.environmentBlendMode==="additive"&&(w=null),w===null?g(o,l):w&&w.isColor&&(g(w,1),b=!0),(t.autoClear||b)&&t.clear(t.autoClearColor,t.autoClearDepth,t.autoClearStencil),w&&(w.isCubeTexture||w.mapping===DT)?(u===void 0&&(u=new En(new Oh(1,1,1),new Tr({name:"BackgroundCubeMaterial",uniforms:V1(wd.backgroundCube.uniforms),vertexShader:wd.backgroundCube.vertexShader,fragmentShader:wd.backgroundCube.fragmentShader,side:qa,depthTest:!1,depthWrite:!1,fog:!1})),u.geometry.deleteAttribute("normal"),u.geometry.deleteAttribute("uv"),u.onBeforeRender=function(A,P,C){this.matrixWorld.copyPosition(C.matrixWorld)},Object.defineProperty(u.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),n.update(u)),u.material.uniforms.envMap.value=w,u.material.uniforms.flipEnvMap.value=w.isCubeTexture&&w.isRenderTargetTexture===!1?-1:1,u.material.uniforms.backgroundBlurriness.value=y.backgroundBlurriness,u.material.uniforms.backgroundIntensity.value=y.backgroundIntensity,u.material.toneMapped=w.encoding!==er,(h!==w||d!==w.version||f!==t.toneMapping)&&(u.material.needsUpdate=!0,h=w,d=w.version,f=t.toneMapping),u.layers.enableAll(),m.unshift(u,u.geometry,u.material,0,0,null)):w&&w.isTexture&&(c===void 0&&(c=new En(new ef(2,2),new Tr({name:"BackgroundMaterial",uniforms:V1(wd.background.uniforms),vertexShader:wd.background.vertexShader,fragmentShader:wd.background.fragmentShader,side:Ih,depthTest:!1,depthWrite:!1,fog:!1})),c.geometry.deleteAttribute("normal"),Object.defineProperty(c.material,"map",{get:function(){return this.uniforms.t2D.value}}),n.update(c)),c.material.uniforms.t2D.value=w,c.material.uniforms.backgroundIntensity.value=y.backgroundIntensity,c.material.toneMapped=w.encoding!==er,w.matrixAutoUpdate===!0&&w.updateMatrix(),c.material.uniforms.uvTransform.value.copy(w.matrix),(h!==w||d!==w.version||f!==t.toneMapping)&&(c.material.needsUpdate=!0,h=w,d=w.version,f=t.toneMapping),c.layers.enableAll(),m.unshift(c,c.geometry,c.material,0,0,null))}function g(m,y){m.getRGB(RP,phe(t)),r.buffers.color.setClear(RP.r,RP.g,RP.b,y,a)}return{getClearColor:function(){return o},setClearColor:function(m,y=1){o.set(m),l=y,g(o,l)},getClearAlpha:function(){return l},setClearAlpha:function(m){l=m,g(o,l)},render:p}}function J8e(t,e,i,r){let n=t.getParameter(34921),s=r.isWebGL2?null:e.get("OES_vertex_array_object"),a=r.isWebGL2||s!==null,o={},l=m(null),c=l,u=!1;function h(F,$,K,X,U){let Y=!1;if(a){let Z=g(X,K,$);c!==Z&&(c=Z,f(c.object)),Y=y(F,X,K,U),Y&&b(F,X,K,U)}else{let Z=$.wireframe===!0;(c.geometry!==X.id||c.program!==K.id||c.wireframe!==Z)&&(c.geometry=X.id,c.program=K.id,c.wireframe=Z,Y=!0)}U!==null&&i.update(U,34963),(Y||u)&&(u=!1,C(F,$,K,X),U!==null&&t.bindBuffer(34963,i.get(U).buffer))}function d(){return r.isWebGL2?t.createVertexArray():s.createVertexArrayOES()}function f(F){return r.isWebGL2?t.bindVertexArray(F):s.bindVertexArrayOES(F)}function p(F){return r.isWebGL2?t.deleteVertexArray(F):s.deleteVertexArrayOES(F)}function g(F,$,K){let X=K.wireframe===!0,U=o[F.id];U===void 0&&(U={},o[F.id]=U);let Y=U[$.id];Y===void 0&&(Y={},U[$.id]=Y);let Z=Y[X];return Z===void 0&&(Z=m(d()),Y[X]=Z),Z}function m(F){let $=[],K=[],X=[];for(let U=0;U<n;U++)$[U]=0,K[U]=0,X[U]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:$,enabledAttributes:K,attributeDivisors:X,object:F,attributes:{},index:null}}function y(F,$,K,X){let U=c.attributes,Y=$.attributes,Z=0,j=K.getAttributes();for(let ee in j)if(j[ee].location>=0){let pe=U[ee],fe=Y[ee];if(fe===void 0&&(ee==="instanceMatrix"&&F.instanceMatrix&&(fe=F.instanceMatrix),ee==="instanceColor"&&F.instanceColor&&(fe=F.instanceColor)),pe===void 0||pe.attribute!==fe||fe&&pe.data!==fe.data)return!0;Z++}return c.attributesNum!==Z||c.index!==X}function b(F,$,K,X){let U={},Y=$.attributes,Z=0,j=K.getAttributes();for(let ee in j)if(j[ee].location>=0){let pe=Y[ee];pe===void 0&&(ee==="instanceMatrix"&&F.instanceMatrix&&(pe=F.instanceMatrix),ee==="instanceColor"&&F.instanceColor&&(pe=F.instanceColor));let fe={};fe.attribute=pe,pe&&pe.data&&(fe.data=pe.data),U[ee]=fe,Z++}c.attributes=U,c.attributesNum=Z,c.index=X}function w(){let F=c.newAttributes;for(let $=0,K=F.length;$<K;$++)F[$]=0}function E(F){M(F,0)}function M(F,$){let K=c.newAttributes,X=c.enabledAttributes,U=c.attributeDivisors;K[F]=1,X[F]===0&&(t.enableVertexAttribArray(F),X[F]=1),U[F]!==$&&((r.isWebGL2?t:e.get("ANGLE_instanced_arrays"))[r.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](F,$),U[F]=$)}function A(){let F=c.newAttributes,$=c.enabledAttributes;for(let K=0,X=$.length;K<X;K++)$[K]!==F[K]&&(t.disableVertexAttribArray(K),$[K]=0)}function P(F,$,K,X,U,Y){r.isWebGL2===!0&&(K===5124||K===5125)?t.vertexAttribIPointer(F,$,K,U,Y):t.vertexAttribPointer(F,$,K,X,U,Y)}function C(F,$,K,X){if(r.isWebGL2===!1&&(F.isInstancedMesh||X.isInstancedBufferGeometry)&&e.get("ANGLE_instanced_arrays")===null)return;w();let U=X.attributes,Y=K.getAttributes(),Z=$.defaultAttributeValues;for(let j in Y){let ee=Y[j];if(ee.location>=0){let pe=U[j];if(pe===void 0&&(j==="instanceMatrix"&&F.instanceMatrix&&(pe=F.instanceMatrix),j==="instanceColor"&&F.instanceColor&&(pe=F.instanceColor)),pe!==void 0){let fe=pe.normalized,se=pe.itemSize,re=i.get(pe);if(re===void 0)continue;let le=re.buffer,he=re.type,ve=re.bytesPerElement;if(pe.isInterleavedBufferAttribute){let xe=pe.data,Se=xe.stride,Ce=pe.offset;if(xe.isInstancedInterleavedBuffer){for(let ce=0;ce<ee.locationSize;ce++)M(ee.location+ce,xe.meshPerAttribute);F.isInstancedMesh!==!0&&X._maxInstanceCount===void 0&&(X._maxInstanceCount=xe.meshPerAttribute*xe.count)}else for(let ce=0;ce<ee.locationSize;ce++)E(ee.location+ce);t.bindBuffer(34962,le);for(let ce=0;ce<ee.locationSize;ce++)P(ee.location+ce,se/ee.locationSize,he,fe,Se*ve,(Ce+se/ee.locationSize*ce)*ve)}else{if(pe.isInstancedBufferAttribute){for(let xe=0;xe<ee.locationSize;xe++)M(ee.location+xe,pe.meshPerAttribute);F.isInstancedMesh!==!0&&X._maxInstanceCount===void 0&&(X._maxInstanceCount=pe.meshPerAttribute*pe.count)}else for(let xe=0;xe<ee.locationSize;xe++)E(ee.location+xe);t.bindBuffer(34962,le);for(let xe=0;xe<ee.locationSize;xe++)P(ee.location+xe,se/ee.locationSize,he,fe,se*ve,se/ee.locationSize*xe*ve)}}else if(Z!==void 0){let fe=Z[j];if(fe!==void 0)switch(fe.length){case 2:t.vertexAttrib2fv(ee.location,fe);break;case 3:t.vertexAttrib3fv(ee.location,fe);break;case 4:t.vertexAttrib4fv(ee.location,fe);break;default:t.vertexAttrib1fv(ee.location,fe)}}}}A()}function R(){z();for(let F in o){let $=o[F];for(let K in $){let X=$[K];for(let U in X)p(X[U].object),delete X[U];delete $[K]}delete o[F]}}function I(F){if(o[F.id]===void 0)return;let $=o[F.id];for(let K in $){let X=$[K];for(let U in X)p(X[U].object),delete X[U];delete $[K]}delete o[F.id]}function k(F){for(let $ in o){let K=o[$];if(K[F.id]===void 0)continue;let X=K[F.id];for(let U in X)p(X[U].object),delete X[U];delete K[F.id]}}function z(){V(),u=!0,c!==l&&(c=l,f(c.object))}function V(){l.geometry=null,l.program=null,l.wireframe=!1}return{setup:h,reset:z,resetDefaultState:V,dispose:R,releaseStatesOfGeometry:I,releaseStatesOfProgram:k,initAttributes:w,enableAttribute:E,disableUnusedAttributes:A}}function eWe(t,e,i,r){let n=r.isWebGL2,s;function a(c){s=c}function o(c,u){t.drawArrays(s,c,u),i.update(u,s,1)}function l(c,u,h){if(h===0)return;let d,f;if(n)d=t,f="drawArraysInstanced";else if(d=e.get("ANGLE_instanced_arrays"),f="drawArraysInstancedANGLE",d===null){console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");return}d[f](s,c,u,h),i.update(u,s,h)}this.setMode=a,this.render=o,this.renderInstances=l}function tWe(t,e,i){let r;function n(){if(r!==void 0)return r;if(e.has("EXT_texture_filter_anisotropic")===!0){let P=e.get("EXT_texture_filter_anisotropic");r=t.getParameter(P.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else r=0;return r}function s(P){if(P==="highp"){if(t.getShaderPrecisionFormat(35633,36338).precision>0&&t.getShaderPrecisionFormat(35632,36338).precision>0)return"highp";P="mediump"}return P==="mediump"&&t.getShaderPrecisionFormat(35633,36337).precision>0&&t.getShaderPrecisionFormat(35632,36337).precision>0?"mediump":"lowp"}let a=typeof WebGL2RenderingContext<"u"&&t instanceof WebGL2RenderingContext,o=i.precision!==void 0?i.precision:"highp",l=s(o);l!==o&&(console.warn("THREE.WebGLRenderer:",o,"not supported, using",l,"instead."),o=l);let c=a||e.has("WEBGL_draw_buffers"),u=i.logarithmicDepthBuffer===!0,h=t.getParameter(34930),d=t.getParameter(35660),f=t.getParameter(3379),p=t.getParameter(34076),g=t.getParameter(34921),m=t.getParameter(36347),y=t.getParameter(36348),b=t.getParameter(36349),w=d>0,E=a||e.has("OES_texture_float"),M=w&&E,A=a?t.getParameter(36183):0;return{isWebGL2:a,drawBuffers:c,getMaxAnisotropy:n,getMaxPrecision:s,precision:o,logarithmicDepthBuffer:u,maxTextures:h,maxVertexTextures:d,maxTextureSize:f,maxCubemapSize:p,maxAttributes:g,maxVertexUniforms:m,maxVaryings:y,maxFragmentUniforms:b,vertexTextures:w,floatFragmentTextures:E,floatVertexTextures:M,maxSamples:A}}function iWe(t){let e=this,i=null,r=0,n=!1,s=!1,a=new $l,o=new Vs,l={value:null,needsUpdate:!1};this.uniform=l,this.numPlanes=0,this.numIntersection=0,this.init=function(h,d){let f=h.length!==0||d||r!==0||n;return n=d,r=h.length,f},this.beginShadows=function(){s=!0,u(null)},this.endShadows=function(){s=!1},this.setGlobalState=function(h,d){i=u(h,d,0)},this.setState=function(h,d,f){let p=h.clippingPlanes,g=h.clipIntersection,m=h.clipShadows,y=t.get(h);if(!n||p===null||p.length===0||s&&!m)s?u(null):c();else{let b=s?0:r,w=b*4,E=y.clippingState||null;l.value=E,E=u(p,d,w,f);for(let M=0;M!==w;++M)E[M]=i[M];y.clippingState=E,this.numIntersection=g?this.numPlanes:0,this.numPlanes+=b}};function c(){l.value!==i&&(l.value=i,l.needsUpdate=r>0),e.numPlanes=r,e.numIntersection=0}function u(h,d,f,p){let g=h!==null?h.length:0,m=null;if(g!==0){if(m=l.value,p!==!0||m===null){let y=f+g*4,b=d.matrixWorldInverse;o.getNormalMatrix(b),(m===null||m.length<y)&&(m=new Float32Array(y));for(let w=0,E=f;w!==g;++w,E+=4)a.copy(h[w]).applyMatrix4(b,o),a.normal.toArray(m,E),m[E+3]=a.constant}l.value=m,l.needsUpdate=!0}return e.numPlanes=g,e.numIntersection=0,m}}function rWe(t){let e=new WeakMap;function i(a,o){return o===bj?a.mapping=L0:o===wj&&(a.mapping=k0),a}function r(a){if(a&&a.isTexture&&a.isRenderTargetTexture===!1){let o=a.mapping;if(o===bj||o===wj)if(e.has(a)){let l=e.get(a).texture;return i(l,a.mapping)}else{let l=a.image;if(l&&l.height>0){let c=new gHe(l.height/2);return c.fromEquirectangularTexture(t,a),e.set(a,c),a.addEventListener("dispose",n),i(c.texture,a.mapping)}else return null}}return a}function n(a){let o=a.target;o.removeEventListener("dispose",n);let l=e.get(o);l!==void 0&&(e.delete(o),l.dispose())}function s(){e=new WeakMap}return{get:r,dispose:s}}var aL=class extends vv{constructor(t=-1,e=1,i=1,r=-1,n=.1,s=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=t,this.right=e,this.top=i,this.bottom=r,this.near=n,this.far=s,this.updateProjectionMatrix()}copy(t,e){return super.copy(t,e),this.left=t.left,this.right=t.right,this.top=t.top,this.bottom=t.bottom,this.near=t.near,this.far=t.far,this.zoom=t.zoom,this.view=t.view===null?null:Object.assign({},t.view),this}setViewOffset(t,e,i,r,n,s){this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=e,this.view.offsetX=i,this.view.offsetY=r,this.view.width=n,this.view.height=s,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){let t=(this.right-this.left)/(2*this.zoom),e=(this.top-this.bottom)/(2*this.zoom),i=(this.right+this.left)/2,r=(this.top+this.bottom)/2,n=i-t,s=i+t,a=r+e,o=r-e;if(this.view!==null&&this.view.enabled){let l=(this.right-this.left)/this.view.fullWidth/this.zoom,c=(this.top-this.bottom)/this.view.fullHeight/this.zoom;n+=l*this.view.offsetX,s=n+l*this.view.width,a-=c*this.view.offsetY,o=a-c*this.view.height}this.projectionMatrix.makeOrthographic(n,s,a,o,this.near,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(t){let e=super.toJSON(t);return e.object.zoom=this.zoom,e.object.left=this.left,e.object.right=this.right,e.object.top=this.top,e.object.bottom=this.bottom,e.object.near=this.near,e.object.far=this.far,this.view!==null&&(e.object.view=Object.assign({},this.view)),e}},Yw=4,PZ=[.125,.215,.35,.446,.526,.582],Vy=20,iF=new aL,RZ=new Ai,rF=null,Ny=(1+Math.sqrt(5))/2,ew=1/Ny,IZ=[new W(1,1,1),new W(-1,1,1),new W(1,1,-1),new W(-1,1,-1),new W(0,Ny,ew),new W(0,Ny,-ew),new W(ew,0,Ny),new W(-ew,0,Ny),new W(Ny,ew,0),new W(-Ny,ew,0)],DZ=class{constructor(t){this._renderer=t,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(t,e=0,i=.1,r=100){rF=this._renderer.getRenderTarget(),this._setSize(256);let n=this._allocateTargets();return n.depthBuffer=!0,this._sceneToCubeUV(t,i,r,n),e>0&&this._blur(n,0,0,e),this._applyPMREM(n),this._cleanup(n),n}fromEquirectangular(t,e=null){return this._fromTexture(t,e)}fromCubemap(t,e=null){return this._fromTexture(t,e)}compileCubemapShader(){this._cubemapMaterial===null&&(this._cubemapMaterial=kZ(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){this._equirectMaterial===null&&(this._equirectMaterial=LZ(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),this._cubemapMaterial!==null&&this._cubemapMaterial.dispose(),this._equirectMaterial!==null&&this._equirectMaterial.dispose()}_setSize(t){this._lodMax=Math.floor(Math.log2(t)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){this._blurMaterial!==null&&this._blurMaterial.dispose(),this._pingPongRenderTarget!==null&&this._pingPongRenderTarget.dispose();for(let t=0;t<this._lodPlanes.length;t++)this._lodPlanes[t].dispose()}_cleanup(t){this._renderer.setRenderTarget(rF),t.scissorTest=!1,IP(t,0,0,t.width,t.height)}_fromTexture(t,e){t.mapping===L0||t.mapping===k0?this._setSize(t.image.length===0?16:t.image[0].width||t.image[0].image.width):this._setSize(t.image.width/4),rF=this._renderer.getRenderTarget();let i=e||this._allocateTargets();return this._textureToCubeUV(t,i),this._applyPMREM(i),this._cleanup(i),i}_allocateTargets(){let t=3*Math.max(this._cubeSize,112),e=4*this._cubeSize,i={magFilter:nr,minFilter:nr,generateMipmaps:!1,type:qp,format:Vn,encoding:Dh,depthBuffer:!1},r=OZ(t,e,i);if(this._pingPongRenderTarget===null||this._pingPongRenderTarget.width!==t||this._pingPongRenderTarget.height!==e){this._pingPongRenderTarget!==null&&this._dispose(),this._pingPongRenderTarget=OZ(t,e,i);let{_lodMax:n}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=nWe(n)),this._blurMaterial=sWe(n,t,e)}return r}_compileMaterial(t){let e=new En(this._lodPlanes[0],t);this._renderer.compile(e,iF)}_sceneToCubeUV(t,e,i,r){let n=new No(90,1,e,i),s=[1,-1,1,1,1,1],a=[1,1,1,-1,-1,-1],o=this._renderer,l=o.autoClear,c=o.toneMapping;o.getClearColor(RZ),o.toneMapping=Gd,o.autoClear=!1;let u=new Xp({name:"PMREM.Background",side:qa,depthWrite:!1,depthTest:!1}),h=new En(new Oh,u),d=!1,f=t.background;f?f.isColor&&(u.color.copy(f),t.background=null,d=!0):(u.color.copy(RZ),d=!0);for(let p=0;p<6;p++){let g=p%3;g===0?(n.up.set(0,s[p],0),n.lookAt(a[p],0,0)):g===1?(n.up.set(0,0,s[p]),n.lookAt(0,a[p],0)):(n.up.set(0,s[p],0),n.lookAt(0,0,a[p]));let m=this._cubeSize;IP(r,g*m,p>2?m:0,m,m),o.setRenderTarget(r),d&&o.render(h,n),o.render(t,n)}h.geometry.dispose(),h.material.dispose(),o.toneMapping=c,o.autoClear=l,t.background=f}_textureToCubeUV(t,e){let i=this._renderer,r=t.mapping===L0||t.mapping===k0;r?(this._cubemapMaterial===null&&(this._cubemapMaterial=kZ()),this._cubemapMaterial.uniforms.flipEnvMap.value=t.isRenderTargetTexture===!1?-1:1):this._equirectMaterial===null&&(this._equirectMaterial=LZ());let n=r?this._cubemapMaterial:this._equirectMaterial,s=new En(this._lodPlanes[0],n),a=n.uniforms;a.envMap.value=t;let o=this._cubeSize;IP(e,0,0,3*o,2*o),i.setRenderTarget(e),i.render(s,iF)}_applyPMREM(t){let e=this._renderer,i=e.autoClear;e.autoClear=!1;for(let r=1;r<this._lodPlanes.length;r++){let n=Math.sqrt(this._sigmas[r]*this._sigmas[r]-this._sigmas[r-1]*this._sigmas[r-1]),s=IZ[(r-1)%IZ.length];this._blur(t,r-1,r,n,s)}e.autoClear=i}_blur(t,e,i,r,n){let s=this._pingPongRenderTarget;this._halfBlur(t,s,e,i,r,"latitudinal",n),this._halfBlur(s,t,i,i,r,"longitudinal",n)}_halfBlur(t,e,i,r,n,s,a){let o=this._renderer,l=this._blurMaterial;s!=="latitudinal"&&s!=="longitudinal"&&console.error("blur direction must be either latitudinal or longitudinal!");let c=3,u=new En(this._lodPlanes[r],l),h=l.uniforms,d=this._sizeLods[i]-1,f=isFinite(n)?Math.PI/(2*d):2*Math.PI/(2*Vy-1),p=n/f,g=isFinite(n)?1+Math.floor(c*p):Vy;g>Vy&&console.warn(`sigmaRadians, ${n}, is too large and will clip, as it requested ${g} samples when the maximum is set to ${Vy}`);let m=[],y=0;for(let A=0;A<Vy;++A){let P=A/p,C=Math.exp(-P*P/2);m.push(C),A===0?y+=C:A<g&&(y+=2*C)}for(let A=0;A<m.length;A++)m[A]=m[A]/y;h.envMap.value=t.texture,h.samples.value=g,h.weights.value=m,h.latitudinal.value=s==="latitudinal",a&&(h.poleAxis.value=a);let{_lodMax:b}=this;h.dTheta.value=f,h.mipInt.value=b-i;let w=this._sizeLods[r],E=3*w*(r>b-Yw?r-b+Yw:0),M=4*(this._cubeSize-w);IP(e,E,M,3*w,2*w),o.setRenderTarget(e),o.render(u,iF)}};function nWe(t){let e=[],i=[],r=[],n=t,s=t-Yw+1+PZ.length;for(let a=0;a<s;a++){let o=Math.pow(2,n);i.push(o);let l=1/o;a>t-Yw?l=PZ[a-t+Yw-1]:a===0&&(l=0),r.push(l);let c=1/(o-2),u=-c,h=1+c,d=[u,u,h,u,h,h,u,u,h,h,u,h],f=6,p=6,g=3,m=2,y=1,b=new Float32Array(g*p*f),w=new Float32Array(m*p*f),E=new Float32Array(y*p*f);for(let A=0;A<f;A++){let P=A%3*2/3-1,C=A>2?0:-1,R=[P,C,0,P+2/3,C,0,P+2/3,C+1,0,P,C,0,P+2/3,C+1,0,P,C+1,0];b.set(R,g*p*A),w.set(d,m*p*A);let I=[A,A,A,A,A,A];E.set(I,y*p*A)}let M=new oi;M.setAttribute("position",new Mi(b,g)),M.setAttribute("uv",new Mi(w,m)),M.setAttribute("faceIndex",new Mi(E,y)),e.push(M),n>Yw&&n--}return{lodPlanes:e,sizeLods:i,sigmas:r}}function OZ(t,e,i){let r=new Mr(t,e,i);return r.texture.mapping=DT,r.texture.name="PMREM.cubeUv",r.scissorTest=!0,r}function IP(t,e,i,r,n){t.viewport.set(e,i,r,n),t.scissor.set(e,i,r,n)}function sWe(t,e,i){let r=new Float32Array(Vy),n=new W(0,1,0);return new Tr({name:"SphericalGaussianBlur",defines:{n:Vy,CUBEUV_TEXEL_WIDTH:1/e,CUBEUV_TEXEL_HEIGHT:1/i,CUBEUV_MAX_MIP:`${t}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:r},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:n}},vertexShader:XH(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;
			uniform int samples;
			uniform float weights[ n ];
			uniform bool latitudinal;
			uniform float dTheta;
			uniform float mipInt;
			uniform vec3 poleAxis;

			#define ENVMAP_TYPE_CUBE_UV
			#include <cube_uv_reflection_fragment>

			vec3 getSample( float theta, vec3 axis ) {

				float cosTheta = cos( theta );
				// Rodrigues' axis-angle rotation
				vec3 sampleDirection = vOutputDirection * cosTheta
					+ cross( axis, vOutputDirection ) * sin( theta )
					+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );

				return bilinearCubeUV( envMap, sampleDirection, mipInt );

			}

			void main() {

				vec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );

				if ( all( equal( axis, vec3( 0.0 ) ) ) ) {

					axis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );

				}

				axis = normalize( axis );

				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );
				gl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );

				for ( int i = 1; i < n; i++ ) {

					if ( i >= samples ) {

						break;

					}

					float theta = dTheta * float( i );
					gl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );
					gl_FragColor.rgb += weights[ i ] * getSample( theta, axis );

				}

			}
		`,blending:Hs,depthTest:!1,depthWrite:!1})}function LZ(){return new Tr({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:XH(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;

			#include <common>

			void main() {

				vec3 outputDirection = normalize( vOutputDirection );
				vec2 uv = equirectUv( outputDirection );

				gl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );

			}
		`,blending:Hs,depthTest:!1,depthWrite:!1})}function kZ(){return new Tr({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:XH(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			uniform float flipEnvMap;

			varying vec3 vOutputDirection;

			uniform samplerCube envMap;

			void main() {

				gl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );

			}
		`,blending:Hs,depthTest:!1,depthWrite:!1})}function XH(){return`

		precision mediump float;
		precision mediump int;

		attribute float faceIndex;

		varying vec3 vOutputDirection;

		// RH coordinate system; PMREM face-indexing convention
		vec3 getDirection( vec2 uv, float face ) {

			uv = 2.0 * uv - 1.0;

			vec3 direction = vec3( uv, 1.0 );

			if ( face == 0.0 ) {

				direction = direction.zyx; // ( 1, v, u ) pos x

			} else if ( face == 1.0 ) {

				direction = direction.xzy;
				direction.xz *= -1.0; // ( -u, 1, -v ) pos y

			} else if ( face == 2.0 ) {

				direction.x *= -1.0; // ( -u, v, 1 ) pos z

			} else if ( face == 3.0 ) {

				direction = direction.zyx;
				direction.xz *= -1.0; // ( -1, v, -u ) neg x

			} else if ( face == 4.0 ) {

				direction = direction.xzy;
				direction.xy *= -1.0; // ( -u, -1, v ) neg y

			} else if ( face == 5.0 ) {

				direction.z *= -1.0; // ( u, v, -1 ) neg z

			}

			return direction;

		}

		void main() {

			vOutputDirection = getDirection( uv, faceIndex );
			gl_Position = vec4( position, 1.0 );

		}
	`}function aWe(t){let e=new WeakMap,i=null;function r(o){if(o&&o.isTexture){let l=o.mapping,c=l===bj||l===wj,u=l===L0||l===k0;if(c||u)if(o.isRenderTargetTexture&&o.needsPMREMUpdate===!0){o.needsPMREMUpdate=!1;let h=e.get(o);return i===null&&(i=new DZ(t)),h=c?i.fromEquirectangular(o,h):i.fromCubemap(o,h),e.set(o,h),h.texture}else{if(e.has(o))return e.get(o).texture;{let h=o.image;if(c&&h&&h.height>0||u&&h&&n(h)){i===null&&(i=new DZ(t));let d=c?i.fromEquirectangular(o):i.fromCubemap(o);return e.set(o,d),o.addEventListener("dispose",s),d.texture}else return null}}}return o}function n(o){let l=0,c=6;for(let u=0;u<c;u++)o[u]!==void 0&&l++;return l===c}function s(o){let l=o.target;l.removeEventListener("dispose",s);let c=e.get(l);c!==void 0&&(e.delete(l),c.dispose())}function a(){e=new WeakMap,i!==null&&(i.dispose(),i=null)}return{get:r,dispose:a}}function oWe(t){let e={};function i(r){if(e[r]!==void 0)return e[r];let n;switch(r){case"WEBGL_depth_texture":n=t.getExtension("WEBGL_depth_texture")||t.getExtension("MOZ_WEBGL_depth_texture")||t.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":n=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":n=t.getExtension("WEBGL_compressed_texture_s3tc")||t.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":n=t.getExtension("WEBGL_compressed_texture_pvrtc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:n=t.getExtension(r)}return e[r]=n,n}return{has:function(r){return i(r)!==null},init:function(r){r.isWebGL2?i("EXT_color_buffer_float"):(i("WEBGL_depth_texture"),i("OES_texture_float"),i("OES_texture_half_float"),i("OES_texture_half_float_linear"),i("OES_standard_derivatives"),i("OES_element_index_uint"),i("OES_vertex_array_object"),i("ANGLE_instanced_arrays")),i("OES_texture_float_linear"),i("EXT_color_buffer_half_float"),i("WEBGL_multisampled_render_to_texture")},get:function(r){let n=i(r);return n===null&&console.warn("THREE.WebGLRenderer: "+r+" extension not supported."),n}}}function lWe(t,e,i,r){let n={},s=new WeakMap;function a(h){let d=h.target;d.index!==null&&e.remove(d.index);for(let p in d.attributes)e.remove(d.attributes[p]);d.removeEventListener("dispose",a),delete n[d.id];let f=s.get(d);f&&(e.remove(f),s.delete(d)),r.releaseStatesOfGeometry(d),d.isInstancedBufferGeometry===!0&&delete d._maxInstanceCount,i.memory.geometries--}function o(h,d){return n[d.id]===!0||(d.addEventListener("dispose",a),n[d.id]=!0,i.memory.geometries++),d}function l(h){let d=h.attributes;for(let p in d)e.update(d[p],34962);let f=h.morphAttributes;for(let p in f){let g=f[p];for(let m=0,y=g.length;m<y;m++)e.update(g[m],34962)}}function c(h){let d=[],f=h.index,p=h.attributes.position,g=0;if(f!==null){let b=f.array;g=f.version;for(let w=0,E=b.length;w<E;w+=3){let M=b[w+0],A=b[w+1],P=b[w+2];d.push(M,A,A,P,P,M)}}else{let b=p.array;g=p.version;for(let w=0,E=b.length/3-1;w<E;w+=3){let M=w+0,A=w+1,P=w+2;d.push(M,A,A,P,P,M)}}let m=new(ohe(d)?s1:fhe)(d,1);m.version=g;let y=s.get(h);y&&e.remove(y),s.set(h,m)}function u(h){let d=s.get(h);if(d){let f=h.index;f!==null&&d.version<f.version&&c(h)}else c(h);return s.get(h)}return{get:o,update:l,getWireframeAttribute:u}}function cWe(t,e,i,r){let n=r.isWebGL2,s;function a(d){s=d}let o,l;function c(d){o=d.type,l=d.bytesPerElement}function u(d,f){t.drawElements(s,f,o,d*l),i.update(f,s,1)}function h(d,f,p){if(p===0)return;let g,m;if(n)g=t,m="drawElementsInstanced";else if(g=e.get("ANGLE_instanced_arrays"),m="drawElementsInstancedANGLE",g===null){console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");return}g[m](s,f,o,d*l,p),i.update(f,s,p)}this.setMode=a,this.setIndex=c,this.render=u,this.renderInstances=h}function uWe(t){let e={geometries:0,textures:0},i={frame:0,calls:0,triangles:0,points:0,lines:0};function r(s,a,o){switch(i.calls++,a){case 4:i.triangles+=o*(s/3);break;case 1:i.lines+=o*(s/2);break;case 3:i.lines+=o*(s-1);break;case 2:i.lines+=o*s;break;case 0:i.points+=o*s;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",a);break}}function n(){i.frame++,i.calls=0,i.triangles=0,i.points=0,i.lines=0}return{memory:e,render:i,programs:null,autoReset:!0,reset:n,update:r}}function hWe(t,e){return t[0]-e[0]}function dWe(t,e){return Math.abs(e[1])-Math.abs(t[1])}function fWe(t,e,i){let r={},n=new Float32Array(8),s=new WeakMap,a=new Ui,o=[];for(let c=0;c<8;c++)o[c]=[c,0];function l(c,u,h,d){let f=c.morphTargetInfluences;if(e.isWebGL2===!0){let p=u.morphAttributes.position||u.morphAttributes.normal||u.morphAttributes.color,g=p!==void 0?p.length:0,m=s.get(u);if(m===void 0||m.count!==g){let w=function(){F.dispose(),s.delete(u),u.removeEventListener("dispose",w)};m!==void 0&&m.texture.dispose();let E=u.morphAttributes.position!==void 0,M=u.morphAttributes.normal!==void 0,A=u.morphAttributes.color!==void 0,P=u.morphAttributes.position||[],C=u.morphAttributes.normal||[],R=u.morphAttributes.color||[],I=0;E===!0&&(I=1),M===!0&&(I=2),A===!0&&(I=3);let k=u.attributes.position.count*I,z=1;k>e.maxTextureSize&&(z=Math.ceil(k/e.maxTextureSize),k=e.maxTextureSize);let V=new Float32Array(k*z*4*g),F=new hhe(V,k,z,g);F.type=cn,F.needsUpdate=!0;let $=I*4;for(let K=0;K<g;K++){let X=P[K],U=C[K],Y=R[K],Z=k*z*4*K;for(let j=0;j<X.count;j++){let ee=j*$;E===!0&&(a.fromBufferAttribute(X,j),V[Z+ee+0]=a.x,V[Z+ee+1]=a.y,V[Z+ee+2]=a.z,V[Z+ee+3]=0),M===!0&&(a.fromBufferAttribute(U,j),V[Z+ee+4]=a.x,V[Z+ee+5]=a.y,V[Z+ee+6]=a.z,V[Z+ee+7]=0),A===!0&&(a.fromBufferAttribute(Y,j),V[Z+ee+8]=a.x,V[Z+ee+9]=a.y,V[Z+ee+10]=a.z,V[Z+ee+11]=Y.itemSize===4?a.w:1)}}m={count:g,texture:F,size:new Ae(k,z)},s.set(u,m),u.addEventListener("dispose",w)}let y=0;for(let w=0;w<f.length;w++)y+=f[w];let b=u.morphTargetsRelative?1:1-y;d.getUniforms().setValue(t,"morphTargetBaseInfluence",b),d.getUniforms().setValue(t,"morphTargetInfluences",f),d.getUniforms().setValue(t,"morphTargetsTexture",m.texture,i),d.getUniforms().setValue(t,"morphTargetsTextureSize",m.size)}else{let p=f===void 0?0:f.length,g=r[u.id];if(g===void 0||g.length!==p){g=[];for(let E=0;E<p;E++)g[E]=[E,0];r[u.id]=g}for(let E=0;E<p;E++){let M=g[E];M[0]=E,M[1]=f[E]}g.sort(dWe);for(let E=0;E<8;E++)E<p&&g[E][1]?(o[E][0]=g[E][0],o[E][1]=g[E][1]):(o[E][0]=Number.MAX_SAFE_INTEGER,o[E][1]=0);o.sort(hWe);let m=u.morphAttributes.position,y=u.morphAttributes.normal,b=0;for(let E=0;E<8;E++){let M=o[E],A=M[0],P=M[1];A!==Number.MAX_SAFE_INTEGER&&P?(m&&u.getAttribute("morphTarget"+E)!==m[A]&&u.setAttribute("morphTarget"+E,m[A]),y&&u.getAttribute("morphNormal"+E)!==y[A]&&u.setAttribute("morphNormal"+E,y[A]),n[E]=P,b+=P):(m&&u.hasAttribute("morphTarget"+E)===!0&&u.deleteAttribute("morphTarget"+E),y&&u.hasAttribute("morphNormal"+E)===!0&&u.deleteAttribute("morphNormal"+E),n[E]=0)}let w=u.morphTargetsRelative?1:1-b;d.getUniforms().setValue(t,"morphTargetBaseInfluence",w),d.getUniforms().setValue(t,"morphTargetInfluences",n)}}return{update:l}}function pWe(t,e,i,r){let n=new WeakMap;function s(l){let c=r.render.frame,u=l.geometry,h=e.get(l,u);return n.get(h)!==c&&(e.update(h),n.set(h,c)),l.isInstancedMesh&&(l.hasEventListener("dispose",o)===!1&&l.addEventListener("dispose",o),i.update(l.instanceMatrix,34962),l.instanceColor!==null&&i.update(l.instanceColor,34962)),h}function a(){n=new WeakMap}function o(l){let c=l.target;c.removeEventListener("dispose",o),i.remove(c.instanceMatrix),c.instanceColor!==null&&i.remove(c.instanceColor)}return{update:s,dispose:a}}var ghe=new Kn,vhe=new hhe,yhe=new tHe,xhe=new WH,NZ=[],UZ=[],BZ=new Float32Array(16),FZ=new Float32Array(9),zZ=new Float32Array(4);function M_(t,e,i){let r=t[0];if(r==null||r<=0||r>0)return t;let n=e*i,s=NZ[n];if(s===void 0&&(s=new Float32Array(n),NZ[n]=s),e!==0){r.toArray(s,0);for(let a=1,o=0;a!==e;++a)o+=i,t[a].toArray(s,o)}return s}function ba(t,e){if(t.length!==e.length)return!1;for(let i=0,r=t.length;i<r;i++)if(t[i]!==e[i])return!1;return!0}function wa(t,e){for(let i=0,r=e.length;i<r;i++)t[i]=e[i]}function oL(t,e){let i=UZ[e];i===void 0&&(i=new Int32Array(e),UZ[e]=i);for(let r=0;r!==e;++r)i[r]=t.allocateTextureUnit();return i}function mWe(t,e){let i=this.cache;i[0]!==e&&(t.uniform1f(this.addr,e),i[0]=e)}function gWe(t,e){let i=this.cache;if(e.x!==void 0)(i[0]!==e.x||i[1]!==e.y)&&(t.uniform2f(this.addr,e.x,e.y),i[0]=e.x,i[1]=e.y);else{if(ba(i,e))return;t.uniform2fv(this.addr,e),wa(i,e)}}function vWe(t,e){let i=this.cache;if(e.x!==void 0)(i[0]!==e.x||i[1]!==e.y||i[2]!==e.z)&&(t.uniform3f(this.addr,e.x,e.y,e.z),i[0]=e.x,i[1]=e.y,i[2]=e.z);else if(e.r!==void 0)(i[0]!==e.r||i[1]!==e.g||i[2]!==e.b)&&(t.uniform3f(this.addr,e.r,e.g,e.b),i[0]=e.r,i[1]=e.g,i[2]=e.b);else{if(ba(i,e))return;t.uniform3fv(this.addr,e),wa(i,e)}}function yWe(t,e){let i=this.cache;if(e.x!==void 0)(i[0]!==e.x||i[1]!==e.y||i[2]!==e.z||i[3]!==e.w)&&(t.uniform4f(this.addr,e.x,e.y,e.z,e.w),i[0]=e.x,i[1]=e.y,i[2]=e.z,i[3]=e.w);else{if(ba(i,e))return;t.uniform4fv(this.addr,e),wa(i,e)}}function xWe(t,e){let i=this.cache,r=e.elements;if(r===void 0){if(ba(i,e))return;t.uniformMatrix2fv(this.addr,!1,e),wa(i,e)}else{if(ba(i,r))return;zZ.set(r),t.uniformMatrix2fv(this.addr,!1,zZ),wa(i,r)}}function bWe(t,e){let i=this.cache,r=e.elements;if(r===void 0){if(ba(i,e))return;t.uniformMatrix3fv(this.addr,!1,e),wa(i,e)}else{if(ba(i,r))return;FZ.set(r),t.uniformMatrix3fv(this.addr,!1,FZ),wa(i,r)}}function wWe(t,e){let i=this.cache,r=e.elements;if(r===void 0){if(ba(i,e))return;t.uniformMatrix4fv(this.addr,!1,e),wa(i,e)}else{if(ba(i,r))return;BZ.set(r),t.uniformMatrix4fv(this.addr,!1,BZ),wa(i,r)}}function _We(t,e){let i=this.cache;i[0]!==e&&(t.uniform1i(this.addr,e),i[0]=e)}function SWe(t,e){let i=this.cache;if(e.x!==void 0)(i[0]!==e.x||i[1]!==e.y)&&(t.uniform2i(this.addr,e.x,e.y),i[0]=e.x,i[1]=e.y);else{if(ba(i,e))return;t.uniform2iv(this.addr,e),wa(i,e)}}function EWe(t,e){let i=this.cache;if(e.x!==void 0)(i[0]!==e.x||i[1]!==e.y||i[2]!==e.z)&&(t.uniform3i(this.addr,e.x,e.y,e.z),i[0]=e.x,i[1]=e.y,i[2]=e.z);else{if(ba(i,e))return;t.uniform3iv(this.addr,e),wa(i,e)}}function AWe(t,e){let i=this.cache;if(e.x!==void 0)(i[0]!==e.x||i[1]!==e.y||i[2]!==e.z||i[3]!==e.w)&&(t.uniform4i(this.addr,e.x,e.y,e.z,e.w),i[0]=e.x,i[1]=e.y,i[2]=e.z,i[3]=e.w);else{if(ba(i,e))return;t.uniform4iv(this.addr,e),wa(i,e)}}function MWe(t,e){let i=this.cache;i[0]!==e&&(t.uniform1ui(this.addr,e),i[0]=e)}function TWe(t,e){let i=this.cache;if(e.x!==void 0)(i[0]!==e.x||i[1]!==e.y)&&(t.uniform2ui(this.addr,e.x,e.y),i[0]=e.x,i[1]=e.y);else{if(ba(i,e))return;t.uniform2uiv(this.addr,e),wa(i,e)}}function CWe(t,e){let i=this.cache;if(e.x!==void 0)(i[0]!==e.x||i[1]!==e.y||i[2]!==e.z)&&(t.uniform3ui(this.addr,e.x,e.y,e.z),i[0]=e.x,i[1]=e.y,i[2]=e.z);else{if(ba(i,e))return;t.uniform3uiv(this.addr,e),wa(i,e)}}function PWe(t,e){let i=this.cache;if(e.x!==void 0)(i[0]!==e.x||i[1]!==e.y||i[2]!==e.z||i[3]!==e.w)&&(t.uniform4ui(this.addr,e.x,e.y,e.z,e.w),i[0]=e.x,i[1]=e.y,i[2]=e.z,i[3]=e.w);else{if(ba(i,e))return;t.uniform4uiv(this.addr,e),wa(i,e)}}function RWe(t,e,i){let r=this.cache,n=i.allocateTextureUnit();r[0]!==n&&(t.uniform1i(this.addr,n),r[0]=n),i.setTexture2D(e||ghe,n)}function IWe(t,e,i){let r=this.cache,n=i.allocateTextureUnit();r[0]!==n&&(t.uniform1i(this.addr,n),r[0]=n),i.setTexture3D(e||yhe,n)}function DWe(t,e,i){let r=this.cache,n=i.allocateTextureUnit();r[0]!==n&&(t.uniform1i(this.addr,n),r[0]=n),i.setTextureCube(e||xhe,n)}function OWe(t,e,i){let r=this.cache,n=i.allocateTextureUnit();r[0]!==n&&(t.uniform1i(this.addr,n),r[0]=n),i.setTexture2DArray(e||vhe,n)}function LWe(t){switch(t){case 5126:return mWe;case 35664:return gWe;case 35665:return vWe;case 35666:return yWe;case 35674:return xWe;case 35675:return bWe;case 35676:return wWe;case 5124:case 35670:return _We;case 35667:case 35671:return SWe;case 35668:case 35672:return EWe;case 35669:case 35673:return AWe;case 5125:return MWe;case 36294:return TWe;case 36295:return CWe;case 36296:return PWe;case 35678:case 36198:case 36298:case 36306:case 35682:return RWe;case 35679:case 36299:case 36307:return IWe;case 35680:case 36300:case 36308:case 36293:return DWe;case 36289:case 36303:case 36311:case 36292:return OWe}}function kWe(t,e){t.uniform1fv(this.addr,e)}function NWe(t,e){let i=M_(e,this.size,2);t.uniform2fv(this.addr,i)}function UWe(t,e){let i=M_(e,this.size,3);t.uniform3fv(this.addr,i)}function BWe(t,e){let i=M_(e,this.size,4);t.uniform4fv(this.addr,i)}function FWe(t,e){let i=M_(e,this.size,4);t.uniformMatrix2fv(this.addr,!1,i)}function zWe(t,e){let i=M_(e,this.size,9);t.uniformMatrix3fv(this.addr,!1,i)}function jWe(t,e){let i=M_(e,this.size,16);t.uniformMatrix4fv(this.addr,!1,i)}function VWe(t,e){t.uniform1iv(this.addr,e)}function HWe(t,e){t.uniform2iv(this.addr,e)}function GWe(t,e){t.uniform3iv(this.addr,e)}function WWe(t,e){t.uniform4iv(this.addr,e)}function qWe(t,e){t.uniform1uiv(this.addr,e)}function XWe(t,e){t.uniform2uiv(this.addr,e)}function $We(t,e){t.uniform3uiv(this.addr,e)}function YWe(t,e){t.uniform4uiv(this.addr,e)}function KWe(t,e,i){let r=this.cache,n=e.length,s=oL(i,n);ba(r,s)||(t.uniform1iv(this.addr,s),wa(r,s));for(let a=0;a!==n;++a)i.setTexture2D(e[a]||ghe,s[a])}function ZWe(t,e,i){let r=this.cache,n=e.length,s=oL(i,n);ba(r,s)||(t.uniform1iv(this.addr,s),wa(r,s));for(let a=0;a!==n;++a)i.setTexture3D(e[a]||yhe,s[a])}function QWe(t,e,i){let r=this.cache,n=e.length,s=oL(i,n);ba(r,s)||(t.uniform1iv(this.addr,s),wa(r,s));for(let a=0;a!==n;++a)i.setTextureCube(e[a]||xhe,s[a])}function JWe(t,e,i){let r=this.cache,n=e.length,s=oL(i,n);ba(r,s)||(t.uniform1iv(this.addr,s),wa(r,s));for(let a=0;a!==n;++a)i.setTexture2DArray(e[a]||vhe,s[a])}function e9e(t){switch(t){case 5126:return kWe;case 35664:return NWe;case 35665:return UWe;case 35666:return BWe;case 35674:return FWe;case 35675:return zWe;case 35676:return jWe;case 5124:case 35670:return VWe;case 35667:case 35671:return HWe;case 35668:case 35672:return GWe;case 35669:case 35673:return WWe;case 5125:return qWe;case 36294:return XWe;case 36295:return $We;case 36296:return YWe;case 35678:case 36198:case 36298:case 36306:case 35682:return KWe;case 35679:case 36299:case 36307:return ZWe;case 35680:case 36300:case 36308:case 36293:return QWe;case 36289:case 36303:case 36311:case 36292:return JWe}}var t9e=class{constructor(t,e,i){this.id=t,this.addr=i,this.cache=[],this.setValue=LWe(e.type)}},i9e=class{constructor(t,e,i){this.id=t,this.addr=i,this.cache=[],this.size=e.size,this.setValue=e9e(e.type)}},r9e=class{constructor(t){this.id=t,this.seq=[],this.map={}}setValue(t,e,i){if(e===void 0)return;let r=this.seq;for(let n=0,s=r.length;n!==s;++n){let a=r[n];a.setValue(t,e[a.id],i)}}},nF=/(\w+)(\])?(\[|\.)?/g;function jZ(t,e){t.seq.push(e),t.map[e.id]=e}function n9e(t,e,i){let r=t.name,n=r.length;for(nF.lastIndex=0;;){let s=nF.exec(r),a=nF.lastIndex,o=s[1],l=s[2]==="]",c=s[3];if(l&&(o=o|0),c===void 0||c==="["&&a+2===n){jZ(i,c===void 0?new t9e(o,t,e):new i9e(o,t,e));break}else{let u=i.map[o];u===void 0&&(u=new r9e(o),jZ(i,u)),i=u}}}var rI=class{constructor(t,e){this.seq=[],this.map={};let i=t.getProgramParameter(e,35718);for(let r=0;r<i;++r){let n=t.getActiveUniform(e,r),s=t.getUniformLocation(e,n.name);n9e(n,s,this)}}setValue(t,e,i,r){let n=this.map[e];n!==void 0&&n.setValue(t,i,r)}setOptional(t,e,i){let r=e[i];r!==void 0&&this.setValue(t,i,r)}static upload(t,e,i,r){for(let n=0,s=e.length;n!==s;++n){let a=e[n],o=i[a.id];o.needsUpdate!==!1&&a.setValue(t,o.value,r)}}static seqWithValue(t,e){let i=[];for(let r=0,n=t.length;r!==n;++r){let s=t[r];s.id in e&&i.push(s)}return i}};function VZ(t,e,i){let r=t.createShader(e);return t.shaderSource(r,i),t.compileShader(r),r}var s9e=0;function a9e(t,e){let i=t.split(`
`),r=[],n=Math.max(e-6,0),s=Math.min(e+6,i.length);for(let a=n;a<s;a++){let o=a+1;r.push(`${o===e?">":" "} ${o}: ${i[a]}`)}return r.join(`
`)}function o9e(t){switch(t){case Dh:return["Linear","( value )"];case er:return["sRGB","( value )"];default:return console.warn("THREE.WebGLProgram: Unsupported encoding:",t),["Linear","( value )"]}}function HZ(t,e,i){let r=t.getShaderParameter(e,35713),n=t.getShaderInfoLog(e).trim();if(r&&n==="")return"";let s=/ERROR: 0:(\d+)/.exec(n);if(s){let a=parseInt(s[1]);return i.toUpperCase()+`

`+n+`

`+a9e(t.getShaderSource(e),a)}else return n}function l9e(t,e){let i=o9e(e);return"vec4 "+t+"( vec4 value ) { return LinearTo"+i[0]+i[1]+"; }"}function c9e(t,e){let i;switch(e){case g6e:i="Linear";break;case v6e:i="Reinhard";break;case y6e:i="OptimizedCineon";break;case x6e:i="ACESFilmic";break;case b6e:i="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",e),i="Linear"}return"vec3 "+t+"( vec3 color ) { return "+i+"ToneMapping( color ); }"}function u9e(t){return[t.extensionDerivatives||t.envMapCubeUVHeight||t.bumpMap||t.tangentSpaceNormalMap||t.clearcoatNormalMap||t.flatShading||t.shaderID==="physical"?"#extension GL_OES_standard_derivatives : enable":"",(t.extensionFragDepth||t.logarithmicDepthBuffer)&&t.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",t.extensionDrawBuffers&&t.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(t.extensionShaderTextureLOD||t.envMap||t.transmission)&&t.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(WE).join(`
`)}function h9e(t){let e=[];for(let i in t){let r=t[i];r!==!1&&e.push("#define "+i+" "+r)}return e.join(`
`)}function d9e(t,e){let i={},r=t.getProgramParameter(e,35721);for(let n=0;n<r;n++){let s=t.getActiveAttrib(e,n),a=s.name,o=1;s.type===35674&&(o=2),s.type===35675&&(o=3),s.type===35676&&(o=4),i[a]={type:s.type,location:t.getAttribLocation(e,a),locationSize:o}}return i}function WE(t){return t!==""}function GZ(t,e){let i=e.numSpotLightShadows+e.numSpotLightMaps-e.numSpotLightShadowsWithMaps;return t.replace(/NUM_DIR_LIGHTS/g,e.numDirLights).replace(/NUM_SPOT_LIGHTS/g,e.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,e.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,i).replace(/NUM_RECT_AREA_LIGHTS/g,e.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,e.numPointLights).replace(/NUM_HEMI_LIGHTS/g,e.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,e.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,e.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,e.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,e.numPointLightShadows)}function WZ(t,e){return t.replace(/NUM_CLIPPING_PLANES/g,e.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,e.numClippingPlanes-e.numClipIntersection)}var f9e=/^[ \t]*#include +<([\w\d./]+)>/gm;function Tj(t){return t.replace(f9e,p9e)}function p9e(t,e){let i=ir[e];if(i===void 0)throw new Error("Can not resolve #include <"+e+">");return Tj(i)}var m9e=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function qZ(t){return t.replace(m9e,g9e)}function g9e(t,e,i,r){let n="";for(let s=parseInt(e);s<parseInt(i);s++)n+=r.replace(/\[\s*i\s*\]/g,"[ "+s+" ]").replace(/UNROLLED_LOOP_INDEX/g,s);return n}function XZ(t){let e="precision "+t.precision+` float;
precision `+t.precision+" int;";return t.precision==="highp"?e+=`
#define HIGH_PRECISION`:t.precision==="mediump"?e+=`
#define MEDIUM_PRECISION`:t.precision==="lowp"&&(e+=`
#define LOW_PRECISION`),e}function v9e(t){let e="SHADOWMAP_TYPE_BASIC";return t.shadowMapType===zH?e="SHADOWMAP_TYPE_PCF":t.shadowMapType===$Ve?e="SHADOWMAP_TYPE_PCF_SOFT":t.shadowMapType===GE&&(e="SHADOWMAP_TYPE_VSM"),e}function y9e(t){let e="ENVMAP_TYPE_CUBE";if(t.envMap)switch(t.envMapMode){case L0:case k0:e="ENVMAP_TYPE_CUBE";break;case DT:e="ENVMAP_TYPE_CUBE_UV";break}return e}function x9e(t){let e="ENVMAP_MODE_REFLECTION";if(t.envMap)switch(t.envMapMode){case k0:e="ENVMAP_MODE_REFRACTION";break}return e}function b9e(t){let e="ENVMAP_BLENDING_NONE";if(t.envMap)switch(t.combine){case Jue:e="ENVMAP_BLENDING_MULTIPLY";break;case p6e:e="ENVMAP_BLENDING_MIX";break;case m6e:e="ENVMAP_BLENDING_ADD";break}return e}function w9e(t){let e=t.envMapCubeUVHeight;if(e===null)return null;let i=Math.log2(e)-2,r=1/e;return{texelWidth:1/(3*Math.max(Math.pow(2,i),112)),texelHeight:r,maxMip:i}}function _9e(t,e,i,r){let n=t.getContext(),s=i.defines,a=i.vertexShader,o=i.fragmentShader,l=v9e(i),c=y9e(i),u=x9e(i),h=b9e(i),d=w9e(i),f=i.isWebGL2?"":u9e(i),p=h9e(s),g=n.createProgram(),m,y,b=i.glslVersion?"#version "+i.glslVersion+`
`:"";i.isRawShaderMaterial?(m=[p].filter(WE).join(`
`),m.length>0&&(m+=`
`),y=[f,p].filter(WE).join(`
`),y.length>0&&(y+=`
`)):(m=[XZ(i),"#define SHADER_NAME "+i.shaderName,p,i.instancing?"#define USE_INSTANCING":"",i.instancingColor?"#define USE_INSTANCING_COLOR":"",i.supportsVertexTextures?"#define VERTEX_TEXTURES":"",i.useFog&&i.fog?"#define USE_FOG":"",i.useFog&&i.fogExp2?"#define FOG_EXP2":"",i.map?"#define USE_MAP":"",i.envMap?"#define USE_ENVMAP":"",i.envMap?"#define "+u:"",i.lightMap?"#define USE_LIGHTMAP":"",i.aoMap?"#define USE_AOMAP":"",i.emissiveMap?"#define USE_EMISSIVEMAP":"",i.bumpMap?"#define USE_BUMPMAP":"",i.normalMap?"#define USE_NORMALMAP":"",i.normalMap&&i.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",i.normalMap&&i.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",i.clearcoatMap?"#define USE_CLEARCOATMAP":"",i.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",i.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",i.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",i.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",i.displacementMap&&i.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",i.specularMap?"#define USE_SPECULARMAP":"",i.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",i.specularColorMap?"#define USE_SPECULARCOLORMAP":"",i.roughnessMap?"#define USE_ROUGHNESSMAP":"",i.metalnessMap?"#define USE_METALNESSMAP":"",i.alphaMap?"#define USE_ALPHAMAP":"",i.transmission?"#define USE_TRANSMISSION":"",i.transmissionMap?"#define USE_TRANSMISSIONMAP":"",i.thicknessMap?"#define USE_THICKNESSMAP":"",i.sheenColorMap?"#define USE_SHEENCOLORMAP":"",i.sheenRoughnessMap?"#define USE_SHEENROUGHNESSMAP":"",i.vertexTangents?"#define USE_TANGENT":"",i.vertexColors?"#define USE_COLOR":"",i.vertexAlphas?"#define USE_COLOR_ALPHA":"",i.vertexUvs?"#define USE_UV":"",i.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",i.flatShading?"#define FLAT_SHADED":"",i.skinning?"#define USE_SKINNING":"",i.morphTargets?"#define USE_MORPHTARGETS":"",i.morphNormals&&i.flatShading===!1?"#define USE_MORPHNORMALS":"",i.morphColors&&i.isWebGL2?"#define USE_MORPHCOLORS":"",i.morphTargetsCount>0&&i.isWebGL2?"#define MORPHTARGETS_TEXTURE":"",i.morphTargetsCount>0&&i.isWebGL2?"#define MORPHTARGETS_TEXTURE_STRIDE "+i.morphTextureStride:"",i.morphTargetsCount>0&&i.isWebGL2?"#define MORPHTARGETS_COUNT "+i.morphTargetsCount:"",i.doubleSided?"#define DOUBLE_SIDED":"",i.flipSided?"#define FLIP_SIDED":"",i.shadowMapEnabled?"#define USE_SHADOWMAP":"",i.shadowMapEnabled?"#define "+l:"",i.sizeAttenuation?"#define USE_SIZEATTENUATION":"",i.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",i.logarithmicDepthBuffer&&i.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","	attribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","	attribute vec3 instanceColor;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_TANGENT","	attribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","	attribute vec4 color;","#elif defined( USE_COLOR )","	attribute vec3 color;","#endif","#if ( defined( USE_MORPHTARGETS ) && ! defined( MORPHTARGETS_TEXTURE ) )","	attribute vec3 morphTarget0;","	attribute vec3 morphTarget1;","	attribute vec3 morphTarget2;","	attribute vec3 morphTarget3;","	#ifdef USE_MORPHNORMALS","		attribute vec3 morphNormal0;","		attribute vec3 morphNormal1;","		attribute vec3 morphNormal2;","		attribute vec3 morphNormal3;","	#else","		attribute vec3 morphTarget4;","		attribute vec3 morphTarget5;","		attribute vec3 morphTarget6;","		attribute vec3 morphTarget7;","	#endif","#endif","#ifdef USE_SKINNING","	attribute vec4 skinIndex;","	attribute vec4 skinWeight;","#endif",`
`].filter(WE).join(`
`),y=[f,XZ(i),"#define SHADER_NAME "+i.shaderName,p,i.useFog&&i.fog?"#define USE_FOG":"",i.useFog&&i.fogExp2?"#define FOG_EXP2":"",i.map?"#define USE_MAP":"",i.matcap?"#define USE_MATCAP":"",i.envMap?"#define USE_ENVMAP":"",i.envMap?"#define "+c:"",i.envMap?"#define "+u:"",i.envMap?"#define "+h:"",d?"#define CUBEUV_TEXEL_WIDTH "+d.texelWidth:"",d?"#define CUBEUV_TEXEL_HEIGHT "+d.texelHeight:"",d?"#define CUBEUV_MAX_MIP "+d.maxMip+".0":"",i.lightMap?"#define USE_LIGHTMAP":"",i.aoMap?"#define USE_AOMAP":"",i.emissiveMap?"#define USE_EMISSIVEMAP":"",i.bumpMap?"#define USE_BUMPMAP":"",i.normalMap?"#define USE_NORMALMAP":"",i.normalMap&&i.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",i.normalMap&&i.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",i.clearcoat?"#define USE_CLEARCOAT":"",i.clearcoatMap?"#define USE_CLEARCOATMAP":"",i.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",i.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",i.iridescence?"#define USE_IRIDESCENCE":"",i.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",i.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",i.specularMap?"#define USE_SPECULARMAP":"",i.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",i.specularColorMap?"#define USE_SPECULARCOLORMAP":"",i.roughnessMap?"#define USE_ROUGHNESSMAP":"",i.metalnessMap?"#define USE_METALNESSMAP":"",i.alphaMap?"#define USE_ALPHAMAP":"",i.alphaTest?"#define USE_ALPHATEST":"",i.sheen?"#define USE_SHEEN":"",i.sheenColorMap?"#define USE_SHEENCOLORMAP":"",i.sheenRoughnessMap?"#define USE_SHEENROUGHNESSMAP":"",i.transmission?"#define USE_TRANSMISSION":"",i.transmissionMap?"#define USE_TRANSMISSIONMAP":"",i.thicknessMap?"#define USE_THICKNESSMAP":"",i.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",i.vertexTangents?"#define USE_TANGENT":"",i.vertexColors||i.instancingColor?"#define USE_COLOR":"",i.vertexAlphas?"#define USE_COLOR_ALPHA":"",i.vertexUvs?"#define USE_UV":"",i.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",i.gradientMap?"#define USE_GRADIENTMAP":"",i.flatShading?"#define FLAT_SHADED":"",i.doubleSided?"#define DOUBLE_SIDED":"",i.flipSided?"#define FLIP_SIDED":"",i.shadowMapEnabled?"#define USE_SHADOWMAP":"",i.shadowMapEnabled?"#define "+l:"",i.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",i.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",i.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",i.logarithmicDepthBuffer&&i.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",i.toneMapping!==Gd?"#define TONE_MAPPING":"",i.toneMapping!==Gd?ir.tonemapping_pars_fragment:"",i.toneMapping!==Gd?c9e("toneMapping",i.toneMapping):"",i.dithering?"#define DITHERING":"",i.opaque?"#define OPAQUE":"",ir.encodings_pars_fragment,l9e("linearToOutputTexel",i.outputEncoding),i.useDepthPacking?"#define DEPTH_PACKING "+i.depthPacking:"",`
`].filter(WE).join(`
`)),a=Tj(a),a=GZ(a,i),a=WZ(a,i),o=Tj(o),o=GZ(o,i),o=WZ(o,i),a=qZ(a),o=qZ(o),i.isWebGL2&&i.isRawShaderMaterial!==!0&&(b=`#version 300 es
`,m=["precision mediump sampler2DArray;","#define attribute in","#define varying out","#define texture2D texture"].join(`
`)+`
`+m,y=["#define varying in",i.glslVersion===Ej?"":"layout(location = 0) out highp vec4 pc_fragColor;",i.glslVersion===Ej?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join(`
`)+`
`+y);let w=b+m+a,E=b+y+o,M=VZ(n,35633,w),A=VZ(n,35632,E);if(n.attachShader(g,M),n.attachShader(g,A),i.index0AttributeName!==void 0?n.bindAttribLocation(g,0,i.index0AttributeName):i.morphTargets===!0&&n.bindAttribLocation(g,0,"position"),n.linkProgram(g),t.debug.checkShaderErrors){let R=n.getProgramInfoLog(g).trim(),I=n.getShaderInfoLog(M).trim(),k=n.getShaderInfoLog(A).trim(),z=!0,V=!0;if(n.getProgramParameter(g,35714)===!1){z=!1;let F=HZ(n,M,"vertex"),$=HZ(n,A,"fragment");console.error("THREE.WebGLProgram: Shader Error "+n.getError()+" - VALIDATE_STATUS "+n.getProgramParameter(g,35715)+`

Program Info Log: `+R+`
`+F+`
`+$)}else R!==""?console.warn("THREE.WebGLProgram: Program Info Log:",R):(I===""||k==="")&&(V=!1);V&&(this.diagnostics={runnable:z,programLog:R,vertexShader:{log:I,prefix:m},fragmentShader:{log:k,prefix:y}})}n.deleteShader(M),n.deleteShader(A);let P;this.getUniforms=function(){return P===void 0&&(P=new rI(n,g)),P};let C;return this.getAttributes=function(){return C===void 0&&(C=d9e(n,g)),C},this.destroy=function(){r.releaseStatesOfProgram(this),n.deleteProgram(g),this.program=void 0},this.name=i.shaderName,this.id=s9e++,this.cacheKey=e,this.usedTimes=1,this.program=g,this.vertexShader=M,this.fragmentShader=A,this}var S9e=0,E9e=class{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(t){let e=t.vertexShader,i=t.fragmentShader,r=this._getShaderStage(e),n=this._getShaderStage(i),s=this._getShaderCacheForMaterial(t);return s.has(r)===!1&&(s.add(r),r.usedTimes++),s.has(n)===!1&&(s.add(n),n.usedTimes++),this}remove(t){let e=this.materialCache.get(t);for(let i of e)i.usedTimes--,i.usedTimes===0&&this.shaderCache.delete(i.code);return this.materialCache.delete(t),this}getVertexShaderID(t){return this._getShaderStage(t.vertexShader).id}getFragmentShaderID(t){return this._getShaderStage(t.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(t){let e=this.materialCache,i=e.get(t);return i===void 0&&(i=new Set,e.set(t,i)),i}_getShaderStage(t){let e=this.shaderCache,i=e.get(t);return i===void 0&&(i=new A9e(t),e.set(t,i)),i}},A9e=class{constructor(t){this.id=S9e++,this.code=t,this.usedTimes=0}};function M9e(t,e,i,r,n,s,a){let o=new GH,l=new E9e,c=[],u=n.isWebGL2,h=n.logarithmicDepthBuffer,d=n.vertexTextures,f=n.precision,p={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};function g(C,R,I,k,z){let V=k.fog,F=z.geometry,$=C.isMeshStandardMaterial?k.environment:null,K=(C.isMeshStandardMaterial?i:e).get(C.envMap||$),X=K&&K.mapping===DT?K.image.height:null,U=p[C.type];C.precision!==null&&(f=n.getMaxPrecision(C.precision),f!==C.precision&&console.warn("THREE.WebGLProgram.getParameters:",C.precision,"not supported, using",f,"instead."));let Y=F.morphAttributes.position||F.morphAttributes.normal||F.morphAttributes.color,Z=Y!==void 0?Y.length:0,j=0;F.morphAttributes.position!==void 0&&(j=1),F.morphAttributes.normal!==void 0&&(j=2),F.morphAttributes.color!==void 0&&(j=3);let ee,pe,fe,se;if(U){let xe=wd[U];ee=xe.vertexShader,pe=xe.fragmentShader}else ee=C.vertexShader,pe=C.fragmentShader,l.update(C),fe=l.getVertexShaderID(C),se=l.getFragmentShaderID(C);let re=t.getRenderTarget(),le=C.alphaTest>0,he=C.clearcoat>0,ve=C.iridescence>0;return{isWebGL2:u,shaderID:U,shaderName:C.type,vertexShader:ee,fragmentShader:pe,defines:C.defines,customVertexShaderID:fe,customFragmentShaderID:se,isRawShaderMaterial:C.isRawShaderMaterial===!0,glslVersion:C.glslVersion,precision:f,instancing:z.isInstancedMesh===!0,instancingColor:z.isInstancedMesh===!0&&z.instanceColor!==null,supportsVertexTextures:d,outputEncoding:re===null?t.outputEncoding:re.isXRRenderTarget===!0?re.texture.encoding:Dh,map:!!C.map,matcap:!!C.matcap,envMap:!!K,envMapMode:K&&K.mapping,envMapCubeUVHeight:X,lightMap:!!C.lightMap,aoMap:!!C.aoMap,emissiveMap:!!C.emissiveMap,bumpMap:!!C.bumpMap,normalMap:!!C.normalMap,objectSpaceNormalMap:C.normalMapType===N6e,tangentSpaceNormalMap:C.normalMapType===k6e,decodeVideoTexture:!!C.map&&C.map.isVideoTexture===!0&&C.map.encoding===er,clearcoat:he,clearcoatMap:he&&!!C.clearcoatMap,clearcoatRoughnessMap:he&&!!C.clearcoatRoughnessMap,clearcoatNormalMap:he&&!!C.clearcoatNormalMap,iridescence:ve,iridescenceMap:ve&&!!C.iridescenceMap,iridescenceThicknessMap:ve&&!!C.iridescenceThicknessMap,displacementMap:!!C.displacementMap,roughnessMap:!!C.roughnessMap,metalnessMap:!!C.metalnessMap,specularMap:!!C.specularMap,specularIntensityMap:!!C.specularIntensityMap,specularColorMap:!!C.specularColorMap,opaque:C.transparent===!1&&C.blending===g0,alphaMap:!!C.alphaMap,alphaTest:le,gradientMap:!!C.gradientMap,sheen:C.sheen>0,sheenColorMap:!!C.sheenColorMap,sheenRoughnessMap:!!C.sheenRoughnessMap,transmission:C.transmission>0,transmissionMap:!!C.transmissionMap,thicknessMap:!!C.thicknessMap,combine:C.combine,vertexTangents:!!C.normalMap&&!!F.attributes.tangent,vertexColors:C.vertexColors,vertexAlphas:C.vertexColors===!0&&!!F.attributes.color&&F.attributes.color.itemSize===4,vertexUvs:!!C.map||!!C.bumpMap||!!C.normalMap||!!C.specularMap||!!C.alphaMap||!!C.emissiveMap||!!C.roughnessMap||!!C.metalnessMap||!!C.clearcoatMap||!!C.clearcoatRoughnessMap||!!C.clearcoatNormalMap||!!C.iridescenceMap||!!C.iridescenceThicknessMap||!!C.displacementMap||!!C.transmissionMap||!!C.thicknessMap||!!C.specularIntensityMap||!!C.specularColorMap||!!C.sheenColorMap||!!C.sheenRoughnessMap,uvsVertexOnly:!(C.map||C.bumpMap||C.normalMap||C.specularMap||C.alphaMap||C.emissiveMap||C.roughnessMap||C.metalnessMap||C.clearcoatNormalMap||C.iridescenceMap||C.iridescenceThicknessMap||C.transmission>0||C.transmissionMap||C.thicknessMap||C.specularIntensityMap||C.specularColorMap||C.sheen>0||C.sheenColorMap||C.sheenRoughnessMap)&&!!C.displacementMap,fog:!!V,useFog:C.fog===!0,fogExp2:V&&V.isFogExp2,flatShading:!!C.flatShading,sizeAttenuation:C.sizeAttenuation,logarithmicDepthBuffer:h,skinning:z.isSkinnedMesh===!0,morphTargets:F.morphAttributes.position!==void 0,morphNormals:F.morphAttributes.normal!==void 0,morphColors:F.morphAttributes.color!==void 0,morphTargetsCount:Z,morphTextureStride:j,numDirLights:R.directional.length,numPointLights:R.point.length,numSpotLights:R.spot.length,numSpotLightMaps:R.spotLightMap.length,numRectAreaLights:R.rectArea.length,numHemiLights:R.hemi.length,numDirLightShadows:R.directionalShadowMap.length,numPointLightShadows:R.pointShadowMap.length,numSpotLightShadows:R.spotShadowMap.length,numSpotLightShadowsWithMaps:R.numSpotLightShadowsWithMaps,numClippingPlanes:a.numPlanes,numClipIntersection:a.numIntersection,dithering:C.dithering,shadowMapEnabled:t.shadowMap.enabled&&I.length>0,shadowMapType:t.shadowMap.type,toneMapping:C.toneMapped?t.toneMapping:Gd,physicallyCorrectLights:t.physicallyCorrectLights,premultipliedAlpha:C.premultipliedAlpha,doubleSided:C.side===jo,flipSided:C.side===qa,useDepthPacking:!!C.depthPacking,depthPacking:C.depthPacking||0,index0AttributeName:C.index0AttributeName,extensionDerivatives:C.extensions&&C.extensions.derivatives,extensionFragDepth:C.extensions&&C.extensions.fragDepth,extensionDrawBuffers:C.extensions&&C.extensions.drawBuffers,extensionShaderTextureLOD:C.extensions&&C.extensions.shaderTextureLOD,rendererExtensionFragDepth:u||r.has("EXT_frag_depth"),rendererExtensionDrawBuffers:u||r.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:u||r.has("EXT_shader_texture_lod"),customProgramCacheKey:C.customProgramCacheKey()}}function m(C){let R=[];if(C.shaderID?R.push(C.shaderID):(R.push(C.customVertexShaderID),R.push(C.customFragmentShaderID)),C.defines!==void 0)for(let I in C.defines)R.push(I),R.push(C.defines[I]);return C.isRawShaderMaterial===!1&&(y(R,C),b(R,C),R.push(t.outputEncoding)),R.push(C.customProgramCacheKey),R.join()}function y(C,R){C.push(R.precision),C.push(R.outputEncoding),C.push(R.envMapMode),C.push(R.envMapCubeUVHeight),C.push(R.combine),C.push(R.vertexUvs),C.push(R.fogExp2),C.push(R.sizeAttenuation),C.push(R.morphTargetsCount),C.push(R.morphAttributeCount),C.push(R.numDirLights),C.push(R.numPointLights),C.push(R.numSpotLights),C.push(R.numSpotLightMaps),C.push(R.numHemiLights),C.push(R.numRectAreaLights),C.push(R.numDirLightShadows),C.push(R.numPointLightShadows),C.push(R.numSpotLightShadows),C.push(R.numSpotLightShadowsWithMaps),C.push(R.shadowMapType),C.push(R.toneMapping),C.push(R.numClippingPlanes),C.push(R.numClipIntersection),C.push(R.depthPacking)}function b(C,R){o.disableAll(),R.isWebGL2&&o.enable(0),R.supportsVertexTextures&&o.enable(1),R.instancing&&o.enable(2),R.instancingColor&&o.enable(3),R.map&&o.enable(4),R.matcap&&o.enable(5),R.envMap&&o.enable(6),R.lightMap&&o.enable(7),R.aoMap&&o.enable(8),R.emissiveMap&&o.enable(9),R.bumpMap&&o.enable(10),R.normalMap&&o.enable(11),R.objectSpaceNormalMap&&o.enable(12),R.tangentSpaceNormalMap&&o.enable(13),R.clearcoat&&o.enable(14),R.clearcoatMap&&o.enable(15),R.clearcoatRoughnessMap&&o.enable(16),R.clearcoatNormalMap&&o.enable(17),R.iridescence&&o.enable(18),R.iridescenceMap&&o.enable(19),R.iridescenceThicknessMap&&o.enable(20),R.displacementMap&&o.enable(21),R.specularMap&&o.enable(22),R.roughnessMap&&o.enable(23),R.metalnessMap&&o.enable(24),R.gradientMap&&o.enable(25),R.alphaMap&&o.enable(26),R.alphaTest&&o.enable(27),R.vertexColors&&o.enable(28),R.vertexAlphas&&o.enable(29),R.vertexUvs&&o.enable(30),R.vertexTangents&&o.enable(31),R.uvsVertexOnly&&o.enable(32),C.push(o.mask),o.disableAll(),R.fog&&o.enable(0),R.useFog&&o.enable(1),R.flatShading&&o.enable(2),R.logarithmicDepthBuffer&&o.enable(3),R.skinning&&o.enable(4),R.morphTargets&&o.enable(5),R.morphNormals&&o.enable(6),R.morphColors&&o.enable(7),R.premultipliedAlpha&&o.enable(8),R.shadowMapEnabled&&o.enable(9),R.physicallyCorrectLights&&o.enable(10),R.doubleSided&&o.enable(11),R.flipSided&&o.enable(12),R.useDepthPacking&&o.enable(13),R.dithering&&o.enable(14),R.specularIntensityMap&&o.enable(15),R.specularColorMap&&o.enable(16),R.transmission&&o.enable(17),R.transmissionMap&&o.enable(18),R.thicknessMap&&o.enable(19),R.sheen&&o.enable(20),R.sheenColorMap&&o.enable(21),R.sheenRoughnessMap&&o.enable(22),R.decodeVideoTexture&&o.enable(23),R.opaque&&o.enable(24),C.push(o.mask)}function w(C){let R=p[C.type],I;if(R){let k=wd[R];I=A_.clone(k.uniforms)}else I=C.uniforms;return I}function E(C,R){let I;for(let k=0,z=c.length;k<z;k++){let V=c[k];if(V.cacheKey===R){I=V,++I.usedTimes;break}}return I===void 0&&(I=new _9e(t,R,C,s),c.push(I)),I}function M(C){if(--C.usedTimes===0){let R=c.indexOf(C);c[R]=c[c.length-1],c.pop(),C.destroy()}}function A(C){l.remove(C)}function P(){l.dispose()}return{getParameters:g,getProgramCacheKey:m,getUniforms:w,acquireProgram:E,releaseProgram:M,releaseShaderCache:A,programs:c,dispose:P}}function T9e(){let t=new WeakMap;function e(s){let a=t.get(s);return a===void 0&&(a={},t.set(s,a)),a}function i(s){t.delete(s)}function r(s,a,o){t.get(s)[a]=o}function n(){t=new WeakMap}return{get:e,remove:i,update:r,dispose:n}}function C9e(t,e){return t.groupOrder!==e.groupOrder?t.groupOrder-e.groupOrder:t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.material.id!==e.material.id?t.material.id-e.material.id:t.z!==e.z?t.z-e.z:t.id-e.id}function $Z(t,e){return t.groupOrder!==e.groupOrder?t.groupOrder-e.groupOrder:t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.z!==e.z?e.z-t.z:t.id-e.id}function YZ(){let t=[],e=0,i=[],r=[],n=[];function s(){e=0,i.length=0,r.length=0,n.length=0}function a(h,d,f,p,g,m){let y=t[e];return y===void 0?(y={id:h.id,object:h,geometry:d,material:f,groupOrder:p,renderOrder:h.renderOrder,z:g,group:m},t[e]=y):(y.id=h.id,y.object=h,y.geometry=d,y.material=f,y.groupOrder=p,y.renderOrder=h.renderOrder,y.z=g,y.group=m),e++,y}function o(h,d,f,p,g,m){let y=a(h,d,f,p,g,m);f.transmission>0?r.push(y):f.transparent===!0?n.push(y):i.push(y)}function l(h,d,f,p,g,m){let y=a(h,d,f,p,g,m);f.transmission>0?r.unshift(y):f.transparent===!0?n.unshift(y):i.unshift(y)}function c(h,d){i.length>1&&i.sort(h||C9e),r.length>1&&r.sort(d||$Z),n.length>1&&n.sort(d||$Z)}function u(){for(let h=e,d=t.length;h<d;h++){let f=t[h];if(f.id===null)break;f.id=null,f.object=null,f.geometry=null,f.material=null,f.group=null}}return{opaque:i,transmissive:r,transparent:n,init:s,push:o,unshift:l,finish:u,sort:c}}function P9e(){let t=new WeakMap;function e(r,n){let s=t.get(r),a;return s===void 0?(a=new YZ,t.set(r,[a])):n>=s.length?(a=new YZ,s.push(a)):a=s[n],a}function i(){t=new WeakMap}return{get:e,dispose:i}}function R9e(){let t={};return{get:function(e){if(t[e.id]!==void 0)return t[e.id];let i;switch(e.type){case"DirectionalLight":i={direction:new W,color:new Ai};break;case"SpotLight":i={position:new W,direction:new W,color:new Ai,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":i={position:new W,color:new Ai,distance:0,decay:0};break;case"HemisphereLight":i={direction:new W,skyColor:new Ai,groundColor:new Ai};break;case"RectAreaLight":i={color:new Ai,position:new W,halfWidth:new W,halfHeight:new W};break}return t[e.id]=i,i}}}function I9e(){let t={};return{get:function(e){if(t[e.id]!==void 0)return t[e.id];let i;switch(e.type){case"DirectionalLight":i={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Ae};break;case"SpotLight":i={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Ae};break;case"PointLight":i={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Ae,shadowCameraNear:1,shadowCameraFar:1e3};break}return t[e.id]=i,i}}}var D9e=0;function O9e(t,e){return(e.castShadow?2:0)-(t.castShadow?2:0)+(e.map?1:0)-(t.map?1:0)}function L9e(t,e){let i=new R9e,r=I9e(),n={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0};for(let u=0;u<9;u++)n.probe.push(new W);let s=new W,a=new St,o=new St;function l(u,h){let d=0,f=0,p=0;for(let k=0;k<9;k++)n.probe[k].set(0,0,0);let g=0,m=0,y=0,b=0,w=0,E=0,M=0,A=0,P=0,C=0;u.sort(O9e);let R=h!==!0?Math.PI:1;for(let k=0,z=u.length;k<z;k++){let V=u[k],F=V.color,$=V.intensity,K=V.distance,X=V.shadow&&V.shadow.map?V.shadow.map.texture:null;if(V.isAmbientLight)d+=F.r*$*R,f+=F.g*$*R,p+=F.b*$*R;else if(V.isLightProbe)for(let U=0;U<9;U++)n.probe[U].addScaledVector(V.sh.coefficients[U],$);else if(V.isDirectionalLight){let U=i.get(V);if(U.color.copy(V.color).multiplyScalar(V.intensity*R),V.castShadow){let Y=V.shadow,Z=r.get(V);Z.shadowBias=Y.bias,Z.shadowNormalBias=Y.normalBias,Z.shadowRadius=Y.radius,Z.shadowMapSize=Y.mapSize,n.directionalShadow[g]=Z,n.directionalShadowMap[g]=X,n.directionalShadowMatrix[g]=V.shadow.matrix,E++}n.directional[g]=U,g++}else if(V.isSpotLight){let U=i.get(V);U.position.setFromMatrixPosition(V.matrixWorld),U.color.copy(F).multiplyScalar($*R),U.distance=K,U.coneCos=Math.cos(V.angle),U.penumbraCos=Math.cos(V.angle*(1-V.penumbra)),U.decay=V.decay,n.spot[y]=U;let Y=V.shadow;if(V.map&&(n.spotLightMap[P]=V.map,P++,Y.updateMatrices(V),V.castShadow&&C++),n.spotLightMatrix[y]=Y.matrix,V.castShadow){let Z=r.get(V);Z.shadowBias=Y.bias,Z.shadowNormalBias=Y.normalBias,Z.shadowRadius=Y.radius,Z.shadowMapSize=Y.mapSize,n.spotShadow[y]=Z,n.spotShadowMap[y]=X,A++}y++}else if(V.isRectAreaLight){let U=i.get(V);U.color.copy(F).multiplyScalar($),U.halfWidth.set(V.width*.5,0,0),U.halfHeight.set(0,V.height*.5,0),n.rectArea[b]=U,b++}else if(V.isPointLight){let U=i.get(V);if(U.color.copy(V.color).multiplyScalar(V.intensity*R),U.distance=V.distance,U.decay=V.decay,V.castShadow){let Y=V.shadow,Z=r.get(V);Z.shadowBias=Y.bias,Z.shadowNormalBias=Y.normalBias,Z.shadowRadius=Y.radius,Z.shadowMapSize=Y.mapSize,Z.shadowCameraNear=Y.camera.near,Z.shadowCameraFar=Y.camera.far,n.pointShadow[m]=Z,n.pointShadowMap[m]=X,n.pointShadowMatrix[m]=V.shadow.matrix,M++}n.point[m]=U,m++}else if(V.isHemisphereLight){let U=i.get(V);U.skyColor.copy(V.color).multiplyScalar($*R),U.groundColor.copy(V.groundColor).multiplyScalar($*R),n.hemi[w]=U,w++}}b>0&&(e.isWebGL2||t.has("OES_texture_float_linear")===!0?(n.rectAreaLTC1=Bt.LTC_FLOAT_1,n.rectAreaLTC2=Bt.LTC_FLOAT_2):t.has("OES_texture_half_float_linear")===!0?(n.rectAreaLTC1=Bt.LTC_HALF_1,n.rectAreaLTC2=Bt.LTC_HALF_2):console.error("THREE.WebGLRenderer: Unable to use RectAreaLight. Missing WebGL extensions.")),n.ambient[0]=d,n.ambient[1]=f,n.ambient[2]=p;let I=n.hash;(I.directionalLength!==g||I.pointLength!==m||I.spotLength!==y||I.rectAreaLength!==b||I.hemiLength!==w||I.numDirectionalShadows!==E||I.numPointShadows!==M||I.numSpotShadows!==A||I.numSpotMaps!==P)&&(n.directional.length=g,n.spot.length=y,n.rectArea.length=b,n.point.length=m,n.hemi.length=w,n.directionalShadow.length=E,n.directionalShadowMap.length=E,n.pointShadow.length=M,n.pointShadowMap.length=M,n.spotShadow.length=A,n.spotShadowMap.length=A,n.directionalShadowMatrix.length=E,n.pointShadowMatrix.length=M,n.spotLightMatrix.length=A+P-C,n.spotLightMap.length=P,n.numSpotLightShadowsWithMaps=C,I.directionalLength=g,I.pointLength=m,I.spotLength=y,I.rectAreaLength=b,I.hemiLength=w,I.numDirectionalShadows=E,I.numPointShadows=M,I.numSpotShadows=A,I.numSpotMaps=P,n.version=D9e++)}function c(u,h){let d=0,f=0,p=0,g=0,m=0,y=h.matrixWorldInverse;for(let b=0,w=u.length;b<w;b++){let E=u[b];if(E.isDirectionalLight){let M=n.directional[d];M.direction.setFromMatrixPosition(E.matrixWorld),s.setFromMatrixPosition(E.target.matrixWorld),M.direction.sub(s),M.direction.transformDirection(y),d++}else if(E.isSpotLight){let M=n.spot[p];M.position.setFromMatrixPosition(E.matrixWorld),M.position.applyMatrix4(y),M.direction.setFromMatrixPosition(E.matrixWorld),s.setFromMatrixPosition(E.target.matrixWorld),M.direction.sub(s),M.direction.transformDirection(y),p++}else if(E.isRectAreaLight){let M=n.rectArea[g];M.position.setFromMatrixPosition(E.matrixWorld),M.position.applyMatrix4(y),o.identity(),a.copy(E.matrixWorld),a.premultiply(y),o.extractRotation(a),M.halfWidth.set(E.width*.5,0,0),M.halfHeight.set(0,E.height*.5,0),M.halfWidth.applyMatrix4(o),M.halfHeight.applyMatrix4(o),g++}else if(E.isPointLight){let M=n.point[f];M.position.setFromMatrixPosition(E.matrixWorld),M.position.applyMatrix4(y),f++}else if(E.isHemisphereLight){let M=n.hemi[m];M.direction.setFromMatrixPosition(E.matrixWorld),M.direction.transformDirection(y),m++}}}return{setup:l,setupView:c,state:n}}function KZ(t,e){let i=new L9e(t,e),r=[],n=[];function s(){r.length=0,n.length=0}function a(u){r.push(u)}function o(u){n.push(u)}function l(u){i.setup(r,u)}function c(u){i.setupView(r,u)}return{init:s,state:{lightsArray:r,shadowsArray:n,lights:i},setupLights:l,setupLightsView:c,pushLight:a,pushShadow:o}}function k9e(t,e){let i=new WeakMap;function r(s,a=0){let o=i.get(s),l;return o===void 0?(l=new KZ(t,e),i.set(s,[l])):a>=o.length?(l=new KZ(t,e),o.push(l)):l=o[a],l}function n(){i=new WeakMap}return{get:r,dispose:n}}var bhe=class extends OT{constructor(t){super(),this.isMeshDepthMaterial=!0,this.type="MeshDepthMaterial",this.depthPacking=em,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(t)}copy(t){return super.copy(t),this.depthPacking=t.depthPacking,this.map=t.map,this.alphaMap=t.alphaMap,this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this}},N9e=class extends OT{constructor(t){super(),this.isMeshDistanceMaterial=!0,this.type="MeshDistanceMaterial",this.referencePosition=new W,this.nearDistance=1,this.farDistance=1e3,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(t)}copy(t){return super.copy(t),this.referencePosition.copy(t.referencePosition),this.nearDistance=t.nearDistance,this.farDistance=t.farDistance,this.map=t.map,this.alphaMap=t.alphaMap,this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this}},U9e=`void main() {
	gl_Position = vec4( position, 1.0 );
}`,B9e=`uniform sampler2D shadow_pass;
uniform vec2 resolution;
uniform float radius;
#include <packing>
void main() {
	const float samples = float( VSM_SAMPLES );
	float mean = 0.0;
	float squared_mean = 0.0;
	float uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );
	float uvStart = samples <= 1.0 ? 0.0 : - 1.0;
	for ( float i = 0.0; i < samples; i ++ ) {
		float uvOffset = uvStart + i * uvStride;
		#ifdef HORIZONTAL_PASS
			vec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );
			mean += distribution.x;
			squared_mean += distribution.y * distribution.y + distribution.x * distribution.x;
		#else
			float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );
			mean += depth;
			squared_mean += depth * depth;
		#endif
	}
	mean = mean / samples;
	squared_mean = squared_mean / samples;
	float std_dev = sqrt( squared_mean - mean * mean );
	gl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );
}`;function F9e(t,e,i){let r=new qH,n=new Ae,s=new Ae,a=new Ui,o=new bhe({depthPacking:she}),l=new N9e,c={},u=i.maxTextureSize,h={[Ih]:qa,[qa]:Ih,[jo]:jo},d=new Tr({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new Ae},radius:{value:4}},vertexShader:U9e,fragmentShader:B9e}),f=d.clone();f.defines.HORIZONTAL_PASS=1;let p=new oi;p.setAttribute("position",new Mi(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));let g=new En(p,d),m=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=zH,this.render=function(E,M,A){if(m.enabled===!1||m.autoUpdate===!1&&m.needsUpdate===!1||E.length===0)return;let P=t.getRenderTarget(),C=t.getActiveCubeFace(),R=t.getActiveMipmapLevel(),I=t.state;I.setBlending(Hs),I.buffers.color.setClear(1,1,1,1),I.buffers.depth.setTest(!0),I.setScissorTest(!1);for(let k=0,z=E.length;k<z;k++){let V=E[k],F=V.shadow;if(F===void 0){console.warn("THREE.WebGLShadowMap:",V,"has no shadow.");continue}if(F.autoUpdate===!1&&F.needsUpdate===!1)continue;n.copy(F.mapSize);let $=F.getFrameExtents();if(n.multiply($),s.copy(F.mapSize),(n.x>u||n.y>u)&&(n.x>u&&(s.x=Math.floor(u/$.x),n.x=s.x*$.x,F.mapSize.x=s.x),n.y>u&&(s.y=Math.floor(u/$.y),n.y=s.y*$.y,F.mapSize.y=s.y)),F.map===null){let X=this.type!==GE?{minFilter:mr,magFilter:mr}:{};F.map=new Mr(n.x,n.y,X),F.map.texture.name=V.name+".shadowMap",F.camera.updateProjectionMatrix()}t.setRenderTarget(F.map),t.clear();let K=F.getViewportCount();for(let X=0;X<K;X++){let U=F.getViewport(X);a.set(s.x*U.x,s.y*U.y,s.x*U.z,s.y*U.w),I.viewport(a),F.updateMatrices(V,X),r=F.getFrustum(),w(M,A,F.camera,V,this.type)}F.isPointLightShadow!==!0&&this.type===GE&&y(F,A),F.needsUpdate=!1}m.needsUpdate=!1,t.setRenderTarget(P,C,R)};function y(E,M){let A=e.update(g);d.defines.VSM_SAMPLES!==E.blurSamples&&(d.defines.VSM_SAMPLES=E.blurSamples,f.defines.VSM_SAMPLES=E.blurSamples,d.needsUpdate=!0,f.needsUpdate=!0),E.mapPass===null&&(E.mapPass=new Mr(n.x,n.y)),d.uniforms.shadow_pass.value=E.map.texture,d.uniforms.resolution.value=E.mapSize,d.uniforms.radius.value=E.radius,t.setRenderTarget(E.mapPass),t.clear(),t.renderBufferDirect(M,null,A,d,g,null),f.uniforms.shadow_pass.value=E.mapPass.texture,f.uniforms.resolution.value=E.mapSize,f.uniforms.radius.value=E.radius,t.setRenderTarget(E.map),t.clear(),t.renderBufferDirect(M,null,A,f,g,null)}function b(E,M,A,P,C,R){let I=null,k=A.isPointLight===!0?E.customDistanceMaterial:E.customDepthMaterial;if(k!==void 0)I=k;else if(I=A.isPointLight===!0?l:o,t.localClippingEnabled&&M.clipShadows===!0&&Array.isArray(M.clippingPlanes)&&M.clippingPlanes.length!==0||M.displacementMap&&M.displacementScale!==0||M.alphaMap&&M.alphaTest>0||M.map&&M.alphaTest>0){let z=I.uuid,V=M.uuid,F=c[z];F===void 0&&(F={},c[z]=F);let $=F[V];$===void 0&&($=I.clone(),F[V]=$),I=$}return I.visible=M.visible,I.wireframe=M.wireframe,R===GE?I.side=M.shadowSide!==null?M.shadowSide:M.side:I.side=M.shadowSide!==null?M.shadowSide:h[M.side],I.alphaMap=M.alphaMap,I.alphaTest=M.alphaTest,I.map=M.map,I.clipShadows=M.clipShadows,I.clippingPlanes=M.clippingPlanes,I.clipIntersection=M.clipIntersection,I.displacementMap=M.displacementMap,I.displacementScale=M.displacementScale,I.displacementBias=M.displacementBias,I.wireframeLinewidth=M.wireframeLinewidth,I.linewidth=M.linewidth,A.isPointLight===!0&&I.isMeshDistanceMaterial===!0&&(I.referencePosition.setFromMatrixPosition(A.matrixWorld),I.nearDistance=P,I.farDistance=C),I}function w(E,M,A,P,C){if(E.visible===!1)return;if(E.layers.test(M.layers)&&(E.isMesh||E.isLine||E.isPoints)&&(E.castShadow||E.receiveShadow&&C===GE)&&(!E.frustumCulled||r.intersectsObject(E))){E.modelViewMatrix.multiplyMatrices(A.matrixWorldInverse,E.matrixWorld);let I=e.update(E),k=E.material;if(Array.isArray(k)){let z=I.groups;for(let V=0,F=z.length;V<F;V++){let $=z[V],K=k[$.materialIndex];if(K&&K.visible){let X=b(E,K,P,A.near,A.far,C);t.renderBufferDirect(A,null,I,X,E,$)}}}else if(k.visible){let z=b(E,k,P,A.near,A.far,C);t.renderBufferDirect(A,null,I,z,E,null)}}let R=E.children;for(let I=0,k=R.length;I<k;I++)w(R[I],M,A,P,C)}}function z9e(t,e,i){let r=i.isWebGL2;function n(){let oe=!1,Re=new Ui,ke=null,st=new Ui(0,0,0,0);return{setMask:function(rt){ke!==rt&&!oe&&(t.colorMask(rt,rt,rt,rt),ke=rt)},setLocked:function(rt){oe=rt},setClear:function(rt,je,Tt,Ft,wi){wi===!0&&(rt*=Ft,je*=Ft,Tt*=Ft),Re.set(rt,je,Tt,Ft),st.equals(Re)===!1&&(t.clearColor(rt,je,Tt,Ft),st.copy(Re))},reset:function(){oe=!1,ke=null,st.set(-1,0,0,0)}}}function s(){let oe=!1,Re=null,ke=null,st=null;return{setTest:function(rt){rt?le(2929):he(2929)},setMask:function(rt){Re!==rt&&!oe&&(t.depthMask(rt),Re=rt)},setFunc:function(rt){if(ke!==rt){switch(rt){case o6e:t.depthFunc(512);break;case l6e:t.depthFunc(519);break;case c6e:t.depthFunc(513);break;case xj:t.depthFunc(515);break;case u6e:t.depthFunc(514);break;case h6e:t.depthFunc(518);break;case d6e:t.depthFunc(516);break;case f6e:t.depthFunc(517);break;default:t.depthFunc(515)}ke=rt}},setLocked:function(rt){oe=rt},setClear:function(rt){st!==rt&&(t.clearDepth(rt),st=rt)},reset:function(){oe=!1,Re=null,ke=null,st=null}}}function a(){let oe=!1,Re=null,ke=null,st=null,rt=null,je=null,Tt=null,Ft=null,wi=null;return{setTest:function(ti){oe||(ti?le(2960):he(2960))},setMask:function(ti){Re!==ti&&!oe&&(t.stencilMask(ti),Re=ti)},setFunc:function(ti,Zi,Xi){(ke!==ti||st!==Zi||rt!==Xi)&&(t.stencilFunc(ti,Zi,Xi),ke=ti,st=Zi,rt=Xi)},setOp:function(ti,Zi,Xi){(je!==ti||Tt!==Zi||Ft!==Xi)&&(t.stencilOp(ti,Zi,Xi),je=ti,Tt=Zi,Ft=Xi)},setLocked:function(ti){oe=ti},setClear:function(ti){wi!==ti&&(t.clearStencil(ti),wi=ti)},reset:function(){oe=!1,Re=null,ke=null,st=null,rt=null,je=null,Tt=null,Ft=null,wi=null}}}let o=new n,l=new s,c=new a,u=new WeakMap,h=new WeakMap,d={},f={},p=new WeakMap,g=[],m=null,y=!1,b=null,w=null,E=null,M=null,A=null,P=null,C=null,R=!1,I=null,k=null,z=null,V=null,F=null,$=t.getParameter(35661),K=!1,X=0,U=t.getParameter(7938);U.indexOf("WebGL")!==-1?(X=parseFloat(/^WebGL (\d)/.exec(U)[1]),K=X>=1):U.indexOf("OpenGL ES")!==-1&&(X=parseFloat(/^OpenGL ES (\d)/.exec(U)[1]),K=X>=2);let Y=null,Z={},j=t.getParameter(3088),ee=t.getParameter(2978),pe=new Ui().fromArray(j),fe=new Ui().fromArray(ee);function se(oe,Re,ke){let st=new Uint8Array(4),rt=t.createTexture();t.bindTexture(oe,rt),t.texParameteri(oe,10241,9728),t.texParameteri(oe,10240,9728);for(let je=0;je<ke;je++)t.texImage2D(Re+je,0,6408,1,1,0,6408,5121,st);return rt}let re={};re[3553]=se(3553,3553,1),re[34067]=se(34067,34069,6),o.setClear(0,0,0,1),l.setClear(1),c.setClear(0),le(2929),l.setFunc(xj),He(!1),Be(VK),le(2884),Fe(Hs);function le(oe){d[oe]!==!0&&(t.enable(oe),d[oe]=!0)}function he(oe){d[oe]!==!1&&(t.disable(oe),d[oe]=!1)}function ve(oe,Re){return f[oe]!==Re?(t.bindFramebuffer(oe,Re),f[oe]=Re,r&&(oe===36009&&(f[36160]=Re),oe===36160&&(f[36009]=Re)),!0):!1}function xe(oe,Re){let ke=g,st=!1;if(oe)if(ke=p.get(Re),ke===void 0&&(ke=[],p.set(Re,ke)),oe.isWebGLMultipleRenderTargets){let rt=oe.texture;if(ke.length!==rt.length||ke[0]!==36064){for(let je=0,Tt=rt.length;je<Tt;je++)ke[je]=36064+je;ke.length=rt.length,st=!0}}else ke[0]!==36064&&(ke[0]=36064,st=!0);else ke[0]!==1029&&(ke[0]=1029,st=!0);st&&(i.isWebGL2?t.drawBuffers(ke):e.get("WEBGL_draw_buffers").drawBuffersWEBGL(ke))}function Se(oe){return m!==oe?(t.useProgram(oe),m=oe,!0):!1}let Ce={[Aw]:32774,[KVe]:32778,[ZVe]:32779};if(r)Ce[qK]=32775,Ce[XK]=32776;else{let oe=e.get("EXT_blend_minmax");oe!==null&&(Ce[qK]=oe.MIN_EXT,Ce[XK]=oe.MAX_EXT)}let ce={[QVe]:0,[JVe]:1,[e6e]:768,[Zue]:770,[a6e]:776,[n6e]:774,[i6e]:772,[t6e]:769,[Que]:771,[s6e]:775,[r6e]:773};function Fe(oe,Re,ke,st,rt,je,Tt,Ft){if(oe===Hs){y===!0&&(he(3042),y=!1);return}if(y===!1&&(le(3042),y=!0),oe!==YVe){if(oe!==b||Ft!==R){if((w!==Aw||A!==Aw)&&(t.blendEquation(32774),w=Aw,A=Aw),Ft)switch(oe){case g0:t.blendFuncSeparate(1,771,1,771);break;case HK:t.blendFunc(1,1);break;case GK:t.blendFuncSeparate(0,769,0,1);break;case WK:t.blendFuncSeparate(0,768,0,770);break;default:console.error("THREE.WebGLState: Invalid blending: ",oe);break}else switch(oe){case g0:t.blendFuncSeparate(770,771,1,771);break;case HK:t.blendFunc(770,1);break;case GK:t.blendFuncSeparate(0,769,0,1);break;case WK:t.blendFunc(0,768);break;default:console.error("THREE.WebGLState: Invalid blending: ",oe);break}E=null,M=null,P=null,C=null,b=oe,R=Ft}return}rt=rt||Re,je=je||ke,Tt=Tt||st,(Re!==w||rt!==A)&&(t.blendEquationSeparate(Ce[Re],Ce[rt]),w=Re,A=rt),(ke!==E||st!==M||je!==P||Tt!==C)&&(t.blendFuncSeparate(ce[ke],ce[st],ce[je],ce[Tt]),E=ke,M=st,P=je,C=Tt),b=oe,R=!1}function De(oe,Re){oe.side===jo?he(2884):le(2884);let ke=oe.side===qa;Re&&(ke=!ke),He(ke),oe.blending===g0&&oe.transparent===!1?Fe(Hs):Fe(oe.blending,oe.blendEquation,oe.blendSrc,oe.blendDst,oe.blendEquationAlpha,oe.blendSrcAlpha,oe.blendDstAlpha,oe.premultipliedAlpha),l.setFunc(oe.depthFunc),l.setTest(oe.depthTest),l.setMask(oe.depthWrite),o.setMask(oe.colorWrite);let st=oe.stencilWrite;c.setTest(st),st&&(c.setMask(oe.stencilWriteMask),c.setFunc(oe.stencilFunc,oe.stencilRef,oe.stencilFuncMask),c.setOp(oe.stencilFail,oe.stencilZFail,oe.stencilZPass)),ze(oe.polygonOffset,oe.polygonOffsetFactor,oe.polygonOffsetUnits),oe.alphaToCoverage===!0?le(32926):he(32926)}function He(oe){I!==oe&&(oe?t.frontFace(2304):t.frontFace(2305),I=oe)}function Be(oe){oe!==qVe?(le(2884),oe!==k&&(oe===VK?t.cullFace(1029):oe===XVe?t.cullFace(1028):t.cullFace(1032))):he(2884),k=oe}function $e(oe){oe!==z&&(K&&t.lineWidth(oe),z=oe)}function ze(oe,Re,ke){oe?(le(32823),(V!==Re||F!==ke)&&(t.polygonOffset(Re,ke),V=Re,F=ke)):he(32823)}function it(oe){oe?le(3089):he(3089)}function wt(oe){oe===void 0&&(oe=33984+$-1),Y!==oe&&(t.activeTexture(oe),Y=oe)}function ge(oe,Re,ke){ke===void 0&&(Y===null?ke=33984+$-1:ke=Y);let st=Z[ke];st===void 0&&(st={type:void 0,texture:void 0},Z[ke]=st),(st.type!==oe||st.texture!==Re)&&(Y!==ke&&(t.activeTexture(ke),Y=ke),t.bindTexture(oe,Re||re[oe]),st.type=oe,st.texture=Re)}function G(){let oe=Z[Y];oe!==void 0&&oe.type!==void 0&&(t.bindTexture(oe.type,null),oe.type=void 0,oe.texture=void 0)}function Q(){try{t.compressedTexImage2D.apply(t,arguments)}catch(oe){console.error("THREE.WebGLState:",oe)}}function we(){try{t.compressedTexImage3D.apply(t,arguments)}catch(oe){console.error("THREE.WebGLState:",oe)}}function te(){try{t.texSubImage2D.apply(t,arguments)}catch(oe){console.error("THREE.WebGLState:",oe)}}function Ne(){try{t.texSubImage3D.apply(t,arguments)}catch(oe){console.error("THREE.WebGLState:",oe)}}function Le(){try{t.compressedTexSubImage2D.apply(t,arguments)}catch(oe){console.error("THREE.WebGLState:",oe)}}function at(){try{t.compressedTexSubImage3D.apply(t,arguments)}catch(oe){console.error("THREE.WebGLState:",oe)}}function Te(){try{t.texStorage2D.apply(t,arguments)}catch(oe){console.error("THREE.WebGLState:",oe)}}function dt(){try{t.texStorage3D.apply(t,arguments)}catch(oe){console.error("THREE.WebGLState:",oe)}}function ot(){try{t.texImage2D.apply(t,arguments)}catch(oe){console.error("THREE.WebGLState:",oe)}}function Qe(){try{t.texImage3D.apply(t,arguments)}catch(oe){console.error("THREE.WebGLState:",oe)}}function pt(oe){pe.equals(oe)===!1&&(t.scissor(oe.x,oe.y,oe.z,oe.w),pe.copy(oe))}function _t(oe){fe.equals(oe)===!1&&(t.viewport(oe.x,oe.y,oe.z,oe.w),fe.copy(oe))}function yt(oe,Re){let ke=h.get(Re);ke===void 0&&(ke=new WeakMap,h.set(Re,ke));let st=ke.get(oe);st===void 0&&(st=t.getUniformBlockIndex(Re,oe.name),ke.set(oe,st))}function Et(oe,Re){let ke=h.get(Re).get(oe);u.get(Re)!==ke&&(t.uniformBlockBinding(Re,ke,oe.__bindingPointIndex),u.set(Re,ke))}function $t(){t.disable(3042),t.disable(2884),t.disable(2929),t.disable(32823),t.disable(3089),t.disable(2960),t.disable(32926),t.blendEquation(32774),t.blendFunc(1,0),t.blendFuncSeparate(1,0,1,0),t.colorMask(!0,!0,!0,!0),t.clearColor(0,0,0,0),t.depthMask(!0),t.depthFunc(513),t.clearDepth(1),t.stencilMask(4294967295),t.stencilFunc(519,0,4294967295),t.stencilOp(7680,7680,7680),t.clearStencil(0),t.cullFace(1029),t.frontFace(2305),t.polygonOffset(0,0),t.activeTexture(33984),t.bindFramebuffer(36160,null),r===!0&&(t.bindFramebuffer(36009,null),t.bindFramebuffer(36008,null)),t.useProgram(null),t.lineWidth(1),t.scissor(0,0,t.canvas.width,t.canvas.height),t.viewport(0,0,t.canvas.width,t.canvas.height),d={},Y=null,Z={},f={},p=new WeakMap,g=[],m=null,y=!1,b=null,w=null,E=null,M=null,A=null,P=null,C=null,R=!1,I=null,k=null,z=null,V=null,F=null,pe.set(0,0,t.canvas.width,t.canvas.height),fe.set(0,0,t.canvas.width,t.canvas.height),o.reset(),l.reset(),c.reset()}return{buffers:{color:o,depth:l,stencil:c},enable:le,disable:he,bindFramebuffer:ve,drawBuffers:xe,useProgram:Se,setBlending:Fe,setMaterial:De,setFlipSided:He,setCullFace:Be,setLineWidth:$e,setPolygonOffset:ze,setScissorTest:it,activeTexture:wt,bindTexture:ge,unbindTexture:G,compressedTexImage2D:Q,compressedTexImage3D:we,texImage2D:ot,texImage3D:Qe,updateUBOMapping:yt,uniformBlockBinding:Et,texStorage2D:Te,texStorage3D:dt,texSubImage2D:te,texSubImage3D:Ne,compressedTexSubImage2D:Le,compressedTexSubImage3D:at,scissor:pt,viewport:_t,reset:$t}}function j9e(t,e,i,r,n,s,a){let o=n.isWebGL2,l=n.maxTextures,c=n.maxCubemapSize,u=n.maxTextureSize,h=n.maxSamples,d=e.has("WEBGL_multisampled_render_to_texture")?e.get("WEBGL_multisampled_render_to_texture"):null,f=typeof navigator>"u"?!1:/OculusBrowser/g.test(navigator.userAgent),p=new WeakMap,g,m=new WeakMap,y=!1;try{y=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")!==null}catch{}function b(ge,G){return y?new OffscreenCanvas(ge,G):CM("canvas")}function w(ge,G,Q,we){let te=1;if((ge.width>we||ge.height>we)&&(te=we/Math.max(ge.width,ge.height)),te<1||G===!0)if(typeof HTMLImageElement<"u"&&ge instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&ge instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&ge instanceof ImageBitmap){let Ne=G?HD:Math.floor,Le=Ne(te*ge.width),at=Ne(te*ge.height);g===void 0&&(g=b(Le,at));let Te=Q?b(Le,at):g;return Te.width=Le,Te.height=at,Te.getContext("2d").drawImage(ge,0,0,Le,at),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+ge.width+"x"+ge.height+") to ("+Le+"x"+at+")."),Te}else return"data"in ge&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+ge.width+"x"+ge.height+")."),ge;return ge}function E(ge){return Mj(ge.width)&&Mj(ge.height)}function M(ge){return o?!1:ge.wrapS!==kn||ge.wrapT!==kn||ge.minFilter!==mr&&ge.minFilter!==nr}function A(ge,G){return ge.generateMipmaps&&G&&ge.minFilter!==mr&&ge.minFilter!==nr}function P(ge){t.generateMipmap(ge)}function C(ge,G,Q,we,te=!1){if(o===!1)return G;if(ge!==null){if(t[ge]!==void 0)return t[ge];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+ge+"'")}let Ne=G;return G===6403&&(Q===5126&&(Ne=33326),Q===5131&&(Ne=33325),Q===5121&&(Ne=33321)),G===33319&&(Q===5126&&(Ne=33328),Q===5131&&(Ne=33327),Q===5121&&(Ne=33323)),G===6408&&(Q===5126&&(Ne=34836),Q===5131&&(Ne=34842),Q===5121&&(Ne=we===er&&te===!1?35907:32856),Q===32819&&(Ne=32854),Q===32820&&(Ne=32855)),(Ne===33325||Ne===33326||Ne===33327||Ne===33328||Ne===34842||Ne===34836)&&e.get("EXT_color_buffer_float"),Ne}function R(ge,G,Q){return A(ge,Q)===!0||ge.isFramebufferTexture&&ge.minFilter!==mr&&ge.minFilter!==nr?Math.log2(Math.max(G.width,G.height))+1:ge.mipmaps!==void 0&&ge.mipmaps.length>0?ge.mipmaps.length:ge.isCompressedTexture&&Array.isArray(ge.image)?G.mipmaps.length:1}function I(ge){return ge===mr||ge===$K||ge===CB?9728:9729}function k(ge){let G=ge.target;G.removeEventListener("dispose",k),V(G),G.isVideoTexture&&p.delete(G)}function z(ge){let G=ge.target;G.removeEventListener("dispose",z),$(G)}function V(ge){let G=r.get(ge);if(G.__webglInit===void 0)return;let Q=ge.source,we=m.get(Q);if(we){let te=we[G.__cacheKey];te.usedTimes--,te.usedTimes===0&&F(ge),Object.keys(we).length===0&&m.delete(Q)}r.remove(ge)}function F(ge){let G=r.get(ge);t.deleteTexture(G.__webglTexture);let Q=ge.source,we=m.get(Q);delete we[G.__cacheKey],a.memory.textures--}function $(ge){let G=ge.texture,Q=r.get(ge),we=r.get(G);if(we.__webglTexture!==void 0&&(t.deleteTexture(we.__webglTexture),a.memory.textures--),ge.depthTexture&&ge.depthTexture.dispose(),ge.isWebGLCubeRenderTarget)for(let te=0;te<6;te++)t.deleteFramebuffer(Q.__webglFramebuffer[te]),Q.__webglDepthbuffer&&t.deleteRenderbuffer(Q.__webglDepthbuffer[te]);else{if(t.deleteFramebuffer(Q.__webglFramebuffer),Q.__webglDepthbuffer&&t.deleteRenderbuffer(Q.__webglDepthbuffer),Q.__webglMultisampledFramebuffer&&t.deleteFramebuffer(Q.__webglMultisampledFramebuffer),Q.__webglColorRenderbuffer)for(let te=0;te<Q.__webglColorRenderbuffer.length;te++)Q.__webglColorRenderbuffer[te]&&t.deleteRenderbuffer(Q.__webglColorRenderbuffer[te]);Q.__webglDepthRenderbuffer&&t.deleteRenderbuffer(Q.__webglDepthRenderbuffer)}if(ge.isWebGLMultipleRenderTargets)for(let te=0,Ne=G.length;te<Ne;te++){let Le=r.get(G[te]);Le.__webglTexture&&(t.deleteTexture(Le.__webglTexture),a.memory.textures--),r.remove(G[te])}r.remove(G),r.remove(ge)}let K=0;function X(){K=0}function U(){let ge=K;return ge>=l&&console.warn("THREE.WebGLTextures: Trying to use "+ge+" texture units while this GPU supports only "+l),K+=1,ge}function Y(ge){let G=[];return G.push(ge.wrapS),G.push(ge.wrapT),G.push(ge.wrapR||0),G.push(ge.magFilter),G.push(ge.minFilter),G.push(ge.anisotropy),G.push(ge.internalFormat),G.push(ge.format),G.push(ge.type),G.push(ge.generateMipmaps),G.push(ge.premultiplyAlpha),G.push(ge.flipY),G.push(ge.unpackAlignment),G.push(ge.encoding),G.join()}function Z(ge,G){let Q=r.get(ge);if(ge.isVideoTexture&&it(ge),ge.isRenderTargetTexture===!1&&ge.version>0&&Q.__version!==ge.version){let we=ge.image;if(we===null)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else if(we.complete===!1)console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete");else{he(Q,ge,G);return}}i.bindTexture(3553,Q.__webglTexture,33984+G)}function j(ge,G){let Q=r.get(ge);if(ge.version>0&&Q.__version!==ge.version){he(Q,ge,G);return}i.bindTexture(35866,Q.__webglTexture,33984+G)}function ee(ge,G){let Q=r.get(ge);if(ge.version>0&&Q.__version!==ge.version){he(Q,ge,G);return}i.bindTexture(32879,Q.__webglTexture,33984+G)}function pe(ge,G){let Q=r.get(ge);if(ge.version>0&&Q.__version!==ge.version){ve(Q,ge,G);return}i.bindTexture(34067,Q.__webglTexture,33984+G)}let fe={[Ep]:10497,[kn]:33071,[_j]:33648},se={[mr]:9728,[$K]:9984,[CB]:9986,[nr]:9729,[w6e]:9985,[j1]:9987};function re(ge,G,Q){if(Q?(t.texParameteri(ge,10242,fe[G.wrapS]),t.texParameteri(ge,10243,fe[G.wrapT]),(ge===32879||ge===35866)&&t.texParameteri(ge,32882,fe[G.wrapR]),t.texParameteri(ge,10240,se[G.magFilter]),t.texParameteri(ge,10241,se[G.minFilter])):(t.texParameteri(ge,10242,33071),t.texParameteri(ge,10243,33071),(ge===32879||ge===35866)&&t.texParameteri(ge,32882,33071),(G.wrapS!==kn||G.wrapT!==kn)&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),t.texParameteri(ge,10240,I(G.magFilter)),t.texParameteri(ge,10241,I(G.minFilter)),G.minFilter!==mr&&G.minFilter!==nr&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.")),e.has("EXT_texture_filter_anisotropic")===!0){let we=e.get("EXT_texture_filter_anisotropic");if(G.magFilter===mr||G.minFilter!==CB&&G.minFilter!==j1||G.type===cn&&e.has("OES_texture_float_linear")===!1||o===!1&&G.type===qp&&e.has("OES_texture_half_float_linear")===!1)return;(G.anisotropy>1||r.get(G).__currentAnisotropy)&&(t.texParameterf(ge,we.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(G.anisotropy,n.getMaxAnisotropy())),r.get(G).__currentAnisotropy=G.anisotropy)}}function le(ge,G){let Q=!1;ge.__webglInit===void 0&&(ge.__webglInit=!0,G.addEventListener("dispose",k));let we=G.source,te=m.get(we);te===void 0&&(te={},m.set(we,te));let Ne=Y(G);if(Ne!==ge.__cacheKey){te[Ne]===void 0&&(te[Ne]={texture:t.createTexture(),usedTimes:0},a.memory.textures++,Q=!0),te[Ne].usedTimes++;let Le=te[ge.__cacheKey];Le!==void 0&&(te[ge.__cacheKey].usedTimes--,Le.usedTimes===0&&F(G)),ge.__cacheKey=Ne,ge.__webglTexture=te[Ne].texture}return Q}function he(ge,G,Q){let we=3553;(G.isDataArrayTexture||G.isCompressedArrayTexture)&&(we=35866),G.isData3DTexture&&(we=32879);let te=le(ge,G),Ne=G.source;i.bindTexture(we,ge.__webglTexture,33984+Q);let Le=r.get(Ne);if(Ne.version!==Le.__version||te===!0){i.activeTexture(33984+Q),t.pixelStorei(37440,G.flipY),t.pixelStorei(37441,G.premultiplyAlpha),t.pixelStorei(3317,G.unpackAlignment),t.pixelStorei(37443,0);let at=M(G)&&E(G.image)===!1,Te=w(G.image,at,!1,u);Te=wt(G,Te);let dt=E(Te)||o,ot=s.convert(G.format,G.encoding),Qe=s.convert(G.type),pt=C(G.internalFormat,ot,Qe,G.encoding,G.isVideoTexture);re(we,G,dt);let _t,yt=G.mipmaps,Et=o&&G.isVideoTexture!==!0,$t=Le.__version===void 0||te===!0,oe=R(G,Te,dt);if(G.isDepthTexture)pt=6402,o?G.type===cn?pt=36012:G.type===Ap?pt=33190:G.type===v0?pt=35056:pt=33189:G.type===cn&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),G.format===y0&&pt===6402&&G.type!==the&&G.type!==Ap&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),G.type=Ap,Qe=s.convert(G.type)),G.format===N0&&pt===6402&&(pt=34041,G.type!==v0&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),G.type=v0,Qe=s.convert(G.type))),$t&&(Et?i.texStorage2D(3553,1,pt,Te.width,Te.height):i.texImage2D(3553,0,pt,Te.width,Te.height,0,ot,Qe,null));else if(G.isDataTexture)if(yt.length>0&&dt){Et&&$t&&i.texStorage2D(3553,oe,pt,yt[0].width,yt[0].height);for(let Re=0,ke=yt.length;Re<ke;Re++)_t=yt[Re],Et?i.texSubImage2D(3553,Re,0,0,_t.width,_t.height,ot,Qe,_t.data):i.texImage2D(3553,Re,pt,_t.width,_t.height,0,ot,Qe,_t.data);G.generateMipmaps=!1}else Et?($t&&i.texStorage2D(3553,oe,pt,Te.width,Te.height),i.texSubImage2D(3553,0,0,0,Te.width,Te.height,ot,Qe,Te.data)):i.texImage2D(3553,0,pt,Te.width,Te.height,0,ot,Qe,Te.data);else if(G.isCompressedTexture)if(G.isCompressedArrayTexture){Et&&$t&&i.texStorage3D(35866,oe,pt,yt[0].width,yt[0].height,Te.depth);for(let Re=0,ke=yt.length;Re<ke;Re++)_t=yt[Re],G.format!==Vn?ot!==null?Et?i.compressedTexSubImage3D(35866,Re,0,0,0,_t.width,_t.height,Te.depth,ot,_t.data,0,0):i.compressedTexImage3D(35866,Re,pt,_t.width,_t.height,Te.depth,0,_t.data,0,0):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):Et?i.texSubImage3D(35866,Re,0,0,0,_t.width,_t.height,Te.depth,ot,Qe,_t.data):i.texImage3D(35866,Re,pt,_t.width,_t.height,Te.depth,0,ot,Qe,_t.data)}else{Et&&$t&&i.texStorage2D(3553,oe,pt,yt[0].width,yt[0].height);for(let Re=0,ke=yt.length;Re<ke;Re++)_t=yt[Re],G.format!==Vn?ot!==null?Et?i.compressedTexSubImage2D(3553,Re,0,0,_t.width,_t.height,ot,_t.data):i.compressedTexImage2D(3553,Re,pt,_t.width,_t.height,0,_t.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):Et?i.texSubImage2D(3553,Re,0,0,_t.width,_t.height,ot,Qe,_t.data):i.texImage2D(3553,Re,pt,_t.width,_t.height,0,ot,Qe,_t.data)}else if(G.isDataArrayTexture)Et?($t&&i.texStorage3D(35866,oe,pt,Te.width,Te.height,Te.depth),i.texSubImage3D(35866,0,0,0,0,Te.width,Te.height,Te.depth,ot,Qe,Te.data)):i.texImage3D(35866,0,pt,Te.width,Te.height,Te.depth,0,ot,Qe,Te.data);else if(G.isData3DTexture)Et?($t&&i.texStorage3D(32879,oe,pt,Te.width,Te.height,Te.depth),i.texSubImage3D(32879,0,0,0,0,Te.width,Te.height,Te.depth,ot,Qe,Te.data)):i.texImage3D(32879,0,pt,Te.width,Te.height,Te.depth,0,ot,Qe,Te.data);else if(G.isFramebufferTexture){if($t)if(Et)i.texStorage2D(3553,oe,pt,Te.width,Te.height);else{let Re=Te.width,ke=Te.height;for(let st=0;st<oe;st++)i.texImage2D(3553,st,pt,Re,ke,0,ot,Qe,null),Re>>=1,ke>>=1}}else if(yt.length>0&&dt){Et&&$t&&i.texStorage2D(3553,oe,pt,yt[0].width,yt[0].height);for(let Re=0,ke=yt.length;Re<ke;Re++)_t=yt[Re],Et?i.texSubImage2D(3553,Re,0,0,ot,Qe,_t):i.texImage2D(3553,Re,pt,ot,Qe,_t);G.generateMipmaps=!1}else Et?($t&&i.texStorage2D(3553,oe,pt,Te.width,Te.height),i.texSubImage2D(3553,0,0,0,ot,Qe,Te)):i.texImage2D(3553,0,pt,ot,Qe,Te);A(G,dt)&&P(we),Le.__version=Ne.version,G.onUpdate&&G.onUpdate(G)}ge.__version=G.version}function ve(ge,G,Q){if(G.image.length!==6)return;let we=le(ge,G),te=G.source;i.bindTexture(34067,ge.__webglTexture,33984+Q);let Ne=r.get(te);if(te.version!==Ne.__version||we===!0){i.activeTexture(33984+Q),t.pixelStorei(37440,G.flipY),t.pixelStorei(37441,G.premultiplyAlpha),t.pixelStorei(3317,G.unpackAlignment),t.pixelStorei(37443,0);let Le=G.isCompressedTexture||G.image[0].isCompressedTexture,at=G.image[0]&&G.image[0].isDataTexture,Te=[];for(let Re=0;Re<6;Re++)!Le&&!at?Te[Re]=w(G.image[Re],!1,!0,c):Te[Re]=at?G.image[Re].image:G.image[Re],Te[Re]=wt(G,Te[Re]);let dt=Te[0],ot=E(dt)||o,Qe=s.convert(G.format,G.encoding),pt=s.convert(G.type),_t=C(G.internalFormat,Qe,pt,G.encoding),yt=o&&G.isVideoTexture!==!0,Et=Ne.__version===void 0||we===!0,$t=R(G,dt,ot);re(34067,G,ot);let oe;if(Le){yt&&Et&&i.texStorage2D(34067,$t,_t,dt.width,dt.height);for(let Re=0;Re<6;Re++){oe=Te[Re].mipmaps;for(let ke=0;ke<oe.length;ke++){let st=oe[ke];G.format!==Vn?Qe!==null?yt?i.compressedTexSubImage2D(34069+Re,ke,0,0,st.width,st.height,Qe,st.data):i.compressedTexImage2D(34069+Re,ke,_t,st.width,st.height,0,st.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):yt?i.texSubImage2D(34069+Re,ke,0,0,st.width,st.height,Qe,pt,st.data):i.texImage2D(34069+Re,ke,_t,st.width,st.height,0,Qe,pt,st.data)}}}else{oe=G.mipmaps,yt&&Et&&(oe.length>0&&$t++,i.texStorage2D(34067,$t,_t,Te[0].width,Te[0].height));for(let Re=0;Re<6;Re++)if(at){yt?i.texSubImage2D(34069+Re,0,0,0,Te[Re].width,Te[Re].height,Qe,pt,Te[Re].data):i.texImage2D(34069+Re,0,_t,Te[Re].width,Te[Re].height,0,Qe,pt,Te[Re].data);for(let ke=0;ke<oe.length;ke++){let st=oe[ke].image[Re].image;yt?i.texSubImage2D(34069+Re,ke+1,0,0,st.width,st.height,Qe,pt,st.data):i.texImage2D(34069+Re,ke+1,_t,st.width,st.height,0,Qe,pt,st.data)}}else{yt?i.texSubImage2D(34069+Re,0,0,0,Qe,pt,Te[Re]):i.texImage2D(34069+Re,0,_t,Qe,pt,Te[Re]);for(let ke=0;ke<oe.length;ke++){let st=oe[ke];yt?i.texSubImage2D(34069+Re,ke+1,0,0,Qe,pt,st.image[Re]):i.texImage2D(34069+Re,ke+1,_t,Qe,pt,st.image[Re])}}}A(G,ot)&&P(34067),Ne.__version=te.version,G.onUpdate&&G.onUpdate(G)}ge.__version=G.version}function xe(ge,G,Q,we,te){let Ne=s.convert(Q.format,Q.encoding),Le=s.convert(Q.type),at=C(Q.internalFormat,Ne,Le,Q.encoding);r.get(G).__hasExternalTextures||(te===32879||te===35866?i.texImage3D(te,0,at,G.width,G.height,G.depth,0,Ne,Le,null):i.texImage2D(te,0,at,G.width,G.height,0,Ne,Le,null)),i.bindFramebuffer(36160,ge),ze(G)?d.framebufferTexture2DMultisampleEXT(36160,we,te,r.get(Q).__webglTexture,0,$e(G)):(te===3553||te>=34069&&te<=34074)&&t.framebufferTexture2D(36160,we,te,r.get(Q).__webglTexture,0),i.bindFramebuffer(36160,null)}function Se(ge,G,Q){if(t.bindRenderbuffer(36161,ge),G.depthBuffer&&!G.stencilBuffer){let we=33189;if(Q||ze(G)){let te=G.depthTexture;te&&te.isDepthTexture&&(te.type===cn?we=36012:te.type===Ap&&(we=33190));let Ne=$e(G);ze(G)?d.renderbufferStorageMultisampleEXT(36161,Ne,we,G.width,G.height):t.renderbufferStorageMultisample(36161,Ne,we,G.width,G.height)}else t.renderbufferStorage(36161,we,G.width,G.height);t.framebufferRenderbuffer(36160,36096,36161,ge)}else if(G.depthBuffer&&G.stencilBuffer){let we=$e(G);Q&&ze(G)===!1?t.renderbufferStorageMultisample(36161,we,35056,G.width,G.height):ze(G)?d.renderbufferStorageMultisampleEXT(36161,we,35056,G.width,G.height):t.renderbufferStorage(36161,34041,G.width,G.height),t.framebufferRenderbuffer(36160,33306,36161,ge)}else{let we=G.isWebGLMultipleRenderTargets===!0?G.texture:[G.texture];for(let te=0;te<we.length;te++){let Ne=we[te],Le=s.convert(Ne.format,Ne.encoding),at=s.convert(Ne.type),Te=C(Ne.internalFormat,Le,at,Ne.encoding),dt=$e(G);Q&&ze(G)===!1?t.renderbufferStorageMultisample(36161,dt,Te,G.width,G.height):ze(G)?d.renderbufferStorageMultisampleEXT(36161,dt,Te,G.width,G.height):t.renderbufferStorage(36161,Te,G.width,G.height)}}t.bindRenderbuffer(36161,null)}function Ce(ge,G){if(G&&G.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(i.bindFramebuffer(36160,ge),!(G.depthTexture&&G.depthTexture.isDepthTexture))throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");(!r.get(G.depthTexture).__webglTexture||G.depthTexture.image.width!==G.width||G.depthTexture.image.height!==G.height)&&(G.depthTexture.image.width=G.width,G.depthTexture.image.height=G.height,G.depthTexture.needsUpdate=!0),Z(G.depthTexture,0);let Q=r.get(G.depthTexture).__webglTexture,we=$e(G);if(G.depthTexture.format===y0)ze(G)?d.framebufferTexture2DMultisampleEXT(36160,36096,3553,Q,0,we):t.framebufferTexture2D(36160,36096,3553,Q,0);else if(G.depthTexture.format===N0)ze(G)?d.framebufferTexture2DMultisampleEXT(36160,33306,3553,Q,0,we):t.framebufferTexture2D(36160,33306,3553,Q,0);else throw new Error("Unknown depthTexture format")}function ce(ge){let G=r.get(ge),Q=ge.isWebGLCubeRenderTarget===!0;if(ge.depthTexture&&!G.__autoAllocateDepthBuffer){if(Q)throw new Error("target.depthTexture not supported in Cube render targets");Ce(G.__webglFramebuffer,ge)}else if(Q){G.__webglDepthbuffer=[];for(let we=0;we<6;we++)i.bindFramebuffer(36160,G.__webglFramebuffer[we]),G.__webglDepthbuffer[we]=t.createRenderbuffer(),Se(G.__webglDepthbuffer[we],ge,!1)}else i.bindFramebuffer(36160,G.__webglFramebuffer),G.__webglDepthbuffer=t.createRenderbuffer(),Se(G.__webglDepthbuffer,ge,!1);i.bindFramebuffer(36160,null)}function Fe(ge,G,Q){let we=r.get(ge);G!==void 0&&xe(we.__webglFramebuffer,ge,ge.texture,36064,3553),Q!==void 0&&ce(ge)}function De(ge){let G=ge.texture,Q=r.get(ge),we=r.get(G);ge.addEventListener("dispose",z),ge.isWebGLMultipleRenderTargets!==!0&&(we.__webglTexture===void 0&&(we.__webglTexture=t.createTexture()),we.__version=G.version,a.memory.textures++);let te=ge.isWebGLCubeRenderTarget===!0,Ne=ge.isWebGLMultipleRenderTargets===!0,Le=E(ge)||o;if(te){Q.__webglFramebuffer=[];for(let at=0;at<6;at++)Q.__webglFramebuffer[at]=t.createFramebuffer()}else{if(Q.__webglFramebuffer=t.createFramebuffer(),Ne)if(n.drawBuffers){let at=ge.texture;for(let Te=0,dt=at.length;Te<dt;Te++){let ot=r.get(at[Te]);ot.__webglTexture===void 0&&(ot.__webglTexture=t.createTexture(),a.memory.textures++)}}else console.warn("THREE.WebGLRenderer: WebGLMultipleRenderTargets can only be used with WebGL2 or WEBGL_draw_buffers extension.");if(o&&ge.samples>0&&ze(ge)===!1){let at=Ne?G:[G];Q.__webglMultisampledFramebuffer=t.createFramebuffer(),Q.__webglColorRenderbuffer=[],i.bindFramebuffer(36160,Q.__webglMultisampledFramebuffer);for(let Te=0;Te<at.length;Te++){let dt=at[Te];Q.__webglColorRenderbuffer[Te]=t.createRenderbuffer(),t.bindRenderbuffer(36161,Q.__webglColorRenderbuffer[Te]);let ot=s.convert(dt.format,dt.encoding),Qe=s.convert(dt.type),pt=C(dt.internalFormat,ot,Qe,dt.encoding,ge.isXRRenderTarget===!0),_t=$e(ge);t.renderbufferStorageMultisample(36161,_t,pt,ge.width,ge.height),t.framebufferRenderbuffer(36160,36064+Te,36161,Q.__webglColorRenderbuffer[Te])}t.bindRenderbuffer(36161,null),ge.depthBuffer&&(Q.__webglDepthRenderbuffer=t.createRenderbuffer(),Se(Q.__webglDepthRenderbuffer,ge,!0)),i.bindFramebuffer(36160,null)}}if(te){i.bindTexture(34067,we.__webglTexture),re(34067,G,Le);for(let at=0;at<6;at++)xe(Q.__webglFramebuffer[at],ge,G,36064,34069+at);A(G,Le)&&P(34067),i.unbindTexture()}else if(Ne){let at=ge.texture;for(let Te=0,dt=at.length;Te<dt;Te++){let ot=at[Te],Qe=r.get(ot);i.bindTexture(3553,Qe.__webglTexture),re(3553,ot,Le),xe(Q.__webglFramebuffer,ge,ot,36064+Te,3553),A(ot,Le)&&P(3553)}i.unbindTexture()}else{let at=3553;(ge.isWebGL3DRenderTarget||ge.isWebGLArrayRenderTarget)&&(o?at=ge.isWebGL3DRenderTarget?32879:35866:console.error("THREE.WebGLTextures: THREE.Data3DTexture and THREE.DataArrayTexture only supported with WebGL2.")),i.bindTexture(at,we.__webglTexture),re(at,G,Le),xe(Q.__webglFramebuffer,ge,G,36064,at),A(G,Le)&&P(at),i.unbindTexture()}ge.depthBuffer&&ce(ge)}function He(ge){let G=E(ge)||o,Q=ge.isWebGLMultipleRenderTargets===!0?ge.texture:[ge.texture];for(let we=0,te=Q.length;we<te;we++){let Ne=Q[we];if(A(Ne,G)){let Le=ge.isWebGLCubeRenderTarget?34067:3553,at=r.get(Ne).__webglTexture;i.bindTexture(Le,at),P(Le),i.unbindTexture()}}}function Be(ge){if(o&&ge.samples>0&&ze(ge)===!1){let G=ge.isWebGLMultipleRenderTargets?ge.texture:[ge.texture],Q=ge.width,we=ge.height,te=16384,Ne=[],Le=ge.stencilBuffer?33306:36096,at=r.get(ge),Te=ge.isWebGLMultipleRenderTargets===!0;if(Te)for(let dt=0;dt<G.length;dt++)i.bindFramebuffer(36160,at.__webglMultisampledFramebuffer),t.framebufferRenderbuffer(36160,36064+dt,36161,null),i.bindFramebuffer(36160,at.__webglFramebuffer),t.framebufferTexture2D(36009,36064+dt,3553,null,0);i.bindFramebuffer(36008,at.__webglMultisampledFramebuffer),i.bindFramebuffer(36009,at.__webglFramebuffer);for(let dt=0;dt<G.length;dt++){Ne.push(36064+dt),ge.depthBuffer&&Ne.push(Le);let ot=at.__ignoreDepthValues!==void 0?at.__ignoreDepthValues:!1;if(ot===!1&&(ge.depthBuffer&&(te|=256),ge.stencilBuffer&&(te|=1024)),Te&&t.framebufferRenderbuffer(36008,36064,36161,at.__webglColorRenderbuffer[dt]),ot===!0&&(t.invalidateFramebuffer(36008,[Le]),t.invalidateFramebuffer(36009,[Le])),Te){let Qe=r.get(G[dt]).__webglTexture;t.framebufferTexture2D(36009,36064,3553,Qe,0)}t.blitFramebuffer(0,0,Q,we,0,0,Q,we,te,9728),f&&t.invalidateFramebuffer(36008,Ne)}if(i.bindFramebuffer(36008,null),i.bindFramebuffer(36009,null),Te)for(let dt=0;dt<G.length;dt++){i.bindFramebuffer(36160,at.__webglMultisampledFramebuffer),t.framebufferRenderbuffer(36160,36064+dt,36161,at.__webglColorRenderbuffer[dt]);let ot=r.get(G[dt]).__webglTexture;i.bindFramebuffer(36160,at.__webglFramebuffer),t.framebufferTexture2D(36009,36064+dt,3553,ot,0)}i.bindFramebuffer(36009,at.__webglMultisampledFramebuffer)}}function $e(ge){return Math.min(h,ge.samples)}function ze(ge){let G=r.get(ge);return o&&ge.samples>0&&e.has("WEBGL_multisampled_render_to_texture")===!0&&G.__useRenderToTexture!==!1}function it(ge){let G=a.render.frame;p.get(ge)!==G&&(p.set(ge,G),ge.update())}function wt(ge,G){let Q=ge.encoding,we=ge.format,te=ge.type;return ge.isCompressedTexture===!0||ge.isVideoTexture===!0||ge.format===Aj||Q!==Dh&&(Q===er?o===!1?e.has("EXT_sRGB")===!0&&we===Vn?(ge.format=Aj,ge.minFilter=nr,ge.generateMipmaps=!1):G=che.sRGBToLinear(G):(we!==Vn||te!==Ho)&&console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):console.error("THREE.WebGLTextures: Unsupported texture encoding:",Q)),G}this.allocateTextureUnit=U,this.resetTextureUnits=X,this.setTexture2D=Z,this.setTexture2DArray=j,this.setTexture3D=ee,this.setTextureCube=pe,this.rebindTextures=Fe,this.setupRenderTarget=De,this.updateRenderTargetMipmap=He,this.updateMultisampleRenderTarget=Be,this.setupDepthRenderbuffer=ce,this.setupFrameBufferTexture=xe,this.useMultisampledRTT=ze}function V9e(t,e,i){let r=i.isWebGL2;function n(s,a=null){let o;if(s===Ho)return 5121;if(s===A6e)return 32819;if(s===M6e)return 32820;if(s===_6e)return 5120;if(s===S6e)return 5122;if(s===the)return 5123;if(s===E6e)return 5124;if(s===Ap)return 5125;if(s===cn)return 5126;if(s===qp)return r?5131:(o=e.get("OES_texture_half_float"),o!==null?o.HALF_FLOAT_OES:null);if(s===T6e)return 6406;if(s===Vn)return 6408;if(s===C6e)return 6409;if(s===P6e)return 6410;if(s===y0)return 6402;if(s===N0)return 34041;if(s===Aj)return o=e.get("EXT_sRGB"),o!==null?o.SRGB_ALPHA_EXT:null;if(s===tI)return 6403;if(s===R6e)return 36244;if(s===BD)return 33319;if(s===I6e)return 33320;if(s===ihe)return 36249;if(s===PB||s===RB||s===IB||s===DB)if(a===er)if(o=e.get("WEBGL_compressed_texture_s3tc_srgb"),o!==null){if(s===PB)return o.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(s===RB)return o.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(s===IB)return o.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(s===DB)return o.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else return null;else if(o=e.get("WEBGL_compressed_texture_s3tc"),o!==null){if(s===PB)return o.COMPRESSED_RGB_S3TC_DXT1_EXT;if(s===RB)return o.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(s===IB)return o.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(s===DB)return o.COMPRESSED_RGBA_S3TC_DXT5_EXT}else return null;if(s===YK||s===KK||s===ZK||s===QK)if(o=e.get("WEBGL_compressed_texture_pvrtc"),o!==null){if(s===YK)return o.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(s===KK)return o.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(s===ZK)return o.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(s===QK)return o.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}else return null;if(s===D6e)return o=e.get("WEBGL_compressed_texture_etc1"),o!==null?o.COMPRESSED_RGB_ETC1_WEBGL:null;if(s===JK||s===eZ)if(o=e.get("WEBGL_compressed_texture_etc"),o!==null){if(s===JK)return a===er?o.COMPRESSED_SRGB8_ETC2:o.COMPRESSED_RGB8_ETC2;if(s===eZ)return a===er?o.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:o.COMPRESSED_RGBA8_ETC2_EAC}else return null;if(s===tZ||s===iZ||s===rZ||s===nZ||s===sZ||s===aZ||s===oZ||s===lZ||s===cZ||s===uZ||s===hZ||s===dZ||s===fZ||s===pZ)if(o=e.get("WEBGL_compressed_texture_astc"),o!==null){if(s===tZ)return a===er?o.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:o.COMPRESSED_RGBA_ASTC_4x4_KHR;if(s===iZ)return a===er?o.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:o.COMPRESSED_RGBA_ASTC_5x4_KHR;if(s===rZ)return a===er?o.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:o.COMPRESSED_RGBA_ASTC_5x5_KHR;if(s===nZ)return a===er?o.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:o.COMPRESSED_RGBA_ASTC_6x5_KHR;if(s===sZ)return a===er?o.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:o.COMPRESSED_RGBA_ASTC_6x6_KHR;if(s===aZ)return a===er?o.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:o.COMPRESSED_RGBA_ASTC_8x5_KHR;if(s===oZ)return a===er?o.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:o.COMPRESSED_RGBA_ASTC_8x6_KHR;if(s===lZ)return a===er?o.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:o.COMPRESSED_RGBA_ASTC_8x8_KHR;if(s===cZ)return a===er?o.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:o.COMPRESSED_RGBA_ASTC_10x5_KHR;if(s===uZ)return a===er?o.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:o.COMPRESSED_RGBA_ASTC_10x6_KHR;if(s===hZ)return a===er?o.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:o.COMPRESSED_RGBA_ASTC_10x8_KHR;if(s===dZ)return a===er?o.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:o.COMPRESSED_RGBA_ASTC_10x10_KHR;if(s===fZ)return a===er?o.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:o.COMPRESSED_RGBA_ASTC_12x10_KHR;if(s===pZ)return a===er?o.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:o.COMPRESSED_RGBA_ASTC_12x12_KHR}else return null;if(s===OB)if(o=e.get("EXT_texture_compression_bptc"),o!==null){if(s===OB)return a===er?o.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:o.COMPRESSED_RGBA_BPTC_UNORM_EXT}else return null;if(s===O6e||s===mZ||s===gZ||s===vZ)if(o=e.get("EXT_texture_compression_rgtc"),o!==null){if(s===OB)return o.COMPRESSED_RED_RGTC1_EXT;if(s===mZ)return o.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(s===gZ)return o.COMPRESSED_RED_GREEN_RGTC2_EXT;if(s===vZ)return o.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}else return null;return s===v0?r?34042:(o=e.get("WEBGL_depth_texture"),o!==null?o.UNSIGNED_INT_24_8_WEBGL:null):t[s]!==void 0?t[s]:null}return{convert:n}}var H9e=class extends No{constructor(t=[]){super(),this.isArrayCamera=!0,this.cameras=t}},Tp=class extends tn{constructor(){super(),this.isGroup=!0,this.type="Group"}},G9e={type:"move"},sF=class{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return this._hand===null&&(this._hand=new Tp,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return this._targetRay===null&&(this._targetRay=new Tp,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new W,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new W),this._targetRay}getGripSpace(){return this._grip===null&&(this._grip=new Tp,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new W,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new W),this._grip}dispatchEvent(t){return this._targetRay!==null&&this._targetRay.dispatchEvent(t),this._grip!==null&&this._grip.dispatchEvent(t),this._hand!==null&&this._hand.dispatchEvent(t),this}connect(t){if(t&&t.hand){let e=this._hand;if(e)for(let i of t.hand.values())this._getHandJoint(e,i)}return this.dispatchEvent({type:"connected",data:t}),this}disconnect(t){return this.dispatchEvent({type:"disconnected",data:t}),this._targetRay!==null&&(this._targetRay.visible=!1),this._grip!==null&&(this._grip.visible=!1),this._hand!==null&&(this._hand.visible=!1),this}update(t,e,i){let r=null,n=null,s=null,a=this._targetRay,o=this._grip,l=this._hand;if(t&&e.session.visibilityState!=="visible-blurred"){if(l&&t.hand){s=!0;for(let p of t.hand.values()){let g=e.getJointPose(p,i),m=this._getHandJoint(l,p);g!==null&&(m.matrix.fromArray(g.transform.matrix),m.matrix.decompose(m.position,m.rotation,m.scale),m.jointRadius=g.radius),m.visible=g!==null}let c=l.joints["index-finger-tip"],u=l.joints["thumb-tip"],h=c.position.distanceTo(u.position),d=.02,f=.005;l.inputState.pinching&&h>d+f?(l.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:t.handedness,target:this})):!l.inputState.pinching&&h<=d-f&&(l.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:t.handedness,target:this}))}else o!==null&&t.gripSpace&&(n=e.getPose(t.gripSpace,i),n!==null&&(o.matrix.fromArray(n.transform.matrix),o.matrix.decompose(o.position,o.rotation,o.scale),n.linearVelocity?(o.hasLinearVelocity=!0,o.linearVelocity.copy(n.linearVelocity)):o.hasLinearVelocity=!1,n.angularVelocity?(o.hasAngularVelocity=!0,o.angularVelocity.copy(n.angularVelocity)):o.hasAngularVelocity=!1));a!==null&&(r=e.getPose(t.targetRaySpace,i),r===null&&n!==null&&(r=n),r!==null&&(a.matrix.fromArray(r.transform.matrix),a.matrix.decompose(a.position,a.rotation,a.scale),r.linearVelocity?(a.hasLinearVelocity=!0,a.linearVelocity.copy(r.linearVelocity)):a.hasLinearVelocity=!1,r.angularVelocity?(a.hasAngularVelocity=!0,a.angularVelocity.copy(r.angularVelocity)):a.hasAngularVelocity=!1,this.dispatchEvent(G9e)))}return a!==null&&(a.visible=r!==null),o!==null&&(o.visible=n!==null),l!==null&&(l.visible=s!==null),this}_getHandJoint(t,e){if(t.joints[e.jointName]===void 0){let i=new Tp;i.matrixAutoUpdate=!1,i.visible=!1,t.joints[e.jointName]=i,t.add(i)}return t.joints[e.jointName]}},H1=class extends Kn{constructor(t,e,i,r,n,s,a,o,l,c){if(c=c!==void 0?c:y0,c!==y0&&c!==N0)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");i===void 0&&c===y0&&(i=Ap),i===void 0&&c===N0&&(i=v0),super(null,r,n,s,a,o,c,i,l),this.isDepthTexture=!0,this.image={width:t,height:e},this.magFilter=a!==void 0?a:mr,this.minFilter=o!==void 0?o:mr,this.flipY=!1,this.generateMipmaps=!1}},W9e=class extends Qa{constructor(t,e){super();let i=this,r=null,n=1,s=null,a="local-floor",o=1,l=null,c=null,u=null,h=null,d=null,f=null,p=e.getContextAttributes(),g=null,m=null,y=[],b=[],w=new Set,E=new Map,M=new No;M.layers.enable(1),M.viewport=new Ui;let A=new No;A.layers.enable(2),A.viewport=new Ui;let P=[M,A],C=new H9e;C.layers.enable(1),C.layers.enable(2);let R=null,I=null;this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(j){let ee=y[j];return ee===void 0&&(ee=new sF,y[j]=ee),ee.getTargetRaySpace()},this.getControllerGrip=function(j){let ee=y[j];return ee===void 0&&(ee=new sF,y[j]=ee),ee.getGripSpace()},this.getHand=function(j){let ee=y[j];return ee===void 0&&(ee=new sF,y[j]=ee),ee.getHandSpace()};function k(j){let ee=b.indexOf(j.inputSource);if(ee===-1)return;let pe=y[ee];pe!==void 0&&pe.dispatchEvent({type:j.type,data:j.inputSource})}function z(){r.removeEventListener("select",k),r.removeEventListener("selectstart",k),r.removeEventListener("selectend",k),r.removeEventListener("squeeze",k),r.removeEventListener("squeezestart",k),r.removeEventListener("squeezeend",k),r.removeEventListener("end",z),r.removeEventListener("inputsourceschange",V);for(let j=0;j<y.length;j++){let ee=b[j];ee!==null&&(b[j]=null,y[j].disconnect(ee))}R=null,I=null,t.setRenderTarget(g),d=null,h=null,u=null,r=null,m=null,Z.stop(),i.isPresenting=!1,i.dispatchEvent({type:"sessionend"})}this.setFramebufferScaleFactor=function(j){n=j,i.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(j){a=j,i.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return l||s},this.setReferenceSpace=function(j){l=j},this.getBaseLayer=function(){return h!==null?h:d},this.getBinding=function(){return u},this.getFrame=function(){return f},this.getSession=function(){return r},this.setSession=async function(j){if(r=j,r!==null){if(g=t.getRenderTarget(),r.addEventListener("select",k),r.addEventListener("selectstart",k),r.addEventListener("selectend",k),r.addEventListener("squeeze",k),r.addEventListener("squeezestart",k),r.addEventListener("squeezeend",k),r.addEventListener("end",z),r.addEventListener("inputsourceschange",V),p.xrCompatible!==!0&&await e.makeXRCompatible(),r.renderState.layers===void 0||t.capabilities.isWebGL2===!1){let ee={antialias:r.renderState.layers===void 0?p.antialias:!0,alpha:p.alpha,depth:p.depth,stencil:p.stencil,framebufferScaleFactor:n};d=new XRWebGLLayer(r,e,ee),r.updateRenderState({baseLayer:d}),m=new Mr(d.framebufferWidth,d.framebufferHeight,{format:Vn,type:Ho,encoding:t.outputEncoding,stencilBuffer:p.stencil})}else{let ee=null,pe=null,fe=null;p.depth&&(fe=p.stencil?35056:33190,ee=p.stencil?N0:y0,pe=p.stencil?v0:Ap);let se={colorFormat:32856,depthFormat:fe,scaleFactor:n};u=new XRWebGLBinding(r,e),h=u.createProjectionLayer(se),r.updateRenderState({layers:[h]}),m=new Mr(h.textureWidth,h.textureHeight,{format:Vn,type:Ho,depthTexture:new H1(h.textureWidth,h.textureHeight,pe,void 0,void 0,void 0,void 0,void 0,void 0,ee),stencilBuffer:p.stencil,encoding:t.outputEncoding,samples:p.antialias?4:0});let re=t.properties.get(m);re.__ignoreDepthValues=h.ignoreDepthValues}m.isXRRenderTarget=!0,this.setFoveation(o),l=null,s=await r.requestReferenceSpace(a),Z.setContext(r),Z.start(),i.isPresenting=!0,i.dispatchEvent({type:"sessionstart"})}};function V(j){for(let ee=0;ee<j.removed.length;ee++){let pe=j.removed[ee],fe=b.indexOf(pe);fe>=0&&(b[fe]=null,y[fe].disconnect(pe))}for(let ee=0;ee<j.added.length;ee++){let pe=j.added[ee],fe=b.indexOf(pe);if(fe===-1){for(let re=0;re<y.length;re++)if(re>=b.length){b.push(pe),fe=re;break}else if(b[re]===null){b[re]=pe,fe=re;break}if(fe===-1)break}let se=y[fe];se&&se.connect(pe)}}let F=new W,$=new W;function K(j,ee,pe){F.setFromMatrixPosition(ee.matrixWorld),$.setFromMatrixPosition(pe.matrixWorld);let fe=F.distanceTo($),se=ee.projectionMatrix.elements,re=pe.projectionMatrix.elements,le=se[14]/(se[10]-1),he=se[14]/(se[10]+1),ve=(se[9]+1)/se[5],xe=(se[9]-1)/se[5],Se=(se[8]-1)/se[0],Ce=(re[8]+1)/re[0],ce=le*Se,Fe=le*Ce,De=fe/(-Se+Ce),He=De*-Se;ee.matrixWorld.decompose(j.position,j.quaternion,j.scale),j.translateX(He),j.translateZ(De),j.matrixWorld.compose(j.position,j.quaternion,j.scale),j.matrixWorldInverse.copy(j.matrixWorld).invert();let Be=le+De,$e=he+De,ze=ce-He,it=Fe+(fe-He),wt=ve*he/$e*Be,ge=xe*he/$e*Be;j.projectionMatrix.makePerspective(ze,it,wt,ge,Be,$e)}function X(j,ee){ee===null?j.matrixWorld.copy(j.matrix):j.matrixWorld.multiplyMatrices(ee.matrixWorld,j.matrix),j.matrixWorldInverse.copy(j.matrixWorld).invert()}this.updateCamera=function(j){if(r===null)return;C.near=A.near=M.near=j.near,C.far=A.far=M.far=j.far,(R!==C.near||I!==C.far)&&(r.updateRenderState({depthNear:C.near,depthFar:C.far}),R=C.near,I=C.far);let ee=j.parent,pe=C.cameras;X(C,ee);for(let se=0;se<pe.length;se++)X(pe[se],ee);C.matrixWorld.decompose(C.position,C.quaternion,C.scale),j.matrix.copy(C.matrix),j.matrix.decompose(j.position,j.quaternion,j.scale);let fe=j.children;for(let se=0,re=fe.length;se<re;se++)fe[se].updateMatrixWorld(!0);pe.length===2?K(C,M,A):C.projectionMatrix.copy(M.projectionMatrix)},this.getCamera=function(){return C},this.getFoveation=function(){if(!(h===null&&d===null))return o},this.setFoveation=function(j){o=j,h!==null&&(h.fixedFoveation=j),d!==null&&d.fixedFoveation!==void 0&&(d.fixedFoveation=j)},this.getPlanes=function(){return w};let U=null;function Y(j,ee){if(c=ee.getViewerPose(l||s),f=ee,c!==null){let pe=c.views;d!==null&&(t.setRenderTargetFramebuffer(m,d.framebuffer),t.setRenderTarget(m));let fe=!1;pe.length!==C.cameras.length&&(C.cameras.length=0,fe=!0);for(let se=0;se<pe.length;se++){let re=pe[se],le=null;if(d!==null)le=d.getViewport(re);else{let ve=u.getViewSubImage(h,re);le=ve.viewport,se===0&&(t.setRenderTargetTextures(m,ve.colorTexture,h.ignoreDepthValues?void 0:ve.depthStencilTexture),t.setRenderTarget(m))}let he=P[se];he===void 0&&(he=new No,he.layers.enable(se),he.viewport=new Ui,P[se]=he),he.matrix.fromArray(re.transform.matrix),he.projectionMatrix.fromArray(re.projectionMatrix),he.viewport.set(le.x,le.y,le.width,le.height),se===0&&C.matrix.copy(he.matrix),fe===!0&&C.cameras.push(he)}}for(let pe=0;pe<y.length;pe++){let fe=b[pe],se=y[pe];fe!==null&&se!==void 0&&se.update(fe,ee,l||s)}if(U&&U(j,ee),ee.detectedPlanes){i.dispatchEvent({type:"planesdetected",data:ee.detectedPlanes});let pe=null;for(let fe of w)ee.detectedPlanes.has(fe)||(pe===null&&(pe=[]),pe.push(fe));if(pe!==null)for(let fe of pe)w.delete(fe),E.delete(fe),i.dispatchEvent({type:"planeremoved",data:fe});for(let fe of ee.detectedPlanes)if(!w.has(fe))w.add(fe),E.set(fe,ee.lastChangedTime),i.dispatchEvent({type:"planeadded",data:fe});else{let se=E.get(fe);fe.lastChangedTime>se&&(E.set(fe,fe.lastChangedTime),i.dispatchEvent({type:"planechanged",data:fe}))}}f=null}let Z=new mhe;Z.setAnimationLoop(Y),this.setAnimationLoop=function(j){U=j},this.dispose=function(){}}};function q9e(t,e){function i(g,m){m.color.getRGB(g.fogColor.value,phe(t)),m.isFog?(g.fogNear.value=m.near,g.fogFar.value=m.far):m.isFogExp2&&(g.fogDensity.value=m.density)}function r(g,m,y,b,w){m.isMeshBasicMaterial||m.isMeshLambertMaterial?n(g,m):m.isMeshToonMaterial?(n(g,m),u(g,m)):m.isMeshPhongMaterial?(n(g,m),c(g,m)):m.isMeshStandardMaterial?(n(g,m),h(g,m),m.isMeshPhysicalMaterial&&d(g,m,w)):m.isMeshMatcapMaterial?(n(g,m),f(g,m)):m.isMeshDepthMaterial?n(g,m):m.isMeshDistanceMaterial?(n(g,m),p(g,m)):m.isMeshNormalMaterial?n(g,m):m.isLineBasicMaterial?(s(g,m),m.isLineDashedMaterial&&a(g,m)):m.isPointsMaterial?o(g,m,y,b):m.isSpriteMaterial?l(g,m):m.isShadowMaterial?(g.color.value.copy(m.color),g.opacity.value=m.opacity):m.isShaderMaterial&&(m.uniformsNeedUpdate=!1)}function n(g,m){g.opacity.value=m.opacity,m.color&&g.diffuse.value.copy(m.color),m.emissive&&g.emissive.value.copy(m.emissive).multiplyScalar(m.emissiveIntensity),m.map&&(g.map.value=m.map),m.alphaMap&&(g.alphaMap.value=m.alphaMap),m.bumpMap&&(g.bumpMap.value=m.bumpMap,g.bumpScale.value=m.bumpScale,m.side===qa&&(g.bumpScale.value*=-1)),m.displacementMap&&(g.displacementMap.value=m.displacementMap,g.displacementScale.value=m.displacementScale,g.displacementBias.value=m.displacementBias),m.emissiveMap&&(g.emissiveMap.value=m.emissiveMap),m.normalMap&&(g.normalMap.value=m.normalMap,g.normalScale.value.copy(m.normalScale),m.side===qa&&g.normalScale.value.negate()),m.specularMap&&(g.specularMap.value=m.specularMap),m.alphaTest>0&&(g.alphaTest.value=m.alphaTest);let y=e.get(m).envMap;if(y&&(g.envMap.value=y,g.flipEnvMap.value=y.isCubeTexture&&y.isRenderTargetTexture===!1?-1:1,g.reflectivity.value=m.reflectivity,g.ior.value=m.ior,g.refractionRatio.value=m.refractionRatio),m.lightMap){g.lightMap.value=m.lightMap;let E=t.physicallyCorrectLights!==!0?Math.PI:1;g.lightMapIntensity.value=m.lightMapIntensity*E}m.aoMap&&(g.aoMap.value=m.aoMap,g.aoMapIntensity.value=m.aoMapIntensity);let b;m.map?b=m.map:m.specularMap?b=m.specularMap:m.displacementMap?b=m.displacementMap:m.normalMap?b=m.normalMap:m.bumpMap?b=m.bumpMap:m.roughnessMap?b=m.roughnessMap:m.metalnessMap?b=m.metalnessMap:m.alphaMap?b=m.alphaMap:m.emissiveMap?b=m.emissiveMap:m.clearcoatMap?b=m.clearcoatMap:m.clearcoatNormalMap?b=m.clearcoatNormalMap:m.clearcoatRoughnessMap?b=m.clearcoatRoughnessMap:m.iridescenceMap?b=m.iridescenceMap:m.iridescenceThicknessMap?b=m.iridescenceThicknessMap:m.specularIntensityMap?b=m.specularIntensityMap:m.specularColorMap?b=m.specularColorMap:m.transmissionMap?b=m.transmissionMap:m.thicknessMap?b=m.thicknessMap:m.sheenColorMap?b=m.sheenColorMap:m.sheenRoughnessMap&&(b=m.sheenRoughnessMap),b!==void 0&&(b.isWebGLRenderTarget&&(b=b.texture),b.matrixAutoUpdate===!0&&b.updateMatrix(),g.uvTransform.value.copy(b.matrix));let w;m.aoMap?w=m.aoMap:m.lightMap&&(w=m.lightMap),w!==void 0&&(w.isWebGLRenderTarget&&(w=w.texture),w.matrixAutoUpdate===!0&&w.updateMatrix(),g.uv2Transform.value.copy(w.matrix))}function s(g,m){g.diffuse.value.copy(m.color),g.opacity.value=m.opacity}function a(g,m){g.dashSize.value=m.dashSize,g.totalSize.value=m.dashSize+m.gapSize,g.scale.value=m.scale}function o(g,m,y,b){g.diffuse.value.copy(m.color),g.opacity.value=m.opacity,g.size.value=m.size*y,g.scale.value=b*.5,m.map&&(g.map.value=m.map),m.alphaMap&&(g.alphaMap.value=m.alphaMap),m.alphaTest>0&&(g.alphaTest.value=m.alphaTest);let w;m.map?w=m.map:m.alphaMap&&(w=m.alphaMap),w!==void 0&&(w.matrixAutoUpdate===!0&&w.updateMatrix(),g.uvTransform.value.copy(w.matrix))}function l(g,m){g.diffuse.value.copy(m.color),g.opacity.value=m.opacity,g.rotation.value=m.rotation,m.map&&(g.map.value=m.map),m.alphaMap&&(g.alphaMap.value=m.alphaMap),m.alphaTest>0&&(g.alphaTest.value=m.alphaTest);let y;m.map?y=m.map:m.alphaMap&&(y=m.alphaMap),y!==void 0&&(y.matrixAutoUpdate===!0&&y.updateMatrix(),g.uvTransform.value.copy(y.matrix))}function c(g,m){g.specular.value.copy(m.specular),g.shininess.value=Math.max(m.shininess,1e-4)}function u(g,m){m.gradientMap&&(g.gradientMap.value=m.gradientMap)}function h(g,m){g.roughness.value=m.roughness,g.metalness.value=m.metalness,m.roughnessMap&&(g.roughnessMap.value=m.roughnessMap),m.metalnessMap&&(g.metalnessMap.value=m.metalnessMap),e.get(m).envMap&&(g.envMapIntensity.value=m.envMapIntensity)}function d(g,m,y){g.ior.value=m.ior,m.sheen>0&&(g.sheenColor.value.copy(m.sheenColor).multiplyScalar(m.sheen),g.sheenRoughness.value=m.sheenRoughness,m.sheenColorMap&&(g.sheenColorMap.value=m.sheenColorMap),m.sheenRoughnessMap&&(g.sheenRoughnessMap.value=m.sheenRoughnessMap)),m.clearcoat>0&&(g.clearcoat.value=m.clearcoat,g.clearcoatRoughness.value=m.clearcoatRoughness,m.clearcoatMap&&(g.clearcoatMap.value=m.clearcoatMap),m.clearcoatRoughnessMap&&(g.clearcoatRoughnessMap.value=m.clearcoatRoughnessMap),m.clearcoatNormalMap&&(g.clearcoatNormalScale.value.copy(m.clearcoatNormalScale),g.clearcoatNormalMap.value=m.clearcoatNormalMap,m.side===qa&&g.clearcoatNormalScale.value.negate())),m.iridescence>0&&(g.iridescence.value=m.iridescence,g.iridescenceIOR.value=m.iridescenceIOR,g.iridescenceThicknessMinimum.value=m.iridescenceThicknessRange[0],g.iridescenceThicknessMaximum.value=m.iridescenceThicknessRange[1],m.iridescenceMap&&(g.iridescenceMap.value=m.iridescenceMap),m.iridescenceThicknessMap&&(g.iridescenceThicknessMap.value=m.iridescenceThicknessMap)),m.transmission>0&&(g.transmission.value=m.transmission,g.transmissionSamplerMap.value=y.texture,g.transmissionSamplerSize.value.set(y.width,y.height),m.transmissionMap&&(g.transmissionMap.value=m.transmissionMap),g.thickness.value=m.thickness,m.thicknessMap&&(g.thicknessMap.value=m.thicknessMap),g.attenuationDistance.value=m.attenuationDistance,g.attenuationColor.value.copy(m.attenuationColor)),g.specularIntensity.value=m.specularIntensity,g.specularColor.value.copy(m.specularColor),m.specularIntensityMap&&(g.specularIntensityMap.value=m.specularIntensityMap),m.specularColorMap&&(g.specularColorMap.value=m.specularColorMap)}function f(g,m){m.matcap&&(g.matcap.value=m.matcap)}function p(g,m){g.referencePosition.value.copy(m.referencePosition),g.nearDistance.value=m.nearDistance,g.farDistance.value=m.farDistance}return{refreshFogUniforms:i,refreshMaterialUniforms:r}}function X9e(t,e,i,r){let n={},s={},a=[],o=i.isWebGL2?t.getParameter(35375):0;function l(b,w){let E=w.program;r.uniformBlockBinding(b,E)}function c(b,w){let E=n[b.id];E===void 0&&(p(b),E=u(b),n[b.id]=E,b.addEventListener("dispose",m));let M=w.program;r.updateUBOMapping(b,M);let A=e.render.frame;s[b.id]!==A&&(d(b),s[b.id]=A)}function u(b){let w=h();b.__bindingPointIndex=w;let E=t.createBuffer(),M=b.__size,A=b.usage;return t.bindBuffer(35345,E),t.bufferData(35345,M,A),t.bindBuffer(35345,null),t.bindBufferBase(35345,w,E),E}function h(){for(let b=0;b<o;b++)if(a.indexOf(b)===-1)return a.push(b),b;return console.error("THREE.WebGLRenderer: Maximum number of simultaneously usable uniforms groups reached."),0}function d(b){let w=n[b.id],E=b.uniforms,M=b.__cache;t.bindBuffer(35345,w);for(let A=0,P=E.length;A<P;A++){let C=E[A];if(f(C,A,M)===!0){let R=C.__offset,I=Array.isArray(C.value)?C.value:[C.value],k=0;for(let z=0;z<I.length;z++){let V=I[z],F=g(V);typeof V=="number"?(C.__data[0]=V,t.bufferSubData(35345,R+k,C.__data)):V.isMatrix3?(C.__data[0]=V.elements[0],C.__data[1]=V.elements[1],C.__data[2]=V.elements[2],C.__data[3]=V.elements[0],C.__data[4]=V.elements[3],C.__data[5]=V.elements[4],C.__data[6]=V.elements[5],C.__data[7]=V.elements[0],C.__data[8]=V.elements[6],C.__data[9]=V.elements[7],C.__data[10]=V.elements[8],C.__data[11]=V.elements[0]):(V.toArray(C.__data,k),k+=F.storage/Float32Array.BYTES_PER_ELEMENT)}t.bufferSubData(35345,R,C.__data)}}t.bindBuffer(35345,null)}function f(b,w,E){let M=b.value;if(E[w]===void 0){if(typeof M=="number")E[w]=M;else{let A=Array.isArray(M)?M:[M],P=[];for(let C=0;C<A.length;C++)P.push(A[C].clone());E[w]=P}return!0}else if(typeof M=="number"){if(E[w]!==M)return E[w]=M,!0}else{let A=Array.isArray(E[w])?E[w]:[E[w]],P=Array.isArray(M)?M:[M];for(let C=0;C<A.length;C++){let R=A[C];if(R.equals(P[C])===!1)return R.copy(P[C]),!0}}return!1}function p(b){let w=b.uniforms,E=0,M=16,A=0;for(let P=0,C=w.length;P<C;P++){let R=w[P],I={boundary:0,storage:0},k=Array.isArray(R.value)?R.value:[R.value];for(let z=0,V=k.length;z<V;z++){let F=k[z],$=g(F);I.boundary+=$.boundary,I.storage+=$.storage}if(R.__data=new Float32Array(I.storage/Float32Array.BYTES_PER_ELEMENT),R.__offset=E,P>0){A=E%M;let z=M-A;A!==0&&z-I.boundary<0&&(E+=M-A,R.__offset=E)}E+=I.storage}return A=E%M,A>0&&(E+=M-A),b.__size=E,b.__cache={},this}function g(b){let w={boundary:0,storage:0};return typeof b=="number"?(w.boundary=4,w.storage=4):b.isVector2?(w.boundary=8,w.storage=8):b.isVector3||b.isColor?(w.boundary=16,w.storage=12):b.isVector4?(w.boundary=16,w.storage=16):b.isMatrix3?(w.boundary=48,w.storage=48):b.isMatrix4?(w.boundary=64,w.storage=64):b.isTexture?console.warn("THREE.WebGLRenderer: Texture samplers can not be part of an uniforms group."):console.warn("THREE.WebGLRenderer: Unsupported uniform value type.",b),w}function m(b){let w=b.target;w.removeEventListener("dispose",m);let E=a.indexOf(w.__bindingPointIndex);a.splice(E,1),t.deleteBuffer(n[w.id]),delete n[w.id],delete s[w.id]}function y(){for(let b in n)t.deleteBuffer(n[b]);a=[],n={},s={}}return{bind:l,update:c,dispose:y}}function $9e(){let t=CM("canvas");return t.style.display="block",t}function whe(t={}){this.isWebGLRenderer=!0;let e=t.canvas!==void 0?t.canvas:$9e(),i=t.context!==void 0?t.context:null,r=t.depth!==void 0?t.depth:!0,n=t.stencil!==void 0?t.stencil:!0,s=t.antialias!==void 0?t.antialias:!1,a=t.premultipliedAlpha!==void 0?t.premultipliedAlpha:!0,o=t.preserveDrawingBuffer!==void 0?t.preserveDrawingBuffer:!1,l=t.powerPreference!==void 0?t.powerPreference:"default",c=t.failIfMajorPerformanceCaveat!==void 0?t.failIfMajorPerformanceCaveat:!1,u;i!==null?u=i.getContextAttributes().alpha:u=t.alpha!==void 0?t.alpha:!1;let h=null,d=null,f=[],p=[];this.domElement=e,this.debug={checkShaderErrors:!0},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.outputEncoding=Dh,this.physicallyCorrectLights=!1,this.toneMapping=Gd,this.toneMappingExposure=1;let g=this,m=!1,y=0,b=0,w=null,E=-1,M=null,A=new Ui,P=new Ui,C=null,R=e.width,I=e.height,k=1,z=null,V=null,F=new Ui(0,0,R,I),$=new Ui(0,0,R,I),K=!1,X=new qH,U=!1,Y=!1,Z=null,j=new St,ee=new Ae,pe=new W,fe={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function se(){return w===null?k:1}let re=i;function le(ye,Xe){for(let ht=0;ht<ye.length;ht++){let qe=ye[ht],gt=e.getContext(qe,Xe);if(gt!==null)return gt}return null}try{let ye={alpha:!0,depth:r,stencil:n,antialias:s,premultipliedAlpha:a,preserveDrawingBuffer:o,powerPreference:l,failIfMajorPerformanceCaveat:c};if("setAttribute"in e&&e.setAttribute("data-engine",`three.js r${S_}`),e.addEventListener("webglcontextlost",pt,!1),e.addEventListener("webglcontextrestored",_t,!1),e.addEventListener("webglcontextcreationerror",yt,!1),re===null){let Xe=["webgl2","webgl","experimental-webgl"];if(g.isWebGL1Renderer===!0&&Xe.shift(),re=le(Xe,ye),re===null)throw le(Xe)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}re.getShaderPrecisionFormat===void 0&&(re.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(ye){throw console.error("THREE.WebGLRenderer: "+ye.message),ye}let he,ve,xe,Se,Ce,ce,Fe,De,He,Be,$e,ze,it,wt,ge,G,Q,we,te,Ne,Le,at,Te,dt;function ot(){he=new oWe(re),ve=new tWe(re,he,t),he.init(ve),at=new V9e(re,he,ve),xe=new z9e(re,he,ve),Se=new uWe,Ce=new T9e,ce=new j9e(re,he,xe,Ce,ve,at,Se),Fe=new rWe(g),De=new aWe(g),He=new xHe(re,ve),Te=new J8e(re,he,He,ve),Be=new lWe(re,He,Se,Te),$e=new pWe(re,Be,He,Se),te=new fWe(re,ve,ce),G=new iWe(Ce),ze=new M9e(g,Fe,De,he,ve,Te,G),it=new q9e(g,Ce),wt=new P9e,ge=new k9e(he,ve),we=new Q8e(g,Fe,De,xe,$e,u,a),Q=new F9e(g,$e,ve),dt=new X9e(re,Se,ve,xe),Ne=new eWe(re,he,Se,ve),Le=new cWe(re,he,Se,ve),Se.programs=ze.programs,g.capabilities=ve,g.extensions=he,g.properties=Ce,g.renderLists=wt,g.shadowMap=Q,g.state=xe,g.info=Se}ot();let Qe=new W9e(g,re);this.xr=Qe,this.getContext=function(){return re},this.getContextAttributes=function(){return re.getContextAttributes()},this.forceContextLoss=function(){let ye=he.get("WEBGL_lose_context");ye&&ye.loseContext()},this.forceContextRestore=function(){let ye=he.get("WEBGL_lose_context");ye&&ye.restoreContext()},this.getPixelRatio=function(){return k},this.setPixelRatio=function(ye){ye!==void 0&&(k=ye,this.setSize(R,I,!1))},this.getSize=function(ye){return ye.set(R,I)},this.setSize=function(ye,Xe,ht){if(Qe.isPresenting){console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting.");return}R=ye,I=Xe,e.width=Math.floor(ye*k),e.height=Math.floor(Xe*k),ht!==!1&&(e.style.width=ye+"px",e.style.height=Xe+"px"),this.setViewport(0,0,ye,Xe)},this.getDrawingBufferSize=function(ye){return ye.set(R*k,I*k).floor()},this.setDrawingBufferSize=function(ye,Xe,ht){R=ye,I=Xe,k=ht,e.width=Math.floor(ye*ht),e.height=Math.floor(Xe*ht),this.setViewport(0,0,ye,Xe)},this.getCurrentViewport=function(ye){return ye.copy(A)},this.getViewport=function(ye){return ye.copy(F)},this.setViewport=function(ye,Xe,ht,qe){ye.isVector4?F.set(ye.x,ye.y,ye.z,ye.w):F.set(ye,Xe,ht,qe),xe.viewport(A.copy(F).multiplyScalar(k).floor())},this.getScissor=function(ye){return ye.copy($)},this.setScissor=function(ye,Xe,ht,qe){ye.isVector4?$.set(ye.x,ye.y,ye.z,ye.w):$.set(ye,Xe,ht,qe),xe.scissor(P.copy($).multiplyScalar(k).floor())},this.getScissorTest=function(){return K},this.setScissorTest=function(ye){xe.setScissorTest(K=ye)},this.setOpaqueSort=function(ye){z=ye},this.setTransparentSort=function(ye){V=ye},this.getClearColor=function(ye){return ye.copy(we.getClearColor())},this.setClearColor=function(){we.setClearColor.apply(we,arguments)},this.getClearAlpha=function(){return we.getClearAlpha()},this.setClearAlpha=function(){we.setClearAlpha.apply(we,arguments)},this.clear=function(ye=!0,Xe=!0,ht=!0){let qe=0;ye&&(qe|=16384),Xe&&(qe|=256),ht&&(qe|=1024),re.clear(qe)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){e.removeEventListener("webglcontextlost",pt,!1),e.removeEventListener("webglcontextrestored",_t,!1),e.removeEventListener("webglcontextcreationerror",yt,!1),wt.dispose(),ge.dispose(),Ce.dispose(),Fe.dispose(),De.dispose(),$e.dispose(),Te.dispose(),dt.dispose(),ze.dispose(),Qe.dispose(),Qe.removeEventListener("sessionstart",st),Qe.removeEventListener("sessionend",rt),Z&&(Z.dispose(),Z=null),je.stop()};function pt(ye){ye.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),m=!0}function _t(){console.log("THREE.WebGLRenderer: Context Restored."),m=!1;let ye=Se.autoReset,Xe=Q.enabled,ht=Q.autoUpdate,qe=Q.needsUpdate,gt=Q.type;ot(),Se.autoReset=ye,Q.enabled=Xe,Q.autoUpdate=ht,Q.needsUpdate=qe,Q.type=gt}function yt(ye){console.error("THREE.WebGLRenderer: A WebGL context could not be created. Reason: ",ye.statusMessage)}function Et(ye){let Xe=ye.target;Xe.removeEventListener("dispose",Et),$t(Xe)}function $t(ye){oe(ye),Ce.remove(ye)}function oe(ye){let Xe=Ce.get(ye).programs;Xe!==void 0&&(Xe.forEach(function(ht){ze.releaseProgram(ht)}),ye.isShaderMaterial&&ze.releaseShaderCache(ye))}this.renderBufferDirect=function(ye,Xe,ht,qe,gt,Zt){Xe===null&&(Xe=fe);let yi=gt.isMesh&&gt.matrixWorld.determinant()<0,Ti=Gr(ye,Xe,ht,qe,gt);xe.setMaterial(qe,yi);let fi=ht.index,vr=1;qe.wireframe===!0&&(fi=Be.getWireframeAttribute(ht),vr=2);let ji=ht.drawRange,Vi=ht.attributes.position,de=ji.start*vr,Ue=(ji.start+ji.count)*vr;Zt!==null&&(de=Math.max(de,Zt.start*vr),Ue=Math.min(Ue,(Zt.start+Zt.count)*vr)),fi!==null?(de=Math.max(de,0),Ue=Math.min(Ue,fi.count)):Vi!=null&&(de=Math.max(de,0),Ue=Math.min(Ue,Vi.count));let Je=Ue-de;if(Je<0||Je===1/0)return;Te.setup(gt,qe,Ti,ht,fi);let nt,Ie=Ne;if(fi!==null&&(nt=He.get(fi),Ie=Le,Ie.setIndex(nt)),gt.isMesh)qe.wireframe===!0?(xe.setLineWidth(qe.wireframeLinewidth*se()),Ie.setMode(1)):Ie.setMode(4);else if(gt.isLine){let ft=qe.linewidth;ft===void 0&&(ft=1),xe.setLineWidth(ft*se()),gt.isLineSegments?Ie.setMode(1):gt.isLineLoop?Ie.setMode(2):Ie.setMode(3)}else gt.isPoints?Ie.setMode(0):gt.isSprite&&Ie.setMode(4);if(gt.isInstancedMesh)Ie.renderInstances(de,Je,gt.count);else if(ht.isInstancedBufferGeometry){let ft=ht._maxInstanceCount!==void 0?ht._maxInstanceCount:1/0,Dt=Math.min(ht.instanceCount,ft);Ie.renderInstances(de,Je,Dt)}else Ie.render(de,Je)},this.compile=function(ye,Xe){function ht(qe,gt,Zt){qe.transparent===!0&&qe.side===jo&&qe.forceSinglePass===!1?(qe.side=qa,qe.needsUpdate=!0,Xi(qe,gt,Zt),qe.side=Ih,qe.needsUpdate=!0,Xi(qe,gt,Zt),qe.side=jo):Xi(qe,gt,Zt)}d=ge.get(ye),d.init(),p.push(d),ye.traverseVisible(function(qe){qe.isLight&&qe.layers.test(Xe.layers)&&(d.pushLight(qe),qe.castShadow&&d.pushShadow(qe))}),d.setupLights(g.physicallyCorrectLights),ye.traverse(function(qe){let gt=qe.material;if(gt)if(Array.isArray(gt))for(let Zt=0;Zt<gt.length;Zt++){let yi=gt[Zt];ht(yi,ye,qe)}else ht(gt,ye,qe)}),p.pop(),d=null};let Re=null;function ke(ye){Re&&Re(ye)}function st(){je.stop()}function rt(){je.start()}let je=new mhe;je.setAnimationLoop(ke),typeof self<"u"&&je.setContext(self),this.setAnimationLoop=function(ye){Re=ye,Qe.setAnimationLoop(ye),ye===null?je.stop():je.start()},Qe.addEventListener("sessionstart",st),Qe.addEventListener("sessionend",rt),this.render=function(ye,Xe){if(Xe!==void 0&&Xe.isCamera!==!0){console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");return}if(m===!0)return;ye.matrixWorldAutoUpdate===!0&&ye.updateMatrixWorld(),Xe.parent===null&&Xe.matrixWorldAutoUpdate===!0&&Xe.updateMatrixWorld(),Qe.enabled===!0&&Qe.isPresenting===!0&&(Qe.cameraAutoUpdate===!0&&Qe.updateCamera(Xe),Xe=Qe.getCamera()),ye.isScene===!0&&ye.onBeforeRender(g,ye,Xe,w),d=ge.get(ye,p.length),d.init(),p.push(d),j.multiplyMatrices(Xe.projectionMatrix,Xe.matrixWorldInverse),X.setFromProjectionMatrix(j),Y=this.localClippingEnabled,U=G.init(this.clippingPlanes,Y),h=wt.get(ye,f.length),h.init(),f.push(h),Tt(ye,Xe,0,g.sortObjects),h.finish(),g.sortObjects===!0&&h.sort(z,V),U===!0&&G.beginShadows();let ht=d.state.shadowsArray;if(Q.render(ht,ye,Xe),U===!0&&G.endShadows(),this.info.autoReset===!0&&this.info.reset(),we.render(h,ye),d.setupLights(g.physicallyCorrectLights),Xe.isArrayCamera){let qe=Xe.cameras;for(let gt=0,Zt=qe.length;gt<Zt;gt++){let yi=qe[gt];Ft(h,ye,yi,yi.viewport)}}else Ft(h,ye,Xe);w!==null&&(ce.updateMultisampleRenderTarget(w),ce.updateRenderTargetMipmap(w)),ye.isScene===!0&&ye.onAfterRender(g,ye,Xe),Te.resetDefaultState(),E=-1,M=null,p.pop(),p.length>0?d=p[p.length-1]:d=null,f.pop(),f.length>0?h=f[f.length-1]:h=null};function Tt(ye,Xe,ht,qe){if(ye.visible===!1)return;if(ye.layers.test(Xe.layers)){if(ye.isGroup)ht=ye.renderOrder;else if(ye.isLOD)ye.autoUpdate===!0&&ye.update(Xe);else if(ye.isLight)d.pushLight(ye),ye.castShadow&&d.pushShadow(ye);else if(ye.isSprite){if(!ye.frustumCulled||X.intersectsSprite(ye)){qe&&pe.setFromMatrixPosition(ye.matrixWorld).applyMatrix4(j);let Zt=$e.update(ye),yi=ye.material;yi.visible&&h.push(ye,Zt,yi,ht,pe.z,null)}}else if((ye.isMesh||ye.isLine||ye.isPoints)&&(ye.isSkinnedMesh&&ye.skeleton.frame!==Se.render.frame&&(ye.skeleton.update(),ye.skeleton.frame=Se.render.frame),!ye.frustumCulled||X.intersectsObject(ye))){qe&&pe.setFromMatrixPosition(ye.matrixWorld).applyMatrix4(j);let Zt=$e.update(ye),yi=ye.material;if(Array.isArray(yi)){let Ti=Zt.groups;for(let fi=0,vr=Ti.length;fi<vr;fi++){let ji=Ti[fi],Vi=yi[ji.materialIndex];Vi&&Vi.visible&&h.push(ye,Zt,Vi,ht,pe.z,ji)}}else yi.visible&&h.push(ye,Zt,yi,ht,pe.z,null)}}let gt=ye.children;for(let Zt=0,yi=gt.length;Zt<yi;Zt++)Tt(gt[Zt],Xe,ht,qe)}function Ft(ye,Xe,ht,qe){let gt=ye.opaque,Zt=ye.transmissive,yi=ye.transparent;d.setupLightsView(ht),U===!0&&G.setGlobalState(g.clippingPlanes,ht),Zt.length>0&&wi(gt,Xe,ht),qe&&xe.viewport(A.copy(qe)),gt.length>0&&ti(gt,Xe,ht),Zt.length>0&&ti(Zt,Xe,ht),yi.length>0&&ti(yi,Xe,ht),xe.buffers.depth.setTest(!0),xe.buffers.depth.setMask(!0),xe.buffers.color.setMask(!0),xe.setPolygonOffset(!1)}function wi(ye,Xe,ht){let qe=ve.isWebGL2;Z===null&&(Z=new Mr(1,1,{generateMipmaps:!0,type:he.has("EXT_color_buffer_half_float")?qp:Ho,minFilter:j1,samples:qe&&s===!0?4:0})),g.getDrawingBufferSize(ee),qe?Z.setSize(ee.x,ee.y):Z.setSize(HD(ee.x),HD(ee.y));let gt=g.getRenderTarget();g.setRenderTarget(Z),g.clear();let Zt=g.toneMapping;g.toneMapping=Gd,ti(ye,Xe,ht),g.toneMapping=Zt,ce.updateMultisampleRenderTarget(Z),ce.updateRenderTargetMipmap(Z),g.setRenderTarget(gt)}function ti(ye,Xe,ht){let qe=Xe.isScene===!0?Xe.overrideMaterial:null;for(let gt=0,Zt=ye.length;gt<Zt;gt++){let yi=ye[gt],Ti=yi.object,fi=yi.geometry,vr=qe===null?yi.material:qe,ji=yi.group;Ti.layers.test(ht.layers)&&Zi(Ti,Xe,ht,fi,vr,ji)}}function Zi(ye,Xe,ht,qe,gt,Zt){ye.onBeforeRender(g,Xe,ht,qe,gt,Zt),ye.modelViewMatrix.multiplyMatrices(ht.matrixWorldInverse,ye.matrixWorld),ye.normalMatrix.getNormalMatrix(ye.modelViewMatrix),gt.onBeforeRender(g,Xe,ht,qe,ye,Zt),gt.transparent===!0&&gt.side===jo&&gt.forceSinglePass===!1?(gt.side=qa,gt.needsUpdate=!0,g.renderBufferDirect(ht,Xe,qe,gt,ye,Zt),gt.side=Ih,gt.needsUpdate=!0,g.renderBufferDirect(ht,Xe,qe,gt,ye,Zt),gt.side=jo):g.renderBufferDirect(ht,Xe,qe,gt,ye,Zt),ye.onAfterRender(g,Xe,ht,qe,gt,Zt)}function Xi(ye,Xe,ht){Xe.isScene!==!0&&(Xe=fe);let qe=Ce.get(ye),gt=d.state.lights,Zt=d.state.shadowsArray,yi=gt.state.version,Ti=ze.getParameters(ye,gt.state,Zt,Xe,ht),fi=ze.getProgramCacheKey(Ti),vr=qe.programs;qe.environment=ye.isMeshStandardMaterial?Xe.environment:null,qe.fog=Xe.fog,qe.envMap=(ye.isMeshStandardMaterial?De:Fe).get(ye.envMap||qe.environment),vr===void 0&&(ye.addEventListener("dispose",Et),vr=new Map,qe.programs=vr);let ji=vr.get(fi);if(ji!==void 0){if(qe.currentProgram===ji&&qe.lightsStateVersion===yi)return As(ye,Ti),ji}else Ti.uniforms=ze.getUniforms(ye),ye.onBuild(ht,Ti,g),ye.onBeforeCompile(Ti,g),ji=ze.acquireProgram(Ti,fi),vr.set(fi,ji),qe.uniforms=Ti.uniforms;let Vi=qe.uniforms;(!ye.isShaderMaterial&&!ye.isRawShaderMaterial||ye.clipping===!0)&&(Vi.clippingPlanes=G.uniform),As(ye,Ti),qe.needsLights=us(ye),qe.lightsStateVersion=yi,qe.needsLights&&(Vi.ambientLightColor.value=gt.state.ambient,Vi.lightProbe.value=gt.state.probe,Vi.directionalLights.value=gt.state.directional,Vi.directionalLightShadows.value=gt.state.directionalShadow,Vi.spotLights.value=gt.state.spot,Vi.spotLightShadows.value=gt.state.spotShadow,Vi.rectAreaLights.value=gt.state.rectArea,Vi.ltc_1.value=gt.state.rectAreaLTC1,Vi.ltc_2.value=gt.state.rectAreaLTC2,Vi.pointLights.value=gt.state.point,Vi.pointLightShadows.value=gt.state.pointShadow,Vi.hemisphereLights.value=gt.state.hemi,Vi.directionalShadowMap.value=gt.state.directionalShadowMap,Vi.directionalShadowMatrix.value=gt.state.directionalShadowMatrix,Vi.spotShadowMap.value=gt.state.spotShadowMap,Vi.spotLightMatrix.value=gt.state.spotLightMatrix,Vi.spotLightMap.value=gt.state.spotLightMap,Vi.pointShadowMap.value=gt.state.pointShadowMap,Vi.pointShadowMatrix.value=gt.state.pointShadowMatrix);let de=ji.getUniforms(),Ue=rI.seqWithValue(de.seq,Vi);return qe.currentProgram=ji,qe.uniformsList=Ue,ji}function As(ye,Xe){let ht=Ce.get(ye);ht.outputEncoding=Xe.outputEncoding,ht.instancing=Xe.instancing,ht.skinning=Xe.skinning,ht.morphTargets=Xe.morphTargets,ht.morphNormals=Xe.morphNormals,ht.morphColors=Xe.morphColors,ht.morphTargetsCount=Xe.morphTargetsCount,ht.numClippingPlanes=Xe.numClippingPlanes,ht.numIntersection=Xe.numClipIntersection,ht.vertexAlphas=Xe.vertexAlphas,ht.vertexTangents=Xe.vertexTangents,ht.toneMapping=Xe.toneMapping}function Gr(ye,Xe,ht,qe,gt){Xe.isScene!==!0&&(Xe=fe),ce.resetTextureUnits();let Zt=Xe.fog,yi=qe.isMeshStandardMaterial?Xe.environment:null,Ti=w===null?g.outputEncoding:w.isXRRenderTarget===!0?w.texture.encoding:Dh,fi=(qe.isMeshStandardMaterial?De:Fe).get(qe.envMap||yi),vr=qe.vertexColors===!0&&!!ht.attributes.color&&ht.attributes.color.itemSize===4,ji=!!qe.normalMap&&!!ht.attributes.tangent,Vi=!!ht.morphAttributes.position,de=!!ht.morphAttributes.normal,Ue=!!ht.morphAttributes.color,Je=qe.toneMapped?g.toneMapping:Gd,nt=ht.morphAttributes.position||ht.morphAttributes.normal||ht.morphAttributes.color,Ie=nt!==void 0?nt.length:0,ft=Ce.get(qe),Dt=d.state.lights;if(U===!0&&(Y===!0||ye!==M)){let me=ye===M&&qe.id===E;G.setState(qe,ye,me)}let Mt=!1;qe.version===ft.__version?(ft.needsLights&&ft.lightsStateVersion!==Dt.state.version||ft.outputEncoding!==Ti||gt.isInstancedMesh&&ft.instancing===!1||!gt.isInstancedMesh&&ft.instancing===!0||gt.isSkinnedMesh&&ft.skinning===!1||!gt.isSkinnedMesh&&ft.skinning===!0||ft.envMap!==fi||qe.fog===!0&&ft.fog!==Zt||ft.numClippingPlanes!==void 0&&(ft.numClippingPlanes!==G.numPlanes||ft.numIntersection!==G.numIntersection)||ft.vertexAlphas!==vr||ft.vertexTangents!==ji||ft.morphTargets!==Vi||ft.morphNormals!==de||ft.morphColors!==Ue||ft.toneMapping!==Je||ve.isWebGL2===!0&&ft.morphTargetsCount!==Ie)&&(Mt=!0):(Mt=!0,ft.__version=qe.version);let Vt=ft.currentProgram;Mt===!0&&(Vt=Xi(qe,Xe,gt));let di=!1,si=!1,Wt=!1,ne=Vt.getUniforms(),ae=ft.uniforms;if(xe.useProgram(Vt.program)&&(di=!0,si=!0,Wt=!0),qe.id!==E&&(E=qe.id,si=!0),di||M!==ye){if(ne.setValue(re,"projectionMatrix",ye.projectionMatrix),ve.logarithmicDepthBuffer&&ne.setValue(re,"logDepthBufFC",2/(Math.log(ye.far+1)/Math.LN2)),M!==ye&&(M=ye,si=!0,Wt=!0),qe.isShaderMaterial||qe.isMeshPhongMaterial||qe.isMeshToonMaterial||qe.isMeshStandardMaterial||qe.envMap){let me=ne.map.cameraPosition;me!==void 0&&me.setValue(re,pe.setFromMatrixPosition(ye.matrixWorld))}(qe.isMeshPhongMaterial||qe.isMeshToonMaterial||qe.isMeshLambertMaterial||qe.isMeshBasicMaterial||qe.isMeshStandardMaterial||qe.isShaderMaterial)&&ne.setValue(re,"isOrthographic",ye.isOrthographicCamera===!0),(qe.isMeshPhongMaterial||qe.isMeshToonMaterial||qe.isMeshLambertMaterial||qe.isMeshBasicMaterial||qe.isMeshStandardMaterial||qe.isShaderMaterial||qe.isShadowMaterial||gt.isSkinnedMesh)&&ne.setValue(re,"viewMatrix",ye.matrixWorldInverse)}if(gt.isSkinnedMesh){ne.setOptional(re,gt,"bindMatrix"),ne.setOptional(re,gt,"bindMatrixInverse");let me=gt.skeleton;me&&(ve.floatVertexTextures?(me.boneTexture===null&&me.computeBoneTexture(),ne.setValue(re,"boneTexture",me.boneTexture,ce),ne.setValue(re,"boneTextureSize",me.boneTextureSize)):console.warn("THREE.WebGLRenderer: SkinnedMesh can only be used with WebGL 2. With WebGL 1 OES_texture_float and vertex textures support is required."))}let _e=ht.morphAttributes;if((_e.position!==void 0||_e.normal!==void 0||_e.color!==void 0&&ve.isWebGL2===!0)&&te.update(gt,ht,qe,Vt),(si||ft.receiveShadow!==gt.receiveShadow)&&(ft.receiveShadow=gt.receiveShadow,ne.setValue(re,"receiveShadow",gt.receiveShadow)),qe.isMeshGouraudMaterial&&qe.envMap!==null&&(ae.envMap.value=fi,ae.flipEnvMap.value=fi.isCubeTexture&&fi.isRenderTargetTexture===!1?-1:1),si&&(ne.setValue(re,"toneMappingExposure",g.toneMappingExposure),ft.needsLights&&Nn(ae,Wt),Zt&&qe.fog===!0&&it.refreshFogUniforms(ae,Zt),it.refreshMaterialUniforms(ae,qe,k,I,Z),rI.upload(re,ft.uniformsList,ae,ce)),qe.isShaderMaterial&&qe.uniformsNeedUpdate===!0&&(rI.upload(re,ft.uniformsList,ae,ce),qe.uniformsNeedUpdate=!1),qe.isSpriteMaterial&&ne.setValue(re,"center",gt.center),ne.setValue(re,"modelViewMatrix",gt.modelViewMatrix),ne.setValue(re,"normalMatrix",gt.normalMatrix),ne.setValue(re,"modelMatrix",gt.matrixWorld),gt.previousModelViewMatrix&&ne.setValue(re,"previousModelViewMatrix",gt.previousModelViewMatrix),ye.previousProjectionMatrix&&ne.setValue(re,"previousProjectionMatrix",ye.previousProjectionMatrix),qe.isShaderMaterial||qe.isRawShaderMaterial){let me=qe.uniformsGroups;for(let Pe=0,Ze=me.length;Pe<Ze;Pe++)if(ve.isWebGL2){let Qi=me[Pe];dt.update(Qi,Vt),dt.bind(Qi,Vt)}else console.warn("THREE.WebGLRenderer: Uniform Buffer Objects can only be used with WebGL 2.")}return Vt}function Nn(ye,Xe){ye.ambientLightColor.needsUpdate=Xe,ye.lightProbe.needsUpdate=Xe,ye.directionalLights.needsUpdate=Xe,ye.directionalLightShadows.needsUpdate=Xe,ye.pointLights.needsUpdate=Xe,ye.pointLightShadows.needsUpdate=Xe,ye.spotLights.needsUpdate=Xe,ye.spotLightShadows.needsUpdate=Xe,ye.rectAreaLights.needsUpdate=Xe,ye.hemisphereLights.needsUpdate=Xe}function us(ye){return ye.isMeshLambertMaterial||ye.isMeshToonMaterial||ye.isMeshPhongMaterial||ye.isMeshStandardMaterial||ye.isShadowMaterial||ye.isShaderMaterial&&ye.lights===!0}this.getActiveCubeFace=function(){return y},this.getActiveMipmapLevel=function(){return b},this.getRenderTarget=function(){return w},this.setRenderTargetTextures=function(ye,Xe,ht){Ce.get(ye.texture).__webglTexture=Xe,Ce.get(ye.depthTexture).__webglTexture=ht;let qe=Ce.get(ye);qe.__hasExternalTextures=!0,qe.__hasExternalTextures&&(qe.__autoAllocateDepthBuffer=ht===void 0,qe.__autoAllocateDepthBuffer||he.has("WEBGL_multisampled_render_to_texture")===!0&&(console.warn("THREE.WebGLRenderer: Render-to-texture extension was disabled because an external texture was provided"),qe.__useRenderToTexture=!1))},this.setRenderTargetFramebuffer=function(ye,Xe){let ht=Ce.get(ye);ht.__webglFramebuffer=Xe,ht.__useDefaultFramebuffer=Xe===void 0},this.setRenderTarget=function(ye,Xe=0,ht=0){w=ye,y=Xe,b=ht;let qe=!0,gt=null,Zt=!1,yi=!1;if(ye){let Ti=Ce.get(ye);Ti.__useDefaultFramebuffer!==void 0?(xe.bindFramebuffer(36160,null),qe=!1):Ti.__webglFramebuffer===void 0?ce.setupRenderTarget(ye):Ti.__hasExternalTextures&&ce.rebindTextures(ye,Ce.get(ye.texture).__webglTexture,Ce.get(ye.depthTexture).__webglTexture);let fi=ye.texture;(fi.isData3DTexture||fi.isDataArrayTexture||fi.isCompressedArrayTexture)&&(yi=!0);let vr=Ce.get(ye).__webglFramebuffer;ye.isWebGLCubeRenderTarget?(gt=vr[Xe],Zt=!0):ve.isWebGL2&&ye.samples>0&&ce.useMultisampledRTT(ye)===!1?gt=Ce.get(ye).__webglMultisampledFramebuffer:gt=vr,A.copy(ye.viewport),P.copy(ye.scissor),C=ye.scissorTest}else A.copy(F).multiplyScalar(k).floor(),P.copy($).multiplyScalar(k).floor(),C=K;if(xe.bindFramebuffer(36160,gt)&&ve.drawBuffers&&qe&&xe.drawBuffers(ye,gt),xe.viewport(A),xe.scissor(P),xe.setScissorTest(C),Zt){let Ti=Ce.get(ye.texture);re.framebufferTexture2D(36160,36064,34069+Xe,Ti.__webglTexture,ht)}else if(yi){let Ti=Ce.get(ye.texture),fi=Xe||0;re.framebufferTextureLayer(36160,36064,Ti.__webglTexture,ht||0,fi)}E=-1},this.readRenderTargetPixels=function(ye,Xe,ht,qe,gt,Zt,yi){if(!(ye&&ye.isWebGLRenderTarget)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");return}let Ti=Ce.get(ye).__webglFramebuffer;if(ye.isWebGLCubeRenderTarget&&yi!==void 0&&(Ti=Ti[yi]),Ti){xe.bindFramebuffer(36160,Ti);try{let fi=ye.texture,vr=fi.format,ji=fi.type;if(vr!==Vn&&at.convert(vr)!==re.getParameter(35739)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");return}let Vi=ji===qp&&(he.has("EXT_color_buffer_half_float")||ve.isWebGL2&&he.has("EXT_color_buffer_float"));if(ji!==Ho&&at.convert(ji)!==re.getParameter(35738)&&!(ji===cn&&(ve.isWebGL2||he.has("OES_texture_float")||he.has("WEBGL_color_buffer_float")))&&!Vi){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");return}Xe>=0&&Xe<=ye.width-qe&&ht>=0&&ht<=ye.height-gt&&re.readPixels(Xe,ht,qe,gt,at.convert(vr),at.convert(ji),Zt)}finally{let fi=w!==null?Ce.get(w).__webglFramebuffer:null;xe.bindFramebuffer(36160,fi)}}},this.readRenderTargetPixelsAsync=async function(ye,Xe,ht,qe,gt,Zt,yi){if(!(ye&&ye.isWebGLRenderTarget))throw new Error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let Ti=Ce.get(ye).__webglFramebuffer;if(ye.isWebGLCubeRenderTarget&&yi!==void 0&&(Ti=Ti[yi]),Ti){let fi=ye.texture,vr=fi.format,ji=fi.type;if(Xe>=0&&Xe<=ye.width-qe&&ht>=0&&ht<=ye.height-gt){xe.bindFramebuffer(re.FRAMEBUFFER,Ti);let Vi=re.createBuffer();re.bindBuffer(re.PIXEL_PACK_BUFFER,Vi),re.bufferData(re.PIXEL_PACK_BUFFER,Zt.byteLength,re.STREAM_READ),re.readPixels(Xe,ht,qe,gt,at.convert(vr),at.convert(ji),0);let de=w!==null?Ce.get(w).__webglFramebuffer:null;xe.bindFramebuffer(re.FRAMEBUFFER,de);let Ue=re.fenceSync(re.SYNC_GPU_COMMANDS_COMPLETE,0);return re.flush(),await J6e(re,Ue,4),re.bindBuffer(re.PIXEL_PACK_BUFFER,Vi),re.getBufferSubData(re.PIXEL_PACK_BUFFER,0,Zt),re.deleteBuffer(Vi),re.deleteSync(Ue),Zt}else throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: requested read bounds are out of range.")}},this.copyFramebufferToTexture=function(ye,Xe,ht=0){let qe=Math.pow(2,-ht),gt=Math.floor(Xe.image.width*qe),Zt=Math.floor(Xe.image.height*qe);ce.setTexture2D(Xe,0),re.copyTexSubImage2D(3553,ht,0,0,ye.x,ye.y,gt,Zt),xe.unbindTexture()},this.copyTextureToTexture=function(ye,Xe,ht,qe=0){let gt=Xe.image.width,Zt=Xe.image.height,yi=at.convert(ht.format),Ti=at.convert(ht.type);ce.setTexture2D(ht,0),re.pixelStorei(37440,ht.flipY),re.pixelStorei(37441,ht.premultiplyAlpha),re.pixelStorei(3317,ht.unpackAlignment),Xe.isDataTexture?re.texSubImage2D(3553,qe,ye.x,ye.y,gt,Zt,yi,Ti,Xe.image.data):Xe.isCompressedTexture?re.compressedTexSubImage2D(3553,qe,ye.x,ye.y,Xe.mipmaps[0].width,Xe.mipmaps[0].height,yi,Xe.mipmaps[0].data):re.texSubImage2D(3553,qe,ye.x,ye.y,yi,Ti,Xe.image),qe===0&&ht.generateMipmaps&&re.generateMipmap(3553),xe.unbindTexture()},this.copyTextureToTexture3D=function(ye,Xe,ht,qe,gt=0){if(g.isWebGL1Renderer){console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: can only be used with WebGL2.");return}let Zt=ye.max.x-ye.min.x+1,yi=ye.max.y-ye.min.y+1,Ti=ye.max.z-ye.min.z+1,fi=at.convert(qe.format),vr=at.convert(qe.type),ji;if(qe.isData3DTexture)ce.setTexture3D(qe,0),ji=32879;else if(qe.isDataArrayTexture)ce.setTexture2DArray(qe,0),ji=35866;else{console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");return}re.pixelStorei(37440,qe.flipY),re.pixelStorei(37441,qe.premultiplyAlpha),re.pixelStorei(3317,qe.unpackAlignment);let Vi=re.getParameter(3314),de=re.getParameter(32878),Ue=re.getParameter(3316),Je=re.getParameter(3315),nt=re.getParameter(32877),Ie=ht.isCompressedTexture?ht.mipmaps[0]:ht.image;re.pixelStorei(3314,Ie.width),re.pixelStorei(32878,Ie.height),re.pixelStorei(3316,ye.min.x),re.pixelStorei(3315,ye.min.y),re.pixelStorei(32877,ye.min.z),ht.isDataTexture||ht.isData3DTexture?re.texSubImage3D(ji,gt,Xe.x,Xe.y,Xe.z,Zt,yi,Ti,fi,vr,Ie.data):ht.isCompressedArrayTexture?(console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: untested support for compressed srcTexture."),re.compressedTexSubImage3D(ji,gt,Xe.x,Xe.y,Xe.z,Zt,yi,Ti,fi,Ie.data)):re.texSubImage3D(ji,gt,Xe.x,Xe.y,Xe.z,Zt,yi,Ti,fi,vr,Ie),re.pixelStorei(3314,Vi),re.pixelStorei(32878,de),re.pixelStorei(3316,Ue),re.pixelStorei(3315,Je),re.pixelStorei(32877,nt),gt===0&&qe.generateMipmaps&&re.generateMipmap(ji),xe.unbindTexture()},this.initRenderTarget=function(ye){Ce.get(ye).__webglFramebuffer===void 0&&ce.setupRenderTarget(ye)},this.initTexture=function(ye){ye.isCubeTexture?ce.setTextureCube(ye,0):ye.isData3DTexture?ce.setTexture3D(ye,0):ye.isDataArrayTexture||ye.isCompressedArrayTexture?ce.setTexture2DArray(ye,0):ce.setTexture2D(ye,0),xe.unbindTexture()},this.resetState=function(){y=0,b=0,w=null,xe.reset(),Te.reset()},typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}var Y9e=class extends whe{};Y9e.prototype.isWebGL1Renderer=!0;var _he=class{constructor(t,e=1,i=1e3){this.isFog=!0,this.name="",this.color=new Ai(t),this.near=e,this.far=i}clone(){return new _he(this.color,this.near,this.far)}toJSON(){return{type:"Fog",color:this.color.getHex(),near:this.near,far:this.far}}},ac=class extends tn{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.backgroundBlurriness=0,this.backgroundIntensity=1,this.overrideMaterial=null,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(t,e){return super.copy(t,e),t.background!==null&&(this.background=t.background.clone()),t.environment!==null&&(this.environment=t.environment.clone()),t.fog!==null&&(this.fog=t.fog.clone()),this.backgroundBlurriness=t.backgroundBlurriness,this.backgroundIntensity=t.backgroundIntensity,t.overrideMaterial!==null&&(this.overrideMaterial=t.overrideMaterial.clone()),this.matrixAutoUpdate=t.matrixAutoUpdate,this}toJSON(t){let e=super.toJSON(t);return this.fog!==null&&(e.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(e.object.backgroundBlurriness=this.backgroundBlurriness),this.backgroundIntensity!==1&&(e.object.backgroundIntensity=this.backgroundIntensity),e}get autoUpdate(){return console.warn("THREE.Scene: autoUpdate was renamed to matrixWorldAutoUpdate in r144."),this.matrixWorldAutoUpdate}set autoUpdate(t){console.warn("THREE.Scene: autoUpdate was renamed to matrixWorldAutoUpdate in r144."),this.matrixWorldAutoUpdate=t}},K9e=class{constructor(t,e){this.isInterleavedBuffer=!0,this.array=t,this.stride=e,this.count=t!==void 0?t.length/e:0,this.usage=Sj,this.updateRange={offset:0,count:-1},this.version=0,this.uuid=yu()}onUploadCallback(){}set needsUpdate(t){t===!0&&this.version++}setUsage(t){return this.usage=t,this}copy(t){return this.array=new t.array.constructor(t.array),this.count=t.count,this.stride=t.stride,this.usage=t.usage,this}copyAt(t,e,i){t*=this.stride,i*=e.stride;for(let r=0,n=this.stride;r<n;r++)this.array[t+r]=e.array[i+r];return this}set(t,e=0){return this.array.set(t,e),this}clone(t){t.arrayBuffers===void 0&&(t.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=yu()),t.arrayBuffers[this.array.buffer._uuid]===void 0&&(t.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);let e=new this.array.constructor(t.arrayBuffers[this.array.buffer._uuid]),i=new this.constructor(e,this.stride);return i.setUsage(this.usage),i}onUpload(t){return this.onUploadCallback=t,this}toJSON(t){return t.arrayBuffers===void 0&&(t.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=yu()),t.arrayBuffers[this.array.buffer._uuid]===void 0&&(t.arrayBuffers[this.array.buffer._uuid]=Array.from(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}},al=new W,Cj=class{constructor(t,e,i,r=!1){this.isInterleavedBufferAttribute=!0,this.name="",this.data=t,this.itemSize=e,this.offset=i,this.normalized=r}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(t){this.data.needsUpdate=t}applyMatrix4(t){for(let e=0,i=this.data.count;e<i;e++)al.fromBufferAttribute(this,e),al.applyMatrix4(t),this.setXYZ(e,al.x,al.y,al.z);return this}applyNormalMatrix(t){for(let e=0,i=this.count;e<i;e++)al.fromBufferAttribute(this,e),al.applyNormalMatrix(t),this.setXYZ(e,al.x,al.y,al.z);return this}transformDirection(t){for(let e=0,i=this.count;e<i;e++)al.fromBufferAttribute(this,e),al.transformDirection(t),this.setXYZ(e,al.x,al.y,al.z);return this}setX(t,e){return this.normalized&&(e=Sn(e,this.array)),this.data.array[t*this.data.stride+this.offset]=e,this}setY(t,e){return this.normalized&&(e=Sn(e,this.array)),this.data.array[t*this.data.stride+this.offset+1]=e,this}setZ(t,e){return this.normalized&&(e=Sn(e,this.array)),this.data.array[t*this.data.stride+this.offset+2]=e,this}setW(t,e){return this.normalized&&(e=Sn(e,this.array)),this.data.array[t*this.data.stride+this.offset+3]=e,this}getX(t){let e=this.data.array[t*this.data.stride+this.offset];return this.normalized&&(e=Mp(e,this.array)),e}getY(t){let e=this.data.array[t*this.data.stride+this.offset+1];return this.normalized&&(e=Mp(e,this.array)),e}getZ(t){let e=this.data.array[t*this.data.stride+this.offset+2];return this.normalized&&(e=Mp(e,this.array)),e}getW(t){let e=this.data.array[t*this.data.stride+this.offset+3];return this.normalized&&(e=Mp(e,this.array)),e}setXY(t,e,i){return t=t*this.data.stride+this.offset,this.normalized&&(e=Sn(e,this.array),i=Sn(i,this.array)),this.data.array[t+0]=e,this.data.array[t+1]=i,this}setXYZ(t,e,i,r){return t=t*this.data.stride+this.offset,this.normalized&&(e=Sn(e,this.array),i=Sn(i,this.array),r=Sn(r,this.array)),this.data.array[t+0]=e,this.data.array[t+1]=i,this.data.array[t+2]=r,this}setXYZW(t,e,i,r,n){return t=t*this.data.stride+this.offset,this.normalized&&(e=Sn(e,this.array),i=Sn(i,this.array),r=Sn(r,this.array),n=Sn(n,this.array)),this.data.array[t+0]=e,this.data.array[t+1]=i,this.data.array[t+2]=r,this.data.array[t+3]=n,this}clone(t){if(t===void 0){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interleaved buffer attribute will de-interleave buffer data.");let e=[];for(let i=0;i<this.count;i++){let r=i*this.data.stride+this.offset;for(let n=0;n<this.itemSize;n++)e.push(this.data.array[r+n])}return new Mi(new this.array.constructor(e),this.itemSize,this.normalized)}else return t.interleavedBuffers===void 0&&(t.interleavedBuffers={}),t.interleavedBuffers[this.data.uuid]===void 0&&(t.interleavedBuffers[this.data.uuid]=this.data.clone(t)),new Cj(t.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(t){if(t===void 0){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interleaved buffer attribute will de-interleave buffer data.");let e=[];for(let i=0;i<this.count;i++){let r=i*this.data.stride+this.offset;for(let n=0;n<this.itemSize;n++)e.push(this.data.array[r+n])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:e,normalized:this.normalized}}else return t.interleavedBuffers===void 0&&(t.interleavedBuffers={}),t.interleavedBuffers[this.data.uuid]===void 0&&(t.interleavedBuffers[this.data.uuid]=this.data.toJSON(t)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}},She=class extends tn{constructor(){super(),this.isBone=!0,this.type="Bone"}},yl=class extends Kn{constructor(t=null,e=1,i=1,r,n,s,a,o,l=mr,c=mr,u,h){super(null,s,a,o,l,c,r,n,u,h),this.isDataTexture=!0,this.image={data:t,width:e,height:i},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}},ZZ=new St,Z9e=new St,$H=class{constructor(t=[],e=[]){this.uuid=yu(),this.bones=t.slice(0),this.boneInverses=e,this.boneMatrices=null,this.boneTexture=null,this.boneTextureSize=0,this.frame=-1,this.init()}init(){let t=this.bones,e=this.boneInverses;if(this.boneMatrices=new Float32Array(t.length*16),e.length===0)this.calculateInverses();else if(t.length!==e.length){console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let i=0,r=this.bones.length;i<r;i++)this.boneInverses.push(new St)}}calculateInverses(){this.boneInverses.length=0;for(let t=0,e=this.bones.length;t<e;t++){let i=new St;this.bones[t]&&i.copy(this.bones[t].matrixWorld).invert(),this.boneInverses.push(i)}}pose(){for(let t=0,e=this.bones.length;t<e;t++){let i=this.bones[t];i&&i.matrixWorld.copy(this.boneInverses[t]).invert()}for(let t=0,e=this.bones.length;t<e;t++){let i=this.bones[t];i&&(i.parent&&i.parent.isBone?(i.matrix.copy(i.parent.matrixWorld).invert(),i.matrix.multiply(i.matrixWorld)):i.matrix.copy(i.matrixWorld),i.matrix.decompose(i.position,i.quaternion,i.scale))}}update(){let t=this.bones,e=this.boneInverses,i=this.boneMatrices,r=this.boneTexture;for(let n=0,s=t.length;n<s;n++){let a=t[n]?t[n].matrixWorld:Z9e;ZZ.multiplyMatrices(a,e[n]),ZZ.toArray(i,n*16)}r!==null&&(r.needsUpdate=!0)}clone(){return new $H(this.bones,this.boneInverses)}computeBoneTexture(){let t=Math.sqrt(this.bones.length*4);t=ahe(t),t=Math.max(t,4);let e=new Float32Array(t*t*4);e.set(this.boneMatrices);let i=new yl(e,t,t,Vn,cn);return i.needsUpdate=!0,this.boneMatrices=e,this.boneTexture=i,this.boneTextureSize=t,this}getBoneByName(t){for(let e=0,i=this.bones.length;e<i;e++){let r=this.bones[e];if(r.name===t)return r}}dispose(){this.boneTexture!==null&&(this.boneTexture.dispose(),this.boneTexture=null)}fromJSON(t,e){this.uuid=t.uuid;for(let i=0,r=t.bones.length;i<r;i++){let n=t.bones[i],s=e[n];s===void 0&&(console.warn("THREE.Skeleton: No bone found with UUID:",n),s=new She),this.bones.push(s),this.boneInverses.push(new St().fromArray(t.boneInverses[i]))}return this.init(),this}toJSON(){let t={metadata:{version:4.5,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};t.uuid=this.uuid;let e=this.bones,i=this.boneInverses;for(let r=0,n=e.length;r<n;r++){let s=e[r];t.bones.push(s.uuid);let a=i[r];t.boneInverses.push(a.toArray())}return t}},PM=class extends Mi{constructor(t,e,i,r=1){super(t,e,i),this.isInstancedBufferAttribute=!0,this.meshPerAttribute=r}copy(t){return super.copy(t),this.meshPerAttribute=t.meshPerAttribute,this}toJSON(){let t=super.toJSON();return t.meshPerAttribute=this.meshPerAttribute,t.isInstancedBufferAttribute=!0,t}},QZ=new St,JZ=new St,DP=[],Q9e=new St,hE=new En,J9e=class extends En{constructor(t,e,i){super(t,e),this.isInstancedMesh=!0,this.instanceMatrix=new PM(new Float32Array(i*16),16),this.instanceColor=null,this.count=i,this.frustumCulled=!1;for(let r=0;r<i;r++)this.setMatrixAt(r,Q9e)}copy(t,e){return super.copy(t,e),this.instanceMatrix.copy(t.instanceMatrix),t.instanceColor!==null&&(this.instanceColor=t.instanceColor.clone()),this.count=t.count,this}getColorAt(t,e){e.fromArray(this.instanceColor.array,t*3)}getMatrixAt(t,e){e.fromArray(this.instanceMatrix.array,t*16)}raycast(t,e){let i=this.matrixWorld,r=this.count;if(hE.geometry=this.geometry,hE.material=this.material,hE.material!==void 0)for(let n=0;n<r;n++){this.getMatrixAt(n,QZ),JZ.multiplyMatrices(i,QZ),hE.matrixWorld=JZ,hE.raycast(t,DP);for(let s=0,a=DP.length;s<a;s++){let o=DP[s];o.instanceId=n,o.object=this,e.push(o)}DP.length=0}}setColorAt(t,e){this.instanceColor===null&&(this.instanceColor=new PM(new Float32Array(this.instanceMatrix.count*3),3)),e.toArray(this.instanceColor.array,t*3)}setMatrixAt(t,e){e.toArray(this.instanceMatrix.array,t*16)}updateMorphTargets(){}dispose(){this.dispatchEvent({type:"dispose"})}},yv=class extends OT{constructor(t){super(),this.isLineBasicMaterial=!0,this.type="LineBasicMaterial",this.color=new Ai(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.linewidth=t.linewidth,this.linecap=t.linecap,this.linejoin=t.linejoin,this.fog=t.fog,this}},eQ=new W,tQ=new W,iQ=new St,aF=new E_,OP=new oc,GD=class extends tn{constructor(t=new oi,e=new yv){super(),this.isLine=!0,this.type="Line",this.geometry=t,this.material=e,this.updateMorphTargets()}copy(t,e){return super.copy(t,e),this.material=t.material,this.geometry=t.geometry,this}computeLineDistances(){let t=this.geometry;if(t.index===null){let e=t.attributes.position,i=[0];for(let r=1,n=e.count;r<n;r++)eQ.fromBufferAttribute(e,r-1),tQ.fromBufferAttribute(e,r),i[r]=i[r-1],i[r]+=eQ.distanceTo(tQ);t.setAttribute("lineDistance",new Gt(i,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}raycast(t,e){let i=this.geometry,r=this.matrixWorld,n=t.params.Line.threshold,s=i.drawRange;if(i.boundingSphere===null&&i.computeBoundingSphere(),OP.copy(i.boundingSphere),OP.applyMatrix4(r),OP.radius+=n,t.ray.intersectsSphere(OP)===!1)return;iQ.copy(r).invert(),aF.copy(t.ray).applyMatrix4(iQ);let a=n/((this.scale.x+this.scale.y+this.scale.z)/3),o=a*a,l=new W,c=new W,u=new W,h=new W,d=this.isLineSegments?2:1,f=i.index,p=i.attributes.position;if(f!==null){let g=Math.max(0,s.start),m=Math.min(f.count,s.start+s.count);for(let y=g,b=m-1;y<b;y+=d){let w=f.getX(y),E=f.getX(y+1);if(l.fromBufferAttribute(p,w),c.fromBufferAttribute(p,E),aF.distanceSqToSegment(l,c,h,u)>o)continue;h.applyMatrix4(this.matrixWorld);let M=t.ray.origin.distanceTo(h);M<t.near||M>t.far||e.push({distance:M,point:u.clone().applyMatrix4(this.matrixWorld),index:y,face:null,faceIndex:null,object:this})}}else{let g=Math.max(0,s.start),m=Math.min(p.count,s.start+s.count);for(let y=g,b=m-1;y<b;y+=d){if(l.fromBufferAttribute(p,y),c.fromBufferAttribute(p,y+1),aF.distanceSqToSegment(l,c,h,u)>o)continue;h.applyMatrix4(this.matrixWorld);let w=t.ray.origin.distanceTo(h);w<t.near||w>t.far||e.push({distance:w,point:u.clone().applyMatrix4(this.matrixWorld),index:y,face:null,faceIndex:null,object:this})}}}updateMorphTargets(){let t=this.geometry.morphAttributes,e=Object.keys(t);if(e.length>0){let i=t[e[0]];if(i!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let r=0,n=i.length;r<n;r++){let s=i[r].name||String(r);this.morphTargetInfluences.push(0),this.morphTargetDictionary[s]=r}}}}},rQ=new W,nQ=new W,LT=class extends GD{constructor(t,e){super(t,e),this.isLineSegments=!0,this.type="LineSegments"}computeLineDistances(){let t=this.geometry;if(t.index===null){let e=t.attributes.position,i=[];for(let r=0,n=e.count;r<n;r+=2)rQ.fromBufferAttribute(e,r),nQ.fromBufferAttribute(e,r+1),i[r]=r===0?0:i[r-1],i[r+1]=i[r]+rQ.distanceTo(nQ);t.setAttribute("lineDistance",new Gt(i,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}},e7e=class extends Kn{constructor(t,e,i,r,n,s,a,o,l){super(t,e,i,r,n,s,a,o,l),this.isVideoTexture=!0,this.minFilter=s!==void 0?s:nr,this.magFilter=n!==void 0?n:nr,this.generateMipmaps=!1;let c=this;function u(){c.needsUpdate=!0,t.requestVideoFrameCallback(u)}"requestVideoFrameCallback"in t&&t.requestVideoFrameCallback(u)}clone(){return new this.constructor(this.image).copy(this)}update(){let t=this.image;!("requestVideoFrameCallback"in t)&&t.readyState>=t.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}},t7e=class extends Kn{constructor(t,e,i,r,n,s,a,o,l){super(t,e,i,r,n,s,a,o,l),this.isCanvasTexture=!0,this.needsUpdate=!0}},cf=class{constructor(){this.type="Curve",this.arcLengthDivisions=200}getPoint(){return console.warn("THREE.Curve: .getPoint() not implemented."),null}getPointAt(t,e){let i=this.getUtoTmapping(t);return this.getPoint(i,e)}getPoints(t=5){let e=[];for(let i=0;i<=t;i++)e.push(this.getPoint(i/t));return e}getSpacedPoints(t=5){let e=[];for(let i=0;i<=t;i++)e.push(this.getPointAt(i/t));return e}getLength(){let t=this.getLengths();return t[t.length-1]}getLengths(t=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===t+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;let e=[],i,r=this.getPoint(0),n=0;e.push(0);for(let s=1;s<=t;s++)i=this.getPoint(s/t),n+=i.distanceTo(r),e.push(n),r=i;return this.cacheArcLengths=e,e}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(t,e){let i=this.getLengths(),r=0,n=i.length,s;e?s=e:s=t*i[n-1];let a=0,o=n-1,l;for(;a<=o;)if(r=Math.floor(a+(o-a)/2),l=i[r]-s,l<0)a=r+1;else if(l>0)o=r-1;else{o=r;break}if(r=o,i[r]===s)return r/(n-1);let c=i[r],u=i[r+1]-c,h=(s-c)/u;return(r+h)/(n-1)}getTangent(t,e){let i=t-1e-4,r=t+1e-4;i<0&&(i=0),r>1&&(r=1);let n=this.getPoint(i),s=this.getPoint(r),a=e||(n.isVector2?new Ae:new W);return a.copy(s).sub(n).normalize(),a}getTangentAt(t,e){let i=this.getUtoTmapping(t);return this.getTangent(i,e)}computeFrenetFrames(t,e){let i=new W,r=[],n=[],s=[],a=new W,o=new St;for(let d=0;d<=t;d++){let f=d/t;r[d]=this.getTangentAt(f,new W)}n[0]=new W,s[0]=new W;let l=Number.MAX_VALUE,c=Math.abs(r[0].x),u=Math.abs(r[0].y),h=Math.abs(r[0].z);c<=l&&(l=c,i.set(1,0,0)),u<=l&&(l=u,i.set(0,1,0)),h<=l&&i.set(0,0,1),a.crossVectors(r[0],i).normalize(),n[0].crossVectors(r[0],a),s[0].crossVectors(r[0],n[0]);for(let d=1;d<=t;d++){if(n[d]=n[d-1].clone(),s[d]=s[d-1].clone(),a.crossVectors(r[d-1],r[d]),a.length()>Number.EPSILON){a.normalize();let f=Math.acos(Fs(r[d-1].dot(r[d]),-1,1));n[d].applyMatrix4(o.makeRotationAxis(a,f))}s[d].crossVectors(r[d],n[d])}if(e===!0){let d=Math.acos(Fs(n[0].dot(n[t]),-1,1));d/=t,r[0].dot(a.crossVectors(n[0],n[t]))>0&&(d=-d);for(let f=1;f<=t;f++)n[f].applyMatrix4(o.makeRotationAxis(r[f],d*f)),s[f].crossVectors(r[f],n[f])}return{tangents:r,normals:n,binormals:s}}clone(){return new this.constructor().copy(this)}copy(t){return this.arcLengthDivisions=t.arcLengthDivisions,this}toJSON(){let t={metadata:{version:4.5,type:"Curve",generator:"Curve.toJSON"}};return t.arcLengthDivisions=this.arcLengthDivisions,t.type=this.type,t}fromJSON(t){return this.arcLengthDivisions=t.arcLengthDivisions,this}},lL=class extends cf{constructor(t=0,e=0,i=1,r=1,n=0,s=Math.PI*2,a=!1,o=0){super(),this.isEllipseCurve=!0,this.type="EllipseCurve",this.aX=t,this.aY=e,this.xRadius=i,this.yRadius=r,this.aStartAngle=n,this.aEndAngle=s,this.aClockwise=a,this.aRotation=o}getPoint(t,e){let i=e||new Ae,r=Math.PI*2,n=this.aEndAngle-this.aStartAngle,s=Math.abs(n)<Number.EPSILON;for(;n<0;)n+=r;for(;n>r;)n-=r;n<Number.EPSILON&&(s?n=0:n=r),this.aClockwise===!0&&!s&&(n===r?n=-r:n=n-r);let a=this.aStartAngle+t*n,o=this.aX+this.xRadius*Math.cos(a),l=this.aY+this.yRadius*Math.sin(a);if(this.aRotation!==0){let c=Math.cos(this.aRotation),u=Math.sin(this.aRotation),h=o-this.aX,d=l-this.aY;o=h*c-d*u+this.aX,l=h*u+d*c+this.aY}return i.set(o,l)}copy(t){return super.copy(t),this.aX=t.aX,this.aY=t.aY,this.xRadius=t.xRadius,this.yRadius=t.yRadius,this.aStartAngle=t.aStartAngle,this.aEndAngle=t.aEndAngle,this.aClockwise=t.aClockwise,this.aRotation=t.aRotation,this}toJSON(){let t=super.toJSON();return t.aX=this.aX,t.aY=this.aY,t.xRadius=this.xRadius,t.yRadius=this.yRadius,t.aStartAngle=this.aStartAngle,t.aEndAngle=this.aEndAngle,t.aClockwise=this.aClockwise,t.aRotation=this.aRotation,t}fromJSON(t){return super.fromJSON(t),this.aX=t.aX,this.aY=t.aY,this.xRadius=t.xRadius,this.yRadius=t.yRadius,this.aStartAngle=t.aStartAngle,this.aEndAngle=t.aEndAngle,this.aClockwise=t.aClockwise,this.aRotation=t.aRotation,this}},i7e=class extends lL{constructor(t,e,i,r,n,s){super(t,e,i,i,r,n,s),this.isArcCurve=!0,this.type="ArcCurve"}};function YH(){let t=0,e=0,i=0,r=0;function n(s,a,o,l){t=s,e=o,i=-3*s+3*a-2*o-l,r=2*s-2*a+o+l}return{initCatmullRom:function(s,a,o,l,c){n(a,o,c*(o-s),c*(l-a))},initNonuniformCatmullRom:function(s,a,o,l,c,u,h){let d=(a-s)/c-(o-s)/(c+u)+(o-a)/u,f=(o-a)/u-(l-a)/(u+h)+(l-o)/h;d*=u,f*=u,n(a,o,d,f)},calc:function(s){let a=s*s,o=a*s;return t+e*s+i*a+r*o}}}var LP=new W,oF=new YH,lF=new YH,cF=new YH,r7e=class extends cf{constructor(t=[],e=!1,i="centripetal",r=.5){super(),this.isCatmullRomCurve3=!0,this.type="CatmullRomCurve3",this.points=t,this.closed=e,this.curveType=i,this.tension=r}getPoint(t,e=new W){let i=e,r=this.points,n=r.length,s=(n-(this.closed?0:1))*t,a=Math.floor(s),o=s-a;this.closed?a+=a>0?0:(Math.floor(Math.abs(a)/n)+1)*n:o===0&&a===n-1&&(a=n-2,o=1);let l,c;this.closed||a>0?l=r[(a-1)%n]:(LP.subVectors(r[0],r[1]).add(r[0]),l=LP);let u=r[a%n],h=r[(a+1)%n];if(this.closed||a+2<n?c=r[(a+2)%n]:(LP.subVectors(r[n-1],r[n-2]).add(r[n-1]),c=LP),this.curveType==="centripetal"||this.curveType==="chordal"){let d=this.curveType==="chordal"?.5:.25,f=Math.pow(l.distanceToSquared(u),d),p=Math.pow(u.distanceToSquared(h),d),g=Math.pow(h.distanceToSquared(c),d);p<1e-4&&(p=1),f<1e-4&&(f=p),g<1e-4&&(g=p),oF.initNonuniformCatmullRom(l.x,u.x,h.x,c.x,f,p,g),lF.initNonuniformCatmullRom(l.y,u.y,h.y,c.y,f,p,g),cF.initNonuniformCatmullRom(l.z,u.z,h.z,c.z,f,p,g)}else this.curveType==="catmullrom"&&(oF.initCatmullRom(l.x,u.x,h.x,c.x,this.tension),lF.initCatmullRom(l.y,u.y,h.y,c.y,this.tension),cF.initCatmullRom(l.z,u.z,h.z,c.z,this.tension));return i.set(oF.calc(o),lF.calc(o),cF.calc(o)),i}copy(t){super.copy(t),this.points=[];for(let e=0,i=t.points.length;e<i;e++){let r=t.points[e];this.points.push(r.clone())}return this.closed=t.closed,this.curveType=t.curveType,this.tension=t.tension,this}toJSON(){let t=super.toJSON();t.points=[];for(let e=0,i=this.points.length;e<i;e++){let r=this.points[e];t.points.push(r.toArray())}return t.closed=this.closed,t.curveType=this.curveType,t.tension=this.tension,t}fromJSON(t){super.fromJSON(t),this.points=[];for(let e=0,i=t.points.length;e<i;e++){let r=t.points[e];this.points.push(new W().fromArray(r))}return this.closed=t.closed,this.curveType=t.curveType,this.tension=t.tension,this}};function sQ(t,e,i,r,n){let s=(r-e)*.5,a=(n-i)*.5,o=t*t,l=t*o;return(2*i-2*r+s+a)*l+(-3*i+3*r-2*s-a)*o+s*t+i}function n7e(t,e){let i=1-t;return i*i*e}function s7e(t,e){return 2*(1-t)*t*e}function a7e(t,e){return t*t*e}function CA(t,e,i,r){return n7e(t,e)+s7e(t,i)+a7e(t,r)}function o7e(t,e){let i=1-t;return i*i*i*e}function l7e(t,e){let i=1-t;return 3*i*i*t*e}function c7e(t,e){return 3*(1-t)*t*t*e}function u7e(t,e){return t*t*t*e}function PA(t,e,i,r,n){return o7e(t,e)+l7e(t,i)+c7e(t,r)+u7e(t,n)}var bh=class extends cf{constructor(t=new Ae,e=new Ae,i=new Ae,r=new Ae){super(),this.isCubicBezierCurve=!0,this.type="CubicBezierCurve",this.v0=t,this.v1=e,this.v2=i,this.v3=r}getPoint(t,e=new Ae){let i=e,r=this.v0,n=this.v1,s=this.v2,a=this.v3;return i.set(PA(t,r.x,n.x,s.x,a.x),PA(t,r.y,n.y,s.y,a.y)),i}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this.v3.copy(t.v3),this}toJSON(){let t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t.v3=this.v3.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this.v3.fromArray(t.v3),this}},nI=class extends cf{constructor(t=new W,e=new W,i=new W,r=new W){super(),this.isCubicBezierCurve3=!0,this.type="CubicBezierCurve3",this.v0=t,this.v1=e,this.v2=i,this.v3=r}getPoint(t,e=new W){let i=e,r=this.v0,n=this.v1,s=this.v2,a=this.v3;return i.set(PA(t,r.x,n.x,s.x,a.x),PA(t,r.y,n.y,s.y,a.y),PA(t,r.z,n.z,s.z,a.z)),i}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this.v3.copy(t.v3),this}toJSON(){let t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t.v3=this.v3.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this.v3.fromArray(t.v3),this}},Eh=class extends cf{constructor(t=new Ae,e=new Ae){super(),this.isLineCurve=!0,this.type="LineCurve",this.v1=t,this.v2=e}getPoint(t,e=new Ae){let i=e;return t===1?i.copy(this.v2):(i.copy(this.v2).sub(this.v1),i.multiplyScalar(t).add(this.v1)),i}getPointAt(t,e){return this.getPoint(t,e)}getTangent(t,e){let i=e||new Ae;return i.copy(this.v2).sub(this.v1).normalize(),i}copy(t){return super.copy(t),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){let t=super.toJSON();return t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}},Ehe=class extends cf{constructor(t=new W,e=new W){super(),this.isLineCurve3=!0,this.type="LineCurve3",this.v1=t,this.v2=e}getPoint(t,e=new W){let i=e;return t===1?i.copy(this.v2):(i.copy(this.v2).sub(this.v1),i.multiplyScalar(t).add(this.v1)),i}getPointAt(t,e){return this.getPoint(t,e)}copy(t){return super.copy(t),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){let t=super.toJSON();return t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}},rv=class extends cf{constructor(t=new Ae,e=new Ae,i=new Ae){super(),this.isQuadraticBezierCurve=!0,this.type="QuadraticBezierCurve",this.v0=t,this.v1=e,this.v2=i}getPoint(t,e=new Ae){let i=e,r=this.v0,n=this.v1,s=this.v2;return i.set(CA(t,r.x,n.x,s.x),CA(t,r.y,n.y,s.y)),i}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){let t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}},h7e=class extends cf{constructor(t=new W,e=new W,i=new W){super(),this.isQuadraticBezierCurve3=!0,this.type="QuadraticBezierCurve3",this.v0=t,this.v1=e,this.v2=i}getPoint(t,e=new W){let i=e,r=this.v0,n=this.v1,s=this.v2;return i.set(CA(t,r.x,n.x,s.x),CA(t,r.y,n.y,s.y),CA(t,r.z,n.z,s.z)),i}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){let t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}},KH=class extends cf{constructor(t=[]){super(),this.isSplineCurve=!0,this.type="SplineCurve",this.points=t}getPoint(t,e=new Ae){let i=e,r=this.points,n=(r.length-1)*t,s=Math.floor(n),a=n-s,o=r[s===0?s:s-1],l=r[s],c=r[s>r.length-2?r.length-1:s+1],u=r[s>r.length-3?r.length-1:s+2];return i.set(sQ(a,o.x,l.x,c.x,u.x),sQ(a,o.y,l.y,c.y,u.y)),i}copy(t){super.copy(t),this.points=[];for(let e=0,i=t.points.length;e<i;e++){let r=t.points[e];this.points.push(r.clone())}return this}toJSON(){let t=super.toJSON();t.points=[];for(let e=0,i=this.points.length;e<i;e++){let r=this.points[e];t.points.push(r.toArray())}return t}fromJSON(t){super.fromJSON(t),this.points=[];for(let e=0,i=t.points.length;e<i;e++){let r=t.points[e];this.points.push(new Ae().fromArray(r))}return this}},d7e=Object.freeze({__proto__:null,ArcCurve:i7e,CatmullRomCurve3:r7e,CubicBezierCurve:bh,CubicBezierCurve3:nI,EllipseCurve:lL,LineCurve:Eh,LineCurve3:Ehe,QuadraticBezierCurve:rv,QuadraticBezierCurve3:h7e,SplineCurve:KH}),Ahe=class extends cf{constructor(){super(),this.type="CurvePath",this.curves=[],this.autoClose=!1}add(t){this.curves.push(t)}closePath(){let t=this.curves[0].getPoint(0),e=this.curves[this.curves.length-1].getPoint(1);t.equals(e)||this.curves.push(new Eh(e,t))}getPoint(t,e){let i=t*this.getLength(),r=this.getCurveLengths(),n=0;for(;n<r.length;){if(r[n]>=i){let s=r[n]-i,a=this.curves[n],o=a.getLength(),l=o===0?0:1-s/o;return a.getPointAt(l,e)}n++}return null}getLength(){let t=this.getCurveLengths();return t[t.length-1]}updateArcLengths(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;let t=[],e=0;for(let i=0,r=this.curves.length;i<r;i++)e+=this.curves[i].getLength(),t.push(e);return this.cacheLengths=t,t}getSpacedPoints(t=40){let e=[];for(let i=0;i<=t;i++)e.push(this.getPoint(i/t));return this.autoClose&&e.push(e[0]),e}getPoints(t=12){let e=[],i;for(let r=0,n=this.curves;r<n.length;r++){let s=n[r],a=s.isEllipseCurve?t*2:s.isLineCurve||s.isLineCurve3?1:s.isSplineCurve?t*s.points.length:t,o=s.getPoints(a);for(let l=0;l<o.length;l++){let c=o[l];i&&i.equals(c)||(e.push(c),i=c)}}return this.autoClose&&e.length>1&&!e[e.length-1].equals(e[0])&&e.push(e[0]),e}copy(t){super.copy(t),this.curves=[];for(let e=0,i=t.curves.length;e<i;e++){let r=t.curves[e];this.curves.push(r.clone())}return this.autoClose=t.autoClose,this}toJSON(){let t=super.toJSON();t.autoClose=this.autoClose,t.curves=[];for(let e=0,i=this.curves.length;e<i;e++){let r=this.curves[e];t.curves.push(r.toJSON())}return t}fromJSON(t){super.fromJSON(t),this.autoClose=t.autoClose,this.curves=[];for(let e=0,i=t.curves.length;e<i;e++){let r=t.curves[e];this.curves.push(new d7e[r.type]().fromJSON(r))}return this}},WD=class extends Ahe{constructor(t){super(),this.type="Path",this.currentPoint=new Ae,t&&this.setFromPoints(t)}setFromPoints(t){this.moveTo(t[0].x,t[0].y);for(let e=1,i=t.length;e<i;e++)this.lineTo(t[e].x,t[e].y);return this}moveTo(t,e){return this.currentPoint.set(t,e),this}lineTo(t,e){let i=new Eh(this.currentPoint.clone(),new Ae(t,e));return this.curves.push(i),this.currentPoint.set(t,e),this}quadraticCurveTo(t,e,i,r){let n=new rv(this.currentPoint.clone(),new Ae(t,e),new Ae(i,r));return this.curves.push(n),this.currentPoint.set(i,r),this}bezierCurveTo(t,e,i,r,n,s){let a=new bh(this.currentPoint.clone(),new Ae(t,e),new Ae(i,r),new Ae(n,s));return this.curves.push(a),this.currentPoint.set(n,s),this}splineThru(t){let e=[this.currentPoint.clone()].concat(t),i=new KH(e);return this.curves.push(i),this.currentPoint.copy(t[t.length-1]),this}arc(t,e,i,r,n,s){let a=this.currentPoint.x,o=this.currentPoint.y;return this.absarc(t+a,e+o,i,r,n,s),this}absarc(t,e,i,r,n,s){return this.absellipse(t,e,i,i,r,n,s),this}ellipse(t,e,i,r,n,s,a,o){let l=this.currentPoint.x,c=this.currentPoint.y;return this.absellipse(t+l,e+c,i,r,n,s,a,o),this}absellipse(t,e,i,r,n,s,a,o){let l=new lL(t,e,i,r,n,s,a,o);if(this.curves.length>0){let u=l.getPoint(0);u.equals(this.currentPoint)||this.lineTo(u.x,u.y)}this.curves.push(l);let c=l.getPoint(1);return this.currentPoint.copy(c),this}copy(t){return super.copy(t),this.currentPoint.copy(t.currentPoint),this}toJSON(){let t=super.toJSON();return t.currentPoint=this.currentPoint.toArray(),t}fromJSON(t){return super.fromJSON(t),this.currentPoint.fromArray(t.currentPoint),this}},Mhe=class extends oi{constructor(t=[new Ae(0,-.5),new Ae(.5,0),new Ae(0,.5)],e=12,i=0,r=Math.PI*2){super(),this.type="LatheGeometry",this.parameters={points:t,segments:e,phiStart:i,phiLength:r},e=Math.floor(e),r=Fs(r,0,Math.PI*2);let n=[],s=[],a=[],o=[],l=[],c=1/e,u=new W,h=new Ae,d=new W,f=new W,p=new W,g=0,m=0;for(let y=0;y<=t.length-1;y++)switch(y){case 0:g=t[y+1].x-t[y].x,m=t[y+1].y-t[y].y,d.x=m*1,d.y=-g,d.z=m*0,p.copy(d),d.normalize(),o.push(d.x,d.y,d.z);break;case t.length-1:o.push(p.x,p.y,p.z);break;default:g=t[y+1].x-t[y].x,m=t[y+1].y-t[y].y,d.x=m*1,d.y=-g,d.z=m*0,f.copy(d),d.x+=p.x,d.y+=p.y,d.z+=p.z,d.normalize(),o.push(d.x,d.y,d.z),p.copy(f)}for(let y=0;y<=e;y++){let b=i+y*c*r,w=Math.sin(b),E=Math.cos(b);for(let M=0;M<=t.length-1;M++){u.x=t[M].x*w,u.y=t[M].y,u.z=t[M].x*E,s.push(u.x,u.y,u.z),h.x=y/e,h.y=M/(t.length-1),a.push(h.x,h.y);let A=o[3*M+0]*w,P=o[3*M+1],C=o[3*M+0]*E;l.push(A,P,C)}}for(let y=0;y<e;y++)for(let b=0;b<t.length-1;b++){let w=b+y*t.length,E=w,M=w+t.length,A=w+t.length+1,P=w+1;n.push(E,M,P),n.push(A,P,M)}this.setIndex(n),this.setAttribute("position",new Gt(s,3)),this.setAttribute("uv",new Gt(a,2)),this.setAttribute("normal",new Gt(l,3))}static fromJSON(t){return new Mhe(t.points,t.segments,t.phiStart,t.phiLength)}},ZH=class extends oi{constructor(t=1,e=1,i=1,r=32,n=1,s=!1,a=0,o=Math.PI*2){super(),this.type="CylinderGeometry",this.parameters={radiusTop:t,radiusBottom:e,height:i,radialSegments:r,heightSegments:n,openEnded:s,thetaStart:a,thetaLength:o};let l=this;r=Math.floor(r),n=Math.floor(n);let c=[],u=[],h=[],d=[],f=0,p=[],g=i/2,m=0;y(),s===!1&&(t>0&&b(!0),e>0&&b(!1)),this.setIndex(c),this.setAttribute("position",new Gt(u,3)),this.setAttribute("normal",new Gt(h,3)),this.setAttribute("uv",new Gt(d,2));function y(){let w=new W,E=new W,M=0,A=(e-t)/i;for(let P=0;P<=n;P++){let C=[],R=P/n,I=R*(e-t)+t;for(let k=0;k<=r;k++){let z=k/r,V=z*o+a,F=Math.sin(V),$=Math.cos(V);E.x=I*F,E.y=-R*i+g,E.z=I*$,u.push(E.x,E.y,E.z),w.set(F,A,$).normalize(),h.push(w.x,w.y,w.z),d.push(z,1-R),C.push(f++)}p.push(C)}for(let P=0;P<r;P++)for(let C=0;C<n;C++){let R=p[C][P],I=p[C+1][P],k=p[C+1][P+1],z=p[C][P+1];c.push(R,I,z),c.push(I,k,z),M+=6}l.addGroup(m,M,0),m+=M}function b(w){let E=f,M=new Ae,A=new W,P=0,C=w===!0?t:e,R=w===!0?1:-1;for(let k=1;k<=r;k++)u.push(0,g*R,0),h.push(0,R,0),d.push(.5,.5),f++;let I=f;for(let k=0;k<=r;k++){let z=k/r*o+a,V=Math.cos(z),F=Math.sin(z);A.x=C*F,A.y=g*R,A.z=C*V,u.push(A.x,A.y,A.z),h.push(0,R,0),M.x=V*.5+.5,M.y=F*.5*R+.5,d.push(M.x,M.y),f++}for(let k=0;k<r;k++){let z=E+k,V=I+k;w===!0?c.push(V,V+1,z):c.push(V+1,V,z),P+=3}l.addGroup(m,P,w===!0?1:2),m+=P}}static fromJSON(t){return new ZH(t.radiusTop,t.radiusBottom,t.height,t.radialSegments,t.heightSegments,t.openEnded,t.thetaStart,t.thetaLength)}},QH=class extends ZH{constructor(t=1,e=1,i=32,r=1,n=!1,s=0,a=Math.PI*2){super(0,t,e,i,r,n,s,a),this.type="ConeGeometry",this.parameters={radius:t,height:e,radialSegments:i,heightSegments:r,openEnded:n,thetaStart:s,thetaLength:a}}static fromJSON(t){return new QH(t.radius,t.height,t.radialSegments,t.heightSegments,t.openEnded,t.thetaStart,t.thetaLength)}},JH=class extends oi{constructor(t=[],e=[],i=1,r=0){super(),this.type="PolyhedronGeometry",this.parameters={vertices:t,indices:e,radius:i,detail:r};let n=[],s=[];a(r),l(i),c(),this.setAttribute("position",new Gt(n,3)),this.setAttribute("normal",new Gt(n.slice(),3)),this.setAttribute("uv",new Gt(s,2)),r===0?this.computeVertexNormals():this.normalizeNormals();function a(y){let b=new W,w=new W,E=new W;for(let M=0;M<e.length;M+=3)d(e[M+0],b),d(e[M+1],w),d(e[M+2],E),o(b,w,E,y)}function o(y,b,w,E){let M=E+1,A=[];for(let P=0;P<=M;P++){A[P]=[];let C=y.clone().lerp(w,P/M),R=b.clone().lerp(w,P/M),I=M-P;for(let k=0;k<=I;k++)k===0&&P===M?A[P][k]=C:A[P][k]=C.clone().lerp(R,k/I)}for(let P=0;P<M;P++)for(let C=0;C<2*(M-P)-1;C++){let R=Math.floor(C/2);C%2===0?(h(A[P][R+1]),h(A[P+1][R]),h(A[P][R])):(h(A[P][R+1]),h(A[P+1][R+1]),h(A[P+1][R]))}}function l(y){let b=new W;for(let w=0;w<n.length;w+=3)b.x=n[w+0],b.y=n[w+1],b.z=n[w+2],b.normalize().multiplyScalar(y),n[w+0]=b.x,n[w+1]=b.y,n[w+2]=b.z}function c(){let y=new W;for(let b=0;b<n.length;b+=3){y.x=n[b+0],y.y=n[b+1],y.z=n[b+2];let w=g(y)/2/Math.PI+.5,E=m(y)/Math.PI+.5;s.push(w,1-E)}f(),u()}function u(){for(let y=0;y<s.length;y+=6){let b=s[y+0],w=s[y+2],E=s[y+4],M=Math.max(b,w,E),A=Math.min(b,w,E);M>.9&&A<.1&&(b<.2&&(s[y+0]+=1),w<.2&&(s[y+2]+=1),E<.2&&(s[y+4]+=1))}}function h(y){n.push(y.x,y.y,y.z)}function d(y,b){let w=y*3;b.x=t[w+0],b.y=t[w+1],b.z=t[w+2]}function f(){let y=new W,b=new W,w=new W,E=new W,M=new Ae,A=new Ae,P=new Ae;for(let C=0,R=0;C<n.length;C+=9,R+=6){y.set(n[C+0],n[C+1],n[C+2]),b.set(n[C+3],n[C+4],n[C+5]),w.set(n[C+6],n[C+7],n[C+8]),M.set(s[R+0],s[R+1]),A.set(s[R+2],s[R+3]),P.set(s[R+4],s[R+5]),E.copy(y).add(b).add(w).divideScalar(3);let I=g(E);p(M,R+0,y,I),p(A,R+2,b,I),p(P,R+4,w,I)}}function p(y,b,w,E){E<0&&y.x===1&&(s[b]=y.x-1),w.x===0&&w.z===0&&(s[b]=E/2/Math.PI+.5)}function g(y){return Math.atan2(y.z,-y.x)}function m(y){return Math.atan2(-y.y,Math.sqrt(y.x*y.x+y.z*y.z))}}static fromJSON(t){return new JH(t.vertices,t.indices,t.radius,t.details)}},The=class extends JH{constructor(t=1,e=0){let i=(1+Math.sqrt(5))/2,r=1/i,n=[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-r,-i,0,-r,i,0,r,-i,0,r,i,-r,-i,0,-r,i,0,r,-i,0,r,i,0,-i,0,-r,i,0,-r,-i,0,r,i,0,r],s=[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9];super(n,s,t,e),this.type="DodecahedronGeometry",this.parameters={radius:t,detail:e}}static fromJSON(t){return new The(t.radius,t.detail)}},qD=class extends WD{constructor(t){super(t),this.uuid=yu(),this.type="Shape",this.holes=[]}getPointsHoles(t){let e=[];for(let i=0,r=this.holes.length;i<r;i++)e[i]=this.holes[i].getPoints(t);return e}extractPoints(t){return{shape:this.getPoints(t),holes:this.getPointsHoles(t)}}copy(t){super.copy(t),this.holes=[];for(let e=0,i=t.holes.length;e<i;e++){let r=t.holes[e];this.holes.push(r.clone())}return this}toJSON(){let t=super.toJSON();t.uuid=this.uuid,t.holes=[];for(let e=0,i=this.holes.length;e<i;e++){let r=this.holes[e];t.holes.push(r.toJSON())}return t}fromJSON(t){super.fromJSON(t),this.uuid=t.uuid,this.holes=[];for(let e=0,i=t.holes.length;e<i;e++){let r=t.holes[e];this.holes.push(new WD().fromJSON(r))}return this}},f7e={triangulate:function(t,e,i=2){let r=e&&e.length,n=r?e[0]*i:t.length,s=Che(t,0,n,i,!0),a=[];if(!s||s.next===s.prev)return a;let o,l,c,u,h,d,f;if(r&&(s=y7e(t,e,s,i)),t.length>80*i){o=c=t[0],l=u=t[1];for(let p=i;p<n;p+=i)h=t[p],d=t[p+1],h<o&&(o=h),d<l&&(l=d),h>c&&(c=h),d>u&&(u=d);f=Math.max(c-o,u-l),f=f!==0?32767/f:0}return RM(s,a,i,o,l,f,0),a}};function Che(t,e,i,r,n){let s,a;if(n===P7e(t,e,i,r)>0)for(s=e;s<i;s+=r)a=aQ(s,t[s],t[s+1],a);else for(s=i-r;s>=e;s-=r)a=aQ(s,t[s],t[s+1],a);return a&&cL(a,a.next)&&(DM(a),a=a.next),a}function U0(t,e){if(!t)return t;e||(e=t);let i=t,r;do if(r=!1,!i.steiner&&(cL(i,i.next)||Yn(i.prev,i,i.next)===0)){if(DM(i),i=e=i.prev,i===i.next)break;r=!0}else i=i.next;while(r||i!==e);return e}function RM(t,e,i,r,n,s,a){if(!t)return;!a&&s&&S7e(t,r,n,s);let o=t,l,c;for(;t.prev!==t.next;){if(l=t.prev,c=t.next,s?m7e(t,r,n,s):p7e(t)){e.push(l.i/i|0),e.push(t.i/i|0),e.push(c.i/i|0),DM(t),t=c.next,o=c.next;continue}if(t=c,t===o){a?a===1?(t=g7e(U0(t),e,i),RM(t,e,i,r,n,s,2)):a===2&&v7e(t,e,i,r,n,s):RM(U0(t),e,i,r,n,s,1);break}}}function p7e(t){let e=t.prev,i=t,r=t.next;if(Yn(e,i,r)>=0)return!1;let n=e.x,s=i.x,a=r.x,o=e.y,l=i.y,c=r.y,u=n<s?n<a?n:a:s<a?s:a,h=o<l?o<c?o:c:l<c?l:c,d=n>s?n>a?n:a:s>a?s:a,f=o>l?o>c?o:c:l>c?l:c,p=r.next;for(;p!==e;){if(p.x>=u&&p.x<=d&&p.y>=h&&p.y<=f&&Kw(n,o,s,l,a,c,p.x,p.y)&&Yn(p.prev,p,p.next)>=0)return!1;p=p.next}return!0}function m7e(t,e,i,r){let n=t.prev,s=t,a=t.next;if(Yn(n,s,a)>=0)return!1;let o=n.x,l=s.x,c=a.x,u=n.y,h=s.y,d=a.y,f=o<l?o<c?o:c:l<c?l:c,p=u<h?u<d?u:d:h<d?h:d,g=o>l?o>c?o:c:l>c?l:c,m=u>h?u>d?u:d:h>d?h:d,y=Pj(f,p,e,i,r),b=Pj(g,m,e,i,r),w=t.prevZ,E=t.nextZ;for(;w&&w.z>=y&&E&&E.z<=b;){if(w.x>=f&&w.x<=g&&w.y>=p&&w.y<=m&&w!==n&&w!==a&&Kw(o,u,l,h,c,d,w.x,w.y)&&Yn(w.prev,w,w.next)>=0||(w=w.prevZ,E.x>=f&&E.x<=g&&E.y>=p&&E.y<=m&&E!==n&&E!==a&&Kw(o,u,l,h,c,d,E.x,E.y)&&Yn(E.prev,E,E.next)>=0))return!1;E=E.nextZ}for(;w&&w.z>=y;){if(w.x>=f&&w.x<=g&&w.y>=p&&w.y<=m&&w!==n&&w!==a&&Kw(o,u,l,h,c,d,w.x,w.y)&&Yn(w.prev,w,w.next)>=0)return!1;w=w.prevZ}for(;E&&E.z<=b;){if(E.x>=f&&E.x<=g&&E.y>=p&&E.y<=m&&E!==n&&E!==a&&Kw(o,u,l,h,c,d,E.x,E.y)&&Yn(E.prev,E,E.next)>=0)return!1;E=E.nextZ}return!0}function g7e(t,e,i){let r=t;do{let n=r.prev,s=r.next.next;!cL(n,s)&&Phe(n,r,r.next,s)&&IM(n,s)&&IM(s,n)&&(e.push(n.i/i|0),e.push(r.i/i|0),e.push(s.i/i|0),DM(r),DM(r.next),r=t=s),r=r.next}while(r!==t);return U0(r)}function v7e(t,e,i,r,n,s){let a=t;do{let o=a.next.next;for(;o!==a.prev;){if(a.i!==o.i&&M7e(a,o)){let l=Rhe(a,o);a=U0(a,a.next),l=U0(l,l.next),RM(a,e,i,r,n,s,0),RM(l,e,i,r,n,s,0);return}o=o.next}a=a.next}while(a!==t)}function y7e(t,e,i,r){let n=[],s,a,o,l,c;for(s=0,a=e.length;s<a;s++)o=e[s]*r,l=s<a-1?e[s+1]*r:t.length,c=Che(t,o,l,r,!1),c===c.next&&(c.steiner=!0),n.push(A7e(c));for(n.sort(x7e),s=0;s<n.length;s++)i=b7e(n[s],i);return i}function x7e(t,e){return t.x-e.x}function b7e(t,e){let i=w7e(t,e);if(!i)return e;let r=Rhe(i,t);return U0(r,r.next),U0(i,i.next)}function w7e(t,e){let i=e,r=-1/0,n,s=t.x,a=t.y;do{if(a<=i.y&&a>=i.next.y&&i.next.y!==i.y){let d=i.x+(a-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(d<=s&&d>r&&(r=d,n=i.x<i.next.x?i:i.next,d===s))return n}i=i.next}while(i!==e);if(!n)return null;let o=n,l=n.x,c=n.y,u=1/0,h;i=n;do s>=i.x&&i.x>=l&&s!==i.x&&Kw(a<c?s:r,a,l,c,a<c?r:s,a,i.x,i.y)&&(h=Math.abs(a-i.y)/(s-i.x),IM(i,t)&&(h<u||h===u&&(i.x>n.x||i.x===n.x&&_7e(n,i)))&&(n=i,u=h)),i=i.next;while(i!==o);return n}function _7e(t,e){return Yn(t.prev,t,e.prev)<0&&Yn(e.next,t,t.next)<0}function S7e(t,e,i,r){let n=t;do n.z===0&&(n.z=Pj(n.x,n.y,e,i,r)),n.prevZ=n.prev,n.nextZ=n.next,n=n.next;while(n!==t);n.prevZ.nextZ=null,n.prevZ=null,E7e(n)}function E7e(t){let e,i,r,n,s,a,o,l,c=1;do{for(i=t,t=null,s=null,a=0;i;){for(a++,r=i,o=0,e=0;e<c&&(o++,r=r.nextZ,!!r);e++);for(l=c;o>0||l>0&&r;)o!==0&&(l===0||!r||i.z<=r.z)?(n=i,i=i.nextZ,o--):(n=r,r=r.nextZ,l--),s?s.nextZ=n:t=n,n.prevZ=s,s=n;i=r}s.nextZ=null,c*=2}while(a>1);return t}function Pj(t,e,i,r,n){return t=(t-i)*n|0,e=(e-r)*n|0,t=(t|t<<8)&16711935,t=(t|t<<4)&252645135,t=(t|t<<2)&858993459,t=(t|t<<1)&1431655765,e=(e|e<<8)&16711935,e=(e|e<<4)&252645135,e=(e|e<<2)&858993459,e=(e|e<<1)&1431655765,t|e<<1}function A7e(t){let e=t,i=t;do(e.x<i.x||e.x===i.x&&e.y<i.y)&&(i=e),e=e.next;while(e!==t);return i}function Kw(t,e,i,r,n,s,a,o){return(n-a)*(e-o)>=(t-a)*(s-o)&&(t-a)*(r-o)>=(i-a)*(e-o)&&(i-a)*(s-o)>=(n-a)*(r-o)}function M7e(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!T7e(t,e)&&(IM(t,e)&&IM(e,t)&&C7e(t,e)&&(Yn(t.prev,t,e.prev)||Yn(t,e.prev,e))||cL(t,e)&&Yn(t.prev,t,t.next)>0&&Yn(e.prev,e,e.next)>0)}function Yn(t,e,i){return(e.y-t.y)*(i.x-e.x)-(e.x-t.x)*(i.y-e.y)}function cL(t,e){return t.x===e.x&&t.y===e.y}function Phe(t,e,i,r){let n=NP(Yn(t,e,i)),s=NP(Yn(t,e,r)),a=NP(Yn(i,r,t)),o=NP(Yn(i,r,e));return!!(n!==s&&a!==o||n===0&&kP(t,i,e)||s===0&&kP(t,r,e)||a===0&&kP(i,t,r)||o===0&&kP(i,e,r))}function kP(t,e,i){return e.x<=Math.max(t.x,i.x)&&e.x>=Math.min(t.x,i.x)&&e.y<=Math.max(t.y,i.y)&&e.y>=Math.min(t.y,i.y)}function NP(t){return t>0?1:t<0?-1:0}function T7e(t,e){let i=t;do{if(i.i!==t.i&&i.next.i!==t.i&&i.i!==e.i&&i.next.i!==e.i&&Phe(i,i.next,t,e))return!0;i=i.next}while(i!==t);return!1}function IM(t,e){return Yn(t.prev,t,t.next)<0?Yn(t,e,t.next)>=0&&Yn(t,t.prev,e)>=0:Yn(t,e,t.prev)<0||Yn(t,t.next,e)<0}function C7e(t,e){let i=t,r=!1,n=(t.x+e.x)/2,s=(t.y+e.y)/2;do i.y>s!=i.next.y>s&&i.next.y!==i.y&&n<(i.next.x-i.x)*(s-i.y)/(i.next.y-i.y)+i.x&&(r=!r),i=i.next;while(i!==t);return r}function Rhe(t,e){let i=new Rj(t.i,t.x,t.y),r=new Rj(e.i,e.x,e.y),n=t.next,s=e.prev;return t.next=e,e.prev=t,i.next=n,n.prev=i,r.next=i,i.prev=r,s.next=r,r.prev=s,r}function aQ(t,e,i,r){let n=new Rj(t,e,i);return r?(n.next=r.next,n.prev=r,r.next.prev=n,r.next=n):(n.prev=n,n.next=n),n}function DM(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function Rj(t,e,i){this.i=t,this.x=e,this.y=i,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function P7e(t,e,i,r){let n=0;for(let s=e,a=i-r;s<i;s+=r)n+=(t[a]-t[s])*(t[s+1]+t[a+1]),a=s;return n}var Ihe=class{static area(t){let e=t.length,i=0;for(let r=e-1,n=0;n<e;r=n++)i+=t[r].x*t[n].y-t[n].x*t[r].y;return i*.5}static isClockWise(t){return Ihe.area(t)<0}static triangulateShape(t,e){let i=[],r=[],n=[];oQ(t),lQ(i,t);let s=t.length;e.forEach(oQ);for(let o=0;o<e.length;o++)r.push(s),s+=e[o].length,lQ(i,e[o]);let a=f7e.triangulate(i,r);for(let o=0;o<a.length;o+=3)n.push(a.slice(o,o+3));return n}};function oQ(t){let e=t.length;e>2&&t[e-1].equals(t[0])&&t.pop()}function lQ(t,e){for(let i=0;i<e.length;i++)t.push(e[i].x),t.push(e[i].y)}var Dhe=class extends JH{constructor(t=1,e=0){let i=(1+Math.sqrt(5))/2,r=[-1,i,0,1,i,0,-1,-i,0,1,-i,0,0,-1,i,0,1,i,0,-1,-i,0,1,-i,i,0,-1,i,0,1,-i,0,-1,-i,0,1],n=[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1];super(r,n,t,e),this.type="IcosahedronGeometry",this.parameters={radius:t,detail:e}}static fromJSON(t){return new Dhe(t.radius,t.detail)}},a1=class extends oi{constructor(t=1,e=32,i=16,r=0,n=Math.PI*2,s=0,a=Math.PI){super(),this.type="SphereGeometry",this.parameters={radius:t,widthSegments:e,heightSegments:i,phiStart:r,phiLength:n,thetaStart:s,thetaLength:a},e=Math.max(3,Math.floor(e)),i=Math.max(2,Math.floor(i));let o=Math.min(s+a,Math.PI),l=0,c=[],u=new W,h=new W,d=[],f=[],p=[],g=[];for(let m=0;m<=i;m++){let y=[],b=m/i,w=0;m==0&&s==0?w=.5/e:m==i&&o==Math.PI&&(w=-.5/e);for(let E=0;E<=e;E++){let M=E/e;u.x=-t*Math.cos(r+M*n)*Math.sin(s+b*a),u.y=t*Math.cos(s+b*a),u.z=t*Math.sin(r+M*n)*Math.sin(s+b*a),f.push(u.x,u.y,u.z),h.copy(u).normalize(),p.push(h.x,h.y,h.z),g.push(M+w,1-b),y.push(l++)}c.push(y)}for(let m=0;m<i;m++)for(let y=0;y<e;y++){let b=c[m][y+1],w=c[m][y],E=c[m+1][y],M=c[m+1][y+1];(m!==0||s>0)&&d.push(b,w,M),(m!==i-1||o<Math.PI)&&d.push(w,E,M)}this.setIndex(d),this.setAttribute("position",new Gt(f,3)),this.setAttribute("normal",new Gt(p,3)),this.setAttribute("uv",new Gt(g,2))}static fromJSON(t){return new a1(t.radius,t.widthSegments,t.heightSegments,t.phiStart,t.phiLength,t.thetaStart,t.thetaLength)}},Ohe=class extends oi{constructor(t=1,e=.4,i=12,r=48,n=Math.PI*2){super(),this.type="TorusGeometry",this.parameters={radius:t,tube:e,radialSegments:i,tubularSegments:r,arc:n},i=Math.floor(i),r=Math.floor(r);let s=[],a=[],o=[],l=[],c=new W,u=new W,h=new W;for(let d=0;d<=i;d++)for(let f=0;f<=r;f++){let p=f/r*n,g=d/i*Math.PI*2;u.x=(t+e*Math.cos(g))*Math.cos(p),u.y=(t+e*Math.cos(g))*Math.sin(p),u.z=e*Math.sin(g),a.push(u.x,u.y,u.z),c.x=t*Math.cos(p),c.y=t*Math.sin(p),h.subVectors(u,c).normalize(),o.push(h.x,h.y,h.z),l.push(f/r),l.push(d/i)}for(let d=1;d<=i;d++)for(let f=1;f<=r;f++){let p=(r+1)*d+f-1,g=(r+1)*(d-1)+f-1,m=(r+1)*(d-1)+f,y=(r+1)*d+f;s.push(p,g,y),s.push(g,m,y)}this.setIndex(s),this.setAttribute("position",new Gt(a,3)),this.setAttribute("normal",new Gt(o,3)),this.setAttribute("uv",new Gt(l,2))}static fromJSON(t){return new Ohe(t.radius,t.tube,t.radialSegments,t.tubularSegments,t.arc)}},Lhe=class extends oi{constructor(t=1,e=.4,i=64,r=8,n=2,s=3){super(),this.type="TorusKnotGeometry",this.parameters={radius:t,tube:e,tubularSegments:i,radialSegments:r,p:n,q:s},i=Math.floor(i),r=Math.floor(r);let a=[],o=[],l=[],c=[],u=new W,h=new W,d=new W,f=new W,p=new W,g=new W,m=new W;for(let b=0;b<=i;++b){let w=b/i*n*Math.PI*2;y(w,n,s,t,d),y(w+.01,n,s,t,f),g.subVectors(f,d),m.addVectors(f,d),p.crossVectors(g,m),m.crossVectors(p,g),p.normalize(),m.normalize();for(let E=0;E<=r;++E){let M=E/r*Math.PI*2,A=-e*Math.cos(M),P=e*Math.sin(M);u.x=d.x+(A*m.x+P*p.x),u.y=d.y+(A*m.y+P*p.y),u.z=d.z+(A*m.z+P*p.z),o.push(u.x,u.y,u.z),h.subVectors(u,d).normalize(),l.push(h.x,h.y,h.z),c.push(b/i),c.push(E/r)}}for(let b=1;b<=i;b++)for(let w=1;w<=r;w++){let E=(r+1)*(b-1)+(w-1),M=(r+1)*b+(w-1),A=(r+1)*b+w,P=(r+1)*(b-1)+w;a.push(E,M,P),a.push(M,A,P)}this.setIndex(a),this.setAttribute("position",new Gt(o,3)),this.setAttribute("normal",new Gt(l,3)),this.setAttribute("uv",new Gt(c,2));function y(b,w,E,M,A){let P=Math.cos(b),C=Math.sin(b),R=E/w*b,I=Math.cos(R);A.x=M*(2+I)*.5*P,A.y=M*(2+I)*C*.5,A.z=M*Math.sin(R)*.5}}static fromJSON(t){return new Lhe(t.radius,t.tube,t.tubularSegments,t.radialSegments,t.p,t.q)}},R7e=class extends Tr{constructor(t){super(t),this.isRawShaderMaterial=!0,this.type="RawShaderMaterial"}};function Ym(t,e,i){return khe(t)?new t.constructor(t.subarray(e,i!==void 0?i:t.length)):t.slice(e,i)}function UP(t,e,i){return!t||t.constructor===e?t:typeof e.BYTES_PER_ELEMENT=="number"?new e(t):Array.prototype.slice.call(t)}function khe(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)}function I7e(t){function e(n,s){return t[n]-t[s]}let i=t.length,r=new Array(i);for(let n=0;n!==i;++n)r[n]=n;return r.sort(e),r}function cQ(t,e,i){let r=t.length,n=new t.constructor(r);for(let s=0,a=0;a!==r;++s){let o=i[s]*e;for(let l=0;l!==e;++l)n[a++]=t[o+l]}return n}function Nhe(t,e,i,r){let n=1,s=t[0];for(;s!==void 0&&s[r]===void 0;)s=t[n++];if(s===void 0)return;let a=s[r];if(a!==void 0)if(Array.isArray(a))do a=s[r],a!==void 0&&(e.push(s.time),i.push.apply(i,a)),s=t[n++];while(s!==void 0);else if(a.toArray!==void 0)do a=s[r],a!==void 0&&(e.push(s.time),a.toArray(i,i.length)),s=t[n++];while(s!==void 0);else do a=s[r],a!==void 0&&(e.push(s.time),i.push(a)),s=t[n++];while(s!==void 0)}var uL=class{constructor(t,e,i,r){this.parameterPositions=t,this._cachedIndex=0,this.resultBuffer=r!==void 0?r:new e.constructor(i),this.sampleValues=e,this.valueSize=i,this.settings=null,this.DefaultSettings_={}}evaluate(t){let e=this.parameterPositions,i=this._cachedIndex,r=e[i],n=e[i-1];e:{t:{let s;i:{r:if(!(t<r)){for(let a=i+2;;){if(r===void 0){if(t<n)break r;return i=e.length,this._cachedIndex=i,this.copySampleValue_(i-1)}if(i===a)break;if(n=r,r=e[++i],t<r)break t}s=e.length;break i}if(!(t>=n)){let a=e[1];t<a&&(i=2,n=a);for(let o=i-2;;){if(n===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(i===o)break;if(r=n,n=e[--i-1],t>=n)break t}s=i,i=0;break i}break e}for(;i<s;){let a=i+s>>>1;t<e[a]?s=a:i=a+1}if(r=e[i],n=e[i-1],n===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(r===void 0)return i=e.length,this._cachedIndex=i,this.copySampleValue_(i-1)}this._cachedIndex=i,this.intervalChanged_(i,n,r)}return this.interpolate_(i,n,t,r)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(t){let e=this.resultBuffer,i=this.sampleValues,r=this.valueSize,n=t*r;for(let s=0;s!==r;++s)e[s]=i[n+s];return e}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}},D7e=class extends uL{constructor(t,e,i,r){super(t,e,i,r),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:Xw,endingEnd:Xw}}intervalChanged_(t,e,i){let r=this.parameterPositions,n=t-2,s=t+1,a=r[n],o=r[s];if(a===void 0)switch(this.getSettings_().endingStart){case $w:n=t,a=2*e-i;break;case jD:n=r.length-2,a=e+r[n]-r[n+1];break;default:n=t,a=i}if(o===void 0)switch(this.getSettings_().endingEnd){case $w:s=t,o=2*i-e;break;case jD:s=1,o=i+r[1]-r[0];break;default:s=t-1,o=e}let l=(i-e)*.5,c=this.valueSize;this._weightPrev=l/(e-a),this._weightNext=l/(o-i),this._offsetPrev=n*c,this._offsetNext=s*c}interpolate_(t,e,i,r){let n=this.resultBuffer,s=this.sampleValues,a=this.valueSize,o=t*a,l=o-a,c=this._offsetPrev,u=this._offsetNext,h=this._weightPrev,d=this._weightNext,f=(i-e)/(r-e),p=f*f,g=p*f,m=-h*g+2*h*p-h*f,y=(1+h)*g+(-1.5-2*h)*p+(-.5+h)*f+1,b=(-1-d)*g+(1.5+d)*p+.5*f,w=d*g-d*p;for(let E=0;E!==a;++E)n[E]=m*s[c+E]+y*s[l+E]+b*s[o+E]+w*s[u+E];return n}},Uhe=class extends uL{constructor(t,e,i,r){super(t,e,i,r)}interpolate_(t,e,i,r){let n=this.resultBuffer,s=this.sampleValues,a=this.valueSize,o=t*a,l=o-a,c=(i-e)/(r-e),u=1-c;for(let h=0;h!==a;++h)n[h]=s[l+h]*u+s[o+h]*c;return n}},O7e=class extends uL{constructor(t,e,i,r){super(t,e,i,r)}interpolate_(t){return this.copySampleValue_(t-1)}},uf=class{constructor(t,e,i,r){if(t===void 0)throw new Error("THREE.KeyframeTrack: track name is undefined");if(e===void 0||e.length===0)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+t);this.name=t,this.times=UP(e,this.TimeBufferType),this.values=UP(i,this.ValueBufferType),this.setInterpolation(r||this.DefaultInterpolation)}static toJSON(t){let e=t.constructor,i;if(e.toJSON!==this.toJSON)i=e.toJSON(t);else{i={name:t.name,times:UP(t.times,Array),values:UP(t.values,Array)};let r=t.getInterpolation();r!==t.DefaultInterpolation&&(i.interpolation=r)}return i.type=t.ValueTypeName,i}InterpolantFactoryMethodDiscrete(t){return new O7e(this.times,this.values,this.getValueSize(),t)}InterpolantFactoryMethodLinear(t){return new Uhe(this.times,this.values,this.getValueSize(),t)}InterpolantFactoryMethodSmooth(t){return new D7e(this.times,this.values,this.getValueSize(),t)}setInterpolation(t){let e;switch(t){case FD:e=this.InterpolantFactoryMethodDiscrete;break;case zD:e=this.InterpolantFactoryMethodLinear;break;case LB:e=this.InterpolantFactoryMethodSmooth;break}if(e===void 0){let i="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(this.createInterpolant===void 0)if(t!==this.DefaultInterpolation)this.setInterpolation(this.DefaultInterpolation);else throw new Error(i);return console.warn("THREE.KeyframeTrack:",i),this}return this.createInterpolant=e,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return FD;case this.InterpolantFactoryMethodLinear:return zD;case this.InterpolantFactoryMethodSmooth:return LB}}getValueSize(){return this.values.length/this.times.length}shift(t){if(t!==0){let e=this.times;for(let i=0,r=e.length;i!==r;++i)e[i]+=t}return this}scale(t){if(t!==1){let e=this.times;for(let i=0,r=e.length;i!==r;++i)e[i]*=t}return this}trim(t,e){let i=this.times,r=i.length,n=0,s=r-1;for(;n!==r&&i[n]<t;)++n;for(;s!==-1&&i[s]>e;)--s;if(++s,n!==0||s!==r){n>=s&&(s=Math.max(s,1),n=s-1);let a=this.getValueSize();this.times=Ym(i,n,s),this.values=Ym(this.values,n*a,s*a)}return this}validate(){let t=!0,e=this.getValueSize();e-Math.floor(e)!==0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),t=!1);let i=this.times,r=this.values,n=i.length;n===0&&(console.error("THREE.KeyframeTrack: Track is empty.",this),t=!1);let s=null;for(let a=0;a!==n;a++){let o=i[a];if(typeof o=="number"&&isNaN(o)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,a,o),t=!1;break}if(s!==null&&s>o){console.error("THREE.KeyframeTrack: Out of order keys.",this,a,o,s),t=!1;break}s=o}if(r!==void 0&&khe(r))for(let a=0,o=r.length;a!==o;++a){let l=r[a];if(isNaN(l)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,a,l),t=!1;break}}return t}optimize(){let t=Ym(this.times),e=Ym(this.values),i=this.getValueSize(),r=this.getInterpolation()===LB,n=t.length-1,s=1;for(let a=1;a<n;++a){let o=!1,l=t[a],c=t[a+1];if(l!==c&&(a!==1||l!==t[0]))if(r)o=!0;else{let u=a*i,h=u-i,d=u+i;for(let f=0;f!==i;++f){let p=e[u+f];if(p!==e[h+f]||p!==e[d+f]){o=!0;break}}}if(o){if(a!==s){t[s]=t[a];let u=a*i,h=s*i;for(let d=0;d!==i;++d)e[h+d]=e[u+d]}++s}}if(n>0){t[s]=t[n];for(let a=n*i,o=s*i,l=0;l!==i;++l)e[o+l]=e[a+l];++s}return s!==t.length?(this.times=Ym(t,0,s),this.values=Ym(e,0,s*i)):(this.times=t,this.values=e),this}clone(){let t=Ym(this.times,0),e=Ym(this.values,0),i=this.constructor,r=new i(this.name,t,e);return r.createInterpolant=this.createInterpolant,r}};uf.prototype.TimeBufferType=Float32Array;uf.prototype.ValueBufferType=Float32Array;uf.prototype.DefaultInterpolation=zD;var T_=class extends uf{};T_.prototype.ValueTypeName="bool";T_.prototype.ValueBufferType=Array;T_.prototype.DefaultInterpolation=FD;T_.prototype.InterpolantFactoryMethodLinear=void 0;T_.prototype.InterpolantFactoryMethodSmooth=void 0;var Bhe=class extends uf{};Bhe.prototype.ValueTypeName="color";var XD=class extends uf{};XD.prototype.ValueTypeName="number";var L7e=class extends uL{constructor(t,e,i,r){super(t,e,i,r)}interpolate_(t,e,i,r){let n=this.resultBuffer,s=this.sampleValues,a=this.valueSize,o=(i-e)/(r-e),l=t*a;for(let c=l+a;l!==c;l+=4)Ii.slerpFlat(n,0,s,l-a,s,l,o);return n}},kT=class extends uf{InterpolantFactoryMethodLinear(t){return new L7e(this.times,this.values,this.getValueSize(),t)}};kT.prototype.ValueTypeName="quaternion";kT.prototype.DefaultInterpolation=zD;kT.prototype.InterpolantFactoryMethodSmooth=void 0;var C_=class extends uf{};C_.prototype.ValueTypeName="string";C_.prototype.ValueBufferType=Array;C_.prototype.DefaultInterpolation=FD;C_.prototype.InterpolantFactoryMethodLinear=void 0;C_.prototype.InterpolantFactoryMethodSmooth=void 0;var $D=class extends uf{};$D.prototype.ValueTypeName="vector";var Ij=class{constructor(t,e=-1,i,r=VH){this.name=t,this.tracks=i,this.duration=e,this.blendMode=r,this.uuid=yu(),this.duration<0&&this.resetDuration()}static parse(t){let e=[],i=t.tracks,r=1/(t.fps||1);for(let s=0,a=i.length;s!==a;++s)e.push(N7e(i[s]).scale(r));let n=new this(t.name,t.duration,e,t.blendMode);return n.uuid=t.uuid,n}static toJSON(t){let e=[],i=t.tracks,r={name:t.name,duration:t.duration,tracks:e,uuid:t.uuid,blendMode:t.blendMode};for(let n=0,s=i.length;n!==s;++n)e.push(uf.toJSON(i[n]));return r}static CreateFromMorphTargetSequence(t,e,i,r){let n=e.length,s=[];for(let a=0;a<n;a++){let o=[],l=[];o.push((a+n-1)%n,a,(a+1)%n),l.push(0,1,0);let c=I7e(o);o=cQ(o,1,c),l=cQ(l,1,c),!r&&o[0]===0&&(o.push(n),l.push(l[0])),s.push(new XD(".morphTargetInfluences["+e[a].name+"]",o,l).scale(1/i))}return new this(t,-1,s)}static findByName(t,e){let i=t;if(!Array.isArray(t)){let r=t;i=r.geometry&&r.geometry.animations||r.animations}for(let r=0;r<i.length;r++)if(i[r].name===e)return i[r];return null}static CreateClipsFromMorphTargetSequences(t,e,i){let r={},n=/^([\w-]*?)([\d]+)$/;for(let a=0,o=t.length;a<o;a++){let l=t[a],c=l.name.match(n);if(c&&c.length>1){let u=c[1],h=r[u];h||(r[u]=h=[]),h.push(l)}}let s=[];for(let a in r)s.push(this.CreateFromMorphTargetSequence(a,r[a],e,i));return s}static parseAnimation(t,e){if(!t)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;let i=function(c,u,h,d,f){if(h.length!==0){let p=[],g=[];Nhe(h,p,g,d),p.length!==0&&f.push(new c(u,p,g))}},r=[],n=t.name||"default",s=t.fps||30,a=t.blendMode,o=t.length||-1,l=t.hierarchy||[];for(let c=0;c<l.length;c++){let u=l[c].keys;if(!(!u||u.length===0))if(u[0].morphTargets){let h={},d;for(d=0;d<u.length;d++)if(u[d].morphTargets)for(let f=0;f<u[d].morphTargets.length;f++)h[u[d].morphTargets[f]]=-1;for(let f in h){let p=[],g=[];for(let m=0;m!==u[d].morphTargets.length;++m){let y=u[d];p.push(y.time),g.push(y.morphTarget===f?1:0)}r.push(new XD(".morphTargetInfluence["+f+"]",p,g))}o=h.length*s}else{let h=".bones["+e[c].name+"]";i($D,h+".position",u,"pos",r),i(kT,h+".quaternion",u,"rot",r),i($D,h+".scale",u,"scl",r)}}return r.length===0?null:new this(n,o,r,a)}resetDuration(){let t=this.tracks,e=0;for(let i=0,r=t.length;i!==r;++i){let n=this.tracks[i];e=Math.max(e,n.times[n.times.length-1])}return this.duration=e,this}trim(){for(let t=0;t<this.tracks.length;t++)this.tracks[t].trim(0,this.duration);return this}validate(){let t=!0;for(let e=0;e<this.tracks.length;e++)t=t&&this.tracks[e].validate();return t}optimize(){for(let t=0;t<this.tracks.length;t++)this.tracks[t].optimize();return this}clone(){let t=[];for(let e=0;e<this.tracks.length;e++)t.push(this.tracks[e].clone());return new this.constructor(this.name,this.duration,t,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}};function k7e(t){switch(t.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return XD;case"vector":case"vector2":case"vector3":case"vector4":return $D;case"color":return Bhe;case"quaternion":return kT;case"bool":case"boolean":return T_;case"string":return C_}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+t)}function N7e(t){if(t.type===void 0)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");let e=k7e(t.type);if(t.times===void 0){let i=[],r=[];Nhe(t.keys,i,r,"value"),t.times=i,t.values=r}return e.parse!==void 0?e.parse(t):new e(t.name,t.times,t.values,t.interpolation)}var YD={enabled:!1,files:{},add:function(t,e){this.enabled!==!1&&(this.files[t]=e)},get:function(t){if(this.enabled!==!1)return this.files[t]},remove:function(t){delete this.files[t]},clear:function(){this.files={}}},Fhe=class{constructor(t,e,i){let r=this,n=!1,s=0,a=0,o,l=[];this.onStart=void 0,this.onLoad=t,this.onProgress=e,this.onError=i,this.itemStart=function(c){a++,n===!1&&r.onStart!==void 0&&r.onStart(c,s,a),n=!0},this.itemEnd=function(c){s++,r.onProgress!==void 0&&r.onProgress(c,s,a),s===a&&(n=!1,r.onLoad!==void 0&&r.onLoad())},this.itemError=function(c){r.onError!==void 0&&r.onError(c)},this.resolveURL=function(c){return o?o(c):c},this.setURLModifier=function(c){return o=c,this},this.addHandler=function(c,u){return l.push(c,u),this},this.removeHandler=function(c){let u=l.indexOf(c);return u!==-1&&l.splice(u,2),this},this.getHandler=function(c){for(let u=0,h=l.length;u<h;u+=2){let d=l[u],f=l[u+1];if(d.global&&(d.lastIndex=0),d.test(c))return f}return null}}},U7e=new Fhe,NT=class{constructor(t){this.manager=t!==void 0?t:U7e,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(t,e){let i=this;return new Promise(function(r,n){i.load(t,r,e,n)})}parse(){}setCrossOrigin(t){return this.crossOrigin=t,this}setWithCredentials(t){return this.withCredentials=t,this}setPath(t){return this.path=t,this}setResourcePath(t){return this.resourcePath=t,this}setRequestHeader(t){return this.requestHeader=t,this}},rp={},B7e=class extends Error{constructor(t,e){super(t),this.response=e}},Dj=class extends NT{constructor(t){super(t)}load(t,e,i,r){t===void 0&&(t=""),this.path!==void 0&&(t=this.path+t),t=this.manager.resolveURL(t);let n=YD.get(t);if(n!==void 0)return this.manager.itemStart(t),setTimeout(()=>{e&&e(n),this.manager.itemEnd(t)},0),n;if(rp[t]!==void 0){rp[t].push({onLoad:e,onProgress:i,onError:r});return}rp[t]=[],rp[t].push({onLoad:e,onProgress:i,onError:r});let s=new Request(t,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"}),a=this.mimeType,o=this.responseType;fetch(s).then(l=>{if(l.status===200||l.status===0){if(l.status===0&&console.warn("THREE.FileLoader: HTTP Status 0 received."),typeof ReadableStream>"u"||l.body===void 0||l.body.getReader===void 0)return l;let c=rp[t],u=l.body.getReader(),h=l.headers.get("Content-Length")||l.headers.get("X-File-Size"),d=h?parseInt(h):0,f=d!==0,p=0,g=new ReadableStream({start(m){y();function y(){u.read().then(({done:b,value:w})=>{if(b)m.close();else{p+=w.byteLength;let E=new ProgressEvent("progress",{lengthComputable:f,loaded:p,total:d});for(let M=0,A=c.length;M<A;M++){let P=c[M];P.onProgress&&P.onProgress(E)}m.enqueue(w),y()}})}}});return new Response(g)}else throw new B7e(`fetch for "${l.url}" responded with ${l.status}: ${l.statusText}`,l)}).then(l=>{switch(o){case"arraybuffer":return l.arrayBuffer();case"blob":return l.blob();case"document":return l.text().then(c=>new DOMParser().parseFromString(c,a));case"json":return l.json();default:if(a===void 0)return l.text();{let c=/charset="?([^;"\s]*)"?/i.exec(a),u=c&&c[1]?c[1].toLowerCase():void 0,h=new TextDecoder(u);return l.arrayBuffer().then(d=>h.decode(d))}}}).then(l=>{YD.add(t,l);let c=rp[t];delete rp[t];for(let u=0,h=c.length;u<h;u++){let d=c[u];d.onLoad&&d.onLoad(l)}}).catch(l=>{let c=rp[t];if(c===void 0)throw this.manager.itemError(t),l;delete rp[t];for(let u=0,h=c.length;u<h;u++){let d=c[u];d.onError&&d.onError(l)}this.manager.itemError(t)}).finally(()=>{this.manager.itemEnd(t)}),this.manager.itemStart(t)}setResponseType(t){return this.responseType=t,this}setMimeType(t){return this.mimeType=t,this}},F7e=class extends NT{constructor(t){super(t)}load(t,e,i,r){this.path!==void 0&&(t=this.path+t),t=this.manager.resolveURL(t);let n=this,s=YD.get(t);if(s!==void 0)return n.manager.itemStart(t),setTimeout(function(){e&&e(s),n.manager.itemEnd(t)},0),s;let a=CM("img");function o(){c(),YD.add(t,this),e&&e(this),n.manager.itemEnd(t)}function l(u){c(),r&&r(u),n.manager.itemError(t),n.manager.itemEnd(t)}function c(){a.removeEventListener("load",o,!1),a.removeEventListener("error",l,!1)}return a.addEventListener("load",o,!1),a.addEventListener("error",l,!1),t.slice(0,5)!=="data:"&&this.crossOrigin!==void 0&&(a.crossOrigin=this.crossOrigin),n.manager.itemStart(t),a.src=t,a}},z7e=class extends NT{constructor(t){super(t)}load(t,e,i,r){let n=new Kn,s=new F7e(this.manager);return s.setCrossOrigin(this.crossOrigin),s.setPath(this.path),s.load(t,function(a){n.image=a,n.needsUpdate=!0,e!==void 0&&e(n)},i,r),n}},UT=class extends tn{constructor(t,e=1){super(),this.isLight=!0,this.type="Light",this.color=new Ai(t),this.intensity=e}dispose(){}copy(t,e){return super.copy(t,e),this.color.copy(t.color),this.intensity=t.intensity,this}toJSON(t){let e=super.toJSON(t);return e.object.color=this.color.getHex(),e.object.intensity=this.intensity,this.groundColor!==void 0&&(e.object.groundColor=this.groundColor.getHex()),this.distance!==void 0&&(e.object.distance=this.distance),this.angle!==void 0&&(e.object.angle=this.angle),this.decay!==void 0&&(e.object.decay=this.decay),this.penumbra!==void 0&&(e.object.penumbra=this.penumbra),this.shadow!==void 0&&(e.object.shadow=this.shadow.toJSON()),e}},j7e=class extends UT{constructor(t,e,i){super(t,i),this.isHemisphereLight=!0,this.type="HemisphereLight",this.position.copy(tn.DEFAULT_UP),this.updateMatrix(),this.groundColor=new Ai(e)}copy(t,e){return super.copy(t,e),this.groundColor.copy(t.groundColor),this}},uF=new St,uQ=new W,hQ=new W,eG=class{constructor(t){this.camera=t,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new Ae(512,512),this.map=null,this.mapPass=null,this.matrix=new St,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new qH,this._frameExtents=new Ae(1,1),this._viewportCount=1,this._viewports=[new Ui(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(t){let e=this.camera,i=this.matrix;uQ.setFromMatrixPosition(t.matrixWorld),e.position.copy(uQ),hQ.setFromMatrixPosition(t.target.matrixWorld),e.lookAt(hQ),e.updateMatrixWorld(),uF.multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse),this._frustum.setFromProjectionMatrix(uF),i.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),i.multiply(uF)}getViewport(t){return this._viewports[t]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(t){return this.camera=t.camera.clone(),this.bias=t.bias,this.radius=t.radius,this.mapSize.copy(t.mapSize),this}clone(){return new this.constructor().copy(this)}toJSON(){let t={};return this.bias!==0&&(t.bias=this.bias),this.normalBias!==0&&(t.normalBias=this.normalBias),this.radius!==1&&(t.radius=this.radius),(this.mapSize.x!==512||this.mapSize.y!==512)&&(t.mapSize=this.mapSize.toArray()),t.camera=this.camera.toJSON(!1).object,delete t.camera.matrix,t}},V7e=class extends eG{constructor(){super(new No(50,1,.5,500)),this.isSpotLightShadow=!0,this.focus=1}updateMatrices(t){let e=this.camera,i=TM*2*t.angle*this.focus,r=this.mapSize.width/this.mapSize.height,n=t.distance||e.far;(i!==e.fov||r!==e.aspect||n!==e.far)&&(e.fov=i,e.aspect=r,e.far=n,e.updateProjectionMatrix()),super.updateMatrices(t)}copy(t){return super.copy(t),this.focus=t.focus,this}},H7e=class extends UT{constructor(t,e,i=0,r=Math.PI/3,n=0,s=2){super(t,e),this.isSpotLight=!0,this.type="SpotLight",this.position.copy(tn.DEFAULT_UP),this.updateMatrix(),this.target=new tn,this.distance=i,this.angle=r,this.penumbra=n,this.decay=s,this.map=null,this.shadow=new V7e}get power(){return this.intensity*Math.PI}set power(t){this.intensity=t/Math.PI}dispose(){this.shadow.dispose()}copy(t,e){return super.copy(t,e),this.distance=t.distance,this.angle=t.angle,this.penumbra=t.penumbra,this.decay=t.decay,this.target=t.target.clone(),this.shadow=t.shadow.clone(),this}},dQ=new St,dE=new W,hF=new W,G7e=class extends eG{constructor(){super(new No(90,1,.5,500)),this.isPointLightShadow=!0,this._frameExtents=new Ae(4,2),this._viewportCount=6,this._viewports=[new Ui(2,1,1,1),new Ui(0,1,1,1),new Ui(3,1,1,1),new Ui(1,1,1,1),new Ui(3,0,1,1),new Ui(1,0,1,1)],this._cubeDirections=[new W(1,0,0),new W(-1,0,0),new W(0,0,1),new W(0,0,-1),new W(0,1,0),new W(0,-1,0)],this._cubeUps=[new W(0,1,0),new W(0,1,0),new W(0,1,0),new W(0,1,0),new W(0,0,1),new W(0,0,-1)]}updateMatrices(t,e=0){let i=this.camera,r=this.matrix,n=t.distance||i.far;n!==i.far&&(i.far=n,i.updateProjectionMatrix()),dE.setFromMatrixPosition(t.matrixWorld),i.position.copy(dE),hF.copy(i.position),hF.add(this._cubeDirections[e]),i.up.copy(this._cubeUps[e]),i.lookAt(hF),i.updateMatrixWorld(),r.makeTranslation(-dE.x,-dE.y,-dE.z),dQ.multiplyMatrices(i.projectionMatrix,i.matrixWorldInverse),this._frustum.setFromProjectionMatrix(dQ)}},W7e=class extends UT{constructor(t,e,i=0,r=2){super(t,e),this.isPointLight=!0,this.type="PointLight",this.distance=i,this.decay=r,this.shadow=new G7e}get power(){return this.intensity*4*Math.PI}set power(t){this.intensity=t/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(t,e){return super.copy(t,e),this.distance=t.distance,this.decay=t.decay,this.shadow=t.shadow.clone(),this}},q7e=class extends eG{constructor(){super(new aL(-5,5,5,-5,.5,500)),this.isDirectionalLightShadow=!0}},X7e=class extends UT{constructor(t,e){super(t,e),this.isDirectionalLight=!0,this.type="DirectionalLight",this.position.copy(tn.DEFAULT_UP),this.updateMatrix(),this.target=new tn,this.shadow=new q7e}dispose(){this.shadow.dispose()}copy(t){return super.copy(t),this.target=t.target.clone(),this.shadow=t.shadow.clone(),this}},zhe=class extends oi{constructor(){super(),this.isInstancedBufferGeometry=!0,this.type="InstancedBufferGeometry",this.instanceCount=1/0}copy(t){return super.copy(t),this.instanceCount=t.instanceCount,this}toJSON(){let t=super.toJSON();return t.instanceCount=this.instanceCount,t.isInstancedBufferGeometry=!0,t}},jhe=class extends NT{constructor(t){super(t)}load(t,e,i,r){let n=this,s=new Dj(n.manager);s.setPath(n.path),s.setRequestHeader(n.requestHeader),s.setWithCredentials(n.withCredentials),s.load(t,function(a){try{e(n.parse(JSON.parse(a)))}catch(o){r?r(o):console.error(o),n.manager.itemError(t)}},i,r)}parse(t){let e={},i={};function r(h,d){if(e[d]!==void 0)return e[d];let f=h.interleavedBuffers[d],p=n(h,f.buffer),g=fP(f.type,p),m=new K9e(g,f.stride);return m.uuid=f.uuid,e[d]=m,m}function n(h,d){if(i[d]!==void 0)return i[d];let f=h.arrayBuffers[d],p=new Uint32Array(f).buffer;return i[d]=p,p}let s=t.isInstancedBufferGeometry?new zhe:new oi,a=t.data.index;if(a!==void 0){let h=fP(a.type,a.array);s.setIndex(new Mi(h,1))}let o=t.data.attributes;for(let h in o){let d=o[h],f;if(d.isInterleavedBufferAttribute){let p=r(t.data,d.data);f=new Cj(p,d.itemSize,d.offset,d.normalized)}else{let p=fP(d.type,d.array),g=d.isInstancedBufferAttribute?PM:Mi;f=new g(p,d.itemSize,d.normalized)}d.name!==void 0&&(f.name=d.name),d.usage!==void 0&&f.setUsage(d.usage),d.updateRange!==void 0&&(f.updateRange.offset=d.updateRange.offset,f.updateRange.count=d.updateRange.count),s.setAttribute(h,f)}let l=t.data.morphAttributes;if(l)for(let h in l){let d=l[h],f=[];for(let p=0,g=d.length;p<g;p++){let m=d[p],y;if(m.isInterleavedBufferAttribute){let b=r(t.data,m.data);y=new Cj(b,m.itemSize,m.offset,m.normalized)}else{let b=fP(m.type,m.array);y=new Mi(b,m.itemSize,m.normalized)}m.name!==void 0&&(y.name=m.name),f.push(y)}s.morphAttributes[h]=f}t.data.morphTargetsRelative&&(s.morphTargetsRelative=!0);let c=t.data.groups||t.data.drawcalls||t.data.offsets;if(c!==void 0)for(let h=0,d=c.length;h!==d;++h){let f=c[h];s.addGroup(f.start,f.count,f.materialIndex)}let u=t.data.boundingSphere;if(u!==void 0){let h=new W;u.center!==void 0&&h.fromArray(u.center),s.boundingSphere=new oc(h,u.radius)}return t.name&&(s.name=t.name),t.userData&&(s.userData=t.userData),s}},$7e=class{constructor(t=!0){this.autoStart=t,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=fQ(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let t=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){let e=fQ();t=(e-this.oldTime)/1e3,this.oldTime=e,this.elapsedTime+=t}return t}};function fQ(){return(typeof performance>"u"?Date:performance).now()}var Y7e=class{constructor(t,e,i){this.binding=t,this.valueSize=i;let r,n,s;switch(e){case"quaternion":r=this._slerp,n=this._slerpAdditive,s=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(i*6),this._workIndex=5;break;case"string":case"bool":r=this._select,n=this._select,s=this._setAdditiveIdentityOther,this.buffer=new Array(i*5);break;default:r=this._lerp,n=this._lerpAdditive,s=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(i*5)}this._mixBufferRegion=r,this._mixBufferRegionAdditive=n,this._setIdentity=s,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}accumulate(t,e){let i=this.buffer,r=this.valueSize,n=t*r+r,s=this.cumulativeWeight;if(s===0){for(let a=0;a!==r;++a)i[n+a]=i[a];s=e}else{s+=e;let a=e/s;this._mixBufferRegion(i,n,0,a,r)}this.cumulativeWeight=s}accumulateAdditive(t){let e=this.buffer,i=this.valueSize,r=i*this._addIndex;this.cumulativeWeightAdditive===0&&this._setIdentity(),this._mixBufferRegionAdditive(e,r,0,t,i),this.cumulativeWeightAdditive+=t}apply(t){let e=this.valueSize,i=this.buffer,r=t*e+e,n=this.cumulativeWeight,s=this.cumulativeWeightAdditive,a=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,n<1){let o=e*this._origIndex;this._mixBufferRegion(i,r,o,1-n,e)}s>0&&this._mixBufferRegionAdditive(i,r,this._addIndex*e,1,e);for(let o=e,l=e+e;o!==l;++o)if(i[o]!==i[o+e]){a.setValue(i,r);break}}saveOriginalState(){let t=this.binding,e=this.buffer,i=this.valueSize,r=i*this._origIndex;t.getValue(e,r);for(let n=i,s=r;n!==s;++n)e[n]=e[r+n%i];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0}restoreOriginalState(){let t=this.valueSize*3;this.binding.setValue(this.buffer,t)}_setAdditiveIdentityNumeric(){let t=this._addIndex*this.valueSize,e=t+this.valueSize;for(let i=t;i<e;i++)this.buffer[i]=0}_setAdditiveIdentityQuaternion(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1}_setAdditiveIdentityOther(){let t=this._origIndex*this.valueSize,e=this._addIndex*this.valueSize;for(let i=0;i<this.valueSize;i++)this.buffer[e+i]=this.buffer[t+i]}_select(t,e,i,r,n){if(r>=.5)for(let s=0;s!==n;++s)t[e+s]=t[i+s]}_slerp(t,e,i,r){Ii.slerpFlat(t,e,t,e,t,i,r)}_slerpAdditive(t,e,i,r,n){let s=this._workIndex*n;Ii.multiplyQuaternionsFlat(t,s,t,e,t,i),Ii.slerpFlat(t,e,t,e,t,s,r)}_lerp(t,e,i,r,n){let s=1-r;for(let a=0;a!==n;++a){let o=e+a;t[o]=t[o]*s+t[i+a]*r}}_lerpAdditive(t,e,i,r,n){for(let s=0;s!==n;++s){let a=e+s;t[a]=t[a]+t[i+s]*r}}},tG="\\[\\]\\.:\\/",K7e=new RegExp("["+tG+"]","g"),iG="[^"+tG+"]",Z7e="[^"+tG.replace("\\.","")+"]",Q7e=/((?:WC+[\/:])*)/.source.replace("WC",iG),J7e=/(WCOD+)?/.source.replace("WCOD",Z7e),eqe=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",iG),tqe=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",iG),iqe=new RegExp("^"+Q7e+J7e+eqe+tqe+"$"),rqe=["material","materials","bones","map"],nqe=class{constructor(t,e,i){let r=i||gn.parseTrackName(e);this._targetGroup=t,this._bindings=t.subscribe_(e,r)}getValue(t,e){this.bind();let i=this._targetGroup.nCachedObjects_,r=this._bindings[i];r!==void 0&&r.getValue(t,e)}setValue(t,e){let i=this._bindings;for(let r=this._targetGroup.nCachedObjects_,n=i.length;r!==n;++r)i[r].setValue(t,e)}bind(){let t=this._bindings;for(let e=this._targetGroup.nCachedObjects_,i=t.length;e!==i;++e)t[e].bind()}unbind(){let t=this._bindings;for(let e=this._targetGroup.nCachedObjects_,i=t.length;e!==i;++e)t[e].unbind()}},gn=class{constructor(t,e,i){this.path=e,this.parsedPath=i||gn.parseTrackName(e),this.node=gn.findNode(t,this.parsedPath.nodeName)||t,this.rootNode=t,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(t,e,i){return t&&t.isAnimationObjectGroup?new gn.Composite(t,e,i):new gn(t,e,i)}static sanitizeNodeName(t){return t.replace(/\s/g,"_").replace(K7e,"")}static parseTrackName(t){let e=iqe.exec(t);if(e===null)throw new Error("PropertyBinding: Cannot parse trackName: "+t);let i={nodeName:e[2],objectName:e[3],objectIndex:e[4],propertyName:e[5],propertyIndex:e[6]},r=i.nodeName&&i.nodeName.lastIndexOf(".");if(r!==void 0&&r!==-1){let n=i.nodeName.substring(r+1);rqe.indexOf(n)!==-1&&(i.nodeName=i.nodeName.substring(0,r),i.objectName=n)}if(i.propertyName===null||i.propertyName.length===0)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+t);return i}static findNode(t,e){if(e===void 0||e===""||e==="."||e===-1||e===t.name||e===t.uuid)return t;if(t.skeleton){let i=t.skeleton.getBoneByName(e);if(i!==void 0)return i}if(t.children){let i=function(n){for(let s=0;s<n.length;s++){let a=n[s];if(a.name===e||a.uuid===e)return a;let o=i(a.children);if(o)return o}return null},r=i(t.children);if(r)return r}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(t,e){t[e]=this.targetObject[this.propertyName]}_getValue_array(t,e){let i=this.resolvedProperty;for(let r=0,n=i.length;r!==n;++r)t[e++]=i[r]}_getValue_arrayElement(t,e){t[e]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(t,e){this.resolvedProperty.toArray(t,e)}_setValue_direct(t,e){this.targetObject[this.propertyName]=t[e]}_setValue_direct_setNeedsUpdate(t,e){this.targetObject[this.propertyName]=t[e],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(t,e){this.targetObject[this.propertyName]=t[e],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(t,e){let i=this.resolvedProperty;for(let r=0,n=i.length;r!==n;++r)i[r]=t[e++]}_setValue_array_setNeedsUpdate(t,e){let i=this.resolvedProperty;for(let r=0,n=i.length;r!==n;++r)i[r]=t[e++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(t,e){let i=this.resolvedProperty;for(let r=0,n=i.length;r!==n;++r)i[r]=t[e++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(t,e){this.resolvedProperty[this.propertyIndex]=t[e]}_setValue_arrayElement_setNeedsUpdate(t,e){this.resolvedProperty[this.propertyIndex]=t[e],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(t,e){this.resolvedProperty[this.propertyIndex]=t[e],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(t,e){this.resolvedProperty.fromArray(t,e)}_setValue_fromArray_setNeedsUpdate(t,e){this.resolvedProperty.fromArray(t,e),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(t,e){this.resolvedProperty.fromArray(t,e),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(t,e){this.bind(),this.getValue(t,e)}_setValue_unbound(t,e){this.bind(),this.setValue(t,e)}bind(){let t=this.node,e=this.parsedPath,i=e.objectName,r=e.propertyName,n=e.propertyIndex;if(t||(t=gn.findNode(this.rootNode,e.nodeName)||this.rootNode,this.node=t),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!t){console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.");return}if(i){let l=e.objectIndex;switch(i){case"materials":if(!t.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!t.material.materials){console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);return}t=t.material.materials;break;case"bones":if(!t.skeleton){console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);return}t=t.skeleton.bones;for(let c=0;c<t.length;c++)if(t[c].name===l){l=c;break}break;case"map":if("map"in t){t=t.map;break}if(!t.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!t.material.map){console.error("THREE.PropertyBinding: Can not bind to material.map as node.material does not have a map.",this);return}t=t.material.map;break;default:if(t[i]===void 0){console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);return}t=t[i]}if(l!==void 0){if(t[l]===void 0){console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,t);return}t=t[l]}}let s=t[r];if(s===void 0){let l=e.nodeName;console.error("THREE.PropertyBinding: Trying to update property for track: "+l+"."+r+" but it wasn't found.",t);return}let a=this.Versioning.None;this.targetObject=t,t.needsUpdate!==void 0?a=this.Versioning.NeedsUpdate:t.matrixWorldNeedsUpdate!==void 0&&(a=this.Versioning.MatrixWorldNeedsUpdate);let o=this.BindingType.Direct;if(n!==void 0){if(r==="morphTargetInfluences"){if(!t.geometry){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);return}if(!t.geometry.morphAttributes){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);return}t.morphTargetDictionary[n]!==void 0&&(n=t.morphTargetDictionary[n])}o=this.BindingType.ArrayElement,this.resolvedProperty=s,this.propertyIndex=n}else s.fromArray!==void 0&&s.toArray!==void 0?(o=this.BindingType.HasFromToArray,this.resolvedProperty=s):Array.isArray(s)?(o=this.BindingType.EntireArray,this.resolvedProperty=s):this.propertyName=r;this.getValue=this.GetterByBindingType[o],this.setValue=this.SetterByBindingTypeAndVersioning[o][a]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}};gn.Composite=nqe;gn.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3};gn.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2};gn.prototype.GetterByBindingType=[gn.prototype._getValue_direct,gn.prototype._getValue_array,gn.prototype._getValue_arrayElement,gn.prototype._getValue_toArray];gn.prototype.SetterByBindingTypeAndVersioning=[[gn.prototype._setValue_direct,gn.prototype._setValue_direct_setNeedsUpdate,gn.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[gn.prototype._setValue_array,gn.prototype._setValue_array_setNeedsUpdate,gn.prototype._setValue_array_setMatrixWorldNeedsUpdate],[gn.prototype._setValue_arrayElement,gn.prototype._setValue_arrayElement_setNeedsUpdate,gn.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[gn.prototype._setValue_fromArray,gn.prototype._setValue_fromArray_setNeedsUpdate,gn.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];var sqe=class{constructor(t,e,i=null,r=e.blendMode){this._mixer=t,this._clip=e,this._localRoot=i,this.blendMode=r;let n=e.tracks,s=n.length,a=new Array(s),o={endingStart:Xw,endingEnd:Xw};for(let l=0;l!==s;++l){let c=n[l].createInterpolant(null);a[l]=c,c.settings=o}this._interpolantSettings=o,this._interpolants=a,this._propertyBindings=new Array(s),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=nhe,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}play(){return this._mixer._activateAction(this),this}stop(){return this._mixer._deactivateAction(this),this.reset()}reset(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}isRunning(){return this.enabled&&!this.paused&&this.timeScale!==0&&this._startTime===null&&this._mixer._isActiveAction(this)}isScheduled(){return this._mixer._isActiveAction(this)}startAt(t){return this._startTime=t,this}setLoop(t,e){return this.loop=t,this.repetitions=e,this}setEffectiveWeight(t){return this.weight=t,this._effectiveWeight=this.enabled?t:0,this.stopFading()}getEffectiveWeight(){return this._effectiveWeight}fadeIn(t){return this._scheduleFading(t,0,1)}fadeOut(t){return this._scheduleFading(t,1,0)}crossFadeFrom(t,e,i){if(t.fadeOut(e),this.fadeIn(e),i){let r=this._clip.duration,n=t._clip.duration,s=n/r,a=r/n;t.warp(1,s,e),this.warp(a,1,e)}return this}crossFadeTo(t,e,i){return t.crossFadeFrom(this,e,i)}stopFading(){let t=this._weightInterpolant;return t!==null&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(t)),this}setEffectiveTimeScale(t){return this.timeScale=t,this._effectiveTimeScale=this.paused?0:t,this.stopWarping()}getEffectiveTimeScale(){return this._effectiveTimeScale}setDuration(t){return this.timeScale=this._clip.duration/t,this.stopWarping()}syncWith(t){return this.time=t.time,this.timeScale=t.timeScale,this.stopWarping()}halt(t){return this.warp(this._effectiveTimeScale,0,t)}warp(t,e,i){let r=this._mixer,n=r.time,s=this.timeScale,a=this._timeScaleInterpolant;a===null&&(a=r._lendControlInterpolant(),this._timeScaleInterpolant=a);let o=a.parameterPositions,l=a.sampleValues;return o[0]=n,o[1]=n+i,l[0]=t/s,l[1]=e/s,this}stopWarping(){let t=this._timeScaleInterpolant;return t!==null&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(t)),this}getMixer(){return this._mixer}getClip(){return this._clip}getRoot(){return this._localRoot||this._mixer._root}_update(t,e,i,r){if(!this.enabled){this._updateWeight(t);return}let n=this._startTime;if(n!==null){let o=(t-n)*i;o<0||i===0?e=0:(this._startTime=null,e=i*o)}e*=this._updateTimeScale(t);let s=this._updateTime(e),a=this._updateWeight(t);if(a>0){let o=this._interpolants,l=this._propertyBindings;switch(this.blendMode){case L6e:for(let c=0,u=o.length;c!==u;++c)o[c].evaluate(s),l[c].accumulateAdditive(a);break;case VH:default:for(let c=0,u=o.length;c!==u;++c)o[c].evaluate(s),l[c].accumulate(r,a)}}}_updateWeight(t){let e=0;if(this.enabled){e=this.weight;let i=this._weightInterpolant;if(i!==null){let r=i.evaluate(t)[0];e*=r,t>i.parameterPositions[1]&&(this.stopFading(),r===0&&(this.enabled=!1))}}return this._effectiveWeight=e,e}_updateTimeScale(t){let e=0;if(!this.paused){e=this.timeScale;let i=this._timeScaleInterpolant;if(i!==null){let r=i.evaluate(t)[0];e*=r,t>i.parameterPositions[1]&&(this.stopWarping(),e===0?this.paused=!0:this.timeScale=e)}}return this._effectiveTimeScale=e,e}_updateTime(t){let e=this._clip.duration,i=this.loop,r=this.time+t,n=this._loopCount,s=i===jH;if(t===0)return n===-1?r:s&&(n&1)===1?e-r:r;if(i===rhe){n===-1&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(r>=e)r=e;else if(r<0)r=0;else{this.time=r;break e}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=r,this._mixer.dispatchEvent({type:"finished",action:this,direction:t<0?-1:1})}}else{if(n===-1&&(t>=0?(n=0,this._setEndings(!0,this.repetitions===0,s)):this._setEndings(this.repetitions===0,!0,s)),r>=e||r<0){let a=Math.floor(r/e);r-=e*a,n+=Math.abs(a);let o=this.repetitions-n;if(o<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,r=t>0?e:0,this.time=r,this._mixer.dispatchEvent({type:"finished",action:this,direction:t>0?1:-1});else{if(o===1){let l=t<0;this._setEndings(l,!l,s)}else this._setEndings(!1,!1,s);this._loopCount=n,this.time=r,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:a})}}else this.time=r;if(s&&(n&1)===1)return e-r}return r}_setEndings(t,e,i){let r=this._interpolantSettings;i?(r.endingStart=$w,r.endingEnd=$w):(t?r.endingStart=this.zeroSlopeAtStart?$w:Xw:r.endingStart=jD,e?r.endingEnd=this.zeroSlopeAtEnd?$w:Xw:r.endingEnd=jD)}_scheduleFading(t,e,i){let r=this._mixer,n=r.time,s=this._weightInterpolant;s===null&&(s=r._lendControlInterpolant(),this._weightInterpolant=s);let a=s.parameterPositions,o=s.sampleValues;return a[0]=n,o[0]=e,a[1]=n+t,o[1]=i,this}},aqe=new Float32Array(1),oqe=class extends Qa{constructor(t){super(),this._root=t,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}_bindAction(t,e){let i=t._localRoot||this._root,r=t._clip.tracks,n=r.length,s=t._propertyBindings,a=t._interpolants,o=i.uuid,l=this._bindingsByRootAndName,c=l[o];c===void 0&&(c={},l[o]=c);for(let u=0;u!==n;++u){let h=r[u],d=h.name,f=c[d];if(f!==void 0)++f.referenceCount,s[u]=f;else{if(f=s[u],f!==void 0){f._cacheIndex===null&&(++f.referenceCount,this._addInactiveBinding(f,o,d));continue}let p=e&&e._propertyBindings[u].binding.parsedPath;f=new Y7e(gn.create(i,d,p),h.ValueTypeName,h.getValueSize()),++f.referenceCount,this._addInactiveBinding(f,o,d),s[u]=f}a[u].resultBuffer=f.buffer}}_activateAction(t){if(!this._isActiveAction(t)){if(t._cacheIndex===null){let i=(t._localRoot||this._root).uuid,r=t._clip.uuid,n=this._actionsByClip[r];this._bindAction(t,n&&n.knownActions[0]),this._addInactiveAction(t,r,i)}let e=t._propertyBindings;for(let i=0,r=e.length;i!==r;++i){let n=e[i];n.useCount++===0&&(this._lendBinding(n),n.saveOriginalState())}this._lendAction(t)}}_deactivateAction(t){if(this._isActiveAction(t)){let e=t._propertyBindings;for(let i=0,r=e.length;i!==r;++i){let n=e[i];--n.useCount===0&&(n.restoreOriginalState(),this._takeBackBinding(n))}this._takeBackAction(t)}}_initMemoryManager(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;let t=this;this.stats={actions:{get total(){return t._actions.length},get inUse(){return t._nActiveActions}},bindings:{get total(){return t._bindings.length},get inUse(){return t._nActiveBindings}},controlInterpolants:{get total(){return t._controlInterpolants.length},get inUse(){return t._nActiveControlInterpolants}}}}_isActiveAction(t){let e=t._cacheIndex;return e!==null&&e<this._nActiveActions}_addInactiveAction(t,e,i){let r=this._actions,n=this._actionsByClip,s=n[e];if(s===void 0)s={knownActions:[t],actionByRoot:{}},t._byClipCacheIndex=0,n[e]=s;else{let a=s.knownActions;t._byClipCacheIndex=a.length,a.push(t)}t._cacheIndex=r.length,r.push(t),s.actionByRoot[i]=t}_removeInactiveAction(t){let e=this._actions,i=e[e.length-1],r=t._cacheIndex;i._cacheIndex=r,e[r]=i,e.pop(),t._cacheIndex=null;let n=t._clip.uuid,s=this._actionsByClip,a=s[n],o=a.knownActions,l=o[o.length-1],c=t._byClipCacheIndex;l._byClipCacheIndex=c,o[c]=l,o.pop(),t._byClipCacheIndex=null;let u=a.actionByRoot,h=(t._localRoot||this._root).uuid;delete u[h],o.length===0&&delete s[n],this._removeInactiveBindingsForAction(t)}_removeInactiveBindingsForAction(t){let e=t._propertyBindings;for(let i=0,r=e.length;i!==r;++i){let n=e[i];--n.referenceCount===0&&this._removeInactiveBinding(n)}}_lendAction(t){let e=this._actions,i=t._cacheIndex,r=this._nActiveActions++,n=e[r];t._cacheIndex=r,e[r]=t,n._cacheIndex=i,e[i]=n}_takeBackAction(t){let e=this._actions,i=t._cacheIndex,r=--this._nActiveActions,n=e[r];t._cacheIndex=r,e[r]=t,n._cacheIndex=i,e[i]=n}_addInactiveBinding(t,e,i){let r=this._bindingsByRootAndName,n=this._bindings,s=r[e];s===void 0&&(s={},r[e]=s),s[i]=t,t._cacheIndex=n.length,n.push(t)}_removeInactiveBinding(t){let e=this._bindings,i=t.binding,r=i.rootNode.uuid,n=i.path,s=this._bindingsByRootAndName,a=s[r],o=e[e.length-1],l=t._cacheIndex;o._cacheIndex=l,e[l]=o,e.pop(),delete a[n],Object.keys(a).length===0&&delete s[r]}_lendBinding(t){let e=this._bindings,i=t._cacheIndex,r=this._nActiveBindings++,n=e[r];t._cacheIndex=r,e[r]=t,n._cacheIndex=i,e[i]=n}_takeBackBinding(t){let e=this._bindings,i=t._cacheIndex,r=--this._nActiveBindings,n=e[r];t._cacheIndex=r,e[r]=t,n._cacheIndex=i,e[i]=n}_lendControlInterpolant(){let t=this._controlInterpolants,e=this._nActiveControlInterpolants++,i=t[e];return i===void 0&&(i=new Uhe(new Float32Array(2),new Float32Array(2),1,aqe),i.__cacheIndex=e,t[e]=i),i}_takeBackControlInterpolant(t){let e=this._controlInterpolants,i=t.__cacheIndex,r=--this._nActiveControlInterpolants,n=e[r];t.__cacheIndex=r,e[r]=t,n.__cacheIndex=i,e[i]=n}clipAction(t,e,i){let r=e||this._root,n=r.uuid,s=typeof t=="string"?Ij.findByName(r,t):t,a=s!==null?s.uuid:t,o=this._actionsByClip[a],l=null;if(i===void 0&&(s!==null?i=s.blendMode:i=VH),o!==void 0){let u=o.actionByRoot[n];if(u!==void 0&&u.blendMode===i)return u;l=o.knownActions[0],s===null&&(s=l._clip)}if(s===null)return null;let c=new sqe(this,s,e,i);return this._bindAction(c,l),this._addInactiveAction(c,a,n),c}existingAction(t,e){let i=e||this._root,r=i.uuid,n=typeof t=="string"?Ij.findByName(i,t):t,s=n?n.uuid:t,a=this._actionsByClip[s];return a!==void 0&&a.actionByRoot[r]||null}stopAllAction(){let t=this._actions,e=this._nActiveActions;for(let i=e-1;i>=0;--i)t[i].stop();return this}update(t){t*=this.timeScale;let e=this._actions,i=this._nActiveActions,r=this.time+=t,n=Math.sign(t),s=this._accuIndex^=1;for(let l=0;l!==i;++l)e[l]._update(r,t,n,s);let a=this._bindings,o=this._nActiveBindings;for(let l=0;l!==o;++l)a[l].apply(s);return this}setTime(t){this.time=0;for(let e=0;e<this._actions.length;e++)this._actions[e].time=0;return this.update(t)}getRoot(){return this._root}uncacheClip(t){let e=this._actions,i=t.uuid,r=this._actionsByClip,n=r[i];if(n!==void 0){let s=n.knownActions;for(let a=0,o=s.length;a!==o;++a){let l=s[a];this._deactivateAction(l);let c=l._cacheIndex,u=e[e.length-1];l._cacheIndex=null,l._byClipCacheIndex=null,u._cacheIndex=c,e[c]=u,e.pop(),this._removeInactiveBindingsForAction(l)}delete r[i]}}uncacheRoot(t){let e=t.uuid,i=this._actionsByClip;for(let s in i){let a=i[s].actionByRoot,o=a[e];o!==void 0&&(this._deactivateAction(o),this._removeInactiveAction(o))}let r=this._bindingsByRootAndName,n=r[e];if(n!==void 0)for(let s in n){let a=n[s];a.restoreOriginalState(),this._removeInactiveBinding(a)}}uncacheAction(t,e){let i=this.existingAction(t,e);i!==null&&(this._deactivateAction(i),this._removeInactiveAction(i))}},xt=class{constructor(t){this.value=t}clone(){return new xt(this.value.clone===void 0?this.value:this.value.clone())}},Vhe=class{constructor(t,e,i=0,r=1/0){this.ray=new E_(t,e),this.near=i,this.far=r,this.camera=null,this.layers=new GH,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(t,e){this.ray.set(t,e)}setFromCamera(t,e){e.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(e.matrixWorld),this.ray.direction.set(t.x,t.y,.5).unproject(e).sub(this.ray.origin).normalize(),this.camera=e):e.isOrthographicCamera?(this.ray.origin.set(t.x,t.y,(e.near+e.far)/(e.near-e.far)).unproject(e),this.ray.direction.set(0,0,-1).transformDirection(e.matrixWorld),this.camera=e):console.error("THREE.Raycaster: Unsupported camera type: "+e.type)}intersectObject(t,e=!0,i=[]){return Oj(t,this,i,e),i.sort(pQ),i}intersectObjects(t,e=!0,i=[]){for(let r=0,n=t.length;r<n;r++)Oj(t[r],this,i,e);return i.sort(pQ),i}};function pQ(t,e){return t.distance-e.distance}function Oj(t,e,i,r){if(t.layers.test(e.layers)&&t.raycast(e,i),r===!0){let n=t.children;for(let s=0,a=n.length;s<a;s++)Oj(n[s],e,i,!0)}}var mQ=class{constructor(t=1,e=0,i=0){return this.radius=t,this.phi=e,this.theta=i,this}set(t,e,i){return this.radius=t,this.phi=e,this.theta=i,this}copy(t){return this.radius=t.radius,this.phi=t.phi,this.theta=t.theta,this}makeSafe(){return this.phi=Math.max(1e-6,Math.min(Math.PI-1e-6,this.phi)),this}setFromVector3(t){return this.setFromCartesianCoords(t.x,t.y,t.z)}setFromCartesianCoords(t,e,i){return this.radius=Math.sqrt(t*t+e*e+i*i),this.radius===0?(this.theta=0,this.phi=0):(this.theta=Math.atan2(t,i),this.phi=Math.acos(Fs(e/this.radius,-1,1))),this}clone(){return new this.constructor().copy(this)}},gQ=new Ae,rG=class{constructor(t=new Ae(1/0,1/0),e=new Ae(-1/0,-1/0)){this.isBox2=!0,this.min=t,this.max=e}set(t,e){return this.min.copy(t),this.max.copy(e),this}setFromPoints(t){this.makeEmpty();for(let e=0,i=t.length;e<i;e++)this.expandByPoint(t[e]);return this}setFromCenterAndSize(t,e){let i=gQ.copy(e).multiplyScalar(.5);return this.min.copy(t).sub(i),this.max.copy(t).add(i),this}clone(){return new this.constructor().copy(this)}copy(t){return this.min.copy(t.min),this.max.copy(t.max),this}makeEmpty(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y}getCenter(t){return this.isEmpty()?t.set(0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(t){return this.isEmpty()?t.set(0,0):t.subVectors(this.max,this.min)}expandByPoint(t){return this.min.min(t),this.max.max(t),this}expandByVector(t){return this.min.sub(t),this.max.add(t),this}expandByScalar(t){return this.min.addScalar(-t),this.max.addScalar(t),this}containsPoint(t){return!(t.x<this.min.x||t.x>this.max.x||t.y<this.min.y||t.y>this.max.y)}containsBox(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y}getParameter(t,e){return e.set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y))}intersectsBox(t){return!(t.max.x<this.min.x||t.min.x>this.max.x||t.max.y<this.min.y||t.min.y>this.max.y)}clampPoint(t,e){return e.copy(t).clamp(this.min,this.max)}distanceToPoint(t){return gQ.copy(t).clamp(this.min,this.max).sub(t).length()}intersect(t){return this.min.max(t.min),this.max.min(t.max),this}union(t){return this.min.min(t.min),this.max.max(t.max),this}translate(t){return this.min.add(t),this.max.add(t),this}equals(t){return t.min.equals(this.min)&&t.max.equals(this.max)}},vQ=new W,BP=new W,xu=class{constructor(t=new W,e=new W){this.start=t,this.end=e}set(t,e){return this.start.copy(t),this.end.copy(e),this}copy(t){return this.start.copy(t.start),this.end.copy(t.end),this}getCenter(t){return t.addVectors(this.start,this.end).multiplyScalar(.5)}delta(t){return t.subVectors(this.end,this.start)}distanceSq(){return this.start.distanceToSquared(this.end)}distance(){return this.start.distanceTo(this.end)}at(t,e){return this.delta(e).multiplyScalar(t).add(this.start)}closestPointToPointParameter(t,e){vQ.subVectors(t,this.start),BP.subVectors(this.end,this.start);let i=BP.dot(BP),r=BP.dot(vQ)/i;return e&&(r=Fs(r,0,1)),r}closestPointToPoint(t,e,i){let r=this.closestPointToPointParameter(t,e);return this.delta(i).multiplyScalar(r).add(this.start)}applyMatrix4(t){return this.start.applyMatrix4(t),this.end.applyMatrix4(t),this}equals(t){return t.start.equals(this.start)&&t.end.equals(this.end)}clone(){return new this.constructor().copy(this)}},yQ=new W,lqe=class extends tn{constructor(t,e){super(),this.light=t,this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.color=e,this.type="SpotLightHelper";let i=new oi,r=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1];for(let s=0,a=1,o=32;s<o;s++,a++){let l=s/o*Math.PI*2,c=a/o*Math.PI*2;r.push(Math.cos(l),Math.sin(l),1,Math.cos(c),Math.sin(c),1)}i.setAttribute("position",new Gt(r,3));let n=new yv({fog:!1,toneMapped:!1});this.cone=new LT(i,n),this.add(this.cone),this.update()}dispose(){this.cone.geometry.dispose(),this.cone.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1);let t=this.light.distance?this.light.distance:1e3,e=t*Math.tan(this.light.angle);this.cone.scale.set(e,e,t),yQ.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(yQ),this.color!==void 0?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)}},cqe=class extends En{constructor(t,e,i){let r=new a1(e,4,2),n=new Xp({wireframe:!0,fog:!1,toneMapped:!1});super(r,n),this.light=t,this.color=i,this.type="PointLightHelper",this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}dispose(){this.geometry.dispose(),this.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.color!==void 0?this.material.color.set(this.color):this.material.color.copy(this.light.color)}},xQ=new W,FP=new W,bQ=new W,uqe=class extends tn{constructor(t,e,i){super(),this.light=t,this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.color=i,this.type="DirectionalLightHelper",e===void 0&&(e=1);let r=new oi;r.setAttribute("position",new Gt([-e,e,0,e,e,0,e,-e,0,-e,-e,0,-e,e,0],3));let n=new yv({fog:!1,toneMapped:!1});this.lightPlane=new GD(r,n),this.add(this.lightPlane),r=new oi,r.setAttribute("position",new Gt([0,0,0,0,0,1],3)),this.targetLine=new GD(r,n),this.add(this.targetLine),this.update()}dispose(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1),xQ.setFromMatrixPosition(this.light.matrixWorld),FP.setFromMatrixPosition(this.light.target.matrixWorld),bQ.subVectors(FP,xQ),this.lightPlane.lookAt(FP),this.color!==void 0?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(FP),this.targetLine.scale.z=bQ.length()}},zP=new W,ts=new vv,KD=class extends LT{constructor(t){let e=new oi,i=new yv({color:16777215,vertexColors:!0,toneMapped:!1}),r=[],n=[],s={};a("n1","n2"),a("n2","n4"),a("n4","n3"),a("n3","n1"),a("f1","f2"),a("f2","f4"),a("f4","f3"),a("f3","f1"),a("n1","f1"),a("n2","f2"),a("n3","f3"),a("n4","f4"),a("p","n1"),a("p","n2"),a("p","n3"),a("p","n4"),a("u1","u2"),a("u2","u3"),a("u3","u1"),a("c","t"),a("p","c"),a("cn1","cn2"),a("cn3","cn4"),a("cf1","cf2"),a("cf3","cf4");function a(f,p){o(f),o(p)}function o(f){r.push(0,0,0),n.push(0,0,0),s[f]===void 0&&(s[f]=[]),s[f].push(r.length/3-1)}e.setAttribute("position",new Gt(r,3)),e.setAttribute("color",new Gt(n,3)),super(e,i),this.type="CameraHelper",this.camera=t,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=s,this.update();let l=new Ai(16755200),c=new Ai(16711680),u=new Ai(43775),h=new Ai(16777215),d=new Ai(3355443);this.setColors(l,c,u,h,d)}setColors(t,e,i,r,n){let s=this.geometry.getAttribute("color");s.setXYZ(0,t.r,t.g,t.b),s.setXYZ(1,t.r,t.g,t.b),s.setXYZ(2,t.r,t.g,t.b),s.setXYZ(3,t.r,t.g,t.b),s.setXYZ(4,t.r,t.g,t.b),s.setXYZ(5,t.r,t.g,t.b),s.setXYZ(6,t.r,t.g,t.b),s.setXYZ(7,t.r,t.g,t.b),s.setXYZ(8,t.r,t.g,t.b),s.setXYZ(9,t.r,t.g,t.b),s.setXYZ(10,t.r,t.g,t.b),s.setXYZ(11,t.r,t.g,t.b),s.setXYZ(12,t.r,t.g,t.b),s.setXYZ(13,t.r,t.g,t.b),s.setXYZ(14,t.r,t.g,t.b),s.setXYZ(15,t.r,t.g,t.b),s.setXYZ(16,t.r,t.g,t.b),s.setXYZ(17,t.r,t.g,t.b),s.setXYZ(18,t.r,t.g,t.b),s.setXYZ(19,t.r,t.g,t.b),s.setXYZ(20,t.r,t.g,t.b),s.setXYZ(21,t.r,t.g,t.b),s.setXYZ(22,t.r,t.g,t.b),s.setXYZ(23,t.r,t.g,t.b),s.setXYZ(24,e.r,e.g,e.b),s.setXYZ(25,e.r,e.g,e.b),s.setXYZ(26,e.r,e.g,e.b),s.setXYZ(27,e.r,e.g,e.b),s.setXYZ(28,e.r,e.g,e.b),s.setXYZ(29,e.r,e.g,e.b),s.setXYZ(30,e.r,e.g,e.b),s.setXYZ(31,e.r,e.g,e.b),s.setXYZ(32,i.r,i.g,i.b),s.setXYZ(33,i.r,i.g,i.b),s.setXYZ(34,i.r,i.g,i.b),s.setXYZ(35,i.r,i.g,i.b),s.setXYZ(36,i.r,i.g,i.b),s.setXYZ(37,i.r,i.g,i.b),s.setXYZ(38,r.r,r.g,r.b),s.setXYZ(39,r.r,r.g,r.b),s.setXYZ(40,n.r,n.g,n.b),s.setXYZ(41,n.r,n.g,n.b),s.setXYZ(42,n.r,n.g,n.b),s.setXYZ(43,n.r,n.g,n.b),s.setXYZ(44,n.r,n.g,n.b),s.setXYZ(45,n.r,n.g,n.b),s.setXYZ(46,n.r,n.g,n.b),s.setXYZ(47,n.r,n.g,n.b),s.setXYZ(48,n.r,n.g,n.b),s.setXYZ(49,n.r,n.g,n.b),s.needsUpdate=!0}update(){let t=this.geometry,e=this.pointMap,i=1,r=1;ts.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse),ms("c",e,t,ts,0,0,-1),ms("t",e,t,ts,0,0,1),ms("n1",e,t,ts,-i,-r,-1),ms("n2",e,t,ts,i,-r,-1),ms("n3",e,t,ts,-i,r,-1),ms("n4",e,t,ts,i,r,-1),ms("f1",e,t,ts,-i,-r,1),ms("f2",e,t,ts,i,-r,1),ms("f3",e,t,ts,-i,r,1),ms("f4",e,t,ts,i,r,1),ms("u1",e,t,ts,i*.7,r*1.1,-1),ms("u2",e,t,ts,-i*.7,r*1.1,-1),ms("u3",e,t,ts,0,r*2,-1),ms("cf1",e,t,ts,-i,0,1),ms("cf2",e,t,ts,i,0,1),ms("cf3",e,t,ts,0,-r,1),ms("cf4",e,t,ts,0,r,1),ms("cn1",e,t,ts,-i,0,-1),ms("cn2",e,t,ts,i,0,-1),ms("cn3",e,t,ts,0,-r,-1),ms("cn4",e,t,ts,0,r,-1),t.getAttribute("position").needsUpdate=!0}dispose(){this.geometry.dispose(),this.material.dispose()}};function ms(t,e,i,r,n,s,a){zP.set(n,s,a).unproject(r);let o=e[t];if(o!==void 0){let l=i.getAttribute("position");for(let c=0,u=o.length;c<u;c++)l.setXYZ(o[c],zP.x,zP.y,zP.z)}}var ZD=class extends LT{constructor(t,e=16776960){let i=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),r=[1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],n=new oi;n.setIndex(new Mi(i,1)),n.setAttribute("position",new Gt(r,3)),super(n,new yv({color:e,toneMapped:!1})),this.box=t,this.type="Box3Helper",this.geometry.computeBoundingSphere()}updateMatrixWorld(t){let e=this.box;e.isEmpty()||(e.getCenter(this.position),e.getSize(this.scale),this.scale.multiplyScalar(.5),super.updateMatrixWorld(t))}dispose(){this.geometry.dispose(),this.material.dispose()}},hqe=class extends LT{constructor(t=1){let e=[0,0,0,t,0,0,0,0,0,0,t,0,0,0,0,0,0,t],i=[1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],r=new oi;r.setAttribute("position",new Gt(e,3)),r.setAttribute("color",new Gt(i,3));let n=new yv({vertexColors:!0,toneMapped:!1});super(r,n),this.type="AxesHelper"}setColors(t,e,i){let r=new Ai,n=this.geometry.attributes.color.array;return r.set(t),r.toArray(n,0),r.toArray(n,3),r.set(e),r.toArray(n,6),r.toArray(n,9),r.set(i),r.toArray(n,12),r.toArray(n,15),this.geometry.attributes.color.needsUpdate=!0,this}dispose(){this.geometry.dispose(),this.material.dispose()}},wp=dqe();function dqe(){let t=new ArrayBuffer(4),e=new Float32Array(t),i=new Uint32Array(t),r=new Uint32Array(512),n=new Uint32Array(512);for(let l=0;l<256;++l){let c=l-127;c<-27?(r[l]=0,r[l|256]=32768,n[l]=24,n[l|256]=24):c<-14?(r[l]=1024>>-c-14,r[l|256]=1024>>-c-14|32768,n[l]=-c-1,n[l|256]=-c-1):c<=15?(r[l]=c+15<<10,r[l|256]=c+15<<10|32768,n[l]=13,n[l|256]=13):c<128?(r[l]=31744,r[l|256]=64512,n[l]=24,n[l|256]=24):(r[l]=31744,r[l|256]=64512,n[l]=13,n[l|256]=13)}let s=new Uint32Array(2048),a=new Uint32Array(64),o=new Uint32Array(64);for(let l=1;l<1024;++l){let c=l<<13,u=0;for(;(c&8388608)===0;)c<<=1,u-=8388608;c&=-8388609,u+=947912704,s[l]=c|u}for(let l=1024;l<2048;++l)s[l]=939524096+(l-1024<<13);for(let l=1;l<31;++l)a[l]=l<<23;a[31]=1199570944,a[32]=2147483648;for(let l=33;l<63;++l)a[l]=2147483648+(l-32<<23);a[63]=3347054592;for(let l=1;l<64;++l)l!==32&&(o[l]=1024);return{floatView:e,uint32View:i,baseTable:r,shiftTable:n,mantissaTable:s,exponentTable:a,offsetTable:o}}function fqe(t){Math.abs(t)>65504&&console.warn("THREE.DataUtils.toHalfFloat(): Value out of range."),t=Fs(t,-65504,65504),wp.floatView[0]=t;let e=wp.uint32View[0],i=e>>23&511;return wp.baseTable[i]+((e&8388607)>>wp.shiftTable[i])}function pqe(t){let e=t>>10;return wp.uint32View[0]=wp.mantissaTable[wp.offsetTable[e]+(t&1023)]+wp.exponentTable[e],wp.floatView[0]}var mqe=Object.freeze({__proto__:null,fromHalfFloat:pqe,toHalfFloat:fqe});typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:S_}}));typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=S_);var fE=".",nG=Symbol("target"),Hhe=Symbol("unsubscribe");function Lj(t){return t instanceof Date||t instanceof Set||t instanceof Map||t instanceof WeakSet||t instanceof WeakMap||ArrayBuffer.isView(t)}function gqe(t){return(typeof t=="object"?t===null:typeof t!="function")||t instanceof RegExp}var Ad=Array.isArray;function sG(t){return typeof t=="symbol"}var vqe={after:(t,e)=>Ad(t)?t.slice(e.length):e===""?t:t.slice(e.length+1),concat:(t,e)=>Ad(t)?(t=[...t],e&&t.push(e),t):e&&e.toString!==void 0?(t!==""&&(t+=fE),sG(e)?t+e.toString():t+e):t,initial:t=>{if(Ad(t))return t.slice(0,-1);if(t==="")return t;let e=t.lastIndexOf(fE);return e===-1?"":t.slice(0,e)},last:t=>{if(Ad(t))return t[t.length-1]||"";if(t==="")return t;let e=t.lastIndexOf(fE);return e===-1?t:t.slice(e+1)},walk:(t,e)=>{if(Ad(t))for(let i of t)e(i);else if(t!==""){let i=0,r=t.indexOf(fE);if(r===-1)e(t);else for(;i<t.length;)r===-1&&(r=t.length),e(t.slice(i,r)),i=r+1,r=t.indexOf(fE,i)}},get(t,e){return this.walk(e,i=>{t&&(t=t[i])}),t}},cu=vqe;function yqe(t){return typeof t=="object"&&typeof t.next=="function"}function xqe(t,e,i,r,n){let s=t.next;if(e.name==="entries")t.next=function(){let a=s.call(this);return a.done===!1&&(a.value[0]=n(a.value[0],e,a.value[0],r),a.value[1]=n(a.value[1],e,a.value[0],r)),a};else if(e.name==="values"){let a=i[nG].keys();t.next=function(){let o=s.call(this);return o.done===!1&&(o.value=n(o.value,e,a.next().value,r)),o}}else t.next=function(){let a=s.call(this);return a.done===!1&&(a.value=n(a.value,e,a.value,r)),a};return t}function wQ(t,e,i){return t.isUnsubscribed||e.ignoreSymbols&&sG(i)||e.ignoreUnderscores&&i.charAt(0)==="_"||"ignoreKeys"in e&&e.ignoreKeys.includes(i)}var bqe=class{constructor(t){this._equals=t,this._proxyCache=new WeakMap,this._pathCache=new WeakMap,this.isUnsubscribed=!1}_getDescriptorCache(){return this._descriptorCache===void 0&&(this._descriptorCache=new WeakMap),this._descriptorCache}_getProperties(t){let e=this._getDescriptorCache(),i=e.get(t);return i===void 0&&(i={},e.set(t,i)),i}_getOwnPropertyDescriptor(t,e){if(this.isUnsubscribed)return Reflect.getOwnPropertyDescriptor(t,e);let i=this._getProperties(t),r=i[e];return r===void 0&&(r=Reflect.getOwnPropertyDescriptor(t,e),i[e]=r),r}getProxy(t,e,i,r){if(this.isUnsubscribed)return t;let n=t[r],s=n||t;this._pathCache.set(s,e);let a=this._proxyCache.get(s);return a===void 0&&(a=n===void 0?new Proxy(t,i):t,this._proxyCache.set(s,a)),a}getPath(t){return this.isUnsubscribed?void 0:this._pathCache.get(t)}isDetached(t,e){return!Object.is(t,cu.get(e,this.getPath(t)))}defineProperty(t,e,i){return Reflect.defineProperty(t,e,i)?(this.isUnsubscribed||(this._getProperties(t)[e]=i),!0):!1}setProperty(t,e,i,r,n){if(!this._equals(n,i)||!(e in t)){let s=this._getOwnPropertyDescriptor(t,e);return s!==void 0&&"set"in s?Reflect.set(t,e,i,r):Reflect.set(t,e,i)}return!0}deleteProperty(t,e,i){if(Reflect.deleteProperty(t,e)){if(!this.isUnsubscribed){let r=this._getDescriptorCache().get(t);r&&(delete r[e],this._pathCache.delete(i))}return!0}return!1}isSameDescriptor(t,e,i){let r=this._getOwnPropertyDescriptor(e,i);return t!==void 0&&r!==void 0&&Object.is(t.value,r.value)&&(t.writable||!1)===(r.writable||!1)&&(t.enumerable||!1)===(r.enumerable||!1)&&(t.configurable||!1)===(r.configurable||!1)&&t.get===r.get&&t.set===r.set}isGetInvariant(t,e){let i=this._getOwnPropertyDescriptor(t,e);return i!==void 0&&i.configurable!==!0&&i.writable!==!0}unsubscribe(){this._descriptorCache=null,this._pathCache=null,this._proxyCache=null,this.isUnsubscribed=!0}};function kj(t){return toString.call(t)==="[object Object]"}function jP(){return!0}function tw(t,e){return t.length!==e.length||t.some((i,r)=>e[r]!==i)}var Ghe=new Set(["hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"]),wqe=new Set(["concat","includes","indexOf","join","keys","lastIndexOf"]),Whe={push:jP,pop:jP,shift:jP,unshift:jP,copyWithin:tw,reverse:tw,sort:tw,splice:tw,flat:tw,fill:tw},_qe=new Set([...Ghe,...wqe,...Object.keys(Whe)]);function VP(t,e){if(t.size!==e.size)return!0;for(let i of t)if(!e.has(i))return!0;return!1}var qhe=["keys","values","entries"],Xhe=new Set(["has","toString"]),$he={add:VP,clear:VP,delete:VP,forEach:VP},Sqe=new Set([...Xhe,...Object.keys($he),...qhe]);function HP(t,e){if(t.size!==e.size)return!0;let i;for(let[r,n]of t)if(i=e.get(r),i!==n||i===void 0&&!e.has(r))return!0;return!1}var Eqe=new Set([...Xhe,"get"]),Yhe={set:HP,clear:HP,delete:HP,forEach:HP},Aqe=new Set([...Eqe,...Object.keys(Yhe),...qhe]),nv=class{constructor(t,e,i,r){this._path=e,this._isChanged=!1,this._clonedCache=new Set,this._hasOnValidate=r,this._changes=r?[]:null,this.clone=e===void 0?t:this._shallowClone(t)}static isHandledMethod(t){return Ghe.has(t)}_shallowClone(t){let e=t;if(kj(t))e={...t};else if(Ad(t))e=[...t];else if(t instanceof Date)e=new Date(t);else if(t instanceof Set)e=new Set([...t].map(i=>this._shallowClone(i)));else if(t instanceof Map){e=new Map;for(let[i,r]of t.entries())e.set(i,this._shallowClone(r))}return this._clonedCache.add(e),e}preferredThisArg(t,e,i,r){return t?(Ad(r)?this._onIsChanged=Whe[e]:r instanceof Set?this._onIsChanged=$he[e]:r instanceof Map&&(this._onIsChanged=Yhe[e]),r):i}update(t,e,i){let r=cu.after(t,this._path);if(e!=="length"){let n=this.clone;cu.walk(r,s=>{n&&n[s]&&(this._clonedCache.has(n[s])||(n[s]=this._shallowClone(n[s])),n=n[s])}),this._hasOnValidate&&this._changes.push({path:r,property:e,previous:i}),n&&n[e]&&(n[e]=i)}this._isChanged=!0}undo(t){let e;for(let i=this._changes.length-1;i!==-1;i--)e=this._changes[i],cu.get(t,e.path)[e.property]=e.previous}isChanged(t){return this._onIsChanged===void 0?this._isChanged:this._onIsChanged(this.clone,t)}},_Q=class extends nv{static isHandledMethod(t){return _qe.has(t)}},Mqe=class extends nv{undo(t){t.setTime(this.clone.getTime())}isChanged(t,e){return!e(this.clone.valueOf(),t.valueOf())}},SQ=class extends nv{static isHandledMethod(t){return Sqe.has(t)}undo(t){for(let e of this.clone)t.add(e);for(let e of t)this.clone.has(e)||t.delete(e)}},EQ=class extends nv{static isHandledMethod(t){return Aqe.has(t)}undo(t){for(let[e,i]of this.clone.entries())t.set(e,i);for(let e of t.keys())this.clone.has(e)||t.delete(e)}},Tqe=class extends nv{constructor(t,e,i,r){super(void 0,e,i,r),this._arg1=i[0],this._weakValue=t.has(this._arg1)}isChanged(t){return this._weakValue!==t.has(this._arg1)}undo(t){this._weakValue&&!t.has(this._arg1)?t.add(this._arg1):t.delete(this._arg1)}},Cqe=class extends nv{constructor(t,e,i,r){super(void 0,e,i,r),this._weakKey=i[0],this._weakHas=t.has(this._weakKey),this._weakValue=t.get(this._weakKey)}isChanged(t){return this._weakValue!==t.get(this._weakKey)}undo(t){let e=t.has(this._weakKey);this._weakHas&&!e?t.set(this._weakKey,this._weakValue):!this._weakHas&&e?t.delete(this._weakKey):this._weakValue!==t.get(this._weakKey)&&t.set(this._weakKey,this._weakValue)}},Mw=class{constructor(t){this._stack=[],this._hasOnValidate=t}static isHandledType(t){return kj(t)||Ad(t)||Lj(t)}static isHandledMethod(t,e){return kj(t)?nv.isHandledMethod(e):Ad(t)?_Q.isHandledMethod(e):t instanceof Set?SQ.isHandledMethod(e):t instanceof Map?EQ.isHandledMethod(e):Lj(t)}get isCloning(){return this._stack.length>0}start(t,e,i){let r=nv;Ad(t)?r=_Q:t instanceof Date?r=Mqe:t instanceof Set?r=SQ:t instanceof Map?r=EQ:t instanceof WeakSet?r=Tqe:t instanceof WeakMap&&(r=Cqe),this._stack.push(new r(t,e,i,this._hasOnValidate))}update(t,e,i){this._stack[this._stack.length-1].update(t,e,i)}preferredThisArg(t,e,i){let{name:r}=t,n=Mw.isHandledMethod(i,r);return this._stack[this._stack.length-1].preferredThisArg(n,r,e,i)}isChanged(t,e,i){return this._stack[this._stack.length-1].isChanged(t,e,i)}undo(t){this._previousClone!==void 0&&this._previousClone.undo(t)}stop(){return this._previousClone=this._stack.pop(),this._previousClone.clone}},Pqe={equals:Object.is,isShallow:!1,pathAsArray:!1,ignoreSymbols:!1,ignoreUnderscores:!1,ignoreDetached:!1,details:!1},aG=(t,e,i={})=>{i={...Pqe,...i};let r=Symbol("ProxyTarget"),{equals:n,isShallow:s,ignoreDetached:a,details:o}=i,l=new bqe(n),c=typeof i.onValidate=="function",u=new Mw(c),h=(b,w,E,M,A)=>!c||u.isCloning||i.onValidate(cu.concat(l.getPath(b),w),E,M,A)===!0,d=(b,w,E,M)=>{!wQ(l,i,w)&&!(a&&l.isDetached(b,t))&&f(l.getPath(b),w,E,M)},f=(b,w,E,M,A)=>{u.isCloning?u.update(b,w,M):e(cu.concat(b,w),E,M,A)},p=b=>b&&(b[r]||b),g=(b,w,E,M)=>gqe(b)||E==="constructor"||s&&!Mw.isHandledMethod(w,E)||wQ(l,i,E)||l.isGetInvariant(w,E)||a&&l.isDetached(w,t)?b:(M===void 0&&(M=l.getPath(w)),l.getProxy(b,cu.concat(M,E),m,r)),m={get(b,w,E){if(sG(w)){if(w===r||w===nG)return b;if(w===Hhe&&!l.isUnsubscribed&&l.getPath(b).length===0)return l.unsubscribe(),b}let M=Lj(b)?Reflect.get(b,w):Reflect.get(b,w,E);return g(M,b,w)},set(b,w,E,M){E=p(E);let A=b[r]||b,P=A[w];if(n(P,E)&&w in b)return!0;let C=h(b,w,E,P);return C&&l.setProperty(A,w,E,M,P)?(d(b,w,b[w],P),!0):!C},defineProperty(b,w,E){if(!l.isSameDescriptor(E,b,w)){let M=b[w];h(b,w,E.value,M)&&l.defineProperty(b,w,E,M)&&d(b,w,E.value,M)}return!0},deleteProperty(b,w){if(!Reflect.has(b,w))return!0;let E=Reflect.get(b,w),M=h(b,w,void 0,E);return M&&l.deleteProperty(b,w,E)?(d(b,w,void 0,E),!0):!M},apply(b,w,E){let M=w[r]||w;if(l.isUnsubscribed)return Reflect.apply(b,M,E);if((o===!1||o!==!0&&!o.includes(b.name))&&Mw.isHandledType(M)){let A=cu.initial(l.getPath(b)),P=Mw.isHandledMethod(M,b.name);u.start(M,A,E);let C=Reflect.apply(b,u.preferredThisArg(b,w,M),P?E.map(k=>p(k)):E),R=u.isChanged(M,n),I=u.stop();if(Mw.isHandledType(C)&&P&&(w instanceof Map&&b.name==="get"&&(A=cu.concat(A,E[0])),C=l.getProxy(C,A,m)),R){let k={name:b.name,args:E,result:C},z=u.isCloning?cu.initial(A):A,V=u.isCloning?cu.last(A):"";h(cu.get(t,z),V,M,I,k)?f(z,V,M,I,k):u.undo(M)}return(w instanceof Map||w instanceof Set)&&yqe(C)?xqe(C,b,w,A,g):C}return Reflect.apply(b,w,E)}},y=l.getProxy(t,i.pathAsArray?[]:"",m);return e=e.bind(y),c&&(i.onValidate=i.onValidate.bind(y)),y};aG.target=t=>t&&t[nG]||t;aG.unsubscribe=t=>t[Hhe]||t;var AQ=aG,Rqe=typeof global=="object"&&global&&global.Object===Object&&global,Khe=Rqe,Iqe=typeof self=="object"&&self&&self.Object===Object&&self,Dqe=Khe||Iqe||Function("return this")(),Bh=Dqe,Oqe=Bh.Symbol,Su=Oqe,Zhe=Object.prototype,Lqe=Zhe.hasOwnProperty,kqe=Zhe.toString,pE=Su?Su.toStringTag:void 0;function Nqe(t){var e=Lqe.call(t,pE),i=t[pE];try{t[pE]=void 0;var r=!0}catch{}var n=kqe.call(t);return r&&(e?t[pE]=i:delete t[pE]),n}var Uqe=Nqe,Bqe=Object.prototype,Fqe=Bqe.toString;function zqe(t){return Fqe.call(t)}var jqe=zqe,Vqe="[object Null]",Hqe="[object Undefined]",MQ=Su?Su.toStringTag:void 0;function Gqe(t){return t==null?t===void 0?Hqe:Vqe:MQ&&MQ in Object(t)?Uqe(t):jqe(t)}var Y0=Gqe;function Wqe(t){return t!=null&&typeof t=="object"}var $p=Wqe,qqe="[object Symbol]";function Xqe(t){return typeof t=="symbol"||$p(t)&&Y0(t)==qqe}var BT=Xqe;function $qe(t,e){for(var i=-1,r=t==null?0:t.length,n=Array(r);++i<r;)n[i]=e(t[i],i,t);return n}var Qhe=$qe,Yqe=Array.isArray,tf=Yqe,TQ=Su?Su.prototype:void 0,CQ=TQ?TQ.toString:void 0;function Jhe(t){if(typeof t=="string")return t;if(tf(t))return Qhe(t,Jhe)+"";if(BT(t))return CQ?CQ.call(t):"";var e=t+"";return e=="0"&&1/t==-1/0?"-0":e}var ede=Jhe,Kqe=/\s/;function Zqe(t){for(var e=t.length;e--&&Kqe.test(t.charAt(e)););return e}var tde=Zqe,Qqe=/^\s+/;function Jqe(t){return t&&t.slice(0,tde(t)+1).replace(Qqe,"")}var eXe=Jqe;function tXe(t){var e=typeof t;return t!=null&&(e=="object"||e=="function")}var Nc=tXe,PQ=NaN,iXe=/^[-+]0x[0-9a-f]+$/i,rXe=/^0b[01]+$/i,nXe=/^0o[0-7]+$/i,sXe=parseInt;function aXe(t){if(typeof t=="number")return t;if(BT(t))return PQ;if(Nc(t)){var e=typeof t.valueOf=="function"?t.valueOf():t;t=Nc(e)?e+"":e}if(typeof t!="string")return t===0?t:+t;t=eXe(t);var i=rXe.test(t);return i||nXe.test(t)?sXe(t.slice(2),i?2:8):iXe.test(t)?PQ:+t}var RQ=aXe;function oXe(t){return t}var ide=oXe,lXe="[object AsyncFunction]",cXe="[object Function]",uXe="[object GeneratorFunction]",hXe="[object Proxy]";function dXe(t){if(!Nc(t))return!1;var e=Y0(t);return e==cXe||e==uXe||e==lXe||e==hXe}var rde=dXe,fXe=Bh["__core-js_shared__"],dF=fXe,IQ=(function(){var t=/[^.]+$/.exec(dF&&dF.keys&&dF.keys.IE_PROTO||"");return t?"Symbol(src)_1."+t:""})();function pXe(t){return!!IQ&&IQ in t}var mXe=pXe,gXe=Function.prototype,vXe=gXe.toString;function yXe(t){if(t!=null){try{return vXe.call(t)}catch{}try{return t+""}catch{}}return""}var K0=yXe,xXe=/[\\^$.*+?()[\]{}|]/g,bXe=/^\[object .+?Constructor\]$/,wXe=Function.prototype,_Xe=Object.prototype,SXe=wXe.toString,EXe=_Xe.hasOwnProperty,AXe=RegExp("^"+SXe.call(EXe).replace(xXe,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function MXe(t){if(!Nc(t)||mXe(t))return!1;var e=rde(t)?AXe:bXe;return e.test(K0(t))}var TXe=MXe;function CXe(t,e){return t?.[e]}var PXe=CXe;function RXe(t,e){var i=PXe(t,e);return TXe(i)?i:void 0}var Z0=RXe,IXe=Z0(Bh,"WeakMap"),Nj=IXe,DQ=Object.create,DXe=(function(){function t(){}return function(e){if(!Nc(e))return{};if(DQ)return DQ(e);t.prototype=e;var i=new t;return t.prototype=void 0,i}})(),OXe=DXe;function LXe(t,e,i){switch(i.length){case 0:return t.call(e);case 1:return t.call(e,i[0]);case 2:return t.call(e,i[0],i[1]);case 3:return t.call(e,i[0],i[1],i[2])}return t.apply(e,i)}var kXe=LXe;function NXe(t,e){var i=-1,r=t.length;for(e||(e=Array(r));++i<r;)e[i]=t[i];return e}var UXe=NXe,BXe=800,FXe=16,zXe=Date.now;function jXe(t){var e=0,i=0;return function(){var r=zXe(),n=FXe-(r-i);if(i=r,n>0){if(++e>=BXe)return arguments[0]}else e=0;return t.apply(void 0,arguments)}}var VXe=jXe;function HXe(t){return function(){return t}}var GXe=HXe,WXe=(function(){try{var t=Z0(Object,"defineProperty");return t({},"",{}),t}catch{}})(),QD=WXe,qXe=QD?function(t,e){return QD(t,"toString",{configurable:!0,enumerable:!1,value:GXe(e),writable:!0})}:ide,XXe=qXe,$Xe=VXe(XXe),YXe=$Xe;function KXe(t,e){for(var i=-1,r=t==null?0:t.length;++i<r&&e(t[i],i,t)!==!1;);return t}var ZXe=KXe;function QXe(t,e,i,r){for(var n=t.length,s=i+(r?1:-1);r?s--:++s<n;)if(e(t[s],s,t))return s;return-1}var JXe=QXe;function e$e(t){return t!==t}var t$e=e$e;function i$e(t,e,i){for(var r=i-1,n=t.length;++r<n;)if(t[r]===e)return r;return-1}var r$e=i$e;function n$e(t,e,i){return e===e?r$e(t,e,i):JXe(t,t$e,i)}var s$e=n$e,a$e=9007199254740991,o$e=/^(?:0|[1-9]\d*)$/;function l$e(t,e){var i=typeof t;return e=e??a$e,!!e&&(i=="number"||i!="symbol"&&o$e.test(t))&&t>-1&&t%1==0&&t<e}var oG=l$e;function c$e(t,e,i){e=="__proto__"&&QD?QD(t,e,{configurable:!0,enumerable:!0,value:i,writable:!0}):t[e]=i}var nde=c$e;function u$e(t,e){return t===e||t!==t&&e!==e}var lG=u$e,h$e=Object.prototype,d$e=h$e.hasOwnProperty;function f$e(t,e,i){var r=t[e];(!(d$e.call(t,e)&&lG(r,i))||i===void 0&&!(e in t))&&nde(t,e,i)}var cG=f$e;function p$e(t,e,i,r){var n=!i;i||(i={});for(var s=-1,a=e.length;++s<a;){var o=e[s],l=r?r(i[o],t[o],o,i,t):void 0;l===void 0&&(l=t[o]),n?nde(i,o,l):cG(i,o,l)}return i}var FT=p$e,OQ=Math.max;function m$e(t,e,i){return e=OQ(e===void 0?t.length-1:e,0),function(){for(var r=arguments,n=-1,s=OQ(r.length-e,0),a=Array(s);++n<s;)a[n]=r[e+n];n=-1;for(var o=Array(e+1);++n<e;)o[n]=r[n];return o[e]=i(a),kXe(t,this,o)}}var g$e=m$e,v$e=9007199254740991;function y$e(t){return typeof t=="number"&&t>-1&&t%1==0&&t<=v$e}var uG=y$e;function x$e(t){return t!=null&&uG(t.length)&&!rde(t)}var sde=x$e,b$e=Object.prototype;function w$e(t){var e=t&&t.constructor,i=typeof e=="function"&&e.prototype||b$e;return t===i}var hG=w$e;function _$e(t,e){for(var i=-1,r=Array(t);++i<t;)r[i]=e(i);return r}var S$e=_$e,E$e="[object Arguments]";function A$e(t){return $p(t)&&Y0(t)==E$e}var LQ=A$e,ade=Object.prototype,M$e=ade.hasOwnProperty,T$e=ade.propertyIsEnumerable,C$e=LQ((function(){return arguments})())?LQ:function(t){return $p(t)&&M$e.call(t,"callee")&&!T$e.call(t,"callee")},dG=C$e;function P$e(){return!1}var R$e=P$e,ode=typeof exports=="object"&&exports&&!exports.nodeType&&exports,kQ=ode&&typeof module=="object"&&module&&!module.nodeType&&module,I$e=kQ&&kQ.exports===ode,NQ=I$e?Bh.Buffer:void 0,D$e=NQ?NQ.isBuffer:void 0,O$e=D$e||R$e,JD=O$e,L$e="[object Arguments]",k$e="[object Array]",N$e="[object Boolean]",U$e="[object Date]",B$e="[object Error]",F$e="[object Function]",z$e="[object Map]",j$e="[object Number]",V$e="[object Object]",H$e="[object RegExp]",G$e="[object Set]",W$e="[object String]",q$e="[object WeakMap]",X$e="[object ArrayBuffer]",$$e="[object DataView]",Y$e="[object Float32Array]",K$e="[object Float64Array]",Z$e="[object Int8Array]",Q$e="[object Int16Array]",J$e="[object Int32Array]",eYe="[object Uint8Array]",tYe="[object Uint8ClampedArray]",iYe="[object Uint16Array]",rYe="[object Uint32Array]",On={};On[Y$e]=On[K$e]=On[Z$e]=On[Q$e]=On[J$e]=On[eYe]=On[tYe]=On[iYe]=On[rYe]=!0;On[L$e]=On[k$e]=On[X$e]=On[N$e]=On[$$e]=On[U$e]=On[B$e]=On[F$e]=On[z$e]=On[j$e]=On[V$e]=On[H$e]=On[G$e]=On[W$e]=On[q$e]=!1;function nYe(t){return $p(t)&&uG(t.length)&&!!On[Y0(t)]}var sYe=nYe;function aYe(t){return function(e){return t(e)}}var fG=aYe,lde=typeof exports=="object"&&exports&&!exports.nodeType&&exports,RA=lde&&typeof module=="object"&&module&&!module.nodeType&&module,oYe=RA&&RA.exports===lde,fF=oYe&&Khe.process,lYe=(function(){try{var t=RA&&RA.require&&RA.require("util").types;return t||fF&&fF.binding&&fF.binding("util")}catch{}})(),G1=lYe,UQ=G1&&G1.isTypedArray,cYe=UQ?fG(UQ):sYe,cde=cYe,uYe=Object.prototype,hYe=uYe.hasOwnProperty;function dYe(t,e){var i=tf(t),r=!i&&dG(t),n=!i&&!r&&JD(t),s=!i&&!r&&!n&&cde(t),a=i||r||n||s,o=a?S$e(t.length,String):[],l=o.length;for(var c in t)(e||hYe.call(t,c))&&!(a&&(c=="length"||n&&(c=="offset"||c=="parent")||s&&(c=="buffer"||c=="byteLength"||c=="byteOffset")||oG(c,l)))&&o.push(c);return o}var ude=dYe;function fYe(t,e){return function(i){return t(e(i))}}var hde=fYe,pYe=hde(Object.keys,Object),mYe=pYe,gYe=Object.prototype,vYe=gYe.hasOwnProperty;function yYe(t){if(!hG(t))return mYe(t);var e=[];for(var i in Object(t))vYe.call(t,i)&&i!="constructor"&&e.push(i);return e}var xYe=yYe;function bYe(t){return sde(t)?ude(t):xYe(t)}var pG=bYe;function wYe(t){var e=[];if(t!=null)for(var i in Object(t))e.push(i);return e}var _Ye=wYe,SYe=Object.prototype,EYe=SYe.hasOwnProperty;function AYe(t){if(!Nc(t))return _Ye(t);var e=hG(t),i=[];for(var r in t)r=="constructor"&&(e||!EYe.call(t,r))||i.push(r);return i}var MYe=AYe;function TYe(t){return sde(t)?ude(t,!0):MYe(t)}var e0=TYe,CYe=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,PYe=/^\w*$/;function RYe(t,e){if(tf(t))return!1;var i=typeof t;return i=="number"||i=="symbol"||i=="boolean"||t==null||BT(t)?!0:PYe.test(t)||!CYe.test(t)||e!=null&&t in Object(e)}var IYe=RYe,DYe=Z0(Object,"create"),OM=DYe;function OYe(){this.__data__=OM?OM(null):{},this.size=0}var LYe=OYe;function kYe(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e}var NYe=kYe,UYe="__lodash_hash_undefined__",BYe=Object.prototype,FYe=BYe.hasOwnProperty;function zYe(t){var e=this.__data__;if(OM){var i=e[t];return i===UYe?void 0:i}return FYe.call(e,t)?e[t]:void 0}var jYe=zYe,VYe=Object.prototype,HYe=VYe.hasOwnProperty;function GYe(t){var e=this.__data__;return OM?e[t]!==void 0:HYe.call(e,t)}var WYe=GYe,qYe="__lodash_hash_undefined__";function XYe(t,e){var i=this.__data__;return this.size+=this.has(t)?0:1,i[t]=OM&&e===void 0?qYe:e,this}var $Ye=XYe;function P_(t){var e=-1,i=t==null?0:t.length;for(this.clear();++e<i;){var r=t[e];this.set(r[0],r[1])}}P_.prototype.clear=LYe;P_.prototype.delete=NYe;P_.prototype.get=jYe;P_.prototype.has=WYe;P_.prototype.set=$Ye;var BQ=P_;function YYe(){this.__data__=[],this.size=0}var KYe=YYe;function ZYe(t,e){for(var i=t.length;i--;)if(lG(t[i][0],e))return i;return-1}var hL=ZYe,QYe=Array.prototype,JYe=QYe.splice;function eKe(t){var e=this.__data__,i=hL(e,t);if(i<0)return!1;var r=e.length-1;return i==r?e.pop():JYe.call(e,i,1),--this.size,!0}var tKe=eKe;function iKe(t){var e=this.__data__,i=hL(e,t);return i<0?void 0:e[i][1]}var rKe=iKe;function nKe(t){return hL(this.__data__,t)>-1}var sKe=nKe;function aKe(t,e){var i=this.__data__,r=hL(i,t);return r<0?(++this.size,i.push([t,e])):i[r][1]=e,this}var oKe=aKe;function R_(t){var e=-1,i=t==null?0:t.length;for(this.clear();++e<i;){var r=t[e];this.set(r[0],r[1])}}R_.prototype.clear=KYe;R_.prototype.delete=tKe;R_.prototype.get=rKe;R_.prototype.has=sKe;R_.prototype.set=oKe;var dL=R_,lKe=Z0(Bh,"Map"),LM=lKe;function cKe(){this.size=0,this.__data__={hash:new BQ,map:new(LM||dL),string:new BQ}}var uKe=cKe;function hKe(t){var e=typeof t;return e=="string"||e=="number"||e=="symbol"||e=="boolean"?t!=="__proto__":t===null}var dKe=hKe;function fKe(t,e){var i=t.__data__;return dKe(e)?i[typeof e=="string"?"string":"hash"]:i.map}var fL=fKe;function pKe(t){var e=fL(this,t).delete(t);return this.size-=e?1:0,e}var mKe=pKe;function gKe(t){return fL(this,t).get(t)}var vKe=gKe;function yKe(t){return fL(this,t).has(t)}var xKe=yKe;function bKe(t,e){var i=fL(this,t),r=i.size;return i.set(t,e),this.size+=i.size==r?0:1,this}var wKe=bKe;function I_(t){var e=-1,i=t==null?0:t.length;for(this.clear();++e<i;){var r=t[e];this.set(r[0],r[1])}}I_.prototype.clear=uKe;I_.prototype.delete=mKe;I_.prototype.get=vKe;I_.prototype.has=xKe;I_.prototype.set=wKe;var pL=I_,_Ke="Expected a function";function mG(t,e){if(typeof t!="function"||e!=null&&typeof e!="function")throw new TypeError(_Ke);var i=function(){var r=arguments,n=e?e.apply(this,r):r[0],s=i.cache;if(s.has(n))return s.get(n);var a=t.apply(this,r);return i.cache=s.set(n,a)||s,a};return i.cache=new(mG.Cache||pL),i}mG.Cache=pL;var SKe=mG,EKe=500;function AKe(t){var e=SKe(t,function(r){return i.size===EKe&&i.clear(),r}),i=e.cache;return e}var MKe=AKe,TKe=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,CKe=/\\(\\)?/g,PKe=MKe(function(t){var e=[];return t.charCodeAt(0)===46&&e.push(""),t.replace(TKe,function(i,r,n,s){e.push(n?s.replace(CKe,"$1"):r||i)}),e}),RKe=PKe;function IKe(t){return t==null?"":ede(t)}var dde=IKe;function DKe(t,e){return tf(t)?t:IYe(t,e)?[t]:RKe(dde(t))}var D_=DKe;function OKe(t){if(typeof t=="string"||BT(t))return t;var e=t+"";return e=="0"&&1/t==-1/0?"-0":e}var mL=OKe;function LKe(t,e){e=D_(e,t);for(var i=0,r=e.length;t!=null&&i<r;)t=t[mL(e[i++])];return i&&i==r?t:void 0}var fde=LKe;function kKe(t,e){for(var i=-1,r=e.length,n=t.length;++i<r;)t[n+i]=e[i];return t}var gG=kKe,FQ=Su?Su.isConcatSpreadable:void 0;function NKe(t){return tf(t)||dG(t)||!!(FQ&&t&&t[FQ])}var UKe=NKe;function pde(t,e,i,r,n){var s=-1,a=t.length;for(i||(i=UKe),n||(n=[]);++s<a;){var o=t[s];e>0&&i(o)?e>1?pde(o,e-1,i,r,n):gG(n,o):r||(n[n.length]=o)}return n}var BKe=pde;function FKe(t){var e=t==null?0:t.length;return e?BKe(t,1):[]}var zKe=FKe;function jKe(t){return YXe(g$e(t,void 0,zKe),t+"")}var mde=jKe,VKe=hde(Object.getPrototypeOf,Object),vG=VKe,HKe="[object Object]",GKe=Function.prototype,WKe=Object.prototype,gde=GKe.toString,qKe=WKe.hasOwnProperty,XKe=gde.call(Object);function $Ke(t){if(!$p(t)||Y0(t)!=HKe)return!1;var e=vG(t);if(e===null)return!0;var i=qKe.call(e,"constructor")&&e.constructor;return typeof i=="function"&&i instanceof i&&gde.call(i)==XKe}var YKe=$Ke;function KKe(t,e,i){var r=-1,n=t.length;e<0&&(e=-e>n?0:n+e),i=i>n?n:i,i<0&&(i+=n),n=e>i?0:i-e>>>0,e>>>=0;for(var s=Array(n);++r<n;)s[r]=t[r+e];return s}var vde=KKe;function ZKe(t,e,i){var r=t.length;return i=i===void 0?r:i,!e&&i>=r?t:vde(t,e,i)}var QKe=ZKe,JKe="\\ud800-\\udfff",eZe="\\u0300-\\u036f",tZe="\\ufe20-\\ufe2f",iZe="\\u20d0-\\u20ff",rZe=eZe+tZe+iZe,nZe="\\ufe0e\\ufe0f",sZe="\\u200d",aZe=RegExp("["+sZe+JKe+rZe+nZe+"]");function oZe(t){return aZe.test(t)}var lZe=oZe;function cZe(t){return t.split("")}var uZe=cZe,yde="\\ud800-\\udfff",hZe="\\u0300-\\u036f",dZe="\\ufe20-\\ufe2f",fZe="\\u20d0-\\u20ff",pZe=hZe+dZe+fZe,mZe="\\ufe0e\\ufe0f",gZe="["+yde+"]",Uj="["+pZe+"]",Bj="\\ud83c[\\udffb-\\udfff]",vZe="(?:"+Uj+"|"+Bj+")",xde="[^"+yde+"]",bde="(?:\\ud83c[\\udde6-\\uddff]){2}",wde="[\\ud800-\\udbff][\\udc00-\\udfff]",yZe="\\u200d",_de=vZe+"?",Sde="["+mZe+"]?",xZe="(?:"+yZe+"(?:"+[xde,bde,wde].join("|")+")"+Sde+_de+")*",bZe=Sde+_de+xZe,wZe="(?:"+[xde+Uj+"?",Uj,bde,wde,gZe].join("|")+")",_Ze=RegExp(Bj+"(?="+Bj+")|"+wZe+bZe,"g");function SZe(t){return t.match(_Ze)||[]}var EZe=SZe;function AZe(t){return lZe(t)?EZe(t):uZe(t)}var zQ=AZe;function MZe(){this.__data__=new dL,this.size=0}var TZe=MZe;function CZe(t){var e=this.__data__,i=e.delete(t);return this.size=e.size,i}var PZe=CZe;function RZe(t){return this.__data__.get(t)}var IZe=RZe;function DZe(t){return this.__data__.has(t)}var OZe=DZe,LZe=200;function kZe(t,e){var i=this.__data__;if(i instanceof dL){var r=i.__data__;if(!LM||r.length<LZe-1)return r.push([t,e]),this.size=++i.size,this;i=this.__data__=new pL(r)}return i.set(t,e),this.size=i.size,this}var NZe=kZe;function O_(t){var e=this.__data__=new dL(t);this.size=e.size}O_.prototype.clear=TZe;O_.prototype.delete=PZe;O_.prototype.get=IZe;O_.prototype.has=OZe;O_.prototype.set=NZe;var sI=O_;function UZe(t,e){return t&&FT(e,pG(e),t)}var BZe=UZe;function FZe(t,e){return t&&FT(e,e0(e),t)}var zZe=FZe,Ede=typeof exports=="object"&&exports&&!exports.nodeType&&exports,jQ=Ede&&typeof module=="object"&&module&&!module.nodeType&&module,jZe=jQ&&jQ.exports===Ede,VQ=jZe?Bh.Buffer:void 0,HQ=VQ?VQ.allocUnsafe:void 0;function VZe(t,e){if(e)return t.slice();var i=t.length,r=HQ?HQ(i):new t.constructor(i);return t.copy(r),r}var HZe=VZe;function GZe(t,e){for(var i=-1,r=t==null?0:t.length,n=0,s=[];++i<r;){var a=t[i];e(a,i,t)&&(s[n++]=a)}return s}var WZe=GZe;function qZe(){return[]}var Ade=qZe,XZe=Object.prototype,$Ze=XZe.propertyIsEnumerable,GQ=Object.getOwnPropertySymbols,YZe=GQ?function(t){return t==null?[]:(t=Object(t),WZe(GQ(t),function(e){return $Ze.call(t,e)}))}:Ade,yG=YZe;function KZe(t,e){return FT(t,yG(t),e)}var ZZe=KZe,QZe=Object.getOwnPropertySymbols,JZe=QZe?function(t){for(var e=[];t;)gG(e,yG(t)),t=vG(t);return e}:Ade,Mde=JZe;function eQe(t,e){return FT(t,Mde(t),e)}var tQe=eQe;function iQe(t,e,i){var r=e(t);return tf(t)?r:gG(r,i(t))}var Tde=iQe;function rQe(t){return Tde(t,pG,yG)}var Fj=rQe;function nQe(t){return Tde(t,e0,Mde)}var Cde=nQe,sQe=Z0(Bh,"DataView"),zj=sQe,aQe=Z0(Bh,"Promise"),jj=aQe,oQe=Z0(Bh,"Set"),Vj=oQe,WQ="[object Map]",lQe="[object Object]",qQ="[object Promise]",XQ="[object Set]",$Q="[object WeakMap]",YQ="[object DataView]",cQe=K0(zj),uQe=K0(LM),hQe=K0(jj),dQe=K0(Vj),fQe=K0(Nj),Uy=Y0;(zj&&Uy(new zj(new ArrayBuffer(1)))!=YQ||LM&&Uy(new LM)!=WQ||jj&&Uy(jj.resolve())!=qQ||Vj&&Uy(new Vj)!=XQ||Nj&&Uy(new Nj)!=$Q)&&(Uy=function(t){var e=Y0(t),i=e==lQe?t.constructor:void 0,r=i?K0(i):"";if(r)switch(r){case cQe:return YQ;case uQe:return WQ;case hQe:return qQ;case dQe:return XQ;case fQe:return $Q}return e});var kM=Uy,pQe=Object.prototype,mQe=pQe.hasOwnProperty;function gQe(t){var e=t.length,i=new t.constructor(e);return e&&typeof t[0]=="string"&&mQe.call(t,"index")&&(i.index=t.index,i.input=t.input),i}var vQe=gQe,yQe=Bh.Uint8Array,e3=yQe;function xQe(t){var e=new t.constructor(t.byteLength);return new e3(e).set(new e3(t)),e}var xG=xQe;function bQe(t,e){var i=e?xG(t.buffer):t.buffer;return new t.constructor(i,t.byteOffset,t.byteLength)}var wQe=bQe,_Qe=/\w*$/;function SQe(t){var e=new t.constructor(t.source,_Qe.exec(t));return e.lastIndex=t.lastIndex,e}var EQe=SQe,KQ=Su?Su.prototype:void 0,ZQ=KQ?KQ.valueOf:void 0;function AQe(t){return ZQ?Object(ZQ.call(t)):{}}var MQe=AQe;function TQe(t,e){var i=e?xG(t.buffer):t.buffer;return new t.constructor(i,t.byteOffset,t.length)}var CQe=TQe,PQe="[object Boolean]",RQe="[object Date]",IQe="[object Map]",DQe="[object Number]",OQe="[object RegExp]",LQe="[object Set]",kQe="[object String]",NQe="[object Symbol]",UQe="[object ArrayBuffer]",BQe="[object DataView]",FQe="[object Float32Array]",zQe="[object Float64Array]",jQe="[object Int8Array]",VQe="[object Int16Array]",HQe="[object Int32Array]",GQe="[object Uint8Array]",WQe="[object Uint8ClampedArray]",qQe="[object Uint16Array]",XQe="[object Uint32Array]";function $Qe(t,e,i){var r=t.constructor;switch(e){case UQe:return xG(t);case PQe:case RQe:return new r(+t);case BQe:return wQe(t,i);case FQe:case zQe:case jQe:case VQe:case HQe:case GQe:case WQe:case qQe:case XQe:return CQe(t,i);case IQe:return new r;case DQe:case kQe:return new r(t);case OQe:return EQe(t);case LQe:return new r;case NQe:return MQe(t)}}var YQe=$Qe;function KQe(t){return typeof t.constructor=="function"&&!hG(t)?OXe(vG(t)):{}}var ZQe=KQe,QQe="[object Map]";function JQe(t){return $p(t)&&kM(t)==QQe}var eJe=JQe,QQ=G1&&G1.isMap,tJe=QQ?fG(QQ):eJe,iJe=tJe,rJe="[object Set]";function nJe(t){return $p(t)&&kM(t)==rJe}var sJe=nJe,JQ=G1&&G1.isSet,aJe=JQ?fG(JQ):sJe,oJe=aJe,lJe=1,cJe=2,uJe=4,Pde="[object Arguments]",hJe="[object Array]",dJe="[object Boolean]",fJe="[object Date]",pJe="[object Error]",Rde="[object Function]",mJe="[object GeneratorFunction]",gJe="[object Map]",vJe="[object Number]",Ide="[object Object]",yJe="[object RegExp]",xJe="[object Set]",bJe="[object String]",wJe="[object Symbol]",_Je="[object WeakMap]",SJe="[object ArrayBuffer]",EJe="[object DataView]",AJe="[object Float32Array]",MJe="[object Float64Array]",TJe="[object Int8Array]",CJe="[object Int16Array]",PJe="[object Int32Array]",RJe="[object Uint8Array]",IJe="[object Uint8ClampedArray]",DJe="[object Uint16Array]",OJe="[object Uint32Array]",Cn={};Cn[Pde]=Cn[hJe]=Cn[SJe]=Cn[EJe]=Cn[dJe]=Cn[fJe]=Cn[AJe]=Cn[MJe]=Cn[TJe]=Cn[CJe]=Cn[PJe]=Cn[gJe]=Cn[vJe]=Cn[Ide]=Cn[yJe]=Cn[xJe]=Cn[bJe]=Cn[wJe]=Cn[RJe]=Cn[IJe]=Cn[DJe]=Cn[OJe]=!0;Cn[pJe]=Cn[Rde]=Cn[_Je]=!1;function aI(t,e,i,r,n,s){var a,o=e&lJe,l=e&cJe,c=e&uJe;if(i&&(a=n?i(t,r,n,s):i(t)),a!==void 0)return a;if(!Nc(t))return t;var u=tf(t);if(u){if(a=vQe(t),!o)return UXe(t,a)}else{var h=kM(t),d=h==Rde||h==mJe;if(JD(t))return HZe(t,o);if(h==Ide||h==Pde||d&&!n){if(a=l||d?{}:ZQe(t),!o)return l?tQe(t,zZe(a,t)):ZZe(t,BZe(a,t))}else{if(!Cn[h])return n?t:{};a=YQe(t,h,o)}}s||(s=new sI);var f=s.get(t);if(f)return f;s.set(t,a),oJe(t)?t.forEach(function(m){a.add(aI(m,e,i,m,t,s))}):iJe(t)&&t.forEach(function(m,y){a.set(y,aI(m,e,i,y,t,s))});var p=c?l?Cde:Fj:l?e0:pG,g=u?void 0:p(t);return ZXe(g||t,function(m,y){g&&(y=m,m=t[y]),cG(a,y,aI(m,e,i,y,t,s))}),a}var Dde=aI,LJe=1,kJe=4;function NJe(t){return Dde(t,LJe|kJe)}var gL=NJe,UJe="__lodash_hash_undefined__";function BJe(t){return this.__data__.set(t,UJe),this}var FJe=BJe;function zJe(t){return this.__data__.has(t)}var jJe=zJe;function t3(t){var e=-1,i=t==null?0:t.length;for(this.__data__=new pL;++e<i;)this.add(t[e])}t3.prototype.add=t3.prototype.push=FJe;t3.prototype.has=jJe;var VJe=t3;function HJe(t,e){for(var i=-1,r=t==null?0:t.length;++i<r;)if(e(t[i],i,t))return!0;return!1}var GJe=HJe;function WJe(t,e){return t.has(e)}var qJe=WJe,XJe=1,$Je=2;function YJe(t,e,i,r,n,s){var a=i&XJe,o=t.length,l=e.length;if(o!=l&&!(a&&l>o))return!1;var c=s.get(t),u=s.get(e);if(c&&u)return c==e&&u==t;var h=-1,d=!0,f=i&$Je?new VJe:void 0;for(s.set(t,e),s.set(e,t);++h<o;){var p=t[h],g=e[h];if(r)var m=a?r(g,p,h,e,t,s):r(p,g,h,t,e,s);if(m!==void 0){if(m)continue;d=!1;break}if(f){if(!GJe(e,function(y,b){if(!qJe(f,b)&&(p===y||n(p,y,i,r,s)))return f.push(b)})){d=!1;break}}else if(!(p===g||n(p,g,i,r,s))){d=!1;break}}return s.delete(t),s.delete(e),d}var Ode=YJe;function KJe(t){var e=-1,i=Array(t.size);return t.forEach(function(r,n){i[++e]=[n,r]}),i}var ZJe=KJe;function QJe(t){var e=-1,i=Array(t.size);return t.forEach(function(r){i[++e]=r}),i}var JJe=QJe,eet=1,tet=2,iet="[object Boolean]",ret="[object Date]",net="[object Error]",set="[object Map]",aet="[object Number]",oet="[object RegExp]",cet="[object Set]",uet="[object String]",het="[object Symbol]",det="[object ArrayBuffer]",fet="[object DataView]",eJ=Su?Su.prototype:void 0,pF=eJ?eJ.valueOf:void 0;function pet(t,e,i,r,n,s,a){switch(i){case fet:if(t.byteLength!=e.byteLength||t.byteOffset!=e.byteOffset)return!1;t=t.buffer,e=e.buffer;case det:return!(t.byteLength!=e.byteLength||!s(new e3(t),new e3(e)));case iet:case ret:case aet:return lG(+t,+e);case net:return t.name==e.name&&t.message==e.message;case oet:case uet:return t==e+"";case set:var o=ZJe;case cet:var l=r&eet;if(o||(o=JJe),t.size!=e.size&&!l)return!1;var c=a.get(t);if(c)return c==e;r|=tet,a.set(t,e);var u=Ode(o(t),o(e),r,n,s,a);return a.delete(t),u;case het:if(pF)return pF.call(t)==pF.call(e)}return!1}var met=pet,get=1,vet=Object.prototype,yet=vet.hasOwnProperty;function xet(t,e,i,r,n,s){var a=i&get,o=Fj(t),l=o.length,c=Fj(e),u=c.length;if(l!=u&&!a)return!1;for(var h=l;h--;){var d=o[h];if(!(a?d in e:yet.call(e,d)))return!1}var f=s.get(t),p=s.get(e);if(f&&p)return f==e&&p==t;var g=!0;s.set(t,e),s.set(e,t);for(var m=a;++h<l;){d=o[h];var y=t[d],b=e[d];if(r)var w=a?r(b,y,d,e,t,s):r(y,b,d,t,e,s);if(!(w===void 0?y===b||n(y,b,i,r,s):w)){g=!1;break}m||(m=d=="constructor")}if(g&&!m){var E=t.constructor,M=e.constructor;E!=M&&"constructor"in t&&"constructor"in e&&!(typeof E=="function"&&E instanceof E&&typeof M=="function"&&M instanceof M)&&(g=!1)}return s.delete(t),s.delete(e),g}var bet=xet,wet=1,tJ="[object Arguments]",iJ="[object Array]",GP="[object Object]",_et=Object.prototype,rJ=_et.hasOwnProperty;function Eet(t,e,i,r,n,s){var a=tf(t),o=tf(e),l=a?iJ:kM(t),c=o?iJ:kM(e);l=l==tJ?GP:l,c=c==tJ?GP:c;var u=l==GP,h=c==GP,d=l==c;if(d&&JD(t)){if(!JD(e))return!1;a=!0,u=!1}if(d&&!u)return s||(s=new sI),a||cde(t)?Ode(t,e,i,r,n,s):met(t,e,l,i,r,n,s);if(!(i&wet)){var f=u&&rJ.call(t,"__wrapped__"),p=h&&rJ.call(e,"__wrapped__");if(f||p){var g=f?t.value():t,m=p?e.value():e;return s||(s=new sI),n(g,m,i,r,s)}}return d?(s||(s=new sI),bet(t,e,i,r,n,s)):!1}var Aet=Eet;function Lde(t,e,i,r,n){return t===e?!0:t==null||e==null||!$p(t)&&!$p(e)?t!==t&&e!==e:Aet(t,e,i,r,Lde,n)}var Met=Lde;function Tet(t,e){return t!=null&&e in Object(t)}var Cet=Tet;function Pet(t,e,i){e=D_(e,t);for(var r=-1,n=e.length,s=!1;++r<n;){var a=mL(e[r]);if(!(s=t!=null&&i(t,a)))break;t=t[a]}return s||++r!=n?s:(n=t==null?0:t.length,!!n&&uG(n)&&oG(a,n)&&(tf(t)||dG(t)))}var Ret=Pet;function Iet(t,e){return t!=null&&Ret(t,e,Cet)}var Det=Iet,Oet=function(){return Bh.Date.now()},mF=Oet,Let="Expected a function",ket=Math.max,Net=Math.min;function Uet(t,e,i){var r,n,s,a,o,l,c=0,u=!1,h=!1,d=!0;if(typeof t!="function")throw new TypeError(Let);e=RQ(e)||0,Nc(i)&&(u=!!i.leading,h="maxWait"in i,s=h?ket(RQ(i.maxWait)||0,e):s,d="trailing"in i?!!i.trailing:d);function f(A){var P=r,C=n;return r=n=void 0,c=A,a=t.apply(C,P),a}function p(A){return c=A,o=setTimeout(y,e),u?f(A):a}function g(A){var P=A-l,C=A-c,R=e-P;return h?Net(R,s-C):R}function m(A){var P=A-l,C=A-c;return l===void 0||P>=e||P<0||h&&C>=s}function y(){var A=mF();if(m(A))return b(A);o=setTimeout(y,g(A))}function b(A){return o=void 0,d&&r?f(A):(r=n=void 0,a)}function w(){o!==void 0&&clearTimeout(o),c=0,r=l=n=o=void 0}function E(){return o===void 0?a:b(mF())}function M(){var A=mF(),P=m(A);if(r=arguments,n=this,l=A,P){if(o===void 0)return p(l);if(h)return clearTimeout(o),o=setTimeout(y,e),f(l)}return o===void 0&&(o=setTimeout(y,e)),a}return M.cancel=w,M.flush=E,M}var NM=Uet;function Bet(t){var e=t==null?0:t.length;return e?t[e-1]:void 0}var Fet=Bet;function zet(t,e){return t>e}var jet=zet;function Vet(t,e){return e.length<2?t:fde(t,vde(e,0,-1))}var Het=Vet;function Get(t,e){return Met(t,e)}var bG=Get;function Wet(t,e,i){for(var r=-1,n=t.length;++r<n;){var s=t[r],a=e(s);if(a!=null&&(o===void 0?a===a&&!BT(a):i(a,o)))var o=a,l=s}return l}var qet=Wet;function Xet(t){return t&&t.length?qet(t,ide,jet):void 0}var $et=Xet;function Yet(t,e){return e=D_(e,t),t=Het(t,e),t==null||delete t[mL(Fet(e))]}var Ket=Yet;function Zet(t){return YKe(t)?void 0:t}var Qet=Zet,Jet=1,ett=2,ttt=4,itt=mde(function(t,e){var i={};if(t==null)return i;var r=!1;e=Qhe(e,function(s){return s=D_(s,t),r||(r=s.length>1),s}),FT(t,Cde(t),i),r&&(i=Dde(i,Jet|ett|ttt,Qet));for(var n=e.length;n--;)Ket(i,e[n]);return i}),Hj=itt;function rtt(t,e,i,r){if(!Nc(t))return t;e=D_(e,t);for(var n=-1,s=e.length,a=s-1,o=t;o!=null&&++n<s;){var l=mL(e[n]),c=i;if(l==="__proto__"||l==="constructor"||l==="prototype")return t;if(n!=a){var u=o[l];c=r?r(u,l,o):void 0,c===void 0&&(c=Nc(u)?u:oG(e[n+1])?[]:{})}cG(o,l,c),o=o[l]}return t}var ntt=rtt;function stt(t,e,i){for(var r=-1,n=e.length,s={};++r<n;){var a=e[r],o=fde(t,a);i(o,a)&&ntt(s,D_(a,t),o)}return s}var att=stt;function ott(t,e){return att(t,e,function(i,r){return Det(t,r)})}var ltt=ott,ctt=mde(function(t,e){return t==null?{}:ltt(t,e)}),Wd=ctt,utt="Expected a function";function htt(t,e,i){var r=!0,n=!0;if(typeof t!="function")throw new TypeError(utt);return Nc(i)&&(r="leading"in i?!!i.leading:r,n="trailing"in i?!!i.trailing:n),NM(t,e,{leading:r,maxWait:e,trailing:n})}var dtt=htt;function ftt(t,e){for(var i=t.length;i--&&s$e(e,t[i],0)>-1;);return i}var ptt=ftt;function mtt(t,e,i){if(t=dde(t),t&&(i||e===void 0))return t.slice(0,tde(t)+1);if(!t||!(e=ede(e)))return t;var r=zQ(t),n=ptt(r,zQ(e))+1;return QKe(r,0,n).join("")}var gtt=mtt;function kde(t){for(let e of Object.keys(t))t[e]===void 0&&delete t[e];return t}function lc(t,e){return Object.setPrototypeOf(t,e),t}var vtt=()=>typeof window>"u"?!1:window.navigator.userAgent.toLowerCase().includes(" electron/"),ytt=()=>typeof window>"u"?!1:window.navigator.platform.toUpperCase().includes("MAC"),xtt=()=>typeof window>"u"?!1:/iPad|iPhone|iPod/.test(window.navigator.userAgent)||vL&&"ontouchend"in document,btt=()=>typeof window>"u"?!1:window.navigator.userAgent.toLowerCase().indexOf("firefox")>-1,wtt=()=>typeof window>"u"?!1:"ontouchstart"in window||navigator.maxTouchPoints>0,_tt=()=>{if(typeof window>"u")return!1;let t=navigator.userAgent,e=navigator.vendor;return/Safari/i.test(t)&&/Apple Computer/.test(e)},Stt=()=>{if(typeof window>"u")return null;let t=navigator.userAgent.match(/Version\/(\d+\.\d)/);return t&&t[1]},Ett=()=>{if(typeof window>"u")return;let t=new URLSearchParams(window.location.search).get("desktop-app-version");return t?(window.localStorage.setItem("desktop-app-version",t),t):window.localStorage.getItem("desktop-app-version")??"0.0.6"},Nde=vtt();Nde&&Ett();var vL=ytt(),L_=xtt(),Att=btt(),Pc=wtt(),nJ=_tt(),Mtt=Number(Stt());function Ude(t){return Array.isArray(t)?t:[t]}function Bde(t,e){let i=0;for(;i<t.length&&i<e.length;){if(t[i]<e[i])return-1;if(t[i]>e[i])return 1;i+=1}return i!==e.length?-1:i!==t.length?1:0}function WP(t){return vL?t.metaKey:t.ctrlKey}function Ttt(t){return t.wheelDeltaY===0||t.deltaY===0?vL&&t.shiftKey&&Math.abs(t.wheelDeltaX)>=120?!1:t.wheelDeltaX?t.wheelDeltaX===-3*t.deltaX||t.wheelDeltaX===-3*window.devicePixelRatio*t.deltaX:t.deltaMode===0:t.wheelDeltaY?t.wheelDeltaY===-3*t.deltaY||t.wheelDeltaY===-3*window.devicePixelRatio*t.deltaY:t.deltaMode===0}var Di=[],i3={},qE={},oI={};function Fde(t){Di.includes(t)||Di.push(t)}function o1(t){delete i3[t.pointerId];for(let e=0;e<Di.length;e++)if(Di[e].pointerId===t.pointerId){Di.splice(e,1);break}}function Ctt(){Di.splice(0,Di.length)}function r3(t){if(t.pointerType!=="touch")return;let e=i3[t.pointerId];e===void 0&&(e={x:0,y:0},i3[t.pointerId]=e),e.x=t.pageX,e.y=t.pageY}function gF(t){let e=t.pointerId===Di[0].pointerId?Di[1]:Di[0];return i3[e.pointerId]}function zde(t){qE[t.key]=!0,oI[t.key]=oI[t.key]===void 0?1:oI[t.key]+1}function jde(t){if(vL&&qE.Meta)for(let e in qE)qE[e]=!1;else qE[t.key]=!1;oI={}}function Ptt(t){t.addEventListener("pointerdown",Fde,!0),t.addEventListener("pointerdown",r3,!0),t.addEventListener("pointermove",r3,!0),t.addEventListener("pointerup",o1,!0),t.addEventListener("pointercancel",o1,!0),t.addEventListener("pointerleave",o1,!0),window.addEventListener("keydown",zde,!0),window.addEventListener("keyup",jde,!0)}function Rtt(t){t.removeEventListener("pointerdown",Fde,!0),t.removeEventListener("pointerdown",r3,!0),t.removeEventListener("pointermove",r3,!0),t.removeEventListener("pointerup",o1,!0),t.removeEventListener("pointercancel",o1,!0),t.removeEventListener("pointerleave",o1,!0),window.removeEventListener("keydown",zde,!0),window.removeEventListener("keyup",jde,!0)}var Vde,Itt=new Promise(t=>{Vde=t}),qP;function Dtt(t){if(qP)return qP;async function e(){let i=t??"https://unpkg.com/@splinetool/navmesh-wasm@1.10.72/build",r=Bc(()=>import("./navmesh-B1pUQaZh.js"),[]),[n,s]=await Promise.all([r,fetch(`${i}/navmesh.wasm`).then(l=>l.arrayBuffer())]),a=n.default,o=await a({wasmBinary:s});Vde(o)}return qP=e(),qP}var Hde,Ott=new Promise(t=>{Hde=t}),XP;function Ltt(){if(XP)return XP;async function t(){let e=await Bc(()=>import("./physics-ChHD2_fM.js"),[]);await e.init(),Hde(e)}return XP=t(),XP}var gi=class{modifyById(t,e){let i=this;if(i[t]===void 0)throw new Error("not expected");{let r={...i,[t]:e};return Object.setPrototypeOf(r,gi.prototype),r}}add(t,e){return this.runOp({type:1,id:t,data:e})?.data??this}runOp(t){let e=this;if(t.type===1){let i=e[t.id],r;i===void 0?r={type:2,id:t.id}:r={type:1,id:t.id,data:i};let{id:n,data:s}=t,a={...e,[n]:s};return Object.setPrototypeOf(a,gi.prototype),{data:a,actual:t,reverse:r}}else if(t.type===2){let{id:i}=t,r=e[i];if(r===void 0)return null;{let n={...e};return Object.setPrototypeOf(n,gi.prototype),delete n[i],{data:n,actual:t,reverse:{type:1,id:i,data:r}}}}return null}};function wG(t){if(t.deepFreeze!==void 0){t.deepFreeze(t);return}let e=Object.getOwnPropertyNames(t);for(let i of e){let r=t[i];r&&typeof r=="object"&&wG(r)}return Object.freeze(t)}function ktt(t,e){let i=0;for(;i<t.length&&i<e.length;){if(t[i]<e[i])return-1;if(t[i]>e[i])return 1;i+=1}return i!==e.length?-1:i!==t.length?1:0}var Gde=class extends Error{};function vF(t){let e={...t};return Object.setPrototypeOf(e,Object.getPrototypeOf(t)),e}function Pg(t,e,i){if(t===void 0?e===void 0?(t=0,e=10):t=e-10:e===void 0&&(e=t+10),t>e){let s=t;t=e,e=s}let r=[],n=1/(i+1);for(let s=0;s<i;s++){let a=t+(e-t)*(s+.75+Math.random()*.5)*n;r.push(a)}return r}function _G(t){return t instanceof Uint8Array||t instanceof Uint16Array||t instanceof Uint32Array||t instanceof Int8Array||t instanceof Int16Array||t instanceof Int32Array||t instanceof Float32Array||t instanceof Float64Array}function Ntt(){return typeof process<"u"}function Wde(t,e){for(let i of t)e(i.id,i.data)!==!0&&Wde(i.children,e)}function qde(t,e){if(e(t.id,t.data)!==!0)for(let i of t.children)qde(i,e)}var yo=class extends Array{constructor(...t){super(...t),Object.setPrototypeOf(this,yo.prototype)}deepFreeze(){let t=0;for(;t<this.length;)wG(this[t]),t++}fillCaches0(t,e){this.objCaches.set(t.id,t),this.parentCaches.set(t.id,e);for(let i of t.children)this.fillCaches0(i,t.id)}fillCaches(){if(this.objCaches===void 0){this.objCaches=new Map,this.parentCaches=new Map;for(let t of this)this.fillCaches0(t,null)}}randomId(){this.fillCaches();let t=Array.from(this.objCaches.keys());if(t.length!==0)return t[Math.max(0,Math.floor(Math.random()*t.length)-1)]}nonExistOrDescendantOf(t,e){if(!this.has(t))return!0;for(;t;){let i=this.parent(t);if(i===e)return!0;t=i}return!1}rootAcestor(t){for(;t;){let e=this.parent(t);if(e)t=e;else return t}return t}isDescendantOf(t,e){for(;t;){let i=this.parent(t);if(i===e)return!0;t=i}return!1}data(t){return this.get(t)?.data}has(t){return this.childrenOf(t)!==void 0}get(t){return this.fillCaches(),this.objCaches.get(t)}childrenOf(t){return t===null?this:this.get(t)?.children}traverseFrom(t,e){if(t===null)this.traverse(e);else{let i=this.get(t);i&&qde(i,e)}}traverse(t){Wde(this,t)}totalSize(){return this.fillCaches(),this.objCaches.size}parent(t){return this.fillCaches(),this.parentCaches.get(t)}childrenArray(t){return t===null?this:this.get(t).children}modifyById(t,e){if(this.get(t)===void 0)throw new Error("not expected");{let i=this.parent(t),r=this.childrenArray(i),n=r.findIndex(a=>a.id===t);if(n<0)throw new Error("not expected");let s=r[n];return r=[...r],r[n]={...s,data:e},this.modifyArrayBy(i,r)}}modifyArrayBy(t,e){let i=t,r=e;for(;i!==null;){let s=r,a=i;if(i=this.parent(i),i===void 0)throw new Error;r=this.childrenArray(i);let o=r.findIndex(l=>l.id===a);if(o<0)throw new Error;r=[...r],r[o]={...r[o],children:s}}Object.setPrototypeOf(r,yo.prototype);let n=r;return n.fillCaches(),n}runOp(t){switch(t.type){case 7:return this.addOp(t);case 8:return this.deleteOp(t);case 9:return this.moveOp(t)}return null}checkDuplicatedIdRec({id:t,children:e}){if(this.get(t)!==void 0)return!0;for(let i of e)if(this.checkDuplicatedIdRec(i))return!0;return!1}addOp(t){let{parent:e,fi:i,id:r,data:n,children:s}=t;if(e!==null&&this.get(e)===void 0||this.checkDuplicatedIdRec(t))return null;{let a=e,o=this.childrenArray(a),l={fi:i,id:r,data:n,children:s};return o=[...o,l],o.sort((c,u)=>c.fi-u.fi),t.localIndex=o.indexOf(l),{data:this.modifyArrayBy(a,o),actual:t,reverse:{type:8,id:r}}}}deleteOp(t){let{id:e}=t;if(this.get(e)===null)return null;{let i=this.parent(e);if(i===void 0)return null;let r=this.childrenArray(i),n=r.findIndex(a=>a.id===e);t.localIndex=n,r=[...r];let s=r.splice(n,1)[0];return{data:this.modifyArrayBy(i,r),actual:t,reverse:{type:7,...s,parent:i}}}}moveOp(t){let{parent:e,fi:i,id:r}=t;if(e!==null&&this.get(e)===void 0)return this.deleteOp({type:8,id:r});if(e!==null){let h=e;for(;h!==null;){if(h===void 0)throw new Error;if(h===r)throw new Gde("cyclic tree");h=this.parent(h)}}let n=this.parent(r);if(n===void 0)return null;let s=n,a=this.childrenArray(n),o=a.findIndex(h=>h.id===r);a=[...a];let l=a.splice(o,1)[0],c=this.modifyArrayBy(n,a);n=e,a=c.childrenArray(n);let u=l.fi;return l={...l,fi:i},a=[...a,l],a.sort((h,d)=>h.fi-d.fi),t.localIndex=a.indexOf(l),c=c.modifyArrayBy(n,a),{data:c,actual:t,reverse:{type:9,parent:s,fi:u,id:r}}}previous(t,e){if(e===null){let r=this.childrenArray(t);return r.length===0?null:r[r.length-1].id}let i=null;for(let r of this.childrenArray(t)){if(r.id===e)return i;i=r.id}return null}traverseSortNext(t){let e=this.parent(t);if(e!==void 0){let i=this.childrenArray(e),r=i.findIndex(n=>n.id===t)+1;if(r<i.length)return i[r].id;if(e)return this.traverseSortNext(e)}}sortNext(t){let e=this.childrenArray(t);return e.length>0?e[0].id:this.traverseSortNext(t)}traverseSortPrevious(t){let e=this.childrenArray(t);return e.length>0?this.traverseSortPrevious(e[e.length-1].id):t}sortPrevious(t){let e=this.parent(t);if(e!==void 0){let i=this.childrenArray(e),r=i.findIndex(n=>n.id===t)-1;return r>=0?this.traverseSortPrevious(i[r].id):e}}getAllSorted(t){let e=[];for(let i of t){let r=this.getWithSortKey(i.id);r!==void 0&&e.push({...i,...r})}e.sort((i,r)=>ktt(i.sortKey,r.sortKey));for(let i of e)delete i.sortKey;return e}getWithSortKey(t){var e=t;let i=[],r=this.get(e),n=r;if(r!==void 0){for(;e;)i.splice(0,0,r.fi),e=this.parent(e),e!==null&&(r=this.get(e));return{...n,sortKey:i}}}insertBeforeHelper(t,e,i){return this.insertAfterHelper(t,this.previous(t,e),i)}insertAfterHelper(t,e,i){let r=this.childrenArray(t);if(e===null){if(r.length===0)return Pg(0,i,i);{let n=r[0].fi;return Pg(n-i,n,i)}}else{let n=this.get(e);if(n===void 0||this.parent(e)!==t)throw new Error("illegal args");let s=r.find(a=>a.fi>n.fi);if(s===void 0){let a=r[r.length-1].fi;return Pg(a,a+i,i)}else return Pg(n.fi,s.fi,i)}}},n3;(t=>{function e(i,r){if(r.type!==0)return null;if(Array.isArray(i)){let n=r.props,s={},a=[...i],o=!1;if(n)for(let l of Object.keys(n)){let c=parseInt(l);if(isNaN(c))throw new Error("wrong index");s[l]=a[c],a[c]=n[l],o=!0}return o?{data:a,actual:r,reverse:{type:0,props:s}}:null}else{let n=r.props,s={},a={...i},o=!1;if(n)for(let l of Object.keys(n)){s[l]=a[l];let c=n[l];c===void 0?delete a[l]:a[l]=c,o=!0}return o?{data:a,actual:r,reverse:{type:0,props:s}}:null}}t.runOp=e})(n3||(n3={}));var ni=class extends Array{constructor(...t){super(...t),Object.setPrototypeOf(this,ni.prototype)}deepFreeze(){let t=0;for(;t<this.length;)wG(this[t]),t++}fillCaches0(t){this.objCaches.set(t.id,t)}fillCaches(){if(this.objCaches===void 0){this.objCaches=new Map,Object.getOwnPropertyDescriptor(this,"objCaches").enumerable=!1;for(let t of this)this.fillCaches0(t)}}randomId(){this.fillCaches();let t=Array.from(this.objCaches.keys());if(t.length!==0)return t[Math.max(0,Math.floor(Math.random()*t.length)-1)]}data(t){return this.get(t)?.data}get(t){return this.fillCaches(),this.objCaches.get(t)}modifyById(t,e){if(this.get(t)===void 0)throw new Error("not expected");{let i=this,r=i.findIndex(s=>s.id===t);if(r<0)throw new Error("not expected");let n=i[r];return i=[...i],i[r]={...n,data:e},this.modifyArrayBy(i)}}modifyArrayBy(t){Object.setPrototypeOf(t,ni.prototype);let e=t;return Ntt()||e.fillCaches(),e}runOp(t){switch(t.type){case 4:return this.addOp(t);case 5:return this.deleteOp(t);case 6:return this.moveOp(t)}return null}addOp(t){let{fi:e,id:i,data:r}=t,n=this,s={fi:e,id:i,data:r};return n=[...n,s],n.sort((a,o)=>a.fi-o.fi),t.localIndex=n.indexOf(s),{data:this.modifyArrayBy(n),actual:t,reverse:{type:5,id:i}}}deleteOp(t){let{id:e}=t,i=this,r=i.findIndex(s=>s.id===e);if(r===-1)return null;t.localIndex=r,i=[...i];let n=i.splice(r,1)[0];return{data:this.modifyArrayBy(i),actual:t,reverse:{type:4,...n}}}moveOp(t){let{fi:e,id:i}=t,r=this;r=[...r];let n=r.findIndex(o=>o.id===i);if(n===-1)return null;let s=r[n].fi,a={...r[n],fi:e};return r[n]=a,r.sort((o,l)=>o.fi-l.fi),t.localIndex=r.indexOf(a),{data:this.modifyArrayBy(r),actual:t,reverse:{type:6,fi:s,id:i}}}previous(t){if(t===null)return this.length===0?null:this[this.length-1].id;let e=null;for(let i of this){if(i.id===t)return e;e=i.id}return null}insertBeforeHelper(t,e){return this.insertAfterHelper(this.previous(t),e)}insertAfterHelper(t,e){let i=this;if(t===null){if(i.length===0)return Pg(0,e,e);{let r=i[0].fi;return Pg(r-e,r,e)}}else{let r=this.get(t);if(r===void 0)throw new Error("illegal args");let n=i.find(s=>s.fi>r.fi);if(n===void 0){let s=i[i.length-1].fi;return Pg(s,s+e,e)}else return Pg(r.fi,n.fi,e)}}};function W1(t){return t&&typeof t=="object"&&t instanceof cs}var cs=class{unusedFunOverridesTable(t){}runOp(t){let e=[],i=this,r=0,n={};for(;r<t.path.length;){if(e.push(i),i=i===void 0?void 0:i[t.path[r]],i!==void 0&&!W1(i))return null;r+=1}i=i?vF(i):new cs;for(let[o,l]of Object.entries(t.props)){let c=i[o];n[o]=c,l===void 0?delete i[o]:i[o]=l}for(;r>0;){if(Object.keys(i).length===0){let o=e[r-1];o&&(i=vF(o),delete i[t.path[r-1]])}else{let o=e[r-1];if(o){let l=vF(o);l[t.path[r-1]]=i,i=l}else{let l=new cs;l[t.path[r-1]]=i,i=l}}r-=1}let s=Object.setPrototypeOf(i,cs.prototype),a={...t,props:n};return{data:s,actual:t,reverse:a}}},jg;(t=>{function e(n,s){return UM(n,s)??n}t.apply=e;function i(n,s){return EG(n,s)}t.merge=i;function r(n,s){let a=0,o=s.path,l=n;for(;a<o.length&&l!==void 0;){if(l=fa.zoomOnce(l,o[a]),l===void 0)return s;if(!W1(l))return;a+=1}if(l===void 0)return s;if(W1(l))if(s.type===0){let c={...s.props};for(let u of Object.keys(l))delete c[u];return{...s,props:c}}else if(s.type===1||s.type===4||s.type===7){let c=SG([s],l);return c?c[0]:s}else return s}t.filterOp=r})(jg||(jg={}));function SG(t,e){if(e===void 0)return;let i=!1,r=t.map(n=>{let s=n.id,a=UM(n.data,e[s]);if(i=i||a!==void 0,a===void 0&&(a=n.data),n.children){let o=SG(n.children,e);return o!==void 0?i=!0:o=n.children,{...n,id:s,data:a,children:o}}else return{...n,id:s,data:a}});if(i)return r}function Utt(t,e){if(e===void 0)return;let i=!1,r=t.map(n=>{let s=n.id,a=UM(n.data,e[s]);return i=i||a!==void 0,a===void 0&&(a=n.data),{...n,id:s,data:a}});if(i)return Object.setPrototypeOf(r,Object.getPrototypeOf(t)),r}function UM(t,e){if(!W1(e))return e;if(t instanceof yo){let i=SG(t,e);return i!==void 0&&Object.setPrototypeOf(i,Object.getPrototypeOf(t)),i}else{if(t instanceof ni)return Utt(t,e);if(Array.isArray(t)){let i=!1,r=t.map((n,s)=>{let a=UM(n,e[s]);return i=i||a!==void 0,a===void 0&&(a=n),a});return i?(Object.setPrototypeOf(r,Object.getPrototypeOf(t)),r):void 0}else{if(t instanceof cs)return EG(t,e);if(t&&typeof t=="object"){let i={},r=!1;for(let[n,s]of Object.entries(t)){let a=UM(s,e[n]);r=r||a!==void 0,a===void 0&&(a=s),i[n]=a}return r?(Object.setPrototypeOf(i,Object.getPrototypeOf(t)),i):void 0}}}}function EG(t,e){if(t===void 0)return e;if(e===void 0)return t;if(!W1(e))return e;if(!W1(t))return jg.apply(t,e);let i=new Set;for(let n of Object.keys(t))i.add(n);for(let n of Object.keys(e))i.add(n);let r=new cs;for(let n of i){let s=EG(t===void 0?void 0:t[n],e===void 0?void 0:e[n]);r[n]=s}return r}function Btt(t,e){let i={cur:[],result:[],len:0};return t=BM(t,e,i)??t,[t,i.result]}function s3(t,e){return t===null?null:(t.cur[t.len]=e,t.len+=1,t)}function a3(t){t&&(t.len-=1)}function Ftt(t){if(t===null)return null;t.result.push(t.cur.slice(0,t.len))}function Xde(t,e,i){let r=!1,n=t.map(s=>{let a=s.id,o=e[a];if(o!==void 0&&typeof o=="string"&&(r=!0,a=o,i!==null))throw new Error("not supported");let l=BM(s.data,e,s3(i,a));a3(i),r=r||l!==void 0,l===void 0&&(l=s.data);let c=Xde(s.children,e,i);return c!==void 0?r=!0:c=s.children,{...s,id:a,data:l,children:c}});if(r)return n}function ztt(t,e,i){let r=!1,n=t.map(s=>{let a=s.id,o=e[a];if(o!==void 0&&typeof o=="string"&&(r=!0,a=o,i!==null))throw new Error("not supported");let l=BM(s.data,e,s3(i,a));return a3(i),r=r||l!==void 0,l===void 0&&(l=s.data),{...s,id:a,data:l}});if(r)return Object.setPrototypeOf(n,Object.getPrototypeOf(t)),n}function BM(t,e,i){if(t instanceof yo){let r=Xde(t,e,i);return r!==void 0&&Object.setPrototypeOf(r,Object.getPrototypeOf(t)),r}else{if(t instanceof ni)return ztt(t,e,i);if(Array.isArray(t)){let r=!1,n=t.map((s,a)=>{let o=BM(s,e,s3(i,a));return a3(i),r=r||o!==void 0,o===void 0&&(o=s),o});return r?(Object.setPrototypeOf(n,Object.getPrototypeOf(t)),n):void 0}else if(t&&typeof t=="object"&&!_G(t)){let r={},n=!1;for(let[s,a]of Object.entries(t))if(s!=="name"&&s!=="variableId"){let o=e[s];if(typeof o=="string"){if(i!==null)throw new Error("not supported");n=!0,s=o}let l=BM(a,e,s3(i,s));a3(i),n=n||l!==void 0,l===void 0&&(l=a),r[s]=l}else r[s]=a;return n?(Object.setPrototypeOf(r,Object.getPrototypeOf(t)),r):void 0}else if(typeof t=="string"){let r=e[t];return r!==void 0&&Ftt(i),r}else return}}var o3;(t=>{function e(i,r){let n=fa.zoom(r,i.path);if(typeof n=="object"){let s={};for(let a of Object.keys(i.props))s[a]=n[a];return{...i,props:s}}else return{...i,props:{}}}t.replaceProps=e})(o3||(o3={}));var Ha;(t=>{function e(l,c){return{...l,path:l.path.slice(c)}}t.drop=e;function i(l,c){return r(l,c)?.data??l}t.applySimple=i;function r(l,c){let u=c.path;for(var h=[];;){let d;if(l instanceof cs&&c.type===0&&(d=l.runOp({...c,path:u.slice(h.length)}),d===null&&(d=void 0)),d===void 0&&h.length===u.length&&(l instanceof yo||l instanceof ni||l instanceof gi?d=l.runOp(c):d=n3.runOp(l,c)),d!==void 0)if(d!==null){let g=d.data;for(let m=h.length-1;m>=0;m--){let y=u[m],b=h[m];if(b instanceof yo){if(typeof y=="number")throw new Error("illegal arg");g=b.modifyById(y,g)}else if(b instanceof ni){if(typeof y=="number")throw new Error("illegal arg");g=b.modifyById(y,g)}else if(b instanceof gi){if(typeof y=="number")throw new Error("illegal arg");g=b.modifyById(y,g)}else if(b instanceof cs){let w={...b,[y]:g};g=Object.setPrototypeOf(w,cs.prototype)}else if(typeof b=="object")if(Array.isArray(b)){if(typeof y=="string"&&(y=parseInt(y),isNaN(y)))throw new Error("Invalid path");let w=g;g=[...b],g[y]=w}else g={...b,[y]:g};else return null}return{data:g,actual:{...d.actual,path:u},reverse:{...d.reverse,path:u}}}else return null;let f=u[h.length],p;if(l instanceof yo){if(typeof f=="number")throw new Error("");p=l.get(f)?.data}else if(l instanceof ni){if(typeof f=="number")throw new Error("");p=l.get(f)?.data}else l!==null&&(p=l[f]);if(p!==void 0)h.push(l),l=p;else return null}}t.apply=r;function n(l,c){for(let u=0;u<l.length&&u<c.length;u++)if(l[u]!==c[u])return!0;return!1}t.pathDisjoint=n;function s(l,c){if(l.length!==c.length)return!1;for(let u=0;u<l.length;u++)if(l[u]!==c[u])return!1;return!0}t.pathEq=s;function a(l,c){return n(l.path,c.path)}t.commutative=a;function o(l,c){return l.type===0&&c.type===0&&s(l.path,c.path)?Object.keys(l.props).every(u=>c.props[u]!==void 0):!1}t.subsumed=o})(Ha||(Ha={}));var Gj;(t=>{function e(){return[]}t.empty=e;function i(c,u){let h=[];for(let d of c){let[f,...p]=d.path;f===u&&h.push({...d,path:p})}return h}t.removePrefix=i;function r(c,u){return c.map(h=>({...h,path:[u,...h.path]}))}t.addPrefix=r;function n(c,u){return[...c,...u]}t.concat=n;function s(c,u){return[...c.filter(h=>!u.some(d=>Ha.subsumed(h,d))),...u]}t.compress=s;function a(c,u){return c.every(h=>u.every(d=>Ha.commutative(h,d)))}t.commutative=a;function o(c,u){for(let h of u){let d=l(c,h);d!==null&&(c=d.data)}return c}t.applyAll=o;function l(c,u){var h=c;let d=[],f=[];for(let p of u)try{if(p.type===3||p.type===5&&p.path[p.path.length-1]==="variables"){let g,m,y;if(p.type===3?(g=fa.zoom(h,[...p.path,p.id]),y=Ha.apply(h,{...p,type:2})):(g=fa.zoom(h,[...p.path,p.id,"value"]),y=Ha.apply(h,p)),y!==null){h=y.data;let[b,w]=Btt(h,{[p.id]:g});h=b;for(let E=0;E<w.length;E++){let M=w[E],A=M.pop();if(typeof A=="number"){let P=[A];for(let R=E+1;R<w.length;R++){let I=w[R],k=I[I.length-1];if(typeof k=="number"&&fa.equal(M,I.slice(0,I.length-1)))P.push(k),w.splice(R,1);else break}let C=fa.zoom(h,M);m=C.map((R,I)=>P.includes(I)?p.id:R),g=C,A=M.pop()}else{if(A==="alphaOverride"||A==="alpha"){g/=100;let P=g,C=fa.zoom(h,M.slice(0,M.length-2)),R=C.layers.map(I=>I.id===M[M.length-1]?{...I,data:{...I.data,[A]:P}}:I);Object.setPrototypeOf(R,Object.getPrototypeOf(C.layers)),C.layers=R}m=p.id}d.push({type:0,path:M,props:{[A]:g}}),f.push({type:0,path:M,props:{[A]:m}})}f.push(y.reverse),d.push(y.actual)}}else{let g=Ha.apply(h,p);g!==null&&(d.push(g.actual),h=g.data,f.push(g.reverse))}}catch(g){if(g instanceof Gde)return null;throw g}return{data:h,actual:d,reverse:f.reverse()}}t.apply=l})(Gj||(Gj={}));var $de=Symbol(),jtt=Symbol(),yL=Symbol(),zT=class{reportOp(t,e,i=[]){let r=this;if(e===null)return;r._current=e.data;let n=i;for(;!(r instanceof Kde);){let s=r._path,a=r._current;if(s!==""&&n.splice(0,0,s),r=r._parent,r===null)return;r.update(s,a)}r.push(n,t,e.actual,e.reverse)}deleteChildren(t){if(this._children){let e=this._children[t];if(e){let i=e[yL];i&&i(),delete this._children[t]}}}},Vtt=class extends zT{constructor(t,e,i){super(),this._parent=t,this._path=e,this._current=i}update(t,e){if(Array.isArray(this._current)){if(typeof t=="string"&&(t=parseInt(t),isNaN(t)))throw new Error("Invalid path");this._current=[...this._current],this._current[t]=e}else if(this._current instanceof cs){let i={...this._current,[t]:e};this._current=Object.setPrototypeOf(i,cs.prototype)}else this._current={...this._current,[t]:e}}runOp(t){this.reportOp(t,n3.runOp(this._current,t),t.path)}},Htt=class extends zT{constructor(t,e,i){super(),this._parent=t,this._path=e,this._current=i}update(t,e){this._current={...this._current,[t]:e},Object.setPrototypeOf(this._current,gi.prototype)}runOp(t){this.reportOp(t,this._current.runOp(t))}},Yde={get(t,e){if(e===yL)return()=>{t._parent=null};if(e===$de)return t._current;if(e===jtt)return t;let{_current:i,_children:r}=t;if(e==="push"&&Array.isArray(i))throw new Error("not supported to expand array");let n=r===void 0?void 0:r[e];if(n!==void 0)return n;let s=i[e],a=xL(t,e,s);return a!==s?(r===void 0&&(r={},t._children=r),r[e]=a,a):s},has(t,e){return e in t._current},ownKeys(t){return Reflect.ownKeys(t._current)},defineProperty(){throw Error("not supported")},getPrototypeOf(t){return Object.getPrototypeOf(t._current)},setPrototypeOf(){throw Error("not supported")},getOwnPropertyDescriptor(t,e){let i=t._current,r=Reflect.getOwnPropertyDescriptor(i,e);return r&&{writable:!0,configurable:!0,enumerable:r.enumerable,value:i[e]}}},Gtt={...Yde,set(t,e,i){let r={type:0,props:{[e]:ws(i)??i}};return t.deleteChildren(e),t.runOp(r),!0},deleteProperty(t,e){let i={type:0,props:{[e]:void 0}};return t.deleteChildren(e),t.runOp(i),!0}},Wtt={...Yde,set(t,e,i){return i===void 0?this.deleteProperty(t,e):(t.deleteChildren(e),t.runOp({type:1,id:e,data:i})),!0},deleteProperty(t,e){return t.runOp({type:2,id:e}),!0}},AG=class extends zT{constructor(t,e,i){super(),this._children={},this._parent=t,this._path=e,this._current=i,this[yL]=()=>{this._parent=null}}unproxy(){return this._current}update(t,e){this._current=this._current.modifyById(t,e)}runOp(t){this.reportOp(t,this._current.runOp(t))}randomId(){return this._current.randomId()}isDescendantOf(t,e){return this._current.isDescendantOf(t,e)}childrenOf(t){return this._current.childrenOf(t)}traverse(t){return this._current.traverse(t)}get(t){return this._current.get(t)}parent(t){return this._current.parent(t)}traverse(t){this._current.traverse((e,i)=>{t(e,this.data(e))})}data(t){let{_current:e,_children:i}=this,r=i===void 0?void 0:i[t];if(r!==void 0)return r;let n=e.get(t)?.data,s=xL(this,t,n);return s!==n?(i===void 0&&(i={},this._children=i),i[t]=s,s):n}add(t,e,i,r,n){this.runOp({type:7,parent:t,fi:e,id:i,data:r,children:n})}move(t,e,i){this.runOp({type:9,parent:t,fi:e,id:i})}insertAfter(t,e,i){let r=this._current.insertAfterHelper(t,e,i.length);for(let n=0;n<i.length;n++){let s=i[n];this.add(t,r[n],s.id,s.data,s.children)}}insertBefore(t,e,i){let r=this._current.insertBeforeHelper(t,e,i.length);for(let n=0;n<i.length;n++){let s=i[n];this.add(t,r[n],s.id,s.data,s.children)}}moveAfter(t,e,i){let r=this._current.insertAfterHelper(t,e,i.length);for(let n=0;n<i.length;n++){let s=i[n];this.move(t,r[n],s)}}moveBefore(t,e,i){let r=this._current.insertBeforeHelper(t,e,i.length);for(let n=0;n<i.length;n++){let s=i[n];this.move(t,r[n],s)}}delete(t){this.deleteChildren(t),this.runOp({type:8,id:t})}sortNext(t){return this._current.sortNext(t)}sortPrevious(t){return this._current.sortPrevious(t)}getAllSorted(t){return this._current.getAllSorted(t)}},MG=class extends zT{constructor(t,e,i){super(),this._children={},this._parent=t,this._path=e,this._current=i,this[yL]=()=>{this._parent=null}}unproxy(){return this._current}get length(){return this._current.length}forEach(t){let e=this.length;for(let i=0;i<e;i++){let r=this._current[i].id,n=this._current[i].fi;t(this.data(this._current[i].id),r,n)}}find(t){let e=this.length;for(let i=0;i<e;i++){let r=this._current[i].id;if(t(this.data(r),r))return this.get(r)}}update(t,e){this._current=this._current.modifyById(t,e)}randomId(){return this._current.randomId()}get(t){return{...this._current.get(t),data:this.data(t)}}data(t){let{_current:e,_children:i}=this,r=i===void 0?void 0:i[t];if(r!==void 0)return r;let n=e.get(t)?.data,s=xL(this,t,n);return s!==n?(i===void 0&&(i={},this._children=i),i[t]=s,s):n}runOp(t){this.reportOp(t,this._current.runOp(t))}add(t,e,i){this.runOp({type:4,fi:t,id:e,data:i})}move(t,e){this.runOp({type:6,fi:t,id:e})}insertAfter(t,e){let i=this._current.insertAfterHelper(t,e.length);for(let r=0;r<e.length;r++){let n=e[r];this.add(i[r],n.id,n.data)}}insertBefore(t,e){let i=this._current.insertBeforeHelper(t,e.length);for(let r=0;r<e.length;r++){let n=e[r];this.add(i[r],n.id,n.data)}}moveAfter(t,e){let i=this._current.insertAfterHelper(t,e.length);for(let r=0;r<e.length;r++){let n=e[r];this.move(i[r],n)}}moveBefore(t,e){let i=this._current.insertBeforeHelper(t,e.length);for(let r=0;r<e.length;r++){let n=e[r];this.move(i[r],n)}}delete(t){this.deleteChildren(t),this.runOp({type:5,id:t})}};function yF(t,e,i){if(t.length>0){let r=t[t.length-1];if(r.type===0&&e.type===0&&fa.equal(r.path,i)){Object.assign(r.props,e.props);return}}t.push({...e,path:i})}var Kde=class extends zT{constructor(t){super(),this.ts=[],this.actual=[],this.reverse=[],this._current=t}update(t,e){if(t!=="")throw new Error("");this._current=e}push(t,e,i,r){yF(this.ts,e,t),yF(this.actual,i,t),yF(this.reverse,r,t)}result(){return{data:this._current,ts:this.ts,actual:this.actual,reverse:this.reverse.reverse()}}};function xL(t,e,i){return i instanceof yo?new AG(t,e,i):i instanceof ni?new MG(t,e,i):i instanceof gi?new Proxy(new Htt(t,e,i),Wtt):i!==null&&typeof i=="object"?_G(i)?i:new Proxy(new Vtt(t,e,i),Gtt):i}function Zde(t){let e=new Kde(t);return[xL(e,"",t),e]}function FM(t,e){let[i,r]=Zde(t);return e(i),r.result()}function ws(t){return t instanceof AG||t instanceof MG?t._current:t!==null&&typeof t=="object"?t[$de]:t}var fa;(t=>{function e(s,a){if(a.length===s.length)for(var o=0;o<s.length;){if(s[o]!==a[o])return!1;o+=1}else return!1;return!0}t.equal=e;function i(s,a,o){let l=n(o,s);if(l!==void 0&&typeof l=="object"&&l!==null){let c={...a};return Object.keys(l).forEach(u=>{delete c[u]}),c}else return a}t.removeOverridden=i;function r(s,a){if((s instanceof yo||s instanceof AG)&&typeof a=="string"||(s instanceof ni||s instanceof MG)&&typeof a=="string")return s.data(a);if(typeof a=="number"&&Array.isArray(s)||typeof a=="string"&&typeof s=="object"&&s!==null)return s[a]}t.zoomOnce=r;function n(s,a,o=0){for(;o<a.length&&s!==void 0;)s=r(s,a[o]),o+=1;return s}t.zoom=n})(fa||(fa={}));function qtt(t,e){let i=[];if(e.length===t.length)for(var r=0;r<t.length;){if(e[r]==="*")i.push(t[r]);else if(t[r]!==e[r])return null;r+=1}else return null;return i}function yn(t,e){let i=[];if(e.length<=t.length)for(var r=0;r<e.length;){if(e[r]==="*")i.push(t[r]);else if(t[r]!==e[r])return null;r+=1}else return null;return i}var Qde=class{},sJ=class extends Qde{constructor(t){super(),this.id=t}},aJ=class extends Qde{constructor(t){super(),this.data=t}},Wj;try{Wj=new TextDecoder}catch{}var Qt,Vg,Ke=0,Zl={},Vr,Rg,uu=0,Md=0,Mc,Lp,wl=[],Zr,oJ={useRecords:!1,mapsAsObjects:!0},Jde=class{},efe=new Jde;efe.name="MessagePack 0xC1";var q1=!1,l3=class{constructor(t){t&&(t.useRecords===!1&&t.mapsAsObjects===void 0&&(t.mapsAsObjects=!0),t.structures?t.structures.sharedLength=t.structures.length:t.getStructures&&((t.structures=[]).uninitialized=!0,t.structures.sharedLength=0)),Object.assign(this,t)}unpack(t,e){if(Qt)return afe(()=>(Xj(),this?this.unpack(t,e):l3.prototype.unpack.call(oJ,t,e)));Vg=e>-1?e:t.length,Ke=0,Md=0,Rg=null,Mc=null,Qt=t;try{Zr=t.dataView||(t.dataView=new DataView(t.buffer,t.byteOffset,t.byteLength))}catch(i){throw Qt=null,t instanceof Uint8Array?i:new Error("Source must be a Uint8Array or Buffer but was a "+(t&&typeof t=="object"?t.constructor.name:typeof t))}if(this instanceof l3){if(Zl=this,this.structures)return Vr=this.structures,$P();(!Vr||Vr.length>0)&&(Vr=[])}else Zl=oJ,(!Vr||Vr.length>0)&&(Vr=[]);return $P()}unpackMultiple(t,e){let i,r=0;try{q1=!0;let n=t.length,s=this?this.unpack(t,n):wL.unpack(t,n);if(e){for(e(s);Ke<n;)if(r=Ke,e($P())===!1)return}else{for(i=[s];Ke<n;)r=Ke,i.push($P());return i}}catch(n){throw n.lastPosition=r,n.values=i,n}finally{q1=!1,Xj()}}_mergeStructures(t,e){t=t||[];for(let i=0,r=t.length;i<r;i++){let n=t[i];n&&(n.isShared=!0,i>=32&&(n.highByte=i-32>>5))}t.sharedLength=t.length;for(let i in e||[])if(i>=0){let r=t[i],n=e[i];n&&(r&&((t.restoreStructures||(t.restoreStructures=[]))[i]=r),t[i]=n)}return this.structures=t}decode(t,e){return this.unpack(t,e)}};function $P(){try{if(!Zl.trusted&&!q1){let e=Vr.sharedLength||0;e<Vr.length&&(Vr.length=e)}let t=ns();if(Ke==Vg)Vr.restoreStructures&&lJ(),Vr=null,Qt=null,Lp&&(Lp=null);else if(Ke>Vg){let e=new Error("Unexpected end of MessagePack data");throw e.incomplete=!0,e}else if(!q1)throw new Error("Data read, but end of buffer not reached");return t}catch(t){throw Vr.restoreStructures&&lJ(),Xj(),(t instanceof RangeError||t.message.startsWith("Unexpected end of buffer"))&&(t.incomplete=!0),t}}function lJ(){for(let t in Vr.restoreStructures)Vr[t]=Vr.restoreStructures[t];Vr.restoreStructures=null}function ns(){let t=Qt[Ke++];if(t<160)if(t<128){if(t<64)return t;{let e=Vr[t&63]||Zl.getStructures&&tfe()[t&63];return e?(e.read||(e.read=TG(e,t&63)),e.read()):t}}else if(t<144)if(t-=128,Zl.mapsAsObjects){let e={};for(let i=0;i<t;i++)e[rfe()]=ns();return e}else{let e=new Map;for(let i=0;i<t;i++)e.set(ns(),ns());return e}else{t-=144;let e=new Array(t);for(let i=0;i<t;i++)e[i]=ns();return e}else if(t<192){let e=t-160;if(Md>=Ke)return Rg.slice(Ke-uu,(Ke+=e)-uu);if(Md==0&&Vg<140){let i=e<16?CG(e):ife(e);if(i!=null)return i}return qj(e)}else{let e;switch(t){case 192:return null;case 193:return Mc?(e=ns(),e>0?Mc[1].slice(Mc.position1,Mc.position1+=e):Mc[0].slice(Mc.position0,Mc.position0-=e)):efe;case 194:return!1;case 195:return!0;case 196:return xF(Qt[Ke++]);case 197:return e=Zr.getUint16(Ke),Ke+=2,xF(e);case 198:return e=Zr.getUint32(Ke),Ke+=4,xF(e);case 199:return Ty(Qt[Ke++]);case 200:return e=Zr.getUint16(Ke),Ke+=2,Ty(e);case 201:return e=Zr.getUint32(Ke),Ke+=4,Ty(e);case 202:if(e=Zr.getFloat32(Ke),Zl.useFloat32>2){let i=PG[(Qt[Ke]&127)<<1|Qt[Ke+1]>>7];return Ke+=4,(i*e+(e>0?.5:-.5)>>0)/i}return Ke+=4,e;case 203:return e=Zr.getFloat64(Ke),Ke+=8,e;case 204:return Qt[Ke++];case 205:return e=Zr.getUint16(Ke),Ke+=2,e;case 206:return e=Zr.getUint32(Ke),Ke+=4,e;case 207:return Zl.int64AsNumber?(e=Zr.getUint32(Ke)*4294967296,e+=Zr.getUint32(Ke+4)):e=Zr.getBigUint64(Ke),Ke+=8,e;case 208:return Zr.getInt8(Ke++);case 209:return e=Zr.getInt16(Ke),Ke+=2,e;case 210:return e=Zr.getInt32(Ke),Ke+=4,e;case 211:return Zl.int64AsNumber?(e=Zr.getInt32(Ke)*4294967296,e+=Zr.getUint32(Ke+4)):e=Zr.getBigInt64(Ke),Ke+=8,e;case 212:if(e=Qt[Ke++],e==114)return fJ(Qt[Ke++]&63);{let i=wl[e];if(i)return i.read?(Ke++,i.read(ns())):i.noBuffer?(Ke++,i()):i(Qt.subarray(Ke,++Ke));throw new Error("Unknown extension "+e)}case 213:return e=Qt[Ke],e==114?(Ke++,fJ(Qt[Ke++]&63,Qt[Ke++])):Ty(2);case 214:return Ty(4);case 215:return Ty(8);case 216:return Ty(16);case 217:return e=Qt[Ke++],Md>=Ke?Rg.slice(Ke-uu,(Ke+=e)-uu):$tt(e);case 218:return e=Zr.getUint16(Ke),Ke+=2,Md>=Ke?Rg.slice(Ke-uu,(Ke+=e)-uu):Ytt(e);case 219:return e=Zr.getUint32(Ke),Ke+=4,Md>=Ke?Rg.slice(Ke-uu,(Ke+=e)-uu):Ktt(e);case 220:return e=Zr.getUint16(Ke),Ke+=2,uJ(e);case 221:return e=Zr.getUint32(Ke),Ke+=4,uJ(e);case 222:return e=Zr.getUint16(Ke),Ke+=2,hJ(e);case 223:return e=Zr.getUint32(Ke),Ke+=4,hJ(e);default:if(t>=224)return t-256;if(t===void 0){let i=new Error("Unexpected end of MessagePack data");throw i.incomplete=!0,i}throw new Error("Unknown MessagePack token "+t)}}}var Xtt=/^[a-zA-Z_$][a-zA-Z\d_$]*$/;function TG(t,e){function i(){if(i.count++>2){let n=t.read=new Function("r","return function(){return {"+t.map(s=>Xtt.test(s)?s+":r()":"["+JSON.stringify(s)+"]:r()").join(",")+"}}")(ns);return t.highByte===0&&(t.read=cJ(e,t.read)),n()}let r={};for(let n=0,s=t.length;n<s;n++){let a=t[n];r[a]=ns()}return r}return i.count=0,t.highByte===0?cJ(e,i):i}var cJ=(t,e)=>function(){let i=Qt[Ke++];if(i===0)return e();let r=t<32?-(t+(i<<5)):t+(i<<5),n=Vr[r]||tfe()[r];if(!n)throw new Error("Record id is not defined for "+r);return n.read||(n.read=TG(n,t)),n.read()};function tfe(){let t=afe(()=>(Qt=null,Zl.getStructures()));return Vr=Zl._mergeStructures(t,Vr)}var qj=bL,$tt=bL,Ytt=bL,Ktt=bL;function bL(t){let e;if(t<16&&(e=CG(t)))return e;if(t>64&&Wj)return Wj.decode(Qt.subarray(Ke,Ke+=t));let i=Ke+t,r=[];for(e="";Ke<i;){let n=Qt[Ke++];if((n&128)===0)r.push(n);else if((n&224)===192){let s=Qt[Ke++]&63;r.push((n&31)<<6|s)}else if((n&240)===224){let s=Qt[Ke++]&63,a=Qt[Ke++]&63;r.push((n&31)<<12|s<<6|a)}else if((n&248)===240){let s=Qt[Ke++]&63,a=Qt[Ke++]&63,o=Qt[Ke++]&63,l=(n&7)<<18|s<<12|a<<6|o;l>65535&&(l-=65536,r.push(l>>>10&1023|55296),l=56320|l&1023),r.push(l)}else r.push(n);r.length>=4096&&(e+=Na.apply(String,r),r.length=0)}return r.length>0&&(e+=Na.apply(String,r)),e}function uJ(t){let e=new Array(t);for(let i=0;i<t;i++)e[i]=ns();return e}function hJ(t){if(Zl.mapsAsObjects){let e={};for(let i=0;i<t;i++)e[rfe()]=ns();return e}else{let e=new Map;for(let i=0;i<t;i++)e.set(ns(),ns());return e}}var Na=String.fromCharCode;function ife(t){let e=Ke,i=new Array(t);for(let r=0;r<t;r++){let n=Qt[Ke++];if((n&128)>0){Ke=e;return}i[r]=n}return Na.apply(String,i)}function CG(t){if(t<4)if(t<2){if(t===0)return"";{let e=Qt[Ke++];if((e&128)>1){Ke-=1;return}return Na(e)}}else{let e=Qt[Ke++],i=Qt[Ke++];if((e&128)>0||(i&128)>0){Ke-=2;return}if(t<3)return Na(e,i);let r=Qt[Ke++];if((r&128)>0){Ke-=3;return}return Na(e,i,r)}else{let e=Qt[Ke++],i=Qt[Ke++],r=Qt[Ke++],n=Qt[Ke++];if((e&128)>0||(i&128)>0||(r&128)>0||(n&128)>0){Ke-=4;return}if(t<6){if(t===4)return Na(e,i,r,n);{let s=Qt[Ke++];if((s&128)>0){Ke-=5;return}return Na(e,i,r,n,s)}}else if(t<8){let s=Qt[Ke++],a=Qt[Ke++];if((s&128)>0||(a&128)>0){Ke-=6;return}if(t<7)return Na(e,i,r,n,s,a);let o=Qt[Ke++];if((o&128)>0){Ke-=7;return}return Na(e,i,r,n,s,a,o)}else{let s=Qt[Ke++],a=Qt[Ke++],o=Qt[Ke++],l=Qt[Ke++];if((s&128)>0||(a&128)>0||(o&128)>0||(l&128)>0){Ke-=8;return}if(t<10){if(t===8)return Na(e,i,r,n,s,a,o,l);{let c=Qt[Ke++];if((c&128)>0){Ke-=9;return}return Na(e,i,r,n,s,a,o,l,c)}}else if(t<12){let c=Qt[Ke++],u=Qt[Ke++];if((c&128)>0||(u&128)>0){Ke-=10;return}if(t<11)return Na(e,i,r,n,s,a,o,l,c,u);let h=Qt[Ke++];if((h&128)>0){Ke-=11;return}return Na(e,i,r,n,s,a,o,l,c,u,h)}else{let c=Qt[Ke++],u=Qt[Ke++],h=Qt[Ke++],d=Qt[Ke++];if((c&128)>0||(u&128)>0||(h&128)>0||(d&128)>0){Ke-=12;return}if(t<14){if(t===12)return Na(e,i,r,n,s,a,o,l,c,u,h,d);{let f=Qt[Ke++];if((f&128)>0){Ke-=13;return}return Na(e,i,r,n,s,a,o,l,c,u,h,d,f)}}else{let f=Qt[Ke++],p=Qt[Ke++];if((f&128)>0||(p&128)>0){Ke-=14;return}if(t<15)return Na(e,i,r,n,s,a,o,l,c,u,h,d,f,p);let g=Qt[Ke++];if((g&128)>0){Ke-=15;return}return Na(e,i,r,n,s,a,o,l,c,u,h,d,f,p,g)}}}}}function xF(t){return Zl.copyBuffers?Uint8Array.prototype.slice.call(Qt,Ke,Ke+=t):Qt.subarray(Ke,Ke+=t)}function Ty(t){let e=Qt[Ke++];if(wl[e])return wl[e](Qt.subarray(Ke,Ke+=t));throw new Error("Unknown extension type "+e)}var dJ=new Array(4096);function rfe(){let t=Qt[Ke++];if(t>=160&&t<192){if(t=t-160,Md>=Ke)return Rg.slice(Ke-uu,(Ke+=t)-uu);if(!(Md==0&&Vg<180))return qj(t)}else return Ke--,ns();let e=(t<<5^(t>1?Zr.getUint16(Ke):t>0?Qt[Ke]:0))&4095,i=dJ[e],r=Ke,n=Ke+t-3,s,a=0;if(i&&i.bytes==t){for(;r<n;){if(s=Zr.getUint32(r),s!=i[a++]){r=1879048192;break}r+=4}for(n+=3;r<n;)if(s=Qt[r++],s!=i[a++]){r=1879048192;break}if(r===n)return Ke=r,i.string;n-=3,r=Ke}for(i=[],dJ[e]=i,i.bytes=t;r<n;)s=Zr.getUint32(r),i.push(s),r+=4;for(n+=3;r<n;)s=Qt[r++],i.push(s);let o=t<16?CG(t):ife(t);return o!=null?i.string=o:i.string=qj(t)}var fJ=(t,e)=>{var i=ns();let r=t;e!==void 0&&(t=t<32?-((e<<5)+t):(e<<5)+t,i.highByte=e);let n=Vr[t];return n&&n.isShared&&((Vr.restoreStructures||(Vr.restoreStructures=[]))[t]=n),Vr[t]=i,i.read=TG(i,r),i.read()},nfe=typeof self=="object"?self:global;wl[0]=()=>{};wl[0].noBuffer=!0;wl[101]=()=>{let t=ns();return(nfe[t[0]]||Error)(t[1])};wl[105]=t=>{let e=Zr.getUint32(Ke-4);Lp||(Lp=new Map);let i=Qt[Ke],r;i>=144&&i<160||i==220||i==221?r=[]:r={};let n={target:r};Lp.set(e,n);let s=ns();return n.used?Object.assign(r,s):(n.target=s,s)};wl[112]=t=>{let e=Zr.getUint32(Ke-4),i=Lp.get(e);return i.used=!0,i.target};wl[115]=()=>new Set(ns());var sfe=["Int8","Uint8","Uint8Clamped","Int16","Uint16","Int32","Uint32","Float32","Float64","BigInt64","BigUint64"].map(t=>t+"Array");wl[116]=t=>{let e=t[0],i=sfe[e];if(!i)throw new Error("Could not find typed array for code "+e);return new nfe[i](Uint8Array.prototype.slice.call(t,1).buffer)};wl[120]=()=>{let t=ns();return new RegExp(t[0],t[1])};wl[98]=t=>{let e=(t[0]<<24)+(t[1]<<16)+(t[2]<<8)+t[3],i=Ke;Ke+=e-4,Mc=[ns(),ns()],Mc.position0=0,Mc.position1=0;let r=Ke;Ke=i;try{return ns()}finally{Ke=r}};wl[255]=t=>t.length==4?new Date((t[0]*16777216+(t[1]<<16)+(t[2]<<8)+t[3])*1e3):t.length==8?new Date(((t[0]<<22)+(t[1]<<14)+(t[2]<<6)+(t[3]>>2))/1e6+((t[3]&3)*4294967296+t[4]*16777216+(t[5]<<16)+(t[6]<<8)+t[7])*1e3):t.length==12?new Date(((t[0]<<24)+(t[1]<<16)+(t[2]<<8)+t[3])/1e6+((t[4]&128?-281474976710656:0)+t[6]*1099511627776+t[7]*4294967296+t[8]*16777216+(t[9]<<16)+(t[10]<<8)+t[11])*1e3):new Date("invalid");function afe(t){let e=Vg,i=Ke,r=uu,n=Md,s=Rg,a=Lp,o=Mc,l=new Uint8Array(Qt.slice(0,Vg)),c=Vr,u=Vr.slice(0,Vr.length),h=Zl,d=q1,f=t();return Vg=e,Ke=i,uu=r,Md=n,Rg=s,Lp=a,Mc=o,Qt=l,q1=d,Vr=c,Vr.splice(0,Vr.length,...u),Zl=h,Zr=new DataView(Qt.buffer,Qt.byteOffset,Qt.byteLength),f}function Xj(){Qt=null,Lp=null,Vr=null}function Ztt(t){t.unpack?wl[t.type]=t.unpack:wl[t.type]=t}var PG=new Array(147);for(let t=0;t<256;t++)PG[t]=+("1e"+Math.floor(45.15-t*.30103));var wL=new l3({useRecords:!1});wL.unpack;wL.unpackMultiple;wL.unpack;var Qtt=new Float32Array(1);new Uint8Array(Qtt.buffer,0,4);var lI;try{lI=new TextEncoder}catch{}var c3,RG,_L=typeof Buffer<"u",bF=_L?Buffer.allocUnsafeSlow:Uint8Array,ofe=_L?Buffer:Uint8Array,pJ=_L?4294967296:2144337920,bt,gs,ct=0,rd,nd=null,Jtt=/[\u0080-\uFFFF]/,mE=Symbol("record-id"),lfe=class extends l3{constructor(t){super(t),this.offset=0;let e,i,r,n,s,a=0,o=ofe.prototype.utf8Write?function(A,P,C){return bt.utf8Write(A,P,C)}:lI&&lI.encodeInto?function(A,P){return lI.encodeInto(A,bt.subarray(P)).written}:!1,l=this;t||(t={});let c=t&&t.sequential,u=t.structures||t.saveStructures,h=t.maxSharedStructures;if(h==null&&(h=u?32:0),h>8160)throw new Error("Maximum maxSharedStructure is 8160");let d=t.maxOwnStructures;d==null&&(d=u?32:64),c&&!t.saveStructures&&(this.structures=[]);let f=h>32||d+h>64,p=h+64,g=h+d+64;if(g>8256)throw new Error("Maximum maxSharedStructure + maxOwnStructure is 8192");let m=[],y=0,b=0;this.pack=this.encode=function(A,P){if(bt||(bt=new bF(8192),gs=new DataView(bt.buffer,0,8192),ct=0),rd=bt.length-10,rd-ct<2048?(bt=new bF(bt.length),gs=new DataView(bt.buffer,0,bt.length),rd=bt.length-10,ct=0):ct=ct+7&2147483640,e=ct,s=l.structuredClone?new Map:null,l.bundleStrings?(nd=["",""],bt[ct++]=214,bt[ct++]=98,nd.position=ct-e,ct+=4):nd=null,i=l.structures,i){i.uninitialized&&(i=l._mergeStructures(l.getStructures()));let C=i.sharedLength||0;if(C>h)throw new Error("Shared structures is larger than maximum shared structures, try increasing maxSharedStructures to "+i.sharedLength);if(!i.transitions){i.transitions=Object.create(null);for(let R=0;R<C;R++){let I=i[R];if(!I)continue;let k,z=i.transitions;for(let V=0,F=I.length;V<F;V++){let $=I[V];k=z[$],k||(k=z[$]=Object.create(null)),z=k}z[mE]=R+64}a=C}c||(i.nextId=C+64)}r&&(r=!1),n=i||[];try{if(w(A),nd){gs.setUint32(nd.position+e,ct-nd.position-e);let C=nd;nd=null,w(C[0]),w(C[1])}if(l.offset=ct,s&&s.idsToInsert){ct+=s.idsToInsert.length*6,ct>rd&&M(ct),l.offset=ct;let C=tit(bt.subarray(e,ct),s.idsToInsert);return s=null,C}return P&iit?(bt.start=e,bt.end=ct,bt):bt.subarray(e,ct)}finally{if(i){if(b<10&&b++,y>1e4)i.transitions=null,b=0,y=0,m.length>0&&(m=[]);else if(m.length>0&&!c){for(let C=0,R=m.length;C<R;C++)m[C][mE]=0;m=[]}if(r&&l.saveStructures){let C=i.sharedLength||h;i.length>C&&(i=i.slice(0,C));let R=bt.subarray(e,ct);return l.saveStructures(i,a)===!1?(l._mergeStructures(l.getStructures()),l.pack(A)):(a=C,R)}}P&rit&&(ct=e)}};let w=A=>{ct>rd&&(bt=M(ct));var P=typeof A,C;if(P==="string"){let R=A.length;if(nd&&R>=8&&R<4096){let z=Jtt.test(A);nd[z?0:1]+=A,bt[ct++]=193,w(z?-R:R);return}let I;R<32?I=1:R<256?I=2:R<65536?I=3:I=5;let k=R*3;if(ct+k>rd&&(bt=M(ct+k)),R<64||!o){let z,V,F,$=ct+I;for(z=0;z<R;z++)V=A.charCodeAt(z),V<128?bt[$++]=V:V<2048?(bt[$++]=V>>6|192,bt[$++]=V&63|128):(V&64512)===55296&&((F=A.charCodeAt(z+1))&64512)===56320?(V=65536+((V&1023)<<10)+(F&1023),z++,bt[$++]=V>>18|240,bt[$++]=V>>12&63|128,bt[$++]=V>>6&63|128,bt[$++]=V&63|128):(bt[$++]=V>>12|224,bt[$++]=V>>6&63|128,bt[$++]=V&63|128);C=$-ct-I}else C=o(A,ct+I,k);C<32?bt[ct++]=160|C:C<256?(I<2&&bt.copyWithin(ct+2,ct+1,ct+1+C),bt[ct++]=217,bt[ct++]=C):C<65536?(I<3&&bt.copyWithin(ct+3,ct+2,ct+2+C),bt[ct++]=218,bt[ct++]=C>>8,bt[ct++]=C&255):(I<5&&bt.copyWithin(ct+5,ct+3,ct+3+C),bt[ct++]=219,gs.setUint32(ct,C),ct+=4),ct+=C}else if(P==="number")if(A>>>0===A)A<64?bt[ct++]=A:A<256?(bt[ct++]=204,bt[ct++]=A):A<65536?(bt[ct++]=205,bt[ct++]=A>>8,bt[ct++]=A&255):(bt[ct++]=206,gs.setUint32(ct,A),ct+=4);else if(A>>0===A)A>=-32?bt[ct++]=256+A:A>=-128?(bt[ct++]=208,bt[ct++]=A+256):A>=-32768?(bt[ct++]=209,gs.setInt16(ct,A),ct+=2):(bt[ct++]=210,gs.setInt32(ct,A),ct+=4);else{let R;if((R=this.useFloat32)>0&&A<4294967296&&A>=-2147483648){bt[ct++]=202,gs.setFloat32(ct,A);let I;if(R<4||(I=A*PG[(bt[ct]&127)<<1|bt[ct+1]>>7])>>0===I){ct+=4;return}else ct--}bt[ct++]=203,gs.setFloat64(ct,A),ct+=8}else if(P==="object")if(!A)bt[ct++]=192;else{if(s){let I=s.get(A);if(I){if(!I.id){let k=s.idsToInsert||(s.idsToInsert=[]);I.id=k.push(I)}bt[ct++]=214,bt[ct++]=112,gs.setUint32(ct,I.id),ct+=4;return}else s.set(A,{offset:ct-e})}let R=A.constructor;if(R===Object)E(A,!0);else if(R===Array){C=A.length,C<16?bt[ct++]=144|C:C<65536?(bt[ct++]=220,bt[ct++]=C>>8,bt[ct++]=C&255):(bt[ct++]=221,gs.setUint32(ct,C),ct+=4);for(let I=0;I<C;I++)w(A[I])}else if(R===Map){C=A.size,C<16?bt[ct++]=128|C:C<65536?(bt[ct++]=222,bt[ct++]=C>>8,bt[ct++]=C&255):(bt[ct++]=223,gs.setUint32(ct,C),ct+=4);for(let[I,k]of A)w(I),w(k)}else{for(let I=0,k=c3.length;I<k;I++){let z=RG[I];if(A instanceof z){let V=c3[I];if(V.write){V.type&&(bt[ct++]=212,bt[ct++]=V.type,bt[ct++]=0),w(V.write.call(this,A));return}let F=bt,$=gs,K=ct;bt=null;let X;try{X=V.pack.call(this,A,U=>(bt=F,F=null,ct+=U,ct>rd&&M(ct),{target:bt,targetView:gs,position:ct-U}),w)}finally{F&&(bt=F,gs=$,ct=K,rd=bt.length-10)}X&&(X.length+ct>rd&&M(X.length+ct),ct=eit(X,bt,ct,V.type));return}}E(A,!A.hasOwnProperty)}}else if(P==="boolean")bt[ct++]=A?195:194;else if(P==="bigint"){if(A<BigInt(1)<<BigInt(63)&&A>=-(BigInt(1)<<BigInt(63)))bt[ct++]=211,gs.setBigInt64(ct,A);else if(A<BigInt(1)<<BigInt(64)&&A>0)bt[ct++]=207,gs.setBigUint64(ct,A);else if(this.largeBigIntToFloat)bt[ct++]=203,gs.setFloat64(ct,Number(A));else throw new RangeError(A+" was too large to fit in MessagePack 64-bit integer format, set largeBigIntToFloat to convert to float-64");ct+=8}else if(P==="undefined")this.encodeUndefinedAsNil?bt[ct++]=192:(bt[ct++]=212,bt[ct++]=0,bt[ct++]=0);else if(P==="function")w(this.writeFunction&&this.writeFunction());else throw new Error("Unknown type: "+P)},E=this.useRecords===!1?this.variableMapSize?A=>{let P=Object.keys(A),C=P.length;C<16?bt[ct++]=128|C:C<65536?(bt[ct++]=222,bt[ct++]=C>>8,bt[ct++]=C&255):(bt[ct++]=223,gs.setUint32(ct,C),ct+=4);let R;for(let I=0;I<C;I++)w(R=P[I]),w(A[R])}:(A,P)=>{bt[ct++]=222;let C=ct-e;ct+=2;let R=0;for(let I in A)(P||A.hasOwnProperty(I))&&(w(I),w(A[I]),R++);bt[C+++e]=R>>8,bt[C+e]=R&255}:A=>{let P=Object.keys(A),C,R=n.transitions||(n.transitions=Object.create(null)),I=0;for(let z=0,V=P.length;z<V;z++){let F=P[z];C=R[F],C||(C=R[F]=Object.create(null),I++),R=C}let k=R[mE];if(k)k>=96&&f?(bt[ct++]=((k-=96)&31)+96,bt[ct++]=k>>5):bt[ct++]=k;else{k=n.nextId,k||(k=64),k<p&&this.shouldShareStructure&&!this.shouldShareStructure(P)?(k=n.nextOwnId,k<g||(k=p),n.nextOwnId=k+1):(k>=g&&(k=p),n.nextId=k+1);let z=P.highByte=k>=96&&f?k-96>>5:-1;R[mE]=k,n[k-64]=P,k<p?(P.isShared=!0,n.sharedLength=k-63,r=!0,z>=0?(bt[ct++]=(k&31)+96,bt[ct++]=z):bt[ct++]=k):(z>=0?(bt[ct++]=213,bt[ct++]=114,bt[ct++]=(k&31)+96,bt[ct++]=z):(bt[ct++]=212,bt[ct++]=114,bt[ct++]=k),I&&(y+=b*I),m.length>=d&&(m.shift()[mE]=0),m.push(R),w(P))}for(let z=0,V=P.length;z<V;z++)w(A[P[z]])},M=A=>{let P;if(A>16777216){if(A-e>pJ)throw new Error("Packed buffer would be larger than maximum buffer size");P=Math.min(pJ,Math.round(Math.max((A-e)*(A>67108864?1.25:2),4194304)/4096)*4096)}else P=(Math.max(A-e<<2,bt.length-1)>>12)+1<<12;let C=new bF(P);return gs=new DataView(C.buffer,0,P),bt.copy?bt.copy(C,0,e,A):C.set(bt.slice(e,A)),ct-=e,e=0,rd=C.length-10,bt=C}}useBuffer(t){bt=t,gs=new DataView(bt.buffer,bt.byteOffset,bt.byteLength),ct=0}};RG=[Date,Set,Error,RegExp,ArrayBuffer,Object.getPrototypeOf(Uint8Array.prototype).constructor,Jde];c3=[{pack(t,e,i){let r=t.getTime()/1e3;if((this.useTimestamp32||t.getMilliseconds()===0)&&r>=0&&r<4294967296){let{target:n,targetView:s,position:a}=e(6);n[a++]=214,n[a++]=255,s.setUint32(a,r)}else if(r>0&&r<17179869184){let{target:n,targetView:s,position:a}=e(10);n[a++]=215,n[a++]=255,s.setUint32(a,t.getMilliseconds()*4e6+(r/1e3/4294967296>>0)),s.setUint32(a+4,r)}else if(isNaN(r)){if(this.onInvalidDate)return e(0),i(this.onInvalidDate());let{target:n,targetView:s,position:a}=e(3);n[a++]=212,n[a++]=255,n[a++]=255}else{let{target:n,targetView:s,position:a}=e(15);n[a++]=199,n[a++]=12,n[a++]=255,s.setUint32(a,t.getMilliseconds()*1e6),s.setBigInt64(a+4,BigInt(Math.floor(r)))}}},{pack(t,e,i){let r=Array.from(t),{target:n,position:s}=e(this.structuredClone?3:0);this.structuredClone&&(n[s++]=212,n[s++]=115,n[s++]=0),i(r)}},{pack(t,e,i){let{target:r,position:n}=e(this.structuredClone?3:0);this.structuredClone&&(r[n++]=212,r[n++]=101,r[n++]=0),i([t.name,t.message])}},{pack(t,e,i){let{target:r,position:n}=e(this.structuredClone?3:0);this.structuredClone&&(r[n++]=212,r[n++]=120,r[n++]=0),i([t.source,t.flags])}},{pack(t,e){this.structuredClone?mJ(t,16,e):gJ(_L?Buffer.from(t):new Uint8Array(t),e)}},{pack(t,e){let i=t.constructor;i!==ofe&&this.structuredClone?mJ(t,sfe.indexOf(i.name),e):gJ(t,e)}},{pack(t,e){let{target:i,position:r}=e(1);i[r]=193}}];function mJ(t,e,i,r){let n=t.byteLength;if(n+1<256){var{target:s,position:a}=i(4+n);s[a++]=199,s[a++]=n+1}else if(n+1<65536){var{target:s,position:a}=i(5+n);s[a++]=200,s[a++]=n+1>>8,s[a++]=n+1&255}else{var{target:s,position:a,targetView:o}=i(7+n);s[a++]=201,o.setUint32(a,n+1),a+=4}s[a++]=116,s[a++]=e,s.set(new Uint8Array(t.buffer,t.byteOffset,t.byteLength),a)}function gJ(t,e){let i=t.byteLength;var r,n;if(i<256){var{target:r,position:n}=e(i+2);r[n++]=196,r[n++]=i}else if(i<65536){var{target:r,position:n}=e(i+3);r[n++]=197,r[n++]=i>>8,r[n++]=i&255}else{var{target:r,position:n,targetView:s}=e(i+5);r[n++]=198,s.setUint32(n,i),n+=4}r.set(t,n)}function eit(t,e,i,r){let n=t.length;switch(n){case 1:e[i++]=212;break;case 2:e[i++]=213;break;case 4:e[i++]=214;break;case 8:e[i++]=215;break;case 16:e[i++]=216;break;default:n<256?(e[i++]=199,e[i++]=n):n<65536?(e[i++]=200,e[i++]=n>>8,e[i++]=n&255):(e[i++]=201,e[i++]=n>>24,e[i++]=n>>16&255,e[i++]=n>>8&255,e[i++]=n&255)}return e[i++]=r,e.set(t,i),i+=n,i}function tit(t,e){let i,r=e.length*6,n=t.length-r;for(e.sort((s,a)=>s.offset>a.offset?1:-1);i=e.pop();){let s=i.offset,a=i.id;t.copyWithin(s+r,s,n),r-=6;let o=s+r;t[o++]=214,t[o++]=105,t[o++]=a>>24,t[o++]=a>>16&255,t[o++]=a>>8&255,t[o++]=a&255,n=s}return t}function k_(t){if(t.Class){if(!t.pack&&!t.write)throw new Error("Extension has no pack or write function");if(t.pack&&!t.type)throw new Error("Extension has no type (numeric code to identify the extension)");RG.unshift(t.Class),c3.unshift(t)}Ztt(t)}var cfe=new lfe({useRecords:!1});cfe.pack;cfe.pack;var iit=512,rit=1024,vJ=new lfe({structuredClone:!0});k_({Class:gi.prototype.constructor,type:1,write(t){return{...t}},read(t){return Object.setPrototypeOf(t,gi.prototype),t}});k_({Class:ni.prototype.constructor,type:2,write(t){return[...t]},read(t){return Object.setPrototypeOf(t,ni.prototype),t}});k_({Class:yo.prototype.constructor,type:3,write(t){return[...t]},read(t){return Object.setPrototypeOf(t,yo.prototype),t}});k_({Class:sJ.prototype.constructor,type:4,write(t){return t.id},read(t){return new sJ(t)}});k_({Class:aJ.prototype.constructor,type:5,write(t){return t.data},read(t){return new aJ(t)}});k_({Class:cs.prototype.constructor,type:6,write(t){return{...t}},read(t){return Object.setPrototypeOf(t,cs.prototype),t}});function nit(t){var e=0;if(t.length===0)return e;for(let i=0;i<t.length;i++){let r=t[i];e=(e<<5)-e+r,e=e&e}return e}function $j(t){if(_G(t))return t;if(Array.isArray(t))return t.map($j);if(typeof t=="object"&&t!==null){let e={};for(let i of Object.keys(t).sort())e[i]=$j(t[i]);return Object.setPrototypeOf(e,Object.getPrototypeOf(t)),e}else return t}var u3;(t=>{function e(n){return vJ.pack(n)}t.serialize=e;function i(n){return vJ.unpack(n)}t.deserialize=i;function r(n){return nit(e($j(n))).toString()}t.checksum=r})(u3||(u3={}));var yJ;(t=>{function e(r){return r.type==="Conditional"?r.condition.type==="Distance"?"Distance":"StateChange":r.type}t.toEventUIType=e;function i(r){return r==="Distance"||r==="StateChange"?"Conditional":r}t.fromEventUIType=i})(yJ||(yJ={}));function xJ(t){return t==="MouseDown"||t==="MouseUp"||t==="KeyDown"||t==="KeyUp"||t==="Collision"||t==="Trigger"}var lo={LookAt:[],Follow:["Create"],DragDrop:["Transition","Animation","Audio","Particles","Create","SetVariable","DynamicVariablePlay","Conditional","ClearLocalStorage","UserAPI"],MouseHover:["Transition","Animation","TimelineAnimation","Particles","Create","Destroy","SwitchCamera","SceneTransition","SetVariable","DynamicVariablePlay","Conditional","ClearLocalStorage","UserAPI"],Scroll:["Transition","Animation","TimelineAnimation","Create","SetVariable","DynamicVariablePlay","Conditional","ClearLocalStorage","UserAPI"],Start:["Transition","Animation","TimelineAnimation","Audio","Particles","Video","Create","Destroy","SwitchCamera","SceneTransition","Reset","SetVariable","DynamicVariablePlay","Conditional","ClearLocalStorage","UserAPI"],Conditional:["Transition","Animation","TimelineAnimation","Audio","Particles","Video","Link","Create","Destroy","SwitchCamera","SceneTransition","Reset","SetVariable","DynamicVariablePlay","Conditional","ClearLocalStorage","UserAPI"],MouseDown:["Transition","Animation","TimelineAnimation","Audio","Particles","Video","Link","Create","Destroy","SwitchCamera","SceneTransition","Reset","SetVariable","DynamicVariablePlay","Conditional","ClearLocalStorage","UserAPI"],MouseUp:["Transition","Animation","TimelineAnimation","Audio","Particles","Video","Link","Create","Destroy","SwitchCamera","SceneTransition","Reset","SetVariable","DynamicVariablePlay","Conditional","ClearLocalStorage","UserAPI"],MousePress:["Transition","Animation","TimelineAnimation","Audio","Particles","Video","Link","Create","SwitchCamera","SceneTransition","Reset","SetVariable","DynamicVariablePlay","Conditional","ClearLocalStorage","UserAPI"],KeyDown:["Transition","Animation","TimelineAnimation","Audio","Particles","Video","Link","Create","Destroy","SwitchCamera","SceneTransition","Reset","SetVariable","DynamicVariablePlay","Conditional","ClearLocalStorage","UserAPI"],KeyUp:["Transition","Animation","TimelineAnimation","Audio","Particles","Video","Link","Create","Destroy","SwitchCamera","SceneTransition","Reset","SetVariable","DynamicVariablePlay","Conditional","ClearLocalStorage","UserAPI"],KeyPress:["Transition","Animation","Audio","Particles","Video","Link","Create","SwitchCamera","Reset","SetVariable","DynamicVariablePlay","Conditional","ClearLocalStorage","UserAPI"],GameControl:["Transition","Animation","TimelineAnimation","Audio","Particles","Create","Conditional"],Collision:["Transition","Animation","TimelineAnimation","Audio","Particles","Video","Create","Destroy","Reset","SetVariable","DynamicVariablePlay","Conditional","ClearLocalStorage","UserAPI"],Trigger:["Transition","Audio","Particles","Video","Link","Create","Destroy","SwitchCamera","SceneTransition","Reset","SetVariable","DynamicVariablePlay","Conditional","ClearLocalStorage","UserAPI"],Resize:["Transition","Animation","Audio","Particles","Video","Create","Destroy","SwitchCamera","SceneTransition","Reset","SetVariable","DynamicVariablePlay","Conditional","ClearLocalStorage","UserAPI"],VariableChange:["Transition","Animation","Audio","Particles","Video","Link","Create","Destroy","SwitchCamera","SceneTransition","Reset","SetVariable","DynamicVariablePlay","Conditional","ClearLocalStorage","UserAPI"],API:["Transition","Animation","Audio","Particles","Video","Link","Create","Destroy","SwitchCamera","SceneTransition","Reset","SetVariable","DynamicVariablePlay","Conditional","ClearLocalStorage","UserAPI"],WEBHOOK:["Transition","Animation","Audio","Particles","Video","Link","Create","Destroy","SwitchCamera","SceneTransition","Reset","SetVariable","DynamicVariablePlay","Conditional","ClearLocalStorage","UserAPI"],AIAssistantListener:["SetVariable"],AIAssistantTrigger:["Transition","Animation","Audio","Particles","Video","Link","Create","Destroy","SwitchCamera","SceneTransition","Reset","SetVariable","DynamicVariablePlay","Conditional","ClearLocalStorage","UserAPI"]},bJ;(t=>{function e(r){return r.type==="MouseDown"||r.type==="MouseUp"||r.type==="MousePress"||r.type==="KeyDown"||r.type==="KeyUp"||r.type==="KeyPress"}t.is=e;function i(r){return r==="MouseDown"||r==="MouseUp"||r==="MousePress"?{type:r,mode:"Object",disabled:!1,actions:new ni}:{type:r,disabled:!1,key:void 0,actions:new ni}}t.defaultData=i})(bJ||(bJ={}));var h3;(t=>{function e(i){return{type:"Property",value:[i??null,"position","x"]}}t.propertyDefaultData=e,t.valueDefaultData={type:"Literal",value:0}})(h3||(h3={}));var Yj;(t=>{function e(n){return{type:"Comparison",operator:"==",lOperand:h3.propertyDefaultData(n),rOperand:{...h3.valueDefaultData}}}t.comparisonDefaultData=e;function i(n){return{type:"Distance",toObject:n??null,fromObject:n??null,distance:200}}t.distanceDefaultData=i;function r(n,s){return{type:"State",object:n??null,state:s??null}}t.stateDefaultData=r})(Yj||(Yj={}));var wJ;(t=>{function e(i){return i.find(r=>r==="ifActions"||r==="elseActions")!==void 0}t.isConditionalSubActions=e})(wJ||(wJ={}));var _J;(t=>{function e(r){return r.type==="Conditional"}t.is=e;function i(r){return{type:"Conditional",disabled:!1,inActions:new ni,outActions:new ni,condition:Yj.distanceDefaultData(r)}}t.defaultData=i})(_J||(_J={}));var SJ;(t=>t.defaultData={type:"DragDrop",cursor:"hand",disabled:!1,dampingFactor:1,objects:[],snapTo:"center",snapSurfaceMode:"bbox",snapSurfaceOffset:0,dropOn:"all",autoOrient:!0,dropDestinations:[],plane:"adaptive",planeMode:"locked",referenceFrame:"global",limits:[-1/0,1/0,-1/0,1/0,-1/0,1/0],drop:!1,resetOnSnapFail:!1,snapSpeed:20,resetSpeed:20,dragDropActions:{drag:new ni,drop:new ni}})(SJ||(SJ={}));var Kj;(t=>t.defaultData={type:"Follow",disabled:!1,maxDelta:0,dampingFactor:1,target:"cursor",plane:"custom",resetOnPointerLeave:!0,resetAfterDistanceLimit:!0,enabledTranslation:[!0,!0,!0],limitDistanceEnabled:!1,limitDistance:1e3,snapDelay:0,resetSpeed:5,actions:new ni})(Kj||(Kj={}));var Zj;(t=>t.defaultData={type:"LookAt",disabled:!1,distance:1e3,dampingFactor:1,target:"cursor",tilt:"up",axis:"z",plane:"custom",resetOnPointerLeave:!0,resetAfterDistanceLimit:!0,enabledRotation:[!0,!0,!0],limitDistanceEnabled:!1,limitDistance:1e3,snapDelay:0,resetSpeed:5})(Zj||(Zj={}));var EJ;(t=>{function e(r){return r.type==="MouseHover"}t.is=e;function i(){return{type:"MouseHover",disabled:!1,actions:new ni}}t.defaultData=i})(EJ||(EJ={}));var AJ;(t=>{function e(r){return r.type==="Scroll"}t.is=e;function i(){return{type:"Scroll",disabled:!1,steps:100,trigger:"load",startFrom:"enter",enterAnchor:"top",startOffset:0,endAfter:400,actions:new ni}}t.defaultData=i})(AJ||(AJ={}));var MJ;(t=>{function e(r){return r.type==="Start"}t.is=e;function i(){return{type:"Start",disabled:!1,actions:new ni}}t.defaultData=i})(MJ||(MJ={}));var TJ;(t=>{function e(r){return r.type==="Collision"}t.is=e;function i(){return{type:"Collision",disabled:!1,target:"character",actions:new ni}}t.defaultData=i})(TJ||(TJ={}));var CJ;(t=>{function e(r){return r.type==="Trigger"}t.is=e;function i(r,n){return{type:"Trigger",disabled:!1,target:"all",triggeringObjects:[],actions:new ni,triggerZone:"box",position:n.toArray(),rotation:[0,0,0],size:r.toArray(),radius:r.length()/2,helperVisible:!0}}t.defaultData=i})(CJ||(CJ={}));var Qj;(t=>{t.defaultSizes={mobile:[480,480],tablet:[768,768],desktop:[1200,1200],custom:[769,1200]};function e(a){return a.type==="Resize"}t.is=e;function i(a){return typeof a=="string"?a:"custom"}t.sizeToDevice=i;function r(a){return typeof a=="string"?[...t.defaultSizes[a]]:[...a]}t.deviceToSize=r;function n(){let a={size:"mobile",operator:"<",actions:new ni},o={size:"tablet",operator:"<",actions:new ni},l={size:[...t.defaultSizes.custom],operator:"<>",actions:new ni},c=new ni;return c.push({id:Ht.generateUUID(),fi:0,data:a},{id:Ht.generateUUID(),fi:1,data:o},{id:Ht.generateUUID(),fi:2,data:l}),{type:"Resize",disabled:!1,orientation:"horizontal",breakpoints:c}}t.defaultData=n;function s(){return{size:[...t.defaultSizes.custom],operator:"<>",actions:new ni}}t.defaultBreakpointData=s})(Qj||(Qj={}));var Jj;(t=>{t.propertyPaths={Position:["position"],"Position X":["position","x"],"Position Y":["position","y"],"Position Z":["position","z"],Rotation:["rotation"],"Rotation X":["rotation","x"],"Rotation Y":["rotation","y"],"Rotation Z":["rotation","z"],Scale:["scale"],"Scale X":["scale","x"],"Scale Y":["scale","y"],"Scale Z":["scale","z"],Width:["width"],Height:["height"],Depth:["depth"],"Mouse Position X":["mouse","x"],"Mouse Position Y":["mouse","y"],"Mouse Pressed":["mouse","pressed"],"Screen Width":["mouse","width"],"Screen Height":["mouse","height"],"Hit Position X":["raycast","x"],"Hit Position Y":["raycast","y"],"Hit Position Z":["raycast","z"],"Hit Object Position X":["raycast","objX"],"Hit Object Position Y":["raycast","objY"],"Hit Object Position Z":["raycast","objZ"]};function e(r){return r.type==="VariableChange"}t.is=e;function i(){return{disabled:!1,type:"VariableChange",actions:new ni,variableId:"",objectId:null,property:"Position X"}}t.defaultData=i})(Jj||(Jj={}));var PJ;(t=>{function e(r){return r.type==="API"}t.is=e;function i(){return{disabled:!1,type:"API",successActions:new ni,errorActions:new ni,userAPIId:""}}t.defaultData=i})(PJ||(PJ={}));var RJ;(t=>{function e(r){return r.type==="WEBHOOK"}t.is=e;function i(){return{disabled:!1,type:"WEBHOOK",actions:new ni,userWebhookId:""}}t.defaultData=i})(RJ||(RJ={}));var IJ;(t=>{function e(r){return r.type==="AIAssistantListener"}t.is=e;function i(){return{disabled:!1,type:"AIAssistantListener",actions:new ni,analysis:"average",analysisRange:[0,71],analysisSingle:0}}t.defaultData=i})(IJ||(IJ={}));var DJ;(t=>{function e(r){return r.type==="AIAssistantTrigger"}t.is=e;function i(){return{disabled:!1,description:"",type:"AIAssistantTrigger",actions:new ni}}t.defaultData=i})(DJ||(DJ={}));var N_="personal camera",IA="a218fcc3-276b-49b9-b485-49037fd14f5f",sit=2960946,Uc=5526619,kd;(t=>{function e(p,g){return p[0]===g[0]&&p[1]===g[1]}t.isEqual=e;function i(p,g,m){return[p[0]+(g[0]-p[0])*m,p[1]+(g[1]-p[1])*m]}t.lerp=i;function r(p,g){return[p[0]+g[0],p[1]+g[1]]}t.add=r;function n(p,g){return[p[0]-g[0],p[1]-g[1]]}t.sub=n;function s(p,g){return[p[0]*g[0],p[1]*g[1]]}t.multiply=s;function a(p,g){return[p[0]/g[0],p[1]/g[1]]}t.divide=a;function o(p,g){return Math.pow(g[0]-p[0],2)+Math.pow(g[1]-p[1],2)}t.distanceSquared=o;function l(p,g){return Math.sqrt(o(p,g))}t.distance=l;function c(p,g){return p[0]*g[0]+p[1]*g[1]}t.dot=c;function u(p,g){return[p[0]*g,p[1]*g]}t.scalarMultiply=u;function h(p,g,m){let y=t.sub(g,p),b=t.sub(m,p),w=t.dot(y,b)/t.dot(y,y),E=t.scalarMultiply(y,w);return t.add(p,E)}t.projectionOnto=h;function d(p,g,m){return l(p,h(p,g,m))}t.projectionOntoDistance=d;function f(p,g){return[(p[0]+g[0])*.5,(p[1]+g[1])*.5]}t.center=f})(kd||(kd={}));var Hg;(t=>{function e(l,c){return l[0]===c[0]&&l[1]===c[1]&&l[2]===c[2]}t.isEqual=e;function i(l,c){return[l[0]+c[0],l[1]+c[1],l[2]+c[2]]}t.add=i;function r(l,c){return[l[0]-c[0],l[1]-c[1],l[2]-c[2]]}t.sub=r;function n(l,c){return[l[0]/c[0],l[1]/c[1],l[2]/c[2]]}t.div=n;function s(l,c){return[l[0]*c[0],l[1]*c[1],l[2]*c[2]]}t.mul=s;function a(l,c){return Math.hypot(l[0]-c[0],l[1]-c[1],l[2]-c[2])}t.dist=a;function o(l,c,u){return[l[0]+(c[0]-l[0])*u,l[1]+(c[1]-l[1])*u,l[2]+(c[2]-l[2])*u]}t.lerp=o})(Hg||(Hg={}));var zM;(t=>{function e(r,n){return r[0]===n[0]&&r[1]===n[1]&&r[2]===n[2]&&r[3]===n[3]}t.isEqual=e;function i(r,n,s){return[r[0]+(n[0]-r[0])*s,r[1]+(n[1]-r[1])*s,r[2]+(n[2]-r[2])*s,r[3]+(n[3]-r[3])*s]}t.lerp=i})(zM||(zM={}));var OJ;(t=>{let e=180/Math.PI,i=Math.PI/180;function r(o){return typeof o=="number"?o*e:o}function n(o){return typeof o=="number"?o*i:o}function s(o){return[r(o[0]),r(o[1]),r(o[2])]}t.radToDeg=s;function a(o){return[n(o[0]),n(o[1]),n(o[2])]}t.degToRad=a})(OJ||(OJ={}));var X1;(t=>{t.identity=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];function e(n,s){for(let a=0;a<16;a++)if(n[a]!==s[a])return!1;return!0}t.isEqual=e;function i(n){return n??t.identity}t.simplify=i;function r(n,s){let a=s.slice(0);for(var o=0,l=s.length;o<l;o+=3){let c=n[3]*s[o]+n[7]*s[o+1]+n[11]*s[o+2]+n[15];a[o]=(n[0]*s[o]+n[4]*s[o+1]+n[8]*s[o+2]+n[12])/c,a[o+1]=(n[1]*s[o]+n[5]*s[o+1]+n[9]*s[o+2]+n[13])/c,a[o+2]=(n[2]*s[o]+n[6]*s[o+1]+n[10]*s[o+2]+n[14])/c}return a}t.applyMatrix4=r})(X1||(X1={}));var ca;(t=>{function e(u){return typeof u=="object"&&typeof u.r=="number"&&typeof u.g=="number"&&typeof u.b=="number"}t.isRGB=e,t.white={r:1,g:1,b:1},t.red={r:1,g:0,b:0},t.black={r:0,g:0,b:0};function i(u){return{r:Math.round(u.r*255),g:Math.round(u.g*255),b:Math.round(u.b*255),a:1}}t.toRgb255a1=i;function r(u){return{r:u.r,g:u.g,b:u.b}}t.clone=r;function n(u){return u=Math.floor(u),{r:(u>>16&255)/255,g:(u>>8&255)/255,b:(u&255)/255}}t.fromHex=n;function s(u){return Math.round(u.r*255)*65536+Math.round(u.g*255)*256+Math.round(u.b*255)}t.toHex=s;function a(u,h){return u.r===h.r&&u.g===h.g&&u.b===h.b}t.equals=a;function o(u,h){return u.r.toFixed(2)===h.r.toFixed(2)&&u.g.toFixed(2)===h.g.toFixed(2)&&u.b.toFixed(2)===h.b.toFixed(2)}t.equalsFixed=o;function l(u,h,d){return{r:u.r+(h.r-u.r)*d,g:u.g+(h.g-u.g)*d,b:u.b+(h.b-u.b)*d}}t.lerp=l;function c(u){return Nc(u)?"r"in u&&"g"in u&&"b"in u&&!("a"in u):!1}t.is=c})(ca||(ca={}));var Xr;(t=>{t.white={...ca.white,a:1};function e(c){return Nc(c)?"r"in c&&"g"in c&&"b"in c&&"a"in c:!1}t.is=e,t.transparent={...ca.white,a:0};function i(c){return{r:c[0],g:c[1],b:c[2],a:c[3]}}t.from0to1=i;function r(c,u){return{...ca.fromHex(c),a:u}}t.fromHexAndA=r;function n(c){return{r:Math.round(c.r*255),g:Math.round(c.g*255),b:Math.round(c.b*255),a:c.a}}t.toRgb255a1=n;function s(c,u){return ca.equals(c,u)&&c.a===u.a}t.equals=s;function a(c,u){return ca.equalsFixed(c,u)&&c.a.toFixed(2)===u.a.toFixed(2)}t.equalsFixed=a;function o(c,u,h){return{r:c.r+(u.r-c.r)*h,g:c.g+(u.g-c.g)*h,b:c.b+(u.b-c.b)*h,a:c.a+(u.a-c.a)*h}}t.lerp=o;function l({r:c,g:u,b:h,a:d}=t.white){return`rgba(${c*255}, ${u*255}, ${h*255}, ${d})`}t.toStyle=l})(Xr||(Xr={}));var e5;(t=>t.identity={position:[0,0,0],rotation:[0,0,0],scale:[1,1,1]})(e5||(e5={}));var ait=(t=>(t[t.LINEAR=0]="LINEAR",t[t.EASE=1]="EASE",t[t.EASE_IN=2]="EASE_IN",t[t.EASE_OUT=3]="EASE_OUT",t[t.EASE_IN_OUT=4]="EASE_IN_OUT",t[t.CUBIC=5]="CUBIC",t[t.SPRING=6]="SPRING",t[t.ARC=7]="ARC",t[t.NONE=8]="NONE",t))(ait||{}),d3;(t=>t.defaultData={mass:1,stiffness:80,damping:10,velocity:0})(d3||(d3={}));var f3;(t=>t.defaultData={control1:[.5,0],control2:[.5,1]})(f3||(f3={}));var pg;(t=>(t.linear=[0,0,1,1],t.ease=[.25,.1,.25,1],t.easeIn=[.42,0,1,1],t.easeOut=[0,0,.58,1],t.easeInOut=[.42,0,.58,1]))(pg||(pg={}));function LJ(t){return typeof t=="string"&&t.length===36?/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i.test(t):!1}var B0;(t=>{t.all=["PerspectiveCamera","OrthographicCamera"];function e(i){return t.all.includes(i)}t.is=e})(B0||(B0={}));var $1;(t=>{t.DefaultUp=[0,1,0],t.DefaultTargetOffset=1e3,t.defaultData={far:1e5,type:"OrthographicCamera",perspective:{near:70,fov:45,zoom:1},orthographic:{near:-1e5,zoom:1},up:t.DefaultUp,isUpVectorFlipped:!1,targetOffset:t.DefaultTargetOffset};function e(i){return i.type==="PerspectiveCamera"?i.perspective?.zoom??1:i.orthographic?.zoom??1}t.getZoom=e})($1||($1={}));var Ig;(t=>{function e(n,s=.1){return{disabled:!1,type:"linear",hideBase:!1,count:3,radial:{radius:Math.max(n[0],n[1])*2,start:0,end:360,alignment:!1,axis:"y",scale:[1,1,1],rotation:[0,0,0],position:[0,0,0]},toObject:{object:"",spreadType:"random",scale:[0,0,0],rotation:[0,0,0],position:[0,0,0],axis:"x",seed:0,count:99,align:"normal"},linear:{scale:[1,1,1],rotation:[0,0,0],position:[n[0]+n[0]*s,0,0]},grid:{count:[2,2,2],size:n.map(a=>a*(1+s)),useCenter:!0},randomness:!1,randomnessObject:{strength:100,scale:[0,0,0],rotation:[0,0,0],position:[0,0,0],movement:1,seed:0,freqScale:10,noiseType:"perlin"}}}t.defaultData=e;function i(n,s){let a={...n};if(ufe.forEach(o=>{Object.assign(a,{[o]:s[o]??n[o]})}),a.radial={...n.radial},s.radial){let o=n.radial,l=s.radial;IG.forEach(c=>{Object.assign(a.radial,{[c]:l[c]??o[c]})})}if(a.linear={...n.linear},s.linear){let o=n.linear,l=s.linear;DG.forEach(c=>{Object.assign(a.linear,{[c]:l[c]??o[c]})})}if(a.grid={...n.grid},s.grid){let o=n.grid,l=s.grid;OG.forEach(c=>{Object.assign(a.grid,{[c]:l[c]??o[c]})})}if(a.toObject={...n.toObject},s.toObject){let o=n.toObject,l=s.toObject;LG.forEach(c=>{Object.assign(a.toObject,{[c]:l[c]??o[c]})})}if(a.randomnessObject={...n.randomnessObject},s.randomnessObject){let o=n.randomnessObject,l=s.randomnessObject;kG.forEach(c=>{Object.assign(a.randomnessObject,{[c]:l[c]??o[c]})})}return a}t.merge=i;function r(n){return!!(n.randomnessObject||n.toObject)}t.isPartial=r})(Ig||(Ig={}));var t5;(t=>{t.defaultData={radial:{},linear:{},grid:{},toObject:{},randomnessObject:{}};let e=["radial","linear","grid","toObject","randomnessObject"];function i(r,n){let s=[];r.count!==void 0&&s.push({type:0,path:n,props:{count:r.count}});for(let a of e){let o=r[a];o&&Object.keys(o).length>0&&s.push({type:0,path:[...n,a],props:o})}return s}t.toOps=i})(t5||(t5={}));var ufe=["count"],IG=["radius","start","end","position","scale","rotation"],DG=["position","scale","rotation"],OG=["count","size"],LG=["count","position","scale","rotation"],kG=["strength","scale","rotation","position","movement","seed","freqScale"],i5;(t=>{t.all=["PointLight","SpotLight","DirectionalLight","HemisphereLight"];function e(i){return t.all.includes(i)}t.is=e})(i5||(i5={}));var r5;(t=>{function e(r){return i(r)}t.defaultData=e;function i(r){if(r==="PointLight")return{type:r,color:Xr.white,intensity:1,distance:2e3,decay:1,shadows:!0,shadowResolution:1024,shadowRadius:1,penumbraSize:.5,depth:1e5};if(r==="SpotLight")return{type:r,color:Xr.white,intensity:1,distance:2e3,decay:1,shadows:!0,penumbra:0,angle:30/180*Math.PI,depth:1e5,penumbraSize:.5,shadowResolution:1024,shadowRadius:1};if(r==="DirectionalLight")return{type:r,color:Xr.white,intensity:1,shadows:!0,size:2e3,depth:1e5,penumbraSize:.5,shadowResolution:1024,shadowRadius:1};throw new Error("not implemented")}})(r5||(r5={}));var p3;(t=>(t.defaultShapeData={type:"PlaneEmitterShape",size:[100,100,100]},t.defaultCollisionData={colliderEntityId:null,collisionBounce:.75},t.defaultData={renderMaterial:{type:"particleMaterial",color:{r:1,g:.2,b:.545,a:1},color2:{r:.945,g:.714,b:.184,a:1},coloring:"gradient",ease:"linearFadeOut",easeSize:"linearFadeOut",transparent:!0,size:[40,40],texture:"pt_default_particle",spriteRotation:[0,0]},birthRatePerSec:50,gravity:1,noiseStrength:0,noiseScale:0,noiseSeed:1,noiseType:"curl",randomRotation:0,randomScale:.2,randomMass:.5,rootObjectType:"instancedMesh",life:1,direction:[0,0,0],directionMode:"axis",speed:10,shape:t.defaultShapeData,autoPlay:!0,emitTimeDelay:0,emitTimeCycle:"infinity",emitTimeDuration:1,...t.defaultCollisionData}))(p3||(p3={}));var Y1;(t=>t.defaultData={enabled:"visibility",fusedBody:!0,rigidBody:"positioned",density:1,pointMass:0,gravityScale:1,friction:.5,damping:0,restitution:.2,colliderType:"convex",enabledRotation:[!0,!0,!0],enabledTranslation:[!0,!0,!0]})(Y1||(Y1={}));var n5;(t=>{t.defaultData={castShadow:!0,receiveShadow:!0};function e(i,r){return i.castShadow===r.castShadow&&i.receiveShadow===r.receiveShadow}t.equals=e})(n5||(n5={}));var s5;(t=>{t.defaultData={flatShading:!1,wireframe:!1,side:0};function e(i,r){return i.flatShading===r.flatShading&&i.side===r.side&&i.wireframe===r.wireframe}t.equals=e})(s5||(s5={}));var a5;(t=>t.defaultData={...s5.defaultData,...n5.defaultData})(a5||(a5={}));var kJ;(t=>{function e(i,r){let n=[];if("material"in i){let s=typeof i.material=="string"?r.materials[i.material]??r.lib.materials[i.material]?.asset:i.material;s&&n.push(s)}else if("materials"in i)for(let s of i.materials){let a=typeof s=="string"?r.materials[s]??r.lib.materials[s]?.asset:s;a&&n.push(a)}return n}t.getMaterialData=e})(kJ||(kJ={}));var m3;(t=>(t.defaultVideo={data:"",thumb:"/_assets/_videos/catThumb.png",type:"video",name:"Cat video"},t.maxSize=3e7))(m3||(m3={}));var NJ;(t=>{function e(i){return i==="texture"||i==="video"||i==="color"||i==="depth"||i==="normal"||i==="gradient"||i==="noise"||i==="fresnel"||i==="rainbow"||i==="toon"||i==="outline"||i==="particle"||i==="transmission"||i==="matcap"||i==="displace"||i==="pattern"||i==="light"}t.is=e})(NJ||(NJ={}));function oit(t){return t.type!=="displace"}var UJ;(t=>{function e(i){return i==="phong"||i==="toon"||i==="lambert"||i==="physical"}t.is=e})(UJ||(UJ={}));var hfe=["mode","gradientType","noiseType","displacementType","projection","cnormal","crop","axis","side"],lit=["wrapping","image","video","name","minFilter","magFilter"],Ba;(t=>{function e(s,a){let{texture:o,...l}=a;if(Object.assign(s,l),o){let c=s.texture;c&&Object.assign(c,o)}}t.patch=e;function i(s,a){return s==="light"&&a?r(a):n(s)}t.defaultData=i;function r(s){let a={mode:0,isMask:!1,visible:!0,bumpMap:void 0,bumpMapIntensity:5,roughnessMap:void 0,alphaOverride:1};switch(s){case"phong":return{...a,category:"phong",specular:{r:.2,g:.2,b:.2},shininess:5,type:"light",visible:!0,mode:0,occlusion:!0,alpha:.6};case"toon":return{...a,category:"toon",specular:{r:.2,g:.2,b:.2},shininess:10,type:"light",alpha:1};case"lambert":return{...a,category:"lambert",emissive:{r:0,g:0,b:0},type:"light",alpha:1,visible:!0,mode:0,occlusion:!0};case"physical":return{...a,category:"physical",roughness:.2,metalness:.2,reflectivity:.2,type:"light",alpha:1,visible:!0,mode:0,occlusion:!0}}}function n(s){let a={alpha:1,mode:0,isMask:!1,visible:!0};switch(s){case"texture":return{...a,type:"texture",size:[128,128],blending:0,axis:"x",side:2,projection:0,texture:{image:"image_0",wrapping:1e3,repeat:[1,1],offset:[0,0],rotation:0,minFilter:1008,magFilter:1006},crop:!1};case"video":return{...a,type:"video",size:[128,128],blending:0,axis:"x",side:2,projection:0,texture:{video:m3.defaultVideo,wrapping:1001,repeat:[1,1],offset:[0,0],rotation:0,minFilter:1008,magFilter:1006},crop:!1};case"color":return{...a,type:"color",color:ca.fromHex(Uc)};case"depth":return{...a,type:"depth",gradientType:1,smooth:!1,isVector:!0,isWorldSpace:!1,origin:[0,0,0],direction:[1,0,0],colors:[[1,1,1,1],[0,0,0,1]],steps:[0,1],near:50,far:200};case"normal":return{...a,type:"normal",cnormal:[1,1,1]};case"gradient":return{...a,type:"gradient",gradientType:0,smooth:!1,colors:[[0,0,0,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1]],steps:[0,1,1,1,1,1,1,1,1,1],num:2,angle:0,offset:[0,0],morph:[0,0]};case"noise":return{...a,type:"noise",size:[100,100,100],noiseType:0,scale:1,move:1,colorA:{...ca.fromHex(6710886),a:1},colorB:{...ca.fromHex(6710886),a:1},colorC:{...ca.fromHex(16777215),a:1},colorD:{...ca.fromHex(16777215),a:1},distortion:[1,1],fA:[1.7,9.2],fB:[8.3,2.8],voronoiStyle:0,highCut:1,lowCut:0,smoothness:.3,seed:0,quality:1};case"fresnel":return{...a,type:"fresnel",color:Xr.fromHexAndA(16777215,1),bias:.1,scale:1,intensity:2,factor:1};case"rainbow":return{...a,type:"rainbow",filmThickness:30,movement:0,wavelengths:[0,0,0],noiseStrength:0,noiseScale:1,offset:[0,0,0]};case"toon":return{...a,type:"toon",positioning:2,colors:[[0,0,0,1],[.5,.5,.5,1],[.5,.5,.5,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1]],steps:[0,.475,.525,1,1,1,1,1,1,1],num:4,source:[0,1e3,0],isWorldSpace:!0,noiseStrength:0,noiseScale:1,shadowColor:Xr.fromHexAndA(0,0),offset:[0,0,0]};case"outline":return{...a,type:"outline",outlineColor:Xr.fromHexAndA(0,1),contourColor:Xr.fromHexAndA(0,1),outlineWidth:2,contourWidth:5,outlineThreshold:.4,contourThreshold:0,outlineSmoothing:0,contourFrequency:10,contourDirection:[0,1,0],positionalLines:!1,compensation:!0};case"matcap":return{...a,type:"matcap",texture:{image:"matcap_0",wrapping:1001,repeat:[1,1],offset:[0,0],rotation:0,minFilter:1008,magFilter:1006}};case"transmission":return{...a,type:"transmission",thickness:10,ior:1.5,roughness:1};case"displace":return{visible:!0,type:"displace",displacementType:"noise",noiseType:0,scale:10,movement:1,offset:[0,0,0],intensity:8,voronoiStyle:0,smoothness:.3,seed:0,highCut:1,lowCut:0,quality:1};case"pattern":return{...a,type:"pattern",style:0,projection:0,axis:"y",blending:0,offset:[0,0],colorA:{...ca.fromHex(0),a:1},colorB:{...ca.fromHex(16777215),a:1},frequency:[10,10],size:.5,variation:0,smoothness:.5,zigzag:0,rotation:0,vertical:[0,1],horizontal:[0,1],sides:6}}}})(Ba||(Ba={}));var Ga;(t=>{function e(u){return!u.layers.some(h=>h.data.type==="texture"&&h.data.projection!==0||h.data.type==="depth"&&!h.data.isWorldSpace||h.data.type==="noise"||h.data.type==="displace")}t.isMergable=e;function i(u){let h="";return u.layers.forEach(d=>{Object.entries(d.data).forEach(([f,p])=>{h+=`${f}${p}`,Array.isArray(p)?p.forEach(g=>h+=`${g}`):typeof p=="object"?Object.values(p).forEach(g=>{typeof g=="number"?h+=`${g.toFixed(4)}`:h+=`${g}`}):h+=`${p}`})}),h}t.getHash=i;function r(){return{layers:new ni}}t.defaultEmptyData=r;function n(u="layer1",h="layer2"){return a("phong",u,h)}t.defaultData=n;function s(u,h){return{...u,name:h}}t.withName=s;function a(u,h="layer1",d="layer2"){let f=new ni;return f.push({fi:0,data:Ba.defaultData("light",u),id:h}),f.push({fi:1,data:Ba.defaultData("color"),id:d}),{layers:f}}t.defaultTwoLayerData=a;function o(u){let h=Ba.defaultData("texture");u&&Object.assign(h.texture,{image:u});let d=new ni;return d.push({fi:0,data:h,id:"layer1"}),d.push({fi:1,data:{...Ba.defaultData("transmission"),alpha:1},id:"layer2"}),d.push({fi:2,data:{...Ba.defaultData("light","lambert"),alpha:0},id:"layer3"}),{layers:d}}t.defaultUIObjectMaterial=o;function l(u,h="phong",d="layer1",f="layer2"){let p=Ba.defaultData("texture");Object.assign(p.texture,{image:u});let g=new ni;return g.push({fi:0,data:p,id:d}),g.push({fi:1,data:Ba.defaultData("light",h),id:f}),{layers:g}}t.defaultTwoLayerTextureData=l;function c(u,h="phong",d="layer1",f="layer2"){let p=Ba.defaultData("video");Object.assign(p.texture,{video:u});let g=new ni;return g.push({fi:0,data:p,id:d}),g.push({fi:1,data:Ba.defaultData("light",h),id:f}),{layers:g}}t.defaultTwoLayerVideoTextureData=c})(Ga||(Ga={}));var g3;(t=>{function e(){return{points:new ni,roundness:0,shapeHoles:[],isClosed:!1}}t.defaultData=e})(g3||(g3={}));var v3;(t=>{function e(){return{points:new ni,lastInsertionPlane:null,subdivisions:12,isClosed:!1}}t.defaultData=e})(v3||(v3={}));var dfe={type:"Ellipse",width:50,height:50,spikes:16,angle:360,innerRadius:0},o5;(t=>{function e(i,r){let n={...i};return NG.forEach(s=>{Object.assign(n,{[s]:r[s]??i[s]})}),n}t.merge=e})(o5||(o5={}));var ffe={shape:dfe,depth:1,offset:0,bevel:50,bevelSides:6,angle:0,twist:0,startScale:1,endScale:1,capType:"flat"},NG=["depth","offset","angle","twist","startScale","endScale"],y3;(t=>{function e(n){return n==="PolygonGeometry"||n==="RectangleGeometry"||n==="StarGeometry"||n==="TriangleGeometry"||n==="EllipseGeometry"||n==="UIGeometry"}t.is2DParametricMesh=e;function i(n){return n==="PolygonGeometry"||n==="RectangleGeometry"||n==="StarGeometry"||n==="TriangleGeometry"||n==="EllipseGeometry"||n==="PathGeometry"||n==="VectorGeometry"||n==="ConeGeometry"||n==="CubeGeometry"||n==="CylinderGeometry"||n==="DodecahedronGeometry"||n==="HelixGeometry"||n==="IcosahedronGeometry"||n==="LatheGeometry"||n==="PyramidGeometry"||n==="SphereGeometry"||n==="PlaneGeometry"||n==="BackdropGeometry"||n==="TorusGeometry"||n==="TorusKnotGeometry"||n==="BooleanGeometry"||n==="TextGeometry"||n==="InputGeometry"}t.isParametricMesh=i;function r(n){return n==="PolygonGeometry"||n==="RectangleGeometry"||n==="StarGeometry"||n==="TriangleGeometry"||n==="EllipseGeometry"||n==="PathGeometry"||n==="VectorGeometry"||n==="ConeGeometry"||n==="CubeGeometry"||n==="CylinderGeometry"||n==="DodecahedronGeometry"||n==="HelixGeometry"||n==="IcosahedronGeometry"||n==="LatheGeometry"||n==="PyramidGeometry"||n==="SphereGeometry"||n==="PlaneGeometry"||n==="BackdropGeometry"||n==="TorusGeometry"||n==="TorusKnotGeometry"||n==="TextGeometry"||n==="SubdivGeometry"||n==="NonParametricGeometry"}t.isSwappableGeometry=r})(y3||(y3={}));var l5;(t=>{function e(i,r){let n={...i};return Object.assign(n,r),n.type==="PathGeometry"&&"extrusion"in r&&r.extrusion&&(n.extrusion={...i.extrusion},Object.assign(n.extrusion,o5.merge(n.extrusion,r.extrusion))),n}t.merge=e})(l5||(l5={}));var xg;(t=>{function e(i){if(i==="RectangleGeometry")return{width:320,height:320,type:i,cornerRadius:[0,0,0,0],cornerType:0,depth:0,extrudeBevelSize:0,extrudeBevelSegments:1};if(i==="UIGeometry")return{type:i,frame:"",cornerRadius:[0,0,0,0],cornerType:0,width:1,height:1};if(i==="PathGeometry")return{type:i,width:1,height:1,depth:1,path:v3.defaultData(),extrusion:ffe};if(i==="VectorGeometry")return{width:1,height:1,type:i,subdivisions:12,shape:g3.defaultData(),depth:0,extrudeBevelSize:0,extrudeBevelSegments:1};if(i==="BooleanGeometry")return{type:i,operation:2,width:0,height:0,depth:0,phongAngle:35};if(i==="ShapeBlendGeometry")return{type:i,width:0,height:0,depth:0,resolutionLevel:6,blendRange:100,useChildrenColors:!1};if(i==="TextGeometry")return{type:i,width:100,height:100,depth:0,horizontalAlign:1,verticalAlign:1,fontSize:16,lineHeight:1.2,letterSpacing:0,text:{textValue:""},textTransform:1,font:"Roboto_regular",editable:!1,extrudeBevelSize:0,extrudeBevelSegments:1};if(i==="InputGeometry")return{...t.defaultData("TextGeometry"),type:i,editable:!0};if(i==="SphereGeometry")return{type:"SphereGeometry",width:100,height:100,depth:100,widthSegments:64,heightSegments:64,phiStart:0,phiLength:2*Math.PI,thetaStart:0,thetaLength:180};throw new Error("not implemented")}t.defaultData=e})(xg||(xg={}));var wF=["width","height","depth"],c5;(t=>t.defaultData={enabled:!1,useBackgroundColor:!1,color:ca.white,near:.1,far:2e3})(c5||(c5={}));var x3;(t=>{let e={opacity:1,blendFunction:13,enabled:!1};t.defaultData={enabled:!1,pixelation:{...e,blendFunction:16,granularity:15},bloom:{...e,blendFunction:16,intensity:1,blurScale:1,luminanceThreshold:.25,luminanceSmoothing:.025,kernelSize:3},chromaticAberration:{...e,offset:[2,2]},vignette:{...e,darkness:1,offset:0},hueSaturation:{...e,hue:3,saturation:0},brightnessContrast:{...e,brightness:.25,contrast:0},depthOfField:{...e,focusDistance:100,focalLength:20,bokehScale:5},noise:{...e,blendFunction:16}}})(x3||(x3={}));var u5;(t=>t.defaultData={softShadowQuality:"low"})(u5||(u5={}));var h5;(t=>t.defaultData={enabled:!0,color:{r:.8274509803921568,g:.8274509803921568,b:.8274509803921568},intensity:.75})(h5||(h5={}));var d5;(t=>t.defaultData={occlusion:!1,aoFullRes:!1,radius:256,bias:.5,aoColor:{r:.19607843137254902,g:.19607843137254902,b:.19607843137254902}})(d5||(d5={}));var K1;(t=>t.defaultData={usePhysics:!1,gravity:-10})(K1||(K1={}));var f5;(t=>t.defaultData={playCamera:N_,gameControlObject:null})(f5||(f5={}));var p5;(t=>t.defaultData={backgroundColor:Xr.fromHexAndA(sit,1),postprocessing:x3.defaultData,fog:c5.defaultData,globalPhysics:K1.defaultData,ambient:h5.defaultData,ao:d5.defaultData,shadow:u5.defaultData,publish:f5.defaultData})(p5||(p5={}));var m5;(t=>t.defaultData={colliderType:"box",size:[100,100,100],colliderHelperVisible:!0,forceType:"collider",forceRange:"global",forceIntensity:.5,forceDambing:.95})(m5||(m5={}));var BJ;(t=>{function e(r){return r==="Component"||r==="Instance"}t.isComponentRelated=e;function i(r){return r==="Empty"||r==="Instance"}t.isEmptyOrComponent=i})(BJ||(BJ={}));var Z1;(t=>{t.identity={...e5.identity,hiddenMatrix:X1.identity};function e(n){return{position:n.position,rotation:n.rotation,scale:n.scale,hiddenMatrix:n.hiddenMatrix}}t.fromObject=e;function i(n,s){return{position:s?.position||n.position,rotation:s?.rotation||n.rotation,scale:s?.scale||n.scale,hiddenMatrix:s?.hiddenMatrix||n.hiddenMatrix}}t.merge=i;function r(n,s){return kde({position:Hg.isEqual(n.position,s.position)?void 0:s.position,rotation:Hg.isEqual(n.rotation,s.rotation)?void 0:s.rotation,scale:Hg.isEqual(n.scale,s.scale)?null:s.scale,hiddenMatrix:X1.isEqual(n.hiddenMatrix,s.hiddenMatrix)?void 0:s.hiddenMatrix})}t.diff=r})(Z1||(Z1={}));var cit=["slide","offset"],pa;(t=>t.defaultData={states:new ni,events:new ni,timelineAnimations:new gi,visible:!0,raycastLock:!1,physics:Y1.defaultData,pathSnapping:{pathId:null,slide:0,offset:0,orientation:"tangential"},...Z1.identity,cloner:null})(pa||(pa={}));var g5;(t=>t.defaultData={type:"Empty",...pa.defaultData})(g5||(g5={}));var FJ;(t=>t.defaultData={type:"ParticleCollider",...m5.defaultData,...pa.defaultData})(FJ||(FJ={}));var zJ;(t=>t.defaultData={type:"Component",...pa.defaultData})(zJ||(zJ={}));var jJ;(t=>t.defaultData={type:"Particle",...pa.defaultData,...p3.defaultData})(jJ||(jJ={}));var bg;(t=>t.defaultData={type:"Mesh",...pa.defaultData,...a5.defaultData})(bg||(bg={}));var jM;(t=>t.defaultData={...pa.defaultData,...Z1.identity,position:[0,0,$1.DefaultTargetOffset],...$1.defaultData})(jM||(jM={}));var v5;(t=>{function e(i){return{...pa.defaultData,...r5.defaultData(i)}}t.defaultData=e,t.defaultDirectionalLightData={...t.defaultData("DirectionalLight"),position:[200,300,300],name:"Directional Light",intensity:.7}})(v5||(v5={}));var b3;(t=>{function e(r,n,s=0){for(;s<n.length;){let a=r?r[n[s]]:void 0;if(n.length===s+1)return a;if(a)r=a.descendants,s+=1;else return}}t.resolveWithDes=e;function i(r,n,s=0){let a=e(r,n,s);if(a){let o=Object.keys(a);if(o.length===1&&o[0]==="descendants")return}return a}t.resolve=i})(b3||(b3={}));var Dg;(t=>{t.rootOverrideProps=["physics","events"],t.compositeNonOptionalOverrideProps=["geometry"],t.compositeEntireOverrideOverrideProps=["material"];function e(r,n){return{...pa.defaultData,...n,component:r,overrides:new cs,physics:void 0,events:void 0,type:"Instance"}}t.ofComponent=e;function i(r){let n=Z1.fromObject(r.data);return e(r.id,n)}t.fromComponentData=i})(Dg||(Dg={}));var Q1;(t=>{t.defaultData={type:"Page",...pa.defaultData,physics:{...Y1.defaultData,fusedBody:!1},...p5.defaultData,camera:jM.defaultData};function e(i){return i.uiScene!==void 0}t.isUIPage=e})(Q1||(Q1={}));var y5;(t=>(t.defaultCamera={position:[0,0,1e3],scale:[1,1,1],rotation:[0,0,0],hiddenMatrix:X1.identity,name:"Play Camera",visible:!0,raycastLock:!1,physics:Y1.defaultData,states:new ni,events:new ni,timelineAnimations:new gi,cloner:null,pathSnapping:{pathId:null,orientation:"tangential",slide:0,offset:0},...$1.defaultData},t.KeysByResetCategory={States:["states"],Events:["events"],Material:["material","materials"],Geometry:["geometry"],Position:["position"],Rotation:["rotation"],Scale:["scale"],Transform:["position","scale","rotation","hiddenMatrix"],Name:["name"],Visibility:["visible","raycastLock","flatShading","wireframe","side"],Shadows:["castShadow","receiveShadow"],Cloner:["cloner"],Physics:["physics"]},t.defaultMeshObject={name:"Rectangle",...pa.defaultData,...bg.defaultData,geometry:xg.defaultData("RectangleGeometry"),material:Ga.defaultTwoLayerData("phong","layer1","layer2")},t.defaultBooleanObject={name:"Boolean",...pa.defaultData,...bg.defaultData,geometry:xg.defaultData("BooleanGeometry"),material:Ga.defaultTwoLayerData("phong","layer1","layer2")},t.defaultShapeBlendObject={name:"Shape Blend",...pa.defaultData,...bg.defaultData,geometry:xg.defaultData("ShapeBlendGeometry"),material:Ga.defaultTwoLayerData("phong","layer1","layer2")},t.defaultTextObject={name:"Text",...pa.defaultData,...bg.defaultData,geometry:xg.defaultData("TextGeometry"),material:Ga.defaultTwoLayerData("phong","layer1","layer2")},t.defaultInputObject={name:"Input",...pa.defaultData,...bg.defaultData,geometry:xg.defaultData("InputGeometry"),material:Ga.defaultTwoLayerData("phong","layer1","layer2")}))(y5||(y5={}));var Og;(t=>{function e(s,a){let o={name:a};return s.type==="Mesh"?(o.geometry={},"material"in s&&(o.material={layers:new cs}),"materials"in s&&(o.materials=s.materials.map(l=>({layers:new cs})))):B0.is(s.type)&&(o.perspective={},o.orthographic={}),o}t.newEmpty=e;function i(s,a){if(a===void 0)return s;let o={...s};return"material"in o&&"material"in a&&a.material&&(o.material=FM(o.material,l=>{if(typeof l!="string")for(let[c,u]of Object.entries(a.material.layers)){let h=l.layers.data(c);h&&Ba.patch(h,u)}}).data),o.materials&&a.materials&&(o.materials=FM(o.materials,l=>{for(let c=0;c<o.materials.length;c++){let u=a.materials[c];if(typeof u!="string")for(let[h,d]of Object.entries(u.layers)){let f=l[c]?.layers?.data(h);f&&Ba.patch(f,d)}}}).data),o}function r(s,a){let o,l=[],c={orthographic:0,perspective:0,geometry:0};function u(h,d){for(let[f,p]of Object.entries(d.layers)){let{texture:g,...m}=p;if(g!==void 0&&Object.keys(g).length>0){let y={path:[...h,"layers",f,"texture"],props:g,type:0};l.push(y)}if(Object.keys(m).length>0){let y={path:[...h,"layers",f],props:m,type:0};l.push(y)}}}for(let[h,d]of Object.entries(a))if(h!=="name")if(h==="cloner")l.push(...t5.toOps(d,["cloner"]));else if(h==="pathSnapping")l.push({path:[h],props:{slide:d.slide,offset:d.offset},type:0});else if(h==="material")u(["material"],d);else if(h==="materials")for(let[f,p]of Object.entries(d))u(["materials",f],p);else if(c[h]===0){if(h==="geometry"&&d.extrusion!==void 0){let f={path:[h,"extrusion"],props:d.extrusion,type:0};l.push(f),d={...d},delete d.extrusion}if(Object.keys(d).length>0){let f={path:[h],props:d,type:0};l.push(f)}}else o===void 0&&(o={path:[],props:{},type:0},l.push(o)),o.props[h]=d;return l}t.toOps=r;function n(s,a){if(a===void 0)return s;let o={...s};if(Object.assign(o,Z1.merge(o,a)),Object.assign(o,{pathSnapping:Object.assign({},o.pathSnapping,{slide:a.pathSnapping?.slide??o.pathSnapping?.slide??0,offset:a.pathSnapping?.offset??o.pathSnapping?.offset??0})}),B0.is(s.type)){o.orthographic={...o.orthographic},o.perspective={...o.perspective};let l=a;l.orthographic?.zoom!==void 0&&(o.orthographic.zoom=l.orthographic.zoom),l.perspective?.zoom!==void 0&&(o.perspective.zoom=l.perspective.zoom),l.isUpVectorFlipped!==void 0&&(o.isUpVectorFlipped=l.isUpVectorFlipped),l.targetOffset!==void 0&&(o.targetOffset=l.targetOffset)}else if(s.type==="Mesh")"geometry"in a&&Object.assign(o,{geometry:l5.merge(o.geometry,a.geometry)}),(a.material||a.materials)&&(o=i(o,a)),o.cloner&&"cloner"in a&&Object.assign(o,{cloner:Ig.merge(o.cloner,a.cloner)});else if(s.type==="Empty")o.cloner&&"cloner"in a&&Object.assign(o,{cloner:Ig.merge(o.cloner,a.cloner)});else if(i5.is(s.type)){let l=a;l.intensity!==void 0&&(o.intensity=l.intensity),l.color!==void 0&&(typeof l.color=="string"?o.color=l.color:o.color=ca.clone(l.color))}return o}t.patch=n})(Og||(Og={}));var w3;(t=>t.defaultData={enablePan:!0,enableZoom:!0,enableRotate:!0,enableDamping:!0,rotationLimitsMode:0,rotationVerticalOffset:{min:Math.PI/4,max:Math.PI/4},rotationHorizontalOffset:{min:Math.PI/4,max:Math.PI/4},rotationSoftLimit:2,panLimitsMode:0,panVerticalOffset:{min:250,max:250},panHorizontalOffset:{min:250,max:250},panSoftLimit:2,zoomLimitsEnabled:!1,zoomLimits:{min:.1,max:2},autoRotate:!1,autoRotateSpeed:2,autoRotateClockwise:!0,hoverRotatePanMode:0,hoverRotatePanStrength:20,hoverRotateDamping:.125,isTouchZoom:!0,orbitTouches:2,panTouches:3,resetHoverEffectOnPointerLeave:!0})(w3||(w3={}));var Cp;(t=>t.defaultData={orbitControls:w3.defaultData,playPage:IA,withBackground:!0,preventScroll:!1,preventTouchScroll:!1,hideCursor:!1,mouseEventTarget:"canvas",joystickSizeAndXYOffset:Array(12).fill(0).map((e,i)=>{let r=0,n=0;return i<5?n=-30:i<10&&(n=30),i===0||i===10||i===5?r=30:(i===4||i===11||i===9)&&(r=-30),[120,[r,n],"show"]}),settings:{image:{format:"jpg",ratio:1},videoStatic:{fps:60,mbps:150,ratio:1,duration:1e3,activeTimeline:null},video:{format:"mp4",imageFormat:"jpg",fps:30,mbps:80,ratio:Math.max(1,typeof window<"u"?Math.floor(window.devicePixelRatio):1),stopMode:"manual",duration:5e3},web:{logo:!0,compress:!0,preset:1,preload:!0,hint:!1,imageQuality:70,pixelRatioMobile:0,pixelRatioDesktop:0}},stopRaycast:!0,hdTransmission:!1})(Cp||(Cp={}));var x5;(t=>t.defaultData={id:"basic",label:"Basic",style:"None",prompt:""})(x5||(x5={}));var b5;(t=>t.defaultData={weather:0,shadows:0,lightOrigin:0,temperature:0,sun:0,camera:0,environment:0,particles:0,nature:0,floor:0})(b5||(b5={}));var t0;(t=>(t.defaultData=()=>({mode:"line-art-both",prompt:"",negativePrompt:"",style:{...x5.defaultData},isRandomSeed:!0,seed:t.generateSeed(),guessMode:!1,advanced:!1,steps:20,guidanceScale:7.5,controlNetScale:1,modifiers:b5.defaultData}),t.generateSeed=()=>Math.round(Math.random()*1e5)))(t0||(t0={}));var VM;(t=>{function e(r){return r.find(n=>n.data.type==="Page"&&n.data.globalPhysics.usePhysics)!==void 0}t.physicsEnabled=e;function i(r,n,s){r.scene.objects.traverseFrom(n,(a,o)=>{if(o.type==="Instance"){let l=E3.getComponentData(r,o.component)?.data;l&&s(a,o,l.events)}else s(a,o,o.events)})}t.traverseModuleInstances=i})(VM||(VM={}));var i0;(t=>{t.TRASH_CAN_ID="830a2708-8ed9-49cf-a68e-085299892222",t.defaultLight={fi:-1,data:v5.defaultDirectionalLightData,id:"830a2708-8ed9-49cf-a68e-085299899103",children:[]};function e(n=!0,s=[]){let a=[],o=y5.defaultMeshObject;n&&(a.push({...t.defaultLight}),a.push({fi:1,id:"7ba78968-2a55-48f2-b14c-5191da3e075e",data:o,children:[]})),a.push(...s);let l=new yo;return l.push({fi:1,id:IA,data:{...Q1.defaultData,name:"Scene 1"},children:a}),l}t.createDefaultObjectTreeWithPage=e,t.defaultData={objects:e(),publish:Cp.defaultData,styles:t0.defaultData()},t.emptyDataWithoutPage=function(){return{objects:new yo,publish:Cp.defaultData,styles:t0.defaultData()}},t.emptyDataWithPage=function(n=!0){return{objects:e(n),publish:Cp.defaultData,styles:t0.defaultData()}},t.emptyData=function(){return{objects:new yo,publish:{...Cp.defaultData},styles:t0.defaultData()}};function i(n){return{...t.defaultData,objects:lc(n,yo.prototype)}}t.withObjs=i;function r(n,s){return i([{id:n,data:s,children:[],fi:0}])}t.withObj=r})(i0||(i0={}));var DA;(t=>t.defaultData={preset:"fullscreen",allowResponsive:!1,size:[512,512],coords:[0,0],sceneScale:1,color:{r:0,g:0,b:0,a:.5}})(DA||(DA={}));var w5;(t=>(t.defaultData=e=>({url:e,name:"New Webhook",parametersSchemas:new ni}),t.defaultParameterValueByType=e=>e==="number"?0:e==="boolean"?!1:""))(w5||(w5={}));var VJ;(t=>t.defaultData=(e,i="GET")=>({url:e,method:i,name:"New API",headers:new ni,queries:new ni,autoStart:!0}))(VJ||(VJ={}));var xo;(t=>{function e(a){return a.textValue!==void 0}t.isTextValue=e;function i(a){return typeof a=="number"}t.isNumber=i;function r(a){return typeof a=="boolean"}t.isBoolean=r;function n(a){return e(a)?"string":r(a)?"boolean":"number"}t.typeOfVariable=n;function s(a){return t.isTextValue(a)?Array.isArray(a.textValue)?a.textValue.map(o=>o.toString().padStart(a.padding??2,"0")).join(a.deliminator??":")+(a.suffix!==void 0?" "+a.suffix:""):a.textValue.toString():t.isBoolean(a)?a?"True":"False":t.isNumber(a)?parseFloat(a.toFixed(3)).toString():a.toString()}t.getDisplayedValue=s})(xo||(xo={}));var _5;(t=>t.all=["images","videos","colors","audios","particles","fonts","materials","variables"])(_5||(_5={}));var HJ;(t=>t.all=[..._5.all,"components"])(HJ||(HJ={}));var GJ;(t=>{function e(){return{images:new gi,videos:new gi,colors:new gi,audios:new gi,particles:new gi,fonts:new gi,materials:new gi,components:new gi,variables:new gi,userAPIs:new gi,userWebhooks:new gi,timelineAnimations:new gi}}t.defaultData=e})(GJ||(GJ={}));var Yp;(t=>{function e(){return{images:new gi,videos:new gi,colors:new gi,audios:new gi,particles:new gi,fonts:new gi,materials:new gi,components:new gi,variables:new gi,userAPIs:new gi,userWebhooks:new gi,timelineAnimations:new gi}}t.defaultData=e})(Yp||(Yp={}));var hu;(t=>{function e(){let a={};return a["89b10010-844c-11ec-a8a3-0242ac120002"]={r:.5,g:.5,b:.5,a:1,name:"Default Color"},lc(a,gi.prototype)}t.defaultColors=e;function i(){return lc({},gi.prototype)}t.defaultImages=i;function r(){return{catelogs:new gi,materials:new gi,images:new gi,videos:new gi,colors:new gi,timelineAnimations:new gi,audios:new gi,particles:new gi,fonts:new gi,variables:new ni,userAPIs:new gi,userWebhooks:new gi,lib:Yp.defaultData()}}t.emptyData=r;function n(a){switch(a){case"number":return{value:0,name:"Number"};case"boolean":return{value:!1,name:"Boolean"};case"string":return{value:{textValue:"String value"},name:"String"};case"time":let o=[0,0,0];return{name:"Time",value:{textValue:o,deliminator:":",padding:2,suffix:"AM"},dynamicVariableType:"time",format:"HH:mm:ss",format12h24h:"12ampm",timeZone:null,hasEnd:!1,endValue:{textValue:o,deliminator:":",padding:2,suffix:"AM"},autoStart:!0,repeat:!1};case"counter":return{name:"Counter",value:0,dynamicVariableType:"counter",updateInterval:1e3,increment:1,autoStart:!0,hasEnd:!0,endValue:60,repeat:!0,randomStart:!1,range:[0,100],decimals:0};case"random":return{name:"Random",value:0,dynamicVariableType:"random",updateInterval:1e3,increment:1,autoStart:!0,isStatic:!1,hasEnd:!0,endValue:60,repeat:!0,min:0,max:100,decimals:0};default:console.error("Unknown variable type",a)}}t.defaultVariables=n;function s(a,o){if(o.format==="HH:mm:ss"){let l=Math.floor(a/3600),c=Math.floor((a-l*3600)/60),u=Math.round(a-l*3600-c*60);return{textValue:[l,c,u]}}else if(o.format==="mm:ss"){let l=Math.floor(a/60),c=Math.round(a-l*60);return{textValue:[l,c]}}else return o.format==="number"?a=Math.round(a):a=Math.round(a*1e3)/1e3,a}t.getFormattedTimerTime=s})(hu||(hu={}));var _3;(t=>t.list=["idle","move","jump","run"])(_3||(_3={}));var S3;(t=>(t.defaultColliderData={type:"capsule",height:200,radius:50,position:[0,0,0],rotation:[0,0,0]},t.defaultDataThirdPerson={moveMode:"walk",forwardDirection:"+z",speedTranslate:1e3,speedRotate:100,runMultiplier:2,rotationMode:"normal",rotBy:"keys",rotByTouch:"drag",delayPos:[.3,.3],delayRot:[.3,.3],keyAssignments:[["moveNegZ","W"],["moveNegX","A"],["movePosZ","S"],["movePosX","D"],["rotPosX",""],["rotPosY",""],["rotNegX",""],["rotNegY",""],["jump","Space"],["run",""],["none","Ctrl"]],touchControl:!0,joystickPosLoc:5,joystickRotLoc:11,jumpTouchButtonLoc:9,collider:t.defaultColliderData,colliderHelperVisible:!0,collisionEnabled:!0,jumpPower:100,resetYPosition:3e3,alignToGround:!1,autoOrientMove:!0,orientWith:"camera",orientMode:"radial",delayPosCamera:.3,delayRotCamera:.3,camera:"",cameraXAxis:"Limit",cameraYAxis:"Free",cameraRotXLimits:[0,Math.PI/2],cameraRotYLimits:[-Math.PI/2,Math.PI/2],gameActions:{idle:new ni,move:new ni,jump:new ni,run:new ni},navmesh:{enabled:!1,ch:6,cs:6,walkableClimb:5,walkableHeight:1,walkableRadius:0,zones:"all",objects:[],helperVisible:!0,destinationHelperRadius:0,destinationHelperColor:Xr.fromHexAndA(3728051,1)}}))(S3||(S3={}));function WJ(t){t.layers.forEach(e=>{if(e.type==="depth"&&e.colorA!==void 0){let i=e.colorA,r=e.colorB,n=[[i.r,i.g,i.b,i.a],[r.r,r.g,r.b,r.a]],s=[0,1];for(let o=2;o<10;o++)n.push(n[1]),s.push(1);let a={...Wd(ws(e),"type","visible","isVector","isWorldSpace","origin","alpha","mode"),near:Math.max(0,e.near),far:Math.max(0,e.far),colors:n,steps:s,num:2,direction:[1,0,0],smooth:!1,gradientType:1};Object.assign(e,a)}else if(e.type==="depth"&&e.gradientType===1&&(e.near<0||e.far<0)){let i={...ws(e),near:Math.max(e.near,0),far:Math.max(e.far,0)};Object.assign(e,i)}})}function wg(t,e){Object.values(t.shared.materials).forEach(i=>e(i))}function _g(t,e){t.scene.objects.traverse((i,r)=>{"materials"in r?r.materials.forEach((n,s)=>{n===void 0&&(r.materials[s]=Ga.defaultData(),n=r.materials[s]),typeof n!="string"&&e(n)}):"material"in r?typeof r.material!="string"&&(r.material===void 0&&(r.material=Ga.defaultData()),e(r.material)):r.type==="Mesh"&&(r.material===void 0&&(r.material=Ga.defaultData()),e(r.material)),"overrides"in r&&Object.values(r.overrides).forEach(n=>{n.material&&typeof n.material!="string"&&Object.getPrototypeOf(n.material)!==cs.prototype&&e(n.material)})})}function uit(t){Object.assign(t.scene.publish,{orbitControls:{...w3.defaultData,...ws(t.scene.publish.orbitControls)}})}function hit(t){Object.assign(t.scene.publish.settings,{video:{...Cp.defaultData.settings.video,...ws(t.scene.publish.settings.video)}})}function dit(t){function e(i){if(i.layers){for(let r of Object.values(i.layers))if(r){for(let[n,s]of Object.entries(r))if((hfe.includes(n)||typeof s=="boolean")&&delete r[n],n==="texture")for(let[a,o]of Object.entries(s))(lit.includes(a)||typeof o=="boolean")&&delete s[a]}}}t.scene.objects.traverse((i,r)=>{r.states.forEach(n=>{let s=n;s.material?e(s.material):s.materials&&s.materials.forEach(a=>{e(a)})})})}function fit(t){t.scene.publish.withBackground=!0}function pit(t){t.scene.publish.settings.web={compress:!0,preload:!0,preset:1,logo:!0,hint:!1}}function mit(t){t.scene.objects.traverse((e,i)=>{let r=i.cloner;r&&(r.radial.scale=r.radial.scale.map(n=>n+1),r.linear.scale=r.linear.scale.map(n=>n+1))})}function git(t){t.scene.objects.traverse((e,i)=>{let r=i.geometry;r&&(r.type==="DodecahedronGeometry"||r.type==="IcosahedronGeometry")&&(r.detail=Math.round(r.detail))})}function vit(t){t.scene.objects.traverse((e,i)=>{let r=t.scene.objects.unproxy().parent(e);if(r){let n=ws(t.scene.objects.data(r));n&&n.type==="Mesh"&&n.geometry.type==="BooleanGeometry"&&i.type==="Mesh"&&(i.visible=ws(i).booleanExclude!==!0)}})}function yit(t){t.scene.objects.traverse((e,i)=>{if(i.type==="Mesh"){let r=i;i.geometry.type==="NonParametricGeometry"?r.material!==void 0&&delete r.material:r.materials!==void 0&&delete r.materials}})}function xit(t){function e(r){Object.setPrototypeOf(r,cs.prototype),r.texture&&Object.setPrototypeOf(r.texture,cs.prototype)}function i(r){Object.setPrototypeOf(r,cs.prototype);for(let n in r)e(r[n])}t.scene.objects.traverse((r,n)=>{n.states.forEach(s=>{let a=s;if(a.material){let o=ws(a.material).layers;i(o),a.material.layers=o}if(a.materials)for(let o=0;o<a.materials.length;o++){let l=a.materials[o],c=ws(l).layers;i(c),l.layers=c}})})}function qJ(t){t.layers===void 0&&Object.assign(t,Ga.defaultTwoLayerData("lambert"))}function _F(t){!t.layers||t.layers.forEach(e=>{if(e.type==="depth"&&e.colors.length===10){let i=[...e.colors];i.push(e.colors[9]);let r=[...e.steps];r.push(e.steps[9]);let n={...ws(e),colors:i,steps:r};Object.assign(e,n)}})}function bit(t){t.scene.objects.traverse((e,i)=>{i.type==="Mesh"&&(i.geometry.type==="BooleanGeometry"||i.geometry.type==="SubdivGeometry")&&(i.geometry.phongAngle=35)})}function XJ(t){t.scene.objects.traverse((e,i)=>{"materials"in i?i.materials.forEach(r=>{typeof r!="string"&&_F(r)}):"material"in i&&typeof i.material!="string"&&_F(i.material)}),Object.values(t.shared.materials).forEach(e=>_F(e))}function wit(t){t.scene.environment.ambientLight.softShadows=!1,t.scene.environment.ambientLight.softShadowQuality="low",t.scene.objects.traverse((e,i)=>{(i.type==="DirectionalLight"||i.type==="SpotLight")&&(i.shadowResolution=1024,i.shadowRadius=1,i.depth=1e5)}),t.shared.penumbraSize=new Array(5).fill(.5)}function _it(t){t.shared.audios=lc({},gi.prototype)}function Sit(t){t.shared.videos=lc({},gi.prototype)}function Eit(t){let e=t.shared.materials;Object.entries(e).forEach(([i,r])=>{if(!r.layers){let n={name:"Untitled Material",layers:[{fi:0,data:{type:"light",category:"phong",alpha:.6,visible:!0,mode:0,specular:{r:.2,g:.2,b:.2},shininess:5},id:"layer1"},{fi:1,data:{type:"color",alpha:1,visible:!0,mode:0,color:{r:.2823529411764706,g:.2823529411764706,b:.30196078431372547}},id:"layer2"}]};Object.assign(e,{[i]:n})}})}function Ait(t){Object.entries(ws(t.shared.images)).filter(e=>e[1].asset===!1).map(e=>e[0]).forEach(e=>{delete t.shared.images[e]}),Object.entries(ws(t.shared.audios)).filter(e=>e[1].asset===!1).map(e=>e[0]).forEach(e=>{delete t.shared.audios[e]})}function Mit(t){t.scene.publish.settings.web.preload=!1}function $J(t){t.layers&&t.layers.forEach(e=>{e.type==="depth"&&e.num!==void 0&&(e.colors=e.colors.slice(0,e.num),e.steps=e.steps.slice(0,e.num),delete e.num)})}function YJ(t){t.layers&&t.layers.forEach(e=>{oit(e)&&e.isMask===void 0&&(e.isMask=!1),(e.type==="texture"||e.type==="video")&&e.blending===void 0&&(e.blending=0),(e.type==="noise"||e.type==="displace"&&e.displacementType==="noise")&&(e.voronoiStyle===void 0&&(e.voronoiStyle=0),e.highCut===void 0&&(e.highCut=1),e.lowCut===void 0&&(e.lowCut=0),e.smoothness===void 0&&(e.smoothness=.3),e.seed===void 0&&(e.seed=0),e.quality===void 0&&(e.quality=1))})}function Tit(t){t.shared.fonts=lc({},gi.prototype)}function Cit(t){return t.replace(".typeface","").replace(/optimer/gi,"open sans").replace("space_mono","space mono").replace(/alma_mono/gi,"varela round").replace(/droid_sans_mono/gi,"noto sans mono").replace(/droid_sans|gentilis|gnomon_(simple|foreground)|helvetiker/gi,"roboto").replace(/droid_serif/gi,"roboto slab").replace("_sans"," sans").replace("crimson_text","crimson text").replace("medium_medium","medium").replace("fatface_fatface","fatface").replace("100hairline","thin").replace("200thin","extralight").replace("300light","light").replace("500medium","medium").replace("600semi","semibold").replace("800heavy","extrabold").replace("900black","black").replace(/bodoni_(11|16|24|36|48|72|96)([^_])/gi,"bodoni_$1_$2").replace(/bodoni_(11|16|24|36|48|72|96)/gi,"bodoni moda").replace(/(thin|hairline)(_regular)?/gi,"100").replace(/(extra|ultra)light(_regular)?/gi,"200").replace(/light(_regular)?/gi,"300").replace(/_book|_normal|_roman/gi,"_regular").replace(/medium(_regular)?/gi,"500").replace(/(semi|demi)bold(_regular)?/gi,"600").replace(/(extra|ultra)bold(_regular)?/gi,"800").replace(/bold(_regular)?/gi,"700").replace(/(black|heavy|fatface)(_regular)?/gi,"900").replace(/([1-9]00)_italic/gi,"$1italic").replace(/regularitalic/gi,"italic").replace(/regularitalic/gi,"italic").split(" ").map(e=>e.charAt(0).toUpperCase()+e.slice(1)).join(" ")}function Pit(t){let e=[];t.scene.objects.traverse((i,r)=>{let n=r;if(n.type==="TextFrame"){let s=Ga.defaultTwoLayerData("phong"),a=typeof n.color=="string"?t.shared.colors[n.color]:n.color;s.layers[1].data.color={r:a.r,g:a.g,b:a.b},s.layers[1].data.alpha=n.alpha;let o=Cit(n.font);t.shared.fonts[o]===void 0&&(t.shared.fonts[o]={name:o});let l={name:n.name,...pa.defaultData,...bg.defaultData,flatShading:!1,wireframe:!1,geometry:{...xg.defaultData("TextGeometry"),width:n.width,height:n.height,font:o,depth:0,horizontalAlign:n.horizontalAlign,verticalAlign:n.verticalAlign,fontSize:n.fontSize*1.40625,lineHeight:n.lineHeight/1.40625,letterSpacing:n.letterSpacing-1,text:n.text,textTransform:n.textTransform,extrudeBevelSize:0,extrudeBevelSegments:1},material:s,states:ws(n.states),events:ws(n.events),visible:n.visible,raycastLock:n.raycastLock,position:n.position,rotation:n.rotation,scale:n.scale,hiddenMatrix:n.hiddenMatrix},c=ws(t.scene.objects).parent(i);t.scene.objects.insertAfter(c??null,i,[{id:i+"new",data:l,children:[]}]),e.push(i)}}),e.forEach(i=>{t.scene.objects.delete(i)})}function Rit(t){let e={0:"MouseDown",1:"MouseUp",2:"MouseHover",5:"KeyDown",6:"KeyUp",7:"Start",9:"LookAt",10:"Follow",11:"Scroll",12:"Audio",13:"GameControl"};t.scene.objects.traverse((i,r)=>{r.events.forEach(n=>{if(e[Number(n.type)])if(Object.assign(n,{type:e[Number(n.type)]}),n.type==="Audio"&&"audioEvent"in n&&(Object.assign(n,{playAudio:n.audioEvent}),delete n.audioEvent),n.type==="GameControl")Object.assign(n,{gameActions:{idle:new ni,move:new ni,jump:new ni}});else{let s=new ni;Object.assign(n,{actions:s}),(n.type==="MouseDown"||n.type==="MouseUp"||n.type==="KeyDown"||n.type==="KeyUp")&&"url"in n&&s.push({fi:0,id:Ht.generateUUID(),data:{type:"Link",url:n.url,delay:0}}),"targets"in n&&(n.targets.forEach((a,o,l)=>{let c={state:void 0,repeat:0,delay:0,delayDirection:void 0,direction:"normal",duration:0,easing:4},u={easing:a.easing,duration:a.duration};a.easing===6?Object.assign(u,Wd(a,"mass","stiffness","damping","velocity")):a.easing===5&&Object.assign(u,{control1:{...a.control1},control2:{...a.control2}});let h={repeat:a.repeat?-1:0,delay:a.delay,delayDirection:a.delayDirection,direction:a.cycle&&a.rewind?"pingpong-rewind":a.cycle?"pingpong":"normal"},d={state:a.state,...h,...u},f={allowSlerp:!0,type:"Transition",object:a.object,repeat:0,delay:0,delayDirection:void 0,direction:"normal",tweens:new ni({fi:0,id:Ht.generateUUID(),data:c},{fi:1,id:Ht.generateUUID(),data:d})};s.push({fi:l,id:o,data:f})}),delete n.targets)}})})}function Iit(t){t.scene.objects.traverse((e,i)=>{function r(n,s){let a=new ni,o=[];if(i.events.forEach((l,c,u)=>{if(l.type==="Audio"&&l.trigger===s){let h;o.push(c),l.interaction==="play"?h={...Wd(l,"interaction","audio","delay","volume","loop"),triggerAfter:"after"in l?l.after:void 0,toggle:"after"in l?l.toggle:void 0,type:"Audio"}:(l.interaction==="pause"||l.interaction==="stop")&&(h={...Wd(l,"interaction","delay","object","playAudio"),type:"Audio"}),h&&a.push({fi:u,id:c,data:h})}}),o.forEach(l=>i.events.delete(l)),a.length){let l=i.events.find(c=>c.type===n)?.data;l?"actions"in l&&l.actions.insertBefore(null,a):i.events.insertBefore(null,[{id:Ht.generateUUID(),data:{type:n,actions:a}}])}}r("Start","start"),r("MouseDown","mouseDown"),r("MouseUp","mouseUp"),r("KeyDown","keyDown"),r("KeyUp","keyUp")})}function KJ(t){let e=t.layers.find(i=>i.type==="light")?.data;if(e?.category==="basic"){let i=Ba.defaultData("light","phong"),r=e;Object.assign(r,i),r.visible=!1}}function ZJ(t){wg(t,KJ),_g(t,KJ)}function Dit(t){t.scene.objects.traverse((e,i)=>{i.type==="Mesh"&&i.geometry.type==="SubdivGeometry"&&(i.geometry.scaleBaked||(i.geometry.scaleBaked=[1,1,1]))})}function Oit(t){t.scene.objects.traverse((e,i)=>{(i.type==="Empty"||i.type==="Mesh")&&i.cloner&&!i.cloner.randomnessObject&&!i.cloner.toObject&&!i.cloner.randomness&&(i.cloner={...i.cloner,toObject:{object:"",spreadType:"random",scale:[0,0,0],rotation:[0,0,0],position:[0,0,0],axis:"x",seed:0,count:99,align:"normal"},randomness:!1,randomnessObject:{strength:100,scale:[0,0,0],rotation:[0,0,0],position:[0,0,0],movement:1,seed:0,freqScale:10,noiseType:"perlin"}})})}function Lit(t){t.scene.objects.traverse((e,i)=>{i.type==="Mesh"&&i.geometry.type==="NonParametricGeometry"&&!("material"in i)&&!("materials"in i)&&(i.material=Ga.defaultTwoLayerData("phong"))})}function kit(t){t.scene.publish.orbitControls.autoZoom===void 0&&(t.scene.publish.orbitControls.autoZoom=!1),t.scene.objects.traverse((e,i)=>{(i.type==="OrthographicCamera"||i.type==="PerspectiveCamera")&&(i.orthographic.autoZoom===void 0&&(i.orthographic.autoZoom=!1),i.orthographic.autoZoomFrustumSize===void 0&&(i.orthographic.autoZoomFrustumSize=790))})}function Nit(t){t.scene.objects.traverse((e,i)=>{i.pathSnapping===void 0&&(i.pathSnapping={pathId:null,slide:0,offset:0,orientation:"tangential"}),i.pathSnapping.offset===void 0&&(i.pathSnapping.offset=0)})}function Uit(t){t.scene.publish.mouseEventTarget===void 0&&(t.scene.publish.mouseEventTarget="canvas"),t.scene.publish.settings.web.hint===void 0&&(t.scene.publish.settings.web.hint=!1)}function Bit(t){let{video:e}=t.scene.publish.settings;e.format==="gif"&&e.fps>48&&(e.fps=15)}function Fit(t){t.scene.objects.traverse((e,i)=>{i.events.forEach(r=>{r.type==="GameControl"&&(r.resetYPosition=Math.abs(r.resetYPosition-i.position[1]))})})}function zit(t){let e=t.scene.environment.usePhysics;t.scene.objects.traverse((i,r)=>{e&&r.physics===null?r.collision=!1:r.collision="visibility"})}function jit(t){t.scene.objects.traverse((e,i)=>{i.events.forEach(r=>{r.type==="GameControl"&&(r.navmesh=S3.defaultDataThirdPerson.navmesh)})})}function Vit(t){t.scene.styles||(t.scene.styles=t0.defaultData())}function QJ(t){t.layers.forEach(e=>{e.type==="light"&&e.category!=="toon"&&e.occlusion===void 0&&(e.occlusion=!0)})}function Hit(t){t.scene.environment.ambientLight.occlusion===void 0&&(t.scene.environment.ambientLight.occlusion=!1),t.scene.environment.ambientLight.aoFullRes===void 0&&(t.scene.environment.ambientLight.aoFullRes=!1),t.scene.environment.ambientLight.radius===void 0&&(t.scene.environment.ambientLight.radius=256),t.scene.environment.ambientLight.bias===void 0&&(t.scene.environment.ambientLight.bias=.5),t.scene.environment.ambientLight.aoColor===void 0&&(t.scene.environment.ambientLight.aoColor={r:.19607843137254902,g:.19607843137254902,b:.19607843137254902}),_g(t,QJ),wg(t,QJ)}function Git(t){t.scene.objects.traverse((e,i)=>{i.events.forEach(r=>{r.type==="GameControl"&&Object.assign(r.gameActions,{run:new ni})})})}function Wit(t){t.scene.objects.traverse((e,i)=>{i.events.forEach(r=>{r.type==="GameControl"&&(r.keyAssignments=[...r.keyAssignments,["run",""],["none","Ctrl"]])})})}function JJ(t){t.layers&&t.layers.forEach(e=>{e.type==="light"&&e.bumpMapIntensity===void 0&&(e.bumpMapIntensity=5)})}function qit(t,e){if(e<1&&(_g(t,WJ),wg(t,WJ),t.schema=1),e<2&&(uit(t),t.schema=2),e<3&&(dit(t),t.schema=3),e<4&&(fit(t),t.schema=4),e<5&&(pit(t),t.schema=5),e<6&&(mit(t),t.schema=6),e<7&&(git(t),t.schema=7),e<8&&(t.schema=8),e<9&&(XJ(t),t.schema=9),e<10&&(bit(t),t.schema=10),e<11&&(wit(t),t.schema=11),e<12&&(XJ(t),t.schema=12),e<13&&(_it(t),t.schema=13),e<14&&(Eit(t),t.schema=14),e<15&&(Ait(t),t.schema=15),e<16&&(Mit(t),t.schema=16),e<17&&(_g(t,$J),wg(t,$J),t.schema=17),e<18&&(_g(t,qJ),wg(t,qJ),t.schema=18),e<19&&(hit(t),t.schema=19),e<20&&(Tit(t),Pit(t),t.schema=20),e<21&&(Rit(t),Iit(t),t.schema=21),e<22&&(ZJ(t),t.schema=22),e<23&&(Dit(t),t.schema=23),e<24&&(Oit(t),t.schema=24),(e<25||t.shared.videos===void 0)&&(Sit(t),e<25&&(t.schema=25)),e<26&&(vit(t),t.schema=26),e<27&&(yit(t),t.schema=27),e<28&&(ZJ(t),t.schema=28),e<29&&(xit(t),t.schema=29),e<30&&(Lit(t),t.schema=30),e<31&&(kit(t),t.schema=31),e<33&&(Nit(t),t.schema=33),e<34&&(Uit(t),t.schema=34),e<35&&(Bit(t),t.schema=35),e<36&&(Fit(t),t.schema=36),e<37&&(zit(t),t.schema=37),e<38&&(_g(t,YJ),wg(t,YJ),t.schema=38),e<39&&(jit(t),t.schema=39),e<40&&(Vit(t),t.schema=40),e<41&&(Hit(t),t.schema=41),e<42&&(Git(t),t.schema=42),e<43&&(Wit(t),t.schema=43),e<99){_g(t,JJ),wg(t,JJ),t.scene.publish.playCamera===null&&(t.scene.publish.playCamera=N_);let i=ws(t.scene.objects),r=t.scene.objects;t.scene.publish.playPage=IA,r.insertBefore(null,null,[{id:IA,data:{...Q1.defaultData,backgroundColor:t.scene.backgroundColor,fog:t.scene.fog,postprocessing:t.scene.postprocessing,ao:Wd(t.scene.environment.ambientLight,"occlusion","aoFullRes","radius","bias","aoColor"),publish:{playCamera:t.scene.publish.playCamera,gameControlObject:t.scene.publish.gameControlObject},shadow:Wd(t.scene.environment.ambientLight,"softShadowQuality"),globalPhysics:{...K1.defaultData,...Wd(t.scene.environment,"usePhysics","gravity")},camera:ws(t.scene.ownerCamera)??Q1.defaultData.camera,name:"Scene"},children:[]}]);for(let a of i)a.id!==i0.TRASH_CAN_ID&&r.move(IA,a.fi,a.id);let n=0,s=0;t.shared.penumbraSize&&t.scene.objects.traverse((a,o)=>{o.type==="DirectionalLight"?(o.penumbraSize=t.shared.penumbraSize[Math.min(n,2)],n+=1):o.type==="SpotLight"&&(o.penumbraSize=t.shared.penumbraSize[3+Math.min(s,1)],s+=1),(o.physics===void 0||o.physics===null)&&o.type!=="Instance"&&(o.physics={},Object.assign(o.physics,Y1.defaultData)),o.physics!==void 0&&o.physics!==null&&(o.physics.enabled=o.collision??"visibility",delete o.collision)}),t.schema=99}}function eee(t){t.layers&&t.layers.forEach(e=>{e.type==="light"&&e.alphaOverride===void 0&&(e.alphaOverride=1)})}function Xit(t){t.scene.objects.traverse((e,i)=>{let r=i.geometry;r&&r.type==="PathGeometry"&&(r.extrusion.capType="flat",r.extrusion.bevel=50,r.extrusion.bevelSides=6,r.extrusion.shape.type==="Custom"&&(r.extrusion.shape.shapeQuality="low"))})}function $it(t){Array.isArray(ws(t.events))&&t.events?.forEach(e=>{"disabled"in e||(e.disabled=!1),(e.type==="MouseDown"||e.type==="MouseUp"||e.type==="MousePress")&&(e.mode=e.mode||"Object")})}var Tw=180/Math.PI;function tee(t){t.rotation=t.rotation.slice(0,3).map(e=>e*Tw)}function pfe(t){tee(t),t.type==="Page"&&tee(t.camera),t.states?.forEach(i=>{i.rotation===void 0||i.rotation===null||(i.rotation=i.rotation.slice(0,3).map(r=>r*Tw))});let e=t.geometry;e&&e.type==="SphereGeometry"&&(e.thetaLength=(e.thetaLength??180)*Tw),e&&e.type==="TorusGeometry"&&(e.arc=e.arc*Tw),e&&e.type==="PathGeometry"&&(e.extrusion.angle*=Tw,e.extrusion.twist*=Tw),t.type==="Mesh"&&t.geometry.type==="TextGeometry"&&(t.geometry.text={textValue:t.geometry.text}),Array.isArray(ws(t.events))&&t.events?.forEach(i=>{(i.type==="MouseDown"||i.type==="MouseUp"||i.type==="MousePress"||i.type==="KeyDown"||i.type==="KeyUp"||i.type==="KeyPress"||i.type==="Collision"||i.type==="Trigger")&&(i.runMode=i.toggle?"Toggle":"Repeat")})}function Yit(t){t.shared.variables=lc({},gi.prototype)}function Kit(t){let e=ws(t.shared.variables);t.shared.variables=lc(Object.entries(e??{}).map(([i,r],n)=>({fi:n,id:i,data:r})),ni.prototype)}var mp=118;function S5(t,e){e(t.data);for(let i of t.children)S5(i,e)}function Zit(t){let e=t.schema??104;e!==mp&&(e<105&&(S5(t.asset,pfe),t.schema=105),e<118&&(S5(t.asset,mfe),t.schema=118))}function Qit(t){t.shared.particles=lc({},gi.prototype),t.shared.lib&&(t.shared.lib.particles=Yp.defaultData().particles)}function Jit(t){t.scene.objects.traverse((e,i)=>{i.type==="Particle"&&typeof i.renderMaterial.size=="number"&&Object.assign(i.renderMaterial,{size:[i.renderMaterial.size,i.renderMaterial.size]})})}function ert(t){t.scene.objects.traverse((e,i)=>{i.type==="Page"&&(i.postprocessing.depthOfField.focusDistance=100,i.postprocessing.depthOfField.focalLength=20,i.postprocessing.depthOfField.bokehScale=5)})}function trt(t){t.scene.objects.traverse((e,i)=>{Array.isArray(ws(i.events))!==!1&&i.events?.forEach(r=>{let n=r.runMode;r.type==="MouseDown"||r.type==="MouseUp"||r.type==="KeyDown"||r.type==="KeyUp"||r.type==="Collision"||r.type==="Trigger"?r.actions?.forEach(s=>{s.type==="Transition"&&(s.runMode=n??"Repeat"),(s.type==="Animation"||s.type==="SwitchCamera")&&(s.runMode=n==="Toggle"?"Toggle":"Normal")}):r.type==="MouseHover"||r.type==="MousePress"||r.type==="KeyPress"?r.actions?.forEach(s=>{(s.type==="Transition"||s.type==="Animation"||s.type==="SwitchCamera")&&(s.runMode="Toggle")}):r.type==="GameControl"?(delete r.actions,Object.keys(r.gameActions).forEach(s=>{r.gameActions[s]?.forEach(a=>{a.type==="Transition"&&(a.runMode="Repeat"),a.type==="Animation"&&(a.runMode="Normal")})})):r.type==="DragDrop"?(delete r.actions,r.dragDropActions?.drag?.forEach(s=>{(s.type==="Transition"||s.type==="Animation"||s.type==="SwitchCamera")&&(s.runMode="Toggle")}),r.dragDropActions?.drop?.forEach(s=>{(s.type==="Transition"||s.type==="Animation"||s.type==="SwitchCamera")&&(s.runMode="Toggle")})):r.type==="Resize"?(delete r.actions,r.breakpoints?.forEach(s=>{s.actions?.forEach(a=>{(a.type==="Transition"||a.type==="Animation"||a.type==="SwitchCamera")&&(a.runMode="Toggle")})})):r.type==="Start"?r.actions?.forEach(s=>{s.type==="Transition"&&(s.runMode="Once"),(s.type==="Animation"||s.type==="SwitchCamera")&&(s.runMode="Normal")}):r.type==="VariableChange"||r.type==="Scroll"?r.actions?.forEach(s=>{s.type==="Transition"&&(s.runMode="Repeat"),(s.type==="Animation"||s.type==="SwitchCamera")&&(s.runMode="Normal")}):r.type==="Conditional"&&(delete r.actions,r.inActions?.forEach(s=>{s.type==="Transition"&&(s.runMode="Repeat"),(s.type==="Animation"||s.type==="SwitchCamera")&&(s.runMode="Normal")}),r.outActions?.forEach(s=>{s.type==="Transition"&&(s.runMode="Repeat"),(s.type==="Animation"||s.type==="SwitchCamera")&&(s.runMode="Normal")}))})})}function irt(t){t.shared.userAPIs=lc({},gi.prototype),t.shared.userWebhooks=lc({},gi.prototype),t.shared.lib&&(t.shared.lib.userAPIs=Yp.defaultData().userAPIs,t.shared.lib.userWebhooks=Yp.defaultData().userWebhooks)}function rrt(t){t.scene.publish.settings.videoStatic===void 0&&(t.scene.publish.settings.videoStatic=Cp.defaultData.settings.videoStatic)}function mfe(t){t.timelineAnimations=lc({},gi.prototype)}function gfe(t){let e=t.schema??0;if(e!==mp){console.warn("updating from ",e,"to ",mp),qit(t,e),e<100&&(t.scene.publish.joystickSizeAndXYOffset===void 0&&(t.scene.publish.joystickSizeAndXYOffset=Cp.defaultData.joystickSizeAndXYOffset),t.schema=100),e<101&&(_g(t,eee),wg(t,eee),t.schema=101),e<102&&(Xit(t),t.schema=102),e<104&&(t.shared.catelogs=new gi,t.shared.lib=Yp.defaultData(),t.schema=104),e<105&&(Yit(t),t.scene.objects.traverse((i,r)=>{pfe(r)}),t.schema=105);for(let i of Object.values(t.shared.lib.components))Zit(i);e<106&&(Kit(t),t.schema=106),e<107&&(t.shared.lib.variables=Yp.defaultData().variables,t.schema=107),e<109&&(Qit(t),t.schema=109),e<110&&(Jit(t),t.schema=110),e<111&&(t.scene.objects.traverse((i,r)=>{$it(r)}),t.schema=111),e<112&&(ert(t),t.schema=112),e<113&&(trt(t),t.schema=113),e<114&&(t.scene.publish.settings.web.imageQuality===void 0&&(t.scene.publish.settings.web.imageQuality=70),t.schema=114),e<115&&(irt(t),t.schema=115),e<116&&(rrt(t),t.schema=116),e<117&&(t.scene.publish.settings.web.pixelRatioMobile===void 0&&(t.scene.publish.settings.web.pixelRatioMobile=0),t.scene.publish.settings.web.pixelRatioDesktop===void 0&&(t.scene.publish.settings.web.pixelRatioDesktop=0),t.schema=117),e<118&&(t.shared.timelineAnimations=lc({},gi.prototype),t.scene.objects.traverse((i,r)=>{mfe(r)}),t.schema=118)}}var E3;(t=>{t.defaultData={schema:mp,scene:i0.defaultData,frames:new gi().add("72fc2993-2da3-4b6b-96ac-2879db3a28bd",DA.defaultData),shared:{...hu.emptyData(),colors:hu.defaultColors()}},t.emptyDataForImports=function(){let s=i0.emptyDataWithPage();return{schema:mp,scene:s,frames:new gi().add("72fc2993-2da3-4b6b-96ac-2879db3a28bd",DA.defaultData),shared:{...hu.emptyData(),colors:hu.defaultColors(),images:hu.defaultImages()}}},t.emptyData=function(){return{schema:mp,scene:i0.emptyDataWithPage(),frames:new gi().add("72fc2993-2da3-4b6b-96ac-2879db3a28bd",DA.defaultData),shared:hu.emptyData()}},t.clipboard2dData=function(){return{schema:mp,scene:i0.emptyData(),frames:new gi,shared:hu.emptyData()}},t.collabHelper={...Gj,updateSchema(s){return(s.schema??0)<mp?FM(s,gfe):(s.schema??0)-mp}};function e(s){let a=t.collabHelper.updateSchema(s);return typeof a=="number"?a===0?s:null:a.data}t.updateSchemaDirectly=e;function i(s){return{...s,shared:{...s.shared,lib:Yp.defaultData()}}}t.withoutLib=i;function r(s,a){let o=s.scene.objects.get(a);if(o&&o.data.type==="Component")return o;{let l=s.shared.lib.components[a];if(l)return l.asset}}t.getComponentData=r;function n(s){let a=Object.values(s.shared.userAPIs);for(let o of a){let l=o.headers;for(let c of l)if(c.data.key.toLowerCase()==="authorization"&&c.data.value!=="")return!0}return!1}t.hasSensitiveData=n})(E3||(E3={}));var E5;(t=>t.emptyImage={data:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVQYV2NgYAAAAAMAAWgmWQ0AAAAASUVORK5CYII=",name:"empty"})(E5||(E5={}));var iee;(t=>{function e(i){return!0}t.is=e})(iee||(iee={}));var A3;(t=>{t.defaultData={position:[0,0],scale:[1,1],rotation:0,shear:[0,0]};function e(r,n){return{position:n?.position??r.position,rotation:n?.rotation??r.rotation,scale:n?.scale??r.scale,shear:n?.shear??r.shear}}t.merge=e;function i(r,n){return kde({position:kd.isEqual(r.position,n.position)?void 0:n.position,rotation:r.rotation===n.rotation?void 0:n.rotation,scale:kd.isEqual(r.scale,n.scale)?void 0:n.scale,shear:r.shear&&n.shear&&kd.isEqual(r.shear,n.shear)?void 0:n.shear})}t.diff=i})(A3||(A3={}));var A5;(t=>t.defaultData={horizontalConstraint:0,verticalConstraint:0})(A5||(A5={}));var ree;(t=>t.defaultData={direction:"row",wrap:"unwrap",align:"top-left",gap:10,rowGap:10,autoGap:!1,autoRowGap:!1,leftPadding:8,rightPadding:8,topPadding:8,bottomPadding:8})(ree||(ree={}));var M3;(t=>t.defaultData={opacity:1,fill:{color:Xr.fromHexAndA(Uc,1),enabled:!0},stroke:{color:Xr.from0to1([0,0,0,1]),thickness:1,enabled:!1,mode:"inside"},layerBlur:{radius:2,enabled:!1},backgroundBlur:{radius:2,enabled:!1},dropShadow:{offset:[10,10],blurRadius:10,color:Xr.from0to1([0,0,0,1]),enabled:!1,spread:0},innerShadow:{offset:[10,10],blurRadius:10,color:Xr.from0to1([0,0,0,1]),enabled:!1,spread:0}})(M3||(M3={}));var r0;(t=>{function e(a,o){return{name:o}}t.newEmpty=e;function i(a,o){if(o===void 0)return a;let l={...a},c=["width","height","cornerRadius"];for(let u of c)u in l&&u in o&&o[u]!==void 0&&Object.assign(l,{[u]:o[u]});return l}function r(a,o){if(o===void 0)return a;let l={...a};return"fill"in l&&"fill"in o&&o.fill!==void 0&&Object.assign(l,{fill:{...l.fill,...o.fill}}),"stroke"in l&&"stroke"in o&&o.stroke!==void 0&&Object.assign(l,{stroke:{...l.stroke,...o.stroke}}),"layerBlur"in l&&"layerBlur"in o&&o.layerBlur!==void 0&&Object.assign(l,{layerBlur:{...l.layerBlur,...o.layerBlur}}),"backgroundBlur"in l&&"backgroundBlur"in o&&o.backgroundBlur!==void 0&&Object.assign(l,{backgroundBlur:{...l.backgroundBlur,...o.backgroundBlur}}),"dropShadow"in l&&"dropShadow"in o&&o.dropShadow!==void 0&&Object.assign(l,{dropShadow:{...l.dropShadow,...o.dropShadow}}),"innerShadow"in l&&"innerShadow"in o&&o.innerShadow!==void 0&&Object.assign(l,{innerShadow:{...l.innerShadow,...o.innerShadow}}),l}function n(a,o){if(o===void 0)return a;let l={...a};return Object.assign(l,A3.merge(l,o)),l=i(l,o),l=r(l,o),l}t.patch=n;function s(a,o){let l,c=[];for(let[u,h]of Object.entries(o))u!=="name"&&(l===void 0&&(l={path:[],props:{},type:0},c.push(l)),l.props[u]=h);return c}t.toOps=s})(r0||(r0={}));var HM;(t=>t.defaultData={...A3.defaultData,...A5.defaultData,states:new ni,events:new ni,visible:!0,raycastLock:!1})(HM||(HM={}));var J1;(t=>t.defaultData={...HM.defaultData,...M3.defaultData})(J1||(J1={}));var T3;(t=>t.defaultData={cornerRadius:[0,0,0,0]})(T3||(T3={}));var M5;(t=>t.defaultData={...J1.defaultData,type:"ellipse2d",width:100,height:100,name:"Ellipse"})(M5||(M5={}));var GM;(t=>t.defaultData={...J1.defaultData,...T3.defaultData,type:"rectangle2d",width:100,height:100,name:"Rectangle"})(GM||(GM={}));var T5;(t=>t.defaultData={...J1.defaultData,type:"text2d",width:100,height:100,fontSize:12,lineHeight:1.2,letterSpacing:0,text:{textValue:"Hello world"},horizontalAlign:1,verticalAlign:1,textTransform:1,font:"Roboto_regular",name:"Text"})(T5||(T5={}));var C5;(t=>t.defaultData={...J1.defaultData,type:"path2d",path:"",name:"Path"})(C5||(C5={}));var nee;(t=>{function e(i){return i.type==="ellipse2d"||i.type==="rectangle2d"||i.type==="text2d"||i.type==="vector2d"||i.type==="path2d"}t.is=e})(nee||(nee={}));var C3;(t=>t.defaultData={...HM.defaultData,name:"Group",type:"group2d"})(C3||(C3={}));var P5;(t=>t.defaultData=()=>({...HM.defaultData,...T3.defaultData,...M3.defaultData,name:"Frame",type:"frame2d",clipped:!0,width:200,height:200,fill:{color:Xr.fromHexAndA(4737101,1),enabled:!0},stroke:{color:Xr.fromHexAndA(0,1),thickness:1,enabled:!1,mode:"inside"},backgroundBlur:{radius:2,enabled:!1},layerBlur:{radius:2,enabled:!1}}))(P5||(P5={}));var b0;(t=>{function e(a){switch(a){case"rectangle2d":return{...GM.defaultData};case"ellipse2d":return{...M5.defaultData};case"text2d":return{...T5.defaultData};case"vector2d":return{...GM.defaultData};case"path2d":return{...C5.defaultData};case"frame2d":return{...P5.defaultData()};case"group2d":return{...C3.defaultData}}}t.defaultData=e;function i(a){return"width"in a&&"height"in a?[typeof a.width=="number"?a.width*.5:0,typeof a.height=="number"?a.height*.5:0]:[0,0]}t.getPivot=i;function r(a){return a.type==="rectangle2d"||a.type==="ellipse2d"||a.type==="text2d"||a.type==="frame2d"}t.isResizeable=r;function n(a){return a.type==="frame2d"&&a.autoLayout!==void 0}t.isAutoLayoutable=n;function s(a){return a.type==="rectangle2d"||a.type==="frame2d"}t.hasCorners=s})(b0||(b0={}));var R5;(t=>(t.defaultData={name:"UI",type:"scene2d",objects:new yo},t.emptyData=function(){return{type:"scene2d",objects:new yo}}))(R5||(R5={}));function n0(t,e=!1){let i=t[0].index!==null,r=new Set(Object.keys(t[0].attributes)),n=new Set(Object.keys(t[0].morphAttributes)),s={},a={},o=t[0].morphTargetsRelative,l=new oi,c=0;for(let u=0;u<t.length;++u){let h=t[u],d=0;if(i!==(h.index!==null))return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+u+". All geometries must have compatible attributes; make sure index attribute exists among all geometries, or in none of them."),null;for(let f in h.attributes){if(!r.has(f))return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+u+'. All geometries must have compatible attributes; make sure "'+f+'" attribute exists among all geometries, or in none of them.'),null;s[f]===void 0&&(s[f]=[]),s[f].push(h.attributes[f]),d++}if(d!==r.size)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+u+". Make sure all geometries have the same number of attributes."),null;if(o!==h.morphTargetsRelative)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+u+". .morphTargetsRelative must be consistent throughout all geometries."),null;for(let f in h.morphAttributes){if(!n.has(f))return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+u+".  .morphAttributes must be consistent throughout all geometries."),null;a[f]===void 0&&(a[f]=[]),a[f].push(h.morphAttributes[f])}if(e){let f;if(i)f=h.index.count;else if(h.attributes.position!==void 0)f=h.attributes.position.count;else return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+u+". The geometry must have either an index or a position attribute"),null;l.addGroup(c,f,u),c+=f}}if(i){let u=0,h=[];for(let d=0;d<t.length;++d){let f=t[d].index;for(let p=0;p<f.count;++p)h.push(f.getX(p)+u);u+=t[d].attributes.position.count}l.setIndex(h)}for(let u in s){let h=see(s[u]);if(!h)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed while trying to merge the "+u+" attribute."),null;l.setAttribute(u,h)}for(let u in a){let h=a[u][0].length;if(h===0)break;l.morphAttributes=l.morphAttributes||{},l.morphAttributes[u]=[];for(let d=0;d<h;++d){let f=[];for(let g=0;g<a[u].length;++g)f.push(a[u][g][d]);let p=see(f);if(!p)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed while trying to merge the "+u+" morphAttribute."),null;l.morphAttributes[u].push(p)}}return l}function see(t){let e,i,r,n=0;for(let o=0;o<t.length;++o){let l=t[o];if(l.isInterleavedBufferAttribute)return console.error("THREE.BufferGeometryUtils: .mergeBufferAttributes() failed. InterleavedBufferAttributes are not supported."),null;if(e===void 0&&(e=l.array.constructor),e!==l.array.constructor)return console.error("THREE.BufferGeometryUtils: .mergeBufferAttributes() failed. BufferAttribute.array must be of consistent array types across matching attributes."),null;if(i===void 0&&(i=l.itemSize),i!==l.itemSize)return console.error("THREE.BufferGeometryUtils: .mergeBufferAttributes() failed. BufferAttribute.itemSize must be consistent across matching attributes."),null;if(r===void 0&&(r=l.normalized),r!==l.normalized)return console.error("THREE.BufferGeometryUtils: .mergeBufferAttributes() failed. BufferAttribute.normalized must be consistent across matching attributes."),null;n+=l.array.length}let s=new e(n),a=0;for(let o=0;o<t.length;++o)s.set(t[o].array,a),a+=t[o].array.length;return new Mi(s,i,r)}var vfe={update:null,begin:null,loopBegin:null,changeBegin:null,change:null,changeComplete:null,timelineChangeComplete:null,loopComplete:null,complete:null,loop:1,direction:"normal",autoplay:!0,timelineOffset:0,rewind:!0},UG={duration:1e3,delay:0,endDelay:0,startOnceDelay:0,pingPongDelayCorrection:0,pingPongEndDelayCorrection:0,easing:"easeOutElastic(1, .5)",round:0},nrt=["translateX","translateY","translateZ","rotate","rotateX","rotateY","rotateZ","scale","scaleX","scaleY","scaleZ","skew","skewX","skewY","perspective","matrix","matrix3d"],P3={CSS:{},springs:{}};function wh(t,e,i){return Math.min(Math.max(t,e),i)}function OA(t,e){return t.indexOf(e)>-1}function SF(t,e){return t.apply(null,e)}var Ni={arr:function(t){return Array.isArray(t)},obj:function(t){return OA(Object.prototype.toString.call(t),"Object")},pth:function(t){return Ni.obj(t)&&t.hasOwnProperty("totalLength")},svg:function(t){return t instanceof SVGElement},inp:function(t){return t instanceof HTMLInputElement},dom:function(t){return!("isNode"in t)&&(t.nodeType||Ni.svg(t))},str:function(t){return typeof t=="string"},fnc:function(t){return typeof t=="function"},und:function(t){return typeof t>"u"},hex:function(t){return/(^#[0-9A-F]{6}$)|(^#[0-9A-F]{3}$)/i.test(t)},rgb:function(t){return/^rgb/.test(t)},hsl:function(t){return/^hsl/.test(t)},col:function(t){return Ni.hex(t)||Ni.rgb(t)||Ni.hsl(t)},key:function(t){return!vfe.hasOwnProperty(t)&&!UG.hasOwnProperty(t)&&t!=="targets"&&t!=="keyframes"}};function yfe(t){var e=/\(([^)]+)\)/.exec(t);return e?e[1].split(",").map(function(i){return parseFloat(i)}):[]}function xfe(t,e){var i=yfe(t),r=wh(Ni.und(i[0])?1:i[0],.1,100),n=wh(Ni.und(i[1])?100:i[1],.1,100),s=wh(Ni.und(i[2])?10:i[2],.1,100),a=wh(Ni.und(i[3])?0:i[3],.1,100),o=Math.sqrt(n/r),l=s/(2*Math.sqrt(n*r)),c=l<1?o*Math.sqrt(1-l*l):0,u=1,h=l<1?(l*o+-a)/c:-a+o;function d(p){var g=e?e*p/1e3:p;return l<1?g=Math.exp(-g*l*o)*(u*Math.cos(c*g)+h*Math.sin(c*g)):g=(u+h*g)*Math.exp(-g*o),p===0||p===1?p:1-g}function f(){var p=P3.springs[t];if(p)return p;for(var g=1/6,m=0,y=0;;)if(m+=g,d(m)===1){if(y++,y>=16)break}else y=0;var b=m*g*1e3;return P3.springs[t]=b,b}return e?d:f}function srt(t){return t===void 0&&(t=10),function(e){return Math.ceil(wh(e,1e-6,1)*t)*(1/t)}}var art=(function(){var t=11,e=1/(t-1);function i(u,h){return 1-3*h+3*u}function r(u,h){return 3*h-6*u}function n(u){return 3*u}function s(u,h,d){return((i(h,d)*u+r(h,d))*u+n(h))*u}function a(u,h,d){return 3*i(h,d)*u*u+2*r(h,d)*u+n(h)}function o(u,h,d,f,p){var g,m,y=0;do m=h+(d-h)/2,g=s(m,f,p)-u,g>0?d=m:h=m;while(Math.abs(g)>1e-7&&++y<10);return m}function l(u,h,d,f){for(var p=0;p<4;++p){var g=a(h,d,f);if(g===0)return h;var m=s(h,d,f)-u;h-=m/g}return h}function c(u,h,d,f){if(!(0<=u&&u<=1&&0<=d&&d<=1))return;var p=new Float32Array(t);if(u!==h||d!==f)for(var g=0;g<t;++g)p[g]=s(g*e,u,d);function m(y){for(var b=0,w=1,E=t-1;w!==E&&p[w]<=y;++w)b+=e;--w;var M=(y-p[w])/(p[w+1]-p[w]),A=b+M*e,P=a(A,u,d);return P>=.001?l(y,A,u,d):P===0?A:o(y,b,b+e,u,d)}return function(y){return u===h&&d===f||y===0||y===1?y:s(m(y),h,f)}}return c})(),bfe=(function(){var t={linear:function(){return function(r){return r}}},e={Sine:function(){return function(r){return 1-Math.cos(r*Math.PI/2)}},Circ:function(){return function(r){return 1-Math.sqrt(1-r*r)}},Back:function(){return function(r){return r*r*(3*r-2)}},Bounce:function(){return function(r){for(var n,s=4;r<((n=Math.pow(2,--s))-1)/11;);return 1/Math.pow(4,3-s)-7.5625*Math.pow((n*3-2)/22-r,2)}},Elastic:function(r,n){r===void 0&&(r=1),n===void 0&&(n=.5);var s=wh(r,1,10),a=wh(n,.1,2);return function(o){return o===0||o===1?o:-s*Math.pow(2,10*(o-1))*Math.sin((o-1-a/(Math.PI*2)*Math.asin(1/s))*(Math.PI*2)/a)}}},i=["Quad","Cubic","Quart","Quint","Expo"];return i.forEach(function(r,n){e[r]=function(){return function(s){return Math.pow(s,n+2)}}}),Object.keys(e).forEach(function(r){var n=e[r];t["easeIn"+r]=n,t["easeOut"+r]=function(s,a){return function(o){return 1-n(s,a)(1-o)}},t["easeInOut"+r]=function(s,a){return function(o){return o<.5?n(s,a)(o*2)/2:1-n(s,a)(o*-2+2)/2}}}),t})();function BG(t,e){if(Ni.fnc(t))return t;var i=t.split("(")[0],r=bfe[i],n=yfe(t);switch(i){case"spring":return xfe(t,e);case"cubicBezier":return SF(art,n);case"steps":return SF(srt,n);default:return SF(r,n)}}function wfe(t){try{var e=document.querySelectorAll(t);return e}catch{return}}function SL(t,e){for(var i=t.length,r=arguments.length>=2?arguments[1]:void 0,n=[],s=0;s<i;s++)if(s in t){var a=t[s];e.call(r,a,s,t)&&n.push(a)}return n}function EL(t){return t.reduce(function(e,i){return e.concat(Ni.arr(i)?EL(i):i)},[])}function aee(t){return Ni.arr(t)?t:(Ni.str(t)&&(t=wfe(t)||t),t instanceof NodeList||t instanceof HTMLCollection?[].slice.call(t):[t])}function FG(t,e){return t.some(function(i){return i===e})}function zG(t){var e={};for(var i in t)e[i]=t[i];return e}function I5(t,e){var i=zG(t);for(var r in t)i[r]=e.hasOwnProperty(r)?e[r]:t[r];return i}function AL(t,e){var i=zG(t);for(var r in e)i[r]=Ni.und(t[r])?e[r]:t[r];return i}function ort(t){var e=/rgb\((\d+,\s*[\d]+,\s*[\d]+)\)/g.exec(t);return e?"rgba("+e[1]+",1)":t}function lrt(t){var e=/^#?([a-f\d])([a-f\d])([a-f\d])$/i,i=t.replace(e,function(o,l,c,u){return l+l+c+c+u+u}),r=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(i),n=parseInt(r[1],16),s=parseInt(r[2],16),a=parseInt(r[3],16);return"rgba("+n+","+s+","+a+",1)"}function crt(t){var e=/hsl\((\d+),\s*([\d.]+)%,\s*([\d.]+)%\)/g.exec(t)||/hsla\((\d+),\s*([\d.]+)%,\s*([\d.]+)%,\s*([\d.]+)\)/g.exec(t),i=parseInt(e[1],10)/360,r=parseInt(e[2],10)/100,n=parseInt(e[3],10)/100,s=e[4]||1;function a(d,f,p){return p<0&&(p+=1),p>1&&(p-=1),p<1/6?d+(f-d)*6*p:p<1/2?f:p<2/3?d+(f-d)*(2/3-p)*6:d}var o,l,c;if(r==0)o=l=c=n;else{var u=n<.5?n*(1+r):n+r-n*r,h=2*n-u;o=a(h,u,i+1/3),l=a(h,u,i),c=a(h,u,i-1/3)}return"rgba("+o*255+","+l*255+","+c*255+","+s+")"}function urt(t){if(Ni.rgb(t))return ort(t);if(Ni.hex(t))return lrt(t);if(Ni.hsl(t))return crt(t)}function kp(t){var e=/[+-]?\d*\.?\d+(?:\.\d+)?(?:[eE][+-]?\d+)?(%|px|pt|em|rem|in|cm|mm|ex|ch|pc|vw|vh|vmin|vmax|deg|rad|turn)?$/.exec(t);if(e)return e[1]}function hrt(t){if(OA(t,"translate")||t==="perspective")return"px";if(OA(t,"rotate")||OA(t,"skew"))return"deg"}function D5(t,e){return Ni.fnc(t)?t(e.target,e.id,e.total):t}function Nd(t,e){return t.getAttribute(e)}function jG(t,e,i){var r=kp(e);if(FG([i,"deg","rad","turn"],r))return e;var n=P3.CSS[e+i];if(!Ni.und(n))return n;var s=100,a=document.createElement(t.tagName),o=t.parentNode&&t.parentNode!==document?t.parentNode:document.body;o.appendChild(a),a.style.position="absolute",a.style.width=s+i;var l=s/a.offsetWidth;o.removeChild(a);var c=l*parseFloat(e);return P3.CSS[e+i]=c,c}function _fe(t,e,i){if(e in t.style){var r=e.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase(),n=t.style[e]||getComputedStyle(t).getPropertyValue(r)||"0";return i?jG(t,n,i):n}}function VG(t,e){if(Ni.dom(t)&&!Ni.inp(t)&&(Nd(t,e)||Ni.svg(t)&&t[e]))return"attribute";if(Ni.dom(t)&&FG(nrt,e))return"transform";if(Ni.dom(t)&&e!=="transform"&&_fe(t,e))return"css";if(t[e]!=null)return"object"}function Sfe(t){if(Ni.dom(t)){for(var e=t.style.transform||"",i=/(\w+)\(([^)]*)\)/g,r=new Map,n;n=i.exec(e);)r.set(n[1],n[2]);return r}}function drt(t,e,i,r){var n=OA(e,"scale")?1:0+hrt(e),s=Sfe(t).get(e)||n;return i&&(i.transforms.list.set(e,s),i.transforms.last=e),r?jG(t,s,r):s}function HG(t,e,i,r){switch(VG(t,e)){case"transform":return drt(t,e,r,i);case"css":return _fe(t,e,i);case"attribute":return Nd(t,e);default:return t[e]||0}}function GG(t,e){var i=/^(\*=|\+=|-=)/.exec(t);if(!i)return t;var r=kp(t)||0,n=parseFloat(e),s=parseFloat(t.replace(i[0],""));switch(i[0][0]){case"+":return n+s+r;case"-":return n-s+r;case"*":return n*s+r}}function Efe(t,e){if(Ni.col(t))return urt(t);if(/\s/g.test(t))return t;var i=kp(t),r=i?t.substr(0,t.length-i.length):t;return e?r+e:r}function WG(t,e){return Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2))}function frt(t){return Math.PI*2*Nd(t,"r")}function prt(t){return Nd(t,"width")*2+Nd(t,"height")*2}function mrt(t){return WG({x:Nd(t,"x1"),y:Nd(t,"y1")},{x:Nd(t,"x2"),y:Nd(t,"y2")})}function Afe(t){for(var e=t.points,i=0,r,n=0;n<e.numberOfItems;n++){var s=e.getItem(n);n>0&&(i+=WG(r,s)),r=s}return i}function grt(t){var e=t.points;return Afe(t)+WG(e.getItem(e.numberOfItems-1),e.getItem(0))}function Mfe(t){if(t.getTotalLength)return t.getTotalLength();switch(t.tagName.toLowerCase()){case"circle":return frt(t);case"rect":return prt(t);case"line":return mrt(t);case"polyline":return Afe(t);case"polygon":return grt(t)}}function vrt(t){var e=Mfe(t);return t.setAttribute("stroke-dasharray",e),e}function yrt(t){for(var e=t.parentNode;Ni.svg(e)&&Ni.svg(e.parentNode);)e=e.parentNode;return e}function Tfe(t,e){var i=e||{},r=i.el||yrt(t),n=r.getBoundingClientRect(),s=Nd(r,"viewBox"),a=n.width,o=n.height,l=i.viewBox||(s?s.split(" "):[0,0,a,o]);return{el:r,viewBox:l,x:l[0]/1,y:l[1]/1,w:a/l[2],h:o/l[3]}}function xrt(t,e){var i=Ni.str(t)?wfe(t)[0]:t,r=e||100;return function(n){return{property:n,el:i,svg:Tfe(i),totalLength:Mfe(i)*(r/100)}}}function brt(t,e){function i(o){o===void 0&&(o=0);var l=e+o>=1?e+o:0;return t.el.getPointAtLength(l)}var r=Tfe(t.el,t.svg),n=i(),s=i(-1),a=i(1);switch(t.property){case"x":return(n.x-r.x)*r.w;case"y":return(n.y-r.y)*r.h;case"angle":return Math.atan2(a.y-s.y,a.x-s.x)*180/Math.PI}}function oee(t,e){var i=/[+-]?\d*\.?\d+(?:\.\d+)?(?:[eE][+-]?\d+)?/g,r=Efe(Ni.pth(t)?t.totalLength:t,e)+"";return{original:r,numbers:r.match(i)?r.match(i).map(Number):[0],strings:Ni.str(t)||e?r.split(i):[]}}function Cfe(t){var e=t?EL(Ni.arr(t)?t.map(aee):aee(t)):[];return SL(e,function(i,r,n){return n.indexOf(i)===r})}function Pfe(t){var e=Cfe(t);return e.map(function(i,r){return{target:i,id:r,total:e.length,transforms:{list:Sfe(i)}}})}function wrt(t,e){var i=zG(e);if(/^spring/.test(i.easing)&&(i.duration=xfe(i.easing)),Ni.arr(t)){var r=t.length,n=r===2&&!Ni.obj(t[0]);n?t={value:t}:Ni.fnc(e.duration)||(i.duration=e.duration/r)}var s=Ni.arr(t)?t:[t];return s.map(function(a,o){var l=Ni.obj(a)&&!Ni.pth(a)?a:{value:a};return Ni.und(l.delay)&&(l.delay=o?0:e.delay),Ni.und(l.endDelay)&&(l.endDelay=o===s.length-1?e.endDelay:0),l}).map(function(a){return AL(a,i)})}function _rt(t){for(var e=SL(EL(t.map(function(s){return Object.keys(s)})),function(s){return Ni.key(s)}).reduce(function(s,a){return s.indexOf(a)<0&&s.push(a),s},[]),i={},r=function(s){var a=e[s];i[a]=t.map(function(o){var l={};for(var c in o)Ni.key(c)?c==a&&(l.value=o[c]):l[c]=o[c];return l})},n=0;n<e.length;n++)r(n);return i}function Srt(t,e){var i=[],r=e.keyframes;r&&(e=AL(_rt(r),e));for(var n in e)Ni.key(n)&&i.push({name:n,tweens:wrt(e[n],t)});return i}function Ert(t,e){var i={};for(var r in t){var n=D5(t[r],e);Ni.arr(n)&&(n=n.map(function(s){return D5(s,e)}),n.length===1&&(n=n[0])),i[r]=n}return i.duration=parseFloat(i.duration),i.delay=parseFloat(i.delay),i}function Art(t,e){var i;return t.tweens.map(function(r){var n=Ert(r,e),s=n.value,a=Ni.arr(s)?s[1]:s,o=kp(a),l=HG(e.target,t.name,o,e),c=i?i.to.original:l,u=Ni.arr(s)?s[0]:c,h=kp(u)||kp(l),d=o||h;return Ni.und(a)&&(a=c),n.from=oee(u,d),n.to=oee(GG(a,u),d),n.start=i?i.end:0,n.end=n.start+n.delay+n.duration+n.endDelay,n.easing=BG(n.easing,n.duration),n.isPath=Ni.pth(s),n.isColor=Ni.col(n.from.original),n.isColor&&(n.round=1),i=n,n})}var Rfe={css:function(t,e,i){return t.style[e]=i},attribute:function(t,e,i){return t.setAttribute(e,i)},object:function(t,e,i){return t[e]=i},transform:function(t,e,i,r,n){if(r.list.set(e,i),e===r.last||n){var s="";r.list.forEach(function(a,o){s+=o+"("+a+") "}),t.style.transform=s}}};function Ife(t,e){var i=Pfe(t);i.forEach(function(r){for(var n in e){var s=D5(e[n],r),a=r.target,o=kp(s),l=HG(a,n,o,r),c=o||kp(l),u=GG(Efe(s,c),l),h=VG(a,n);Rfe[h](a,n,u,r.transforms,!0)}})}function Mrt(t,e){var i=VG(t.target,e.name);if(i){var r=Art(e,t),n=r[r.length-1];return{type:i,property:e.name,animatable:t,tweens:r,duration:n.end,delay:r[0].delay,endDelay:n.endDelay}}}function Trt(t,e){return SL(EL(t.map(function(i){return e.map(function(r){return Mrt(i,r)})})),function(i){return!Ni.und(i)})}function Dfe(t,e){var i=t.length,r=function(s){return s.timelineOffset?s.timelineOffset:0},n={};return n.duration=i?Math.max.apply(Math,t.map(function(s){let a=s.startOnceDelay??0,o=s.pingPongDelayCorrection??0,l=s.pingPongEndDelayCorrection??0;return r(s)+a+o+l+s.duration*(s.loop??1)})):e.duration,n.delay=i?Math.min.apply(Math,t.map(function(s){let a=s.startOnceDelay??0,o=s.pingPongDelayCorrection??0;return r(s)+a+o+s.delay})):e.delay,n.endDelay=i?n.duration-Math.max.apply(Math,t.map(function(s){let a=s.startOnceDelay??0,o=s.pingPongDelayCorrection??0,l=s.pingPongEndDelayCorrection??0;return r(s)+a+o+s.duration*(s.loop??1)-s.endDelay-l})):e.endDelay,n}var lee=0;function Crt(t){var e=I5(vfe,t),i=I5(UG,t),r=Srt(i,t),n=Pfe(t.targets),s=Trt(n,r),a=Dfe(s,i),o=lee;return lee++,AL(e,{id:o,children:[],animatables:n,animations:s,duration:a.duration,delay:a.delay,endDelay:a.endDelay,startOnceDelay:i.startOnceDelay,pingPongDelayCorrection:i.pingPongDelayCorrection,pingPongEndDelayCorrection:i.pingPongEndDelayCorrection})}var bu=[],cee=[],Cw,uee=(function(){let t=0,e=!0;function i(s){let a=bu.length;if(a){let o=0;for(;o<a;){let l=bu[o];l.paused?(bu.splice(o,1),a--):(l.tick(s),o++)}Cw=requestAnimationFrame(i)}else Cw&&(cancelAnimationFrame(Cw),Cw=null)}function r(){t=performance.now(),Cw=requestAnimationFrame(i)}function n(s){t+=s,i(t)}return{isUsingInternalRaf:e,play:r,update:n}})();function Prt(t){document.hidden?(bu.forEach(function(e){return e.pause(t.timeStamp)}),cee=bu.slice(0),_s.running=bu=[]):cee.forEach(function(e){return e.play(t.timeStamp)})}typeof document<"u"&&document.addEventListener("visibilitychange",Prt);function _s(t){t===void 0&&(t={});var e=0,i=0,r=0,n,s,a=0,o=null;function l(A){var P=window.Promise&&new Promise(function(C){return o=C});return A.finished=P,P}var c=Crt(t);l(c);function u(){var A=c.direction;A!=="alternate"&&(c.direction=A!=="normal"?"normal":"reverse"),c.reversed=!c.reversed,s.forEach(function(P){(P.loop===1||P.loop%2===0)&&(P.reversed=c.reversed)})}function h(){c.direction="normal",c.reversed=!1,s.forEach(function(A){return A.reversed=!1})}function d(A){return c.reversed?c.duration-A:A}function f(){e=0,i=d(c.currentTime)*(1/_s.speed)}function p(A,P,C=!1){P&&(c.reversed?P.seek(P.duration*P.loop-(A-P.timelineOffset-P.pingPongDelayCorrection),C):P.seek(A-P.timelineOffset-P.startOnceDelay-P.pingPongDelayCorrection,C))}function g(A,P=!1){if(c.reversed)for(var C=a;C--;)p(A,s[C],P);else for(var R=0;R<a;R++)p(A,s[R],P)}function m(A){var P=0,C=c.animations,R=C.length;for(c.direction!=="alternate"&&c.parent?.direction==="alternate"?c.parent?.rewind===!1&&c.reversePlayback===!0&&c.rewind===!1&&(c.parent?.reversed&&c.direction==="alternate"?A=c.duration-c.delay+c.endDelay-A:A=c.duration+c.delay-c.endDelay-A):E(!1,c.parent?.rewind,c.rewind,c.parent?.reversePlayback,c.reversePlayback)&&(c.parent?.reversed&&c.direction==="alternate"?A=c.duration-c.delay+c.endDelay-A:A=c.duration+c.delay-c.endDelay-A);P<R;){var I=C[P],k=I.animatable,z=I.tweens,V=z.length-1,F=z[V];V&&(F=SL(z,function(he){return A<he.end})[0]||F);let le;c.parent?.reversed&&c.direction==="alternate"?le=wh(A-F.start-F.endDelay,0,F.duration)/F.duration:le=wh(A-F.start-F.delay,0,F.duration)/F.duration;for(var $=isNaN(le)?1:F.easing(le),K=F.to.strings,X=F.round,U=[],Y=F.to.numbers.length,Z=void 0,j=0;j<Y;j++){var ee=void 0;let he,ve;c.direction!=="alternate"?c.parent?.rewind===!1&&c.reversePlayback===!0&&c.rewind===!1?(he=F.to.numbers[j],ve=F.from.numbers[j]||0):(ve=F.to.numbers[j],he=F.from.numbers[j]||0):E(!0,c.parent?.rewind,c.rewind,c.parent?.reversePlayback,c.reversePlayback)?(he=F.to.numbers[j],ve=F.from.numbers[j]||0):(ve=F.to.numbers[j],he=F.from.numbers[j]||0),F.isPath?ee=brt(F.value,$*ve):ee=he+$*(ve-he),X&&(F.isColor&&j>2||(ee=Math.round(ee*X)/X)),U.push(ee)}var pe=K.length;if(!pe)Z=U[0];else{Z=K[0];for(var fe=0;fe<pe;fe++){K[fe];var se=K[fe+1],re=U[fe];isNaN(re)||(se?Z+=re+se:Z+=re+" ")}}Rfe[I.type](k.target,I.property,Z,k.transforms),I.currentValue=Z,P++}}function y(A){c[A]&&!c.passThrough&&c[A](c)}function b(){c.remaining&&c.remaining!==!0&&c.remaining--}let w={0:!1,1:!0,2:!1,3:!0,4:!1,5:!1,6:!1,7:!1,8:!1,9:!0,10:!0,11:!1,12:!1,13:!1,14:!0,15:!0,16:!1,17:!0,18:!0,19:!1,20:!1,21:!1,22:!0,23:!0,24:!1,25:!0,26:!1,27:!0,28:!1,29:!1,30:!1,31:!1};function E(A,P,C,R,I){return w[A<<4|P<<3|C<<2|R<<1|I]}function M(A,P=!1){var C=c.duration;let R=c.delay,I=C-c.endDelay;c.parent?.reversed&&c.direction==="alternate"&&(R=c.endDelay,I=C-c.delay);var k=d(A);if(c.progress=wh(k/C*100,0,100),P||(c.reversePlayback=k<c.currentTime),a&&g(k,P),!c.began&&k>=R&&(c.began=!0),!c.loopBegan&&c.currentTime>0&&(c.loopBegan=!0,y("loopBegin")),(c.reversed||k>=0)&&k<=R&&c.currentTime!==0&&(m(0),y("change")),(k>=I&&c.currentTime!==C+c.pingPongDelayCorrection||!C)&&(m(C),y("change")),k>R&&k<I?(c.changeBegan||(c.changeBegan=!0,c.changeCompleted=!1,y("changeBegin")),m(k),y("change")):c.changeBegan?(c.changeCompleted=!0,c.changeBegan=!1,y("change"),a&&y("timelineChangeComplete")):c.began&&k>I&&y("changeComplete"),c.currentTime=wh(k,0,C+c.pingPongDelayCorrection),c.began&&y("update"),A>=C)if(b(),!c.remaining)c.paused=!0,c.completed||(c.completed=!0,y("loopComplete"),y("complete"),!c.passThrough&&"Promise"in window&&(o(),l(c)));else{a?e+=c.duration/_s.speed:e+=c.duration;for(let z of s)z.setStartTime(0),z.remaining=z.loop;y("loopComplete"),c.loopBegan=!1,c.direction==="alternate"?u():a&&h()}}return c.reset=function(){var A=c.direction;c.passThrough=!1,c.currentTime=0,c.progress=0,c.paused=!0,c.began=!1,c.loopBegan=!1,c.changeBegan=!1,c.completed=!1,c.changeCompleted=!1,c.reversed=A==="reverse",c.remaining=c.loop,s=c.children,a=s.length;for(var P=a;P--;)c.children[P].reset();m(c.reversed?c.duration:0)},c.setStartTime=function(A){e=A},c.set=function(A,P){return Ife(A,P),c},c.tick=function(A){r=A,e||(e=r),M((r+(i-e))*_s.speed)},c.seek=function(A,P=!1){M(A-e,P)},c.pause=function(A){c.paused=!0,a&&(n=A??performance.now())},c.play=function(A){!c.paused||(c.completed&&c.reset(),c.paused=!1,bu.push(c),a&&n!==void 0&&(e+=(A??performance.now())-n),!Cw&&uee.isUsingInternalRaf&&uee.play())},c.reverse=function(){u(),c.completed=!c.reversed,f()},c.restart=function(){c.reset(),c.play()},c.reset(),c.autoplay&&c.play(),c}function hee(t,e){for(var i=e.length;i--;)FG(t,e[i].animatable.target)&&e.splice(i,1)}function Rrt(t){for(var e=Cfe(t),i=bu.length;i--;){var r=bu[i],n=r.animations,s=r.children;hee(e,n);for(var a=s.length;a--;){var o=s[a],l=o.animations;hee(e,l),!l.length&&!o.children.length&&s.splice(a,1)}!n.length&&!s.length&&r.pause()}}function Irt(t,e){e===void 0&&(e={});var i=e.direction||"normal",r=e.easing?BG(e.easing):null,n=e.grid,s=e.axis,a=e.from||0,o=a==="first",l=a==="center",c=a==="last",u=Ni.arr(t),h=parseFloat(u?t[0]:t),d=u?parseFloat(t[1]):0,f=kp(u?t[1]:t)||0,p=e.start||0+(u?h:0),g=[],m=0;return function(y,b,w){if(o&&(a=0),l&&(a=(w-1)/2),c&&(a=w-1),!g.length){for(var E=0;E<w;E++){if(!n)g.push(Math.abs(a-E));else{var M=l?(n[0]-1)/2:a%n[0],A=l?(n[1]-1)/2:Math.floor(a/n[0]),P=E%n[0],C=Math.floor(E/n[0]),R=M-P,I=A-C,k=Math.sqrt(R*R+I*I);s==="x"&&(k=-R),s==="y"&&(k=-I),g.push(k)}m=Math.max.apply(Math,g)}r&&(g=g.map(function(V){return r(V/m)*m})),i==="reverse"&&(g=g.map(function(V){return s?V<0?V*-1:-V:Math.abs(m-V)}))}var z=u?(d-h)/m:h;return p+z*(Math.round(g[b]*100)/100)+f}}function Drt(t){t===void 0&&(t={});var e=_s(t);return e.duration=0,e.add=function(i,r){var n=bu.indexOf(e),s=e.children;n>-1&&bu.splice(n,1);function a(d){d.passThrough=!0}for(var o=0;o<s.length;o++)a(s[o]);var l=AL(i,I5(UG,t));l.targets=l.targets||t.targets;var c=e.duration;l.autoplay=!1,l.timelineOffset=Ni.und(r)?c:GG(r,c),a(e);var u=_s(l);a(u),s.push(u),u.parent=e;var h=Dfe(s,t);return e.delay=h.delay,e.endDelay=h.endDelay,e.duration=h.duration,u.loop===!0&&(e.duration=1/0),e.seek(0),e.reset(),e.autoplay&&e.play(),e},e}_s.version="3.2.0";_s.speed=1;_s.running=bu;_s.remove=Rrt;_s.get=HG;_s.set=Ife;_s.convertPx=jG;_s.path=xrt;_s.setDashoffset=vrt;_s.stagger=Irt;_s.timeline=Drt;_s.easing=BG;_s.penner=bfe;_s.random=function(t,e){return Math.floor(Math.random()*(e-t+1))+t};var Gg=_s,Ya=class extends Ai{constructor(t,e,i,r){super(t,e,i),this.isColorA=!0,this.a=r}setRGBA(t,e,i,r){super.setRGB(t,e,i),this.a=r}copy(t){return super.copy(t),this.a="a"in t?t.a:1,this}clone(){return new this.constructor(this.r,this.g,this.b,this.a)}equals(t){return super.equals(t)&&this.a===t.a}setStyle(t,e="srgb"){let i;if(t==="transparent")return this.setRGBA(0,0,0,0),this;if(i=/^((?:rgb|hsl)a?)\(([^)]*)\)/.exec(t)){let r,n=i[1],s=i[2];switch(n){case"rgb":case"rgba":if(r=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(s))return this.a=n==="rgba"?parseFloat(r[4]):1,super.setStyle(t,e);break;case"hsl":case"hsla":if(r=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)%\s*,\s*(\d*\.?\d+)%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(s))return this.a=n==="hsla"?parseFloat(r[4]):1,super.setStyle(t,e);break}}return super.setStyle(t,e)}get x(){return this.r}get y(){return this.g}get z(){return this.b}get w(){return this.a}set x(t){this.r=t}set y(t){this.g=t}set z(t){this.b=t}set w(t){this.a=t}},{degToRad:dee,radToDeg:Ort}=Ht,fee=new W,pee=new W,mee=new Ii;function Lrt(t,e,i,r){if(r===0)return i.copy(t);if(r===1)return i.copy(e);let n=t.w*e.w+t.x*e.x+t.y*e.y+t.z*e.z;if(n>=1)return i.copy(t);let s=1-n*n;if(s<=Number.EPSILON){let u=1-r;return i.w=u*t.w+r*e.w,i.x=u*t.x+r*e.x,i.y=u*t.y+r*e.y,i.z=u*t.z+r*e.z,i.normalize(),i}let a=Math.sqrt(s),o=Math.atan2(a,n),l=Math.sin((1-r)*o)/a,c=Math.sin(r*o)/a;return i.w=t.w*l+e.w*c,i.x=t.x*l+e.x*c,i.y=t.y*l+e.y*c,i.z=t.z*l+e.z*c,i}function go(t,e,i,r,n,s){let a=i[t]!==void 0?i[t]:void 0,o=r[t];if(o==null)return;let l=a!=null?typeof a=="string"?Number(n.getVariable(a)??0):a:e[t],c=typeof o=="string"?Number(n.getVariable(o)??0):o;if(l!==c)return{update:u=>{let h=Ht.lerp(l,c,u);s?e[t]=Math.trunc(h):e[t]=h},start:()=>{e[t]=l},end:()=>{e[t]=c}}}function qG(t,e,i,r,n,s){let a=i[t]?i[t]:void 0,o=r[t];if(!o)return;let l=e[t],c=[...a??l].map(h=>typeof h=="string"?Number(n.getVariable(h)??0):h),u=[...o].map(h=>typeof h=="string"?Number(n.getVariable(h)??0):h);if(!(c.length!==u.length||bG(c,u)))return{update:h=>{c.forEach((d,f)=>{let p=Ht.lerp(d,u[f],h);e[t][f]=s?Math.trunc(p):p})},start:()=>{Object.assign(e[t],c)},end:()=>{Object.assign(e[t],u)}}}function R3(t,e,i){return e.forEach((r,n)=>{t.setComponent(n,typeof r=="string"?Number(i.getVariable(r)??0):r)}),t}function gee(t,e,i,r,n){let s=i[t]?i[t]:void 0,a=r[t];if(!a)return;let o=e[t],l=s?R3(new W,s,n):o.clone(),c=R3(new W,a,n);if(!l.equals(c))return{update:u=>{o.lerpVectors(l,c,u)},start:()=>{o.copy(l)},end:()=>{o.copy(c)}}}function vee(t,e,i){return e.forEach((r,n)=>{t.setComponent(n,typeof r=="string"?Number(i.getVariable(r)??0):r)}),t}function I3(t,e,i,r,n){let s=i[t]?i[t]:void 0,a=r[t];if(!a)return;let o=e[t],l=!(o instanceof Ae),c=o instanceof Ae?o:new Ae().fromArray(o),u=s?vee(new Ae,s,n):c.clone(),h=vee(new Ae,a,n);if(!u.equals(h))return{update:d=>{c.lerpVectors(u,h,d),l&&(e[t]=c.toArray())},start:()=>{c.copy(u),l&&(e[t]=c.toArray())},end:()=>{c.copy(h),l&&(e[t]=c.toArray())}}}function krt(t,e,i,r){let n=i[t]?i[t]:void 0,s=r[t];if(!s)return;let a=e[t],o=n?new St().fromArray(n):a.clone(),l=new W,c=new Ii,u=new W;o.decompose(l,c,u);let h=new St().fromArray(s),d=new W,f=new Ii,p=new W;if(h.decompose(d,f,p),!o.equals(h))return{update:g=>{mee.slerpQuaternions(c,f,g),fee.lerpVectors(l,d,g),pee.lerpVectors(u,p,g),a.compose(fee,mee,pee)},start:()=>{a.compose(l,c,u)},end:()=>{a.compose(d,f,p)}}}function Nrt(t,e,i,r,n){let s=i[t]?i[t]:void 0,a=r[t];if(!a)return;let o=e[t],l=s?typeof s=="string"?n.getColor(s).clone():new Ai().setRGB(s.r,s.g,s.b):o.clone(),c=typeof a=="string"?n.getColor(a).clone():new Ai().setRGB(a.r,a.g,a.b);if(l.equals(c))return;let u=o.clone();return{update:h=>{u.lerpColors(l,c,h),e[t]?.copy?.(u)},start:()=>{u.copy(l)},end:()=>{u.copy(c)}}}function YP(t,e,i,r,n){let s=i[t]?i[t]:void 0,a=r[t];if(!a)return;let o=e[t],l=new Ya(o.r,o.g,o.b,o.a),c=s?typeof s=="string"?n.getColor(s).clone():new Ya(s.r,s.g,s.b,s.a):l.clone(),u=typeof a=="string"?n.getColor(a).clone():new Ya(a.r,a.g,a.b,a.a);if(!c.equals(u))return{update:h=>{l.lerpColors(c,u,h);let d=Ht.lerp(c.a,u.a,h);l.a=d,e[t]={r:l.r,g:l.g,b:l.b,a:l.a}},start:()=>{l.copy(c)},end:()=>{l.copy(u)}}}function xv(t,e,i,r,n){if(typeof e[t]=="number")return go(t,e,i??{},r,n);if(Array.isArray(e[t]))return qG(t,e,i??{},r,n)}var yee=new xs;function Urt(t,e,i,r=!0){let n=[t.x,t.y,t.z],s=[e.x,e.y,e.z];r&&(n=n.map(dee),s=s.map(dee));let a=new Ii().setFromEuler(yee.fromArray(n)),o=new Ii().setFromEuler(yee.fromArray(s)),l=a.slerp(o,i),c=new xs().setFromQuaternion(l),u=[c.x,c.y,c.z];return r&&(u=u.map(Ort)),{x:u[0],y:u[1],z:u[2]}}function Sg(t,e,i,r,n){let s=i[t],a=r[t];if(typeof e[t]=="number")e[t]=Ht.lerp(s,a,n);else if(Array.isArray(e[t]))for(let o=0,l=s.length;o<l;o++)e[t][o]=Ht.lerp(s[o],a[o],n)}function Brt(t,e,i,r){let n=[];if(!("cloner"in i)||!t.cloner)return n;let s=t.cloner,a="cloner"in e?e.cloner:{},o=i.cloner;ufe.forEach(f=>{let p;f==="count"?p=go("count",s.parameters,a,o,r,!0):p=xv(f,s.parameters,a??{},o,r),p&&n.push(p)});let l=Frt(s,a,o,r);l?.length&&n.push(...l);let c=zrt(s,a,o,r);c?.length&&n.push(...c);let u=jrt(s,a,o,r);u?.length&&n.push(...u);let h=Vrt(s,a,o,r);h?.length&&n.push(...h);let d=Hrt(s,a,o,r);return d?.length&&n.push(...d),n.length&&n.push({update:()=>{s.update()}}),n}function Frt(t,e,i,r){if(t.parameters.type!=="radial")return;let n=e.radial,s=i.radial;if(!s)return;let a=t.parameters.radial,o=[];return IG.forEach(l=>{let c=xv(l,a,n??{},s,r);c&&o.push(c)}),o}function zrt(t,e,i,r){if(t.parameters.type!=="linear")return;let n=e.linear,s=i.linear;if(!s)return;let a=[],o=t.parameters.linear;return DG.forEach(l=>{let c=xv(l,o,n??{},s,r);c&&a.push(c)}),a}function jrt(t,e,i,r){if(t.parameters.type!=="grid")return;let n=e.grid,s=i.grid;if(!s)return;let a=[],o=t.parameters.grid;return OG.forEach(l=>{let c;l==="count"?c=qG(l,o,n??{},s,r,!0):c=xv(l,o,n??{},s,r),c&&a.push(c)}),a}function Vrt(t,e,i,r){if(t.parameters.type!=="toObject")return;let n=e.toObject,s=i.toObject;if(!s)return;let a=[],o=t.parameters.toObject;return LG.forEach(l=>{let c;l==="count"?c=go(l,o,n??{},s,r,!0):c=xv(l,o,n??{},s,r),c&&a.push(c)}),a}function Hrt(t,e,i,r){if(!t.parameters.randomness)return;let n=e.randomnessObject,s=i.randomnessObject;if(!s)return;let a=[],o=t.parameters.randomnessObject;return kG.forEach(l=>{let c=xv(l,o,n??{},s,r);c&&a.push(c)}),a}function Grt(t,e,i,r){let n=r.cloner?.parameters;if(n){Sg("count",n,t,e,i),n.count=Math.trunc(n.count);for(let s of IG)Sg(s,n.radial,t.radial,e.radial,i);for(let s of DG)Sg(s,n.linear,t.linear,e.linear,i);for(let s of OG)Sg(s,n.grid,t.grid,e.grid,i);for(let s of LG)Sg(s,n.toObject,t.toObject,e.toObject,i);return n}}function Wrt(t,e,i,r){let n=r.cloner?.parameters;if(n){for(let s of kG)Sg(s,n.randomnessObject,t.randomnessObject,e.randomnessObject,i);return n}}function qs(t,e=[0,0]){let i=t&&!isNaN(t[0])?t[0]:e[0],r=t&&!isNaN(t[1])?t[1]:e[1];return[i,r]}function fl(t,e,i){switch(t){case 0:return"cubicBezier( 0, 0, 1, 1 )";case 1:return"cubicBezier( .25, .1, .25, 1 )";case 2:return"cubicBezier( .42, 0, 1, 1 )";case 3:return"cubicBezier( 0, 0, .58, 1 )";case 4:return"cubicBezier( .42, 0, .58, 1 )";case 7:return"cubicBezier( .25, 1, .5, 1 )";case 5:let{control1:r,control2:n}=e??{...f3.defaultData};return`cubicBezier( ${r[0]}, ${r[1]}, ${n[0]}, ${n[1]} )`;case 6:let{mass:s,stiffness:a,damping:o,velocity:l}=i??{...d3.defaultData},c=new ent(s,a,o,l),u=c.solve(1);return()=>h=>c.solve(h)/u;case 8:return()=>h=>Math.floor(h)}}var xee;(t=>{function e(i){return i&&typeof i.x=="number"&&typeof i.y=="number"&&typeof i.z=="number"}t.is=e})(xee||(xee={}));var O5;(t=>{function e(o,l){let c=[0,0],u=[1,1];if(o?.cubicControls)c=qs(o.cubicControls.control1,c);else switch(o?.type){case 2:c=[.42,0];break;case 3:c=[0,0];break;case 4:c=[.42,0];break;case 1:c=[.25,.1];break;case 0:c=[0,0];break;case 7:c=[.25,1];break}if(l?.cubicControls)u=qs(l.cubicControls.control2,u);else switch(l?.type){case 2:u=[1,1];break;case 3:u=[.58,1];break;case 4:u=[.58,1];break;case 1:u=[.25,1];break;case 0:u=[1,1];break;case 7:u=[.5,1];break}return{control1:c,control2:u}}t.getControlsWithDefault=e;function i(o,l){return{id:o,name:l,to:5,properties:new ni}}t.defaultData=i;function r(o){let l=new ni;return o.forEach(({data:c,id:u,fi:h})=>{if(c.type==="light"){let d=bee(["material",`${c.category} lighting`],u,h);l.push(d)}else{let d=bee(["material",c.type],u,h);l.push(d)}}),l}t.createMaterialGroup=r;function n(o){return Object.entries(o).reduce((l,[c,u])=>(typeof u!="string"&&l.push({name:u.name}),l),[])}t.createName=n;function s(o,l,c){let u=Gg.timeline({easing:fl(0),begin(){o.resetBBoxNeedsUpdate()},change(){o.resetBBoxNeedsUpdate()},direction:l.direction,autoplay:!1});return a(o,l,c).forEach(h=>u.add(h,0)),u.duration=l.to*1e3,u}t.createTimeline=s;function a(o,l,c,u){let h=[];return l.properties.forEach((d,f)=>{let p=d.data.path?.[0];if(p&&["position","rotation","scale"].includes(p)){let g=qrt(d.data,c?.[p],o instanceof Gs);g&&h.push(...g)}if(p&&p==="shape size"&&"geometry"in o){let g=Xrt(o,d.data,c?.shapeSize);g&&h.push(...g)}if(p&&p==="path extrusion"&&o instanceof LL){let g=$rt(o,d.data,c?.pathExtrusion);g&&h.push(g)}if(p&&p==="path snapping"&&o.data.pathSnapping){let g=Yrt(o,d.data,c?.pathSnapping);g&&h.push(g)}if(p&&p==="material"&&o.type==="Mesh"&&"material"in o&&o.material instanceof Qp){let g=d.data.id;if(g){let m=o.material.getLayerByUuid(g);if(m){let y=wee(m,d.data,c?.material,u);y&&h.push(y)}else{let y=o.material.getLayersOfType(d.data.type);if(y)for(let b of y){let w=wee(b,d.data,c?.material,u);w&&h.push(w)}}}}if(p&&p==="opacity"&&o.type==="Mesh"&&"material"in o){let g=Krt(d.data,c?.opacity);g&&h.push(g)}if(p&&p==="cloner"){let g=Zrt(o,d.data,c?.cloner);g&&h.push(g)}if(p&&p==="camera"&&o instanceof Gs){let g=Qrt(o,d.data,c?.camera,"zoom");g&&h.push(g)}if(p&&p==="light"&&(o instanceof IL||o instanceof w8||o instanceof DL)){let g=Jrt(o,d.data,c?.light,d.data.path[1],u);g&&h.push(g)}}),h}t.addKeyframesToTimeline=a,t.Presets=[{name:"Slide in",animationParams:{translateX:{value:[-20,0],easing:fl(3),duration:1e3},opacity:{value:[0,1],easing:fl(3),duration:1e3},endDelay:250,loop:!0}},{name:"Rotate",animationParams:{rotate:{value:[0,"1turn"],easing:fl(5),duration:700},endDelay:250,loop:!0}},{name:"Scale Out",animationParams:{scale:{value:[1,1.5],easing:fl(4),duration:1e3},endDelay:250,loop:!0}},{name:"Jump",animationParams:{translateY:[{value:0,duration:200,easing:"linear"},{value:-20,easing:"linear",duration:200},{value:0,easing:"linear",duration:100}],endDelay:500,loop:!0}},{name:"Jump Rotate",animationParams:{translateY:[{value:0,duration:200,easing:"linear"},{value:-20,easing:"linear",duration:200},{value:0,easing:"linear",duration:100}],rotate:{value:[0,"1turn"],easing:fl(5),duration:500},endDelay:500,loop:!0}},{name:"Bounce",animationParams:{translateY:{value:["20px","-20px"],duration:575,easing:"easeOutQuad"},direction:"alternate",loop:!0}}]})(O5||(O5={}));function bee(t,e,i){let r=e;return{id:r,fi:i,data:{id:r,path:t,keyframes:new ni}}}var Ofe=["x","y","z"];function qrt(t,e=()=>{},i){let r=[];for(let n of Ofe){let s=[...t.keyframes??[]].filter(l=>l.data.value[n]!==void 0).sort((l,c)=>l.data.time-c.data.time),a=s[0];a&&e?.(a.data.value);let o={index:[],t:[]};for(let l=0;l<s.length-1;l++){let c=s[l],u=s[l+1]??c,h={duration:(u?.data?.time-c.data.time)*1e3,delay:l===0?s[0].data.time*1e3:0};l<s.length-1&&(o.t.push({...h,value:l%2===0?1:0,easing:fl(c.data.easing.type,{control1:qs(c.data.easing.cubicControls?.control1,[0,0]),control2:qs(u.data.easing.cubicControls?.control2,[1,1])},c.data.easing.springParameters)}),o.index.push({...h,value:l,easing:"linear"}))}if(s.length>1){let l={t:0,index:0};r.push({targets:l,...o,update:c=>{let u=Math.ceil(l.index),h=u%2===0?l.t:1-l.t,d=s?.[u].data.value,f=s?.[u+1]?.data.value;if(d!==void 0&&f!==void 0){let p=i&&t.path[0]==="rotation"&&Object.keys(d).length===3&&Object.keys(f).length===3?Urt(d,f,h):{[n]:d[n]+(f[n]-d[n])*h};e?.(p)}}})}}return r}function Xrt(t,e,i){let r=[];for(let n of Ofe){let s={},a=[...e.keyframes??[]].filter(l=>l.data.value[n]!==void 0).sort((l,c)=>l.data.time-c.data.time),o=a[0];o&&i?.(o.data.value),s={index:[],t:[]};for(let l=0;l<a.length-1;l++){let c=a[l],u=a[l+1]??c,h={duration:(u?.data?.time-c.data.time)*1e3,delay:l===0?a[0].data.time*1e3:0};l<a.length-1&&(s.t.push({...h,value:l%2===0?1:0,easing:fl(c.data.easing.type,{control1:qs(c.data.easing.cubicControls?.control1,[0,0]),control2:qs(u.data.easing.cubicControls?.control2,[1,1])},c.data.easing.springParameters)}),s.index.push({...h,value:l,easing:"linear"}))}if(a.length>1){let l={t:0,index:0};r.push({targets:l,...s,update:c=>{let u=Math.ceil(l.index),h=u%2===0?l.t:1-l.t,d=a?.[u].data.value,f=a?.[u+1]?.data.value;if(d!==void 0&&f!==void 0){let p={[n]:d[n]+(f[n]-d[n])*h};i?.(p)}}})}}return r}function $rt(t,e,i){let r={},n=[...e.keyframes??[]].sort((a,o)=>a.data.time-o.data.time),s=n[0];s&&i?.(t,s.data.value),r={index:[],t:[]};for(let a=0;a<n.length-1;a++){let o=n[a],l=n[a+1]??o,c={duration:(l?.data?.time-o.data.time)*1e3,delay:a===0?n[0].data.time*1e3:0};a<n.length-1&&(r.t.push({...c,value:a%2===0?1:0,easing:fl(o.data.easing.type,{control1:qs(o.data.easing.cubicControls?.control1,[0,0]),control2:qs(l.data.easing.cubicControls?.control2,[1,1])},o.data.easing.springParameters)}),r.index.push({...c,value:a,easing:"linear"}))}if(n.length>1){let a={t:0,index:0};return{targets:a,...r,update:o=>{let l=Math.ceil(a.index),c=l%2===0?a.t:1-a.t,u=n?.[Math.min(l,n.length-1)].data.value,h=n?.[Math.min(l,n.length-1)+1]?.data.value;i?.(t,pft(t,u,h,c))}}}}function Yrt(t,e,i){let r={},n=[...e.keyframes??[]].sort((a,o)=>a.data.time-o.data.time),s=n[0];s&&i?.(s.data.value),r={index:[],t:[]};for(let a=0;a<n.length-1;a++){let o=n[a],l=n[a+1]??o,c={duration:(l?.data?.time-o.data.time)*1e3,delay:a===0?n[0].data.time*1e3:0};a<n.length-1&&(r.t.push({...c,value:a%2===0?1:0,easing:fl(o.data.easing.type,{control1:qs(o.data.easing.cubicControls?.control1,[0,0]),control2:qs(l.data.easing.cubicControls?.control2,[1,1])},o.data.easing.springParameters)}),r.index.push({...c,value:a,easing:"linear"}))}if(n.length>1){let a={t:0,index:0};return{targets:a,...r,update:o=>{let l=Math.ceil(a.index),c=l%2===0?a.t:1-a.t,u=n?.[Math.min(l,n.length-1)].data.value,h=n?.[Math.min(l,n.length-1)+1]?.data.value;i?.(mft(t,u,h,c))}}}}function wee(t,e,i,r){if(e){let n={},s=[...e.keyframes??[]].sort((a,o)=>a.data.time-o.data.time);if("data"in t){let a=s[0];a&&i?.(a.data.value,t),n={index:[],t:[]};for(let o=0;o<s.length-1;o++){let l=s[o],c=s[o+1]??l,u={duration:(c?.data?.time-l.data.time)*1e3,delay:o===0?s[0].data.time*1e3:0};o<s.length-1&&(n.t.push({...u,value:o%2===0?1:0,easing:fl(l.data.easing.type,{control1:qs(l.data.easing.cubicControls?.control1,[0,0]),control2:qs(c.data.easing.cubicControls?.control2,[1,1])},l.data.easing.springParameters)}),n.index.push({...u,value:o,easing:"linear"}))}if(s.length>1){let o={t:0,index:0};return{targets:o,...n,update:l=>{let c=Math.ceil(o.index),u=c%2===0?o.t:1-o.t,h=s?.[Math.min(c,s.length-1)].data.value,d=s?.[Math.min(c,s.length-1)+1]?.data.value,f={},p={};if(Object.keys(h).length>0&&Object.keys(d).length>0){for(let g in t.data)if(g in h&&g in d){let m=XG(h[g],d[g],u,r);m!==void 0&&(f[g]=m,p[g]={start:h,end:d,t:u})}}i?.({...f},t,p)}}}}}}function Krt(t,e){if(t){let i={},r=[...t.keyframes??[]].sort((s,a)=>s.data.time-a.data.time),n=r[0];n&&e?.(n.data.value),i={index:[],t:[]};for(let s=0;s<r.length-1;s++){let a=r[s],o=r[s+1]??a,l={duration:(o?.data?.time-a.data.time)*1e3,delay:s===0?r[0].data.time*1e3:0};s<r.length-1&&(i.t.push({...l,value:s%2===0?1:0,easing:fl(a.data.easing.type,{control1:qs(a.data.easing.cubicControls?.control1,[0,0]),control2:qs(o.data.easing.cubicControls?.control2,[1,1])},a.data.easing.springParameters)}),i.index.push({...l,value:s,easing:"linear"}))}if(r.length>1){let s={t:0,index:0};return{targets:s,...i,update:a=>{let o=Math.ceil(s.index),l=o%2===0?s.t:1-s.t,c=r?.[Math.min(o,r.length-1)].data.value,u=r?.[Math.min(o,r.length-1)+1]?.data.value,h=Ht.lerp(c,u,l);e?.(h)}}}}}function Zrt(t,e,i){let r={},n=[...e.keyframes??[]].sort((a,o)=>a.data.time-o.data.time),s=n[0];s&&i?.(t,s.data.value,s.data.value),r={index:[],t:[]};for(let a=0;a<n.length-1;a++){let o=n[a],l=n[a+1]??o,c={duration:(l?.data?.time-o.data.time)*1e3,delay:a===0?n[0].data.time*1e3:0};a<n.length-1&&(r.t.push({...c,value:a%2===0?1:0,easing:fl(o.data.easing.type,{control1:qs(o.data.easing.cubicControls?.control1,[0,0]),control2:qs(l.data.easing.cubicControls?.control2,[1,1])},o.data.easing.springParameters)}),r.index.push({...c,value:a,easing:"linear"}))}if(n.length>1){let a={t:0,index:0};return{targets:a,...r,update:o=>{let l=Math.ceil(a.index),c=l%2===0?a.t:1-a.t,u=n?.[Math.min(l,n.length-1)].data.value,h=n?.[Math.min(l,n.length-1)+1]?.data.value;i?.(t,u.randomnessObject?void 0:Grt(u,h,c,t),u.randomnessObject?Wrt(u,h,c,t):void 0)}}}}function XG(t,e,i,r){if(typeof t=="string"&&r&&(t=r.color(t)),typeof e=="string"&&r&&(t=r.color(e)),typeof t=="number")return t===e?void 0:Ht.lerp(t,e,i);if(Xr.is(t))return Xr.lerp(t,e,i);if(ca.is(t))return ca.lerp(t,e,i);if(Array.isArray(t))return(t.length>e.length?e:t).map((n,s,a)=>{if(Array.isArray(n)){let o=t[s].length>e[s].length?e[s].length:t[s].length;return(o===4?zM:o===3?Hg:kd).lerp(t[s],e[s],i)}else return Ht.lerp(t[s],e[s],i)});if(typeof t=="object"&&t!==null){let n={};for(let s in t){let a=XG(t[s],e[s],i,r);a!==void 0&&(n[s]=a)}return n}}function Qrt(t,e,i,r){if(e){let n={[r]:[]},s=[...e.keyframes??[]].sort((o,l)=>o.data.time-l.data.time),a=s[0];a&&(t[r]=a.data.value,a&&i?.(r,a.data.value));for(let o=0;o<s.length-1;o++){let l=s[o];if(!Number.isFinite(l.data.value))continue;let c=s[o+1]??l,u=c.data.value;n[r].push({value:u,easing:fl(l.data.easing.type,{control1:qs(l.data.easing.cubicControls?.control1,[0,0]),control2:qs(c.data.easing.cubicControls?.control2,[1,1])},l.data.easing.springParameters),duration:(c?.data?.time-l.data.time)*1e3,delay:o===0?s[0].data.time*1e3:0})}if(s.length>1)return{targets:t,...n,update:()=>{i?.(r,t[r])}}}}function Jrt(t,e,i,r,n){if(e){let s={},a=[...e.keyframes??[]].sort((l,c)=>l.data.time-c.data.time),o=a[0];if(o){let l=o.data.value;t[r]=l,i?.(r,l)}s={index:[],t:[]};for(let l=0;l<a.length-1;l++){let c=a[l],u=a[l+1]??c,h={duration:(u?.data?.time-c.data.time)*1e3,delay:l===0?a[0].data.time*1e3:0};l<a.length-1&&(s.t.push({...h,value:l%2===0?1:0,easing:fl(c.data.easing.type,{control1:qs(c.data.easing.cubicControls?.control1,[0,0]),control2:qs(u.data.easing.cubicControls?.control2,[1,1])},c.data.easing.springParameters)}),s.index.push({...h,value:l,easing:"linear"}))}if(a.length>1){let l={t:0,index:0};return{targets:l,...s,update:()=>{let c=Math.ceil(l.index),u=c%2===0?l.t:1-l.t,h=a?.[Math.min(c,a.length-1)].data.value,d=a?.[Math.min(c,a.length-1)+1]?.data.value,f=XG(h,d,u,n);i?.(r,f)}}}}}var ent=class{constructor(t=1,e=100,i=10,r=0){this.mass=t,this.stiffness=e,this.damping=i,this.initialVelocity=r,this.m_w0=Math.sqrt(e/t),this.m_zeta=i/(2*Math.sqrt(e*t)),this.m_zeta<1?(this.m_wd=this.m_w0*Math.sqrt(1-this.m_zeta*this.m_zeta),this.m_A=1,this.m_B=(this.m_zeta*this.m_w0+-r)/this.m_wd):(this.m_wd=0,this.m_A=1,this.m_B=-r+this.m_w0)}solve(t){return this.m_zeta<1?t=Math.exp(-t*this.m_zeta*this.m_w0)*(this.m_A*Math.cos(this.m_wd*t)+this.m_B*Math.sin(this.m_wd*t)):t=(this.m_A+this.m_B*t)*Math.exp(-t*this.m_w0),1-t}getDuration(){let t=.16666666666666666,e=0,i=0;for(;;)if(e+=t,this.solve(e)===1){if(i++,i>=16)break}else i=0;return e*t*1e3}},tnt=Math.pow(2,-24),KP=class{constructor(){}};function Td(t,e,i){return i.min.x=e[t],i.min.y=e[t+1],i.min.z=e[t+2],i.max.x=e[t+3],i.max.y=e[t+4],i.max.z=e[t+5],i}function _ee(t){let e=-1,i=-1/0;for(let r=0;r<3;r++){let n=t[r+3]-t[r];n>i&&(i=n,e=r)}return e}function See(t,e){e.set(t)}function Eee(t,e,i){let r,n;for(let s=0;s<3;s++){let a=s+3;r=t[s],n=e[s],i[s]=r<n?r:n,r=t[a],n=e[a],i[a]=r>n?r:n}}function ZP(t,e,i){for(let r=0;r<3;r++){let n=e[t+2*r],s=e[t+2*r+1],a=n-s,o=n+s;a<i[r]&&(i[r]=a),o>i[r+3]&&(i[r+3]=o)}}function gE(t){let e=t[3]-t[0],i=t[4]-t[1],r=t[5]-t[2];return 2*(e*i+i*r+r*e)}function int(t,e){if(!t.index){let i=t.attributes.position.count,r=e.useSharedArrayBuffer?SharedArrayBuffer:ArrayBuffer,n;i>65535?n=new Uint32Array(new r(4*i)):n=new Uint16Array(new r(2*i)),t.setIndex(new Mi(n,1));for(let s=0;s<i;s++)n[s]=s}}function rnt(t){if(!t.groups||!t.groups.length)return[{offset:0,count:t.index.count/3}];let e=[],i=new Set;for(let n of t.groups)i.add(n.start),i.add(n.start+n.count);let r=Array.from(i.values()).sort((n,s)=>n-s);for(let n=0;n<r.length-1;n++){let s=r[n],a=r[n+1];e.push({offset:s/3,count:(a-s)/3})}return e}function EF(t,e,i,r,n=null){let s=1/0,a=1/0,o=1/0,l=-1/0,c=-1/0,u=-1/0,h=1/0,d=1/0,f=1/0,p=-1/0,g=-1/0,m=-1/0,y=n!==null;for(let b=e*6,w=(e+i)*6;b<w;b+=6){let E=t[b+0],M=t[b+1],A=E-M,P=E+M;A<s&&(s=A),P>l&&(l=P),y&&E<h&&(h=E),y&&E>p&&(p=E);let C=t[b+2],R=t[b+3],I=C-R,k=C+R;I<a&&(a=I),k>c&&(c=k),y&&C<d&&(d=C),y&&C>g&&(g=C);let z=t[b+4],V=t[b+5],F=z-V,$=z+V;F<o&&(o=F),$>u&&(u=$),y&&z<f&&(f=z),y&&z>m&&(m=z)}r[0]=s,r[1]=a,r[2]=o,r[3]=l,r[4]=c,r[5]=u,y&&(n[0]=h,n[1]=d,n[2]=f,n[3]=p,n[4]=g,n[5]=m)}function nnt(t,e,i,r){let n=1/0,s=1/0,a=1/0,o=-1/0,l=-1/0,c=-1/0;for(let u=e*6,h=(e+i)*6;u<h;u+=6){let d=t[u+0];d<n&&(n=d),d>o&&(o=d);let f=t[u+2];f<s&&(s=f),f>l&&(l=f);let p=t[u+4];p<a&&(a=p),p>c&&(c=p)}r[0]=n,r[1]=s,r[2]=a,r[3]=o,r[4]=l,r[5]=c}function snt(t,e,i,r,n){let s=i,a=i+r-1,o=n.pos,l=n.axis*2;for(;;){for(;s<=a&&e[s*6+l]<o;)s++;for(;s<=a&&e[a*6+l]>=o;)a--;if(s<a){for(let c=0;c<3;c++){let u=t[s*3+c];t[s*3+c]=t[a*3+c],t[a*3+c]=u;let h=e[s*6+c*2+0];e[s*6+c*2+0]=e[a*6+c*2+0],e[a*6+c*2+0]=h;let d=e[s*6+c*2+1];e[s*6+c*2+1]=e[a*6+c*2+1],e[a*6+c*2+1]=d}s++,a--}else return s}}var cp=32,ant=(t,e)=>t.candidate-e.candidate,Km=new Array(cp).fill().map(()=>({count:0,bounds:new Float32Array(6),rightCacheBounds:new Float32Array(6),leftCacheBounds:new Float32Array(6),candidate:0})),QP=new Float32Array(6);function ont(t,e,i,r,n,s){let a=-1,o=0;if(s===0)a=_ee(e),a!==-1&&(o=(e[a]+e[a+3])/2);else if(s===1)a=_ee(t),a!==-1&&(o=lnt(i,r,n,a));else if(s===2){let l=gE(t),c=1.25*n,u=r*6,h=(r+n)*6;for(let d=0;d<3;d++){let f=e[d],p=(e[d+3]-f)/cp;if(n<cp/4){let g=[...Km];g.length=n;let m=0;for(let b=u;b<h;b+=6,m++){let w=g[m];w.candidate=i[b+2*d],w.count=0;let{bounds:E,leftCacheBounds:M,rightCacheBounds:A}=w;for(let P=0;P<3;P++)A[P]=1/0,A[P+3]=-1/0,M[P]=1/0,M[P+3]=-1/0,E[P]=1/0,E[P+3]=-1/0;ZP(b,i,E)}g.sort(ant);let y=n;for(let b=0;b<y;b++){let w=g[b];for(;b+1<y&&g[b+1].candidate===w.candidate;)g.splice(b+1,1),y--}for(let b=u;b<h;b+=6){let w=i[b+2*d];for(let E=0;E<y;E++){let M=g[E];w>=M.candidate?ZP(b,i,M.rightCacheBounds):(ZP(b,i,M.leftCacheBounds),M.count++)}}for(let b=0;b<y;b++){let w=g[b],E=w.count,M=n-w.count,A=w.leftCacheBounds,P=w.rightCacheBounds,C=0;E!==0&&(C=gE(A)/l);let R=0;M!==0&&(R=gE(P)/l);let I=1+1.25*(C*E+R*M);I<c&&(a=d,c=I,o=w.candidate)}}else{for(let y=0;y<cp;y++){let b=Km[y];b.count=0,b.candidate=f+p+y*p;let w=b.bounds;for(let E=0;E<3;E++)w[E]=1/0,w[E+3]=-1/0}for(let y=u;y<h;y+=6){let b=~~((i[y+2*d]-f)/p);b>=cp&&(b=cp-1);let w=Km[b];w.count++,ZP(y,i,w.bounds)}let g=Km[cp-1];See(g.bounds,g.rightCacheBounds);for(let y=cp-2;y>=0;y--){let b=Km[y],w=Km[y+1];Eee(b.bounds,w.rightCacheBounds,b.rightCacheBounds)}let m=0;for(let y=0;y<cp-1;y++){let b=Km[y],w=b.count,E=b.bounds,M=Km[y+1].rightCacheBounds;w!==0&&(m===0?See(E,QP):Eee(E,QP,QP)),m+=w;let A=0,P=0;m!==0&&(A=gE(QP)/l);let C=n-m;C!==0&&(P=gE(M)/l);let R=1+1.25*(A*m+P*C);R<c&&(a=d,c=R,o=b.candidate)}}}}else console.warn(`MeshBVH: Invalid build strategy value ${s} used.`);return{axis:a,pos:o}}function lnt(t,e,i,r){let n=0;for(let s=e,a=e+i;s<a;s++)n+=t[s*6+r*2];return n/i}function cnt(t,e){let i=t.attributes.position,r=t.index.array,n=r.length/3,s=new Float32Array(n*6),a=i.normalized,o=i.array,l=i.offset||0,c=3;i.isInterleavedBufferAttribute&&(c=i.data.stride);let u=["getX","getY","getZ"];for(let h=0;h<n;h++){let d=h*3,f=h*6,p,g,m;a?(p=r[d+0],g=r[d+1],m=r[d+2]):(p=r[d+0]*c+l,g=r[d+1]*c+l,m=r[d+2]*c+l);for(let y=0;y<3;y++){let b,w,E;a?(b=i[u[y]](p),w=i[u[y]](g),E=i[u[y]](m)):(b=o[p+y],w=o[g+y],E=o[m+y]);let M=b;w<M&&(M=w),E<M&&(M=E);let A=b;w>A&&(A=w),E>A&&(A=E);let P=(A-M)/2,C=y*2;s[f+C+0]=M+P,s[f+C+1]=P+(Math.abs(M)+P)*tnt,M<e[y]&&(e[y]=M),A>e[y+3]&&(e[y+3]=A)}}return s}function unt(t,e){function i(y){d&&d(y/f)}function r(y,b,w,E=null,M=0){if(!p&&M>=l&&(p=!0,c&&(console.warn(`MeshBVH: Max depth of ${l} reached when generating BVH. Consider increasing maxDepth.`),console.warn(t))),w<=u||M>=l)return i(b+w),y.offset=b,y.count=w,y;let A=ont(y.boundingData,E,a,b,w,h);if(A.axis===-1)return i(b+w),y.offset=b,y.count=w,y;let P=snt(o,a,b,w,A);if(P===b||P===b+w)i(b+w),y.offset=b,y.count=w;else{y.splitAxis=A.axis;let C=new KP,R=b,I=P-b;y.left=C,C.boundingData=new Float32Array(6),EF(a,R,I,C.boundingData,s),r(C,R,I,s,M+1);let k=new KP,z=P,V=w-I;y.right=k,k.boundingData=new Float32Array(6),EF(a,z,V,k.boundingData,s),r(k,z,V,s,M+1)}return y}int(t,e);let n=new Float32Array(6),s=new Float32Array(6),a=cnt(t,n),o=t.index.array,l=e.maxDepth,c=e.verbose,u=e.maxLeafTris,h=e.strategy,d=e.onProgress,f=t.index.count/3,p=!1,g=[],m=rnt(t);if(m.length===1){let y=m[0],b=new KP;b.boundingData=n,nnt(a,y.offset,y.count,s),r(b,y.offset,y.count,s),g.push(b)}else for(let y of m){let b=new KP;b.boundingData=new Float32Array(6),EF(a,y.offset,y.count,b.boundingData,s),r(b,y.offset,y.count,s),g.push(b)}return g}function hnt(t,e){let i=unt(t,e),r,n,s,a=[],o=e.useSharedArrayBuffer?SharedArrayBuffer:ArrayBuffer;for(let u=0;u<i.length;u++){let h=i[u],d=l(h),f=new o(32*d);r=new Float32Array(f),n=new Uint32Array(f),s=new Uint16Array(f),c(0,h),a.push(f)}return a;function l(u){return u.count?1:1+l(u.left)+l(u.right)}function c(u,h){let d=u/4,f=u/2,p=!!h.count,g=h.boundingData;for(let m=0;m<6;m++)r[d+m]=g[m];if(p){let m=h.offset,y=h.count;return n[d+6]=m,s[f+14]=y,s[f+15]=65535,u+32}else{let m=h.left,y=h.right,b=h.splitAxis,w;if(w=c(u+32,m),w/4>Math.pow(2,32))throw new Error("MeshBVH: Cannot store child pointer greater than 32 bits.");return n[d+6]=w/4,w=c(w,y),n[d+7]=b,w}}}var Kp=class{constructor(){this.min=1/0,this.max=-1/0}setFromPointsField(t,e){let i=1/0,r=-1/0;for(let n=0,s=t.length;n<s;n++){let a=t[n][e];i=a<i?a:i,r=a>r?a:r}this.min=i,this.max=r}setFromPoints(t,e){let i=1/0,r=-1/0;for(let n=0,s=e.length;n<s;n++){let a=e[n],o=t.dot(a);i=o<i?o:i,r=o>r?o:r}this.min=i,this.max=r}isSeparated(t){return this.min>t.max||t.min>this.max}};Kp.prototype.setFromBox=(function(){let t=new W;return function(e,i){let r=i.min,n=i.max,s=1/0,a=-1/0;for(let o=0;o<=1;o++)for(let l=0;l<=1;l++)for(let c=0;c<=1;c++){t.x=r.x*o+n.x*(1-o),t.y=r.y*l+n.y*(1-l),t.z=r.z*c+n.z*(1-c);let u=e.dot(t);s=Math.min(u,s),a=Math.max(u,a)}this.min=s,this.max=a}})();var dnt=(function(){let t=new W,e=new W,i=new W;return function(r,n,s){let a=r.start,o=t,l=n.start,c=e;i.subVectors(a,l),t.subVectors(r.end,r.start),e.subVectors(n.end,n.start);let u=i.dot(c),h=c.dot(o),d=c.dot(c),f=i.dot(o),p=o.dot(o)*d-h*h,g,m;p!==0?g=(u*h-f*d)/p:g=0,m=(u+g*h)/d,s.x=g,s.y=m}})(),$G=(function(){let t=new Ae,e=new W,i=new W;return function(r,n,s,a){dnt(r,n,t);let o=t.x,l=t.y;if(o>=0&&o<=1&&l>=0&&l<=1){r.at(o,s),n.at(l,a);return}else if(o>=0&&o<=1){l<0?n.at(0,a):n.at(1,a),r.closestPointToPoint(a,!0,s);return}else if(l>=0&&l<=1){o<0?r.at(0,s):r.at(1,s),n.closestPointToPoint(s,!0,a);return}else{let c;o<0?c=r.start:c=r.end;let u;l<0?u=n.start:u=n.end;let h=e,d=i;if(r.closestPointToPoint(u,!0,e),n.closestPointToPoint(c,!0,i),h.distanceToSquared(u)<=d.distanceToSquared(c)){s.copy(h),a.copy(u);return}else{s.copy(c),a.copy(d);return}}}})(),fnt=(function(){let t=new W,e=new W,i=new $l,r=new xu;return function(n,s){let{radius:a,center:o}=n,{a:l,b:c,c:u}=s;if(r.start=l,r.end=c,r.closestPointToPoint(o,!0,t).distanceTo(o)<=a||(r.start=l,r.end=u,r.closestPointToPoint(o,!0,t).distanceTo(o)<=a)||(r.start=c,r.end=u,r.closestPointToPoint(o,!0,t).distanceTo(o)<=a))return!0;let h=s.getPlane(i);if(Math.abs(h.distanceToPoint(o))<=a){let d=h.projectPoint(o,e);if(s.containsPoint(d))return!0}return!1}})(),pnt=1e-15;function iw(t){return Math.abs(t)<pnt}var Zp=class extends vo{constructor(...t){super(...t),this.isExtendedTriangle=!0,this.satAxes=new Array(4).fill().map(()=>new W),this.satBounds=new Array(4).fill().map(()=>new Kp),this.points=[this.a,this.b,this.c],this.sphere=new oc,this.plane=new $l,this.needsUpdate=!0}intersectsSphere(t){return fnt(t,this)}update(){let t=this.a,e=this.b,i=this.c,r=this.points,n=this.satAxes,s=this.satBounds,a=n[0],o=s[0];this.getNormal(a),o.setFromPoints(a,r);let l=n[1],c=s[1];l.subVectors(t,e),c.setFromPoints(l,r);let u=n[2],h=s[2];u.subVectors(e,i),h.setFromPoints(u,r);let d=n[3],f=s[3];d.subVectors(i,t),f.setFromPoints(d,r),this.sphere.setFromPoints(this.points),this.plane.setFromNormalAndCoplanarPoint(a,t),this.needsUpdate=!1}};Zp.prototype.closestPointToSegment=(function(){let t=new W,e=new W,i=new xu;return function(r,n=null,s=null){let{start:a,end:o}=r,l=this.points,c,u=1/0;for(let h=0;h<3;h++){let d=(h+1)%3;i.start.copy(l[h]),i.end.copy(l[d]),$G(i,r,t,e),c=t.distanceToSquared(e),c<u&&(u=c,n&&n.copy(t),s&&s.copy(e))}return this.closestPointToPoint(a,t),c=a.distanceToSquared(t),c<u&&(u=c,n&&n.copy(t),s&&s.copy(a)),this.closestPointToPoint(o,t),c=o.distanceToSquared(t),c<u&&(u=c,n&&n.copy(t),s&&s.copy(o)),Math.sqrt(u)}})();Zp.prototype.intersectsTriangle=(function(){let t=new Zp,e=new Array(3),i=new Array(3),r=new Kp,n=new Kp,s=new W,a=new W,o=new W,l=new W,c=new xu,u=new xu,h=new xu;return function(d,f=null,p=!1){this.needsUpdate&&this.update(),d.isExtendedTriangle?d.needsUpdate&&d.update():(t.copy(d),t.update(),d=t);let g=this.plane,m=d.plane;if(Math.abs(g.normal.dot(m.normal))>1-1e-10){let y=this.satBounds,b=this.satAxes;i[0]=d.a,i[1]=d.b,i[2]=d.c;for(let M=0;M<4;M++){let A=y[M],P=b[M];if(r.setFromPoints(P,i),A.isSeparated(r))return!1}let w=d.satBounds,E=d.satAxes;e[0]=this.a,e[1]=this.b,e[2]=this.c;for(let M=0;M<4;M++){let A=w[M],P=E[M];if(r.setFromPoints(P,e),A.isSeparated(r))return!1}for(let M=0;M<4;M++){let A=b[M];for(let P=0;P<4;P++){let C=E[P];if(s.crossVectors(A,C),r.setFromPoints(s,e),n.setFromPoints(s,i),r.isSeparated(n))return!1}}return f&&(p||console.warn("ExtendedTriangle.intersectsTriangle: Triangles are coplanar which does not support an output edge. Setting edge to 0, 0, 0."),f.start.set(0,0,0),f.end.set(0,0,0)),!0}else{let y=this.points,b=!1,w=0;for(let V=0;V<3;V++){let F=y[V],$=y[(V+1)%3];c.start.copy(F),c.end.copy($),c.delta(a);let K=b?u.start:u.end,X=iw(m.distanceToPoint(F));if(iw(m.normal.dot(a))&&X){u.copy(c),w=2;break}if((m.intersectLine(c,K)||X)&&!iw(K.distanceTo($))){if(w++,b)break;b=!0}}if(w===1&&d.containsPoint(u.end))return f&&(f.start.copy(u.end),f.end.copy(u.end)),!0;if(w!==2)return!1;let E=d.points,M=!1,A=0;for(let V=0;V<3;V++){let F=E[V],$=E[(V+1)%3];c.start.copy(F),c.end.copy($),c.delta(o);let K=M?h.start:h.end,X=iw(g.distanceToPoint(F));if(iw(g.normal.dot(o))&&X){h.copy(c),A=2;break}if((g.intersectLine(c,K)||X)&&!iw(K.distanceTo($))){if(A++,M)break;M=!0}}if(A===1&&this.containsPoint(h.end))return f&&(f.start.copy(h.end),f.end.copy(h.end)),!0;if(A!==2)return!1;if(u.delta(a),h.delta(o),a.dot(o)<0){let V=h.start;h.start=h.end,h.end=V}let P=u.start.dot(a),C=u.end.dot(a),R=h.start.dot(a),I=h.end.dot(a),k=C<R,z=P<I;return P!==I&&R!==C&&k===z?!1:(f&&(l.subVectors(u.start,h.start),l.dot(a)>0?f.start.copy(u.start):f.start.copy(h.start),l.subVectors(u.end,h.end),l.dot(a)<0?f.end.copy(u.end):f.end.copy(h.end)),!0)}}})();Zp.prototype.distanceToPoint=(function(){let t=new W;return function(e){return this.closestPointToPoint(e,t),e.distanceTo(t)}})();Zp.prototype.distanceToTriangle=(function(){let t=new W,e=new W,i=["a","b","c"],r=new xu,n=new xu;return function(s,a=null,o=null){let l=a||o?r:null;if(this.intersectsTriangle(s,l))return(a||o)&&(a&&l.getCenter(a),o&&l.getCenter(o)),0;let c=1/0;for(let u=0;u<3;u++){let h,d=i[u],f=s[d];this.closestPointToPoint(f,t),h=f.distanceToSquared(t),h<c&&(c=h,a&&a.copy(t),o&&o.copy(f));let p=this[d];s.closestPointToPoint(p,t),h=p.distanceToSquared(t),h<c&&(c=h,a&&a.copy(p),o&&o.copy(t))}for(let u=0;u<3;u++){let h=i[u],d=i[(u+1)%3];r.set(this[h],this[d]);for(let f=0;f<3;f++){let p=i[f],g=i[(f+1)%3];n.set(s[p],s[g]),$G(r,n,t,e);let m=t.distanceToSquared(e);m<c&&(c=m,a&&a.copy(t),o&&o.copy(e))}}return Math.sqrt(c)}})();var rf=class{constructor(t,e,i){this.isOrientedBox=!0,this.min=new W,this.max=new W,this.matrix=new St,this.invMatrix=new St,this.points=new Array(8).fill().map(()=>new W),this.satAxes=new Array(3).fill().map(()=>new W),this.satBounds=new Array(3).fill().map(()=>new Kp),this.alignedSatBounds=new Array(3).fill().map(()=>new Kp),this.needsUpdate=!1,t&&this.min.copy(t),e&&this.max.copy(e),i&&this.matrix.copy(i)}set(t,e,i){this.min.copy(t),this.max.copy(e),this.matrix.copy(i),this.needsUpdate=!0}copy(t){this.min.copy(t.min),this.max.copy(t.max),this.matrix.copy(t.matrix),this.needsUpdate=!0}};rf.prototype.update=(function(){return function(){let t=this.matrix,e=this.min,i=this.max,r=this.points;for(let l=0;l<=1;l++)for(let c=0;c<=1;c++)for(let u=0;u<=1;u++){let h=1*l|2*c|4*u,d=r[h];d.x=l?i.x:e.x,d.y=c?i.y:e.y,d.z=u?i.z:e.z,d.applyMatrix4(t)}let n=this.satBounds,s=this.satAxes,a=r[0];for(let l=0;l<3;l++){let c=s[l],u=n[l],h=1<<l,d=r[h];c.subVectors(a,d),u.setFromPoints(c,r)}let o=this.alignedSatBounds;o[0].setFromPointsField(r,"x"),o[1].setFromPointsField(r,"y"),o[2].setFromPointsField(r,"z"),this.invMatrix.copy(this.matrix).invert(),this.needsUpdate=!1}})();rf.prototype.intersectsBox=(function(){let t=new Kp;return function(e){this.needsUpdate&&this.update();let i=e.min,r=e.max,n=this.satBounds,s=this.satAxes,a=this.alignedSatBounds;if(t.min=i.x,t.max=r.x,a[0].isSeparated(t)||(t.min=i.y,t.max=r.y,a[1].isSeparated(t))||(t.min=i.z,t.max=r.z,a[2].isSeparated(t)))return!1;for(let o=0;o<3;o++){let l=s[o],c=n[o];if(t.setFromBox(l,e),c.isSeparated(t))return!1}return!0}})();rf.prototype.intersectsTriangle=(function(){let t=new Zp,e=new Array(3),i=new Kp,r=new Kp,n=new W;return function(s){this.needsUpdate&&this.update(),s.isExtendedTriangle?s.needsUpdate&&s.update():(t.copy(s),t.update(),s=t);let a=this.satBounds,o=this.satAxes;e[0]=s.a,e[1]=s.b,e[2]=s.c;for(let h=0;h<3;h++){let d=a[h],f=o[h];if(i.setFromPoints(f,e),d.isSeparated(i))return!1}let l=s.satBounds,c=s.satAxes,u=this.points;for(let h=0;h<3;h++){let d=l[h],f=c[h];if(i.setFromPoints(f,u),d.isSeparated(i))return!1}for(let h=0;h<3;h++){let d=o[h];for(let f=0;f<4;f++){let p=c[f];if(n.crossVectors(d,p),i.setFromPoints(n,e),r.setFromPoints(n,u),i.isSeparated(r))return!1}}return!0}})();rf.prototype.closestPointToPoint=(function(){return function(t,e){return this.needsUpdate&&this.update(),e.copy(t).applyMatrix4(this.invMatrix).clamp(this.min,this.max).applyMatrix4(this.matrix),e}})();rf.prototype.distanceToPoint=(function(){let t=new W;return function(e){return this.closestPointToPoint(e,t),e.distanceTo(t)}})();rf.prototype.distanceToBox=(function(){let t=["x","y","z"],e=new Array(12).fill().map(()=>new xu),i=new Array(12).fill().map(()=>new xu),r=new W,n=new W;return function(s,a=0,o=null,l=null){if(this.needsUpdate&&this.update(),this.intersectsBox(s))return(o||l)&&(s.getCenter(n),this.closestPointToPoint(n,r),s.closestPointToPoint(r,n),o&&o.copy(r),l&&l.copy(n)),0;let c=a*a,u=s.min,h=s.max,d=this.points,f=1/0;for(let g=0;g<8;g++){let m=d[g];n.copy(m).clamp(u,h);let y=m.distanceToSquared(n);if(y<f&&(f=y,o&&o.copy(m),l&&l.copy(n),y<c))return Math.sqrt(y)}let p=0;for(let g=0;g<3;g++)for(let m=0;m<=1;m++)for(let y=0;y<=1;y++){let b=(g+1)%3,w=(g+2)%3,E=m<<b|y<<w,M=1<<g|m<<b|y<<w,A=d[E],P=d[M];e[p].set(A,P);let C=t[g],R=t[b],I=t[w],k=i[p],z=k.start,V=k.end;z[C]=u[C],z[R]=m?u[R]:h[R],z[I]=y?u[I]:h[R],V[C]=h[C],V[R]=m?u[R]:h[R],V[I]=y?u[I]:h[R],p++}for(let g=0;g<=1;g++)for(let m=0;m<=1;m++)for(let y=0;y<=1;y++){n.x=g?h.x:u.x,n.y=m?h.y:u.y,n.z=y?h.z:u.z,this.closestPointToPoint(n,r);let b=n.distanceToSquared(r);if(b<f&&(f=b,o&&o.copy(r),l&&l.copy(n),b<c))return Math.sqrt(b)}for(let g=0;g<12;g++){let m=e[g];for(let y=0;y<12;y++){let b=i[y];$G(m,b,r,n);let w=r.distanceToSquared(n);if(w<f&&(f=w,o&&o.copy(r),l&&l.copy(n),w<c))return Math.sqrt(w)}}return Math.sqrt(f)}})();var rw=new W,nw=new W,sw=new W,JP=new Ae,eR=new Ae,tR=new Ae,Aee=new W,Mee=new W,Tee=new W,iR=new W;function mnt(t,e,i,r,n,s){let a;return s===qa?a=t.intersectTriangle(r,i,e,!0,n):a=t.intersectTriangle(e,i,r,s!==jo,n),a===null?null:{distance:t.origin.distanceTo(n),point:n.clone()}}function gnt(t,e,i,r,n,s,a,o,l){rw.fromBufferAttribute(e,s),nw.fromBufferAttribute(e,a),sw.fromBufferAttribute(e,o);let c=mnt(t,rw,nw,sw,iR,l);if(c){r&&(JP.fromBufferAttribute(r,s),eR.fromBufferAttribute(r,a),tR.fromBufferAttribute(r,o),c.uv=vo.getInterpolation(iR,rw,nw,sw,JP,eR,tR,new Ae)),n&&(JP.fromBufferAttribute(n,s),eR.fromBufferAttribute(n,a),tR.fromBufferAttribute(n,o),c.uv1=vo.getInterpolation(iR,rw,nw,sw,JP,eR,tR,new Ae)),i&&(Aee.fromBufferAttribute(i,s),Mee.fromBufferAttribute(i,a),Tee.fromBufferAttribute(i,o),c.normal=vo.getInterpolation(iR,rw,nw,sw,Aee,Mee,Tee,new W),c.normal.dot(t.direction)>0&&c.normal.multiplyScalar(-1));let u={a:s,b:a,c:o,normal:new W,materialIndex:0};vo.getNormal(rw,nw,sw,u.normal),c.face=u,c.faceIndex=s}return c}function Lfe(t,e,i,r,n){let s=r*3,a=t.index.getX(s),o=t.index.getX(s+1),l=t.index.getX(s+2),{position:c,normal:u,uv:h,uv1:d}=t.attributes,f=gnt(i,c,u,h,d,a,o,l,e);return f?(f.faceIndex=r,n&&n.push(f),f):null}function vnt(t,e,i,r,n,s){for(let a=r,o=r+n;a<o;a++)Lfe(t,e,i,a,s)}function ynt(t,e,i,r,n){let s=1/0,a=null;for(let o=r,l=r+n;o<l;o++){let c=Lfe(t,e,i,o);c&&c.distance<s&&(a=c,s=c.distance)}return a}function _d(t,e,i,r){let n=t.a,s=t.b,a=t.c,o=e,l=e+1,c=e+2;i&&(o=i.getX(e),l=i.getX(e+1),c=i.getX(e+2)),n.x=r.getX(o),n.y=r.getY(o),n.z=r.getZ(o),s.x=r.getX(l),s.y=r.getY(l),s.z=r.getZ(l),a.x=r.getX(c),a.y=r.getY(c),a.z=r.getZ(c)}function Cee(t,e,i,r,n,s,a){let o=i.index,l=i.attributes.position;for(let c=t,u=e+t;c<u;c++)if(_d(a,c*3,o,l),a.needsUpdate=!0,r(a,c,n,s))return!0;return!1}var kfe=class{constructor(t){this._getNewPrimitive=t,this._primitives=[]}getPrimitive(){let t=this._primitives;return t.length===0?this._getNewPrimitive():t.pop()}releasePrimitive(t){this._primitives.push(t)}};function Eg(t,e){return e[t+15]===65535}function l1(t,e){return e[t+6]}function WM(t,e){return e[t+14]}function qM(t){return t+8}function XM(t,e){return e[t+6]}function xnt(t,e){return e[t+7]}var Zw=new Ss,D3=new W,bnt=["x","y","z"];function L5(t,e,i,r,n){let s=t*2,a=U_,o=Wg,l=qg;if(Eg(s,o)){let c=l1(t,l),u=WM(s,o);vnt(e,i,r,c,u,n)}else{let c=qM(t);O3(c,a,r,D3)&&L5(c,e,i,r,n);let u=XM(t,l);O3(u,a,r,D3)&&L5(u,e,i,r,n)}}function k5(t,e,i,r){let n=t*2,s=U_,a=Wg,o=qg;if(Eg(n,a)){let l=l1(t,o),c=WM(n,a);return ynt(e,i,r,l,c)}else{let l=xnt(t,o),c=bnt[l],u=r.direction[c]>=0,h,d;u?(h=qM(t),d=XM(t,o)):(h=XM(t,o),d=qM(t));let f=O3(h,s,r,D3)?k5(h,e,i,r):null;if(f){let g=f.point[c];if(u?g<=s[d+l]:g>=s[d+l+3])return f}let p=O3(d,s,r,D3)?k5(d,e,i,r):null;return f&&p?f.distance<=p.distance?f:p:f||p||null}}var wnt=(function(){let t,e,i=[],r=new kfe(()=>new Ss);return function(...s){t=r.getPrimitive(),e=r.getPrimitive(),i.push(t,e);let a=n(...s);r.releasePrimitive(t),r.releasePrimitive(e),i.pop(),i.pop();let o=i.length;return o>0&&(e=i[o-1],t=i[o-2]),a};function n(s,a,o,l,c=null,u=0,h=0){function d(b){let w=b*2,E=Wg,M=qg;for(;!Eg(w,E);)b=qM(b),w=b*2;return l1(b,M)}function f(b){let w=b*2,E=Wg,M=qg;for(;!Eg(w,E);)b=XM(b,M),w=b*2;return l1(b,M)+WM(w,E)}let p=s*2,g=U_,m=Wg,y=qg;if(Eg(p,m)){let b=l1(s,y),w=WM(p,m);return Td(s,g,t),l(b,w,!1,h,u+s,t)}else{let b=qM(s),w=XM(s,y),E=b,M=w,A,P,C,R;if(c&&(C=t,R=e,Td(E,g,C),Td(M,g,R),A=c(C),P=c(R),P<A)){E=w,M=b;let K=A;A=P,P=K,C=R}C||(C=t,Td(E,g,C));let I=Eg(E*2,m),k=o(C,I,A,h+1,u+E),z;if(k===2){let K=d(E),X=f(E)-K;z=l(K,X,!0,h+1,u+E,C)}else z=k&&n(E,a,o,l,c,u,h+1);if(z)return!0;R=e,Td(M,g,R);let V=Eg(M*2,m),F=o(R,V,P,h+1,u+M),$;if(F===2){let K=d(M),X=f(M)-K;$=l(K,X,!0,h+1,u+M,R)}else $=F&&n(M,a,o,l,c,u,h+1);return!!$}}})(),_nt=(function(){let t=new Zp,e=new Zp,i=new St,r=new rf,n=new rf;return function s(a,o,l,c,u=null){let h=a*2,d=U_,f=Wg,p=qg;if(u===null&&(l.boundingBox||l.computeBoundingBox(),r.set(l.boundingBox.min,l.boundingBox.max,c),u=r),Eg(h,f)){let g=o,m=g.index,y=g.attributes.position,b=l.index,w=l.attributes.position,E=l1(a,p),M=WM(h,f);if(i.copy(c).invert(),l.boundsTree)return Td(a,d,n),n.matrix.copy(i),n.needsUpdate=!0,l.boundsTree.shapecast({intersectsBounds:A=>n.intersectsBox(A),intersectsTriangle:A=>{A.a.applyMatrix4(c),A.b.applyMatrix4(c),A.c.applyMatrix4(c),A.needsUpdate=!0;for(let P=E*3,C=(M+E)*3;P<C;P+=3)if(_d(e,P,m,y),e.needsUpdate=!0,A.intersectsTriangle(e))return!0;return!1}});for(let A=E*3,P=M+E*3;A<P;A+=3){_d(t,A,m,y),t.a.applyMatrix4(i),t.b.applyMatrix4(i),t.c.applyMatrix4(i),t.needsUpdate=!0;for(let C=0,R=b.count;C<R;C+=3)if(_d(e,C,b,w),e.needsUpdate=!0,t.intersectsTriangle(e))return!0}}else{let g=a+8,m=p[a+6];return Td(g,d,Zw),!!(u.intersectsBox(Zw)&&s(g,o,l,c,u)||(Td(m,d,Zw),u.intersectsBox(Zw)&&s(m,o,l,c,u)))}}})();function O3(t,e,i,r){return Td(t,e,Zw),i.intersectBox(Zw,r)}var N5=[],cI,U_,Wg,qg;function XE(t){cI&&N5.push(cI),cI=t,U_=new Float32Array(t),Wg=new Uint16Array(t),qg=new Uint32Array(t)}function rR(){cI=null,U_=null,Wg=null,qg=null,N5.length&&XE(N5.pop())}var AF=Symbol("skip tree generation"),MF=new Ss,TF=new Ss,aw=new St,Cy=new rf,vE=new rf,yE=new W,nR=new W,Snt=new W,Ent=new W,Ant=new W,Pee=new Ss,sd=new kfe(()=>new Zp),LA=class{static serialize(t,e={}){if(e.isBufferGeometry)return console.warn("MeshBVH.serialize: The arguments for the function have changed. See documentation for new signature."),LA.serialize(arguments[0],{cloneBuffers:arguments[2]===void 0?!0:arguments[2]});e={cloneBuffers:!0,...e};let i=t.geometry,r=t._roots,n=i.getIndex(),s;return e.cloneBuffers?s={roots:r.map(a=>a.slice()),index:n.array.slice()}:s={roots:r,index:n.array},s}static deserialize(t,e,i={}){if(typeof i=="boolean")return console.warn("MeshBVH.deserialize: The arguments for the function have changed. See documentation for new signature."),LA.deserialize(arguments[0],arguments[1],{setIndex:arguments[2]===void 0?!0:arguments[2]});i={setIndex:!0,...i};let{index:r,roots:n}=t,s=new LA(e,{...i,[AF]:!0});if(s._roots=n,i.setIndex){let a=e.getIndex();if(a===null){let o=new Mi(t.index,1,!1);e.setIndex(o)}else a.array!==r&&(a.array.set(r),a.needsUpdate=!0)}return s}constructor(t,e={}){if(t.isBufferGeometry){if(t.index&&t.index.isInterleavedBufferAttribute)throw new Error("MeshBVH: InterleavedBufferAttribute is not supported for the index attribute.")}else throw new Error("MeshBVH: Only BufferGeometries are supported.");if(e=Object.assign({strategy:0,maxDepth:40,maxLeafTris:10,verbose:!0,useSharedArrayBuffer:!1,setBoundingBox:!0,onProgress:null,[AF]:!1},e),e.useSharedArrayBuffer&&typeof SharedArrayBuffer>"u")throw new Error("MeshBVH: SharedArrayBuffer is not available.");this._roots=null,e[AF]||(this._roots=hnt(t,e),!t.boundingBox&&e.setBoundingBox&&(t.boundingBox=this.getBoundingBox(new Ss))),this.geometry=t}refit(t=null){t&&Array.isArray(t)&&(t=new Set(t));let e=this.geometry,i=e.index.array,r=e.attributes.position,n,s,a,o,l=0,c=this._roots;for(let h=0,d=c.length;h<d;h++)n=c[h],s=new Uint32Array(n),a=new Uint16Array(n),o=new Float32Array(n),u(0,l),l+=n.byteLength;function u(h,d,f=!1){let p=h*2;if(a[p+15]===65535){let g=s[h+6],m=a[p+14],y=1/0,b=1/0,w=1/0,E=-1/0,M=-1/0,A=-1/0;for(let P=3*g,C=3*(g+m);P<C;P++){let R=i[P],I=r.getX(R),k=r.getY(R),z=r.getZ(R);I<y&&(y=I),I>E&&(E=I),k<b&&(b=k),k>M&&(M=k),z<w&&(w=z),z>A&&(A=z)}return o[h+0]!==y||o[h+1]!==b||o[h+2]!==w||o[h+3]!==E||o[h+4]!==M||o[h+5]!==A?(o[h+0]=y,o[h+1]=b,o[h+2]=w,o[h+3]=E,o[h+4]=M,o[h+5]=A,!0):!1}else{let g=h+8,m=s[h+6],y=g+d,b=m+d,w=f,E=!1,M=!1;t?w||(E=t.has(y),M=t.has(b),w=!E&&!M):(E=!0,M=!0);let A=w||E,P=w||M,C=!1;A&&(C=u(g,d,w));let R=!1;P&&(R=u(m,d,w));let I=C||R;if(I)for(let k=0;k<3;k++){let z=g+k,V=m+k,F=o[z],$=o[z+3],K=o[V],X=o[V+3];o[h+k]=F<K?F:K,o[h+k+3]=$>X?$:X}return I}}}traverse(t,e=0){let i=this._roots[e],r=new Uint32Array(i),n=new Uint16Array(i);s(0);function s(a,o=0){let l=a*2,c=n[l+15]===65535;if(c){let u=r[a+6],h=n[l+14];t(o,c,new Float32Array(i,a*4,6),u,h)}else{let u=a+8,h=r[a+6],d=r[a+7];t(o,c,new Float32Array(i,a*4,6),d)||(s(u,o+1),s(h,o+1))}}}raycast(t,e=Ih){let i=this._roots,r=this.geometry,n=[],s=e.isMaterial,a=Array.isArray(e),o=r.groups,l=s?e.side:e;for(let c=0,u=i.length;c<u;c++){let h=a?e[o[c].materialIndex].side:l,d=n.length;if(XE(i[c]),L5(0,r,h,t,n),rR(),a){let f=o[c].materialIndex;for(let p=d,g=n.length;p<g;p++)n[p].face.materialIndex=f}}return n}raycastFirst(t,e=Ih){let i=this._roots,r=this.geometry,n=e.isMaterial,s=Array.isArray(e),a=null,o=r.groups,l=n?e.side:e;for(let c=0,u=i.length;c<u;c++){let h=s?e[o[c].materialIndex].side:l;XE(i[c]);let d=k5(0,r,h,t);rR(),d!=null&&(a==null||d.distance<a.distance)&&(a=d,s&&(d.face.materialIndex=o[c].materialIndex))}return a}intersectsGeometry(t,e){let i=this.geometry,r=!1;for(let n of this._roots)if(XE(n),r=_nt(0,i,t,e),rR(),r)break;return r}shapecast(t,e,i){let r=this.geometry;if(t instanceof Function){if(e){let h=e;e=(d,f,p,g)=>{let m=f*3;return h(d,m,m+1,m+2,p,g)}}t={boundsTraverseOrder:i,intersectsBounds:t,intersectsTriangle:e,intersectsRange:null},console.warn("MeshBVH: Shapecast function signature has changed and now takes an object of callbacks as a second argument. See docs for new signature.")}let n=sd.getPrimitive(),{boundsTraverseOrder:s,intersectsBounds:a,intersectsRange:o,intersectsTriangle:l}=t;if(o&&l){let h=o;o=(d,f,p,g,m)=>h(d,f,p,g,m)?!0:Cee(d,f,r,l,p,g,n)}else o||(l?o=(h,d,f,p)=>Cee(h,d,r,l,f,p,n):o=(h,d,f)=>f);let c=!1,u=0;for(let h of this._roots){if(XE(h),c=wnt(0,r,a,o,s,u),rR(),c)break;u+=h.byteLength}return sd.releasePrimitive(n),c}bvhcast(t,e,i){let{intersectsRanges:r,intersectsTriangles:n}=i,s=this.geometry.index,a=this.geometry.attributes.position,o=t.geometry.index,l=t.geometry.attributes.position;aw.copy(e).invert();let c=sd.getPrimitive(),u=sd.getPrimitive();if(n){let d=function(f,p,g,m,y,b,w,E){for(let M=g,A=g+m;M<A;M++){_d(u,M*3,o,l),u.a.applyMatrix4(e),u.b.applyMatrix4(e),u.c.applyMatrix4(e),u.needsUpdate=!0;for(let P=f,C=f+p;P<C;P++)if(_d(c,P*3,s,a),c.needsUpdate=!0,n(c,u,P,M,y,b,w,E))return!0}return!1};if(r){let f=r;r=function(p,g,m,y,b,w,E,M){return f(p,g,m,y,b,w,E,M)?!0:d(p,g,m,y,b,w,E,M)}}else r=d}t.getBoundingBox(TF),TF.applyMatrix4(e);let h=this.shapecast({intersectsBounds:d=>TF.intersectsBox(d),intersectsRange:(d,f,p,g,m,y)=>(MF.copy(y),MF.applyMatrix4(aw),t.shapecast({intersectsBounds:b=>MF.intersectsBox(b),intersectsRange:(b,w,E,M,A)=>r(d,f,b,w,g,m,M,A)}))});return sd.releasePrimitive(c),sd.releasePrimitive(u),h}intersectsBox(t,e){return Cy.set(t.min,t.max,e),Cy.needsUpdate=!0,this.shapecast({intersectsBounds:i=>Cy.intersectsBox(i),intersectsTriangle:i=>Cy.intersectsTriangle(i)})}intersectsSphere(t){return this.shapecast({intersectsBounds:e=>t.intersectsBox(e),intersectsTriangle:e=>e.intersectsSphere(t)})}closestPointToGeometry(t,e,i={},r={},n=0,s=1/0){t.boundingBox||t.computeBoundingBox(),Cy.set(t.boundingBox.min,t.boundingBox.max,e),Cy.needsUpdate=!0;let a=this.geometry,o=a.attributes.position,l=a.index,c=t.attributes.position,u=t.index,h=sd.getPrimitive(),d=sd.getPrimitive(),f=nR,p=Snt,g=null,m=null;r&&(g=Ent,m=Ant);let y=1/0,b=null,w=null;return aw.copy(e).invert(),vE.matrix.copy(aw),this.shapecast({boundsTraverseOrder:E=>Cy.distanceToBox(E),intersectsBounds:(E,M,A)=>A<y&&A<s?(M&&(vE.min.copy(E.min),vE.max.copy(E.max),vE.needsUpdate=!0),!0):!1,intersectsRange:(E,M)=>{if(t.boundsTree)return t.boundsTree.shapecast({boundsTraverseOrder:A=>vE.distanceToBox(A),intersectsBounds:(A,P,C)=>C<y&&C<s,intersectsRange:(A,P)=>{for(let C=A*3,R=(A+P)*3;C<R;C+=3){_d(d,C,u,c),d.a.applyMatrix4(e),d.b.applyMatrix4(e),d.c.applyMatrix4(e),d.needsUpdate=!0;for(let I=E*3,k=(E+M)*3;I<k;I+=3){_d(h,I,l,o),h.needsUpdate=!0;let z=h.distanceToTriangle(d,f,g);if(z<y&&(p.copy(f),m&&m.copy(g),y=z,b=I/3,w=C/3),z<n)return!0}}}});{let A=u?u.count:c.count;for(let P=0,C=A;P<C;P+=3){_d(d,P,u,c),d.a.applyMatrix4(e),d.b.applyMatrix4(e),d.c.applyMatrix4(e),d.needsUpdate=!0;for(let R=E*3,I=(E+M)*3;R<I;R+=3){_d(h,R,l,o),h.needsUpdate=!0;let k=h.distanceToTriangle(d,f,g);if(k<y&&(p.copy(f),m&&m.copy(g),y=k,b=R/3,w=P/3),k<n)return!0}}}}}),sd.releasePrimitive(h),sd.releasePrimitive(d),y===1/0?null:(i.point?i.point.copy(p):i.point=p.clone(),i.distance=y,i.faceIndex=b,r&&(r.point?r.point.copy(m):r.point=m.clone(),r.point.applyMatrix4(aw),p.applyMatrix4(aw),r.distance=p.sub(r.point).length(),r.faceIndex=w),i)}closestPointToPoint(t,e={},i=0,r=1/0){let n=i*i,s=r*r,a=1/0,o=null;if(this.shapecast({boundsTraverseOrder:c=>(yE.copy(t).clamp(c.min,c.max),yE.distanceToSquared(t)),intersectsBounds:(c,u,h)=>h<a&&h<s,intersectsTriangle:(c,u)=>{c.closestPointToPoint(t,yE);let h=t.distanceToSquared(yE);return h<a&&(nR.copy(yE),a=h,o=u),h<n}}),a===1/0)return null;let l=Math.sqrt(a);return e.point?e.point.copy(nR):e.point=nR.clone(),e.distance=l,e.faceIndex=o,e}getBoundingBox(t){return t.makeEmpty(),this._roots.forEach(e=>{Td(0,new Float32Array(e),Pee),t.union(Pee)}),t}},U5=gv(jVe()),Mnt=.5*(Math.sqrt(3)-1),xE=(3-Math.sqrt(3))/6,Tnt=1/3,ad=1/6,kA=t=>Math.floor(t)|0,Ree=new Float64Array([1,1,-1,1,1,-1,-1,-1,1,0,-1,0,1,0,-1,0,0,1,0,-1,0,1,0,-1]),CF=new Float64Array([1,1,0,-1,1,0,1,-1,0,-1,-1,0,1,0,1,-1,0,1,1,0,-1,-1,0,-1,0,1,1,0,-1,1,0,1,-1,0,-1,-1]);function Cnt(t=Math.random){let e=Nfe(t),i=new Float64Array(e).map(n=>Ree[n%12*2]),r=new Float64Array(e).map(n=>Ree[n%12*2+1]);return function(n,s){let a=0,o=0,l=0,c=(n+s)*Mnt,u=kA(n+c),h=kA(s+c),d=(u+h)*xE,f=u-d,p=h-d,g=n-f,m=s-p,y,b;g>m?(y=1,b=0):(y=0,b=1);let w=g-y+xE,E=m-b+xE,M=g-1+2*xE,A=m-1+2*xE,P=u&255,C=h&255,R=.5-g*g-m*m;if(R>=0){let z=P+e[C],V=i[z],F=r[z];R*=R,a=R*R*(V*g+F*m)}let I=.5-w*w-E*E;if(I>=0){let z=P+y+e[C+b],V=i[z],F=r[z];I*=I,o=I*I*(V*w+F*E)}let k=.5-M*M-A*A;if(k>=0){let z=P+1+e[C+1],V=i[z],F=r[z];k*=k,l=k*k*(V*M+F*A)}return 70*(a+o+l)}}function Pnt(t=Math.random){let e=Nfe(t),i=new Float64Array(e).map(s=>CF[s%12*3]),r=new Float64Array(e).map(s=>CF[s%12*3+1]),n=new Float64Array(e).map(s=>CF[s%12*3+2]);return function(s,a,o){let l,c,u,h,d=(s+a+o)*Tnt,f=kA(s+d),p=kA(a+d),g=kA(o+d),m=(f+p+g)*ad,y=f-m,b=p-m,w=g-m,E=s-y,M=a-b,A=o-w,P,C,R,I,k,z;E>=M?M>=A?(P=1,C=0,R=0,I=1,k=1,z=0):E>=A?(P=1,C=0,R=0,I=1,k=0,z=1):(P=0,C=0,R=1,I=1,k=0,z=1):M<A?(P=0,C=0,R=1,I=0,k=1,z=1):E<A?(P=0,C=1,R=0,I=0,k=1,z=1):(P=0,C=1,R=0,I=1,k=1,z=0);let V=E-P+ad,F=M-C+ad,$=A-R+ad,K=E-I+2*ad,X=M-k+2*ad,U=A-z+2*ad,Y=E-1+3*ad,Z=M-1+3*ad,j=A-1+3*ad,ee=f&255,pe=p&255,fe=g&255,se=.6-E*E-M*M-A*A;if(se<0)l=0;else{let ve=ee+e[pe+e[fe]];se*=se,l=se*se*(i[ve]*E+r[ve]*M+n[ve]*A)}let re=.6-V*V-F*F-$*$;if(re<0)c=0;else{let ve=ee+P+e[pe+C+e[fe+R]];re*=re,c=re*re*(i[ve]*V+r[ve]*F+n[ve]*$)}let le=.6-K*K-X*X-U*U;if(le<0)u=0;else{let ve=ee+I+e[pe+k+e[fe+z]];le*=le,u=le*le*(i[ve]*K+r[ve]*X+n[ve]*U)}let he=.6-Y*Y-Z*Z-j*j;if(he<0)h=0;else{let ve=ee+1+e[pe+1+e[fe+1]];he*=he,h=he*he*(i[ve]*Y+r[ve]*Z+n[ve]*j)}return 32*(l+c+u+h)}}function Nfe(t){let e=new Uint8Array(512);for(let i=0;i<512/2;i++)e[i]=i;for(let i=0;i<512/2-1;i++){let r=i+~~(t()*(256-i)),n=e[i];e[i]=e[r],e[r]=n}for(let i=256;i<512;i++)e[i]=e[i-256];return e}var nh=new vo,Rnt=class{constructor(t){this.weightAttribute=null;let e=t.geometry;if(!e.isBufferGeometry||e.attributes.position.itemSize!==3)throw new Error("THREE.MeshSurfaceSampler: Requires BufferGeometry triangle mesh.");e.index&&(e=e.toNonIndexed()),this.geometry=e,this.randomFunction=Math.random,this.positionAttribute=this.geometry.getAttribute("position"),this.distribution=null}build(){let t=this.positionAttribute,e=new Float32Array(t.count/3);for(let r=0;r<t.count;r+=3){let n=1;nh.a.fromBufferAttribute(t,r),nh.b.fromBufferAttribute(t,r+1),nh.c.fromBufferAttribute(t,r+2),n*=nh.getArea(),e[r/3]=n}this.distribution=new Float32Array(t.count/3);let i=0;for(let r=0;r<e.length;r++)i+=e[r],this.distribution[r]=i;return this}setRandomGenerator(t){return this.randomFunction=t,this}sample(t,e){if(this.distribution){let i=this.distribution[this.distribution.length-1],r=this.binarySearch(this.randomFunction()*i);return this.sampleFace(r,t,e)}}binarySearch(t){if(!this.distribution)return 0;let e=this.distribution,i=0,r=e.length-1,n=-1;for(;i<=r;){let s=Math.ceil((i+r)/2);if(s===0||e[s-1]<=t&&e[s]>t){n=s;break}else t<e[s]?r=s-1:i=s+1}return n}sampleFace(t,e,i){let r=this.randomFunction(),n=this.randomFunction();return r+n>1&&(r=1-r,n=1-n),nh.a.fromBufferAttribute(this.positionAttribute,t*3),nh.b.fromBufferAttribute(this.positionAttribute,t*3+1),nh.c.fromBufferAttribute(this.positionAttribute,t*3+2),e.set(0,0,0).addScaledVector(nh.a,r).addScaledVector(nh.b,n).addScaledVector(nh.c,1-(r+n)),nh.getNormal(i),this}},Int=gv(Yue()),Dnt=new St,Ont=new St,Lnt=new St,F0;(t=>{function e(i){return i&&i.__isSPEObject}t.is=e})(F0||(F0={}));var YG=t=>class extends t{constructor(){super(...arguments),this.previousModelViewMatrix=new St,this.copyPreviousMatrix=!0,this.hiddenMatrix=new St,this.matrixWorldRigid=new St,this.shearScale=new St,this.shearScaleInv=new St}get __isSPEObject(){return!0}isDescendantOf(e){e instanceof tn&&(e=e.uuid);let i=this;for(;i.parent;){if(i.parent.uuid===e)return!0;i=i.parent}return!1}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(this.parent===null?this.matrixWorld.multiplyMatrices(this.hiddenMatrix,this.matrix):(this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.hiddenMatrix),this.matrixWorld.multiplyMatrices(this.matrixWorld,this.matrix)),this.matrixWorldNeedsUpdate=!1,e=!0);for(let i of this.children)i.updateMatrixWorld(e)}updateWorldMatrix(e,i){let r=this.parent;if(e&&r!==null&&r.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.parent===null?this.matrixWorld.multiplyMatrices(this.hiddenMatrix,this.matrix):(this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.hiddenMatrix),this.matrixWorld.multiplyMatrices(this.matrixWorld,this.matrix)),i)for(let n of this.children)n.updateWorldMatrix(!1,!0)}traverseChildren(e,i=0){for(let r of this.children)F0.is(r)&&r.traverseObject(e,i+1)}traverseObject(e,i=0){if(e(this,i)!==!0)for(let r of this.children)F0.is(r)&&r.traverseObject(e,i+1)}updateMatrixWorldSVD(){let e=this.matrixWorld.elements,i=[[e[0],e[4],e[8]],[e[1],e[5],e[9]],[e[2],e[6],e[10]]],{u:r,v:n,q:s}=(0,Int.SVD)(i),a=Dnt.set(r[0][0],r[0][1],r[0][2],0,r[1][0],r[1][1],r[1][2],0,r[2][0],r[2][1],r[2][2],0,0,0,0,1),o=Ont.set(n[0][0],n[0][1],n[0][2],0,n[1][0],n[1][1],n[1][2],0,n[2][0],n[2][1],n[2][2],0,0,0,0,1),l=Lnt.copy(o).transpose();this.shearScale.makeScale(s[0],s[1],s[2]).multiply(l).premultiply(o),this.shearScaleInv.copy(this.shearScale).invert(),this.matrixWorldRigid.multiplyMatrices(a,l).copyPosition(this.matrixWorld),s.every(c=>Math.abs(s[0]-c)<.01)?this.hasNonUniformScale=!1:this.hasNonUniformScale=!0}attach(e,i){this.updateWorldMatrix(!0,!1);let r=new St().copy(this.matrixWorld).invert();return e.parent!==null&&(e.parent.updateWorldMatrix(!0,!1),r.multiply(e.parent.matrixWorld)),"hiddenMatrix"in e&&e.hiddenMatrix instanceof St?e.hiddenMatrix.premultiply(r):e.applyMatrix4(r),e.updateWorldMatrix(!1,!1),this.add(e),i!==void 0&&(this.children.pop(),this.children.splice(i,0,e)),this}copy(e,i=!1){return super.copy(e,i),this.hasNonUniformScale=e.hasNonUniformScale,this}onAfterRender(e,i,r,n,s,a){this.copyPreviousMatrix&&this.previousModelViewMatrix.copy(this.modelViewMatrix)}},knt=class extends YG(tn){},Nnt=t=>t.type==="Mesh",bo=class extends knt{constructor(t){super(),this.object=t,this.matrixAutoUpdate=!1,this.hasNonUniformScale=t.hasNonUniformScale}raycast(t,e){}expand(){let t=0,e=this.object.entityChildren(t);for(;e;){let i=this.children[t];i?.object!==e&&(i&&this.remove(i),i=new bo(e),this.add(i),this.children.splice(t,0,this.children.pop()),i.matrixWorldNeedsUpdate=!0,i.matrixAutoUpdate=!1,i.matrix=e.matrix,i.hiddenMatrix=e.hiddenMatrix),i.expand(),t+=1,e=this.object.entityChildren(t)}for(;this.children.length>t;)this.remove(this.children[t])}get visible(){return this.playModeVisible!==void 0?this.playModeVisible:this.object.visible||this.object.dataPatched.visible&&this.object.dataPatched.cloner?.hideBase===!0}set visible(t){}get castShadow(){return this.object.castShadow}set castShadow(t){}get receiveShadow(){return this.object.receiveShadow}set receiveShadow(t){}get isMesh(){return Nnt(this.object)}get isLight(){return this.object.isLight}get layers(){return this.object.layers}set layers(t){}get isCamera(){return!1}get geometry(){if(this.object.geometry)return this.object.geometry}get material(){if(this.object.material)return this.object.material}get morphTargetInfluences(){if(this.object.morphTargetInfluences)return this.object.morphTargetInfluences}set morphTargetInfluences(t){}},Hy=new W,Gy=new W,c1=new St,Ufe=[new W(-1,1,1),new W(-1,-1,1),new W(1,-1,1),new W(1,1,1),new W(-1,1,-1),new W(-1,-1,-1),new W(1,-1,-1),new W(1,1,-1)],Unt=[[0,3],[1,2],[5,6],[4,7],[0,1],[3,2],[7,6],[4,5],[0,4],[1,5],[2,6],[3,7]],Bnt=[[0,2],[7,5],[4,1],[3,6],[4,3],[1,6]],Iee=(t,e,i)=>{t.updateEntityBoxSize(Hy,Gy),c1.copy(e).multiply(t.matrixWorld),Gy.x===0&&Gy.y===0&&Gy.z===0?i.push(new W(Hy.x,Hy.y,Hy.z).applyMatrix4(c1)):Ufe.forEach(r=>{i.push(r.clone().multiply(Gy).add(Hy).applyMatrix4(c1))})},Dee=class extends Ss{constructor(){super(...arguments),this.matrix=new St,this.vertices=[],this.faces=[],this.edges=[],this.centerEdges=[]}copy(t){return super.copy(t),this.matrix.copy(t.matrix),this.vertices=t.vertices.map(e=>e.clone()),this.faces=t.faces.map(e=>e.clone()),this.edges=t.edges.map(e=>e.clone()),this.centerEdges=t.centerEdges.map(e=>e.clone()),this}setFromObjectSize(t,e=!1){t.updateWorldMatrix(!1,e),this.makeEmpty(),this.matrix.copy(t.matrixWorld);let i=new St().copy(t.matrixWorld).invert();return this.expandByObjectSize(t,i,e)}expandByObjectSize(t,e,i=!1){let r=[];return i===!0?t.traverseEntity(n=>{if(n.visible||n.cloner&&n.data.visible){if(!("geometry"in n)){r.push(new W);return}Iee(n,e,r)}}):Iee(t,e,r),this.setFromPoints(r)}getCenter(t){return t=super.getCenter(t),t.applyMatrix4(this.matrix),t}getPositionToCenter(t){return t=super.getCenter(t),t.applyMatrix4(c1.copy(this.matrix).setPosition(0,0,0)),t}computeVertices(){this.getSize(Gy).multiplyScalar(.5),this.getCenter(Hy),c1.copy(this.matrix).setPosition(Hy),this.vertices=Ufe.map(t=>t.clone().multiply(Gy).applyMatrix4(c1))}computeEdges(){this.vertices.length>0&&this.computeVertices(),this.edges=Unt.map(([t,e])=>new xu(this.vertices[t],this.vertices[e])),this.centerEdges=this.edges.map(t=>t.getCenter(new W))}computeFaces(){this.vertices.length>0&&this.computeVertices(),this.faces=Bnt.map(([t,e])=>this.vertices[t].clone().add(this.vertices[e]).multiplyScalar(.5))}},Lg={Cloner:()=>{},changeEntityProptotype:()=>{},createEntity:()=>{}},Fnt=class extends Ahe{constructor(){super()}getPoints(t=12){let e=[],i,r=this.getCurveLengths(),n=r[r.length-1]/r.length;for(let s=0,a=this.curves;s<a.length;s++){let o=a[s],l=s===0?r[s]:r[s]-r[s-1],c=Math.ceil(t*l/n),u=o.getPoints(c);for(let h=0;h<u.length;h++){let d=u[h];i&&i.equals(d)||(e.push(d),i=d)}}return this.autoClose&&e.length>1&&!e[e.length-1].equals(e[0])&&e.push(e[0]),e}},B5=.001;function F5(t,e,i){return e.clone().sub(t).cross(e.clone().sub(i)).length()<=B5}function PF(t,e){let i=new W(...t.position),r=new W(...t.controlNext.position),n=new W(...e.controlPrevious.position),s=new W(...e.position);return F5(i,r,s)&&F5(i,n,s)}function Bfe(t){let e=t.points.map(u=>new W(...u.data.position)),i=[t.points[0]],r=new W(...i[0].data.position);for(let u=0;u<t.points.length-1;u++)F5(r,e[u],e[u+1])||(i.push(t.points[u]),r=e[u]);i.push(t.points[t.points.length-1]);let n=t.isClosed,s=i.length-(n?0:1),a=i.length,o=[];for(let u=0;u<a;u++){let h=i[u].data,d=new W(...h.position),f=new W(...h.controlPrevious.position),p=new W(...h.controlNext.position),g={position:d,baseRoundness:h.roundness,controlPrevious:f,controlNext:p};if(h.roundness===0||!t.isClosed&&(u===0||u===a-1)){o[u]={...g,removedLength:0};continue}let m=n&&u==0?a-1:u-1,y=n&&u==a-1?0:u+1,b=i[m].data,w=i[y].data,E=new W(...b.position),M=new W(...w.position),A=E.clone().sub(d).normalize(),P=M.clone().sub(d).normalize();Object.assign(g,{prevDir:A,nextDir:P});let C=PF(b,h),R=PF(h,w);if(!C||!R)o[u]={...g,removedLength:0};else{let I=A.clone().add(P).normalize(),k=I.clone().cross(A).length()/A.dot(I);o[u]={...g,tan:k,removedLength:h.roundness/k}}}for(let u=0;u<s;u++){let h=u,d=n&&u===a-1?0:u+1,f=o[h],p=o[d];if(f.removedLength!==0||p.removedLength!==0){let g=f.position.distanceTo(p.position);f.removedLength=Math.min(f.removedLength,g/2),p.removedLength=Math.min(p.removedLength,g/2)}}let l=[];for(let u=0;u<s;u++){let h=u,d=n&&u===a-1?0:u+1,f=o[h],p=o[d],g=null;if(!PF(i[h].data,i[d].data))f.position.distanceTo(p.position)>B5&&(g=new nI(f.position,f.controlNext,p.controlPrevious,p.position));else{let m=f.position.clone(),y=p.position.clone();(f.removedLength!==0||p.removedLength!==0)&&(f.nextDir&&m.add(f.nextDir.clone().setLength(f.removedLength)),p.prevDir&&y.add(p.prevDir.clone().setLength(p.removedLength))),m.distanceTo(y)>B5&&(g=new nI(m,m.clone().lerp(y,.3),y.clone().lerp(m,.3),y))}l[2*u+1]=g}for(let u=0;u<a;u++){let h=o[u];if(h.removedLength===0){l[2*u]=null;continue}let d=h.position,f=h.prevDir.clone().multiplyScalar(h.removedLength).add(d),p=h.nextDir.clone().multiplyScalar(h.removedLength).add(d),g=h.tan*h.removedLength,m=h.prevDir.clone().add(h.nextDir).normalize(),y=f.clone().lerp(p,.5),b=f.distanceTo(p)/2,w=m.clone().multiplyScalar(Math.sqrt(Math.pow(g,2)-Math.pow(b,2))).add(y),E=m.clone().multiplyScalar(-g).add(w),M=d.distanceTo(E)/d.distanceTo(y),A=h.prevDir.clone().multiplyScalar(M*d.distanceTo(f)).add(d),P=A.clone().lerp(E,2),C=f.clone().lerp(A,4/3),R=p.clone().lerp(P,4/3);l[2*u]=new nI(f,C,R,p)}let c=new Fnt;return l.forEach(u=>{u&&c.add(u)}),c}var Er;(t=>{function e(i){return i&&i.__isEntity}t.is=e})(Er||(Er={}));var gp=t=>Er.is(t),znt={type:"completeState",isfromEntity:!0},jnt=["x","y","z"],RF=new W,Vnt=new W().set(0,1,0),KG=t=>class extends YG(t){constructor(){super(...arguments),this.raycastLock=!1,this.scaleLock=!1,this.disposed=!1,this.stateSelection=null,this.destroyedInAction=!1,this.instances=[],this.prevState=null,this.currentState=null,this.currentAnimationAction=null,this.reversibleToState=null,this.currentTransitionEvent=null,this.previousAction=null,this._singleBBox=new Dee,this._recursiveBBox=new Dee,this.singleBBoxNeedsUpdate=!0,this.recursiveBBoxNeedsUpdate=!0,this._needApplyPathSnapping=!0,this.attachedPaths=new Set}get __isEntity(){return!0}entityChildren(e){let i=this.children[e];if(Er.is(i))return i}entityChildrenCount(){let e=this.children.length;for(;e--;)if(Er.is(this.children[e]))return e+1;return 0}get isConcreteEntity(){return typeof this.identity=="string"}get isVirtualEntity(){return typeof this.identity!="string"}get isInstanceRoot(){return this.isConcreteEntity&&this.data.type==="Instance"}nearestInstanceSelfOrParent(){let e=this;for(;e.data.type!=="Instance";){let i=e.parent;if(Er.is(i))e=i;else return}return e}forInstancesRec(e){this.instances.forEach(i=>{i.disposed||e(i),i.forInstancesRec(e)})}super_Entity(e,i){typeof e=="string"&&(this.uuid=e),this.identity=e,this.data=i,this.matrixAutoUpdate=!1,this.dataPatched=this.data}changeSelectedState(e,i,r=!1){if(!(this.data.states.length===0&&!r)){for(let n of this.data.states)Og.toOps(this.data,n.data).forEach(s=>{let a=o3.replaceProps(s,this.data);this.dataPatched=this.data,this.updateByPatchedOp(a,this.data,i)});if(e!==null){let n=this.data.states.data(e);n&&(this.dataPatched=Og.patch(this.data,n),Og.toOps(this.data,n).forEach(s=>{this.updateByPatchedOp(s,this.dataPatched,i)}))}r&&this.updateTransformState(this.dataPatched,i),this.stateSelection=e,this.updatePathSnapping(this.dataPatched.pathSnapping)}}get singleBBox(){return this.singleBBoxNeedsUpdate&&(this.singleBBoxNeedsUpdate=!1,this._singleBBox.setFromObjectSize(this,!1),this._singleBBox.computeVertices(),this._singleBBox.computeEdges(),this._singleBBox.computeFaces()),this._singleBBox}get recursiveBBox(){return this.recursiveBBoxNeedsUpdate&&(this.recursiveBBoxNeedsUpdate=!1,this._recursiveBBox.setFromObjectSize(this,!0),this._recursiveBBox.computeVertices(),this._recursiveBBox.computeEdges(),this._recursiveBBox.computeFaces()),this._recursiveBBox}updateEntityBoxSize(e,i){e.setScalar(0),i.setScalar(0)}resetBBoxNeedsUpdateSelf(){this.singleBBoxNeedsUpdate=!0,this.recursiveBBoxNeedsUpdate=!0}resetBBoxNeedsUpdate(){this.resetBBoxNeedsUpdateSelf(),this.traverseAncestors(e=>{gp(e)&&e.resetBBoxNeedsUpdateSelf()}),this.traverseEntity(e=>{e.resetBBoxNeedsUpdateSelf()})}find(e){let i;return this.traverseEntity(r=>{r.uuid===e&&(i=r)}),i}traverseSortNextHelper(){let e=this.parent;if(e){let i=e.children,r=i.indexOf(this)+1;if(Er.is(i[r]))return i[r];if(Er.is(e))return e.traverseSortNextHelper()}}sortNext(){let e=this.children;return this.children.length>0&&Er.is(this.children[0])?e[0]:this.traverseSortNextHelper()}goUp(e){let i=this;for(;e>0&&i!==null;)i=i.parent,e-=1;return i}hasAnccestorOrSelf(e){return this===e||this.hasAnccestor(e)}hasAnccestor(e){let i=this.parent;for(;i;){if(e===i)return!0;i=i.parent}return!1}countToAccestor(e){let i=0,r=this;for(;r!==e;){if(r===null)return-1;r=r.parent,i+=1}return i}forEachEntity(e){for(let i of this.children)gp(i)&&e(i)}traverseEntityAncestors(e){this.traverseAncestors(i=>{Er.is(i)&&e(i)})}traverseConcreteEntity(e,i=0){if(e(this,i)!==!0)for(let r of this.children)gp(r)&&r.isConcreteEntity&&r.traverseEntity(e,i+1)}traverseEntity(e,i=0){if(e(this,i)!==!0)for(let r of this.children)gp(r)&&r.traverseEntity(e,i+1)}traverseVisibleEntity(e){e(this);for(let i of this.children)gp(i)&&i.visible&&i.traverseVisibleEntity(e)}updateMatrix(){super.updateMatrix(),this.cloner&&this.cloner.onObjUpdateMatrix(),this.dispatchEvent({type:"updateMatrix"})}updateMatrixWorld(e){super.updateMatrixWorld(e),this.dispatchEvent({type:"updateMatrixWorld"})}copy(e,i=!1){return super.copy(e,i),this.dataPatched=e.dataPatched,this.raycastLock=e.raycastLock,this.scaleLock=e.scaleLock,this.hiddenMatrix.copy(e.hiddenMatrix),this}hasEntityChild(){return this.children.some(e=>gp(e))}isAncestorOf(e){if(this.uuid===e)return!1;let i=!1;return this.traverseEntity(r=>{r.uuid===e&&(i=!0)}),i}toObjectTransformState(e=[]){this.updateWorldMatrix(!0,!1);let i={position:this.position.toArray(),rotation:[this.rotation.x*Ht.RAD2DEG,this.rotation.y*Ht.RAD2DEG,this.rotation.z*Ht.RAD2DEG],scale:this.scale.toArray(),hiddenMatrix:this.hiddenMatrix.toArray()};return Hj(i,e)}getTransformValues(e,i,r){return i[e].map((n,s)=>r?.shared.getVariable(n,[this.uuid,e,jnt[s]])??n)}updateTransformState(e,i){let r=!1;return e.position&&(this.position.fromArray(this.getTransformValues("position",e,i)),r=!0),e.rotation&&(RF.fromArray(this.getTransformValues("rotation",e,i)).multiplyScalar(Ht.DEG2RAD),this.rotation.setFromVector3(RF),r=!0),e.scale&&(this.scale.fromArray(this.getTransformValues("scale",e,i)),r=!0),e.hiddenMatrix!==void 0&&(r=!0,this.hiddenMatrix.fromArray(e.hiddenMatrix??X1.identity)),r&&(this.updateMatrix(),this.resetBBoxNeedsUpdate(),this.invalidateClonerTransform(this),this.traverseEntityAncestors(n=>{n.invalidateClonerTransform(this)})),e.position&&e.rotation&&e.scale&&e.hiddenMatrix!==void 0&&this.updateWorldMatrix(!1,!0),r}onVariableUpdate(e=!1){if(e){this.resetBBoxNeedsUpdate();return}this.updateMatrix(),this.resetBBoxNeedsUpdate(),this.invalidateClonerTransform(this),this.traverseEntityAncestors(i=>{i.invalidateClonerTransform(this)})}dispose(){this.disposed=!0,this.cloner&&(this.cloner.removeFromParent(),this.cloner=void 0)}disposeChildrenRecursively(){for(let e of this.children)Er.is(e)&&e.disposeRecursively()}disposeRecursively(){this.dispose(),this.children.forEach(e=>{Er.is(e)&&e.disposeRecursively()})}toState(e=[]){let i={name:this.name,visible:this.visible,raycastLock:this.raycastLock,...this.toObjectTransformState(e)};return Hj(i,e)}updateByObjUpdateOp(e,i){e!==void 0&&this.updateByOp({type:0,props:e,path:[]},{...this.data,...e},i,!1)}updateByOp(e,i,r,n){let s=this.data;this.data=i;let a=e,o=yn(e.path,["states","*"]);if(o!==null){if(e.type===0){let[l]=o;if(this?.stateSelection===l){let c={...e.props};if(delete c.name,Object.values(e.props).some(u=>u===void 0)){let u=this.data;if(u!==void 0){let h=fa.zoom(u,e.path.slice(2));if(h)for(let d in e.props)e.props[d]===void 0&&d in h&&(c[d]=h[d])}}a={...e,props:c,path:e.path.slice(2)}}}}else if(e.type===0){let l=this.stateSelection?this.data.states.data(this.stateSelection):void 0;if(l!==void 0){if(e.props.name!==void 0&&l.name){let{name:u,...h}=l;l=h}if(e.props.material!==void 0&&"material"in l){let{material:u,...h}=l;l=h}let c=fa.removeOverridden(e.path,e.props,l);a={...e,props:c}}}if(this.updateByPatchedOpBase(a,Og.patch(this.data,this.stateSelection?this.data.states.data(this.stateSelection):void 0),r),yn(e.path,["overrides"])){let l=[],c=[...e.path];for(l.push(c[1]),c.splice(0,2);c.length>0&&c[0]==="descendants";)l.push(c[1]),c.splice(0,2);if(l[l.length-1]===void 0){if(e.type===0)for(let u of Object.keys(e.props)){l[l.length-1]=u;let h=r.scene.findInstance([this.uuid,...l]);h&&(h.overrideData=e.props[u],h.updateState(jg.apply(h.component.data,h.overrideData),r))}}else{let u=r.scene.findInstance([this.uuid,...l]);if(u){let h=fa.zoom(u.component.data,c);if(e={...e,path:c},e.type===0){let d=e.props;if(h)for(let[f,p]of Object.entries(e.props))p===void 0&&(d===e.props&&(d={...e.props}),d[f]=h[f]);e={...e,props:d}}u.overrideData=b3.resolve(i.overrides,l),u.updateByOp(e,Ha.applySimple(u.data,e),r,!1)}}}else if(this.instances.length>0){let l;if(e.path.length===0&&e.type===0){let c;for(let u of Dg.rootOverrideProps)u in e.props&&(c===void 0&&(c={}),c[u]=e.props[u]);c&&(l={...e,props:c})}else for(let c of Dg.rootOverrideProps)if(yn(e.path,[c])){l=e;break}l!==void 0&&this.instances.forEach(c=>{if(c.isInstanceRoot){let u=jg.filterOp(c.overrideData,l);u&&c.updateByOp(u,Ha.applySimple(c.data,u),r,!0)}}),this.instances.forEach(c=>{if(!c.isInstanceRoot){let u=jg.filterOp(c.overrideData,e);if(u){let h;s===c.data&&e===u?h=i:h=Ha.applySimple(c.data,u),c.updateByOp(u,h,r,!0)}}})}}updateByPatchedOpBase(e,i,r){if(this.dataPatched=i,e.path.length===0&&e.type===0)e.props.type!==void 0&&!B0.is(e.props.type)&&Lg.changeEntityProptotype(this,i,r);else if(e.path.length===1&&e.path[0]==="geometry"&&e.type===0&&"type"in e.props){Lg.changeEntityProptotype(this,i,r);for(let n of this.children)Er.is(n)&&n.updateVisible(r.scene)}this.updateByPatchedOp(e,i,r)}updateByPatchedOp(e,i,r){if(e.path.length===0&&e.type===0?this.updateState(e.props,r):e.type===0&&("resolutionLevel"in e.props||"useChildrenColors"in e.props)&&this.updateState(i,r),e.path[0]==="morphTargetInfluences"&&e.type===0){let n=i.morphTargetInfluences.get(e.path[1])?.data.name;n&&this.updateMorphInfluences(n,r.shared.getVariable(e.props.value,[this.uuid,"morphTargetInfluences",n]))}if(yn(e.path,["pathSnapping"])!==null&&this.updatePathSnapping(i.pathSnapping),yn(e.path,["cloner"])!==null){let n=Ha.drop(e,1);n.path.length===0&&n.type===0&&n.props.disabled===!0?this.setFromClonerState(null,r):this.cloner?this.cloner.updateState(i.cloner,r.scene):(this.setFromClonerState(i.cloner,r),this.expandCloner(r.scene)),this.updateVisible(r.scene)}}updatePathSnapping(e=this.dataPatched.pathSnapping){this._updatedPathSnapping=e,this._needApplyPathSnapping=!0}get updatedPathSnapping(){return this._updatedPathSnapping}applyPathSnapping(e){let i=this._updatedPathSnapping?.pathId??this.dataPatched.pathSnapping.pathId,r=this._updatedPathSnapping?.slide??this.dataPatched.pathSnapping.slide??0,n=this._updatedPathSnapping?.offset??this.dataPatched.pathSnapping.offset??0,s=this._updatedPathSnapping?.orientation??this.dataPatched.pathSnapping.orientation;if(i===null)return;let a=e.find(i);if(!a||this._needApplyPathSnapping===!1)return;this._needApplyPathSnapping=!1;let o=a.data;if(o.geometry.path.points.length<=1)return;let l=Bfe(o.geometry.path),c=(r+n)%1;r+n===1&&c===0&&(c=1);let u=null;try{u=l.curves.length?l.getPointAt(c):null}catch{}if(u===null)return;let h=this.parent?this.parent?.matrixWorld:new St;a.updateMatrixWorld();let d=new St().multiplyMatrices(h.clone().invert(),a.matrixWorld);u.applyMatrix4(d);let f={position:u.toArray(),rotation:o.rotation};if(s==="tangential"){let p=new St().extractRotation(a.matrixWorld),g=l.getTangentAt(c).applyMatrix4(p).add(u),m=new St().lookAt(u,g,Vnt),y=RF.setFromEuler(new xs().setFromRotationMatrix(m)).multiplyScalar(Ht.RAD2DEG);f={...f,rotation:y.toArray()}}this.updateTransformState(f),this.traverseEntity(p=>{p._cameraType&&p.dispatchEvent(znt)})}updateVisible(e){if(this.visible=this.dataPatched.visible&&(!this.dataPatched.cloner||(this.dataPatched.cloner.disabled??!1)||this.dataPatched.cloner?.hideBase!==!0),!e)return;let i=!1;this.traverseEntity(r=>{if(r.data.type==="Splat")return i=!0,!0}),i&&e.reloadSplats()}updateState_Entity(e,i){e.name!==void 0&&(this.name=e.name),e.raycastLock!==void 0&&(this.raycastLock=e.raycastLock),e.visible!==void 0&&(this.updateVisible(i?.scene),this.resetBBoxNeedsUpdate()),i&&"cloner"in e&&e.cloner!==void 0&&(this.setFromClonerState(e.cloner,i),this.updateVisible(i.scene)),this.updateTransformState(e,i)}get attachedSurfaceCloners(){return this.children.filter(e=>e instanceof Lg.Cloner&&e.parameters.type==="toObject")}setFromClonerState(e,i){this.disposed||(e===null||e.disabled?(this.cloner&&this.cloner.removeFromParent(),this.cloner=void 0):this.cloner===void 0?(this.cloner=new Lg.Cloner(this,e),i.scene.addPendingExpandCloner(this)):this.cloner.updateState(e,i.scene))}expandCloner(e){!this.disposed&&this.cloner&&this.cloner.expandClones(e)}invalidateClonerTransform(e){this.cloner&&this.cloner.invalidateTransform(e)}requestRender(){this.dispatchEvent({type:"requestRender"})}},Ffe=class{static create(t){return this.build(this.normalizeInputs(t))}static normalizeInputs(t,e){let i=t.parameters?.radiusTop,r=t.parameters?.radiusBottom,n=Object.assign({},e?.parameters??{width:100,radialSegments:64,heightSegments:1,openEnded:!1,thetaStart:0,thetaLength:360,cornerRadius:8,cornerSegments:8,hollow:0},t.parameters);n.thetaLength=Ht.clamp(n.thetaLength,0,360);let s=n.width/2,a=n.radiusTop??s,o=n.radiusBottom??s;if(a===o?(a=s,o=s):a>o?(a=s,o=o*s/a):(a=a*s/o,o=s),n.shapeBlendNode){a=i??s,o=r??s;let l=Math.max(a,o)*2;n.width=l,n.depth=l}return{parameters:Object.assign(n,{width:Math.abs(n.width),height:Math.abs(n.height??n.width),depth:Math.abs(n.depth??n.width),radiusTop:a,radiusBottom:o})}}static build(t){let{width:e,depth:i,height:r,radialSegments:n,heightSegments:s,openEnded:a,thetaStart:o,thetaLength:l,radiusTop:c,radiusBottom:u,cornerRadius:h,cornerSegments:d,hollow:f}=t.parameters,p;return l===0?(p=new oi,p.setAttribute("position",new Gt([],3))):h||f?p=new zfe(c,u,r,n,s,a,o,l*Math.PI/180,h,h,d,f):p=new ZH(c,u,r,n,s,a,o,l*Math.PI/180),p.scale(1,1,i/e),Object.assign(p,{userData:{...t,type:"CylinderGeometry"}})}};function Zm(t,e,i){i.x=t.x*e.x,i.y=t.y,i.z=t.x*e.y}function Oee(t){return new Ae(t.y,-t.x)}var zfe=class extends oi{constructor(t,e,i,r,n,s,a,o,l,c,u,h,d=!1){super(),this.type="RoundedCylinderBufferGeometry",t=t!==void 0?t:1,e=e!==void 0?e:1,i=i||1,r=Math.floor(r)||8,n=Math.floor(n)||1,s=s!==void 0?s:!1,a=a!==void 0?a:0,o=o!==void 0?o:Math.PI*2,s&&(l=0,c=0);let f=[],p=[],g=[],m=[],y=0,b=i/2,w=new W,E=new W;d&&t==0&&(t=l),d&&e==0&&(e=c);let M=new Ae(t,b),A=new Ae(e,-b),P=null,C=null,R=null,I=null,k=M.clone().sub(A),z=0,V=0,F=0;h>0&&(z=Math.min(t,e)*(1-h),V=t-z,F=e-z);let $=M.clone();$.x-=z;let K=Math.PI-k.angle(),X=k.angle(),U=Math.tan(X/2),Y=Math.tan(K/2),Z=U+Y,j=h?Z:Y,ee=h?Z:U;if(l=Math.min(l,(t-V)/j,k.length()/Z),c=Math.min(c,(e-F)/ee,k.length()/Z),l>0){let he=l/U;P=M.clone().sub(new Ae(he,l)),h&&(R=P.clone(),R.x-=z-Z*l),M.sub(k.clone().setLength(he))}if(c>0){let he=c/Y;C=A.clone().sub(new Ae(he,-c)),A.add(k.clone().setLength(he)),h&&(I=C.clone(),I.x-=z-Z*c,$.sub(k.clone().setLength(he)))}k=M.clone().sub(A);let pe=k.length()<.5,fe=[];for(let he=0;he<=r;he++){let ve=[],xe=he/r,Se=xe*o+a,Ce=new Ae(Math.sin(Se),Math.cos(Se));I&&C?(se(ve,xe,Ce,K,c,I,-1,!0),se(ve,xe,Ce,X,c,C,-1,!1)):C?(re(ve,Ce,C.x,0,-1),se(ve,xe,Ce,X,c,C,-1,!1)):s||re(ve,Ce,e,F,-1);let ce=Oee(k).normalize();if(Zm(ce,Ce,w),!pe)for(let Fe=0;Fe<=n;Fe++){let De=Fe/n,He=k.clone().multiplyScalar(De).add(A);Zm(He,Ce,E),p.push(E.x,E.y,E.z),g.push(w.x,w.y,w.z),m.push(xe,.5+E.y/i),ve.push(y++)}if(R&&P?(se(ve,xe,Ce,K,l,P,1,!1),se(ve,xe,Ce,X,l,R,1,!0)):P?(se(ve,xe,Ce,K,l,P,1,!1),re(ve,Ce,P.x,0,1)):s||re(ve,Ce,t,V,1),h&&!pe){let Fe=Oee(k).multiplyScalar(-1).normalize();Zm(Fe,Ce,w);for(let De=0;De<=n;De++){let He=De/n,Be=k.clone().multiplyScalar(-He).add($);Zm(Be,Ce,E),p.push(E.x,E.y,E.z),g.push(w.x,w.y,w.z),m.push(xe,.5+E.y/i),ve.push(y++)}}h&&!s&&ve.push(ve[0]),fe.push(ve)}for(let he=0;he<fe.length-1;he++)for(let ve=0;ve<fe[0].length-1;ve++){if(s&&h&&ve==n)continue;let xe=fe[he][ve],Se=fe[he+1][ve],Ce=fe[he+1][ve+1],ce=fe[he][ve+1],Fe=p[Ce*3+0],De=p[Ce*3+2];f.push(xe,Se,ce),(Fe!=0||De!=0)&&f.push(Se,Ce,ce)}o<Math.PI*2&&(le(-1,fe[0],a),le(1,fe[fe.length-1],a+o)),this.setIndex(f),this.setAttribute("position",new Gt(p,3)),this.setAttribute("normal",new Gt(g,3)),this.setAttribute("uv",new Gt(m,2));function se(he,ve,xe,Se,Ce,ce,Fe,De){for(let He=0;He<u+1;He++){let Be=He/u,$e=Fe<0?Be:1-Be;De&&($e-=1),$e*=Se;let ze=new Ae(Math.sin($e),Math.cos($e)*Fe),it=ze.clone().multiplyScalar(Ce).add(ce);Zm(it,xe,E),p.push(E.x,E.y,E.z),Zm(ze,xe,w),g.push(w.x,w.y,w.z),m.push(ve,.5+E.y/i),he.push(y++)}}function re(he,ve,xe,Se,Ce){let ce=new W,Fe=new Ae,De=[xe,Se];Ce<0&&De.reverse();for(let He of De)Fe.set(He,b*Ce),Zm(Fe,ve,ce),p.push(ce.x,ce.y,ce.z),g.push(0,Ce,0),m.push(.5,.5),he.push(y++)}function le(he,ve,xe){let Se=new Ae(Math.sin(xe),Math.cos(xe)),Ce=new Ae(-Math.cos(xe),Math.sin(xe)),ce=new W,Fe=he<0?(Be,$e,ze)=>f.push(Be,$e,ze):(Be,$e,ze)=>f.push(Be,ze,$e),De=new Ae((t+e+V+F)/4,0);Zm(De,Se,ce),p.push(ce.x,ce.y,ce.z),g.push(Ce.x,0,Ce.y),m.push(.5,.5);let He=y++;for(let Be of ve){let $e=p.slice(Be*3,Be*3+3);p.push(...$e),g.push(Ce.x,0,Ce.y);let ze=m.slice(Be*2,Be*2+2);m.push(...ze),y++}for(let Be=He+1;Be<y-1;Be++)Fe(He,Be,Be+1);Fe(He,y-1,He+1)}}},Hnt=class{static create(t){return this.build(this.normalizeInputs(t))}static normalizeInputs(t,e){let i=Object.assign({},e?.parameters??{width:100,radialSegments:32,heightSegments:8,openEnded:!1,thetaStart:0,thetaLength:360,cornerRadiusTop:8,cornerRadiusBottom:8,cornerSegments:8},t.parameters);return i.thetaLength=Ht.clamp(i.thetaLength,0,360),{parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??i.width)})}}static build(t){let{width:e,depth:i,height:r,radialSegments:n,heightSegments:s,openEnded:a,thetaStart:o,thetaLength:l,cornerRadiusTop:c,cornerRadiusBottom:u,cornerSegments:h}=t.parameters,d;return l===0?(d=new oi,d.setAttribute("position",new Gt([],3))):c>0||u>0||l<360?d=new zfe(0,e/2,r,n,s,a,o,l*Math.PI/180,c,u,h,0,!0):d=new QH(e/2,r,n,s,a),d.scale(1,1,i/e),Object.assign(d,{userData:{...t,type:"ConeGeometry"}})}},Gnt=class{static create(t){return this.build(this.normalizeInputs(t))}static normalizeInputs(t,e){let i=Object.assign({},e?.parameters??{width:100,widthSegments:1,heightSegments:1,depthSegments:1,cornerRadius:8,cornerSegments:8},t.parameters);return{parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??i.width)})}}static build(t){let{width:e,height:i,depth:r,widthSegments:n,heightSegments:s,depthSegments:a,cornerRadius:o,cornerSegments:l}=t.parameters,c;return o===0?c=new Oh(e,i,r,n,s,a):c=new Wnt(e,i,r,n,s,a,o,l),Object.assign(c,{userData:{...t,type:"CubeGeometry"}})}},IF=Math.PI/2,Wnt=class extends oi{constructor(t=1,e=1,i=1,r=1,n=1,s=1,a=0,o=4){super(),this.type="BoxGeometry",r=Math.floor(r),n=Math.floor(n),s=Math.floor(s),o=Math.floor(o),a=Math.min(a,t/2,e/2,i/2);let l=[],c=[],u=[],h=[],d=0;f("z","y","x",-1,-1,i,e,t,s,n),f("z","y","x",1,-1,i,e,-t,s,n),f("x","z","y",1,1,t,i,e,r,s),f("x","z","y",1,-1,t,i,-e,r,s),f("x","y","z",1,-1,t,e,i,r,n),f("x","y","z",-1,-1,t,e,-i,r,n),a>0&&(p("z","y","x",-1,-1,1,i,e,t,s),p("z","y","x",1,-1,-1,i,e,t,s),p("z","y","x",-1,1,-1,i,e,t,s),p("z","y","x",1,1,1,i,e,t,s),p("x","y","z",-1,-1,-1,t,e,i,r),p("x","y","z",1,-1,1,t,e,i,r),p("x","y","z",-1,1,1,t,e,i,r),p("x","y","z",1,1,-1,t,e,i,r),p("y","x","z",-1,-1,1,e,t,i,n),p("y","x","z",1,-1,-1,e,t,i,n),p("y","x","z",1,1,1,e,t,i,n),p("y","x","z",-1,1,-1,e,t,i,n),g(1,1,1),g(-1,1,1),g(1,-1,1),g(-1,-1,1),g(1,1,-1),g(-1,1,-1),g(1,-1,-1),g(-1,-1,-1)),this.setIndex(l),this.setAttribute("position",new Gt(c,3)),this.setAttribute("normal",new Gt(u,3)),this.setAttribute("uv",new Gt(h,2));function f(m,y,b,w,E,M,A,P,C,R){let I=(M-2*a)/C,k=(A-2*a)/R,z=M/2-a,V=A/2-a,F=P/2,$=C+1,K=R+1,X=0,U=new W;for(let Y=0;Y<K;Y++){let Z=Y*k-V;for(let j=0;j<$;j++){let ee=j*I-z;U[m]=ee*w,U[y]=Z*E,U[b]=F,c.push(U.x,U.y,U.z),U[m]=0,U[y]=0,U[b]=P>0?1:-1,u.push(U.x,U.y,U.z),h.push(j/C),h.push(1-Y/R),X+=1}}for(let Y=0;Y<R;Y++)for(let Z=0;Z<C;Z++){let j=d+Z+$*Y,ee=d+Z+$*(Y+1),pe=d+(Z+1)+$*(Y+1),fe=d+(Z+1)+$*Y;l.push(j,ee,fe),l.push(ee,pe,fe)}d+=X}function p(m,y,b,w,E,M,A,P,C,R){let I=(A-2*a)/R,k=A/2-a,z=P/2-a,V=C/2,F=R+1,$=0,K=new W,X=new W;for(let U=0;U<o+1;U++){let Y=U/o*IF,Z=Math.sin(Y)*a,j=(1-Math.cos(Y))*a,ee=Math.sin(Y),pe=Math.cos(Y);K[y]=(z+Z)*E,K[b]=(V-j)*M,X[m]=0,X[y]=ee*Math.sign(K[y]),X[b]=pe*Math.sign(K[b]);for(let fe=0;fe<F;fe++){let se=fe*I-k;K[m]=se*w,c.push(K.x,K.y,K.z),u.push(X.x,X.y,X.z),h.push(fe/R),h.push(0),$+=1}}for(let U=0;U<o;U++)for(let Y=0;Y<R;Y++){let Z=d+Y+F*U,j=d+Y+F*(U+1),ee=d+(Y+1)+F*(U+1),pe=d+(Y+1)+F*U;l.push(Z,j,pe),l.push(j,ee,pe)}d+=$}function g(m,y,b){let w=new W,E=new W(t/2,e/2,i/2);E.subScalar(a);let M=[],A=m*y*b>0?(C,R,I)=>l.push(C,R,I):(C,R,I)=>l.push(C,I,R);for(let C=0;C<=o;C++){let R=[],I=IF*(1-C/o),k=Math.cos(I),z=Math.sin(I),V=0;for(let F=0;F<=C;F++){let $=Math.cos(V),K=Math.sin(V);w.x=k*$,w.y=z,w.z=k*K;let X=E.clone().addScaledVector(w,a);c.push(m*X.x,y*X.y,b*X.z),u.push(m*w.x,y*w.y,b*w.z),h.push(0,0),R.push(d++),V+=IF/C}M.push(R)}let P=M.length-1;for(let C=0;C<P;C++){let R=M[C],I=M[C+1],k=R.length-1;A(R[0],I[1],I[0]);for(let z=1;z<=k;z++)A(R[z-1],R[z],I[z]),A(R[z],I[z+1],I[z])}}}},ZG=class extends oi{constructor(t=[],e=[],i="",r=1,n=.2,s=4){super(),this.type="PolyhedronGeometryRound";let a=[],o=[],l=[];c(),u(),this.setAttribute("position",new Gt(a,3)),this.setAttribute("normal",new Gt(l,3)),this.setAttribute("uv",new Gt(o,2));return;function c(){n=Math.min(1-1e-5,n),n==0&&(s=0);let h={IcosahedronGeometry:5,DodecahedronGeometry:3,HexahedronGeometry:3,OctahedronGeometry:4,TetrahedronGeometry:3}[i],d=new W,f=d.clone(),p=new vo,g=n*r,m=r-g,y=s+1,b=new W,w=(X,U)=>b.subVectors(X,U).normalize(),E=(X,U)=>Array(X).fill(void 0).map(U),M=E(t.length/3,(X,U)=>new W().fromArray(t,U*3).setLength(r)),A=[],P=1e6;for(let X=0;X<M.length;X++){let U=M[X],Y=[],Z,j,ee,pe=1e10,fe=-1;for(;(fe=e.indexOf(X,fe+1))!=-1;){let he=fe-fe%3;Z=e[he+(fe+1)%3],j=e[he+(fe+2)%3],ee=U.distanceToSquared(M[Z]),pe=Math.min(pe,ee),Y.push([Z,j,ee])}pe+=1e-6;let se=[],re=0,le=Y.length;for(let he=0;he<le;he++){[Z,j,ee]=Y[re];let ve=A[Z]?.includes(X)==!0;ee<=pe&&se.push(Z+ +ve*P),re=Y.findIndex(xe=>xe[0]==j)}A.push(se)}let C=[];{let X=0,U=0,Y,Z,j=h==3;for(let ee=0;ee<=s;ee++){Y=ee*(ee+1)/2,Z=(ee+1)*(ee+2)/2;for(let pe=0;pe<s-ee;pe++)[X,U]=[Y+pe+ee+2,Z+pe+ee+3],C.push(Y,Z,...j?[U,Y]:[X,Z],U,X),[Y,Z]=[X,U];C.push(Y,Z,Y+s+2)}}let R=d.clone(),I=d.clone(),k=d.clone(),z=d.clone(),V=d.clone(),F=[],$=E(M.length,()=>E(h,()=>d.clone()));for(let X=0;X<M.length;X++){d.copy(M[X]).normalize(),R.copy(d).multiplyScalar(m);let U=A[X];for(let se=0;se<U.length;se++){let re=U[se],le=U[(se+1)%h];p.setFromPointsAndIndices(M,X,re%P,le%P),p.b.sub(p.a).setLength(1e10).add(p.a),p.c.sub(p.a).setLength(1e10).add(p.a),p.closestPointToPoint(R,$[X][se])}let Y=[],Z=[],j=[],ee=new W;s==0&&[...$[X]].reduce((se,re)=>se.add(re),ee).multiplyScalar(1/h);for(let se=0;se<h;se++){let re=[],le=(se-1+h)%h,he=$[X][le],ve=$[X][se];d.copy(he).sub(R),f.copy(ve).sub(R);let xe=R.angleTo(d),Se=d.angleTo(f),Ce=Math.cos(xe)*g;s==0?I.copy(ee):I.copy(R).setLength(m+Ce),Z.push(Ce);let ce=[I,he,ve];for(let Fe=0;Fe<2;Fe++){let De=ce[Fe],He=ce[Fe+1];z.subVectors(De,R),V.subVectors(He,R),k.crossVectors(z,V).normalize();for(let Be=0;Be<y;Be++){let $e=[xe,Se][Fe]*Be/y;d.copy(z).applyAxisAngle(k,$e).add(R),Y.push(d.clone()),Fe&&(w(d,R),re.push([Be==0?De:d.clone(),b.clone()]))}Fe&&(w(He,R),re.push([He,b.clone()]))}j.push(re)}F.push(j);let pe=2*y,fe=2;for(let se=0;se<h;se++){let re=pe*se,le=pe*((se+1)%h),he=[Y[re]];for(let xe=1;xe<y;xe++){z=Y[re+xe],V=Y[le+xe],he.push(z);for(let Se=1,Ce=xe-fe+1;Se<=Ce;Se++)d.lerpVectors(z,V,Se/(Ce+1)),d.sub(R).setLength(Z[se]).add(R),he.push(d.clone());he.push(V)}for(let xe=0;xe<y;xe++)he.push(Y[xe+y+re]);he.push(Y[le+y]);let ve=C.map(xe=>he[xe]);a.push(...ve.map(xe=>[xe.x,xe.y,xe.z]).flat()),l.push(...ve.map(xe=>(w(xe,R),[b.x,b.y,b.z])).flat())}}let K=[];for(let X=0;X<A.length;X++)for(let U=0;U<h;U++){let Y=A[X][U];if(Y<P){let Z=A[Y].findIndex(pe=>pe%P==X),j=F[X][U],ee=F[Y][Z];for(let pe=0;pe<y;pe++){let fe=j[pe],se=ee[y-pe],re=j[pe+1],le=ee[y-(pe+1)];[fe,se,re,re,se,le].forEach(he=>{a.push(he[0].x,he[0].y,he[0].z),l.push(he[1].x,he[1].y,he[1].z)})}K.push(j[0][0],ee[y][0],j[y][0],ee[0][0])}}for(;K.length;){let X,U,Y,Z;[X,U]=K.splice(0,2);let j=[X];for(;X!=U;)j.push(U),Y=K.indexOf(U),Z=Y%2,U=K.splice(Y-Z,2)[1-Z];b.subVectors(j[0],j[1]).cross(d.subVectors(j[0],j[2])).normalize();let ee=b.dot(j[0])<0;ee&&b.negate();for(let pe=1;pe<=j.length-2;pe++)[j[pe+ +ee],j[pe+1-+ee],j[0]].forEach(fe=>{a.push(fe.x,fe.y,fe.z),l.push(b.x,b.y,b.z)})}}function u(){let h=new W;for(let A=0;A<a.length;A+=3){h.x=a[A+0],h.y=a[A+1],h.z=a[A+2];let P=E(h)/2/Math.PI+.5,C=M(h)/Math.PI+.5;o.push(P,1-C)}let d=new W,f=new W,p=new W,g=new W,m=new Ae,y=new Ae,b=new Ae,w=(A,P,C,R)=>{R<0&&A.x===1&&(o[P]=A.x-1),C.x===0&&C.z===0&&(o[P]=R/2/Math.PI+.5)};for(let A=0,P=0;A<a.length;A+=9,P+=6){d.set(a[A+0],a[A+1],a[A+2]),f.set(a[A+3],a[A+4],a[A+5]),p.set(a[A+6],a[A+7],a[A+8]),m.set(o[P+0],o[P+1]),y.set(o[P+2],o[P+3]),b.set(o[P+4],o[P+5]),g.copy(d).add(f).add(p).divideScalar(3);let C=E(g);w(m,P+0,d,C),w(y,P+2,f,C),w(b,P+4,p,C)}for(let A=0;A<o.length;A+=6){let P=o[A+0],C=o[A+2],R=o[A+4],I=Math.max(P,C,R),k=Math.min(P,C,R);I>.9&&k<.1&&(P<.2&&(o[A+0]+=1),C<.2&&(o[A+2]+=1),R<.2&&(o[A+4]+=1))}function E(A){return Math.atan2(A.z,-A.x)}function M(A){return Math.atan2(-A.y,Math.sqrt(A.x*A.x+A.z*A.z))}}}static fromJSON(t){return new ZG(t.vertices,t.indices,t.radius,t.corner,t.cornerSides)}},qnt=class{static create(t){return this.build(this.normalizeInputs(t))}static normalizeInputs(t,e){let i=Object.assign({},e?.parameters??{width:100,detail:0,corner:0,cornerSides:4},t.parameters);return{parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??i.width)})}}static build(t){let{width:e,height:i,depth:r,detail:n,corner:s,cornerSides:a}=t.parameters,o=n===0&&s!==0?new jfe(e*.5,s,a):new The(e*.5,n);return o.scale(1,i/e,r/e),Object.assign(o,{userData:{...t,type:"DodecahedronGeometry"}})}},jfe=class extends ZG{constructor(t=1,e=.2,i=4){let r=(1+Math.sqrt(5))/2,n=1/r,s=[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-n,-r,0,-n,r,0,n,-r,0,n,r,-n,-r,0,-n,r,0,n,-r,0,n,r,0,-r,0,-n,r,0,-n,-r,0,n,r,0,n],a=[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9],o="DodecahedronGeometry";super(s,a,o,t,e,i),this.type=o}static fromJSON(t){return new jfe(t.radius,t.corner,t.cornerSides)}},bE=1e-12,QG=class{constructor(t){this.position=new Ae,this.startPosition=new Ae,this.uuid=Ht.generateUUID(),this.position=t.clone()}start(){this.reset()}reset(){this.startPosition.copy(this.position)}applyOffset(t){this.position.copy(this.startPosition).add(t)}copy(t){return this.position.copy(t.position),this.startPosition.copy(t.startPosition),this}clone(){return new QG(this.position).copy(this)}toJSON(){return[this.position.x,this.position.y]}},z5=class extends QG{constructor(t){super(t.position),this.parent=t}copy(t){return super.copy(t),this}clone(){return new z5(this.parent).copy(this)}},u1=class extends QG{constructor(t,e){super(e),this.controls=[],this.roundness=0,this.areControlsDirectionsMirrored=!0,this.uuid=t,this.controls.push(new z5(this),new z5(this))}static create(t,e){let i=new u1(t,new Ae(...e.position));return i.controls[0].position.set(...e.controlPrevious.position),i.controls[1].position.set(...e.controlNext.position),i.roundness=e.roundness,i.areControlsDirectionsMirrored=e.areControlsDirectionsMirrored,i}getOppositeControl(t){let e=this.controls.indexOf(t);return e===0?this.controls[1]:e===1?this.controls[0]:null}applyOffsetToControls(t,e=1){for(let i=0,r=this.controls.length;i<r;i++){let n=this.controls[i];this.position.distanceTo(n.position)<=e?n.position.copy(this.position):n.applyOffset(t)}}controlsMoved(){return!(this.position.equals(this.controls[0].position)&&this.position.equals(this.controls[1].position))}copy(t){return super.copy(t),this.controls[0].copy(t.controls[0]),this.controls[1].copy(t.controls[1]),this.roundness=t.roundness,this.uuid=t.uuid,this}clone(){return new u1(this.uuid,this.position).copy(this)}toJSON(){return super.toJSON().concat(this.controls[0].toJSON(),this.controls[1].toJSON(),[this.roundness])}computeTangents(){let t=this.curveBefore?.getTangentAt(1),e=this.curveAfter?.getTangentAt(0);return[t,e]}computeNormals(t=new Ae,e=new Ae){let[i,r]=this.computeTangents();return i&&r&&(Lee(i,t),Lee(r,e)),[t,e]}computeTangent(t=new Ae){let[e,i]=this.computeTangents();return e&&i&&t.copy(e).add(i).normalize(),t}computeNormal(t=new Ae){let[e,i]=this.computeNormals();return t.copy(e).add(i).normalize(),t}};function Lee(t,e=new Ae){let i=t.length();return e.set(-t.y/i,t.x/i)}var JG=t=>t,B_=new Ae,ML=new Ae,Xnt=new Ae,$nt=new Ae,Ynt=new Ae,Knt=new Ae,Vfe=new W,Hfe=new W;function Znt(t){let e=new Ae;e.addVectors(t.v0,B_.subVectors(t.v1,t.v0).multiplyScalar(2/3));let i=new Ae;return i.addVectors(t.v2,ML.subVectors(t.v1,t.v2).multiplyScalar(2/3)),new bh(t.v0,e,i,t.v2)}function $E(t,e,i=Number.EPSILON){return Math.abs(t-e)<i}function Qnt(t,e,i=Number.EPSILON){return t.distanceTo(e)<i}function Jnt(t,e,i=Number.EPSILON){return t.distanceTo(e)<i}function Gfe(t,e,i){let r=Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2)),n=Math.sqrt(Math.pow(e.x-i.x,2)+Math.pow(e.y-i.y,2)),s=Math.sqrt(Math.pow(i.x-t.x,2)+Math.pow(i.y-t.y,2));return Math.acos((n*n+r*r-s*s)/(2*n*r))}function est(t,e,i){return Nee(t,e)&&Nee(e,i)&&j5(t.position,e.position,i.position)}function j5(t,e,i){return B_.copy(e).sub(t).cross(ML.copy(i).sub(t))===0}function tst(t,e,i,r,n){let s=Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2)),a=(t.y+e.y)/2,o=(t.x+e.x)/2,l=Math.sqrt(Math.pow(i,2)-Math.pow(s/2,2))*(t.y-e.y)/s,c=Math.sqrt(Math.pow(i,2)-Math.pow(s/2,2))*(e.x-t.x)/s;return r.set(o+l,a+c),n.set(o-l,a-c),[r,n]}function ist(t,e,i){let r=t.distanceTo(i),n=e.distanceTo(i);return r<n?e:t}function rst(t,e,i,r,n,s){let a=e.x-t.x,o=e.y-t.y,l=i.x-t.x,c=i.y-t.y,u=Math.sqrt((a+l)*(a+l)+(o+c)*(o+c)),h;return Gfe(e,t,i)>Math.PI&&(u*=-1),$E(c,o)?h=(o+c)*(r/u-.5)*8/3/(a-l):h=(a+l)*(r/u-.5)*8/3/(c-o),n.set(e.x-h*o,e.y+h*a),s.set(i.x+h*c,i.y-h*l),[n,s]}function kee(t,e){return t.position.equals(t.controls[1].position)&&e.position.equals(e.controls[0].position)}function Nee(t,e){return j5(t.position,t.controls[1].position,e.position)&&j5(t.position,e.controls[0].position,e.position)}function nst(t,e,i,r,n=.5){let s=B_.subVectors(e,t).multiplyScalar(n).add(t),a=ML.subVectors(i,e).multiplyScalar(n).add(e),o=Xnt.subVectors(r,i).multiplyScalar(n).add(i),l=s,c=$nt.subVectors(a,s).multiplyScalar(n).add(s),u=Ynt.subVectors(o,a).multiplyScalar(n).add(a),h=o,d=Knt.subVectors(u,c).multiplyScalar(n).add(c);return[t.x,t.y,l.x,l.y,c.x,c.y,d.x,d.y,u.x,u.y,h.x,h.y,r.x,r.y]}function sst(t,e,i=12,r=!0){let n=Hfe.set(0,0,0),s,a=0;for(let o=0;o<e.length;o++){let l=JG(e[o]),c=B_,u=w0(l,i);for(let h=0;h<=u;h++)if(l instanceof bh||l instanceof rv||l instanceof Eh){if(l.getPoint(h/u,c),n.set(c.x,c.y,0),s!==void 0&&Jnt(s,n))continue;s===void 0&&(s=Vfe),s.copy(n),t.setXYZ(a,n.x,n.y,n.z),a++}}return r&&a>1&&!(t.getX(a-1)===t.getX(0)&&t.getY(a-1)===t.getY(0)&&t.getZ(a-1)===t.getZ(0))&&(t.setXYZ(a,t.getX(0),t.getY(0),t.getZ(0)),a++),t}function ast(t,e,i,r=12,n=!0){let s=Hfe.set(0,0,0),a=0,o=[];for(let l=0;l<e.length;l++){if(i[l]===!1)continue;let c,u=JG(e[l]),h=B_,d=w0(u,r);o.push(d);for(let f=0;f<=d;f++)if(u instanceof bh||u instanceof rv||u instanceof Eh){if(u.getPoint(f/d,h),s.set(h.x,h.y,0),c?.equals(s))continue;c===void 0?c=Vfe:(t.setXYZ(a,c.x,c.y,c.z),a++,t.setXYZ(a,s.x,s.y,s.z),a++),c.copy(s)}}return n&&a>1&&!(t.getX(a-1)===t.getX(0)&&t.getY(a-1)===t.getY(0)&&t.getZ(a-1)===t.getZ(0))&&(t.setXYZ(a,t.getX(0),t.getY(0),t.getZ(0)),a++),o}function Uee(t,e=12,i=!1){let r=[];for(let n=0,s=t.length;n<s;n++){let a=t[n],o=0;if(i&&a.roundedCurveCorner!==void 0){let l=w0(a.roundedCurveCorner,e)*.5;n>0&&(r[n-1]+=l),o+=l}a.curveAfter!==void 0&&(o+=w0(a.curveAfter,e)),r.push(o)}return t.length>0&&i&&t[0].roundedCurveCorner!==void 0&&(r[t.length-1]+=w0(t[0].roundedCurveCorner,e)*.5),r}function w0(t,e=12){return t&&t instanceof lL?e*2:t&&(t instanceof Eh||t instanceof Ehe)?1:t&&t instanceof KH?e*t.points.length:e}function ost(t,e,i=12,r=!0){let n,s=0;for(let a=0;a<e.length;a++){let o=JG(e[a]),l=w0(o,i),c=B_;for(let u=0;u<=l;u++)if(o instanceof bh||o instanceof rv||o instanceof Eh){if(o.getPoint(u/l,c),n!==void 0&&Qnt(n,c,bE))continue;n===void 0&&(n=ML),n.copy(c),t.push(c.x,c.y),s++}}return $E(t[0],t[t.length-2],bE)&&$E(t[1],t[t.length-1],bE)&&(t.pop(),t.pop()),r&&s>1&&!($E(t[s-1],t[1],bE)&&$E(t[s-2],t[0],bE))&&(t.push(t[0],t[1]),s++),t}var DF=new Ae,lst=new Ae,cst=new Ae,ust=new Ae,hst=new Ae,dst=new Ae,as=class extends qD{constructor(t=100,e=100){super(),this.points=[],this.shapeHoles=[],this.plane=new $l(new W(0,0,-1)),this.subdivision=0,this.controlSnapDistance=4,this.pointIDs=0,this.isMesh2D=!1,this.isText=!1,this._roundness=0,this.isClosed=!1,this.useCubicForRoundedCorners=!0,this.uuid=Ht.generateUUID(),this.needsUpdate=!1,this.roundedCurves=[],this._width=t,this._height=e}static createFromState(t,e,i){let r=new as;return r.isClosed=t.isClosed,r.points=t.points.map(n=>u1.create(n.id,n.data)),typeof t.roundness=="number"&&(r.roundness=t.roundness),r.shapeHoles=t.shapeHoles.map(n=>as.createFromState(n)),e!==void 0&&i!==void 0&&r.applySize(e,i),r.update(),r}get width(){return this._width}get height(){return this._height}get roundness(){return this._roundness}set roundness(t){if(this._roundness!==t){this._roundness=t;for(let e=0,i=this.points.length;e<i;e++)this.points[e].roundness=t;this.needsUpdate=!0}}getPointsIndexesByIds(t){return t.map(e=>this.getPointIndexById(e)).filter(e=>e>=0)}getPointIndexById(t){let e=this.points.length,i=this.points.findIndex(r=>r.uuid===t);if(i<0){let r=e;for(let n=0,s=this.shapeHoles.length;n<s;n++){let a=this.shapeHoles[n],o=a.points.length,l=a.getPointIndexById(t);if(l<0)r+=o;else return l+r}}return i}getLineIndexById(t){return this.getPointIndexById(t)}getBezierPoint(t){if(t<=this.points.length-1)return this.points[t];if(this.shapeHoles.length>0){let e=this.points.length;for(let i=0,r=this.shapeHoles.length;i<r;i++){let n=this.shapeHoles[i],s=t-e;if(s<=n.points.length-1)return n.points[s];e+=n.points.length}}throw new Error("This shape does not have a point for this index: "+t)}getBezierPointIndex(t){let e=this.points.indexOf(t);if(e>=0)return e;if(e=this.points.length,this.shapeHoles.length>0)for(let i=0,r=this.shapeHoles.length;i<r;i++){let n=this.shapeHoles[i],s=n.points.indexOf(t);if(s>=0)return e+s;e+=n.points.length}return-1}getAllPoints(){let t=[].concat(...this.shapeHoles.map(e=>e.points));return[...this.points,...t]}applySize(t,e){t===0&&(t=.001),e===0&&(e=.001),this._width=t,this._height=e}applyScale(t,e){let i=DF.set(t,e);for(let r=0,n=this.points.length;r<n;r++){let s=this.points[r];s.position.multiply(i),s.controls[0].position.multiply(i),s.controls[1].position.multiply(i)}for(let r=0,n=this.shapeHoles.length;r<n;r++)this.shapeHoles[r].applyScale(t,e);this._update()}createPoint(t,e=0,i=Ht.generateUUID()){let r;t instanceof Ae?r=t:r=new Ae(t,e);let n=new u1(i,r);return n.roundness=this.roundness,n}addPoint(t){this.points.push(t),this.needsUpdate=!0}addPointAt(t,e){this.points.splice(e,0,t),this.needsUpdate=!0}getPointByUuid(t){for(let e=0,i=this.points.length;e<i;e++){let r=this.points[e];if(r.uuid===t)return r}for(let e=0,i=this.shapeHoles.length;e<i;e++){let r=this.shapeHoles[e].getPointByUuid(t);if(r)return r}}getFirstPoint(){return this.points[0]}getLastPoint(){return this.points[this.points.length-1]}removePoint(t){let e=this.points.indexOf(t);e>=0&&this.points.splice(e,1),this.needsUpdate=!0}removePointById(t){let e=this.points.find(i=>i.uuid===t);e&&this.removePoint(e)}update(){for(let t=0,e=this.shapeHoles.length;t<e;t++)this.shapeHoles[t].update();this._update()}extractShapePointsToBuffer(t,e=12,i=!1){this.subdivision=e,this.curveDivisions===void 0&&this.computeCurveDivisions(e);let r=i?this.roundedCurveDivisions:this.curveDivisions;return sst(t,i?this.roundedCurves:this.curves,e,this.autoClose),r.reduce((n,s)=>n+s,0)+1}computeCurveDivisions(t=12){return this.curveDivisions=Uee(this.points,t,!1),this.roundedCurveDivisions=Uee(this.points,t,!0),this.curveDivisions}extractFilteredShapePointsToBuffer(t,e,i=12){return ast(t,this.curves,e,i,this.autoClose).reduce((r,n)=>r+n,0)*2}extractShapePointsToFlatArray(t,e=12){return this.subdivision=e,this.curveDivisions===void 0&&this.computeCurveDivisions(e),ost(t,this.roundedCurves,e,this.autoClose)}getCurveIndexFromVertexId(t,e=!1){let i=0;this.curveDivisions===void 0&&this.computeCurveDivisions(this.subdivision);let r=e?this.roundedCurveDivisions:this.curveDivisions,n=0;e&&this.points[0].roundedCurveCorner!==void 0&&(n=w0(this.points[0].roundedCurveCorner,this.subdivision)*.5);let s=t-n;s<0&&(s+=r.reduce((a,o)=>a+o,0));for(let a=0,o=r.length;a<o;a++){let l=r[a];if(s<i+l)return[a,(s-i+1)/l];i+=l}return[0,1]}getCurveT(t,e,i){let r=this.points[t],n=this.points[t>=this.points.length-1?0:t+1],s=this.curveDivisions,a=s[t];if(kee(r,n)){let l=r.position.distanceTo(n.position);return r.position.distanceTo(DF.set(i.x,i.y))/l}let o=0;for(let l=0;l<t;l++)o+=s[l];return(e-o)/a}dispose(){}_applyCurveForPoint(t,e){kee(e,t)?this.lineTo(t.position.x,t.position.y):this.bezierCurveTo(e.controls[1].position.x,e.controls[1].position.y,t.controls[0].position.x,t.controls[0].position.y,t.position.x,t.position.y);let i=this.curves[this.curves.length-1];t.curveBefore=i,e.curveAfter=i;let r=i.clone();t.roundedCurveBefore=r,e.roundedCurveAfter=r,t.roundedCurveCorner=void 0,this.roundedCurves.push(r)}_update(){if(this.curves=[],this.roundedCurves=[],!this.points.length)return;for(let e=0,i=this.points.length;e<i;e++){let r=this.points[e];if(e===0)this.moveTo(r.position.x,r.position.y);else{let n=this.points[e-1];this._applyCurveForPoint(r,n)}}let t=this.getLastPoint();if(t?.curveAfter&&(t.curveAfter=void 0),this.isClosed){let e=this.points[0],i=this.points[this.points.length-1];this._applyCurveForPoint(e,i)}if(this.points.length>2){let e=0;for(let i=0,r=this.points.length;i<r;i++){let n=this.points[i],s=this.points[i-1]??this.points[this.points.length-1],a=this.points[i+1]??this.points[0],o=n.roundness,l=s&&a&&est(s,n,a);if(!n.controlsMoved()&&o>0&&!l){let c=n.curveBefore,u=n.curveAfter;if(c===void 0||u===void 0)continue;let h=n.roundedCurveBefore,d=n.roundedCurveAfter,f=c.getLength(),p=u.getLength(),g=Math.min(o,f*.499),m=Math.min(o,p*.499),y=Math.min(g,m),b=1-y/f,w=y/p,E=c.getPointAt(b,DF),M=u.getPointAt(w,lst);this._subSplitCurve(c,h,b,E,void 0),this._subSplitCurve(u,d,w,void 0,M);let A;if(this.useCubicForRoundedCorners){let P=Gfe(E,n.position,M)/2,C=Math.tan(P)*E.distanceTo(n.position),[R,I]=tst(E,M,C,cst,ust),k=ist(R,I,n.position),[z,V]=rst(k,E,M,C,hst,dst);A=new bh(E.clone(),z.clone(),V.clone(),M.clone())}else A=new rv(E.clone(),n.position.clone(),M.clone());n.roundedCurveCorner=A,this.roundedCurves.splice(i+e,0,A),e++}}}}_subSplitCurve(t,e,i,r,n){if(t instanceof Eh)r!==void 0&&e.v2.copy(r),n!==void 0&&e.v1.copy(n);else{let s=t,a=e,o=s.getUtoTmapping(i,0),l=nst(s.v0,s.v1,s.v2,s.v3,o);return r!==void 0&&(a.v0.set(l[0],l[1]),a.v1.set(l[2],l[3]),a.v2.set(l[4],l[5]),a.v3.set(l[6],l[7])),n!==void 0&&(a.v0.set(l[6],l[7]),a.v1.set(l[8],l[9]),a.v2.set(l[10],l[11]),a.v3.set(l[12],l[13])),a}return e}clone(){let t=new as(this._width,this._height);return t.points=this.points.map(e=>e.clone()),t.isClosed=this.isClosed,t.roundness=this.roundness,t.isMesh2D=this.isMesh2D,t.shapeHoles=this.shapeHoles.map(e=>e.clone()),t}toJSON(){return{points:this.points.reduce((t,e)=>t.concat(e.toJSON()),[]),shapeHoles:this.shapeHoles.map(t=>t.toJSON()),isClosed:this.isClosed,roundness:this.roundness}}fromJSON(t){this.points=[],this.pointIDs=0;let e=t.points.length/7;for(let i=0;i<e;i++){let r=i*7,n=t.points[r+0],s=t.points[r+1],a=t.points[r+2],o=t.points[r+3],l=t.points[r+4],c=t.points[r+5],u=t.points[r+6],h=new u1(Ht.generateUUID(),new Ae(n,s));h.controls[0].position.set(a,o),h.controls[1].position.set(l,c),h.roundness=u,this.points.push(h)}return this.shapeHoles=t.shapeHoles?.length?t.shapeHoles.map(i=>{let r=new as;return r.fromJSON(i),r}):[],this.isClosed=t.isClosed,this._roundness=t.roundness,this._update(),this}fromShape(t,e=!1){this.isText=e;let i=(n,s)=>{s instanceof bh&&s.v3.equals(n.position)&&n.controls[0].position.copy(s.v2)},r=n=>{let s=[],a,o;for(a=0,o=n.length;a<o;a++)n[a]instanceof rv&&(n[a]=Znt(n[a]));for(a=0,o=n.length;a<o;a++){let u=n[a],h=a>0?n[a-1]:null,d;u instanceof bh?(d=this.createPoint(u.v0),d.controls[1].position.copy(u.v1)):u instanceof Eh&&(d=this.createPoint(u.v1)),d!==void 0&&(h!==null&&i(d,h),s.push(d))}let l=n[n.length-1],c=!1;return l instanceof bh?l.v3.equals(s[0].position)&&(s[0].controls[0].position.copy(l.v2),c=!0):l instanceof Eh&&l.v2.equals(s[0].position)&&(c=!0),this.isClosed=c,s};return this.points=r(t.curves),t instanceof qD&&(this.shapeHoles=t.holes.map(n=>{let s=new as;return s.fromShape(n),s})),this.update(),this}updatePoint(t,e){let i=this.getPointByUuid(t);i&&(e.position!==void 0&&i.position.fromArray(e.position),e.roundness!==void 0&&(i.roundness=e.roundness),e.areControlsDirectionsMirrored!==void 0&&(i.areControlsDirectionsMirrored=e.areControlsDirectionsMirrored),this.needsUpdate=!0)}updatePreviousControl(t,e){let i=this.getPointByUuid(t)?.controls[0];i&&(e.position&&i.position.fromArray(e.position),this.needsUpdate=!0)}updateNextControl(t,e){let i=this.getPointByUuid(t)?.controls[1];i&&(e.position&&i.position.fromArray(e.position),this.needsUpdate=!0)}},Wfe=Math.PI*2;function OF({x:t,y:e},i,r,n,s){return{x:t*i+n,y:e*r+s}}function fst(t,e){let i=e===1.5707963267948966?.551915024494:e===-1.5707963267948966?-.551915024494:1.3333333333333333*Math.tan(e/4),r=Math.cos(t),n=Math.sin(t),s=Math.cos(t+e),a=Math.sin(t+e);return[{x:r-n*i,y:n+r*i},{x:s+a*i,y:a-s*i},{x:s,y:a}]}function Bee(t,e,i,r){let n=t*r-e*i<0?-1:1,s=Math.min(1,Math.max(-1,t*i+e*r));return n*Math.acos(s)}function pst(t,e,i,r,n,s,a,o,l,c){let u=Math.pow(n,2),h=Math.pow(s,2),d=Math.pow(a,2),f=Math.pow(o,2),p=u*h-u*f-h*d;p<0&&(p=0),p/=u*f+h*d,p=Math.sqrt(p)*(l===c?-1:1);let g=p*n/s*o,m=p*-s/n*a,y=g+(t+i)/2,b=m+(e+r)/2,w=(a-g)/n,E=(o-m)/s,M=(-a-g)/n,A=(-o-m)/s,P=Bee(1,0,w,E),C=Bee(w,E,M,A);return C<0&&(C+=Wfe),{centerx:y,centery:b,ang1:P,ang2:C}}function mst({px:t,py:e,cx:i,cy:r,rx:n,ry:s,largeArcFlag:a,sweepFlag:o}){let l=[];if(n===0||s===0)return[];let c=(t-i)/2,u=(e-r)/2;if(c===0&&u===0)return[];n=Math.abs(n),s=Math.abs(s);let h=Math.pow(c,2)/Math.pow(n,2)+Math.pow(u,2)/Math.pow(s,2);h>1&&(n*=Math.sqrt(h),s*=Math.sqrt(h));let d=pst(t,e,i,r,n,s,c,u,a,o),{ang1:f,ang2:p}=d,{centerx:g,centery:m}=d,y=Math.abs(p)/(Wfe/4);Math.abs(1-y)<1e-7&&(y=1);let b=Math.max(Math.ceil(y),1);p/=b;for(let w=0;w<b;w++)l.push(fst(f,p)),f+=p;return l.map(w=>{let{x:E,y:M}=OF(w[0],n,s,g,m),{x:A,y:P}=OF(w[1],n,s,g,m),{x:C,y:R}=OF(w[2],n,s,g,m);return{x1:E,y1:M,x2:A,y2:P,x:C,y:R}})}var hn;(function(t){t[t.ODD=0]="ODD",t[t.NONZERO=1]="NONZERO",t[t.POSITIVE=2]="POSITIVE",t[t.NEGATIVE=3]="NEGATIVE",t[t.ABS_GEQ_TWO=4]="ABS_GEQ_TWO"})(hn||(hn={}));var zs;(function(t){t[t.POLYGONS=0]="POLYGONS",t[t.CONNECTED_POLYGONS=1]="CONNECTED_POLYGONS",t[t.BOUNDARY_CONTOURS=2]="BOUNDARY_CONTOURS"})(zs||(zs={}));function ki(t,e){if(!t)throw e||"Assertion Failed!"}var Ei=(function(){function t(){}return t.vertEq=function(e,i){return e.s===i.s&&e.t===i.t},t.vertLeq=function(e,i){return e.s<i.s||e.s===i.s&&e.t<=i.t},t.transLeq=function(e,i){return e.t<i.t||e.t===i.t&&e.s<=i.s},t.edgeGoesLeft=function(e){return t.vertLeq(e.Dst,e.Org)},t.edgeGoesRight=function(e){return t.vertLeq(e.Org,e.Dst)},t.vertL1dist=function(e,i){return Math.abs(e.s-i.s)+Math.abs(e.t-i.t)},t.edgeEval=function(e,i,r){ki(t.vertLeq(e,i)&&t.vertLeq(i,r));var n=i.s-e.s,s=r.s-i.s;return n+s>0?n<s?i.t-e.t+(e.t-r.t)*(n/(n+s)):i.t-r.t+(r.t-e.t)*(s/(n+s)):0},t.edgeSign=function(e,i,r){ki(t.vertLeq(e,i)&&t.vertLeq(i,r));var n=i.s-e.s,s=r.s-i.s;return n+s>0?(i.t-r.t)*n+(i.t-e.t)*s:0},t.transEval=function(e,i,r){ki(t.transLeq(e,i)&&t.transLeq(i,r));var n=i.t-e.t,s=r.t-i.t;return n+s>0?n<s?i.s-e.s+(e.s-r.s)*(n/(n+s)):i.s-r.s+(r.s-e.s)*(s/(n+s)):0},t.transSign=function(e,i,r){ki(t.transLeq(e,i)&&t.transLeq(i,r));var n=i.t-e.t,s=r.t-i.t;return n+s>0?(i.s-r.s)*n+(i.s-e.s)*s:0},t.vertCCW=function(e,i,r){return e.s*(i.t-r.t)+i.s*(r.t-e.t)+r.s*(e.t-i.t)>=0},t.interpolate=function(e,i,r,n){return e=e<0?0:e,r=r<0?0:r,e<=r?r===0?(i+n)/2:i+(n-i)*(e/(e+r)):n+(i-n)*(r/(e+r))},t.intersect=function(e,i,r,n,s){var a,o,l;t.vertLeq(e,i)||(l=e,e=i,i=l),t.vertLeq(r,n)||(l=r,r=n,n=l),t.vertLeq(e,r)||(l=e,e=r,r=l,l=i,i=n,n=l),t.vertLeq(r,i)?t.vertLeq(i,n)?(a=t.edgeEval(e,r,i),o=t.edgeEval(r,i,n),a+o<0&&(a=-a,o=-o),s.s=t.interpolate(a,r.s,o,i.s)):(a=t.edgeSign(e,r,i),o=-t.edgeSign(e,n,i),a+o<0&&(a=-a,o=-o),s.s=t.interpolate(a,r.s,o,n.s)):s.s=(r.s+i.s)/2,t.transLeq(e,i)||(l=e,e=i,i=l),t.transLeq(r,n)||(l=r,r=n,n=l),t.transLeq(e,r)||(l=e,e=r,r=l,l=i,i=n,n=l),t.transLeq(r,i)?t.transLeq(i,n)?(a=t.transEval(e,r,i),o=t.transEval(r,i,n),a+o<0&&(a=-a,o=-o),s.t=t.interpolate(a,r.t,o,i.t)):(a=t.transSign(e,r,i),o=-t.transSign(e,n,i),a+o<0&&(a=-a,o=-o),s.t=t.interpolate(a,r.t,o,n.t)):s.t=(r.t+i.t)/2},t})(),wE=(function(){function t(){this.next=null,this.prev=null,this.anEdge=null,this.trail=null,this.n=0,this.marked=!1,this.inside=!1}return t})(),sR=(function(){function t(e){this.side=e,this.next=null,this.Org=null,this.Sym=null,this.Onext=null,this.Lnext=null,this.Lface=null,this.activeRegion=null,this.winding=0}return Object.defineProperty(t.prototype,"Rface",{get:function(){return this.Sym.Lface},set:function(e){this.Sym.Lface=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"Dst",{get:function(){return this.Sym.Org},set:function(e){this.Sym.Org=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"Oprev",{get:function(){return this.Sym.Lnext},set:function(e){this.Sym.Lnext=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"Lprev",{get:function(){return this.Onext.Sym},set:function(e){this.Onext.Sym=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"Dprev",{get:function(){return this.Lnext.Sym},set:function(e){this.Lnext.Sym=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"Rprev",{get:function(){return this.Sym.Onext},set:function(e){this.Sym.Onext=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"Dnext",{get:function(){return this.Sym.Onext.Sym},set:function(e){this.Sym.Onext.Sym=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"Rnext",{get:function(){return this.Sym.Lnext.Sym},set:function(e){this.Sym.Lnext.Sym=e},enumerable:!0,configurable:!0}),t})(),Pw=(function(){function t(){this.next=null,this.prev=null,this.anEdge=null,this.coords=[0,0,0],this.s=0,this.t=0,this.pqHandle=0,this.n=0,this.idx=0}return t})(),Fee=(function(){function t(){var e=new Pw,i=new wE,r=new sR(0),n=new sR(1);e.next=e.prev=e,e.anEdge=null,i.next=i.prev=i,r.next=r,r.Sym=n,n.next=n,n.Sym=r,this.vHead=e,this.fHead=i,this.eHead=r,this.eHeadSym=n}return t.prototype.makeEdge_=function(e){var i=new sR(0),r=new sR(1);e.Sym.side<e.side&&(e=e.Sym);var n=e.Sym.next;return r.next=n,n.Sym.next=i,i.next=e,e.Sym.next=r,i.Sym=r,i.Onext=i,i.Lnext=r,i.Org=null,i.Lface=null,i.winding=0,i.activeRegion=null,r.Sym=i,r.Onext=r,r.Lnext=i,r.Org=null,r.Lface=null,r.winding=0,r.activeRegion=null,i},t.prototype.splice_=function(e,i){var r=e.Onext,n=i.Onext;r.Sym.Lnext=i,n.Sym.Lnext=e,e.Onext=n,i.Onext=r},t.prototype.makeVertex_=function(e,i,r){var n=e;ki(n,"Vertex can't be null!");var s=r.prev;n.prev=s,s.next=n,n.next=r,r.prev=n,n.anEdge=i;var a=i;do a.Org=n,a=a.Onext;while(a!==i)},t.prototype.makeFace_=function(e,i,r){var n=e;ki(n,"Face can't be null");var s=r.prev;n.prev=s,s.next=n,n.next=r,r.prev=n,n.anEdge=i,n.trail=null,n.marked=!1,n.inside=r.inside;var a=i;do a.Lface=n,a=a.Lnext;while(a!==i)},t.prototype.killEdge_=function(e){e.Sym.side<e.side&&(e=e.Sym);var i=e.next,r=e.Sym.next;i.Sym.next=r,r.Sym.next=i},t.prototype.killVertex_=function(e,i){var r=e.anEdge,n=r;do n.Org=i,n=n.Onext;while(n!==r);var s=e.prev,a=e.next;a.prev=s,s.next=a},t.prototype.killFace_=function(e,i){var r=e.anEdge,n=r;do n.Lface=i,n=n.Lnext;while(n!==r);var s=e.prev,a=e.next;a.prev=s,s.next=a},t.prototype.makeEdge=function(){var e=new Pw,i=new Pw,r=new wE,n=this.makeEdge_(this.eHead);return this.makeVertex_(e,n,this.vHead),this.makeVertex_(i,n.Sym,this.vHead),this.makeFace_(r,n,this.fHead),n},t.prototype.splice=function(e,i){var r=!1,n=!1;if(e!==i){if(i.Org!==e.Org&&(n=!0,this.killVertex_(i.Org,e.Org)),i.Lface!==e.Lface&&(r=!0,this.killFace_(i.Lface,e.Lface)),this.splice_(i,e),!n){var s=new Pw;this.makeVertex_(s,i,e.Org),e.Org.anEdge=e}if(!r){var a=new wE;this.makeFace_(a,i,e.Lface),e.Lface.anEdge=e}}},t.prototype.delete=function(e){var i=e.Sym,r=!1;if(e.Lface!==e.Rface&&(r=!0,this.killFace_(e.Lface,e.Rface)),e.Onext===e)this.killVertex_(e.Org,null);else if(e.Rface.anEdge=e.Oprev,e.Org.anEdge=e.Onext,this.splice_(e,e.Oprev),!r){var n=new wE;this.makeFace_(n,e,e.Lface)}i.Onext===i?(this.killVertex_(i.Org,null),this.killFace_(i.Lface,null)):(e.Lface.anEdge=i.Oprev,i.Org.anEdge=i.Onext,this.splice_(i,i.Oprev)),this.killEdge_(e)},t.prototype.addEdgeVertex=function(e){var i=this.makeEdge_(e),r=i.Sym;this.splice_(i,e.Lnext),i.Org=e.Dst;var n=new Pw;return this.makeVertex_(n,r,i.Org),i.Lface=r.Lface=e.Lface,i},t.prototype.splitEdge=function(e){var i=this.addEdgeVertex(e),r=i.Sym;return this.splice_(e.Sym,e.Sym.Oprev),this.splice_(e.Sym,r),e.Dst=r.Org,r.Dst.anEdge=r.Sym,r.Rface=e.Rface,r.winding=e.winding,r.Sym.winding=e.Sym.winding,r.idx=e.idx,r.Sym.idx=e.Sym.idx,r},t.prototype.connect=function(e,i){var r=!1,n=this.makeEdge_(e),s=n.Sym;if(i.Lface!==e.Lface&&(r=!0,this.killFace_(i.Lface,e.Lface)),this.splice_(n,e.Lnext),this.splice_(s,i),n.Org=e.Dst,s.Org=i.Org,n.Lface=s.Lface=e.Lface,e.Lface.anEdge=s,!r){var a=new wE;this.makeFace_(a,n,e.Lface)}return n},t.prototype.zapFace=function(e){var i=e.anEdge,r,n,s,a,o;n=i.Lnext;do r=n,n=r.Lnext,r.Lface=null,r.Rface===null&&(r.Onext===r?this.killVertex_(r.Org,null):(r.Org.anEdge=r.Onext,this.splice_(r,r.Oprev)),s=r.Sym,s.Onext===s?this.killVertex_(s.Org,null):(s.Org.anEdge=s.Onext,this.splice_(s,s.Oprev)),this.killEdge_(r));while(r!=i);a=e.prev,o=e.next,o.prev=a,a.next=o},t.prototype.countFaceVerts_=function(e){var i=e.anEdge,r=0;do r++,i=i.Lnext;while(i!==e.anEdge);return r},t.prototype.mergeConvexFaces=function(e){var i,r,n,s,a,o,l;for(i=this.fHead.next;i!==this.fHead;i=i.next)if(i.inside)for(r=i.anEdge,a=r.Org;n=r.Lnext,s=r.Sym,s&&s.Lface&&s.Lface.inside&&(o=this.countFaceVerts_(i),l=this.countFaceVerts_(s.Lface),o+l-2<=e&&Ei.vertCCW(r.Lprev.Org,r.Org,s.Lnext.Lnext.Org)&&Ei.vertCCW(s.Lprev.Org,s.Org,r.Lnext.Lnext.Org)&&(n=s.Lnext,this.delete(s),r=null,s=null)),!(r&&r.Lnext.Org===a);)r=n;return!0},t.prototype.check=function(){var e=this.fHead,i=this.vHead,r=this.eHead,n,s,a,o,l,c;for(s=e,s=e;(n=s.next)!==e;s=n){ki(n.prev===s),l=n.anEdge;do ki(l.Sym!==l),ki(l.Sym.Sym===l),ki(l.Lnext.Onext.Sym===l),ki(l.Onext.Sym.Lnext===l),ki(l.Lface===n),l=l.Lnext;while(l!==n.anEdge)}for(ki(n.prev===s&&n.anEdge===null),o=i,o=i;(a=o.next)!==i;o=a){ki(a.prev===o),l=a.anEdge;do ki(l.Sym!==l),ki(l.Sym.Sym===l),ki(l.Lnext.Onext.Sym===l),ki(l.Onext.Sym.Lnext===l),ki(l.Org===a),l=l.Onext;while(l!==a.anEdge)}for(ki(a.prev===o&&a.anEdge===null),c=r,c=r;(l=c.next)!==r;c=l)ki(l.Sym.next===c.Sym),ki(l.Sym!==l),ki(l.Sym.Sym===l),ki(l.Org!==null),ki(l.Dst!==null),ki(l.Lnext.Onext.Sym===l),ki(l.Onext.Sym.Lnext===l);ki(l.Sym.next===c.Sym&&l.Sym===this.eHeadSym&&l.Sym.Sym===l&&l.Org===null&&l.Dst===null&&l.Lface===null&&l.Rface===null)},t})(),zee=(function(){function t(){this.handle=null}return t})(),jee=(function(){function t(){this.key=null,this.node=0}return t})(),gst=(function(){function t(e,i){this.leq=i,this.max=0,this.nodes=[],this.handles=[],this.initialized=!1,this.freeList=0,this.size=0,this.max=e,this.nodes=[],this.handles=[];for(var r=0;r<e+1;r++)this.nodes[r]=new zee,this.handles[r]=new jee;this.initialized=!1,this.nodes[1].handle=1,this.handles[1].key=null}return t.prototype.floatDown_=function(e){var i=this.nodes,r=this.handles,n,s,a;for(n=i[e].handle;;){if(a=e<<1,a<this.size&&this.leq(r[i[a+1].handle].key,r[i[a].handle].key)&&++a,ki(a<=this.max),s=i[a].handle,a>this.size||this.leq(r[n].key,r[s].key)){i[e].handle=n,r[n].node=e;break}i[e].handle=s,r[s].node=e,e=a}},t.prototype.floatUp_=function(e){var i=this.nodes,r=this.handles,n,s,a;for(n=i[e].handle;;){if(a=e>>1,s=i[a].handle,a===0||this.leq(r[s].key,r[n].key)){i[e].handle=n,r[n].node=e;break}i[e].handle=s,r[s].node=e,e=a}},t.prototype.init=function(){for(var e=this.size;e>=1;--e)this.floatDown_(e);this.initialized=!0},t.prototype.min=function(){return this.handles[this.nodes[1].handle].key},t.prototype.insert=function(e){var i,r;if(i=++this.size,i*2>this.max){this.max*=2;var n,s;for(s=this.nodes.length,this.nodes.length=this.max+1,n=s;n<this.nodes.length;n++)this.nodes[n]=new zee;for(s=this.handles.length,this.handles.length=this.max+1,n=s;n<this.handles.length;n++)this.handles[n]=new jee}return this.freeList===0?r=i:(r=this.freeList,this.freeList=this.handles[r].node),this.nodes[i].handle=r,this.handles[r].node=i,this.handles[r].key=e,this.initialized&&this.floatUp_(i),r},t.prototype.extractMin=function(){var e=this.nodes,i=this.handles,r=e[1].handle,n=i[r].key;return this.size>0&&(e[1].handle=e[this.size].handle,i[e[1].handle].node=1,i[r].key=null,i[r].node=this.freeList,this.freeList=r,--this.size,this.size>0&&this.floatDown_(1)),n},t.prototype.delete=function(e){var i=this.nodes,r=this.handles,n;ki(e>=1&&e<=this.max&&r[e].key!==null),n=r[e].node,i[n].handle=i[this.size].handle,r[i[n].handle].node=n,--this.size,n<=this.size&&(n<=1||this.leq(r[i[n>>1].handle].key,r[i[n].handle].key)?this.floatDown_(n):this.floatUp_(n)),r[e].key=null,r[e].node=this.freeList,this.freeList=e},t})(),LF=(function(){function t(){this.eUp=null,this.nodeUp=null,this.windingNumber=0,this.inside=!1,this.sentinel=!1,this.dirty=!1,this.fixUpperEdge=!1}return t})(),Vee=(function(){function t(){this.key=null,this.next=null,this.prev=null}return t})(),vst=(function(){function t(e,i){this.frame=e,this.leq=i,this.head=new Vee,this.head.next=this.head,this.head.prev=this.head}return t.prototype.min=function(){return this.head.next},t.prototype.max=function(){return this.head.prev},t.prototype.insert=function(e){return this.insertBefore(this.head,e)},t.prototype.search=function(e){var i=this.head;do i=i.next;while(i.key!==null&&!this.leq(this.frame,e,i.key));return i},t.prototype.insertBefore=function(e,i){do e=e.prev;while(e.key!==null&&!this.leq(this.frame,e.key,i));var r=new Vee;return r.key=i,r.next=e.next,e.next.prev=r,r.prev=e,e.next=r,r},t.prototype.delete=function(e){e.next.prev=e.prev,e.prev.next=e.next},t})(),yst=(function(){function t(){}return t.regionBelow=function(e){return e.nodeUp.prev.key},t.regionAbove=function(e){return e.nodeUp.next.key},t.debugEvent=function(e){},t.addWinding=function(e,i){e.winding+=i.winding,e.Sym.winding+=i.Sym.winding},t.edgeLeq=function(e,i,r){var n=e.event,s=i.eUp,a=r.eUp;if(s.Dst===n)return a.Dst===n?Ei.vertLeq(s.Org,a.Org)?Ei.edgeSign(a.Dst,s.Org,a.Org)<=0:Ei.edgeSign(s.Dst,a.Org,s.Org)>=0:Ei.edgeSign(a.Dst,n,a.Org)<=0;if(a.Dst===n)return Ei.edgeSign(s.Dst,n,s.Org)>=0;var o=Ei.edgeEval(s.Dst,n,s.Org),l=Ei.edgeEval(a.Dst,n,a.Org);return o>=l},t.deleteRegion=function(e,i){i.fixUpperEdge&&ki(i.eUp.winding===0),i.eUp.activeRegion=null,e.dict.delete(i.nodeUp)},t.fixUpperEdge=function(e,i,r){ki(i.fixUpperEdge),e.mesh.delete(i.eUp),i.fixUpperEdge=!1,i.eUp=r,r.activeRegion=i},t.topLeftRegion=function(e,i){var r=i.eUp.Org,n;do i=t.regionAbove(i);while(i.eUp.Org===r);if(i.fixUpperEdge){if(n=e.mesh.connect(t.regionBelow(i).eUp.Sym,i.eUp.Lnext),n===null)return null;t.fixUpperEdge(e,i,n),i=t.regionAbove(i)}return i},t.topRightRegion=function(e){var i=e.eUp.Dst;do e=t.regionAbove(e);while(e.eUp.Dst===i);return e},t.addRegionBelow=function(e,i,r){var n=new LF;return n.eUp=r,n.nodeUp=e.dict.insertBefore(i.nodeUp,n),n.fixUpperEdge=!1,n.sentinel=!1,n.dirty=!1,r.activeRegion=n,n},t.isWindingInside=function(e,i){switch(e.windingRule){case hn.ODD:return(i&1)!==0;case hn.NONZERO:return i!==0;case hn.POSITIVE:return i>0;case hn.NEGATIVE:return i<0;case hn.ABS_GEQ_TWO:return i>=2||i<=-2}throw new Error("Invalid winding rulle")},t.computeWinding=function(e,i){i.windingNumber=t.regionAbove(i).windingNumber+i.eUp.winding,i.inside=t.isWindingInside(e,i.windingNumber)},t.finishRegion=function(e,i){var r=i.eUp,n=r.Lface;n.inside=i.inside,n.anEdge=r,t.deleteRegion(e,i)},t.finishLeftRegions=function(e,i,r){for(var n,s=null,a=i,o=i.eUp;a!==r;){if(a.fixUpperEdge=!1,s=t.regionBelow(a),n=s.eUp,n.Org!=o.Org){if(!s.fixUpperEdge){t.finishRegion(e,a);break}n=e.mesh.connect(o.Lprev,n.Sym),t.fixUpperEdge(e,s,n)}o.Onext!==n&&(e.mesh.splice(n.Oprev,n),e.mesh.splice(o,n)),t.finishRegion(e,a),o=s.eUp,a=s}return o},t.addRightEdges=function(e,i,r,n,s,a){var o,l,c,u,h=!0;c=r;do ki(Ei.vertLeq(c.Org,c.Dst)),t.addRegionBelow(e,i,c.Sym),c=c.Onext;while(c!==n);for(s===null&&(s=t.regionBelow(i).eUp.Rprev),l=i,u=s;o=t.regionBelow(l),c=o.eUp.Sym,c.Org===u.Org;)c.Onext!==u&&(e.mesh.splice(c.Oprev,c),e.mesh.splice(u.Oprev,c)),o.windingNumber=l.windingNumber-c.winding,o.inside=t.isWindingInside(e,o.windingNumber),l.dirty=!0,!h&&t.checkForRightSplice(e,l)&&(t.addWinding(c,u),t.deleteRegion(e,l),e.mesh.delete(u)),h=!1,l=o,u=c;l.dirty=!0,ki(l.windingNumber-c.winding===o.windingNumber),a&&t.walkDirtyRegions(e,l)},t.spliceMergeVertices=function(e,i,r){e.mesh.splice(i,r)},t.vertexWeights=function(e,i,r){var n=Ei.vertL1dist(i,e),s=Ei.vertL1dist(r,e),a=.5*s/(n+s),o=.5*n/(n+s);e.coords[0]+=a*i.coords[0]+o*r.coords[0],e.coords[1]+=a*i.coords[1]+o*r.coords[1],e.coords[2]+=a*i.coords[2]+o*r.coords[2]},t.getIntersectData=function(e,i,r,n,s,a){i.coords[0]=i.coords[1]=i.coords[2]=0,i.idx=-1,t.vertexWeights(i,r,n),t.vertexWeights(i,s,a)},t.checkForRightSplice=function(e,i){var r=t.regionBelow(i),n=i.eUp,s=r.eUp;if(Ei.vertLeq(n.Org,s.Org)){if(Ei.edgeSign(s.Dst,n.Org,s.Org)>0)return!1;Ei.vertEq(n.Org,s.Org)?n.Org!==s.Org&&(e.pq.delete(n.Org.pqHandle),t.spliceMergeVertices(e,s.Oprev,n)):(e.mesh.splitEdge(s.Sym),e.mesh.splice(n,s.Oprev),i.dirty=r.dirty=!0)}else{if(Ei.edgeSign(n.Dst,s.Org,n.Org)<0)return!1;t.regionAbove(i).dirty=i.dirty=!0,e.mesh.splitEdge(n.Sym),e.mesh.splice(s.Oprev,n)}return!0},t.checkForLeftSplice=function(e,i){var r=t.regionBelow(i),n=i.eUp,s=r.eUp,a;if(ki(!Ei.vertEq(n.Dst,s.Dst)),Ei.vertLeq(n.Dst,s.Dst)){if(Ei.edgeSign(n.Dst,s.Dst,n.Org)<0)return!1;t.regionAbove(i).dirty=i.dirty=!0,a=e.mesh.splitEdge(n),e.mesh.splice(s.Sym,a),a.Lface.inside=i.inside}else{if(Ei.edgeSign(s.Dst,n.Dst,s.Org)>0)return!1;i.dirty=r.dirty=!0,a=e.mesh.splitEdge(s),e.mesh.splice(n.Lnext,s.Sym),a.Rface.inside=i.inside}return!0},t.checkForIntersect=function(e,i){var r=t.regionBelow(i),n=i.eUp,s=r.eUp,a=n.Org,o=s.Org,l=n.Dst,c=s.Dst,u,h,d=new Pw,f,p;if(ki(!Ei.vertEq(c,l)),ki(Ei.edgeSign(l,e.event,a)<=0),ki(Ei.edgeSign(c,e.event,o)>=0),ki(a!==e.event&&o!==e.event),ki(!i.fixUpperEdge&&!r.fixUpperEdge),a===o||(u=Math.min(a.t,l.t),h=Math.max(o.t,c.t),u>h))return!1;if(Ei.vertLeq(a,o)){if(Ei.edgeSign(c,a,o)>0)return!1}else if(Ei.edgeSign(l,o,a)<0)return!1;return t.debugEvent(e),Ei.intersect(l,a,c,o,d),ki(Math.min(a.t,l.t)<=d.t),ki(d.t<=Math.max(o.t,c.t)),ki(Math.min(c.s,l.s)<=d.s),ki(d.s<=Math.max(o.s,a.s)),Ei.vertLeq(d,e.event)&&(d.s=e.event.s,d.t=e.event.t),f=Ei.vertLeq(a,o)?a:o,Ei.vertLeq(f,d)&&(d.s=f.s,d.t=f.t),Ei.vertEq(d,a)||Ei.vertEq(d,o)?(t.checkForRightSplice(e,i),!1):!Ei.vertEq(l,e.event)&&Ei.edgeSign(l,e.event,d)>=0||!Ei.vertEq(c,e.event)&&Ei.edgeSign(c,e.event,d)<=0?c===e.event?(e.mesh.splitEdge(n.Sym),e.mesh.splice(s.Sym,n),i=t.topLeftRegion(e,i),n=t.regionBelow(i).eUp,t.finishLeftRegions(e,t.regionBelow(i),r),t.addRightEdges(e,i,n.Oprev,n,n,!0),!0):l===e.event?(e.mesh.splitEdge(s.Sym),e.mesh.splice(n.Lnext,s.Oprev),r=i,i=t.topRightRegion(i),p=t.regionBelow(i).eUp.Rprev,r.eUp=s.Oprev,s=t.finishLeftRegions(e,r,null),t.addRightEdges(e,i,s.Onext,n.Rprev,p,!0),!0):(Ei.edgeSign(l,e.event,d)>=0&&(t.regionAbove(i).dirty=i.dirty=!0,e.mesh.splitEdge(n.Sym),n.Org.s=e.event.s,n.Org.t=e.event.t),Ei.edgeSign(c,e.event,d)<=0&&(i.dirty=r.dirty=!0,e.mesh.splitEdge(s.Sym),s.Org.s=e.event.s,s.Org.t=e.event.t),!1):(e.mesh.splitEdge(n.Sym),e.mesh.splitEdge(s.Sym),e.mesh.splice(s.Oprev,n),n.Org.s=d.s,n.Org.t=d.t,n.Org.pqHandle=e.pq.insert(n.Org),t.getIntersectData(e,n.Org,a,l,o,c),t.regionAbove(i).dirty=i.dirty=r.dirty=!0,!1)},t.walkDirtyRegions=function(e,i){for(var r=t.regionBelow(i),n,s;;){for(;r.dirty;)i=r,r=t.regionBelow(r);if(!i.dirty&&(r=i,i=t.regionAbove(i),i===null||!i.dirty))return;if(i.dirty=!1,n=i.eUp,s=r.eUp,n.Dst!==s.Dst&&t.checkForLeftSplice(e,i)&&(r.fixUpperEdge?(t.deleteRegion(e,r),e.mesh.delete(s),r=t.regionBelow(i),s=r.eUp):i.fixUpperEdge&&(t.deleteRegion(e,i),e.mesh.delete(n),i=t.regionAbove(r),n=i.eUp)),n.Org!==s.Org)if(n.Dst!==s.Dst&&!i.fixUpperEdge&&!r.fixUpperEdge&&(n.Dst===e.event||s.Dst===e.event)){if(t.checkForIntersect(e,i))return}else t.checkForRightSplice(e,i);n.Org===s.Org&&n.Dst===s.Dst&&(t.addWinding(s,n),t.deleteRegion(e,i),e.mesh.delete(n),i=t.regionAbove(r))}},t.connectRightVertex=function(e,i,r){var n,s=r.Onext,a=t.regionBelow(i),o=i.eUp,l=a.eUp,c=!1;if(o.Dst!==l.Dst&&t.checkForIntersect(e,i),Ei.vertEq(o.Org,e.event)&&(e.mesh.splice(s.Oprev,o),i=t.topLeftRegion(e,i),s=t.regionBelow(i).eUp,t.finishLeftRegions(e,t.regionBelow(i),a),c=!0),Ei.vertEq(l.Org,e.event)&&(e.mesh.splice(r,l.Oprev),r=t.finishLeftRegions(e,a,null),c=!0),c){t.addRightEdges(e,i,r.Onext,s,s,!0);return}Ei.vertLeq(l.Org,o.Org)?n=l.Oprev:n=o,n=e.mesh.connect(r.Lprev,n),t.addRightEdges(e,i,n,n.Onext,n.Onext,!1),n.Sym.activeRegion.fixUpperEdge=!0,t.walkDirtyRegions(e,i)},t.connectLeftDegenerate=function(e,i,r){var n,s,a,o,l;if(n=i.eUp,Ei.vertEq(n.Org,r)){ki(!1),t.spliceMergeVertices(e,n,r.anEdge);return}if(!Ei.vertEq(n.Dst,r)){e.mesh.splitEdge(n.Sym),i.fixUpperEdge&&(e.mesh.delete(n.Onext),i.fixUpperEdge=!1),e.mesh.splice(r.anEdge,n),t.sweepEvent(e,r);return}ki(!1),i=t.topRightRegion(i),l=t.regionBelow(i),a=l.eUp.Sym,s=o=a.Onext,l.fixUpperEdge&&(ki(s!==a),t.deleteRegion(e,l),e.mesh.delete(a),a=s.Oprev),e.mesh.splice(r.anEdge,a),Ei.edgeGoesLeft(s)||(s=null),t.addRightEdges(e,i,a.Onext,o,s,!0)},t.connectLeftVertex=function(e,i){var r,n,s,a,o,l,c=new LF;if(c.eUp=i.anEdge.Sym,r=e.dict.search(c).key,n=t.regionBelow(r),!!n){if(a=r.eUp,o=n.eUp,Ei.edgeSign(a.Dst,i,a.Org)===0){t.connectLeftDegenerate(e,r,i);return}if(s=Ei.vertLeq(o.Dst,a.Dst)?r:n,r.inside||s.fixUpperEdge){if(s===r)l=e.mesh.connect(i.anEdge.Sym,a.Lnext);else{var u=e.mesh.connect(o.Dnext,i.anEdge);l=u.Sym}s.fixUpperEdge?t.fixUpperEdge(e,s,l):t.computeWinding(e,t.addRegionBelow(e,r,l)),t.sweepEvent(e,i)}else t.addRightEdges(e,r,i.anEdge,i.anEdge,null,!0)}},t.sweepEvent=function(e,i){e.event=i,t.debugEvent(e);for(var r=i.anEdge;r.activeRegion===null;)if(r=r.Onext,r===i.anEdge){t.connectLeftVertex(e,i);return}var n=t.topLeftRegion(e,r.activeRegion);ki(n!==null);var s=t.regionBelow(n),a=s.eUp,o=t.finishLeftRegions(e,s,null);o.Onext===a?t.connectRightVertex(e,n,o):t.addRightEdges(e,n,o.Onext,a,a,!0)},t.addSentinel=function(e,i,r,n){var s=new LF,a=e.mesh.makeEdge();a.Org.s=r,a.Org.t=n,a.Dst.s=i,a.Dst.t=n,e.event=a.Dst,s.eUp=a,s.windingNumber=0,s.inside=!1,s.fixUpperEdge=!1,s.sentinel=!0,s.dirty=!1,s.nodeUp=e.dict.insert(s)},t.initEdgeDict=function(e){e.dict=new vst(e,t.edgeLeq);var i=e.bmax[0]-e.bmin[0],r=e.bmax[1]-e.bmin[1],n=e.bmin[0]-i,s=e.bmax[0]+i,a=e.bmin[1]-r,o=e.bmax[1]+r;t.addSentinel(e,n,s,a),t.addSentinel(e,n,s,o)},t.doneEdgeDict=function(e){for(var i,r=0;(i=e.dict.min().key)!==null;)i.sentinel||(ki(i.fixUpperEdge),ki(++r===1)),ki(i.windingNumber===0),t.deleteRegion(e,i)},t.removeDegenerateEdges=function(e){var i,r,n,s=e.mesh.eHead;for(i=s.next;i!==s;i=r)r=i.next,n=i.Lnext,Ei.vertEq(i.Org,i.Dst)&&i.Lnext.Lnext!==i&&(t.spliceMergeVertices(e,n,i),e.mesh.delete(i),i=n,n=i.Lnext),n.Lnext===i&&(n!==i&&((n===r||n===r.Sym)&&(r=r.next),e.mesh.delete(n)),(i===r||i===r.Sym)&&(r=r.next),e.mesh.delete(i))},t.initPriorityQ=function(e){var i,r,n,s=0;for(n=e.mesh.vHead,r=n.next;r!==n;r=r.next)s++;for(s+=8,i=e.pq=new gst(s,Ei.vertLeq),n=e.mesh.vHead,r=n.next;r!==n;r=r.next)r.pqHandle=i.insert(r);return r!==n?!1:(i.init(),!0)},t.donePriorityQ=function(e){e.pq=null},t.removeDegenerateFaces=function(e,i){var r,n,s;for(r=i.fHead.next;r!==i.fHead;r=n)n=r.next,s=r.anEdge,ki(s.Lnext!==s),s.Lnext.Lnext===s&&(t.addWinding(s.Onext,s),e.mesh.delete(s));return!0},t.computeInterior=function(e,i){i===void 0&&(i=!0);var r,n;if(t.removeDegenerateEdges(e),!t.initPriorityQ(e))return!1;for(t.initEdgeDict(e);(r=e.pq.extractMin())!==null;){for(;n=e.pq.min(),!(n===null||!Ei.vertEq(n,r));)n=e.pq.extractMin(),t.spliceMergeVertices(e,r.anEdge,n.anEdge);t.sweepEvent(e,r)}return e.event=e.dict.min().key.eUp.Org,t.debugEvent(e),t.doneEdgeDict(e),t.donePriorityQ(e),t.removeDegenerateFaces(e,e.mesh)?(i&&e.mesh.check(),!0):!1},t})(),xst=(function(){function t(){this.mesh=new Fee,this.normal=[0,0,0],this.sUnit=[0,0,0],this.tUnit=[0,0,0],this.bmin=[0,0],this.bmax=[0,0],this.windingRule=hn.ODD,this.dict=null,this.pq=null,this.event=null,this.vertexIndexCounter=0,this.vertices=[],this.vertexIndices=[],this.vertexCount=0,this.elements=[],this.elementCount=0}return t.prototype.dot_=function(e,i){return e[0]*i[0]+e[1]*i[1]+e[2]*i[2]},t.prototype.normalize_=function(e){var i=e[0]*e[0]+e[1]*e[1]+e[2]*e[2];if(!i)throw"Zero-size vector!";i=Math.sqrt(i),e[0]/=i,e[1]/=i,e[2]/=i},t.prototype.longAxis_=function(e){var i=0;return Math.abs(e[1])>Math.abs(e[0])&&(i=1),Math.abs(e[2])>Math.abs(e[i])&&(i=2),i},t.prototype.computeNormal_=function(e){var i,r,n,s,a,o,l=[0,0,0],c=[0,0,0],u=[0,0,0],h=[0,0,0],d=[0,0,0],f=[null,null,null],p=[null,null,null],g=this.mesh.vHead;i=g.next;for(var m=0;m<3;++m)s=i.coords[m],c[m]=s,p[m]=i,l[m]=s,f[m]=i;for(i=g.next;i!==g;i=i.next)for(var y=0;y<3;++y)s=i.coords[y],s<c[y]&&(c[y]=s,p[y]=i),s>l[y]&&(l[y]=s,f[y]=i);var b=0;if(l[1]-c[1]>l[0]-c[0]&&(b=1),l[2]-c[2]>l[b]-c[b]&&(b=2),c[b]>=l[b]){e[0]=0,e[1]=0,e[2]=1;return}for(o=0,r=p[b],n=f[b],u[0]=r.coords[0]-n.coords[0],u[1]=r.coords[1]-n.coords[1],u[2]=r.coords[2]-n.coords[2],i=g.next;i!==g;i=i.next)h[0]=i.coords[0]-n.coords[0],h[1]=i.coords[1]-n.coords[1],h[2]=i.coords[2]-n.coords[2],d[0]=u[1]*h[2]-u[2]*h[1],d[1]=u[2]*h[0]-u[0]*h[2],d[2]=u[0]*h[1]-u[1]*h[0],a=d[0]*d[0]+d[1]*d[1]+d[2]*d[2],a>o&&(o=a,e[0]=d[0],e[1]=d[1],e[2]=d[2]);o<=0&&(e[0]=e[1]=e[2]=0,e[this.longAxis_(u)]=1)},t.prototype.checkOrientation_=function(){for(var e=this.mesh.fHead,i,r=this.mesh.vHead,n,s=0,a=e.next;a!==e;a=a.next)if(n=a.anEdge,!(n.winding<=0))do s+=(n.Org.s-n.Dst.s)*(n.Org.t+n.Dst.t),n=n.Lnext;while(n!==a.anEdge);if(s<0){for(i=r.next;i!==r;i=i.next)i.t=-i.t;this.tUnit[0]=-this.tUnit[0],this.tUnit[1]=-this.tUnit[1],this.tUnit[2]=-this.tUnit[2]}},t.prototype.projectPolygon_=function(){var e=this.mesh.vHead,i=[0,0,0],r,n,s=!1;i[0]=this.normal[0],i[1]=this.normal[1],i[2]=this.normal[2],!i[0]&&!i[1]&&!i[2]&&(this.computeNormal_(i),s=!0),r=this.sUnit,n=this.tUnit;var a=this.longAxis_(i);r[a]=0,r[(a+1)%3]=1,r[(a+2)%3]=0,n[a]=0,n[(a+1)%3]=0,n[(a+2)%3]=i[a]>0?1:-1;for(var o=e.next;o!==e;o=o.next)o.s=this.dot_(o.coords,r),o.t=this.dot_(o.coords,n);s&&this.checkOrientation_();for(var l=!0,c=e.next;c!==e;c=c.next)l?(this.bmin[0]=this.bmax[0]=c.s,this.bmin[1]=this.bmax[1]=c.t,l=!1):(c.s<this.bmin[0]&&(this.bmin[0]=c.s),c.s>this.bmax[0]&&(this.bmax[0]=c.s),c.t<this.bmin[1]&&(this.bmin[1]=c.t),c.t>this.bmax[1]&&(this.bmax[1]=c.t))},t.prototype.addWinding_=function(e,i){e.winding+=i.winding,e.Sym.winding+=i.Sym.winding},t.prototype.tessellateMonoRegion_=function(e,i){var r,n;if(r=i.anEdge,!(r.Lnext!==r&&r.Lnext.Lnext!==r))throw"Mono region invalid";for(;Ei.vertLeq(r.Dst,r.Org);r=r.Lprev);for(;Ei.vertLeq(r.Org,r.Dst);r=r.Lnext);n=r.Lprev;for(var s=void 0;r.Lnext!==n;)if(Ei.vertLeq(r.Dst,n.Org)){for(;n.Lnext!==r&&(Ei.edgeGoesLeft(n.Lnext)||Ei.edgeSign(n.Org,n.Dst,n.Lnext.Dst)<=0);)s=e.connect(n.Lnext,n),n=s.Sym;n=n.Lprev}else{for(;n.Lnext!==r&&(Ei.edgeGoesRight(r.Lprev)||Ei.edgeSign(r.Dst,r.Org,r.Lprev.Org)>=0);)s=e.connect(r,r.Lprev),r=s.Sym;r=r.Lnext}if(n.Lnext===r)throw"Mono region invalid";for(;n.Lnext.Lnext!==r;)s=e.connect(n.Lnext,n),n=s.Sym;return!0},t.prototype.tessellateInterior_=function(e){for(var i,r=e.fHead.next;r!==e.fHead;r=i)if(i=r.next,r.inside&&!this.tessellateMonoRegion_(e,r))return!1;return!0},t.prototype.discardExterior_=function(e){for(var i,r=e.fHead.next;r!==e.fHead;r=i)i=r.next,r.inside||e.zapFace(r)},t.prototype.setWindingNumber_=function(e,i,r){for(var n,s=e.eHead.next;s!==e.eHead;s=n)n=s.next,s.Rface.inside!==s.Lface.inside?s.winding=s.Lface.inside?i:-i:r?e.delete(s):s.winding=0},t.prototype.getNeighbourFace_=function(e){return!e.Rface||!e.Rface.inside?-1:e.Rface.n},t.prototype.outputPolymesh_=function(e,i,r,n){var s,a=0,o=0,l;r>3&&e.mergeConvexFaces(r);for(var c=e.vHead.next;c!==e.vHead;c=c.next)c.n=-1;for(var u=e.fHead.next;u!==e.fHead;u=u.next)if(u.n=-1,!!u.inside){s=u.anEdge,l=0;do{var c=s.Org;c.n===-1&&(c.n=o,o++),l++,s=s.Lnext}while(s!==u.anEdge);if(l>r)throw"Face vertex greater that support polygon";u.n=a,++a}this.elementCount=a,i===zs.CONNECTED_POLYGONS&&(a*=2),this.elements=[],this.elements.length=a*r,this.vertexCount=o,this.vertices=[],this.vertices.length=o*n,this.vertexIndices=[],this.vertexIndices.length=o;for(var c=e.vHead.next;c!==e.vHead;c=c.next)if(c.n!==-1){var h=c.n*n;this.vertices[h+0]=c.coords[0],this.vertices[h+1]=c.coords[1],n>2&&(this.vertices[h+2]=c.coords[2]),this.vertexIndices[c.n]=c.idx}for(var d=0,u=e.fHead.next;u!==e.fHead;u=u.next)if(u.inside){s=u.anEdge,l=0;do{var c=s.Org;this.elements[d++]=c.n,l++,s=s.Lnext}while(s!==u.anEdge);for(var f=l;f<r;++f)this.elements[d++]=-1;if(i===zs.CONNECTED_POLYGONS){s=u.anEdge;do this.elements[d++]=this.getNeighbourFace_(s),s=s.Lnext;while(s!==u.anEdge);for(var p=l;p<r;++p)this.elements[d++]=-1}}},t.prototype.outputContours_=function(e,i){var r,n,s=0,a=0;this.vertexCount=0,this.elementCount=0;for(var o=e.fHead.next;o!==e.fHead;o=o.next)if(o.inside){n=r=o.anEdge;do this.vertexCount++,r=r.Lnext;while(r!==n);this.elementCount++}this.elements=[],this.elements.length=this.elementCount*2,this.vertices=[],this.vertices.length=this.vertexCount*i,this.vertexIndices=[],this.vertexIndices.length=this.vertexCount;var l=0,c=0,u=0;s=0;for(var o=e.fHead.next;o!==e.fHead;o=o.next)if(o.inside){a=0,n=r=o.anEdge;do this.vertices[l++]=r.Org.coords[0],this.vertices[l++]=r.Org.coords[1],i>2&&(this.vertices[l++]=r.Org.coords[2]),this.vertexIndices[c++]=this.vertexIdCallback?this.vertexIdCallback(r):r.Org.idx,a++,r=r.Lnext;while(r!==n);this.elements[u++]=s,this.elements[u++]=a,s+=a}},t.prototype.addContour=function(e,i){this.mesh===null&&(this.mesh=new Fee),e<2&&(e=2),e>3&&(e=3);for(var r=null,n=0;n<i.length;n+=e)r===null?(r=this.mesh.makeEdge(),this.mesh.splice(r,r.Sym)):(this.mesh.splitEdge(r),r=r.Lnext),r.Org.coords[0]=i[n+0],r.Org.coords[1]=i[n+1],e>2?r.Org.coords[2]=i[n+2]:r.Org.coords[2]=0,r.Org.idx=this.vertexIndexCounter++,this.edgeCreateCallback&&this.edgeCreateCallback(r),r.winding=1,r.Sym.winding=-1},t.prototype.tesselate=function(e,i,r,n,s,a){if(e===void 0&&(e=hn.ODD),i===void 0&&(i=zs.POLYGONS),a===void 0&&(a=!0),this.vertices=[],this.elements=[],this.vertexIndices=[],this.vertexIndexCounter=0,s&&(this.normal[0]=s[0],this.normal[1]=s[1],this.normal[2]=s[2]),this.windingRule=e,n<2&&(n=2),n>3&&(n=3),!this.mesh)return!1;this.projectPolygon_(),yst.computeInterior(this,a);var o=this.mesh;return i===zs.BOUNDARY_CONTOURS?this.setWindingNumber_(o,1,!0):this.tessellateInterior_(o),a&&o.check(),i===zs.BOUNDARY_CONTOURS?this.outputContours_(o,n):this.outputPolymesh_(o,i,r,n),!0},t})();function kg(t){var e=t.windingRule,i=e===void 0?hn.ODD:e,r=t.elementType,n=r===void 0?zs.POLYGONS:r,s=t.polySize,a=s===void 0?3:s,o=t.vertexSize,l=o===void 0?2:o,c=t.normal,u=c===void 0?[0,0,1]:c,h=t.contours,d=h===void 0?[]:h,f=t.strict,p=f===void 0?!0:f,g=t.debug,m=g===void 0?!1:g;if(!d&&p)throw new Error("Contours can't be empty");if(d){var y=new xst;t.edgeCreateCallback&&(y.edgeCreateCallback=t.edgeCreateCallback),t.vertexIdCallback&&(y.vertexIdCallback=t.vertexIdCallback);for(var b=0;b<d.length;b++)y.addContour(l||2,d[b]);return y.tesselate(i,n,a,l,u,p),{vertices:y.vertices,vertexIndices:y.vertexIndices,vertexCount:y.vertexCount,elements:y.elements,elementCount:y.elementCount,mesh:m?y.mesh:void 0}}}hn.ODD;hn.NONZERO;hn.POSITIVE;hn.NEGATIVE;hn.ABS_GEQ_TWO;zs.POLYGONS;zs.CONNECTED_POLYGONS;zs.BOUNDARY_CONTOURS;var V5=class{constructor(t=256,e=!1){this.capacity=t,this.size=0,this.debug=e,this.debug&&console.log(`allocating with cap ${t}`);let i=t*V5.eSize;this.buffer=new ArrayBuffer(i);let r=Float32Array.BYTES_PER_ELEMENT,n=0;this.positions=new Float32Array(this.buffer,n*r,3*t),n+=3*t,this.normals=new Float32Array(this.buffer,n*r,3*t),n+=3*t,this.uvs=new Float32Array(this.buffer,n*r,2*t)}realloc(t,e=!1){if(t<this.size)throw Error("cannot shrink buffer");if(t<=this.capacity&&!e)return;this.debug&&console.log(`resizing from ${this.capacity}  ${t}`);let i=t*V5.eSize,r=new ArrayBuffer(i),n=Float32Array.BYTES_PER_ELEMENT,s=0,a=new Float32Array(r,s*n,3*t);s+=3*t;let o=new Float32Array(r,s*n,3*t);s+=3*t;let l=new Float32Array(r,s*n,2*t);e?(a.set(this.positions.subarray(0,this.size*3)),o.set(this.normals.subarray(0,this.size*3)),l.set(this.uvs.subarray(0,this.size*2))):(a.set(this.positions),o.set(this.normals),l.set(this.uvs)),this.buffer=r,this.positions=a,this.normals=o,this.uvs=l,this.capacity=t}get(t=1){let e=this.size+t;if(e>this.capacity){let r=this.capacity;for(;e>r;)r*=2;this.realloc(r)}let i=this.size;return this.size=e,i}reserve(t){let e=this.size+t;e>this.capacity&&this.realloc(e)}shrink(){this.debug&&console.log(`shrinking ${this.capacity}  ${this.size}`),this.realloc(this.size,!0)}},qfe=V5;qfe.eSize=8*Float32Array.BYTES_PER_ELEMENT;var bst=class{constructor(t=[],e=(i,r)=>i<r?-1:i>r?1:0){if(this.data=t,this.length=this.data.length,this.compare=e,this.length>0)for(let i=(this.length>>1)-1;i>=0;i--)this._down(i)}push(t){this.data.push(t),this._up(this.length++)}pop(){if(this.length===0)return;let t=this.data[0],e=this.data.pop();return--this.length>0&&(this.data[0]=e,this._down(0)),t}peek(){return this.data[0]}_up(t){let{data:e,compare:i}=this,r=e[t];for(;t>0;){let n=t-1>>1,s=e[n];if(i(r,s)>=0)break;e[t]=s,t=n}e[t]=r}_down(t){let{data:e,compare:i}=this,r=this.length>>1,n=e[t];for(;t<r;){let s=(t<<1)+1,a=s+1;if(a<this.length&&i(e[a],e[s])<0&&(s=a),i(e[s],n)>=0)break;e[t]=e[s],t=s}e[t]=n}};function wst(t,e,i=1,r=!1){let n=1/0,s=1/0,a=-1/0,o=-1/0;for(let[b,w]of t[0])b<n&&(n=b),w<s&&(s=w),b>a&&(a=b),w>o&&(o=w);let l=a-n,c=o-s,u=Math.max(i,Math.min(l,c));if(u===i){let b=[n,s];return b.distance=0,b.distance}let h=new bst([],(b,w)=>w.max-b.max),d=Sst(t),f=new L3(n+l/2,s+c/2,0,t);f.d>d.d&&(d=f);let p=2;function g(b,w,E){let M=new L3(b,w,E,t);if(p++,M.max>d.d+i&&h.push(M),M.d>d.d&&(d=M,r&&console.log(`found best ${Math.round(1e4*M.d)/1e4} after ${p} probes`),d.d>e))return e}let m=u/2;for(let b=n;b<a;b+=u)for(let w=s;w<o;w+=u)g(b+m,w+m,m);for(;h.length;){let{max:b,x:w,y:E,h:M}=h.pop();if(b-d.d<=i)break;m=M/2,g(w-m,E-m,m),g(w+m,E-m,m),g(w-m,E+m,m),g(w+m,E+m,m)}r&&console.log(`num probes: ${p}
best distance: ${d.d}`);let y=[d.x,d.y];return y.distance=d.d,y.distance}function L3(t,e,i,r){this.x=t,this.y=e,this.h=i,this.d=_st(t,e,r),this.max=this.d+this.h*Math.SQRT2}function _st(t,e,i){let r=!1,n=1/0;for(let s of i)for(let a=0,o=s.length,l=o-1;a<o;l=a++){let c=s[a],u=s[l];c[1]>e!=u[1]>e&&t<(u[0]-c[0])*(e-c[1])/(u[1]-c[1])+c[0]&&(r=!r),n=Math.min(n,Est(t,e,c,u))}return n===0?0:(r?1:-1)*Math.sqrt(n)}function Sst(t){let e=0,i=0,r=0,n=t[0];for(let a=0,o=n.length,l=o-1;a<o;l=a++){let c=n[a],u=n[l],h=c[0]*u[1]-u[0]*c[1];i+=(c[0]+u[0])*h,r+=(c[1]+u[1])*h,e+=h*3}let s=new L3(i/e,r/e,0,t);return e===0||s.d<0?new L3(n[0][0],n[0][1],0,t):s}function Est(t,e,i,r){let n=i[0],s=i[1],a=r[0]-n,o=r[1]-s;if(a!==0||o!==0){let l=((t-n)*a+(e-s)*o)/(a*a+o*o);l>1?(n=r[0],s=r[1]):l>0&&(n+=a*l,s+=o*l)}return a=t-n,o=e-s,a*a+o*o}var e8={vertices:[160,160,-160,160,-160,-160,160,-160],vertexIndices:[1,0,3,2],vertexCount:4,elements:[0,4],elementCount:1,mesh:void 0},Xfe={vertices:[],vertexIndices:[],vertexCount:0,elements:[],elementCount:0,mesh:void 0},$fe={vertices:[-160,160,160,-160,160,160,-160,-160],vertexIndices:[1,3,0,2],vertexCount:4,elements:[0,1,2,1,0,3],elementCount:2,mesh:void 0},kF=(t,e)=>([i,r])=>(r<i&&(r+=e),(t>=i?t:t+e)<=r),t8=class extends oi{constructor(t,e,i=0,r=12,n=3,s=hn.ODD,a=!1){super(),this.forPathBevel=a,this.type="ShapeGeometry",this.vertexCache={},this._shape=t,this._depth=e,this._curveSegments=r,this._bevelSegmentsInput=n;let o=this._shape.extractShapePointsToFlatArray([],r),l=this._shape.shapeHoles.map(R=>{let I=R.extractShapePointsToFlatArray([],r),k=[];for(let z=I.length-1;z>=1;z-=2){let V=I[z-1],F=I[z-0];k.push(V,F)}return k}),c=[],u=[];for(let R=0;R<o.length;R+=2)u.push([o[R],o[R+1]]);c.push(u);for(let R=0;R<l.length;R++){let I=l[R],k=[];for(let z=0;z<I.length;z+=2)k.push([I[z],I[z+1]]);c.push(k)}let h;t.isText?h=new rG().setFromPoints(t.points.map(R=>R.position)).getSize(new Ae).length()*.1:c[0].length===0?h=i:i>0?h=wst(c,i):h=1e-5,i<=0?(this._bevel=0,this._bevelSegments=0):(this._bevel=Math.min(i,h,e/2),this._bevelSegments=Math.floor(n));let d;try{d=kg({windingRule:s,elementType:zs.BOUNDARY_CONTOURS,vertexSize:2,strict:!0,contours:[o]})}catch{d=e8}let f;try{f=kg({windingRule:hn.ODD,elementType:zs.BOUNDARY_CONTOURS,vertexSize:2,strict:!0,contours:[...l]})}catch{f=Xfe}if(!d)throw new Error("error generating geometry");let p=d.elementCount;if(f){d.elementCount+=f.elementCount;for(let R=0;R<f.elements.length;R++){let I=f.elements[R],k=R%2===0?d.vertexCount:0;d.elements.push(I+k)}for(let R=0;R<f.vertexIndices.length;R++){let I=f.vertexIndices[R],k=d.vertexCount;d.vertexIndices.push(I+k)}for(let R=0;R<f.vertices.length;R++){let I=f.vertices[R];d.vertices.push(I)}}let g=1/0,m=-1/0,y=1/0,b=-1/0;for(let R=0,I=d.vertexCount;R<I;R++){let k=R*2,z=d.vertices[k+0],V=d.vertices[k+1];z<g&&(g=z),z>m&&(m=z),V<y&&(y=V),V>b&&(b=V)}this._minX=g,this._minY=y,this._width=m-g,this._height=b-y,this._buffer=new qfe(this._computeBufferEstimatedSize(d));let w=[],E=[];for(let R=d.elementCount-1;R>=0;R--){let I=R>=p,k=R*2,z=d.elements[k+0],V=d.elements[k+1],F=z+V,$={start:z,count:V,normals:[],continuous:[],concave:[]},K=z,X=F-1,U=z+1,Y=this._shape.roundedCurves.length;do{let fe=K-z,se=d.vertices[X*2+0],re=d.vertices[X*2+1],le=d.vertices[K*2+0],he=d.vertices[K*2+1],ve=d.vertices[U*2+0],xe=d.vertices[U*2+1],Se=le-se,Ce=he-re,ce=Math.sqrt(Se*Se+Ce*Ce);Se/=ce,Ce/=ce;let Fe=le-ve,De=he-xe,He=Math.sqrt(Fe*Fe+De*De);Fe/=He,De/=He,$.normals[fe*2+0]=-De,$.normals[fe*2+1]=Fe,$.concave[fe]=Se*De-Ce*Fe>0;let Be=d.vertexIndices[K];if(Array.isArray(Be))$.continuous[fe]=!1;else{let[$e,ze]=this._shape.getCurveIndexFromVertexId(Be-1,!0);if(ze>0&&ze<1)$.continuous[fe]=!0;else{let it=ze===1?$e+1:$e-1;it=(it+Y)%Y;let wt=ze===1?0:1,ge=this._shape.roundedCurves[$e].getTangent(ze),G=this._shape.roundedCurves[it].getTangent(wt);$.continuous[fe]=ge.dot(G)>.95}}I&&($.normals[fe*2+0]*=-1,$.normals[fe*2+1]*=-1),[X,K,U]=[K,U,U+1],U>=F&&(U-=V)}while(U!==z+1);let Z=[];Z.push({bevelI:0,angle:0,size:0,boundary:{vertices:d.vertices.slice(z*2,F*2),vertexCount:V,vertexIndices:new Array(V).fill(!0).map((fe,se)=>[se,se]),elements:[0,V],elementCount:1,mesh:null},reverseMap:[],insetPoints:d.vertices.slice(z*2,F*2)});let j=0;for(let fe=1;fe<=this._bevelSegments;fe++){let se=fe/this._bevelSegments*Math.PI/2,re=(1-Math.cos(se))*this._bevel,le=[],he=[],ve=0;for(let Se=0;Se<V;Se++){let Ce=Se*2,ce=(Se-1+V)%V*2,Fe=d.vertices[$.start*2+Ce+0],De=d.vertices[$.start*2+Ce+1],He=-$.normals[ce+0]*re,Be=-$.normals[ce+1]*re,$e=-$.normals[Ce+0]*re,ze=-$.normals[Ce+1]*re;if($.concave[Se]||!$.concave[Se]&&I){let it=Math.atan2(Be,He),wt=Math.atan2(ze,$e);wt>it&&(wt-=Math.PI*2);let ge=wt-it;if($.continuous[Se]||I){let G=it+ge/2,Q=Math.cos(G)*re,we=Math.sin(G)*re;le[2*ve+0]=Fe+Q*(I?-1:1),le[2*ve+1]=De+we*(I?-1:1),he[ve]=Se,ve++}else{let G=Math.max(1,Math.floor(r/4*Math.abs(ge)/Math.PI));for(let Q=0;Q<=G;Q++){let we=it+ge*(Q/G),te=Math.cos(we)*re,Ne=Math.sin(we)*re;le[2*ve+0]=Fe+te,le[2*ve+1]=De+Ne,he[ve]=Se,ve++}}}else le[2*ve+0]=Fe+He,le[2*ve+1]=De+Be,he[ve]=Se,ve++,le[2*ve+0]=Fe,le[2*ve+1]=De,he[ve]=Se,ve++,le[2*ve+0]=Fe+$e,le[2*ve+1]=De+ze,he[ve]=Se,ve++}let xe=kg({windingRule:hn.POSITIVE,elementType:zs.BOUNDARY_CONTOURS,vertexSize:2,strict:!0,contours:[le],edgeCreateCallback:Se=>{let Ce=Se.Org.idx,ce=he[Ce],Fe=he[(Ce+1)%he.length];Se.idx=[ce,Fe],Se.Sym.idx=[Fe,ce]},vertexIdCallback:Se=>{let Ce=Se.Lprev.idx;return[Ce?Ce[1]:0,Se.idx?Se.idx[0]:0]}});if(!xe)throw console.log("Error"),new Error(`error generating bevel geometry for ${fe}'th loop`);if(!xe.vertexCount){let Se=(fe-1)/this._bevelSegments*Math.PI/2;j=(1-Math.sin(Se))*this._bevel;break}for(let Se=0;Se<xe.vertexIndices.length;Se++){let[Ce,ce]=xe.vertexIndices[Se];if(Ce===ce)continue;let Fe=ce;ce<Ce&&(Fe+=V);for(let De=Ce;De<Fe;De++){let He=De%V,Be=(De+1)%V;if(!$.continuous[He]||!$.continuous[Be]){xe.vertexIndices[Se]=[Ce,He],xe.vertexIndices.splice(Se+1,0,[Be,ce]),xe.vertices.splice((Se+1)*2,0,xe.vertices[Se*2],xe.vertices[Se*2+1]);break}}}Z.push({bevelI:fe,angle:se,size:re,boundary:xe,reverseMap:he,insetPoints:le})}let ee=(fe,se,re)=>{let le=0,he=fe.boundary.vertexIndices.length;for(;le<he&&re(fe.boundary.vertexIndices[se]);)se=(se+1)%he,le++;return le},pe=w.length;for(let fe=1;fe<Z.length;fe++){let se=Z[fe-1],re=Z[fe],le=se.boundary.vertexIndices.length,he=re.boundary.vertexIndices.length;if(!le||!he)break;let ve=$.concave.length,xe=0,Se=kF(xe,V);for(;!se.boundary.vertexIndices.filter(Se).length||!re.boundary.vertexIndices.filter(Se).length;)xe++,Se=kF(xe,V);let Ce=se.boundary.vertexIndices.findIndex(Se),ce=re.boundary.vertexIndices.findIndex(Se);do Ce=(Ce+1)%le;while(Se(se.boundary.vertexIndices[Ce]));do ce=(ce+1)%he;while(Se(re.boundary.vertexIndices[ce]));xe=(xe+1)%V;let Fe=xe,De=0,He=this._buildBevelVert($,se,(Ce-1+le)%le,void 0,De),Be=this._buildBevelVert($,re,(ce-1+he)%he,void 0,De),$e=He,ze=Be,it,wt,ge=!1;do{De=(xe||ve)/ve,Se=kF(xe,V);let G=ee(se,Ce,Se),Q=ee(re,ce,Se),we=ge;if(ge=!1,G&&!Q){for(let te=0;te<G;te++)it=this._buildBevelVert($,se,(Ce+te)%le,te/(G-1),De),w.push($e.topN,it.topP,ze.topN),a===!1&&w.push(it.bottomP,$e.bottomN,ze.bottomN),$e=it;ge=!0}else if(!G&&Q)for(let te=0;te<Q;te++)wt=this._buildBevelVert($,re,(ce+te)%he,te/(Q-1),De),w.push(ze.topN,$e.topP,wt.topP),a===!1&&w.push($e.bottomP,ze.bottomN,wt.bottomP),ze=wt;else if(G&&Q)if(it=this._buildBevelVert($,se,Ce,0,De),wt=this._buildBevelVert($,re,ce,0,De),we?(w.push($e.topN,wt.topP,ze.topN),w.push($e.topN,it.topP,wt.topP),a===!1&&(w.push(wt.bottomP,$e.bottomN,ze.bottomN),w.push(wt.bottomP,it.bottomP,$e.bottomN))):(w.push(ze.topN,$e.topN,it.topP),w.push(ze.topN,it.topP,wt.topP),a===!1&&(w.push(it.bottomP,$e.bottomN,ze.bottomN),w.push(it.bottomP,ze.bottomN,wt.bottomP))),$e=it,ze=wt,G===Q)for(let te=1;te<G;te++)it=this._buildBevelVert($,se,(Ce+te)%le,te/(G-1),De),wt=this._buildBevelVert($,re,(ce+te)%he,te/(Q-1),De),w.push($e.topN,it.topP,ze.topN),w.push(ze.topN,it.topP,wt.topP),a===!1&&(w.push(it.bottomP,$e.bottomN,ze.bottomN),w.push(it.bottomP,ze.bottomN,wt.bottomP)),$e=it,ze=wt;else if(G>Q){let te=G/Q,Ne=0;for(let Le=1;Le<G;Le++)it=this._buildBevelVert($,se,(Ce+Le)%le,Le/(G-1),De),w.push($e.topN,it.topP,ze.topN),a===!1&&w.push(it.bottomP,$e.bottomN,ze.bottomN),$e=it,Le>(Ne+1)*te&&(Ne++,wt=this._buildBevelVert($,re,(ce+Ne)%he,Ne/(Q-1),De),w.push(ze.topN,it.topP,wt.topP),a===!1&&w.push(it.bottomP,ze.bottomN,wt.bottomP),ze=wt)}else{let te=Q/G,Ne=0;for(let Le=1;Le<Q;Le++)wt=this._buildBevelVert($,re,(ce+Le)%he,Le/(Q-1),De),w.push(ze.topN,it.topP,wt.topP),a===!1&&w.push(it.bottomP,ze.bottomN,wt.bottomP),ze=wt,Le>(Ne+1)*te&&(Ne++,it=this._buildBevelVert($,se,(Ce+Ne)%le,Ne/(G-1),De),w.push($e.topN,it.topP,ze.topN),a===!1&&w.push(it.bottomP,$e.bottomN,ze.bottomN),$e=it)}Ce=(Ce+G)%le,ce=(ce+Q)%he,xe=(xe+1)%ve}while(xe!==Fe)}if(a===!1&&this._depth>this._bevel*2&&this._buildWall(Z,$,w),I){let fe=[];for(let se=w.length-1;se>=pe+2;se-=3){let re=w[se-2],le=w[se-1],he=w[se-0];fe.push(he,le,re)}w.splice(pe,w.length-pe,...fe)}if(I){let fe=[];for(let se=Z[Z.length-1].boundary.vertices.length-1;se>=1;se-=2){let re=Z[Z.length-1].boundary.vertices[se-1],le=Z[Z.length-1].boundary.vertices[se-0];fe.push(re,le)}E.push(fe)}if(!I){let fe=Z[Z.length-1],se;try{se=kg({windingRule:Z.length>1?hn.POSITIVE:hn.ODD,elementType:zs.POLYGONS,vertexSize:2,strict:!0,contours:[fe.insetPoints,...E]})}catch{se=$fe}if(!se)throw new Error("Error generating geometry for surface");l.length===0&&this._bevel<h&&Object.assign(this,{useNgonForTopBottomFaceDuringBake:!0});for(let re=0;re<se.elementCount*3;re+=3){let le=this._buildSurfaceVert(se,se.elements[re+0],j),he=this._buildSurfaceVert(se,se.elements[re+1],j),ve=this._buildSurfaceVert(se,se.elements[re+2],j);w.push(le.top,he.top,ve.top),a===!1&&w.push(ve.bottom,he.bottom,le.bottom)}}this.vertexCache={}}this._buffer.shrink();let M=new Mi(Uint32Array.from(w),1),A=new Mi(this._buffer.positions,3),P=new Mi(this._buffer.normals,3),C=new Mi(this._buffer.uvs,2);A.needsUpdate=!0,P.needsUpdate=!0,C.needsUpdate=!0,M.needsUpdate=!0,this.setAttribute("position",A),this.setAttribute("normal",P),this.setAttribute("uv",C),this.setIndex(M)}_computeBufferEstimatedSize(t){return t.vertexCount*2*(2+this._bevelSegments)}_buildWall(t,e,i){let r=t[0];for(let n=0,s=r.boundary.vertexCount;n<s;n++){let a=this._buildBevelVert(e,r,n),o=this._buildBevelVert(e,r,(n+1)%s);i.push(o.topP,a.topN,a.bottomN),i.push(o.topP,a.bottomN,o.bottomP)}}_buildSurfaceVert(t,e,i){let r=e.toString();if(r in this.vertexCache)return this.vertexCache[r];let n=t.vertices[e*2+0],s=t.vertices[e*2+1],a=(n-this._minX)/this._width,o=(s-this._minY)/this._height;this.forPathBevel&&(o=1);let l=this._buffer.get(this.forPathBevel?1:2),c=l*3,u=l*2,h={top:l+0,bottom:l+1};return this._buffer.positions[c+0]=n,this._buffer.positions[c+1]=s,this._buffer.positions[c+2]=this.forPathBevel?this._bevel:this._depth-i,this._buffer.normals[c+0]=0,this._buffer.normals[c+1]=0,this._buffer.normals[c+2]=1,this._buffer.uvs[u+0]=a,this._buffer.uvs[u+1]=o,this.forPathBevel===!1&&(this._buffer.positions[c+3]=n,this._buffer.positions[c+4]=s,this._buffer.positions[c+5]=i,this._buffer.normals[c+3]=0,this._buffer.normals[c+4]=0,this._buffer.normals[c+5]=-1,this._buffer.uvs[u+2]=a,this._buffer.uvs[u+3]=o),this.vertexCache[r]=h,h}_buildBevelVert(t,e,i,r=1,n){let s=`${e.bevelI}:${i}`;if(s in this.vertexCache&&n!==0&&n!==1&&(!n||n===this.vertexCache[s].pathBevelUCoord))return this.vertexCache[s];let[a,o]=e.boundary.vertexIndices[i],l,c,u,h;a!==o?(c=a,l=o,h=!1,u=t.continuous[c]&&t.continuous[l]):(l=a,c=(l-1+t.count)%t.count,h=t.concave[l]&&e.bevelI>0,u=t.continuous[l]||h);let d=Math.cos(e.angle),f=Math.sin(e.angle),p=i*2,g=l*2,m=c*2,y=e.boundary.vertices[p+0],b=e.boundary.vertices[p+1],w=(1-f)*this._bevel,E=(y-this._minX)/this._width,M=(b-this._minY)/this._height;this.forPathBevel&&(n!==void 0&&(E=n),M=1);let A=t.normals[g+0],P=t.normals[g+1],C=t.normals[m+0],R=t.normals[m+1];if(h){let F=C-A,$=R-P;A=A+F*(1-r),P=P+$*(1-r);let K=Math.sqrt(A*A+P*P);A/=K,P/=K}let I=this.forPathBevel?this._buffer.get(u?1:2):this._buffer.get(u?2:4),k=I*3,z=I*2,V={i,fi:l,topP:I+0,topN:I+0,bottomP:I+1,bottomN:I+1,pathBevelUCoord:n};return this._buffer.positions[k+0]=y,this._buffer.positions[k+1]=b,this._buffer.positions[k+2]=(this.forPathBevel?this._bevel:this._depth)-w,this._buffer.normals[k+0]=A*d,this._buffer.normals[k+1]=P*d,this._buffer.normals[k+2]=f,this._buffer.uvs[z+0]=E,this._buffer.uvs[z+1]=M,this.forPathBevel===!1&&(this._buffer.positions[k+3]=y,this._buffer.positions[k+4]=b,this._buffer.positions[k+5]=w,this._buffer.normals[k+3]=A*d,this._buffer.normals[k+4]=P*d,this._buffer.normals[k+5]=-f,this._buffer.uvs[z+2]=M,this._buffer.uvs[z+3]=E),u||(this.forPathBevel?(I+=1,k+=3,z+=2):(I+=2,k+=6,z+=4),V.topP=I+0,V.bottomP=I+1,this._buffer.positions[k+0]=y,this._buffer.positions[k+1]=b,this._buffer.positions[k+2]=(this.forPathBevel?this._bevel:this._depth)-w,this._buffer.normals[k+0]=C*d,this._buffer.normals[k+1]=R*d,this._buffer.normals[k+2]=f,this._buffer.uvs[z+0]=E,this._buffer.uvs[z+1]=M,this.forPathBevel===!1&&(this._buffer.positions[k+3]=y,this._buffer.positions[k+4]=b,this._buffer.positions[k+5]=w,this._buffer.normals[k+3]=C*d,this._buffer.normals[k+4]=R*d,this._buffer.normals[k+5]=-f,this._buffer.uvs[z+2]=M,this._buffer.uvs[z+3]=E)),this.vertexCache[s]=V,V}clone(){let t=new t8(this._shape,this._depth,this._bevel,this._curveSegments,this._bevelSegmentsInput);return t.userData=gL(this.userData),t}},Yfe=class extends oi{constructor(t,e=12,i={}){super(),this.type="ShapeGeometry",this.windingRule=hn.ODD,this.elementType=zs.POLYGONS,this.polySize=3,this.vertexSize=2,this.strict=!0,this._shape=t,this._curveSegments=e,this._triangulationOptions=Object.assign({windingRule:hn.ODD,elementType:zs.POLYGONS,polySize:3,vertexSize:2,strict:!0},i);let r=this._shape.extractShapePointsToFlatArray([],this._curveSegments),n=this._shape.shapeHoles.map(d=>d.extractShapePointsToFlatArray([],this._curveSegments)),s,a=!0,o=!0,l,c;for(let d=0,f=r.length/2;d<f;d++){let p=d*2,g=r[p+0],m=r[p+1];if(l!==void 0&&g!==l&&(a=!1),c!==void 0&&m!==c&&(o=!1),l=g,c=m,!a&&!o)break}if(!a&&!o)try{s=kg({contours:[r,...n],windingRule:this._triangulationOptions.windingRule,elementType:this._triangulationOptions.elementType,polySize:this._triangulationOptions.polySize,vertexSize:this._triangulationOptions.vertexSize,strict:this._triangulationOptions.strict})}catch{s=e8}let u=s?.vertexCount??1,h=s?.elementCount??1;if(this._positionAttribute=new Mi(new Float32Array(u*3),3),this._normalAttribute=new Mi(new Float32Array(u*3),3),this._uvAttribute=new Mi(new Float32Array(u*2),2),this._indexAttribute=new Mi(new Uint32Array(h*3),1),s){let d=1/0,f=-1/0,p=1/0,g=-1/0;for(let b=0,w=u;b<w;b++){let E=b*2,M=s.vertices[E+0],A=s.vertices[E+1];M<d&&(d=M),M>f&&(f=M),A<p&&(p=A),A>g&&(g=A)}let m=f-d,y=g-p;for(let b=0,w=u;b<w;b++){let E=b*2,M=s.vertices[E+0],A=s.vertices[E+1],P=(M-d)/m,C=(A-p)/y;this._positionAttribute.setXYZ(b,M,A,0),this._normalAttribute.setXYZ(b,0,0,1),this._uvAttribute.setXY(b,P,C)}for(let b=0,w=h;b<w;b++){let E=b*3,M=s.elements[E+0],A=s.elements[E+1],P=s.elements[E+2];this._indexAttribute.setX(E+0,M),this._indexAttribute.setX(E+1,A),this._indexAttribute.setX(E+2,P)}}this.setAttribute("position",this._positionAttribute),this.setAttribute("normal",this._normalAttribute),this.setAttribute("uv",this._uvAttribute),this.setIndex(this._indexAttribute),this.setDrawRange(0,(s?.elementCount??1)*3)}clone(){let t=new Yfe(this._shape,this._curveSegments);return t.userData=gL(this.userData),t}},Kfe=class extends t8{constructor(t,e,i=0,r=12,n=3,s=hn.ODD){super(t,e,i,r,n,s),this.type="ShapeGeometry"}_computeBufferEstimatedSize(t){return t.vertexCount*2*(2+this._bevelSegments)}_buildWall(t,e,i){let r=t[0];for(let n=0,s=r.boundary.vertexCount;n<s;n++){let a=this._buildBevelVert(e,r,n),o=this._buildBevelVert(e,r,(n+1)%s);i.push(o.topP,a.topN,a.bottomN),i.push(o.topP,a.bottomN,o.bottomP)}}clone(){let t=new Kfe(this._shape,this._depth,this._bevel,this._curveSegments,this._bevelSegmentsInput);return t.userData=gL(this.userData),t}},Q0=class{static create(t){return this.build(this.normalizeInputs(t))}static normalizeInputs(t,e){let i=Object.assign({},e?.parameters??{width:100,subdivisions:40,roundness:0,extrudeBevelSize:0,extrudeBevelSegments:3,windingRule:hn.ODD},t.parameters),r=Math.abs(i.width),n=Math.abs(i.height??i.width),s=Math.abs(i.depth??0),a=t.shape??e?.shape,o=a?.roundness??i.roundness;a!==void 0&&(a instanceof as?(a.width!==r||a.height!==n)&&a.applySize(r,n):a=new as(r,n).fromJSON(a),t.parameters?.roundness!==void 0&&t.parameters?.roundness>0&&a.update());let l=a??new as(r,n);return{parameters:Object.assign(i,{width:r,height:n,depth:s,roundness:o}),shape:l}}static build(t){let{depth:e,extrudeBevelSize:i,extrudeBevelSegments:r,subdivisions:n,roundness:s,windingRule:a}=t.parameters;t.shape.roundness=s;let o;return e<=0?o=new Yfe(t.shape,n,{windingRule:a}):o=new Kfe(t.shape,e,i,n,r,a),Object.assign(o,{userData:{...t,type:"VectorGeometry"}})}},Zfe=Math.PI*2,i8=class{static create(t){return this.build(this.normalizeInputs(t))}static normalizeInputs(t,e){let i=Object.assign({},e?.parameters??{width:100,depth:0,spikes:64,angle:360,innerRadius:0,extrudeBevelSize:0,extrudeBevelSegments:1},t.parameters);return i.angle=Ht.clamp(i.angle,0,360),{shape:t.shape&&t.shape instanceof as?t.shape:new as,parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??0)})}}static build(t){let{width:e,height:i,spikes:r,angle:n,innerRadius:s,depth:a,extrudeBevelSize:o,extrudeBevelSegments:l}=t.parameters,c=t.shape,u=e*.5,h=i*.5,d=Ast(c,u,h,n*Math.PI/180,r,s);c.isClosed=!0,c.update();let f;return n===0?(f=new oi,f.setAttribute("position",new Gt([],3))):f=Q0.create({shape:c,parameters:{subdivisions:d,depth:a,extrudeBevelSize:o,extrudeBevelSegments:l}}),Object.assign(f,{userData:{...t,type:"EllipseGeometry"}})}};function Ast(t,e,i,r,n,s){if(r>=Zfe)return n>30||n%4===0?(Tst(t,e,i,s),Math.round(n/4)):Hee(t,r,n,e,i,s);r=Math.max(r,.001);let a={x:0,y:i},o=r+Math.PI*.5,l={x:Math.cos(o)*e,y:Math.sin(o)*i},c=mst({px:a.x,py:a.y,cx:l.x,cy:l.y,rx:e,ry:i,largeArcFlag:r>Math.PI,sweepFlag:!0});return n>30||n%c.length===0?Mst(t,a.x,a.y,c,n,e,i,s):Hee(t,r,n,e,i,s)}function Mst(t,e,i,r,n,s,a,o){let l=Math.round(n/r.length);t.addPoint(h1(e,i));for(let c=0,u=r.length;c<u;c++){let h=r[c],d=t.points[c],f=h1(h.x,h.y);d.controls[1].position.set(h.x1,h.y1),f.controls[0].position.set(h.x2,h.y2),t.addPoint(f)}return o>0?Qfe(t,s,a,o):t.addPoint(h1(0,0)),l}function Hee(t,e,i,r,n,s){let a=-e/i;for(let o=0;o<=i;o++){let l=a*o,c=Math.sin(l)*r,u=Math.cos(l)*n;t.addPoint(h1(c,u))}return e<Zfe?s>0?Qfe(t,r,n,s):t.addPoint(h1(0,0)):(t.removePoint(t.points[t.points.length-1]),s>0&&Jfe(t,r,n,s)),1}function Tst(t,e,i,r=0,n=0,s=0){let a=.5522847498,o=e*a,l=i*a;t.addPoint(aR(n-e,s,n-e,s-l,n-e,s+l)),t.addPoint(aR(n,s+i,n-o,s+i,n+o,s+i)),t.addPoint(aR(n+e,s,n+e,s+l,n+e,s-l)),t.addPoint(aR(n,s-i,n+o,s-i,n-o,s-i)),r>0&&Jfe(t,e,i,r)}function h1(t,e){return new u1(Ht.generateUUID(),new Ae(t,e))}function aR(t,e,i,r,n,s){let a=h1(t,e);return a.controls[0].position.set(i,r),a.controls[1].position.set(n,s),a}function Qfe(t,e,i,r){epe(t,e,i,r).forEach(n=>t.addPoint(n))}function Jfe(t,e,i,r){let n=epe(t,e,i,r),s=new as;n.forEach(a=>s.addPoint(a)),s.isClosed=!0,t.shapeHoles.push(s)}function epe(t,e,i,r){let n=r*e/100,s=n*(Math.abs(i)/Math.abs(e)),a=new Ae(n/e,s/i),o=t.points.map(l=>{let c=l.clone();return c.uuid=Ht.generateUUID(),c}).reverse();return o.forEach(l=>{l.position.multiply(a);let c=l.controls[0].position.clone().multiply(a),u=l.controls[1].position.clone().multiply(a);l.controls[0].position.copy(u),l.controls[1].position.copy(c)}),o}var Cst=class{static create(t){return this.build(this.normalizeInputs(t))}static normalizeInputs(t,e){let i=Object.assign({},e?.parameters??{width:100,revolutions:2,segments:40,pathRadius:10,pathType:0,pathSegments:30,cornerRadius:30,cornerSegments:4},t.parameters),r=Math.abs(i.width),n=Math.abs(i.height??r),s=Math.abs(i.depth??r),a=Math.abs(Math.min(r,s))/2;return{parameters:Object.assign(i,{width:r,height:n,depth:s,radius:a,segments:Math.round(i.segments),pathSegments:Math.round(i.pathSegments),cornerSegments:Math.round(i.cornerSegments)})}}static build(t){let{width:e,height:i,depth:r,radius:n,revolutions:s,segments:a,pathRadius:o,pathType:l,pathSegments:c,cornerRadius:u,cornerSegments:h}=t.parameters,d=new tpe(!1,e,i,r,n,s,a,o,l,c,u,h);return Object.assign(d,{userData:{...t,type:"HelixGeometry"}})}},NF=new s1([0,0,0],1),tpe=class extends oi{constructor(t=!0,e=1,i=1,r=1,n=1,s=1,a=1,o=1,l=1,c=1,u=1,h=1){if(super(),s===0)return;let d=t&&s===1;d&&(h=0),u>100&&(u=100),u===0&&(h=0);let f=()=>new W,p=new W,g=f(),m=f(),y=f(),b,w,E,M,A,P,C,R,I=f(),k=f(),z=f(),V=f(),F=f(),$=f(),K=f(),X=f(),U=i-2*o+.001,Y=U/s,Z=Math.ceil(a*s),j=Z+1,ee=U/Z,pe=-U/2,fe=c+1,se=2*Math.PI/c,re=Math.PI/2/h,le=.01,he=Math.min((1-u/100)*o,o-le),ve=o-he,xe=0,Se=2,Ce=h*Se+Se,ce=fe*Ce/Se,Fe=ce+fe*j,De=Math.max(0,fe*(j+Ce)),[He,Be,$e]=[3,3,2].map(Te=>Array(De*Te).fill(0)),ze=[],it=n-o;function wt(Te,dt){let ot=Math.PI/2;P=dt*ee,R=2*Math.PI*(P%Y)/Y+ot,P+=pe,C=Math.sin(R)*it,A=Math.cos(R)*it,t?Te.set(A,C,P):Te.set(A,P,C)}wt(p,-1e-10),wt(g,0),I.copy(p),wt(p,1);let ge=p.distanceTo(g),G=d?0:ve+he,Q=ge*Z+2*G,we=he,te=Q-G;for(let Te=0;Te<=Z;Te++){wt(m,Te),X.subVectors(m,I).normalize(),I.copy(m),$.copy(m).setComponent(+t+1,0).normalize(),K.crossVectors(X,$).normalize();let dt=Te===0,ot=Te===Z,Qe=dt?3*Math.PI/2:re,pt=dt?we:te,_t=dt?fe:Fe,yt=dt?0:De-fe,Et=X.clone().multiplyScalar(dt?-ve:ve).add(m),$t=X.clone().multiplyScalar(dt?-1:1).normalize();for(let oe=0;oe<fe;oe++){let Re=oe*se;if(k.addVectors(p.copy($).multiplyScalar(o*Math.cos(Re)),g.copy(K).multiplyScalar(o*Math.sin(Re))),z.copy(k).normalize(),dt||ot){d||(xe=yt+oe,[0,1,2].forEach(ke=>{He[xe*3+ke]=Et.getComponent(ke),Be[xe*3+ke]=$t.getComponent(ke)}),$e[xe*2]=+ot,$e[xe*2+1]=oe/c),g.copy(z).multiplyScalar(he),y.addVectors(m,g);for(let ke=0;ke<h;ke++){let st=ke*re+Qe;V.addVectors(p.copy(X).multiplyScalar(ve*Math.sin(st)),g.copy(z).multiplyScalar(ve*Math.cos(st))),F.copy(V).normalize(),g.addVectors(y,V),V.normalize(),xe=_t+ke*fe+oe,[0,1,2].forEach(je=>{He[xe*3+je]=g.getComponent(je),Be[xe*3+je]=F.getComponent(je)});let rt=+dt+Math.sin(st);$e[xe*2]=(pt+ve*rt)/Q,$e[xe*2+1]=oe/c}}g.addVectors(m,k),xe=ce+Te*fe+oe,[0,1,2].forEach(ke=>{He[xe*3+ke]=g.getComponent(ke),Be[xe*3+ke]=z.getComponent(ke)}),$e[xe*2]=(G+Te*ge)/Q,$e[xe*2+1]=oe/c}}let Ne=j+2*h+Se,[Le,at]=[+d,Ne-1];for(let Te=Le;Te<=at-1;Te++){let dt=d&&Te===at-1;for(let ot=0;ot<fe-1;ot++)b=Te*fe+ot,w=b+1,E=(dt?ot:b)+fe,M=(dt?ot+1:w)+fe,Te===0?ze.push(w,M,E):Te===Ne-2?ze.push(b,w,E):ze.push(b,w,E,w,M,E)}this.setIndex(ze),this.setAttribute("position",new Gt(He,3)),this.setAttribute("normal",new Gt(Be,3)),this.setAttribute("uv",new Gt($e,2))}getClosedTorusIndicesForBooleanOrSubdiv(){let t=this.userData.parameters,e=Math.ceil(t.tubularSegments),i=t.radialSegments+1,r=Array.from(this.getIndex().array),n,s,a,o,l=6*(e-1)*t.radialSegments,c=e,u=c===e;for(let h=0;h<t.radialSegments;h++)n=c*i+h,s=n+1,a=(u?h:n)+i,o=(u?h+1:s)+i,r[l++]=n,r[l++]=s,r[l++]=a,r[l++]=s,r[l++]=o,r[l++]=a;return r.length=l,NF.array=r,NF.count=r.length,NF}},Pst=class{static create(t){return this.build(this.normalizeInputs(t))}static normalizeInputs(t,e){let i=Object.assign({},e?.parameters??{width:100,detail:0,corner:0,cornerSides:4},t.parameters);return{parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??i.width)})}}static build(t){let{width:e,height:i,depth:r,detail:n,corner:s,cornerSides:a}=t.parameters,o=n===0&&s!==0?new ipe(e*.5,s,a):new Dhe(e*.5,n);return o.scale(1,i/e,r/e),Object.assign(o,{userData:{...t,type:"IcosahedronGeometry"}})}},ipe=class extends ZG{constructor(t=1,e=.2,i=4){let r=(1+Math.sqrt(5))/2,n=[-1,r,0,1,r,0,-1,-r,0,1,-r,0,0,-1,r,0,1,r,0,-1,-r,0,1,-r,r,0,-1,r,0,1,-r,0,-1,-r,0,1],s=[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],a="IcosahedronGeometry";super(n,s,a,t,e,i),this.type=a}static fromJSON(t){return new ipe(t.radius,t.corner,t.cornerSides)}},Rst=class{static create(t){return this.build(this.normalizeInputs(t))}static normalizeInputs(t,e){(t.parameters?.points??[]).forEach(r=>{Array.isArray(r)&&(r.x=r[0],r.y=r[1])});let i=Object.assign({},e?.parameters??{width:100,segments:64,verticalSegments:64,points:[{x:0,y:-50,id:0},{x:50,y:-50,id:1},{x:50,y:50,id:2},{x:0,y:50,id:3}]},t.parameters);return{parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??i.width)})}}static build(t){let{points:e,segments:i,verticalSegments:r}=t.parameters,n=new qD;n.moveTo(e[0].x,e[0].y),n.bezierCurveTo(e[1].x,e[1].y,e[2].x,e[2].y,e[3].x,e[3].y);let s=new Mhe(n.extractPoints(r).shape,i);return s.rotateZ(Math.PI),Object.assign(s,{userData:{...t,type:"LatheGeometry"}})}},od=new St,UF=new tn,oR=new W,k3=class extends Qa{constructor(){super(),this.uuid=Ht.generateUUID(),this.name="",this.type="Geometry",this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.elementsNeedUpdate=!1,this.verticesNeedUpdate=!1,this.uvsNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.lineDistancesNeedUpdate=!1,this.groupsNeedUpdate=!1}applyMatrix4(t){let e=new Vs().getNormalMatrix(t);for(let i=0,r=this.vertices.length;i<r;i++)this.vertices[i].applyMatrix4(t);for(let i=0,r=this.faces.length;i<r;i++){let n=this.faces[i];n.normal.applyMatrix3(e).normalize();for(let s=0,a=n.vertexNormals.length;s<a;s++)n.vertexNormals[s].applyMatrix3(e).normalize()}return this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this.verticesNeedUpdate=!0,this.normalsNeedUpdate=!0,this}rotateX(t){return od.makeRotationX(t),this.applyMatrix4(od),this}rotateY(t){return od.makeRotationY(t),this.applyMatrix4(od),this}rotateZ(t){return od.makeRotationZ(t),this.applyMatrix4(od),this}translate(t,e,i){return od.makeTranslation(t,e,i),this.applyMatrix4(od),this}scale(t,e,i){return od.makeScale(t,e,i),this.applyMatrix4(od),this}lookAt(t){return UF.lookAt(t),UF.updateMatrix(),this.applyMatrix4(UF.matrix),this}fromBufferGeometry(t){let e=this,i=t.index!==null?t.index:void 0,r=t.attributes;if(r.position===void 0)return console.error("THREE.Geometry.fromBufferGeometry(): Position attribute required for conversion."),this;let n=r.position,s=r.normal,a=r.color,o=r.uv,l=r.uv2;l!==void 0&&(this.faceVertexUvs[1]=[]);for(let h=0;h<n.count;h++)e.vertices.push(new W().fromBufferAttribute(n,h)),a!==void 0&&e.colors.push(new Ai().fromBufferAttribute(a,h));function c(h,d,f,p){let g=a===void 0?[]:[e.colors[h].clone(),e.colors[d].clone(),e.colors[f].clone()],m=s===void 0?[]:[new W().fromBufferAttribute(s,h),new W().fromBufferAttribute(s,d),new W().fromBufferAttribute(s,f)],y=new H5(h,d,f,m,g,p);e.faces.push(y),o!==void 0&&e.faceVertexUvs[0].push([new Ae().fromBufferAttribute(o,h),new Ae().fromBufferAttribute(o,d),new Ae().fromBufferAttribute(o,f)]),l!==void 0&&e.faceVertexUvs[1].push([new Ae().fromBufferAttribute(l,h),new Ae().fromBufferAttribute(l,d),new Ae().fromBufferAttribute(l,f)])}let u=t.groups;if(u.length>0)for(let h=0;h<u.length;h++){let d=u[h],f=d.start,p=d.count;for(let g=f,m=f+p;g<m;g+=3)i!==void 0?c(i.getX(g),i.getX(g+1),i.getX(g+2),d.materialIndex):c(g,g+1,g+2,d.materialIndex)}else if(i!==void 0)for(let h=0;h<i.count;h+=3)c(i.getX(h),i.getX(h+1),i.getX(h+2));else for(let h=0;h<n.count;h+=3)c(h,h+1,h+2);return this.computeFaceNormals(),t.boundingBox!==null&&(this.boundingBox=t.boundingBox.clone()),t.boundingSphere!==null&&(this.boundingSphere=t.boundingSphere.clone()),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(oR).negate(),this.translate(oR.x,oR.y,oR.z),this}normalize(){this.computeBoundingSphere();let t=this.boundingSphere.center,e=this.boundingSphere.radius,i=e===0?1:1/e,r=new St;return r.set(i,0,0,-i*t.x,0,i,0,-i*t.y,0,0,i,-i*t.z,0,0,0,1),this.applyMatrix4(r),this}computeFaceNormals(){let t=new W,e=new W;for(let i=0,r=this.faces.length;i<r;i++){let n=this.faces[i],s=this.vertices[n.a],a=this.vertices[n.b],o=this.vertices[n.c];t.subVectors(o,a),e.subVectors(s,a),t.cross(e),t.normalize(),n.normal.copy(t)}}computeVertexNormals(t=!0){let e=new Array(this.vertices.length);for(let i=0,r=this.vertices.length;i<r;i++)e[i]=new W;if(t){let i=new W,r=new W;for(let n=0,s=this.faces.length;n<s;n++){let a=this.faces[n],o=this.vertices[a.a],l=this.vertices[a.b],c=this.vertices[a.c];i.subVectors(c,l),r.subVectors(o,l),i.cross(r),e[a.a].add(i),e[a.b].add(i),e[a.c].add(i)}}else{this.computeFaceNormals();for(let i=0,r=this.faces.length;i<r;i++){let n=this.faces[i];e[n.a].add(n.normal),e[n.b].add(n.normal),e[n.c].add(n.normal)}}for(let i=0,r=this.vertices.length;i<r;i++)e[i].normalize();for(let i=0,r=this.faces.length;i<r;i++){let n=this.faces[i],s=n.vertexNormals;s.length===3?(s[0].copy(e[n.a]),s[1].copy(e[n.b]),s[2].copy(e[n.c])):(s[0]=e[n.a].clone(),s[1]=e[n.b].clone(),s[2]=e[n.c].clone())}this.faces.length>0&&(this.normalsNeedUpdate=!0)}computeFlatVertexNormals(){this.computeFaceNormals();for(let t=0,e=this.faces.length;t<e;t++){let i=this.faces[t],r=i.vertexNormals;r.length===3?(r[0].copy(i.normal),r[1].copy(i.normal),r[2].copy(i.normal)):(r[0]=i.normal.clone(),r[1]=i.normal.clone(),r[2]=i.normal.clone())}this.faces.length>0&&(this.normalsNeedUpdate=!0)}computeMorphNormals(){for(let e=0,i=this.faces.length;e<i;e++){let r=this.faces[e];r.__originalFaceNormal?r.__originalFaceNormal.copy(r.normal):r.__originalFaceNormal=r.normal.clone(),r.__originalVertexNormals||(r.__originalVertexNormals=[]);for(let n=0,s=r.vertexNormals.length;n<s;n++)r.__originalVertexNormals[n]?r.__originalVertexNormals[n].copy(r.vertexNormals[n]):r.__originalVertexNormals[n]=r.vertexNormals[n].clone()}let t=new k3;t.faces=this.faces;for(let e=0,i=this.morphTargets.length;e<i;e++){if(!this.morphNormals[e]){this.morphNormals[e]={},this.morphNormals[e].faceNormals=[],this.morphNormals[e].vertexNormals=[];let n=this.morphNormals[e].faceNormals,s=this.morphNormals[e].vertexNormals;for(let a=0,o=this.faces.length;a<o;a++){let l=new W,c={a:new W,b:new W,c:new W};n.push(l),s.push(c)}}let r=this.morphNormals[e];t.vertices=this.morphTargets[e].vertices,t.computeFaceNormals(),t.computeVertexNormals();for(let n=0,s=this.faces.length;n<s;n++){let a=this.faces[n],o=r.faceNormals[n],l=r.vertexNormals[n];o.copy(a.normal),l.a.copy(a.vertexNormals[0]),l.b.copy(a.vertexNormals[1]),l.c.copy(a.vertexNormals[2])}}for(let e=0,i=this.faces.length;e<i;e++){let r=this.faces[e];r.normal=r.__originalFaceNormal,r.vertexNormals=r.__originalVertexNormals}}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new Ss),this.boundingBox.setFromPoints(this.vertices)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new oc),this.boundingSphere.setFromPoints(this.vertices)}merge(t,e,i=0){if(!(t&&t.isGeometry)){console.error("THREE.Geometry.merge(): geometry not an instance of THREE.Geometry.",t);return}let r,n=this.vertices.length,s=this.vertices,a=t.vertices,o=this.faces,l=t.faces,c=this.colors,u=t.colors;e!==void 0&&(r=new Vs().getNormalMatrix(e));for(let h=0,d=a.length;h<d;h++){let f=a[h].clone();e!==void 0&&f.applyMatrix4(e),s.push(f)}for(let h=0,d=u.length;h<d;h++)c.push(u[h].clone());for(let h=0,d=l.length;h<d;h++){let f=l[h],p,g,m=f.vertexNormals,y=f.vertexColors,b=new H5(f.a+n,f.b+n,f.c+n);b.normal.copy(f.normal),r!==void 0&&b.normal.applyMatrix3(r).normalize();for(let w=0,E=m.length;w<E;w++)p=m[w].clone(),r!==void 0&&p.applyMatrix3(r).normalize(),b.vertexNormals.push(p);b.color.copy(f.color);for(let w=0,E=y.length;w<E;w++)g=y[w],b.vertexColors.push(g.clone());b.materialIndex=f.materialIndex+i,o.push(b)}for(let h=0,d=t.faceVertexUvs.length;h<d;h++){let f=t.faceVertexUvs[h];this.faceVertexUvs[h]===void 0&&(this.faceVertexUvs[h]=[]);for(let p=0,g=f.length;p<g;p++){let m=f[p],y=[];for(let b=0,w=m.length;b<w;b++)y.push(m[b].clone());this.faceVertexUvs[h].push(y)}}}mergeMesh(t){if(!(t&&t.isMesh)){console.error("THREE.Geometry.mergeMesh(): mesh not an instance of THREE.Mesh.",t);return}t.matrixAutoUpdate&&t.updateMatrix(),this.merge(t.geometry,t.matrix)}mergeVertices(t=4){let e={},i=[],r=[],n=Math.pow(10,t);for(let o=0,l=this.vertices.length;o<l;o++){let c=this.vertices[o],u=Math.round(c.x*n)+"_"+Math.round(c.y*n)+"_"+Math.round(c.z*n);e[u]===void 0?(e[u]=o,i.push(this.vertices[o]),r[o]=i.length-1):r[o]=r[e[u]]}let s=[];for(let o=0,l=this.faces.length;o<l;o++){let c=this.faces[o];c.a=r[c.a],c.b=r[c.b],c.c=r[c.c];let u=[c.a,c.b,c.c];for(let h=0;h<3;h++)if(u[h]===u[(h+1)%3]){s.push(o);break}}for(let o=s.length-1;o>=0;o--){let l=s[o];this.faces.splice(l,1);for(let c=0,u=this.faceVertexUvs.length;c<u;c++)this.faceVertexUvs[c].splice(l,1)}let a=this.vertices.length-i.length;return this.vertices=i,a}setFromPoints(t){this.vertices=[];for(let e=0,i=t.length;e<i;e++){let r=t[e];this.vertices.push(new W(r.x,r.y,r.z||0))}return this}sortFacesByMaterialIndex(){let t=this.faces,e=t.length;for(let o=0;o<e;o++)t[o]._id=o;function i(o,l){return o.materialIndex-l.materialIndex}t.sort(i);let r=this.faceVertexUvs[0],n=this.faceVertexUvs[1],s,a;r&&r.length===e&&(s=[]),n&&n.length===e&&(a=[]);for(let o=0;o<e;o++){let l=t[o]._id;s&&s.push(r[l]),a&&a.push(n[l])}s&&(this.faceVertexUvs[0]=s),a&&(this.faceVertexUvs[1]=a)}toJSON(){let t={metadata:{version:4.5,type:"Geometry",generator:"Geometry.toJSON"}};if(t.uuid=this.uuid,t.type=this.type,this.name!==""&&(t.name=this.name),this.parameters!==void 0){let f=this.parameters;for(let p in f)f[p]!==void 0&&(t[p]=f[p]);return t}let e=[];for(let f=0;f<this.vertices.length;f++){let p=this.vertices[f];e.push(p.x,p.y,p.z)}let i=[],r=[],n={},s=[],a={},o=[],l={};for(let f=0;f<this.faces.length;f++){let p=this.faces[f],g=!0,m=!1,y=this.faceVertexUvs[0][f]!==void 0,b=p.normal.length()>0,w=p.vertexNormals.length>0,E=p.color.r!==1||p.color.g!==1||p.color.b!==1,M=p.vertexColors.length>0,A=0;if(A=c(A,0,0),A=c(A,1,g),A=c(A,2,m),A=c(A,3,y),A=c(A,4,b),A=c(A,5,w),A=c(A,6,E),A=c(A,7,M),i.push(A),i.push(p.a,p.b,p.c),i.push(p.materialIndex),y){let P=this.faceVertexUvs[0][f];i.push(d(P[0]),d(P[1]),d(P[2]))}if(b&&i.push(u(p.normal)),w){let P=p.vertexNormals;i.push(u(P[0]),u(P[1]),u(P[2]))}if(E&&i.push(h(p.color)),M){let P=p.vertexColors;i.push(h(P[0]),h(P[1]),h(P[2]))}}function c(f,p,g){return g?f|1<<p:f&~(1<<p)}function u(f){let p=f.x.toString()+f.y.toString()+f.z.toString();return n[p]!==void 0||(n[p]=r.length/3,r.push(f.x,f.y,f.z)),n[p]}function h(f){let p=f.r.toString()+f.g.toString()+f.b.toString();return a[p]!==void 0||(a[p]=s.length,s.push(f.getHex())),a[p]}function d(f){let p=f.x.toString()+f.y.toString();return l[p]!==void 0||(l[p]=o.length/2,o.push(f.x,f.y)),l[p]}return t.data={},t.data.vertices=e,t.data.normals=r,s.length>0&&(t.data.colors=s),o.length>0&&(t.data.uvs=[o]),t.data.faces=i,t}clone(){return new k3().copy(this)}copy(t){this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.name=t.name;let e=t.vertices;for(let h=0,d=e.length;h<d;h++)this.vertices.push(e[h].clone());let i=t.colors;for(let h=0,d=i.length;h<d;h++)this.colors.push(i[h].clone());let r=t.faces;for(let h=0,d=r.length;h<d;h++)this.faces.push(r[h].clone());for(let h=0,d=t.faceVertexUvs.length;h<d;h++){let f=t.faceVertexUvs[h];this.faceVertexUvs[h]===void 0&&(this.faceVertexUvs[h]=[]);for(let p=0,g=f.length;p<g;p++){let m=f[p],y=[];for(let b=0,w=m.length;b<w;b++){let E=m[b];y.push(E.clone())}this.faceVertexUvs[h].push(y)}}let n=t.morphTargets;for(let h=0,d=n.length;h<d;h++){let f={};if(f.name=n[h].name,n[h].vertices!==void 0){f.vertices=[];for(let p=0,g=n[h].vertices.length;p<g;p++)f.vertices.push(n[h].vertices[p].clone())}if(n[h].normals!==void 0){f.normals=[];for(let p=0,g=n[h].normals.length;p<g;p++)f.normals.push(n[h].normals[p].clone())}this.morphTargets.push(f)}let s=t.morphNormals;for(let h=0,d=s.length;h<d;h++){let f={};if(s[h].vertexNormals!==void 0){f.vertexNormals=[];for(let p=0,g=s[h].vertexNormals.length;p<g;p++){let m=s[h].vertexNormals[p],y={};y.a=m.a.clone(),y.b=m.b.clone(),y.c=m.c.clone(),f.vertexNormals.push(y)}}if(s[h].faceNormals!==void 0){f.faceNormals=[];for(let p=0,g=s[h].faceNormals.length;p<g;p++)f.faceNormals.push(s[h].faceNormals[p].clone())}this.morphNormals.push(f)}let a=t.skinWeights;for(let h=0,d=a.length;h<d;h++)this.skinWeights.push(a[h].clone());let o=t.skinIndices;for(let h=0,d=o.length;h<d;h++)this.skinIndices.push(o[h].clone());let l=t.lineDistances;for(let h=0,d=l.length;h<d;h++)this.lineDistances.push(l[h]);let c=t.boundingBox;c!==null&&(this.boundingBox=c.clone());let u=t.boundingSphere;return u!==null&&(this.boundingSphere=u.clone()),this.elementsNeedUpdate=t.elementsNeedUpdate,this.verticesNeedUpdate=t.verticesNeedUpdate,this.uvsNeedUpdate=t.uvsNeedUpdate,this.normalsNeedUpdate=t.normalsNeedUpdate,this.colorsNeedUpdate=t.colorsNeedUpdate,this.lineDistancesNeedUpdate=t.lineDistancesNeedUpdate,this.groupsNeedUpdate=t.groupsNeedUpdate,this}toBufferGeometry(){let t=new Ist().fromGeometry(this),e=new oi,i=new Float32Array(t.vertices.length*3);if(e.setAttribute("position",lR.call(new Mi(i,3),t.vertices)),t.normals.length>0){let r=new Float32Array(t.normals.length*3);e.setAttribute("normal",lR.call(new Mi(r,3),t.normals))}if(t.colors.length>0){let r=new Float32Array(t.colors.length*3);e.setAttribute("color",Gee.call(new Mi(r,3),t.colors))}if(t.uvs.length>0){let r=new Float32Array(t.uvs.length*2);e.setAttribute("uv",Wee.call(new Mi(r,2),t.uvs))}if(t.uvs2.length>0){let r=new Float32Array(t.uvs2.length*2);e.setAttribute("uv2",Wee.call(new Mi(r,2),t.uvs2))}e.groups=t.groups;for(let r in t.morphTargets){let n=[],s=t.morphTargets[r];for(let a=0,o=s.length;a<o;a++){let l=s[a],c=new Gt(l.data.length*3,3);c.name=l.name,n.push(lR.call(c,l.data))}e.morphAttributes[r]=n}if(t.skinIndices.length>0){let r=new Gt(t.skinIndices.length*4,4);e.setAttribute("skinIndex",qee.call(r,t.skinIndices))}if(t.skinWeights.length>0){let r=new Gt(t.skinWeights.length*4,4);e.setAttribute("skinWeight",qee.call(r,t.skinWeights))}return t.boundingSphere!==null&&(e.boundingSphere=t.boundingSphere.clone()),t.boundingBox!==null&&(e.boundingBox=t.boundingBox.clone()),e}computeTangents(){console.error("THREE.Geometry: .computeTangents() has been removed.")}computeLineDistances(){console.error("THREE.Geometry: .computeLineDistances() has been removed. Use THREE.Line.computeLineDistances() instead.")}applyMatrix(t){return console.warn("THREE.Geometry: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(t)}dispose(){this.dispatchEvent({type:"dispose"})}static createBufferGeometryFromObject(t){let e=new oi,i=t.geometry;if(t.isPoints||t.isLine){let r=new Gt(i.vertices.length*3,3),n=new Gt(i.colors.length*3,3);if(e.setAttribute("position",lR.call(r,i.vertices)),e.setAttribute("color",Gee.call(n,i.colors)),i.lineDistances&&i.lineDistances.length===i.vertices.length){let s=new Gt(i.lineDistances.length,1);e.setAttribute("lineDistance",Dst.call(s,i.lineDistances))}i.boundingSphere!==null&&(e.boundingSphere=i.boundingSphere.clone()),i.boundingBox!==null&&(e.boundingBox=i.boundingBox.clone())}else t.isMesh&&(e=i.toBufferGeometry());return e}};k3.prototype.isGeometry=!0;var Ist=class{constructor(){this.vertices=[],this.normals=[],this.colors=[],this.uvs=[],this.uvs2=[],this.groups=[],this.morphTargets={},this.skinWeights=[],this.skinIndices=[],this.boundingBox=null,this.boundingSphere=null,this.verticesNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.uvsNeedUpdate=!1,this.groupsNeedUpdate=!1}computeGroups(t){let e=[],i,r,n,s=t.faces;for(r=0;r<s.length;r++){let a=s[r];a.materialIndex!==n&&(n=a.materialIndex,i!==void 0&&(i.count=r*3-i.start,e.push(i)),i={start:r*3,materialIndex:n})}i!==void 0&&(i.count=r*3-i.start,e.push(i)),this.groups=e}fromGeometry(t){let e=t.faces,i=t.vertices,r=t.faceVertexUvs,n=r[0]&&r[0].length>0,s=r[1]&&r[1].length>0,a=t.morphTargets,o=a.length,l;if(o>0){l=[];for(let m=0;m<o;m++)l[m]={name:a[m].name,data:[]};this.morphTargets.position=l}let c=t.morphNormals,u=c.length,h;if(u>0){h=[];for(let m=0;m<u;m++)h[m]={name:c[m].name,data:[]};this.morphTargets.normal=h}let d=t.skinIndices,f=t.skinWeights,p=d.length===i.length,g=f.length===i.length;i.length>0&&e.length===0&&console.error("THREE.DirectGeometry: Faceless geometries are not supported.");for(let m=0;m<e.length;m++){let y=e[m];this.vertices.push(i[y.a],i[y.b],i[y.c]);let b=y.vertexNormals;if(b.length===3)this.normals.push(b[0],b[1],b[2]);else{let E=y.normal;this.normals.push(E,E,E)}let w=y.vertexColors;if(w.length===3)this.colors.push(w[0],w[1],w[2]);else{let E=y.color;this.colors.push(E,E,E)}if(n===!0){let E=r[0][m];E!==void 0?this.uvs.push(E[0],E[1],E[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv ",m),this.uvs.push(new Ae,new Ae,new Ae))}if(s===!0){let E=r[1][m];E!==void 0?this.uvs2.push(E[0],E[1],E[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv2 ",m),this.uvs2.push(new Ae,new Ae,new Ae))}for(let E=0;E<o;E++){let M=a[E].vertices;l[E].data.push(M[y.a],M[y.b],M[y.c])}for(let E=0;E<u;E++){let M=c[E].vertexNormals[m];h[E].data.push(M.a,M.b,M.c)}p&&this.skinIndices.push(d[y.a],d[y.b],d[y.c]),g&&this.skinWeights.push(f[y.a],f[y.b],f[y.c])}return this.computeGroups(t),this.verticesNeedUpdate=t.verticesNeedUpdate,this.normalsNeedUpdate=t.normalsNeedUpdate,this.colorsNeedUpdate=t.colorsNeedUpdate,this.uvsNeedUpdate=t.uvsNeedUpdate,this.groupsNeedUpdate=t.groupsNeedUpdate,t.boundingSphere!==null&&(this.boundingSphere=t.boundingSphere.clone()),t.boundingBox!==null&&(this.boundingBox=t.boundingBox.clone()),this}},H5=class{constructor(t,e,i,r,n,s=0){this.a=t,this.b=e,this.c=i,this.normal=r&&r.isVector3?r:new W,this.vertexNormals=Array.isArray(r)?r:[],this.color=n&&n.isColor?n:new Ai,this.vertexColors=Array.isArray(n)?n:[],this.materialIndex=s}clone(){return new this.constructor().copy(this)}copy(t){this.a=t.a,this.b=t.b,this.c=t.c,this.normal.copy(t.normal),this.color.copy(t.color),this.materialIndex=t.materialIndex;for(let e=0,i=t.vertexNormals.length;e<i;e++)this.vertexNormals[e]=t.vertexNormals[e].clone();for(let e=0,i=t.vertexColors.length;e<i;e++)this.vertexColors[e]=t.vertexColors[e].clone();return this}};function Dst(t){return this.array.set(t),this}function Gee(t){let e=this.array,i=0;for(let r=0,n=t.length;r<n;r++){let s=t[r];s===void 0&&(console.warn("THREE.BufferAttribute.copyColorsArray(): color is undefined",r),s=new Ai),e[i++]=s.r,e[i++]=s.g,e[i++]=s.b}return this}function Wee(t){let e=this.array,i=0;for(let r=0,n=t.length;r<n;r++){let s=t[r];s===void 0&&(console.warn("THREE.BufferAttribute.copyVector2sArray(): vector is undefined",r),s=new Ae),e[i++]=s.x,e[i++]=s.y}return this}function lR(t){let e=this.array,i=0;for(let r=0,n=t.length;r<n;r++){let s=t[r];s===void 0&&(console.warn("THREE.BufferAttribute.copyVector3sArray(): vector is undefined",r),s=new W),e[i++]=s.x,e[i++]=s.y,e[i++]=s.z}return this}function qee(t){let e=this.array,i=0;for(let r=0,n=t.length;r<n;r++){let s=t[r];s===void 0&&(console.warn("THREE.BufferAttribute.copyVector4sArray(): vector is undefined",r),s=new Ui),e[i++]=s.x,e[i++]=s.y,e[i++]=s.z,e[i++]=s.w}return this}var Ost=["a","b","c"];function Lst(t,e){switch(e){case"c":return t.c;case"b":return t.b;case"a":default:return t.a}}function BF(t,e,i){let r=Math.min(t,e),n=Math.max(t,e),s=r+"_"+n;return i.get(s)}function FF(t,e,i,r,n,s){let a=Math.min(t,e),o=Math.max(t,e),l=a+"_"+o,c;if(r.has(l))c=r.get(l);else{let u=i[a],h=i[o];c={a:u,b:h,newEdge:null,faces:[]},r.set(l,c)}c.faces.push(n),s[t].edges.push(c),s[e].edges.push(c)}function kst(t,e,i,r){let n,s,a;for(n=0,s=t.length;n<s;n++)i[n]={edges:[]};for(n=0,s=e.length;n<s;n++)a=e[n],FF(a.a,a.b,t,r,a,i),FF(a.b,a.c,t,r,a,i),FF(a.c,a.a,t,r,a,i)}function cR(t,e,i,r,n){t.push(new H5(e,i,r,void 0,void 0,n))}function ow(t,e){return Math.abs(e-t)/2+Math.min(t,e)}function uR(t,e,i,r){t.push([e.clone(),i.clone(),r.clone()])}var Nst=class{constructor(t=1){this.subdivisions=t}modify(t){t instanceof oi?t=new k3().fromBufferGeometry(t):t=t.clone(),t.mergeVertices();let e=this.subdivisions;for(;e-- >0;)this._smooth(t);return t.computeFaceNormals(),t.computeVertexNormals(),t}_smooth(t){let e=new W,i,r,n,s,a,o=t.vertices,l=t.faces,c=t.faceVertexUvs[0],u=c!==void 0&&c.length>0,h=[],d=new Map;kst(o,l,h,d);let f=[],p,g,m,y,b,w,E;for(let le of Array.from(d.keys())){for(g=d.get(le),m=new W,b=3/8,w=1/8,E=g.faces.length,E!=2&&(b=.5,w=0,E!=1),m.addVectors(g.a,g.b).multiplyScalar(b),e.set(0,0,0),s=0;s<E;s++){for(y=g.faces[s],a=0;a<3&&(p=o[Lst(y,Ost[a])],!(p!==g.a&&p!==g.b));a++);p&&e.add(p)}e.multiplyScalar(w),m.add(e),g.newEdge=f.length,f.push(m)}let M,A,P,C,R,I,k,z=[];for(r=0,n=o.length;r<n;r++){for(I=o[r],R=h[r].edges,i=R.length,i==3?M=3/16:i>3&&(M=3/(8*i)),A=1-i*Number(M),P=M,i<=2&&(i==2?(A=3/4,P=1/8):i==1||i==0),k=I.clone().multiplyScalar(A),e.set(0,0,0),s=0;s<i;s++)C=R[s],p=C.a!==I?C.a:C.b,e.add(p);e.multiplyScalar(Number(P)),k.add(e),z.push(k)}let V=z.concat(f),F=z.length,$,K,X,U=[],Y=[],Z,j,ee,pe,fe=new Ae,se=new Ae,re=new Ae;for(r=0,n=l.length;r<n;r++)y=l[r],$=Number(BF(y.a,y.b,d).newEdge)+F,K=Number(BF(y.b,y.c,d).newEdge)+F,X=Number(BF(y.c,y.a,d).newEdge)+F,cR(U,$,K,X,y.materialIndex),cR(U,y.a,$,X,y.materialIndex),cR(U,y.b,K,$,y.materialIndex),cR(U,y.c,X,K,y.materialIndex),u&&(Z=c[r],j=Z[0],ee=Z[1],pe=Z[2],fe.set(ow(j.x,ee.x),ow(j.y,ee.y)),se.set(ow(ee.x,pe.x),ow(ee.y,pe.y)),re.set(ow(j.x,pe.x),ow(j.y,pe.y)),uR(Y,fe,se,re),uR(Y,j,fe,re),uR(Y,ee,se,fe),uR(Y,pe,re,se));t.vertices=V,t.faces=U,u&&(t.faceVertexUvs[0]=Y)}},ra=new W,Ust=class{static create(t){return this.build(this.normalizeInputs(t))}static normalizeInputs(t,e){let i=t.geometry??e?.geometry??new oi().copy(new Oh(100,100,100)),r;e===void 0?(i.computeBoundingBox(),i.boundingBox.getSize(ra),r={width:ra.x,height:ra.y,depth:ra.z,subdivisions:0}):r=e.parameters;let n={...r,...t.parameters};return{parameters:{width:Math.abs(n.width),height:Math.abs(n.height),depth:Math.abs(n.depth),subdivisions:Math.abs(n.subdivisions)},geometry:i}}static build(t){let{width:e,height:i,depth:r,subdivisions:n}=t.parameters,s=t.geometry??new oi().copy(new Oh(100,100,100)),a=s.userData.parameters;a===void 0?(s.computeBoundingBox(),s.boundingBox.getSize(ra)):ra.set(a.width,a.height,a.depth),(e!==ra.x||i!==ra.y||r!==ra.z)&&s.scale(ra.x===0?1:e/ra.x,ra.y===0?1:i/ra.y,ra.z===0?1:r/ra.z);let o=s.originalGeometry;try{n>0?(o===void 0||a?.subdivisions!==n)&&(o===void 0&&(o=s),s=new Nst(n).modify(o).toBufferGeometry()):(o!==void 0&&(s=o),o=void 0,s.getAttribute("normal")===void 0&&s.computeVertexNormals())}catch{o!==void 0&&(s=o),o=void 0,s.getAttribute("normal")===void 0&&s.computeVertexNormals()}return o!==void 0&&Object.assign(s,{originalGeometry:o}),delete t.geometry,Object.assign(s,{userData:{...t,type:"NonParametricGeometry"}})}static loadFromUrl(t,e,i){new jhe(i).load(t,r=>{let n=this.normalizeInputs({geometry:r});r.boundingBox.getSize(ra);let s=100/ra.x;Object.assign(n.parameters,{width:100,height:ra.y*s,depth:ra.z*s}),e(this.build(n))})}},rpe=class{static create(t){return this.build(this.normalizeInputs(t))}static normalizeInputs(t,e){let i=Object.assign({},e?.parameters??{width:100,depth:0,spikes:5,cornerRadius:0,extrudeBevelSize:0,extrudeBevelSegments:3},t.parameters);return{shape:t.shape&&t.shape instanceof as?t.shape:new as,parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??0)})}}static build(t){let{width:e,height:i,spikes:r,cornerRadius:n,depth:s,extrudeBevelSize:a,extrudeBevelSegments:o}=t.parameters,l=t.shape,c=e*.5,u=i*.5,h=0,d=0,f=2*Math.PI/r;for(let g=0;g<r;g++){let m=f*g,y=h+Math.sin(m)*c,b=d+Math.cos(m)*u;l.addPoint(l.createPoint(y,b))}l.isClosed=!0;for(let g=0,m=l.points.length;g<m;g++)l.points[g].roundness=n;l.roundness=n,l.update();let p=Q0.create({shape:l,parameters:{roundness:n,depth:s,extrudeBevelSize:a,extrudeBevelSegments:o}});return Object.assign(p,{userData:{...t,type:"PolygonGeometry"}})}},Bst=class{static create(t){return this.build(this.normalizeInputs(t))}static normalizeInputs(t,e){let i=Object.assign({},e?.parameters??{width:100,radialSegments:4,heightSegments:1,cornerRadius:0,cornerSegments:8,openEnded:!1},t.parameters);return{parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??i.width)})}}static build(t){let{width:e,height:i,depth:r,radialSegments:n,heightSegments:s,openEnded:a,cornerRadius:o,cornerSegments:l}=t.parameters,c=new zst(e*.5,i,n,s,a,o,l);return c.scale(1,1,r/e),Object.assign(c,{userData:{...t,type:"PyramidGeometry"}})}};function _E(t,e,i){i.x=t.x*e.x,i.y=t.y,i.z=t.x*e.y}function zF(t,e,i,r,n,s){let a=e.clone().sub(t),o=i.clone().sub(t),l=a.angleTo(o);if(a.normalize(),o.normalize(),r===n){let c=a.add(o).normalize();s.copy(t).addScaledVector(c,r/Math.sin(l/2))}else{let c=a.angleTo(o);s.copy(t),s.addScaledVector(a,n/Math.sin(c)),s.addScaledVector(o,r/Math.sin(c))}}function Fst(t,e,i){let r=t.clone().sub(e),n=i.clone().sub(e);return r.projectOnVector(n),r.add(e)}var zst=class extends oi{constructor(t=.5,e=1,i=4,r=1,n=!1,s=0,a=4){super(),i=Math.floor(Math.max(3,i)),r=Math.floor(r),a=Math.floor(a);let o=[],l=[],c=[],u=[],h=0,d=e/2,f=Math.PI/i,p=t*Math.cos(Math.PI/i),g=2*Math.PI/i,m=(i-2)*Math.PI/i,y=Math.PI-m,b=new W(0,-d,0),w=new W(0,d,0),E=new Ae(t,-d),M=new Ae(p,-d),A=new Ae(0,w.y).sub(M),P=new Ae(0,w.y).sub(E),C=new Ae(A.y,-A.x).normalize(),R=new Ae(P.y,-P.x).normalize(),I=t*Math.cos(Math.PI/i)*Math.tan((Math.PI-A.angle())/2)-1e-8;s=Math.min(s,I);let k;{let X=new W(C.x,C.y,0),U=new W(Math.cos(g)*X.x,X.y,Math.sin(g)*X.x);k=X.angleTo(U)}let z=s/Math.tan((Math.PI-A.angle())/2),V=s/Math.tan((Math.PI-k)/2),F=new W;if(!n){l.push(b.x,b.y,b.z),c.push(0,-1,0),u.push(0,0);let X=h++,U=[],Y=E.clone(),Z=z/Math.cos(Math.PI/i);Y.x-=Z;for(let j=0;j<i;j++){let ee=j/i*Math.PI*2+f,pe=new Ae(Math.sin(ee),Math.cos(ee));_E(Y,pe,F),l.push(F.x,F.y,F.z),c.push(0,-1,0),u.push(0,0),U.push(h++)}for(let j=0;j<U.length;j++)o.push(U[j],X,U[(j+1)%U.length])}{let X=new W,U=new W,Y=new W,Z=new W,j=new W,ee=new W;for(let pe=0;pe<i;pe++){let fe=pe/i*Math.PI*2+f,se=(pe+.5)/i*Math.PI*2+f,re=(pe+1)/i*Math.PI*2+f,le=new Ae(Math.sin(fe),Math.cos(fe)),he=new Ae(Math.sin(se),Math.cos(se)),ve=new Ae(Math.sin(re),Math.cos(re));_E(E,le,U),_E(E,ve,Y),_E(C,he,X),zF(w,U,Y,V,V,Z),l.push(Z.x,Z.y,Z.z),zF(U,w,Y,V,z,j),l.push(j.x,j.y,j.z),zF(Y,U,w,z,V,ee),l.push(ee.x,ee.y,ee.z),c.push(X.x,X.y,X.z),c.push(X.x,X.y,X.z),c.push(X.x,X.y,X.z),u.push(0,0),u.push(0,0),u.push(0,0);let xe=h++,Se=h++,Ce=h++;if(o.push(xe,Se,Ce),s>0){{let De=U.clone().add(Y).multiplyScalar(.5),He=w.clone().sub(De).normalize(),Be=b.clone().sub(De).normalize().add(He).normalize().multiplyScalar(-1),$e=ee.clone().sub(j);$(De,$e,Be,A.angle())}let ce,Fe;{let De=new W;_E(R,ve,De);let He=ee.clone().add(Z).multiplyScalar(.5);He=Fst(He,Y,w);let Be=ee.clone().sub(Z);[ce,Fe]=$(He,Be,De,k,Z.y)}{let De=ce,He=De.clone().setY(0).normalize(),Be=new W(0,-1,0),$e=He.clone().cross(Be);K(De,He,Be,$e)}{let De=A.angle(),He=Math.PI-De,Be=w.clone();Be.y-=s/Math.sin(De-Math.PI/2);let $e=new W,ze=[];for(let wt=0;wt<a;wt++){let ge=[],G=Math.PI/2-He*wt/a,Q=Math.cos(G),we=Math.sin(G),te=se;for(let Ne=0;Ne<=wt;Ne++){let Le=Math.cos(te),at=Math.sin(te);X.x=Q*at,X.y=we,X.z=Q*Le,$e.copy(Be).addScaledVector(X,s),l.push($e.x,$e.y,$e.z),c.push(X.x,X.y,X.z),u.push(0,0),ge.push(h++),te+=Math.PI*2/wt/i}ze.push(ge)}Fe.reverse(),ze.push(Fe);let it=ze.length-1;for(let wt=0;wt<it;wt++){let ge=ze[wt],G=ze[wt+1],Q=ge.length-1;o.push(G[1],ge[0],G[0]);for(let we=1;we<=Q;we++)o.push(ge[we],ge[we-1],G[we]),o.push(G[we+1],ge[we],G[we])}}}}}this.setIndex(o),this.setAttribute("position",new Gt(l,3)),this.setAttribute("normal",new Gt(c,3)),this.setAttribute("uv",new Gt(u,2));function $(X,U,Y,Z,j){let ee=-Z/2,pe=(Math.PI-Z)/2,fe=U.clone().normalize().cross(Y);X.addScaledVector(Y,-s/Math.sin(pe));let se=new W,re=new W,le=1,he=h,ve=[];for(let xe=0;xe<=a;xe++){let Se=ee+xe/a*Z;re.set(0,0,0),re.addScaledVector(fe,Math.sin(Se)),re.addScaledVector(Y,Math.cos(Se));for(let Ce=0;Ce<=le;Ce++){let ce=Ce/le-.5;if(se.copy(X),se.addScaledVector(U,ce),se.addScaledVector(re,s),j!=null){let Fe=Math.max(0,se.y-j);se.addScaledVector(U,-Fe/U.y)}l.push(se.x,se.y,se.z),c.push(re.x,re.y,re.z),u.push(0,0),Ce===0&&ve.push(h),h++}}for(let xe=0;xe<a;xe++)for(let Se=0;Se<le;Se++){let Ce=he+Se+(le+1)*xe,ce=Ce+(le+1),Fe=ce+1,De=Ce+1;o.push(Ce,ce,De),o.push(ce,Fe,De)}return[X.clone().addScaledVector(U,.5),ve]}function K(X,U,Y,Z){let j=Math.PI/2,ee=P.angle()-j,pe=[],fe=new W,se=new W;for(let le=0;le<=a;le++){let he=[],ve=le/a;for(let xe=0;xe<=le;xe++){let Se=((le?xe/le:0)-.5)*y,Ce=Math.cos(Se),ce=Math.sin(Se),Fe=Math.atan(Math.tan(ee)*Ce),De=(j+Fe)*ve,He=Math.cos(De),Be=Math.sin(De);fe.set(0,0,0),fe.addScaledVector(U,Be*Ce),fe.addScaledVector(Y,He),fe.addScaledVector(Z,Be*ce),se.copy(X).addScaledVector(fe,s),l.push(se.x,se.y,se.z),c.push(fe.x,fe.y,fe.z),u.push(0,0),he.push(h++)}pe.push(he)}let re=pe.length-1;for(let le=0;le<re;le++){let he=pe[le],ve=pe[le+1],xe=he.length-1;o.push(he[0],ve[1],ve[0]);for(let Se=1;Se<=xe;Se++)o.push(he[Se-1],he[Se],ve[Se]),o.push(he[Se],ve[Se+1],ve[Se])}}}},r8=class{static create(t){return this.build(this.normalizeInputs(t))}static normalizeInputs(t,e){let i=Object.assign({},e?.parameters??{width:100,depth:0,cornerRadius:[0,0,0,0],cornerType:1,extrudeBevelSize:0,extrudeBevelSegments:1},t.parameters),r=Object.assign(e?.ui??{enabledIndieCorners:!1},t.ui);return{shape:t.shape&&t.shape instanceof as?t.shape:new as,parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??0)}),ui:r}}static build(t){let e=t.shape,{width:i,height:r,cornerRadius:n,cornerType:s,depth:a,extrudeBevelSize:o,extrudeBevelSegments:l}=t.parameters,c={x:i*.5,y:r*.5},u={x:-c.x,y:-c.y},h={x:c.x,y:c.y};function d(E,M,A){return M>i&&A>r?Math.min(E*i/M,E*r/A):M>i?E*i/M:A>r?E*r/A:E}let f=[];f[0]=n[0]===0?0:d(n[0],n[0]+n[3],n[0]+n[1]),f[1]=n[1]===0?0:d(n[1],n[1]+n[2],n[1]+n[0]),f[2]=n[2]===0?0:d(n[2],n[2]+n[1],n[2]+n[3]),f[3]=n[3]===0?0:d(n[3],n[3]+n[0],n[3]+n[2]);let p=u.x,g=h.x,m=h.y,y=u.y;e.addPoint(e.createPoint(p,m)),e.addPoint(e.createPoint(g,m)),e.addPoint(e.createPoint(g,y)),e.addPoint(e.createPoint(p,y)),e.isClosed=!0;let b=!0;for(let E=0,M=e.points.length;E<M;E++)e.points[E].roundness=f[E],E>0&&f[E]!==f[E-1]&&(b=!1);b&&(e.roundness=f[0]),e.useCubicForRoundedCorners=s!==1,e.update();let w=Q0.create({shape:e,parameters:{depth:a,extrudeBevelSize:o,extrudeBevelSegments:l}});return Object.assign(w,{userData:{...t,type:"RectangleGeometry"}})}},jst=class{static create(t){return this.build(this.normalizeInputs(t))}static normalizeInputs(t,e){let i=Object.assign({},e?.parameters??{width:100,widthSegments:64,heightSegments:64,phiStart:0,phiLength:2*Math.PI,thetaStart:0,thetaLength:180},t.parameters);return i.thetaLength=Ht.clamp(i.thetaLength,0,180),{parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??i.width)})}}static build(t){let{width:e=100,height:i=e,depth:r=e,widthSegments:n=64,heightSegments:s=64,phiStart:a,phiLength:o,thetaStart:l,thetaLength:c}=t.parameters,u;return c===0?(u=new oi,u.setAttribute("position",new Gt([],3))):u=new a1(.5*e,n,s,a,o,l,c*Ht.DEG2RAD),u.scale(1,i/e,r/e),Object.assign(u,{userData:{...t,type:"SphereGeometry"}})}},Vst=class{static create(t){return this.build(this.normalizeInputs(t))}static normalizeInputs(t,e){let i=Object.assign({},e?.parameters??{width:100,depth:0,widthSegments:8,heightSegments:8},t.parameters);return{parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:0})}}static build(t){let{width:e=100,height:i=e,widthSegments:r=8,heightSegments:n=8}=t.parameters,s=new ef(e,i,r,n);return s.scale(1,1,1),Object.assign(s,{userData:{...t,type:"PlaneGeometry"}})}},Hst=class{static create(t){return this.build(this.normalizeInputs(t))}static normalizeInputs(t,e){let i=Object.assign({},e?.parameters??{width:100,angle:90,cornerRadius:24,cornerSegments:8},t.parameters);return{parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??i.width)})}}static build(t){let{width:e,height:i,depth:r,angle:n,cornerRadius:s,cornerSegments:a}=t.parameters,o=new Gst(e,i,r,n,s,a);return Object.assign(o,{userData:{...t,type:"BackdropGeometry"}})}},Gst=class extends oi{constructor(t=1,e=1,i=1,r=90,n=10,s=24){super(),this.type="BackdropGeometry";let a=[],o=[],l=[],c=.001;n==0&&(s=1),s=Math.max(1,Math.floor(s)),n=Math.min(n,100),r=Math.min(180-c,r),r*=Math.PI/180;let u=[],h=Math.PI/2,d=(le=0,he=0,ve=0)=>new W(le,he,ve),f=d(),p=d(),[g,m,y]=[e/2,t/2,i/2],b=-m,w=+m,[E,M,A]=[d(b,-g,+y),d(b,-g,-y),d(b,+g,-y)],P=(le,he=!1)=>Math.sin(le-Math.PI/(1+ +he)),C=(le,he=!1)=>Math.cos(le-Math.PI/(1+ +he));A.y=Math.sin(r)*e-g;let R=Math.cos(r)*e-y,I=E.z-c;r<=h?(A.z=Math.min(R,I),A.z==I&&(A.y-=(R-I)/Math.tan(h-r))):M.z=Math.min(M.z-R-y,E.z-c),f.subVectors(E,M),p.subVectors(A,M);let k=Math.min(f.length(),p.length())*n/100,z=k*Math.tan(r/2),V=k/Math.cos(r/2),F=f.clone().normalize().add(p.normalize()).setLength(V).add(M);f.set(0,P(r,!0),C(r,!0)),u.push([A,f.clone()]);let $=(Math.PI-r)/s;for(let le=0;le<=s;le++){let he=h+r+le*$;f.set(0,Math.sin(he)*z,Math.cos(he)*z),f.add(F),p.set(0,P(he),C(he)),u.push([f.clone(),p.clone()])}u.push([E,d(0,1,0)]);let K=Math.sin($/2)*z*2,X=u.length-1,U=u[0][0].distanceTo(u[1][0]),Y=u[X-1][0].distanceTo(u[X][0]),Z=U+K*s+Y;u[0].push(1);for(let le=0;le<=s;le++)u[le+1].push(1-(U+le*K)/Z);u[X].push(0);let[j,ee,pe]=u[0],fe,se,re;for(let le=1;le<u.length;le++)[fe,se,re]=u[le],a.push(b,j.y,j.z,b,fe.y,fe.z,w,j.y,j.z,w,j.y,j.z,b,fe.y,fe.z,w,fe.y,fe.z),o.push(0,ee.y,ee.z,0,se.y,se.z,0,ee.y,ee.z,0,ee.y,ee.z,0,se.y,se.z,0,se.y,se.z),l.push(0,pe,0,re,1,pe,1,pe,0,re,1,re),[j,ee,pe]=[fe,se,re];this.setAttribute("position",new Gt(a,3)),this.setAttribute("normal",new Gt(o,3)),this.setAttribute("uv",new Gt(l,2))}},npe=class{static create(t){return this.build(this.normalizeInputs(t))}static normalizeInputs(t,e){let i=Object.assign({},e?.parameters??{width:100,depth:0,innerRadiusPercent:38.19,spikes:5,cornerRadius:0,angle:360,extrudeBevelSize:0,extrudeBevelSegments:1},t.parameters);return{shape:t.shape&&t.shape instanceof as?t.shape:new as,parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??0)})}}static build(t){let{width:e,height:i,innerRadiusPercent:r,spikes:n,cornerRadius:s,angle:a,depth:o,extrudeBevelSize:l,extrudeBevelSegments:c}=t.parameters,u=t.shape,h=e*.5,d=i*.5,f=0,p=0,g=a*Math.PI/360/n,m=Math.PI/2*3*-1,y=h*r/100,b=d*r/100;if(n===3&&r===50){g=2*Math.PI/n;for(let E=0;E<n;E++){let M=g*E,A=f+Math.sin(M)*h,P=p+Math.cos(M)*d;u.addPoint(u.createPoint(A,P))}}else for(let E=0;E<n;E++){let M=f+Math.cos(m)*h,A=p+Math.sin(m)*d;u.addPoint(u.createPoint(M,A)),m+=g,M=f+Math.cos(m)*y,A=p+Math.sin(m)*b,u.addPoint(u.createPoint(M,A)),m+=g}u.isClosed=!0;for(let E=0,M=u.points.length;E<M;E++)u.points[E].roundness=s;u.roundness=s,u.update();let w=Q0.create({shape:u,parameters:{roundness:s,depth:o,extrudeBevelSize:l,extrudeBevelSegments:c}});return Object.assign(w,{userData:{...t,type:"StarGeometry"}})}},Wst=class{static create(t){return this.build(this.normalizeInputs(t))}static normalizeInputs(t,e){let i=Object.assign({},e?.parameters??{width:100,depth:0},t.parameters);return{parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??0)})}}static build(t){let{width:e,height:i}=t.parameters,r=new ef(e,i);return Object.assign(r,{userData:{...t,type:"TextFrameGeometry"}})}},qst=class{static create(t){return this.build(this.normalizeInputs(t))}static normalizeInputs(t,e){let i=Object.assign({},e?.parameters??{width:100,radialSegments:32,tubularSegments:64,arc:360,cornerRadius:30,cornerSegments:8},t.parameters),r=Math.abs(i.width),n=Math.abs(i.height??i.width);i.shapeBlendNode&&(n=r);let s=Math.round(Math.abs(i.depth??i.width*.25));return{parameters:Object.assign(i,{width:r,height:n,depth:s})}}static build(t){let{width:e,height:i,depth:r,radialSegments:n,tubularSegments:s,arc:a,cornerRadius:o,cornerSegments:l}=t.parameters,c=Xst(e,i,r,e*.5,a,s,0,0,n,o,l);return c.scale(1,i/e,1),Object.assign(c,{userData:{...t,type:"TorusGeometry"}})}};function Xst(t,e,i,r,n,s,a,o,l,c,u){[e,i]=[i,e],a=e/2;let h=Ht.clamp(n/360,0,1);if(h===0){let d=new oi;return d.setAttribute("position",new Gt([],3)),d}return h===1&&(c=0),new tpe(!0,t,e,i,r,h,s,a,o,l,c,u)}var $st=class{static create(t){return this.build(this.normalizeInputs(t))}static normalizeInputs(t,e){let i=Object.assign({},e?.parameters??{width:100,tubularSegments:64,radialSegments:32,p:2,q:3},t.parameters);return{parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width),depth:Math.abs(i.depth??i.width),tube:i.tube??i.width*.125})}}static build(t){let{width:e,tube:i,tubularSegments:r,radialSegments:n,p:s,q:a}=t.parameters,o=e*.5;o!==i&&(o-=i);let l=new Lhe(o,i,r,n,s,a);return Object.assign(l,{userData:{...t,type:"TorusKnotGeometry"}})}},Yst=class{static create(t){return this.build(this.normalizeInputs(t))}static normalizeInputs(t,e){let i=Object.assign({},e?.parameters??{width:100,depth:0,spikes:5,cornerRadius:0,extrudeBevelSize:0,extrudeBevelSegments:1,isRect:!1},t.parameters);return{shape:t.shape&&t.shape instanceof as?t.shape:new as,parameters:Object.assign(i,{width:Math.abs(i.width),height:Math.abs(i.height??i.width*(i.isRect?1:Math.sqrt(3)/2)),depth:Math.abs(i.depth??0)})}}static build(t){let{width:e=100,height:i,cornerRadius:r,depth:n,extrudeBevelSize:s,extrudeBevelSegments:a,isRect:o}=t.parameters,l=t.shape,c=e*.5,u=i*.5;o?(l.addPoint(l.createPoint(-c,u)),l.addPoint(l.createPoint(c,-u)),l.addPoint(l.createPoint(-c,-u))):(l.addPoint(l.createPoint(0,u)),l.addPoint(l.createPoint(c,-u)),l.addPoint(l.createPoint(-c,-u))),l.isClosed=!0;for(let d=0,f=l.points.length;d<f;d++)l.points[d].roundness=r;l.roundness=r,l.update();let h=Q0.create({shape:l,parameters:{roundness:r,depth:n,extrudeBevelSize:s,extrudeBevelSegments:a}});return Object.assign(h,{userData:{...t,type:"TriangleGeometry"}})}};function Kst(t,e){let i=2*Math.PI;return(t%i+i)%i===(e%i+i)%i}function Zst(t){return/^(rgba)?\(\s*(\d+),\s*(\d+),\s*(\d+)(?:,\s*(\d+(?:\.\d+)?))?\s*\)$/.exec(t.toLowerCase())}function Qst(t,e,i){let r,n,s,a=Math.floor(t*6),o=t*6-a,l=i*(1-e),c=i*(1-o*e),u=i*(1-(1-o)*e);switch(a%6){case 0:r=i,n=u,s=l;break;case 1:r=c,n=i,s=l;break;case 2:r=l,n=i,s=u;break;case 3:r=l,n=c,s=i;break;case 4:r=u,n=l,s=i;break;case 5:default:r=i,n=l,s=c;break}return{r:r*255,g:n*255,b:s*255}}function Jst(t,e,i){t/=255,e/=255,i/=255;let r=Math.max(t,e,i),n=Math.min(t,e,i),s=r,a=r-n,o=r==0?0:a/r,l;if(r==n)l=0;else{switch(r){case t:l=(e-i)/a+(e<i?6:0);break;case e:l=(i-t)/a+2;break;case i:default:l=(t-e)/a+4;break}l/=6}return{h:l,s:o,v:s}}function eat(t){return t=Math.floor(t),{r:t>>16&255,g:t>>8&255,b:t&255}}function tat(t,e,i){return(t<<16)+(e<<8)+i}function iat(t,e,i){return t=Math.round(t),e=Math.round(e),i=Math.round(i),"#"+[t,e,i].map(r=>r.toString(16).padStart(2,"0")).join("").toUpperCase()}function rat(t){let e=/^#?([a-f\d])([a-f\d])([a-f\d])$/i;t=t.replace(e,(r,n,s,a)=>String(n+n+s+s+a+a));let i=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);return i?{r:parseInt(i[1],16),g:parseInt(i[2],16),b:parseInt(i[3],16)}:null}var nat={parseRgba:Zst,hsvToRgb:Qst,rgbToHsv:Jst,hexToRgb:eat,rgbToHex:tat,rgbToHexString:iat,hexStringToRgb:rat},sat=class{add(t,e,i){if(typeof arguments[0]!="string")for(let r in arguments[0])this.add(r,arguments[0][r],arguments[1]);else(Array.isArray(t)?t:[t]).forEach(function(r){this[r]=this[r]||[],e&&this[r][i?"unshift":"push"](e)},this)}run(t,e){this[t]=this[t]||[],this[t].forEach(function(i){i.call(e&&e.context?e.context:e,e)})}},aat=class{constructor(t){this.jsep=t,this.registered={}}register(...t){t.forEach(e=>{if(typeof e!="object"||!e.name||!e.init)throw new Error("Invalid JSEP plugin format");this.registered[e.name]||(e.init(this.jsep),this.registered[e.name]=e)})}},mt=class{static get version(){return"1.3.8"}static toString(){return"JavaScript Expression Parser (JSEP) v"+mt.version}static addUnaryOp(t){return mt.max_unop_len=Math.max(t.length,mt.max_unop_len),mt.unary_ops[t]=1,mt}static addBinaryOp(t,e,i){return mt.max_binop_len=Math.max(t.length,mt.max_binop_len),mt.binary_ops[t]=e,i?mt.right_associative.add(t):mt.right_associative.delete(t),mt}static addIdentifierChar(t){return mt.additional_identifier_chars.add(t),mt}static addLiteral(t,e){return mt.literals[t]=e,mt}static removeUnaryOp(t){return delete mt.unary_ops[t],t.length===mt.max_unop_len&&(mt.max_unop_len=mt.getMaxKeyLen(mt.unary_ops)),mt}static removeAllUnaryOps(){return mt.unary_ops={},mt.max_unop_len=0,mt}static removeIdentifierChar(t){return mt.additional_identifier_chars.delete(t),mt}static removeBinaryOp(t){return delete mt.binary_ops[t],t.length===mt.max_binop_len&&(mt.max_binop_len=mt.getMaxKeyLen(mt.binary_ops)),mt.right_associative.delete(t),mt}static removeAllBinaryOps(){return mt.binary_ops={},mt.max_binop_len=0,mt}static removeLiteral(t){return delete mt.literals[t],mt}static removeAllLiterals(){return mt.literals={},mt}get char(){return this.expr.charAt(this.index)}get code(){return this.expr.charCodeAt(this.index)}constructor(t){this.expr=t,this.index=0}static parse(t){return new mt(t).parse()}static getMaxKeyLen(t){return Math.max(0,...Object.keys(t).map(e=>e.length))}static isDecimalDigit(t){return t>=48&&t<=57}static binaryPrecedence(t){return mt.binary_ops[t]||0}static isIdentifierStart(t){return t>=65&&t<=90||t>=97&&t<=122||t>=128&&!mt.binary_ops[String.fromCharCode(t)]||mt.additional_identifier_chars.has(String.fromCharCode(t))}static isIdentifierPart(t){return mt.isIdentifierStart(t)||mt.isDecimalDigit(t)}throwError(t){let e=new Error(t+" at character "+this.index);throw e.index=this.index,e.description=t,e}runHook(t,e){if(mt.hooks[t]){let i={context:this,node:e};return mt.hooks.run(t,i),i.node}return e}searchHook(t){if(mt.hooks[t]){let e={context:this};return mt.hooks[t].find(function(i){return i.call(e.context,e),e.node}),e.node}}gobbleSpaces(){let t=this.code;for(;t===mt.SPACE_CODE||t===mt.TAB_CODE||t===mt.LF_CODE||t===mt.CR_CODE;)t=this.expr.charCodeAt(++this.index);this.runHook("gobble-spaces")}parse(){this.runHook("before-all");let t=this.gobbleExpressions(),e=t.length===1?t[0]:{type:mt.COMPOUND,body:t};return this.runHook("after-all",e)}gobbleExpressions(t){let e=[],i,r;for(;this.index<this.expr.length;)if(i=this.code,i===mt.SEMCOL_CODE||i===mt.COMMA_CODE)this.index++;else if(r=this.gobbleExpression())e.push(r);else if(this.index<this.expr.length){if(i===t)break;this.throwError('Unexpected "'+this.char+'"')}return e}gobbleExpression(){let t=this.searchHook("gobble-expression")||this.gobbleBinaryExpression();return this.gobbleSpaces(),this.runHook("after-expression",t)}gobbleBinaryOp(){this.gobbleSpaces();let t=this.expr.substr(this.index,mt.max_binop_len),e=t.length;for(;e>0;){if(mt.binary_ops.hasOwnProperty(t)&&(!mt.isIdentifierStart(this.code)||this.index+t.length<this.expr.length&&!mt.isIdentifierPart(this.expr.charCodeAt(this.index+t.length))))return this.index+=e,t;t=t.substr(0,--e)}return!1}gobbleBinaryExpression(){let t,e,i,r,n,s,a,o,l;if(s=this.gobbleToken(),!s||(e=this.gobbleBinaryOp(),!e))return s;for(n={value:e,prec:mt.binaryPrecedence(e),right_a:mt.right_associative.has(e)},a=this.gobbleToken(),a||this.throwError("Expected expression after "+e),r=[s,n,a];e=this.gobbleBinaryOp();){if(i=mt.binaryPrecedence(e),i===0){this.index-=e.length;break}n={value:e,prec:i,right_a:mt.right_associative.has(e)},l=e;let c=u=>n.right_a&&u.right_a?i>u.prec:i<=u.prec;for(;r.length>2&&c(r[r.length-2]);)a=r.pop(),e=r.pop().value,s=r.pop(),t={type:mt.BINARY_EXP,operator:e,left:s,right:a},r.push(t);t=this.gobbleToken(),t||this.throwError("Expected expression after "+l),r.push(n,t)}for(o=r.length-1,t=r[o];o>1;)t={type:mt.BINARY_EXP,operator:r[o-1].value,left:r[o-2],right:t},o-=2;return t}gobbleToken(){let t,e,i,r;if(this.gobbleSpaces(),r=this.searchHook("gobble-token"),r)return this.runHook("after-token",r);if(t=this.code,mt.isDecimalDigit(t)||t===mt.PERIOD_CODE)return this.gobbleNumericLiteral();if(t===mt.SQUOTE_CODE||t===mt.DQUOTE_CODE)r=this.gobbleStringLiteral();else if(t===mt.OBRACK_CODE)r=this.gobbleArray();else{for(e=this.expr.substr(this.index,mt.max_unop_len),i=e.length;i>0;){if(mt.unary_ops.hasOwnProperty(e)&&(!mt.isIdentifierStart(this.code)||this.index+e.length<this.expr.length&&!mt.isIdentifierPart(this.expr.charCodeAt(this.index+e.length)))){this.index+=i;let n=this.gobbleToken();return n||this.throwError("missing unaryOp argument"),this.runHook("after-token",{type:mt.UNARY_EXP,operator:e,argument:n,prefix:!0})}e=e.substr(0,--i)}mt.isIdentifierStart(t)?(r=this.gobbleIdentifier(),mt.literals.hasOwnProperty(r.name)?r={type:mt.LITERAL,value:mt.literals[r.name],raw:r.name}:r.name===mt.this_str&&(r={type:mt.THIS_EXP})):t===mt.OPAREN_CODE&&(r=this.gobbleGroup())}return r?(r=this.gobbleTokenProperty(r),this.runHook("after-token",r)):this.runHook("after-token",!1)}gobbleTokenProperty(t){this.gobbleSpaces();let e=this.code;for(;e===mt.PERIOD_CODE||e===mt.OBRACK_CODE||e===mt.OPAREN_CODE||e===mt.QUMARK_CODE;){let i;if(e===mt.QUMARK_CODE){if(this.expr.charCodeAt(this.index+1)!==mt.PERIOD_CODE)break;i=!0,this.index+=2,this.gobbleSpaces(),e=this.code}this.index++,e===mt.OBRACK_CODE?(t={type:mt.MEMBER_EXP,computed:!0,object:t,property:this.gobbleExpression()},this.gobbleSpaces(),e=this.code,e!==mt.CBRACK_CODE&&this.throwError("Unclosed ["),this.index++):e===mt.OPAREN_CODE?t={type:mt.CALL_EXP,arguments:this.gobbleArguments(mt.CPAREN_CODE),callee:t}:(e===mt.PERIOD_CODE||i)&&(i&&this.index--,this.gobbleSpaces(),t={type:mt.MEMBER_EXP,computed:!1,object:t,property:this.gobbleIdentifier()}),i&&(t.optional=!0),this.gobbleSpaces(),e=this.code}return t}gobbleNumericLiteral(){let t="",e,i;for(;mt.isDecimalDigit(this.code);)t+=this.expr.charAt(this.index++);if(this.code===mt.PERIOD_CODE)for(t+=this.expr.charAt(this.index++);mt.isDecimalDigit(this.code);)t+=this.expr.charAt(this.index++);if(e=this.char,e==="e"||e==="E"){for(t+=this.expr.charAt(this.index++),e=this.char,(e==="+"||e==="-")&&(t+=this.expr.charAt(this.index++));mt.isDecimalDigit(this.code);)t+=this.expr.charAt(this.index++);mt.isDecimalDigit(this.expr.charCodeAt(this.index-1))||this.throwError("Expected exponent ("+t+this.char+")")}return i=this.code,mt.isIdentifierStart(i)?this.throwError("Variable names cannot start with a number ("+t+this.char+")"):(i===mt.PERIOD_CODE||t.length===1&&t.charCodeAt(0)===mt.PERIOD_CODE)&&this.throwError("Unexpected period"),{type:mt.LITERAL,value:parseFloat(t),raw:t}}gobbleStringLiteral(){let t="",e=this.index,i=this.expr.charAt(this.index++),r=!1;for(;this.index<this.expr.length;){let n=this.expr.charAt(this.index++);if(n===i){r=!0;break}else if(n==="\\")switch(n=this.expr.charAt(this.index++),n){case"n":t+=`
`;break;case"r":t+="\r";break;case"t":t+="	";break;case"b":t+="\b";break;case"f":t+="\f";break;case"v":t+="\v";break;default:t+=n}else t+=n}return r||this.throwError('Unclosed quote after "'+t+'"'),{type:mt.LITERAL,value:t,raw:this.expr.substring(e,this.index)}}gobbleIdentifier(){let t=this.code,e=this.index;for(mt.isIdentifierStart(t)?this.index++:this.throwError("Unexpected "+this.char);this.index<this.expr.length&&(t=this.code,mt.isIdentifierPart(t));)this.index++;return{type:mt.IDENTIFIER,name:this.expr.slice(e,this.index)}}gobbleArguments(t){let e=[],i=!1,r=0;for(;this.index<this.expr.length;){this.gobbleSpaces();let n=this.code;if(n===t){i=!0,this.index++,t===mt.CPAREN_CODE&&r&&r>=e.length&&this.throwError("Unexpected token "+String.fromCharCode(t));break}else if(n===mt.COMMA_CODE){if(this.index++,r++,r!==e.length){if(t===mt.CPAREN_CODE)this.throwError("Unexpected token ,");else if(t===mt.CBRACK_CODE)for(let s=e.length;s<r;s++)e.push(null)}}else if(e.length!==r&&r!==0)this.throwError("Expected comma");else{let s=this.gobbleExpression();(!s||s.type===mt.COMPOUND)&&this.throwError("Expected comma"),e.push(s)}}return i||this.throwError("Expected "+String.fromCharCode(t)),e}gobbleGroup(){this.index++;let t=this.gobbleExpressions(mt.CPAREN_CODE);if(this.code===mt.CPAREN_CODE)return this.index++,t.length===1?t[0]:t.length?{type:mt.SEQUENCE_EXP,expressions:t}:!1;this.throwError("Unclosed (")}gobbleArray(){return this.index++,{type:mt.ARRAY_EXP,elements:this.gobbleArguments(mt.CBRACK_CODE)}}},oat=new sat;Object.assign(mt,{hooks:oat,plugins:new aat(mt),COMPOUND:"Compound",SEQUENCE_EXP:"SequenceExpression",IDENTIFIER:"Identifier",MEMBER_EXP:"MemberExpression",LITERAL:"Literal",THIS_EXP:"ThisExpression",CALL_EXP:"CallExpression",UNARY_EXP:"UnaryExpression",BINARY_EXP:"BinaryExpression",ARRAY_EXP:"ArrayExpression",TAB_CODE:9,LF_CODE:10,CR_CODE:13,SPACE_CODE:32,PERIOD_CODE:46,COMMA_CODE:44,SQUOTE_CODE:39,DQUOTE_CODE:34,OPAREN_CODE:40,CPAREN_CODE:41,OBRACK_CODE:91,CBRACK_CODE:93,QUMARK_CODE:63,SEMCOL_CODE:59,COLON_CODE:58,unary_ops:{"-":1,"!":1,"~":1,"+":1},binary_ops:{"||":1,"&&":2,"|":3,"^":4,"&":5,"==":6,"!=":6,"===":6,"!==":6,"<":7,">":7,"<=":7,">=":7,"<<":8,">>":8,">>>":8,"+":9,"-":9,"*":10,"/":10,"%":10},right_associative:new Set,additional_identifier_chars:new Set(["$","_"]),literals:{true:!0,false:!1,null:null},this_str:"this"});mt.max_unop_len=mt.getMaxKeyLen(mt.unary_ops);mt.max_binop_len=mt.getMaxKeyLen(mt.binary_ops);var e_=t=>new mt(t).parse(),lat=Object.getOwnPropertyNames(mt);lat.forEach(t=>{e_[t]===void 0&&t!=="prototype"&&(e_[t]=mt[t])});e_.Jsep=mt;var cat="ConditionalExpression",uat={name:"ternary",init(t){t.hooks.add("after-expression",function(e){if(e.node&&this.code===t.QUMARK_CODE){this.index++;let i=e.node,r=this.gobbleExpression();if(r||this.throwError("Expected expression"),this.gobbleSpaces(),this.code===t.COLON_CODE){this.index++;let n=this.gobbleExpression();if(n||this.throwError("Expected expression"),e.node={type:cat,test:i,consequent:r,alternate:n},i.operator&&t.binary_ops[i.operator]<=.9){let s=i;for(;s.right.operator&&t.binary_ops[s.right.operator]<=.9;)s=s.right;e.node.test=s.right,s.right=e.node,e.node=i}}else this.throwError("Expected :")}})}};e_.plugins.register(uat);function TL(t){return{all:t=t||new Map,on:function(e,i){var r=t.get(e);r?r.push(i):t.set(e,[i])},off:function(e,i){var r=t.get(e);r&&(i?r.splice(r.indexOf(i)>>>0,1):t.set(e,[]))},emit:function(e,i){var r=t.get(e);r&&r.slice().map(function(n){n(i)}),(r=t.get("*"))&&r.slice().map(function(n){n(e,i)})}}}var spe=class{constructor(t,e,i){this.id=t,this.userAPI=e,this.result=void 0,this.error="null",this.isPrefetched=!1,this.isLoading=!1,this.isLoaded=!1,this.prefetchPromise=new Promise(r=>r()),this.emitter=TL(),this._innerCallUserAPI=async r=>{this.emitter.emit("start",{userAPIId:this.id}),this.isLoading=!0,this.isLoading=!1;try{this.result=await mat(this.userAPI,r),this.error="null",this.emitter.emit("success",{userAPIId:this.id})}catch(n){let s=n.message?.split("_:_")?.[0]?.replace("status:","")??"null";this.error=s,this.result=null,this.emitter.emit("error",{userAPIId:this.id})}this.isLoading=!1,this.isPrefetched=!0,this.isLoaded=!0},e?.integration?.type==="OpenAI"?this.result={content:""}:e.method==="GET"&&e.url!==""&&(this.prefetchPromise=this.prefetch(i)),this._debouncedCallUserAPI=this._innerCallUserAPI,this._updateDebouncedCallUserAPI(),this._debouncedPrefetch=NM(this.prefetch,1e3,{trailing:!0})}_updateDebouncedCallUserAPI(){this._debouncedCallUserAPI=this.userAPI.debounce!==void 0&&this.userAPI.debounce>0?NM(this._innerCallUserAPI,this.userAPI.debounce,{leading:!0,trailing:!0}):this._innerCallUserAPI}async prefetch(t){await this.callUserAPI(t)}async callUserAPI(t){await this._debouncedCallUserAPI(t)}update(t,e,i=!0){this.userAPI=t,this._updateDebouncedCallUserAPI(),this.userAPI.url!==""&&this.userAPI.method==="GET"&&i&&this._debouncedPrefetch(e)}retrieveValue(t){if(this.result)try{return fa.zoom(this.result,t)}catch(e){console.error(e)}}retrieveZoomedKeyValues(t){if(this.result){let e=t&&t.length?fa.zoom(this.result,t):this.result;if(pat(e))return Object.entries(e);if(fat(e))return e.map((i,r)=>[r.toString(),i]);throw dat(e)?new Error("This path points to a value, use retrieveValue() instead. "+t?.join(".")):new Error("Path error"+t?.join("."))}}dispose(){}on(t,e){this.emitter.on(t,e)}off(t,e){this.emitter.off(t,e)}get autostart(){return this.userAPI.autoStart}};function hat(t){let e=new Headers;return t.headers.forEach(i=>{i.data.key!==""&&e.append(i.data.key,i.data.value)}),e}function dat(t){return typeof t=="string"||typeof t=="number"||typeof t=="boolean"||t===null}function fat(t){return Array.isArray(t)}function pat(t){return typeof t=="object"&&t!==null}async function mat(t,e,i=new AbortController){let r,n=t.url,s=t.proxy?.enabled??!1,a;if(t.integration?.type==="OpenAI"){let l=YE(t.integration.prompt===""?[]:JSON.parse(t.integration.prompt),e),c=t.integration.behavior===""?[]:YE(JSON.parse(t.integration.behavior),e);a=`{
		"model": "${t.integration.model}",
		"messages": [${t.integration.useBehavior?`
		{
			"role": "system",
			"content": "${c}"
		},`:""}
		{
			"role": "user",
			"content": "${l}"
		}
		]
	}`}if(s){n=`https://apis.spline.design/file/${t.proxy.fileId}/external-api/request?uuidexternalapi=${t.proxy.proxyId}`;let l;a!==void 0?l=a:t.method==="POST"&&t.body&&(l=YE(JSON.parse(t.body),e)),l!==void 0&&(n+=`&data=${encodeURIComponent(l.replace(/(\r\n|\n|\r|\t)/gm,""))}`)}else t.integration?.type==="OpenAI"?r=a:t.method==="POST"&&t.body&&(r=YE(JSON.parse(t.body),e));let o=await fetch(n,{method:s?"GET":t.method,headers:s?void 0:hat(t),signal:i.signal,body:r});if(!o.ok)throw new Error("status:"+o.status+"_:_"+o.statusText);if(t.integration?.type==="OpenAI"){let l=await o.json();return s&&(l=l.response),{content:l.choices[0].message.content}}else{let l=await o.json();return s&&(l=l.response),l}}var ape=(t,e)=>{if(typeof t=="string"){let i=e.getVariable(t);if(i)return ape(i,e)}return xo.isBoolean(t)?xo.getDisplayedValue(t).toLowerCase():xo.getDisplayedValue(t)},YE=(t,e)=>t.map((i,r)=>{if("text"in i)return i.text;if("type"in i){if(i.type==="paragraph")return(r>0?`
`:"")+YE(i.children,e);if(i.type==="variable"){let n=e.getVariable(i.variableId);if(n!==void 0)return ape(n,e)}}return""}).join(""),gat=["+","-","*","/","(",")","==","!=",">","<",">=","<=","and","or","!","%","^",","],vat=["0","1","2","3","4","5","6","7","8","9","."],yat=["sin","cos","tan","asin","acos","atan","atan2","sqrt","abs","log","exp","floor","ceil","round","min","max","random"];function xat(t){return typeof t!="string"?!1:!isNaN(t)&&!isNaN(parseFloat(t))}e_.addBinaryOp("^",11,!0);function ope(t,e,i="number"){let r="";for(let a=0;a<t.length;a++){let o=t[a];if("objType"in o&&o.objType==="api"){let l=JSON.parse(o.id),c=l[0],u=e.getUserAPI(c);if(u!==void 0&&u instanceof spe){let h=u.retrieveValue(l.slice(1));h!==void 0&&(r+=h)}continue}if("objType"in o&&o.objType==="webhook"){let l=JSON.parse(o.id),[c,u]=l,h=e.getUserWebhook(c);if(h!==void 0){let d=h.getParameterValue(u);d!==void 0&&(r+=d)}continue}if("objType"in o&&o.objType==="aiAssistant"){let l=e.openAIRealtime;if("objId"in o&&o.objId!==void 0){let c;if(e.scene.data.objects.traverse((u,h)=>{let d=h.events?.find(f=>f.id===o.objId);d&&(c=d)}),c!==void 0&&c.data.type==="AIAssistantListener"){let u=l?.computeAnalysisForListenerEvent(c.data);if(u!==void 0){r+=u;continue}}}r+=l?.voice??0;continue}if("id"in o){let l=t[a-1];if(a>0&&"id"in l){console.error("Two variables in a row",t);return}let c=e.getVariable(o.id),u=xo.getDisplayedValue(c);i==="number"&&xo.isTextValue(c)&&Array.isArray(c.textValue)&&c.textValue.length===1?u=parseFloat(u).toString():i==="boolean"&&xo.isBoolean(c)?u=c?"true":"false":i==="boolean"&&xo.isTextValue(c)&&!Array.isArray(c.textValue)&&(u='"'+u+'"'),r+=u;continue}else if(i==="string"){o.name!=='"'&&(o.name!=="+"||o.escaped)&&(r+=o.name),o.name==="+"&&!o.escaped&&r[r.length-1]==="\\"&&(r=r.slice(0,-1)+o.name);continue}if(o.name==="and"){r+="&&";continue}if(o.name==="or"){r+="||";continue}if(o.name==="True"){r+="true";continue}if(o.name==="False"){r+="false";continue}if(i==="boolean"&&!xat(o.name)&&!vat.includes(o.name)&&!gat.includes(o.name)&&!yat.includes(o.name.replace(/\($/g,""))){r+='"'+o.name+'"';continue}r+=o.name}if(i==="string")return r;if(t.length===0){if(i==="number")return 0;if(i==="boolean")return!1}let n;try{n=e_(r)}catch(a){console.error(r,a);return}let s;try{s=Dr(n)}catch(a){console.error(r,n,a)}return s}function Dr(t){switch(t.type){case"BinaryExpression":switch(t.operator){case"==":return+(Dr(t.left)===Dr(t.right));case"!=":return+(Dr(t.left)!==Dr(t.right));case">":return+(Dr(t.left)>Dr(t.right));case">=":return+(Dr(t.left)>=Dr(t.right));case"<":return+(Dr(t.left)<Dr(t.right));case"<=":return+(Dr(t.left)<=Dr(t.right));case"+":return Dr(t.left)+Dr(t.right);case"-":return Dr(t.left)-Dr(t.right);case"*":return Dr(t.left)*Dr(t.right);case"/":return Dr(t.left)/Dr(t.right);case"%":return Dr(t.left)%Dr(t.right);case"&&":return Dr(t.left)&&Dr(t.right);case"||":return Dr(t.left)||Dr(t.right);case"^":return Math.pow(Dr(t.left),Dr(t.right));default:throw new Error("Unknown operator: "+t.operator)}case"UnaryExpression":switch(t.operator){case"-":return-Dr(t.argument);case"!":return+!Dr(t.argument);default:throw new Error("Unknown operator: "+t.operator)}case"Identifier":throw new Error("Unknown identifier: "+t.name);case"Literal":return t.value;case"CallExpression":if(t.callee.type==="Identifier"){if(t.callee.name==="random"){let e=0,i=1;if(t.arguments.length>=1)try{e=Dr(t.arguments[0])}catch(r){console.warn(r)}if(t.arguments.length>=2)try{i=Dr(t.arguments[1])}catch(r){console.warn(r)}return e=Math.min(i,e),i=Math.max(i,e),e+Math.random()*(i-e)}return Math[t.callee.name].apply(null,t.arguments.map(Dr))}else throw new Error("Unknown node");default:throw new Error("Unknown node type: "+t.type)}}var bat=new St,wat=new St;function _at(t,e,i){let r=[new W,new W,new W],n=[new W,new W,new W];return t.extractBasis(r[0],r[1],r[2]),e.extractBasis(n[0],n[1],n[2]),r.forEach((s,a)=>{let o=n[a],l=Ht.lerp(s.length(),o.length(),i);s.lerp(o,i).setLength(l)}),new St().makeBasis(r[0],r[1],r[2])}var Sat=class{static create(t){return this.build(this.normalizeInputs(t))}static normalizeInputs(t,e){let i=Object.assign({},e?.parameters??{width:100,height:100,depth:1,subdivisions:12,roundness:0,extrudeBevelSize:0,extrudeBevelSegments:3},t.parameters),r=Math.abs(i.width),n=Math.abs(i.height??i.width),s=Math.abs(i.depth??0),a=e?.shapeData??i8.create({parameters:dfe}).userData.shape;return{path:t.path??v3.defaultData(),parameters:Object.assign(i,{width:r,height:n,depth:s,extrusion:{...ffe,...i.extrusion}}),shapeData:a}}static build(t){if(t.path.points.length>=2){let e=new Eat(t);return Object.assign(e,{userData:{...t,type:"PathGeometry"}})}else return Object.assign(new oi,{userData:{...t,type:"PathGeometry"}})}},Eat=class extends oi{constructor(t){super(),this.type="PathExtrusionGeometry",this.inputs=t,this.build()}_isGeometryClosed(){return this.inputs.path.isClosed&&this.inputs.parameters.extrusion.depth===1}_isOpenEnded(){let t=this.inputs.parameters.extrusion;return!(this.inputs.path.isClosed&&t.depth===1)||!Kst(t.twist,0)||t.startScale!==t.endScale}build(){let t=this._extractPathPoints();if(t.length<2)return;let e=this._computeBasisMatrices(t),{depth:i,offset:r}=this.inputs.parameters.extrusion;i=Math.max(0,Math.min(i,1)),r=Math.max(0,Math.min(r,1));let n=this.inputs.path.isClosed?t.length:t.length-1,s=Math.floor(r*n),a=this.inputs.path.isClosed?Math.ceil((i+r)*n):Math.ceil(Math.min(1,i+r)*n),o=Math.min(Math.max(2,a-s+1),n+2),l=[],c=[];for(let X=0;X<o;X++){let U=this.inputs.path.isClosed?(X+s)%t.length:Math.min(X+s,t.length-1);l.push(t[U].clone()),c.push(e[U].clone())}let u=(X,U,Y)=>{l[X]=l[X].clone().lerp(l[U],Y),c[X]=_at(c[X],c[U],Y)},h=0,d=r*n%1;(!this.inputs.path.isClosed||i<=1)&&(d||r===0)&&(h=d,u(0,1,h));let f=0,p=(r+i)*n%1;if((this.inputs.path.isClosed&&i<=1||!this.inputs.path.isClosed&&r+i<1)&&p&&(f=p,u(l.length-1,l.length-2,1-f)),i===0){let X=l.length-1;l[X].copy(l[0]),c[X].copy(c[0])}this._applyPathModifiers(c,h,f);let{bevel:g,bevelSides:m}=this.inputs.parameters.extrusion,y=g>0?this.inputs.parameters.extrusion.capType:"flat",b=5;this.inputs.parameters.extrusion.shape.type==="Custom"&&(b=this.inputs.parameters.extrusion.shape.shapeQuality==="low"?5:12);let{regions:w,infos:E,vertices:M}=this._computeShapePoints(b),A=0,P;y==="round"&&(P=new t8(this.inputs.shapeData,2*g,g,b,m,void 0,!0),A=P.getAttribute("position").count);let C=0,R=0;E.sort((X,U)=>X.start-U.start),E.forEach(X=>{X.verticesStart=C,X.verticesCount=X.continuous.reduce((U,Y,Z)=>U+(Z===0||!Y?2:1),0),R+=X.verticesCount,C=R});let I=R*o,k,z=0;if(this._isOpenEnded()&&y==="flat"){try{k=kg({windingRule:hn.ODD,elementType:zs.POLYGONS,polySize:3,vertexSize:2,strict:!0,contours:w})}catch{k=$fe}z=k.vertexCount}let V=I+2*z+A*2,F=I+2*z,$={positions:new Float32Array(V*3),normals:new Float32Array(V*3),uvs:new Float32Array(V*2)},K=[];if(E.forEach(X=>{this._extrudeRegion(X,M,c,l,$,K,this._isGeometryClosed()&&!this._isOpenEnded())}),k&&(this._closeEnd(k,I,K,$,c[0],l[0],!1),this._closeEnd(k,I+z,K,$,c[c.length-1],l[l.length-1],!0)),P){$.positions.set(P.getAttribute("position").array,F*3),$.normals.set(P.getAttribute("normal").array,F*3),$.uvs.set(P.getAttribute("uv").array,F*2);for(let Z=F;Z<F+A;Z++)$.uvs[Z*2+1]=1e-4;let X=K.length;K.push(...P.getIndex().array.map(Z=>Z+F)),F+=A,$.positions.set(P.getAttribute("position").array,F*3),$.normals.set(P.getAttribute("normal").array,F*3),$.uvs.set(P.getAttribute("uv").array,F*2);let U=K.length;K.push(...P.getIndex().array.map(Z=>Z+F)),this.setAttribute("position",new Mi($.positions,3)),this.setAttribute("normal",new Mi($.normals,3)),this.setAttribute("uv",new Mi($.uvs,2)),this.setIndex(K);let Y=bat;Y.copy(c[c.length-1]).setPosition(l[l.length-1]),this.applyMatrix4OnRange(Y,F,V),Y.copy(c[0]).setPosition(l[0]).multiply(wat.makeScale(1,1,-1)),this.applyMatrix4OnRange(Y,F-A,F),this.reverseIndicesOnRange(X,U)}else this.setAttribute("position",new Mi($.positions,3)),this.setAttribute("normal",new Mi($.normals,3)),this.setAttribute("uv",new Mi($.uvs,2)),this.setIndex(K)}_extractPathPoints(){let t=Bfe(this.inputs.path).getPoints(this.inputs.path.subdivisions);if(t.length<2)return[];let e=[t[0]];return t.forEach(i=>{e[e.length-1].distanceToSquared(i)>.001&&e.push(i)}),this.inputs.path.isClosed&&e[e.length-1].distanceTo(e[0])<.001&&e.pop(),e}_computeBasisMatrices(t){let e=[],i=t.length,r=this.inputs.path.isClosed,n=new W,s=new W,a=new W,o=new W,l=new W(0,1,0);for(let p=0;p<i;p++){let g=t[p],m;p===0?m=r?t[t.length-2]:g.clone().multiplyScalar(2).sub(t[1]):m=t[p-1];let y;p===i-1?y=r?t[1]:g.clone().multiplyScalar(2).sub(t[p-1]):y=t[p+1];let b=g.clone().sub(m).normalize(),w=y.clone().sub(g).normalize(),E=b.clone().add(w).normalize();a.copy(E),p===0&&(E.equals(l)||E.clone().negate().equals(l))&&l.set(0,0,1);let M=l.clone().cross(E).normalize(),A=E.clone().cross(M).normalize();l.copy(A),o.copy(M),p===0&&(n.copy(A),s.copy(E));let P=new St().makeBasis(M,A,E);e.push(P)}let c=r?s:a,u=r?n:new W(0,1,0),h=c.clone().cross(o).normalize(),d=Math.acos(u.dot(h));if(isNaN(d))return e;let f=u.clone().cross(h);c.dot(f)>0&&(d*=-1);for(let p=1;p<e.length;p++){let g=new St().makeRotationZ(d*p/e.length);e[p].multiply(g)}return e}_applyPathModifiers(t,e,i){let r=t.length,{angle:n,twist:s,startScale:a,endScale:o}=this.inputs.parameters.extrusion,l=new St,c=new St;return t.forEach((u,h)=>{let d=h===0?0:h===r-1?1:(h-e)/(r-(i===0?0:1)-(e+(1-i)));l.makeRotationZ(Ht.lerp(n,n+s,d)*Ht.DEG2RAD);let f=Ht.lerp(a,o,d);c.makeScale(f,f,f),u.multiply(l).multiply(c)}),t}_computeShapePoints(t=12,e=hn.ODD){let i=this.inputs.shapeData,r=i.extractShapePointsToFlatArray([],t),n=i.shapeHoles.map(c=>{let u=c.extractShapePointsToFlatArray([],t),h=[];for(let d=u.length-1;d>=1;d-=2){let f=u[d-1],p=u[d-0];h.push(f,p)}return h}),s;try{s=kg({windingRule:e,elementType:zs.BOUNDARY_CONTOURS,vertexSize:2,strict:!0,contours:[r]})}catch{s=e8}let a;try{a=kg({windingRule:hn.ODD,elementType:zs.BOUNDARY_CONTOURS,vertexSize:2,strict:!0,contours:[...n]})}catch{a=Xfe}if(!s)throw new Error("error generating geometry");let o=s.elementCount;if(a){s.elementCount+=a.elementCount;for(let c=0;c<a.elements.length;c++){let u=a.elements[c],h=c%2===0?s.vertexCount:0;s.elements.push(u+h)}for(let c=0;c<a.vertexIndices.length;c++){let u=a.vertexIndices[c],h=s.vertexCount;s.vertexIndices.push(u+h)}for(let c=0;c<a.vertices.length;c++){let u=a.vertices[c];s.vertices.push(u)}}for(let c=0,u=s.vertexCount;c<u;c++){let h=c*2;s.vertices[h+0],s.vertices[h+1]}let l=[];for(let c=s.elementCount-1;c>=0;c--){let u=c>=o,h=c*2,d=s.elements[h+0],f=s.elements[h+1],p=d+f,g={start:d,count:f,normals:[],isHole:u,continuous:[],verticesStart:0,verticesCount:0};l.push(g);let m=d,y=p-1,b=d+1,w=i.roundedCurves.length;do{let E=m-d;s.vertices[y*2+0],s.vertices[y*2+1];let M=s.vertices[m*2+0],A=s.vertices[m*2+1],P=s.vertices[b*2+0],C=s.vertices[b*2+1],R=M-P,I=A-C,k=Math.sqrt(R*R+I*I);R/=k,I/=k,g.normals[E*2+0]=-I,g.normals[E*2+1]=R;let z=s.vertexIndices[m];if(Array.isArray(z))g.continuous[E]=!1;else{let[V,F]=i.getCurveIndexFromVertexId(z-1,!0);if(F>0&&F<1)g.continuous[E]=!0;else{let $=F===1?V+1:V-1;$=($+w)%w;let K=F===1?0:1,X=i.roundedCurves[V].getTangent(F),U=i.roundedCurves[$].getTangent(K);g.continuous[E]=X.dot(U)>.95}}u&&(g.normals[E*2+0]*=-1,g.normals[E*2+1]*=-1),[y,m,b]=[m,b,b+1],b>=p&&(b-=f)}while(b!==d+1)}return{regions:[r,...n],infos:l,vertices:s.vertices}}_insertVertex(t,e,i,r,n){let s=e*2,a=e*3;t.positions[a+0]=i.x,t.positions[a+1]=i.y,t.positions[a+2]=i.z,t.normals[a+0]=r.x,t.normals[a+1]=r.y,t.normals[a+2]=r.z,t.uvs[s+0]=n.x,t.uvs[s+1]=n.y}_extrudeRegion(t,e,i,r,n,s,a){let o=new W,l=new W,c=new W,u=new W,h=new Ae;i.forEach((f,p)=>{let g=r[p],m=t.verticesStart*i.length+t.verticesCount*p;for(let y=0;y<t.count;y++){let b=(t.start+y)*2;if(o.set(e[b+0],e[b+1],0),c.copy(o).applyMatrix4(f).add(g),t.continuous[y])u.set(t.normals[y*2+0],t.normals[y*2+1],0);else{let w=y===0?(t.start+t.count-1)*2:b-2;l.set(e[w+0],e[w+1],0),u.copy(o).sub(l),u.set(-u.y,u.x,0),t.isHole||u.negate()}if(u.applyMatrix4(f).normalize(),h.set(y===0?1:y/t.count,p/(i.length-1)),this._insertVertex(n,m,c,u,h),m++,!t.continuous[y]||y===0){if(y===0)u.set(t.normals[y*2+0],t.normals[y*2+1],0),h.set(0,p/(i.length-1));else{let w=y===t.count-1?t.start*2:b+2;l.set(e[w+0],e[w+1],0),u.copy(l).sub(o),u.set(-u.y,u.x,0),t.isHole||u.negate()}u.applyMatrix4(f).normalize(),this._insertVertex(n,m,c,u,h),m++}}});let d=i.length-1;for(let f=0;f<d;f++){let p=t.verticesStart*i.length+t.verticesCount*f,g=t.verticesStart*i.length+t.verticesCount*(f+1),m=0;for(let y=0;y<t.count;y++){(!t.continuous[y]||y===0)&&m++;let b=y===t.count-1?0:m+1,w=p+m,E=p+b,M=g+b,A=g+m;t.isHole?s.push(w,M,E,w,A,M):s.push(w,E,M,w,M,A),m++}}}_closeEnd(t,e,i,r,n,s,a){let o=t.vertexCount,l=new W(0,0,a?-1:1).applyMatrix4(n),c=new W,u=new Ae;for(let d=0;d<o;d++){let f=2*d;c.set(t.vertices[f+0],t.vertices[f+1],0).applyMatrix4(n).add(s),this._insertVertex(r,e+d,c,l,u)}let h=t.elements;for(let d=0;d<t.elementCount;d++){let f=3*d,p=h[f+0]+e,g=h[f+(a?1:2)]+e,m=h[f+(a?2:1)]+e;i.push(p,g,m)}}applyMatrix4OnRange(t,e,i){let r=t.elements,n=new Vs().getNormalMatrix(t).elements,s,a,o,l,c=this.attributes.position,u=this.attributes.normal;if(!c||!u)return;let h=c.array,d=u.array,f=c.itemSize;for(let p=e*f,g=i*f;p<g;p+=f){if(p===e)debugger;s=h[p+0],a=h[p+1],o=h[p+2],l=1/(r[3]*s+r[7]*a+r[11]*o+r[15]),h[p+0]=(r[0]*s+r[4]*a+r[8]*o+r[12])*l,h[p+1]=(r[1]*s+r[5]*a+r[9]*o+r[13])*l,h[p+2]=(r[2]*s+r[6]*a+r[10]*o+r[14])*l,s=d[p+0],a=d[p+1],o=d[p+2],d[p+0]=n[0]*s+n[3]*a+n[6]*o,d[p+1]=n[1]*s+n[4]*a+n[7]*o,d[p+2]=n[2]*s+n[5]*a+n[8]*o}c.needsUpdate=!0,u.needsUpdate=!0}reverseIndicesOnRange(t,e){let i=this.index;if(i){for(let r=t;r<e;r+=3){let n=i.getX(r),s=i.getX(r+1),a=i.getX(r+2);i.setXYZ(r,a,s,n)}i.needsUpdate=!0}}};function lpe(){let t=new oi;return t.setAttribute("position",new Mi(new Float32Array([]),3)),t.setIndex(new Mi(new Uint16Array([]),1)),t}var Aat=lpe().attributes,Mat=12,Tat=1,G5=class extends oi{constructor(t,e){super(),this.charWidths=[],this.charCoords=[],this.wrappedText=[],this.isLowResolution=!1,this.vectorShapes=[],Object.assign(this.attributes,Aat),this.userData={parameters:t,type:"TextGeometry"};let i=e.getFont(t.font);i?.isLoaded?(this.font=i,this.update(t,e)):this.updateFont(t.font,e).then(()=>{this.update(t,e),e?.requestRender()})}async updateFont(t,e){let i=e.getFont(t);i&&(this.font=i,await i.loadingPromise)}update(t,e){let i=this.font;if(this.userData={parameters:t,type:"TextGeometry"},!i?.isLoaded){console.warn("Cannot update text because its font is not loaded");return}let{width:r,height:n,depth:s,extrudeBevelSize:a,extrudeBevelSegments:o,text:l,textTransform:c}=t,u=xo.getDisplayedValue(l),h=c===2?u.toUpperCase():c===3?u.toLowerCase():u,d=Cat(t,i,h,e),{shapes:f,charWidths:p,charCoords:g}=i.generateShapes(d,t,e),m=(typeof r=="number"?r:Number(e.getVariable(r)))*.5,y=(typeof n=="number"?n:Number(e.getVariable(n)))*.5,b=f.map(M=>new as().fromShape(M,!0));this.vectorShapes=b;let w=b.map(M=>Q0.create({shape:M,parameters:{depth:s,extrudeBevelSegments:o,extrudeBevelSize:a,windingRule:s<=0?hn.NONZERO:hn.ODD,subdivisions:this.isLowResolution&&s>0?Tat:Mat}})),E=w.length?n0(w):lpe();E.translate(-m,y,0),this.dispose(),this.wrappedText=d,this.charCoords=g,this.charWidths=p,this.deleteAttribute("extrudeNormal"),Object.entries(E.attributes).forEach(([M,A])=>{this.setAttribute(M,A)}),this.setIndex(E.index),this.computeBoundingSphere()}clone(){let t=lc(new oi,G5.prototype);return t.copy(this),console.log("CloneGeometry",this,t),t}copy(t){return Object.entries(t.attributes).forEach(([e,i])=>{this.setAttribute(e,i)}),this.setIndex(t.index),this.userData={parameters:{...t.userData.parameters},type:"TextGeometry"},this}async setText(t,e){this.font&&await this.font.loadingPromise,await this.update({...this.userData.parameters,text:{textValue:t}},e)}get text(){return this.userData.parameters.text??""}};function Cat(t,e,i,r){let n=typeof t.width=="string"?Number(r.getVariable(t.width)):t.width,s=[""],a="";for(let o of i)a+=o,o===" "||o===`
`?(s[s.length-1]+=a,a="",o===`
`&&s.push("")):e.getTextWidth(s[s.length-1]+a,t)>n&&(s[s.length-1].length&&s.push(""),e.getTextWidth(s[s.length-1]+a,t)>n&&(a.length===1?(s[s.length-1]+=a,a=""):(s[s.length-1]+=a.slice(0,-1),a=a[a.length-1],s.push(""))));return s[s.length-1]+=a,s}var cpe,upe=new Promise(t=>{cpe=t}),Xee=!1,hR;function Pat(t){if(Xee)return;if(hR)return hR;async function e(){let i=t??"https://unpkg.com/@splinetool/modelling-wasm@1.10.72/build",r=Bc(()=>import("./process-VPR0TfJD.js"),[]),[n,s]=await Promise.all([r,fetch(`${i}/process.wasm`).then(l=>l.arrayBuffer())]),a=n.default,o=await a({wasmBinary:s});cpe(o),Xee=!0}return hR=e(),hR}var Rat=["font"];function $M(t,e,i,r){let n,s,a;t.type==="PathGeometry"?(s=JSON.parse(JSON.stringify(t)),a=[[],["extrusion"]]):(s={...t},a=[[]]);for(let c of a){let u=s;for(let h of c)u=u[h];for(n in u){let h=u[n];LJ(h)&&!Rat.includes(n)&&(u[n]=e.getVariable(h,[r.uuid,"geometry",...c,n]),LJ(u[n])&&(u[n]=1))}}let o={parameters:s,type:s.type};if(s.type==="PathGeometry")o.path=s.path;else if(s.type==="VectorGeometry"){let c=as.createFromState(s.shape,s.width,s.height);o.shape=c}else if(s.type==="NonParametricGeometry"){if(s.data.groups&&s.data.groups?.forEach(c=>c.materialIndex=Math.max(c.materialIndex??0,0)),o.geometry=new jhe().parse(s),o.geometry.groups.length===0){let c=o.geometry;c.addGroup(0,Math.max(c.getIndex()?.count??0,c.getAttribute("position").count),0)}}else if(s.type==="SubdivGeometry"){let c=new hl(s,i);return c.data=t,c}else{if(s.type==="TextGeometry")return new G5(s,e);if(s.type==="InputGeometry")return new G5(s,e);if(s.type==="UIGeometry")return r8.create({parameters:{width:s.width,height:s.height,cornerRadius:s.cornerRadius,cornerType:s.cornerType}})}let l;try{l=Qee(o)}catch(c){console.error(c)}if(!l){let c=as.createFromState(g3.defaultData(),100,100);o.shape=c,l=Qee(o)}return l}var Iat=new St;function W5(t,e,i,r){let n=t.position.array,s=t.normal.array,a=Iat.makeScale(e,i,r).invert().elements,o,l,c;for(var u=0,h=n.length;u<h;u+=3)n[u]*=e,n[u+1]*=i,n[u+2]*=r,o=s[u],l=s[u+1],c=s[u+2],s[u]=a[0]*o+a[4]*l+a[8]*c,s[u+1]=a[1]*o+a[5]*l+a[9]*c,s[u+2]=a[2]*o+a[6]*l+a[10]*c;t.position.needsUpdate=!0,t.normal.needsUpdate=!0}var dR=new Ss,lw=new W,Pi;upe.then(t=>{Pi=t});var $ee=new Float32Array([10,10,0,-10,10,0,-10,-10,0,10,-10,0]),Yee=new Uint32Array([0,1,2,3]),Kee=new Uint8Array([4]),hl=class extends oi{constructor(t,e){super(),this.data=t,this.flatShading=e,this.subdivPointer=0,this.rebuild(),this.freeSubdivPointer()}mutateDirectlyScaleBaked(t,e){this.freeSubdivPointer();let i=this.data.scaleBaked,r=Hg.div(e,i);if(r.every(a=>a===1))return;this.subdividedGeometry&&W5(this.subdividedGeometry.attributes,...r),this.originalGeometry&&W5(this.originalGeometry.attributes,...r),this.data=t;let n=this.userData.parameters;this.userData.parameters={width:n.width*r[0],height:n.height*r[1],depth:n.depth*r[2]},this.originalGeometry.boundingSphere.center.multiply(lw.fromArray(r));let s=lw.set(n.width,n.height,n.depth).length();this.originalGeometry.boundingSphere.radius=s/2}ensureSubdivPointer(){return this.subdivPointer===0&&this.rebuild(),this.subdivPointer}rebuild(){let t,e,i;try{({originalGeometry:t,subdividedGeometry:e,subdivPointer:i}=hl.build(this.data,void 0,!this.flatShading,void 0))}catch{t=new Oh(100,100,100),i=0}this.subdivPointer=i,this.originalGeometry=t,this.subdividedGeometry=e??void 0;let r=this.subdividedGeometry??this.originalGeometry;Object.assign(this,r),this.calcBoundingBox()}freeSubdivPointer(){this.subdivPointer&&(hl.freeSubdivPointer(this.subdivPointer),this.subdivPointer=0)}dispose(){super.dispose(),this.freeSubdivPointer()}calcBoundingBox(){let t=this.originalGeometry;t.boundingSphere===null&&(t.boundingSphere=new oc,this.subdividedGeometry&&(this.subdividedGeometry.boundingSphere=t.boundingSphere));let e=t.attributes.position,i=t.boundingSphere.center;dR.setFromBufferAttribute(e),dR.getCenter(i),t.boundingSphere.radius=i.distanceTo(dR.max),isNaN(t.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this),dR.getSize(lw);let r={width:lw.x,height:lw.y,depth:lw.z};return this.userData.parameters=r,r}static build(t,e,i,r){let n,s,a,o=t?.phongAngle??35;i===!1&&(o=-1),e&&(Pi.free_bvh(e),Pi.free_subdivision_surface(e));try{n=hl.allocate(t,r)}catch(l){console.error(l,t),n=hl.allocate({positionWASM:$ee,indexWASM:Yee,verticesPerFaceWASM:Kee},r)}if(Pi.set_destination_refinement_level(n,0),s=hl.buildLevel(n,!0,o),t.subdivisions>0)try{Pi.set_destination_refinement_level(n,t.subdivisions),a=hl.buildLevel(n,!1,o)}catch{try{Pi.set_destination_refinement_level(n,t.subdivisions-1),a=hl.buildLevel(n,!1,o)}catch{a=null}}else a=null;return{subdivPointer:n,originalGeometry:s,subdividedGeometry:a}}static primitiveToQuads(t,e,i){t.widthSegments>16&&(t.widthSegments=16),t.heightSegments>16&&(t.heightSegments=16),t.depthSegments>16&&(t.depthSegments=16),t.radialSegments>16&&(t.radialSegments=16),t.type==="DodecahedronGeometry"&&(t.detail=0);let r=t.shape!==void 0||t.path!==void 0?e.geometry:$M(t,i,!1,e),n;t.type==="TorusGeometry"&&t.arc===Math.PI*2?n=r.getClosedTorusIndicesForBooleanOrSubdiv():n=r.getIndex();let s,a,o,l;({positions:s,triIndices:l}=CL(r.getAttribute("position"),n));let c;if(t.type==="CylinderGeometry"&&t.cornerRadius===0&&t.hollow===0&&t.openEnded===!1){let u=t.radialSegments*t.heightSegments*3*2,h=u+t.radialSegments*3;c=[u,h]}return{indices:a,verticesPerFace:o}=hpe(s,l,r,c),{positions:s,indices:a,verticesPerFace:o}}static allocate(t,e){let i,r,n,s=[],a=[];t.positionWASM&&t.positionWASM.length>0?(i=t.positionWASM,r=t.indexWASM,n=t.verticesPerFaceWASM):(i=$ee,r=Yee,n=Kee);let o=i.length,l=r.length,c=n.length,u=i.length+s.length+a.length,h=r.length+n.length,d=u*Float32Array.BYTES_PER_ELEMENT+h*Uint32Array.BYTES_PER_ELEMENT,f=u*Float32Array.BYTES_PER_ELEMENT,p=Pi._malloc(d),g=new Float32Array(Pi.HEAPF32.buffer,p,u),m=new Uint32Array(Pi.HEAPU32.buffer,p+f,h);g.set(i,0),g.set(s,i.length),g.set(a,i.length+s.length),m.set(r,0),m.set(n,r.length);let y;t?.scaleBaked?.some(w=>w!==1)&&(y=new St().makeScale(...t.scaleBaked)),e&&(y?y.premultiply(e):y=e);let b=y?Pi.alloc_subdivision_surface2(p,o,p+f,l,p+f+r.length*Uint32Array.BYTES_PER_ELEMENT,c,y.elements):Pi.alloc_subdivision_surface(p,o,p+f,l,p+f+r.length*Uint32Array.BYTES_PER_ELEMENT,c);return Pi._free(p),b}static buildLevel(t,e,i,r,n){let s=n?Pi.get_mesh_data2(t,e?Pi.Level.CONTROL:Pi.Level.REFINED,i,n.elements):Pi.get_mesh_data(t,e?Pi.Level.CONTROL:Pi.Level.REFINED,i),a=8,o=Pi.HEAPU32.subarray(s>>2,(s>>2)+a),l=o.subarray(4,8),c=0,u=Pi.HEAPU32[o[c]>>2],h=Pi.HEAPF32.subarray(u>>2,(u>>2)+l[c]);c++;let d=Pi.HEAPU32[o[c]>>2],f=Pi.HEAPF32.subarray(d>>2,(d>>2)+l[c]);c++;let p=Pi.HEAPU32[o[c]>>2],g=Pi.HEAPU32.subarray(p>>2,(p>>2)+l[c]);c++;let m=Pi.HEAPU32[o[c]>>2],y=Pi.HEAPU32.subarray(m>>2,(m>>2)+l[c]);if(c++,r===void 0){let b=new oi;if(b.setIndex(new s1(y,1)),b.setAttribute("position",new Gt(h,3)),b.setAttribute("normal",new Gt(f,3)),e){b.setAttribute("faceMap",new s1(g,1));let w=new Float32Array(f.length/3*4).fill(0);b.setAttribute("color",new Mi(w,4))}return Pi.free_mesh_data(s),b.userData.type="SubdivGeometry",b}r.getAttribute("position").copyArray(h),r.getAttribute("normal").copyArray(f),r.attributes.position.needsUpdate=!0,r.attributes.normal.needsUpdate=!0,Pi.free_mesh_data(s)}static freeSubdivPointer(t){Pi.free_bvh(t),Pi.free_subdivision_surface(t)}static buildControlCageWireframe(t,e,i){let r=Pi.get_wireframe_data_for_base_level(t),n=4,s=Pi.HEAPU32.subarray(r>>2,(r>>2)+n),a=s.subarray(2,4),o=0,l=Pi.HEAPU32[s[o]>>2],c=Pi.HEAPF32.subarray(l>>2,(l>>2)+a[o]);o++;let u=Pi.HEAPU32[s[o]>>2],h=Pi.HEAPU32.subarray(u>>2,(u>>2)+a[o]);if(e===void 0){let d=new oi;d.setAttribute("position",new Gt(c,3));let f=new Float32Array(c.length);for(let p=0,g=c.length;p<g;)f[p++]=i.r,f[p++]=i.g,f[p++]=i.b;return d.setAttribute("color",new Mi(f,3)),d.setIndex(new s1(h,1)),Pi.free_wireframe_data_for_base_level(r),d}e.getAttribute("position").copyArray(c),e.attributes.position.needsUpdate=!0,Pi.free_wireframe_data_for_base_level(r)}static updateCollabMesh(t,e,i){let r=e===0;r||Pi.set_destination_refinement_level(t,e);let n=i?Pi.get_topological_data2(t,r?Pi.Level.CONTROL:Pi.Level.REFINED,i.elements):Pi.get_topological_data(t,r?Pi.Level.CONTROL:Pi.Level.REFINED),s=6,a=Pi.HEAPU32.subarray(n>>2,(n>>2)+s),o=a.subarray(3,6),l=0,c=Pi.HEAPU32[a[l]>>2],u=new Float32Array(Pi.HEAPF32.subarray(c>>2,(c>>2)+o[l]));l++;let h=Pi.HEAPU32[a[l]>>2],d=new Uint32Array(Pi.HEAPU32.subarray(h>>2,(h>>2)+o[l]));l++;let f=Pi.HEAPU32[a[l]>>2],p=new Uint8Array(Pi.HEAPU32.subarray(f>>2,(f>>2)+o[l]));return Pi.free_topological_data(n),{positions:u,indices:d,verticesPerFace:p}}},Zee=["getX","getY","getZ"];function CL(t,e){let i={},r=e?e.count:t.count,n=0,s=[],a=[],o=1e4;for(let c=0;c<r;c++){let u=e?e.getX(c):c,h="";for(let d=0;d<3;d++)h+=`${~~(t[Zee[d]](u)*o)},`;if(h in i)s.push(i[h]);else{for(let d=0;d<3;d++)a.push(t[Zee[d]](u));i[h]=n,s.push(n),n++}}let l=[];for(let c=0;c<s.length;c+=3)s[c]===s[c+1]||s[c]===s[c+2]||s[c+1]===s[c+2]||l.push(s[c],s[c+1],s[c+2]);return{positions:a,triIndices:l}}var fR=new W,jF=new W,VF=new W,HF=new W;function hpe(t,e,i,r){let n=[],s=[];if(i.userData.shape!==void 0&&i.userData.parameters.depth===0&&i.userData.shape.shapeHoles.length===0){let l=i.userData.shape.extractShapePointsToFlatArray([]),c=i.userData.parameters.spikes;if(i.userData.type==="EllipseGeometry"&&c<=24&&c%4===0&&i.userData.parameters.angle>=360){let d=l.length/2/c;l=l.filter((f,p)=>Math.floor(p/2)%d===0)}let u=0;for(let d=0;d<l.length;d+=2)u+=(l[d]-l[(d===0?l.length:d)-2])*(l[d+1]+l[(d===0?l.length:d)-1]);t.length=0;let h=0;if(u<0)for(let d=0;d<l.length;d+=2)t.push(l[d],l[d+1],0),n.push(h++);else for(let d=l.length-2;d>=0;d-=2)t.push(l[d],l[d+1],0),n.push(h++);return s.push(h),{indices:n,verticesPerFace:s}}let a=new Float32Array([i.userData.parameters.depth])[0],o=0;for(;o<e.length;){if(i.useNgonForTopBottomFaceDuringBake){let l=0;if((t[e[o]*3+2]===a||t[e[o]*3+2]===0)&&l++,(t[e[o+1]*3+2]===a||t[e[o+1]*3+2]===0)&&l++,(t[e[o+2]*3+2]===a||t[e[o+2]*3+2]===0)&&l++,l===3)break}if(e[o+1]===e[o+3]&&e[o+2]===e[o+5]||e[o+0]===e[o+3]&&e[o+2]===e[o+4]){fR.set(t[e[o]*3],t[e[o]*3+1],t[e[o]*3+2]),jF.set(t[e[o+1]*3],t[e[o+1]*3+1],t[e[o+1]*3+2]),VF.set(t[e[o+4]*3],t[e[o+4]*3+1],t[e[o+4]*3+2]),HF.set(t[e[o+5]*3],t[e[o+5]*3+1],t[e[o+5]*3+2]),jF.sub(fR).normalize(),VF.sub(fR).normalize(),HF.sub(fR).normalize();let l=jF.cross(VF).dot(HF);Math.abs(l)>.005||r&&r.some((c,u)=>u%2===1?!1:o>=r[u]&&o<r[u+1])?(n.push(e[o],e[o+1],e[o+2]),s.push(3),o+=3):(n.push(e[o],e[o+1],e[o+4],e[o+5]),s.push(4),o+=6)}else n.push(e[o],e[o+1],e[o+2]),s.push(3),o+=3}if(i.useNgonForTopBottomFaceDuringBake){let l=[],c=[],u=0;for(let h=0,d=0;h<t.length;h+=3,d++)t[h+2]===0&&(l.push(d),u++),t[h+2]===a&&c.push(d);if(i.userData.parameters.extrudeBevelSize===0){let h=c[0];c[0]=c[1],c[1]=h}l.reverse(),n.push(...l,...c),s.push(u,u)}return{indices:n,verticesPerFace:s}}var fp={};FVe(fp,{calcBoolean:()=>Nat,calcBooleanTopological:()=>kat,freeMeshSet:()=>zat,getMeshSet:()=>Uat,hasOpenEdges:()=>Bat,transformMeshSet:()=>Fat});var dpe,Dat=new Promise(t=>{dpe=t}),pR;function Oat(t){if(pR)return pR;async function e(){let i=t??"https://unpkg.com/@splinetool/boolean-wasm@1.10.72/build",r=Bc(()=>import("./boolean-DnW06Vcs.js"),[]),[n,s]=await Promise.all([r,fetch(`${i}/boolean.wasm`).then(l=>l.arrayBuffer())]),a=n.default,o=await a({wasmBinary:s});dpe(o)}return pR=e(),pR}var Sr,d1;Dat.then(t=>Sr=t);function Lat(t,e,i){let r,n;t.userData.parameters.type==="TorusGeometry"&&t.userData.parameters.arc===Math.PI*2?n=t.getClosedTorusIndicesForBooleanOrSubdiv():n=t.getIndex();let{positions:s,triIndices:a}=CL(t.getAttribute("position"),n),o;if(e&&i){let{indices:l,verticesPerFace:c}=hpe(s,a,t);o=c.length,r=[];for(let u=0,h=0;u<o;u++){r.push(c[u]);for(let d=0;d<c[u];d++)r.push(l[h++])}}else{let l=a.length;r=Array(l+l/3),o=0;for(let c=0,u=0;u<r.length;)r[u++]=3,o++,r[u++]=a[c++],r[u++]=a[c++],r[u++]=a[c++]}return{positions:s,faceIndices:r,nFaces:o}}function fpe(t){let e=t.length,i=e*Uint32Array.BYTES_PER_ELEMENT,r=e*Float32Array.BYTES_PER_ELEMENT,n=Number.isInteger(t[0])?i:r,s=Sr._malloc(n);return(Number.isInteger(t[0])?new Uint32Array(Sr.HEAPU32.buffer,s,e):new Float32Array(Sr.HEAPF32.buffer,s,e)).set(t,0),s}function ppe(t){switch(t){case 0:return Sr.OP.UNION;case 1:return Sr.OP.INTERSECTION;case 2:return Sr.OP.A_MINUS_B;default:throw new Error("Unknown boolean operation "+t)}}function kat(t,e){d1===void 0&&(d1=Sr.init_csg());let i=fpe(t),r=Sr.csg_calc_topological(d1,i,t.length,ppe(e));Sr._free(i);let n=6,s=Sr.HEAPU32.subarray(r>>2,(r>>2)+n),a=s.subarray(3,6),o=0,l=Sr.HEAPU32[s[o]>>2],c=new Float32Array(Sr.HEAPF32.subarray(l>>2,(l>>2)+a[o]));o++;let u=Sr.HEAPU32[s[o]>>2],h=new Uint32Array(Sr.HEAPU32.subarray(u>>2,(u>>2)+a[o]));o++;let d=Sr.HEAPU32[s[o]>>2],f=new Uint8Array(Sr.HEAPU32.subarray(d>>2,(d>>2)+a[o]));return Sr.free_mesh_data(r),{positions:c,indices:h,verticesPerFace:f}}function Nat(t,e,i,r){d1===void 0&&(d1=Sr.init_csg());let n=fpe(t),s=Sr.csg_calc(d1,n,t.length,r,ppe(e));Sr._free(n);let a=5,o=Sr.HEAPU32.subarray(s>>2,(s>>2)+a),l=o.subarray(2,5),c=0,u=Sr.HEAPU32[o[c]>>2],h=Sr.HEAPF32.subarray(u>>2,(u>>2)+l[c]);c++;let d=Sr.HEAPU32[o[c]>>2],f=Sr.HEAPF32.subarray(d>>2,(d>>2)+l[c]);c++;let p=l[c];i.setAttribute("position",new Gt(h,3)),i.setAttribute("normal",new Gt(f,3));let g=Sr.HEAPF32.subarray((s>>2)+5,(s>>2)+5+6);return i.boundingSphere===null&&(i.boundingSphere=new oc),i.boundingSphere.center.set(g[0],g[1],g[2]),i.boundingSphere.radius=(g[3]**2+g[4]**2+g[5]**2)**.5,i.userData.parameters={width:g[3]*2,height:g[4]*2,depth:g[5]*2},Sr.free_mesh_data(s),p}function Uat(t,e,i){if(Sr===void 0)return-1;let r,n,s;if(e&&t.userData.positions!==void 0){let m=t.userData;s=m.verticesPerFace.length,r=m.positions,n=Array(m.verticesPerFace.reduce((y,b)=>y+b,0)+s);for(let y=0,b=0,w=0;y<m.verticesPerFace.length;y++){n[w++]=m.verticesPerFace[y];for(let E=0;E<m.verticesPerFace[y];E++)n[w++]=m.indices[b++]}}else({positions:r,faceIndices:n,nFaces:s}=Lat(t,e,i));let a=r.length,o=n.length,l=r.length,c=n.length,u=l*Float32Array.BYTES_PER_ELEMENT+c*Uint32Array.BYTES_PER_ELEMENT,h=l*Float32Array.BYTES_PER_ELEMENT,d=Sr._malloc(u),f=new Float32Array(Sr.HEAPF32.buffer,d,l),p=new Uint32Array(Sr.HEAPU32.buffer,d+h,c);f.set(r,0),p.set(n,0);let g=Sr.get_csg_mesh(d,a,d+h,o,s);return Sr._free(d),g}function Bat(t){return Sr.has_open_edges(t)}function Fat(t,e){Sr.transform_csg_mesh(t,e.elements)}function zat(t){Sr.free_csg_mesh(t)}var jat={ConeGeometry:Hnt,CubeGeometry:Gnt,CylinderGeometry:Ffe,DodecahedronGeometry:qnt,EllipseGeometry:i8,HelixGeometry:Cst,IcosahedronGeometry:Pst,LatheGeometry:Rst,NonParametricGeometry:Ust,PolygonGeometry:rpe,PyramidGeometry:Bst,RectangleGeometry:r8,SphereGeometry:jst,PlaneGeometry:Vst,BackdropGeometry:Hst,StarGeometry:npe,TextFrameGeometry:Wst,TorusGeometry:qst,TorusKnotGeometry:$st,TriangleGeometry:Yst,PathGeometry:Sat,VectorGeometry:Q0},Qee=t=>jat[t.type].create(t);function cw(t){return t!==null&&"booleanOp"in t}var mpe=class extends KG(En){constructor(){super(...arguments),this.booleanMeshSetAddress=-1,this.booleanWasTransformed=!1,this.booleanMatrixInvOld=new St}updateVisible(t){super.updateVisible(t),this.visible=!cw(this.parent)&&this.visible,cw(this.parent)&&this.parent.invalidateDownstreamBooleanData()}freeBooleanPointer(){this.booleanMeshSetAddress!==-1&&(fp.freeMeshSet(this.booleanMeshSetAddress),this.booleanMeshSetAddress=-1)}invalidateDownstreamBooleanData(t=!1){return t?this.booleanWasTransformed=!0:this.freeBooleanPointer(),cw(this.parent)?this.parent.invalidateDownstreamBooleanData():this}invalidateUpstreamBooleanData(){this.freeBooleanPointer();for(let t of this.children)t instanceof mpe&&(t.freeBooleanPointer(),cw(t)&&t.invalidateUpstreamBooleanData())}updateTransformState(t,e){let i=super.updateTransformState(t,e);return i&&cw(this.parent)&&this.invalidateDownstreamBooleanData(!0),i}onVariableUpdate(t=!1){super.onVariableUpdate(t),cw(this.parent)&&this.invalidateDownstreamBooleanData(!0)}},mR=new Ss;function n8(t,e=0,i=t.count,r,n){let s=1/0,a=1/0,o=1/0,l=-1/0,c=-1/0,u=-1/0;for(let h=e;h<i;h++){let d=t.getX(h),f=t.getY(h),p=t.getZ(h);d<s&&(s=d),f<a&&(a=f),p<o&&(o=p),d>l&&(l=d),f>c&&(c=f),p>u&&(u=p)}mR.min.set(s,a,o),mR.max.set(l,c,u),mR.getCenter(r),mR.getSize(n).multiplyScalar(.5)}var Vat=new oi,Hat=new Xp,So=class extends mpe{constructor(t,e){super(Vat,Hat),this.super_Entity(t,e)}updateState(t,e){this.updateState_Entity(t,e)}updateEntityBoxSize(t,e){let i=this.geometry.getAttribute("position");i!==void 0?n8(i,this.geometry.drawRange.start,this.geometry.drawRange.count<1/0?this.geometry.drawRange.count:i.count,t,e):super.updateEntityBoxSize(t,e)}},mg=class{constructor(t){if(this.hashProperties=void 0,this.isNode=!0,this.shortcuts={},mg.uuidContext===null)throw new Error("plz startContext");mg.uuidContext===mg.globalContext?this.uuid="_gid"+mg.uuidContext.nodeContextUuid++:this.uuid="_uid"+mg.uuidContext.nodeContextUuid++,this.type=t,this.name=""}static startContext(t){this.uuidContext===null||this.uuidContext===mg.globalContext?this.uuidContext=t:console.error("Can't start context twice")}static endContext(t){this.uuidContext!==t&&console.error("Can't end context twice"),this.uuidContext=null}analyze(t,e){e=e??{},t.analyzing=!0,this.build(t.addFlow(e.slot,e.cache,e.context),"v4"),t.clearVertexNodeCode(),t.clearFragmentNodeCode(),t.removeFlow(),t.analyzing=!1}analyzeAndFlow(t,e,i){return i=i??{},this.analyze(t,i),this.flow(t,e,i)}flow(t,e,i){i=i??{},t.addFlow(i.slot,i.cache,i.context);let r={result:this.build(t,e),code:t.clearNodeCode(),extra:t.context.extra};return t.removeFlow(),r}build(t,e,i){e=e??this.getType(t,e);let r=t.getNodeData(i??this);return t.analyzing&&this.appendDepsNode(t,r,e),t.nodes.indexOf(this)===-1&&t.nodes.push(this),this.updateFrame!==void 0&&t.updaters.indexOf(this)===-1&&t.updaters.push(this),this.generate(t,e,i)}updateFrame(t){}generateReadonly(t,e,i,r,n,s){return""}generate(t,e,i,r,n){return""}parse(t,e,i,r){}appendDepsNode(t,e,i){e.deps=(e.deps||0)+1;let r=t.getTypeLength(i);(r>(e.outputMax||0)||this.getType(t,i))&&(e.outputMax=r,e.output=i)}setName(t){this.name=t}getName(){return this.name}getType(t,e){return e==="sampler2D"||e==="samplerCube"?e:this.type}},da=mg;da.globalContext={nodeContextUuid:0},da.uuidContext=mg.globalContext;var Jee=class{constructor(t){t=t??{},this.name=t.name,this.type=t.type,this.node=t.node,this.size=t.size,this.needsUpdate=t.needsUpdate}get value(){return this.node.value}set value(t){this.node.value=t}},Gat=class{constructor(){this.nodes={},this.keywords={}}add(t){this.nodes[t.name]=t}addKeyword(t,e,i){i=i!==void 0?i:!0,this.keywords[t]={callback:e,cache:i}}remove(t){delete this.nodes[t.name]}removeKeyword(t){delete this.keywords[t]}get(t){return this.nodes[t]}getKeyword(t,e){return this.keywords[t].callback(e)}getKeywordData(t){return this.keywords[t]}contains(t){return this.nodes[t]!==void 0}containsKeyword(t){return this.keywords[t]!==void 0}},Ql=new Gat,dn=class extends da{constructor(t,e){super(t),this.scope="",e=e??{},this.shared=e.shared!==void 0?e.shared:!0,this.unique=e.unique!==void 0?e.unique:!1}build(t,e,i,r){if(e=e??this.getType(t),this.getShared(t,e)){let n=this.getUnique(t,e);n&&this.uuid===void 0&&(this.uuid=Ht.generateUUID()),i=t.getUUID(i??this.getUUID(),!n);let s=t.getNodeData(i),a=s.output||this.getType(t);if(t.analyzing)return(s.deps||0)>0||this.getLabel()?(this.appendDepsNode(t,s,e),this.generate(t,e,i)):super.build(t,e,i);if(n)return s.name=s.name||super.build(t,e,i),s.name;if(!this.getLabel()&&(!this.getShared(t,a)||t.context.ignoreCache||s.deps===1))return super.build(t,e,i);i=this.getUUID(!1);let o=this.getTemp(t,i);if(o)return t.format(o,a,e);{o=super.generate(t,e,i,s.output,r);let l=this.generate(t,a,i);return t.addNodeCode(o+" = "+l+";"),t.format(o,a,e)}}return super.build(t,e,i)}getShared(t,e){return e!=="sampler2D"&&e!=="samplerCube"&&this.shared}getUnique(t,e){return this.unique}setLabel(t){return this.label=t,this}getLabel(){return this.label}getUUID(t){let e=this.uuid;return typeof this.scope=="string"&&(e=this.scope+"-"+e),e}getTemp(t,e){e=e||this.uuid;let i=t.getVars()[e];return i?i.name:void 0}generate(t,e,i,r,n){return this.getShared(t,e)||console.error("TempNode is not shared"),i=i??this.uuid,t.getTempVar(i,r??this.getType(t),n,this.getLabel()).name}},uc=class extends dn{constructor(t,e){e=e??{},e.shared=e.shared!==void 0?e.shared:!1,super(t,e),this.readonly=!1}setReadonly(t){return this.readonly=t,this.hashProperties=this.readonly?["value"]:void 0,this}getReadonly(){return this.readonly}generate(t,e,i,r,n,s){i=t.getUUID(i??this.getUUID()),r=r??this.getType(t);let a=t.getNodeData(i);return this.getReadonly()&&this.generateReadonly!==void 0?this.generateReadonly(t,e,i,r,n,s):t.isShader("vertex")?(a.vertex||(a.vertex=t.createVertexUniform(r,this,n,s,this.getLabel())),t.format(a.vertex.name,r,e)):(a.fragment||(a.fragment=t.createFragmentUniform(r,this,n,s,this.getLabel())),t.format(a.fragment.name,r,e))}},mo=class extends uc{constructor(t=0,e){super("v2"),this.nodeType="Vector2",this.value=t instanceof Ae?t:new Ae(t,e)}get x(){return this.value.x}set x(t){this.value.x=t}get y(){return this.value.y}set y(t){this.value.y=t}generateReadonly(t,e,i,r,n,s){return t.format("vec2("+this.value.x+", "+this.value.y+")",r,e)}},lu=class extends uc{constructor(t=0,e,i){super("v3"),this.nodeType="Vector3",this.value=t instanceof W?t:new W(t,e,i)}get x(){return this.value.x}set x(t){this.value.x=t}get y(){return this.value.y}set y(t){this.value.y=t}get z(){return this.value.z}set z(t){this.value.z=t}generateReadonly(t,e,i,r,n,s){return t.format("vec3("+this.value.x+", "+this.value.y+", "+this.value.z+")",r,e)}},pp=class extends uc{constructor(t){super("v4"),this.nodeType="Vector4",this.value=t instanceof Ya?t:new Ya(t.r,t.g,t.b,t.a)}generateReadonly(t,e,i,r,n,s){return t.format("vec4("+this.value.r+", "+this.value.g+", "+this.value.b+", "+this.value.a+")",r,e)}},Wat=/^\s*([a-z_0-9]+)\s([a-z_0-9]+)\s*\((.*?)\)/i,ete=/[a-z_0-9]+/gi,jt=class extends dn{constructor(t,e,i,r,n){super(n),this.src="",this.nodeType="Function",this.useKeywords=!0,this.includes=[],this.extensions={},this.keywords={},this.isMethod=n===void 0,this.isInterface=!1,this.parse(t,e,i,r)}getShared(t,e){return!this.isMethod}getType(t){return t.getTypeByFormat(this.type)}getInputByName(t){if(this.inputs){let e=this.inputs.length;for(;e--;)if(this.inputs[e].name===t)return this.inputs[e]}}getIncludeByName(t){if(this.includes){let e=this.includes.length;for(;e--;)if(this.includes[e].name===t)return this.includes[e]}}generate(t,e,i,r,n){let s,a=0,o=this.src;if(this.includes)for(let c=0;c<this.includes.length;c++)t.include(this.includes[c],this);for(let c in this.extensions)t.extensions[c]=!0;let l=[];for(;s=ete.exec(this.src);)l.push(s);for(let c=0;c<l.length;c++){let u=l[c],h=u[0],d=this.isMethod?!this.getInputByName(h):!0,f=h;if(this.keywords[h]||this.useKeywords&&d&&Ql.containsKeyword(h)){let p=this.keywords[h];if(!p){let g=Ql.getKeywordData(h);g.cache&&(p=t.keywords[h]),p=p||Ql.getKeyword(h,t),g.cache&&(t.keywords[h]=p)}f=p.build(t)}h!==f&&o[u.index+a-1]!=="."&&(o=o.substring(0,u.index+a)+f+o.substring(u.index+h.length+a),a+=f.length-h.length),this.getIncludeByName(f)===void 0&&Ql.contains(f)&&t.include(Ql.get(f))}return e==="source"?o:this.isMethod?(this.isInterface||t.include(this,void 0,o),this.name):t.format("( "+o+" )",this.getType(t),e)}parse(t,e,i,r){if(this.src=t||"",this.includes=e??[],this.extensions=i??{},this.keywords=r??{},this.isMethod){let n=Wat.exec(this.src);if(this.inputs=[],n&&n.length==4){this.type=n[1],this.name=n[2];let s=n[3].match(ete);if(s){let a=0;for(;a<s.length;){let o=s[a++],l;o==="in"||o==="out"||o==="inout"?l=s[a++]:(l=o,o="");let c=s[a++];this.inputs.push({name:c,type:l,qualifier:o})}}this.isInterface=this.src.indexOf("{")===-1}else this.type="",this.name=""}}},qat=/^([a-z_0-9]+)\s([a-z_0-9]+)\s?\=?\s?(.*?)(\;|$)/i,gpe=class extends dn{constructor(t="",e){super(),this.src="",this.useDefine=!1,this.nodeType="Const",this.parse(t||gpe.PI,void 0,void 0,void 0,e)}getType(t){return t.getTypeByFormat(this.type)}parse(t,e,i,r,n){this.src=t||"";let s,a,o="",l=qat.exec(t);this.useDefine=n??this.src.charAt(0)==="#",l&&l.length>1?(a=l[1],s=l[2],o=l[3]):(s=this.src,a="f"),this.name=s,this.type=a,this.value=o}build(t,e){if(e==="source"){if(this.value)return this.useDefine?"#define "+this.name+" "+this.value:"const "+this.type+" "+this.name+" = "+this.value+";";if(this.useDefine)return this.src}return t.include(this),t.format(this.name,this.getType(t),e)}generate(t,e,i,r,n){return t.format(this.name,this.getType(t),e)}},qr=gpe;qr.PI="PI",qr.PI2="PI2",qr.RECIPROCAL_PI="RECIPROCAL_PI",qr.RECIPROCAL_PI2="RECIPROCAL_PI2",qr.LOG2="LOG2",qr.EPSILON="EPSILON";var Xat=new RegExp(`^structs*([a-z_0-9]+)s*{s*((.|
)*?)}`,"gim"),$at=new RegExp("s*(w*?)s*(w*?)(=|;)","gim"),vpe=class extends dn{constructor(t=""){super(),this.inputs=[],this.src="",this.nodeType="Struct",this.parse(t)}getType(t){return t.getTypeByFormat(this.name)}getInputByName(t){let e=this.inputs.length;for(;e--;)if(this.inputs[e].name===t)return this.inputs[e]}generate(t,e,i,r,n){return e==="source"?this.src+";":t.format("( "+this.src+" )",this.getType(t),e)}parse(t=""){this.src=t,this.inputs=[];let e=Xat.exec(t);if(e){let i=e[2],r;for(;r=$at.exec(i);)this.inputs.push({type:r[1],name:r[2]});this.name=e[1]}else this.name="";this.type=this.name}},s8=class extends dn{constructor(t){super("v2",{shared:!1}),this.nodeType="UV",this.index=t??0}generate(t,e){t.requires.uv[this.index]=!0;let i=this.index>0?this.index+1:"",r=t.isShader("vertex")?"uv"+i:"vUv"+i;return t.format(r,this.getType(t),e)}};Ql.addKeyword("uv",function(){return new s8});Ql.addKeyword("uv2",function(){return new s8(1)});var Rw=class extends dn{constructor(t,e){super("v4"),this.nodeType="ColorSpace",this.input=t,this.method=e??Rw.LINEAR_TO_LINEAR,this.hashProperties=["method"]}static getEncodingComponents(t){switch(t){case Dh:return["Linear"];case er:return["sRGB"];default:return[]}}generate(t,e){let i=this.input.build(t,"v4"),r=this.getType(t),n=Rw.Nodes[this.method],s=t.include(n);if(s===Rw.LINEAR_TO_LINEAR)return t.format(i,r,e);if(n.inputs?.length===2){let a=this.factor.build(t,"f");return t.format(s+"( "+i+", "+a+" )",r,e)}else return t.format(s+"( "+i+" )",r,e)}fromEncoding(t){let e=Rw.getEncodingComponents(t);this.method="LinearTo"+e[0],this.factor=e[1]}fromDecoding(t){let e=Rw.getEncodingComponents(t);this.method=e[0]+"ToLinear",this.factor=e[1]}},Ud=Rw;Ud.Nodes={LinearToLinear:new jt(["vec4 LinearToLinear( in vec4 value ) {","	return value;","}"].join(`
`)),sRGBToLinear:new jt(["vec4 sRGBToLinear( in vec4 value ) {","	return vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.w );","}"].join(`
`)),LinearTosRGB:new jt(["vec4 LinearTosRGB( in vec4 value ) {","	return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.w );","}"].join(`
`))},Ud.LINEAR_TO_LINEAR="LinearToLinear",Ud.SRGB_TO_LINEAR="sRGBToLinear",Ud.LINEAR_TO_SRGB="LinearTosRGB";var Pn=class extends jt{constructor(t="",e,i,r,n){super(t,n,r,i,e),this.nodeType="Expression"}},_p=class extends uc{constructor(t=new Kn,e,i,r){super("v4",{shared:!0}),this.nodeType="Texture",this.value=t,this.uv=e??new s8,this.bias=i,this.project=r!==void 0?r:!1}getTexture(t,e){return super.generate(t,e,this.value.uuid,"t")}generate(t,e){if(e==="sampler2D")return this.getTexture(t,e);let i=this.getTexture(t,e),r=this.uv.build(t,this.project?"v4":"v2"),n=this.bias?this.bias.build(t,"f"):void 0;n===void 0&&t.context.bias&&(n=t.context.bias.setTexture(this).build(t,"f"));let s,a;this.project?s="texture2DProj":s=n?"tex2DBias":"tex2D",n?a=s+"( "+i+", "+r+", "+n+" )":a=s+"( "+i+", "+r+" )";let o={include:t.isShader("vertex"),ignoreCache:!0},l=this.getType(t);return t.addContext(o),this.colorSpace=this.colorSpace??new Ud(new Pn("",l)),this.colorSpace.fromDecoding(t.getTextureEncodingFromMap(this.value)),this.colorSpace.input.parse(a),a=this.colorSpace.build(t,l),t.removeContext(),t.format(a,l,e)}},Kt=class extends uc{constructor(t){super("f"),this.nodeType="Float",this.value=t??0}generateReadonly(t,e,i,r,n,s){return t.format(this.value+(this.value%1?"":".0"),r,e)}},tte=class extends dn{constructor(t,e){super(),this.inputs=[],this.nodeType="FunctionCall",this.value=t,this.inputs=e??[]}getFunction(){return this.value}getType(t){return this.value.getType(t)}generate(t,e,i,r,n){r=this.getType(t);let s=this.value,a=s.build(t,e)+"( ",o=[];if(s.inputs){for(let l=0;l<s.inputs.length;l++){let c=s.inputs[l],u=this.inputs[l]||this.inputs[c.name];o.push(u.build(t,t.getTypeByFormat(c.type)))}a+=o.join(", ")+" )"}return t.format(a,r,e)}},ype=class extends dn{constructor(t,e,i=ype.ADD){super(),this.nodeType="Operator",this.type=t.type,this.a=t,this.b=e,this.op=i}getType(t){let e=this.a.getType(t),i=this.b.getType(t);return t.isTypeMatrix(e)?"v4":t.getTypeLength(i)>t.getTypeLength(e)?i:e}generate(t,e){let i=this.getType(t);this.type=i;let r=this.a.build(t,i),n=this.b.build(t,i);return t.format("( "+r+" "+this.op+" "+n+" )",i,e)}},Gl=ype;Gl.ADD="+",Gl.SUB="-",Gl.MUL="*",Gl.DIV="/";var an=class extends dn{constructor(t,e=an.ABS,i,r){super(),this.nodeType="Math",this.a=t,typeof e!="string"?this.b=e:r=e,typeof i!="string"?this.c=i:r=i,this.method=r,this.hashProperties=["method"]}getNumInputs(t){switch(this.method){case an.MIX:case an.CLAMP:case an.REFRACT:case an.SMOOTHSTEP:case an.FACEFORWARD:return 3;case an.MIN:case an.MAX:case an.MOD:case an.STEP:case an.REFLECT:case an.DISTANCE:case an.DOT:case an.CROSS:case an.POW:return 2;default:return 1}}getInputType(t){let e=t.getTypeLength(this.a.getType(t)),i=this.b?t.getTypeLength(this.b.getType(t)):0,r=this.c?t.getTypeLength(this.c.getType(t)):0;return e>i&&e>r?this.a.getType(t):i>r?this.b.getType(t):this.c.getType(t)}getType(t){switch(this.method){case an.LENGTH:case an.DISTANCE:case an.DOT:return"f";case an.CROSS:return"v3"}return this.getInputType(t)}generate(t,e){let i,r,n,s=this.a?t.getTypeLength(this.a.getType(t)):0,a=this.b?t.getTypeLength(this.b.getType(t)):0,o=this.c?t.getTypeLength(this.c.getType(t)):0,l=this.getInputType(t),c=this.getType(t);switch(this.type=c,this.method){case an.NEGATE:return t.format("( -"+this.a.build(t,l)+" )",l,e);case an.INVERT:return t.format("( 1.0 - "+this.a.build(t,l)+" )",l,e);case an.CROSS:i=this.a.build(t,"v3"),r=this.b.build(t,"v3");break;case an.STEP:i=this.a.build(t,s===1?"f":l),r=this.b.build(t,l);break;case an.MIN:case an.MAX:case an.MOD:i=this.a.build(t,l),r=this.b.build(t,a===1?"f":l);break;case an.REFRACT:i=this.a.build(t,l),r=this.b.build(t,l),n=this.c.build(t,"f");break;case an.MIX:i=this.a.build(t,l),r=this.b.build(t,l),n=this.c.build(t,o===1?"f":l);break;default:i=this.a.build(t,l),this.b&&(r=this.b.build(t,l)),this.c&&(n=this.c.build(t,l));break}let u=[];u.push(i),r&&u.push(r),n&&u.push(n);let h=this.getNumInputs(t);if(u.length!==h)throw Error(`Arguments not match used in "${this.method}". Require ${h}, currently ${u.length}.`);return t.format(this.method+"( "+u.join(", ")+" )",c,e)}},Ki=an;Ki.RAD="radians",Ki.DEG="degrees",Ki.EXP="exp",Ki.EXP2="exp2",Ki.LOG="log",Ki.LOG2="log2",Ki.SQRT="sqrt",Ki.INV_SQRT="inversesqrt",Ki.FLOOR="floor",Ki.CEIL="ceil",Ki.NORMALIZE="normalize",Ki.FRACT="fract",Ki.SATURATE="saturate",Ki.SIN="sin",Ki.COS="cos",Ki.TAN="tan",Ki.ASIN="asin",Ki.ACOS="acos",Ki.ARCTAN="atan",Ki.ABS="abs",Ki.SIGN="sign",Ki.LENGTH="length",Ki.NEGATE="negate",Ki.INVERT="invert",Ki.MIN="min",Ki.MAX="max",Ki.MOD="mod",Ki.STEP="step",Ki.REFLECT="reflect",Ki.DISTANCE="distance",Ki.DOT="dot",Ki.CROSS="cross",Ki.POW="pow",Ki.MIX="mix",Ki.CLAMP="clamp",Ki.REFRACT="refract",Ki.SMOOTHSTEP="smoothstep",Ki.FACEFORWARD="faceforward";var KE=class extends dn{constructor(t,e,i){super("v4"),this.nodeType="TextureCubeUV",this.value=t,this.uv=e,this.bias=i}bilinearCubeUV(t,e,i,r){let n=new tte(KE.Nodes.bilinearCubeUV,[e,i,r]);this.colorSpaceTL=this.colorSpaceTL??new Ud(new Pn("","v4")),this.colorSpaceTL.fromDecoding(t.getTextureEncodingFromMap(this.value.value)),this.colorSpaceTL.input.parse(n.build(t)+".tl"),this.colorSpaceTR=this.colorSpaceTR??new Ud(new Pn("","v4")),this.colorSpaceTR.fromDecoding(t.getTextureEncodingFromMap(this.value.value)),this.colorSpaceTR.input.parse(n.build(t)+".tr"),this.colorSpaceBL=this.colorSpaceBL??new Ud(new Pn("","v4")),this.colorSpaceBL.fromDecoding(t.getTextureEncodingFromMap(this.value.value)),this.colorSpaceBL.input.parse(n.build(t)+".bl"),this.colorSpaceBR=this.colorSpaceBR??new Ud(new Pn("","v4")),this.colorSpaceBR.fromDecoding(t.getTextureEncodingFromMap(this.value.value)),this.colorSpaceBR.input.parse(n.build(t)+".br");let s={include:t.isShader("vertex"),ignoreCache:!0};t.addContext(s),this.colorSpaceTLExp=new Pn(this.colorSpaceTL.build(t,"v4"),"v4"),this.colorSpaceTRExp=new Pn(this.colorSpaceTR.build(t,"v4"),"v4"),this.colorSpaceBLExp=new Pn(this.colorSpaceBL.build(t,"v4"),"v4"),this.colorSpaceBRExp=new Pn(this.colorSpaceBR.build(t,"v4"),"v4"),t.removeContext();let a=new Pn("mix( mix( cubeUV_TL, cubeUV_TR, cubeUV.f.x ), mix( cubeUV_BL, cubeUV_BR, cubeUV.f.x ), cubeUV.f.y )","v4");return a.keywords.cubeUV_TL=this.colorSpaceTLExp,a.keywords.cubeUV_TR=this.colorSpaceTRExp,a.keywords.cubeUV_BL=this.colorSpaceBLExp,a.keywords.cubeUV_BR=this.colorSpaceBRExp,a.keywords.cubeUV=n,a}generate(t,e){if(t.isShader("fragment")){let i=this.uv,r=this.bias||t.context.roughness,n=new tte(KE.Nodes.roughnessToMip,[r]),s=new Ki(n,KE.Nodes.m0,KE.Nodes.cubeUV_maxMipLevel,Ki.CLAMP),a=new Ki(s,Ki.FLOOR),o=new Ki(s,Ki.FRACT),l=this.bilinearCubeUV(t,this.value,i,a),c=this.bilinearCubeUV(t,this.value,i,new Gl(a,new Kt(1).setReadonly(!0),Gl.ADD)),u=new Ki(l,c,o,Ki.MIX);return t.format(u.build(t),"v4",e)}else return console.warn("TextureCubeUVNode is not compatible with "+t.shader+" shader."),t.format("vec4( 0.0 )",this.getType(t),e)}},q5=KE;q5.Nodes=(function(){let t=new vpe(`struct TextureCubeUVData {
			vec4 tl;
			vec4 tr;
			vec4 br;
			vec4 bl;
			vec2 f;
		}`),e=new qr("float cubeUV_maxMipLevel 8.0",!0),i=new qr("float cubeUV_minMipLevel 4.0",!0),r=new qr("float cubeUV_maxTileSize 256.0",!0),n=new qr("float cubeUV_minTileSize 16.0",!0),s=new jt(`float getFace(vec3 direction) {
				vec3 absDirection = abs(direction);
				float face = -1.0;
				if (absDirection.x > absDirection.z) {
					if (absDirection.x > absDirection.y)
						face = direction.x > 0.0 ? 0.0 : 3.0;
					else
						face = direction.y > 0.0 ? 1.0 : 4.0;
				} else {
					if (absDirection.z > absDirection.y)
						face = direction.z > 0.0 ? 2.0 : 5.0;
					else
						face = direction.y > 0.0 ? 1.0 : 4.0;
				}
				return face;
		}`);s.useKeywords=!1;let a=new jt(`vec2 getUV(vec3 direction, float face) {
				vec2 uv;
				if (face == 0.0) {
					uv = vec2(direction.z, direction.y) / abs(direction.x); // pos x
				} else if (face == 1.0) {
					uv = vec2(-direction.x, -direction.z) / abs(direction.y); // pos y
				} else if (face == 2.0) {
					uv = vec2(-direction.x, direction.y) / abs(direction.z); // pos z
				} else if (face == 3.0) {
					uv = vec2(-direction.z, direction.y) / abs(direction.x); // neg x
				} else if (face == 4.0) {
					uv = vec2(-direction.x, direction.z) / abs(direction.y); // neg y
				} else {
					uv = vec2(direction.x, direction.y) / abs(direction.z); // neg z
				}
				return 0.5 * (uv + 1.0);
		}`);a.useKeywords=!1;let o=new jt(`TextureCubeUVData bilinearCubeUV(sampler2D envMap, vec3 direction, float mipInt) {
			float face = getFace(direction);
			float filterInt = max(cubeUV_minMipLevel - mipInt, 0.0);
			mipInt = max(mipInt, cubeUV_minMipLevel);
			float faceSize = exp2(mipInt);
			float texelSize = 1.0 / (3.0 * cubeUV_maxTileSize);
			vec2 uv = getUV(direction, face) * (faceSize - 1.0);
			vec2 f = fract(uv);
			uv += 0.5 - f;
			if (face > 2.0) {
				uv.y += faceSize;
				face -= 3.0;
			}
			uv.x += face * faceSize;
			if(mipInt < cubeUV_maxMipLevel){
				uv.y += 2.0 * cubeUV_maxTileSize;
			}
			uv.y += filterInt * 2.0 * cubeUV_minTileSize;
			uv.x += 3.0 * max(0.0, cubeUV_maxTileSize - 2.0 * faceSize);
			uv *= texelSize;
			vec4 tl = texture2D(envMap, uv);
			uv.x += texelSize;
			vec4 tr = texture2D(envMap, uv);
			uv.y += texelSize;
			vec4 br = texture2D(envMap, uv);
			uv.x -= texelSize;
			vec4 bl = texture2D(envMap, uv);
			return TextureCubeUVData( tl, tr, br, bl, f );
		}`,[t,s,a,e,i,r,n]);o.useKeywords=!1;let l=new qr("float r0 1.0",!0),c=new qr("float v0 0.339",!0),u=new qr("float m0 -2.0",!0),h=new qr("float r1 0.8",!0),d=new qr("float v1 0.276",!0),f=new qr("float m1 -1.0",!0),p=new qr("float r4 0.4",!0),g=new qr("float v4 0.046",!0),m=new qr("float m4 2.0",!0),y=new qr("float r5 0.305",!0),b=new qr("float v5 0.016",!0),w=new qr("float m5 3.0",!0),E=new qr("float r6 0.21",!0),M=new qr("float v6 0.0038",!0),A=new qr("float m6 4.0",!0),P=[l,c,u,h,d,f,p,g,m,y,b,w,E,M,A],C=new jt(`float roughnessToMip(float roughness) {
			float mip = 0.0;
			if (roughness >= r1) {
				mip = (r0 - roughness) * (m1 - m0) / (r0 - r1) + m0;
			} else if (roughness >= r4) {
				mip = (r1 - roughness) * (m4 - m1) / (r1 - r4) + m1;
			} else if (roughness >= r5) {
				mip = (r4 - roughness) * (m5 - m4) / (r4 - r5) + m4;
			} else if (roughness >= r6) {
				mip = (r5 - roughness) * (m6 - m5) / (r5 - r6) + m5;
			} else {
				mip = -2.0 * log2(1.16 * roughness);// 1.16 = 1.79^0.25
			}
			return mip;
		}`,P);return{bilinearCubeUV:o,roughnessToMip:C,m0:u,cubeUV_maxMipLevel:e}})();var Iw=class extends dn{constructor(t){super("v3"),this.nodeType="Normal",this.scope=t??Iw.VIEW}getShared(){return this.scope===Iw.WORLD}build(t,e,i,r){let n=t.context[this.scope+"Normal"];return n?n.build(t,e,i,r):super.build(t,e,i)}generate(t,e,i,r,n){let s;switch(this.scope){case Iw.VIEW:t.isShader("vertex")?s="transformedNormal":s="geometryNormal";break;case Iw.LOCAL:t.isShader("vertex")?s="objectNormal":(t.requires.normal=!0,s="vObjectNormal");break;case Iw.WORLD:t.isShader("vertex")?s="inverseTransformDirection( transformedNormal, viewMatrix ).xyz":(t.requires.worldNormal=!0,s="vWNormal");break}return t.format(s,this.getType(t),e)}},ic=Iw;ic.LOCAL="local",ic.WORLD="world",ic.VIEW="view",ic.NORMAL="normal";Ql.addKeyword("viewNormal",function(){return new ic(ic.VIEW)});Ql.addKeyword("localNormal",function(){return new ic(ic.NORMAL)});Ql.addKeyword("worldNormal",function(){return new ic(ic.WORLD)});var up=class extends dn{constructor(t){super("v3"),this.nodeType="Position",this.scope=t??up.LOCAL}getType(){switch(this.scope){case up.PROJECTION:return"v4"}return this.type}getShader(){switch(this.scope){case up.LOCAL:case up.WORLD:return!1}return!0}generate(t,e,i,r,n){let s;switch(this.scope){case up.LOCAL:t.isShader("vertex")?s="transformed":(t.requires.position=!0,s="vPosition");break;case up.WORLD:if(t.isShader("vertex"))return"( modelMatrix * vec4( transformed, 1.0 ) ).xyz";t.requires.worldPosition=!0,s="vWPosition";break;case up.VIEW:s=t.isShader("vertex")?"-mvPosition.xyz":"vViewPosition";break;case up.PROJECTION:s=t.isShader("vertex")?"( projectionMatrix * modelViewMatrix * vec4( position, 1.0 ) )":"vec4( 0.0 )";break}return t.format(s,this.getType(),e)}},_h=up;_h.LOCAL="local",_h.WORLD="world",_h.VIEW="view",_h.PROJECTION="projection";Ql.addKeyword("position",function(){return new _h});Ql.addKeyword("worldPosition",function(){return new _h(_h.WORLD)});Ql.addKeyword("viewPosition",function(){return new _h(_h.VIEW)});var gd=class extends dn{constructor(t){super("v3"),this.nodeType="Reflect",this.scope=t??gd.CUBE}getUnique(t){return!t.context.viewNormal}getType(){switch(this.scope){case gd.SPHERE:return"v2"}return this.type}generate(t,e){let i=this.getUnique(t);if(t.isShader("fragment")){let r;switch(this.scope){case gd.VECTOR:{let n=new ic(ic.VIEW),s=t.context.roughness,a=n.build(t,"v3"),o=new _h(_h.VIEW).build(t,"v3"),l=s?s.build(t,"f"):void 0,c=`reflect( -normalize( ${o} ), ${a} )`;l&&(c=`normalize( mix( ${c}, ${a}, ${l} * ${l} ) )`);let u=`inverseTransformDirection( ${c}, viewMatrix )`;i?(t.addNodeCode(`vec3 reflectVec = ${u};`),r="reflectVec"):r=u;break}case gd.CUBE:{let n=new gd(gd.VECTOR).build(t,"v3"),s="vec3( -"+n+".x, "+n+".yz )";i?(t.addNodeCode(`vec3 reflectCubeVec = ${s};`),r="reflectCubeVec"):r=s;break}case gd.SPHERE:{let n="normalize( ( viewMatrix * vec4( "+new gd(gd.VECTOR).build(t,"v3")+", 0.0 ) ).xyz + vec3( 0.0, 0.0, 1.0 ) ).xy * 0.5 + 0.5";i?(t.addNodeCode(`vec2 reflectSphereVec = ${n};`),r="reflectSphereVec"):r=n;break}}return t.format(r,this.getType(),e)}else return console.warn("ReflectNode is not compatible with "+t.shader+" shader."),t.format("vec3( 0.0 )",this.type,e)}},f1=gd;f1.CUBE="cube",f1.SPHERE="sphere",f1.VECTOR="vector";var Yat=class extends dn{constructor(t=new _p,e,i){super("v4"),this.nodeType="TextureCube",this.value=t,this.radianceNode=new q5(this.value,e??new f1(f1.VECTOR),i),this.irradianceNode=new q5(this.value,new ic(ic.WORLD),new Kt(1).setReadonly(!0))}generate(t,e){return t.isShader("fragment")?(t.require("irradiance"),t.context.bias&&t.context.bias.setTexture(this.value),(t.slot==="irradiance"?this.irradianceNode:this.radianceNode).build(t,e)):(console.warn("TextureCubeNode is not compatible with "+t.shader+" shader."),t.format("vec4( 0.0 )",this.getType(t),e))}},Kat=class extends uc{constructor(t=new WH,e,i){super("v4",{shared:!0}),this.nodeType="CubeTexture",this.value=t,this.uv=e??new f1,this.bias=i}getTexture(t,e){return super.generate(t,e,this.value.uuid,"tc")}generate(t,e){if(e==="samplerCube")return this.getTexture(t,e);let i=this.getTexture(t,e),r=this.uv?.build(t,"v3"),n=this.bias?this.bias.build(t,"f"):void 0;n===void 0&&t.context.bias&&(n=t.context.bias.setTexture(this).build(t,"f"));let s;n?s="texCubeBias( "+i+", "+r+", "+n+" )":s="texCube( "+i+", "+r+" )";let a={include:t.isShader("vertex"),ignoreCache:!0},o=this.getType(t);return t.addContext(a),this.colorSpace=this.colorSpace??new Ud(new Pn("",o)),this.colorSpace.fromDecoding(t.getTextureEncodingFromMap(this.value)),this.colorSpace.input.parse(s),s=this.colorSpace.build(t,o),t.removeContext(),t.format(s,o,e)}},Zat=`
uniform int frameIndex;
uniform vec2 resolution;
uniform mat4 previousModelViewMatrix;
uniform mat4 previousProjectionMatrix;

varying vec4 vCurrentPosition;
varying vec4 vPreviousPosition;
`,Qat=`
layout(location = 1) out vec4 gVelocity;

uniform int frameIndex;
uniform vec2 resolution;

varying vec4 vCurrentPosition;
varying vec4 vPreviousPosition;

const vec2 haltonSequence[16] = vec2[16](
vec2( 0.000000,-0.333334),
vec2(-0.500000, 0.333334),
vec2( 0.500000,-0.777778),
vec2(-0.750000,-0.111112),
vec2( 0.250000, 0.555556),
vec2(-0.250000,-0.555556),
vec2( 0.750000, 0.111112),
vec2(-0.875000, 0.777778),
vec2(0.125000, -0.925926),
vec2(-0.375000, -0.259260),
vec2(0.625000, 0.407408),
vec2(-0.625000, -0.703704),
vec2(0.375000, -0.037038),
vec2(-0.125000, 0.629630),
vec2(0.875000, -0.481482),
vec2(-0.937500, 0.185186));

vec2 vogelDiskSample(int sampleIndex, int sampleCount, float angle) {
  const float goldenAngle = 2.399963f; // radians
  float r = sqrt(float(sampleIndex) + 0.5f) / sqrt(float(sampleCount));
  float theta = float(sampleIndex) * goldenAngle + angle;
  float sine = sin(theta);
  float cosine = cos(theta);
  return vec2(cosine, sine) * r;
}

// Derived from the interleaved gradient function from Jimenez 2014 http:goo.gl/eomGso
float getNoiseInterleavedGradient(vec2 screenPos) {
    vec3 magic = vec3(0.06711056f, 0.00583715f, 52.9829189f);
    return fract(magic.z * fract(dot(screenPos, magic.xy)));
}

`,Jat=`
// TODO: This could be generated CPU side and passed to the shader every frame
const vec2 haltonSequence[16] = vec2[16](
vec2( 0.000000,-0.333334),
vec2(-0.500000, 0.333334),
vec2( 0.500000,-0.777778),
vec2(-0.750000,-0.111112),
vec2( 0.250000, 0.555556),
vec2(-0.250000,-0.555556),
vec2( 0.750000, 0.111112),
vec2(-0.875000, 0.777778),
vec2(0.125000, -0.925926),
vec2(-0.375000, -0.259260),
vec2(0.625000, 0.407408),
vec2(-0.625000, -0.703704),
vec2(0.375000, -0.037038),
vec2(-0.125000, 0.629630),
vec2(0.875000, -0.481482),
vec2(-0.937500, 0.185186));

// TODO: Pass correct view size
vec2 offset = haltonSequence[frameIndex];
offset.x /= resolution.x;
offset.y /= resolution.y;

vec4 currentPosition = gl_Position;
vec4 currentPositionJittered = currentPosition + (vec4(offset.x, offset.y, 0.0, 0.0) * currentPosition.w);

// We want to calculate the velocity with unjittered positions
// so that things that are not moving get a velocity = 0
vCurrentPosition = currentPosition;
vPreviousPosition = previousProjectionMatrix * previousModelViewMatrix * vec4(transformed, 1.0);
#ifdef OUTLINE_COMPENSATION
vPreviousPosition.xy += OUTLINE_COMPENSATION;
#endif
gl_Position = currentPositionJittered;

`,eot=`
vec2 oldPos = vPreviousPosition.xy;
    oldPos /= vPreviousPosition.w;
    oldPos.xy = (oldPos.xy+1.)/2.0;

vec2 newPos = vCurrentPosition.xy;
    newPos /= vCurrentPosition.w;
    newPos.xy = (newPos.xy+1.)/2.0;

vec2 velocity = (newPos - oldPos);

// Discard fully transparent pixels 
if (gl_FragColor.a <= 0.0) discard;

gVelocity = vec4(velocity, 0.0, 1.0);
`,tot=`
layout(location = 1) out vec4 gVelocity;
`,iot=`
    // Discard fully transparent pixels 
    if (gl_FragColor.a <= 0.0) discard;

    gVelocity = vec4(0.0, 0.0, 0.0, 1.0);
`,ite=["x","y","z","w"],rot=["float","vec2","vec3","vec4"],not={float:"f",vec2:"v2",vec3:"v3",vec4:"v4",mat4:"v4",int:"i",bool:"b","float[]":"f[]","vec4[]":"v4[]"},sot={t:"sampler2D",tc:"samplerCube",b:"bool",i:"int",f:"float",c:"vec3",v2:"vec2",v3:"vec3",v4:"vec4",m3:"mat3",m4:"mat4","f[]":"float[]","v4[]":"vec4[]"},xpe=class{constructor(){this.includes={consts:{},functions:{},structs:{}},this.cache="",this.slot="",this.shader="",this.context={},this.needsJitter=!0,this.getIncludesCode=(function(){function t(e,i){return e.deps.length-i.deps.length}return function(e,i){let r=this.getIncludes(e,i);if(!r)return"";let n="";r=r.sort(t);for(let s=0;s<r.length;s++)r[s].src&&(n+=r[s].src+`
`);return n}})(),this.slots=[],this.caches=[],this.contexts=[],this.keywords={},this.nodeData={},this.fragmentVariables={},this.fragmentParsVariables={},this.vertexParsVariables={},this.requires={uv:[],color:[],transparent:!1,irradiance:!1,position:!1,worldPosition:!1,normal:!1,worldNormal:!1,vWorldViewDir:!1,modelMatrix:!1,viewMatrix:!1,projectionMatrix:!1},this.includes={consts:[],functions:[],structs:[]},this.attributes={},this.prefixCode=["#ifdef TEXTURE_LOD_EXT","	#define texCube(a, b) textureCube(a, b)","	#define texCubeBias(a, b, c) textureCubeLodEXT(a, b, c)","	#define tex2D(a, b) texture2D(a, b)","	#define tex2DBias(a, b, c) texture2DLodEXT(a, b, c)","#else","	#define texCube(a, b) textureCube(a, b)","	#define texCubeBias(a, b, c) textureCube(a, b, c)","	#define tex2D(a, b) texture2D(a, b)","	#define tex2DBias(a, b, c) texture2D(a, b, c)","#endif",`
			// NOTE: Include Spline's blending modes. This could be part of BlendNode
			#define SPE_BLENDING_NORMAL 0
			#define SPE_BLENDING_MULTIPLY 1
			#define SPE_BLENDING_SCREEN 2
			#define SPE_BLENDING_OVERLAY 3

			vec3 spe_normalBlend( vec3 a, vec3 b, float alpha ) {
				return mix( a, b, alpha );
			}

			vec3 spe_multiplyBlend( vec3 a, vec3 b, float alpha ) {
				return mix( a, a * b, alpha );
			}

			vec3 spe_screenBlend( vec3 a, vec3 b, float alpha ) {
				vec3 tmp = 1.0 - ( 1.0 - a ) * ( 1.0 - b );
				return mix( a, tmp, alpha );
			}

			vec3 spe_overlayBlend( vec3 a, vec3 b, float alpha ) {
				vec3 tmp = mix( 1. - 2. * (1. - a) * (1. - b), 2. * a * b, step( a, vec3(.5) ) );
				return clamp( mix( a, tmp, alpha ), 0.0, 1.0 );
			}

			vec3 spe_blend( vec3 a, vec3 b, float alpha, int mode ) {
				if ( mode == SPE_BLENDING_NORMAL ) return spe_normalBlend( a, b, alpha );
				else if ( mode == SPE_BLENDING_MULTIPLY ) return spe_multiplyBlend( a, b, alpha );
				else if ( mode == SPE_BLENDING_SCREEN ) return spe_screenBlend( a, b, alpha );
				else if ( mode == SPE_BLENDING_OVERLAY ) return spe_overlayBlend( a, b, alpha );
				return vec3( 1.0 );
			}
			`,"#include <packing>","#include <common>"].join(`
`),this.parsCode={vertex:["float neighbor_offset = 0.0001;",""].join(`
`),fragment:["float accumAlpha = 0.0;",`void accumulateAlpha(float alpha) {
					accumAlpha += (1.0 - accumAlpha) * alpha;
				}`,""].join(`
`)},this.code={vertex:"",fragment:""},this.nodeCode={vertex:"",fragment:""},this.resultCode={vertex:"",fragment:""},this.finalCode={vertex:"",fragment:""},this.inputs={uniforms:{list:[],vertex:[],fragment:[]},arrayUniforms:{list:[],vertex:[],fragment:[]},vars:{varying:[],vertex:[],fragment:[]}},this.defines={},this.uniforms={},this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.updaters=[],this.nodes=[],this.analyzing=!1}build(t,e){this.addVertexParsCode(Zat),this.addFragmentParsCode(Qat),this.buildShader("vertex",t),this.buildShader("fragment",e);for(let i=0;i<this.requires.uv.length;i++)if(this.requires.uv[i]){let r=i>0?i+1:"";this.addVaryCode("varying vec2 vUv"+r+";"),i>0&&this.addVertexParsCode("attribute vec2 uv"+r+";"),this.addVertexFinalCode("vUv"+r+" = uv"+r+";")}return this.requires.color[0]&&(this.addVaryCode("varying vec4 vColor;"),this.addVertexParsCode("attribute vec4 color;"),this.addVertexFinalCode("vColor = color;")),this.requires.color[1]&&(this.addVaryCode("varying vec4 vColor2;"),this.addVertexParsCode("attribute vec4 color2;"),this.addVertexFinalCode("vColor2 = color2;")),this.requires.position&&(this.addVaryCode("varying vec3 vPosition;"),this.addVertexFinalCode("vPosition = transformed;")),this.requires.worldPosition,this.requires.normal&&(this.addVaryCode("varying vec3 vObjectNormal;"),this.addVertexFinalCode(`
				#ifndef SHAPEBLEND 
					vObjectNormal = normal;
				#else
					vObjectNormal = objectNormal;
				#endif
			`)),this.requires.modelMatrix&&this.addFragmentParsCode("uniform mat4 modelMatrix;"),this.requires.viewMatrix&&this.addFragmentParsCode("uniform mat4 viewMatrix;"),this.requires.projectionMatrix&&this.addFragmentParsCode("uniform mat4 projectionMatrix;"),this.requires.worldNormal&&(this.addVaryCode("varying vec3 vWNormal;"),this.addVertexFinalCode("vWNormal = inverseTransformDirection( transformedNormal, viewMatrix ).xyz;")),this.requires.vWorldViewDir&&(this.addVaryCode("varying vec3 vWorldViewDir;"),this.addVertexFinalCode("vWorldViewDir = isPerspectiveMatrix( projectionMatrix ) ?  ( (modelMatrix * vec4(position, 1.0)).xyz - cameraPosition ) : vec3( -viewMatrix[0][2], -viewMatrix[1][2], -viewMatrix[2][2] );")),this.needsJitter&&(this.addVertexFinalCode(Jat),this.addFragmentFinalCode(eot)),this}buildShader(t,e){this.resultCode[t]=e.build(this.setShader(t),"v4")}setMaterial(t,e){return this.defines={},this}addFlow(t,e,i){return this.addSlot(t).addCache(e).addContext(i)}removeFlow(){return this.removeSlot().removeCache().removeContext()}addCache(t){return this.cache=t??"",this.caches.push(this.cache),this}removeCache(){return this.caches.pop(),this.cache=this.caches[this.caches.length-1]||"",this}addContext(t){return this.context=Object.assign({},this.context,t),this.context.extra=this.context.extra||{},this.contexts.push(this.context),this}removeContext(){return this.contexts.pop(),this.context=this.contexts[this.contexts.length-1]||{},this}addSlot(t){return this.slot=t||"",this.slots.push(this.slot),this}removeSlot(){return this.slots.pop(),this.slot=this.slots[this.slots.length-1]||"",this}addFragmentVariable(t,e){this.fragmentVariables[t]===void 0&&(this.addFragmentCode(`${e} ${t};`),this.fragmentVariables[t]="")}addFragmentParsVariable(t,e){this.fragmentParsVariables[t]===void 0&&(this.addFragmentParsCode(`${e} ${t};`),this.fragmentParsVariables[t]="")}addVertexParsVariable(t,e){this.vertexParsVariables[t]===void 0&&(this.addVertexParsCode(`${e} ${t};`),this.vertexParsVariables[t]="")}addVertexCode(t){this.addCode(t,"vertex")}addFragmentCode(t){this.addCode(t,"fragment")}addCode(t,e){this.code[e??this.shader]+=t+`
`}addVertexNodeCode(t){this.addNodeCode(t,"vertex")}addFragmentNodeCode(t){this.addNodeCode(t,"fragment")}addNodeCode(t,e){this.nodeCode[e??this.shader]+=t+`
`}clearNodeCode(t){t=t??this.shader;let e=this.nodeCode[t];return this.nodeCode[t]="",e}clearVertexNodeCode(){return this.clearNodeCode("vertex")}clearFragmentNodeCode(){return this.clearNodeCode("fragment")}addVertexFinalCode(t){this.addFinalCode(t,"vertex")}addFragmentFinalCode(t){this.addFinalCode(t,"fragment")}addFinalCode(t,e){this.finalCode[e??this.shader]+=t+`
`}addVertexParsCode(t){this.addParsCode(t,"vertex")}addFragmentParsCode(t){this.addParsCode(t,"fragment")}addParsCode(t,e){this.parsCode[e??this.shader]+=t+`
`}addVaryCode(t){this.addVertexParsCode(t),this.addFragmentParsCode(t)}isCache(t){return this.caches.indexOf(t)!==-1}isSlot(t){return this.slots.indexOf(t)!==-1}define(t,e){this.defines[t]=e===void 0?1:e}require(t){this.requires[t]=!0}isDefined(t){return this.defines[t]!==void 0}getVar(t,e,i,r="varying",n="V",s=""){let a=this.getVars(r),o=a[t];if(!o){let l=a.length;o={name:i||"node"+n+l+(s?"_"+s:""),type:e},a.push(o),a[t]=o}return o}getTempVar(t,e,i,r){return this.getVar(t,e,i,this.shader,"T",r)}getAttribute(t,e){if(!this.attributes[t]){let i=this.getVar(t,e);this.addVertexParsCode("attribute "+e+" "+t+";"),this.addVertexFinalCode(i.name+" = "+t+";"),this.attributes[t]={varying:i,name:t,type:e}}return this.attributes[t]}getCode(t){return[this.prefixCode,this.parsCode[t],this.getVarListCode(this.getVars("varying"),"varying"),this.getVarListCode(this.inputs.uniforms[t],"uniform"),this.getVarListCode(this.inputs.arrayUniforms[t],"uniform"),this.getIncludesCode("consts",t),this.getIncludesCode("structs",t),this.getIncludesCode("functions",t),"void main() {",this.getVarListCode(this.getVars(t)),this.code[t],this.resultCode[t],this.finalCode[t],"}"].join(`
`)}getVarListCode(t,e){e=e??"";let i="";for(let r=0,n=t.length;r<n;++r){let s=t[r],a=s.type,o=s.name,l=s.size,c=this.getFormatByType(a);if(c===void 0)throw new Error("Node pars "+c+" not found.");c.includes("[]")?i+=e+" "+c.substring(0,c.length-2)+" "+o+`[${l}];
`:i+=e+" "+c+" "+o+`;
`}return i}getVars(t){return this.inputs.vars[t??this.shader]}getNodeData(t){let e=t instanceof da?t.uuid:t;return this.nodeData[e]=this.nodeData[e]||{}}createUniform(t,e,i,r,n,s){if(e.includes("[]")){let a=this.inputs.arrayUniforms,o=a.list.length,l=new Jee({type:e,size:i.size,name:r||"nodeUA"+o+(s?"_"+s:""),node:i,needsUpdate:n});return a.list.push(l),a[t].push(l),a[t][l.name]=l,this.uniforms[l.name]=l,l}else{let a=this.inputs.uniforms,o=a.list.length,l=new Jee({type:e,name:r||"nodeU"+o+(s?"_"+s:""),node:i,needsUpdate:n});return a.list.push(l),a[t].push(l),a[t][l.name]=l,this.uniforms[l.name]=l,l}}createVertexUniform(t,e,i,r,n){return this.createUniform("vertex",t,e,i,r,n)}createFragmentUniform(t,e,i,r,n){return this.createUniform("fragment",t,e,i,r,n)}include(t,e,i){let r;if(t=typeof t=="string"?Ql.get(t):t,this.context.include===!1)return t.name;t instanceof jt?r=this.includes.functions:t instanceof qr?r=this.includes.consts:t instanceof vpe&&(r=this.includes.structs);let n=r[this.shader]=r[this.shader]||[];if(t){let s=n[t.name];if(s||(s=n[t.name]={node:t,deps:[]},n.push(s),s.src=t.build(this,"source")),t instanceof jt&&e&&n[e.name]&&n[e.name].deps.indexOf(t)===-1&&(n[e.name].deps.push(t),t.includes?.length)){let a=0;do this.include(t.includes[a++],e);while(a<t.includes.length)}return i&&(s.src=i),t.name}else throw new Error("Include not found.")}colorToVectorProperties(t){return t.replace("r","x").replace("g","y").replace("b","z").replace("a","w")}colorToVector(t){return t.replace(/c/g,"v3")}getIncludes(t,e){return this.includes[t][e||this.shader]}getConstructorFromLength(t){return rot[t-1]}isTypeMatrix(t){return/^m/.test(t)}getTypeLength(t){return t==="f"?1:parseInt(this.colorToVector(t).substr(1))}getTypeFromLength(t){return t===1?"f":"v"+t}findNode(...t){for(let e=0;e<arguments.length;e++){let i=t[e];if(i?.isNode)return i}}resolve(...t){for(let e=0;e<arguments.length;e++){let i=t[e];if(i!==void 0){if(i.isNode)return i;if(i.isTexture)switch(i.mapping){case L0:case k0:return new Kat(i);case DT:return new Yat(new _p(i));default:return new _p(i)}else{if(i.isVector2)return new mo(i);if(i.isVector3)return new lu(i);if(i.isVector4)return new pp(i)}}}}format(t,e,i){switch(this.colorToVector(i+" <- "+e)){case"f <- v2":return t+".x";case"f <- v3":return t+".x";case"f <- v4":return t+".x";case"f <- i":case"f <- b":return"float( "+t+" )";case"v2 <- f":return"vec2( "+t+" )";case"v2 <- v3":return t+".xy";case"v2 <- v4":return t+".xy";case"v2 <- i":case"v2 <- b":return"vec2( float( "+t+" ) )";case"v3 <- f":return"vec3( "+t+" )";case"v3 <- v2":return"vec3( "+t+", 0.0 )";case"v3 <- v4":return t+".xyz";case"v3 <- i":case"v3 <- b":return"vec2( float( "+t+" ) )";case"v4 <- f":return"vec4( "+t+" )";case"v4 <- v2":return"vec4( "+t+", 0.0, 1.0 )";case"v4 <- v3":return"vec4( "+t+", 1.0 )";case"v4 <- i":case"v4 <- b":return"vec4( float( "+t+" ) )";case"i <- f":case"i <- b":return"int( "+t+" )";case"i <- v2":return"int( "+t+".x )";case"i <- v3":return"int( "+t+".x )";case"i <- v4":return"int( "+t+".x )";case"b <- f":return"( "+t+" != 0.0 )";case"b <- v2":return"( "+t+" != vec2( 0.0 ) )";case"b <- v3":return"( "+t+" != vec3( 0.0 ) )";case"b <- v4":return"( "+t+" != vec4( 0.0 ) )";case"b <- i":return"( "+t+" != 0 )"}return t}getTypeByFormat(t){return not[t]||t}getFormatByType(t){return sot[t]||t}getUUID(t,e){return e=e!==void 0?e:!0,e&&this.cache&&(t=this.cache+"-"+t),t}getElementByIndex(t){return ite[t]}getIndexByElement(t){return ite.indexOf(t)}isShader(t){return this.shader===t}setShader(t){return this.shader=t,this}mergeDefines(t){for(let e in t)this.defines[e]=t[e];return this.defines}mergeUniform(t){for(let e in t)this.uniforms[e]=t[e];return this.uniforms}getTextureEncodingFromMap(t){let e;return t?t.isTexture&&(e=t.encoding):e=Dh,e===Dh&&this.context.gamma&&(e=er),e}},os=class extends uc{constructor(t=0,e,i,r){super("c"),this.nodeType="Color",this.value=t instanceof Ya?t:new Ya(t||0,e,i,r)}setRGBA(t){this.value.setRGBA(t.r,t.g,t.b,t.a)}generate(t,e,i,r,n,s){i=t.getUUID(i??this.getUUID()),r=r??this.getType(t);let a=t.getNodeData(i),o=this.getReadonly()&&this.generateReadonly!==void 0;if(this.alpha){let l=this.alpha.build(t,"f");t.addFragmentNodeCode(`accumAlpha += ( 1.0 - accumAlpha ) * ${l};`)}return o?this.generateReadonly(t,e,i,r,n,s):t.isShader("vertex")?(a.vertex||(a.vertex=t.createVertexUniform(r,this,n,s,this.getLabel())),t.format(a.vertex.name,r,e)):(a.fragment||(a.fragment=t.createFragmentUniform(r,this,n,s,this.getLabel())),t.format(a.fragment.name,r,e))}generateReadonly(t,e,i,r,n,s){return t.format("vec3("+this.value.r+", "+this.value.g+", "+this.value.b+")",r,e)}},vn=class extends uc{constructor(t){super("i"),this.nodeType="Int",this.value=Math.floor(t??0)}generateReadonly(t,e,i,r,n,s){return t.format(this.value.toString(),r,e)}},ml=class extends uc{constructor(t){super("b"),this.nodeType="Bool",this.value=t??!1}generateReadonly(t,e,i,r){return t.format(this.value?"true":"false",r,e)}},By=class extends uc{constructor(t=1,e){super("f[]"),this.nodeType="FloatArray",this.size=t,this.value=Array.isArray(e)?e:typeof e=="number"?new Array(t).fill(e):new Array(t).fill(0)}},a8=class extends uc{},aot=class extends a8{constructor(t){super("v3"),this.image=t,this._value=new W}get value(){return this._value.x=this.image.isVideo?this.image.img.videoWidth??0:this.image.img.width,this._value.y=this.image.isVideo?this.image.img.videoHeight??0:this.image.img.height,this._value}},X5=class extends a8{constructor(t,e,i=1008,r=1006){super("t"),this.image=t,this.wrap=e,this.minFilter=i,this.magFilter=r}get value(){return this.image.getTexture(this.wrap,this.minFilter,this.magFilter)}},bpe=class extends uc{constructor(t){super("m3"),this.nodeType="Matrix3",this.value=t??new Vs}generateReadonly(t,e,i,r,n,s){return t.format("mat3("+this.value.elements.join(", ")+")",r,e)}get elements(){return this.value.elements}set elements(t){this.value.fromArray(t)}},nf=class extends uc{constructor(t){super("m4"),this.nodeType="Matrix4",this.value=t??new St}generateReadonly(t,e,i,r,n,s){return t.format("mat4("+this.value.elements.join(", ")+")",r,e)}get elements(){return this.value.elements}set elements(t){this.value.fromArray(t)}};function rte(t,e,i,r=0){t.setUvTransform(i[0],i[1],e[0],e[1],0,0,0).premultiply(new Vs().makeRotation(r*Ht.DEG2RAD))}var oot=class extends bpe{constructor(t,e,i=0){super(new Vs),this.repeat=t,this.offset=e,this.rotation=i,rte(this.value,t,e,i)}updateMatrix(){rte(this.value,this.repeat,this.offset,this.rotation)}},Fy=class extends uc{constructor(t=1,e){super("v4[]"),this.nodeType="Vector4Array",this.size=t,this.value=Array.isArray(e)?e:e instanceof Ui?new Array(t).fill(e):new Array(t).fill(new Ui(0))}},nte=class extends dn{constructor(t,e,i,r){super("v3"),this.nodeType="Blend",this.a=t,this.b=e,this.alpha=i,this.mode=r}generate(t,e){if(t.isShader("fragment")){let i=[];return i.push(this.a.build(t,"c")),i.push(this.b.build(t,"c")),i.push(this.alpha.build(t,"f")),i.push(this.mode.build(t,"i")),t.format("spe_blend("+i.join(",")+")",this.getType(t),e)}else return console.warn("BlendNode is not compatible with "+t.shader+" shader."),t.format("vec3( 0.0 )",this.getType(t),e)}},wpe=class extends dn{constructor(t,e){super("v3"),this.nodeType="CustomColor",this.color=t,this.alpha=e,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(t,e){if(t.isShader("fragment")){let i=t.include(wpe.Nodes.customColor);t.addFragmentVariable(this.calpha,"float");let r=[];return r.push(this.color.build(t,"v3")),r.push(this.mask?`luminance(${this.mask.build(t,"v3")})`:"1.0"),r.push(this.alpha.build(t,"f")),r.push(this.calpha),t.format(i+"("+r.join(",")+")",this.getType(t),e)}else return console.warn("CustomColorNode is not compatible with "+t.shader+" shader."),t.format("vec3( 0.0 )",this.getType(t),e)}},$5=wpe;$5.Nodes=(function(){return{customColor:new jt(`vec3 customColor(vec3 color, float mask, float alpha, out float calpha) {
				float lalpha = alpha * mask;
				calpha =  lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0);
				accumAlpha += (1.0 - accumAlpha) * lalpha;

				return color;
			}`)}})();var _pe=class extends dn{constructor(t,e){super("v3"),this.nodeType="CustomNormal",this.cnormal=t,this.alpha=e,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(t,e){if(t.isShader("fragment")){let i=t.include(_pe.Nodes.customNormal);t.addFragmentVariable(this.calpha,"float");let r=[];return r.push(this.cnormal.build(t,"v3")),r.push("normal"),r.push(this.mask?`luminance(${this.mask.flow(t,"v3").result})`:"1.0"),r.push(this.alpha.build(t,"f")),r.push(this.calpha),t.format(i+"("+r.join(",")+")",this.getType(t),e)}else return console.warn("CustomNormalNode is not compatible with "+t.shader+" shader."),t.format("vec3( 0.0 )",this.getType(t),e)}},Spe=_pe;Spe.Nodes=(function(){return{customNormal:new jt(`vec3 customNormal(vec3 cnormal, vec3 norm, float mask, float alpha, out float calpha) {
				vec3 normal = packNormalToRGB( norm ).rgb;
				normal *= step( vec3(0.5), cnormal );

				float lalpha = alpha * mask;
				calpha =  lalpha / clamp( lalpha + accumAlpha, 0.00001, 1.0 );
				accumAlpha += ( 1.0 - accumAlpha ) * lalpha;

				return normal;
			}`)}})();var ZE=class extends dn{constructor(t,e,i,r,n,s,a,o,l,c,u,h){super("v3"),this.nodeType="CustomTexture",this.texture=t,this.textureSize=e,this.crop=i,this.projection=r,this.axis=n,this.side=s,this.size=a,this.blending=o,this.mat=l,this.isMask=h,this.alpha=c,this.mode=u,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(t,e){t.require("position"),t.require("normal"),t.require("uv"),t.requires.uv=[!0],t.extensions.shaderTextureLOD=!0,t.extensions.derivatives=!0;let i=`g${this.uuid.toString().replace(/-/g,"")}`,r;switch(this.projection.value){case 3:r=t.include(ZE.Nodes.cylindrical);break;case 2:r=t.include(ZE.Nodes.spherical);break;case 1:let s=["vec3(1.0, 0.0, 0.0)","vec3(0.0, 1.0, 0.0)","vec3(0.0, 0.0, 1.0)"][this.axis.value],a=["zy","xz","xy"][this.axis.value],o=new jt(`
		vec3 ${i}_planarTexture(vec3 normal, sampler2D tex, vec2 textureSize, float crop, mat3 mat, vec2 size, float blending, bool isMask, float mask, float alpha, int mode, out float calpha, out vec2 writeUv) {
				vec2 projected = (1. + (position.${a})) / 2.;
				vec2 uvs = ( mat * vec3( (projected * 2. - 1.) / (size * .5), 1. ) / 2. + 0.5 ).xy;
				writeUv = uvs;

				vec4 tmp = texture2D( tex, uvs );

				vec3 col = tmp.rgb;
				float lalpha = alpha * tmp.a;
				${this.side.value===2?"":`lalpha *= step(0.0, ${this.side.value===1?"-1.0 * ":""}dot(vObjectNormal, ${s}));`}

				if ( crop > 0.5 ) {
					if ( uvs.x < 0.0 || uvs.x > 1.0 || uvs.y < 0.0 || uvs.y > 1.0 )  {
						lalpha = 0.0;
					}
				}
				
				lalpha *= mask;

				calpha =  lalpha / clamp( lalpha + accumAlpha, 0.00001, 1.0 );
				accumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));

				return col;
			}`);r=t.include(o);break;case 4:r=t.include(ZE.Nodes.triplanar);break;default:r=t.include(ZE.Nodes.uv);break}t.addFragmentVariable(this.calpha,"float");let n=[];if(n.push("normal"),n.push(this.texture.generate(t,"t")),n.push(this.textureSize.build(t,"v2")),n.push(this.crop.build(t,"f")),n.push(this.mat.build(t,"mat3")),n.push(this.size.build(t,"v2")),n.push(this.blending.build(t,"f")),n.push(this.isMask.build(t,"b")),n.push(this.mask?`luminance(${this.mask.flow(t,"v3").result})`:"1.0"),n.push(this.alpha.build(t,"f")),n.push(this.mode.build(t,"i")),n.push(this.calpha),this.projection.value===4){let s=`${i}_writeUvs`,a=s+"0",o=s+"1",l=s+"2",c=`${i}_triplanarWeights`;t.addFragmentVariable(a,"vec2"),t.addFragmentVariable(o,"vec2"),t.addFragmentVariable(l,"vec2"),t.addFragmentVariable(c,"vec3"),n.push(a),n.push(o),n.push(l),n.push(c)}else{let s=`${i}_writeUvs`;t.addFragmentVariable(s,"vec2"),n.push(s)}return t.format(r+"("+n.join(",")+")",this.getType(t),e)}},o8=ZE;o8.Nodes=(function(){let t=new jt(`
vec3 cylindricalTexture(vec3 normal, sampler2D tex, vec2 textureSize, float crop, mat3 mat, vec2 size, float blending, bool isMask, float mask, float alpha, int mode, out float calpha, out vec2 writeUv) {
                vec3 posN = normalize(position);
                float u = 0.5 + atan(posN.z, posN.x) / (2.*3.1415);
                float scaledHeight = position.y / (size.y * 0.5);
                float v =  (scaledHeight / 2.) + .5;

                vec2 calculatedUv = vec2(u,v);
				vec2 uvs = ( mat * vec3( calculatedUv * 2. - 1., 1. ) / 2. + 0.5 ).xy;
				writeUv = uvs;

                vec2 df = fwidth(uvs);
               	if(df.x > 0.5) df.x = 0.;

				#ifdef GL_EXT_shader_texture_lod
                vec4 tmp = texture2DLodEXT(tex, uvs, log2(max(df.x, df.y)*min(textureSize.x, textureSize.y)));
				#else
                vec4 tmp = textureLod(tex, uvs, log2(max(df.x, df.y)*min(textureSize.x, textureSize.y)));
				#endif

				vec3 col = tmp.rgb;
				float lalpha = alpha * tmp.a;
				if ( crop > 0.5 ) {
					if ( uvs.x < 0.0 || uvs.x > 1.0 || uvs.y < 0.0 || uvs.y > 1.0 )  {
						lalpha = 0.0;
					}
				}

				lalpha *= mask;
				
				calpha =  lalpha / clamp( lalpha + accumAlpha, 0.00001, 1.0 );
				accumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));

				return col;
			}
`),e=new jt(`
vec3 sphericalTexture(vec3 normal, sampler2D tex, vec2 textureSize, float crop, mat3 mat, vec2 size, float blending, bool isMask, float mask, float alpha, int mode, out float calpha, out vec2 writeUv) {
                vec3 posN = normalize(vPosition);
                float u = 0.5 + atan(posN.z, posN.x) / (2.*3.1415);
                float v = 0.5 + asin(posN.y) / 3.1415;

                vec2 calculatedUv = vec2(u,v);
				vec2 uvs = ( mat * vec3( calculatedUv * 2. - 1., 1. ) / 2. + 0.5 ).xy;
				writeUv = uvs;

                vec2 df = fwidth(uvs);
               	if(df.x > 0.5) df.x = 0.;
				#ifdef GL_EXT_shader_texture_lod
                vec4 tmp = texture2DLodEXT(tex, uvs, log2(max(df.x, df.y)*min(textureSize.x, textureSize.y)));
				#else
                vec4 tmp = textureLod(tex, uvs, log2(max(df.x, df.y)*min(textureSize.x, textureSize.y)));
				#endif

				vec3 col = tmp.rgb;
				float lalpha = alpha * tmp.a;
				if ( crop > 0.5 ) {
					if ( uvs.x < 0.0 || uvs.x > 1.0 || uvs.y < 0.0 || uvs.y > 1.0 )  {
						lalpha = 0.0;
					}
				}

				lalpha *= mask;

				calpha =  lalpha / clamp( lalpha + accumAlpha, 0.00001, 1.0 );
				accumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));

				return col;
			}
`),i=new jt(`vec3 uvTexture(vec3 normal, sampler2D tex, vec2 textureSize, float crop, mat3 mat, vec2 size, float blending, bool isMask, float mask, float alpha, int mode, out float calpha, out vec2 writeUv) {
				vec2 uvs = ( mat * vec3( vUv * 2. - 1., 1. ) / 2. + 0.5 ).xy;
				writeUv = uvs;

				vec4 tmp = texture2D( tex, uvs );

				vec3 col = tmp.rgb;

				float lalpha = alpha * tmp.a;
				if ( crop > 0.5 ) {
					if ( uvs.x < 0.0 || uvs.x > 1.0 || uvs.y < 0.0 || uvs.y > 1.0 )  {
						lalpha = 0.0;
					}
				}
				
				lalpha *= mask;

				calpha =  lalpha / clamp( lalpha + accumAlpha, 0.00001, 1.0 );
				accumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));

				return col;
			}`),r=new jt(`vec3 triplanarTexture(vec3 normal, sampler2D tex, vec2 textureSize, float crop, mat3 mat, vec2 size, float blending, bool isMask, float mask, float alpha, int mode, out float calpha, out vec2 writeUvs0, out vec2 writeUvs1, out vec2 writeUvs2, out vec3 writeWeights) {
				vec3 p = position;
				vec2 uv0 = (1.0 + p.xy) / 2.0;     
				vec2 uv1 = (1.0 + p.zy) / 2.0;		
				vec2 uv2 = (1.0 + p.xz) / 2.0;		
	
				uv0 = (mat * vec3((uv0 * 2.0 - 1.0) / (size * 0.5), 1.0) / 2.0 + 0.5).xy;
				uv1 = (mat * vec3((uv1 * 2.0 - 1.0) / (size * 0.5), 1.0) / 2.0 + 0.5).xy;
				uv2 = (mat * vec3((uv2 * 2.0 - 1.0) / (size * 0.5), 1.0) / 2.0 + 0.5).xy;

				// Range from 3 to 128 seems to be good
				float exponent = (1.0 - blending) * 125.0 + 3.0;

				vec3 n = vObjectNormal;
				vec3 weights = abs(normalize(n));
				weights = pow(weights, vec3(exponent));
				weights /= dot(weights, vec3(1.0));

				// Write out all sets of UVs that we generated
				writeUvs0 = uv0;
				writeUvs1 = uv1;
				writeUvs2 = uv2;
				writeWeights = weights;

				// Derivatives for LOD
				vec2 df0 = fwidth(uv0);
				vec2 df1 = fwidth(uv1);
				vec2 df2 = fwidth(uv2);
				if (df0.x > 0.5) df0.x = 0.0;
				if (df1.x > 0.5) df1.x = 0.0;
				if (df2.x > 0.5) df2.x = 0.0;

				#ifdef GL_EXT_shader_texture_lod
                	vec4 tmp = 
						texture2DLodEXT(tex, uv0, log2(max(df0.x, df0.y)*min(textureSize.x, textureSize.y))) * weights.z + 
						texture2DLodEXT(tex, uv1, log2(max(df1.x, df1.y)*min(textureSize.x, textureSize.y))) * weights.x + 
						texture2DLodEXT(tex, uv2, log2(max(df2.x, df2.y)*min(textureSize.x, textureSize.y))) * weights.y;
				#else
                	vec4 tmp = 
						textureLod(tex, uv0, log2(max(df0.x, df0.y)*min(textureSize.x, textureSize.y))) * weights.z + 
						textureLod(tex, uv1, log2(max(df1.x, df1.y)*min(textureSize.x, textureSize.y))) * weights.x + 
						textureLod(tex, uv2, log2(max(df2.x, df2.y)*min(textureSize.x, textureSize.y))) * weights.y;
				#endif

				vec3 col = tmp.rgb;
				float lalpha = alpha * tmp.a;

				// Apply cropping across all 3 planes
				if ( crop > 0.5 ) {
					if ( uv0.x < 0.0 || uv0.x > 1.0 || uv0.y < 0.0 || uv0.y > 1.0 )  {
						lalpha = 0.0;
					}
					if ( uv1.x < 0.0 || uv1.x > 1.0 || uv1.y < 0.0 || uv1.y > 1.0 )  {
						lalpha = 0.0;
					}
					if ( uv2.x < 0.0 || uv2.x > 1.0 || uv2.y < 0.0 || uv2.y > 1.0 )  {
						lalpha = 0.0;
					}
				}

				lalpha *= mask;
				calpha =  lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0);
				accumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));

				return col;//n * 0.5 + 0.5;
			}			
			`);return{cylindrical:t,spherical:e,uv:i,triplanar:r}})();var QE=class extends dn{constructor(t,e,i,r,n,s,a,o,l,c,u,h){super("v3"),this.nodeType="Depth",this.gradientType=t,this.smooth=e,this.near=i,this.far=r,this.isVector=n,this.isWorldSpace=s,this.origin=a,this.direction=o,this.colors=l,this.steps=c,this.isMask=h,this.alpha=u,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(t,e){let i=`g${this.uuid.toString().replace(/-/g,"")}`,r=new jt(`vec3 ${i}_sdepth(float near, float far, vec3 origin, vec3 direction, vec4 colors[${i}_MAX_COLORS], float steps[${i}_MAX_COLORS], bool isMask, float mask, float alpha, out float calpha) {
               vec4 color = colors[0];
               #ifdef ${i}_IS_VECTOR
                   #ifdef ${i}_LINEAR
                       #ifdef ${i}_WORLDSPACE
                       float depth = vectorLinearWorldSpaceDepth(direction, origin, near, far);
                       #else
                       float depth = vectorLinearObjectSpaceDepth(direction, origin, near, far);
                       #endif
                   #else
                       #ifdef ${i}_WORLDSPACE
                           float depth = vectorSphericalWorldSpaceDepth(origin, near, far);
                       #else
                           float depth = vectorSphericalObjectSpaceDepth(origin, near, far);
                       #endif
                   #endif
               #else
                   float dist = length(vWPosition - cameraPosition);
			       float depth = ( dist - near ) / ( far - near );
               #endif


              float p;
              #ifdef ${i}_SMOOTH
				for ( int i = 1; i < ${i}_MAX_COLORS; i++ ) {
						p = clamp( ( depth - steps[i-1] ) / ( steps[i] - steps[i-1] ), 0.0, 1.0 );
						color = mix(color, colors[i], smoothstep(0.0, 1.0, p));
					}
              #else
                for ( int i = 1; i < ${i}_MAX_COLORS; i++ ) {
                   p = clamp(( depth - steps[i - 1] ) / ( steps[i] - steps[i - 1] ), 0.0, 1.0);
                   color = mix(color, colors[i], p);
                 }
              #endif

               float lalpha = alpha * color.a * mask;
               calpha = mix(lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0), lalpha, float(isMask));
			   accumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));
			   
               return color.rgb;
			}`,[QE.Nodes.vectorLinearWorldSpaceDepth,QE.Nodes.vectorLinearObjectSpaceDepth,QE.Nodes.vectorSphericalObjectSpaceDepth,QE.Nodes.vectorSphericalWorldSpaceDepth]);if(t.isShader("fragment")){t.define(`${i}_MAX_COLORS`,this.colors.value.length),this.smooth.value&&t.define(`${i}_SMOOTH`),this.isVector.value>.5&&t.define(`${i}_IS_VECTOR`),this.gradientType.value===0&&t.define(`${i}_LINEAR`),this.isWorldSpace.value>.5&&t.define(`${i}_WORLDSPACE`),t.require("worldPosition"),t.addFragmentVariable(this.calpha,"float");let n=t.include(r),s=[];return s.push(this.near.build(t,"f")),s.push(this.far.build(t,"f")),s.push(this.origin.build(t,"v3")),s.push(this.direction.build(t,"v3")),s.push(this.colors.build(t,"v4[]")),s.push(this.steps.build(t,"f[]")),s.push(this.isMask.build(t,"b")),s.push(this.mask?`luminance(${this.mask.flow(t,"v3").result})`:"1.0"),s.push(this.alpha.build(t,"f")),s.push(this.calpha),t.format(n+"("+s.join(",")+")",this.getType(t),e)}else return console.warn("DepthNode is not compatible with "+t.shader+" shader."),t.format("vec3( 0.0 )",this.getType(t),e)}},Epe=QE;Epe.Nodes=(function(){let t=new jt(`float vectorLinearWorldSpaceDepth(vec3 direction, vec3 origin, float near, float far) {
               vec3 n = normalize(direction);
               float dist = (n.x*(vWPosition.x - origin.x) + n.y*(vWPosition.y - origin.y) + n.z*(vWPosition.z - origin.z));
               return ( dist - near ) / ( far - near );
            }`),e=new jt(`float vectorLinearObjectSpaceDepth(vec3 direction, vec3 origin, float near, float far) {
               vec3 n = normalize(direction);
               float dist = (n.x*(position.x - origin.x) + n.y*(position.y - origin.y) + n.z*(position.z - origin.z));
               return ( dist - near ) / ( far - near );
            }`),i=new jt(`float vectorSphericalWorldSpaceDepth(vec3 origin, float near, float far) {
               float dist = length(vWPosition - origin);
               return ( dist - near ) / ( far - near );
            }`),r=new jt(`float vectorSphericalObjectSpaceDepth(vec3 origin, float near, float far) {
               float dist = length(position - origin);
               return ( dist - near ) / ( far - near );
            }`);return{vectorLinearWorldSpaceDepth:t,vectorLinearObjectSpaceDepth:e,vectorSphericalWorldSpaceDepth:i,vectorSphericalObjectSpaceDepth:r}})();var lot=class extends dn{constructor(t,e,i,r,n,s,a,o){super("v3"),this.nodeType="Fresnel",this.color=t,this.bias=e,this.scale=i,this.intensity=r,this.factor=n,this.isMask=o,this.alpha=s,this.mode=a,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(t,e){if(t.require("vWorldViewDir"),t.require("worldNormal"),t.isShader("fragment")){t.addFragmentVariable(this.calpha,"float");let i=new jt(`vec3 fresnel(vec3 color, float bias, float scale, float intensity, float factor, bool isMask, float mask, float alpha, int mode, out float calpha) {
					float fresnel = bias + scale * pow( abs( factor + dot( normalize( vWorldViewDir ), normalize( vWNormal ) ) ), intensity );

					float lalpha = clamp(fresnel, 0.0, 1.0) * alpha * mask;
					calpha = mix(lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0), lalpha, float(isMask));
					accumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));

					return color;
				}`),r=t.include(i),n=[];return n.push(this.color.build(t,"c")),n.push(this.bias.build(t,"f")),n.push(this.scale.build(t,"f")),n.push(this.intensity.build(t,"f")),n.push(this.factor.build(t,"f")),n.push(this.isMask.build(t,"b")),n.push(this.mask?`luminance(${this.mask.flow(t,"v3").result})`:"1.0"),n.push(this.alpha.build(t,"f")),n.push(this.mode.build(t,"i")),n.push(this.calpha),t.format(r+"("+n.join(",")+")",this.getType(t),e)}else return console.warn("FresnelNode is not compatible with "+t.shader+" shader."),t.format("vec3( 0.0 )",this.getType(t),e)}},Ape=class extends dn{constructor(t,e,i,r,n,s,a,o,l){super("v3"),this.nodeType="Gradient",this.gradientType=t,this.smooth=e,this.colors=i,this.steps=r,this.offset=n,this.morph=s,this.angle=a,this.isMask=l,this.alpha=o,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(t,e){if(t.isShader("fragment")){t.define("GRAD_MAX",10),t.require("uv"),t.requires.uv=[!0],t.addFragmentVariable(this.calpha,"float");let i=t.include(Ape.Nodes.gradient),r=[];return r.push(this.gradientType.build(t,"i")),r.push(this.smooth.build(t,"b")),r.push(this.colors.build(t,"v4[]")),r.push(this.steps.build(t,"f[]")),r.push(this.offset.build(t,"v2")),r.push(this.morph.build(t,"v2")),r.push(this.angle.build(t,"f")),r.push(this.isMask.build(t,"b")),r.push(this.mask?`luminance(${this.mask.flow(t,"v3").result})`:"1.0"),r.push(this.alpha.build(t,"f")),r.push(this.calpha),t.format(i+"("+r.join(",")+")",this.getType(t),e)}else return console.warn("GradientNode is not compatible with "+t.shader+" shader."),t.format("vec3( 0.0 )",this.getType(t),e)}},Mpe=Ape;Mpe.Nodes=(function(){return{gradient:new jt(`vec3 gradient(int gradientType, bool smoothed, vec4 colors[GRAD_MAX], float steps[GRAD_MAX], vec2 offset, vec2 morph, float angle, bool isMask, float mask, float alpha, out float calpha) {
				vec4 color = colors[0];
				vec2 m = morph / vUv.xy;
				vec2 rot = vec2( 0.5 + m.x, m.y );
				vec2 dt = vec2(
					cos( angle ) * rot.x - sin( angle ) * rot.y,
					sin( angle ) * rot.x + cos( angle ) * rot.y
				);
				vec2 pt = ( vUv - 0.5 + offset ) / 2.0 + dt / 2.0;
				float t = dot( pt, dt ) / dot( dt, dt );
				if ( gradientType == 1 ) {
					t = distance (
						( vUv + morph ) * 3.0,
						( vUv + offset ) + 1.0
					) + angle;
				} else if ( gradientType == 2 ) {
					float polar = atan(
						vUv.x + morph.x - 0.5 + offset.x,
						vUv.y + morph.y - 0.5 + offset.y
					) * -1.0;
					t = fract( ( angle / PI / -2.0 ) + 0.5 * ( polar / PI ) );
				}

				float p;
				if (smoothed) {
					for ( int i = 1; i < GRAD_MAX; i++ ) {
						p = clamp( ( t - steps[i-1] ) / ( steps[i] - steps[i-1] ), 0.0, 1.0 );
						color = mix(color, colors[i], smoothstep(0.0, 1.0, p));
					}

				} else {
					for ( int i = 1; i < GRAD_MAX; i++ ) {
						p = clamp( ( t - steps[i-1] ) / ( steps[i] - steps[i-1] ), 0.0, 1.0 );
						color = mix(color, colors[i], p);
					}
				}

				float lalpha = alpha * color.a * mask;
				calpha = mix(lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0), lalpha, float(isMask));
				accumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));
				
				return color.xyz;
			}`)}})();var Tpe=class extends dn{constructor(t,e,i,r,n){super("v3"),this.nodeType="Matcap",this.texture=t,this.isMask=r,this.alpha=e,this.mode=i,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`,this.rotation=n}generate(t,e){if(t.isShader("fragment")){t.addFragmentVariable(this.calpha,"float");let i=t.include(Tpe.Nodes.matcap);t.require("normal"),t.requires.normal=!0;let r=[];return r.push(this.texture.generate(t,"t")),r.push("normal"),r.push(this.isMask.build(t,"b")),r.push(this.mask?`luminance(${this.mask.flow(t,"v3").result})`:"1.0"),r.push(this.alpha.build(t,"f")),r.push(this.mode.build(t,"i")),r.push(this.calpha),r.push(this.rotation.build(t,"f")),t.format(i+"("+r.join(",")+")",this.getType(t),e)}else return console.warn("MatcapNode is not compatible with "+t.shader+" shader."),t.format("vec3( 0.0 )",this.getType(t),e)}},Cpe=Tpe;Cpe.Nodes=(function(){return{matcap:new jt(`vec3 matcap(sampler2D matcapTex, vec3 normal, bool isMask, float mask, float alpha, int mode, out float calpha, float rotation) {
					vec3 viewDir = normalize( vViewPosition );
					vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );
					vec3 y = cross( viewDir, x );
					vec2 uv = vec2( dot( x, normal ), dot( y, normal ) );
					uv = mat2( cos(rotation), sin(rotation), -sin(rotation), cos(rotation) ) * uv;
					uv = uv * 0.495 + 0.5;
					vec4 matcapColor = texture2D( matcapTex, uv );

					float lalpha = alpha * mask;
					calpha = mix(lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0), lalpha, float(isMask));
					accumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));
					
					return matcapColor.rgb;
            	}`)}})();var Yl=(function(){let t=new jt(`vec3 random3(vec3 c) {
			float j = 4096.0*sin(dot(c,vec3(17.0, 59.4, 15.0)));
			vec3 r;
			r.z = fract(512.0*j);
			j *= .125;
			r.x = fract(512.0*j);
			j *= .125;
			r.y = fract(512.0*j);
			return r-0.5;
		}`),e=new jt(`float simplexFast(vec3 p) {
			 vec3 s = floor(p + dot(p, vec3(F3)));
			 mediump vec3 x = p - s + dot(s, vec3(G3));
			 mediump vec3 hs = s;
			 
			 mediump vec3 e = step(vec3(0.0), x - x.yzx);
			 mediump vec3 i1 = e*(1.0 - e.zxy);
			 mediump vec3 i2 = 1.0 - e.zxy*(1.0 - e);
				
			 mediump vec3 x1 = x - i1 + G3;
			 mediump vec3 x2 = x - i2 + 2.0*G3;
			 mediump vec3 x3 = x - 1.0 + 3.0*G3;
			 
			 mediump vec4 w, d;
			 
			 w.x = dot(x, x);
			 w.y = dot(x1, x1);
			 w.z = dot(x2, x2);
			 w.w = dot(x3, x3);
			 
			 w = max(0.6 - w, 0.0);
			 
			 d.x = dot(random3(hs), x);
			 d.y = dot(random3(hs + i1), x1);
			 d.z = dot(random3(hs + i2), x2);
			 d.w = dot(random3(hs + 1.0), x3);
			 
			 w *= w;
			 w *= w;
			 d *= w;
			 
			 return dot(d, vec4(52.0));
		}`,[t]);e.keywords.F3=new qr("float F3 0.3333333"),e.keywords.G3=new qr("float G3 0.1666667");let i=new jt(`float simplexPrecise(vec3 p) {
			 vec3 s = floor(p + dot(p, vec3(F3)));
			 vec3 x = p - s + dot(s, vec3(G3));
			 
			 vec3 e = step(vec3(0.0), x - x.yzx);
			 vec3 i1 = e*(1.0 - e.zxy);
			 vec3 i2 = 1.0 - e.zxy*(1.0 - e);
				
			 vec3 x1 = x - i1 + G3;
			 vec3 x2 = x - i2 + 2.0*G3;
			 vec3 x3 = x - 1.0 + 3.0*G3;
			 
			 vec4 w, d;
			 
			 w.x = dot(x, x);
			 w.y = dot(x1, x1);
			 w.z = dot(x2, x2);
			 w.w = dot(x3, x3);
			 
			 w = max(0.6 - w, 0.0);
			 
			 d.x = dot(random3(s), x);
			 d.y = dot(random3(s + i1), x1);
			 d.z = dot(random3(s + i2), x2);
			 d.w = dot(random3(s + 1.0), x3);
			 
			 w *= w;
			 w *= w;
			 d *= w;
			 
			 return dot(d, vec4(52.0));
		}`,[t]);i.keywords.F3=new qr("float F3 0.3333333"),i.keywords.G3=new qr("float G3 0.1666667");let r=new jt(`float simplexFractal(vec3 m) {
			mat3 rot1 = mat3(-0.37, 0.36, 0.85,-0.14,-0.93, 0.34,0.92, 0.01,0.4);
			mat3 rot2 = mat3(-0.55,-0.39, 0.74, 0.33,-0.91,-0.24,0.77, 0.12,0.63);
			mat3 rot3 = mat3(-0.71, 0.52,-0.47,-0.08,-0.72,-0.68,-0.7,-0.45,0.56);
			return 0.5333333 * simplexFast(m * rot1)
				 + 0.2666667 * simplexFast(2.0 * m * rot2)
				 + 0.1333333 * simplexFast(4.0 * m * rot3)
				 + 0.0666667 * simplexFast(8.0 * m);
		}`,[e]),n=new jt("vec4 permute(vec4 x){return mod(((x*34.0)+1.0)*x, 289.0);}"),s=new jt("vec4 taylorInvSqrt(vec4 r){return 1.79284291400159 - 0.85373472095314 * r;}"),a=new jt(`float simplexAshima(vec3 v) {
		  const vec2  C = vec2(1.0/6.0, 1.0/3.0) ;
		  const vec4  D = vec4(0.0, 0.5, 1.0, 2.0);
		  vec3 i  = floor(v + dot(v, C.yyy) );
		  vec3 x0 =   v - i + dot(i, C.xxx) ;
		  vec3 g = step(x0.yzx, x0.xyz);
		  vec3 l = 1.0 - g;
		  vec3 i1 = min( g.xyz, l.zxy );
		  vec3 i2 = max( g.xyz, l.zxy );
		  vec3 x1 = x0 - i1 + 1.0 * C.xxx;
		  vec3 x2 = x0 - i2 + 2.0 * C.xxx;
		  vec3 x3 = x0 - 1. + 3.0 * C.xxx;
		  i = mod(i, 289.0 ); 
		  vec4 p = permute( permute( permute( 
					 i.z + vec4(0.0, i1.z, i2.z, 1.0 ))
				   + i.y + vec4(0.0, i1.y, i2.y, 1.0 )) 
				   + i.x + vec4(0.0, i1.x, i2.x, 1.0 ));
		  float n_ = 1.0/7.0; // N=7
		  vec3  ns = n_ * D.wyz - D.xzx;
		  vec4 j = p - 49.0 * floor(p * ns.z *ns.z);  //  mod(p,N*N)
		  vec4 x_ = floor(j * ns.z);
		  vec4 y_ = floor(j - 7.0 * x_ );    // mod(j,N)
		  vec4 x = x_ *ns.x + ns.yyyy;
		  vec4 y = y_ *ns.x + ns.yyyy;
		  vec4 h = 1.0 - abs(x) - abs(y);
		  vec4 b0 = vec4( x.xy, y.xy );
		  vec4 b1 = vec4( x.zw, y.zw );
		  vec4 s0 = floor(b0)*2.0 + 1.0;
		  vec4 s1 = floor(b1)*2.0 + 1.0;
		  vec4 sh = -step(h, vec4(0.0));
		  vec4 a0 = b0.xzyw + s0.xzyw*sh.xxyy ;
		  vec4 a1 = b1.xzyw + s1.xzyw*sh.zzww ;
		  vec3 p0 = vec3(a0.xy,h.x);
		  vec3 p1 = vec3(a0.zw,h.y);
		  vec3 p2 = vec3(a1.xy,h.z);
		  vec3 p3 = vec3(a1.zw,h.w);
		  vec4 norm = taylorInvSqrt(vec4(dot(p0,p0), dot(p1,p1), dot(p2, p2), dot(p3,p3)));
		  p0 *= norm.x;
		  p1 *= norm.y;
		  p2 *= norm.z;
		  p3 *= norm.w;
		  vec4 m = max(0.6 - vec4(dot(x0,x0), dot(x1,x1), dot(x2,x2), dot(x3,x3)), 0.0);
		  m = m * m;
		  return 42.0 * dot( m*m, vec4( dot(p0,x0), dot(p1,x1), 
										dot(p2,x2), dot(p3,x3) ) );
		}`,[n,s]),o=new jt("vec4 mod289(vec4 x){return x - floor(x * (1.0 / 289.0)) * 289.0;}"),l=new jt("vec4 perm(vec4 x){return mod289(((x * 34.0) + 1.0) * x);}",[o]),c=new jt(`float noise(vec3 p){
			vec3 a = floor(p);
			vec3 d = p - a;
			d = d * d * (3.0 - 2.0 * d);
			vec4 b = a.xxyy + vec4(0.0, 1.0, 0.0, 1.0);
			vec4 k1 = perm(b.xyxy);
			vec4 k2 = perm(k1.xyxy + b.zzww);
			vec4 c = k2 + a.zzzz;
			vec4 k3 = perm(c);
			vec4 k4 = perm(c + 1.0);
			vec4 o1 = fract(k3 * (1.0 / 41.0));
			vec4 o2 = fract(k4 * (1.0 / 41.0));
			vec4 o3 = o2 * d.z + o1 * (1.0 - d.z);
			vec2 o4 = o3.yw * d.x + o3.xz * (1.0 - d.x);
			return o4.y * d.y + o4.x * (1.0 - d.y);
		}`,[l]),u=new jt(`float fbm(vec3 x) {
			float v = 0.0;
			float a = 0.5;
			vec3 shift = vec3(100);
			for (int i = 0; i < NUM_OCTAVES; ++i) {
				v += a * noise(x);
				x = x * 2.0 + shift;
				a *= 0.5;
			}
			return v;
		}`,[c]);u.keywords.NUM_OCTAVES=new qr("int NUM_OCTAVES 5");let h=new jt("vec3 fade(vec3 t) {return t*t*t*(t*(t*6.0-15.0)+10.0);}"),d=new jt(`float perlin(vec3 P){
		  vec3 Pi0 = floor(P);
		  vec3 Pi1 = Pi0 + vec3(1.0);
		  Pi0 = mod(Pi0, 289.0);
		  Pi1 = mod(Pi1, 289.0);
		  vec3 Pf0 = fract(P);
		  vec3 Pf1 = Pf0 - vec3(1.0);
		  vec4 ix = vec4(Pi0.x, Pi1.x, Pi0.x, Pi1.x);
		  vec4 iy = vec4(Pi0.yy, Pi1.yy);
		  vec4 iz0 = Pi0.zzzz;
		  vec4 iz1 = Pi1.zzzz;
		  vec4 ixy = permute(permute(ix) + iy);
		  vec4 ixy0 = permute(ixy + iz0);
		  vec4 ixy1 = permute(ixy + iz1);
		  vec4 gx0 = ixy0 / 7.0;
		  vec4 gy0 = fract(floor(gx0) / 7.0) - 0.5;
		  gx0 = fract(gx0);
		  vec4 gz0 = vec4(0.5) - abs(gx0) - abs(gy0);
		  vec4 sz0 = step(gz0, vec4(0.0));
		  gx0 -= sz0 * (step(0.0, gx0) - 0.5);
		  gy0 -= sz0 * (step(0.0, gy0) - 0.5);
		  vec4 gx1 = ixy1 / 7.0;
		  vec4 gy1 = fract(floor(gx1) / 7.0) - 0.5;
		  gx1 = fract(gx1);
		  vec4 gz1 = vec4(0.5) - abs(gx1) - abs(gy1);
		  vec4 sz1 = step(gz1, vec4(0.0));
		  gx1 -= sz1 * (step(0.0, gx1) - 0.5);
		  gy1 -= sz1 * (step(0.0, gy1) - 0.5);
		  vec3 g000 = vec3(gx0.x,gy0.x,gz0.x);
		  vec3 g100 = vec3(gx0.y,gy0.y,gz0.y);
		  vec3 g010 = vec3(gx0.z,gy0.z,gz0.z);
		  vec3 g110 = vec3(gx0.w,gy0.w,gz0.w);
		  vec3 g001 = vec3(gx1.x,gy1.x,gz1.x);
		  vec3 g101 = vec3(gx1.y,gy1.y,gz1.y);
		  vec3 g011 = vec3(gx1.z,gy1.z,gz1.z);
		  vec3 g111 = vec3(gx1.w,gy1.w,gz1.w);
		  vec4 norm0 = taylorInvSqrt(vec4(dot(g000, g000), dot(g010, g010), dot(g100, g100), dot(g110, g110)));
		  g000 *= norm0.x;
		  g010 *= norm0.y;
		  g100 *= norm0.z;
		  g110 *= norm0.w;
		  vec4 norm1 = taylorInvSqrt(vec4(dot(g001, g001), dot(g011, g011), dot(g101, g101), dot(g111, g111)));
		  g001 *= norm1.x;
		  g011 *= norm1.y;
		  g101 *= norm1.z;
		  g111 *= norm1.w;
		  float n000 = dot(g000, Pf0);
		  float n100 = dot(g100, vec3(Pf1.x, Pf0.yz));
		  float n010 = dot(g010, vec3(Pf0.x, Pf1.y, Pf0.z));
		  float n110 = dot(g110, vec3(Pf1.xy, Pf0.z));
		  float n001 = dot(g001, vec3(Pf0.xy, Pf1.z));
		  float n101 = dot(g101, vec3(Pf1.x, Pf0.y, Pf1.z));
		  float n011 = dot(g011, vec3(Pf0.x, Pf1.yz));
		  float n111 = dot(g111, Pf1);
		  vec3 fade_xyz = fade(Pf0);
		  vec4 n_z = mix(vec4(n000, n100, n010, n110), vec4(n001, n101, n011, n111), fade_xyz.z);
		  vec2 n_yz = mix(n_z.xy, n_z.zw, fade_xyz.y);
		  float n_xyz = mix(n_yz.x, n_yz.y, fade_xyz.x); 
		  return 2.2 * n_xyz;
		}`,[n,s,h]),f=new jt(`float hashwithoutsine13(vec3 p3)
		{
			p3  = fract(p3 * .1031);
			p3 += dot(p3, p3.yzx + 33.33);
			return fract((p3.x + p3.y) * p3.z);
		}`),p=new jt(`vec3 hashwithoutsine33(vec3 p3)
		{
			p3 = fract(p3 * vec3(.1031, .1030, .0973));
			p3 += dot(p3, p3.yxz+33.33);
			return fract((p3.xxy + p3.yxx)*p3.zyx);
		}`),g=new jt(`float metric(in vec3 p)
		{
			// L2 
			return length(p);

			// Chebyshev 
			// vec3 a = abs(p);
			// return max(a.x, max(a.y, a.z));
		}`),m=new jt(`float smin( float a, float b, float k )
		{
			float h = smoothstep(0.0, 1.0, 0.5 + 0.5 * (b - a) / k);
			float correction = k * h * (1.0 - h);
			return mix(b, a, h) - correction;
		}`),y=new jt(`float smax( float a, float b, float k )
		{
			float h = smoothstep(1.0, 0.0, 0.5 + 0.5 * (a - b) / k);
			float correction = k * h * (1.0 - h);
			return mix(a, b, h) + correction;
		}`),b=new jt(`float remap(float value, float input_min, float input_max, float output_min, float output_max) {
			// Compute width of each interval
			float input_width = input_max - input_min;
			float output_width = output_max - output_min;
		
			// Convert input range into a 0-1 range 
			float scaled = (value - input_min) / input_width;
		
			// Convert the 0-1 range into a value in output range
			return output_min + (scaled * output_width);
		}`),w=new jt(`float voronoi(in vec3 x, in int style, in float smoothness, in float seed, in int quality) 
		{
			// Integer and fractional parts of this point's coordinates
			ivec3 p = ivec3(floor(x));
			vec3 f = fract(x);

			// Different variables that we will use to construct noise:
			//
			// f1: distance to the closest feature point
			// f2: distance to the second closest feature point
			// e: distance to the closest edge (cell boundary)
			//
			// We also compute "smooth" versions of all of the above quantites, essentially
			// replacing "hard" minimums with "smooth" minimums (described by IQ)
			float f1_smooth = 8.0;
			float f1 = 8.0;
			float f2_smooth = 8.0;
			float f2 = 8.0;
			float e_smooth = 8.0;
			float e = 8.0;

			// Variables stored from closest cell
			ivec3 mb;
			vec3 mr; 

			int steps = quality;
			
			for (int x = -steps; x <= steps; x++) 
			for (int y = -steps; y <= steps; y++)
			for (int z = -steps; z <= steps; z++)
			{
				ivec3 b = ivec3(x, y, z);
				vec3 r = vec3(b) + hashwithoutsine33(vec3(p + b) + seed) - f;
				float d = length(r);
				
				f1_smooth = smin(d, f1_smooth, smoothness);

				// Store un-smoothed distances too 
				if (d < f1) 
				{
					f2 = f1;
					f1 = d;

					mb = ivec3(x, y, z);
					mr = r;
				} 
				else if (d < f2) 
				{
					f2 = d;
				}
			}	
			
			// Second pass for edge distance  
			// skip for styles don't need
			if (style != 0 &&  style != 5 && style != 7)
			for (int x = -steps; x <= steps; x++) 
			for (int y = -steps; y <= steps; y++)
			for (int z = -steps; z <= steps; z++)
			{
				// Start search at the cell that contains the closest point to "x" (found in 1st pass)
				ivec3 b = mb + ivec3(x, y, z);
				vec3 r = vec3(b) + hashwithoutsine33(vec3(p + b) + seed) - f;
				float d1 = dot(0.5 * (mr + r), (r - mr)); 				// IQ normalizes "r - mr" but that breaks things for the smooth version?
				float d2 = dot(0.5 * (mr + r), normalize(r - mr));

				e_smooth = smin(d1, e_smooth, smoothness);

				e = min(e, d2);

				// Also compute a smooth version of F2 in this pass
				{
					ivec3 b = ivec3(x, y, z);
					if (b != mb) 
					{
						vec3 r = vec3(b) + hashwithoutsine33(vec3(p + b) + seed) - f;
						float d = length(r);

						f2_smooth = smin(d, f2_smooth, smoothness);
					}
				}
			}

			// Different visualization modes 
			if (style == 0) 
			{
				return f1_smooth;
			}
			if (style == 1) 
			{
				return f2_smooth;
			}
			if (style == 2) 
			{
				return f2_smooth - f1_smooth;
				
				// "Pebbles" also cool
				//return step(0.2, f2_smooth - f1_smooth);
			}
			if (style == 3) 
			{
				// This one is really good for rock / stone effects
				float a = f1; 
				float b = f2;
				float k = 3.0;
				float h = max(k - abs(a - b), 0.0) / k;
				float final = min(a, b) - h * h * k * (1.0 / 4.0);
				return final;
			}
			if (style == 4) 
			{
				// Some random adjustments to make this style stand out more 
				return exp(5.0 * e_smooth);
			}
			if (style == 5) 
			{
				return pow(f1_smooth, 3.0);
			}
			if (style == 6) 
			{				
				const float eps = 0.0125;

				// Thicker lines as the user increases the smoothness slider
				float thickness = smoothness * 0.25 + eps;

				// Blurrier lines as the user increases the smoothness slider
				float blur = pow(smoothness, 3.0) * 0.25 + eps;

				return smoothstep(
					thickness - thickness * blur, 
					thickness + thickness * blur, 
					e
				);
			}
			if (style == 7) 
			{
				return hashwithoutsine13(vec3(p + mb) + seed);
			}
		}
	`,[f,p,g,m,y,b]);return{simplexFast:e,simplexPrecise:i,simplexFractal:r,simplexAshima:a,fbm:u,perlin:d,voronoi:w}})(),Ppe=class extends dn{constructor(t,e,i,r,n,s,a,o,l,c,u,h,d,f,p,g,m,y,b){super("v3"),this.nodeType="Noise",this.scale=t,this.size=e,this.move=i,this.fA=r,this.fB=n,this.distortion=s,this.colorA=a,this.colorB=o,this.colorC=l,this.colorD=c,this.noiseType=h,this.voronoiStyle=f,this.highCut=p,this.lowCut=g,this.smoothness=m,this.seed=y,this.quality=b,this.isMask=d,this.alpha=u,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(t,e,i,r,n){t.require("uv"),t.requires.uv=[!0],t.addFragmentVariable(this.calpha,"float");let s=["simplexFast","simplexFractal","simplexAshima","fbm","perlin","voronoi"][this.noiseType.value],a=s=="voronoi"?`
		float v = ${s}(st + move, voronoiStyle, smoothness, seed, quality);

		// Apply clipping to colors
		v = remap(v, lowCut, highCut, 0.0, 1.0);
		v = smax(v, 0.0, smoothness * 0.25);
		v = smin(v, 1.0, smoothness * 0.25);

		// Note that the voronoi mode only uses colors "A" and "C" from the UI 
		vec4 color = mix(colorA, colorC, v); 
		`:`
		vec3 q = vec3(${s}(st),
					   ${s}(st + vec3(1.0)),
					   ${s}(st + vec3(1.0)));
		vec3 r = vec3(${s}(st + vec3(distortion, 1.0) * q + vec3(fA, 1.0) + move),
					  ${s}(st + vec3(distortion, 1.0) * q + vec3(fB, 1.0) + move), 
					  ${s}(st * q));
		float f = ${s}(st + r);
		vec4 color;
		color = mix(colorA, colorB, clamp((f * f) * 4.0, 0.0, 1.0));
		color = mix(color, colorC, clamp(length(q), 0.0, 1.0));
		color = mix(color, colorD, clamp(length(r.x), 0.0, 1.0));
		`,o=new jt(`vec3 ${s}customNoise(float scale, vec3 size, float move, vec2 fA, vec2 fB, vec2 distortion, vec4 colorA, vec4 colorB, vec4 colorC, vec4 colorD, int voronoiStyle, float highCut, float lowCut, float smoothness, float seed, int quality, bool isMask, float mask, float alpha, out float calpha) 
			{
                // Prevent scale of zero 
				scale = max(abs(scale), 0.001);

				vec3 st = position / size;
				st /= scale;

				${a}

				float lalpha = alpha * color.a * mask;
				calpha = mix(lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0), lalpha, float(isMask));
				accumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));

				return clamp(color, 0.0, 1.0).rgb;
			}`,[Yl.simplexFast,Yl.simplexFractal,Yl.simplexAshima,Yl.fbm,Yl.perlin,Yl.voronoi]),l=t.include(o),c=[];return c.push(this.scale.build(t,"f")),c.push(this.size.build(t,"v3")),c.push(this.move.build(t,"f")),c.push(this.fA.build(t,"v2")),c.push(this.fB.build(t,"v2")),c.push(this.distortion.build(t,"v2")),c.push(this.colorA.build(t,"v4")),c.push(this.colorB.build(t,"v4")),c.push(this.colorC.build(t,"v4")),c.push(this.colorD.build(t,"v4")),c.push(this.voronoiStyle.build(t,"i")),c.push(this.highCut.build(t,"f")),c.push(this.lowCut.build(t,"f")),c.push(this.smoothness.build(t,"f")),c.push(this.seed.build(t,"f")),c.push(this.quality.build(t,"i")),c.push(this.isMask.build(t,"b")),c.push(this.mask?`luminance(${this.mask.flow(t,"v3").result})`:"1.0"),c.push(this.alpha.build(t,"f")),c.push(this.calpha),t.format(l+"("+c.join(",")+")",this.getType(t),e)}};Ppe.numOctaves=5;var Rpe=class extends dn{constructor(t,e,i,r,n,s,a,o,l,c,u,h,d,f,p,g){super("v3"),this.nodeType="Outline",this.firstTime=!0,this.outlineColor=t,this.contourColor=e,this.outlineWidth=i,this.contourWidth=r,this.contourThreshold=n,this.outlineThreshold=s,this.contourFrequency=a,this.outlineSmoothing=o,this.contourDirection=l,this.positionalLines=c,this.compensation=u,this.resolution=h,this.normalMap=d,this.depthMap=f,this.pixelRatio=p,this.alpha=g,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(t,e){let i=`g${this.uuid.toString().replace(/-/g,"")}`;if(t.require("vWorldViewDir"),t.require("worldNormal"),t.extensions.derivatives=!0,this.compensation.value&&t.define("OUTLINE_COMPENSATION",`${i}_offset`),this.firstTime){let r=this.outlineWidth.build(t,"f"),n=this.resolution.build(t,"v2"),s=this.compensation.build(t,"b"),a=this.pixelRatio.build(t,"f");t.addVertexParsVariable("randomColor","attribute vec3"),t.addVertexParsVariable("extrudeNormal","attribute vec3"),t.addVertexParsVariable(r,"uniform float"),t.addVertexParsVariable(n,"uniform vec2"),t.addVertexParsVariable(s,"uniform bool"),t.addVertexParsVariable(a,"uniform float"),t.addVertexParsVariable("vID","flat out float"),t.addFragmentParsVariable("vID","flat in float"),t.addVertexFinalCode(`
                vID = randomColor.r;
                vec2 ${i}_offset = vec2(0.0);
                if (${s}) {
                    vec4 ${i}_clipPosition = projectionMatrix * (modelViewMatrix * vec4(transformed, 1.0));
                    // NOTE: For certain shapes, like spheres, we get incorrect extrusion when the
                    // normals face the camera directly. So we hackily fix this by offsetting the normal
                    // by a tiny amount.
                    vec3 ${i}_clipNormal = mat3(projectionMatrix) * (mat3(modelViewMatrix) * extrudeNormal) + 0.0000001;
                    ${i}_offset = normalize(${i}_clipNormal.xy) / ${n} * (${r} / 2.0) * ${i}_clipPosition.w * 2.0 * ${a};
                    ${i}_clipPosition.xy += ${i}_offset;
                    // TODO(MAX): To handle multiple outline layers, we only want to extrude
                    // if this offset is the biggest of all the potential offsets
                    gl_Position = ${i}_clipPosition;
                }
            `)}if(t.isShader("fragment")){t.require("uv"),t.requires.uv=[!0],t.addFragmentVariable(this.calpha,"float");let r=t.include(Rpe.Nodes.outline),n=[];return n.push(this.outlineColor.build(t,"c")),n.push(this.contourColor.build(t,"c")),n.push(this.outlineWidth.build(t,"f")),n.push(this.contourWidth.build(t,"f")),n.push(this.contourThreshold.build(t,"f")),n.push(this.outlineThreshold.build(t,"f")),n.push(this.contourFrequency.build(t,"f")),n.push(this.outlineSmoothing.build(t,"f")),n.push(this.contourDirection.build(t,"v3")),n.push(this.positionalLines.build(t,"b")),n.push(this.resolution.build(t,"v2")),n.push(this.normalMap.getTexture(t,"t")),n.push(this.depthMap.getTexture(t,"t")),n.push(this.pixelRatio.build(t,"f")),n.push(this.compensation.build(t,"b")),n.push(this.mask?`luminance(${this.mask.flow(t,"v3").result})`:"1.0"),n.push(this.alpha.build(t,"f")),n.push(this.calpha),this.firstTime=!this.firstTime,t.format(r+"("+n.join(",")+")",this.getType(t),e)}else return console.warn("OutlineNode is not compatible with "+t.shader+" shader."),""}},Ipe=Rpe;Ipe.Nodes=(function(){let t=new jt(`
float sobelSample(sampler2D t, sampler2D d, vec2 uv, vec2 resolution, float outlineWidth, float pixelRatio)
{
    vec2 halton = haltonSequence[frameIndex];
    float temporalOffset = getNoiseInterleavedGradient(gl_FragCoord.xy + halton);
    float temporalAngle  = temporalOffset * PI2;

    vec2 texelSize = (vec2(1.0) / resolution);
    vec2 offsetSize = texelSize * outlineWidth * pixelRatio;

    vec2 uvSamples[9];
    vec4 normalSamples[9];

	uvSamples[0] = uv + vec2( -offsetSize.x, -offsetSize.y) + (vogelDiskSample(0, 9, temporalAngle) * texelSize);
	uvSamples[1] = uv + vec2(0.0, -offsetSize.y) + (vogelDiskSample(1, 9, temporalAngle) * texelSize);
	uvSamples[2] = uv + vec2(  offsetSize.x, -offsetSize.y) + (vogelDiskSample(2, 9, temporalAngle) * texelSize);
	uvSamples[3] = uv + vec2( -offsetSize.x, 0.0) + (vogelDiskSample(3, 9, temporalAngle) * texelSize);
	uvSamples[4] = uv;
	uvSamples[5] = uv + vec2(  offsetSize.x, 0.0) + (vogelDiskSample(5, 9, temporalAngle) * texelSize);
	uvSamples[6] = uv + vec2( -offsetSize.x, offsetSize.y) + (vogelDiskSample(6, 9, temporalAngle) * texelSize);
	uvSamples[7] = uv + vec2(0.0, offsetSize.y) + (vogelDiskSample(7, 9, temporalAngle) * texelSize);
	uvSamples[8] = uv + vec2(  offsetSize.x, offsetSize.y) + (vogelDiskSample(8, 9, temporalAngle) * texelSize);


    normalSamples[0] = texture2D(t, uvSamples[0]);
    normalSamples[1] = texture2D(t, uvSamples[1]);
    normalSamples[2] = texture2D(t, uvSamples[2]);
    normalSamples[3] = texture2D(t, uvSamples[3]);
    normalSamples[4] = texture2D(t, uvSamples[4]);
    normalSamples[5] = texture2D(t, uvSamples[5]);
    normalSamples[6] = texture2D(t, uvSamples[6]);
    normalSamples[7] = texture2D(t, uvSamples[7]);
    normalSamples[8] = texture2D(t, uvSamples[8]);

    float depthBias = 0.0001;
    // TODO(MAX): Can we somehow reduce the number of conditionals here with MATH?!
    if (normalSamples[0].a != vID && normalSamples[0].a != 0.0) {
        float depthAtSample = texture2D(d, uvSamples[0]).r + depthBias;
        if (gl_FragCoord.z > depthAtSample) {
           return 0.0;
        }
    }

    if (normalSamples[1].a != vID && normalSamples[1].a != 0.0) {
        float depthAtSample = texture2D(d, uvSamples[1]).r + depthBias;
        if (gl_FragCoord.z > depthAtSample) {
           return 0.0;
        }
    }

    if (normalSamples[2].a != vID && normalSamples[2].a != 0.0) {
        float depthAtSample = texture2D(d, uvSamples[2]).r + depthBias;
        if (gl_FragCoord.z > depthAtSample) {
           return 0.0;
        }
    }

    if (normalSamples[3].a != vID && normalSamples[3].a != 0.0) {
        float depthAtSample = texture2D(d, uvSamples[3]).r + depthBias;
        if (gl_FragCoord.z > depthAtSample) {
           return 0.0;
        }
    }


    if (normalSamples[4].a != vID && normalSamples[4].a != 0.0) {
        float depthAtSample = texture2D(d, uvSamples[4]).r + depthBias;
        if (gl_FragCoord.z > depthAtSample) {
           return 0.0;
        }
    }

    if (normalSamples[5].a != vID && normalSamples[5].a != 0.0) {
        float depthAtSample = texture2D(d, uvSamples[5]).r + depthBias;
        if (gl_FragCoord.z > depthAtSample) {
           return 0.0;
        }
    }

    if (normalSamples[6].a != vID && normalSamples[6].a != 0.0) {
        float depthAtSample = texture2D(d, uvSamples[6]).r + depthBias;
        if (gl_FragCoord.z > depthAtSample) {
           return 0.0;
        }
    }

    if (normalSamples[7].a != vID && normalSamples[7].a != 0.0) {
        float depthAtSample = texture2D(d, uvSamples[7]).r + depthBias;
        if (gl_FragCoord.z > depthAtSample) {
           return 0.0;
        }
    }

    if (normalSamples[8].a != vID && normalSamples[8].a != 0.0) {
        float depthAtSample = texture2D(d, uvSamples[8]).r + depthBias;
        if (gl_FragCoord.z > depthAtSample) {
           return 0.0;
        }
    }

    vec3 sobel_edge_h = normalSamples[2].rgb + (2.0*normalSamples[5].rgb) + normalSamples[8].rgb - (normalSamples[0].rgb + (2.0*normalSamples[3].rgb) + normalSamples[6].rgb);
  	vec3 sobel_edge_v = normalSamples[0].rgb + (2.0*normalSamples[1].rgb) + normalSamples[2].rgb - (normalSamples[6].rgb + (2.0*normalSamples[7].rgb) + normalSamples[8].rgb);

    float edgeNormal = sqrt(dot(sobel_edge_h, sobel_edge_h) + dot(sobel_edge_v, sobel_edge_v));
    return edgeNormal;
}
`);return{outline:new jt(`vec3 outline(vec3 outlineColor, vec3 contourColor, float outlineWidth, float contourWidth, float outlineThreshold, float contourThreshold, float outlineSmoothing, float contourFrequency, vec3 contourDirection, bool positionalLines, vec2 resolution, sampler2D normalMap, sampler2D depthMap, float pixelRatio, bool compensation, float mask, float alpha, out float calpha) {
                vec3 result = outlineColor;
                float resultAlpha = 0.0;

                vec3 N = normalize(vWNormal);
                vec2 nuv = (gl_FragCoord.xy / resolution);
                float sobelSample = compensation ? sobelSample(normalMap, depthMap, nuv, resolution, outlineWidth / 2., pixelRatio) : sobelSample(normalMap, depthMap, nuv, resolution, outlineWidth, pixelRatio);
                resultAlpha = smoothstep(outlineThreshold - outlineSmoothing, outlineThreshold + outlineSmoothing, sobelSample);

                //resultAlpha = 1.0;
                //result = vec3(sobelSample);

                float t = 1.0 - contourThreshold;
                if(positionalLines) {
                    vec3 NDir = position * contourDirection;
                    float NT = NDir.x + NDir.y + NDir.z;
                    float f  = fract(NT * contourFrequency * 0.01);
                    float df = fwidth(NT * contourFrequency);

                    float g = smoothstep(df * (contourWidth * 0.01), df * (contourWidth * 0.01 * 2.0), f);
                    if (g < 1.0 && resultAlpha == 0.0) {
                        result = contourColor;
                        resultAlpha = 1.0;
                    }
                 }
                 else {
                    vec3 NDir = N * contourDirection;
                    float NT = NDir.x + NDir.y + NDir.z;
                    float df = fwidth(NT * contourThreshold);
                    float f = sin(NT * 1.0 * contourFrequency);
                    float g = smoothstep(0.0, df * contourWidth, 1.0 - f);

                    if (df > (t * 0.5) && g < 1.0 && resultAlpha == 0.0) {
                        result = contourColor;
                        resultAlpha = 1.0 - g;
                    }
                 }

                 float lalpha = alpha * resultAlpha * mask;
                 calpha =  lalpha / clamp( lalpha + accumAlpha, 0.00001, 1.0 );
                 accumAlpha += ( 1.0 - accumAlpha ) * lalpha;
				 
                 return result;
             }`,[t])}})();var hp=class extends dn{constructor(t,e,i,r,n,s,a,o,l,c,u,h,d,f,p,g,m,y){super("v3"),this.nodeType="Pattern",this.style=t,this.projection=e,this.axis=i,this.blending=r,this.offset=n,this.colorA=s,this.colorB=a,this.frequency=o,this.size=l,this.variation=c,this.smoothness=u,this.zigzag=h,this.rotation=d,this.vertical=f,this.horizontal=p,this.sides=g,this.isMask=y,this.alpha=m,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(t,e){if(t.isShader("fragment")){t.require("position"),t.require("uv"),t.requires.uv=[!0],t.require("normal"),t.requires.normal=!0,t.addFragmentVariable(this.calpha,"float");let i;switch(this.style.value){case 0:i="circle";break;case 1:i="ring";break;case 2:i="polygon";break;case 3:i="xcross";break;case 4:i="diamond";break;case 5:i="checkerboard";break;case 6:i="line";break;case 7:i="wave";break;default:i="circle";break}let r=`g${this.uuid.toString().replace(/-/g,"")}`,n=new jt(`float hashwithoutsine12(vec2 p)
				{
					vec3 p3 = fract(vec3(p.xyx) * .1031);
					p3 += dot(p3, p3.yzx + 33.33);
					return fract((p3.x + p3.y) * p3.z);
				}`),s=new jt(`vec2 rotate_uv(in vec2 uv, float a, bool repeat) 
				{
					const float mid = 0.5;
					float radians = a * (PI / 180.0);
					vec2 rotated = vec2(
						cos(radians) * (uv.x - mid) + sin(radians) * (uv.y - mid) + mid,
						cos(radians) * (uv.y - mid) - sin(radians) * (uv.x - mid) + mid
					);
					return repeat ? fract(rotated): rotated;
				}`),a="";if(this.projection.value===4){let u=this.style.value===2?`${i}(uv0, frequency, size, variation, smoothness_remapped, zigzag, rotation, sides)`:`${i}(uv0, frequency, size, variation, smoothness_remapped, zigzag, rotation)`,h=this.style.value===2?`${i}(uv1, frequency, size, variation, smoothness_remapped, zigzag, rotation, sides)`:`${i}(uv1, frequency, size, variation, smoothness_remapped, zigzag, rotation)`,d=this.style.value===2?`${i}(uv2, frequency, size, variation, smoothness_remapped, zigzag, rotation, sides)`:`${i}(uv2, frequency, size, variation, smoothness_remapped, zigzag, rotation)`;a=`
				vec3 p = position;
				float factor = 0.0125;
				vec2 uv0 = fract(p.xy * factor);
				vec2 uv1 = fract(p.zy * factor);
				vec2 uv2 = fract(p.xz * factor);
				
				uv0 = rotate_uv(uv0 + offset, rotation, true);
				uv1 = rotate_uv(uv1 + offset, rotation, true);
				uv2 = rotate_uv(uv2 + offset, rotation, true);
	
				float d0 = ${u};
				float d1 = ${h};
				float d2 = ${d};
				
				// Range from 3 to 128 seems to be good
				float exponent = (1.0 - blending) * 125.0 + 3.0;

				vec3 n = vObjectNormal;
				vec3 weights = abs(normalize(n));
				weights = pow(weights, vec3(exponent));
				weights /= dot(weights, vec3(1.0));
				d0 *= weights.z;
				d1 *= weights.x;
				d2 *= weights.y;
				float draw = d0 + d1 + d2;
	
				vec2 custom_uv = uv0 * weights.z + uv1 * weights.x + uv2 * weights.y;
				`}else{let u=this.style.value===2?`${i}(custom_uv, frequency, size, variation, smoothness_remapped, zigzag, rotation, sides)`:`${i}(custom_uv, frequency, size, variation, smoothness_remapped, zigzag, rotation)`,h="";this.axis.value===0?h=`float radius = length(p);
					float theta = atan(p.y, p.z);
					float phi = acos(p.x / radius);`:this.axis.value===1?h=`float radius = length(p);
					float theta = atan(p.x, p.z);
					float phi = acos(p.y / radius);`:(this.axis.value,h=`float radius = length(p);
					float theta = atan(p.y, p.x);
					float phi = acos(p.z / radius);`);let d="";switch(this.projection.value){case 0:d="custom_uv = vUv.st;";break;case 1:break;case 2:d=`
							vec3 p = position;
							${h}
							custom_uv = vec2(theta, phi);
							custom_uv /= PI;
							`;break}a=`
				vec2 custom_uv;
				${d}
	
				custom_uv += offset;
				custom_uv = fract(custom_uv);
				custom_uv = rotate_uv(custom_uv, rotation, true);
	
				float draw = ${u};
				`}let o=new jt(`vec3 ${r}_pattern(vec3 normal, float blending, int style, vec2 offset, vec4 colorA, vec4 colorB, vec2 frequency, float size, float variation, float smoothness, float zigzag, float rotation, vec2 vertical, vec2 horizontal, int sides, bool isMask, float mask, float alpha, out float calpha) {
					const float TWO_PI = PI * 2.0;
					float smoothness_remapped = pow(smoothness, 5.0);	

					${a}

					// Construct final output color
					vec4 color = mix(colorA, colorB, draw);
					color.a = clamp(color.a, 0.0, 1.0);

					// Apply cuts
					color.a *= 
						step(vertical.x, custom_uv.y) * 
						step(custom_uv.y, vertical.y);
					color.a *= 
						step(horizontal.x, abs(custom_uv.x)) * 
						step(abs(custom_uv.x), horizontal.y);

					// Accumulate alpha 
					float lalpha = alpha * clamp(color.a, 0.0, 1.0) * mask;
					calpha = mix(lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0), lalpha, float(isMask));
					accumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));

					return clamp(color, 0.0, 1.0).rgb;
				}`,[s,n,hp.DrawFunctions.circle,hp.DrawFunctions.ring,hp.DrawFunctions.polygon,hp.DrawFunctions.cross,hp.DrawFunctions.diamond,hp.DrawFunctions.checkerboard,hp.DrawFunctions.line,hp.DrawFunctions.wave]),l=t.include(o),c=[];return c.push("normal"),c.push(this.blending.build(t,"f")),c.push(this.style.build(t,"i")),c.push(this.offset.build(t,"v2")),c.push(this.colorA.build(t,"v4")),c.push(this.colorB.build(t,"v4")),c.push(this.frequency.build(t,"v2")),c.push(this.size.build(t,"f")),c.push(this.variation.build(t,"f")),c.push(this.smoothness.build(t,"f")),c.push(this.zigzag.build(t,"f")),c.push(this.rotation.build(t,"f")),c.push(this.vertical.build(t,"v2")),c.push(this.horizontal.build(t,"v2")),c.push(this.sides.build(t,"i")),c.push(this.isMask.build(t,"b")),c.push(this.mask?`luminance(${this.mask.flow(t,"v3").result})`:"1.0"),c.push(this.alpha.build(t,"f")),c.push(this.calpha),t.format(l+"("+c.join(",")+")",this.getType(t),e)}else return console.warn("PatterNode is not compatible with "+t.shader+" shader."),t.format("vec3(0.0)",this.getType(t),e)}},Dpe=hp;Dpe.DrawFunctions=(function(){let t=new jt(`float hashwithoutsine12(vec2 p) {
				vec3 p3 = fract(vec3(p.xyx) * 0.1031);
				p3 += dot(p3, p3.yzx + 33.33);
				return fract((p3.x + p3.y) * p3.z);
			}`),e=new jt(`vec2 tile_and_center(in vec2 uv, in vec2 frequency, in float variation, in float zigzag, in float rotation) {
                // Create tiles in UV-space
                uv *= frequency;

                // Integer coords
                vec2 i = floor(uv);

                // Offset every other row based on zigzag param, then compute fractional coords
                float row_offset = mod(i.y, 2.0);
                uv.x += row_offset * zigzag;
                vec2 f = fract(uv);

				// Rotate the tile itself:
				// const float mid = 0.5;
				// f = vec2(
				// 	cos(rotation) * (f.x - mid) + sin(rotation) * (f.y - mid) + mid,
				// 	cos(rotation) * (f.y - mid) - sin(rotation) * (f.x - mid) + mid
				// );
				// f = fract(f);

                f = f * 2.0 - 1.0;

				// Recompute integer coords after shifting - then, random value per tile 
				i = floor(uv);
				float rand = (hashwithoutsine12(i) * 5.0 + 1.0);
				float jitter = mix(1.0, rand, variation);
				f *= jitter;

                return f;
            }`,[t]),i=new jt(`float circle(in vec2 uv, in vec2 frequency, in float size, in float variation, in float smoothness, in float zigzag, in float rotation) {
                vec2 f = tile_and_center(uv, frequency, variation, zigzag, rotation);
                return smoothstep(
                    -smoothness, 
                     smoothness, 
                     length(f) - size
                );
            }`,[e]),r=new jt(`float ring(in vec2 uv, in vec2 frequency, in float size, in float variation, in float smoothness, in float zigzag, in float rotation) {
                vec2 f = tile_and_center(uv, frequency, variation, zigzag, rotation);

				float d = length(f);
                const float inner_width = 0.5;

                float outer = smoothstep(-smoothness, smoothness, d - size);
                float inner = smoothstep(-smoothness, smoothness, d - size * inner_width);
				return outer + (1.0 - inner);   
            }`,[e]),n=new jt(`float sdf_ngon(in vec2 p, in float r, in int n) {
                float an = (PI * 2.0) / float(n);
                float he = r * tan(0.5 * an);
                
                // Rotate to first sector
                p = -p.yx; 
                float bn = an * floor((atan(p.y, p.x) + 0.5 * an) / an);
                vec2  cs = vec2(cos(bn), sin(bn));
                p = mat2(cs.x, -cs.y, cs.y, cs.x)*p;
            
                // Side of polygon
                return length(p - vec2(r, clamp(p.y, -he, he))) * sign(p.x - r);
            }
            
            float polygon(in vec2 uv, in vec2 frequency, in float size, in float variation, in float smoothness, in float zigzag, in float rotation, in int sides) {
                vec2 f = tile_and_center(uv, frequency, variation, zigzag, rotation);
                return smoothstep(-smoothness, smoothness, sdf_ngon(f, size, sides));
            }`,[e]),s=new jt(`float sdf_cross(in vec2 p, in vec2 b, float r ) {
                p = abs(p); 
				p = (p.y > p.x) ? p.yx : p.xy;
                vec2  q = p - b;
                float k = max(q.y, q.x);
                vec2  w = (k > 0.0) ? q : vec2(b.y - p.x, -k);
                return sign(k) * length(max(w, 0.0)) + r;
            }
            
            // Avoid namespace conflicts 
            float xcross(in vec2 uv, in vec2 frequency, in float size, in float variation, in float smoothness, in float zigzag, in float rotation) {
                vec2 f = tile_and_center(uv, frequency, variation, zigzag, rotation);
                return smoothstep(-smoothness, smoothness, sdf_cross(f, vec2(size, size * 0.25), smoothness));
            }`,[e]),a=new jt(`float ndot(vec2 a, vec2 b) { 
                return a.x*b.x - a.y*b.y; 
            }
            
            float sdf_diamond(in vec2 p, in vec2 b) {
                p = abs(p);
                float h = clamp(ndot(b - 2.0 * p, b) / dot(b, b), -1.0, 1.0);
                float d = length(p - 0.5 * b * vec2(1.0 - h, 1.0 + h));
                return d * sign(p.x * b.y + p.y * b.x - b.x * b.y);
            }

            float diamond(in vec2 uv, in vec2 frequency, in float size, in float variation, in float smoothness, in float zigzag, in float rotation) {
                vec2 f = tile_and_center(uv, frequency, variation, zigzag, rotation);
	            return smoothstep(-smoothness, smoothness, sdf_diamond(f, vec2(size)));
            }`,[e]),o=new jt(`float checkerboard(in vec2 uv, in vec2 frequency, in float size, in float variation, in float smoothness, in float zigzag, in float rotation) {
                uv *= frequency;
                vec2 i = floor(uv);

                float offset = mod(i.y, 2.0);

                uv.x += offset + zigzag * offset;
                float x = floor(uv.x);
                
                return mod(x, 2.0);
            }`),l=new jt(`float line(in vec2 uv, in vec2 frequency, in float size, in float variation, in float smoothness, in float zigzag, in float rotation) {
                vec2 f = tile_and_center(uv, frequency, 0.0, zigzag, rotation);
				
				// Different approach for variation param here
				float row = floor(uv * frequency).y;
				float rand = hashwithoutsine12(vec2(row));
				float s = mix(size, size * rand, variation);

				return smoothstep(
					s - smoothness, 
					s + smoothness, 
					abs(f.y)
				);
            }`,[e]),c=new jt(`// Uses bisection 
            float udf_cos(in vec2 p, in float a, in float b, in float c, in float d) {
                // Convert all data to a primitive cosine wave
                p = c * (p - vec2(d, a));
                
                const float TWO_PI = PI * 2.0;

                // Reduce to principal half cycle
                p.x = mod(p.x, TWO_PI); 
                if (p.x > PI) {
                    p.x = TWO_PI - p.x;
                }
            
                // Find zero of derivative (minimize distance)
                float xa = 0.0;
                float xb = TWO_PI;

                // 24 bit precision
                for (int i = 0; i < 24; i++) {
                    float x = 0.5 * (xa + xb);
                    float y = x - p.x + b * c * sin(x) * (p.y - b * c * cos(x));
                    if (y < 0.0) xa = x; 
                    else xb = x;
                }
                float x = 0.5 * (xa + xb);
                
                // Compute distance    
                vec2 q = vec2(x, b * c * cos(x));
                return length(p - q) / c;
            }

            float wave(in vec2 uv, in vec2 frequency, in float size, in float variation, in float smoothness, in float zigzag, in float rotation) {
                float repeat = frequency.x;
                uv *= repeat;
                vec2 i = floor(uv);
                float row_offset = mod(i.y, 2.0);
                uv.x += row_offset * zigzag;
                vec2 f = vec2(uv.x, fract(uv.y));

                // Generalized cosine: y(x) = a + b * cos(cx + d)
                const float amplitude = 0.125;
                float wave_frequency = frequency.y * 0.1;
                float distance_estimate = udf_cos(f, 0.50, amplitude, wave_frequency * (2.0 * PI), 0.0);

				// Different approach for variation param here
				float rand = hashwithoutsine12(vec2(i.y));
				float s = mix(size, size * rand, variation);

                return smoothstep(-smoothness, smoothness, distance_estimate - s * 0.5);
            }`);return{tileAndCenter:e,circle:i,ring:r,polygon:n,cross:s,diamond:a,checkerboard:o,line:l,wave:c}})();var Ope=class extends dn{constructor(t,e,i,r,n,s,a,o){super("v3"),this.nodeType="Rainbow",this.filmThickness=t,this.movement=e,this.wavelengths=i,this.noiseStrength=r,this.noiseScale=n,this.offset=s,this.isMask=o,this.alpha=a,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(t,e){if(t.require("vWorldViewDir"),t.require("worldNormal"),t.isShader("fragment")){t.require("uv"),t.requires.uv=[!0],t.addFragmentVariable(this.calpha,"float");let i=t.include(Ope.Nodes.rainbow),r=[];return r.push(this.filmThickness.build(t,"f")),r.push(this.movement.build(t,"f")),r.push(this.wavelengths.build(t,"v3")),r.push(this.noiseStrength.build(t,"f")),r.push(this.noiseScale.build(t,"f")),r.push(this.offset.build(t,"v3")),r.push(this.isMask.build(t,"b")),r.push(this.mask?`luminance(${this.mask.flow(t,"v3").result})`:"1.0"),r.push(this.alpha.build(t,"f")),r.push(this.calpha),t.format(i+"("+r.join(",")+")",this.getType(t),e)}else return console.warn("RainbowNode is not compatible with "+t.shader+" shader."),t.format("vec3( 0.0 )",this.getType(t),e)}},Lpe=Ope;Lpe.Nodes=(function(){let t=new jt(`vec3 attenuation(vec3 wavelengths, float filmThickness, float movement, float noiseStrength, float noiseScale, vec3 offset) {
				float f = 0.0;
				
				if (noiseStrength != 0.0) {
					vec3 st = position / noiseScale;
					float noise = simplexFast(1.6 * st + vec3(1.8, 1.5, 1.9) * simplexFast(st) + vec3(1.7, 9.2, 1.0));
					f = noise * noiseStrength;
				}

				vec3 waves = wavelengths * vec3(1.0, 0.8, 0.6) + 1.0;
				float angle = dot(normalize(vWorldViewDir + (offset * -0.001)), normalize(vWNormal));

				mediump vec3 color = cos((((filmThickness + f) / waves) * angle) + movement);
				return .5 + .5 * color;
			 }`,[Yl.simplexFast]);return{rainbow:new jt(`vec3 rainbow(float filmThickness, float movement, vec3 wavelengths, float noiseStrength, float noiseScale, vec3 offset, bool isMask, float mask, float alpha, out float calpha) {
				mediump vec3 res = clamp(attenuation(wavelengths, filmThickness, movement, noiseStrength, noiseScale, offset), 0.0, 2.0);

				float rainbowContribution = clamp(res.r + res.g + res.b, 0.0, 1.0);

				float lalpha = alpha * rainbowContribution * mask;
				calpha = mix(lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0), lalpha, float(isMask));
				accumAlpha += (1.0 - accumAlpha) * lalpha * (1.0 - float(isMask));

				return res;
			 }`,[t])}})();var kpe=class extends dn{constructor(t,e,i,r,n,s,a,o,l,c){super("v3"),this.nodeType="Toon",this.positioning=t,this.colors=e,this.steps=i,this.source=r,this.isWorldSpace=n,this.noiseStrength=s,this.noiseScale=a,this.shadowColor=o,this.offset=l,this.alpha=c,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(t,e){if(t.require("worldNormal"),t.require("worldPosition"),t.isShader("fragment")){t.define("COLORS_MAX",10),t.addFragmentVariable(this.calpha,"float");let i=t.include(kpe.Nodes.toon),r=[];return r.push(this.positioning.build(t,"i")),r.push(this.colors.build(t,"v4[]")),r.push(this.steps.build(t,"f[]")),r.push(this.source.build(t,"v3")),r.push(this.isWorldSpace.build(t,"b")),r.push(this.noiseStrength.build(t,"f")),r.push(this.noiseScale.build(t,"f")),r.push(this.shadowColor.build(t,"v4")),r.push(this.offset.build(t,"v3")),r.push(this.mask?`luminance(${this.mask.flow(t,"v3").result})`:"1.0"),r.push(this.alpha.build(t,"f")),r.push(this.calpha),t.format(i+"("+r.join(",")+")",this.getType(t),e)}else return console.warn("ToonNode is not compatible with "+t.shader+" shader."),t.format("vec3( 0.0 )",this.getType(t),e)}},Npe=kpe;Npe.Nodes=(function(){let t=new jt(`float rand(float n) {
				return fract(sin(n) * 43758.5453123);
			}`),e=new jt(`float hash1(float p) { 
				p = fract(p * 0.011); 
				p *= p + 7.5; 
				p *= p + p; 
				return fract(p); 
			}`),i=new jt(`float valueNoise(vec3 x) {
				const vec3 step = vec3(110, 241, 171);
			
				vec3 i = floor(x);
				vec3 f = fract(x);
			 
				// For performance, compute the base input to a 1D hash from the integer part of the argument and the 
				// incremental change to the 1D based on the 3D -> 1D wrapping
				float n = dot(i, step);
			
				vec3 u = f * f * (3.0 - 2.0 * f);
				return mix(mix(mix( hash1(n + dot(step, vec3(0, 0, 0))), hash1(n + dot(step, vec3(1, 0, 0))), u.x),
							   mix( hash1(n + dot(step, vec3(0, 1, 0))), hash1(n + dot(step, vec3(1, 1, 0))), u.x), u.y),
						   mix(mix( hash1(n + dot(step, vec3(0, 0, 1))), hash1(n + dot(step, vec3(1, 0, 1))), u.x),
							   mix( hash1(n + dot(step, vec3(0, 1, 1))), hash1(n + dot(step, vec3(1, 1, 1))), u.x), u.y), u.z);
			}`,[e]),r=new jt(`vec3 hash3(vec3 x) {
				x = vec3(dot(x,vec3(127.1, 311.7, 74.7)),
						 dot(x,vec3(269.5, 183.3, 246.1)),
						 dot(x,vec3(113.5, 271.9, 124.6)));
			
				return fract(sin(x)*43758.5453123);
			}`),n=new jt(`vec3 voronoiNoise(in vec3 x)
			{
				vec3 p = floor(x);
				vec3 f = fract(x);

				float id = 0.0;
				vec2 res = vec2(100.0);

				for(int k=-1; k<=1; k++)
				for(int j=-1; j<=1; j++)
				for(int i=-1; i<=1; i++)
				{
					vec3 b = vec3(float(i), float(j), float(k));

					// Comment out the "+ hash(p + b);" part below to get "square" cells
					vec3 r = vec3(b) - f + hash3(p + b);
					float d = dot(r, r);

					if (d < res.x)
					{
						id = dot(p + b, vec3(1.0, 57.0, 113.0));
						res = vec2(d, res.x);			
					}
					else if (d < res.y)
					{
						res.y = d;
					}
				}

				return vec3(sqrt(res), abs(id));
			}
			`,[r]);return{toon:new jt(`vec3 toon(int positioning, vec4 colors[COLORS_MAX], float steps[COLORS_MAX], vec3 source, bool isWorldSpace, float noiseStrength, float noiseScale, vec4 shadowColor, vec3 offset, float mask, float alpha, out float calpha) {
				float t = 0.0;
				float shadow = 1.0;

				if (positioning == 0) {

					// Can't do this mode if lighting is "none"
					#if (defined(PHONG) || defined(LAMBERT) || defined(STANDARD))

						// Algorithm from Chapter 10 of Graphics Shaders
						const vec3 weights = vec3(0.2125, 0.7154, 0.0721);
						vec3 lpos;
						vec3 l;
						float dproduct;

						#if (NUM_POINT_LIGHTS > 0)

							#if defined(USE_SHADOWMAP) && (NUM_POINT_LIGHT_SHADOWS > 0)
								PointLightShadow pointLightShadow;
							#endif 

							#pragma unroll_loop_start
							for (int i = 0; i < NUM_POINT_LIGHTS; i++) {
								// Light positions are in view-space for some reason?
								lpos = (inverse(viewMatrix) * vec4(pointLights[UNROLLED_LOOP_INDEX].position, 1.0)).xyz;
								l = normalize(lpos - worldPosition);
								
								dproduct = dot(l, normalize(worldNormal)) * 0.5 + 0.5;
								
								// TODO: we want to use "intensity" but it isn't available in the shader code
								//dproduct += dot(pointLights[UNROLLED_LOOP_INDEX].color, weights);

								t = max(t, dproduct);

								// Accumulate shadow contribution
								#if defined(USE_SHADOWMAP) && (UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS)
									pointLightShadow = pointLightShadows[UNROLLED_LOOP_INDEX];
									shadow *= getPointShadow( 
											pointShadowMap[UNROLLED_LOOP_INDEX], 
											pointLightShadow.shadowMapSize, 
											pointLightShadow.shadowBias, 
											pointLightShadow.shadowRadius,
											vPointShadowCoord[UNROLLED_LOOP_INDEX], 
											pointLightShadow.shadowCameraNear, 
											pointLightShadow.shadowCameraFar);
								#endif
							}
							#pragma unroll_loop_end

						#endif

						#if NUM_DIR_LIGHTS > 0 
							
							#if defined(USE_SHADOWMAP) && (NUM_DIR_LIGHT_SHADOWS > 0)
								DirectionalLightShadow directionalLightShadow;
							#endif 

							#pragma unroll_loop_start
							for (int i = 0; i < NUM_DIR_LIGHTS; i++) {
								// Use the direction vector for directional lights instead
								l = (inverse(viewMatrix) * vec4(directionalLights[UNROLLED_LOOP_INDEX].direction, 0.0)).xyz;
		
								dproduct = dot(l, normalize(worldNormal)) * 0.5 + 0.5;
								t = max(t, dproduct);

								// Accumulate shadow contribution
								#if defined(USE_SHADOWMAP) && (UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS)
									directionalLightShadow = directionalLightShadows[UNROLLED_LOOP_INDEX];
									shadow *= getShadow( 
										UNROLLED_LOOP_INDEX,
										directionalShadowMap[UNROLLED_LOOP_INDEX], 
										directionalLightShadow.shadowMapSize, 
										directionalLightShadow.shadowBias, 
										directionalLightShadow.shadowRadius, 
										vDirectionalShadowCoord[UNROLLED_LOOP_INDEX]);
								#endif
							}
							#pragma unroll_loop_end

						#endif

						#if NUM_SPOT_LIGHTS > 0 
							
							#if defined(USE_SHADOWMAP) && (NUM_SPOT_LIGHT_SHADOWS > 0)
								SpotLightShadow spotLightShadow;
							#endif 

							#pragma unroll_loop_start
							for (int i = 0; i < NUM_SPOT_LIGHTS; i++) {
								lpos = (inverse(viewMatrix) * vec4(spotLights[UNROLLED_LOOP_INDEX].position, 1.0)).xyz;
								l = normalize(lpos - worldPosition);
								
								dproduct = dot(l, normalize(worldNormal)) * 0.5 + 0.5;
								t = max(t, dproduct);

								// Accumulate shadow contribution
								#if defined(USE_SHADOWMAP) && (UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS)
									spotLightShadow = spotLightShadows[UNROLLED_LOOP_INDEX];
									shadow *= getShadow(
										UNROLLED_LOOP_INDEX,
										spotShadowMap[UNROLLED_LOOP_INDEX], 
										spotLightShadow.shadowMapSize, 
										spotLightShadow.shadowBias, 
										spotLightShadow.shadowRadius, 
										vSpotLightCoord[UNROLLED_LOOP_INDEX]);
								#endif
							}
							#pragma unroll_loop_end

						#endif

						t = clamp(t, 0.0, 1.0);
				
					#endif

				} else if (positioning == 1) {
					
					vec3 origin = mix(position, worldPosition, float(isWorldSpace));
					vec3 direction = normalize(source - origin);
					t = dot(direction, normalize(worldNormal)) * 0.5 + 0.5;	

				} else {

					vec3 origin = worldPosition;
					vec3 source = cameraPosition - offset;
					vec3 direction = normalize(source - origin);
					t = dot(direction, normalize(worldNormal)) * 0.5 + 0.5;	
					
				}

				if (noiseStrength > 0.0) {
					// Distort with noise
					vec3 st = position / noiseScale;
					
					// Voronoi "smooth" noise
					float noise = 1.0 - voronoiNoise(st).x;

					// Voronoi cellular noise
					//float noise = 1.0 - rand(voronoiNoise(st).z);

					// Position warp noise
					// vec3 offset = vec3(
					// 	simplexFast(st),
					// 	simplexFast(st + vec3(111.1, 143.89, 217.19)),
					// 	simplexFast(st + vec3(171.1, 247.89, 117.23))
					// );
					// st += offset;
					// float noise = valueNoise(st);

					t += noise * noiseStrength;
				}

				t = clamp(t, 0.0, 1.0);

				// Compute ramp color
				float p;
				vec4 color = colors[0];
				for (int i = 1; i < COLORS_MAX; i++) {
					p = clamp((t - steps[i-1]) / (steps[i] - steps[i-1]), 0.0, 1.0);
					color = mix(color, colors[i], smoothstep(0.0, 1.0, p));
				}

				// Incorporate custom shadow color
				if (positioning == 0) {

					vec3 blendedShadow = mix(color.rgb, shadowColor.rgb, shadowColor.a);
					color.rgb = mix(blendedShadow, color.rgb, shadow);
				
				}

				// Accumulate alpha as usual
				float lalpha = alpha * color.a * mask;
				calpha =  lalpha / clamp(lalpha + accumAlpha, 0.00001, 1.0);
				accumAlpha += (1.0 - accumAlpha) * lalpha;

				return color.xyz;

            }`,[Yl.simplexFast,t,i,n])}})();var cot=(function(){return{textureBicubic:new jt(`float w0( float a ) {
            return ( 1.0 / 6.0 ) * ( a * ( a * ( - a + 3.0 ) - 3.0 ) + 1.0 );
        }
    
        float w1( float a ) {
            return ( 1.0 / 6.0 ) * ( a *  a * ( 3.0 * a - 6.0 ) + 4.0 );
        }
    
        float w2( float a ){
            return ( 1.0 / 6.0 ) * ( a * ( a * ( - 3.0 * a + 3.0 ) + 3.0 ) + 1.0 );
        }
    
        float w3( float a ) {
            return ( 1.0 / 6.0 ) * ( a * a * a );
        }
    
        // g0 and g1 are the two amplitude functions
        float g0( float a ) {
            return w0( a ) + w1( a );
        }
    
        float g1( float a ) {
            return w2( a ) + w3( a );
        }
    
        // h0 and h1 are the two offset functions
        float h0( float a ) {
            return - 1.0 + w1( a ) / ( w0( a ) + w1( a ) );
        }
    
        float h1( float a ) {
            return 1.0 + w3( a ) / ( w2( a ) + w3( a ) );
        }
    
        vec4 bicubic( sampler2D tex, vec2 uv, vec4 texelSize, float lod ) {
            uv = uv * texelSize.zw + 0.5;
    
            vec2 iuv = floor( uv );
            vec2 fuv = fract( uv );
    
            float g0x = g0( fuv.x );
            float g1x = g1( fuv.x );
            float h0x = h0( fuv.x );
            float h1x = h1( fuv.x );
            float h0y = h0( fuv.y );
            float h1y = h1( fuv.y );
    
            vec2 p0 = ( vec2( iuv.x + h0x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
            vec2 p1 = ( vec2( iuv.x + h1x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
            vec2 p2 = ( vec2( iuv.x + h0x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
            vec2 p3 = ( vec2( iuv.x + h1x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
    
            return g0( fuv.y ) * ( g0x * textureLod( tex, p0, lod ) + g1x * textureLod( tex, p1, lod ) ) + 
                   g1( fuv.y ) * ( g0x * textureLod( tex, p2, lod ) + g1x * textureLod( tex, p3, lod ) );
        }

        vec4 textureBicubic( sampler2D sampler, vec2 uv, float lod ) {
            vec2 fLodSize = vec2( textureSize( sampler, int( lod ) ) );
            vec2 cLodSize = vec2( textureSize( sampler, int( lod + 1.0 ) ) );
            vec2 fLodSizeInv = 1.0 / fLodSize;
            vec2 cLodSizeInv = 1.0 / cLodSize;
            vec4 fSample = bicubic( sampler, uv, vec4( fLodSizeInv, fLodSize ), floor( lod ) );
            vec4 cSample = bicubic( sampler, uv, vec4( cLodSizeInv, cLodSize ), ceil( lod ) );
            return mix( fSample, cSample, fract( lod ) );
        }`)}})();function uot(t,e){return t>=e?new Ae(e/t,1):new Ae(1,t/e)}var Upe=class extends dn{constructor(t,e,i,r,n,s,a,o){super("v3"),this.nodeType="Transmission",this.thickness=t,this.ior=e,this.roughness=i,this.transmissionSamplerSize=r,this.transmissionSamplerMap=n,this.transmissionDepthMap=s,this.aspectRatio=a,this.alpha=o,this.calpha=`g${this.uuid.toString().replace(/-/g,"")}_calpha`}generate(t,e){if(t.extensions.shaderTextureLOD=!0,t.extensions.derivatives=!0,t.isShader("fragment")){t.define("NUM_SAMPLES",6),t.define("BLUR_SLOD",Math.pow(2,Ri.transmissionLod.value)),t.require("worldPosition"),t.requires.worldNormal=!0,t.requires.modelMatrix=!0,t.requires.projectionMatrix=!0,t.addFragmentVariable(this.calpha,"float");let i=t.include(Upe.Nodes.transmission),r=[];return r.push(this.thickness.build(t,"f")),r.push(this.ior.build(t,"f")),r.push(this.roughness.build(t,"f")),r.push(this.transmissionSamplerSize.build(t,"v2")),r.push(this.transmissionSamplerMap.getTexture(t,"t")),r.push(this.transmissionDepthMap.getTexture(t,"t")),r.push(this.aspectRatio.build(t,"v2")),r.push("normal"),r.push(this.mask?`luminance(${this.mask.flow(t,"v3").result})`:"1.0"),r.push(this.alpha.build(t,"f")),r.push(this.calpha),t.format(i+"("+r.join(",")+")",this.getType(t),e)}else return console.warn("TransmissionNode is not compatible with "+t.shader+" shader."),t.format("vec3( 0.0 )",this.getType(t),e)}},Bpe=Upe;Bpe.Nodes=(function(){let t=new jt(`vec3 blur(sampler2D sp, vec2 U, vec2 scale, float lod, sampler2D dm, vec2 unrefractedU, vec2 aspectRatio) {
                // Slightly modified version of this:
                // https://www.shadertoy.com/view/ltScRG

				// Special case for blur == 0.0
				if (lod == 0.0) {
					#ifdef TEXTURE_LOD_EXT
					return texture2DLodEXT( sp, U, 0.0).rgb;
					#else
					return textureLod( sp, U, 0.0).rgb;
					#endif
				}
				
				vec2 texelSize = vec2(1.0) / resolution;
                vec2 halton = haltonSequence[frameIndex];
                float temporalOffset = getNoiseInterleavedGradient(gl_FragCoord.xy + halton);
                float temporalAngle  = temporalOffset * PI2;
				vec3 res = vec3(0.0);
                vec2 uv = vec2(0.0);
                vec2 offset = vec2(0.0);
                vec2 vogelSample = vec2(0.0);
                for (int i = 0; i < NUM_SAMPLES; i++) {
                    vogelSample =  vogelDiskSample(i, NUM_SAMPLES, temporalAngle) * texelSize;
                    offset = vogelSample * scale * (lod * 10.0); // TODO: used to be hardcoded to 20
                    uv = U + offset;
                    float opaqueDepth = unpackRGBAToDepth(textureLod(dm, uv, lod));
                    if (opaqueDepth != 0.0 && opaqueDepth < gl_FragCoord.z) {
                        uv = unrefractedU;
                        lod = lod > 4.0 ? lod : lod / 2.0;
                    }
                    res += textureLod(sp, uv, lod).rgb;
                }
                return res / float(NUM_SAMPLES);
            }`),e=new jt(`vec3 getVolumeTransmissionRay( vec3 n, vec3 v, float thickness, float ior, mat4 modelMatrix ) {
		        // Direction of refracted light.
		        vec3 refractionVector = refract( -v,  n, 1.0 / ior );
		        
				// Compute rotation-independant scaling of the model matrix.
		        vec3 modelScale;
		        modelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );
		        modelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );
		        modelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );

		        // The thickness is specified in local space
		        return normalize( refractionVector ) * thickness * modelScale;
	        }`),i=new jt(`float applyIorToRoughness( float roughness, float ior ) {
				// Scale roughness with IOR so that an IOR of 1.0 results in no microfacet refraction and
				// an IOR of 1.5 results in the default amount of microfacet refraction.
				return roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );
			}`),r=new jt(`vec3 getTransmissionSample( vec2 fragCoord, float roughness, float ior, vec2 transmissionSamplerSize, sampler2D transmissionSamplerMap, sampler2D transmissionDepthMap, vec2 unrefractedCoords, vec2 aspectRatio) {
				// Threejs exports do not pass a depth map to this shader, so we have to fallback to the "Threejs method of blurring" - see
				// also the code in convertTransmission.ts, which runs during export
				#ifdef IS_THREEJS_EXPORT
					float lod = log2(transmissionSamplerSize.x) * applyIorToRoughness(roughness / 5.0, ior);
					return textureBicubic(transmissionSamplerMap, fragCoord.xy, lod).rgb;
				#else
					float framebufferLod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );
					float lod = applyIorToRoughness(roughness, ior);
					return blur(transmissionSamplerMap, fragCoord, vec2(lod), min(framebufferLod / 5.5, 8.5), transmissionDepthMap, unrefractedCoords, aspectRatio);
				#endif
			}`,[cot.textureBicubic,i,t]),n=new jt(`vec3 getIBLVolumeRefraction( vec3 n, vec3 v, float roughness, vec3 position, mat4 modelMatrix, mat4 viewMatrix, mat4 projMatrix, float ior, float thickness, vec2 transmissionSamplerSize, sampler2D transmissionSamplerMap, sampler2D transmissionDepthMap, vec2 aspectRatio ) {
				vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );
				vec3 refractedRayExit = position + transmissionRay;

				// Project refracted vector on the framebuffer, while mapping to normalized device coordinates.
				vec4 ndcPos = projMatrix * viewMatrix *  vec4( refractedRayExit, 1.0 );
				vec2 refractionCoords = ndcPos.xy / ndcPos.w;
				refractionCoords += 1.0;
				refractionCoords /= 2.0;

				vec4 ndcPosUnrefracted = projMatrix * viewMatrix * vec4(position, 1.0 );
				vec2 unrefractedCoords = ndcPosUnrefracted.xy / ndcPosUnrefracted.w;
				unrefractedCoords += 1.0;
				unrefractedCoords /= 2.0;

				// Sample framebuffer to get pixel the refracted ray hits.
				return getTransmissionSample( refractionCoords, roughness, ior, transmissionSamplerSize, transmissionSamplerMap, transmissionDepthMap, unrefractedCoords, aspectRatio );
    		}`,[r,e]);return{transmission:new jt(`vec3 transmission(float thickness, float ior, float roughness, vec2 transmissionSamplerSize, sampler2D transmissionSamplerMap, sampler2D transmissionDepthMap, vec2 aspectRatio, vec3 normal, float mask, float alpha, out float calpha) {
                vec3 v = vec3(0.);
                if (isOrthographic) {
                    v = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
                } else {
                    v = normalize(vWPosition - cameraPosition);
                }
                vec3 transmission = getIBLVolumeRefraction(vWNormal, -v, roughness,  vWPosition, modelMatrix, viewMatrix, projectionMatrix, ior, thickness, transmissionSamplerSize, transmissionSamplerMap, transmissionDepthMap, aspectRatio );
                
				float lalpha = alpha * mask;
				calpha =  lalpha / clamp( lalpha + accumAlpha, 0.00001, 1.0 );
				accumAlpha += ( 1.0 - accumAlpha ) * alpha;

				return transmission;
            }`,[n])}})();var Y5=(t=>(t.NOISE="noise",t.MAP="map",t))(Y5||{}),Fpe=class extends dn{constructor(t,e,i,r,n,s,a,o,l,c,u){super("v3"),this.displacementTypeIndex=new vn(0),this.nodeType="VertexDisplacement",this.intensity=t,this.movementOrTexture=e,Object.values(Y5)[this.displacementTypeIndex.value]==="map"&&(this.mat=new bpe(this.movementOrTexture.value.matrix)),this.cropOrOffset=i,this.scale=c,this.noiseFunctionIndex=u,this.voronoiStyle=r,this.smoothness=n,this.seed=s,this.highCut=a,this.lowCut=o,this.quality=l}generate(t,e){if(t.isShader("vertex")){t.define("USE_LAYER_DISPLACE");let i,r=[];switch(r.push("displaced_position"),r.push("displaced_normal"),Object.values(Y5)[this.displacementTypeIndex.value]){case"map":{i=t.include(Fpe.Nodes.map),r.push(this.movementOrTexture.getTexture(t,"t")),r.push("uv"),r.push(this.cropOrOffset.build(t,"f")),this.mat&&r.push(this.mat.build(t,"mat3"));break}case"noise":{let n=["simplexPrecise","simplexFractal","simplexAshima","fbm","perlin","voronoi"][this.noiseFunctionIndex.value],s=new jt(`vec3 orthogonal(vec3 v) {
							return normalize(abs(v.x) > abs(v.z) ? vec3(-v.y, v.x, 0.0) : vec3(0.0, -v.z, v.y));
						}`),a=n=="voronoi"?`
					float v = ${n}((p + offset) * scale * 0.001 + neighbour_offset + (movement * 0.1), voronoiStyle, smoothness, seed, quality);
					v = remap(v, lowCut, highCut, 0.0, 1.0);
					v = smax(v, 0.0, smoothness * 0.25);
					v = smin(v, 1.0, smoothness * 0.25);

					return p + n * v * intensity;
					`:`
					return p + n * ${n}((p + offset) * scale * 0.001 + neighbour_offset + (movement * 0.1)) * intensity;
					`,o=new jt(`vec3 distorted(vec3 p, vec3 n, float scale, float intensity, vec3 offset, float neighbour_offset, float movement, int voronoiStyle, float smoothness, float seed, float highCut, float lowCut, int quality) {
							${a}
						}`,[Yl.simplexPrecise,Yl.simplexFractal,Yl.simplexAshima,Yl.fbm,Yl.perlin,Yl.voronoi]),l=new jt(`vec3 vertexDisplacementNoise(vec3 position, vec3 normal, float scale, vec3 offset, float movement, int voronoiStyle, float smoothness, float seed, float highCut, float lowCut, int quality, float intensity, out vec3 displaced_normal) {
							vec3 displaced_position = distorted(position, normal, scale, intensity, offset, neighbor_offset, movement, voronoiStyle, smoothness, seed, highCut, lowCut, quality);
							vec3 tangent1 = orthogonal(normal);
							vec3 tangent2 = normalize(cross(normal, tangent1));

                            // TODO(Max): The distance to the neighbors was originally scaled by 0.1.
                            // This caused some small oval/circular visual artifacts in the lighting.
                            // For now, simply using neighbors further away betters the problem,
                            // but we should figure out the underlying cause when we have some time.
                            // Maybe its related to how we calculate the tangent and bitangent?
							vec3 nearby1 = position + tangent1;
							vec3 nearby2 = position + tangent2;
							vec3 distorted1 = distorted(nearby1, normal, scale, intensity, offset, neighbor_offset, movement, voronoiStyle, smoothness, seed, highCut, lowCut, quality);
							vec3 distorted2 = distorted(nearby2, normal, scale, intensity, offset, neighbor_offset, movement, voronoiStyle, smoothness, seed, highCut, lowCut, quality);
							displaced_normal = normalize(cross(distorted1 - displaced_position, distorted2 - displaced_position));
							return displaced_position;
						}`,[o,s]);i=t.include(l),r.push(this.scale.build(t,"f")),r.push(this.cropOrOffset.build(t,"v3")),r.push(this.movementOrTexture.build(t,"f")),r.push(this.voronoiStyle.build(t,"i")),r.push(this.smoothness.build(t,"f")),r.push(this.seed.build(t,"f")),r.push(this.highCut.build(t,"f")),r.push(this.lowCut.build(t,"f")),r.push(this.quality.build(t,"i"));break}}return r.push(this.intensity.build(t,"f")),r.push("displaced_normal"),t.format(i+"("+r.join(",")+")",this.getType(t),e)}else return console.warn("VertexDisplacementNode is not compatible with "+t.shader+" shader."),t.format("vec3( 0.0 )",this.getType(t),e)}},zpe=Fpe;zpe.Nodes=(function(){let t=new jt(`vec3 orthogonal(vec3 v) {
				return normalize(abs(v.x) > abs(v.z) ? vec3(-v.y, v.x, 0.0) : vec3(0.0, -v.z, v.y));
			}`),e=new jt(`float displacementMapTexture(sampler2D tex, float crop, vec2 uv, mat3 mat, vec2 offset) {
				vec2 uvs = (mat * vec3(uv * 2.0 - 1.0, 1.0) / 2.0 + 0.5).xy + offset;
				vec4 tmp = texture2D(tex, uvs);
				vec3 col = tmp.rgb;
				if (crop > 0.5) {
					if ( uvs.x < 0.0 || uvs.x > 1.0 || uvs.y < 0.0 || uvs.y > 1.0 )  {
						return 0.0;
					}
				}
				return col.r;
			}`);return{map:new jt(`vec3 vertexDisplacementMap(vec3 position, vec3 normal, sampler2D tex, vec2 uv, float crop, mat3 mat, float intensity, out vec3 displaced_normal) {
				vec3 displaced_position = position + normal * displacementMapTexture(tex, crop, uv, mat, vec2(0.0)) * intensity;
				vec3 tangent1 = normalize(orthogonal(normal));
				vec3 tangent2 = normalize(cross(normal, tangent1));
				vec3 nearby1 = position + tangent1 * 0.1;
				vec3 nearby2 = position + tangent2 * 0.1;
				vec3 distorted1 = nearby1 + normal * displacementMapTexture(tex, crop, uv, mat, vec2(neighbor_offset)) * intensity;
				vec3 distorted2 = nearby2 + normal * displacementMapTexture(tex, crop, uv, mat, vec2(neighbor_offset)) * intensity;
				displaced_normal = normalize(cross(distorted1 - displaced_position, distorted2 - displaced_position));
				return displaced_position;
			}`,[t,e])}})();var Ri={normalRenderTarget:new _p,normalRenderTargetDepth:new _p,transmissionRenderTarget:new _p,aspectRatio:new mo,transmissionSize:new mo(2048,2048),transmissionRenderTargetDepth:new _p,aoRenderTarget:new _p,aoEnabled:new ml,pixelRatioNode:new Kt(1),resolution:new mo,penumbraSize:new By(5,.5),frameIndex:new vn(0),transmissionLod:new vn(2)};for(let t of Object.values(Ri))t.isRenderGlobal=!0;var jpe={skiaWasmUrl:"https://unpkg.com/@splinetool/ui-wasm@1.10.72/build/ui.wasm"},l8=class extends da{constructor(){super("basic"),this.nodeType="Basic",this.color=new os(Uc),this.shadingAlpha=new Kt(1),this.shadingBlend=new vn(0),this.previousModelViewMatrix=new nf,this.previouseProjectionMatrix=new nf}get category(){return"phong"}generate(t){let e;if(t.isShader("vertex")){let i=this.position?this.position.analyzeAndFlow(t,"v3",{cache:"position"}):void 0;t.mergeUniform({frameIndex:Ri.frameIndex}),t.mergeUniform({resolution:Ri.resolution}),t.mergeUniform({previousModelViewMatrix:this.previousModelViewMatrix}),t.mergeUniform({previousProjectionMatrix:this.previouseProjectionMatrix}),t.mergeUniform(A_.merge([Bt.fog])),t.addParsCode(["varying vec3 vViewPosition;","varying vec3 vWPosition;","#include <fog_pars_vertex>","#include <skinning_pars_vertex>","#include <normal_pars_vertex>","#include <morphtarget_pars_vertex>"].join(`
`));let r=["#include <beginnormal_vertex>","#include <morphnormal_vertex>",`
				#include <skinbase_vertex>
				#include <skinnormal_vertex>
				#if !defined( USE_LAYER_DISPLACE )
					#include <defaultnormal_vertex>
				#endif

				vec3 displaced_position = position;
				vec3 displaced_normal = normal;

				#if defined( USE_LAYER_DISPLACE )
					vec3 transformed;
					vec3 transformedNormal;
				#endif
				`,"#include <normal_vertex>",`
				#if !defined( USE_LAYER_DISPLACE )
					#include <begin_vertex>
				#endif /* !USE_LAYER_DISPLACE */
				`];i&&r.push(i.code,i.result?"displaced_position = "+i.result+";":""),r.push("transformed = displaced_position;","#include <morphtarget_vertex>","#include <skinning_vertex>","transformedNormal = normalMatrix * displaced_normal;","#ifndef FLAT_SHADED","	vNormal = transformedNormal;","#endif"),r.push("#include <project_vertex>","#include <fog_vertex>","#include <clipping_planes_vertex>","	vViewPosition = - mvPosition.xyz;","#include <worldpos_vertex>"),r.push("vWPosition = ( modelMatrix * vec4( transformed, 1.0 ) ).xyz;"),e=r.join(`
`)}else{this.color===void 0&&(this.color=new os(Uc)),this.color.analyze(t,{slot:"color"}),this.alpha&&this.alpha.analyze(t),this.afterColor&&this.afterColor.analyze(t,{slot:"afterColor"});let i=this.color.flow(t,"c",{slot:"color"}),r=this.alpha?this.alpha.flow(t,"f"):void 0,n=this.alphaOverride?this.alphaOverride.flow(t,"f"):void 0,s=this.afterColor?this.afterColor.flow(t,"c",{slot:"afterColor"}):void 0;t.requires.transparent=r!==void 0,t.addParsCode(["varying vec3 vWPosition;","#include <fog_pars_fragment>","#include <dithering_pars_fragment>","varying vec3 vViewPosition;","#include <normal_pars_fragment>"].join(`
`));let a=["#include <normal_fragment_begin>",i.code];r&&a.push(r.code,"#ifdef ALPHATEST"," if ( "+r.result+" <= ALPHATEST ) discard;","#endif"),s?a.push(s.code,`vec3 outgoingLight = ${i.result};`,`vec3 finalColor = spe_blend(outgoingLight, ${s.result}, 1.0, SPE_BLENDING_NORMAL);`):a.push(`vec3 finalColor = ${i.result};`);let o="1.0";this.mask&&(this.mask.analyze(t),o=`luminance(${this.mask.flow(t,"v3").result})`),r?a.push(`gl_FragColor = vec4( finalColor, accumAlpha * ${r.result} * ${o} );`):a.push("gl_FragColor = vec4("+i.result+", 1.0 );"),n&&a.push(`gl_FragColor.a *= ${n.result};`),a.push("#include <fog_fragment>","#include <dithering_fragment>"),e=a.join(`
`)}return e}},hot=class extends da{constructor(){super("lambert"),this.nodeType="Lambert",this.color=new os(Uc),this.emissive=new os(0),this.emissiveIntensity=new Kt(1),this.previousModelViewMatrix=new nf,this.previouseProjectionMatrix=new nf,this.shadingAlpha=new Kt(1),this.shadingBlend=new vn(0),this.occlusion=new ml(!0)}get category(){return"lambert"}build(t){let e;if(t.define("LAMBERT"),t.requires.lights=!0,t.extensions.derivatives=!0,t.isShader("vertex")){let i=this.position?this.position.analyzeAndFlow(t,"v3",{cache:"position"}):void 0;t.mergeUniform({frameIndex:Ri.frameIndex}),t.mergeUniform({resolution:Ri.resolution}),t.mergeUniform({previousModelViewMatrix:this.previousModelViewMatrix}),t.mergeUniform({previousProjectionMatrix:this.previouseProjectionMatrix}),t.mergeUniform(A_.merge([Bt.fog,Bt.lights])),t.addParsCode(["varying vec3 vViewPosition;","varying vec3 vWPosition;","varying vec3 vLightFront;","varying vec3 vIndirectFront;","#ifndef DOUBLE_SIDED","   #define DOUBLE_SIDED","#endif","#ifdef DOUBLE_SIDED","	varying vec3 vLightBack;","	varying vec3 vIndirectBack;","#endif","#include <bsdfs>","#include <lights_pars_begin>","#include <color_pars_vertex>","#include <fog_pars_vertex>","#include <skinning_pars_vertex>","#include <normal_pars_vertex>","#include <morphtarget_pars_vertex>","#include <shadowmap_pars_vertex>","#include <clipping_planes_pars_vertex>"].join(`
`));let r=["#include <beginnormal_vertex>","#include <morphnormal_vertex>",`
				#include <skinbase_vertex>
				#include <skinnormal_vertex>
				#ifndef USE_LAYER_DISPLACE
					#include <defaultnormal_vertex>
				#endif

				vec3 displaced_position = position;
				vec3 displaced_normal = objectNormal;

				#ifdef USE_LAYER_DISPLACE
					vec3 transformed;
					vec3 transformedNormal;
				#endif
				`,"#include <normal_vertex>",`
				#ifndef USE_LAYER_DISPLACE
					#include <begin_vertex>
				#endif
				`];i&&r.push(i.code,i.result?"displaced_position = "+i.result+";":""),r.push("transformed = displaced_position;","#include <morphtarget_vertex>","#include <skinning_vertex>","transformedNormal = normalMatrix * displaced_normal;","#ifndef FLAT_SHADED","    vNormal = transformedNormal;","#endif"),r.push("	#include <project_vertex>","	#include <clipping_planes_vertex>","	vViewPosition = - mvPosition.xyz;","	#include <worldpos_vertex>",`
					vec3 diffuse = vec3( 1.0 );
					GeometricContext geometry;
					geometry.position = mvPosition.xyz;
					geometry.normal = normalize( transformedNormal );
					geometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( -mvPosition.xyz );
				`),r.push(`
					GeometricContext backGeometry;
					backGeometry.position = geometry.position;
					backGeometry.normal = -geometry.normal;
					backGeometry.viewDir = geometry.viewDir;
					vLightFront = vec3( 0.0 );
					vIndirectFront = vec3( 0.0 );
					#ifdef DOUBLE_SIDED
						vLightBack = vec3( 0.0 );
						vIndirectBack = vec3( 0.0 );
					#endif
					IncidentLight directLight;
					float dotNL;
					vec3 directLightColor_Diffuse;
					vIndirectFront += getAmbientLightIrradiance( ambientLightColor );
					vIndirectFront += getLightProbeIrradiance( lightProbe, geometry.normal );
					#ifdef DOUBLE_SIDED
						vIndirectBack += getAmbientLightIrradiance( ambientLightColor );
						vIndirectBack += getLightProbeIrradiance( lightProbe, backGeometry.normal );
					#endif
					#if NUM_POINT_LIGHTS > 0
						#pragma unroll_loop_start
						for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
							getPointLightInfo( pointLights[ i ], geometry, directLight );
							dotNL = dot( geometry.normal, directLight.direction );
							directLightColor_Diffuse = directLight.color;
							vLightFront += saturate( dotNL ) * directLightColor_Diffuse;
							#ifdef DOUBLE_SIDED
								vLightBack += saturate( -dotNL ) * directLightColor_Diffuse;
							#endif
						}
						#pragma unroll_loop_end
					#endif
					#if NUM_SPOT_LIGHTS > 0
						#pragma unroll_loop_start
						for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
							getSpotLightInfo( spotLights[ i ], geometry, directLight );
							dotNL = dot( geometry.normal, directLight.direction );
							directLightColor_Diffuse = directLight.color;
							vLightFront += saturate( dotNL ) * directLightColor_Diffuse;
							#ifdef DOUBLE_SIDED
								vLightBack += saturate( -dotNL ) * directLightColor_Diffuse;
							#endif
						}
						#pragma unroll_loop_end
					#endif
					#if NUM_DIR_LIGHTS > 0
						#pragma unroll_loop_start
						for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
							getDirectionalLightInfo( directionalLights[ i ], geometry, directLight );
							dotNL = dot( geometry.normal, directLight.direction );
							directLightColor_Diffuse = directLight.color;
							vLightFront += saturate( dotNL ) * directLightColor_Diffuse;
							#ifdef DOUBLE_SIDED
								vLightBack += saturate( -dotNL ) * directLightColor_Diffuse;
							#endif
						}
						#pragma unroll_loop_end
					#endif
					#if NUM_HEMI_LIGHTS > 0
						#pragma unroll_loop_start
						for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
							vIndirectFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );
							#ifdef DOUBLE_SIDED
								vIndirectBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry.normal );
							#endif
						}
						#pragma unroll_loop_end
					#endif
				`,"	#include <shadowmap_vertex>","	#include <fog_vertex>"),r.push("vWPosition = ( modelMatrix * vec4( transformed, 1.0 ) ).xyz;"),e=r.join(`
`)}else{t.mergeUniform({penumbraSize:Ri.penumbraSize}),t.mergeUniform({frameIndex:Ri.frameIndex}),t.mergeUniform({aoMap:Ri.aoRenderTarget}),t.mergeUniform({aoEnabled:Ri.aoEnabled}),this.color===void 0&&(this.color=new os(Uc)),this.color.analyze(t,{slot:"color"}),this.shadingAlpha.analyze(t),this.shadingBlend.analyze(t),this.afterColor&&this.afterColor.analyze(t,{slot:"afterColor"}),this.alpha&&this.alpha.analyze(t);let i=this.color.flow(t,"c",{slot:"color"}),r=this.emissive.flow(t,"c",{slot:"emissive"}),n=this.emissiveIntensity.flow(t,"f",{slot:"emissive"}),s=this.occlusion.flow(t,"b",{slot:"occlusion"}),a=this.shadingAlpha.flow(t,"f"),o=this.shadingBlend.flow(t,"i"),l=this.afterColor?this.afterColor.flow(t,"c",{slot:"afterColor"}):void 0,c=this.alpha?this.alpha.flow(t,"f"):void 0,u=this.alphaOverride?this.alphaOverride.flow(t,"f"):void 0;t.requires.transparent=c!==void 0,t.addParsCode(["uniform float penumbraSize[5];","uniform sampler2D aoMap;","uniform bool aoEnabled;","varying vec3 vViewPosition;","varying vec3 vWPosition;","varying vec3 vLightFront;","varying vec3 vIndirectFront;","#ifndef DOUBLE_SIDED","   #define DOUBLE_SIDED","#endif","#include <normal_pars_fragment>","#ifdef DOUBLE_SIDED","	varying vec3 vLightBack;","	varying vec3 vIndirectBack;","#endif","#include <bsdfs>","#include <lights_pars_begin>","#include <fog_pars_fragment>","#include <shadowmap_pars_fragment>","#include <shadowmask_pars_fragment>","#include <clipping_planes_pars_fragment>","#include <dithering_pars_fragment>"].join(`
`));let h=["#include <normal_fragment_begin>",`
				// NOTE: gl_FrontFacing alternative using face normal estimation.
				vec3 viewdx = dFdx(vViewPosition);
				vec3 viewdy = dFdy(vViewPosition);
				vec3 faceNormal = normalize(cross(viewdx, viewdy));
				bool isFrontFacing = (dot(normal, faceNormal) >= 0.0);
				`,"#include <clipping_planes_fragment>"];h.push(i.code,"vec3 diffuseColor = "+i.result+";","ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );"),c&&h.push(c.code,"#ifdef ALPHATEST","if ( "+c.result+" <= ALPHATEST ) discard;","#endif"),h.push("#ifdef DOUBLE_SIDED","	reflectedLight.indirectDiffuse += ( isFrontFacing ) ? vIndirectFront : vIndirectBack;","#else","	reflectedLight.indirectDiffuse += vIndirectFront;","#endif","#include <lightmap_fragment>","reflectedLight.indirectDiffuse *= BRDF_Lambert( diffuseColor.rgb );","#ifdef DOUBLE_SIDED","	reflectedLight.directDiffuse = ( isFrontFacing ) ? vLightFront : vLightBack;","#else","	reflectedLight.directDiffuse = vLightFront;","#endif","reflectedLight.directDiffuse *= BRDF_Lambert( diffuseColor.rgb ) * getShadowMask();"),r&&h.push(r.code,"reflectedLight.directDiffuse += "+r.result+" * "+n.result+";"),h.push("vec3 ao = aoEnabled && "+s.result+" ? tex2D(aoMap, gl_FragCoord.xy / resolution).rgb : vec3(1.0);","vec3 outgoingLight = (reflectedLight.directDiffuse + reflectedLight.indirectDiffuse) ;");let d="1.0";this.mask&&(this.mask.analyze(t),d=`luminance(${this.mask.flow(t,"v3").result})`),h.push(`
				if (outgoingLight != diffuseColor) {
					float lightAccu = clamp( length( reflectedLight.directSpecular + reflectedLight.indirectSpecular ), 0.0, 1.0 );
					accumAlpha += ( 1.0 - accumAlpha ) * ${a.result} * ${d} * lightAccu;
					outgoingLight = spe_blend( diffuseColor, outgoingLight, ${a.result} * ${d}, ${o.result} );

					outgoingLight *= ao;
				}
				`),l&&h.push(l.code,`outgoingLight = spe_blend(outgoingLight, ${l.result}, 1.0, SPE_BLENDING_NORMAL);`),c?h.push(`gl_FragColor = vec4( outgoingLight, accumAlpha * ${c.result} );`):h.push("gl_FragColor = vec4( outgoingLight, 1.0 );"),u&&h.push(`gl_FragColor.a *= ${u.result};`),h.push("#include <encodings_fragment>","#include <fog_fragment>","#include <dithering_fragment>"),e=h.join(`
`)}return e}},t_=(function(){let t=new jt(`vec2 dHdxy(sampler2D bumpMap, vec2 bumpMapUv, float bumpScale) {

            // Gradient of UVs w.r.t. X coordinate (in screen-space)
            vec2 dSTdx = dFdx(bumpMapUv);

            // Gradient of UVs w.r.t. Y coordinate (in screen-space)
            vec2 dSTdy = dFdy(bumpMapUv);
            
            // Forward differencing
            float Hll = bumpScale * luminance(texture(bumpMap, bumpMapUv).rgb);
            float dBx = bumpScale * luminance(texture(bumpMap, bumpMapUv + dSTdx).rgb) - Hll;
            float dBy = bumpScale * luminance(texture(bumpMap, bumpMapUv + dSTdy).rgb) - Hll;
            
            return vec2( dBx, dBy );
        }`),e=new jt(`vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {
            vec3 vSigmaX = dFdx( surf_pos.xyz );
            vec3 vSigmaY = dFdy( surf_pos.xyz );
            vec3 vN = surf_norm; // normalized
            
            vN = normalize(vN);

            vec3 R1 = cross( vSigmaY, vN );
            vec3 R2 = cross( vN, vSigmaX );

            R1 = normalize(R1);
            R2 = normalize(R2);
    
            float fDet = dot( vSigmaX, R1 ) * faceDirection;
    
            vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );
            return normalize( abs( fDet ) * vN - vGrad );
        }`);return{dHdxy:t,perturbNormalArb:e}})(),dot=class extends da{constructor(){super("phong"),this.nodeType="Phong",this.color=new os(Uc),this.specular=new os(1118481),this.shininess=new Kt(30),this.previousModelViewMatrix=new nf,this.previouseProjectionMatrix=new nf,this.shadingAlpha=new Kt(1),this.shadingBlend=new vn(0),this.occlusion=new ml(!0)}get category(){return"phong"}build(t){let e;if(t.define("PHONG"),t.requires.lights=!0,t.extensions.derivatives=!0,t.isShader("vertex")){let i=this.position?this.position.analyzeAndFlow(t,"v3",{cache:"position"}):void 0;t.mergeUniform({frameIndex:Ri.frameIndex}),t.mergeUniform({resolution:Ri.resolution}),t.mergeUniform({previousModelViewMatrix:this.previousModelViewMatrix}),t.mergeUniform({previousProjectionMatrix:this.previouseProjectionMatrix}),t.mergeUniform(A_.merge([Bt.fog,Bt.lights])),t.addParsCode(["varying vec3 vViewPosition;","varying vec3 vWPosition;","#include <fog_pars_vertex>","#include <skinning_pars_vertex>","#include <normal_pars_vertex>","#include <morphtarget_pars_vertex>","#include <shadowmap_pars_vertex>","#include <clipping_planes_pars_vertex>"].join(`
`));let r=["#include <beginnormal_vertex>","#include <morphnormal_vertex>",`
				#include <skinbase_vertex>
				#include <skinnormal_vertex>
				#ifndef USE_LAYER_DISPLACE
					#include <defaultnormal_vertex>
				#endif

				vec3 displaced_position = position;
				vec3 displaced_normal = objectNormal;

				#ifdef USE_LAYER_DISPLACE
					vec3 transformed;
					vec3 transformedNormal;
				#endif
				`,"#include <normal_vertex>",`
				#ifndef USE_LAYER_DISPLACE
					#include <begin_vertex>
				#endif
				`];i&&r.push(i.code,i.result?"displaced_position = "+i.result+";":""),r.push("transformed = displaced_position;","#include <morphtarget_vertex>","#include <skinning_vertex>","transformedNormal = normalMatrix * displaced_normal;","#ifndef FLAT_SHADED","    vNormal = transformedNormal;","#endif"),r.push("	#include <project_vertex>","	#include <clipping_planes_vertex>","	vViewPosition = - mvPosition.xyz;","	#include <worldpos_vertex>","	#include <shadowmap_vertex>","	#include <fog_vertex>"),r.push("vWPosition = ( modelMatrix * vec4( transformed, 1.0 ) ).xyz;"),e=r.join(`
`)}else{t.mergeUniform({penumbraSize:Ri.penumbraSize}),t.mergeUniform({frameIndex:Ri.frameIndex}),t.mergeUniform({aoMap:Ri.aoRenderTarget}),t.mergeUniform({aoEnabled:Ri.aoEnabled}),this.color===void 0&&(this.color=new os(Uc)),this.color.analyze(t,{slot:"color"}),this.specular.analyze(t),this.shininess.analyze(t);let i=this.occlusion.flow(t,"b",{slot:"occlusion"});this.shadingAlpha.analyze(t),this.shadingBlend.analyze(t),this.afterColor&&this.afterColor.analyze(t,{slot:"afterColor"}),this.alpha&&this.alpha.analyze(t);let r=this.color.flow(t,"c",{slot:"color"}),n=this.specular.flow(t,"c"),s=this.shininess.flow(t,"f"),a=this.shadingAlpha.flow(t,"f"),o=this.shadingBlend.flow(t,"i"),l=this.afterColor?this.afterColor.flow(t,"c",{slot:"afterColor"}):void 0,c=this.alpha?this.alpha.flow(t,"f"):void 0,u=this.alphaOverride?this.alphaOverride.flow(t,"f"):void 0;t.requires.transparent=c!==void 0,t.addParsCode(["varying vec3 vWPosition;","uniform vec3 emissive;","uniform float penumbraSize[5];","uniform sampler2D aoMap;","uniform bool aoEnabled;","#include <normal_pars_fragment>","#include <fog_pars_fragment>","#include <bsdfs>","#include <lights_pars_begin>","#include <lights_phong_pars_fragment>","#include <shadowmap_pars_fragment>","#include <dithering_pars_fragment>"].join(`
`));let h=["#include <normal_fragment_begin>",`
				// NOTE: gl_FrontFacing alternative using face normal estimation.
				vec3 viewdx = dFdx(vViewPosition);
				vec3 viewdy = dFdy(vViewPosition);
				vec3 faceNormal = normalize(cross(viewdx,viewdy));
				if (dot(normal, faceNormal) < 0.0) {
					normal *= -1.0;
				}
				`,"	BlinnPhongMaterial material;"];if(this.bumpMap){t.include(t_.dHdxy),t.include(t_.perturbNormalArb);let f=this.bumpMap.texture.flow(t,"t"),p=this.bumpMap.flow(t,"v3"),g=this.bumpMapIntensity?this.bumpMapIntensity.flow(t,"f").result:"1.0",m="";this.bumpMap.projection.value===4?m=`
					vec3 bumpNormal = vec3(0.0);
					{
						vec2 uv0 = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_writeUvs0;
						vec2 uv1 = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_writeUvs1;
						vec2 uv2 = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_writeUvs2;
						vec3 weights = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_triplanarWeights;

						vec2 grad0 = dHdxy(${f.result}, uv0, ${g});
						vec3 n0 = perturbNormalArb(-vViewPosition, normal, grad0, faceDirection);

						vec2 grad1 = dHdxy(${f.result}, uv1, ${g});
						vec3 n1 = perturbNormalArb(-vViewPosition, normal, grad1, faceDirection);

						vec2 grad2 = dHdxy(${f.result}, uv2, ${g});
						vec3 n2 = perturbNormalArb(-vViewPosition, normal, grad2, faceDirection);
						
						bumpNormal = n0 * weights.z + n1 * weights.x + n2 * weights.y;
						bumpNormal = normalize(bumpNormal);
					}

					normal = bumpNormal;
					`:m=`
					vec2 bumpMapCachedUv = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_writeUvs;
					vec2 grad = dHdxy(${f.result}, bumpMapCachedUv, ${g});
					normal = perturbNormalArb( - vViewPosition, normal, grad, faceDirection );
					`,h.push(`// Call the Texture Layer's function once here so that it writes out its procedural UV coordinates
					${p.result};
					${m}
					`)}h.push(r.code,"	vec3 diffuseColor = "+r.result+";","	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );","	vec3 totalEmissiveRadiance = emissive;",n.code,"	vec3 specular = "+n.result+";",s.code,"	float shininess = max( 0.0001, "+s.result+" );","	float specularStrength = 1.0;"),c&&h.push(c.code,"#ifdef ALPHATEST","if ( "+c.result+" <= ALPHATEST ) discard;","#endif"),h.push("material.diffuseColor = diffuseColor;"),h.push("material.specularColor = specular;","material.specularShininess = shininess;","material.specularStrength = specularStrength;","#include <lights_fragment_begin>","#include <lights_fragment_end>"),h.push("vec3 ao = aoEnabled && "+i.result+" ? tex2D(aoMap, gl_FragCoord.xy / resolution).rgb : vec3(1.0);","vec3 outgoingLight = ((reflectedLight.directDiffuse + reflectedLight.indirectDiffuse)) + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;");let d="1.0";this.mask&&(this.mask.analyze(t),d=`luminance(${this.mask.flow(t,"v3").result})`),h.push(`
				if (outgoingLight != diffuseColor) {
					float lightAccu = clamp( length( reflectedLight.directSpecular + reflectedLight.indirectSpecular ), 0.0, 1.0 );
					accumAlpha += ( 1.0 - accumAlpha ) * ${a.result} * ${d} * lightAccu;
					outgoingLight = spe_blend( diffuseColor, outgoingLight, ${a.result} * ${d}, ${o.result} );
					
					outgoingLight *= ao;
				}
				`),l&&h.push(l.code,`outgoingLight = spe_blend(outgoingLight, ${l.result}, 1.0, SPE_BLENDING_NORMAL);`),c?h.push(`gl_FragColor = vec4( outgoingLight, accumAlpha * ${c.result});`):h.push("gl_FragColor = vec4( outgoingLight, 1.0 );"),u&&h.push(`gl_FragColor.a *= ${u.result};`),h.push("#include <encodings_fragment>","#include <fog_fragment>","#include <dithering_fragment>"),e=h.join(`
`)}return e}},fot=class extends da{constructor(){super("standard"),this.nodeType="Standard",this.color=new os(Uc),this.roughness=new Kt(.3),this.metalness=new Kt(0),this.reflectivity=new Kt(.5),this.previousModelViewMatrix=new nf,this.previouseProjectionMatrix=new nf,this.shadingAlpha=new Kt(1),this.shadingBlend=new vn(0),this.occlusion=new ml(!0)}get category(){return"physical"}build(t){let e;if(t.define("STANDARD"),t.requires.lights=!0,t.extensions.derivatives=!0,t.extensions.shaderTextureLOD=!0,t.isShader("vertex")){let i=this.position?this.position.analyzeAndFlow(t,"v3",{cache:"position"}):void 0;t.mergeUniform({frameIndex:Ri.frameIndex}),t.mergeUniform({resolution:Ri.resolution}),t.mergeUniform({previousModelViewMatrix:this.previousModelViewMatrix}),t.mergeUniform({previousProjectionMatrix:this.previouseProjectionMatrix}),t.mergeUniform(A_.merge([Bt.fog,Bt.lights])),Bt.LTC_1&&(t.uniforms.ltc_1={value:void 0},t.uniforms.ltc_2={value:void 0}),t.addParsCode(["varying vec3 vViewPosition;","varying vec3 vWPosition;","#include <fog_pars_vertex>","#include <skinning_pars_vertex>","#include <normal_pars_vertex>","#include <morphtarget_pars_vertex>","#include <shadowmap_pars_vertex>","#include <clipping_planes_pars_vertex>"].join(`
`));let r=["#include <beginnormal_vertex>","#include <morphnormal_vertex>",`
				#include <skinbase_vertex>
				#include <skinnormal_vertex>
				#if !defined( USE_LAYER_DISPLACE )
					#include <defaultnormal_vertex>
				#endif

				vec3 displaced_position = position;
				vec3 displaced_normal = objectNormal;

				#if defined( USE_LAYER_DISPLACE )
					vec3 transformed;
					vec3 transformedNormal;
				#endif
				`,"#include <normal_vertex>",`
				#if !defined( USE_LAYER_DISPLACE )
					#include <begin_vertex>
				#endif /* !USE_LAYER_DISPLACE */
				`];i&&r.push(i.code,i.result?"displaced_position = "+i.result+";":""),r.push("transformed = displaced_position;","#include <morphtarget_vertex>","#include <skinning_vertex>","transformedNormal = normalMatrix * displaced_normal;","#ifndef FLAT_SHADED","    vNormal = transformedNormal;","#endif"),r.push("#include <project_vertex>","#include <fog_vertex>","#include <clipping_planes_vertex>","	vViewPosition = - mvPosition.xyz;","#include <worldpos_vertex>","#include <shadowmap_vertex>"),r.push("vWPosition = ( modelMatrix * vec4( transformed, 1.0 ) ).xyz;"),e=r.join(`
`)}else{t.mergeUniform({penumbraSize:Ri.penumbraSize}),t.mergeUniform({frameIndex:Ri.frameIndex}),t.mergeUniform({aoMap:Ri.aoRenderTarget}),t.mergeUniform({aoEnabled:Ri.aoEnabled});let i={gamma:!0};this.color===void 0&&(this.color=new os(Uc)),this.color.analyze(t,{slot:"color",context:i}),this.roughness.analyze(t),this.metalness.analyze(t);let r=this.occlusion.flow(t,"b",{slot:"occlusion"});this.shadingAlpha.analyze(t),this.shadingBlend.analyze(t),this.afterColor&&this.afterColor.analyze(t,{slot:"afterColor"}),this.alpha&&this.alpha.analyze(t),this.reflectivity&&this.reflectivity.analyze(t);let n=this.color.flow(t,"c",{slot:"color",context:i}),s=this.roughness.flow(t,"f"),a=this.metalness.flow(t,"f"),o=this.shadingAlpha.flow(t,"f"),l=this.shadingBlend.flow(t,"i"),c=this.afterColor?this.afterColor.flow(t,"c",{slot:"afterColor"}):void 0,u=this.alpha?this.alpha.flow(t,"f"):void 0,h=this.alphaOverride?this.alphaOverride.flow(t,"f"):void 0,d=this.reflectivity?this.reflectivity.flow(t,"f"):void 0;t.requires.transparent=u!==void 0,t.addParsCode(["varying vec3 vViewPosition;","varying vec3 vWPosition;","uniform float penumbraSize[5];","uniform sampler2D aoMap;","uniform bool aoEnabled;","#include <normal_pars_fragment>","#include <dithering_pars_fragment>","#include <fog_pars_fragment>","#include <bsdfs>","#include <lights_pars_begin>","#include <lights_physical_pars_fragment>","#include <shadowmap_pars_fragment>"].join(`
`));let f=["#include <clipping_planes_fragment>","	#include <normal_fragment_begin>",`
				// NOTE: gl_FrontFacing alternative using face normal estimation.
				vec3 viewdx = dFdx(vViewPosition);
				vec3 viewdy = dFdy(vViewPosition);
				vec3 faceNormal = normalize(cross(viewdx,viewdy));
				if (dot(normal, faceNormal) < 0.0) {
					normal *= -1.0;
				}
				`,"	PhysicalMaterial material;","	material.diffuseColor = vec3( 1.0 );"];if(this.bumpMap){t.include(t_.dHdxy),t.include(t_.perturbNormalArb);let g=this.bumpMap.texture.flow(t,"t"),m=this.bumpMap.flow(t,"v3"),y=this.bumpMapIntensity?this.bumpMapIntensity.flow(t,"f").result:"1.0",b="";this.bumpMap.projection.value===4?b=`
					vec3 bumpNormal = vec3(0.0);
					{
						vec2 uv0 = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_writeUvs0;
						vec2 uv1 = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_writeUvs1;
						vec2 uv2 = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_writeUvs2;
						vec3 weights = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_triplanarWeights;

						vec2 grad0 = dHdxy(${g.result}, uv0, ${y});
						vec3 n0 = perturbNormalArb(-vViewPosition, normal, grad0, faceDirection);

						vec2 grad1 = dHdxy(${g.result}, uv1, ${y});
						vec3 n1 = perturbNormalArb(-vViewPosition, normal, grad1, faceDirection);

						vec2 grad2 = dHdxy(${g.result}, uv2, ${y});
						vec3 n2 = perturbNormalArb(-vViewPosition, normal, grad2, faceDirection);
						
						bumpNormal = n0 * weights.z + n1 * weights.x + n2 * weights.y;
						bumpNormal = normalize(bumpNormal);
					}

					normal = bumpNormal;
					`:b=`
					vec2 bumpMapCachedUv = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_writeUvs;
					vec2 grad = dHdxy(${g.result}, bumpMapCachedUv, ${y});
					normal = perturbNormalArb( - vViewPosition, normal, grad, faceDirection );
					`,f.push(`// Call the Texture Layer's function once here so that it writes out its procedural UV coordinates
					${m.result};
					${b}
					`)}if(f.push(n.code,"	vec3 diffuseColor = "+n.result+";","	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );",a.code,"	float metalnessFactor = "+a.result+";"),this.roughnessMap){let g=this.roughnessMap.texture.flow(t,"t"),m=this.roughnessMap.flow(t,"v3"),y="";this.roughnessMap.projection.value===4?y=`
					float roughnessChange = 1.0;
					{
						vec2 uv0 = g${this.roughnessMap.uuid.toString().replace(/-/g,"")}_writeUvs0;
						vec2 uv1 = g${this.roughnessMap.uuid.toString().replace(/-/g,"")}_writeUvs1;
						vec2 uv2 = g${this.roughnessMap.uuid.toString().replace(/-/g,"")}_writeUvs2;
						vec3 weights = g${this.roughnessMap.uuid.toString().replace(/-/g,"")}_triplanarWeights;

						float r0 = luminance(texture(${g.result}, uv0).rgb) * roughnessScale;
						float r1 = luminance(texture(${g.result}, uv1).rgb) * roughnessScale;
						float r2 = luminance(texture(${g.result}, uv2).rgb) * roughnessScale;

						roughnessChange = (r0 * weights.z + r1 * weights.x + r2 * weights.y);
					}
					float roughnessFactor = roughnessChange * ${s.result};
					`:y=`
					vec2 roughnessMapCachedUv = g${this.roughnessMap.uuid.toString().replace(/-/g,"")}_writeUvs;

					vec4 vals = texture(${g.result},  roughnessMapCachedUv);
					float roughnessFactor = luminance(vals.rgb) * ${s.result};
					`,f.push(`// Call the Texture Layer's function once here so that it writes out its procedural UV coordinates
					${m.result};

					const float roughnessScale = 1.0;

					${y}
				`)}else f.push(s.code,"	float roughnessFactor = "+s.result+";");u&&f.push(u.code,"#ifdef ALPHATEST","	if ( "+u.result+" <= ALPHATEST ) discard;","#endif"),f.push("vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );","float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );"),f.push("material.diffuseColor = diffuseColor * ( 1.0 - metalnessFactor );","material.roughness = max( roughnessFactor, 0.0525 );","material.roughness += geometryRoughness;","material.roughness = min( material.roughness, 1.0 );","material.roughness = clamp( roughnessFactor, 0.04, 1.0 );"),d?f.push(d.code,"material.specularColor = mix( vec3( 0.16 * pow2( "+d.result+" ) ), diffuseColor, metalnessFactor );"):f.push("material.specularColor = mix( vec3( 0.04 ), diffuseColor, metalnessFactor );"),f.push("#include <lights_fragment_begin>"),f.push("#include <lights_fragment_end>"),f.push("vec3 ao = aoEnabled && "+r.result+" ? tex2D(aoMap, gl_FragCoord.xy / resolution).rgb : vec3(1.0);","vec3 outgoingLight = ((reflectedLight.directDiffuse + reflectedLight.indirectDiffuse)) + reflectedLight.directSpecular + reflectedLight.indirectSpecular;");let p="1.0";this.mask&&(this.mask.analyze(t),p=`luminance(${this.mask.flow(t,"v3").result})`),f.push(`
				if (outgoingLight != diffuseColor) {
					float lightAccu = clamp( length( reflectedLight.directSpecular + reflectedLight.indirectSpecular ), 0.0, 1.0 );
					accumAlpha += ( 1.0 - accumAlpha ) * ${o.result} * ${p} * lightAccu;
					outgoingLight = spe_blend( diffuseColor, outgoingLight, ${o.result} * ${p}, ${l.result} );
					
					outgoingLight *= ao;
				}
				`),c&&f.push(c.code,`outgoingLight = spe_blend(outgoingLight, ${c.result}, 1.0, SPE_BLENDING_NORMAL);`),u?f.push(`gl_FragColor = vec4( outgoingLight, accumAlpha * ${u.result} );`):f.push("gl_FragColor = vec4( outgoingLight, 1.0 );"),h&&f.push(`gl_FragColor.a *= ${h.result};`),f.push("#include <encodings_fragment>","#include <fog_fragment>","#include <dithering_fragment>"),e=f.join(`
`)}return e}},pot=class extends da{constructor(){super("toon"),this.nodeType="Toon",this.color=new os(Uc),this.specular=new os(1118481),this.shininess=new Kt(30),this.previousModelViewMatrix=new nf,this.previouseProjectionMatrix=new nf,this.shadingAlpha=new Kt(1),this.shadingBlend=new vn(0)}get category(){return"toon"}build(t){let e;if(t.define("TOON"),t.requires.lights=!0,t.extensions.derivatives=!0,t.isShader("vertex")){let i=this.position?this.position.analyzeAndFlow(t,"v3",{cache:"position"}):void 0;t.mergeUniform({frameIndex:Ri.frameIndex}),t.mergeUniform({resolution:Ri.resolution}),t.mergeUniform({previousModelViewMatrix:this.previousModelViewMatrix}),t.mergeUniform({previousProjectionMatrix:this.previouseProjectionMatrix}),t.mergeUniform(A_.merge([Bt.fog,Bt.lights])),t.addParsCode(["varying vec3 vViewPosition;","varying vec3 vWPosition;","#include <fog_pars_vertex>","#include <skinning_pars_vertex>","#include <normal_pars_vertex>","#include <morphtarget_pars_vertex>","#include <shadowmap_pars_vertex>","#include <clipping_planes_pars_vertex>"].join(`
`));let r=["#include <beginnormal_vertex>","#include <morphnormal_vertex>",`
				#include <skinbase_vertex>
				#include <skinnormal_vertex>
				#ifndef USE_LAYER_DISPLACE
					#include <defaultnormal_vertex>
				#endif

				vec3 displaced_position = position;
				vec3 displaced_normal = objectNormal;

				#ifdef USE_LAYER_DISPLACE
					vec3 transformed;
					vec3 transformedNormal;
				#endif
				`,"#include <normal_vertex>",`
				#ifndef USE_LAYER_DISPLACE
					#include <begin_vertex>
				#endif
				`];i&&r.push(i.code,i.result?"displaced_position = "+i.result+";":""),r.push("transformed = displaced_position;","#include <morphtarget_vertex>","#include <skinning_vertex>","transformedNormal = normalMatrix * displaced_normal;","#ifndef FLAT_SHADED","    vNormal = transformedNormal;","#endif"),r.push("	#include <project_vertex>","	#include <fog_vertex>","	#include <clipping_planes_vertex>","	vViewPosition = - mvPosition.xyz;","	#include <worldpos_vertex>","	#include <shadowmap_vertex>","	#include <fog_vertex>"),r.push("vWPosition = ( modelMatrix * vec4( transformed, 1.0 ) ).xyz;"),e=r.join(`
`)}else{t.mergeUniform({penumbraSize:Ri.penumbraSize}),t.mergeUniform({frameIndex:Ri.frameIndex}),t.mergeUniform({aoMap:Ri.aoRenderTarget}),t.mergeUniform({aoEnabled:Ri.aoEnabled}),this.color===void 0&&(this.color=new os(Uc)),this.color.analyze(t,{slot:"color"}),this.specular.analyze(t),this.shininess.analyze(t),this.shadingAlpha.analyze(t),this.shadingBlend.analyze(t),this.afterColor&&this.afterColor.analyze(t,{slot:"afterColor"}),this.alpha&&this.alpha.analyze(t);let i=this.color.flow(t,"c",{slot:"color"}),r=this.specular.flow(t,"c"),n=this.shininess.flow(t,"f"),s=this.shadingAlpha.flow(t,"f"),a=this.shadingBlend.flow(t,"i"),o=this.afterColor?this.afterColor.flow(t,"c",{slot:"afterColor"}):void 0,l=this.alpha?this.alpha.flow(t,"f"):void 0,c=this.alphaOverride?this.alphaOverride.flow(t,"f"):void 0;t.requires.transparent=l!==void 0,t.addParsCode(["uniform float penumbraSize[5];","uniform sampler2D aoMap;","uniform bool aoEnabled;","varying vec3 vWPosition;","#include <normal_pars_fragment>","#include <gradientmap_pars_fragment>","#include <fog_pars_fragment>","#include <bsdfs>","#include <lights_pars_begin>","#include <dithering_pars_fragment>",`
					varying vec3 vViewPosition;
					struct ToonMaterial {
						vec3	diffuseColor;
						vec3	specularColor;
						float	specularShininess;
						float	specularStrength;
					};
					void RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
						vec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;
			
						reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
						reflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularShininess ) * material.specularStrength;
					}
					void RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
						reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
					}
					#define RE_Direct				RE_Direct_Toon
					#define RE_IndirectDiffuse		RE_IndirectDiffuse_Toon
					#define Material_LightProbeLOD( material )	(0)
					`,"#include <shadowmap_pars_fragment>","#include <bumpmap_pars_fragment>","#include <normalmap_pars_fragment>"].join(`
`));let u=["#include <normal_fragment_begin>",`
				// NOTE: gl_FrontFacing alternative using face normal estimation.
				vec3 viewdx = dFdx(vViewPosition);
				vec3 viewdy = dFdy(vViewPosition);
				vec3 faceNormal = normalize(cross(viewdx,viewdy));
				if (dot(normal, faceNormal) < 0.0) {
					normal *= -1.0;
				}
				`,"	ToonMaterial material;"];if(this.bumpMap){t.include(t_.dHdxy),t.include(t_.perturbNormalArb);let d=this.bumpMap.texture.flow(t,"t"),f=this.bumpMap.flow(t,"v3"),p=this.bumpMapIntensity?this.bumpMapIntensity.flow(t,"f").result:"1.0",g="";this.bumpMap.projection.value===4?g=`
					vec3 bumpNormal = vec3(0.0);
					{
						vec2 uv0 = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_writeUvs0;
						vec2 uv1 = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_writeUvs1;
						vec2 uv2 = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_writeUvs2;
						vec3 weights = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_triplanarWeights;

						vec2 grad0 = dHdxy(${d.result}, uv0, ${p});
						vec3 n0 = perturbNormalArb(-vViewPosition, normal, grad0, faceDirection);

						vec2 grad1 = dHdxy(${d.result}, uv1, ${p});
						vec3 n1 = perturbNormalArb(-vViewPosition, normal, grad1, faceDirection);

						vec2 grad2 = dHdxy(${d.result}, uv2, ${p});
						vec3 n2 = perturbNormalArb(-vViewPosition, normal, grad2, faceDirection);
						
						bumpNormal = n0 * weights.z + n1 * weights.x + n2 * weights.y;
						bumpNormal = normalize(bumpNormal);
					}

					normal = bumpNormal;
					`:g=`
					vec2 bumpMapCachedUv = g${this.bumpMap.uuid.toString().replace(/-/g,"")}_writeUvs;
					vec2 grad = dHdxy(${d.result}, bumpMapCachedUv, ${p});
					normal = perturbNormalArb( - vViewPosition, normal, grad, faceDirection );
					`,u.push(`// Call the Texture Layer's function once here so that it writes out its procedural UV coordinates
					${f.result};
					${g}
					`)}u.push(i.code,"	vec3 diffuseColor = "+i.result+";","	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );",r.code,"	vec3 specular = "+r.result+";",n.code,"	float shininess = max( 0.0001, "+n.result+" );","	float specularStrength = 1.0;"),l&&u.push(l.code,"#ifdef ALPHATEST","if ( "+l.result+" <= ALPHATEST ) discard;","#endif"),u.push("material.diffuseColor = diffuseColor;"),u.push("material.specularColor = specular;","material.specularShininess = shininess;","material.specularStrength = specularStrength;","#include <lights_fragment_begin>","#include <lights_fragment_end>"),u.push("vec3 ao = aoEnabled ? tex2D(aoMap, gl_FragCoord.xy / resolution).rgb : vec3(1.0);","vec3 outgoingLight = ((reflectedLight.directDiffuse + reflectedLight.indirectDiffuse) * ao) + reflectedLight.directSpecular;");let h="1.0";this.mask&&(this.mask.analyze(t),h=`luminance(${this.mask.flow(t,"v3").result})`),u.push(`
				if (outgoingLight != diffuseColor) {
					float lightAccu = clamp( length( reflectedLight.directSpecular + reflectedLight.indirectSpecular ), 0.0, 1.0 );
					accumAlpha += ( 1.0 - accumAlpha ) * ${s.result} * ${h} * lightAccu;
					outgoingLight = spe_blend( diffuseColor, outgoingLight, ${s.result} * ${h}, ${a.result} );
				}
				`),o&&u.push(o.code,`outgoingLight = spe_blend(outgoingLight, ${o.result}, 1.0, SPE_BLENDING_NORMAL);`),l?u.push(`gl_FragColor = vec4( outgoingLight, accumAlpha * ${l.result} );`):u.push("gl_FragColor = vec4( outgoingLight, 1.0 );"),c&&u.push(`gl_FragColor.a *= ${c.result};`),u.push("#include <encodings_fragment>","#include <fog_fragment>","#include <dithering_fragment>"),e=u.join(`
`)}return e}},mot=class{constructor(t=1e3*10){this.timeout=t,this.cache=new Map,this.head={data:null,time:0,src:null,next:null,prev:null},this.tail={data:null,time:1/0,src:null,next:null,prev:null},this.hasClean=!1,this.head.next=this.tail,this.tail.prev=this.head}log(...t){}remove(t){let e=this.cache.get(t);e&&(this.dispose(t,e.data),this.cache.delete(t),e.prev.next=e.next,e.next.prev=e.prev)}scheduleCleanup(){this.hasClean||(this.log("scheduled cleanup"),this.hasClean=!0,setTimeout(()=>{this.hasClean=!1,this.log("cleaning");let t=Date.now(),e=this.head.next;for(;e.time<t-this.timeout;)this.dispose(e.src,e.data),this.cache.delete(e.src),e=e.next,e.prev=this.head,this.head.next=e;this.head.next!==this.tail?this.scheduleCleanup():this.log("no more cleanup")},this.timeout+1e3))}has(t){return this.cache.get(t)?.data}load(t){let e=Date.now(),i=this.cache.get(t);return i===void 0?(i={data:this.create(t),src:t,time:e,next:null,prev:null},this.cache.set(t,i)):(i.time=e,i.prev.next=i.next,i.next.prev=i.prev),i.prev=this.tail.prev,i.next=this.tail,this.tail.prev.next=i,this.tail.prev=i,this.scheduleCleanup(),i.data}},got=class extends mot{create(t){return URL.createObjectURL(new Blob([t]))}dispose(t,e){URL.revokeObjectURL(e)}},GF;function vot(t){return typeof t=="string"?t:(GF||(GF=new got),GF.load(t))}var yot=class{constructor(t,e){this.data=t,this.cache=e,this.refCount=0}deref(){this.refCount,this.refCount-=1,this.refCount===0&&(this.cache.remove(this),this.dispose())}dispose(){this.refCount}},xot=class{constructor(){this.cache=new Map}remove(t){this.cache.delete(t.data)}load(t){let e=this.cache.get(t);return e===void 0&&(e=this.create(t),this.cache.set(t,e)),e.refCount+=1,e}},Vpe=class extends yot{constructor(t,e){super(t,e.imageHolderCache),this.data=t,this.shared=e,this.loaded=!1,this.isVideo=!1,this.isBuffer=!1,this._cache={1e3:{},1001:{},1002:{}},this.isVideo=t.type==="video",this.isBuffer=t.isWebGLRenderTarget===!0,this.loadPromise=this.updateSrc(this.isBuffer?t:t.data)}async updateSrc(t){if(typeof document>"u")return;this.disposeTextures(),this.loaded=!1;let e=()=>{this.loaded=!0;for(let r of Object.values(this._cache))for(let n of Object.values(r))for(let s of Object.values(n))s&&(s.image=this.img,s.needsUpdate=!0);this.shared.requestRender()};if(this.isBuffer)this.img=t,this.loaded=!0;else if(this.isVideo){if(this.img=document.createElement("video"),this.img.preload="auto",this.img.playsInline=!0,this.img.currentTime=.01,typeof t!="string"){var i=new FileReader;i.readAsDataURL(new Blob([t],{type:"video/mp4"}));let r;await new Promise(n=>{i.onloadend=s=>{r=s.target?.result,n(null)}}),this.img.src=r}else this.img.src=t;this.img.onloadeddata=()=>{e()}}else this.img=new Image,this.img.src=vot(t),this.img.onload=e,await new Promise(r=>{this.img.onload=()=>{e(),r(null)}})}getTexture(t,e=1008,i=1006){let r=this._cache[t]?.[e]?.[i];if(r)return r;{let n;return this.isBuffer?n=this.img.texture:this.isVideo?n=new e7e(this.img,void 0,t,t):n=new Kn(this.img,void 0,t,t,i,e),this.loaded&&(n.needsUpdate=!0),this._cache[t]===void 0&&(this._cache[t]={}),this._cache[t][e]===void 0&&(this._cache[t][e]={}),this._cache[t][e][i]=n,n}}setNeedsUpdate(t){for(let e of Object.values(this._cache))for(let i of Object.values(e))for(let r of Object.values(i))r&&(r.needsUpdate=t)}disposeTextures(){for(let[t,e]of Object.entries(this._cache))for(let[i,r]of Object.entries(e))for(let[n,s]of Object.entries(r))s?.dispose(),this._cache[t]!==void 0&&this._cache[t][i]!==void 0&&(this._cache[t][i][n]=void 0)}dispose(){super.dispose(),this.disposeTextures()}},Ag=class extends Vpe{};function bot(t,e){var i=Eot(e);return i.formatToParts?_ot(i,t):Sot(i,t)}var wot={year:0,month:1,day:2,hour:3,minute:4,second:5};function _ot(t,e){try{for(var i=t.formatToParts(e),r=[],n=0;n<i.length;n++){var s=wot[i[n].type];s>=0&&(r[s]=parseInt(i[n].value,10))}return r}catch(a){if(a instanceof RangeError)return[NaN];throw a}}function Sot(t,e){var i=t.format(e).replace(/\u200E/g,""),r=/(\d+)\/(\d+)\/(\d+),? (\d+):(\d+):(\d+)/.exec(i);return[r[3],r[1],r[2],r[4],r[5],r[6]]}var WF={};function Eot(t){if(!WF[t]){var e=new Intl.DateTimeFormat("en-US",{hour12:!1,timeZone:"America/New_York",year:"numeric",month:"numeric",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"}).format(new Date("2014-06-25T04:00:00.123Z")),i=e==="06/25/2014, 00:00:00"||e==="06/25/2014 00:00:00";WF[t]=i?new Intl.DateTimeFormat("en-US",{hour12:!1,timeZone:t,year:"numeric",month:"numeric",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"}):new Intl.DateTimeFormat("en-US",{hourCycle:"h23",timeZone:t,year:"numeric",month:"numeric",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"})}return WF[t]}function Hpe(t,e,i,r,n,s,a){var o=new Date(0);return o.setUTCFullYear(t,e,i),o.setUTCHours(r,n,s,a),o}var ste=36e5,Aot=6e4,qF={timezoneZ:/^(Z)$/,timezoneHH:/^([+-]\d{2})$/,timezoneHHMM:/^([+-]\d{2}):?(\d{2})$/};function Gpe(t,e,i){var r,n;if(!t||(r=qF.timezoneZ.exec(t),r))return 0;var s;if(r=qF.timezoneHH.exec(t),r)return s=parseInt(r[1],10),ate(s)?-(s*ste):NaN;if(r=qF.timezoneHHMM.exec(t),r){s=parseInt(r[1],10);var a=parseInt(r[2],10);return ate(s,a)?(n=Math.abs(s)*ste+a*Aot,s>0?-n:n):NaN}if(Cot(t)){e=new Date(e||Date.now());var o=i?e:Mot(e),l=K5(o,t),c=i?l:Tot(e,l,t);return-c}return NaN}function Mot(t){return Hpe(t.getFullYear(),t.getMonth(),t.getDate(),t.getHours(),t.getMinutes(),t.getSeconds(),t.getMilliseconds())}function K5(t,e){var i=bot(t,e),r=Hpe(i[0],i[1]-1,i[2],i[3]%24,i[4],i[5],0).getTime(),n=t.getTime(),s=n%1e3;return n-=s>=0?s:1e3+s,r-n}function Tot(t,e,i){var r=t.getTime(),n=r-e,s=K5(new Date(n),i);if(e===s)return e;n-=s-e;var a=K5(new Date(n),i);return s===a?s:Math.max(s,a)}function ate(t,e){return-23<=t&&t<=23&&(e==null||0<=e&&e<=59)}var ote={};function Cot(t){if(ote[t])return!0;try{return new Intl.DateTimeFormat(void 0,{timeZone:t}),ote[t]=!0,!0}catch{return!1}}var Pot=gv(VVe(),1),lte=gv(HVe(),1),Rot=/(Z|[+-]\d{2}(?::?\d{2})?| UTC| [a-zA-Z]+\/[a-zA-Z_]+(?:\/[a-zA-Z_]+)?)$/,Iot=Rot,XF=36e5,cte=6e4,Dot=2,gl={dateTimePattern:/^([0-9W+-]+)(T| )(.*)/,datePattern:/^([0-9W+-]+)(.*)/,YY:/^(\d{2})$/,YYY:[/^([+-]\d{2})$/,/^([+-]\d{3})$/,/^([+-]\d{4})$/],YYYY:/^(\d{4})/,YYYYY:[/^([+-]\d{4})/,/^([+-]\d{5})/,/^([+-]\d{6})/],MM:/^-(\d{2})$/,DDD:/^-?(\d{3})$/,MMDD:/^-?(\d{2})-?(\d{2})$/,Www:/^-?W(\d{2})$/,WwwD:/^-?W(\d{2})-?(\d{1})$/,HH:/^(\d{2}([.,]\d*)?)$/,HHMM:/^(\d{2}):?(\d{2}([.,]\d*)?)$/,HHMMSS:/^(\d{2}):?(\d{2}):?(\d{2}([.,]\d*)?)$/,timeZone:Iot};function Oot(t,e){if(arguments.length<1)throw new TypeError("1 argument required, but only "+arguments.length+" present");if(t===null)return new Date(NaN);var i={},r=i.additionalDigits==null?Dot:(0,Pot.default)(i.additionalDigits);if(r!==2&&r!==1&&r!==0)throw new RangeError("additionalDigits must be 0, 1 or 2");if(t instanceof Date||typeof t=="object"&&Object.prototype.toString.call(t)==="[object Date]")return new Date(t.getTime());if(typeof t=="number"||Object.prototype.toString.call(t)==="[object Number]")return new Date(t);if(!(typeof t=="string"||Object.prototype.toString.call(t)==="[object String]"))return new Date(NaN);var n=Lot(t),s=kot(n.date,r),a=s.year,o=s.restDateString,l=Not(o,a);if(isNaN(l))return new Date(NaN);if(l){var c=l.getTime(),u=0,h;if(n.time&&(u=Uot(n.time),isNaN(u)))return new Date(NaN);if(n.timeZone||i.timeZone){if(h=Gpe(n.timeZone||i.timeZone,new Date(c+u)),isNaN(h))return new Date(NaN)}else h=(0,lte.default)(new Date(c+u)),h=(0,lte.default)(new Date(c+u+h));return new Date(c+u+h)}else return new Date(NaN)}function Lot(t){var e={},i=gl.dateTimePattern.exec(t),r;if(i?(e.date=i[1],r=i[3]):(i=gl.datePattern.exec(t),i?(e.date=i[1],r=i[2]):(e.date=null,r=t)),r){var n=gl.timeZone.exec(r);n?(e.time=r.replace(n[1],""),e.timeZone=n[1].trim()):e.time=r}return e}function kot(t,e){var i=gl.YYY[e],r=gl.YYYYY[e],n;if(n=gl.YYYY.exec(t)||r.exec(t),n){var s=n[1];return{year:parseInt(s,10),restDateString:t.slice(s.length)}}if(n=gl.YY.exec(t)||i.exec(t),n){var a=n[1];return{year:parseInt(a,10)*100,restDateString:t.slice(a.length)}}return{year:null}}function Not(t,e){if(e===null)return null;var i,r,n,s;if(t.length===0)return r=new Date(0),r.setUTCFullYear(e),r;if(i=gl.MM.exec(t),i)return r=new Date(0),n=parseInt(i[1],10)-1,hte(e,n)?(r.setUTCFullYear(e,n),r):new Date(NaN);if(i=gl.DDD.exec(t),i){r=new Date(0);var a=parseInt(i[1],10);return zot(e,a)?(r.setUTCFullYear(e,0,a),r):new Date(NaN)}if(i=gl.MMDD.exec(t),i){r=new Date(0),n=parseInt(i[1],10)-1;var o=parseInt(i[2],10);return hte(e,n,o)?(r.setUTCFullYear(e,n,o),r):new Date(NaN)}if(i=gl.Www.exec(t),i)return s=parseInt(i[1],10)-1,dte(e,s)?ute(e,s):new Date(NaN);if(i=gl.WwwD.exec(t),i){s=parseInt(i[1],10)-1;var l=parseInt(i[2],10)-1;return dte(e,s,l)?ute(e,s,l):new Date(NaN)}return null}function Uot(t){var e,i,r;if(e=gl.HH.exec(t),e)return i=parseFloat(e[1].replace(",",".")),$F(i)?i%24*XF:NaN;if(e=gl.HHMM.exec(t),e)return i=parseInt(e[1],10),r=parseFloat(e[2].replace(",",".")),$F(i,r)?i%24*XF+r*cte:NaN;if(e=gl.HHMMSS.exec(t),e){i=parseInt(e[1],10),r=parseInt(e[2],10);var n=parseFloat(e[3].replace(",","."));return $F(i,r,n)?i%24*XF+r*cte+n*1e3:NaN}return null}function ute(t,e,i){e=e||0,i=i||0;var r=new Date(0);r.setUTCFullYear(t,0,4);var n=r.getUTCDay()||7,s=e*7+i+1-n;return r.setUTCDate(r.getUTCDate()+s),r}var Bot=[31,28,31,30,31,30,31,31,30,31,30,31],Fot=[31,29,31,30,31,30,31,31,30,31,30,31];function Wpe(t){return t%400===0||t%4===0&&t%100!==0}function hte(t,e,i){if(e<0||e>11)return!1;if(i!=null){if(i<1)return!1;var r=Wpe(t);if(r&&i>Fot[e]||!r&&i>Bot[e])return!1}return!0}function zot(t,e){if(e<1)return!1;var i=Wpe(t);return!(i&&e>366||!i&&e>365)}function dte(t,e,i){return!(e<0||e>52||i!=null&&(i<0||i>6))}function $F(t,e,i){return!(t!=null&&(t<0||t>=25)||e!=null&&(e<0||e>=60)||i!=null&&(i<0||i>=60))}function jot(t,e,i){var r=Oot(t,i),n=Gpe(e,r,!0),s=new Date(r.getTime()-n),a=new Date(0);return a.setFullYear(s.getUTCFullYear(),s.getUTCMonth(),s.getUTCDate()),a.setHours(s.getUTCHours(),s.getUTCMinutes(),s.getUTCSeconds(),s.getUTCMilliseconds()),a}function xl(t,e){return e.color(t)}function fte(t=new Date,e){let i=e.format,r=t.getSeconds(),n=t;e&&e.timeZone!==null&&(n=jot(new Date,e.timeZone));let s=n.getHours(),a=n.getMinutes(),o;e.format12h24h==="12ampm"&&(o=s>=12?"PM":"AM");let l=s;e.format12h24h!=="24"&&(l=s%12,l===0&&(l=12));let c,u;switch(i){case"HH:mm:ss":c=[l,a,r];break;case"HH:mm":c=[l,a];break;case"HH":c=[l],o=void 0;break;case"mm":c=[a],o=void 0;break;case"ss":c=[r],o=void 0;break;case"year":u=n.getFullYear();break;case"month":u=n.getMonth()+1;break;case"dayOfYear":u=Math.floor((n.getTime()-new Date(n.getFullYear(),0,0).getTime())/864e5);break;case"dayOfMonth":u=n.getDate();break;case"secondOfDay":u=s*60*60+a*60+r;break;default:console.error("Unknown time format",i),u=0;break}return c!==void 0?{textValue:c,suffix:o}:u}function Vot(t,e){switch(t.type){case"fresnel":return Wot(t,e);case"gradient":return qot(t,e);case"depth":return Xot(t,e);case"normal":return $ot(t,e);case"noise":return Yot(t,e);case"rainbow":return Kot(t,e);case"toon":return Zot(t,e);case"outline":return Qot(t,e);case"transmission":return Jot(t,e);case"color":return Got(t,e);case"pattern":return elt(t,e)}}function Hot(t){return{type:t.type}}function Fh(t,e){let{alpha:i,mode:r,isMask:n}=t,s=typeof i=="string"?(Number(e.getVariable(i))??100)/100:i;return{...Hot(t),alpha:s,mode:r,isMask:n}}function Got(t,e){return{...Fh(t,e),color:xl(t.color,e)}}function Wot(t,e){let{bias:i,scale:r,intensity:n,factor:s,color:a}=t;return{...Fh(t,e),color:xl(a,e),bias:i,scale:r,intensity:n,factor:s}}function qot(t,e){let{gradientType:i,smooth:r,colors:n,steps:s,angle:a,offset:o,morph:l}=t;return{...Fh(t,e),gradientType:i,smooth:r,colors:n.map(c=>new Ui(c[0],c[1],c[2],c[3])),num:n.length,steps:s,offset:new Ae(...o),morph:new Ae(...l),angle:a}}function Xot(t,e){let{gradientType:i,near:r,far:n,isVector:s,isWorldSpace:a,origin:o,direction:l,colors:c,steps:u,smooth:h}=t;return{...Fh(t,e),gradientType:i,near:r,far:n,isVector:s,isWorldSpace:a,origin:new W(...o),direction:l?new W(...l):new W(1,0,0),colors:c.map(d=>d!==void 0?new Ui(d[0],d[1],d[2],d[3]):new Ui(0,0,0,0)),steps:u.slice(0,c.length),smooth:h}}function $ot(t,e){let{cnormal:i}=t;return{...Fh(t,e),cnormal:new W(i[0],i[1],i[2])}}function Yot(t,e){return{...Fh(t,e),scale:t.scale,move:t.move,fA:new Ae(...t.fA),fB:new Ae(...t.fB),size:new W(...t.size),distortion:new Ae(...t.distortion),colorA:xl(t.colorA,e),colorB:xl(t.colorB,e),colorC:xl(t.colorC,e),colorD:xl(t.colorD,e),noiseType:t.noiseType,voronoiStyle:t.voronoiStyle,highCut:t.highCut,lowCut:t.lowCut,smoothness:t.smoothness,seed:t.seed,quality:t.quality}}function Kot(t,e){return{...Fh(t,e),filmThickness:t.filmThickness,movement:t.movement,wavelengths:new W(...t.wavelengths),noiseStrength:t.noiseStrength,noiseScale:t.noiseScale,offset:new W(...t.offset)}}function Zot(t,e){return{...Fh(t,e),positioning:t.positioning,colors:t.colors.map(i=>new Ui(i[0],i[1],i[2],i[3])),num:t.colors.length,steps:t.steps,source:new W(...t.source),isWorldSpace:t.isWorldSpace,noiseStrength:t.noiseStrength,noiseScale:t.noiseScale,shadowColor:xl(t.shadowColor,e),offset:new W(...t.offset)}}function Qot(t,e){return{...Fh(t,e),outlineColor:xl(t.outlineColor,e),contourColor:xl(t.contourColor,e),outlineWidth:t.outlineWidth,contourWidth:t.contourWidth,outlineThreshold:t.outlineThreshold,contourThreshold:t.contourThreshold,outlineSmoothing:t.outlineSmoothing,contourFrequency:t.contourFrequency,contourDirection:new W(...t.contourDirection),positionalLines:t.positionalLines,compensation:t.compensation}}function Jot(t,e){return{...Fh(t,e),thickness:t.thickness,ior:t.ior,roughness:t.roughness}}function elt(t,e){return{...Fh(t,e),style:t.style,projection:t.projection,axis:t.axis,blending:t.blending,offset:new Ae(...t.offset),colorA:xl(t.colorA,e),colorB:xl(t.colorB,e),frequency:new Ae(...t.frequency),size:t.size,variation:t.variation,smoothness:t.smoothness,zigzag:t.zigzag,rotation:t.rotation,vertical:new Ae(...t.vertical),horizontal:new Ae(...t.horizontal),sides:t.sides}}var N3=class extends Ya{},tlt={noise:["noiseType"],texture:["projection","axis","side"],video:["projection","axis","side"],displace:["noiseType"],light:["roughnessMap","bumpMap"],depth:["smooth","isWorldSpace","gradientType","isVector"],pattern:["style","projection","axis"]},ilt={depth:["colors"]};function rlt(t,e,i){if(e==="isMask")return!0;let r=tlt[t.type],n=ilt[t.type];if(n!==void 0){let s=t.color;if(n.includes(e)){let a=s[e]?.value?.length;if(a!==void 0&&a!==i.length)return!0}}return r!==void 0?r.includes(e):!1}function qpe(t,e,i){let r=i.uniforms[`f${i.id}_texture`];if(!r)return!1;let n=!1,s=t;if("image"in s){let a=s.image,o=e.image(a),l=r;l.image instanceof Ag||l.image.deref(),l.image=o}if("video"in s){let a=s.video,o=e.video(a),l=r;l.image instanceof Ag||l.image.deref(),l.image=o}if("wrapping"in s){let a=r;a.wrap=s.wrapping}if("minFilter"in s){let a=r;a.minFilter=s.minFilter}if("magFilter"in s){let a=r;a.magFilter=s.magFilter}if("rotation"in s&&i.uniforms[`f${i.id}_rotation`])return i.uniforms[`f${i.id}_rotation`].value=(s.rotation??0)*Ht.DEG2RAD,n;if("repeat"in s||"offset"in s||"rotation"in s){let a="mat",o=i.uniforms[`f${i.id}_${a}`];"repeat"in s&&(o.repeat=s.repeat),"offset"in s&&(o.offset=s.offset),"rotation"in s&&(o.rotation=s.rotation??0),o.updateMatrix()}return n}function nlt(t,e,i,r){let n=!1;for(let[s,a]of Object.entries(t)){if(s==="bumpMap"||s==="roughnessMap"){n=!0;continue}if(!s||a===void 0)continue;if($pe(s,i,r,e)){s==="visible"&&i.type==="light"&&(n=!0);continue}i.visible=r.visible;let o=i.uniforms[`f${i.id}_${s}`];if(o&&!(o instanceof a8))switch(n=n||rlt(i,s,a),o.constructor){case os:if(typeof a=="string"){let l=e.getColor(a);l&&(o.value=l);break}else{let l=a;o.value instanceof N3?o.value=new Ya(l.r,l.g,l.b,l.a):o.setRGBA(l);break}case pp:if(typeof a=="string"){let l=e.getColor(a);l&&(o.value=l);break}else{let l=a;o.value instanceof N3?o.value=new Ya(l.r,l.g,l.b,l.a):o.value.setRGBA(l.r,l.g,l.b,l.a);break}case mo:{let l=a;o.value.setX(l[0]),o.value.setY(l[1]);break}case lu:{let l=a;o.value.setX(l[0]),o.value.setY(l[1]),o.value.setZ(l[2]);break}case _p:{qpe(a,e,i);break}case Fy:{o.value=a.map(l=>new Ui(...l));break}default:{o.value=a;break}}}return n}var z0=(t,e,i)=>Math.max(0,Math.min(1,Number(e.getVariable(typeof t=="number"?t*100:t,i)??100)/100))??1,jT=class{constructor(t,e,i,r,n){this.id=t,this.uuid=e,this.data=i,this.uniforms={};for(let s in r)this.uniforms[`f${this.id}_${s}`]=r[s];for(let s in i)$pe(s,this,i,n)}get type(){return this.data.type}static create(t,e,i,r){if(i.type==="light")return xd.createLightLayer(t,e,i,r);if(i.type==="texture"||i.type==="video"){let n=i.type==="texture"?r.uiBuffer(i.texture.image)??r.image(i.texture.image):r.video(i.texture.video),s=new X5(n,i.texture.wrapping,i.texture.minFilter??1008,i.texture.magFilter??1006),a=new aot(n),o=new oot(i.texture.repeat,i.texture.offset,i.texture.rotation??0),l=new Kt(i.crop?1:0),c=new vn(i.projection??0),u=new vn(["x","y","z"].indexOf(i.axis)??0),h=new vn(i.side??0),d=new mo(i.size?new Ae(i.size[0],i.size[1]):new Ae(100,100)),f=new Kt(i.blending??0),p=new Kt(z0(i.alpha,r)),g=new vn(i.mode??0),m=new ml(i.isMask??!1),y=new o8(s,a,l,c,u,h,d,f,o,p,g,m),b=new Pn(y.calpha,"f");return new is(t,e,i,{texture:s,textureSize:a,crop:l,projection:c,axis:u,side:h,size:d,blending:f,mat:o,alpha:p,mode:g,isMask:m},y,g,b,m,r)}else if(i.type==="matcap"){let n=r.image(i.texture.image),s=new X5(n,i.texture.wrapping,i.texture.minFilter??1008,i.texture.magFilter??1006),a=new Kt(z0(i.alpha,r)),o=new vn(i.mode??0),l=new ml(i.isMask??!1),c=new Kt((i.texture.rotation??0)*Ht.DEG2RAD),u=new Cpe(s,a,o,l,c),h=new Pn(u.calpha,"f");return new is(t,e,i,{texture:s,alpha:a,mode:o,isMask:l,rotation:c},u,o,h,l,r)}else if(i.type==="displace")if(i.displacementType==="noise"){let n=new lu(new W(...i.offset)),s=new Kt(i.scale??10),a=new Kt(i.intensity??8),o=new Kt(i.movement??1),l=new vn(i.noiseType??0),c=new vn(i.voronoiStyle??0),u=new Kt(i.smoothness??.5),h=new Kt(i.seed??0),d=new Kt(i.highCut??1),f=new Kt(i.lowCut??0),p=new vn(i.quality??1),g=new zpe(a,o,n,c,u,h,d,f,p,s,l);return new Xpe(t,e,i,{offset:n,scale:s,intensity:a,movement:o,noiseType:l,voronoiStyle:c,smoothness:u,seed:h,highCut:d,lowCut:f,quality:p},g,r)}else throw new Error;else return olt(t,e,i,r)}updateByOp(t,e,i){let r=t;if(r.path[0]===void 0){if(r.type===0)return"type"in r.props||"category"in r.props||"visible"in r.props||"noiseType"in r.props?(i.scene.markNeedsUpdateRendererDirty(),!0):nlt(r.props,i.shared,this,e)}else if(r.path[0]==="texture")return"texture"in e||"video"in e?qpe(r.props,i.shared,this):!0;return!1}dispose(){if(slt(this)){let t=this.uniforms[`f${this.id}_texture`];if(!t)return!1;let e=t;e.image instanceof Ag||e.image.deref()}}hasValueByKey(t){return this.uniforms[t]!==void 0}hasValue(t){return this.hasValueByKey(`f${this.id}_${t}`)}setValue(t,e){let i=`f${this.id}_${t}`;this.hasValueByKey(i)&&e!==void 0&&(this.uniforms[i].value=e)}getNode(t){let e=`f${this.id}_${t}`;if(this.hasValueByKey(e))return this.uniforms[e]}getValue(t){let e=`f${this.id}_${t}`;if(this.hasValueByKey(e))return this.uniforms[e].value}getName(t){let e=/f\d+_(.*)/.exec(t);if(e&&e.length>1)return e[1];console.log(`Layer.getName: error ${t}`)}getNames(){let t=[];for(let e in this.uniforms){let i=this.getName(e);i&&t.push(i)}return t}},is=class extends jT{constructor(t,e,i,r,n,s,a,o,l){super(t,e,i,r,l),this.params=r,this.color=n,this.mode=s,this.alpha=a,this.isMask=o}},Xpe=class extends jT{constructor(t,e,i,r,n,s){super(t,e,i,r,s),this.position=n}},xd=class extends jT{constructor(t,e,i,r,n,s){super(t,e,i,n,s),this.node=r}static createLightLayer(t,e,i,r){let n,s=new Kt(z0(i.alpha,r)),a=new vn(i.mode),o=new Kt(i.bumpMapIntensity),l=new Kt(z0(i.alphaOverride,r)),c;if(!i.visible)n=new l8,c={};else if(i.category==="lambert"){n=new hot;let u=new os(r.color(i.emissive)??0),h=new ml(i.occlusion??!0);c={emissive:u,occlusion:h},n.emissive=u,n.occlusion=h}else if(i.category==="toon"){n=new pot;let u=new Kt(i.shininess??30),h=new os(r.color(i.specular)??1118481);c={shininess:u,specular:h},n.shininess=u,n.specular=h}else if(i.category==="physical"){n=new fot;let u=new Kt(i.roughness??.3),h=new Kt(i.metalness??0),d=new Kt(i.reflectivity??.5),f=new ml(i.occlusion??!0);c={roughness:u,metalness:h,reflectivity:d,occlusion:f},n.roughness=u,n.metalness=h,n.reflectivity=d,n.occlusion=f}else{n=new dot;let u=new Kt(i.shininess??30),h=new os(i.specular!==void 0?r.color(i.specular)??1118481:1118481),d=new ml(i.occlusion??!0);c={shininess:u,specular:h,occlusion:d},n.shininess=u,n.specular=h,n.occlusion=d}return n.alpha=new Kt(1),n.shadingAlpha=s,n.shadingBlend=a,n.bumpMapIntensity=o,n.alphaOverride=l,c.alpha=n.shadingAlpha,c.mode=n.shadingBlend,c.bumpMapIntensity=n.bumpMapIntensity,c.alphaOverride=n.alphaOverride,new xd(t,e,i,n,c,r)}get category(){return this.node.category}};function slt(t){let e=t instanceof jT?t.type:t;return e==="texture"||e==="video"||e==="displace_map"||e==="matcap"}function tu(t){return{alpha:new Kt(t.alpha??1),mode:new vn(t.mode??0),isMask:new ml(t.isMask??!1)}}function alt(t,e,i,r,n){switch(t.type){case"color":{let s=new os(r.color??Uc),a=tu(r),o=new $5(s,a.alpha),l=new Pn(o.calpha,"f");return new is(e,i,t,{color:s,...a},o,a.mode,l,a.isMask,n)}case"fresnel":{let s=new os(r.color??16777215),a=new Kt(r.bias??.1),o=new Kt(r.scale??1),l=new Kt(r.intensity??2),c=new Kt(r.factor??1),u=tu(r),h=new lot(s,a,o,l,c,u.alpha,u.mode,u.isMask),d=new Pn(h.calpha,"f");return new is(e,i,t,{color:s,bias:a,scale:o,intensity:l,factor:c,...u},h,u.mode,d,u.isMask,n)}case"rainbow":{let s=new Kt(r.filmThickness??30),a=new Kt(r.movement??0),o=new lu(r.wavelengths??new W(0,0,0)),l=new Kt(r.noiseStrength??0),c=new Kt(r.noiseScale??1),u=new lu(r.offset??new W(0,0,0)),h=tu(r),d=new Lpe(s,a,o,l,c,u,h.alpha,h.isMask),f=new Pn(d.calpha,"f");return new is(e,i,t,{filmThickness:s,movement:a,wavelengths:o,noiseStrength:l,noiseScale:c,offset:u,...h},d,h.mode,f,h.isMask,n)}case"transmission":{let s=new Kt(r.thickness??10),a=new Kt(r.ior??1.5),o=new Kt(r.roughness??.5),l=Ri.transmissionSize,c=Ri.transmissionRenderTarget,u=Ri.transmissionRenderTargetDepth,h=window.innerWidth,d=window.innerHeight,f=h>=d?new mo(d/h,1):new mo(1,h/d),p=tu(r),g=new Bpe(s,a,o,l,c,u,f,p.alpha),m=new Pn(g.calpha,"f");return new is(e,i,t,{thickness:s,ior:a,roughness:o,aspectRatio:f,...p},g,p.mode,m,p.isMask,n)}case"toon":{let s=new vn(r.positioning??0),a;r.colors?a=new Fy(r.colors.length,r.colors):(a=new Fy(10,new Ui(0,0,0,1)),a.value[1]=new Ui(1,1,1,1));let o;r.steps?o=new By(r.steps.length,r.steps):(o=new By(10,1),o.value[0]=0);let l=new lu(r.source??new W(0,0,0)),c=new ml(r.isWorldSpace??!0),u=new Kt(r.noiseStrength??0),h=new Kt(r.noiseScale??1),d=new pp(r.shadowColor),f=new lu(r.offset??new W(0,0,0)),p=tu(r),g=new Npe(s,a,o,l,c,u,h,d,f,p.alpha),m=new Pn(g.calpha,"f");return new is(e,i,t,{positioning:s,colors:a,steps:o,source:l,isWorldSpace:c,noiseStrength:u,noiseScale:h,shadowColor:d,offset:f,...p},g,p.mode,m,p.isMask,n)}case"outline":{let s=new os(r.outlineColor??16777215),a=new os(r.contourColor??16777215),o=new Kt(r.outlineWidth??.1),l=new Kt(r.contourWidth??.1),c=new Kt(r.outlineThreshold??.1),u=new Kt(r.contourThreshold??.1),h=new Kt(r.outlineSmoothing??.1),d=new Kt(r.contourFrequency??.1),f=new lu(r.contourDirection??new W(0,1,0)),p=new ml(r.positionalLines??!1),g=new ml(r.compensation??!0),m=Ri.normalRenderTarget,y=Ri.normalRenderTargetDepth,b=Ri.pixelRatioNode,w=Ri.resolution,E=tu(r),M=new Ipe(s,a,o,l,c,u,h,d,f,p,g,w,m,y,b,E.alpha),A=new Pn(M.calpha,"f");return new is(e,i,t,{outlineColor:s,contourColor:a,outlineWidth:o,contourWidth:l,outlineThreshold:c,contourThreshold:u,outlineSmoothing:h,contourFrequency:d,contourDirection:f,positionalLines:p,compensation:g,...E},M,E.mode,A,E.isMask,n)}case"depth":{let s=new vn(r.gradientType??0),a=new ml(r.smooth??!1),o=new Kt(r.near??50),l=new Kt(r.far??200),c=new Kt(r.isVector??1),u=new Kt(r.isWorldSpace??0),h=new lu(r.origin??new W),d=new lu(r.direction??new W),f;r.colors?f=new Fy(r.colors.length,r.colors):(f=new Fy(2,new Ui(0,0,0,1)),f.value[1]=new Ui(1,1,1,1));let p;r.steps?p=new By(r.steps.length,r.steps):(p=new By(2,1),p.value[0]=0);let g=tu(r),m=new Epe(s,a,o,l,c,u,h,d,f,p,g.alpha,g.isMask),y=new Pn(m.calpha,"f");return new is(e,i,t,{gradientType:s,smooth:a,near:o,far:l,isVector:c,isWorldSpace:u,origin:h,direction:d,colors:f,steps:p,...g},m,g.mode,y,g.isMask,n)}case"noise":{let s=new Kt(r.scale??1),a=new lu(r.size??new W(100,100,100)),o=new Kt(r.move??1),l=new mo(r.fA??new Ae(1.7,9.2)),c=new mo(r.fB??new Ae(8.3,2.8)),u=new mo(r.distortion??new Ae(1,1)),h=new pp(r.colorA),d=new pp(r.colorB),f=new pp(r.colorC),p=new pp(r.colorD),g=new vn(r.noiseType??0),m=new vn(r.voronoiStyle??0),y=new Kt(r.highCut??1),b=new Kt(r.lowCut??0),w=new Kt(r.smoothness??.5),E=new Kt(r.seed??.5),M=new vn(r.quality??1),A=tu(r),P=new Ppe(s,a,o,l,c,u,h,d,f,p,A.alpha,g,A.isMask,m,y,b,w,E,M),C=new Pn(P.calpha,"f");return new is(e,i,t,{scale:s,size:a,move:o,fA:l,fB:c,distortion:u,colorA:h,colorB:d,colorC:f,colorD:p,noiseType:g,...A,voronoiStyle:m,highCut:y,lowCut:b,smoothness:w,seed:E,quality:M},P,A.mode,C,A.isMask,n)}case"normal":{let s=new lu(r.cnormal??new W(1,1,1)),a=tu(r),o=new Spe(s,a.alpha),l=new Pn(o.calpha,"f");return new is(e,i,t,{cnormal:s,...a},o,a.mode,l,a.isMask,n)}case"gradient":{let s=new vn(r.gradientType??0),a=new ml(r.smooth??!1),o;r.colors?o=new Fy(r.colors.length,r.colors):(o=new Fy(10,new Ui(0,0,0,1)),o.value[1]=new Ui(1,1,1,1));let l;r.steps?l=new By(r.steps.length,r.steps):(l=new By(10,1),l.value[0]=0);let c=new mo(r.offset??new Ae(0,0)),u=new mo(r.morph??new Ae(0,0)),h=new Kt(r.angle??0),d=tu(r),f=new Mpe(s,a,o,l,c,u,h,d.alpha,d.isMask),p=new Pn(f.calpha,"f");return new is(e,i,t,{gradientType:s,smooth:a,colors:o,steps:l,offset:c,morph:u,angle:h,...d},f,d.mode,p,d.isMask,n)}case"pattern":{let s=new vn(r.style??0),a=new vn(r.projection??0),o=new vn(["x","y","z"].indexOf(r.axis)??0),l=new Kt(r.blending??0),c=new mo(r.offset??new Ae(0,0)),u=new pp(r.colorA),h=new pp(r.colorB),d=new mo(r.frequency??new Ae(10,10)),f=new Kt(r.size??.5),p=new Kt(r.variation??0),g=new Kt(r.smoothness??.5),m=new Kt(r.zigzag??0),y=new Kt(r.rotation??0),b=new mo(r.vertical??new Ae(0,1)),w=new mo(r.horizontal??new Ae(0,1)),E=new vn(r.sides??6),M=tu(r),A=new Dpe(s,a,o,l,c,u,h,d,f,p,g,m,y,b,w,E,M.alpha,M.isMask),P=new Pn(A.calpha,"f");return new is(e,i,t,{style:s,projection:a,axis:o,blending:l,offset:c,colorA:u,colorB:h,frequency:d,size:f,variation:p,smoothness:g,zigzag:m,rotation:y,vertical:b,horizontal:w,sides:E,...M},A,M.mode,P,M.isMask,n)}default:{let s=new os(1,0,0,1),a=tu(r),o=new $5(s,a.alpha),l=new Pn(o.calpha,"f");return new is(e,i,t,{color:s,...a},o,a.mode,l,a.isMask,n)}}}function olt(t,e,i,r){let n=Vot(i,r);return alt(i,t,e,n,r)}function $pe(t,e,i,r){if(i.type==="displace"&&(t==="intensity"||t==="visible")){let n=e.uniforms[`f${e.id}_intensity`];return n?(n.value=i.intensity*(i.visible?1:0),n):void 0}if(i.type!=="displace"&&(t==="alpha"||t==="visible")){let n=e.uniforms[`f${e.id}_alpha`];if(!n)return;if(n.value=z0(i.alpha,r)*(i.visible?1:0),i.type==="outline"&&t==="visible"){let s=e.uniforms[`f${e.id}_compensation`];s&&(s.value=i.compensation&&i.visible)}return n}}function Qw(t,e){let i=0,r=t.layers.find(n=>n.data.type==="light");if(r){let n=r.data,s=Number(e.getVariable(n.alphaOverride));if((typeof n.alphaOverride=="string"?s/100:n.alphaOverride)<1)return!0}for(let n of t.layers){if(n.data.type!=="displace"&&n.data.isMask)return!0;if(n.data.type!=="displace"&&"alpha"in n.data&&n.data.type!=="light"&&n.data.type!=="fresnel"&&n.data.type!=="texture"&&n.data.type!=="matcap"&&n.data.type!=="rainbow"&&n.data.type!=="outline"&&n.data.type!=="pattern"){let s=n.data.visible?n.data.alpha:0;if(typeof s=="string"&&(s=Math.max(0,Math.min(1,Number(e.getVariable(s)??100)/100))),s===1&&n.data.type==="depth"||n.data.type==="gradient"){for(let a of n.data.colors)if(a[3]<1){s=a[3];break}}else if(s===1&&n.data.type==="noise"){let a=e.color(n.data.colorA).a,o=e.color(n.data.colorB).a,l=e.color(n.data.colorC).a,c=e.color(n.data.colorD).a,u=Math.min(a,Math.min(o,Math.min(l,c)));u<1&&(s=u)}i+=(1-i)*s}}return i<1}var Qp=class extends Tr{constructor(){super(void 0),this.flatShading=!1,this.needsJitter=!0,this.shadersPatchedForShapeBlend=!1,this.nodeContextUuid=0,this.fog=!0,this.dithering=!0,this.vertexColors=!0,this.transparent=!0}customProgramCacheKey(){return""}},llt=class extends Qp{constructor(t,e,i,r){super(),this.flatShading=t,this.side=e,this.wireframe=i,this.root=r}updateAfterBuild(){let t=this.root;this.lights=t.lights,this.vertexShader=t.vertexShader,this.fragmentShader=t.fragmentShader,Object.assign(this.defines,t.defines),Object.assign(this.uniforms,t.uniforms),this.extensions=t.extensions,this.transparent=t.transparent,this.cacheKey=t.customProgramCacheKey()+"flat"+this.flatShading+this.side}onBeforeCompile(t,e){this.root.onBeforeCompile(t)}get data(){return this.root.data}get category(){return this.root.category}get hasAO(){return this.root.hasAO}getFlavor(t,e,i,r){return this.root.getFlavor(t,e,i,r)}get layers(){return this.root.layers}get fragment(){return this.root.fragment}getLayersOfType(t){return this.root.getLayersOfType(t)}getLayerByUuid(t){return this.root.getLayerByUuid(t)}updateByOp(t,e,i){this.root.updateByOp(t,e,i)}nodeMaterialDispose(){this.root.nodeMaterialDispose()}},c8=class extends Qp{constructor(t,e,i=!0){super(),this.data=t,this.allowVariableSaves=i,this.layerIdGen=0,this.flavors=[],this.masks={},this.type="NodeMaterial",this.updaters=[],this.needsJitter=e.shared.needsJitter,da.startContext(this),this.reset0(t,e),da.endContext(this)}get nodeMaterial(){return this}getFlavor(t,e,i,r){let n=i?6:(t?3:0)+e;if(n+=((r?.resolutionLevel??0)-(r?.useChildrenColors?4:0))*7,n===0)return this;this.flavors===void 0&&(this.flavors=[]),n-=1;let s=this.flavors[n];return s===void 0&&(s=new llt(t,e,i,this),s.needsJitter=this.needsJitter,this.flavors[n]=s,s.flatShading=t,s.side=e,s.updateAfterBuild(),r&&(s.defines.SHAPEBLEND=r.resolutionLevel,s.defines.SHAPEBLEND_C=r.useChildrenColors?1:0)),s}get fragment(){return this.lightLayer.node}get category(){return this.lightLayer.category}get hasAO(){return this.lightLayer.getNode("occlusion")?.value??!1}reset(t,e,i=!1){da.startContext(this),(this.data!==t||i)&&this.reset0(t,e),da.endContext(this)}reset0(t,e){this.data=t;let i=t.layers??Ga.defaultTwoLayerData("phong").layers;try{this.layers=i.map(r=>jT.create(this.layerIdGen++,r.id,r.data,e.shared))}catch{this.layers=[]}this.layers.reverse(),this.name=t.name??"Untitled Material",this.onUpdate(e.shared),this.transparent=Qw(t,e.shared),this.saveVariableLocations(e)}onVariableUpdate(t,e,i){if(t[0]==="alphaOverride")this.transparent=Qw(this.data,i.shared),this.lightLayer.setValue("alphaOverride",Math.max(0,Math.min(Number(e)/100,1)));else if(t[0]==="layer"){let r=t[1],n=t[2];if(r&&n){let s=this.layers.find(a=>a.uuid===r);s?.hasValue(n)&&(n==="alpha"?(this.transparent=Qw(this.data,i.shared),s.setValue(n,Math.max(0,Math.min(Number(e)/100,1)))):s.setValue(n,e))}}}saveVariableLocations(t){if(!this.allowVariableSaves)return;let e=this.data.layers.find(i=>i.data.type==="light");e&&t.shared.getVariable(e.data.alphaOverride,["material",this.uuid,"alphaOverride"]),this.data.layers.forEach(i=>{"alpha"in i.data&&typeof i.data.alpha=="string"&&t.shared.getVariable(i.data.alpha,["material",this.uuid,"layer",i.id,"alpha"])})}getLayersOfType(t){return this.layers.filter(e=>e.type===t)}getLayerByUuid(t){return this.layers.find(e=>e.uuid===t)}onUpdate(t){this.lightLayer=this.layers.find(e=>e instanceof xd),this.lightLayer===void 0&&(this.lightLayer=new xd(0,"",{...Ba.defaultData("light","phong"),visible:!1},new l8,{},t)),this.dispose();for(let e of this.flavors)e&&e.dispose();this.applyTextureMaps(),this.applyMasks(),this.blendColors(),this.blendAfterColors(),this.blendPositions(),this.build(),this.nodeContextUuid=0}applyTextureMaps(){let t=this.layers.find(n=>n instanceof xd);if(!t)return;let e=t.data,i=e.bumpMap,r=e.roughnessMap;t.node.bumpMap=void 0,t.node.roughnessMap=void 0;for(let n=0;n<this.layers.length;++n){let s=this.layers[n];s instanceof is&&s.color instanceof o8&&(s.uuid===i&&(t.node.bumpMap=s.color),s.uuid===r&&(t.node.roughnessMap=s.color))}}updateByOp(t,e,i){if(da.startContext(this),e!==void 0?this.data=e:e=this.data,this.transparent=Qw(e,i.shared),t.path[0]==="layers"){let r=i.shared,n=t.path[1];if(n===void 0)i.scene.markNeedsUpdateRendererDirty(),this.reset0(e,i);else{t.type===0&&t.props.occlusion!==void 0&&i.scene.markNeedsUpdateRendererDirty();let s=this.layers.find(a=>a.uuid===n);if(s){let a=e.layers.data(n),o;t.type===0&&("alpha"in t.props||"alphaOverride"in t.props)&&("alpha"in t.props?o={...t.props,alpha:z0(t.props.alpha,r,["material",this.uuid,"layer",n,"alpha"])}:o={...t.props,alphaOverride:z0(t.props.alphaOverride,r,["material",this.uuid,"alphaOverride"])}),s.updateByOp({...t,...o?{props:o}:{},path:t.path.slice(2)},a,i)&&this.reset0(e,i)}}}else this.reset0(e,i);da.endContext(this)}applyMasks(){for(let t=0;t<this.layers.length;++t){let e=this.layers[t];e instanceof is?e.color.mask=void 0:e instanceof xd&&(e.node.mask=void 0)}for(let t=0;t<this.layers.length;++t){let e=this.layers[t];if(e instanceof is&&e.isMask.value&&e.data.visible&&t>0){let i=t-1,r=this.layers[i];r instanceof xd?r.node.mask=new Gl(e.color,e.alpha,Gl.MUL):r instanceof is&&(r.isMask.value||(r.color.mask=new Gl(e.color,e.alpha,Gl.MUL)))}}}blendColors(){let t=this.layers.findIndex(i=>i instanceof is),e=this.layers.findIndex(i=>i instanceof xd);if(t!==-1&&t<e){let i=this.layers[t].color;for(let r=t+1;r<e;++r){let n=this.layers[r];if(n instanceof is){if(n.isMask.value)continue;i=new nte(i,n.color,n.alpha,n.mode)}}this.fragment.color=i}else this.fragment.color=void 0}blendAfterColors(){let t=new Pn("outgoingLight","f"),e=this.layers.findIndex(i=>i instanceof xd);if(this.layers.length>e+1){for(let i=e+1;i<this.layers.length;++i){let r=this.layers[i];if(r instanceof is){if(r.isMask.value)continue;t=new nte(t,r.color,r.alpha,r.mode)}}this.fragment.afterColor=t}else this.fragment.afterColor=void 0}blendPositions(){let t=this.layers.filter(e=>e instanceof Xpe);if(t.length>0){let e=t[0].position;for(let i=1;i<t.length;++i)t[i]&&(e=new Gl(e,t[i].position,Gl.ADD),e=new Gl(e,new Kt(.5).setReadonly(!0),Gl.MUL));this.fragment.position=e}else this.fragment.position=void 0}getDefines(){return this.defines}getUniforms(){return this.uniforms}getVertexShader(){return this.vertexShader}getFragmentShader(){return this.fragmentShader}onBeforeCompile(t){this.shapeBlendhack&&this.shapeBlendhack(this),t.uniforms=this.uniforms,t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader,t.extensionDerivatives=this.extensions.derivatives===!0,t.extensionFragDepth=this.extensions.fragDepth===!0,t.extensionDrawBuffers=this.extensions.drawBuffers===!0,t.extensionShaderTextureLOD=this.extensions.shaderTextureLOD===!0}clampUniformsForPreview(t,e){let i=(r,n,s)=>Math.min(Math.max(r,n),s);for(let r of this.layers)if(r.type==="displace"){let n=i(r.uniforms[`f${r.id}_intensity`].value,t,e);r.uniforms[`f${r.id}_intensity`].value=n}}updateFrame(t){for(let e=0;e<this.updaters.length;++e)t.updateNode(this.updaters[e])}build(){let t=new xpe;t.needsJitter=this.needsJitter,this.lights=this.lightLayer.data.visible,t.build(this.fragment,this.fragment),this.vertexShader=t.getCode("vertex"),this.fragmentShader=t.getCode("fragment"),this.defines=t.defines,this.uniforms=t.uniforms,this.extensions=t.extensions,this.updaters=t.updaters;for(let e of this.flavors)e&&e.updateAfterBuild();return this.shadersPatchedForShapeBlend=!1,this}nodeMaterialDispose(){this.layers.forEach(t=>t.dispose()),super.dispose();for(let t of this.flavors)t&&t.dispose()}assetsLoaded(){for(let t of this.layers)if(t instanceof is){let e=t.params.texture;if(e instanceof X5&&!e.image.loaded)return!1}return!0}};Object.defineProperties(Qp.prototype,{properties:{get:function(){return this.fragment.properties}}});var Z5=class extends c8{constructor(t,e,i){super(t,e,!1),this.uuid=i,this.allowVariableSaves=!0,this.saveVariableLocations(e)}},pte=new Map;function clt(t){if(typeof t=="string")return t;let e=pte.get(t);return e||(e={url:URL.createObjectURL(new Blob([t]))},pte.set(t,e)),e.url}var Ype,ult=new Promise(t=>{Ype=t}),mte=!1,gR;function hlt(){if(mte)return;if(gR)return gR;async function t(){await Bc(()=>import("./howler-i2XOl8UU.js").then(e=>e.h),[]),Ype(window!==void 0?window:global),mte=!0}return gR=t(),gR}var Kpe;ult.then(t=>Kpe=t);function gte(t,e){t.forEach(i=>{"dragDropActions"in i.data?(e.push(...i.data.dragDropActions.drag),e.push(...i.data.dragDropActions.drop)):"inActions"in i.data?(e.push(...i.data.inActions),e.push(...i.data.outActions)):"gameActions"in i.data?(e.push(...i.data.gameActions.idle),e.push(...i.data.gameActions.move),e.push(...i.data.gameActions.jump),e.push(...i.data.gameActions.run)):"breakpoints"in i.data?i.data.breakpoints.forEach(r=>{e.push(...r.data.actions)}):"actions"in i.data&&(e.push(...i.data.actions),i.data.actions.forEach(r=>{r.data.type==="Conditional"&&r.data.ifActions&&(e.push(...r.data.ifActions),e.push(...r.data.elseActions))}))})}function dlt(t){let e=!1,i=[];return t.scene.objects.traverse((r,n)=>{if(n.type==="Page"&&n.uiScene!==void 0&&n.uiScene.objects.traverse((s,a)=>{if(a.events===void 0||Array.isArray(a.events)===!1)return!0;gte(a.events,i),e=e||i.some(o=>o.data.type==="Audio")}),n.events===void 0||Array.isArray(n.events)===!1)return!0;gte(n.events,i),e=e||i.some(s=>s.data.type==="Audio")}),e}var JE=class{constructor({src:t,volume:e,delay:i,loop:r}){this._volume=1,this.delay=0,this._loop=1,this.loopsRemaining=0,this._status="stopped",this.onEnd=()=>{this.loopsRemaining===1/0?this.replay():this.loopsRemaining>1?(this.replay(),this.loopsRemaining--):(this._status="stopped",this.loopsRemaining=this._loop)};let n;typeof t=="string"?n={src:t}:n={src:clt(t),format:"wav"},this.sound=new Kpe.Howl(n),this.sound.on("end",this.onEnd),this.src=t,e!==void 0&&(this.volume=e),i!==void 0&&(this.delay=i),r!==void 0&&(this.loop=r)}get status(){return this._status}get volume(){return this._volume}set volume(t){this._volume=t,this.sound.volume(t)}get loop(){return this._loop}set loop(t){this._loop=t,this.loopsRemaining=t}replay(){this.clearDelay(),this.delayTimerId=window.setTimeout(()=>{this.sound.play(),this.clearDelay()},this.delay)}fade(t,e=1e3){t?(this.sound.volume(this._volume),this.clearFade(),this.fadeTimerId=window.setTimeout(()=>{this.sound.fade(this._volume,0,e),this.clearFade()},t)):this.sound.fade(this._volume,0,e)}on(t,e,i){this.sound.on(t,e,i)}off(t,e,i){this.sound.off(t,e,i)}play(){this._status==="playing"||this.sound.playing()||(this._status==="paused"?(this.sound.seek()===0?this.replay():this.sound.play(),this._status="playing"):this._status==="stopped"&&(this.replay(),this._status="playing"))}pause(){this._status==="playing"&&(this.sound.pause(),this.clearFade(),this.clearDelay(),this._status="paused")}stop(){this.sound.stop(),this.loopsRemaining=this._loop,this.clearFade(),this.clearDelay(),this._status="stopped"}clearFade(){this.fadeTimerId&&(clearTimeout(this.fadeTimerId),delete this.fadeTimerId)}clearDelay(){this.delayTimerId&&(clearTimeout(this.delayTimerId),delete this.delayTimerId)}dispose(t=!1){this.off(),this.stop(),this.clearFade(),this.clearDelay()}},flt=class{constructor(){this.type="ShapePath",this.color=new Ai,this.subPaths=[],this.currentPath=null}moveTo(t,e){return this.currentPath=new WD,this.subPaths.push(this.currentPath),this.currentPath.moveTo(t,e),this}lineTo(t,e){return this.currentPath?.lineTo(t,e),this}quadraticCurveTo(t,e,i,r){return this.currentPath?.quadraticCurveTo(t,e,i,r),this}bezierCurveTo(t,e,i,r,n,s){return this.currentPath?.bezierCurveTo(t,e,i,r,n,s),this}splineThru(t){return this.currentPath?.splineThru(t),this}toShapes(){let t={ORIGIN:0,DESTINATION:1,BETWEEN:2,LEFT:3,RIGHT:4,BEHIND:5,BEYOND:6},e={loc:t.ORIGIN,t:0};function i(f,p,g,m){let y=f.x,b=p.x,w=g.x,E=m.x,M=f.y,A=p.y,P=g.y,C=m.y,R=(E-w)*(M-P)-(C-P)*(y-w),I=(b-y)*(M-P)-(A-M)*(y-w),k=(C-P)*(b-y)-(E-w)*(A-M),z=R/k,V=I/k;if(k===0&&R!==0||z<=0||z>=1||V<0||V>1)return null;if(R===0&&k===0){for(let F=0;F<2;F++)if(r(F===0?g:m,f,p),e.loc===t.ORIGIN){let $=F===0?g:m;return{x:$.x,y:$.y,t:e.t}}else if(e.loc===t.BETWEEN){let $=+(y+e.t*(b-y)).toPrecision(10),K=+(M+e.t*(A-M)).toPrecision(10);return{x:$,y:K,t:e.t}}return null}else{for(let K=0;K<2;K++)if(r(K===0?g:m,f,p),e.loc===t.ORIGIN){let X=K===0?g:m;return{x:X.x,y:X.y,t:e.t}}let F=+(y+z*(b-y)).toPrecision(10),$=+(M+z*(A-M)).toPrecision(10);return{x:F,y:$,t:z}}}function r(f,p,g){let m=g.x-p.x,y=g.y-p.y,b=f.x-p.x,w=f.y-p.y,E=m*w-b*y;if(f.x===p.x&&f.y===p.y){e.loc=t.ORIGIN,e.t=0;return}if(f.x===g.x&&f.y===g.y){e.loc=t.DESTINATION,e.t=1;return}if(E<-Number.EPSILON){e.loc=t.LEFT;return}if(E>Number.EPSILON){e.loc=t.RIGHT;return}if(m*b<0||y*w<0){e.loc=t.BEHIND;return}if(Math.sqrt(m*m+y*y)<Math.sqrt(b*b+w*w)){e.loc=t.BEYOND;return}let M;m!==0?M=b/m:M=w/y,e.loc=t.BETWEEN,e.t=M}function n(f,p){let g=[],m=[];for(let y=1;y<f.length;y++){let b=f[y-1],w=f[y];for(let E=1;E<p.length;E++){let M=p[E-1],A=p[E],P=i(b,w,M,A);P!==null&&g.find(C=>C.t<=P.t+Number.EPSILON&&C.t>=P.t-Number.EPSILON)===void 0&&(g.push(P),m.push(new Ae(P.x,P.y)))}}return m}function s(f,p,g){let m=new Ae;p.getCenter(m);let y=[];return g.forEach(b=>{b.boundingBox.containsPoint(m)&&n(f,b.points).forEach(w=>{y.push({identifier:b.identifier,isCW:b.isCW,point:w})})}),y.sort((b,w)=>b.point.x-w.point.x),y}function a(f,p,g,m,y){(y==null||y==="")&&(y="nonzero");let b=new Ae;f.boundingBox.getCenter(b);let w=[new Ae(g,b.y),new Ae(m,b.y)],E=s(w,f.boundingBox,p);E.sort((I,k)=>I.point.x-k.point.x);let M=[],A=[];E.forEach(I=>{I.identifier===f.identifier?M.push(I):A.push(I)});let P=M[0].point.x,C=[],R=0;for(;R<A.length&&A[R].point.x<P;)C.length>0&&C[C.length-1]===A[R].identifier?C.pop():C.push(A[R].identifier),R++;if(C.push(f.identifier),y==="evenodd"){let I=C.length%2===0,k=C[C.length-2];return{identifier:f.identifier,isHole:I,for:k}}else if(y==="nonzero"){let I=!0,k=null,z=null;for(let V=0;V<C.length;V++){let F=C[V];p[F]&&(I?(z=p[F].isCW,I=!1,k=F):z!==p[F].isCW&&(z=p[F].isCW,I=!0))}return{identifier:f.identifier,isHole:I,for:k}}else console.warn('fill-rule: "'+y+'" is currently not implemented.')}let o=0,l=999999999,c=-999999999,u=[];this.subPaths.forEach(f=>{let p=f.getPoints(),g=-999999999,m=999999999,y=-999999999,b=999999999;for(let w=0;w<p.length;w++){let E=p[w];E.y>g&&(g=E.y),E.y<m&&(m=E.y),E.x>y&&(y=E.x),E.x<b&&(b=E.x)}c<=y&&(c=y+1),l>=b&&(l=b-1),p.length&&u.push({curves:f.curves,points:p,isCW:Ihe.isClockWise(p),identifier:o++,boundingBox:new rG(new Ae(b,m),new Ae(y,g))})});let h=u.map(f=>a(f,u,l,c,this.userData?.style.fillRule)),d=[];return u.forEach(f=>{let p=h[f.identifier];if(p&&!p.isHole){let g=new qD;g.curves=f.curves,h.filter(m=>m?.isHole&&m.for===f.identifier).forEach(m=>{if(m){let y=u[m.identifier],b=new WD;b.curves=y.curves,g.holes.push(b)}}),d.push(g)}}),d}},Zpe=!1,Qpe,vte=new Promise(t=>{Qpe=t}),yte=!1,vR;function plt(){if(Zpe=!0,yte)return;if(vR)return vR;async function t(){let e=await Bc(()=>import("./opentype-U-0Y99ve.js"),[]);Qpe(e),yte=!0}return vR=t(),vR}var mlt=class{async load(t,e,i=()=>{}){let{load:r}=await vte;r(t,(n,s)=>{n||!s?i(n??"Something went wrong"):e(s)})}async parse(t){let{parse:e,Bidi:i}=await vte;try{let r=e(t),n=new i,s=a=>r.charToGlyphIndex(a.char);return n.registerModifier("glyphIndex",null,s),n.applyFeatures(r,r.defaultRenderOptions.features),{font:r,bidi:n}}catch(r){console.error(r)}}};async function glt(t){return await(await fetch(t)).arrayBuffer()}var vlt=new mlt;async function xte(t){let e,i,r=!1;if(t.url?(e=await glt(t.url),i=t.url,r=t.url.startsWith("/")):t.data&&(e=t.data.buffer.slice(t.data.byteOffset,t.data.byteOffset+t.data.byteLength)),e)if(Zpe){let n=await vlt.parse(e);if(n)return{font:n.font,url:i,intercepted:r,arr:e,bidi:n.bidi}}else return{font:void 0,url:i,intercepted:r,arr:e,bidi:null}}function ylt(t,e){return e.state.glyphIndex===t||e.state.fina===t||e.state.medi===t||e.state.init===t}var xlt=class{constructor(t){this._arrayBuffer=new ArrayBuffer(1),this._isLoaded=!1,this._intercepted=!1,this._isUserFont=t.isUserFont??!1,this._loadingPromise=xte(t).then(e=>{e&&(this._arrayBuffer=e.arr,this._url=e.url,this.font=e.font,this._intercepted=e.intercepted,this._isLoaded=!0,this._bidi=e.bidi)})}update(t){this._isLoaded=!1,this._isUserFont=t.isUserFont??!1,this._loadingPromise=xte(t).then(e=>{e&&(this._arrayBuffer=e.arr,this._url=e.url,this.font=e.font,this._intercepted=e.intercepted,this._isLoaded=!0,this._bidi=e.bidi)})}get url(){return this._url}get intercepted(){return this._intercepted}get isLoaded(){return this._isLoaded}get loadingPromise(){return this._loadingPromise}reverseLigaturesTable(t,e,i){if(!this._bidi)return[];let r=this._bidi;r.getTextGlyphs(e);let n=r.tokenizer.tokens,s=[],a=0,o=i.length===n.length;for(let l=0;l<i.length;l++){let c=i[l].index,u=String.fromCharCode(i[l].unicode),h=n[a];if(ylt(c,h)||o)s.push({char:u,index:c,replacements:[h.state.glyphIndex],replacementChars:[h.char]}),a++;else{let d=h.char,f="",p=[h.state.glyphIndex],g=[],m=!1;for(;!m;)a++,f=e.charAt(a),d+=f,p.push(t.charToGlyphIndex(f)),g=t.stringToGlyphs(d),g.length===1&&g[0].index===c&&(m=!0),a>e.length&&(m=!0);s.push({char:u,index:c,replacements:p,replacementChars:Array.from(d)}),a++}}return s}generateShapes(t,e,i){if(!this._isLoaded)return;let r=this.font,n=e.fontSize/this.unitsPerEm,s=e.fontSize*e.lineHeight,a=t.map(y=>this.getTextWidth(y,e)),o=typeof e.width=="string"?Number(i.getVariable(e.width)):e.width,l=typeof e.height=="string"?Number(i.getVariable(e.height)):e.height,c=this.getCharWidth(`
`,e),u=e.horizontalAlign===1?c:0,h=this.getLineInitialOffsetX(a[0],o,e.horizontalAlign,t[0],c),d=this.getLineInitialOffsetY(s,t.length,l,n,e.verticalAlign),f=[],p=t.map(y=>[]),g=t.map(y=>[]);for(let y=0;y<t.length;y++){let b=t[y],w={features:{liga:!0},letterSpacing:e.letterSpacing},E=[];try{E=r.stringToGlyphs(b,w)}catch(R){console.warn(R)}h=this.getLineInitialOffsetX(a[y],o,e.horizontalAlign,b,c);let M=[];try{M=this.reverseLigaturesTable(r,b,E)}catch(R){console.warn(R)}let A=this.computeSpaceWidthForLine(t,y,e,i),P=0,C=E[0];C&&e.horizontalAlign===2&&C.leftSideBearing!==void 0&&(h-=C.leftSideBearing*n),this.font?.forEachGlyph(b,h,d,e.fontSize,w,(R,I,k,z,V)=>{let F=R.index===0?`
`:R.unicode?String.fromCharCode(R.unicode):void 0,$=M[P],K=0;if(F===`
`)K=u;else if(F===" ")K=A;else{let X=this.createPath(R,n,I,k,e);X&&(K=X.offsetX,f.push(X.path))}if($.replacements.length===1)g[y].push([I,k]),p[y].push(K);else{let X=$.replacements.map(j=>(r.glyphs.get(j).advanceWidth??0)*n),U=X.reduce((j,ee)=>j+=ee,0),Y=X.map(j=>j/U),Z=I;for(let j=0;j<Y.length;j++){let ee=K*Y[j];g[y].push([Z,k]),p[y].push(ee),Z+=ee}}P++}),d-=s}let m=[];for(let y=0,b=f.length;y<b;y++)m.push(...f[y].toShapes());return{shapes:m,charWidths:p,lineWidths:a,charCoords:g}}get isUserFont(){return this._isUserFont}get arrayBuffer(){return this._arrayBuffer}get ascender(){return this.font?.ascender??0}get descender(){return this.font?.descender??0}get familyName(){return this.font?.names.fontFamily??""}get subfamilyName(){return this.font?.names.fontSubfamily??""}get unitsPerEm(){return this.font?.unitsPerEm??1}getLineInitialOffsetX(t,e,i,r,n){return(i===3||i===2)&&r.indexOf(`
`)>=0&&(t-=n),i===3?e*.5-t*.5:i===2?e-t:0}getLineInitialOffsetY(t,e,i,r,n){let s=e*t,a=Math.abs(this.ascender-this.descender)*r,o=t-a,l=-this.ascender*r-o/2;return n===3?-(i-s-l):n===2?-(i*.5-s*.5-l):l}createPath(t,e,i,r,n){let s=t.getPath(i,-r,n.fontSize,{kerning:!1,letterSpacing:n.letterSpacing});if(!s){console.error('THREE.Font: character "'+t+'" does not exists in font family '+this.familyName+".");return}let a=new flt,o=(t.advanceWidth??1)*e;if(t)for(let l of s.commands){let c=a.currentPath?.currentPoint;if(!(c&&l.type!=="Z"&&c.x===l.x&&-c.y===l.y))switch(l.type){case"M":a.moveTo(l.x,-l.y);break;case"L":a.lineTo(l.x,-l.y);break;case"Q":a.quadraticCurveTo(l.x1,-l.y1,l.x,-l.y);break;case"C":a.bezierCurveTo(l.x1,-l.y1,l.x2,-l.y2,l.x,-l.y);break}}return a.subPaths.forEach(l=>{let c=blt(l.curves);c!==void 0&&l.currentPoint.distanceTo(c)>0&&l.lineTo(c.x,c.y)}),{offsetX:o,path:a}}getCharWidth(t,e){return this.font?.getAdvanceWidth(t,e.fontSize,{kerning:!0,letterSpacing:e.letterSpacing})??0}getTextWidth(t,e){return this.font?.getAdvanceWidth(t,e.fontSize,{kerning:!0,letterSpacing:e.letterSpacing})??0}computeSpaceWidthForLine(t,e,i,r){let n=this.getCharWidth(" ",i),s=t[e];if(s){let a=this.countSpaces(s.trimEnd());if(i.horizontalAlign===4&&e<t.length-1&&a){let o=typeof i.width=="string"?Number(r.getVariable(i.width)):i.width,l=this.getTextWidth(s,i);return(o-(l-a*n))/a}}return n}countSpaces(t){return(t.match(/ /g)||[]).length}};function blt(t){if(t.length){let e=t[0];if(e instanceof Eh)return e.v1;if(e instanceof bh||e instanceof rv)return e.v0}}var wlt=class{constructor(){this.objects=new Map,this.unreachable=new Set}getCached(t){return this.objects.get(t)}get size(){return this.objects.size}get(t,e,i){let r=this.objects.get(t);return r===void 0?(r=this.createObject(t,e,i),this.objects.set(t,r)):r.isShared=!0,r}forceDelete(t){let e=this.objects.get(t);e&&(this.disposeObject(e),this.objects.delete(t))}mutateIfUnique(t,e){let i=this.objects.get(t);if(i&&i.isShared!==!0)return this.objects.delete(t),this.objects.set(e,i),i}startGc(){this.unreachable=new Set(this.objects.keys())}markAsReachable(t,e){let i=this.objects.get(t);e===i&&this.unreachable.delete(t)}endGc(){this.unreachable.forEach(t=>{this.disposeObject(this.objects.get(t)),this.objects.delete(t)}),this.unreachable.clear()}dispose(){this.objects.forEach(t=>{this.disposeObject(t)}),this.objects.clear()}},bte=class extends wlt{constructor(t){super(),this.flatShading=t}disposeObject(t){t.dispose()}createObject(t,e,i){let r=$M(t,e,this.flatShading,i);return r.computeBoundingSphere(),r}},_lt={markNeedsUpdateRendererDirty:()=>{}},uI=1e3,wte=512*uI;function Slt(t,e){let i=typeof t;return!!((e==="string"||e==="number")&&i===e||e==="boolean"&&(t==="true"||t==="false"||t===!0||t===!1)||e==="image"&&i==="string"&&t.startsWith("http"))}var Elt="https://hooks.spline.design",Alt=`${Elt}/events?hashFile=`,Mlt=class{constructor(t,e){this.id=t,this.userWebhook=e,this.result=void 0,this._connected=!1,this.emitter=TL(),this.reconnectWaitFor=uI,this._onError=i=>{this.eventSource?.removeEventListener("message",this._onMessage),this.eventSource?.removeEventListener("error",this._onError),this.eventSource?.removeEventListener("open",this._onConnected),this._scheduleReconnect()},this._onConnected=i=>{clearTimeout(this.scheduledReconnectHandle),this.reconnectWaitFor=uI,this._connected=!0},this._onDisconnected=()=>{clearTimeout(this.scheduledReconnectHandle),this.reconnectWaitFor=uI,this._connected=!1},this._onMessage=i=>{let r=i.data,n;try{n=JSON.parse(r)}catch(s){console.error("Error parsing webhook message",s)}if(n){let s=!1;this.userWebhook.parametersSchemas.forEach(({data:a})=>{n[a.name]!==void 0&&Slt(n[a.name],a.type)&&(this.result===void 0&&(this.result={}),this.result[a.name]=n[a.name],s=!0)}),s&&this.emitter.emit("message",{userWebhookId:this.id})}}}connect(){clearTimeout(this.scheduledReconnectHandle),this.userWebhook.url&&(this.eventSource=new EventSource(Alt+this.userWebhook.url),this.eventSource.addEventListener("message",this._onMessage),this.eventSource.addEventListener("error",this._onError),this.eventSource.addEventListener("open",this._onConnected))}disconnect(){this.eventSource?.removeEventListener("message",this._onMessage),this.eventSource?.removeEventListener("error",this._onError),this.eventSource?.removeEventListener("open",this._onConnected),this.eventSource?.close(),this._onDisconnected(),clearTimeout(this.scheduledReconnectHandle)}_scheduleReconnect(){this.reconnectWaitFor*=2,this.reconnectWaitFor>wte&&(this.reconnectWaitFor=wte),clearTimeout(this.scheduledReconnectHandle),this.scheduledReconnectHandle=setTimeout(()=>{this.scheduledReconnectHandle=void 0,this.connect()},this.reconnectWaitFor)}update(t){this.userWebhook=t}dispose(){this._connected&&this.disconnect()}get connected(){return this._connected}on(t,e){this.emitter.on(t,e)}off(t,e){this.emitter.off(t,e)}getParametersKeys(){return this.userWebhook.parametersSchemas.map(t=>t.data.name)}getParameterValue(t){if(this.getParametersKeys().includes(t)){if(this.result)return this.result?.[t];for(let e of this.userWebhook.parametersSchemas)if(e.data.name===t)return w5.defaultParameterValueByType(e.data.type)}}},_te=[4186.01,4434.92,4698.63,4978.03,5274.04,5587.65,5919.91,6271.93,6644.88,7040,7458.62,7902.13],Tlt=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],Xg=[],u8=[];for(let t=1;t<=8;t++)for(let e=0;e<_te.length;e++){let i=_te[e];Xg.push(i/Math.pow(2,8-t)),u8.push(Tlt[e]+t)}var U3=[32,2e3],Ste=Xg.filter((t,e)=>Xg[e]>U3[0]&&Xg[e]<U3[1]),Clt=u8.filter((t,e)=>Xg[e]>U3[0]&&Xg[e]<U3[1]),Plt=class{static getFrequencies(t,e,i,r="frequency",n=-100,s=-30){i||(i=new Float32Array(t.frequencyBinCount),t.getFloatFrequencyData(i));let a=e/2,o=1/i.length*a,l,c,u;if(r==="music"||r==="voice"){let d=r==="voice"?Ste:Xg,f=Array(d.length).fill(n);for(let p=0;p<i.length;p++){let g=p*o,m=i[p];for(let y=d.length-1;y>=0;y--)if(g>d[y]){f[y]=Math.max(f[y],m);break}}l=f,c=r==="voice"?Ste:Xg,u=r==="voice"?Clt:u8}else l=Array.from(i),c=l.map((d,f)=>o*f),u=c.map(d=>`${d.toFixed(2)} Hz`);let h=l.map(d=>Math.max(0,Math.min((d-n)/(s-n),1)));return{values:new Float32Array(h),frequencies:c,labels:u}}},Rlt="gpt-4o-realtime-preview-2024-12-17",Ilt=()=>"https://relayserver.spline.design/";async function Dlt(t){try{return(await(await fetch(Ilt()+"session?uuidfile="+t)).json()).token}catch(e){console.error("Token generation error:",e)}}var Olt=class{constructor(t){this.value=0,this.frequencies=new Float32Array(0);let e=new AudioContext;this.source=e.createMediaStreamSource(t),this.analyser=e.createAnalyser(),this.source.connect(this.analyser),this.analyser.fftSize=8192,this.analyser.smoothingTimeConstant=.1}getFrequencies(t=-100,e=-30){if(!this.analyser)throw new Error("Not connected, please call .connect() first");return Plt.getFrequencies(this.analyser,44100,void 0,"voice",t,e)}update(){let t=this.getFrequencies(),e=t.values.reduce((i,r)=>i+r,0)/t.values.length;this.value=e,this.frequencies=t.values}disconnect(){this.source.disconnect(),this.analyser.disconnect()}},Ete=class{constructor(t,e,i){this.data=t,this.id=e,this.shared=i,this.emitter=TL(),this.rafId=0,this.voice=0,this.frequencies=new Float32Array([0]),this.events=[],this.isConnected=!1,this.isToolsAdded=!1,this.tools=[],this.onMessage=r=>{let n=JSON.parse(r.data);if(this.appendEvent(n),n.type==="session.created"&&this.onSessionCreated(),n.type==="response.done"&&n.response?.output){for(let s of n.response.output)if(s.type==="function_call")for(let[a,o]of this.tools)s.name===a.name&&(o(JSON.parse(s.arguments)),setTimeout(()=>{this.sendClientEvent({type:"response.create",response:{instructions:"notice the user about what you just did"}})}))}},this.onSessionCreated=()=>{this.isToolsAdded||this.registerTools()},this.onOpen=()=>{this.events=[],this.isConnected=!0,this.sendClientEvent({type:"response.create",response:{instructions:"Say hi"}})},this.animate=()=>{if(this.rafId=requestAnimationFrame(this.animate),this.isConnected&&this.analyser){this.analyser.update();let r=this.analyser.value,n=this.analyser.frequencies;this.voice=r,this.frequencies=n,this.emitter.emit("voice",{value:r,frequencies:n})}}}update(t){this.data=t}setColorByName(t,e){let i=this.shared.getColorByName(t);if(i){let{id:r}=i,{r:n,g:s,b:a}=nat.hexStringToRgb(e)??{r:0,g:0,b:0};this.shared.updateColor(r,{r:n/255,g:s/255,b:a/255})}}async connect(){if(this.isConnected)return;let t=await Dlt(this.data.integration.hash);this.pc=new RTCPeerConnection,this.audioElement=document.createElement("audio"),this.audioElement.autoplay=!0,this.pc.ontrack=n=>{let s=n.streams[0];this.audioElement.srcObject=s,this.analyser=new Olt(s)};let e=await navigator.mediaDevices.getUserMedia({audio:!0});this.pc.addTrack(e.getTracks()[0]),this.dc=this.pc.createDataChannel("oai-events"),this.dc.addEventListener("message",this.onMessage),this.dc.addEventListener("open",this.onOpen);let i=await this.pc.createOffer();await this.pc.setLocalDescription(i);let r={type:"answer",sdp:await(await fetch(`https://api.openai.com/v1/realtime?model=${Rlt}`,{method:"POST",body:i.sdp,headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/sdp"}})).text()};await this.pc.setRemoteDescription(r),this.animate()}appendEvent(t){this.events=[t,...this.events]}sendClientEvent(t){this.dc?(t.event_id=t.event_id||crypto.randomUUID(),this.dc.send(JSON.stringify(t)),this.appendEvent(t)):console.error("Failed to send message - no data channel available",t)}registerTools(){this.isToolsAdded=!0,this.registerTool({type:"function",name:"set_personality_color",description:"returns a color based on the voice personality of the ai assistant. This should be called by the voice assistant each time it is asks to speak differently. If a color cannot be associated to the personality, the color should be a neutral color.",parameters:{type:"object",properties:{color:{type:"string",description:"css hex color string, reflecting the personality"},personality:{type:"string",description:"the personality of the voice assistant"}},required:["color","personality"]}},({color:n})=>{this.setColorByName("Voice Assistant Color",n)});let t=this.shared.getVariablesNames().join(", ");this.registerTool({type:"function",name:"set_variable",description:"Sets a Spline variable value when asked by the user.",parameters:{type:"object",properties:{name:{type:"string",description:`The name of the variable that needs to be set. Here's a list of available variables: ${t}. It the variable does not exist, don't call the function and warn the user about it.`},value:{type:"string",description:"The new value for this variable, should always be a string even for number and boolean variables, assume that the value will be cast to the proper type afterwards."}},required:["name","value","type"]}},({name:n,value:s})=>{let a=this.shared.getVariableByName(n);if(a){let o=this.shared.getVariable(a.id),l;typeof o=="number"?l=parseFloat(s):typeof o=="boolean"?l=s.toLowerCase()==="true":l={textValue:s},this.shared.updateVariable(a.id,l)}});let e=this.shared.getColorNames().join(", ");this.registerTool({type:"function",name:"set_color",description:"Sets a Spline color asset value when asked by the user.",parameters:{type:"object",properties:{name:{type:"string",description:`The name of the color asset that needs to be set. Here's a list of available color assets: ${e}. It the color asset does not exist, don't call the function and warn the user about it.`},value:{type:"string",description:"css hex color string"}},required:["name","value"]}},({name:n,value:s})=>{this.setColorByName(n,s)});let i=this.shared.scene,r=[];i.traverseEntity(n=>{n.data.events.forEach(s=>{if(s.data.type==="AIAssistantTrigger"){let{description:a}=s.data;r.push(a)}})}),this.registerTool({type:"function",name:"trigger_event",description:"Trigger an event by name, here are the available events, please match what the user is asking for to one of these if it applies, otherwise don't call the function and warn the user.",parameters:{type:"object",properties:{description:{type:"string",description:`The name of the event that needs to be triggered. Here's a list of available events: ${JSON.stringify(r)}.`},direction:{type:"string",description:"default is forward, but can be forward or backward. Always set to forward unless the user ask to reverse or cancel the event, then set to backward."}},required:["description","direction"]}},({description:n,direction:s})=>{this.emitter.emit("trigger_event",{description:n,direction:s})}),this.sendClientEvent({type:"session.update",session:{tools:this.tools.map(([n])=>n)}})}registerTool(t,e){this.tools.push([t,e])}disconnect(){cancelAnimationFrame(this.rafId),this.analyser?.disconnect(),this.voice=0,this.isConnected=!1,this.isToolsAdded=!1,this.dc?.removeEventListener("message",this.onMessage),this.dc?.removeEventListener("open",this.onOpen),this.dc?.close(),this.pc?.getSenders().forEach(t=>{t.track&&t.track.stop()}),this.pc?.close(),this.pc=void 0}computeAnalysisForListenerEvent(t){if(t.analysis==="range"){let e=this.frequencies.slice(...t.analysisRange);return e.reduce((i,r)=>i+r,0)/e.length}return t.analysis==="single"?this.frequencies[t.analysisSingle]:this.voice}on(t,e){this.emitter.on(t,e)}off(t,e){this.emitter.off(t,e)}};function Q5(t){return"variable_"+t}var Llt=class extends xot{constructor(t){super(),this.shared=t}create(t){return new Vpe(t,this.shared)}},h8=class{constructor(t,e={},i=!0,r=!1){if(this.data=t,this.needsJitter=i,this.enableLocalStorageForPersistentVariables=r,this.geometryCache=new bte(!0),this.geometryCache2=new bte(!1),this.imageHolderCache=new Llt(this),this.thisContext={scene:_lt,shared:this},this.deletedMaterial=new Z5(Ga.defaultTwoLayerData("phong"),this.thisContext,""),this.deletedImage=new Ag(E5.emptyImage,this),this.deletedVideo=new Ag(m3.defaultVideo,this),this.materials={},this.images={},this.uiBuffers={},this.videos={},this.colors={},this.audios={},this.particles={},this.fonts={},this.timelineAnimations={},this.variables={},this.userAPIs={},this.userWebhooks={},this.mouseProperty=null,this.raycastProperty=null,this.requestRender=()=>{this._requestRender&&this._requestRender()},e.images)for(let[n,s]of Object.entries(e.images))this.addImage(n,s);if(e.videos)for(let[n,s]of Object.entries(e.videos))this.addVideo(n,s);if(e.audios)for(let[n,s]of Object.entries(e.audios))this.addAudio(n,s);if(e.particles)for(let[n,s]of Object.entries(e.particles))this.addParticle(n,s);this.reset(t)}setRequestRender(t){this._requestRender=t}getImageLoadPromises(){return Object.values(this.images).map(t=>t.loadPromise)}setEntityOpContext(t){this.entityOpContext=t}reset(t,e=!1,i=!1){this.data=t,this.resetLib(t.lib);for(let{id:r,data:n}of t.variables)this.addVariableHolder(r,n),e&&this.updateVariableHolder(r,n);for(let[r,n]of Object.entries(t.userAPIs))this.addUserAPI(r,n);for(let[r,n]of Object.entries(t.userWebhooks))this.addUserWebhook(r,n);if(!i){for(let[r,n]of Object.entries(t.images))this.addImage(r,n);for(let[r,n]of Object.entries(t.videos))this.addVideo(r,n)}for(let[r,n]of Object.entries(t.colors))this.addColor(r,n);for(let[r,n]of Object.entries(t.materials))this.addMaterial(r,n);for(let[r,n]of Object.entries(t.audios))this.addAudio(r,n);for(let[r,n]of Object.entries(t.particles))this.addParticle(r,n);for(let[r,n]of Object.entries(t.fonts))this.addFont(r,n);for(let[r,n]of Object.entries(t.timelineAnimations??{}))this.addAnimation(r,n)}addMaterial(t,e){if(this.materials[t]){let i=this.materials[t];i.reset(e,this.thisContext),i.dispose()}else{let i=new Z5(e,this.thisContext,t);this.materials[t]=i}}deleteMaterial(t){this.materials[t]&&(this.materials[t].nodeMaterialDispose(),delete this.materials[t])}getMaterial(t){return this.materials[t]}getMaterialOrDeletedPlaceholder(t){return this.materials[t]??this.deletedMaterial}material(t){return typeof t=="string"?this.getMaterialOrDeletedPlaceholder(t):t==null?(console.error("material is undefined or null"),this.deletedMaterial):new c8(t,this.thisContext)}getMaterials(){return this.materials}addImage(t,e){return this.images[t]?(this.onColorOrImageUpdate&&this.onColorOrImageUpdate(),this.images[t].updateSrc(e.data),!0):(this.images[t]=new Ag(e,this),!1)}deleteImage(t){let e=this.images[t];e&&(e.dispose(),delete this.images[t])}getDefaultImage(){return this.images.image_0}getImage(t){return this.images[t]??this.deletedImage}image(t){return typeof t=="string"?this.getImage(t):this.imageHolderCache.load(t)}addUIBuffer(t,e){return this.uiBuffers[t]?(this.onColorOrImageUpdate&&this.onColorOrImageUpdate(),this.uiBuffers[t].updateSrc(e),!0):(this.uiBuffers[t]=new Ag(e,this),!1)}uiBuffer(t){return this.uiBuffers[t]}addVideo(t,e){return this.videos[t]?(this.videos[t].updateSrc(e.data),!0):(this.videos[t]=new Ag(e,this),!1)}deleteVideo(t){let e=this.videos[t];e&&(e.dispose(),delete this.videos[t])}getVideo(t){return this.videos[t]??this.deletedVideo}video(t){return typeof t=="string"?this.getVideo(t):this.imageHolderCache.load(t)}addColor(t,e){return this.colors[t]?(this.onColorOrImageUpdate&&this.onColorOrImageUpdate(),"a"in e?this.colors[t].setRGBA(e.r,e.g,e.b,e.a):this.colors[t].setRGBA(e.r,e.g,e.b,1),!0):("a"in e?this.colors[t]=new N3(e.r,e.g,e.b,e.a):this.colors[t]=new N3(e.r,e.g,e.b,1),!1)}updateColor(t,e){if(this.colors[t]){this.onColorOrImageUpdate&&this.onColorOrImageUpdate();let i=this.colors[t];return this.colors[t].r=e.r??i.r,this.colors[t].g=e.g??i.g,this.colors[t].b=e.b??i.b,this.colors[t].a=e.a??i.a,!0}return!1}deleteColor(t){this.colors[t]&&delete this.colors[t]}getColor(t){return this.colors[t]}getColorNames(){return Object.values(this.data.colors).map(t=>t.name)}getColorByName(t){for(let e in this.data.colors)if(this.data.colors[e].name===t)return{color:this.colors[e],id:e}}color(t){let e;if(typeof t=="string"){let i=this.getColor(t);i?e=i:(console.warn("Tried to create color layer params with a color key that does not exist in the assets manager"),e=new Ya(0,0,0,0))}else return"a"in t?new Ya(t.r,t.g,t.b,t.a):new Ya(t.r,t.g,t.b,1);return e}addAudio(t,e){this.audios[t]=e}getAudio(t){let e=this.audios[t];if(e instanceof JE)return e;{let i=new JE({src:e.data});return this.audios[t]=i,i}}addParticle(t,e){this.particles[t]=e}getParticle(t){return this.particles[t]}deleteParticle(t){this.particles[t]&&delete this.particles[t]}deleteAudio(t){let e=this.audios[t];e&&(e instanceof JE&&e.dispose(),delete this.audios[t])}addFont(t,e){this.fonts[t]=new xlt(e),this.fonts[t].loadingPromise.then(()=>this.requestRender())}getFont(t){return this.fonts[t]}deleteFont(t){this.fonts[t]&&delete this.fonts[t]}addAnimation(t,e){this.timelineAnimations[t]=e}getAnimation(t){return this.timelineAnimations[t]}deleteAniamtion(t){this.timelineAnimations[t]&&delete this.timelineAnimations[t]}dispose(){Object.keys(this.materials).forEach(t=>this.deleteMaterial(t)),this._requestRender=void 0,Object.values(this.audios).forEach(t=>{t instanceof JE&&t.dispose()}),this.audios={},this.particles={},this.geometryCache.dispose(),this.geometryCache2.dispose()}addVariableHolder(t,e){if(this.variables[t]===void 0){let i=e.value;if(this.enableLocalStorageForPersistentVariables&&e.persistent){let r=localStorage.getItem(Q5(t));i=r!==null?JSON.parse(r):e.value}return this.variables[t]={value:i,locations:[],persistent:e.persistent},"dynamicVariableType"in e&&(this.variables[t].dynamicVariablePlayState="Playing",this.variables[t].dynamicVariableToggleIsForward=void 0),!0}return this.variables[t].value=e.value,!1}resetDynamicVariablePlayState(){for(let t in this.variables)this.variables[t].dynamicVariablePlayState!==void 0&&(this.variables[t].dynamicVariablePlayState="Playing",this.variables[t].dynamicVariableToggleIsForward=void 0)}updateVariableHolder(t,e){this.updateVariable(t,e.value)}updateVariable(t,e){if(this.variables[t]===void 0)return!1;this.variables[t].value=e,this.enableLocalStorageForPersistentVariables&&this.variables[t].persistent&&localStorage.setItem(Q5(t),JSON.stringify(e));let i=e;for(;typeof i=="string";)i=this.variables[i].value;let r=this.entityOpContext.scene;for(let n=this.variables[t].locations.length-1;n>=0;n--){let s=this.variables[t].locations[n];if(s[0]==="material"){let a=s[1],o=i,l={scene:r,shared:this},c=s.slice(2);r.traverseMaterial(h=>{let d=h.root??h;d.uuid===a&&d.onVariableUpdate(c,o,l)});let u=this.materials[a];u&&u.onVariableUpdate(c,o,l)}else{let a=r.find(s[0]);if(a===void 0){this.variables[t].locations.splice(n,1);continue}if(s[1]!=="geometry"&&s[1]!=="particles"){for(let o=1;o<s.length-1;o++)a=a[s[o]];s[1]==="rotation"?a[s[s.length-1]]=i*Ht.DEG2RAD:a[s[s.length-1]]=i}if(a=r.find(s[0]),a.type==="ParticleEmitter"&&a.updateVariableState(i,s),Er.is(a))if(s[1]==="position"||s[1]==="rotation"||s[1]==="scale")a.onVariableUpdate();else if(s[1]==="geometry"){let o=a;a.component&&(o=a.component);let l=o.dataPatched;o.chooseGeoemtryCache(this).forceDelete(l.geometry),o.createGeometryDelayed(this.entityOpContext),o.onVariableUpdate(!0),o.invalidateDownstreamBooleanData(),o.instances.forEach(c=>{let u=c.dataPatched;c.chooseGeoemtryCache(this).forceDelete(u.geometry),c.createGeometryDelayed(this.entityOpContext),c.onVariableUpdate(!0),c.invalidateDownstreamBooleanData()})}else s[1]==="morphTargetInfluences"&&a.updateMorphInfluences(s[2],i)}}return this.requestRender(),!0}deleteVariable(t){this.variables[t]&&delete this.variables[t]}getVariable(t,e){if(Array.isArray(t)){if(t[0]==="mouse")return this.mouseProperty?.[t[1]]??0;if(t[0]==="raycast")return this.raycastProperty?.[t[1]]??0;let i=this.entityOpContext.scene.find(t[0]);if(t[1]==="width"||t[1]==="height"||t[1]==="depth")return i.geometry.userData.parameters[t[1]];for(let r=1;r<t.length;r++)i=i[t[r]];return t[1]==="rotation"&&(i*=Ht.RAD2DEG),i}for(let i in this.variables){if(e===void 0)break;let r=this.variables[i],n=r.locations?.findIndex(s=>fa.equal(s,e));n!==void 0&&n!==-1&&r.locations.splice(n,1)}if(typeof t=="string"){let i=t,r=t;do{if(r=i,this.variables[i]===void 0)break;let n=this.variables[i].value;e&&this.variables[r]!==void 0&&this.variables[r].locations.push(e),i=n}while(typeof i=="string");return i}else return t}getVariables(){return this.variables}getVariablesNames(){return this.data.variables.map(t=>t.data.name)}getVariableByName(t){for(let e of this.data.variables)if(e.data.name===t)return{variable:e.data,id:e.id}}getDynamicVariablePlayState(t){return this.variables[t]?.dynamicVariablePlayState}setDynamicVariablePlayState(t,e){this.variables[t]!==void 0&&(this.variables[t].dynamicVariablePlayState=e)}getDynamicVariableToggleIsForward(t){return this.variables[t]?.dynamicVariableToggleIsForward}setDynamicVariableToggleIsForward(t,e){this.variables[t]!==void 0&&(this.variables[t].dynamicVariableToggleIsForward=e)}resetLib(t){for(let[e,i]of Object.entries(t.images))this.addImage(e,i.asset);for(let[e,i]of Object.entries(t.audios))this.addAudio(e,i.asset);for(let[e,i]of Object.entries(t.particles))this.addParticle(e,i.asset);for(let[e,i]of Object.entries(t.colors))this.addColor(e,i.asset);for(let[e,i]of Object.entries(t.fonts))this.addFont(e,i.asset);for(let[e,i]of Object.entries(t.materials))this.addMaterial(e,i.asset);for(let[e,i]of Object.entries(t.videos))this.addVideo(e,i.asset);for(let[e,i]of Object.entries(t.variables))this.addVariableHolder(e,i.asset)}updateLibByOp(t,e){t.path[0]==="images"?t.path.length===1&&t.type===1?this.addImage(t.id,t.data.asset):t.path.length===1&&t.type===2&&this.deleteImage(t.id):t.path[0]==="videos"?t.path.length===1&&t.type===1?this.addVideo(t.id,t.data.asset):t.path.length===1&&t.type===2&&this.deleteVideo(t.id):t.path[0]==="audios"?t.path.length===1&&t.type===1?this.addAudio(t.id,t.data.asset):t.path.length===1&&t.type===2&&this.deleteAudio(t.id):t.path[0]==="particles"?t.path.length===1&&t.type===1?this.addParticle(t.id,t.data.asset):t.path.length===1&&t.type===2&&this.deleteParticle(t.id):t.path[0]==="colors"?t.path.length===1&&t.type===1?this.addColor(t.id,t.data.asset):t.path.length===1&&t.type===2&&this.deleteColor(t.id):t.path[0]==="materials"?t.path.length===1&&t.type===1?this.addMaterial(t.id,t.data.asset):t.path.length===1&&t.type===2&&this.deleteMaterial(t.id):t.path[0]==="fonts"?t.path.length===1&&t.type===1?this.addFont(t.id,t.data.asset):t.path.length===1&&t.type===2&&this.deleteFont(t.id):t.path[0]==="variables"?t.path.length===1&&t.type===1?this.addVariableHolder(t.id,t.data.asset):t.path.length===1&&t.type===2&&this.deleteVariable(t.id):t.path[0]==="components"&&e.updateByLibOp(t,this)}updateByOp(t,e,i){if(this.data=e,t.path[0]==="images")t.path.length===2&&t.type===0?t.props.data&&this.getImage(t.path[1]).updateSrc(t.props.data):t.path.length===1&&t.type===1?this.addImage(t.id,t.data):t.path.length===1&&t.type===2&&this.deleteImage(t.id);else if(t.path[0]==="videos")t.path.length===2&&t.type===0?t.props.data&&this.getVideo(t.path[1]).updateSrc(t.props.data):t.path.length===1&&t.type===1?this.addVideo(t.id,t.data):t.path.length===1&&t.type===2&&this.deleteVideo(t.id);else if(t.path[0]==="audios")t.path.length===2&&t.type===0?t.props.data&&this.addAudio(t.path[1],e.audios[t.path[1]]):t.path.length===1&&t.type===1?this.addAudio(t.id,t.data):t.path.length===1&&t.type===2&&this.deleteAudio(t.id);else if(t.path[0]==="particles")t.path.length===2&&t.type===0?t.props.data&&this.addParticle(t.path[1],e.particles[t.path[1]]):t.path.length===1&&t.type===1?this.addParticle(t.id,t.data):t.path.length===1&&t.type===2&&this.deleteParticle(t.id);else if(t.path[0]==="colors")t.path.length===2&&t.type===0?this.updateColor(t.path[1],t.props):t.path.length===1&&t.type===1?this.addColor(t.id,t.data):t.path.length===1&&t.type===2&&this.deleteColor(t.id);else if(t.path[0]==="materials")t.path.length===1&&t.type===1?this.addMaterial(t.id,t.data):t.path.length===1&&t.type===2?this.deleteMaterial(t.id):t.path.length>1&&this.getMaterial(t.path[1]).updateByOp(Ha.drop(t,2),e.materials[t.path[1]],{shared:this,scene:i});else if(t.path[0]==="fonts")t.path.length===2&&t.type===0?this.updateFont(t.path[1],t,i):t.path.length===1&&t.type===1?this.addFont(t.id,t.data):t.path.length===1&&t.type===2&&this.deleteFont(t.id);else if(t.path[0]==="variables")t.path.length===2&&t.type===0?"value"in t.props?this.updateVariable(t.path[1],t.props.value):"persistent"in t.props&&(this.variables[t.path[1]].persistent=t.props.persistent):t.path.length===1&&t.type===4?this.addVariableHolder(t.id,t.data):t.path.length===1&&t.type===5&&this.deleteVariable(t.id);else if(t.path[0]==="userAPIs"){if(t.path.length===1&&t.type===1)this.addUserAPI(t.id,t.data);else if(t.path.length===1&&t.type===2)this.deleteUserAPI(t.id);else if(typeof t.path[1]=="string"){let r=e.userAPIs[t.path[1]];if(r){let n=t.type===0&&t.props.debounce===void 0,s=this.getUserAPI(t.path[1]);s instanceof Ete?s.update(r):s?.update(r,this,n)}}}else if(t.path[0]==="userWebhooks"){if(t.path.length===1&&t.type===1)this.addUserWebhook(t.id,t.data);else if(t.path.length===1&&t.type===2)this.deleteUserWebhook(t.id);else if(typeof t.path[1]=="string"){let r=e.userWebhooks[t.path[1]];r&&this.getUserWebhook(t.path[1])?.update(r)}}else t.path[0]==="lib"&&this.updateLibByOp(Ha.drop(t,1),i)}updateFont(t,e,i){if(e.props.url){let r=this.getFont(t),n={...this.data.fonts[t],url:e.props.url};r.update(n),r.loadingPromise.then(()=>this.requestRender()),i.updateFont(t,this)}}addUserAPI(t,e){return this.userAPIs[t]?(this.userAPIs[t].update(e,this),!0):this.openAIRealtime?.id===t?(this.openAIRealtime.update(e),!0):e.integration?.type==="VoiceAssistant"?(this.openAIRealtime=new Ete(e,t,this),!1):(this.userAPIs[t]=new spe(t,e,this),!1)}getUserAPI(t){return this.openAIRealtime?.id===t?this.openAIRealtime:this.userAPIs[t]}getUserAPIs(){return this.userAPIs}deleteUserAPI(t){let e=this.userAPIs[t];e&&(e.dispose(),delete this.userAPIs[t])}addUserWebhook(t,e){return this.userWebhooks[t]?(this.userWebhooks[t].update(e),!0):(this.userWebhooks[t]=new Mlt(t,e),!1)}getUserWebhook(t){return this.userWebhooks[t]}getUserWebhooks(){return this.userWebhooks}deleteUserWebhook(t){let e=this.userWebhooks[t];e&&(e.dispose(),delete this.userWebhooks[t])}get scene(){return this.entityOpContext.scene}};new h8(hu.emptyData());var sv=class extends So{updateByPatchedOp(t,e,i){if(super.updateByPatchedOp(t,e,i),qtt(t.path,["materials"])!==null&&t.type===0&&Array.isArray(this.material))for(let[r,n]of Object.entries(t.props)){let s=i.shared.material(n);this.material[Number(r)]=s}else if(yn(t.path,["material"])&&this.material instanceof Qp)"material"in e&&typeof e.material!="string"&&this.material.updateByOp(Ha.drop(t,1),e.material,i);else if(yn(t.path,["materials","*"])&&Array.isArray(this.material)){let r=t.path[1];if("materials"in e&&r<this.material.length){let n=e.materials[r];typeof n!="string"&&this.material[r].updateByOp(Ha.drop(t,2),n,i)}}}get needsAO(){return this.material!==void 0?(Array.isArray(this.material)?this.material[0]:this.material).hasAO:!1}updateState(t,e){super.updateState(t,e),t.castShadow!==void 0&&(this.castShadow=t.castShadow),t.receiveShadow!==void 0&&(this.receiveShadow=t.receiveShadow);let i=this.dataPatched;this.dataPatched.type==="Mesh"&&this.dataPatched.geometry.shapeBlendNode&&this.layers.set(9);let r;this.dataPatched.type==="Mesh"&&this.dataPatched.geometry.type==="ShapeBlendGeometry"&&(r={resolutionLevel:this.dataPatched.geometry.resolutionLevel,useChildrenColors:this.dataPatched.geometry.useChildrenColors}),t.geometry?.type!=="NonParametricGeometry"&&"material"in t&&t.material!==void 0&&(this.disposeMaterial(),this.material=e.shared.material(t.material).getFlavor(i.flatShading,i.side,i.wireframe,r),e.scene.markNeedsUpdateRendererDirty()),(t.geometry?.type==="NonParametricGeometry"||"materials"in t)&&("materials"in t&&t.materials!==void 0?(this.disposeMaterial(),this.material=t.materials.map(s=>e.shared.material(s).getFlavor(i.flatShading,i.side,i.wireframe)),e.scene.markNeedsUpdateRendererDirty()):"material"in t&&t.material!==void 0&&(this.disposeMaterial(),this.material=[e.shared.material(t.material).getFlavor(i.flatShading,i.side,i.wireframe)],e.scene.markNeedsUpdateRendererDirty()));let n=this.data;if(n.geometry?.type!=="NonParametricGeometry"&&"materials"in n&&n.materials!==void 0&&(this.disposeMaterial(),this.material=e.shared.material(n.materials[0]).getFlavor(i.flatShading,i.side,i.wireframe)),t.flatShading!==void 0||t.wireframe!==void 0||t.side!==void 0)if(Array.isArray(this.material))for(let s=0;s<this.material.length;s++)this.material[s]=this.material[s].getFlavor(i.flatShading,i.side,i.wireframe);else this.material=this.material.getFlavor(i.flatShading,i.side,i.wireframe,r)}disposeMaterial(){this.material&&Ude(this.material).forEach(t=>{t instanceof Qp&&(t instanceof Z5||t.nodeMaterialDispose())})}dispose(){this.disposeMaterial(),super.dispose()}},Ate=new W,Mte=new Ui,Tte=new Ui,klt=new W,Cte=new St,bs=class extends sv{constructor(t,e,i){super(t,e),this.data=e,this.isSkinnedMesh=!1,this.localGeometry=void 0,e.bindMode&&e.bindMatrix&&(this.bindMode=e.bindMode,this.bindMatrix=new St().fromArray(e.bindMatrix),this.bindMatrixInverse=new St)}chooseGeoemtryCache(t){return t.geometryCache}markGeometryAsReachable(t){this.geometryCreateDeleyed instanceof oi&&this.chooseGeoemtryCache(t).markAsReachable(this.dataPatched.geometry,this.geometryCreateDeleyed)}get geometry(){if(this.localGeometry!==void 0)return this.localGeometry;if(this.geometryCreateDeleyed instanceof h8){let t=this.geometryCreateDeleyed,e=this.chooseGeoemtryCache(t);this.geometryCreateDeleyed=e.get(this.dataPatched.geometry,t,this)}return this.geometryCreateDeleyed}set geometry(t){this.localGeometry=t}get is2DAndNoDepth(){let t=this.dataPatched.geometry;return y3.is2DParametricMesh(t.type)&&t.depth===0}get is2DType(){return y3.is2DParametricMesh(this.geometry.userData.type)}get isNonParametric(){return this.geometry.userData.type==="NonParametricGeometry"}updateByPatchedOp(t,e,i){super.updateByPatchedOp(t,e,i),yn(t.path,["geometry"])&&this.updateByPatchedOpGeometry(Ha.drop(t,1),e.geometry,i)}removeInteractionGeometry(t){this.localGeometry?.dispose(),this.localGeometry=void 0}updateGeometryInteractions(t,e){this.invalidateDownstreamBooleanData();let i=this.data.geometry.type;if(i==="NonParametricGeometry"||i==="SubdivGeometry"){let r=t;if(this.localGeometry===void 0){let l={...this.data.geometry,...r};this.localGeometry=$M(l,e,this.data.flatShading,this)}let n,s,a;r.scaleBaked?[n,s,a]=r.scaleBaked:{width:n,height:s,depth:a}=r;let o=this.localGeometry.userData;o.sxPrev!==void 0&&W5(this.localGeometry.attributes,n/o.sxPrev,s/o.syPrev,a/o.szPrev),o.sxPrev=n,o.syPrev=s,o.szPrev=a}else{let r={...this.data.geometry,...t};this.localGeometry?.dispose(),this.localGeometry=$M(r,e,this.data.flatShading,this)}}refreshAttachedClonersInteractions(){for(let t of this.attachedSurfaceCloners)t.update()}refreshAttachedCloners(t){for(let e of this.attachedSurfaceCloners)t.scene.addPendingUpdateCloner(e.object)}refreshAttachedPaths(t){for(let e of this.attachedPaths)t.scene.addPendingCommand(()=>e.updateShape())}createGeometryDelayed(t){this.geometryCreateDeleyed=t.shared,this.refreshAttachedCloners(t),this.refreshAttachedPaths(t)}updateByPatchedOpGeometry(t,e,i){let r=!1;t.type===0&&t.path.length===0&&Object.keys(t.props).includes("scaleBaked")&&this.geometryCreateDeleyed instanceof hl&&this.chooseGeoemtryCache(i.shared).mutateIfUnique(this.geometryCreateDeleyed.data,e)===this.geometryCreateDeleyed&&(r=!0,this.geometryCreateDeleyed.mutateDirectlyScaleBaked(e,t.props.scaleBaked),this.refreshAttachedCloners(i),this.refreshAttachedPaths(i)),r||(i.scene?.markGeometryCacheDirty(),this.createGeometryDelayed(i)),this.resetBBoxNeedsUpdate(),this.invalidateDownstreamBooleanData()}updateGeometryOnStateUpdate(t,e){this.createGeometryDelayed(e)}updateState(t,e){t.geometry!==void 0&&this.updateGeometryOnStateUpdate(t.geometry,e);let i=t.morphTargetInfluences;if(i){this.updateMorphTargets(),this.geometry.morphTargetsRelative=!0;for(let{data:{name:r,value:n}}of i)this.updateMorphInfluences(r,e.shared.getVariable(n,[this.uuid,"morphTargetInfluences",r]))}super.updateState(t,e)}updateMorphInfluences(t,e){if(this.morphTargetDictionary===void 0)return;let i=this.morphTargetDictionary[t];i!==void 0&&(this.morphTargetInfluences[i]=e)}updateGeometryGroupsIfNeeded(){Array.isArray(this.material)&&this.geometry.groups.length===0&&this.geometry.addGroup(0,Math.max(this.geometry.getIndex()?.count??0,this.geometry.getAttribute("position").count),0)}updateEntityBoxSize(t,e){let i=this.geometry.userData.parameters;this.is2DType?t.set(0,0,i.depth*.5):this.isNonParametric?(t.setScalar(0),this.geometry.boundingSphere&&t.copy(this.geometry.boundingSphere.center),e.set(i.width,i.height,i.depth??0).multiplyScalar(.5)):i.centerOffset?t.fromArray(i.centerOffset):t.setScalar(0),e.set(i.width,i.height,i.depth??0).multiplyScalar(.5)}updateMatrixWorld(t){super.updateMatrixWorld(t),this.bindMode==="attached"?this.bindMatrixInverse.copy(this.matrixWorld).invert():this.bindMode==="detached"&&this.bindMatrixInverse.copy(this.bindMatrix).invert()}bind(t,e){this.skeleton=t,this.isSkinnedMesh=!0,e===void 0&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),e=this.matrixWorld),this.bindMatrix.copy(e),this.bindMatrixInverse.copy(e).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(t){let e=new Ui,i=this.geometry.attributes.skinWeight;for(let r=0,n=i.count;r<n;r++){e.fromBufferAttribute(i,r);let s=1/e.manhattanLength();s!==1/0?e.multiplyScalar(s):e.set(1,0,0,0),i.setXYZW(r,e.x,e.y,e.z,e.w)}}boneTransform(t,e){let i=this.skeleton;if(i===void 0)return;let r=this.geometry;Mte.fromBufferAttribute(r.attributes.skinIndex,t),Tte.fromBufferAttribute(r.attributes.skinWeight,t),Ate.copy(e).applyMatrix4(this.bindMatrix),e.set(0,0,0);for(let n=0;n<4;n++){let s=Tte.getComponent(n);if(s!==0){let a=Mte.getComponent(n);Cte.multiplyMatrices(i.bones[a].matrixWorld,i.boneInverses[a]),e.addScaledVector(klt.copy(Ate).applyMatrix4(Cte),s)}}return e.applyMatrix4(this.bindMatrixInverse)}};function Nlt(t){if(t.geometry.attributes.extrudeNormal||!t.geometry.attributes.position||!t.geometry.attributes.normal)return;let e=new Map,i=t.geometry.attributes,r=i.position.array,n=i.normal.array,s=new Float32Array(r.length);for(let a=0;a<r.length;a+=3){let o=`${r[a]}_${r[a+1]}_${r[a+2]}`,l=new W(n[a],n[a+1],n[a+2]);e.has(o)?e.get(o)?.normals.push(l):e.set(o,{normals:[l],result:new W})}e.forEach((a,o)=>{for(let l of a.normals)a.result.add(l);a.result.divideScalar(a.normals.length)});for(let a=0;a<r.length;a+=3){let o=`${r[a]}_${r[a+1]}_${r[a+2]}`,l=e.get(o)?.result;l&&(s[a]=l.x,s[a+1]=l.y,s[a+2]=l.z)}t.geometry.setAttribute("extrudeNormal",new Gt(s,3))}function Ult(t){if(t.geometry.attributes.extrudeNormals||!t.geometry.attributes.position)return;let e=t.geometry.attributes.position.array,i=new Float32Array(e.length),r=new W;for(let n=0;n<e.length;n+=3)r.set(e[n],e[n+1],e[n+2]).normalize(),i[n]=r.x,i[n+1]=r.y,i[n+2]=r.z;t.geometry.setAttribute("extrudeNormal",new Gt(i,3))}function d8(t){if(Array.isArray(t.material)){for(let e of t.material)if(e.getLayersOfType("outline").length===0)return}else if(!(t.material instanceof Qp)||t.material.getLayersOfType("outline").length===0)return;t instanceof bs&&t.is2DAndNoDepth?Ult(t):Nlt(t)}function f8(t){if(!t.geometry.attributes.position)return;let e=t.geometry.attributes.position.array,i=new Float32Array(e.length),r=parseInt(t.uuid.replace(/\D/g,"")),n=[Ht.seededRandom(r),Ht.seededRandom(r+1e4),Ht.seededRandom(r+2e4)];for(let s=0;s<e.length;s++)i[s]=n[s%3];t.geometry.setAttribute("randomColor",new Mi(i,3))}var ld=new Ss,SE=new W;function Blt(t){let e=!1;return t.scene.objects.traverse((i,r)=>{r.type==="Mesh"&&r.geometry.type==="SubdivGeometry"&&(e=!0)}),e}var YM=class extends bs{constructor(t,e,i){super(t,e,i),this.data=e,this.hiddenMatrixOld=new St,this.smoothShading=!0,this.skipReactionUpdate=!1}chooseGeoemtryCache(t){return this.dataPatched.flatShading?t.geometryCache:t.geometryCache2}get subdivPointerNew(){return this.localGeometry!==void 0?this.subdivPointer:this.geometry.ensureSubdivPointer()}get originalGeometryNew(){return this.localGeometry!==void 0?this.originalGeometry:this.geometry.originalGeometry}get phongAngle(){return this.data.geometry.phongAngle??45}updateEntityBoxSize(t,e){let i=this.geometry.userData.parameters;t.copy(this.originalGeometryNew.boundingSphere.center),e.set(i.width,i.height,i.depth??0).multiplyScalar(.5)}createGeometryByControls(t){if(this.skipReactionUpdate===!0)return;let e=this.localGeometry?.uuid,{originalGeometry:i,subdividedGeometry:r,subdivPointer:n}=hl.build(t,this.subdivPointer,this.smoothShading,this.hasNonUniformScale?this.shearScale:void 0);this.subdivPointer=n,i!==void 0&&(this.originalGeometry?.dispose(),this.originalGeometry=i),r!==void 0&&(this.subdividedGeometry?.dispose(),this.subdividedGeometry=r??void 0),this.localGeometry=this.subdividedGeometry??this.originalGeometry,d8(this),f8(this),this.calcBoundingBox(),e&&(this.localGeometry.uuid=e)}updateState(t,e){if(super.updateState(t,e),t.flatShading!==void 0){let i=this.material;this.material=Array.isArray(i)?i.map(r=>r.getFlavor(!1,r.side,r.wireframe)):i.getFlavor(!1,i.side,i.wireframe),this.smoothShading=!t.flatShading,this.createGeometryDelayed(e)}}updateMesh(t=!1){hl.buildLevel(this.subdivPointer,!0,this.smoothShading?this.phongAngle:-1,this.originalGeometry,t&&this.hasNonUniformScale?this.shearScaleInv:void 0),this.subdividedGeometry&&hl.buildLevel(this.subdivPointer,!1,this.smoothShading?this.phongAngle:-1,this.subdividedGeometry,t&&this.hasNonUniformScale?this.shearScaleInv:void 0)}updateTopology(){this.originalGeometry.dispose(),this.originalGeometry=hl.buildLevel(this.subdivPointer,!0,this.smoothShading?this.phongAngle:-1),this.subdividedGeometry&&(this.subdividedGeometry.dispose(),this.subdividedGeometry=hl.buildLevel(this.subdivPointer,!1,this.smoothShading?this.phongAngle:-1)),this.localGeometry=this.subdividedGeometry??this.originalGeometry}raycast(t,e){let i=this.localGeometry;this.localGeometry=this.originalGeometryNew,So.prototype.raycast.call(this,t,e),this.localGeometry=i}activateSVDCompensation(){!this.hasNonUniformScale||(this.matrix.copy(this.matrixWorldRigid),this.hiddenMatrixOld.copy(this.hiddenMatrix),this.hiddenMatrix.copy(this.parent.matrixWorld).invert())}deactivateSVDCompensation(){!this.hasNonUniformScale||(this.updateMatrix(),this.hasNonUniformScale=void 0,this.hiddenMatrix.copy(this.hiddenMatrixOld))}calcBoundingBox(){let t=this.originalGeometry;t.boundingSphere===null&&(t.boundingSphere=new oc,this.subdividedGeometry&&(this.subdividedGeometry.boundingSphere=t.boundingSphere));let e=t.attributes.position,i=t.boundingSphere.center;ld.setFromBufferAttribute(e),ld.getCenter(i),t.boundingSphere.radius=i.distanceTo(ld.max),isNaN(t.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this),ld.getSize(SE),this.hasNonUniformScale&&SE.divide(this.scale);let r={width:SE.x,height:SE.y,depth:SE.z};return this.geometry.userData.parameters=r,r}updateBoundingSphere(t){let e=this.originalGeometry;ld.min.set(t[0],t[2],t[4]),ld.max.set(t[1],t[3],t[5]),this.hasNonUniformScale&&(ld.min.applyMatrix4(this.shearScaleInv),ld.max.applyMatrix4(this.shearScaleInv)),e.boundingSphere===null&&(e.boundingSphere=new oc);let i=e.boundingSphere.center;ld.getCenter(i),e.boundingSphere.radius=i.distanceTo(ld.max)}freeSubdivPointer(){this.subdivPointer&&(hl.freeSubdivPointer(this.subdivPointer),this.subdivPointer=0),this.localGeometry=void 0,this.originalGeometry?.dispose(),this.subdividedGeometry?.dispose()}dispose(){super.dispose(),this.freeSubdivPointer()}updateByPatchedOpGeometry(t,e,i){super.updateByPatchedOpGeometry(t,e,i),this.localGeometry&&this.createGeometryByControls(e)}},Pte=-1,Flt=1,zlt={x:[1,0,0],"-x":[-1,0,0],y:[0,1,0],"-y":[0,-1,0],z:[0,0,1],"-z":[0,0,-1]},jlt={polygon_center:0,edge:1,vertex:2},yR=(t,e)=>(i,r)=>!e||i===0||t===0?0:t*r/100,Ji=(t,e)=>{let i=Math.abs(e),r=i*-1;return(t-Pte)*(i-r)/(Flt-Pte)+r},Vlt=new W,xR=new W,Hlt=new W,Glt=new W;function p1(t,e){let i=Hlt.fromArray(t),r=Glt.fromArray(e);xR.copy(r).sub(i);let n=xR.length();return xR.normalize().multiplyScalar(n*.5),Vlt.copy(i).add(xR).toArray()}var du=new vo,bR=new W,B3=new W,Wy=new W;function Wlt(t){let e=[];for(let i=0;i<=t.index.count;i++)if(bR.fromArray(t.index.array,i*3),du.setFromAttributeAndIndices(t.attributes.position,bR.x,bR.y,bR.z),du.getNormal(B3),du.getMidpoint(Wy),!(isNaN(Wy.x)||isNaN(Wy.y)||isNaN(Wy.z))){let{a:r,b:n,c:s}=du,a=r.toArray(),o=n.toArray(),l=s.toArray(),c=r.distanceTo(n),u=n.distanceTo(s),h=s.distanceTo(r),d=p1(a,o),f=p1(o,l),p=p1(l,a),g=[c,u,h],m=Math.max(...g),y=g.filter(E=>Math.round(E)===Math.round(m)).length>1,b=[],w=du.getMidpoint(Wy).toArray();m===c&&!y&&(b=[f,p,p],w=d),m===u&&!y&&(b=[d,p,p],w=f),m===h&&!y&&(b=[d,f,f],w=p),y&&(b=[d,f,p]),e.push({vertices:[a,o,l],faceCenters:b,midpoint:w,norm:du.getNormal(B3).toArray()})}return e}function qlt(t){let e=[],{position:i}=t.attributes;for(let r=0;r<i.count;r++){du.setFromAttributeAndIndices(i,r*3,r*3+1,r*3+2),du.getNormal(B3),du.getMidpoint(Wy);let n=du.a.toArray(),s=du.b.toArray(),a=du.c.toArray();e.push({vertices:[n,s,a],faceCenters:[p1(n,s),p1(s,a),p1(a,n)],midpoint:Wy.toArray(),norm:B3.toArray()})}return e}var Xlt=4,$lt=.5,YF=t=>.5*(1-Math.cos(t*Math.PI)),Ylt=class{constructor(){this.perlin=new Array(4096)}noise(t,e=0,i=0){if(this.perlin==null){this.perlin=new Array(4096);for(let m=0;m<4096;m++)this.perlin[m]=Math.random()}t<0&&(t=-t),e<0&&(e=-e),i<0&&(i=-i);let r=Math.floor(t),n=Math.floor(e),s=Math.floor(i),a=t-r,o=e-n,l=i-s,c,u,h=0,d=.5,f,p,g;for(let m=0;m<Xlt;m++){let y=r+(n<<4)+(s<<8);c=YF(a),u=YF(o),f=this.perlin[y&4095],f+=c*(this.perlin[y+1&4095]-f),p=this.perlin[y+16&4095],p+=c*(this.perlin[y+16+1&4095]-p),f+=u*(p-f),y+=256,p=this.perlin[y&4095],p+=c*(this.perlin[y+1&4095]-p),g=this.perlin[y+16&4095],g+=c*(this.perlin[y+16+1&4095]-g),p+=u*(g-p),f+=YF(l)*(p-f),h+=f*d,d*=$lt,r<<=1,a*=2,n<<=1,o*=2,s<<=1,l*=2,a>=1&&(r++,a--),o>=1&&(n++,o--),l>=1&&(s++,l--)}return h}noiseSeed(t){let e=(()=>{let i,r;return{setSeed(n){r=i=(n??Math.random()*4294967296)>>>0},getSeed(){return i},rand(){return r=(1664525*r+1013904223)%4294967296,r/4294967296}}})();e.setSeed(t),this.perlin=new Array(4096);for(let i=0;i<4096;i++)this.perlin[i]=e.rand()}},Klt=Ylt,Rte=new W,Ite=new St,Dte=new E_;function Ote(t){let e=!1;return t.scene.objects.traverse((i,r)=>{r.type==="Mesh"&&(r.geometry.type==="TextGeometry"||r.geometry.type==="InputGeometry")&&(e=!0)}),e}var p8=class extends bs{constructor(t,e,i){super(t,e,i),this.data=e}get textGeometry(){return this.geometry}get charWidths(){return this.textGeometry.charWidths}get charCoords(){return this.textGeometry.charCoords}get wrappedText(){return this.textGeometry.wrappedText}get font(){return this.textGeometry.font}get initialOffsetY(){let t=this.dataPatched;return this.font?.getLineInitialOffsetY(this.lineHeight,this.wrappedText.length,t.geometry.height,this.fontScale,t.geometry.verticalAlign)??0}get fontScale(){let t=this.dataPatched;return this.font?t.geometry.fontSize/this.font.unitsPerEm:1}get AD(){return Math.abs(this.ascender-this.descender)}get ascender(){return(this.font?.ascender??1)*this.fontScale}get descender(){return(this.font?.descender??1)*this.fontScale}get lineHeight(){let t=this.dataPatched;return t.geometry.fontSize*t.geometry.lineHeight}raycast(t,e){let{matrixWorld:i}=this;if(!(isNaN(t.ray.origin.x)||this.scale.x===0||this.scale.y===0||this.scale.z===0)&&(Ite.copy(i).invert(),Dte.copy(t.ray).applyMatrix4(Ite),Dte.intersectBox(this.singleBBox,Rte))){let r=Rte.applyMatrix4(i),n=t.ray.origin.distanceTo(r);e.push({distance:n,point:r.clone(),object:this})}}},ol=1e-4,cd,Jpe,eme,tme,Lte=new W,kte=new W;upe.then(t=>{cd=t,Jpe=[cd.get_face_center,cd.get_edge_midpoint,cd.get_vertex_position],eme=[cd.get_face_normal,cd.get_edge_normal,cd.get_vertex_normal],tme=[cd.face_count,cd.edge_count,cd.vertex_count]});var Zlt=new St,Qlt=new St,Qm=new W,wR=new W,EE=new W,KF=new W,Jlt=new W,ect=new W,tct=class{constructor(t,e){this.data=t,this.is3D=e,this.perlin=new Klt,t.noiseType==="perlin"?(this.perlin.noiseSeed(t.seed),e?this.noise=(i,r,n)=>this.perlin.noise(i,r,n):this.noise=i=>this.perlin.noise(i)):e?this.noise=Pnt((0,U5.default)(t.seed)):this.noise=Cnt((0,U5.default)(t.seed))}},vu=class extends YG(tn){constructor(t,e){super(),this.parameters=e,this.objectForSample=void 0,this._pendingMediaLoad=!1,this.random=null,this.object=t}resetOnMove(){this.removeFromParent(),this.parent=null}expandClones(t){if(this.parent===null)this.updateState(this.parameters,t);else for(let e of this.children)e instanceof bo&&e.expand()}invalidateTransform(t){this.matrixWorldNeedsUpdate=!0,this.traverse(e=>{e instanceof bo&&e.object===t&&(e.matrixWorldNeedsUpdate=!0)})}onObjUpdateMatrix(){this.parameters.type!=="toObject"&&(this.matrixWorldNeedsUpdate=!0)}update(){switch(this._updateCount(),this.parameters.type){case"radial":this._updateRadial(this.parameters);break;case"linear":this._updateLinear(this.parameters);break;case"grid":this._updateGrid(this.parameters);break;case"toObject":this._updateToObject(this.parameters)}for(let t of this.children)t.updateMatrix(),t.hasNonUniformScale&&(t.updateMatrixWorld(),t.updateMatrixWorldSVD())}_updateCount(t){let e;if(t!==void 0?e=t:e=this.parameters.type==="grid"?Math.round(this.parameters.grid.count[0])*Math.round(this.parameters.grid.count[1])*Math.round(this.parameters.grid.count[2]):this.parameters.count,this.parameters.type==="toObject"){if(!this.parameters.toObject.object)e=0;else if(t===void 0&&this.parameters.toObject.spreadType!=="random")return}if(this.parameters.type==="toObject"&&this.objectForSample){let i=this.children;if(i.length===e)return;if(i.length<e)for(let r=0,n=e-i.length;r<n;++r){let s=new bo(this.object);s.expand(),this.add(s)}else for(let r=0,n=i.length-e;r<n;++r)this.remove(i[r])}else{if(this.children.length===e)return;if(this.children.length<e)for(let i=0,r=e-this.children.length;i<r;++i){let n=new bo(this.object);n.expand(),this.add(n)}else for(let i=0,r=this.children.length-e;i<r;++i)this.remove(this.children[i])}}getRandom(t,e=!1){return(this.random===null||this.random.data.seed!==t.seed||this.random.is3D!==e)&&(this.random=new tct(t,e)),this.random}_updateRadial(t){let e=t.radial,i=e.start*Ht.DEG2RAD,r=e.end*Ht.DEG2RAD,n=i-r,s=new xs(e.rotation[0],e.rotation[1],e.rotation[2]),a;switch(e.axis){case"z":a=new W(0,0,1);break;case"y":a=new W(0,1,0);break;default:case"x":a=new W(1,0,0);break}let o=t.randomnessObject??Ig.defaultData([1,1,1]).randomnessObject,l=this.getRandom(o),c=yR(o.strength,this.parameters.randomness);for(let[u,h]of this.children.entries()){let d=u*(o.freqScale/10)+o.movement,f=l.noise(d,d,d),p=u+1;h.scale.x=e.scale[0]+c(p,Ji(f,o.scale[0]))||ol,h.scale.y=e.scale[1]+c(p,Ji(f,o.scale[1]))||ol,h.scale.z=e.scale[2]+c(p,Ji(f,o.scale[2]))||ol,h.position.setScalar(0);let g=n/t.count*u-i;switch(e.axis){case"x":h.rotation.set(0,g,0);break;case"y":h.rotation.set(0,0,g);break;case"z":h.rotation.set(g,0,0);break}h.translateOnAxis(a,e.radius),h.position.x+=e.position[0]+c(p,Ji(f,o.position[0])),h.position.y+=e.position[1]+c(p,Ji(f,o.position[1])),h.position.z+=e.position[2]+c(p,Ji(f,o.position[2]));let m=c(p,Ji(f,o.rotation[0])),y=c(p,Ji(f,o.rotation[1])),b=c(p,Ji(f,o.rotation[2]));e.alignment===!0?(h.rotation.x+=s.x+m,h.rotation.y+=s.y+y,h.rotation.z+=s.z+b):h.rotation.set(s.x+m,s.y+y,s.z+b)}}_updateLinear(t){if(t.type!=="linear")throw new Error;let e=t.linear,i=new xs(e.rotation[0],e.rotation[1],e.rotation[2]),r=t.randomnessObject??Ig.defaultData([1,1,1]).randomnessObject,n=this.getRandom(r),s=yR(r.strength,this.parameters.randomness);for(let[a,o]of this.children.entries()){let l=a*(r.freqScale/10)+r.movement,c=n.noise(l,l,l),u=a+1,h=s(u,Ji(c,r.rotation[0])),d=s(u,Ji(c,r.rotation[1])),f=s(u,Ji(c,r.rotation[2]));o.scale.x=1+(e.scale[0]-1)*a+s(u,Ji(c,r.scale[0]))||ol,o.scale.y=1+(e.scale[1]-1)*a+s(u,Ji(c,r.scale[1]))||ol,o.scale.z=1+(e.scale[2]-1)*a+s(u,Ji(c,r.scale[2]))||ol,o.rotation.x=i.x*a+h,o.rotation.y=i.y*a+d,o.rotation.z=i.z*a+f,o.position.x=e.position[0]*a+s(u,Ji(c,r.position[0])),o.position.y=e.position[1]*a+s(u,Ji(c,r.position[1])),o.position.z=e.position[2]*a+s(u,Ji(c,r.position[2]))}}_updateGrid(t){let e=0,i=t.grid,r=t.randomnessObject??Ig.defaultData([1,1,1]).randomnessObject,n=this.getRandom(r,!0),s=yR(r.strength,this.parameters.randomness);if(i.useCenter===!0){let a={x:i.count[0]%2===0?2:1,y:i.count[1]%2===0?2:1,z:i.count[2]%2===0?2:1},o=new W(i.size[0]*(i.count[0]-a.x)*.5,i.size[1]*(i.count[1]-a.y)*.5,i.size[2]*(i.count[2]-a.z)*.5);for(let l=0;l<i.count[0];l++)for(let c=0;c<i.count[1];c++)for(let u=0;u<i.count[2];u++){let h=n.noise((l+1)*(r.freqScale/10)+r.movement,(c+1)*(r.freqScale/10)+r.movement,(u+1)*(r.freqScale/10)+r.movement),d=this.children[e++];d.scale.x=1+s(e,Ji(h,r.scale[0]))||ol,d.scale.y=1+s(e,Ji(h,r.scale[1]))||ol,d.scale.z=1+s(e,Ji(h,r.scale[2]))||ol;let f=s(e,Ji(h,r.rotation[0])),p=s(e,Ji(h,r.rotation[1])),g=s(e,Ji(h,r.rotation[2]));d.rotation.set(f,p,g),d.position.x=i.size[0]*l-o.x+s(e,Ji(h,r.position[0])),d.position.y=i.size[1]*c-o.y+s(e,Ji(h,r.position[1])),d.position.z=i.size[2]*u-o.z+s(e,Ji(h,r.position[2]))}}else for(let a=0;a<i.count[0];a++)for(let o=0;o<i.count[1];o++)for(let l=0;l<i.count[2];l++){let c=n.noise((a+1)*(r.freqScale/10)+r.movement,(o+1)*(r.freqScale/10)+r.movement,(l+1)*(r.freqScale/10)+r.movement),u=this.children[e++];u.scale.x=1+s(e,Ji(c,r.scale[0]))||ol,u.scale.y=1+s(e,Ji(c,r.scale[1]))||ol,u.scale.z=1+s(e,Ji(c,r.scale[2]))||ol;let h=s(e,Ji(c,r.rotation[0])),d=s(e,Ji(c,r.rotation[1])),f=s(e,Ji(c,r.rotation[2]));u.rotation.set(h,d,f),u.position.x=i.size[0]*a+s(e,Ji(c,r.position[0])),u.position.y=-i.size[1]*o+s(e,Ji(c,r.position[1])),u.position.z=-i.size[2]*l+s(e,Ji(c,r.position[2]))}}_updateToObject(t){if(t.type!=="toObject")throw new Error;let{toObject:e}=t,i=new xs(e.rotation[0],e.rotation[1],e.rotation[2]),r=t.randomnessObject??Ig.defaultData([1,1,1]).randomnessObject,n=this.getRandom(r),s=yR(r.strength,this.parameters.randomness);if(!e.object){for(let[,u]of this.children.entries())u.position.set(0,0,0),u.scale.setScalar(1),u.rotation.set(0,0,0);this.objectForSample=void 0;return}if(!this.objectForSample)return;if(this.objectForSample instanceof p8)if(!this.objectForSample.font?.isLoaded||this.objectForSample.geometry.attributes.position===void 0){this._pendingMediaLoad=!0;return}else this._pendingMediaLoad=!1;if(this.objectForSample.geometry===void 0&&this.objectForSample.isAncestorOf(this.object.uuid)){console.warn(`Oh no! The object "${this.object.name}" (${this.object.uuid}) seem to be a child/descendant of the object it's being cloned to. Please re-parent it so that they are siblings instead.`);return}let a=this.getSubdivData();if(a.length>0){let u=Math.round(a.length*e.count/100);this._updateCount(u)}else{let u=this.objectForSample.geometry.getAttribute("position");if(!u||isNaN(u.count)||u.count===0){console.warn(`Oh no! The object "${this.object.name}" (${this.object.uuid}) cannot be cloned on the surface of "${this.objectForSample.name}" (${this.objectForSample.uuid}) because the latter does not have a valid geometry.`);return}}this.objectForSample.updateMatrixWorld();let o=new Rnt(this.objectForSample).build(),l=zlt[e.axis],c=this.children;o.setRandomGenerator((0,U5.default)(this.object.uuid+e.seed));for(let[u,h]of c.entries()){let d=u*(r.freqScale/10)+r.movement,f=n.noise(d,d,d),p=u+1,g=s(p,Ji(f,r.rotation[0])),m=s(p,Ji(f,r.rotation[1])),y=s(p,Ji(f,r.rotation[2]));e.spreadType==="random"?o.sample(EE,KF):(a.length&&(EE.fromArray(a[u].pos),KF.fromArray(a[u].norm)),this.objectForSample instanceof YM&&EE.applyMatrix4(Zlt.copy(this.objectForSample.matrixWorld).invert())),EE.applyMatrix4(this.object.hiddenMatrix.clone().invert()),h.position.copy(EE),Qm.fromArray(l);let b=e.align==="normal"?KF:this.object.getWorldDirection(ect),w=wR.fromArray(e.position);wR.x+=s(p,Ji(f,r.position[0])),wR.y+=s(p,Ji(f,r.position[1])),wR.z+=s(p,Ji(f,r.position[2]));let E=Math.acos(b.dot(Qm)),M=Jlt.crossVectors(Qm,b).normalize(),A=Qlt.makeRotationAxis(M,E),P=b.clone().cross(this.object.up).normalize(),C=P.clone().cross(b).normalize(),R=new St().makeBasis(P,b,C),I=new W(Qm.y,Qm.z,Qm.x).normalize(),k=I.clone().cross(Qm).normalize(),z=new St().makeBasis(I,Qm,k).invert(),V=new St().multiplyMatrices(R,z);h.rotation.setFromRotationMatrix(V),w.applyMatrix4(A),h.position.add(w),h.rotation.x=h.rotation.x+i.x+g,h.rotation.y=h.rotation.y+i.y+m,h.rotation.z=h.rotation.z+i.z+y,h.scale.setScalar(1),h.scale.x=h.scale.x+e.scale[0]+s(p,Ji(f,r.scale[0]))||ol,h.scale.y=h.scale.y+e.scale[1]+s(p,Ji(f,r.scale[1]))||ol,h.scale.z=h.scale.z+e.scale[2]+s(p,Ji(f,r.scale[2]))||ol,h.scale.multiply(this.object.scale),h.hiddenMatrix=this.object.hiddenMatrix}}getSubdivData(){if(!this.objectForSample)return[];let t=this.parameters.toObject.spreadType,e=new Map,i=(n,s)=>{let a=Math.round(n[0]*1e4)+"_"+Math.round(n[1]*1e4)+"_"+Math.round(n[2]*1e4),o=e.get(a);o?(o.pos[0]+=n[0],o.pos[1]+=n[1],o.pos[2]+=n[2],o.norm[0]+=s[0],o.norm[1]+=s[1],o.norm[2]+=s[2],o.count+=1):e.set(a,{pos:[...n],norm:[...s],count:1})};if(t==="random")return[];if(this.objectForSample instanceof YM){let n=this.objectForSample,s=jlt[t],a=tme[s],o=Jpe[s],l=eme[s],c=a(n.subdivPointerNew);for(let u=0;u<=c-1;u++){let h=o(n.subdivPointerNew,u),d=l(n.subdivPointerNew,u);Lte.fromArray(h).applyMatrix4(n.matrixWorld),kte.fromArray(d),i(Lte.toArray(),kte.toArray())}}else(this.objectForSample.geometry.index?Wlt(this.objectForSample.geometry):qlt(this.objectForSample.geometry)).forEach((n,s)=>{t==="polygon_center"&&i(n.midpoint,n.norm),t==="vertex"&&(i(n.vertices[0],n.norm),i(n.vertices[1],n.norm),i(n.vertices[2],n.norm)),t==="edge"&&(i(n.faceCenters[0],n.norm),i(n.faceCenters[1],n.norm),i(n.faceCenters[2],n.norm))});let r=Array.from(e.values());for(let n of r)n.pos[0]/=n.count,n.pos[1]/=n.count,n.pos[2]/=n.count,n.norm[0]/=n.count,n.norm[1]/=n.count,n.norm[2]/=n.count;return r}updateState(t,e){if(this.parameters=gL(t),this.parameters.type!=="toObject")(this.parent===null||this.parent!==this.object)&&(this.removeFromParent(),this.object.parent?.add(this),this.matrix=this.object.matrix,this.hiddenMatrix=this.object.hiddenMatrix,this.matrixWorldNeedsUpdate=!0,this.matrixAutoUpdate=!1);else if(this.parent===null||this.parent.uuid!==this.parameters.toObject.object){this.removeFromParent();let i=e.find(this.parameters.toObject.object);i instanceof So?this.objectForSample=i:this.objectForSample=void 0,this.matrix=new St,this.hiddenMatrix=new St,this.matrixWorldNeedsUpdate=!0,this.matrixAutoUpdate=!1,i&&i.add(this)}this.update()}get pendingMediaLoad(){return this._pendingMediaLoad}},VT=t=>{var e;return e=class extends t{},e.geometryHelper=new Oh(30,30,30),e},_R=new E_,ZF=new oc,Nte=new St,HT=(t,e,i,r,n=!1,s=t)=>{let a=e,o=s.matrixWorld;if(a.boundingSphere===null&&a.computeBoundingSphere(),ZF.copy(a.boundingSphere),ZF.applyMatrix4(o),i.ray.intersectsSphere(ZF)===!1||(Nte.copy(o).invert(),_R.copy(i.ray).applyMatrix4(Nte),a.boundingBox!==null&&_R.intersectsBox(a.boundingBox)===!1))return;let l,c,u,h,d=a.index,f=a.attributes.position,p=a.drawRange,g,m;if(n===!1){let b=Math.max(0,p.start),w=Math.min(d.count,p.start+p.count);for(g=b,m=w;g<m;g+=3)if(c=d.getX(g),u=d.getX(g+1),h=d.getX(g+2),l=y(t,i,_R,f,c,u,h),l){l.faceIndex=Math.floor(g/3),r.push(l);return}}else{let b=a.attributes.position,w=new W,E=new W,M=new W,A=new W,P=2,C=1/((s.scale.x+s.scale.y+s.scale.z)/3),R=C*C,I=Math.max(0,p.start),k=Math.min(b.count,p.start+p.count);for(let z=I,V=k-1;z<V;z+=P){if(w.fromBufferAttribute(b,z),E.fromBufferAttribute(b,z+1),_R.distanceSqToSegment(w,E,A,M)>R)continue;A.applyMatrix4(s.matrixWorld);let F=i.ray.origin.distanceTo(A);F<i.near||F>i.far||r.push({distance:F,point:M.clone().applyMatrix4(s.matrixWorld),object:t})}}function y(b,w,E,M,A,P,C){let R=new W,I=new W,k=new W,z=new W,V=new W;if(R.fromBufferAttribute(M,A),I.fromBufferAttribute(M,P),k.fromBufferAttribute(M,C),E.intersectTriangle(R,I,k,!1,z)===null)return null;V.copy(z),V.applyMatrix4(b.matrixWorld);let F=w.ray.origin.distanceTo(V);return F<w.near||F>w.far?null:{faceIndex:1,distance:F,point:V.clone(),object:b}}},SR=new W,iu=new vv,ict=class extends LT{constructor(t){let e=new oi,i=new yv({color:16777215,vertexColors:!0,toneMapped:!1}),r=[],n=[],s={},a=new Ai(15711266),o=new Ai(15711266),l=new Ai(2857471);c("n1","n2",a),c("n2","n4",a),c("n4","n3",a),c("n3","n1",a),c("f1","f2",a),c("f2","f4",a),c("f4","f3",a),c("f3","f1",a),c("n1","f1",a),c("n2","f2",a),c("n3","f3",a),c("n4","f4",a),c("p","n1",o),c("p","n2",o),c("p","n3",o),c("p","n4",o),c("u1","u2",l),c("u2","u3",l),c("u3","u1",l);function c(h,d,f){u(h,f),u(d,f)}function u(h,d){r.push(0,0,0),n.push(d.r,d.g,d.b),s[h]===void 0&&(s[h]=[]),s[h].push(r.length/3-1)}e.setAttribute("position",new Gt(r,3)),e.setAttribute("color",new Gt(n,3)),super(e,i),this.type="CameraHelper",this.camera=t,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=s,this.update()}update(){let t=this.geometry,e=this.pointMap;iu.projectionMatrixInverse.elements=[.5112609807824982,-0,-0,-0,-0,.41421356237309503,-0,-0,-0,-0,-0,-.099999,-0,-0,-1.0000000000000002,.100001];let i=1,r=1,n=.8;sh("n1",e,t,iu,-i,-r,n),sh("n2",e,t,iu,i,-r,n),sh("n3",e,t,iu,-i,r,n),sh("n4",e,t,iu,i,r,n);let s=n;sh("f1",e,t,iu,-i,-r,s),sh("f2",e,t,iu,i,-r,s),sh("f3",e,t,iu,-i,r,s),sh("f4",e,t,iu,i,r,s);let a=s,o=.5;sh("u1",e,t,iu,i*.7*o,r*1.1,a),sh("u2",e,t,iu,-i*.7*o,r*1.1,a),sh("u3",e,t,iu,0,r*(1.1+.9*o),a),t.getAttribute("position").needsUpdate=!0}dispose(){this.geometry.dispose(),this.material.dispose()}};function sh(t,e,i,r,n,s,a){SR.set(n,s,a).unproject(r);let o=e[t];if(o!==void 0){let l=i.getAttribute("position");for(let c=0,u=o.length;c<u;c++)l.setXYZ(o[c],SR.x,SR.y,SR.z)}}var rct=class extends VT(ict){constructor(t){super(t),this.object=t,this.object=t,this.name=`CombinedCameraHelper: ${t.uuid}`}updateMatrixWorld(t){super.updateMatrixWorld(t),this.updateTarget()}updateTarget(){let t=this.object.getTarget();this.updateWorldMatrix(!0,!1),this.worldToLocal(t)}raycast(t,e){HT(this.object,this.geometry,t,e,!0)}},J5;(t=>t.is=e=>"objectHelper"in e)(J5||(J5={}));var F_=(t,e)=>class extends KG(t){constructor(){super(...arguments),this.objectHelper=new e(this),this.gizmos={}}get geometryHelper(){return e.geometryHelper}raycast(i,r){this.objectHelper.raycast(i,r)}showGizmos(){for(let i in this.gizmos){let r=this.gizmos[i];r instanceof ZD&&(r.visible=!0)}}updateEntityBoxSize(i,r){this.objectHelper.visible&&this.geometryHelper instanceof Oh?(i.setScalar(0),r.set(this.geometryHelper.parameters.width,this.geometryHelper.parameters.height,this.geometryHelper.parameters.height).multiplyScalar(.5)):super.updateEntityBoxSize(i,r)}hideGizmos(){for(let i in this.gizmos){let r=this.gizmos[i];r instanceof ZD&&(r.visible=!1)}}},ER=790,uw=new W,QF=new W,JF=new Ii,e4=new W,AE=new W,t4=new W,Gs=class extends F_(vv,rct){constructor(t="",e={...jM.defaultData,name:""}){super(),this._cameraType="OrthographicCamera",this.targetOffset=$1.DefaultTargetOffset,this.isUpVectorFlipped=!1,this.angleOffsetFromUp=0,this.wasMovedByUser=!1,this.wasMovedBySwitchCameraAction=!1,this.super_Entity(t,e),this.previousProjectionMatrix=new St,this.matrixAutoUpdate=!0,this.width=window.innerWidth,this.height=window.innerHeight;let i=this.width,r=this.height;this.orthoCamera=new aL(i*-.5,i*.5,r*.5,r*-.5,-5e4,1e4),this.perspCamera=new No(45,i/r,50,1e4),this.left=this.orthoCamera.left,this.right=this.orthoCamera.right,this.top=this.orthoCamera.top,this.bottom=this.orthoCamera.bottom,this.far=this.orthoCamera.far,this.view=this.orthoCamera.view,this.aspect=this.perspCamera.aspect,this.focus=this.perspCamera.focus,this.filmGauge=this.perspCamera.filmGauge,this.filmOffset=this.perspCamera.filmOffset,this.objectHelper.update()}get isPerspectiveCamera(){return this.cameraType==="PerspectiveCamera"}get isOrthographicCamera(){return!this.isPerspectiveCamera}get cameraType(){return this._cameraType}set fov(t){this.perspCamera.fov=t}get fov(){return this.perspCamera.fov}setNear(t,e){t==="PerspectiveCamera"?this.perspCamera.near=e:this.orthoCamera.near=e}setZoom(t,e){e>=0&&(t==="PerspectiveCamera"?this.perspCamera.zoom=e:this.orthoCamera.zoom=e)}set cameraType(t){t==="PerspectiveCamera"?this.toPerspective():t==="OrthographicCamera"&&this.toOrthographic()}get near(){return this._cameraType==="PerspectiveCamera"?this.perspCamera.near:this.orthoCamera.near}set near(t){this._cameraType==="PerspectiveCamera"?this.perspCamera.near=t:this.orthoCamera.near=t}get zoom(){return this._cameraType==="PerspectiveCamera"?this.perspCamera.zoom:this.orthoCamera.zoom}set zoom(t){t>=0&&(this._cameraType==="PerspectiveCamera"?this.perspCamera.zoom=t:this.orthoCamera.zoom=t)}lookAt(t,e,i){typeof t=="number"&&(t=new W(t,e,i)),super.lookAt(t),this.getWorldPosition(uw),this.targetOffset=uw.distanceTo(t)}getTarget(t=new W){return this.getWorldDirection(QF),this.getWorldPosition(uw),QF.multiplyScalar(this.targetOffset),t.copy(uw).add(QF),t}getDistanceToTarget(){let t=this.getTarget();return this.getWorldPosition(uw),uw.distanceTo(t)}updateUp(){this.getWorldQuaternion(JF),e4.set(0,0,1).applyQuaternion(JF),AE.copy(tn.DEFAULT_UP),this.isUpVectorFlipped&&AE.negate(),AE.applyQuaternion(JF),t4.copy(tn.DEFAULT_UP).projectOnPlane(e4),this.angleOffsetFromUp=t4.angleTo(AE),this.angleOffsetFromUp*=t4.cross(AE).dot(e4)>=0?1:-1}updateTransformState(t,e){let i=super.updateTransformState(t,e);return t.isUpVectorFlipped!==void 0&&(this.isUpVectorFlipped=t.isUpVectorFlipped),this.updateUp(),i}getViewFrontToObject(t){let e=t.getWorldPosition(new W),i=t.getWorldDirection(new W).multiplyScalar(this.targetOffset);return{position:e.clone().add(i),target:e}}getViewToTarget(t){let e=this.getWorldDirection(new W).multiplyScalar(this.targetOffset);return{position:t.clone().sub(e),target:t}}getViewToObject(t){let e=new W;return t.getWorldPosition(e),this.getViewToTarget(e)}setViewplaneSize(t,e,i=!1){if(this.aspect=t/e,i){let r=t>e?this.aspect:1,n=t>e?1:this.aspect;this.left=-ER*.5*r,this.right=ER*.5*r,this.top=ER*.5*(1/n),this.bottom=-ER*.5*(1/n)}else this.left=-t*.5,this.right=t*.5,this.top=e*.5,this.bottom=-e*.5;this.updateProjectionMatrix()}copyViewPlaneSize(t){this.aspect=t.aspect,this.left=t.left,this.right=t.right,this.top=t.top,this.bottom=t.bottom,this.updateProjectionMatrix()}toOrthographic(){this.orthoCamera.left=this.left,this.orthoCamera.right=this.right,this.orthoCamera.top=this.top,this.orthoCamera.bottom=this.bottom,this.orthoCamera.view=this.view,this.orthoCamera.far=this.far,this.orthoCamera.updateProjectionMatrix(),this.projectionMatrix=this.orthoCamera.projectionMatrix,this.projectionMatrixInverse=this.orthoCamera.projectionMatrixInverse,this._cameraType="OrthographicCamera",this.objectHelper&&this.objectHelper.update()}toPerspective(){this.perspCamera.aspect=this.aspect,this.perspCamera.fov=this.fov,this.perspCamera.view=this.view,this.perspCamera.far=this.far,this.perspCamera.updateProjectionMatrix(),this.projectionMatrix=this.perspCamera.projectionMatrix,this.projectionMatrixInverse=this.perspCamera.projectionMatrixInverse,this._cameraType="PerspectiveCamera",this.objectHelper&&this.objectHelper.update()}setFocalLength(t){this.perspCamera.setFocalLength(t),this.toPerspective()}getFocalLength(){return this.perspCamera.getFocalLength()}getEffectiveFOV(){return this.perspCamera.getEffectiveFOV()}getFilmWidth(){return this.perspCamera.getFilmWidth()}getFilmHeight(){return this.perspCamera.getFilmHeight()}setViewOffset(t,e,i,r,n,s){this._cameraType==="PerspectiveCamera"?this.perspCamera.setViewOffset(t,e,i,r,n,s):this.orthoCamera.setViewOffset(t,e,i,r,n,s)}clearViewOffset(){this._cameraType==="PerspectiveCamera"?(this.perspCamera.clearViewOffset(),this.toPerspective()):(this.orthoCamera.clearViewOffset(),this.toOrthographic())}copyHistory(){this.previousProjectionMatrix&&this.previousProjectionMatrix.copy(this.projectionMatrix)}updateProjectionMatrix(){this._cameraType==="PerspectiveCamera"?this.toPerspective():this._cameraType==="OrthographicCamera"&&this.toOrthographic()}updateMatrixWorld(t){super.updateMatrixWorld(t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(t,e){super.updateWorldMatrix(t,e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}copy(t,e){return super.copy(t,e),this.parent=t.parent,this.orthoCamera.copy(t.orthoCamera),this.perspCamera.copy(t.perspCamera),this.left=t.left,this.right=t.right,this.top=t.top,this.bottom=t.bottom,this.far=t.far,this.view=t.view===null?null:Object.assign({},t.view),this._cameraType=t._cameraType,this.aspect=t.aspect,this.fov=t.fov,this.focus=t.focus,this.filmGauge=t.filmGauge,this.filmOffset=t.filmOffset,this.targetOffset=t.targetOffset,this.updateProjectionMatrix(),this}toCameraState(t=[]){let e={type:this.cameraType,far:this.far,orthographic:{near:this.orthoCamera.near,zoom:this.orthoCamera.zoom},perspective:{near:this.perspCamera.near,fov:this.perspCamera.fov,zoom:this.perspCamera.zoom},up:this.up.toArray(),targetOffset:this.targetOffset,isUpVectorFlipped:this.isUpVectorFlipped};return Hj(e,t)}updateCameraSubtype(t,e){let i=t==="perspective"?"PerspectiveCamera":"OrthographicCamera";e.zoom!==void 0&&this.setZoom(i,e.zoom),e.near!==void 0&&this.setNear(i,e.near),e.fov!==void 0&&i==="PerspectiveCamera"&&(this.fov=e.fov)}updateState(t,e){this.updateCameraState(t,e)}updateCameraState(t,e){this.updateState_Entity(t,e),t.far!==void 0&&(this.far=t.far),t.orthographic!==void 0&&this.updateCameraSubtype("orthographic",t.orthographic),t.perspective!==void 0&&this.updateCameraSubtype("perspective",t.perspective),t.type!==void 0&&(this.cameraType=t.type),t.up!==void 0&&this.up.fromArray(t.up),t.targetOffset!==void 0&&(this.targetOffset=t.targetOffset),t.isUpVectorFlipped!==void 0&&(this.isUpVectorFlipped=t.isUpVectorFlipped),this.updateProjectionMatrix()}updateByPatchedOp(t,e,i){super.updateByPatchedOp(t,e,i),t.path.length===1&&t.type===0&&this.updateCameraSubtype(t.path[0],t.props)}toState(t){return{...super.toState(t),...this.toCameraState(t),type:this.cameraType}}},hw=new St,nct=new St;function Ute(t){let e=!1;return t.scene.objects.traverse((i,r)=>{r.geometry?.type==="BooleanGeometry"&&(e=!0)}),e}var j0=class extends sv{constructor(t,e,i){super(t,e),this.data=e,this.meshSetAddresses=[],this.needsTransformForDownstream=!1,this.geometry=new oi,this.onAfterRender=(r,n,s,a,o,l)=>{super.onAfterRender(r,n,s,a,o,l),this.recomputeBoolean()},this.geometry.userData.parameters={width:0,height:0,depth:0}}get booleanOp(){return this.data.geometry.operation}get phongAngle(){return this.data.geometry.phongAngle??45}get isLOD(){return this.recomputeBoolean(),!1}updateByPatchedOp(t,e,i){super.updateByPatchedOp(t,e,i),t.path.length===1&&t.path[0]==="geometry"&&t.type===0&&t.props.operation!==void 0&&(this.freeBooleanPointer(),this.resetBBoxNeedsUpdate())}freeBooleanPointer(){super.freeBooleanPointer(),this.geometry.dispose()}recomputeBoolean(t,e=!0){if(this.booleanMeshSetAddress!==-1&&!t)return;for(let r=0;r<this.children.length;r++){let n=this.children[r];n instanceof j0&&n.dataPatched.visible===!0&&n.recomputeBoolean(t===!0,e)}this.meshSetAddresses=[];for(let r=0;r<this.children.length;r++){let n=this.children[r];if(n instanceof So&&n.dataPatched.visible===!0&&n.geometry.attributes.position?.count>0&&n.geometry.drawRange.count>0&&n.booleanMeshSetAddress!==0){hw.multiplyMatrices(n.hiddenMatrix,n.matrix);try{if(n.booleanMeshSetAddress===-1){if((n.geometry.index??n.geometry.getAttribute("position")).count/3<15e5&&(n.booleanMeshSetAddress=fp.getMeshSet(n.geometry,t===!0,e)),n.booleanMeshSetAddress===-1)return;fp.transformMeshSet(n.booleanMeshSetAddress,hw),n.booleanMatrixInvOld.copy(hw).invert(),n.booleanWasTransformed=!1}else n instanceof j0&&n.needsTransformForDownstream===!0?(fp.transformMeshSet(n.booleanMeshSetAddress,hw),n.needsTransformForDownstream=!1):n.booleanWasTransformed===!0&&(fp.transformMeshSet(n.booleanMeshSetAddress,nct.multiplyMatrices(hw,n.booleanMatrixInvOld)),n.booleanMatrixInvOld.copy(hw).invert(),n.booleanWasTransformed=!1)}catch(s){console.error(s),n.booleanMeshSetAddress=0,n.geometry.userData.booleanOperationDidFail=!0;continue}fp.hasOpenEdges(n.booleanMeshSetAddress)===!1||r===this.children.length-1&&this.booleanOp===2?(this.meshSetAddresses.push(n.booleanMeshSetAddress),n.geometry.userData.booleanOperationDidFail=!1):n.geometry.userData.booleanOperationDidFail="openEdges"}}if(this.meshSetAddresses.length===0){this.geometry.setAttribute("position",new Gt([],0)),this.geometry.setDrawRange(0,0);return}if(t===!0)return fp.calcBooleanTopological(this.meshSetAddresses,this.booleanOp);let i=this.geometry;i.dispose(),this.geometry=new oi,this.geometry.userData=i.userData,this.geometry.boundingSphere=i.boundingSphere;try{this.booleanMeshSetAddress=fp.calcBoolean(this.meshSetAddresses,this.booleanOp,this.geometry,this.phongAngle)}catch(r){this.booleanMeshSetAddress=0,this.geometry.userData.booleanOperationDidFail=!0,console.error(r)}this.booleanMatrixInvOld.copy(this.matrix).invert(),this.needsTransformForDownstream=!0,d8(this),f8(this)}dispose(){super.dispose(),this.geometry.dispose()}},F3;(t=>{function e(i){return Er.is(i)&&i instanceof UT}t.is=e})(F3||(F3={}));var m8=(t,e)=>class extends F_(t,e){updateState_Light(i,r){this.updateState_Entity(i,r),i.color!==void 0&&(this.color=r.shared.color(i.color)),i.intensity!==void 0&&(this.intensity=i.intensity),i.depth!==void 0&&(this.shadow.camera.far=i.depth,this.shadow.needsUpdate=!0),i.shadows!==void 0&&(this.castShadow=i.shadows)}},Cd=t=>t instanceof So,Pp=t=>t!==null&&t instanceof j0,eV=t=>J5.is(t),sct=new W(1,1,1),Bte=new W,act=new W,Fte=new Ii,GT=class extends VT(hqe){constructor(t,e=15){super(e),this.object=t,this.dummy=new Tp,this.object.updateMatrixWorld(),this.name=`EmptyObjectHelper: ${t.uuid}`,this.matrix=this.dummy.matrixWorld,this.matrixAutoUpdate=!1,this.object.isBone&&(this.visible=!1)}raycast(t,e){HT(this.object,GT.geometryHelper,t,e,!1,this.dummy)}update(){}updateMatrix(){}updateMatrixWorld(t){this.object.matrixWorld.decompose(Bte,Fte,act),this.matrix.compose(Bte,Fte,sct),super.updateMatrixWorld(t)}updateWorldMatrix(t,e){}},m1=class extends F_(Tp,GT){constructor(t,e){super(),this.super_Entity(t,e),this.objectHelper.update()}updateState(t,e){this.updateState_Entity(t,e),"buffer"in t&&Object.keys(t).length===1&&e.scene.reloadSplats()}},NA=class extends F_(Tp,GT){constructor(t,e,i){super(),this.super_Entity(t,e),this.context=i,this.objectHelper.update()}updateState(t,e){this.updateState_Entity(t,e)}},ime={RED:0,GREEN:1},WT="varying vec2 vUv;void main(){vUv=position.xy*0.5+0.5;gl_Position=vec4(position.xy,1.0,1.0);}",oct=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
uniform lowp sampler2D cocBuffer;uniform vec2 texelSize;uniform float scale;uniform vec4 kernel64[32];varying vec2 vUv;void main(){
#ifdef FOREGROUND
vec2 CoCNearFar=texture2D(cocBuffer,vUv).rg;float CoC=CoCNearFar.r*scale;
#else
float CoC=texture2D(cocBuffer,vUv).g*scale;
#endif
if(CoC==0.0){gl_FragColor=texture2D(inputBuffer,vUv);}else{
#ifdef FOREGROUND
vec2 step=texelSize*max(CoC,CoCNearFar.g*scale);
#else
vec2 step=texelSize*CoC;
#endif
vec4 acc=vec4(0.0);for(int i=0;i<32;++i){vec4 kernel=kernel64[i];vec2 uv=step*kernel.xy+vUv;acc+=texture2D(inputBuffer,uv);uv=step*kernel.zw+vUv;acc+=texture2D(inputBuffer,uv);}gl_FragColor=acc/64.0;}}`,AR=class extends Tr{constructor(t=!1,e=!1){super({name:"BokehMaterial",defines:{PASS:t?"2":"1"},uniforms:{kernel64:new xt(null),kernel16:new xt(null),inputBuffer:new xt(null),cocBuffer:new xt(null),texelSize:new xt(new Ae),scale:new xt(1)},blending:Hs,depthWrite:!1,depthTest:!1,fragmentShader:oct,vertexShader:WT}),this.toneMapped=!1,e&&(this.defines.FOREGROUND="1"),this.generateKernel()}set inputBuffer(t){this.uniforms.inputBuffer.value=t}setInputBuffer(t){this.uniforms.inputBuffer.value=t}set cocBuffer(t){this.uniforms.cocBuffer.value=t}setCoCBuffer(t){this.uniforms.cocBuffer.value=t}get scale(){return this.uniforms.scale.value}set scale(t){this.uniforms.scale.value=t}getScale(t){return this.uniforms.scale.value=t}setScale(t){this.uniforms.scale.value=t}generateKernel(){let t=2.39996323,e=new Float32Array(128),i=new Float32Array(32),r=0,n=0;for(let o=0;o<80;++o){let l=o*t,c=Math.sqrt(o)/Math.sqrt(80),u=c*Math.cos(l),h=c*Math.sin(l);o%5===0?(i[n++]=u,i[n++]=h):(e[r++]=u,e[r++]=h)}let s=[],a=[];for(let o=0;o<128;)s.push(new Ui(e[o++],e[o++],e[o++],e[o++]));for(let o=0;o<32;)a.push(new Ui(i[o++],i[o++],i[o++],i[o++]));this.uniforms.kernel64.value=s,this.uniforms.kernel16.value=a}setTexelSize(t,e){this.uniforms.texelSize.value.set(t,e)}setSize(t,e){this.uniforms.texelSize.value.set(1/t,1/e)}};function zte(t,e,i){return t*(e-i)-e}function tV(t,e,i){return Math.min(Math.max((t+e)/(e-i),0),1)}var lct=`#include <common>
#include <packing>
#ifdef GL_FRAGMENT_PRECISION_HIGH
uniform highp sampler2D depthBuffer;
#else
uniform mediump sampler2D depthBuffer;
#endif
uniform float focusDistance;uniform float focusRange;uniform float cameraNear;uniform float cameraFar;varying vec2 vUv;float readDepth(const in vec2 uv){
#if DEPTH_PACKING == 3201
return unpackRGBAToDepth(texture2D(depthBuffer,uv));
#else
return texture2D(depthBuffer,uv).r;
#endif
}void main(){float depth=readDepth(vUv);
#ifdef PERSPECTIVE_CAMERA
float viewZ=perspectiveDepthToViewZ(depth,cameraNear,cameraFar);float linearDepth=viewZToOrthographicDepth(viewZ,cameraNear,cameraFar);
#else
float linearDepth=depth;
#endif
float signedDistance=linearDepth-focusDistance;float magnitude=smoothstep(0.0,focusRange,abs(signedDistance));gl_FragColor.rg=magnitude*vec2(step(signedDistance,0.0),step(0.0,signedDistance));}`,cct=class extends Tr{constructor(t){super({name:"CircleOfConfusionMaterial",defines:{DEPTH_PACKING:"0"},uniforms:{depthBuffer:new xt(null),focusDistance:new xt(0),focusRange:new xt(0),cameraNear:new xt(.3),cameraFar:new xt(1e3)},blending:Hs,depthWrite:!1,depthTest:!1,fragmentShader:lct,vertexShader:WT}),this.toneMapped=!1,this.uniforms.focalLength=this.uniforms.focusRange,this.adoptCameraSettings(t)}get near(){return this.uniforms.cameraNear.value}get far(){return this.uniforms.cameraFar.value}set depthBuffer(t){this.uniforms.depthBuffer.value=t}set depthPacking(t){this.defines.DEPTH_PACKING=t.toFixed(0),this.needsUpdate=!0}setDepthBuffer(t,e=em){this.depthBuffer=t,this.depthPacking=e}get focusDistance(){return this.uniforms.focusDistance.value}set focusDistance(t){this.uniforms.focusDistance.value=t}get worldFocusDistance(){return-zte(this.focusDistance,this.near,this.far)}set worldFocusDistance(t){this.focusDistance=tV(-t,this.near,this.far)}getFocusDistance(t){this.uniforms.focusDistance.value=t}setFocusDistance(t){this.uniforms.focusDistance.value=t}get focalLength(){return this.focusRange}set focalLength(t){this.focusRange=t}get focusRange(){return this.uniforms.focusRange.value}set focusRange(t){this.uniforms.focusRange.value=t}get worldFocusRange(){return-zte(this.focusRange,this.near,this.far)}set worldFocusRange(t){this.focusRange=tV(-t,this.near,this.far)}getFocalLength(t){return this.focusRange}setFocalLength(t){this.focusRange=t}adoptCameraSettings(t){t&&(this.uniforms.cameraNear.value=t.near,this.uniforms.cameraFar.value=t.far,t instanceof No?this.defines.PERSPECTIVE_CAMERA="1":delete this.defines.PERSPECTIVE_CAMERA,this.needsUpdate=!0)}},uct=`#include <common>
#include <dithering_pars_fragment>
#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;void main(){vec4 sum=texture2D(inputBuffer,vUv0);sum+=texture2D(inputBuffer,vUv1);sum+=texture2D(inputBuffer,vUv2);sum+=texture2D(inputBuffer,vUv3);gl_FragColor=sum*0.25;
#include <encodings_fragment>
#include <dithering_fragment>
}`,hct="uniform vec2 texelSize;uniform vec2 halfTexelSize;uniform float kernel;uniform float scale;varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;void main(){vec2 uv=position.xy*0.5+0.5;vec2 dUv=(texelSize*vec2(kernel)+halfTexelSize)*scale;vUv0=vec2(uv.x-dUv.x,uv.y+dUv.y);vUv1=vec2(uv.x+dUv.x,uv.y+dUv.y);vUv2=vec2(uv.x+dUv.x,uv.y-dUv.y);vUv3=vec2(uv.x-dUv.x,uv.y-dUv.y);gl_Position=vec4(position.xy,1.0,1.0);}",jte=class extends Tr{constructor(t=new Ae){super({name:"KawaseBlurMaterial",uniforms:{inputBuffer:new xt(null),texelSize:new xt(new Ae),halfTexelSize:new xt(new Ae),kernel:new xt(0),scale:new xt(1)},blending:Hs,depthWrite:!1,depthTest:!1,fragmentShader:uct,vertexShader:hct}),this.toneMapped=!1,this.setTexelSize(t.x,t.y)}set inputBuffer(t){this.uniforms.inputBuffer.value=t}setInputBuffer(t){this.inputBuffer=t}get scale(){return this.uniforms.scale.value}set scale(t){this.uniforms.scale.value=t}getScale(){return this.uniforms.scale.value}setScale(t){this.uniforms.scale.value=t}getKernel(){return null}get kernel(){return this.uniforms.kernel.value}set kernel(t){this.uniforms.kernel.value=t}setKernel(t){this.kernel=t}setTexelSize(t,e){this.uniforms.texelSize.value.set(t,e),this.uniforms.halfTexelSize.value.set(t,e).multiplyScalar(.5)}setSize(t,e){let i=this.uniforms;i.texelSize.value.set(1/t,1/e),i.halfTexelSize.value.copy(i.texelSize.value).multiplyScalar(.5)}},dct=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
uniform float opacity;varying vec2 vUv;void main(){vec4 texel=texture2D(inputBuffer,vUv);gl_FragColor=opacity*texel;
#include <encodings_fragment>
}`,fct=class extends Tr{constructor(){super({name:"CopyMaterial",uniforms:{inputBuffer:new xt(null),opacity:new xt(1)},blending:Hs,depthWrite:!1,depthTest:!1,fragmentShader:dct,vertexShader:WT}),this.toneMapped=!1}set inputBuffer(t){this.uniforms.inputBuffer.value=t}setInputBuffer(t){this.uniforms.inputBuffer.value=t}getOpacity(t){return this.uniforms.opacity.value}setOpacity(t){this.uniforms.opacity.value=t}},pct=`varying vec2 vUv;varying vec2 vUv0;varying vec2 vUv1;
#if THREE_REVISION < 143
#define luminance(v) linearToRelativeLuminance(v)
#endif
#if EDGE_DETECTION_MODE != 0
varying vec2 vUv2;varying vec2 vUv3;varying vec2 vUv4;varying vec2 vUv5;
#endif
#if EDGE_DETECTION_MODE == 1
#include <common>
#endif
#if EDGE_DETECTION_MODE == 0 || PREDICATION_MODE == 1
#ifdef GL_FRAGMENT_PRECISION_HIGH
uniform highp sampler2D depthBuffer;
#else
uniform mediump sampler2D depthBuffer;
#endif
float readDepth(const in vec2 uv){
#if DEPTH_PACKING == 3201
return unpackRGBAToDepth(texture2D(depthBuffer,uv));
#else
return texture2D(depthBuffer,uv).r;
#endif
}vec3 gatherNeighbors(){float p=readDepth(vUv);float pLeft=readDepth(vUv0);float pTop=readDepth(vUv1);return vec3(p,pLeft,pTop);}
#elif PREDICATION_MODE == 2
uniform sampler2D predicationBuffer;vec3 gatherNeighbors(){float p=texture2D(predicationBuffer,vUv).r;float pLeft=texture2D(predicationBuffer,vUv0).r;float pTop=texture2D(predicationBuffer,vUv1).r;return vec3(p,pLeft,pTop);}
#endif
#if PREDICATION_MODE != 0
vec2 calculatePredicatedThreshold(){vec3 neighbours=gatherNeighbors();vec2 delta=abs(neighbours.xx-neighbours.yz);vec2 edges=step(PREDICATION_THRESHOLD,delta);return PREDICATION_SCALE*EDGE_THRESHOLD*(1.0-PREDICATION_STRENGTH*edges);}
#endif
#if EDGE_DETECTION_MODE != 0
uniform sampler2D inputBuffer;
#endif
void main(){
#if EDGE_DETECTION_MODE == 0
const vec2 threshold=vec2(DEPTH_THRESHOLD);
#elif PREDICATION_MODE != 0
vec2 threshold=calculatePredicatedThreshold();
#else
const vec2 threshold=vec2(EDGE_THRESHOLD);
#endif
#if EDGE_DETECTION_MODE == 0
vec3 neighbors=gatherNeighbors();vec2 delta=abs(neighbors.xx-vec2(neighbors.y,neighbors.z));vec2 edges=step(threshold,delta);if(dot(edges,vec2(1.0))==0.0){discard;}gl_FragColor=vec4(edges,0.0,1.0);
#elif EDGE_DETECTION_MODE == 1
float l=luminance(texture2D(inputBuffer,vUv).rgb);float lLeft=luminance(texture2D(inputBuffer,vUv0).rgb);float lTop=luminance(texture2D(inputBuffer,vUv1).rgb);vec4 delta;delta.xy=abs(l-vec2(lLeft,lTop));vec2 edges=step(threshold,delta.xy);if(dot(edges,vec2(1.0))==0.0){discard;}float lRight=luminance(texture2D(inputBuffer,vUv2).rgb);float lBottom=luminance(texture2D(inputBuffer,vUv3).rgb);delta.zw=abs(l-vec2(lRight,lBottom));vec2 maxDelta=max(delta.xy,delta.zw);float lLeftLeft=luminance(texture2D(inputBuffer,vUv4).rgb);float lTopTop=luminance(texture2D(inputBuffer,vUv5).rgb);delta.zw=abs(vec2(lLeft,lTop)-vec2(lLeftLeft,lTopTop));maxDelta=max(maxDelta.xy,delta.zw);float finalDelta=max(maxDelta.x,maxDelta.y);edges.xy*=step(finalDelta,LOCAL_CONTRAST_ADAPTATION_FACTOR*delta.xy);gl_FragColor=vec4(edges,0.0,1.0);
#elif EDGE_DETECTION_MODE == 2
vec4 delta;vec3 c=texture2D(inputBuffer,vUv).rgb;vec3 cLeft=texture2D(inputBuffer,vUv0).rgb;vec3 t=abs(c-cLeft);delta.x=max(max(t.r,t.g),t.b);vec3 cTop=texture2D(inputBuffer,vUv1).rgb;t=abs(c-cTop);delta.y=max(max(t.r,t.g),t.b);vec2 edges=step(threshold,delta.xy);if(dot(edges,vec2(1.0))==0.0){discard;}vec3 cRight=texture2D(inputBuffer,vUv2).rgb;t=abs(c-cRight);delta.z=max(max(t.r,t.g),t.b);vec3 cBottom=texture2D(inputBuffer,vUv3).rgb;t=abs(c-cBottom);delta.w=max(max(t.r,t.g),t.b);vec2 maxDelta=max(delta.xy,delta.zw);vec3 cLeftLeft=texture2D(inputBuffer,vUv4).rgb;t=abs(c-cLeftLeft);delta.z=max(max(t.r,t.g),t.b);vec3 cTopTop=texture2D(inputBuffer,vUv5).rgb;t=abs(c-cTopTop);delta.w=max(max(t.r,t.g),t.b);maxDelta=max(maxDelta.xy,delta.zw);float finalDelta=max(maxDelta.x,maxDelta.y);edges*=step(finalDelta,LOCAL_CONTRAST_ADAPTATION_FACTOR*delta.xy);gl_FragColor=vec4(edges,0.0,1.0);
#endif
}`,mct=`uniform vec2 texelSize;varying vec2 vUv;varying vec2 vUv0;varying vec2 vUv1;
#if EDGE_DETECTION_MODE != 0
varying vec2 vUv2;varying vec2 vUv3;varying vec2 vUv4;varying vec2 vUv5;
#endif
void main(){vUv=position.xy*0.5+0.5;vUv0=vUv+texelSize*vec2(-1.0,0.0);vUv1=vUv+texelSize*vec2(0.0,-1.0);
#if EDGE_DETECTION_MODE != 0
vUv2=vUv+texelSize*vec2(1.0,0.0);vUv3=vUv+texelSize*vec2(0.0,1.0);vUv4=vUv+texelSize*vec2(-2.0,0.0);vUv5=vUv+texelSize*vec2(0.0,-2.0);
#endif
gl_Position=vec4(position.xy,1.0,1.0);}`,PL={COLOR:2},gct={DISABLED:0},vct=class extends Tr{constructor(t=new Ae,e=PL.COLOR){super({name:"EdgeDetectionMaterial",defines:{THREE_REVISION:S_.replace(/\D+/g,""),LOCAL_CONTRAST_ADAPTATION_FACTOR:"2.0",EDGE_THRESHOLD:"0.1",DEPTH_THRESHOLD:"0.01",PREDICATION_MODE:"0",PREDICATION_THRESHOLD:"0.01",PREDICATION_SCALE:"2.0",PREDICATION_STRENGTH:"1.0",DEPTH_PACKING:"0"},uniforms:{inputBuffer:new xt(null),depthBuffer:new xt(null),predicationBuffer:new xt(null),texelSize:new xt(t)},blending:Hs,depthWrite:!1,depthTest:!1,fragmentShader:pct,vertexShader:mct}),this.toneMapped=!1,this.edgeDetectionMode=e}set depthBuffer(t){this.uniforms.depthBuffer.value=t}set depthPacking(t){this.defines.DEPTH_PACKING=t.toFixed(0),this.needsUpdate=!0}setDepthBuffer(t,e=em){this.depthBuffer=t,this.depthPacking=e}get edgeDetectionMode(){return Number(this.defines.EDGE_DETECTION_MODE)}set edgeDetectionMode(t){this.defines.EDGE_DETECTION_MODE=t.toFixed(0),this.needsUpdate=!0}getEdgeDetectionMode(){return this.edgeDetectionMode}setEdgeDetectionMode(t){this.edgeDetectionMode=t}get localContrastAdaptationFactor(){return Number(this.defines.LOCAL_CONTRAST_ADAPTATION_FACTOR)}set localContrastAdaptationFactor(t){this.defines.LOCAL_CONTRAST_ADAPTATION_FACTOR=t.toFixed("6"),this.needsUpdate=!0}getLocalContrastAdaptationFactor(){return this.localContrastAdaptationFactor}setLocalContrastAdaptationFactor(t){this.localContrastAdaptationFactor=t}get edgeDetectionThreshold(){return Number(this.defines.EDGE_THRESHOLD)}set edgeDetectionThreshold(t){this.defines.EDGE_THRESHOLD=t.toFixed("6"),this.defines.DEPTH_THRESHOLD=(t*.1).toFixed("6"),this.needsUpdate=!0}getEdgeDetectionThreshold(){return this.edgeDetectionThreshold}setEdgeDetectionThreshold(t){this.edgeDetectionThreshold=t}get predicationMode(){return Number(this.defines.PREDICATION_MODE)}set predicationMode(t){this.defines.PREDICATION_MODE=t.toFixed(0),this.needsUpdate=!0}getPredicationMode(){return this.predicationMode}setPredicationMode(t){this.predicationMode=t}set predicationBuffer(t){this.uniforms.predicationBuffer.value=t}setPredicationBuffer(t){this.uniforms.predicationBuffer.value=t}get predicationThreshold(){return Number(this.defines.PREDICATION_THRESHOLD)}set predicationThreshold(t){this.defines.PREDICATION_THRESHOLD=t.toFixed("6"),this.needsUpdate=!0}getPredicationThreshold(){return this.predicationThreshold}setPredicationThreshold(t){this.predicationThreshold=t}get predicationScale(){return Number(this.defines.PREDICATION_SCALE)}set predicationScale(t){this.defines.PREDICATION_SCALE=t.toFixed("6"),this.needsUpdate=!0}getPredicationScale(){return this.predicationScale}setPredicationScale(t){this.predicationScale=t}get predicationStrength(){return Number(this.defines.PREDICATION_STRENGTH)}set predicationStrength(t){this.defines.PREDICATION_STRENGTH=t.toFixed("6"),this.needsUpdate=!0}getPredicationStrength(){return this.predicationStrength}setPredicationStrength(t){this.predicationStrength=t}setSize(t,e){this.uniforms.texelSize.value.set(1/t,1/e)}},yct=`#include <common>
#include <packing>
#include <dithering_pars_fragment>
#define packFloatToRGBA(v) packDepthToRGBA(v)
#define unpackRGBAToFloat(v) unpackRGBAToDepth(v)
#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
#ifdef GL_FRAGMENT_PRECISION_HIGH
uniform highp sampler2D depthBuffer;
#else
uniform mediump sampler2D depthBuffer;
#endif
uniform vec2 resolution;uniform vec2 texelSize;uniform float cameraNear;uniform float cameraFar;uniform float aspect;uniform float time;varying vec2 vUv;
#if THREE_REVISION < 143
#define luminance(v) linearToRelativeLuminance(v)
#endif
#if THREE_REVISION >= 137
vec4 sRGBToLinear(const in vec4 value){return vec4(mix(pow(value.rgb*0.9478672986+vec3(0.0521327014),vec3(2.4)),value.rgb*0.0773993808,vec3(lessThanEqual(value.rgb,vec3(0.04045)))),value.a);}
#endif
float readDepth(const in vec2 uv){
#if DEPTH_PACKING == 3201
return unpackRGBAToDepth(texture2D(depthBuffer,uv));
#else
return texture2D(depthBuffer,uv).r;
#endif
}float getViewZ(const in float depth){
#ifdef PERSPECTIVE_CAMERA
return perspectiveDepthToViewZ(depth,cameraNear,cameraFar);
#else
return orthographicDepthToViewZ(depth,cameraNear,cameraFar);
#endif
}FRAGMENT_HEADvoid main(){FRAGMENT_MAIN_UVvec4 color0=texture2D(inputBuffer,UV);vec4 color1=vec4(0.0);FRAGMENT_MAIN_IMAGEgl_FragColor=color0;
#ifdef ENCODE_OUTPUT
#include <encodings_fragment>
#endif
#include <dithering_fragment>
}`,xct="uniform vec2 resolution;uniform vec2 texelSize;uniform float cameraNear;uniform float cameraFar;uniform float aspect;uniform float time;varying vec2 vUv;VERTEX_HEADvoid main(){vUv=position.xy*0.5+0.5;VERTEX_MAIN_SUPPORTgl_Position=vec4(position.xy,1.0,1.0);}",ah={FRAGMENT_HEAD:"FRAGMENT_HEAD",FRAGMENT_MAIN_UV:"FRAGMENT_MAIN_UV",FRAGMENT_MAIN_IMAGE:"FRAGMENT_MAIN_IMAGE",VERTEX_HEAD:"VERTEX_HEAD",VERTEX_MAIN_SUPPORT:"VERTEX_MAIN_SUPPORT"},iV=class extends Tr{constructor(t,e,i,r,n=!1){super({name:"EffectMaterial",defines:{THREE_REVISION:S_.replace(/\D+/g,""),DEPTH_PACKING:"0",ENCODE_OUTPUT:"1"},uniforms:{inputBuffer:new xt(null),depthBuffer:new xt(null),resolution:new xt(new Ae),texelSize:new xt(new Ae),cameraNear:new xt(.3),cameraFar:new xt(1e3),aspect:new xt(1),time:new xt(0)},blending:Hs,depthWrite:!1,depthTest:!1,dithering:n}),this.toneMapped=!1,t&&this.setShaderParts(t),e&&this.setDefines(e),i&&this.setUniforms(i),this.adoptCameraSettings(r)}set inputBuffer(t){this.uniforms.inputBuffer.value=t}setInputBuffer(t){this.uniforms.inputBuffer.value=t}get depthBuffer(){return this.uniforms.depthBuffer.value}set depthBuffer(t){this.uniforms.depthBuffer.value=t}get depthPacking(){return Number(this.defines.DEPTH_PACKING)}set depthPacking(t){this.defines.DEPTH_PACKING=t.toFixed(0),this.needsUpdate=!0}setDepthBuffer(t,e=em){this.depthBuffer=t,this.depthPacking=e}setShaderParts(t){return this.fragmentShader=yct.replace(ah.FRAGMENT_HEAD,t.get(ah.FRAGMENT_HEAD)).replace(ah.FRAGMENT_MAIN_UV,t.get(ah.FRAGMENT_MAIN_UV)).replace(ah.FRAGMENT_MAIN_IMAGE,t.get(ah.FRAGMENT_MAIN_IMAGE)),this.vertexShader=xct.replace(ah.VERTEX_HEAD,t.get(ah.VERTEX_HEAD)).replace(ah.VERTEX_MAIN_SUPPORT,t.get(ah.VERTEX_MAIN_SUPPORT)),this.needsUpdate=!0,this}setDefines(t){for(let e of t.entries())this.defines[e[0]]=e[1];return this.needsUpdate=!0,this}setUniforms(t){for(let e of t.entries())this.uniforms[e[0]]=e[1];return this}setExtensions(t){this.extensions={};for(let e of t)this.extensions[e]=!0;return this}get encodeOutput(){return this.defines.ENCODE_OUTPUT!==void 0}set encodeOutput(t){this.encodeOutput!==t&&(t?this.defines.ENCODE_OUTPUT="1":delete this.defines.ENCODE_OUTPUT,this.needsUpdate=!0)}isOutputEncodingEnabled(t){return this.encodeOutput}setOutputEncodingEnabled(t){this.encodeOutput=t}get time(){return this.uniforms.time.value}set time(t){this.uniforms.time.value=t}setDeltaTime(t){this.uniforms.time.value+=t}adoptCameraSettings(t){t&&(this.uniforms.cameraNear.value=t.near,this.uniforms.cameraFar.value=t.far,t instanceof No?this.defines.PERSPECTIVE_CAMERA="1":delete this.defines.PERSPECTIVE_CAMERA,this.needsUpdate=!0)}setSize(t,e){let i=this.uniforms;i.resolution.value.set(t,e),i.texelSize.value.set(1/t,1/e),i.aspect.value=t/e}static get Section(){return ah}},bct=`#include <common>
#if THREE_REVISION < 143
#define luminance(v) linearToRelativeLuminance(v)
#endif
#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
#ifdef RANGE
uniform vec2 range;
#elif defined(THRESHOLD)
uniform float threshold;uniform float smoothing;
#endif
varying vec2 vUv;void main(){vec4 texel=texture2D(inputBuffer,vUv);float l=luminance(texel.rgb);
#ifdef RANGE
float low=step(range.x,l);float high=step(l,range.y);l*=low*high;
#elif defined(THRESHOLD)
l=smoothstep(threshold,threshold+smoothing,l);
#endif
#ifdef COLOR
gl_FragColor=vec4(texel.rgb*l,l);
#else
gl_FragColor=vec4(l);
#endif
}`,wct=class extends Tr{constructor(t=!1,e=null){super({name:"LuminanceMaterial",defines:{THREE_REVISION:S_.replace(/\D+/g,"")},uniforms:{inputBuffer:new xt(null),threshold:new xt(0),smoothing:new xt(1),range:new xt(null)},blending:Hs,depthWrite:!1,depthTest:!1,fragmentShader:bct,vertexShader:WT}),this.toneMapped=!1,this.colorOutput=t,this.luminanceRange=e}set inputBuffer(t){this.uniforms.inputBuffer.value=t}setInputBuffer(t){this.uniforms.inputBuffer.value=t}get threshold(){return this.uniforms.threshold.value}set threshold(t){this.smoothing>0||t>0?this.defines.THRESHOLD="1":delete this.defines.THRESHOLD,this.uniforms.threshold.value=t}getThreshold(){return this.threshold}setThreshold(t){this.threshold=t}get smoothing(){return this.uniforms.smoothing.value}set smoothing(t){this.threshold>0||t>0?this.defines.THRESHOLD="1":delete this.defines.THRESHOLD,this.uniforms.smoothing.value=t}getSmoothingFactor(){return this.smoothing}setSmoothingFactor(t){this.smoothing=t}get useThreshold(){return this.threshold>0||this.smoothing>0}set useThreshold(t){}get colorOutput(){return this.defines.COLOR!==void 0}set colorOutput(t){t?this.defines.COLOR="1":delete this.defines.COLOR,this.needsUpdate=!0}isColorOutputEnabled(t){return this.colorOutput}setColorOutputEnabled(t){this.colorOutput=t}get useRange(){return this.luminanceRange!==null}set useRange(t){this.luminanceRange=null}get luminanceRange(){return this.uniforms.range.value}set luminanceRange(t){t!==null?this.defines.RANGE="1":delete this.defines.RANGE,this.uniforms.range.value=t,this.needsUpdate=!0}getLuminanceRange(){return this.luminanceRange}setLuminanceRange(t){this.luminanceRange=t}},_ct=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
#ifdef MASK_PRECISION_HIGH
uniform mediump sampler2D maskTexture;
#else
uniform lowp sampler2D maskTexture;
#endif
#if MASK_FUNCTION != 0
uniform float strength;
#endif
varying vec2 vUv;void main(){
#if COLOR_CHANNEL == 0
float mask=texture2D(maskTexture,vUv).r;
#elif COLOR_CHANNEL == 1
float mask=texture2D(maskTexture,vUv).g;
#elif COLOR_CHANNEL == 2
float mask=texture2D(maskTexture,vUv).b;
#else
float mask=texture2D(maskTexture,vUv).a;
#endif
#if MASK_FUNCTION == 0
#ifdef INVERTED
mask=step(mask,0.0);
#else
mask=1.0-step(mask,0.0);
#endif
#else
mask=clamp(mask*strength,0.0,1.0);
#ifdef INVERTED
mask=1.0-mask;
#endif
#endif
#if MASK_FUNCTION == 2
gl_FragColor=vec4(mask*texture2D(inputBuffer,vUv).rgb,mask);
#else
gl_FragColor=mask*texture2D(inputBuffer,vUv);
#endif
}`,rme={DISCARD:0,MULTIPLY:1},Sct=class extends Tr{constructor(t=null){super({name:"MaskMaterial",uniforms:{maskTexture:new xt(t),inputBuffer:new xt(null),strength:new xt(1)},blending:Hs,depthWrite:!1,depthTest:!1,fragmentShader:_ct,vertexShader:WT}),this.toneMapped=!1,this.setColorChannel(ime.RED),this.setMaskFunction(rme.DISCARD)}set inputBuffer(t){this.uniforms.inputBuffer.value=t}setInputBuffer(t){this.uniforms.inputBuffer.value=t}set maskTexture(t){this.uniforms.maskTexture.value=t,delete this.defines.MASK_PRECISION_HIGH,t.type!==Ho&&(this.defines.MASK_PRECISION_HIGH="1"),this.needsUpdate=!0}setMaskTexture(t){this.maskTexture=t}set colorChannel(t){this.defines.COLOR_CHANNEL=t.toFixed(0),this.needsUpdate=!0}setColorChannel(t){this.colorChannel=t}set maskFunction(t){this.defines.MASK_FUNCTION=t.toFixed(0),this.needsUpdate=!0}setMaskFunction(t){this.maskFunction=t}get inverted(){return this.defines.INVERTED!==void 0}set inverted(t){this.inverted&&!t?delete this.defines.INVERTED:t&&(this.defines.INVERTED="1"),this.needsUpdate=!0}isInverted(){return this.inverted}setInverted(t){this.inverted=t}get strength(){return this.uniforms.strength.value}set strength(t){this.uniforms.strength.value=t}getStrength(){return this.strength}setStrength(t){this.strength=t}},Ect=`#define sampleLevelZeroOffset(t, coord, offset) texture2D(t, coord + offset * texelSize)
#if __VERSION__ < 300
#define round(v) floor(v + 0.5)
#endif
#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
uniform lowp sampler2D areaTexture;uniform lowp sampler2D searchTexture;uniform vec2 texelSize;uniform vec2 resolution;varying vec2 vUv;varying vec4 vOffset[3];varying vec2 vPixCoord;void movec(const in bvec2 c,inout vec2 variable,const in vec2 value){if(c.x){variable.x=value.x;}if(c.y){variable.y=value.y;}}void movec(const in bvec4 c,inout vec4 variable,const in vec4 value){movec(c.xy,variable.xy,value.xy);movec(c.zw,variable.zw,value.zw);}vec2 decodeDiagBilinearAccess(in vec2 e){e.r=e.r*abs(5.0*e.r-5.0*0.75);return round(e);}vec4 decodeDiagBilinearAccess(in vec4 e){e.rb=e.rb*abs(5.0*e.rb-5.0*0.75);return round(e);}vec2 searchDiag1(const in vec2 texCoord,const in vec2 dir,out vec2 e){vec4 coord=vec4(texCoord,-1.0,1.0);vec3 t=vec3(texelSize,1.0);for(int i=0;i<MAX_SEARCH_STEPS_INT;++i){if(!(coord.z<float(MAX_SEARCH_STEPS_DIAG_INT-1)&&coord.w>0.9)){break;}coord.xyz=t*vec3(dir,1.0)+coord.xyz;e=texture2D(inputBuffer,coord.xy).rg;coord.w=dot(e,vec2(0.5));}return coord.zw;}vec2 searchDiag2(const in vec2 texCoord,const in vec2 dir,out vec2 e){vec4 coord=vec4(texCoord,-1.0,1.0);coord.x+=0.25*texelSize.x;vec3 t=vec3(texelSize,1.0);for(int i=0;i<MAX_SEARCH_STEPS_INT;++i){if(!(coord.z<float(MAX_SEARCH_STEPS_DIAG_INT-1)&&coord.w>0.9)){break;}coord.xyz=t*vec3(dir,1.0)+coord.xyz;e=texture2D(inputBuffer,coord.xy).rg;e=decodeDiagBilinearAccess(e);coord.w=dot(e,vec2(0.5));}return coord.zw;}vec2 areaDiag(const in vec2 dist,const in vec2 e,const in float offset){vec2 texCoord=vec2(AREATEX_MAX_DISTANCE_DIAG,AREATEX_MAX_DISTANCE_DIAG)*e+dist;texCoord=AREATEX_PIXEL_SIZE*texCoord+0.5*AREATEX_PIXEL_SIZE;texCoord.x+=0.5;texCoord.y+=AREATEX_SUBTEX_SIZE*offset;return texture2D(areaTexture,texCoord).rg;}vec2 calculateDiagWeights(const in vec2 texCoord,const in vec2 e,const in vec4 subsampleIndices){vec2 weights=vec2(0.0);vec4 d;vec2 end;if(e.r>0.0){d.xz=searchDiag1(texCoord,vec2(-1.0,1.0),end);d.x+=float(end.y>0.9);}else{d.xz=vec2(0.0);}d.yw=searchDiag1(texCoord,vec2(1.0,-1.0),end);if(d.x+d.y>2.0){vec4 coords=vec4(-d.x+0.25,d.x,d.y,-d.y-0.25)*texelSize.xyxy+texCoord.xyxy;vec4 c;c.xy=sampleLevelZeroOffset(inputBuffer,coords.xy,vec2(-1,0)).rg;c.zw=sampleLevelZeroOffset(inputBuffer,coords.zw,vec2(1,0)).rg;c.yxwz=decodeDiagBilinearAccess(c.xyzw);vec2 cc=vec2(2.0)*c.xz+c.yw;movec(bvec2(step(0.9,d.zw)),cc,vec2(0.0));weights+=areaDiag(d.xy,cc,subsampleIndices.z);}d.xz=searchDiag2(texCoord,vec2(-1.0,-1.0),end);if(sampleLevelZeroOffset(inputBuffer,texCoord,vec2(1,0)).r>0.0){d.yw=searchDiag2(texCoord,vec2(1.0),end);d.y+=float(end.y>0.9);}else{d.yw=vec2(0.0);}if(d.x+d.y>2.0){vec4 coords=vec4(-d.x,-d.x,d.y,d.y)*texelSize.xyxy+texCoord.xyxy;vec4 c;c.x=sampleLevelZeroOffset(inputBuffer,coords.xy,vec2(-1,0)).g;c.y=sampleLevelZeroOffset(inputBuffer,coords.xy,vec2(0,-1)).r;c.zw=sampleLevelZeroOffset(inputBuffer,coords.zw,vec2(1,0)).gr;vec2 cc=vec2(2.0)*c.xz+c.yw;movec(bvec2(step(0.9,d.zw)),cc,vec2(0.0));weights+=areaDiag(d.xy,cc,subsampleIndices.w).gr;}return weights;}float searchLength(const in vec2 e,const in float offset){vec2 scale=SEARCHTEX_SIZE*vec2(0.5,-1.0);vec2 bias=SEARCHTEX_SIZE*vec2(offset,1.0);scale+=vec2(-1.0,1.0);bias+=vec2(0.5,-0.5);scale*=1.0/SEARCHTEX_PACKED_SIZE;bias*=1.0/SEARCHTEX_PACKED_SIZE;return texture2D(searchTexture,scale*e+bias).r;}float searchXLeft(in vec2 texCoord,const in float end){vec2 e=vec2(0.0,1.0);for(int i=0;i<MAX_SEARCH_STEPS_INT;++i){if(!(texCoord.x>end&&e.g>0.8281&&e.r==0.0)){break;}e=texture2D(inputBuffer,texCoord).rg;texCoord=vec2(-2.0,0.0)*texelSize+texCoord;}float offset=-(255.0/127.0)*searchLength(e,0.0)+3.25;return texelSize.x*offset+texCoord.x;}float searchXRight(vec2 texCoord,const in float end){vec2 e=vec2(0.0,1.0);for(int i=0;i<MAX_SEARCH_STEPS_INT;++i){if(!(texCoord.x<end&&e.g>0.8281&&e.r==0.0)){break;}e=texture2D(inputBuffer,texCoord).rg;texCoord=vec2(2.0,0.0)*texelSize.xy+texCoord;}float offset=-(255.0/127.0)*searchLength(e,0.5)+3.25;return-texelSize.x*offset+texCoord.x;}float searchYUp(vec2 texCoord,const in float end){vec2 e=vec2(1.0,0.0);for(int i=0;i<MAX_SEARCH_STEPS_INT;++i){if(!(texCoord.y>end&&e.r>0.8281&&e.g==0.0)){break;}e=texture2D(inputBuffer,texCoord).rg;texCoord=-vec2(0.0,2.0)*texelSize.xy+texCoord;}float offset=-(255.0/127.0)*searchLength(e.gr,0.0)+3.25;return texelSize.y*offset+texCoord.y;}float searchYDown(vec2 texCoord,const in float end){vec2 e=vec2(1.0,0.0);for(int i=0;i<MAX_SEARCH_STEPS_INT;i++){if(!(texCoord.y<end&&e.r>0.8281&&e.g==0.0)){break;}e=texture2D(inputBuffer,texCoord).rg;texCoord=vec2(0.0,2.0)*texelSize.xy+texCoord;}float offset=-(255.0/127.0)*searchLength(e.gr,0.5)+3.25;return-texelSize.y*offset+texCoord.y;}vec2 area(const in vec2 dist,const in float e1,const in float e2,const in float offset){vec2 texCoord=vec2(AREATEX_MAX_DISTANCE)*round(4.0*vec2(e1,e2))+dist;texCoord=AREATEX_PIXEL_SIZE*texCoord+0.5*AREATEX_PIXEL_SIZE;texCoord.y=AREATEX_SUBTEX_SIZE*offset+texCoord.y;return texture2D(areaTexture,texCoord).rg;}void detectHorizontalCornerPattern(inout vec2 weights,const in vec4 texCoord,const in vec2 d){
#if !defined(DISABLE_CORNER_DETECTION)
vec2 leftRight=step(d.xy,d.yx);vec2 rounding=(1.0-CORNER_ROUNDING_NORM)*leftRight;rounding/=leftRight.x+leftRight.y;vec2 factor=vec2(1.0);factor.x-=rounding.x*sampleLevelZeroOffset(inputBuffer,texCoord.xy,vec2(0,1)).r;factor.x-=rounding.y*sampleLevelZeroOffset(inputBuffer,texCoord.zw,vec2(1,1)).r;factor.y-=rounding.x*sampleLevelZeroOffset(inputBuffer,texCoord.xy,vec2(0,-2)).r;factor.y-=rounding.y*sampleLevelZeroOffset(inputBuffer,texCoord.zw,vec2(1,-2)).r;weights*=clamp(factor,0.0,1.0);
#endif
}void detectVerticalCornerPattern(inout vec2 weights,const in vec4 texCoord,const in vec2 d){
#if !defined(DISABLE_CORNER_DETECTION)
vec2 leftRight=step(d.xy,d.yx);vec2 rounding=(1.0-CORNER_ROUNDING_NORM)*leftRight;rounding/=leftRight.x+leftRight.y;vec2 factor=vec2(1.0);factor.x-=rounding.x*sampleLevelZeroOffset(inputBuffer,texCoord.xy,vec2(1,0)).g;factor.x-=rounding.y*sampleLevelZeroOffset(inputBuffer,texCoord.zw,vec2(1,1)).g;factor.y-=rounding.x*sampleLevelZeroOffset(inputBuffer,texCoord.xy,vec2(-2,0)).g;factor.y-=rounding.y*sampleLevelZeroOffset(inputBuffer,texCoord.zw,vec2(-2,1)).g;weights*=clamp(factor,0.0,1.0);
#endif
}void main(){vec4 weights=vec4(0.0);vec4 subsampleIndices=vec4(0.0);vec2 e=texture2D(inputBuffer,vUv).rg;if(e.g>0.0){
#if !defined(DISABLE_DIAG_DETECTION)
weights.rg=calculateDiagWeights(vUv,e,subsampleIndices);if(weights.r==-weights.g){
#endif
vec2 d;vec3 coords;coords.x=searchXLeft(vOffset[0].xy,vOffset[2].x);coords.y=vOffset[1].y;d.x=coords.x;float e1=texture2D(inputBuffer,coords.xy).r;coords.z=searchXRight(vOffset[0].zw,vOffset[2].y);d.y=coords.z;d=round(resolution.xx*d+-vPixCoord.xx);vec2 sqrtD=sqrt(abs(d));float e2=sampleLevelZeroOffset(inputBuffer,coords.zy,vec2(1,0)).r;weights.rg=area(sqrtD,e1,e2,subsampleIndices.y);coords.y=vUv.y;detectHorizontalCornerPattern(weights.rg,coords.xyzy,d);
#if !defined(DISABLE_DIAG_DETECTION)
}else{e.r=0.0;}
#endif
}if(e.r>0.0){vec2 d;vec3 coords;coords.y=searchYUp(vOffset[1].xy,vOffset[2].z);coords.x=vOffset[0].x;d.x=coords.y;float e1=texture2D(inputBuffer,coords.xy).g;coords.z=searchYDown(vOffset[1].zw,vOffset[2].w);d.y=coords.z;d=round(resolution.yy*d-vPixCoord.yy);vec2 sqrtD=sqrt(abs(d));float e2=sampleLevelZeroOffset(inputBuffer,coords.xz,vec2(0,1)).g;weights.ba=area(sqrtD,e1,e2,subsampleIndices.x);coords.x=vUv.x;detectVerticalCornerPattern(weights.ba,coords.xyxz,d);}gl_FragColor=weights;}`,Act="uniform vec2 texelSize;uniform vec2 resolution;varying vec2 vUv;varying vec4 vOffset[3];varying vec2 vPixCoord;void main(){vUv=position.xy*0.5+0.5;vPixCoord=vUv*resolution;vOffset[0]=vUv.xyxy+texelSize.xyxy*vec4(-0.25,-0.125,1.25,-0.125);vOffset[1]=vUv.xyxy+texelSize.xyxy*vec4(-0.125,-0.25,-0.125,1.25);vOffset[2]=vec4(vOffset[0].xz,vOffset[1].yw)+vec4(-2.0,2.0,-2.0,2.0)*texelSize.xxyy*MAX_SEARCH_STEPS_FLOAT;gl_Position=vec4(position.xy,1.0,1.0);}",Mct=class extends Tr{constructor(t=new Ae,e=new Ae){super({name:"SMAAWeightsMaterial",defines:{MAX_SEARCH_STEPS_INT:"16",MAX_SEARCH_STEPS_FLOAT:"16.0",MAX_SEARCH_STEPS_DIAG_INT:"8",MAX_SEARCH_STEPS_DIAG_FLOAT:"8.0",CORNER_ROUNDING:"25",CORNER_ROUNDING_NORM:"0.25",AREATEX_MAX_DISTANCE:"16.0",AREATEX_MAX_DISTANCE_DIAG:"20.0",AREATEX_PIXEL_SIZE:"(1.0 / vec2(160.0, 560.0))",AREATEX_SUBTEX_SIZE:"(1.0 / 7.0)",SEARCHTEX_SIZE:"vec2(66.0, 33.0)",SEARCHTEX_PACKED_SIZE:"vec2(64.0, 16.0)"},uniforms:{inputBuffer:new xt(null),searchTexture:new xt(null),areaTexture:new xt(null),resolution:new xt(e),texelSize:new xt(t)},blending:Hs,depthWrite:!1,depthTest:!1,fragmentShader:Ect,vertexShader:Act}),this.toneMapped=!1}set inputBuffer(t){this.uniforms.inputBuffer.value=t}setInputBuffer(t){this.uniforms.inputBuffer.value=t}get searchTexture(){return this.uniforms.searchTexture.value}set searchTexture(t){this.uniforms.searchTexture.value=t}get areaTexture(){return this.uniforms.areaTexture.value}set areaTexture(t){this.uniforms.areaTexture.value=t}setLookupTextures(t,e){this.searchTexture=t,this.areaTexture=e}get orthogonalSearchSteps(){return Number(this.defines.MAX_SEARCH_STEPS_INT)}set orthogonalSearchSteps(t){let e=Math.min(Math.max(t,0),112);this.defines.MAX_SEARCH_STEPS_INT=e.toFixed("0"),this.defines.MAX_SEARCH_STEPS_FLOAT=e.toFixed("1"),this.needsUpdate=!0}setOrthogonalSearchSteps(t){this.orthogonalSearchSteps=t}get diagonalSearchSteps(){return Number(this.defines.MAX_SEARCH_STEPS_DIAG_INT)}set diagonalSearchSteps(t){let e=Math.min(Math.max(t,0),20);this.defines.MAX_SEARCH_STEPS_DIAG_INT=e.toFixed("0"),this.defines.MAX_SEARCH_STEPS_DIAG_FLOAT=e.toFixed("1"),this.needsUpdate=!0}setDiagonalSearchSteps(t){this.diagonalSearchSteps=t}get diagonalDetection(){return this.defines.DISABLE_DIAG_DETECTION===void 0}set diagonalDetection(t){t?delete this.defines.DISABLE_DIAG_DETECTION:this.defines.DISABLE_DIAG_DETECTION="1",this.needsUpdate=!0}isDiagonalDetectionEnabled(){return this.diagonalDetection}setDiagonalDetectionEnabled(t){this.diagonalDetection=t}get cornerRounding(){return Number(this.defines.CORNER_ROUNDING)}set cornerRounding(t){let e=Math.min(Math.max(t,0),100);this.defines.CORNER_ROUNDING=e.toFixed("4"),this.defines.CORNER_ROUNDING_NORM=(e/100).toFixed("4"),this.needsUpdate=!0}setCornerRounding(t){this.cornerRounding=t}get cornerDetection(){return this.defines.DISABLE_CORNER_DETECTION===void 0}set cornerDetection(t){t?delete this.defines.DISABLE_CORNER_DETECTION:this.defines.DISABLE_CORNER_DETECTION="1",this.needsUpdate=!0}isCornerRoundingEnabled(){return this.cornerDetection}setCornerRoundingEnabled(t){this.cornerDetection=t}setSize(t,e){let i=this.uniforms;i.texelSize.value.set(1/t,1/e),i.resolution.value.set(t,e)}},Tct=new vv,Jm=null;function Cct(){if(Jm===null){let t=new Float32Array([-1,-1,0,3,-1,0,-1,3,0]),e=new Float32Array([0,0,2,0,0,2]);Jm=new oi,Jm.setAttribute!==void 0?(Jm.setAttribute("position",new Mi(t,3)),Jm.setAttribute("uv",new Mi(e,2))):(Jm.addAttribute("position",new Mi(t,3)),Jm.addAttribute("uv",new Mi(e,2)))}return Jm}var El=class{constructor(t="Pass",e=new ac,i=Tct){this.name=t,this.renderer=null,this.scene=e,this.camera=i,this.screen=null,this.rtt=!0,this.needsSwap=!0,this.needsDepthTexture=!1,this.enabled=!0}get renderToScreen(){return!this.rtt}set renderToScreen(t){if(this.rtt===t){let e=this.getFullscreenMaterial();e!==null&&(e.needsUpdate=!0),this.rtt=!t}}setRenderer(t){this.renderer=t}isEnabled(){return this.enabled}setEnabled(t){this.enabled=t}get fullscreenMaterial(){return this.screen!==null?this.screen.material:null}set fullscreenMaterial(t){let e=this.screen;e!==null?e.material=t:(e=new En(Cct(),t),e.frustumCulled=!1,this.scene===null&&(this.scene=new ac),this.scene.add(e),this.screen=e)}getFullscreenMaterial(){return this.fullscreenMaterial}setFullscreenMaterial(t){this.fullscreenMaterial=t}getDepthTexture(){return null}setDepthTexture(t,e=em){}render(t,e,i,r,n){throw new Error("Render method not implemented!")}setSize(t,e){}initialize(t,e,i){}dispose(){for(let t of Object.keys(this)){let e=this[t];if(e!==null&&typeof e=="object"&&typeof e.dispose=="function"){if(e instanceof ac||e===this.renderer)continue;this[t].dispose()}}}},rV=class extends El{constructor(t,e=!0){super("CopyPass"),this.fullscreenMaterial=new fct,this.needsSwap=!1,this.renderTarget=t,t===void 0&&(this.renderTarget=new Mr(1,1,{minFilter:nr,magFilter:nr,stencilBuffer:!1,depthBuffer:!1}),this.renderTarget.texture.name="CopyPass.Target"),this.autoResize=e}get resize(){return this.autoResize}set resize(t){this.autoResize=t}get texture(){return this.renderTarget.texture}getTexture(){return this.renderTarget.texture}setAutoResizeEnabled(t){this.autoResize=t}render(t,e,i,r,n){this.fullscreenMaterial.inputBuffer=e.texture,t.setRenderTarget(this.renderToScreen?null:this.renderTarget),t.render(this.scene,this.camera)}setSize(t,e){this.autoResize&&this.renderTarget.setSize(t,e)}initialize(t,e,i){i!==void 0&&(this.renderTarget.texture.type=i,i!==Ho?this.fullscreenMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1":t.outputEncoding===er&&(this.renderTarget.texture.encoding=er))}},Pct=class extends El{constructor(){super("ClearMaskPass",null,null),this.needsSwap=!1}render(t,e,i,r,n){let s=t.state.buffers.stencil;s.setLocked(!1),s.setTest(!1)}},i4=new Ai,g8=class extends El{constructor(t=!0,e=!0,i=!1){super("ClearPass",null,null),this.needsSwap=!1,this.color=t,this.depth=e,this.stencil=i,this.overrideClearColor=null,this.overrideClearAlpha=-1}setClearFlags(t,e,i){this.color=t,this.depth=e,this.stencil=i}getOverrideClearColor(){return this.overrideClearColor}setOverrideClearColor(t){this.overrideClearColor=t}getOverrideClearAlpha(){return this.overrideClearAlpha}setOverrideClearAlpha(t){this.overrideClearAlpha=t}render(t,e,i,r,n){let s=this.overrideClearColor,a=this.overrideClearAlpha,o=t.getClearAlpha(),l=s!==null,c=a>=0;l?(i4.copy(t.getClearColor(i4)),t.setClearColor(s,c?a:o)):c&&t.setClearAlpha(a),t.setRenderTarget(this.renderToScreen?null:e),t.clear(this.color,this.depth,this.stencil),l?t.setClearColor(i4,o):c&&t.setClearAlpha(o)}},eg=-1,rc=class extends Qa{constructor(t,e=eg,i=eg,r=1){super(),this.resizable=t,this.base=new Ae(1,1),this.preferred=new Ae(e,i),this.target=this.preferred,this.s=r}get width(){let{base:t,preferred:e,scale:i}=this,r;return e.width!==eg?r=e.width:e.height!==eg?r=Math.round(e.height*(t.width/Math.max(t.height,1))):r=Math.round(t.width*i),r}set width(t){this.preferredWidth=t}get height(){let{base:t,preferred:e,scale:i}=this,r;return e.height!==eg?r=e.height:e.width!==eg?r=Math.round(e.width/Math.max(t.width/Math.max(t.height,1),1)):r=Math.round(t.height*i),r}set height(t){this.preferredHeight=t}getWidth(){return this.width}getHeight(){return this.height}get scale(){return this.s}set scale(t){this.s!==t&&(this.s=t,this.preferred.setScalar(eg),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.base.width,this.base.height))}getScale(){return this.scale}setScale(t){this.scale=t}get baseWidth(){return this.base.width}set baseWidth(t){this.base.width!==t&&(this.base.width=t,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.base.width,this.base.height))}getBaseWidth(){return this.base.width}setBaseWidth(t){this.base.width!==t&&(this.base.width=t,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.base.width,this.base.height))}get baseHeight(){return this.base.height}set baseHeight(t){this.base.height!==t&&(this.base.height=t,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.base.width,this.base.height))}getBaseHeight(){return this.baseHeight}setBaseHeight(t){this.baseHeight=t}setBaseSize(t,e){(this.base.width!==t||this.base.height!==e)&&(this.base.set(t,e),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.base.width,this.base.height))}get preferredWidth(){return this.preferred.width}set preferredWidth(t){this.preferred.width!==t&&(this.preferred.width=t,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.base.width,this.base.height))}getPreferredWidth(){return this.preferredWidth}setPreferredWidth(t){this.preferredWidth=t}get preferredHeight(){return this.preferred.height}set preferredHeight(t){this.preferred.height!==t&&(this.preferred.height=t,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.base.width,this.base.height))}getPreferredHeight(){return this.preferredHeight}setPreferredHeight(t){this.preferredHeight=t}setPreferredSize(t,e){(this.preferred.width!==t||this.preferred.height!==e)&&(this.preferred.set(t,e),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.base.width,this.base.height))}copy(t){this.base.set(t.getBaseWidth(),t.getBaseHeight()),this.preferred.set(t.getPreferredWidth(),t.getPreferredHeight()),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.base.width,this.base.height)}static get AUTO_SIZE(){return eg}},r4=!1,Vte=class{constructor(t=null){this.originalMaterials=new Map,this.material=null,this.materials=null,this.materialsBackSide=null,this.materialsDoubleSide=null,this.materialsFlatShaded=null,this.materialsFlatShadedBackSide=null,this.materialsFlatShadedDoubleSide=null,this.setMaterial(t),this.meshCount=0,this.replaceMaterial=e=>{if(e.isMesh){let i;if(e.material.flatShading)switch(e.material.side){case jo:i=this.materialsFlatShadedDoubleSide;break;case qa:i=this.materialsFlatShadedBackSide;break;default:i=this.materialsFlatShaded;break}else switch(e.material.side){case jo:i=this.materialsDoubleSide;break;case qa:i=this.materialsBackSide;break;default:i=this.materials;break}this.originalMaterials.set(e,e.material),e.isSkinnedMesh?e.material=i[2]:e.isInstancedMesh?e.material=i[1]:e.material=i[0],++this.meshCount}}}setMaterial(t){if(this.disposeMaterials(),this.material=t,t!==null){let e=this.materials=[t.clone(),t.clone(),t.clone()];for(let i of e)i.uniforms=Object.assign({},t.uniforms),i.side=Ih;e[2].skinning=!0,this.materialsBackSide=e.map(i=>{let r=i.clone();return r.uniforms=Object.assign({},t.uniforms),r.side=qa,r}),this.materialsDoubleSide=e.map(i=>{let r=i.clone();return r.uniforms=Object.assign({},t.uniforms),r.side=jo,r}),this.materialsFlatShaded=e.map(i=>{let r=i.clone();return r.uniforms=Object.assign({},t.uniforms),r.flatShading=!0,r}),this.materialsFlatShadedBackSide=e.map(i=>{let r=i.clone();return r.uniforms=Object.assign({},t.uniforms),r.flatShading=!0,r.side=qa,r}),this.materialsFlatShadedDoubleSide=e.map(i=>{let r=i.clone();return r.uniforms=Object.assign({},t.uniforms),r.flatShading=!0,r.side=jo,r})}}render(t,e,i){let r=t.shadowMap.enabled;if(t.shadowMap.enabled=!1,r4){let n=this.originalMaterials;this.meshCount=0,e.traverse(this.replaceMaterial),t.render(e,i);for(let s of n)s[0].material=s[1];this.meshCount!==n.size&&n.clear()}else{let n=e.overrideMaterial;e.overrideMaterial=this.material,t.render(e,i),e.overrideMaterial=n}t.shadowMap.enabled=r}disposeMaterials(){if(this.material!==null){let t=this.materials.concat(this.materialsBackSide).concat(this.materialsDoubleSide).concat(this.materialsFlatShaded).concat(this.materialsFlatShadedBackSide).concat(this.materialsFlatShadedDoubleSide);for(let e of t)e.dispose()}}dispose(){this.originalMaterials.clear(),this.disposeMaterials()}static get workaroundEnabled(){return r4}static set workaroundEnabled(t){r4=t}},Rct=class extends El{constructor(t,e,i=null){super("RenderPass",t,e),this.needsSwap=!1,this.clearPass=new g8,this.overrideMaterialManager=i===null?null:new Vte(i),this.ignoreBackground=!1,this.skipShadowMapUpdate=!1,this.selection=null}get renderToScreen(){return super.renderToScreen}set renderToScreen(t){super.renderToScreen=t,this.clearPass.renderToScreen=t}get overrideMaterial(){let t=this.overrideMaterialManager;return t!==null?t.material:null}set overrideMaterial(t){let e=this.overrideMaterialManager;t!==null?e!==null?e.setMaterial(t):this.overrideMaterialManager=new Vte(t):e!==null&&(e.dispose(),this.overrideMaterialManager=null)}getOverrideMaterial(){return this.overrideMaterial}setOverrideMaterial(t){this.overrideMaterial=t}get clear(){return this.clearPass.enabled}set clear(t){this.clearPass.enabled=t}getSelection(){return this.selection}setSelection(t){this.selection=t}isBackgroundDisabled(){return this.ignoreBackground}setBackgroundDisabled(t){this.ignoreBackground=t}isShadowMapDisabled(){return this.skipShadowMapUpdate}setShadowMapDisabled(t){this.skipShadowMapUpdate=t}getClearPass(){return this.clearPass}render(t,e,i,r,n){let s=this.scene,a=this.camera,o=this.selection,l=a.layers.mask,c=s.background,u=t.shadowMap.autoUpdate,h=this.renderToScreen?null:e;o!==null&&a.layers.set(o.getLayer()),this.skipShadowMapUpdate&&(t.shadowMap.autoUpdate=!1),(this.ignoreBackground||this.clearPass.overrideClearColor!==null)&&(s.background=null),this.clearPass.enabled&&this.clearPass.render(t,e),t.setRenderTarget(h),this.overrideMaterialManager!==null?this.overrideMaterialManager.render(t,s,a):t.render(s,a),a.layers.mask=l,s.background=c,t.shadowMap.autoUpdate=u}},Hte=class extends El{constructor(t,e,{resolutionScale:i=1,width:r=rc.AUTO_SIZE,height:n=rc.AUTO_SIZE,renderTarget:s}={}){super("DepthPass"),this.needsSwap=!1,this.renderPass=new Rct(t,e,new bhe({depthPacking:she}));let a=this.renderPass;a.skipShadowMapUpdate=!0,a.ignoreBackground=!0;let o=a.getClearPass();o.overrideClearColor=new Ai(16777215),o.overrideClearAlpha=1,this.renderTarget=s,this.renderTarget===void 0&&(this.renderTarget=new Mr(1,1,{minFilter:mr,magFilter:mr,stencilBuffer:!1}),this.renderTarget.texture.name="DepthPass.Target");let l=this.resolution=new rc(this,r,n,i);l.addEventListener("change",c=>this.setSize(l.baseWidth,l.baseHeight))}get texture(){return this.renderTarget.texture}getTexture(){return this.renderTarget.texture}getResolution(){return this.resolution}getResolutionScale(){return this.resolution.scale}setResolutionScale(t){this.resolution.scale=t}render(t,e,i,r,n){let s=this.renderToScreen?null:this.renderTarget;this.renderPass.render(t,s)}setSize(t,e){let i=this.resolution;i.setBaseSize(t,e),this.renderTarget.setSize(i.width,i.height)}},Rr={SKIP:0,ADD:1,ALPHA:2,AVERAGE:3,COLOR_BURN:4,COLOR_DODGE:5,DARKEN:6,DIFFERENCE:7,EXCLUSION:8,LIGHTEN:9,MULTIPLY:10,DIVIDE:11,NEGATION:12,NORMAL:13,OVERLAY:14,REFLECT:15,SCREEN:16,SOFT_LIGHT:17,SUBTRACT:18},Ict="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return min(x+y,1.0)*opacity+x*(1.0-opacity);}",Dct="vec3 blend(const in vec3 x,const in vec3 y,const in float opacity){return y*opacity+x*(1.0-opacity);}vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){float a=min(y.a,opacity);return vec4(blend(x.rgb,y.rgb,a),max(x.a,a));}",Oct="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return(x+y)*0.5*opacity+x*(1.0-opacity);}",Lct="float blend(const in float x,const in float y){return(y==0.0)?y:max(1.0-(1.0-x)/y,0.0);}vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=vec4(blend(x.r,y.r),blend(x.g,y.g),blend(x.b,y.b),blend(x.a,y.a));return z*opacity+x*(1.0-opacity);}",kct="float blend(const in float x,const in float y){return(y==1.0)?y:min(x/(1.0-y),1.0);}vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=vec4(blend(x.r,y.r),blend(x.g,y.g),blend(x.b,y.b),blend(x.a,y.a));return z*opacity+x*(1.0-opacity);}",Nct="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return min(x,y)*opacity+x*(1.0-opacity);}",Uct="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return abs(x-y)*opacity+x*(1.0-opacity);}",Bct="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return(x+y-2.0*x*y)*opacity+x*(1.0-opacity);}",Fct="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return max(x,y)*opacity+x*(1.0-opacity);}",zct="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return x*y*opacity+x*(1.0-opacity);}",jct="float blend(const in float x,const in float y){return(y>0.0)?min(x/y,1.0):1.0;}vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=vec4(blend(x.r,y.r),blend(x.g,y.g),blend(x.b,y.b),blend(x.a,y.a));return z*opacity+x*(1.0-opacity);}",Vct="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return(1.0-abs(1.0-x-y))*opacity+x*(1.0-opacity);}",Hct="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return y*opacity+x*(1.0-opacity);}",Gct="float blend(const in float x,const in float y){return(x<0.5)?(2.0*x*y):(1.0-2.0*(1.0-x)*(1.0-y));}vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=vec4(blend(x.r,y.r),blend(x.g,y.g),blend(x.b,y.b),blend(x.a,y.a));return z*opacity+x*(1.0-opacity);}",Wct="float blend(const in float x,const in float y){return(y==1.0)?y:min(x*x/(1.0-y),1.0);}vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=vec4(blend(x.r,y.r),blend(x.g,y.g),blend(x.b,y.b),blend(x.a,y.a));return z*opacity+x*(1.0-opacity);}",qct="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return(1.0-(1.0-x)*(1.0-y))*opacity+x*(1.0-opacity);}",Xct="float blend(const in float x,const in float y){return(y<0.5)?(2.0*x*y+x*x*(1.0-2.0*y)):(sqrt(x)*(2.0*y-1.0)+2.0*x*(1.0-y));}vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=vec4(blend(x.r,y.r),blend(x.g,y.g),blend(x.b,y.b),blend(x.a,y.a));return z*opacity+x*(1.0-opacity);}",$ct="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return max(x+y-1.0,0.0)*opacity+x*(1.0-opacity);}",Yct=new Map([[Rr.SKIP,null],[Rr.ADD,Ict],[Rr.ALPHA,Dct],[Rr.AVERAGE,Oct],[Rr.COLOR_BURN,Lct],[Rr.COLOR_DODGE,kct],[Rr.DARKEN,Nct],[Rr.DIFFERENCE,Uct],[Rr.EXCLUSION,Bct],[Rr.LIGHTEN,Fct],[Rr.MULTIPLY,zct],[Rr.DIVIDE,jct],[Rr.NEGATION,Vct],[Rr.NORMAL,Hct],[Rr.OVERLAY,Gct],[Rr.REFLECT,Wct],[Rr.SCREEN,qct],[Rr.SOFT_LIGHT,Xct],[Rr.SUBTRACT,$ct]]),Kct=class extends Qa{constructor(t,e=1){super(),this.f=t,this.opacity=new xt(e)}getOpacity(){return this.opacity.value}setOpacity(t){this.opacity.value=t}get blendFunction(){return this.f}set blendFunction(t){this.f=t,this.dispatchEvent({type:"change"})}getBlendFunction(){return this.blendFunction}setBlendFunction(t){this.blendFunction=t}getShaderCode(){return Yct.get(this.blendFunction)}},qd={NONE:0,DEPTH:1,CONVOLUTION:2},hf=class extends Qa{constructor(t,e,{attributes:i=qd.NONE,blendFunction:r=Rr.SCREEN,defines:n=new Map,uniforms:s=new Map,extensions:a=null,vertexShader:o=null}={}){super(),this.name=t,this.renderer=null,this.attributes=i,this.fragmentShader=e,this.vertexShader=o,this.defines=n,this.uniforms=s,this.extensions=a,this.blendMode=new Kct(r),this.blendMode.addEventListener("change",l=>this.setChanged())}getName(){return this.name}setRenderer(t){this.renderer=t}getDefines(){return this.defines}getUniforms(){return this.uniforms}getExtensions(){return this.extensions}getBlendMode(){return this.blendMode}getAttributes(){return this.attributes}setAttributes(t){this.attributes=t,this.setChanged()}getFragmentShader(){return this.fragmentShader}setFragmentShader(t){this.fragmentShader=t,this.setChanged()}getVertexShader(){return this.vertexShader}setVertexShader(t){this.vertexShader=t,this.setChanged()}setChanged(){this.dispatchEvent({type:"change"})}setDepthTexture(t,e=em){}update(t,e,i){}setSize(t,e){}initialize(t,e,i){}dispose(){for(let t of Object.keys(this)){let e=this[t];if(e!==null&&typeof e=="object"&&typeof e.dispose=="function"){if(e instanceof ac||e===this.renderer)continue;this[t].dispose()}}}};function Gte(t,e,i){for(let r of e){let n="$1"+t+r.charAt(0).toUpperCase()+r.slice(1),s=new RegExp("([^\\.])(\\b"+r+"\\b)","g");for(let a of i.entries())a[1]!==null&&i.set(a[0],a[1].replace(s,n))}}function Zct(t,e,i,r,n,s,a){let o=new Map([["fragment",e.getFragmentShader()],["vertex",e.getVertexShader()]]),l=o.get("fragment")!==void 0&&/mainImage/.test(o.get("fragment")),c=o.get("fragment")!==void 0&&/mainUv/.test(o.get("fragment")),u=[],h=[],d=!1,f=!1;if(o.get("fragment")===void 0)console.error("Missing fragment shader",e);else if(c&&(a&qd.CONVOLUTION)!==0)console.error("Effects that transform UV coordinates are incompatible with convolution effects",e);else if(!l&&!c)console.error("The fragment shader contains neither a mainImage nor a mainUv function",e);else{let p=/(?:\w+\s+(\w+)\([\w\s,]*\)\s*{[^}]+})/g,g=iV.Section;if(c){let y=`	${t}MainUv(UV);
`;i.set(g.FRAGMENT_MAIN_UV,i.get(g.FRAGMENT_MAIN_UV)+y),d=!0}if(o.get("vertex")!==null&&/mainSupport/.test(o.get("vertex"))){let y=`	${t}MainSupport(`;y+=/mainSupport *\([\w\s]*?uv\s*?\)/.test(o.get("vertex"))?`vUv);
`:`);
`,i.set(g.VERTEX_MAIN_SUPPORT,i.get(g.VERTEX_MAIN_SUPPORT)+y),u=u.concat([...o.get("vertex").matchAll(/(?:varying\s+\w+\s+(\w*))/g)].map(b=>b[1])),h=h.concat(u).concat([...o.get("vertex").matchAll(p)].map(b=>b[1]))}h=h.concat([...o.get("fragment").matchAll(p)].map(y=>y[1])),h=h.concat([...e.defines.keys()].map(y=>y.replace(/\([\w\s,]*\)/g,""))),h=h.concat([...e.uniforms.keys()]),e.uniforms.forEach((y,b)=>s.set(t+b.charAt(0).toUpperCase()+b.slice(1),y)),e.defines.forEach((y,b)=>n.set(t+b.charAt(0).toUpperCase()+b.slice(1),y)),Gte(t,h,n),Gte(t,h,o);let m=e.blendMode;if(r.set(m.blendFunction,m),l){let y=/MainImage *\([\w\s,]*?depth[\w\s,]*?\)/,b=`${t}MainImage(color0, UV, `;(a&qd.DEPTH)!==0&&y.test(o.get("fragment"))&&(b+="depth, ",f=!0),b+=`color1);
	`;let w=t+"BlendOpacity";s.set(w,m.opacity),b+=`color0 = blend${m.blendFunction}(color0, color1, ${w});

	`,i.set(g.FRAGMENT_MAIN_IMAGE,i.get(g.FRAGMENT_MAIN_IMAGE)+b),b=`uniform float ${w};

`,i.set(g.FRAGMENT_HEAD,i.get(g.FRAGMENT_HEAD)+b)}i.set(g.FRAGMENT_HEAD,i.get(g.FRAGMENT_HEAD)+o.get("fragment")+`
`),o.get("vertex")!==null&&i.set(g.VERTEX_HEAD,i.get(g.VERTEX_HEAD)+o.get("vertex")+`
`)}return{varyings:u,transformedUv:d,readDepth:f}}var z3=class extends El{constructor(t,...e){super("EffectPass"),this.fullscreenMaterial=new iV(null,null,null,t),this.effects=e.sort((i,r)=>r.attributes-i.attributes),this.skipRendering=!1,this.uniformCount=0,this.varyingCount=0,this.minTime=1,this.maxTime=Number.POSITIVE_INFINITY}get encodeOutput(){return this.fullscreenMaterial.encodeOutput}set encodeOutput(t){this.fullscreenMaterial.encodeOutput=t}get dithering(){return this.fullscreenMaterial.dithering}set dithering(t){let e=this.fullscreenMaterial;e.dithering=t,e.needsUpdate=!0}verifyResources(){let t=this.renderer.capabilities,e=Math.min(t.maxFragmentUniforms,t.maxVertexUniforms);this.uniformCount>e&&console.warn("The current rendering context doesn't support more than "+e+" uniforms, but "+this.uniformCount+" were defined"),e=t.maxVaryings,this.varyingCount>e&&console.warn("The current rendering context doesn't support more than "+e+" varyings, but "+this.varyingCount+" were defined")}updateMaterial(){let t=iV.Section,e=new Map([[t.FRAGMENT_HEAD,""],[t.FRAGMENT_MAIN_UV,""],[t.FRAGMENT_MAIN_IMAGE,""],[t.VERTEX_HEAD,""],[t.VERTEX_MAIN_SUPPORT,""]]),i=new Map,r=new Map,n=new Map,s=new Set,a=0,o=0,l=0,c=!1,u=!1;for(let d of this.effects)if(d.blendMode.blendFunction===Rr.SKIP)l|=d.getAttributes()&qd.DEPTH;else if((l&d.getAttributes()&qd.CONVOLUTION)!==0)console.error("Convolution effects cannot be merged",d);else{l|=d.getAttributes();let f="e"+a++,p=Zct(f,d,e,i,r,n,l);if(o+=p.varyings.length,c=c||p.transformedUv,u=u||p.readDepth,d.extensions!==null)for(let g of d.extensions)s.add(g)}let h=/\bblend\b/g;for(let d of i.values()){let f=d.getShaderCode().replace(h,`blend${d.blendFunction}`);e.set(t.FRAGMENT_HEAD,e.get(t.FRAGMENT_HEAD)+f+`
`)}(l&qd.DEPTH)!==0?(u&&e.set(t.FRAGMENT_MAIN_IMAGE,`float depth = readDepth(UV);

	`+e.get(t.FRAGMENT_MAIN_IMAGE)),this.needsDepthTexture=this.getDepthTexture()===null):this.needsDepthTexture=!1,c?(e.set(t.FRAGMENT_MAIN_UV,`vec2 transformedUv = vUv;
`+e.get(t.FRAGMENT_MAIN_UV)),r.set("UV","transformedUv")):r.set("UV","vUv"),e.forEach((d,f,p)=>p.set(f,d.trim().replace(/^#/,`
#`))),this.uniformCount=n.size,this.varyingCount=o,this.skipRendering=a===0,this.needsSwap=!this.skipRendering,this.fullscreenMaterial.setShaderParts(e).setExtensions(s).setUniforms(n).setDefines(r)}recompile(){this.updateMaterial(),this.verifyResources()}getDepthTexture(){return this.fullscreenMaterial.depthBuffer}setDepthTexture(t,e=em){this.fullscreenMaterial.depthBuffer=t,this.fullscreenMaterial.depthPacking=e;for(let i of this.effects)i.setDepthTexture(t,e)}render(t,e,i,r,n){for(let s of this.effects)s.update(t,e,r);if(!this.skipRendering||this.renderToScreen){let s=this.fullscreenMaterial;s.inputBuffer=e.texture,s.time+=r,t.setRenderTarget(this.renderToScreen?null:i),t.render(this.scene,this.camera)}}setSize(t,e){this.fullscreenMaterial.setSize(t,e);for(let i of this.effects)i.setSize(t,e)}initialize(t,e,i){this.renderer=t;for(let r of this.effects)r.initialize(t,e,i),r.addEventListener("change",n=>this.handleEvent(n));this.updateMaterial(),this.verifyResources(),i!==void 0&&i!==Ho&&(this.fullscreenMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1")}dispose(){super.dispose();for(let t of this.effects)t.dispose()}handleEvent(t){switch(t.type){case"change":this.recompile();break}}},Qct=[new Float32Array([0,0]),new Float32Array([0,1,1]),new Float32Array([0,1,1,2]),new Float32Array([0,1,2,2,3]),new Float32Array([0,1,2,3,4,4,5]),new Float32Array([0,1,2,3,4,5,7,8,9,10])],v8=class extends El{constructor({resolutionScale:t=.5,width:e=rc.AUTO_SIZE,height:i=rc.AUTO_SIZE,kernelSize:r=RL.LARGE}={}){super("KawaseBlurPass"),this.renderTargetA=new Mr(1,1,{minFilter:nr,magFilter:nr,stencilBuffer:!1,depthBuffer:!1}),this.renderTargetA.texture.name="Blur.Target.A",this.renderTargetB=this.renderTargetA.clone(),this.renderTargetB.texture.name="Blur.Target.B";let n=this.resolution=new rc(this,e,i,t);n.addEventListener("change",s=>this.setSize(n.baseWidth,n.baseHeight)),this.blurMaterial=new jte,this.ditheredBlurMaterial=new jte,this.ditheredBlurMaterial.uniforms.scale=this.blurMaterial.uniforms.scale,this.ditheredBlurMaterial.dithering=!0,this.dithering=!1,this.kernelSize=r}getResolution(){return this.resolution}get width(){return this.resolution.width}set width(t){this.resolution.preferredWidth=t}get height(){return this.resolution.height}set height(t){this.resolution.preferredHeight=t}get scale(){return this.blurMaterial.scale}set scale(t){this.blurMaterial.scale=t}getScale(){return this.blurMaterial.scale}setScale(t){this.blurMaterial.scale=t}getKernelSize(){return this.kernelSize}setKernelSize(t){this.kernelSize=t}getResolutionScale(){return this.resolution.scale}setResolutionScale(t){this.resolution.scale=t}render(t,e,i,r,n){let s=this.scene,a=this.camera,o=this.renderTargetA,l=this.renderTargetB,c=Qct[this.kernelSize],u=this.blurMaterial,h=e,d,f;for(this.fullscreenMaterial=u,d=0,f=c.length-1;d<f;++d){let p=(d&1)===0?o:l;u.kernel=c[d],u.inputBuffer=h.texture,t.setRenderTarget(p),t.render(s,a),h=p}this.dithering&&(u=this.ditheredBlurMaterial,this.fullscreenMaterial=u),u.kernel=c[d],u.inputBuffer=h.texture,t.setRenderTarget(this.renderToScreen?null:i),t.render(s,a)}setSize(t,e){let i=this.resolution;i.setBaseSize(t,e);let r=i.width,n=i.height;this.renderTargetA.setSize(r,n),this.renderTargetB.setSize(r,n),this.blurMaterial.setSize(r,n),this.ditheredBlurMaterial.setSize(r,n)}initialize(t,e,i){i!==void 0&&(this.renderTargetA.texture.type=i,this.renderTargetB.texture.type=i,i!==Ho?(this.blurMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1",this.ditheredBlurMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1"):t.outputEncoding===er&&(this.renderTargetA.texture.encoding=er,this.renderTargetB.texture.encoding=er))}static get AUTO_SIZE(){return rc.AUTO_SIZE}},Jct=class extends El{constructor({width:t=rc.AUTO_SIZE,height:e=rc.AUTO_SIZE,renderTarget:i,luminanceRange:r,colorOutput:n}={}){super("LuminancePass"),this.fullscreenMaterial=new wct(n,r),this.needsSwap=!1,this.renderTarget=i,this.renderTarget===void 0&&(this.renderTarget=new Mr(1,1,{minFilter:nr,magFilter:nr,stencilBuffer:!1,depthBuffer:!1}),this.renderTarget.texture.name="LuminancePass.Target",this.renderTarget.texture.generateMipmaps=!1);let s=this.resolution=new rc(this,t,e);s.addEventListener("change",a=>this.setSize(s.baseWidth,s.baseHeight))}get texture(){return this.renderTarget.texture}getTexture(){return this.renderTarget.texture}getResolution(){return this.resolution}render(t,e,i,r,n){let s=this.fullscreenMaterial;s.inputBuffer=e.texture,t.setRenderTarget(this.renderToScreen?null:this.renderTarget),t.render(this.scene,this.camera)}setSize(t,e){let i=this.resolution;i.setBaseSize(t,e),this.renderTarget.setSize(i.width,i.height)}initialize(t,e,i){i!==void 0&&i!==Ho&&(this.fullscreenMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1")}},eut=class extends El{constructor(t,e){super("MaskPass",t,e),this.needsSwap=!1,this.clearPass=new g8(!1,!1,!0),this.inverse=!1}get inverted(){return this.inverse}set inverted(t){this.inverse=t}get clear(){return this.clearPass.enabled}set clear(t){this.clearPass.enabled=t}getClearPass(){return this.clearPass}isInverted(){return this.inverted}setInverted(t){this.inverted=t}render(t,e,i,r,n){let s=t.getContext(),a=t.state.buffers,o=this.scene,l=this.camera,c=this.clearPass,u=this.inverted?0:1,h=1-u;a.color.setMask(!1),a.depth.setMask(!1),a.color.setLocked(!0),a.depth.setLocked(!0),a.stencil.setTest(!0),a.stencil.setOp(s.REPLACE,s.REPLACE,s.REPLACE),a.stencil.setFunc(s.ALWAYS,u,4294967295),a.stencil.setClear(h),a.stencil.setLocked(!0),this.clearPass.enabled&&(this.renderToScreen?c.render(t,null):(c.render(t,e),c.render(t,i))),this.renderToScreen?(t.setRenderTarget(null),t.render(o,l)):(t.setRenderTarget(e),t.render(o,l),t.setRenderTarget(i),t.render(o,l)),a.color.setLocked(!1),a.depth.setLocked(!1),a.stencil.setLocked(!1),a.stencil.setFunc(s.EQUAL,1,4294967295),a.stencil.setOp(s.KEEP,s.KEEP,s.KEEP),a.stencil.setLocked(!0)}},fu=class extends El{constructor(t,e="inputBuffer"){super("ShaderPass"),this.fullscreenMaterial=t,this.inputBufferUniform=null,this.setInput(e)}setInput(t){if(this.inputBufferUniform=null,this.fullscreenMaterial!==null){let e=this.fullscreenMaterial.uniforms;e!==void 0&&e[t]!==void 0&&(this.inputBufferUniform=e[t])}}render(t,e,i,r,n){this.inputBufferUniform!==null&&e!==null&&(this.inputBufferUniform.value=e.texture),t.setRenderTarget(this.renderToScreen?null:i),t.render(this.scene,this.camera)}initialize(t,e,i){i!==void 0&&i!==Ho&&(this.fullscreenMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1")}},n4=1/1e3,tut=1e3,iut=class{constructor(){this.previousTime=0,this.currentTime=0,this.delta=0,this.fixedDelta=1e3/60,this.elapsed=0,this.timescale=1,this.fixedDeltaEnabled=!1,this.autoReset=!1}setFixedDeltaEnabled(t){return this.fixedDeltaEnabled=t,this}isAutoResetEnabled(t){return this.autoReset}setAutoResetEnabled(t){return typeof document<"u"&&document.hidden!==void 0&&(t?document.addEventListener("visibilitychange",this):document.removeEventListener("visibilitychange",this),this.autoReset=t),this}getDelta(){return this.delta*n4}getFixedDelta(){return this.fixedDelta*n4}setFixedDelta(t){return this.fixedDelta=t*tut,this}getElapsed(){return this.elapsed*n4}getTimescale(){return this.timescale}setTimescale(t){return this.timescale=t,this}update(t){return this.fixedDeltaEnabled?this.delta=this.fixedDelta:(this.previousTime=this.currentTime,this.currentTime=t!==void 0?t:performance.now(),this.delta=this.currentTime-this.previousTime),this.delta*=this.timescale,this.elapsed+=this.delta,this}reset(){return this.delta=0,this.elapsed=0,this.currentTime=performance.now(),this}handleEvent(t){document.hidden||(this.currentTime=performance.now())}dispose(){this.setAutoResetEnabled(!1)}},RL={MEDIUM:2,LARGE:3,HUGE:5},rut=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D map;
#else
uniform lowp sampler2D map;
#endif
uniform float intensity;void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){outputColor=clamp(texture2D(map,uv)*intensity,0.0,1.0);}`,nut=class extends hf{constructor({blendFunction:t=Rr.SCREEN,luminanceThreshold:e=.9,luminanceSmoothing:i=.025,resolutionScale:r=.5,intensity:n=1,width:s=rc.AUTO_SIZE,height:a=rc.AUTO_SIZE,kernelSize:o=RL.LARGE}={}){super("BloomEffect",rut,{blendFunction:t,uniforms:new Map([["map",new xt(null)],["intensity",new xt(n)]])}),this.renderTarget=new Mr(1,1,{minFilter:nr,magFilter:nr,stencilBuffer:!1,depthBuffer:!1}),this.renderTarget.texture.name="Bloom.Target",this.renderTarget.texture.generateMipmaps=!1,this.uniforms.get("map").value=this.renderTarget.texture,this.luminancePass=new Jct({renderTarget:this.renderTarget,colorOutput:!0}),this.luminanceMaterial.threshold=e,this.luminanceMaterial.smoothingFactor=i,this.blurPass=new v8({resolutionScale:r,width:s,height:a,kernelSize:o});let l=this.blurPass.getResolution();l.addEventListener("change",c=>this.setSize(l.baseWidth,l.baseHeight))}get texture(){return this.renderTarget.texture}getTexture(){return this.renderTarget.texture}get resolution(){return this.blurPass.resolution}getResolution(){return this.blurPass.resolution}getBlurPass(){return this.blurPass}getLuminancePass(){return this.luminancePass}get luminanceMaterial(){return this.luminancePass.fullscreenMaterial}getLuminanceMaterial(){return this.luminancePass.fullscreenMaterial}get width(){return this.resolution.width}set width(t){this.resolution.preferredWidth=t}get height(){return this.resolution.height}set height(t){this.resolution.preferredHeight=t}get dithering(){return this.blurPass.dithering}set dithering(t){this.blurPass.dithering=t}get kernelSize(){return this.blurPass.kernelSize}set kernelSize(t){this.blurPass.kernelSize=t}get distinction(){return console.warn(this.name,"distinction was removed"),1}set distinction(t){console.warn(this.name,"distinction was removed")}get intensity(){return this.uniforms.get("intensity").value}set intensity(t){this.uniforms.get("intensity").value=t}getIntensity(){return this.intensity}setIntensity(t){this.intensity=t}getResolutionScale(){return this.resolution.scale}setResolutionScale(t){this.resolution.scale=t}update(t,e,i){let r=this.renderTarget;this.luminancePass.enabled?(this.luminancePass.render(t,e,r),this.blurPass.render(t,r,r)):this.blurPass.render(t,e,r)}setSize(t,e){let i=this.resolution;i.setBaseSize(t,e),this.renderTarget.setSize(i.width,i.height),this.luminancePass.resolution.copy(i)}initialize(t,e,i){this.blurPass.initialize(t,e,i),i!==void 0&&(this.renderTarget.texture.type=i,t.outputEncoding===er&&(this.renderTarget.texture.encoding=er))}},sut="uniform float brightness;uniform float contrast;void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){vec3 color=inputColor.rgb+vec3(brightness-0.5);if(contrast>0.0){color/=vec3(1.0-contrast);}else{color*=vec3(1.0+contrast);}outputColor=vec4(min(color+vec3(0.5),1.0),inputColor.a);}",aut=class extends hf{constructor({blendFunction:t=Rr.NORMAL,brightness:e=0,contrast:i=0}={}){super("BrightnessContrastEffect",sut,{blendFunction:t,uniforms:new Map([["brightness",new xt(e)],["contrast",new xt(i)]])})}get brightness(){return this.uniforms.get("brightness").value}set brightness(t){this.uniforms.get("brightness").value=t}getBrightness(t){return this.brightness}setBrightness(t){this.brightness=t}get contrast(){return this.uniforms.get("contrast").value}set contrast(t){this.uniforms.get("contrast").value=t}getContrast(t){return this.contrast}setContrast(t){this.contrast=t}},out="void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){outputColor=vec4(vec3(average(inputColor.rgb)),inputColor.a);}",lut=class extends hf{constructor(t=Rr.NORMAL){super("ColorAverageEffect",out,{blendFunction:t})}},cut="varying vec2 vUvR;varying vec2 vUvB;void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){vec2 ra=texture2D(inputBuffer,vUvR).ra;vec2 ba=texture2D(inputBuffer,vUvB).ba;outputColor=vec4(ra.x,inputColor.g,ba.x,max(max(ra.y,ba.y),inputColor.a));}",uut="uniform vec2 offset;varying vec2 vUvR;varying vec2 vUvB;void mainSupport(const in vec2 uv){vec2 shift=offset*vec2(1.0,aspect);vUvR=uv+shift;vUvB=uv-shift;}",hut=class extends hf{constructor({blendFunction:t=Rr.NORMAL,offset:e=new Ae(.001,5e-4)}={}){super("ChromaticAberrationEffect",cut,{vertexShader:uut,blendFunction:t,attributes:qd.CONVOLUTION,uniforms:new Map([["offset",new xt(e)]])})}get offset(){return this.uniforms.get("offset").value}set offset(t){this.uniforms.get("offset").value=t}getOffset(){return this.offset}setOffset(t){this.offset=t}},dut=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D nearColorBuffer;uniform mediump sampler2D farColorBuffer;
#else
uniform lowp sampler2D nearColorBuffer;uniform lowp sampler2D farColorBuffer;
#endif
uniform lowp sampler2D nearCoCBuffer;uniform float scale;void mainImage(const in vec4 inputColor,const in vec2 uv,const in float depth,out vec4 outputColor){vec4 colorNear=texture2D(nearColorBuffer,uv);vec4 colorFar=texture2D(farColorBuffer,uv);float CoCNear=texture2D(nearCoCBuffer,uv).r;CoCNear=min(CoCNear*scale,1.0);vec4 result=inputColor*(1.0-colorFar.a)+colorFar;result=mix(result,colorNear,CoCNear);outputColor=result;}`,fut=class extends hf{constructor(t,{blendFunction:e=Rr.NORMAL,worldFocusDistance:i,worldFocusRange:r,focusDistance:n=0,focalLength:s=.1,focusRange:a=s,bokehScale:o=1,width:l=rc.AUTO_SIZE,height:c=rc.AUTO_SIZE}={}){super("DepthOfFieldEffect",dut,{blendFunction:e,attributes:qd.DEPTH,uniforms:new Map([["nearColorBuffer",new xt(null)],["farColorBuffer",new xt(null)],["nearCoCBuffer",new xt(null)],["scale",new xt(1)]])}),this.camera=t,this.renderTarget=new Mr(1,1,{minFilter:nr,magFilter:nr,stencilBuffer:!1,depthBuffer:!1}),this.renderTarget.texture.name="DoF.Intermediate",this.renderTarget.texture.generateMipmaps=!1,this.renderTargetMasked=this.renderTarget.clone(),this.renderTargetMasked.texture.name="DoF.Masked.Far",this.renderTargetNear=this.renderTarget.clone(),this.renderTargetNear.texture.name="DoF.Bokeh.Near",this.uniforms.get("nearColorBuffer").value=this.renderTargetNear.texture,this.renderTargetFar=this.renderTarget.clone(),this.renderTargetFar.texture.name="DoF.Bokeh.Far",this.uniforms.get("farColorBuffer").value=this.renderTargetFar.texture,this.renderTargetCoC=this.renderTarget.clone(),this.renderTargetCoC.texture.name="DoF.CoC",this.renderTargetCoCBlurred=this.renderTargetCoC.clone(),this.renderTargetCoCBlurred.texture.name="DoF.CoC.Blurred",this.uniforms.get("nearCoCBuffer").value=this.renderTargetCoCBlurred.texture,this.cocPass=new fu(new cct(t));let u=this.cocMaterial;u.focusDistance=n,u.focusRange=a,i!==void 0&&(u.worldFocusDistance=i),r!==void 0&&(u.worldFocusRange=r),this.blurPass=new v8({kernelSize:RL.MEDIUM,width:l,height:c});let h=this.blurPass.getResolution();h.addEventListener("change",f=>this.setSize(h.getBaseWidth(),h.getBaseHeight())),this.maskPass=new fu(new Sct(this.renderTargetCoC.texture));let d=this.maskPass.fullscreenMaterial;d.maskFunction=rme.MULTIPLY,d.colorChannel=ime.GREEN,this.bokehNearBasePass=new fu(new AR(!1,!0)),this.bokehNearBasePass.fullscreenMaterial.cocBuffer=this.renderTargetCoCBlurred.texture,this.bokehNearFillPass=new fu(new AR(!0,!0)),this.bokehNearFillPass.fullscreenMaterial.cocBuffer=this.renderTargetCoCBlurred.texture,this.bokehFarBasePass=new fu(new AR(!1,!1)),this.bokehFarBasePass.fullscreenMaterial.cocBuffer=this.renderTargetCoC.texture,this.bokehFarFillPass=new fu(new AR(!0,!1)),this.bokehFarFillPass.fullscreenMaterial.cocBuffer=this.renderTargetCoC.texture,this.target=null,this.bokehScale=o}get cocTexture(){return this.renderTargetCoC.texture}get cocMaterial(){return this.cocPass.fullscreenMaterial}get circleOfConfusionMaterial(){return this.cocMaterial}getCircleOfConfusionMaterial(){return this.circleOfConfusionMaterial}getBlurPass(){return this.blurPass}get resolution(){return this.blurPass.getResolution()}getResolution(){return this.blurPass.getResolution()}get bokehScale(){return this.uniforms.get("scale").value}set bokehScale(t){let e=[this.bokehNearBasePass,this.bokehNearFillPass,this.bokehFarBasePass,this.bokehFarFillPass];for(let i of e)i.fullscreenMaterial.setScale(t);this.maskPass.fullscreenMaterial.setStrength(t),this.uniforms.get("scale").value=t}getBokehScale(){return this.bokehScale}setBokehScale(t){this.bokehScale=t}getTarget(){return this.target}setTarget(t){this.target=t}calculateFocusDistance(t){let e=this.camera,i=e.position.distanceTo(t);return tV(-i,e.near,e.far)}setDepthTexture(t,e=em){this.circleOfConfusionMaterial.depthBuffer=t,this.circleOfConfusionMaterial.depthPacking=e}update(t,e,i){let r=this.renderTarget,n=this.renderTargetCoC,s=this.renderTargetCoCBlurred,a=this.renderTargetMasked;if(this.target!==null){let o=this.calculateFocusDistance(this.target);this.circleOfConfusionMaterial.focusDistance=o}this.cocPass.render(t,null,n),this.blurPass.render(t,n,s),this.maskPass.render(t,e,a),this.bokehFarBasePass.render(t,a,r),this.bokehFarFillPass.render(t,r,this.renderTargetFar),this.bokehNearBasePass.render(t,e,r),this.bokehNearFillPass.render(t,r,this.renderTargetNear)}setSize(t,e){let i=this.resolution;i.setBaseSize(t,e);let r=i.width,n=i.height,s=[this.cocPass,this.blurPass,this.maskPass,this.bokehNearBasePass,this.bokehNearFillPass,this.bokehFarBasePass,this.bokehFarFillPass];s.push(this.renderTargetCoC,this.renderTargetMasked),s.forEach(a=>a.setSize(t,e)),s=[this.renderTarget,this.renderTargetNear,this.renderTargetFar,this.renderTargetCoCBlurred],s.forEach(a=>a.setSize(r,n)),[this.bokehNearBasePass,this.bokehNearFillPass,this.bokehFarBasePass,this.bokehFarFillPass].forEach(a=>a.fullscreenMaterial.setSize(r,n))}initialize(t,e,i){[this.cocPass,this.maskPass,this.bokehNearBasePass,this.bokehNearFillPass,this.bokehFarBasePass,this.bokehFarFillPass].forEach(r=>r.initialize(t,e,i)),this.blurPass.initialize(t,e,Ho),i!==void 0&&(this.renderTarget.texture.type=i,this.renderTargetNear.texture.type=i,this.renderTargetFar.texture.type=i,this.renderTargetMasked.texture.type=i,t.outputEncoding===er&&(this.renderTarget.texture.encoding=er,this.renderTargetNear.texture.encoding=er,this.renderTargetFar.texture.encoding=er,this.renderTargetMasked.texture.encoding=er))}};new W;new St;var put="uniform vec3 hue;uniform float saturation;void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){vec3 color=vec3(dot(inputColor.rgb,hue.xyz),dot(inputColor.rgb,hue.zxy),dot(inputColor.rgb,hue.yzx));float average=(color.r+color.g+color.b)/3.0;vec3 diff=average-color;if(saturation>0.0){color+=diff*(1.0-1.0/(1.001-saturation));}else{color+=diff*-saturation;}outputColor=vec4(min(color,1.0),inputColor.a);}",mut=class extends hf{constructor({blendFunction:t=Rr.NORMAL,hue:e=0,saturation:i=0}={}){super("HueSaturationEffect",put,{blendFunction:t,uniforms:new Map([["hue",new xt(new W)],["saturation",new xt(i)]])}),this.hue=e}get saturation(){return this.uniforms.get("saturation").value}set saturation(t){this.uniforms.get("saturation").value=t}getSaturation(){return this.saturation}setSaturation(t){this.saturation=t}get hue(){let t=this.uniforms.get("hue").value;return Math.acos((t.x*3-1)/2)}set hue(t){let e=Math.sin(t),i=Math.cos(t);this.uniforms.get("hue").value.set((2*i+1)/3,(-Math.sqrt(3)*e-i+1)/3,(Math.sqrt(3)*e-i+1)/3)}getHue(){return this.hue}setHue(t){this.hue=t}};new Ai;var gut=`void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){vec3 noise=vec3(rand(uv*time));
#ifdef PREMULTIPLY
outputColor=vec4(min(inputColor.rgb*noise,vec3(1.0)),inputColor.a);
#else
outputColor=vec4(noise,inputColor.a);
#endif
}`,vut=class extends hf{constructor({blendFunction:t=Rr.SCREEN,premultiply:e=!1}={}){super("NoiseEffect",gut,{blendFunction:t}),this.premultiply=e}get premultiply(){return this.defines.has("PREMULTIPLY")}set premultiply(t){this.premultiply!==t&&(t?this.defines.set("PREMULTIPLY","1"):this.defines.delete("PREMULTIPLY"),this.setChanged())}isPremultiplied(){return this.premultiply}setPremultiplied(t){this.premultiply=t}},yut="uniform bool active;uniform vec2 d;void mainUv(inout vec2 uv){if(active){uv=vec2(d.x*(floor(uv.x/d.x)+0.5),d.y*(floor(uv.y/d.y)+0.5));}}",xut=class extends hf{constructor(t=30){super("PixelationEffect",yut,{uniforms:new Map([["active",new xt(!1)],["d",new xt(new Ae)]])}),this.resolution=new Ae,this.d=0,this.granularity=t}get granularity(){return this.d}set granularity(t){let e=Math.floor(t);e%2>0&&(e+=1),this.d=e,this.uniforms.get("active").value=e>0,this.setSize(this.resolution.width,this.resolution.height)}getGranularity(){return this.granularity}setGranularity(t){this.granularity=t}setSize(t,e){this.resolution.set(t,e),this.uniforms.get("d").value.setScalar(this.d).divide(this.resolution)}};new W;new W;var Wte="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAAAQCAYAAACm53kpAAAAeElEQVRYR+2XSwqAMAxEJ168ePEqwRSKhIIiuHjJqiU0gWE+1CQdApcVAMUAuARaMGCX1MIL/Ow13++9lW2s3mW9MWvsnWc/2fvGygwPAN4E8QzAA4CXAB6AHjG4JTHYI1ey3pcx6FHnEfhLDOIBKAmUBK6/ANUDTlROXAHd9EC1AAAAAElFTkSuQmCC",qte="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAKAAAAIwCAYAAAABNmBHAAAgAElEQVR4Xuy9CbhlV1ktOvbpq09DkiIkUBI6kxASIH0DlAQiIK1wRfSJTx+i4JX7vKIigs8HXpXvqVcvrcC9agQ7IDTSSWgqCQQliDRBJKkkhDSkqVPNqVOnP+8b//rH3P+eZ+199tlznVTlvVrft7+1T7OaueZY42/m37QALKNk2wHg1pITlB17mC+Pp11W3X/LHyT32vhg48/5SOv+PnwpsHA70JoGlueB1iKApeqzvOzn44GatTB76Xzhd7suBR7+WWADgDEAwwCG/L54b/poDLrHuvvm70Z2Avhsc+PVcxscBU8F8C8ADg5+ipIjD/PlGwfgju8B924E5seARUfLsiNmqQW0IjL8+7L2NYD/7COBzfcCm+aB8SVgdAkYIRCXKyDax4EdAanL5PuNPllNvXDlAHwFgP8AcC2AhRIoDXbsYb48dl5WkVFTE3LGDcC9m4CZCWBuFFgeAZaGAYJQQCRqDHT+McJrVb8zwATUXH02MHYfMHEIGFsAxgjApQqACYQORjtd/B7Axt/z79sC0+cMPgjjlwPwVwHcA+DfAHzTxcVgWBroqMN8+cYBeM71wH0TwKExYHYUWCIAHYRLTlkCYgcIBcAgU/n3qy8GRu4HRgnAOWBkERhddPAJhGJDBxkvw7cqimr+zFM/ZLnZF64cgL8BYD+AWwB8x/dlWuWagHiYL984AJ/0RWBy1AE4AizyM1yxYAcTigW55xMbAkxEiwEdkJ/ZCQxPAiOHgBECcKEC4TBZcKkSv+mTieNcNPNC26mLNsj45QD8LQDTAO4GcJt/7iw2bfoG4WG+vAGwm9ExiEg69zpg/wgwPQLMjgALzn4E4aIzoJjQ9g4024uygkj+pyuAoX0VAIfngOH5NgCHMhAm8Sv2y3XDZeBhNIp8OzJE8OsBzAKYBHAXgDt8/4O+MVT0j4f58o0D8Pxrgf3DwMwIMEPQEYRkNwfgsuuDZLskip0No0gWMD/9HGDoADAkAC4Aw/wsAgZAgs2Z0ABI0GU6IVmKv+f28KDnHxkA/G0A8y6G73N9kOCjXnh/Ebb6OvgwX75xAF5wLTA1VIHPADgMLDj4yIA5AAm6aCUnv4oz46eeDwxNAUMzwJAz4BABSNDFTwSfg7DDKHE23MG5PqIY8A1u/dINs9dBdy8AgnGPM2NfUBrsnw7z5RsH4IXXAAcJviFgluAbygBINnSLWOAjGxJ4pgOKDV0v/OSLKp8iGXBovhLBBOCQM2ACoTOhnYrAdItYbCij5JFzRyIAqRccAnDAQUjg6UNQ7hsMXP0cRQAexss3DsCLCECCLwCQzMcPwUi2MwAScAKbfnY/YRLFQ8DHX+IAJAMSfDkAF13kLvleIjhjQQHxUVS3jjgGpKeeNzYVQEjgUS8k+PghONdhIwAP4+XXBYCHKIJbwJyDTgaIAdCBJx3Q2M8tYAHP9m4df/ylQOsQ0JqtRLCx30K1wtLBggScQOgsKBGcWHAJeOwRC0BSM1mQIKRbhh+Bj98JQP6t4U0APEyXXxcAEnxkQAFwoVUxID9kvQg+c1C7vidRbIDkc24B//hTQGumDcCWA5DgMxASdNIFBUI5pCML8v8API5zfEQx4BudgqiczviSnJhQwCP4BMCGl+wO8+U7AJi/W4O4YS6+pmK/2ciADsAOBhTIIiAJnPB7AvNjP+0AnANaYkAHX2JBAc+tYaJXOqBZv24Vc386XW5dtkHGW+4HFAJonpOe+YYQZAShgKjv3PNvPQaxVoI8zJdfFwASfPzMUwS3Kt1v0UFIlos6oDFdAGFcliMAP/ryAEAGNwQRnDOgLbdlIEwrIs6AZ/QgkMMHQF6ZAKQcJAsSYPwIeAIk9wJgoPK1gi7+PwF4GC/fOAAvIQPSs0URTPBJ/Pp3GSEGRHfBCIQ0xowBtUbcAj7ys5X4Jfu1HIAGQrIgQRXEsAFQIORDFhiDY/rMHmrU4QUgR08AkgUjCAW6CD6CkwBsAIQC4GG6fPMA3OXiNzCg2I9gNCMksmAAoemDzoimFwL48M85AKkiuQVMAAp8CYRRDAt8GQiJ67N6GJODAXAHlsGguscA2AJg1IPGYmxOpBxFWkRN9LsATgIwXnNs/v/5z/9XCf8BO3YAtxbc/46/KDt+5+ea1Yku2VUxHz/z0v24FwMGK1gWsK2OUUxHHdCBeRUB6OxHABr4ZICIBd0QWSF+XRdMTAjgCdTrG9cBNwE4F8CpDkICyYLGsuhFt6zs+gISwUen8zEAjgMw4cfx2H6O/90yAFo84Cbg4ID3/9TfLTt+5+ebnRABkODjx0SwPi5ec/FrYpmqSAxM8Dn60CsqAFI6GfhqAMiDE/gokmvEr0C4PgDkBQm40wE8zMFEUDKEVoxIMLl/KS73mE7H9d+vcKHQQcjwW0Yu9nP8m8sAmOIBuWY6wP2/4s0ezjjg8TuvaR6ABJ70vxUApGrm7EbGE+i472BAB+WHfqHS/eoAaEwY2E9+wLSXTqhI7CXgnB6LCoOJ4BiST+hTnG0HcCwAglCx3ARoZEVFXnBPp/O/A/hXACc7CPs9/i1lAOyIB+RDX+P9/+pbQjjjAMfv/PL6AFDs1wFAgs/9fgKfgdE/ZEpuiQlbwAde6QAMBgiRmsSwA9BY0JfjovGRDBMH4TlcXGhcBOc6HkF0gjPhZgchxTLZMAci/04W/B6Ab3t09EPXcPyflgFwRTwgJ2MN9/8bf5qFM67x+B/aW4XQz42FeL0YrRyikztUFw0704mf9kXgxhOAqc3AAsPyRxxQCs/PdXOFY0W1KHy3QIUGtx+6vdnx1vsB+dsTncm2AogglFgVEAlUWrOMB2RyEmMCGQ/Y7/HvKns6tfGAnJQ+r/9b76oJZ1zD8WdyQjYBh8aBhVEHjELouQ8ukQ7VRSCJAALwkr+sALhnGzDD3JAJYJHg9uhoi4bx8ytkWUtvHT/7+Zc4dw1uZ3612fH2dkQf7yxIEEockwkJQn4IQoq8unhAhmPRKKFx0uv4K8ueTs94wD7u//VX9ghn7OP4c+4G7h8HpseB+dF2AKlFLwuAIZ8jD6NPrOhAffmfA9/ZBuzZCkyRWSeqBCWyoYGQ5yQrBpDbum/ME1HoPo0XEkSD2zlfbna8q6+EUJcTCxKEtHL5EQjP6BEPyIgYAZBvYt3xHyx7OqvGA65y/7/9wVXCGVc5/sl7qxD66dEqiYgRzAqhN1A4CBNAAlDyAFI+iZ9/N3DLJuC+jcDUBmCWyUnOrmTYCMIOkNclLg0B8/RsNLg9+UvNjnd1APLmmQpFHyEBROuWACQT8nN+H/GAvY7/VNnT6SsesMf13/CpahGnZzhjj+PPmwX2MYdDIfQexWyBAwEUOQDrRDN/98p3A7dvAO6fAA5sqHJDBEAyoUVGkwEd6HR12XU4kwzfl6fCXTZzjy57vvnR513X7Hj7AyDvggAUi9EyFgiZqNxPQF6345nOWbD1HQ/Y5fpvuLa/2+82/vNHgAPDFQDnhoF5j2C2qBWCI8bw1eRw5CL5l94L3DEOTI4DB8Y9OWmsEu/zBJ3rgsaybqBob/7A4C7jtWcooRrczr+u2fH2D0AOQgAUCxKEP7aGgLy64+m6KdjWFA9Yc/03/Osa4glrjr+AupqHz1sEs0cxG0BC9HIePLoit9eNkVf9L+DuUWByDJgaq4ybGYLPAWgiXmLedUE7dwC7saL7CqfPKXi4NYdaykCD410bAHlDEsNiwZ9wAPYbkJcfz6T2gm3N8YDZ9d/wHxUA+739fPwXPrSKYGb+BuP3jAFDElFH9HIWwbzCIGkBr/or4J4RYO8oMOW6ZVcAuvi1Cgoha04BCwT5gfMKHm7NoRde2+x41w5A3hQZkADk5+cGiAeMx3+/7AENFA8Yrv/G71cAXFM4Yzj+otOAaQLQA0gZxaIIZtMDFTigKJV8H9Iq6aZ59ZXAvSPAvpEKgBTtBODcSCWCZeRYtpzrmLyeGNCAyFl1v+Hei8qeb370Rdc2O97BAMi7EgB/2QG41nhAHU9LuWAbOB7Qr//GPRUA13r7Gv9FZwIMoVcEswEwfDoimEP0shKKtIphaZQAXv1+YM+wA3DEdcvRKkGJADQQEsQuhi1Tjt95vBsh5nx2IO59SsHDrTmUOStNjndwAAqEry0IyCMICkOyiuIBNwBvPFQQT7gBuPjc9oRYAIHyOEL4vIFEYVNaOou5vCGE/tV/A0wOVcnpzI47NOri3QFIBpSeaSDUdYLOSWvYImSGgftpJDa4MWJbAGxivGUA5MAOc0Be6eVLj7/4Mk+hzCOYPYpZDBiNkLh+G/M3yFyv/ltgL3W3YQfgcFUhgRY2PwY+Z7/EhAR1SFyXCOb57r28QfQBsJQBMn5D4y0HYLPje9Cd7RIC0PM3EiMofF4gVCBp1P840ix/gyz56r+vAMjk9Gl375iB4+CzveuZdLkkEPJ8ZEfX/6R73vOjzT5Si9hucLxHAVg4PwJgRwh9CKOXK8YA4ZEqKZXSQWh5P+5AftXfA/uGKvYjCKn72cctbFrZNECka5L5CPwIPtMH3TVz17MLB5gdLgA2Nd6jACycHwLQxFEUSR5ASvARDB0h9AQb9bXIgCGk6lUfAPYTgEPAITKgg1BObk58srTJgG58WMkWMaAbQQT1nc8rHGANAJsc71EAFs4PAagQestgC1lsBJ4BMCSOK6dDUcwqqaFiQr/0QeAAAdjy+jBiQQeeMSBZT3nCPUDIa9z+/MIB1gCwyfEeBWDh/BCAeQSzgkjFfGLBBD5nxQ4DxN0wv3hVxX5TBGDwL5obxvVA5YqYL5BeMLd66YYxJpRB0gK+96LCAdYAsMnxHgVg4fwIgMrhUPKQ2C+Bz0PmBTqBMQehAbDlIjj4F80KJguSVZ0FuXpjoCOgXawLjALhbT9eOMAuAGxqvEcBWDg/l1IE05Ed0ygZnyHdz0VwCqEPIfNyx0QQvvLDFQCp+8nfZk5und8tXwIgWcHSNX0N2CJmnAl3v6RwgNnhl17T7HiPArBwfghAS7mV/hey2JS9FvM3BLpUUi1YwDRMXvkRYJoAlAh2l0dcZ04s6JUTDIjyBcrl4yDc/dLCAdYAsMnxHgVg4fxwKVwJgGEJNmWtxpQMpX9on2eRhVA+O56AjMfnP+e3Xvf3NwG4xIPTleiY55bpGh6UbafNU0l0z0p+5Jh5HqYJ6b51nP6XP8cx12XNHQVgIQB/bFPVg2OC7Q+WgVFWng/FvtWLI06uWh5oguKEcXVS/9sEAF//VGD7t4ETDgJbF4CNi8CGZWBs2fPL/H6Vwp2KEtVk4fJ+v/EIYPN9wKa5qu+IncfPwXHVZe/aOL3EbwS7xv8A1rQvnO0j8PArTgTGZ4BxFv9mIxhOCGsv+0OPYDRghcLfkWkEuq0+G00x4OtfDGz+d2DbHmDLjL8si8AYP/7CGIAiEEMTG92zXqSbH+d9R2aA0XnvO+JjthiIrOVDHHPOkBrzUQAWAPsZp3oPDpa/Xag6EVkLBK+5rAnJC3/nYk/APD704WiEAV8OTHwX2LQH2DgFbJgFNrBhjd8r79deGoEwsllgNBOzy8CdjweG9wBj08AIAci2D6HafmyAk4/Z7SJ72hGYRwFYAMDLTwOGp4FRFgD3HhzqRGQiyeurqOdG6r0Rm8IEZjzRlkiqCWoEgK8Axm4BJu4HJhyAbFhDxmbDGnZO4j0SgLGDkpibgEq66TJw/1nA0F5gdLpq+zDqFfd5LMeWqu5HNST0uJOIllg+qgMWgI+HPv0xwLA3gWHpW2sC441gCECbmKziaGrnUdMO4aHeh6MxAP4SMHI7ML4HGD8AjHvHJGNAgpDgY/ck3stipRemvVhc+uASMPUEYGh/9dIRgGx8Y+MNbR/00uVtH0wEx94j/v0oAxaA8Ed+GBieAYZZg5kADC0QWGOFzGJlcGPzl1BxNLXD8sk4xftwNAbA/wwM3wGMUmxOOQBnHXzetIYvibonmSiuYTNjriVg7glAiwBk0fNZH6+PmX9P6kfNmCXGpftJ7TgKwBIAnln14BAAYxMYm5C6RjCyCoOyr0qkD/c+HI0B8DXA8N3AyCQwesD1VQKH7EcASm1Q+y4CkN9pUKiVF5nLvy+fBbTUd8QBaH1HvNBROiZvfsNnrF4kcvPwpdsBLBeU18Nf7AB23Dp4ecHC8oBgUlJJecLS+7+WOpE3gbE+HKw+yoevCYkMGKqPJrdEKARutaFYRs1fiEZ0wP8CDN8LDO8FRqYq3W10pgKgfYLaYCzootgA6KXaTA90y374TKB1sBozy77xHFZ536utRgAmEaw6g5kUSFZwSXnA330qsOlfgHMPDlZesLA8IOjoLypPWHj/11EnCiVwkz7kAExtsGraYUWdSDX5TmsagL8KDBGA7Bd30JsW0oWivnEOQNP7yGTSBR101AlZSUtGyfgZDkCWY1HnJdcBVe6325hTvelg2CQjZNDygG/2An0j1wKnL6y9vGBheUC8prQ8YeH9X39OVQSc7Mc6fCaKvAeHdCIVf4yMYCynTpX+nb97NJmlSQb8r8DQHm9YOFUZTKOzoXGhs6AxF0HIexcLBvWBuiHN8s2ne98R3qc6L4Vyb2oBVjfm9MIFHbjDCh6kPOBbQoG+oW8CO5bWVl6wsDwgfr20PGHh/X/1iaEIuDcCTIW/1Q4rFv8OnYiW3c+W2iKwUjKbyjQNwL1uuR6sAEgDgq1brXOmV81PxhNB6DUDBSYzQJwFtz623XcktX1Q1VWKaTF/zZhVazBVYA1tX5MazsGvobwe/jQr0Ne6BTh5uf/ygoXlAfG60vKEhff/rSe1i4DnTWDUACY1guFTDqLYdCBvf6DJYSMYATBfOx1kLfj1v1axH10nQ3Sd0GUkBnTfpemtBJgseIKQAHLQcVxa2TnuMW0Aqui5es8xBIegVdVVE8VhzHnLh65WMB9An+X18K6aAn2tO4ETl6vqbKuVFywsDwhevqg8YeH93/Rk70JE90nowxZbIJjvS3WYNSGUwGHJTpPxwwcbBuBrgRYBeKACn7VtpdUu/c0NJxO9BIxcKu4TTODzbkonPLoaL0vyUQRb2y8HsL1ckfWzMeuFi40Qezqi+yiPhyt7FOjr6/gCFwgP7Xb5vssTFt7/nQRg6MGRWmDRoeyTlpgw68GRTwgZgo1gGmXAX6/8dtaylSKY/koyID9BhzML3q1gAos2AcOrZYSoq/pJp1VtODRm9Z3LS/7WjVkvXOzEtOpKyGrlAT+4SoG+VY8vBGCvy/dVnrDw/vee65NBJiAjBIVcAJQjOm+DkCZEeiGAMw6sAwDZsJrAdhFM9rPGhd4904Co5oVuCZPV6kD40Ec6+9W8dBTBsfdc3nkpvnB82fp2RPcs79dHgb51LA9ofsDV6vut5/3PnxcAmLVBiDqgevDaJLkYrpuQxzcNwN8AWgIgRbB8loEBzXDwl4cGiDGft58SCOWGedgjvOJ+bPvgRkiuA+ZjzhnQQOiFNVbloa7l/fos0LdO5QENgEXlCfs8Qbf7HyMA3QVjYihYhLENgjX9y/qwxQmRU/asfd0ZcLU2CHVGyusJQLKfVi98CS12T5f7iECkHpsMkAhCF8+nshWH2I/jXsOYO144GV/9ApAIrS3vt4YCfetQHtAA2G+/4PW4/2PPbzMgmUMi2NoeSCRxIt2/FvuxWURIWCXg357gfTjEDNIHnTRXRCpH5ugKwGl3HpMBXQc0v6WLYVm/5limj04rG762K2uYY9jBkr9+rI03NL5ZbczS/dJ+LQyoga4o77fGAn0NlwdMAOy3vl/T938KAcj121z8Bn+Y9eWQJRz8Y6kNagDh2ey5EvxjxQD8TWdAuneCCO4An1vw5vdzQMmdktwq7pLZQR+dM34+ZumAxvY1Y04uqOAJ6FsExzeto7zfAAX6GiwPaLWR1lrfr8n7f/Rl3QGzmsis+/uO71V9OFgP2gpPhgr7TGRqRUT6dyvr4aIs/pm/2zVUNbBSv6G8e5pEv0Cvec7Po7+bTtjlBRlkvAMBkDeQyvsNWKCvofKACYBrre/X1P0/oWEAnnFD1YdjhtXxR73mX10FfCHHE9pVWcGAI/S0gKsfA2y+twrFZw6Hxf/F0Pk8Ri/kpGSnMuDx5T0iACgQHioo0NdAecBUHW6QdsV2/cL7v/Cyqr5gnc42CCOcfX1VIZ/V8We9IDmTzVXwPDJiXuKXPxtDBma8+lzP4WAgKkPxCUAPE4v5GzEuMX0PYJPLhB6FJsc7MAMmkVxaYC/K9gG+F1++8AQ7Gwbgk78I7GFpXgIwFiRXOwaJZPUbiR0yCUDRk+cHf+YpwMj9HgfI8ClGPyvsSiH0WSKRuYlitLb/zHM/JOSs5C/YIC9cMQDZr/dwxgOW9gtGYUBi0wA8l304vDQvAchilFbpIBQhZ7Ejq6ZQ0/Yhil8y4j89Axie9DAsD6FX9HOK3QtROTFkviN83kG4felIY8DCeLrSeMDSfsEovAECUFsTjHD+tcB+tkFgcXKvBRir7qtFl9owmO4Xy/1G3bAFfPrZHorFNWBFwHjQAFctIghj2kBarw06If/+MM9ZqTN6DgsDojCerjQesLRfMApvoGkAWh8Ob/tgAPSKWCp8ngNQtadjmTdltvNvn3peFYhgQQgh+iUmEaUAUoXM1yRLmWuFLaE9Z+XIAWBhPF1pPGBpv2AU3kDTALzwmqo6qtVh9kJErAudABia38TC5wJgS2xIhAwBn3yhByL4EhzXfRXxYsDTJ4IvrNN2JFMxZcBzVo4cABbG05XGA5b2C0bhDTQNQLZBYH1AVsQSAAU+imI1obHyblnjG/kJk3U8BHz8xVUQAhnQIl5CyNgKAGp5LKSSCoAySh5Jj79vTagcxUaIBeRNe79g9gq+DXig4wGzy+PONfT7RWFA4noAkGXZVAhcBckJQgNgrLiaNb3paIDo1vHHX+oA9LQBi4DxJcOUPJUnTgU2NJUyROs8irGARxQAC+PpCtsFd40H/AEf0gMQkLgeACT41PiGoLOKqyrJq3K/Ya9mNyr5FusN/uPLPIeDa8Bc+w3rtyl4VFHaMZc3i9RWBM9jjzgAFsbTFbYLRmm/YBTeQNMAtD4cBKDXBTQGdAB2MGBo8SCLmEuS1AFVAJ3A/NhPt0PoCcA8bSDG76XI7aySg6JYuGfKwJHFgH0E5B3ueMCe/Y4L+xVHAOZ+9EHcEgQgwbeiEYx6jwTdz4qfu7EhEJqxGqruf/RnHIAEnxgwBM0aC8aUAYWNBRCmoIll4HTqO122QcZbrgMWxtMVtgvuOx6wa7/jwhtoGoDWh4MBJ16WN4lfr8AqI0TVV1O1fa9BbQzovkAy4Ed+NgCQUSxZCFWvCOaOFREXyUwZOPIA2GdA3uGOB6wPaOz+QPv5S+MA3OXiN9aclghW+d3IgupBF2pPqxcxGenDPxfSRh2ASiKKiVP2PaZScvAKoA0VDc6cOlIB2GdA3uGOB1zR77iwX/F6AFB9ONSOQW0frA50sILVcckWJyIDSgwPAVcJgFbYuZ3FJvAlEHbJ3IsgJLGedeBIA+AAAXmHOx6wo99xYb/i9QKg2iAIfDJEJHqj4SExbEty0gkdhB/6P9oZbBZIGiKYVb9GKaN50lRHBLOvhDxh/5EKwDUG5B3ueMB2QGM/grb7/6wHAPNGMAY+GSGUjC52VX2f2CD4+HO0gqkZfegXKgBaHkcWtS0AWii9xG1ImrLlN5XR8L8fmQD05BVrmEENmpYSP9QX+KHiqj2/82+HqqDWwnbBRfGATdzAegGwru2DpRq7Mzq2fpAf0Nq0Rl2wBXzglZ4yUAPAmDSVWDBPHQjLcgTqOZ6zUvdKHh4ruDCerox/Dnu7YqwXAC1NI/QcEQuK6WK/kdgCTGC0PYAP/KIDMBgglq+hIkrOfsaCviLSofcJgJ5AdM7kkSaCj/HqQKVIGvD4swF8bcBjmzjsaQ2H5D/6acBd9wALB4DFWWB5AVherMp4GKIYEOp7+26UF0aSfT/xYuDG7wDjrIpAERytXf2vajj7ueryQXSFl10K/ON3gIWDwCLvjfGB8Z54O+Ee4ve6513uB2R1yzsqC+twbC8HcNVhfAeaBuDP/TvwtS3A/ePAIfYFVlPq2HHTuyulZCTlhbjhETF5yxTQGgPGhoHhIWC4VSXGD3n0tLkMHXHxu+YyB+MlPwDuZs5K6FlsbCzdVO9DuKfkHM8AEkP7B8fOkwDcD+B7np42+JkGOvKdAL4E4K8P0zvQdET0b14D3DgB3D0B7B8HZka9WzrD88N6sFm+YcUjrn7E1ZDvMtF9DBgeAYaHgSGB0PNHCD4BLwLRsByAyX/ij0/dDUxuqlIG5hix7eFhvLcOVUAtyPSydAFmOQNe6EYGV/9ZESiKgIEgtbaD/gHALQC4ovY5r5KwtjOU/XfTAHzzLuCmIeDuMWDvKHBwpMoN0WQzNtAaYSs0K4ZlOSAjGG9kPjCBRwZ0ABKEBJexYAZEAU3A7Oi1BeDym4EDnjQ1TwCGWMW8MXcKks0YOyZNlQOQjcgYIUHllEzYQ0ktm+r6oz8G4F4AXwXwRd8/kO9A0wB8y65KmPxgGJgcqYJTKYpTv2CCzyddQJRDOjKivn+Deh8BF8BnwBtaCUA+YYEyAU8h+c6Az9gNHHRmrgOgmDA3jHQ+iWupCeUAvNSrA9HNwqx+muk9nJVNg/CTfrmbAPwbgK8D+PcHkIibjob5o13A3XypWsAkG1cPA9PDFQDZM1id0i1KxsWfOrKnAFXlifCFFMMRcASigOcs2MGAIfE9iWXplS6On7UbmPaUUTXQrgsVMzcRj5Folg2V5ayUA5BWYKwOxKUafnosWjcJwk+7W5F2EKvlE3xcXaNYfiCYsGkA/smuqug6hcleAnAImPbO6YwRpMgjCAVAm/yQmKTv5hNsAf/i7SyNBSl2a8Qv/4/M1yF+BZSYlNQCnnVrpbC+mToAACAASURBVJcaI7sOSEY2NpaDXLqpR+vE/OVksDgImgGgghHoYJbTWc7oJtFWc65/cg2AYvh2ALsB3AzgVv95nS/f4QdsIkT9T3cBrGtITWZfC5hqtQHInsEGQn3UDDvEDEY/ICf7SxMOrAg8T+c00JGkvHGd2DABUYZIAONzCUDppCFhSukCBsLQrFtZe/IixYQpSyEoJoqnuPWrVRAubQh83HNlZB23z7j1ywmj6CIIqUPxw2Xeu9bx2jx10wz4Z7sqTYZaDD8EIDuoE3hMVEphWg66JIp90k0sBxBcy+iPIIaT1RtEsHS/yIAqw+VSNPWQfe5tlVEk8auXgVa5BUsEJuT5uoliAbE5AGotmIAjCPnR9xDG3TQernYAUupTdBGEFMf83OkApHG+XlvTAPwfuyrgSZOhas3u6cwTsUBVn2gTwyFMi8wjHZAA1M9fYGHDULJD1m8Cpa8fRxDad+l+Ykf/3XNvd11U+qiL39SxXevSsshdDFvgbI1O2AwAtRZMZzTBRuDFjxe1Xg8QEIB8yyj5yYIUxfQIkfkIRnmHCM712JoG4FsdgHHp3ACoMH2G6jM4lWzoQarSvwQ6MSB/vporVaFkh+mCLlpVR8Z+dqDZLoDOpHSiQeAFDkBjPrlgCHgCUaFifg67H/9uYjn4Ai1vpTERTAASBaoQJBAKeNqHlL6mwPDZYAOROag/EYRkPX34MwHIvzW9rQcA+TLpI22G7EcQKlJGsYIJhC6ClUMiXfBTbFUQAej6nPS/OuAl9pOOqIc2BLzg++3VmWgIEUz82cRuCAtLIHQQm0gO52uOAb22sC3JEWgRfPpZf2sQBQIgLydPEIFGwPEj8MlF2bSbsulghLftqsCXq9HGgHysznrGgi5qzTUTFH8FLhAUn3hIJwCN0HLncw37qaF2zoYvuKNivmQIuUNc7GvWt6sHNs26twA6vhyq8NEMAHlyntFrDCcQehyaPTl+FwAbXDcmAKMRThakEk8Q8kPg8SPL0qzLBl+A9QCgR6uZGs3vfHz8TtBZvkgGQrEPBVAUg2Sij50QAOjiVKI3saADJRm7dSLYWfSFDkCem/dhZeMy9pPY5QvSDYQyUJoDIK8qMezh3wY6fSL49PcGgCAA8pScJLIgAUYQEmz8RPA17StvGoBv39W24eREiBoNQSgWNI1HBkdgxJSw1AI+dFIbgOYmkjimQ1r6XXC3rAbCHycAgytohf8vsB/r2KRaRq7zpZ+D37HMX0s3DDcCUGLYaw53MJ4YUODzusqlGCQAOQCejuxA8UULUkxIwAmMAp8Wa3qkN/R9W+sBwOhIEPjk5SLr8HeKFbTQfb77csPIMHGl/4MPbReslPhNe4+MiTpi9AFGV4nI7MfvagNQLh/pfrYnDAS8aJQ42A2w4em2cAyWQUuJVQTGWLs1uL7DG9J1RjhA+jvYk4t3KXeMqijpzrud4At9z3XtP16yGfjKZmCGooYh1tZzvv8xXPFl4PoJYC97k9FlwZWD+Azi/deMZWeP13eQCGEyoERudChIjbb3mJYwH7V0QIKuCwj/gfMj0asn2I0FXRSHXfL/iRkNgLyeVj8ccMY//J1fyxzTAXT2+xoQViKYD/1hDqLxPiYxTgSvQrphphG97tz4Slqafnj7uk1kIQDZrvWTw8B3jwEW+RLxPgSiCERdPwPR7+wCPg/gulFgfruDkOMQkFc5x84e708JAMmCuRNBXi4TIg5CGRzGiBGE/D4E/C2r2vcAYJoify62i0aJSMhB+2IHoNwu0fkcjQ85pu3ack5nIBREqneYFyWLkAXIJHESe00Cyx5QyeL6F/tyEcDcrOW2n7fX8df0mME+/vQ/PQjhoy3gzo3AISYf80MQaQx1peH9wb7v2mrtmCBkIMMejp3jIJD1MsaxaMZ8v5N/67INAsB3BAYU4JL4DSo1J15AFPAEwuQHZJzkKfUAtOHLJSOQRWndBYQvCQA01cfnNopfsaCJaD2baBn79QjSTiOEP1EcawIpkq2kegBTNgHWEpOKF8Uwq2NRFPM4AqCf46/rA2U9/uVDvurB01zvAJpiiwOl3fEeciCGF+Ij11f+QkbSfMPfIzqw57mEFZ9Dl3Ps5HXWAYByHJAJKV7N+s0cCQQhwSlfm4lGZ0KB8C/rABgZUS6ZHITBSEhCowUYAAksF7cStWREyxRwtuPpOlgw+5s9sq6OaIJIIlUgEhA1edoTgHxa9HVw5jibZNF+j/9yGQA/7pbujZ4bwv2+cWB6tFo0NzYnkxFA+cvEAo43VBoEo2e+48EMXEOmD9F6xhCE8RwZEJ80VblKvDlmzwicfqy93/o+8K8TwB2jVSgW138FrJQTXBNlnJgmrjZwanow9CBP/rL9wF0jwAGWDtFyoN9PHutnIHT05mPXz93dMGQAPniJsjiBXiTbxDZFMF9NLUPQxKR5qezz1Y6/YZDH0D6GkdAkYJIvRalAdHAMmPZoYhb6NhDWvEyf/ma737CXN7R1ZC7hUbPgcFgqt/ZZjADnM1xqEVhYBpb4CUk5UsL7jQvj///5buDrLeCOEeD+YQchYwG9VIfyg1NaZszFiCH6DkRGLze5/dgk8IMWcMCjdCiCzR8od1B8OTwvJM8JEShFut1fzMhi+eRJr6LI7hYP2M/xVLwKNoZjUTwRMAQQmYyhWGQxsSADOflZ4kukj7PhZ75bETjBpkAGahMkcrGgwhsXeCyBHBj1wmOBQwvAwqKzoFeRV8ZaerjKYAuirmPY/o9X7q5Cyr7fAvYMAftCPGAEoYlBiVtFwLjtp2U4irj7yOANbi+crHyrfCbTquJV44O0F1FrwQGIMZFqdQDyP/gGSZ8TC0ZRRsOlVzzgasd/u+zpMByLehAfCgMQCDyGZJHFCCgLZ2f8mgI5qauEcVx9e5vACTgCTwEMWr5TdIpWKJb5MvrnoocDswvAPAG4VLGg6UKeqmi4iuDz4er30oX0FP7u5moMvIf7W8B+jwlUNAzFnlZCIhvGFRCeWzrgXSSIBreXTFZSgVLHAp4UHOFuociEEsn2PJwl/XEk0dzfSojeerFg1IOo5BKAveIBex1P67lgUzgWQaJwLAKRH04i14ItgDKEtGsRnWx49b2Vkk9wUefTGrKCF7R0JxZMqxN8cmPAxWcAcxGABKEAKPA5u9lEaAbCmKMI+sDN1X3z+ro24wEZFc0VEE64ABgT180PF9ZdBcDb6JpqcPtPk+1ACbmKjJnllwyuILunEAWjZHkBsrsRUnfD0qEiC5IJfyisgMhzWhcP2O14Ro4WbASgAMQJ48SJwchmBCDFa8qpyBbSP7OvU4PQ0p2W7+LSnSJUFOrI4V7w5IoBTQQTfJ6oTSYk2mQcpGRyH2syGjIF6EM3V/fM++C1CfwUExhCsmzCaQT43lZC3e1hBpEHh36XEqrB7Scmq5dV0XZxmV8WuDFzAF9iwhow9seAGoBcGtKjqAc+1l9rLb/1igesO55ysmCrC8ei6IxRMAKTWNBi6Xw98xNTFUi0jEcmpYgRAPhddpVi9OIEPP5cYD4CcLkCooHPwaW9kV+iwWrQHT8uA1fd3F7DFvgUHUP2k8jTiogAqLoxFpDgbMj9jXSuN7i9dLIdaxzBp5XVBMIMgFEnFAPKT9qPd6A9BIGI7MfPmf4U+40HzI8nWgq2PBxL4FEkjKJixGRRFyQQPzzd1iAUzCAQas1YOmAEoFjwkecDC/PAwhKw6CxIkCXwOdVJLxTobMjBdyIgfvimNvNJ7Evf4jWtdnRYD1YNGVuG93VWuWs4Jf+mlZCCZxwP/cnJ6mXVKk2+tK8lQQVHRTGc64SDAZB3Ey3JcxyACkToJx4wHl+YwqloGDICmYmTFgMQFBET8yyYzyAG/AfWX8mCGQg0BTRoHwt9KVaPE/HQ890AIfgWK+CRAaMRYnVdxHbhdY8Wslw1V93UDsmPIj9GxgiAioRRMIJNvoti+SW/Ikd0gwAU8+XxJcbGITJPDvI6XdCFREFSknTB83xka40H1PGF9dnycCxFwygkK0bASJQSVAbAYeD98xUAe5U3jKIwBosSgNsuABYogl3/IwgFPrOIg1Xc4ZrpAsSrvruykl2ucykapkMMh4CExD5DwJfWAYAxwk4MKPAJgOIjGSEGwuCakRhemw6Yv0UUwRf7L00L9pnsNx6Qx4feY4O8pDEcixOjsoTKKpMYjSFYYjOC8Eq3Wnnr0YYS+0Tmi2HysrPGLqwASNYzBnT2Mz2QD91laxLB0gs12GAh81cf/o/OcHyJ+qj0S/zxnhUZbSyYWaL8+Rq2S29wowiWkJPan4MvgrDDGAlRe7KIywDIgR3meEDWg9HbJgApNTkXo8o0i7oVgxnEgFr8F7jEdnU5GvqfJQKQKyEOPlsNIQvyvupAGHS/Okv4qv9oh+PHxMLk8ggBCRxvAmEN+AiEzz2iQfQBeNmkh4K52hJBKOaNe/FSLobLRXCz43rQnu2yi9oMSMDxs2jo8303ERz1wsCGZECF4kd3DwEYYwJjhoNlQrgIjlYodbBPrwMAZfEmyzcIv27gs6XDzC/IR1DOgA9a6DRz4wZAsZ+LYXvQYsHoD4ziOFklna6YD3+nnU6dZ7bGDAcBUImIAmEUw/zbJ1i/scGNDJiLXmle3RhQ+l/aq57gUQCWzwwBKPeLsZ/LFrGg/ShRXAe64Ajkv30kALAjF8R11Dy3K7KRwJcsUTaqWScARou3w/INVnCH+A36n8RvM3nB5XP4oD6DATBYwGb5ajlOLOh6X8JaBKRG77+7ygGYp1bn+V25/01AzBnwQ1ypanD7KWfA1QDYC3zJIj7KgOUzc9nFbetX/r+O5biwNhyX5uSEDr5o0xsJwLp8/m4A7GaJUv/j3/5+HQFYJ3oFPPkho/hNeqBcMkcB2BAA6XrxmMBkfFAci/m0JpwzXw0TXvXtzrz+PKc/Ml/ugzM9MDqCAbz/keVjjGcQA/YLvjoguo1mRslRI6RwfsiA5nqhL5D6nscF8gfTdfxpS+/hLzvWfzMQCoB1Fq/8b3VWaPIDZqsRV64DALsZHVHs1gEvsqFAeBSApQC8pHK90Oql4UEAyvCwNeGcBXNLOPMLftgZsI75ouUr9ousp2TEyIJ/sU4AzC1e+WIFshyAHPZREVwItrrD3wGAhibTYBhxVpe/xePyrNBuWaoNp3DgFwC81O+RAepK/a5Lfe51jxr7JwA83nPXYgq1asl0yX5N48+f4VEGLATlK1vAo5YB1gBSRmsM+NFE57lcfPD5pPFWCJImtyvGgGfOAacBYO59zFglgHgPefZsXV6/gPXBYeC0RVgyJNOGYuJjPka9eHWgjL9bWzhWk0/n/wPn+k8bgFNmgYcsVflZnBRmIShtJM/m7JGibGBoOIIez9wKPP4AcNpylfbNlGfdI+9NjBjz8JVzppckZuJ+dBw4aQ44drk6j1LIY9JkPD7P4s2lwVEGLHwJnncscNIh4Nh5YMsSsHm5ndOu1BGFThJ8/K6JrZtoslST2+XHA6ftB05ZAE5crgAups5TfaL6EF+UyIif3gAcOwtsXep82eIYY9JkXpMgMp/AeZQBC2b8OduBYw8C2+aALQvARgJwGZhY7swEzbNa88IRvAVO1qkF91J36DNOBE7eD2yfB45fqphLnevzdGeBKBfL8UX5/CZgyyyweRHYsFwxYHzRNK6oetSBMDLjUQAWTPqPngpsnQK2zgKbCMAlYMMSME4ALrcnR6JYQIwsoUnjpDRstOLy7cBJB4CHUGwuAtuW2nUDVH1EFUhycSwWjGD64mZg0xywcaECoI0z5P3X5P6nWlHdgHgUgAUAfOYOYMtBYNMssHEe2LgITBCADkIzSJZXpCOnIg25uPrhgnupO/TyhwLHHwSOmwW2LVSik2pCrDsQskzNIBGIpBdGI+VfNgMb5oENCxX4yPRjPj4xaJ0+WGeEHRXBDUz2Mx4FbDoIbJypADixUAFwzAFI8KUJChMV2SUaAGc1cE/xFJef3FYRti64nkqWDrqqEhbrsm5zvZCdPCd8nHzJOLZuABRz9hTHZwPL7LnLnoNMIY2VyaKcjtZLHOAbNgNPngKe4BacfGF1pnydD+hphQ/8XV5UiEueLGnDN1tWXj/3/4cTwAUzwGPcRcFJiDpPt3FLmf5vjwE2HAQ2zPrEzDv7OQg5OSM+ScYQy5Xbo8465u/ZfLTJ7fKHAdumKxVh8wKwealSE6inEoSy2MWCdbUHIghv3AqMzwHji9VLZuDzD8cXxxWZs5c7apmW0fMBnIHKn5X7d6I5npvRz94O7LgXuGIReJSb+Xl1tzqflybwRwqf9i97BQRWomWJQ7oZVFtJoqDX/b/oGODsvcBTATB9gsfGqmzdjtVz+G+PAyamgYmZCoDjFE2anCVg1CeJwOMnTRB/DmUINVkkgia3y08BtkwDW+YqAFJFMD1VAAw6XG61R31O9/fdrcDYPDDmY0zjc1UjivBuAMx1QdMB+WAYXU8dhEU16dOSkppbcHFSrng8MHwnsGMPcN5ypURHp2xMIa7zDz2z8Gn/kVe0YomO0wEwBYKujL7v/zHA6C3AxfOVh58g5AsZxx4fZM7sf3h6BcDxWWeGBZ+cMEFiwGEHHRnDzun7ONHs/djkRgBunql0VDOSHIDU3cxSD4aEajhFXS4H4S1bgVGN0V8we7E0Fh9jVDG6Obr1LJMRwn+kOCaTEYT0dsfqZHXl/p7PrLi9wIY7gO0H2yAgCAWCWCowKrYE8nMLn/a7PQn9X7zIJPPkCcK+758y7x7guNsB6l98gZjLLYet3Ay5n0sv4R+fCYxPA2MOwLEAQLIDPyP8uBg2cRYmzFweAYilKkn+OC8/Fdh0CNhEA4nGA40kd6FES13WLO8v1qHKAfh9B+DoYjU2Ak/js/8NAIwg7OUb7LCC+WAfB4CpBJoIiTRNRmS1l13kqWh3Adv2A8cdqqp1MB+aIOSxWv6pq5D2kkIAvt8rF7BLJksN/jMqfa7v+7/Ak4B3A6ceqpasKMq5akAmlLWY37t8ZW97PDB2qALg2BxgAFwANEGcnI5JcrDZRPlkaXL4u1KJUAfAjbTQ59x6dSvdLPXAgGYshZWR6JIRaXB/NwFI8C1WwLMXzMeSwLfcXuKrA2G+wrLCDcN/IIg4ERRn0qvyySAQX6mG1XuA4fuAbTOVwktRRr2MLCoQyvEZ/UY/WwjAj3jtFJZkU79g1ghkgEBf98+0Umb/3A2M3lkBl/fOcdMok2EjkZyv8773LAfgHDDKjwNwxEUw9yailpwdxBAEYhBbAuGzG3aKkQEJwAkCkOCjlb7Y6SYyf2UwlAS+vKYnAXjfNmDEX7DEfA5CjUcsnzvbu1nDtUMmCDkRZEEyGdlAk6G6lQTSa6m0MP6HuY73AxNTlcJLZ6WOJYC5/CNxLpHMgdKIKNl69Qvu6/75AjHOiTU87gKOOViJb748BKCWrnK/maTA+58AjM0Ao7PA6Lx/xBAupoYDC9okBRAmPdBZ47lNA/DhwMRsxX7mPgl+SrmK5EaRNRslXFQ9CKB9DkADn79cZtkHFkysJ103eBbqlh97DpmTQTYgk9VNxu+xYbXKU3lhFoJPOgdFGY+lPkgQxokkgF9Xgj4AvfoFs84eX4Ke9x9fIC+tRfDxvvniif358sSir2LCj5wNjBKAc8CIi2AxxLCzIAGY9L7AhGIKgpATw4l8wToB0JjPrfTkp+SLQbHrOqm5jNyajS6VCMIpApDAWwQ4LrGgXqzIfnq5cv0vN0ZXHTInME5GBNLb1DGdOYQsI7AfGKFjlgqve8wJwG4T+fuFAFytXzCLb+VgWnH/fIGYfc46Hs7iHC8ZkPcdXx4VfVXJw8+cA4wIgM6AHSLKWZCTESfLfg7WsIyRF3ckiRQ+HACXkwHptyP4KHrpJvKVGnOhRF9eBF9wE0mUEogz2wC+WGI/vVxiQQIxAs9+rmHA6E1YFYB8DJwQMZl0OrLZ++i7sfT8zroYHLS9df4RACWKxSZvLXzG/fQLZqk2gqn2/vUCUQ9UZaM9wDaPeSPrC4A5C1KV+NITKwCS/SiCR/jRBDlLmP7nHynsxno1IPwJSyRpbiMADXzuPDYfZfBTEoAmcuVQdiaW0zwXwQsCYDYmMaDA1wG8TBSvaoR0G77EcGSET6hjOvVApfRPAUN0zjr45JzVcSqiTxD+VeGzXku/4Nr7JwDJOkxFIwt6j6+RqUrlkO4bXzp1gCAAv04AzgLDDsBhKugLFUvQUhTwCEKbnKCw14HwJ9cDgGQ9WegRgDI8XEcVEDvAl7lVlglAgi+I4CR+Zf1mLGgMmDFhBGFfDCicRJFERviSABjLS7FC0MFKMU+07wOPE0kGvaoQgGvtF9z1/iODkwn3VWoEXxres5ib9xx1wZufBAwLgAQexbAD0JiQwJOuJBA68/H3Zhk6+3CifqqwWNMKN8wjKgbk6gWJgC+FMaBb5vJVmsUbV2vCqo3cRWZcCIACoax53+ulkqNd7iqOcU1WcC9cxEm5kQBUdZ+sTnSL/jEtTWngi21jhJNJBivZBukXvOL+yYBkcOqxKjJ4AGgxzMrBVwdAMmHrZOAYF2l6y/mwV6xD17zmWo6MbRyeWtOHwxJ91IIhr6rqZS70DPPLXDVUrfBwzHKr1EUp6/h0T/6L/GcCqslt4IhoTcwdAqDSs7I60WQH6R329pHuFyuXDJmEjuOSbdB+wSvuP5bGUjmsA5XoUvcvBXKKAQnApUdXwah0b8jXR2YzJTsC0ZHB33FL+2yiX3h/1YeD1fFZGT81g/H6yqkVa9YEpqMhTADle8erHA6t7Mh6j4ZBXdBGjFyO4CSIm9wGBiBvgqxwIAJQlXIyEJLyI/i0SkAG/FbhaEr6BXfcv+5dLKhCg4z1C1HEBJ8+BODQGZXfk/quAZC6ketAZEQCTWAU8PIJt0fgwHzZvVWNaKqi7JLOmtDWFy42g1FxH/XfqGkII0C+a0tnDkfsGxQjn3VPsk7tXmuy+Xp0JhtoJosAaFcUAJUYKiYJxcqHqKAH9rPlG2cMrmCUbMX9guMLpGTcCMKDlZGhMK8IPnPIn1X5PA2AwegwEEYmDGBMjOI5whGQP3NPBT7VJlRNaKvF4t2IWHbDErtDlSk1p4lJ7/zd246tglGZryIfrFhQ7pU8WCAX0ZENG+57U14Z4YrCeLrSxXdev6TfLwrbxT7znMrfKQXfHLQCnyvmRIv0Q3430ezMmL98P393G3wqz6am1NYzzoGn+svqRmTAU2citctqAX/2EI8F9ACEmLHXLZGoFxtSl2xyK2bAYwrj6Xr12+1noL/jUTCD9vvFrn6u0v1/nvGkaoVBAQi0eummMAuXQHMWJAA7gCixG8U0gFfcXdlBKk4Z6zELgAJfZEKrxpC1xOIl/+Sk7jkcdYlSco90y9+gK6vJrRiADD0piad7RuFo3udNCgft94vCdrGXn+tujgV3QAcHLcFnroelivHkchEL8ue0uQ74S3eubAITS3IQhKkMRjBMokgWG3L//2z3VSnP4VDgQWxUEEUxAZFHL0eR3HDfm3IRbDHkBfF0zy4EIKNhSvr9goGEBdvTz/MIYQLQdVsTwRTFDj5jQmdArRDYJQNDSs961R3tPhx5NXoVgoxleHnarjohgLec3D2HI492yQNvIwvqO9fJm9zKGbAwnu6FhaP5pFuMg/b7tTbpBdvTz68cz/zI8azVj8iAHTqgmFHXDUB89R2dtaC7tUGw4kDOgFb0R2wYRDGZ8g9O8aU4XwPOczhiwGlMjqqLWiFYGu570wADFsbTvaxg8nkow7E8nM/atfKzln6/1mS4YHv6BQ4+Z0BbqHcd0NwwYbVD3+1yWhXJxPBrbq8AqE/XApSqAxiBV2MZ/54DMOZwKE00rnDUWcR5KiV/brjtSAMALIyn+/mCyeehjIYp6fdrvVELth8RAClyHXxmhPi6r1m8FM0ucgk8+y4RHC1kAK/5XgW+2hZYofafWcPq1B5AqDqEYsQ3nepR2gqhV2yiol1COkD0C+aOaoGx4aL7DQCwMJ7uVwomn4fm7VrX2u/XAlELth+5sHPtN+l/Ap6sX2dCsZ/phZkIJgv9l++1wbcq+2WFv2NXIjNKAPzuw7MUAV8DTuynFIEsQy83RgTAhiv+NgBABaQOGE/3mwWTLwAqHnaQfr9GnwUbARgDNBUlkpzQboyYCyYDYdILdf0l4NduW9kGoa4geNdazLElKoA3Prx7DofiETtC6XvE7hGEzJlpcis3Qgrj6d5UOJoYDcMglrX2+y0NPtl5UZUjkfx/Hqbecoe0OZzdF1gHQrln9Bhee4s3f3Zxm4MvAk9VSFdUIw0i+Q2PaBtISiBSSFgCYMjMW00MP7pwvvLDmwFgQTzdHxcOSGvBg/b7ZRZByWYAlOERluKM3Ra9CKWc0q73dTBhMFT4ZwIw9l5Lrpes+HjeBiGCUOKXeuBvPcKTiEIOR0f+RhDBMYi0Lhea4GTaa5NbOQAVDzhgPB1La5RssV3rIP1+7yy5OAADoAchEHBkFbKfGRpiweAPtMs5IFNokyOGk/7rAYC9OhBFwNXVY1at5tftCBHaWVS2AJdEcEinrDNC+Lumiyc1B8AB4+muLARAXTDCWvr93lR4/Z0Xt6ODFQkj8WtumEwHTKDLQejAfN3uds/dfjoQdatGLxb8jQBAYz6/boxiFgAVudzNIc2/s3xLk1szAORoB4yn+2DhaATAGJCtbpkCYq9+v4V+aBgAQ4i66XtaC85YkDog/zdZvzUgfN1N7a633Xqv6fe9msDIHfNaB6Ay2JRE1AHAEDIfI5nzZCLeN4Nbm9yaA+CA8XSsul6yqV0rJ2WQfr+splCyCYBR/HJyKX4phs0PKBZ0lqOYTpvniAiUAmAd+HKjo1cvDjHgr+3wPJQsVCymUZrPMuRsRBDG4AQCsunyJtFGHwAAIABJREFUcc0BUJlxQoH62q8ST8cggpKNAFRGwCD9fkuvbwAkyGgJE3C+Nz1P1q9/T3F1EZBxvZh50s6AEYC5yyUHXt5/Q8zI5/KrAmAIkkipkyGPYwXz1aRT8v5ZO6jJrRyAvKOvNXlLazsXs9bo/ztc29Pohgotp5J49Rcj/pzfIwGS//3OM4CNd1dpntQpFUmjEH4LYIgnyn/OLjL8FeDGhwJbNgFjI8DIEDA8BAy1PFK7FSKf43cNKrvHx+8C/vmxwMgmYHgEaA35J0StpvvzL/nP8RbLAfhyT207TChgDRiu/ZL9DsfWNABvYzbhCDBKoBAk/pEobGWTqp819hzQ1/0k0PoaMDEJbJjxVZFgDad0SaUO5LksWVj+XScDmw5UEUDJ6U4d0nVbC91S3ovfVHp5al64cgC+k7mZAP768KCA0WD3A/ieLz090CDceVmlAuhBljLgrfcAw6PAyDAwPFwBkCAbItM4a/FiNtERjBl76W9ffD2AbwJDdwFj+6syImRXrd5Y2FjIYcnzWPLEqnsfC0zsr6qBMQmfIDR/pyJ6xMhKyMrSDiKD2xja6TADTt0/AGAs1KcAUCFrOLF6tbtiRVFavT/wuMCa7MfVTlH098YBeBcwNAIMEYAUlS4uBULOmK3LCnwOPANlEIOSoF9+C4DvVoWXhvdWZVOYqWgi3vOXDUQhgieB0EElViMYJ08HxqeqnG8D4IIDkAzo51DKQQJvBKUmKACzbM4+5hUivwrgiwC4LzvjmgCh6nBcgiMTcv9Abo0D8E6g5eCjfpUA6AxoQIzgi8ALmWwC4z//DxcPPwBak8DQFDB8yJPpPZHeGCyC0KN5DFCByfh9/+OAsekKgEzCTwD047X0SCPM1IYQjCv2E/MJoGVwUUQoPboq0MdqkWVn7RtDDMahB4g+P6qhXFpjVtkDtRGA2nKjos7IyOyHFUbIrXe0FXsTuzIYfNb4O2M3ATGIYQOmPn6hG6gi3eUkQQAeAIYOAUOzALMVh2pAlESqGFBAXAYOMQVjxll03iO/yYKRAT0FQXkwZkjp1pz51LO2XAT3KtD3AIAwj4Wg05kfiuUHYlsXAJLVnP0INLM0OYFx78AzcRySeTsw2AJueI+Dj2Fne4EWKz5MA0MzDkCCkAByUWqsJzarEanzj2zXwjEGFHuGY+pYsMojzZL1G9EBexXou339IRBrC3lJGmNDuSHX+w7WC4Cm6wWxm8DngLTImgC8pBcGBuTXf/1fXnyTugnFwxTQOgi0CECyIFlsvvJfEnh0mhsYI/s5uxFYi1xZof7oOqSAawwYjRGBzYGXbtWXaCIrlvHUagX6SP/ruMVYCEbEqECXAMjfree2HgA0ESur1/0vtnNwGSsG0RsZME20/+/XWH6Mugk/yngPAGy5GDYALjiIHIgRUIrsZjM7Ax+BSx1S4pfffQVIep8dL7dMDsTGjJB+CvQxTHmdtrw4l0CovFruC2NOe975egDQsCXRK/eK634JhBK90q2C7I1i+Gt0jxF40k1cPJAB7UP2m3MGJAAFQrGei9iUTH9yBUDTHfU3B5+BOIKQ43BWtNtPcWIOzEZE8FoK9K0DCGNxLi3FqaKA9gTgeoFwPQAoI0OulWT11oEwiFz7cwbErzNxWtEYBB+VY76Vh4DWrH8IOoGQ7Ocg1CqMRLPltmxvs1/SHaP4dcAJePYyyUCRIzrTB8tE8FoL9DUMwl61kQQ87Rmy2PS2rgB0a1ci18RudEJH57OsY02y/+83/sZdBKr4FXQTApBvprGgQCg9UEAM+h9F6ugJDkC3gJPBEvRGrYoYCBX9IxEcS5K4i6cZAHIw8oXQ4mLBb35YH5d7OekadtTV1UZSjaEIPH4nQzYNwgjAHNwDuWGYpZc7lzPfX1cQur5oBorfzDf+zi0yVTuSkuxBI2Q+PhQDIUEnMLo1TBCZLufGw/ixbQa0KB8CTODjPohdY78IQmfDjmW7Yo/doAX6GqIiAtDHaYswSmeMubV81kp11L6hy2PdAcgblfslOKC1IiKRmyRxZgV/8++DS8BFrxXi5Hd/U6MeSKdqEsEKhpBRsgRMbAtuG4KU/+9ry5brzP/lPVMv1EPOQegharrVcgZUhVHFxNPcp9VFtlOWkL437C0WABWypFRGsV0sb5Hn2zYBwvUGoKl10v1knDgo0y7XA8Pfv0UACnjaK33Co9gJQAOe64FkNvtZAHQdjz9v2Nz2GSa3jYej2W3KGuZ9ixGdIVSoKT13B2s5AHkGheST6qn0erHv5AIgAAU+LVfw/wq3CEAV7clBKDDGZG9/5oVXx/oyYARczcqH5GyH8eFplTawFvAtrtXLGpNrQDGbejupB3omlIHQGc/ErzOcGSRs8zrhAbbuL1Tco/JfbLlNwHOmi2kIcs3owbdwNpYtynDQhsFcgvuG9/YapGFvYX22zZcAU0/GwA2LJ/4AmGF9mwEbBu98Y3cMF+uAGQCj2HVp3BbPuo3IlqxAy5wHAq4OfARmEBXGfNIBa0BIsG0ecwC67merHgRpZLwocrWaovuTxew/V0txJQ2DWeae3WAGbdhb2DB4+wRw7w5g8Qpv88liyGtoWHzMi4C9fAEHbBi8kwUKu2xNAdBxaGBLbJdZux1LwAGECYAEm6wyfpelJrEgFnRDxESwgyUxIUsVMwjVy5AYO0bG89Auu1/5BF38KqjBHlUAYXsteNCGwTeWNuwtk4JMkrlzGNizA1hm69g1Nix+zDOBW0aBeRZZGqBh8M4emfWNADDT+zqMjQyESdQFHfDbZECCLRgdHeCTe8CBaKJY1rDnBRCIAuGW4TYAZeFG8ZuMkGiQ1IEwGCJtHZBmy1obBsvVMnDD3jIAerti3LEBOMjGcOpa3WfD4ic9t6oveDtLfw7QMHjnH6wPAybW6yaG4+8D4HIQfvtDIVtLejpBFsVvUI7NIBHw3DUjRzL3rDVtsYPOkAScuX3coNDynT2VYJCkn+PjqvUD8hVbS8NgjphGxcANe8sAGNoVY/824BCBtIaGxRe8pLKZdpMkTvXiJ2toGHzSNHDPScAyq3er4qPyGaNc7JCRXWLT2TjwGmCOeQashq6+qSpZmp8vojQpheF58ncdZVjLnjWPHr4VWKTKxrHGUqq97qXu3jp0wPy+eEC/DYNZsZAO6IEb9pY9lNCuGPcNV830ZmkM9dmw+OKfbdcXvJMPdY0Ng0/7GnDXKcDMccBS7MwdKz8KCAKQIgY0MWGCtr4TOHAasMwOkTqf6unyuLykfd254nkb7qsw/iVg7jhgmSX31Vpd9yRHeLx+zRhjEGRbB6wDYT8NdymyubzDzCCGfpMJWfSRYfr9HP/aMgBm7YoxNQHMbQHm+ID6aFh8yS93tAvGQb7da2gYfPoXgbtPAqaPA+a3AEubgGU1RM6B060fgkRoCzj+TcD+04CFE4BldZdRc4/YxlxgjJMewSiwN1zWfsOngdljq3EmY08vm5i/7j5yIMqpvupKyGoNg9lngYosl9wY/0dZdrMzYl8Ne8sAWNOu2MA3zw/F2CoNiy99XbvftrcLriz6PhsGn3U9cM9xMODObQYWCMANwPJ49UliuW6SaqqBn/gGYP8pwPyJwNIxwDK76ahDeN6uXYCuYyABkEza4LbpY5WEWdSLxjF26/dQB0SJ6r4ByAN6NQxmkWcqrnQ00x1DEDJFjR8CcNWGvWVPp6ZdMQ6OVOCb3wAscPJ6NCy+7PerkP5Q3tBY1PrT9tEw+JwbgPu2AlNbgVkCcCOwtAFYcgAuiwWlM/XqDjMEbP9t4MB2YO54YJFMo/5gHIcALV1TRZ17FXOhPtvgtvkqf9H4kvHDlyKK4l6VzvVSBF22uwjOb7pbw+CfcwBSkyeFEHAUx/yw9JTyEbo27C17Ol3aFWNuAlgIn9QxO2tYfNlbK6MvaxeMRYquvL9rTcPgJ30TuH8LcHAzMOugX3QALo21WXBZLEHwRF1OgHS2eOgbgIPHA7PHAezNu7QFWFZ7JnXJ5rnqxHEulvlzwyVNN3+wern5Yovl7SXLGwvn4riLWO4fgMRJXcPd/+pmOymELEhRzBxJAo9gVL4kwVnbsLccgHEpWi3epocCAMeBRU5eTcPiy/6qtl0wpvhA+2gYfO7NwOQm4OBGYGaDs+5ExYDGgqP+ccAkINaVpB8GTv4d4OBxwNw2YGFrxYCmV0YxLNYheCXau7EhV3ga3Lb8g4+R45uoGLADgHWqhsBXA8K1AZADyRvuvtkBSArh+i9DsQhCOtf0UUgW/7aiYW/Z0+nRrhizoxXwFhyAi5y4rGHxU66qAFhT3rDSIVdpGHzencDejcDBDcDsBDBP1uX1CMJRwFiQIBzxieL3KIY1YW5MPOxNwLRb8gs0aghAss1GZ1O+SFHsdRPt0i/PLHu++dFb/x4mXfhcbWxhfCtYMFr/uWvKxfDaAcg7ipPCvFOVpuo3HrCjYW/ZA+rRrti6TS6MVQ+L4NPH2nx698GnXF0BsKa8Iab4dFZpGHz+JLBvApieqAA4J8CPOQuOBBAOV0CUYbIskRkAecrvAdNbXc/aDCxSpyT4CEIyTgRgneiLIp3nP6fs+a4A4N8B8/48CUC+ZGJA29fpuLmxJW+5h5kNFg2jiWHSi0r0Uv4pCoZsxw8DUfnhd4Vk0XGdGvaWPaBV2hVjdjgA0BlpkQ/K9bmn/HOVqtClvKEBqlfD4AtmgP3jDsBxB6DA7tdbcvYzJvQJkii2n4NOeMpbgJktbYPGACiF3wFoEx1ZMNe/4jnPLXu+KwD4t/5SO/iMBcXuesHylyACMBPDgzGg7opM8mEHIGdwrfGA1rC37AH10a64Yr4APvvOSdwEPOVbKxu+K2pdKRTmdI3dqkPPVgbSTBGAY8AsATjWniBdx0QxJylOFCcr6HBiw1P/CDgU3EgEIMW52M8YkLolQRddIN1AyKWiBretf9MJQN6HsaCPxe4rvgDdHOcOxDIAcmDFDXvLnk4f7Yqt63gEIB/Yoj+4p9xaAbBHeUPM8qF2aRh84QQwNQYcGgdmx4C50WqCFngNsgSvQ+Dxu4MuiawhwIAXVk1O+e/A7CZgThY1dcno1nHL2oDIyZULpBsAFTBZ9pjT0QQgn2V6ufRicS8QRgbs5ZYpEsENDejBfpoLrwAOjgIzZMBRZ0AHoUC+SOA56xJwNlEyTFw5FxBPeWvlzpnbANCdQ1eSGTRybMuydgMggVBsKmtYoC6Mt8znZxsZMLzAxoAOvsh+ydDqtXx4FIDl8L/omQ7A0QqA82S/ERdTI22mNfaTuBIIxR4BhKe+y61punQC+MytI/Zz/c9EuvyBeetLAfGZ5WOMZ9j2/gqABB1fMLsHAVBqhfTcyH5d9MByEdzs+B50Z7voGZX+NzNSsd8cwUcG5ASRKYbdHRNYwhhDIHRgGmO0gFP+HJh15jOXjnyKblVT5Cbfoq+yJOszF8P8+VnNPlICkMAzds/YLxlYznrJwIpO6egTPMqA5ZNDAB6iCCYAyYBcBqTRQ0e4630SxZyQJQIvMJ8mSeLrYe+p/GzGfnTpEIBy6US/out+K1wg+brs88rHmDOgAVCMnrEfxxMte1Mt6j7u9zzKgIXzczEBOJIB0BnCJoqgIfDEhM58SWzJEPGJe9hfVH42un/Mfxl9bgSiBySIBWnAJBDGEDAB8QWFA8wO3/a+wH4+rg4RLPYLul8tCI8CsJmJMQAOuwFC9qMI9g9Z0CxhZz65K0wfFBPqu7PEyVdWAOTHVlTcpxhXHZLz1w0ZA6EDLhkCskRf0sw4dRYC0PQ/vVSRAYPo7QCdj7GqVOSMeBSAzUzMxZcDMwLgcKX/zbv45SQlHXDIgagJc+bjZBqAWhUoH/Y+B2D0J7rFa6LYDRmzomsAaOeKqxEvbWacHQB08JkRIteSXiSBLYJOLB+X4xrzAzY7vgfd2S4RAKkDDgPzNEAIxMASSWF38WsgkuXLyXTRSRCe/DduSZMBMwe6ObTd8JBj24Aot07uDObPP9XsIzUGFPs5+JJ/M6oT4buxHv9X7BeY8KgOWDg/Z58GTC9Xq5FxTXOw9c3Cm6k5fPcjgbHbgAlvVG2tH1T3Oavoq6BlniZ+12n5u/2sDbOvasqoFg8x2Lnbcd1GdhSAhXN+7qMrAC4sA8sORJ6yHwD28z+Ft4fdv8UyqUDrDmCEBcpZ39kLS6aq9l4D2rLb/KYsFTPWdfbvh86vQu2s1K/K+zIjTsXIVQ9a59Egs4Y6sZfIA/EcSp/jEXv8BWcAhxaA+SVgSQAkGAMICcwVlNLlqTc9Gbv/HAA7MrL4+f1VlXwrUq7SvCoyGcrrWpGhuur2fNGYwM8YT67hT3s1LaZvqn5MLM0bzmHMmIFSgdFNj/mIBct63NhFZwEzDsBFgpDPeanNgATfCtGsX9TIKwNrg9tuVkhlng7TI/YArX1VkXKrEe1l2SynN1RCsFJsqnQv3UIMxhwIRjU5AGN9QUteVz3BUAvahuNgjC3HxLAND7nBp/cgONXF5wCz8xUDGgCjKPbvevlzcKUHH2ag6cnYzepYBB9Zi2FxDJdjoXJv1WDFiLJ6MKqKZUzoQFTfj2HmwTKcTpVWvcxHKm6kKgoORAEvVclPD6NdzLXpMT8IYNPcLV7yJGB2AVhYrAC4SNA5AxKM9ryDPE5fs6eeVKWGZ2M3S3MQfEyJUKV8L1ZpJXpVJ9pLilmlAxWkVJHKwIhjjD9TtVXVm1HdOy/pJiaMFRWM+bo0rWl4yM1N7oPhTJecC8wRgAttBjQWdBBGESwgSiV0Pb9DRgu0TY19N+M1mRKh8niqFx3rRDsLqjgl9yaGXT80vcL1wnE252PAZCzAHQCoiqoW3yYWFIt664fUpKaREr1NPakH6XkuOQ+YDwy4FMSwgU8GSRSz0UJx3Vx/5vFNbrs/EiLRY+v4ACITww6iJEodQKwBIyBRv9vwhKzUW6z66TUGEwhDS3ezqusAyNxnJn8xa1KRPSFts9YfFB/QDZcAm78CnDBT5U8rCqjfc3yh8Gn/hGd/MsKf1+QzYJ4891Jye13iy1cAE9cDJ+6FpYrEkidxDN3OtXR+FwBGMezoMmxJLOumAuD4J4rxJrfdH/XCoLGFVKiUbw+LAPQqWWaMMLrd6/+JycSIm85w9lOpt1j1MwAwFTiqAWEUxeYH5ENn/jInUVHeMXQ/f/jRePvCa4DhTwLHfBc4frGqqaNJzLPw6iZxV+HTplFGvZrXZT45N39+HW3TujlZv8D6fp8HRq8Dts9XIOR5YtakgBgdrrrt5Qsq8Ssd0BhQ4HMwmVitAWHAY/LbLDQNQDaTVJ8Q6W4qVB51OOqDZDPVB3TLOBepW5jmqaLbec3jGgBGMSxvvemDYkQ9GoKF1ShUCSKCqBeQrvmfVZPC1keBjXcCmw911tTJ8q5XgOLaQgA+x/OdWA2EGZ98gbjleTHdQHQN+2iwls3nK3/Zhj3VeQhovYzdxmArSwQgDRA3QiSCJUrTnjfl4KozRCSCCeYmt90EoJJbVCk/1+FiCwFZxLk4dRfLFia6x8LbYkD9v9cXtLG6+O4AYQRfrgPygVIcqyhTXcWFOJH8fh3rz7EKwnUArq8mcGwK2MCC1i7WY7Zenh56feHT/jE3yliE4TZncd636gPFCKWavGhcRx2J+cvs9MlSw0Ty3cCm+c7n0G0MExdW4BMIbTXE9UCynvyCCX+Ovm4gbByA/xisVgJPpXrzLj4EoRJjJIZrWHArS9iprK+KcefgiyB0XVKGjOmCmW9xhRVMUSyRFnNeFGEdI2q+/HFXclkp9WsAbgTG9wGj08CI64WxRk/OTDcUAvBHXSLQxcVCDMQSWbzv+1e7WVbz+k5w2tJtsbcCYV6WJY7hmAsDA7r1Sz3OgOgoM+KTOJbcjSI5yGIaNE1uuwlAAU/MF+tF5/0sIghVLdVdM2S0bSzHx2Mi+FTxXf8X925NC4BycK8QwfmgVX1LlcFiykEMcL2BndJJ7aQfijKfxLGDwAhByM7aC5U4qwPzNwufNnNuOH4VZaCPlPo2AahqFqoPVFc14ga2m+WEEL0cAz9kdPrOmMu8r1o/rTsXz7f9oswFs+jO6LAqkvC3Ggg5Fg6mwW03CUI6X12h8lyfcz3QHqr3DIl64DbqaQKc9mI87QXACD6vpJqY0EVxz2CEyCI5eMSGX2e7VtI5J4yTRyZhscrvt1nQuivOAaNLlYESwcySgiVbr37Bfd0/u31yEgg2FVaiPCeVOguqAfGov0iR0R9JABJ0bnwk9nMxw+fOh55EbgRhzozrBUA1polN9CLwok5HEEUQBjFMQB7D+j656PW+IrJ8O/bBCo4sGFdGejqiyYCx3mKe9/JtTiBvmI5OFiTisg9LtJFF7gZGDrUbHKs79+hyu5hSaUvh1foFr3r/6vZJCiXgCDwVVFJ7MVmRLsrGltuFCc68yFdACMDAflwR4QM3HPoKgIExt4gz42SuaQb8hBOE2oZmlu+KFlKR3QSssMJxDPWbbjpfLoJrxG8CYT8MKGZSVTCxYFTIb84nkCxCIPLDiby30gXFghaF4c2ReR466Uu2fvoFr3r/fKAEFxvpqMcd9yonIrkuK5LLV7MVCM+/uDJCyIC2J8a0z1iwqyESgMl15Sa33QKgmtPEBnp11mwuXgO70Ud4DHWzfgDYC3zBEOk7HlA6XKyHQzb8HgGoCSQLqsxorIy1Bxie7Wx0rFaf+wr9Xv32C+56/7HbJ5VHtRYT+GJrsehHcya57PyKAQk6+vBkBZPpjPEExlwU59awg3C24W6KBsC6tqHR+MidyVG3i3rdAnAsH2T093XT+zLr197MTA80h3SfsZP2UqpCrPQ46oF317VrpeiKXTJ9MhMLkgGdCacKG/mupV9w1/vnwyGgCDCKWzJe3lqsyzLWZWe6/kc/oKzgKH4jC7oolhdC4jiuzM0WPo+cPQ2AsX1obFCTO5Jzn566PwbReiwnfTWjI4KvDoh1juh+aT+WKSYD3i8Aql2rJk+VsVQly5kkddv2FvHT61icqO7Fr71/IkLNXOi0FQjV0046oBy6wZ922Q95ICqDEaL4XWw3COcf9Mw73DFB9AqE6wZAAS8XuzGQIDKf+oVkqxt00ttAc+YT0PJ9qRFSB8xoye5Xu1ZVeCSgCLbYLVNswoncHxoeLwCzBGjBNki/4BX3z9lXgUCyIIGmhova83cRgO5Te9yLgP3MfmsBS8xs8/U67ePQOqy9umBUruDchqo8sHSd3PMfT5ifo+ack8eFHI6QEcnT5GvdOnVdXof+ptJ+BVPWceiaRHA8Us/nkACo8mzqlqmWrbFDppT5A5UIZm7CPA2Vgm3QfsEd909kKIqB1qJAKCBG8ZstZz3xHOAAiwmpDIdng1maZQAkZzsHZ537YfQrwNyxoQ+HakrnS0h1mUA1C96TdJTmORyhC3oeqdwROi+GDhkFI6bYNrcNDEDeAkXwQizPRpmnIs3OdqZPSaRFUcbchHlgie6agq2kX7Dd/+d8lUJVXuUzk8ERmS+2vfd4uvN2VOV5rSwb0y3JhgIh9wJeN3YMQCIgR78Q+nDEVYBYZUrUpbXFnM7COSdf7N4IPvtDnT2BY/h8Chh10MXQeYGS+7GGjaQiABpuNIFiECnzdWJMIUHcazLptC7YivsF8/7FgLFMqpiQL5TuNbKfA/DC46rqqAbAwIKWK+timRUBEiNGsOQsyQm+Gpjd4n046hbT84KPuYjOmHHyp92gcgDS2OoIuVIeh/xyUkaVwyEWdLrewHE3uBUDcKIwnq40HpDXL+n3CzbaKdguel5VnFJl2awaghLQBTzteZ0cjLq2A2n0M6EPh2pC57Wg41poLzZsAZNso0Hw6eVR/J8bF9YjWGmVCpGKwQLBRCcrbiSxNLgVAxCF8XSl8YDHHFPW7xeFBRwv/rGqOKUBkODzqgdWPYAM53vTASMQu4Bx9J+69OHIF+N71F1O1gUB+AsBfFqKC+4Wi4BWX+CYgOTAU36wdMVNVKka3MoBWBhPxyiuko3xkSX9fvGMkqsDlzzHC1N6SQ4DoINOe7KelWWTheziObeKCdARApD1AdVnRH048gKUAmAEYi6Oh4DJV4VoGDWqjq4XLbO5o1jBoimEPhPJmwu9FvnTLgdgYTwd2wyXbMyRKen3i2eXXB245FlVYUpVxUpGiLtmGBlrTEhVUwV8dEkVKAq3MHJ1uzRbRx+OOgDWFX6MsXJU/36lJoEoA2AKvw8+uwTEDIBbStdOs8ddDsDCeDom7ZdszBIs6fcL9ror2C75US9IxJJsEsHdGFBil4yYuUwknofJgF4XcEUfjrz+X7fKo4EJJ//PkMORO6FrVjQMeL5kJhZMMXzLwNZCt1nzDFgYT8cQwpLt4hDON0i/X7ys5OrAJVe0S/ISgFY7j9ZvnQ7I3+lyqpYaL98CWp/N+nDkZdhi6bW8An1kP3fRTLKVWlwF6RZCH2L4zDDR0k1IqeTNb2OQSYNbOQMWxtMxeqtkY6I+ny9VEz6btfb7xc+XXB249AoXv85+tIBVgJJ6n4lf6oV+mfjdDJNMH0wAVFX90GMk1f5TxlS3Fggh92DyN0IORy5665KIfCktsl+K3VsGtpVOWOMiuDCerlSnjQ2rB+n3C+pIBdulz8wqonrNPLKgwKaC5B3s53qhXVq6oDNg6sOhqvqhEr3V2VNLBjmnSSNdrOLJ1zkAu6VPRjFcFz4fXDJ8i45hG94Gt3IGjOFYA8TTlQZ/qGH1oP1+8ZtlT1MAtHK8mQg25zOZUSCLIliWcbw8wfW5Ln04ssqnHX04euiCk6/3de66MPpuAQVZAEFkw2MKFw6a1wEL4+lSBvmAOMhD8vkOkFX77feLNw14YT/ssmc4A6oOdHBEkwXlgjH2k4Nal6wB4fIuX9LzZjAmorNeHMo5Tc0OewHwDTUh9HXxfGJsYkAbAAAgAElEQVS/uvCpoAcew6zBBrdyBlQwwoDxdLZWXLDFkHyF8xGE/fb7xR8XXByAAVC1oB18HQYIT+8uGfP75SCUs1o64he8v4j6cIQ+IqkPhxrBCHjdjBH6AblQkAeY1ondukSiELmsUPpjbyp7XuvDgAXxdNZVvWCLIfmKg6Bbhrjup98v3lVwcQLw8gqA5v9zC9jErutltg8gMxDWWMBaMVkmANWFyEV6R0uH2I1IzW7ypbkQOTP5f2ch9KsFkwp0kQlDAOmxzHpscGuGAQvi6VD4RgmAg/b7xZVlT5MATNXwqQc6KGwf2U2uGV2uzg3D4ua7fDnPwZcKgIdq9GaIBPZb0YdD7hgyIFWMXiH0eQ5vXS5HcMkc++9lz2t9GLAgns7KxxZsCkgdtN8vWD+vYDMAUpcja7lOR9eLVcIP4tcuob/3AOHCdW02VTX62ApB4Mv1v24gnPy9HiH03fJ366KYHYTHsgBBg1s5AxbG0+HLZaOp65i+ln6/YM5EwdYBwGj1cmUkE7+8THLNdAHhwrUOXtcrO/pwhF4cct2oN68BMDCfmsJM/n6PEPoYPp8bH3kCkbtjji2tJJA962YAWBBPZ0WBCrbYsFoOf9pDAiENk179fkuvf9nTXewKcBSjsn7ldonWbgQpx+26otaLIwAlfi2QQSJY3Yjy5i9dmsFM/oEDMM/Z7Uf0RiYUA7J+ToNbOQC3e0WBBm9qLad6HICG1ZK1XB5PoxnuOOIcxSXe/Of8xHV/P+FpwN47gKUpYHmuSve0pKZgCKSq5wqniWE1WZz/xouBm74KTMwBI17lVBXwtWSs+8/vL45Ff3vhpcAnvwos8d48DZX3M2hx9XIAnu0IIO0chu35AOgLL0yuG/jOmwbg028G/mNz1YWdETbm4I5BrFlov+EtD2wIo7l+Atg8D2xY7iw3V5diEqO54mnj6XdMAYcU+6gon7A3NSO2qFjlyZYDkAX6uD5Iam44YaUfVNDNxaJcLIPXcGGpfi6PnZdVD1wPspQBX/wl4OaNwN6Jqg+xwrxslcVFuYJblehkcYYZGPS3L20BxueBcS8nwg5H5kZkx6TQSbXFZcCQKadx5Cz5mPurAFxrRaa17pAR2PFC+ElSHKQ/0QjQcgCyGyM9v3SnsDBRJgL6msWCf6IfWeUJac8UFlpY8500DcCfvgb43hiwZwyYVhd2D/VSrKGAmIDnBkiafEcN9cprHgKMzgNjS1V7rRjRlceyrqif6KAkMgXIM+6tAnDl+zSL36O9+U8p9jGHQo285/2XA/AnXeNnKAorDXH/AILwbSvLEz6Ql2+cAf/3XcCdw8DkKHBwpOpFbE2wadzIdyh3jjNQirYWEwYq+/zJwMh8pf+xKNSwM6DZMmzNRRbM2K+2Ii6TlFrAWfd5V3i/F7IgT2LBF5LbIdkqxLPWvtzlAGQ3RpU3Y7AiixMxLOUB2t7pKQ8M0qCTnp8HkojJgNqaMEJesQv4AR3Iw8DB4QqAs+6SWRiqgJgY0HVDAdBA4Ba4xN7ndlSFAAjAYX4IPO5dBDMAdS2i+Jx7XTf1eEdTDfgAQnR34p/wQkRmjNAoByDT/ugFphXAmjAEn8qaPQAgZCs0lSckCNmVigEbFMsPBBE3DcBX7gLuawH7hoAD7EM8DMw48AhATrjtQwiXoqkTEwWd7LOneXNCbz6Tiq/TInb2M8ZzIFrTQbGiy92oGz7pXl/7jvdAJnb2470IbB3T77Sai+hyAP5voTqW6sKwFAc/TAdc5+3dvcsTrvPVYSK4SQb8xV3+6IaAqSHg0FDVh3iOIFTIFxtit9orL5Z/LD1Q4s+B8OnHVuXwhhdd5DoLGsgCCJ04q66X/Ju/vSaeAxDPvbdtmdtKDV90gVEPIl/xySkviOhmAEjrlzSkwj40SlQZYZ39I+8JBMx8mZryhOsKwqYB+KpdVSDFvhYwPVR9BD7uyX4SwRS59nNI+bRck/DzJ05v12M0nY8fAk8iWL5BB5qASPGRCi8EVjzv3mqpkC9ACrrwhKukB67GhpqRRowQMqCiYbj8oOoHeUWpdYIBAUj8c8WjrjyhNIJ1unzjDPjqXdUjJAAP8TMEzLYq9uOHICQALe/EwWe+QgddAqCzzD8+vgIgg0qp+5nYjaDzCgjmnCYone0klqP4JSgvvK+6LoFPoFMlkPGh+0rPWta4RHTNJJQz4M8EAGoNTPVU8opS64CC9zoAWTFChcq7lCdch6s3L4J/2QFIEBKA1P9mHIBmhPh3Ai354RyAAmWsR/PRs6vOR8Z8FMPS97yxtIlYgVB/I7jC0rIKSfLXF1EEB+BFFjQ3jCLA49OWsRTTEPzvzQEwry7VrZ5KwzAQAPssT9jw1dcHgCrORQCS/bgn+1HsCYQSveaHkzvGv1scgU/6R55Y1YIxhvOm1EZekQWl8wVDxJgwc88QiJc6AKX/meHDawX9z16M/Em7bO8Q08GBP/jEkAEVjMBoAFWXUjRA3KtNwOBXW3EkAZhrALktpC6lKtTV4OU7RHB+3kHWgv/zrnYZl2kCkF4uF8MGQGc+MqEYUCA0n1tkwxbw4ScHAHr71Q7W4++c8czwcBAmHVB/c7Bcek9b3FuwbdD/kjGWgzJjQ3thGmVA3jhfOyU+RxB6FamOFp8NrhsTgLy8Cpzm5QlVptAU+6CiNgXCaIQ0BcDYV8b0P4pi30vfIxD5+w72C9aliegW8MHzqrmh/meuFhYi0pKbs6D9fsh/n1XFMrYMbPgUByCZz6J+uEknDA9AornWFRb01WZEsACoHhOqyC7wdetT0QAK2KqOb5MCUvPyhLE0oQxzqaYNXL5xBvyVXe12vByLADjXAvgxBvSPGFGMIjCmJbEW8HfntxtQmxT0cmxp9UPAdKAZ1upA6EB7qgDo6oCUxXRtPVSpAwJpnUhuxAqWCCYK1MBExZljY5S8SYr+pxAFAuBayhNG26jw8usCQLX0SAAkwwcAEngyQizaXoziIli+Oe7/9kJvNk1LmBMe9ECO3XRB7aPeF0EYHNVPdT8gj016YBcWtBfBVYJuz7mF7VgGY/pO8f5WdQ1/7U67nIKNS7j0wIbDPFZsyNHHY7od/xdlEHj8CcC3TgCWHgGAPSxiSdt4312u/8SPAl8/Dlh4pDeZW2PD4J1c9+uyDaIDkgEJQKnTfG/N8nUAmu5HUnMW5ARbPfEuIHy/ACjRK7FL5pOR4RaxgTHofKl8r/S1ZWBnAGDKefbn3AFIPRPXB7sFiVQimKVgGdl5ooNwLQ1/1U+DQGSXQ9r5Evy1q9rZbP1lGQDZsPpzI8APHgXgod7qUx11YtBbFzC+/C+BL7SAWwhgdoLkONSLqy5oLogYft3ZI1F7EAC+phsAnekokhP4HIzml/PvthQWmPB9LJ7jxkcSr14jWj4/0wFlgJD5eoDw6fe4DzAYPHokWhHJZ3TFSkn4h7YOSOBwEtiMTv1aY0uktFYTmI2/43EMQmCuAJmUE0gmVD8EFdPpdnxhVhqzDr8F4NMtYM9Jfg98EVTeNu9Q2OFZBX7vr9vtgm/lcezczZ61ZNN8DCvilYCdPXqNDQpAlfGTKm0M6AA0PTAyoMSx64cRfPQHXsniOTI+fEWDFGp+Qb9BeySRBV2kpl0QxxGAlHDmkI56X6z+EP7UDYSdRgh/IouwIZ36lHabBE0GJ0r10Rgb/xA/tt/j/6aMAf+7R4CxzuBXWRGULwBfIrY6UNfpvLae7n0I+LO/reoLMqiVMbW38oUhkNkQIzZO7tIweGePcmWlAFTjAYHPVGwXxWoLYblEDkLuTT8MDPhXLJ4jALpaJB+ggU6xfgJknT7IKXIQXh4Y0FZCog+wxiUTwSkXUbSMV1rB/A31OXWuFpPUda/mRHKi1e6U+hA7Zq7l+A+UAfDtHg/LrptkQpZ727cRWOL9542Pa3rOvuOqagUltgtmJM08j4/PILbIDKz6w5PAHsbraTnMGdZWIwIzxIfeK0rn578J3LAVuH8CODRahV/FFQ/1IumIvXP1QudNfyNT8oVqcHviPcBd48A0g2RDuoDqHdb2SalZAdG9dnfDkAE0gXnH5ijWCDbKCq5/MRiV0QD8HgHQ63jG0hdsLGxA3x9Bw1Asli7hO3BwApgng/Gjvq01IHrXJ7q3Cz7E++YziF2rs1ZLZ+8H9jJsSoECWXj6igmR87aLgfbGq4GvbgLu2gjsHwdmCEIPSI1h+SkCRjpfUC3iNWcpoRrcnrYbuGsUOMBo7QBCxSTG/igxVcBIVGPWM1h1JYQPnyKNExGZMDIJ9b66eEBGxPDY1Y5nv+GCjfGAxD+DDpiawphABWZPjwNzNLAEIH4XCH0M7/5c93bBfI8Yk2cgVAdvdT10ifDkBWC/r9lGH51NhIsnsWHOfPmEUKT94WeAG8eAO8aAfWPAwVEHISNQlKQUglJjJExqC+H6Nq93kOpUg9szbwLuHa66QzFWkaFieXxi6hgVHOMCYGRuJ+5V4jYJIDKI9KlsAvFDq8QDrnb8NWVPh9EwdFkQ79TlSMIsN0Mi5s9MoOGno4U6f3YAvefL7Y7rvdoFLxOANSA8f7xSgWmd0kCQbmZ6mTLEnJ0UqWLhUkxlrBn6n3wWuGkYuGukCsufGq2iojnRFpafsU7MDxErJuZhYCsJosHtWTcBe1oeq+hxigJgXBrMmTBPnJKLrr+VED54ibHYvZos8sO+DNcrHrDX8YVVyglAKud0LtMjFPtNMz6QLDY7VomLJd671AEH4Xu+3g7nWq28ISvX58/hguOBg8vtFQvV/hEzxfqOevuTfpjri8vAWz8L3NYCfjBc6ZYHmBcitnFd06pxyb8W4gPlgonBqffTtdTg9pybqiVNBssyUsdUD7eGO9amnf3sXtxQipl7Wg/sD4A8AwHIyZMYky50Tp/xgN2OL8y051qw2hXzwRCEdT2nmck1RxHG+w5jeO9NFQBpR6ldMIMXlFWgVndqF2dVFsJzuOgRwMElB6DcI6rznemD0RnbwQiSRS3g7Z+tVIl7PC9kahiYZm6IizuLigliT/VoUog+p8P9l3wJ7qGEanB77k3VczroUToWLCsABud4ypaLCUoxf9i/9w9ADiICULrQRWuIB6w7nuZrwaZwLBGwClSqSyz3AhHbaRGEFGOmC44D72UVgjW2C2Z4lIF4ArjodODQcqUGqAxfcpG4mJVuVqcL5tbs2z/veV0tYK/nhTAqesYNHdO5PCJZos+WuzxHJIViuXFyJxupNLg976ZK2lizUKodilGUgzyGhokF8yw5Mf+qRkjdjfuDtwkkm7DTkNaBaQ2ox1q3eMD8+B6O3H6em8Kx1Ccx9ptWl9iYIUAAWrI3I3nHgPdOtsO5eOuxXXBdj0V1vOL/so3Cxef60tlSpYwveKf0pAu6ohfdJ8k4CUqgvr5jV6VGTBKALeCAh+VbZLTnh5gu6D44A6H8cVlkNK95O1WkBrfn31R5HSy+JCwPplAxRegE/2T+AloGncNmbQyogUQx/KwB4gHj8YWNTwRAOW0FIIIndoqNkTAxz/bd09XDGLBdMM6/pLKi5whAX60gCK2ujxzEAqGL2pQ1Jis5AJEAFHvTujYAKjRf+SEugm1d2COQLU/DAwQ44caEw8AtZzSIPgAvuKkdrWMM6M7xCMBoiBn4YpCE2NCfxWAA5MEuwvCCEICwlnhAHV+YORfDsWJGgPpMKwg1b9QpFnzHbD2BK2JGul9s8KkYW17vLALQRTCBpzXZpS4gtCXXMAkduuAy8E7PijPWprXJ5CR38ygw1fJDohh2BlRAgq2OeN7uTWc1D0AFNtmL54ESBsCaJcLkDajxj5ZXRiCIGA0waDwgjy8sk5+HY+X9ppUbJSCp6TnFCMXwny1WAFQ8rUAc2wUrRL6mXTAefWnFfnz3FpbagQKLAqAzoZjAKkkpXkNO5GCEvOMLFXOnnC4xIKOjnQGNdWSM+GqHQGd7JSsxUf+JzQLwhTdV4je1nQvr1MkPGtlf9yP2Dy+gAqZ6rQytfvdHSDxgLwBF8AmAYjHWluEDiKGMiqOVvtejXTBOuRSYJwDJAARgZAGWL9Nk+IM3SzgTydE4eec1nZHbtDaNAf1Dpd/SMx2END6kD0oXtFhBXmcY+OY6AFChnKnzl7NfdMR3qCAae2B+VVMYXASvDs3/X/zHJZcB84vuiqABEo0QPnhnwqQLyRURmZBPytnwHde0M1vN2lR6picoKULaxHDIEdHkW2iWg4/7b5zb7DSQAVd0/griV2JYojfpwRGEYsGBrOBmx/OgP5sAKANkcbFzNWTRnX/GSGImMYH/LYlk+gGvdT+bW+SWH+Ig1GqL5QeTtR2EYj5LVHfjw/ZDwL8yJ6TB7UU3VVoTjTYxYDK+Ivv7dzNAZIxpZSiU8jjKgIWTcykZkBawDBBnQdMr5QeTKI5iWCB09AmEb7+ucnOQ/aTPWn6wuzyS4u+R0Ob6CUGqJpIDA97AdqINbgRgBJ69CG4Jp6q/ckjXqB/RKla4WpkO2ODgHoynigA0JiLwaNiEt95YQKJ4FRC+7brKzRH9jZbN6iJYuSHm9I5iOAOhHNJfZkh+gxsBKPbLu3+JgaWDdojhMO5kkDWSlNTg4B6MpyIAjf3IggJgMD4MCARjFMU9QCgAykhSKnUCYHB9JB0wy5aTRUxmup4h+Q1uAmDs+hpXgFLnB6ULONOn5xACNJqxghsc3IPxVBGAiQG9aLeilWUJW1FvVXEN0TKp1C6At19TMSCBpz1dHtT/JH7N9yaxp6QkF73KBxYIr10nAMproB44qQGTj6sjUrtOFPtLeFQHLES9AdDFrq1E6M13MaxVCTNAXNFThIylLcor40zxtgDAPKuVwDMrOKw+SBTbtR2MND7sZwC7Qvm4wqHa4T/uIrhb+7n0EgbQdTijoyg+agWXT8llDsAFWr/B8qP1K7bT0pvtVwHhW6+t2C/m8svvZlawi2CKe37nhFtapkDnILRqBQA+v04AjMyn79EIkXO/DnzyCBwVweX4wxs9B4rRZgyPVFqykgDd+5JSpBU5r0vHyHz+jsc3ub0KABsZMCyQgeExKyFPVIz3lmcM6OfPAGCADYPE67Jfs6h7G0o+xvi7oyK4cLZfOgpsXwC2Lq9MwuuVERonKn4nSJrcXnQKcM7dwMMXgYcsVxkSebJgzOWPqdB1ad2f3gpsnwK2LXWeR9m3danUIV1lBSCPArBwtp+7DThuBti6UDWDmWA/DvXk8LRptfPtNUlihYZTOPCi04GH3wFsnwGOW6iAs5n3GeJJ+KLoE+9VDClQ8R6vOQHYegDYwuY3S6H/iJ8jb11ck0q9Qhoc9QMWgPBZJwFbpoFN88DGRWBiqQIgWyJY3lPozaGJ1KTEPh36zpTkJrcXPRE44S7g+Cng2DlgyyKwaclfFoIwvCwx9Zn3Q1DmIPx/2/sSaMuusszvjfXq1ZRUElJkKsBEGQyYhJCBSkUqAW1tsBdpuxEVaBzowXZqe1g90G2LotjQdmMjKqtBxQERdAWUAkUlZNBGkQRNyIAEMAkxpFKpqjfUG3t9//m/c/+737njPq9uVeqcte66b7jnnn32/s6///3v//++Tz0dmD0KzC4DM6vAFpd/0L3Gh6yTDgnvLwKzAWDGiH/ThcC2OWDrErB1pRgQisIQhAa+AED+HEEY6uNLyrRnZLSl6tSbrgLOeBQ44yiw8ziwfaV4UGbdegmA5QMTLFlqsfn7XecDW+eAmePAltXiXnkuZSBkRcm4UGXtU2uo3xsAZgz6y54JzMwDWzkgBOAqMMVBCSAUObh8QuN/CiTgcWAuyWhL1amvvBbY+VgxbW477paa7gIBqCnUrbUBiQuhAKDUot13IbBlDtiyBEyvtO5VDxvvVfxW/JkWNFrCeK8NAGsY7BsvKQC4hQCkJNaKy2LRIsg6SJ3IQSe1onKKC2CsOYMeN+0Dtj0ObDsGbFsEZmWp5S74g2Ir2uA22BScAJGA+dJFwPQ8ML0ETAUAkgDTPq9zdK/+sMWpPF19NxYwA4g3PtsHxAE4SQC6FdSgmGWRRIJLZJll8EGKjHiX1jwaN10HzD4BbD0GzC4WrsKMW2pNobZoCu6CLCDfCTqzgg6sr+wFphaAKQfgZHKvpRSYg7HN5XCL2AbAZwPrZGaj6ippXhgn0kqmU1woxnHedg5AATuWHig2FE1uVRwoxoX+Wcbg89S3AqCKPONcCi8oPtVP+9++G3j+oSK2xRBFDElUxbTS+3nvc4FpDsjxllXQoJg8FgdCQoGJJTTicLcQ6vPL6wbg9cDM4cJv27oAzFA5ky9/UOSvmg8oP86n0dICBn25JwjARWDSAUgBHN6vfdbv10AbARh8X91vDM2ss+NvAECKPVLCsHoyUgRqrlbnRwB933OBc+4DXrIC0IEmiLnE75di8HsyAcjzWUVGUi6uICMpVwwJVMXdeOk3XAxc+Hng+vV2esAYw+sWoP31r3eLcLwQBeQUrEHh4Jo2h4vDmJPuAyMLGAeEn7uqbgB+I7DlSWBGCwe31Gb9aL20kGDb/EGRxY6WTz8f2wtM8l4pgL1SgM8esHCvsuylME4nn9cfQLtldg6TZ0kUKorAfij23vAPCmqp3fcCl60XFINid1PlZrf41/dnApB6wSQjutUfIDJR8CGIQOwWEH7DywpKrWc8CFzqRLHkVYrB2jS2FQH5vkuBycXCAlIUUAAkCM2iRBA6+ARCe7DjYmQduLYTleiQ/XTTS4DpI+6nLhZW2nzVCEBaMLd+soIGqjD1ampdugiYWCpeBKA9bBJC9ActAk8LES26SqsftInLZ44dQif4Igdhym5WLrPDyuYH/7HTCNwDnPko8LXrBccjQaioe6BiKad3+QY/MGTH6rS3OBvCnQDuAIyqhiDkQ9RX+29yE3on8IwjxQPI8zkTiApGU3oVkD/4fGDieAuAdMw5MFQjEgg1DYsUku+a3uI0TGBfV7PotwHwaOEmbHEATvuDIutni6UAQoFRIFRYhfe/dhEw7tbe9Of0Si1g8HkrwRcevDajz07gIJ7n05rYyWIpb4ya/7vv8PRdFpj/LXDmkQLAnA4jCCOlTBRN/rFMAJKgkkVHpGUjySSBSFeg7/azqk8EgbSEq8UDRACLKDXSyaQ7Br//DcA4LSCtwnKhTEkQcmAIQhtM+Uaajl0uS9NatITXWzpzfcdNB4DpY+6nBgDaCtanYLN6fCj4u1ay0QIqtML/EYC61wSA9tAJeP6eWsAoDysFpg1eB0HIQRCIIkVeCqQf/05P3WCB+UPA+CPAzvmCaFWDKEuYcl1yMN+Y2dckqGTeHPEvvWDSNhOAfbefX0A6rS8CUw8X9066bFIfdqMHJID++DJgLACQumyc3gyAEYRRKFCLD1eu5ODLF6QvXedx0w3A1BwwxdAJLTXjd8seQnGrZ9bPFxLyA7WIKON63tYtCQBN/sv9QPm6BkLp0vl9t/m6ietR6fbyBA4gnXtORwRRpNnTtPpW6gWLH83lKqcOFTEnDiKtoHwy8RNFhrefyeztbnrBfbWfgttsP+kIyO32ELD1cHHvInrlvWs6TsnB7qAUlg/suFtAWkE55zYQ0QpqcALoNCXTEt7A3KoaDwGQfqoAOEUBa7fUbKctltwCajVbxvSiyvoasM0BaBKwwdKb9fN7NfcqBWGiSWykWXER0umeacUEonQgCKRfIgDFjya5yq8Wfsfs8dYgiuMxgpAg/vnMzu6mF0z6Zj5APdvPQec0TEosnvQosGOhaLuIYvnwEYSithE52F1XFAA0p5yigD4otCqygFKnpHUpLYP0OcKURYv6Mj4MNR433QhM0gL6QongawOg+6rl9CswKoSkEIxPyTsuAPigCYBmAXVfYcVf+n0SRYw6dP1YwNgHsgSajiJP429RrpWOM6cxDiJB6NINM4w7LbUGMQUwB/M9mZ3dSy+YVG0EoBiDBST5ddZ+PkCsAiIlQZDa3LVatJ0WXG2PbL98AB+4omB3oP/HgTUhmGgBfRqWf2TTrUSjExDSP/qWzQDgfAFAWyzR8rkFtDAKX75jo6nUguZxZ8NByHbvvqBQ36T1swcsBaBAGGRg40Ir+rt9WUDhQ5ZAU7Es2e9LLzglqHRxNkbeuW+oQRRls5jaMjnK0a9ecNf2R4LAwO829kQB3LTtEYQPUwzQAWgW0AGo8AQH0ljp/V17pm0KRcEifGuNOnocO1rACQbKPXhs8TtNwVr5uh+n6Zf3wDgu29g2FdMtOc8B6PdpFj08ZFrplw+ZA5FTvAQQ0/BT36FPDkRqBT9Jag7xYlQItY0f88j78sZzCcKPZlrAQfSCK9uvB4h577SCotUiEJ8opq8IQFl/PUBPEoBLxbRE62LSqG4dFB8r5bHcOtiOQSqT5T7RKzYDgJx+BUCCTxZQCwhaQc9oKcEnEBKknj5FsJ1LAPo9xoWWPWDy+6IIoqbeaO0VA+zHB0zxIQDKkn1GgtXiRxMIAx0Vn0Db+lkuFjLRCt5WEwD71Qvu2H5OfekD5FaciQay/GIbFgBXriwAyGmJADR1ck3DwTE3TQ4B0LetzBJErTYAr2BBSI3HTS8tLKBZPo/fWQDZp197Z3scjGb5BDp/L3+njMweB6B83Gj9wj3atOsPWin9WgXCFlVO/3ctf4iD8XkBkH5USlAZlNPZAQqARr5vxu1yjmH0givbX0UQKI63o0Wun/xHuR8E4VnPK5JQLd4VNttTBvK2uoiKOUf/f+GjwMNBh0NMV6J0c0NpcRv7mrYv3kh8/uHxYp+bVpwLp3R7sts2YzouSq3KGa+q7+x7Co4nazAerRKsVlV1QitF59dyyFZaYY0HMu9mWL3gtvZXMbymBIFMZ1ov2h0B+LTLisxgW+Eq5uU92iZ72ud9vvR+4JFp4NjkRh2ONi0OB1/UBCkvEYRhfuNs4OmhhiPKnFQlx6aAjMnSXJUAACAASURBVPjmz1w41nnwO4cCIBvBwZgTAOUHRq3gyDExD4zRGVYEnpm5LqmQc0M5esFt7acFl0SlHiBxuTkYxxdaihUC4QVXFu5FCUD5QtJl85sjGA0ziQxqeu/fem+hw0F2fLLQGxFlYMRvo7v1WmIVtpt1DFkXvOR7LwJ2HSkyoZmEypoVVe8p7b6qEMnidGG/Vl/L2aPOIwuA1pAIQE3DAmFa4j9f7CPaFpCHKujr5xzZesGdHqAqKz5X+FLRAl58le+jui+kTBALMcgZ73CDBkpN2/7+bfcWOhwUyCEAjQTcAVhKdjkPc2RajewKyu/n1//qJcA2uhBMRGXQOcn9U6JIOjXHQqSYOsVoQp1HNgAvz8yny80H5PVz9H6RqVd849WtXQ/zA0Ow2ayGLJ474L0G79vvbulwkJi8BGCg4S01SKqofoNvSIC+5zkhFUupV8rUTpJN06KpaBkFQm5M1HlkA3AyM5/u9Zl38zrk6f0iU6/4hmscgK5ISUtCTowyDqb7UxwsqFJW3fo/vbuIBJEZ1YRgyHwQKNi0KEl1OKTCZJdxtPDn//v8ooaDaVgqFyiTD2IKfcjZS4Fo+7g+HXOPv84jG4DIzKfLzQf8KVfI/FNKrQ6h94tfz+vOA9cGAAbrpylY2SDlVTTt+uCnV3/V3a7DQQAysJAwobZJgUXi78Qayhd812WeiOAZzEyUiAkHMeu5BF5FwZQAWLPwknkLQy9CrPMy8+lIHZFzvN3T+YbV+8X7c64OHHix74V6zIxB+RJ0wQ+UU992tYoFy3fcXcTDxQkoPsCUhFIczKVCegSg5B8A/PILN9ZwxBSxtiKiUAOi7JW0dLTustF8AGbm0/1o3vjjnSGdj+lYlGwdRO8XN+c1wABIoHk6k61yuSCJITq3jDY9Vx0BqK++uwAfX6JkI/hME0SC1EGguiQ+isqcQRLrF6/0jO2w+6FMnZhyZYsQ1W50qOHgPX1NXndtODsfgMwHzMin+0+ZN0S9YOllMzWfLwKQSS396P3iY3kNOLDPM1y065H4gOW3p4uTDkB8zWdb7FgbdDhEgJkCUDRvogTmd/vPv3BVAUBuvylNzAAYi4hisVQnEHoIqWblrxqm4Mx8ujfljT+YjsWBYgIOc0oJPsq1slCpH71fKybJOEoAuuVTRSCnYlmU6P/Z4iSJEcbLv+Yu9/1EAh7JKEXDKxq4ChUiKymRbwjgHdcUWTARgLYXHSr2LOU+BV7MVwzxwOfkOWybYAGZD5iRT0edjpxD6VhcOQ6j94tP51wdOHBdMeXa9OqWRcmWXA1XLUIUH6zyCwlAs3z+YBkfs1u+VIejJEF3ckrjI9T0y/aMA2+/tgAg08VURKT8vbKMUgAMIGzzAcOi5HknHQAz8+l+MW/829KxhtH7tTz+jIMAJPCYMULAWd6fvi+EY9ouoZBM/Kx/4LUBgFLgNC5o16FrE8JJVJgkiFhaQQBv3+dVbMrWVsC8UxFRkjjaVsW2DtRdOJ/vAyohVYK7A+bTvTdj8HlqTMcaRu/XxHkzjgNkIOWuDr8jnYYDKDutgpUhra0uAlAyCCUAK8BXcjBXgLCk/h0D/hcByDxFAdAzoFUqUBYRJTUcMWdPP7ONL6i5bLQeALJRQ+bT/W7G4AuAOXq/lsGdcRgAY+glLkYclJVTsa6ptCX3uQjAKINQstFrAZKIwWxQIhIJuovB/Nx+r2LzFCwlj8Y0evl/MYk0kieVtcvrwGUnHQCVjjVkPl3mItQsIPuElx9G79dOzDgMgGkAWlNyBJn8xKprBRC+zgEo4LWRgcdVcOCjjlNvmx84DrzNAahaFZWLygKWxUNibIhTcPD9BMLLa65bzreAMSGVoXvJ/Cgh1WUfO+XTZS5CDYDs9GH1fnOrIDcAkABTTDCCLYK0Cwi/586WcKJUiEpC8CCBYDsiiSplqUIUmOjf+o2tIiKVUJbgU5uSWl4DWwX4+PcXnrQATBNS+8yny1yEopdcay+930y5YhgAg+9n2OoUeI5TdQer+32fdhmGoOBZanBo+g1yEKU4dYgFSvqB//vZBIBt9RshkTbW8ZZZ2hUgvDL3iU3uux4LSBM0ZD7dPRnTH08VAIfV+2XAOucQAMuVcKfFSD/+IAABsEoGwYAoHZIKEEYxRIHwLS8pUuhjFVs6/ZZhIVWyxVKBBIRXnbQATBNS+8ynI4tBzkEACv+chlUVIKE/5cRGsWmlKfIzudc3APLQSlg3E2OCyVRc1kpU3DgBmKoQsWtlBcswjPu+nfTYtBL+GQdgOf16GCZW6pXlBCqWSgqJypoOAFfXXDifbwFJLvi5HAjlnUsiIe6AjOp4iQNQHRlT2PlgJCUbbc2s+v/hFwFb/q7gm6HlYpBbmTV2sscQyy/qFBj2v0/cAdz/HGD7NDA1AUyOOU+1CwWOewNjKj6/O03F1/WuugW4/XJgfBoYmwDGdH7IxB5kLPIB+I8AfNwZgga5ck2fJbEm8V9zNWPfrasbgMuPAcuseJ8Exsb9FdBhA+7gaQNKB6TfcgCYug+YJT+g89aoBDMmIMScP12uTKj13uDv8zsKig/uJ1uQOsnojm3qB5P5ACRBH3OhPuzzRN9DV88HqQLEWPJnvTy5nm/t/1s4BcuSpRZtGAu4fi+wtBVYEyccrYwn6hF8/FkJp9bKxAKVFsn/d8urgbHPA9NPOEOWl4+2cfoFHhfVrJTZPKHSj5daOtup6JyCpPx8rHWRVQ7WOlrYCMx8AHIzlxkALPD9c0VB+x/A3E/+E2fUYHXdF7KTGwdvTd0AHP9r4PgWYG0KWBdfsBdsMPfPrKKsoL9XAVLAvO2fFylCE4cKliyrDVZNcGS1CqEYhWFiAZV+XntaURdTLmpCEbpchTYLqi6NrkMCzLzt5Xc4HwyJmmkJ+Z73jQOh4NWeDUZiK1K08f0EXt7CMHVawIk7gaVpYJUA9LI1Ao8bzKX1cytoFtFfpdCIWz7rgzHgth8u0oPGDwETc8CEMySUzFaikgtlpW1Ta8JqNba7lVljSRgW+Q6ZP/57WQvj6fydBjXfAjKbgEvMLwWCvhNoipgNpnQshlS4IGFWzIk6ylWwAz93ETLxGWB5ClidLABoIOS7pmGfG+33YAG5mND0G8F4678vkiPJczNOAC4UyQm2N8w94kirFlfIAl7i402d6dbPWWAtrsjOFiuCvAJZOQE0pHTFsckHYDeCvhNgipQNxoAz8/8IPr5nbvH2jd+6AThJAE4AqwTdZKEBLDoDgU4+YVkPHIBoPwareOt/BkDexsMFAFnbzNJYm0IDnVwbt4uyur1kwL7Tp+iZM/08WT9Rc7DHUmuYTr/x+6o4ovvu9fjBbgR9JyA+omwwxvZI5ULg6ZW7y9FPf9QNwKm/CgCcKABovh8ByVy/UCtJq2f+X1yYJPGU27lIZLbuEWDsWBHesZeDz4iURLUWa1TE47LqK12fZmd3OXidFctqm92KatVs1jAEsNv6sdymaa2g8+xUL4I+Pn2beCgbLGWHI/h8G3oTr45iK86POlbBU9yKI/AcfLR+ouQwH9BfmmbLlTHboOnZ/T9+5vaf8FUaAThXsFOQ45mUcgZCWTAxe0UQ+urYMO1/37GtxQmoLCBtRSp30LrDp2SFdzYMgk/R+VNwvwR9mwQDsaspGSfJgYDYNTbp8psCQFJxEIBkQjDrxt8dXCUIY+COH5MVFPi8SOn2n/QYLZ9Gp0cxANIP5IvAkzVzxivRydnKNzBa8fddM84b6AFyAriMF2pajk9kYIeoClXmA3AQgr5NQEHMBqMVFMNaIOayNRL/vhlH3RZwmhbQQUcAasrVVGz4EtjCu/3dfb/ID3PbT7uKAZ/MhcIC0vqRTo4W0IBIEAmEtFwCYqjW03bcmdwBYeoWgetUbrR8snrloiR2drpACf+rD4D9EvTVjIJu7HBV+781X752Czj9lwUZkTEgcPoNPp5Nv4oBRhCG6dd+1DkMz1JIhR1BAHJ7zwqO3fIRRM5tmDK5CoQKsSgOeBYBKFZULTqcB9r6Ni5KYmd3WKDUA0BlhNLM8EbT1QBXBU72aI5ZjUcVOxz7WLkQ8d37vsart/uA6RcPsxNSAtAXHDYNC1AEpf9s01kKwuBwGU7HgVt/1jtD1e60fgQigSe/j5bQp+KYpGB+H62jT7P8/ZypBIC8Dhcx8eY9wF015abhmnoAyJ5WSrKeNgKO9SHxnT/LSasJBim5lRjWBEIVeROInKL1qunybRawLgASdEy74qjaNNzJCgqEEYzBGvK0297mAFSHEIB6ebKDgc8J1ksmV8t29f1en6L5v6cxIK5iK6Xne/5jCTiFcTqVn/r/tWDPWwXnEPTVgIKUHU7ljASawKefIwDpMdRxRB+wFgD+RREDJABpwSzz2c0LfxczVjkVKwaYgtBBezu3SvX08d39P5uO3QKahXMQciourZRAGKZWar/YZ1xXRPe8wQr2AUK7TvbOVTZBXx4MBECRnConUBSFEXT6mf/TK+/qmzAF/0UBOPqBZYF52HrTFCw2LH5G8UCzJEko5nZqmRnPh/uCXmpnVpDTsIPPwKApOaSA2QLDLSHf97iPx0tpISLfz7bl4iFfsUsnj+HZWEeOYDCDnDmCvZkEgedcCjxGseIhBYt3vx049HwMLRh8gA9gh2MoH9ABqKJzxf0McO7XlSAU4HzhYYFq+5D7hwBu/98OQLlIBCKnW39SlXNY+nqeiq2dkQg+gnGPb9/ZpT0lq6MV5D96gLCwgDmCwbdnCvZmCgY/dxy47xxg5SWuUjigYPHFbwA+fyGwfr2rXrMvPB+vp3L3GHCgi9JOHQCkRVPppeUBigXLFymyejYTB4YsgfA20ofRAlYB0FfAlvQqP0/TsX5PLOB5DNu471cmIwiBaRww/F01J+mz2pqChxUMZvpJlmBv3iTocsW4dzewfhkGFix+2febXDAeJO/YEILBB7pU1g8LQFo98QASVGYNQ6DZfEG3fnEqrgLhbf/HV15anbkFNCvohWSl9XPQ2XTM/2s3I4DwPIZwBEDfgitH0Ek6N6x+u/iD7T4g/YdBBYPpWHEaHlqwNw+AQa4Yj54JrJO+aQDB4pt+oCAyYvOPEIQDCgYfeF/9U3AbAMX7ItAlVtAspKZdz5SOlvA2pstxjES3wJ+92NgAGK2gwi78QoVfEhBeQACqNNP1RdoA18kKdgDhxkUI/zKIYDCnqyzB3jwAJnLFOEIW7QEEi1/1Y21ywVglCAcQDD5/Efj7M4CVrZ5AKlkhxeQUaxBI4nvFzxf8IfCVC4HV7cC6ZEX5nen3VX1vAGLZq8ysrvHY+QBwbGfI2E6JpLvdX+ksthpUvQrmX/sVDGZVUJZgb17vJHLFeGQcmCdVb5+Cxd/5xjZ6QzzMLOQBBIOfTV2Ps4HFHQ7CLQUQmUrV0rgKJMsCjsxGAqTn/hzw0EXA4tnAyg5gbTYBorKkUyLnkB9YVhTxu+kT13iccwtwdBewPAus+b2ar9xJAafqfgMQO4dh+J9+BHe5gqZZZzYok1JJUcpaR6bp93P+W/N6p0KuGIemgEWKgPQhWPxdP7NBLhiHKYHUp2DwpZ8rLOD8tmJQVplOLxAqmbRKC6EDYC7/CeCRPcCx3cDSrsISrs04CPm9ArZk55UvKAspYLqPaPdR4/H0g8DRHcDyVr/X6VabLHk2PhjpPVZY7d5xwF6CwS9y/4LbbVyQsEKIufGiKe0p2JvXOx3kinF0GjhOQY+oNRtljji9TQPf/fOV9IZY4Gq4D8Hgy/4W+Oo2YG5bUUy04vUcLCqSJVRWszJbNgxSmMau+q/Ao2cBR88EjtOqbgNWWaTkIFz3YiWrF4nAjtN0nBZrJnU+/8PA3CxwfMYB6LUra3oglL0tps6wlVha5rLiqd9AdDfB4Je6U0s/0BXTDYh80Sr2FOzNA2AXuWIszABL1JaKWq1R+nwGeM17OsoFY5XTVw/B4Cv+Djg0C8xvLYqJCECzgsxmZlq9T8e0XGUyaUizavPtxoFr/zvw2BnA0Z3A8e2FVV3x6c4sqwObckeyhiXAowUSADhD1XhceDMwx37lvU4XxVN2n3rJIocygkr/Vbs7fe+EdBLcfaXXQ3IPWIrpBB6XlnwpR76jYG9e7/SQKzarxM7qJFj8mg8UarMV9IZ4gvNDD8HgKx8HDs8A8zMFAFnPYQPDl0Co2g4fpDZLqKCxT0/7fhJ4fCdwbFvhRiwRgJruCOwUgCpeCvUjZmEFxhfk9W969kW/B8xvKQqnVgg+B6CB0MsI7P70AHgmd2n1NQ0rv7FvALIlVYK73MnQCDLThSGZoDpuP7uCeuX5n8zroB5yxThGnQ0CgyBMxY63Aq/5aBHG6EBviDlOLV0Eg1+0AByZLgbl+HRxnZXJoqqttA4ODovlJZVuSjTQFtq+NwNPbHMAzramdVpVs6wEoPtdNg37wJfvsYiJP9NFqvHY+7vAwjSwxAeNxVO8T6aNVRRRlT6hHrJ0Ovaw0WDJCKng7g86APvNB9wg2JvXO33IFWOBgn8EIf2nRLD4tbe1+AU7yAWbZeskGHwVdd2mgAUCcNKnJgLQrZ/V9/Jnn5JUYmnAE3hCmv3+t8AWQfSzyPK/POOgJgDdsgqA5nfJAvLdLV+bz0kK4RqPZ3wQWJxyAPqDVhZQyQr7gyaXI9axWCFVAGLvRUhV46PgLnUWBs0HbBPszeudPuWKsTRZAJDTo8l8ui/42juL5veQC7ZpsEow+OrZQlqVVuH4FLA8WVyDAOTAmHUQCAWQkOlsQAwDt/9/AE8SgPQpNa07+AhAA6HLXbb5Xr4IaAMfv/eGvP5NzyYA7UGjBWTWjh40v9fSyscHLtaxhJWxFVsNNAXH1khw983+DYPmA5aCvXkdNIBccemfceooAfhAAcA+6A2xLuAGucxrzgKOMexDfV9OwbS2BB/BEoqLSrBoYGgJ3E8qLcIEsP/ngCPuUy7S13L3wb6PU56/m/Xj4Ps0TKCXQA6AXuNeZY3HMz5QANAeND1kwcKXlj6wOZQ+b7R+Pi0PD0DeFAfk590CKg8qncfoFzIRVWVqfFfBhgn25vXOAHLFWCDbvPstBsJZ4LUPt+jdesgFg+qVptWq11bg2gtgfuLiRAAgQeg+oEmsOujsXb5SsAoCIN/3vx04OlNM6Yv0tdx1MKvK7/TFjVmeCD4HQQQhf159eV7/pmc/kwCcKABoeYvR0oept7SEoZQ0Tr1lPuPQFlAtO0nyAcWhpzw/FSjFzGjLx+RGvxzoSeC1hwsA9klvaFN5FAy+9mJgnhaQ0qqagglADo4c9AhCDpJPl5ZommQ8738HcGw6AJBW1VecZv0cePwOY0/wl1lAD/WUCx0mMlDLr8bjmb+Dwp3x4nkDYbD0thIO5aNtfmDi/xGEeRawxhs7Vb/q2huABQJwAlhyy2cC0xoggjAAUCWWAkksOiIY978TmOOqeqqwqAx3WGhHK06n7TDwOcAV/iipPAKjwgrZm2o8nkUA0gKmAHTrp+o9MTrEYvq44o9pZIOtgmu8mafCV72YAKT/RwAy5OPOuVlAAk9Oule6xQRTWUKlWtkU/IvAHAHti5oIwDK841ZPFtCmdr0U8PaC9hVultd4CIC8P2Ztt/m5/qC11TJXlJDGGpfGAmYODgFoCxACkLpuWh3KCgqE8gNVZK4KtxgjJAB/2X1Krao1rfN7CWZf3LSBT4uAEIyWBVpipL7GgwA0AW25GbGENBTRx3rm1M2w39mmrFVwjTd1Kn+VAZALEE5LtIDyMWUBvbLNLGHgd5H/V07BDp7r3uU+Jadgn3ptxekA5MBri0/Wp4wzBjDbCnkMWMqVpE8GJwLQqvfc0pqbkVj5aNk7gbCxgJno30cAjntowtXNaZ1suvSKNhsYTcVKmw9F5xGE+94dfEoP+JYhD/8OC8eIPUsUHokVVKB78XszbzAF4Pvd//PCKVGIpOAr78mn4DZOm8YC1jco+w6EFTDDPJqeCEBZBa5GffVbhmQ8DtZW5TYOvPhXip0GTuu22lTMLSw+aAVl9QhEWjurI/aQiLJkTMLsX9R3r/ymZ73fp1+37OU9hunXSkdl7T3QrhKCtlCM59k2i5CMMSIAGdqxEIwrmptzTsCEut5yilKoJLAcxCq3fe8tLCDBFwO+tKjyuxSCMdYEXoeDrHcHvu0tTwLzmwHA4N/Gh6zNCqqeOSxC2lb8tQSiMwbuqXIqAcjFh2JjBKGJyShQG6ygVbfJegULWBYcMR3rvb6oCRaQwFPgl1M5rR7/JtBZOIZWx/0+s4QeY5z/1/X2tFnAxPpFELaVkdLN8MWGVr4pCBsfMHN8bmTKfCjZ0Ncp456/x58zLzfw6Qf3ABd8pUgEYmqk5bGyek06IQl1bkXScnlN/u8L24Gdx1qVq91KQvrpgwaAAw9p+wnXPw1YjyWMGtDo2ASOFGMU7SIEUzdYD34vMPmXwLbHgdkFYAtlGiim6DpxJtvq9LtlVr/aWKEB8pUXAOOPAFPzwBTZ9r04vdQ9Ts4pAZ3cd+yHxgfMAOH+vcA69/9Uxijmz/AerYpdar1lNSMYzV+vWY/34I8DY58Gph8Bpo8A04vAFEFIknIHohGVR62QhFRSYjQE6qFri2z3iaPAhHNNlxKwArI0Q1IAxwfReacbC5gBPp66/5ICgLKCtqnsrKKlrFZUFPKOr7osMTtdsxzqQRZ93Q1MPARMPllohUxRqkEK6gShOP0S+dY2hlRv99y+ovRi7IiTnTvLqmg6xDPYpqAUgRgsoR7MxgJmgHD/c4E1FXu7FRRbvEgd7evXWlbPpp9EgUjiJpwe6zwOMlvpAWCMVusJYPIYMOlSDZRpoGiNxKzbdIQlXONMWJbGtw4svdgz3El47nzTRvPrrKptAJT6ZrzfintvAJgx4vsvdQvIXK5VYF3sUZxmJUvgA1FOvwF8spKyBtM1y6EepI4LqVMedbEaTp0EIKdPKh5FqYYqSxgo2jgFr13j6XXHnOiSZOeBVSvyC8qC2r05FVvVw9cAMAOA178AWPMp2LJaaekiCPXExwHw660n1oB/niGQazwOkkSepbJ/72I1x4CJ+cJ6lYI1riccrVicUuVSmIW82pkwnHHVOKbFsOozQGkFkwewnBES37ABYMaAX39ZAUCCb82nIlo+40p2gNnvsoKunxH1xGwA/LOzdQOQJPIuHzV2GBg7Cow7AI0l33XfjOsv6oVodes6ISbBsAZMX+kJxU56KY7pkmFVhOciuvTzSt05v0+ryuT/9gDrZNe4wPMsI7VJP3GcP7gUOOdvgL1rRYJ0ZI5IV3hV4/wrGYPPU3/AiRhYusy2K7mU999P+z90ObD7LuBZK0Xdkeq9NSX2+o4HLwfWlopFCC0fgciBMtAFC8CGrYXVoVjnU2G7rTXrzh4kfRzLY1kyGwBoeiGcPiXb5eAzdXWnazPCSScb4j3xfmav8Cx2p50lAMW0VXINitCogl2r9H2dcctWwQxQsn6ZTBbMNtcgdKIbiZj51VcBk38CXPxoQcfCUg8pjcYgZScw/momACnXyr4leBhs5QaBTHpf7X8dMPYJYO8XgAv9e8QJlAZZq8D4xSuANYKPJQn0AR2AHKy1MACKe9nfFI6IEqduEWoHIJ9wlsVKLekoMCa9EAegSTYQeM4TXco2SEMkAHEbBZoj4bbYtdyCVrFqGXgTSxgXYTZeHLi9AMjEQRCVUXP/n4KUaaT8vVTi+Rtg7GPAuYcAWlMCgUVkQfJ2Q12yBvPXMwHImhDWwf81imsTiLSEvHZkr+jY/p9CQRD4p8DOBwteItai05qn31FFdfLlFxYWgCDUIkRkj/TxbCEi/89jfPZ3X2VqYSJQbmUNQY3HQT7hbv2sLoerVwKQHNEEoCsm8R4MhPRjXUGzVEIKIoY7yaEYuY4dgGb5RXruoSgtSCLLarkICQ9f6QNykGjFdjsIBaI4kGlt8W+Rg5g0HJ8qAp47nihAzFpuWtPIMBZJlASILvR6fQ0DCVbJCkJOJCqnk4pGpb99tZ8MopyiKDX7WWDiwYKXiEQOehCrgKh+eJQ+EQHo1Lby/zRlyf8TIbf9XS5ftIb8I92YugH4ay2pLusorl7dAoonWtMwQSTdOFuQSLTGHyIC8kxSIQuA4hwU2WUAoO4/grBcDbsfWElSzg+JCoYDoEGM1ixSkHzgF/wG7y8sIa3J7JPAGWuFJSQIaU01iJHUiYP4e33BrPOHmG/JMaOfTZVYRhwGav87vWKPJ9/rSH4IOGO5sITqg/ggxXs4TOaBAECbeoOsgfl+DrQShFqcEIhyyt0MbMusEkx76iAZXKM8BvXiZAGlF+KaIbaadYpem4aDgpJZQz6YJABV5VcHAJZ0v4FxX6KG5UpYs0KnqjhRuagEVgPglYAl9ciHf8mdUrJh0Qx9vkDBzBywfbkYQIGwahA/kglATsHsDzKA0BATiPyZ4NEDwIeoa/uFYKKXL2f24nQoIgd9R3yQCMTFqwIAfdBWI7+yB5ZLECYLETd85YJl+2YAUNosLIel/xYlu4Jsl6bhNhD6it4WJCvA2Zc4Gxo73RcgJeOqFmGR6rcChLYACyGojmEYdj59KnZ+tIQRhH9IvWA2hiREjDeRI9Cly7fMF3EtWRFawhQIf5IJwE56wdTIYdt7tp9ys1K8JnoJvod9Wn682PNkP4hUy1ndWgstAtBDMLYN5/6PAc5DGNoF4SrZfN+4+IhT8jqwg2Cp8ThIJ5vfSWBXAVCrWN9SMxDK+skaOvhoAc8me654pmUB3f0wyt+E8FyRAGmPlOEoiSD2qgvmAKoOm52fAuiTDHSyIRxx+lI0QxxADubfF5vffMmSajrWlP7nmZ3dSy+4r/ZzAUEHnQ8R70HsXlK+PgJsW68G4XYGZj0EY2EYATCAT6tAhmE0DXcC4faapcwMgAIfLb0kuzT9Qmw5uwAAIABJREFUSi+EfeALkSrpBovbrQDnkm8wAo8/E3i+CCsZ98NCpAp8cUekZyBavI4ET/TnaAk/RQCyAXy6uNSPA0i+wMeB6ePA5HFgZq2wpNGK3FUDAHmv3fSCe7afX8CB4UNEEOolVi/3obastNwJ9cO5BOBKEQMsAcifHWzRAigWWAlCn5K2bQYAOe1KMjTIR2kRUhKVS7IrLia0v+3xwHMZMCbYNP0KfG79zAqK5DxOvyEuWu6VD5KSHy2YAEQAfpaRdl5UkuUctIpBnCIIl4psD03FtIIP1ADAlBuJM47EqqUX3LX9kSBQcuuyftK78xUkHyQ+RLqHZ3Fv1KcgLj5kAQ1s0Qo6IA1nHhNLQzA8ZxvBXuNx8DcS5UYpNnoYxsCnUIqvZo0F3wPTMa7Hv53HOJVbS/l+5bumX7d+5WLE44hxIRJB2NMCqj9ixwuE90svWCaIA6bAp959EKeWChAyA0PTOV2unGMQveCO7bfqHbcS4rJR7Ewqnw5AWhLuImg2uFQAXAVs8RGmntW4+g2hB3P79L/EJ9zGvqrxOPibiVihAOgrWQOf/EBfBcsPNBBqW9Hv6zzGqFzmoXz3B9AePgXiq6bgiv4YOB9QHS8AfpkAFMMjrWAcQA0iO9XJiQyAnos2vV7ESHOOQfWCO7Zf7F40mZFQScRKAYBaSU6vAVcTgN7xXHiUFpDTMK2dFh56912BTiDcvpkATIXzCL4g3WXTZ4jpGfjoF/oihL+fx+0yWUABLwIwtYKKIabgCzHQvi2ggBKn0McEQDaKT5cGkIOo6SuyYzEfjQB0EM5nZgAPoxe8of3sgSqCQM3jkdFLvpRvR13+7UVRuhUFSavNO6otwp88ZZ3+t4M6HLtch6OT9AG/q9cmtf//gV1JDYcnQ2zY6/YakfSrU+Pg1M45NqPt3IEtoM7WFHokyrWKkooglCMWLYjiUXMtK3g8Uzd1WL3gDe3vRRCoUEYCwGtYFxxqgA2E/jI20F5hhmQod98BHNnlxOTig1aGiDanO21yV4DygWuB8YeB6fnC9WEtiKVVKeE0ZGiXWczeJoWMIig5a9V5DA1ANoKDeDylZ9NSXxyAsiKawrQqmCv2HVf5e8aRoxfc1n7xs+khItAUvojvyWryxVcWJZksVSyZoQRA3dcAoHzax4Gj2wtu6FVKM7gMgti02jbV476oUJJs1j/AbA1mQ3Pm8eTRsoZDtR+xZKCiEKmMXTIeXHPGdhYArX8FwG4DGMEnAHIK4yvT58nWC2b73cexaZgWWaEKgU1gjNbPP7PvOYGsUSBkv3hBtmRWNzxjTk9RWktvxp6POj0vARjY9sWkFel8RWxegjIF4RjwAOnZWMPBTGjqvHmszxJOBUD3xyznL2bqROvoP3N3q84jG4C7M/PpcvMBef0cvV9k6hXv+2Yno5QfGArRbaCC0mWv2YtF3ecerNDhkNZIIsXQRv5dlTtGADJSz2gEE1EJQM//026HdIEZLC8B6A0tk0g1Ja8DuzJdphS82QBEZj5dbj7gxZN5er/IZI+67pscgE7QaDOUMyC0Wb8+gXjuR4F5J6YsaXnFhBoAGEVvUhb60jISgCQnoh/OLBgvIrL8v7DdFkEYM5dtNg97tvz5zJqzdfIBmJlPl5sP+DJP5xtW7xffnzeh7H+Z+3+RpkyWT1YxuURJYVtx6T0fCTocouQV85VkHRIGegEuEv/YKpkA/JceVmL8kv6t5/9pu62tfiPWcFQVEa0DZ9WcLJEPwMx8uvfnjT9IgZyj94t/ldeA/S9tMaGa9SNdmsIxbvVscVJ1GScoMt4UPwhAsmMZ0aXzQBsvdGRBjQz0FUpEJRAJQOq4KAnBdz+sfiPJ3bOYn8fsykyVWMfiN3BOzckS+QDMzKe7OW/88aqQzsfE5kH1fvGjeQ0wADodmVGwOeiMsUqHrGOnS4UFy9P/wAEojkEnI+IqOIJQNLgpCXhcmLAtD/D+kgQE235L93tj+YBqgTX9BiCeW/NedT4AmQ+YkU/3sbzxBymQuZhm8g1T+QbV+wWFdjKO/Te2mEFNlCb6gPF708VJ1TXHgKd91GnZpDfi1k/gM2vqU3DUnCuBmNQe3P9vw6pe229KOvB0K1k+ZS+rnrfM2AlA3JMZtah/EZKZT3drxuDz1O/yxAwu9JgJxr3lQfR+8aa8Buy/wdWQZAVl+ZzCrG3q9c/YrkmHy3IRYryAAqAkEBIlopJxNNUbER+fA/H+/+AAdP9PmS9dazicJybm7mlB8nR2dI1HvgVkOlZGPt2nM29GCamcGZjAwlQ+vvrV+8X/zGsAAUiLVPp/wd+zaTMFWw+/kAA0GQQnpCw5mDsAMIrcRB5mC/+MAffTwgfwKY2KfmCZ6ZIkUShrxXxBX4yYaV8Hzmcn13jUA8CMfDqWYeQcSkhVOl8U6uxH7xekrsg49h8oiCENgC5TUG5vKxxT8f2aRtOtcAKQ1s8soPuOVUIwpchNlEEIOyNSIrrvv3hwnckWIZPZsnbcDyzTpvg3lU8mpZQqozyfK74aj3wAKh1LgrsD5tMxiz/nkGD1sHq/YNFOxkEAcuW7oqmXlisuQOT7VV2jwi/kTgj1RkoZhBje8Z83SCAEEJZW0C3gff8tADCt4VASaWIBK0HI9q8BF5yUAMzIp8tNx5Jg9bB6v/jdDPSRns0BWIZeUitIo9IhHmhXTvzCPQddccnZ76U1V/IvC4SBCFyg26DFNg7c++Mhhb6qiCikT7WVUmr6lYn2nRKyrdZ51GMBlZIc07GUBdMjny6XCiUmpA6j94vMZbgBMFo552pu27PXAqXTyAUQcitOQjAm9xX0N9pIwIPmSCmH5QuPqER0L4kDYgp9zOUL6fYxkbZcFceyAreAF3GlV+NRDwAz8uksnT3jiILVSmpWNlhMze+k94vMZfgGAPJeHDjpCrgM01Tdry9OzvmYAzAqLVWIwEShwzbRwwSEn+MqP6bQK5tZlWyhjCCCsC19Xv7gOnBRbgp7cu/5AOyVjqVMmA75dJZ9nHF0yohWNlhMxKnS+0XmMtwAmFq4imnYbrEqNJPc+9kfd62RKh0On8qV9hXZ9askEPgAfI56ziocUgVbzGT28lEtRMoKtg7lBHtznfZNA+CQ+XQWM8k4uglWK/NLYKzS+8U9GReXD0g/Tyvh4Ne17Yb4Zbr6g6y7/aNWcoPpjKRTsJIags5IJwkEAv6en05S6GUBfRWsUExZyVZVQCQwrgN7Wfdd41GPBczIp8ODeXfTSbBa6YYxlY8/p3q/udc3C+jTbtvqt2oadnB2m4oNgMn0W0p+hYWHWbwg9yU/0Kb9EIy+5y2hiCit4UgKyTeAkN8Valk4Le/ldlONRz4AWWBRM6fdIPfHstw/G+SE5rMnVQ/kA5AkLHS0ak7V7reXfhgACaBqDtD3e/nmc5k9kA/A80JReq+U38zGVp3ObJo/BvAOD3dtwiWar9zEHsgHIGlFubqSx7+Jja36anLLcDvvgwA+NDpDfILv+qlzuXwAXuSjrkKemlO2e3U1uWUYnL8dwB/5e2apca9LNv+vsQfyAUheX4VguB+mzIsaG9ntqxhF4Xbe3QD+n7/uHLAW9wQ1tblMRQ/UA0CaHC7plXEh+q4T0OWcfhleYTSHBK0EH/mi+fcRuKQn4I6fWpeoB4AevCz3HOOm9yb3F5mBlZBNclYCj1aRfyfrbgPCTR6AzK+vD4CyglX7jpmN7HY66d1E0ctdIrEEE4wEIMlam+Pk7YF6AMj7EwAVbU82vTerCwhAXopJN9zVI+AYrOeULLZgErY2x8nZA/kAJGWr0naUWdFpy2cT+oCWjpdjLFxE5UzYIBBpEUX5nLnlvAktb76SPVAfAOUHpiAMm96bsVtCAMaKALICMyxDq6cXfycA+b/mOLl6oF4AiqBRIEzBp7/X2Af0+fi1XIioMIlAI+AIPIGPmeROWV3j1Zuvyu2B+gHoFfZiDS2lC0LiY52WUADkQoTTMH1BFSYRdHoRfKSu5v9qrizMHYPT+vx6ARhSuDcAzzmDo5ZGHT1PAKYMwQxME2jiSo/gEwBrrq+u41ZOy++oD4BaCcsXTPiSI3ey8s4KGoG8QwCMFM+0ggQhLR0BF19SXuD/ayakz7uR0/TsMcxg3SjfqWNA0hsrga/ojaq/8WPcC+YIk4Ke4CMSuB2XVht1Oj8zIfXlU8BtU8DhmYRXWdfrdF1fgr3+S8At48CD04DVjXQSDO70PTUnaJ5uOCwsIIFHSSFy1pKPWCDsZxCpw8UVgKSPxLXM937OzxxAljzcPAbcswU4Qh4V3UN8mKoeKm/bu78IfKJQa8VD48CylHQiL3O3/qg5Rf30BKACMtJXjXKQcfBSK8Dfqc3KVCwuN2VFGRnm/yKZtq4Re5ifyQQgM2A+BeB3GHaZBo5MAIue0l7Kt3cC4xhw+5eL7TuCkJk1jBtyerbUfYG5ExjZ/pqrxE5fAOrOq5SmowVIrRp1IyT2R6+fg0bgVYG4CsyZe2UsaiOGKXr4Sfp9k8CxCYAFSKyvXeY1o1BxQux91yMtfsHPutgnnyUuUvhc0ZsgUXib+nVkq6+ZKaABIHsgVZnuwD9sVo66rrR4ImdhLGSQ8zPL/JgBQxeU1ouWkO9PTgDzbgmXxrzMkatl3keivfG5x4r4IRcz5BfkO5vEZ0kgpIfBZ8yKjlL17syy0tMNcOn9dl4Fy6dLFabj1Mpvow9Ify+I4Nlo9Xt+ZqU9VdJpqZh4QDDyxUyYOYJwHDg+DhgI/WUVZl7aSEt93+GO9Ia2iuZKOfA7lhp9JpvAVy61w2mOwO5hmCgMHC1H9O24gu6UD9jP+ZmbtLRaSsei9SL4XDPbAEh/kGQ/pSUcc0lbApFWb67lQUhpVnLBsoKqqZclFMmUtrxPcwxl3X7vOCAtYLSCcugFQmqhdssH7HU+RznjiOlYXA8wqkOfkItTAom+oKygca4ES8jY+N3z7fSG4hfUtp3ihUHruVSsFy1iRvNP+1N7A5BdJACmVpAgZPhGOyCigEjlPLudn7kvFtOxuB4g6OjD8UWLRkCZFRwrLCEXJQQhp2K+37lQeBCRX1A7KPQto1prFEmSYn2mB9EAsO+kYfk8KQhZF8yjVz5gp/MztyOUjiW9bCUhEBhKRCCgSis45uQ/PhX/xfFWMgOnWu2gxB0TF/o0kEZ/kCDM1Ts+3RHYnwVUL6XhDFrAswfIB6w6P1MrTulY0sum1VICglKwCEACqvQFCUK3gHcsFQCM/ILayqP1k9JshVqrncMalOYYvgcGAyCvIwuod8YBJQmZpmGJeyRwkGw4n8jJOJQNw3idLFhMRNB0SgASTJyKoy/4ieXCeFfJBUeV2SoAclFyR0bbm1OHTUiN0/DTAwD7zQeM52dqj8VsGEkVE2jKetG7AEhQ0frJAv6RC0trC1skl+IWlNinGLbSaZg7Mc0xfA8MbgF1LQV1z08A2G8+oM7PVF9Ms2GUE0gQyp+Lwu2yagLgR9ZaYpkSypQ6a6Q2DCqzpkvietXIFdoZfuieGmcOD0DeP0HEbBhNwYPmA/L8zJQsATAKnguEqS+XTqkE4YfWWwCUFZTksYAYwZfIBeN9Tw0cjOwu8gDIZqsoSSvhEeQDiiGYFoyWiSDRypWgi69UP5sc5fIcquSCNeXqe2X9ZAHfM7Khe2pcOB+AT41+aO5iRD3QAHBEHd9ctuiBBoANEkbaAw0AR9r9zcUbADYYGGkPNAAcafc3F28A2GBgpD3QAHCk3d9cvAFgg4GR9kADwJF2f3PxBoANBkbaAw0AR9r9zcUbADYYGGkPNAAcafc3F28A2GBgpD3QAHCk3d9cfOxqYJ2au9RdPtdp/khoEOlglDYT39V1PzQFXLsMXAlgt9PCxJKPbufyf8/KHIPfBPAZABf79Xc5XQ0ZQ1Q7360NbxoHrlsDvs5ZRsgo0une06by6X1mZvtP99PNAp4F4LsBXA5gjw8EGTeqaGF4QhzQF80CX7cAvGIdeDYAfhdZ2sTKUcVrpE7nd31N5gj8e2dIo2osk7NZpMdK0Z19tv+bJ4F9K8D1ACj8yfNSikHeg+5Z969m57Y/8/ZP+dPLKZhP/rcA+AYAF7g1oRUhEMUzFMt6eSJfX78b2DkPfM0i8GIAX+uWlAMppreUUErn8p2gzTl+2flg/sDbTkvIOik+CP20//mzwAXzwDcCuNTPJeFXpEpM6QEjIHm/zTF8D7T5gATYNQCe69aAloRTGulfBESBSYNyxR5g/Bhw7hKwZwl4vk9LnM5JmsBzUyDGAX3B8G23Mz/g9BuUa/0IiutfMkj7zwKmngAuXSvOpUvAWYBtF4BTnspIj/O8zPaf7qdvWITw6eZA0JLQEhKEGgxZhUj/dz3NzSKwbR44exnYvVKcy+mM5Km0JhxInUtrGkmzCPicg3W5LMGkQiZZTm9xS9Z3+4m2o8C5c4X15pTKW2Lb+fCx7WLtjYxzqiql29Icw/dA5SqYf6RTTilg+lYCIXmICKQ4IK9wxfSJY8AZK8CuFWDnanEua9ZTAMsaCog3Dt92O/MvnRGBtGwkqKRmMEkqCaa+2k+0LQDTh4rP88UHj74kF1WaATo9QHQ7mmP4HugYhtEKj4PB6ZQ+FS0hQahpldPya1kXTOqNY8DscgG+HavAttUCvBxInitrkgL4lcO33c7spBdM3kAuSnq2nx9gQfAh4JyVwvrxwel2z3p4aMlzH6DM2z/lT+8aB+Q/OT4EEqckWQSBkGD6EQKQnDCLwBSnYgcf32fXioGUFawC4esyu7CXXnDP9tOCsyD4KLB1rmgvX7zfbu2WG/Jtme0/3U/vKxBNAMoi0KcjkATCN3HOEr3UAjDrwOP71rXixYEkeKMFlSX8ocwR6KUXTJ7AaNE2tF8WfA4Ye7Kw1mwvX/yZn+eKnvcrfzC6IK/ObP/pfnpfAGQnySoISBqUXyAASS1AK0JfagWYcRDOrAF66TxZQU7jBOEbM0egH71gcgXSFZAV54NQtj9YcNIpbONCyh8Ygi8CVospApDuB63g92W2/3Q/vW8AsqM4gLIKBBIH8bcJwMCNMX68BTqBb8s6sGWtsIA6jwDk662ZI9CvXjA5A6NVa2t/IAicnC/aGV+8T74IQPm/AmGuBc+8/VP+9IEAyLslAKMV/LgAyIUInfnjwPQqMOOgI/DstQ5Mr7UAqMF8V2YXDqoXXNl+EQQ6N9v29aKdesUpWJZbAPyPme0/3U8fGIDssDid/pUASCvCaXgJmFguAEfgEXT27gDkuwaUg/nbmSMwjF7whvbLhSDL5TwwvdRqo9oqHzACkCB8U2b7T/fThwIgO01T1IMCoAZxGRhbKoAXQUcQTjkI+a4B5e5FzjGsXvCG9gdqrLGFYrpVG/UuHzBOw2/LaXxzbh43DKeoJwlAHqLndSs4udoCoIBHQE45EPk3DuitmYOQoxdctp8+rFwIWsGFYiFFoLGNchcEQC6e+OJC5J2Z7T/dTx/aApYdJ37AyJK/DIwvFxYvWr0IwEn/H1Opco5sveDUhSAAF4HJpQJkWixp6k2n4IYfMGf0amDHev2I8+l4/UbvNw8Eozw72wJePOJ8und7EkKj9ztKGA1/7WwATo44n45pWI3e7/AAGPWZ2QBkYHCU+XTMfGGQmYIxjd7vqOE0+PXzATjifDrKtTZ6v4MP/MlyRj4AR5xPF+VaqZLJF1UzKdPV6P2eLDDr3I58AI44n07ZMARbo/d78gMubWE+AEecT8e9YOn2Uheu0fs9tUCYD8AR59MpG6bR+z21gKfW1gNAz4geRT5dTEZo9H5PPRDmAzBmRM8BJzqfLiYjSKKr0fs9dYBYDwBHmE9XtRfMsIz04aQZ1+j9npygrA+Akqs8wfl0BCCTWRq935MTYL1aVQ8Ao1zlAnAi8+kEQGZTNXq/vYb75Pt/fQAcUT5dBGCj93vyAaxXi+oDoFLyT3A+3Rcavd9eY3xS/z8fgCQX/LPR3SOzkon55jg1eyAfgD8M4NcAPD6aDmBtB1e4NMDNcer1QD4AbwbwxwDe4UvRE9wHZG1gNSXDLlwLNcep1QP5APxzzwj9IIAPnXhT5ORc5EYCA9HNcWr1QD4AmRH6FQBMTSZZH98ZmD5Bh5g1FopiNns1x6nTA/kAvAfAEwDudnI+EvQxPfkEzYfaCXRSBluQMB7YHKdGD+QDsBNBH/9+AkAobqTADGK7Inw1x8nfA/kA7EXQt8kgrGAGMfBxZ5Cv5ji5eyAfgL0I+r68uR0QmUFoBQU8vfNvzXHy9kA9AORoMw7CdGQCjoUZDwL4kv/+8OZ1gJhBIjGDgMh3vTavBc035/RAPgD7JegjODfhiMwgoqeJwNPPTaB6Ezq/hq+sB4AcXeXEP+ZhGVo9vRimIQD5v5oPAZCupgDI9wg8/qz/1Xz55usyeyAfgMMQ9GU2Op4eAchpOIJQQEz/VuPlm6/K7IH6AMjgGzdl6QtyX5jWjpQFevF3lq3xf6yhrOlIAUgQCojR8gmE+l9Nl2++JrMH6gEgR5UA5KYsc+AZmCbQCDi+IvgEQMob1XBEAHIajgBMLV+0kCdws6aGu3zqfkV9AGTwjftg3JRVVRAtHQEXX/wbAcoXP5d5CID8GoJKvqDAloKOoIz/y7x8c3pmD4zhaqwjRzCYyQg5gr2ZgsFTLweWr8XQgsXjbwLWrnNtMlKgNoLBmZAa7PTCAuYIBlMvlWQswwr2UlUw45jdDSx8HbD+Ctd+HVCwePKbgJV9aASDM8Yg59TWFDysYPBtmYK91IbNOHaPA/M7gUXKXA4hWDz79cA8+W0aweCMURj+1HYfcBjBYO54MMY3tGDv8I3nmWSHOzYOLJ0LLPGXAQWLz3oB8MQUsEa16kYwOG8whjh74yJkUMFgbsNlCfYO0epwissVY34bsHw2sEIRkAEEi/dcU0SP5qhF1ggG5w3GEGdXr4L5134Fg4kAjuDQgr1DtDqcUmZETwArZwAru4BVqsv0KVh8/o3F4v0QXZBGMDhvMIY4u3MYhv95Zh+Cu1xBcxuOU/HfeDIq5cv7FuwdotXhlCBXjOXZAnyrO4BV6in0IVh8wStLuWCsUAyvEQzOG5ABz+4eB+R/ewnu/kOP/3G/l4kJTERlljQtIot2e53/IwO2OPl4FLtcnCqAp9cahT56CBZf+LpSLhhz1N5qBIPzBmTAs/sLRHcTDKbiNHdBGGymOC/3hglEvgjAnoK9A7Y4+XgiV4zVWYDAs/etxaubYPFFP1QkLtCIP8neaASD8wZkwLP7AyC/tJNg8L/xLNBu+YBdBXsHbHEFAINcMVamgdWZAoRrfPdXm8KitLdmgYveWAq+2y7iMqfuRjA4b1AGOLt/APJLqwSD3+y5T1yI0AoSbAxMMzGV1o8/My2ro2DvAK2t+GgiV4zj4+3AIwDXtwBrVJeuECze+9aW4Dut4PxkIhYsdetGMDhvoDqcPRgA+SWp4O4veQ5Uv/mAGwR78+6rQq4Yq9PAOi2fA4/vBkKudKVU7VZw77uKvWFuZbtcMNb5v0YwOG9g+jx7cADyi6Pg7gccgIxlcA5TKhaD01yYKBmVFpBZMfx/m2Bvny3t8LGqoqTliZbVI+gMgHwnMAnCIFi897cLAAZ6QyzFzzSCwXkD1OPs4QDIL5XgLmk5JHk/SD5gKdibd38VcsVYGmuBTaAzEHLHgyCcaokB7/1IkUET5IKxwF5pBIPzBqbPs4cHIC/AaeqvPL9pmHxAE+zts6VdLCD/lcgVY3UyWD0Bj1ZwqgCggXA7sPfWAoAJvaEtZBrB4Lyx6efsPADyCtmCvf00s/NnOsgVY3m8BTRZPZuGBUACdArY+5lWDqGmYbIrLHEx0ggG5w1OH2fnA7CPizQfaXqgUw80AGywMdIeaAA40u5vLt4AsMHASHugAeBIu7+5eAPABgMj7YEGgCPt/ubiDQAbDIy0BxoAjrT7m4s3AGwwMNIeaAA40u5vLt4AsMHASHugAeBIu7+5eAPABgMj7YEGgCPt/ubiDQAbDIy0B8ZYNMbkX+ZekpuIiOQrPar+xs889HJg6jZg5jAwvVZ8B+ll9PlO5/Fc/o+ECjnHfi8zYfkvM5ulmp4qJXVqx5deD4zfAkw/CGxdAZgoHfuh131QkaI5hu8Bs4Ds8B0AWLnIRGCBsFfn87JffDMwdjOw5R5g8giwZa34jnQQUwDo99wBfJ4TM7COiNdlaj2rA/jeV/vfDeATAP4UGH8I2Lrc6gc+SHqY4oMZ74VSKM0xfA+UUzB/oBUUCKMl6zSQ/PsXqZD5KQC/A0w/DEwcAcYXgYnVwppwADuBkefnCim90FmBWXwnK87Uen53BI8sbuwqaz9p5UgnQhBS+ZN1zE8Ak0utviCwq8DI8/nx5hi+Bzb4gJzKZE1SEFZZgS9/2pWR/gTAJ4HJQ8DEMWB8ARhfBsaWCwDquwQKvvNgHXvOcYVbPFJPkw+dDxC/W1Y4tWDpw/Rlgo4lo1T4/KxTihDNpJwj3/UiMLXemprjffC7eWpzDN8DlYsQDiKtVxzEqoHkyX9HRizW+nIgaQnvAiaeBCbmC0s4tgSMu2rMePAR9X252jXklaTFU108K0MHav/nvJ6ZxVVk9OI7GR2IZoGQNc/HgbHgIwqILIVujuF7oOMqWFawCoRxkfEIB5CWgkREBCNf9wMTc8A4QciBWyoGz16rwNgaML5eWKpctYZL3N+TWLX0gvtuP0HHk2n16JDyxXmVhfU0qywbJbr5GSuXKxA/sV5Y9UYWdnjwyS3qKKgarWA69Wg6fjQOIK0HadnIjPVFB+AiME4AuiUkCFnESyCSkmAuU7Cjm15wX+2X2ifBRn9A8mKcW2UFjULVQcgVDl80u40SYh763FfvquhLCxitoBYUsoJfjXKttByMq9CKcHn4sPuCbgXNJwyWkECcz5Q376UX3LNncZyQAAADEklEQVT9fFgIJs6lBBwtn3Tt6FpIz4RWnuQxPh2XIGzm4CwQ9hWIFgBTK0gQHiIAJddKq0ELQh+KL1qUR4MvSEsoENIKrgALHNiMox+94K7tl9qnnMio8MSf6SNwGpYVjCDk/Ju7isq496fCqX0BkDeqlWwKwic1gAQSpzGREnFgREz01eALLvvq2Kfi45m6cf3qBXdsfxRbJMho8dimqOhEK8cXQRr9QVpvPoDNMXQP9A3ACELFxPh+jACkP0fLIKFCCRRqKuPUdqjlC9o07JZwKVNHeBC94DQcZO0XAAkmgotAk9QYrR9f/BvByYfMSATDVMzwTXMM3QMDAVAgVHCZ7/MaQK4QZUHiNCbBQlqUw74YCb7gcmYkelC9YFlwvVv7RRAorTuBkECU9asCID9/x9B935zYzyKkqpfiNHxcA0gLQgvBAaPVkCqm3h2AtC5m/RyEqzw/4xhGL3hD++MmslgqCbgUfLKAcRrmTlBzDN0DA1tAXUlWcDm1IOIIJAjlT/Fd05lbFQFwjdtgGcewesFt7Rc/Gx8iWjUCjGCT1YvWT1MwgUqrf3NG45tTbcu0aximWx9xENcEQHGbcYAEwtSXSqY0gnCdgeuMI0cvuGx/FUGgFhwEYrR80QckWN+X0fjm1DwAWv8RgJFilJZBznz0pQg+AZAAlVWh1GvGka0XzB0cCQi30aSGVa9AF62fLOB7MhrfnJoPwPER59Px+o3e76mL5Kwp2G57xPl0kxc3er+nLvyKtLmhfUC78RHn081ONnq/pzcAR5xPR9mRRu/31IVgvgUccT4dNaobvd/TGYAjzqejumqj93s6A3DE+XRUg2VSCjdaGr3fUw+I+VPwiPPpqJjO8J1Nw43e7ymHwHoAKMFd7QErAeEE5NNJMb3R+z3lsGcNzgfgiPPpomJ6o/d76oGwPgCOKJ8uKqY3er+nKwBHmE+noqRG7/fUA199U/AI8+kEwEbv93QHoEhZTnA+nYqSGr3fBoAtaiqBUImdm5hPJwA2er+nKwBHnE+X1gUzSbnR+z11wPj/AeCpPDD3t7rvAAAAAElFTkSuQmCC",but="uniform sampler2D weightMap;varying vec2 vOffset0;varying vec2 vOffset1;void movec(const in bvec2 c,inout vec2 variable,const in vec2 value){if(c.x){variable.x=value.x;}if(c.y){variable.y=value.y;}}void movec(const in bvec4 c,inout vec4 variable,const in vec4 value){movec(c.xy,variable.xy,value.xy);movec(c.zw,variable.zw,value.zw);}void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){vec4 a;a.x=texture2D(weightMap,vOffset0).a;a.y=texture2D(weightMap,vOffset1).g;a.wz=texture2D(weightMap,uv).rb;vec4 color=inputColor;if(dot(a,vec4(1.0))>=1e-5){bool h=max(a.x,a.z)>max(a.y,a.w);vec4 blendingOffset=vec4(0.0,a.y,0.0,a.w);vec2 blendingWeight=a.yw;movec(bvec4(h),blendingOffset,vec4(a.x,0.0,a.z,0.0));movec(bvec2(h),blendingWeight,a.xz);blendingWeight/=dot(blendingWeight,vec2(1.0));vec4 blendingCoord=blendingOffset*vec4(texelSize,-texelSize)+uv.xyxy;color=blendingWeight.x*texture2D(inputBuffer,blendingCoord.xy);color+=blendingWeight.y*texture2D(inputBuffer,blendingCoord.zw);}outputColor=color;}",wut="varying vec2 vOffset0;varying vec2 vOffset1;void mainSupport(const in vec2 uv){vOffset0=uv+texelSize*vec2(1.0,0.0);vOffset1=uv+texelSize*vec2(0.0,1.0);}",qy={LOW:0,MEDIUM:1,HIGH:2,ULTRA:3},nme=class extends hf{constructor({preset:t=qy.MEDIUM,edgeDetectionMode:e=PL.COLOR,predicationMode:i=gct.DISABLED}={}){super("SMAAEffect",but,{vertexShader:wut,blendFunction:Rr.NORMAL,attributes:qd.CONVOLUTION|qd.DEPTH,uniforms:new Map([["weightMap",new xt(null)]])});let r,n;arguments.length>1&&(r=arguments[0],n=arguments[1],arguments.length>2&&(t=arguments[2]),arguments.length>3&&(e=arguments[3])),this.renderTargetEdges=new Mr(1,1,{minFilter:nr,stencilBuffer:!1,depthBuffer:!1}),this.renderTargetEdges.texture.name="SMAA.Edges",this.renderTargetWeights=this.renderTargetEdges.clone(),this.renderTargetWeights.texture.name="SMAA.Weights",this.uniforms.get("weightMap").value=this.renderTargetWeights.texture,this.clearPass=new g8(!0,!1,!1),this.clearPass.overrideClearColor=new Ai(0),this.clearPass.overrideClearAlpha=1,this.edgeDetectionPass=new fu(new vct),this.edgeDetectionMaterial.edgeDetectionMode=e,this.edgeDetectionMaterial.predicationMode=i,this.weightsPass=new fu(new Mct);let s=new Fhe;s.onLoad=()=>{let a=new Kn(r);a.name="SMAA.Search",a.magFilter=mr,a.minFilter=mr,a.generateMipmaps=!1,a.needsUpdate=!0,a.flipY=!0,this.weightsMaterial.searchTexture=a;let o=new Kn(n);o.name="SMAA.Area",o.magFilter=nr,o.minFilter=nr,o.generateMipmaps=!1,o.needsUpdate=!0,o.flipY=!1,this.weightsMaterial.areaTexture=o,this.dispatchEvent({type:"load"})},s.itemStart("search"),s.itemStart("area"),r!==void 0&&n!==void 0?(s.itemEnd("search"),s.itemEnd("area")):typeof Image<"u"&&(r=new Image,n=new Image,r.addEventListener("load",()=>s.itemEnd("search")),n.addEventListener("load",()=>s.itemEnd("area")),r.src=Wte,n.src=qte),this.applyPreset(t)}get edgesTexture(){return this.renderTargetEdges.texture}getEdgesTexture(){return this.edgesTexture}get weightsTexture(){return this.renderTargetWeights.texture}getWeightsTexture(){return this.weightsTexture}get edgeDetectionMaterial(){return this.edgeDetectionPass.fullscreenMaterial}get colorEdgesMaterial(){return this.edgeDetectionMaterial}getEdgeDetectionMaterial(){return this.edgeDetectionMaterial}get weightsMaterial(){return this.weightsPass.fullscreenMaterial}getWeightsMaterial(){return this.weightsMaterial}setEdgeDetectionThreshold(t){this.edgeDetectionMaterial.edgeDetectionThreshold=t}setOrthogonalSearchSteps(t){this.weightsMaterial.orthogonalSearchSteps=t}applyPreset(t){let e=this.edgeDetectionMaterial,i=this.weightsMaterial;switch(t){case qy.LOW:e.edgeDetectionThreshold=.15,i.orthogonalSearchSteps=4,i.diagonalDetection=!1,i.cornerDetection=!1;break;case qy.MEDIUM:e.edgeDetectionThreshold=.1,i.orthogonalSearchSteps=8,i.diagonalDetection=!1,i.cornerDetection=!1;break;case qy.HIGH:e.edgeDetectionThreshold=.1,i.orthogonalSearchSteps=16,i.diagonalSearchSteps=8,i.cornerRounding=25,i.diagonalDetection=!0,i.cornerDetection=!0;break;case qy.ULTRA:e.edgeDetectionThreshold=.05,i.orthogonalSearchSteps=32,i.diagonalSearchSteps=16,i.cornerRounding=25,i.diagonalDetection=!0,i.cornerDetection=!0;break}}setDepthTexture(t,e=em){this.edgeDetectionMaterial.depthBuffer=t,this.edgeDetectionMaterial.depthPacking=e}update(t,e,i){this.clearPass.render(t,this.renderTargetEdges),this.edgeDetectionPass.render(t,e,this.renderTargetEdges),this.weightsPass.render(t,this.renderTargetEdges,this.renderTargetWeights)}setSize(t,e){this.edgeDetectionMaterial.setSize(t,e),this.weightsMaterial.setSize(t,e),this.renderTargetEdges.setSize(t,e),this.renderTargetWeights.setSize(t,e)}dispose(){let{searchTexture:t,areaTexture:e}=this.weightsMaterial;t!==null&&e!==null&&(t.dispose(),e.dispose()),super.dispose()}static get searchImageDataURL(){return Wte}static get areaImageDataURL(){return qte}},_ut=`uniform float offset;uniform float darkness;void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){const vec2 center=vec2(0.5);vec3 color=inputColor.rgb;
#if VIGNETTE_TECHNIQUE == 0
float d=distance(uv,center);color*=smoothstep(0.8,offset*0.799,d*(darkness+offset));
#else
vec2 coord=(uv-center)*vec2(offset);color=mix(color,vec3(1.0-darkness),dot(coord,coord));
#endif
outputColor=vec4(color,inputColor.a);}`,MR={DEFAULT:0,ESKIL:1},Sut=class extends hf{constructor({blendFunction:t=Rr.NORMAL,technique:e=MR.DEFAULT,eskil:i=!1,offset:r=.5,darkness:n=.5}={}){super("VignetteEffect",_ut,{blendFunction:t,defines:new Map([["VIGNETTE_TECHNIQUE",e.toFixed(0)]]),uniforms:new Map([["offset",new xt(r)],["darkness",new xt(n)]])})}get technique(){return Number(this.defines.get("VIGNETTE_TECHNIQUE"))}set technique(t){this.technique!==t&&(this.defines.set("VIGNETTE_TECHNIQUE",t.toFixed(0)),this.setChanged())}get eskil(){return this.technique===MR.ESKIL}set eskil(t){this.technique=t?MR.ESKIL:MR.DEFAULT}getTechnique(){return this.technique}setTechnique(t){this.technique=t}get offset(){return this.uniforms.get("offset").value}set offset(t){this.uniforms.get("offset").value=t}getOffset(){return this.offset}setOffset(t){this.offset=t}get darkness(){return this.uniforms.get("darkness").value}set darkness(t){this.uniforms.get("darkness").value=t}getDarkness(){return this.darkness}setDarkness(t){this.darkness=t}},tm=class{constructor(t,e){this.enabled=!1,this.effect=new t(e),Object.defineProperty(this,"opacity",{enumerable:!0,set(i){this.effect.blendMode.opacity.value=i},get(){return this.effect.blendMode.opacity.value}}),Object.defineProperty(this,"blendFunction",{enumerable:!0,set(i){this.effect.blendMode.setBlendFunction(Number(i))},get(){return this.effect.blendMode.blendFunction}}),this.blendFunction=Rr.NORMAL}},Eut=class extends tm{constructor(){super(nut),this.blendFunction=Rr.SCREEN}set intensity(t){this.effect.intensity=t}get intensity(){return this.effect.intensity}set luminanceThreshold(t){this.effect.luminanceMaterial.threshold=t}get luminanceThreshold(){return this.effect.luminanceMaterial.threshold}set luminanceSmoothing(t){this.effect.luminanceMaterial.smoothing=t}get luminanceSmoothing(){return this.effect.luminanceMaterial.smoothing}set blurScale(t){this.effect.blurPass.scale=t}get blurScale(){return this.effect.blurPass.scale}set kernelSize(t){this.effect.blurPass.kernelSize=t}get kernelSize(){return this.effect.blurPass.kernelSize}},Aut=class extends tm{constructor(){super(aut)}set contrast(t){this.effect.uniforms.get("contrast").value=t}get contrast(){return this.effect.uniforms.get("contrast").value}set brightness(t){this.effect.uniforms.get("brightness").value=t}get brightness(){return this.effect.uniforms.get("brightness").value}},Mut=class extends tm{constructor(){super(hut),this.effect.offset=new Ae(.01,.01)}set offset(t){this.effect.offset.set(t[0]/1e3,t[1]/1e3)}get offset(){return[this.effect.offset.x*1e3,this.effect.offset.y*1e3]}},Tut=class extends tm{constructor(){super(lut)}},Cut=class extends tm{constructor(){super(mut),this._hue=0}set hue(t){this._hue=t,this.effect.setHue(t)}get hue(){return this._hue}set saturation(t){this.effect.uniforms.get("saturation").value=t}get saturation(){return this.effect.uniforms.get("saturation").value}},Put=class extends tm{constructor(){super(vut),this.blendFunction=Rr.OVERLAY}},Rut=class extends tm{constructor(){super(Sut)}get eskil(){return this.effect.eskil}set eskil(t){this.effect.eskil=t}get darkness(){return this.effect.uniforms.get("darkness").value}set darkness(t){this.effect.uniforms.get("darkness").value=t}get offset(){return this.effect.uniforms.get("offset").value}set offset(t){this.effect.uniforms.get("offset").value=t}},Iut=class extends tm{constructor(t){super(fut)}set focalLength(t){this.effect.circleOfConfusionMaterial.uniforms.focalLength.value=t/2e3}get focalLength(){return this.effect.circleOfConfusionMaterial.uniforms.focalLength.value}set focusDistance(t){this.effect.circleOfConfusionMaterial.uniforms.focusDistance.value=this.isPerspectiveCamera?t/2e3:(t+992)/2e3}get focusDistance(){return this.effect.circleOfConfusionMaterial.uniforms.focusDistance.value}get bokehScale(){return this.effect.bokehScale}set bokehScale(t){this.effect.bokehScale=t}setCamera(t){let e=!1;(t.isPerspectiveCamera&&this.isPerspectiveCamera===!1||!t.isPerspectiveCamera&&this.isPerspectiveCamera===!0)&&(e=!0),t.isPerspectiveCamera?(this.effect.circleOfConfusionMaterial.adoptCameraSettings(t.perspCamera),this.isPerspectiveCamera=!0):(this.effect.circleOfConfusionMaterial.adoptCameraSettings(t),this.isPerspectiveCamera=!1),e&&this.effect.setChanged()}},Dut=class extends tm{constructor(){super(xut)}get granularity(){return this.effect.getGranularity()}set granularity(t){this.effect.setGranularity(t)}},Out=`#define GLSLIFY 1
varying vec2 vUv;varying vec2 vTexCoords[9];uniform vec2 resolution;void main(){vUv=position.xy*0.5+0.5;vec2 texelSize=vec2(1.0)/resolution;vTexCoords[0]=vUv+vec2(-texelSize.x,-texelSize.y);vTexCoords[1]=vUv+vec2(0.0,-texelSize.y);vTexCoords[2]=vUv+vec2(texelSize.x,-texelSize.y);vTexCoords[3]=vUv+vec2(-texelSize.x,0.0);vTexCoords[4]=vUv+vec2(0.0,0.0);vTexCoords[5]=vUv+vec2(texelSize.x,0.0);vTexCoords[6]=vUv+vec2(-texelSize.x,texelSize.y);vTexCoords[7]=vUv+vec2(0.0,texelSize.y);vTexCoords[8]=vUv+vec2(texelSize.x,texelSize.y);gl_Position=vec4(position.xy,1.0,1.0);}`,Lut=`#define GLSLIFY 1
#include <common>
varying vec2 vUv;varying vec2 vTexCoords[9];uniform sampler2D inputBuffer;uniform sampler2D historyBuffer;uniform sampler2D velocityBuffer;uniform sampler2D depthBuffer;uniform vec2 resolution;
#define USE_YCOCG
#define USE_CATMULL_ROM
const float feedback_min=0.5;const float feedback_max=0.95;vec3 RGB_YCoCg(vec3 c){return vec3(c.x/4.0+c.y/2.0+c.z/4.0,c.x/2.0-c.z/2.0,-c.x/4.0+c.y/2.0-c.z/4.0);}vec3 YCoCg_RGB(vec3 c){return clamp(vec3(c.x+c.y-c.z,c.x+c.z,c.x-c.y-c.z),vec3(0.0),vec3(1.0));}vec4 sample_color(sampler2D tex,vec2 uv){
#ifdef USE_YCOCG
vec4 c=texture(tex,uv);return vec4(RGB_YCoCg(c.rgb),c.a);
#else
return texture(tex,uv);
#endif
}vec4 sample_catmull_rom(sampler2D tex,vec2 uv,vec2 texSize){vec2 samplePos=uv*texSize;vec2 texPos1=floor(samplePos-0.5)+0.5;vec2 f=samplePos-texPos1;vec2 w0=f*(-0.5+f*(1.0-0.5*f));vec2 w1=1.0+f*f*(-2.5+1.5*f);vec2 w2=f*(0.5+f*(2.0-1.5*f));vec2 w3=f*f*(-0.5+0.5*f);vec2 w12=w1+w2;vec2 offset12=w2/(w1+w2);vec2 texPos0=texPos1-1.0;vec2 texPos3=texPos1+2.0;vec2 texPos12=texPos1+offset12;texPos0/=texSize;texPos3/=texSize;texPos12/=texSize;vec4 result=vec4(0.0);result+=texture2D(tex,vec2(texPos12.x,texPos0.y))*w12.x*w0.y;result+=texture2D(tex,vec2(texPos0.x,texPos12.y))*w0.x*w12.y;result+=texture2D(tex,vec2(texPos12.x,texPos12.y))*w12.x*w12.y;result+=texture2D(tex,vec2(texPos3.x,texPos12.y))*w3.x*w12.y;result+=texture2D(tex,vec2(texPos12.x,texPos3.y))*w12.x*w3.y;return result;}vec3 choose_motion_vector(){
#ifdef CHOOSE_LONGEST_MOTION_VECTOR
float longest=-1.0;vec3 v_choose=vec3(-1.0);for(int i=0;i<9;i++){vec3 v=texture2D(velocityBuffer,vTexCoords[i]).rgb;float l=length(v.xy);if(l>longest){longest=l;v_choose=v;}}return v_choose;
#else
float closest_depth=1000.0;vec2 closest_uv_offset=vec2(0.0);for(int i=0;i<9;i++){float neighbor_depth=texture2D(depthBuffer,vTexCoords[i]).r;if(neighbor_depth<closest_depth){closest_uv_offset=vTexCoords[i];closest_depth=neighbor_depth;}}return texture2D(velocityBuffer,closest_uv_offset).rgb;
#endif
}vec4 clipAabb(vec3 aabb_min,vec3 aabb_max,vec4 avg,vec4 input_texel){const float FLT_EPS=0.00000001;vec3 p_clip=0.5*(aabb_max+aabb_min);vec3 e_clip=0.5*(aabb_max-aabb_min)+FLT_EPS;vec4 v_clip=input_texel-vec4(p_clip,avg.w);vec3 v_unit=v_clip.xyz/e_clip;vec3 a_unit=abs(v_unit);float ma_unit=max(a_unit.x,max(a_unit.y,a_unit.z));if(ma_unit>1.0){return vec4(p_clip,avg.w)+v_clip/ma_unit;}else{return input_texel;}}vec3 clip_aabb_variance(in vec3 cOld,in vec3 cNew,in vec3 centre,in vec3 halfSize){if(all(lessThanEqual(abs(cOld-centre),halfSize))){return cOld;}vec3 dir=(cNew-cOld);vec3 near=centre-sign(dir)*halfSize;vec3 tAll=(near-cOld)/dir;float t=0.0001;for(int i=0;i<3;i++){if(tAll[i]>=0.0&&tAll[i]<t){t=tAll[i];}}if(t>=0.0001){return cOld;}return cOld+dir*t;}void main(){vec3 v=choose_motion_vector();vec2 velocity=v.rg;vec2 previousPixelPos=vUv-velocity;vec4 currentColor=sample_color(inputBuffer,vUv);
#ifdef USE_CATMULL_ROM
vec4 previousColor=sample_catmull_rom(historyBuffer,previousPixelPos,resolution);
#else
vec4 previousColor=sample_color(historyBuffer,previousPixelPos);
#endif
#ifdef USE_YCOCG
previousColor=vec4(RGB_YCoCg(previousColor.rgb),previousColor.a);
#endif
vec4 ctl=sample_color(inputBuffer,vTexCoords[0]);vec4 ctc=sample_color(inputBuffer,vTexCoords[1]);vec4 ctr=sample_color(inputBuffer,vTexCoords[2]);vec4 cml=sample_color(inputBuffer,vTexCoords[3]);vec4 cmc=sample_color(inputBuffer,vTexCoords[4]);vec4 cmr=sample_color(inputBuffer,vTexCoords[5]);vec4 cbl=sample_color(inputBuffer,vTexCoords[6]);vec4 cbc=sample_color(inputBuffer,vTexCoords[7]);vec4 cbr=sample_color(inputBuffer,vTexCoords[8]);vec4 cmin=min(ctl,min(ctc,min(ctr,min(cml,min(cmc,min(cmr,min(cbl,min(cbc,cbr))))))));vec4 cmax=max(ctl,max(ctc,max(ctr,max(cml,max(cmc,max(cmr,max(cbl,max(cbc,cbr))))))));vec4 cavg=(ctl+ctc+ctr+cml+cmc+cmr+cbl+cbc+cbr)/9.0;vec4 cmin5=min(ctc,min(cml,min(cmc,min(cmr,cbc))));vec4 cmax5=max(ctc,max(cml,max(cmc,max(cmr,cbc))));vec4 cavg5=(ctc+cml+cmc+cmr+cbc)/5.0;cmin=0.5*(cmin+cmin5);cmax=0.5*(cmax+cmax5);cavg=0.5*(cavg+cavg5);
#ifdef USE_YCOCG
vec2 chroma_extent=vec2(0.25*0.5*(cmax.r-cmin.r));vec2 chroma_center=currentColor.gb;cmin.yz=chroma_center-chroma_extent;cmax.yz=chroma_center+chroma_extent;cavg.yz=chroma_center;
#endif
vec4 previousColorClipped=clamp(previousColor,cmin,cmax);
#ifdef LUMINANCE_DIFFERENCES
#ifdef USE_YCOCG
float lum0=currentColor.r;float lum1=previousColorClipped.r;
#else
float lum0=luminance(currentColor.rgb);float lum1=luminance(previousColorClipped.rgb);
#endif
float unbiased_diff=abs(lum0-lum1)/max(lum0,max(lum1,0.2));float unbiased_weight=1.0-unbiased_diff;float unbiased_weight_sqr=unbiased_weight*unbiased_weight;float k_feedback=mix(feedback_min,feedback_max,unbiased_weight_sqr);vec4 result=mix(currentColor,previousColorClipped,vec4(k_feedback));
#else
const float alpha=0.1;vec4 result=mix(currentColor,previousColorClipped,1.0-alpha);
#endif
#ifdef USE_YCOCG
gl_FragColor=vec4(YCoCg_RGB(result.rgb).rgb,result.a);
#else
gl_FragColor=result;
#endif
}`,kut=`#define GLSLIFY 1
varying vec2 vUv;void main(){gl_Position=vec4(position.xy,1.0,1.0);vUv=position.xy*0.5+0.5;}`,Nut=`#define GLSLIFY 1
layout(location=1)out vec4 gVelocity;varying vec2 vUv;uniform sampler2D inputBuffer;void main(){gl_FragColor=texture2D(inputBuffer,vUv);gVelocity=vec4(0.0);}`,nV=class extends Tr{constructor(){super({name:"PassthroughMaterial",uniforms:{inputBuffer:new xt(null)},blending:Hs,depthWrite:!1,depthTest:!1,vertexShader:kut,fragmentShader:Nut})}set inputBuffer(t){this.uniforms.inputBuffer.value=t}},Uut=class extends El{constructor(){super("TAAResolvePass"),this.MRTCompatible=!0,this.needsSwap=!1,this.passThroughMaterial=new nV,this.resolutionVector=new Ae,this.resolveMaterial=new Tr({name:"TAAResolveMaterial",uniforms:{inputBuffer:new xt(null),historyBuffer:new xt(null),velocityBuffer:new xt(null),depthBuffer:new xt(null),resolution:new xt(new Ae)},blending:Hs,depthWrite:!1,depthTest:!1,vertexShader:Out,fragmentShader:Lut}),this.historyRenderTarget=new Mr(1024,1024,{minFilter:nr,stencilBuffer:!1,depthBuffer:!1}),this.historyRenderTarget.texture.name="TAA.History",this.resultRenderTarget=new Mr(1024,1024,{minFilter:nr,stencilBuffer:!1,depthBuffer:!1}),this.resultRenderTarget.texture.name="TAA.Output"}setSize(t,e){this.historyRenderTarget.setSize(t,e),this.resultRenderTarget.setSize(t,e)}render(t,e){this.fullscreenMaterial=this.resolveMaterial,this.resolveMaterial.uniforms.inputBuffer.value=e.texture[0],this.resolveMaterial.uniforms.velocityBuffer.value=e.texture[1],this.resolveMaterial.uniforms.depthBuffer.value=e.depthTexture,this.resolveMaterial.uniforms.historyBuffer.value=this.historyRenderTarget.texture,this.resolveMaterial.uniforms.resolution.value.set(e.width,e.height),t.setRenderTarget(this.resultRenderTarget),t.render(this.scene,this.camera),this.fullscreenMaterial=this.passThroughMaterial,this.passThroughMaterial.inputBuffer=this.resultRenderTarget.texture,t.setRenderTarget(this.historyRenderTarget),t.render(this.scene,this.camera);let i=this.renderToScreen?null:e;this.fullscreenMaterial=this.passThroughMaterial,this.passThroughMaterial.inputBuffer=this.resultRenderTarget.texture,t.setRenderTarget(i),t.render(this.scene,this.camera)}dispose(){this.resultRenderTarget.dispose(),this.historyRenderTarget.dispose(),this.resolveMaterial.dispose(),this.passThroughMaterial.dispose()}},But=class extends El{constructor(t,e,i){super("TransmissionPass",void 0,e),this.MRTCompatible=!0,this.depthPass=new Hte(t,e,{renderTarget:i.transmissionDepthTarget}),this.passThroughMaterial=new nV,this.splineScene=t,this.needsSwap=!1}updatePasses(t){this.passThroughMaterial=new nV,this.depthPass=new Hte(this.splineScene,this.camera,{renderTarget:t.transmissionDepthTarget})}setCamera(t){this.camera=t}setScene(t){this.splineScene=t}render(t,e,i){let r=this.camera.layers.mask,n=t;n.setRenderTarget(n.transmissionRenderTarget),this.fullscreenMaterial=this.passThroughMaterial,this.passThroughMaterial.inputBuffer=e.texture[0],n.clear(),n.render(this.scene,this.camera),this.camera.layers.disable(3),this.depthPass.render(t,e,i),n.shadowMap.needsUpdate=!1,n.shadowMap.autoUpdate=!1;let s=this.renderToScreen?null:e;this.camera.layers.set(3),t.setRenderTarget(s),t.render(this.splineScene,this.camera),this.camera.layers.mask=r}},Xte=new ac,Fut=new Tr({transparent:!0,vertexShader:`
        void main() {
            gl_Position = vec4(0.0);
        }
    `,fragmentShader:`
        layout(location = 1) out vec4 gVelocity;

        void main() {
            gl_FragColor = vec4(0.0);
			gVelocity = vec4(0.0);
        }
    `}),sV=class extends El{constructor(t,e,i){super("OpaquePass",e??Xte,i),this.MRTCompatible=!0,this.originalMaterials=[],this.hasTransmissionPass=!1,this.clear=!0,this.clearColorOnly=!1,this.clearDepth=!1,this.needsSwap=!1,this.MRTCompatible=t}setCamera(t){this.camera=t}setScene(t){this.scene=t??Xte}getScene(){return this.scene}render(t,e){this.camera.layers.enable(3),this.hasTransmissionPass&&(this.originalMaterials.length=0,this.scene.traverse(r=>{r.layers.isEnabled(3)&&r instanceof So&&(this.originalMaterials.push([r,r.material]),r.material=Fut)}),t.shadowMap.needsUpdate=!0,t.shadowMap.autoUpdate=!0),this.camera.layers.enable(8);let i=this.renderToScreen?null:e;t.setRenderTarget(i),this.clearColorOnly&&t.clear(!0,!1,!0),this.clear&&t.clear(),t.render(this.scene,this.camera),this.clearDepth&&t.clear(!1,!0,!1),this.hasTransmissionPass&&this.originalMaterials.forEach(r=>{r[0].material=r[1]})}},zut=class{constructor(t,{depthBuffer:e=!0,stencilBuffer:i=!1,multisampling:r=0,frameBufferType:n=0}={}){this.renderer=t,this.helperStartIndex=0,this.copyPass=new rV,this.depthTexture=null,this.timer=new iut,this._width=1,this._height=1,this.passes=[],this.helperPasses=[],this.autoRenderToScreen=!0,this.inputBuffer=this.createBuffer(e,i,n,r,!0,"input buffer mrt"),this.inputBufferSingle=this.createBuffer(e,i,n,r,!1," input buffer single"),this.inputBufferSingle.texture.dispose(),this.inputBufferSingle.depthTexture.dispose(),this.inputBufferSingle.texture=this.inputBuffer.texture[0],this.inputBufferSingle.depthTexture=this.inputBuffer.depthTexture,this.outputBuffer=this.inputBuffer.clone(),this.outputBuffer.name="output buffer mrt",this.outputBufferSingle=this.createBuffer(e,i,n,r,!1,"output buffer single"),this.outputBufferSingle.texture.dispose(),this.outputBufferSingle.depthTexture.dispose(),this.outputBufferSingle.texture=this.outputBuffer.texture[0],this.outputBufferSingle.depthTexture=this.outputBuffer.depthTexture,this.setRenderer(t)}get multisampling(){return this.inputBuffer.samples||0}set multisampling(t){let e=this.inputBuffer,i=this.multisampling;i>0&&t>0?(this.inputBuffer.samples=t,this.outputBuffer.samples=t,this.inputBuffer.dispose(),this.outputBuffer.dispose()):i!==t&&(this.inputBuffer.dispose(),this.outputBuffer.dispose(),console.log("creating new input buffer"),this.inputBuffer=this.createBuffer(e.depthBuffer,e.stencilBuffer,e.texture.type,t,!0,"new input buffer"),this.inputBuffer.depthTexture=this.depthTexture,this.outputBuffer=this.inputBuffer.clone())}getTimer(){return this.timer}getRenderer(){return this.renderer}setRenderer(t){if(this.renderer=t,t!==null){let e=t.getSize(new Ae),i=t.getContext().getContextAttributes()?.alpha??!1,r=this.inputBuffer.texture[0].type;r===Ho&&t.outputEncoding===er&&(this.inputBuffer.texture[0].encoding=er,this.outputBuffer.texture[0].encoding=er,this.inputBuffer.dispose(),this.outputBuffer.dispose(),console.log("doing some kinda dispose??")),t.autoClear=!1,this.setSize(e.width,e.height,!1);for(let n of this.passes)n.initialize(t,i,r)}}replaceRenderer(t,e=!0){let i=this.renderer,r=i.domElement.parentNode;return this.setRenderer(t),e&&r!==null&&(r.removeChild(i.domElement),r.appendChild(t.domElement)),i}createDepthTexture(){let t=this.depthTexture=new H1(this._width,this._height);return this.inputBuffer.depthTexture=t,this.inputBuffer.stencilBuffer?(t.format=N0,t.type=v0):t.type=Ap,t}deleteDepthTexture(){if(this.depthTexture!==null){this.depthTexture.dispose(),this.depthTexture=null,this.inputBuffer.depthTexture=null,this.inputBuffer.dispose();for(let t of this.passes)t.setDepthTexture(null)}}createBuffer(t,e,i,r,n,s){let a=this.renderer,o=a===null?new Ae:a.getDrawingBufferSize(new Ae),l={minFilter:nr,magFilter:nr,wrapS:kn,wrapT:kn,stencilBuffer:e,depthBuffer:t},c;return r>0?(c=new Mr(o.width,o.height,l),c.samples=r):(n?(c=new dhe(o.width,o.height,2,l),c.texture[1].type=qp):c=new Mr(o.width,o.height,l),c.depthTexture=new H1(2048,2048),c.depthTexture.type=cn),i===Ho&&a!==null&&a.outputEncoding===er&&(Array.isArray(c.texture)?c.texture.forEach(u=>u.encoding=er):c.texture.encoding=er),Array.isArray(c.texture)?c.texture.forEach((u,h)=>{u.name=`EffectComposer.Buffer ${n} ${h}`,u.generateMipmaps=!1}):(c.texture.name=`EffectComposer.Buffer ${n}`,c.texture.generateMipmaps=!1),c.name=s,c}addPass(t,e){let i=this.passes,r=this.renderer,n=r.getDrawingBufferSize(new Ae),s=r.getContext().getContextAttributes()?.alpha??!1,a;if(t.MRTCompatible&&(a=this.inputBuffer.texture[0].type),t.MRTCompatible||(a=this.inputBuffer.texture.type),t.setRenderer(r),t.setSize(n.width,n.height),t.initialize(r,s,a),this.autoRenderToScreen&&(i.length>0&&(i[i.length-1].renderToScreen=!1),t.renderToScreen&&(this.autoRenderToScreen=!1)),e!==void 0?i.splice(e,0,t):i.push(t),this.autoRenderToScreen&&(i[i.length-1].renderToScreen=!0),t.needsDepthTexture||this.depthTexture!==null)if(this.depthTexture===null){let o=this.createDepthTexture();for(t of i)t.setDepthTexture(o)}else t.setDepthTexture(this.depthTexture)}setHelperStartIndex(t){this.helperStartIndex=t}removePass(t){let e=this.passes,i=e.indexOf(t);if(i!==-1&&e.splice(i,1).length>0){if(this.depthTexture!==null){let r=(n,s)=>n||s.needsDepthTexture;e.reduce(r,!1)||t.getDepthTexture()===this.depthTexture&&t.setDepthTexture(null)}this.autoRenderToScreen&&i===e.length&&(t.renderToScreen=!1,e.length>0&&(e[e.length-1].renderToScreen=!0))}}removeAllPasses(){let t=this.passes;t.length>0&&(this.autoRenderToScreen&&(t[t.length-1].renderToScreen=!1),this.passes=[])}render(t){let e=this.renderer,i=this.copyPass,r=this.inputBuffer,n=this.outputBuffer,s=this.inputBufferSingle,a=this.outputBufferSingle,o=!1,l,c,u,h;t===void 0&&(t=this.timer.update().getDelta());for(let d of this.passes)d.enabled&&(d.MRTCompatible?d.render(e,r,n,t,o):d.render(e,s,a,t,o),d.needsSwap&&(o&&(i.renderToScreen=d.renderToScreen,l=e.getContext(),c=e.state.buffers.stencil,c.setFunc(l.NOTEQUAL,1,4294967295),i.render(e,r,n,t,o),c.setFunc(l.EQUAL,1,4294967295)),u=r,h=s,r=n,s=a,n=u,a=h),d instanceof eut?o=!0:d instanceof Pct&&(o=!1))}setSize(t,e,i){let r=this.renderer;if(this._width=t,this._height=e,t===void 0||e===void 0){let s=r.getSize(new Ae);t=s.width,e=s.height}r.setSize(t,e,i);let n=r.getDrawingBufferSize(new Ae);this.inputBuffer.setSize(n.width,n.height),this.outputBuffer.setSize(n.width,n.height),this.inputBufferSingle.setSize(n.width,n.height),this.outputBufferSingle.setSize(n.width,n.height);for(let s of this.passes)s.setSize(n.width,n.height)}reset(){let t=this.timer.isAutoResetEnabled();this.dispose(),this.autoRenderToScreen=!0,this.timer.setAutoResetEnabled(t)}dispose(){for(let t of this.passes)t.dispose();this.passes=[],this.inputBuffer!==null&&this.inputBuffer.dispose(),this.outputBuffer!==null&&this.outputBuffer.dispose(),this.inputBufferSingle!==null&&this.inputBufferSingle.dispose(),this.outputBufferSingle!==null&&this.outputBufferSingle.dispose(),this.deleteDepthTexture(),this.copyPass.dispose(),this.timer.dispose()}},jut=new Tr({name:"CombineMaterial",uniforms:{inputBufferA:new xt(null),inputBufferB:new xt(null)},blending:Hs,depthWrite:!1,depthTest:!1,vertexShader:`
varying vec2 vUv;
void main() {
    gl_Position = vec4(position.xy, 1.0, 1.0);
    vUv = position.xy * 0.5 + 0.5;
}
`,fragmentShader:`
    varying vec2 vUv;
    uniform sampler2D inputBufferA;
    uniform sampler2D inputBufferB;

    // TODO: Why do we need these when postpro of framemode is enabled???
    layout(location = 1) out vec4 gVelocity;

    void main() {
	vec4 resA = texture2D(inputBufferA, vUv);
	vec4 resB = texture2D(inputBufferB, vUv);
    float a = resA.a + resB.a * ( 1.0 - resA.a );

	vec4 res;
	res.rgb =  resA.rgb + (resB.rgb * (1.0 - resA.a));
	res.a = resA.a + resB.a * (1.0 - resA.a);
	gl_FragColor = res;
    gVelocity = vec4(0.0);
    }
`}),Vut=class extends El{constructor(t){super("HelperPass",void 0,t),this.MRTCompatible=!1,this.fullscreenMaterial=jut,this.helperPass=new sV(!1,void 0,this.camera),this.helperPass.hasTransmissionPass=!1,this.helperPass.clear=!1,this.helperPass.renderToScreen=!1,this.helperPassOnTop=new sV(!1,void 0,this.camera),this.helperPassOnTop.hasTransmissionPass=!1,this.helperPassOnTop.clear=!1,this.helperPassOnTop.renderToScreen=!1;let e=new nme({preset:qy.LOW,edgeDetectionMode:PL.COLOR});this.effectPass=new z3(this.camera,e),this.rt=new Mr(10,10,{minFilter:nr,magFilter:nr,wrapS:kn,wrapT:kn,depthBuffer:!0})}setSize(t,e){this.rt.setSize(t,e),this.effectPass.setSize(t,e)}set sceneHelpers(t){this.helperPass.setScene(t)}get sceneHelpers(){return this.helperPass.getScene()}set sceneHelpersOnTop(t){this.helperPassOnTop.setScene(t)}get sceneHelpersOnTop(){return this.helperPassOnTop.getScene()}setCamera(t){this.helperPass.setCamera(t),this.helperPassOnTop.setCamera(t)}initialize(t,e,i){super.initialize(t,e,i),this.effectPass.initialize(t,e,i)}dispose(){super.dispose(),this.rt.dispose(),this.effectPass.dispose()}render(t,e,i){this.rt.depthTexture=e.depthTexture;let r=t.getClearAlpha();t.setClearAlpha(0),this.helperPass.clearDepth=!0,this.helperPass.clearColorOnly=!0,this.helperPass.render(t,this.rt),this.helperPassOnTop.render(t,this.rt),this.effectPass.renderToScreen=!1,this.effectPass.render(t,this.rt,i),this.fullscreenMaterial.uniforms.inputBufferA.value=i.texture,this.fullscreenMaterial.uniforms.inputBufferB.value=e.texture,t.setClearAlpha(r),t.setRenderTarget(null),t.clear(),t.render(this.scene,this.camera)}},Hut=`#define GLSLIFY 1
#include <skinning_pars_vertex>
#include <morphtarget_pars_vertex>
out vec3 n;void main(){
#include <beginnormal_vertex>
#include <morphnormal_vertex>
#include <skinbase_vertex>
#include <skinnormal_vertex>
#include <defaultnormal_vertex>
#include <begin_vertex>
#include <morphtarget_vertex>
#include <skinning_vertex>
vec4 view_space=viewMatrix*modelMatrix*vec4(transformed,1.0);gl_Position=projectionMatrix*view_space;n=normalize(transformedNormal);}`,Gut=`#define GLSLIFY 1
in vec3 n;void main(){gl_FragColor=vec4(n,1.0);}`,Wut=`#define GLSLIFY 1
out vec2 v_uv;void main(){v_uv=uv;gl_Position=vec4(position.xy,1.0,1.0);}`,qut=`#define GLSLIFY 1
in vec2 v_uv;const float pi=3.14159265;const float num_steps=4.0;const float num_directions=4.0;uniform float near;uniform float far;uniform float fov;uniform vec4 proj_info;uniform bool is_ortho;uniform vec2 resolution;uniform float radius_of_influence;uniform float radius_in_screen_space;uniform float exponent;uniform vec3 ao_color;uniform float bias;uniform sampler2D texture_depth;uniform sampler2D texture_normals;uniform sampler2D texture_blue_noise;uniform sampler2D texture_blue_noise_in_disk;uniform sampler2D texture_color_pass;uniform int frame_index;uniform bool fog_enabled;uniform float fog_near;uniform float fog_far;vec3 uv_to_view_space(vec2 uv,float eye_z){return vec3((uv*proj_info.xy+proj_info.zw)*(is_ortho ? 1.0 : eye_z),eye_z);}float linearize_depth(float depth_sampled){float z=is_ortho ? depth_sampled : depth_sampled*2.0-1.0;return mix((2.0*near*far)/(far+near-z*(far-near)),near+z*(far-near),float(is_ortho));}vec3 get_view_position(vec2 uv_coords){float linear_depth=linearize_depth(texture(texture_depth,uv_coords).x);return uv_to_view_space(uv_coords,linear_depth);}vec3 min_difference(vec3 p,vec3 right,vec3 left){vec3 v1=right-p;vec3 v2=p-left;return(dot(v1,v1)<dot(v2,v2))? v1 : v2;}vec3 rebuild_normal(in vec2 uv,in vec3 p){vec2 one_over_resolution=1.0/resolution;vec3 r=get_view_position(uv+vec2(one_over_resolution.x,0));vec3 l=get_view_position(uv+vec2(-one_over_resolution.x,0));vec3 t=get_view_position(uv+vec2(0,one_over_resolution.y));vec3 b=get_view_position(uv+vec2(0,-one_over_resolution.y));return normalize(cross(min_difference(p,r,l),min_difference(p,t,b)));}float falloff(float distance_squared){float neg_inv_r2=-1.0/(radius_of_influence*radius_of_influence);return distance_squared*neg_inv_r2+1.0;}float ao_contribution(vec3 P,vec3 N,vec3 S){vec3 to_sample=S-P;float norm_squared=dot(to_sample,to_sample);float norm=sqrt(norm_squared);float cos_theta=dot(N,to_sample)/norm;return clamp(cos_theta-bias,0.0,1.0)*clamp(falloff(norm_squared),0.0,1.0);}float compute_ambient_occlusion(vec2 uv,float radius_in_screen_space,vec3 pc,vec3 view_space_n){vec2 one_over_resolution=1.0/resolution;ivec2 noise_uv=ivec2(int(mod(gl_FragCoord.x,128.0)),int(mod(gl_FragCoord.y,128.0)));float noise=texelFetch(texture_blue_noise,noise_uv,0).r;noise=fract(noise+0.61803398875*float(frame_index));float theta=noise*2.0*3.1415;float ct=cos(theta);float st=sin(theta);float step_size=radius_in_screen_space/(num_steps+1.0);const float angle_step=2.0*pi/num_directions;float contribution=0.0;for(int i=0;i<int(num_directions);++i){float current_pixel=step_size+1.0;for(int j=0;j<int(num_steps);++j){int index=i*int(num_steps)+j;vec2 blue_noise_sample=texelFetch(texture_blue_noise_in_disk,ivec2(index,0),0).rg;vec2 disk_point;disk_point.x=blue_noise_sample.x*ct-blue_noise_sample.y*st;disk_point.y=blue_noise_sample.x*st+blue_noise_sample.y*ct;vec2 sample_direction=disk_point;vec2 snapped_uv=round(current_pixel*sample_direction)*one_over_resolution+uv;vec3 ps=get_view_position(snapped_uv);current_pixel+=step_size;contribution+=ao_contribution(pc,view_space_n,ps);}}float mult=1.0/(1.0-bias);contribution*=mult/(num_directions*num_steps);return clamp(1.0-contribution*2.0,0.0,1.0);}
#define USE_GBUFFER_NORMALS
void main(){vec3 view_space_p=get_view_position(v_uv);
#ifdef USE_GBUFFER_NORMALS
vec3 view_space_n=texture(texture_normals,v_uv).rgb;view_space_n.z*=-1.0;
#else
vec3 view_space_n=-rebuild_normal(v_uv,view_space_p);
#endif
float radius_ss=radius_in_screen_space/(is_ortho ? 1.0 : view_space_p.z);float ao=compute_ambient_occlusion(v_uv,radius_ss,view_space_p,view_space_n);float final=pow(ao,exponent);if(view_space_p.z>=far){final=1.0;}vec3 color=mix(ao_color,vec3(1.0),final);if(fog_enabled){float fog_factor=smoothstep(fog_near,fog_far,view_space_p.z);color=mix(color,vec3(1.0),fog_factor);}gl_FragColor=vec4(color,1.0);}`,Xut=`#define GLSLIFY 1
out vec2 v_uv;void main(){gl_Position=vec4(position.xy,1.0,1.0);v_uv=uv;}`,$ut=`#define GLSLIFY 1
in vec2 v_uv;uniform sampler2D texture_ao_lrez;uniform sampler2D texture_depth_lrez;uniform sampler2D texture_depth_hrez;uniform float near;uniform float far;float linearize_depth(float depth_sampled){float z=depth_sampled*2.0-1.0;return(2.0*near*far)/(far+near-z*(far-near));}vec2 nearest_depth_filter(in vec2 uv){vec2 resolution=vec2(textureSize(texture_depth_lrez,0));vec2 texel_size=1.0/resolution;vec2 offset=uv-0.5*texel_size;float d_hrez=texture(texture_depth_hrez,uv).r;float a=abs(d_hrez-texture(texture_depth_lrez,offset).r);float b=abs(d_hrez-texture(texture_depth_lrez,offset+vec2(texel_size.x,0.0)).r);float c=abs(d_hrez-texture(texture_depth_lrez,offset+vec2(0.0,texel_size.y)).r);float d=abs(d_hrez-texture(texture_depth_lrez,offset+vec2(texel_size.x,texel_size.y)).r);float min_diff=min(a,min(b,min(c,d)));if(min_diff==a)return offset;if(min_diff==b)return offset+vec2(texel_size.x,0.0);if(min_diff==c)return offset+vec2(0.0,texel_size.y);if(min_diff==d)return offset+vec2(texel_size.x,texel_size.y);}void main(){
#ifdef DEBUG
float d_lrez=texture(texture_depth_lrez,v_uv).r;float d_hrez=texture(texture_depth_hrez,v_uv).r;float output_d=mix(linearize_depth(d_lrez)/far,linearize_depth(d_hrez)/far,step(0.5,v_uv.x));gl_FragColor=vec4(vec3(output_d),1.0);
#else
vec2 filtered_uv=nearest_depth_filter(v_uv);vec4 ao=texture(texture_ao_lrez,filtered_uv);gl_FragColor=vec4(ao.rgb,1.0);gl_FragColor=ao;
#endif
}`,ME=[[.478712,.875764],[-.337956,-.793959],[-.955259,-.028164],[.864527,.325689],[.209342,-.395657],[-.106779,.672585],[.156213,.235113],[-.413644,-.082856],[-.415667,.323909],[.141896,-.93998],[.954932,-.182516],[-.766184,.410799],[-.434912,-.458845],[.415242,-.078724],[.728335,-.491777],[-.058086,-.066401],[.20299,.686837],[-.808362,-.556402],[.507386,-.640839],[-.723494,-.22924],[.48974,.317826],[-.622663,.765301],[-.01064,.929347],[.663146,.647618],[-.096674,-.413835],[.525945,-.321063],[-.122533,.366019],[.195235,-.687983],[-.563203,.098748],[.418563,.561335],[-.378595,.800367],[.826922,.001024],[-.085372,-.766651],[-.92192,.183673],[-.590008,-.721799],[.167751,-.164393],[.032961,-.56253],[.6329,-.107059],[-.46408,.569669],[-.173676,-.958758],[-.242648,-.234303],[-.275362,.157163],[.382295,-.795131],[.562955,.115562],[.190586,.470121],[.770764,-.297576],[.237281,.93105],[-.666642,-.455871],[-.905649,-.298379],[.33952,.157829],[.701438,-.7041],[-.062758,.160346],[-.220674,.957141],[.642692,.432706],[-.77339,-.015272],[-.671467,.24688],[.158051,.062859],[.806009,.527232],[-.05762,-.247071],[.333436,-.51671],[-.550658,-.315773],[-.652078,.589846],[.008818,.530556],[-.210004,.519896]],Yut=new Tr({vertexShader:Hut,fragmentShader:Gut}),dw=new Tr({vertexShader:Xut,fragmentShader:$ut,uniforms:{texture_ao_lrez:new xt(null),texture_depth_lrez:new xt(null),texture_depth_hrez:new xt(null),near:new xt(null),far:new xt(null)}}),Kut=class extends El{constructor(t,e){super("AmbientOcclusionPass",void 0,e),this.fogEnabled=!1,this.fogNear=1,this.fogFar=1e3,this.frameIndex=0,this._runHalfRes=!0,this._width=1,this._height=1;let i=1024,r=1024;this.gBuffer=new Mr(i,r,{type:L_?qp:cn,depthTexture:new H1(i,r),minFilter:nr,magFilter:nr}),this.depthBufferHighRes=new Mr(i,r,{depthTexture:new H1(i,r)}),this.aoBuffer=new Mr(i,r,{minFilter:nr,magFilter:nr}),this.splineScene=t,this.splineCamera=e;let n=new Float32Array(ME.length*2);for(let a=0;a<ME.length;a++){let o=a*2;n[o+0]=ME[a][0],n[o+1]=ME[a][1]}this.blueNoiseInDiskTexture=new yl(n,ME.length,1,BD,cn),this.blueNoiseInDiskTexture.wrapS=Ep,this.blueNoiseInDiskTexture.wrapT=Ep,this.blueNoiseInDiskTexture.needsUpdate=!0,this.hbaoMaterial=new Tr({vertexShader:Wut,fragmentShader:qut,uniforms:{near:new xt(null),far:new xt(null),fov:new xt(null),proj_info:new xt(new Ui),is_ortho:new xt(!1),resolution:new xt(new Ae),radius_of_influence:new xt(8),radius_in_screen_space:new xt(1),exponent:new xt(1),ao_color:new xt(new W),bias:new xt(.5),texture_depth:new xt(null),texture_normals:new xt(null),texture_blue_noise:new xt(null),texture_blue_noise_in_disk:new xt(this.blueNoiseInDiskTexture),frame_index:new xt(0),fog_enabled:new xt(!1),fog_near:new xt(1),fog_far:new xt(1e3)}}),this.radius=128,this.aoColor={r:0,g:0,b:0},this.bias=.5,this.hbaoMaterial.uniforms.texture_depth.value=this.gBuffer.depthTexture,this.hbaoMaterial.uniforms.texture_normals.value=this.gBuffer.texture,this.needsSwap=!0,this.aaBuffer=new Mr(i,r,{minFilter:nr,magFilter:nr,wrapS:kn,wrapT:kn,depthBuffer:!1,type:cn});let s=new nme({preset:qy.ULTRA,edgeDetectionMode:PL.COLOR});this.effectPass=new z3(this.camera,s)}initialize(t,e,i){super.initialize(t,e,i),this.effectPass.initialize(t,e,i)}setBlueNoiseTexture(t){this.hbaoMaterial.uniforms.texture_blue_noise.value=t}setSize(t,e){this._width=t,this._height=e,this.depthBufferHighRes.setSize(t,e);let i=this._runHalfRes?.5:1,r=t*i,n=e*i;this.gBuffer.setSize(r,n),this.aoBuffer.setSize(r,n),this.hbaoMaterial.uniforms.resolution.value.set(r,n),this.aaBuffer.setSize(r,n),this.effectPass.setSize(r,n)}get runHalfRes(){return this._runHalfRes}set runHalfRes(t){this._runHalfRes=t,this.setSize(this._width,this._height)}setCamera(t){this.splineCamera=t}setScene(t){this.splineScene=t}setDepthTexture(t){this.depthBufferHighRes.depthTexture=t,dw.uniforms.texture_depth_hrez.value=t,dw.needsUpdate=!0}render(t,e,i){this.splineScene.overrideMaterial=Yut;let r=this.splineCamera.layers.mask;if(this.splineCamera.layers.set(5),t.setRenderTarget(this.gBuffer),t.clear(),t.render(this.splineScene,this.splineCamera),t.setRenderTarget(this.depthBufferHighRes),t.clear(),t.render(this.splineScene,this.splineCamera),this.splineScene.overrideMaterial=null,this.splineCamera.layers.mask=r,this.hbaoMaterial.uniforms.radius_of_influence.value=this.radius,this.hbaoMaterial.uniforms.ao_color.value.set(this.aoColor.r,this.aoColor.g,this.aoColor.b),this.hbaoMaterial.uniforms.bias.value=this.bias,this.hbaoMaterial.uniforms.fog_enabled.value=this.fogEnabled,this.hbaoMaterial.uniforms.fog_near.value=this.fogNear,this.hbaoMaterial.uniforms.fog_far.value=this.fogFar,this.hbaoMaterial.uniforms.frame_index.value=this.frameIndex,this.frameIndex++,this.splineCamera.isPerspectiveCamera){this.hbaoMaterial.uniforms.near.value=this.splineCamera.perspCamera.near,this.hbaoMaterial.uniforms.far.value=this.splineCamera.perspCamera.far;let n=this.splineCamera.perspCamera.projectionMatrix.elements,s=2/n[0],a=2/n[5],o=-(1-n[8])/n[0],l=-(1+n[9])/n[5];this.hbaoMaterial.uniforms.proj_info.value.set(s,a,o,l);let c=this.splineCamera.perspCamera.fov*(Math.PI/180),u=this.hbaoMaterial.uniforms.resolution.value.y/(Math.tan(c*.5)*2),h=this.hbaoMaterial.uniforms.radius_of_influence.value*.5*u;this.hbaoMaterial.uniforms.radius_in_screen_space.value=h,this.hbaoMaterial.uniforms.is_ortho.value=!1}else{this.hbaoMaterial.uniforms.near.value=this.splineCamera.orthoCamera.near,this.hbaoMaterial.uniforms.far.value=this.splineCamera.orthoCamera.far;let n=this.splineCamera.orthoCamera.projectionMatrix.elements,s=2/n[0],a=2/n[5],o=-(1+n[12])/n[0],l=-(1-n[13])/n[5];this.hbaoMaterial.uniforms.proj_info.value.set(s,a,o,l);let c=.5*(this.hbaoMaterial.uniforms.resolution.value.y/a),u=this.hbaoMaterial.uniforms.radius_of_influence.value*c;this.hbaoMaterial.uniforms.radius_in_screen_space.value=u,this.hbaoMaterial.uniforms.is_ortho.value=!0}this.runHalfRes?(this.fullscreenMaterial=this.hbaoMaterial,t.setRenderTarget(this.aoBuffer),t.clear(),t.render(this.scene,this.camera),this.fullscreenMaterial=dw,dw.uniforms.texture_ao_lrez.value=this.aoBuffer.texture,dw.uniforms.texture_depth_lrez.value=this.gBuffer.depthTexture,dw.uniforms.texture_depth_hrez.value=this.depthBufferHighRes.depthTexture,t.setRenderTarget(t.aoRenderTarget),t.clear(),t.render(this.scene,this.camera)):(this.fullscreenMaterial=this.hbaoMaterial,t.setRenderTarget(this.aaBuffer),t.clear(),t.render(this.scene,this.camera),this.effectPass.renderToScreen=!1,this.effectPass.render(t,this.aaBuffer,t.aoRenderTarget))}dispose(){this.gBuffer.dispose(),this.depthBufferHighRes.dispose(),this.aoBuffer.dispose()}},Zut=`
varying vec2 vUv;
void main() {
    vUv = uv;
    gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,Qut=`
uniform sampler2D tInput;
uniform sampler2D tMap;
uniform vec2 resolution;
varying vec2 vUv;

uniform vec2 uResolution;
uniform vec2 uCoords;

// Draws a rectangle at center <st> with size <size>
float rectangle(vec2 st, vec2 size) {
    size = vec2(0.5) - size * 0.5;
    vec2 uv = vec2(step(size.x, st.x), step(size.y, st.y));
    uv *= vec2(step(size.x, 1.0 - st.x), step(size.y, 1.0 - st.y));

    return uv.x * uv.y;
}

uniform vec2 uSize;
uniform float uScale;
uniform float uDPR;
uniform float uCurrent;
uniform vec3 uSceneColor;

void main() {
    vec2 screenUv = gl_FragCoord.xy / uResolution.xy;
    screenUv *= 1.0 / uDPR;

    vec2 center = vec2(0.5, -0.5);
    vec2 outsideUv = screenUv;
    outsideUv += center;
    outsideUv -= uCoords.xy / uResolution.xy;
    outsideUv = (outsideUv - 0.5) + 0.5;
    outsideUv -= center;
    vec2 s = (uSize / uResolution) * uScale;
    float isOutside = 1.0 - rectangle(outsideUv, s);
    
    vec2 mid = vec2(0.5);
    vec2 insideUv = (screenUv - mid + s * mid) / s;
    vec4 background = texture2D(tInput, screenUv);
    vec4 image = texture2D(tMap, insideUv);
    gl_FragColor = mix(image, background, isOutside);
}
`,Jut=class extends fu{constructor(){super(new Tr({vertexShader:Zut,fragmentShader:Qut,uniforms:{tInput:new xt(null),tMap:new xt(null),uResolution:new xt(new Ae),uSize:new xt(new Ae),uCoords:new xt(new Ae),uScale:new xt(1),uSceneColor:new xt(new Ai(16711680)),uDPR:new xt(1),uCurrent:new xt(0)}}),"tInput"),this.needsSwap=!0}get uniforms(){return this.fullscreenMaterial.uniforms}get texture(){return this.uniforms.tMap.value}set texture(t){this.uniforms.tMap.value=t}},eht=`
void main() {
    gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,tht=`
uniform sampler2D toScene;
uniform sampler2D fromScene;
uniform vec2 resolution;

uniform vec2 uResolution;
uniform float uDPR;

uniform float mixRatio;
uniform sampler2D tMixTexture;
uniform int useTexture;
uniform float threshold;

void main() {
	vec2 screenUv = gl_FragCoord.xy / uResolution.xy;
	screenUv *= 1.0 / uDPR;

	vec4 texel1 = texture2D( fromScene, screenUv );
	vec4 texel2 = texture2D( toScene, screenUv );

	if (useTexture==1) {
		
		vec4 transitionTexel = texture2D( tMixTexture, screenUv );
		float r = mixRatio * (1.0 + threshold * 2.0) - threshold;
		float mixf=clamp((transitionTexel.r - r)*(1.0/threshold), 0.0, 1.0);
		
		gl_FragColor = mix( texel1, texel2, mixf );
	} else {
		
		gl_FragColor = mix( texel1, texel2, mixRatio );
		
	}
}
`,iht=[],rht=class extends fu{constructor(){super(new Tr({vertexShader:eht,fragmentShader:tht,uniforms:{toScene:new xt(null),fromScene:new xt(null),uResolution:new xt(new Ae),uDPR:new xt(1),mixRatio:new xt(0),threshold:new xt(.1),useTexture:new xt(0),tMixTexture:{value:iht[0]}}}),"toScene"),this.needsSwap=!0}get uniforms(){return this.fullscreenMaterial.uniforms}get texture(){return this.uniforms.fromScene.value}set texture(t){this.uniforms.fromScene.value=t}},nht=`
void main() {
    gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,sht=`
uniform sampler2D inputBuffer;
uniform sampler2D blurredInputBuffer;
uniform sampler2D overlay;
uniform float blurIntensity;

uniform vec2 uResolution;
uniform float uDPR;

void main() {
	vec2 screenUv = gl_FragCoord.xy / uResolution.xy;
	screenUv *= 1.0 / uDPR;

	vec4 texel1 = texture2D( overlay, screenUv );
	vec4 texel2 = texture2D( inputBuffer, screenUv );
	vec4 texel3 = texture2D( blurredInputBuffer, screenUv );

	float blurMask2 = max(sign(texel1.a), 0.0) * blurIntensity;
    gl_FragColor = mix( mix(texel2, texel3, blurMask2), texel1, texel1.a );
}
`,aht=class extends fu{constructor(){super(new Tr({vertexShader:nht,fragmentShader:sht,uniforms:{inputBuffer:new xt(null),blurredInputBuffer:new xt(null),overlay:new xt(null),uResolution:new xt(new Ae),uDPR:new xt(1),blurIntensity:new xt(0)}})),this._blurEnabled=!1,this.blurTarget=new Mr(1,1,{minFilter:nr,magFilter:nr,wrapS:kn,wrapT:kn}),this.blurPass=new v8({width:window.innerWidth,height:window.innerHeight,kernelSize:RL.HUGE,resolutionScale:.25}),this.blurPass.renderToScreen=!1,this.uniforms.blurredInputBuffer.value=this.blurTarget.texture}get uniforms(){return this.fullscreenMaterial.uniforms}get texture(){return this.uniforms.overlay.value}set texture(t){this.uniforms.overlay.value=t}setResolution(t,e,i=1){this.uniforms.uResolution.value.set(t,e),this.uniforms.uDPR.value=i,this.blurPass.setSize(t,e),this.blurTarget.setSize(t,e),this.blurPass.setSize(t,e)}get uiCanvas(){return this._uiCanvas}set uiCanvas(t){this._uiCanvas=t,t.texture&&(this.uniforms.overlay.value=t.texture);let e=t.frame;if(e){let i=e.data.backgroundBlur,r=i.radius;this._blurEnabled=i.enabled,this.uniforms.blurIntensity.value=this._blurEnabled?1:0,this.blurPass.scale=r/3}}render(t,e,i,r,n){this._blurEnabled&&(this.blurPass.setDepthTexture(this.getDepthTexture()),this.blurPass.render(t,e,this.blurTarget,r,n)),super.render(t,e,i,r,n)}},oht=`
varying vec2 vUv;
void main() {
    vUv = uv;
    gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,lht=`
uniform sampler2D tInput;
uniform sampler2D tOverlayImage;
varying vec2 vUv;
uniform vec2 uResolution;
uniform vec2 uRightBottom;
uniform vec2 uImageSize;
uniform float uScale;
uniform float uDPR;

vec3 blendNormal(vec3 base, vec3 blend) {
	return blend;
}

vec3 blendNormal(vec3 base, vec3 blend, float opacity) {
	return (blendNormal(base, blend) * opacity + base * (1.0 - opacity));
}

vec4 drawFixedSizeImage(sampler2D image, vec2 screenUV, vec2 imageSize, vec2 imageCoords, vec2 screenSize, float dpr) {
	vec2 uv = (screenUV * screenSize * dpr - imageCoords) / (imageSize * dpr);
	if (uv.x < 0.0 || uv.x > 1.0 || uv.y < 0.0 || uv.y > 1.0) {
		return vec4(0.0);
	}
	return texture2D(image, uv);
}

void main() {
    vec2 screenUV = gl_FragCoord.xy / (uResolution.xy * uDPR);
	vec2 imageCoords = vec2(uResolution.x * uDPR - uImageSize.x * uScale * uDPR - uRightBottom.x * uDPR, uRightBottom.y * uDPR);
    vec4 background = texture2D(tInput, screenUV);
    vec4 image = drawFixedSizeImage(tOverlayImage, screenUV, uImageSize * uScale, imageCoords, uResolution, uDPR);
    gl_FragColor = vec4(blendNormal(background.rgb, image.rgb, image.a), max(background.a, image.a));
}
`,cht=class extends fu{constructor(){super(new Tr({vertexShader:oht,fragmentShader:lht,uniforms:{tInput:new xt(null),tOverlayImage:new xt(null),uResolution:new xt(new Ae),uImageSize:new xt(new Ae),uRightBottom:new xt(new Ae(20,20)),uScale:new xt(.25),uDPR:new xt(1)}}),"tInput")}get uniforms(){return this.fullscreenMaterial.uniforms}get texture(){return this.uniforms.tOverlayImage.value}set texture(t){this.uniforms.tOverlayImage.value=t,this.uniforms.uImageSize.value.set(t.image.width,t.image.height)}};function $te(t,e){return e&&e.enabled&&t.push(e.effect),t}var uht=t=>Object.values(Rr).includes(t)?t:Rr.NORMAL,hht=class extends Qa{constructor(t,e){super(),this._needsDOFResize=e,this.postprocessingState=x3.defaultData,this._scene=new ac,this._camera=new Gs,this.effects=new Map,this.blueNoiseTexture=new yl,this._renderToScreen=!0,this._isUIOverlayEnabled=!1,this.clock=new $7e,this.renderer=t,this.debug=!1,this.effects.set("bloom",new Eut),this.effects.set("chromaticAberration",new Mut),this.effects.set("vignette",new Rut),this.effects.set("noise",new Put),this.effects.set("colorAverage",new Tut),this.effects.set("hueSaturation",new Cut),this.effects.set("brightnessContrast",new Aut),this.effects.set("depthOfField",new Iut),this.effects.set("pixelation",new Dut),this.effectComposer=new zut(this.renderer),this.effectComposer.autoRenderToScreen=!1,this.opaquePass=new sV(!0,this.scene,this.camera),this.opaquePass.clear=!0,this.transmissionPass=new But(this.scene,this.camera,this.renderer),this.aoPass=new Kut(this.scene,this.camera),this.taaPass=new Uut,this.taaPass.renderToScreen=!1,this.helperPass=new Vut(this.camera),this.helperPass.renderToScreen=!1,this.stylesOverlayPass=new Jut,this.stylesOverlayPass.enabled=!1,this.uiOverlayPass=new aht,this.uiOverlayPass.enabled=!1,this.logoOverlayPass=new cht,this.logoOverlayPass.enabled=!1,this.sceneTransitionPass=new rht,this.sceneTransitionPass.enabled=!1,this._initCopyPass(),this._initPasses()}set overlayTexture(t){t!==void 0?(this.stylesOverlayPass.texture=t,this.stylesOverlayPass.enabled=!0):this.stylesOverlayPass.enabled=!1}get overlayTexture(){return this.stylesOverlayPass.texture}set sceneHelpers(t){this.helperPass.sceneHelpers=t}get sceneHelpers(){return this.helperPass.sceneHelpers}set sceneHelpersOnTop(t){this.helperPass.sceneHelpersOnTop=t}get sceneHelpersOnTop(){return this.helperPass.sceneHelpersOnTop}get scene(){return this._scene}set scene(t){this._scene=t,this.opaquePass.setScene(t),this.transmissionPass.setScene(t),this.aoPass.setScene(t)}get camera(){return this._camera}set camera(t){let e=this._camera!==t;this._camera=t,this.opaquePass.setCamera(t),this.transmissionPass.setCamera(t),e&&this.transmissionPass.updatePasses(this.renderer),this.aoPass.setCamera(t),this.helperPass.setCamera(t),this.effects.get("depthOfField").setCamera(t)}updateRenderToScreen(){let t=!1;for(let e=this.effectComposer.passes.length-1;e>=0;e--){let i=this.effectComposer.passes[e];if(i.enabled===!0&&!t&&this._renderToScreen){i.renderToScreen=!0,t=!0;continue}i.renderToScreen=!1}}get isUIOverlayEnabled(){return this._isUIOverlayEnabled}disableUIOverlay(){this._isUIOverlayEnabled=!1}enableUIOverlay(){this._isUIOverlayEnabled=!0}disableHelpers(){this.helperPass.enabled=!1,this.updateRenderToScreen()}enableHelpers(){this.helperPass.enabled=!0,this.updateRenderToScreen()}updateBlueNoiseTexture(t){this.blueNoiseTexture=new yl(t,128,128),this.blueNoiseTexture.wrapS=Ep,this.blueNoiseTexture.wrapT=Ep,this.blueNoiseTexture.minFilter=mr,this.blueNoiseTexture.magFilter=mr,this.blueNoiseTexture.needsUpdate=!0}setAmbientOcclusionParams(t,e,i,r,n,s,a,o){this.aoPass.enabled=t,this.aoPass.radius=e,this.aoPass.bias=i,this.aoPass.aoColor=r,this.aoPass.fogEnabled=n,this.aoPass.fogNear=s,this.aoPass.fogFar=a,this.aoPass.runHalfRes!==!o&&(this.aoPass.runHalfRes=!o)}setTransmissionPassEnabled(t){this.transmissionPass.enabled=t,this.opaquePass.hasTransmissionPass=t}_initPasses(){if(this.uvEffectPass?.dispose(),this.effectPass?.dispose(),this.effectComposer.removeAllPasses(),this.transmissionPass.updatePasses(this.renderer),this.effectComposer.addPass(this.aoPass),this.effectComposer.addPass(this.opaquePass),this.effectComposer.addPass(this.transmissionPass),this.effectComposer.addPass(this.taaPass),this.postprocessingState.enabled){let t=[this.effects.get("pixelation")].reduce($te,[]);t.length>0&&(this.uvEffectPass=new z3(this.camera,...t),this.uvEffectPass.renderToScreen=!1,this.effectComposer.addPass(this.uvEffectPass));let e=[this.effects.get("chromaticAberration"),this.effects.get("bloom"),this.effects.get("depthOfField"),this.effects.get("colorAverage"),this.effects.get("hueSaturation"),this.effects.get("brightnessContrast"),this.effects.get("vignette"),this.effects.get("noise")].reduce($te,[]);if(e.length>0&&(this.effectPass=new z3(this.camera,...e),this.effectPass.renderToScreen=!1,this.effectComposer.addPass(this.effectPass),this._needsDOFResize&&this.effects.get("depthOfField")?.enabled&&window!==void 0)){let i=this.renderer.viewportWidth,r=this.renderer.viewportHeight;this.renderer.setSize(i-1,r-1),this.renderer.setSize(i,r)}}this.effectComposer.addPass(this.stylesOverlayPass),this.effectComposer.addPass(this.uiOverlayPass),this.effectComposer.addPass(this.sceneTransitionPass),this.effectComposer.addPass(this.helperPass),this.effectComposer.addPass(this.logoOverlayPass)}_initCopyPass(){if(this._savePass)return;let t=new Ae;this.renderer.getDrawingBufferSize(t),this._rt=new Mr(t.x,t.y,{depthBuffer:!1,stencilBuffer:!1,wrapS:Ep,wrapT:Ep}),this._rt.samples=0,this._savePass=new rV(this._rt,!1),this._savePass.renderToScreen=!1}setCopyPass(t){this._rt=t,this._savePass=new rV(this._rt,!1),this.renderToScreen=!1}get renderToScreen(){return this._renderToScreen}set renderToScreen(t){if(this._renderToScreen===t)return;let e=this.effectComposer;!e||(t===!0?e.removePass(this._savePass):e.addPass(this._savePass),this._renderToScreen=t,this.updateRenderToScreen())}set sceneTransitionFromTexture(t){t!==this.sceneTransitionPass.texture&&(t!==null?this.sceneTransitionPass.enabled=!0:(this.sceneTransitionPass.enabled=!1,this.updateRenderToScreen()),this.sceneTransitionPass.texture=t)}setWatermark(t){this.logoOverlayPass.enabled=t!==null,t&&(this.logoOverlayPass.texture=t)}get texture(){return this._rt&&this._rt.texture}get renderTarget(){return this._rt}updatePostprocessing(t){let{enabled:e,...i}=t,r=!1;e!==this.postprocessingState.enabled&&(r=!0);for(let n of Object.entries(i)){let s=n[1],a=this.effects.get(n[0]);if(a){a.enabled!==s.enabled&&(r=!0),a.enabled=s.enabled;for(let[o,l]of Object.entries(s))o==="blendFunction"?a.blendFunction=uht(l):a[o]=l}}this.postprocessingState=t,r&&this._initPasses()}render(){this.effectComposer.render(this.clock.getDelta())}setScissor(t,e,i,r){t instanceof Ui?(this.effectComposer.inputBuffer.scissor.set(t.x,t.y,t.z,t.w),this.effectComposer.outputBuffer.scissor.set(t.x,t.y,t.z,t.w)):(this.effectComposer.inputBuffer.scissor.set(t,e,i,r),this.effectComposer.outputBuffer.scissor.set(t,e,i,r));let n=this.renderer.getPixelRatio();this.effectComposer.inputBuffer.scissor.multiplyScalar(n),this.effectComposer.outputBuffer.scissor.multiplyScalar(n),this.renderer.setScissor(t,e,i,r)}setScissorTest(t){this.effectComposer.inputBuffer.scissorTest=t,this.effectComposer.outputBuffer.scissorTest=t,this.renderer.setScissorTest(t)}setViewport(t,e,i,r){t instanceof Ui?(this.effectComposer.inputBuffer.viewport.copy(t),this.effectComposer.outputBuffer.viewport.copy(t)):(this.effectComposer.inputBuffer.viewport.set(t,e,i,r),this.effectComposer.outputBuffer.viewport.set(t,e,i,r))}resize(t,e,i){if(this.effectComposer.setSize(t,e,i),this._rt){let r=this.renderer.getPixelRatio();this._rt.setSize(t*r,e*r)}}dispose(){this.uvEffectPass?.dispose(),this.effectPass?.dispose(),this.effectComposer.dispose()}},dht=t=>`

// PCSS implementation based on:
// https://www.gamedev.net/articles/programming/graphics/contact-hardening-soft-shadows-made-fast-r4906/
// NOTE: This number affects how big the shadow blur can
// possibly get. Bigger number == bigger blur, but less precise results

const float  gPenumbraFilterSize = 80.0;
const int   gPenumbraSamples = ${t};
const int gShadowSamples = ${t};
const float gShadowSamplesRpc = 1.0f / float(gShadowSamples);

#ifdef USE_SHADOWMAP
    #if NUM_DIR_LIGHT_SHADOWS > 0

        uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];
        varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];

        struct DirectionalLightShadow {
            float shadowBias;
            float shadowNormalBias;
            float shadowRadius;
            vec2 shadowMapSize;
        };

        uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];

    #endif

    #if NUM_SPOT_LIGHT_SHADOWS > 0

        uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];
        varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_SHADOWS ];

        struct SpotLightShadow {
            float shadowBias;
            float shadowNormalBias;
            float shadowRadius;
            vec2 shadowMapSize;
        };

        uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];

    #endif

    #if NUM_POINT_LIGHT_SHADOWS > 0

        uniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];
        varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];

        struct PointLightShadow {
            float shadowBias;
            float shadowNormalBias;
            float shadowRadius;
            vec2 shadowMapSize;
            float shadowCameraNear;
            float shadowCameraFar;
        };

        uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];

    #endif

    /*
    #if NUM_RECT_AREA_LIGHTS > 0

        // TODO (abelnation): create uniforms for area light shadows

    #endif
    */

float computePenumbra(int index, sampler2D shadowMap, float temporalAngle, float texelSize, vec2 uv, float compare, float texelScalar, float shadowRadius)
{
    float penumbra = 1.0;
    float blockerDepthAvg = 0.0;
    float blockerCount = 0.0;

    #pragma unroll_loop_start
    for(int i = 0; i < gPenumbraSamples; i ++)
    {
        vec2 offset = (vogelDiskSample(i, gShadowSamples, temporalAngle) * texelSize) * texelScalar;
        float depth = unpackRGBAToDepth( texture2D( shadowMap, uv + offset ) );

        if(depth < compare + 0.0001)
        {
            blockerDepthAvg += depth;
            blockerCount++;
        }
    }
    #pragma unroll_loop_end

    if (blockerCount > 0.0)
    {
        blockerDepthAvg /= blockerCount;

        // Compute penumbra
        penumbra = (compare - blockerDepthAvg) / (blockerDepthAvg);
        penumbra *= penumbra;
        penumbra *= 200.0 * penumbraSize[min(index, 5 - 1)]; // Magic number that affects how quickly the penumbra grows

        return clamp(penumbra, 0.00, 1.0);
    }
    return 0.0;
}

float vogelShadow(int index, sampler2D shadowMap, vec2 uv, float texelSize, float compare, float shadowRadius)
{
    float shadow         = 0.0f;

    // NOTE: When using TAA, we should use screen space interleaved gradient noise
    vec2 halton = haltonSequence[frameIndex];
    float temporalOffset = getNoiseInterleavedGradient(gl_FragCoord.xy + halton);
    float temporalAngle  = temporalOffset * PI2;

    float texelScalar = (gPenumbraFilterSize) / (texelSize * 1024.);
    float penumbra = computePenumbra(index, shadowMap, temporalAngle, texelSize, uv, compare, texelScalar, shadowRadius);
    if (penumbra == -1.0) {
        return 1.0;
    }

    #pragma unroll_loop_start
    for (int i = 0; i < gShadowSamples; i++)
    {
        vec2 vogelSample =  vogelDiskSample(i, gShadowSamples, temporalAngle) * texelSize;
        // Overall blurring offset
        vec2 offset = vogelSample * (shadowRadius * 2.);

        // Penumbra offset
        offset += vogelSample * (penumbra * texelScalar);

        shadow += step( compare, unpackRGBAToDepth( texture2D( shadowMap, uv + offset ) ) );
    }
    #pragma unroll_loop_end

    return shadow * gShadowSamplesRpc;
}


    float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {

        return step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );

    }

    vec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {

        return unpackRGBATo2Half( texture2D( shadow, uv ) );

    }

    float VSMShadow (sampler2D shadow, vec2 uv, float compare ){

        float occlusion = 1.0;

        vec2 distribution = texture2DDistribution( shadow, uv );

        float hard_shadow = step( compare , distribution.x ); // Hard Shadow

        if (hard_shadow != 1.0 ) {

            float distance = compare - distribution.x ;
            float variance = max( 0.00000, distribution.y * distribution.y );
            float softness_probability = variance / (variance + distance * distance ); // Chebeyshevs inequality
            softness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 ); // 0.3 reduces light bleed
            occlusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );

        }
        return occlusion;

    }

    float getShadow( int i, sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {

        float shadow = 1.0;

        shadowCoord.xyz /= shadowCoord.w;
        shadowCoord.z += shadowBias;

        // if ( something && something ) breaks ATI OpenGL shader compiler
        // if ( all( something, something ) ) using this instead

        bvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );
        bool inFrustum = all( inFrustumVec );

        bvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );

        bool frustumTest = all( frustumTestVec );

        if ( frustumTest ) {

        #if defined( SHADOWMAP_TYPE_PCF )

            vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
            return vogelShadow(i, shadowMap, shadowCoord.xy, texelSize.x, shadowCoord.z, shadowRadius );

        #elif defined( SHADOWMAP_TYPE_PCF_SOFT )

            vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
            float dx = texelSize.x;
            float dy = texelSize.y;

            vec2 uv = shadowCoord.xy;
            vec2 f = fract( uv * shadowMapSize + 0.5 );
            uv -= f * texelSize;

            shadow = (
                texture2DCompare( shadowMap, uv, shadowCoord.z ) +
                texture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +
                texture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +
                texture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +
                mix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),
                     texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),
                     f.x ) +
                mix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),
                     texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),
                     f.x ) +
                mix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),
                     texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),
                     f.y ) +
                mix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),
                     texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),
                     f.y ) +
                mix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),
                          texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),
                          f.x ),
                     mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),
                          texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),
                          f.x ),
                     f.y )
            ) * ( 1.0 / 9.0 );

        #elif defined( SHADOWMAP_TYPE_VSM )

            shadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );

        #else // no percentage-closer filtering:

            shadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );

        #endif

        }

        return shadow;

    }

    // cubeToUV() maps a 3D direction vector suitable for cube texture mapping to a 2D
    // vector suitable for 2D texture mapping. This code uses the following layout for the
    // 2D texture:
    //
    // xzXZ
    //  y Y
    //
    // Y - Positive y direction
    // y - Negative y direction
    // X - Positive x direction
    // x - Negative x direction
    // Z - Positive z direction
    // z - Negative z direction
    //
    // Source and test bed:
    // https://gist.github.com/tschw/da10c43c467ce8afd0c4

    vec2 cubeToUV( vec3 v, float texelSizeY ) {

        // Number of texels to avoid at the edge of each square

        vec3 absV = abs( v );

        // Intersect unit cube

        float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );
        absV *= scaleToCube;

        // Apply scale to avoid seams

        // two texels less per square (one texel will do for NEAREST)
        v *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );

        // Unwrap

        // space: -1 ... 1 range for each square
        //
        // #X##         dim    := ( 4 , 2 )
        //  # #         center := ( 1 , 1 )

        vec2 planar = v.xy;

        float almostATexel = 1.5 * texelSizeY;
        float almostOne = 1.0 - almostATexel;

        if ( absV.z >= almostOne ) {

            if ( v.z > 0.0 )
                planar.x = 4.0 - v.x;

        } else if ( absV.x >= almostOne ) {

            float signX = sign( v.x );
            planar.x = v.z * signX + 2.0 * signX;

        } else if ( absV.y >= almostOne ) {

            float signY = sign( v.y );
            planar.x = v.x + 2.0 * signY + 2.0;
            planar.y = v.z * signY - 2.0;

        }

        // Transform to UV space

        // scale := 0.5 / dim
        // translate := ( center + 0.5 ) / dim
        return vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );

    }

    float getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {

        float shadow = 1.0;
        vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );

        // for point lights, the uniform @vShadowCoord is re-purposed to hold
        // the vector from the light to the world-space position of the fragment.
        vec3 lightToPosition = shadowCoord.xyz;

        // dp = normalized distance from light to fragment position
        float compare = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear ); // need to clamp?
        compare += shadowBias;

        // bd3D = base direction 3D
        vec3 bd3D = normalize( lightToPosition );

        vec2 halton = haltonSequence[frameIndex];
        float temporalOffset = getNoiseInterleavedGradient(gl_FragCoord.xy + halton);
        float temporalAngle  = temporalOffset * PI2;

        #if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_VSM )
            for (int i = 0; i < gShadowSamples; i++) {
                vec2 vogelSample = vogelDiskSample(i, gShadowSamples, temporalAngle) * texelSize;

                // Overall blurring offset
                vec3 offset = vec3(vogelSample.x, vogelSample.y, -vogelSample.x) * (shadowRadius + 5.);

                // NOTE: Removed for now
                // Penumbra offset
                //offset += vec3(vogelSample.x, vogelSample.y, vogelSample.y)  * (penumbra * gPenumbraFilterSize);

                shadow += texture2DCompare( shadowMap, cubeToUV( bd3D + offset, texelSize.y ), compare );

            }
            return shadow * gShadowSamplesRpc;

        #elif defined( SHADOWMAP_TYPE_PCF_SOFT )
            for (int i = 0; i < 16; i++) {
                vec2 vogelSample = vogelDiskSample(i, gShadowSamples, temporalAngle) * texelSize;

                // Overall blurring offset
                vec3 offset = vec3(vogelSample.x, vogelSample.y, -vogelSample.x) * (shadowRadius + 5.);

                shadow += texture2DCompare( shadowMap, cubeToUV( bd3D + offset, texelSize.y ), compare );

            }
            return shadow * (1.0 / 16.0);
        #else // no percentage-closer filtering

            return texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), compare );

        #endif

    }

#endif
`,fht=ir.lights_fragment_begin,pht=ir.shadowmask_pars_fragment,Yte=null,mht=t=>{switch(t){case"low":return 8;case"medium":return 16;case"high":return 32;default:return 16}},ght=(t="medium")=>{if(Yte===t)return!1;Yte=t;let e=mht(t);ir.shadowmap_pars_fragment=dht(e);let i=fht.slice();i=i.replace("getShadow( spotShadowMap[ i ]","getShadow( UNROLLED_LOOP_INDEX + 3, spotShadowMap[ i ]"),i=i.replace("getShadow( directionalShadowMap[ i ]","getShadow( UNROLLED_LOOP_INDEX, directionalShadowMap[ i ]"),ir.lights_fragment_begin=i;let r=pht.slice();return r=r.replaceAll("getShadow(","getShadow( UNROLLED_LOOP_INDEX, "),ir.shadowmask_pars_fragment=r,!0},vht=`
attribute vec3 randomColor;
varying vec3 vNormal;
flat out vec3 vColor;
#include <skinning_pars_vertex>
#include <morphtarget_pars_vertex>
	
void main()
{
#include <beginnormal_vertex>
#include <morphnormal_vertex>
#include <skinbase_vertex>
#include <skinnormal_vertex>
vec3 transformed = vec3(position);
#include <morphtarget_vertex>
#include <skinning_vertex>

vNormal = normal;
vColor = randomColor;
gl_Position = projectionMatrix * (modelViewMatrix * vec4(transformed, 1.0));
}
`,yht=`
uniform float depthContrast;
varying vec3 vNormal;
flat in vec3 vColor;
void main()
{
vec3 normal = (normalize(vNormal)).rgb;

float contrastDepth = (gl_FragCoord.z - 0.5) * depthContrast + 0.5;

vec3 resultColor = mix(mix(vColor, normal, 0.2), vec3(contrastDepth), 0.4);
gl_FragColor = vec4(resultColor, vColor.r);
gl_FragColor = vec4(resultColor, vColor.r);
}
`,s4=new Tr({vertexShader:vht,fragmentShader:yht,uniforms:{depthContrast:{value:1}}}),Kte=new Kn,Zte=new Ae,xht=class extends whe{constructor(t){super(t),this._pixelRatio=this.getPixelRatio(),this.viewportWidth=1,this.viewportHeight=1,this.resolution=new Ae,this.dummyCamera=new Gs,this.sceneTransitionDuration=0,this.sceneTransitionTimeRemaining=-1,this.isXRCopyPassSet=!1,this.clear=(n=!0,s=!0,a=!0)=>{let o=this.getContext(),l=0;n&&(l|=o.COLOR_BUFFER_BIT),s&&(l|=o.DEPTH_BUFFER_BIT),a&&(l|=o.STENCIL_BUFFER_BIT),o.clear(l),o.clearBufferfv(o.COLOR,1,[0,0,0,1])},this.pipeline=new hht(this,t?.needsDOFResize??!1),this.autoClear=!1;let e=this.setPixelRatio.bind(this),i=this.setSize.bind(this);this.shadowMap.enabled=!0,this.shadowMap.type=zH,this.dummyCamera.matrixAutoUpdate=!1,this.domElement.removeAttribute("data-engine");let r=this.getContext();if(r&&"drawingBufferColorSpace"in r)try{r.drawingBufferColorSpace="display-p3"}catch(n){console.warn(n)}this.setPixelRatio=n=>{this._pixelRatio!==n&&(this._pixelRatio=n,e(n))},this.setSize=(n,s,a=!0)=>{(this.viewportWidth!==n||this.viewportHeight!==s)&&(this.viewportWidth=n,this.viewportHeight=s,i(n,s,a),this.normalRenderTarget?.setSize(n*this._pixelRatio,s*this._pixelRatio),this._resizeTransmission(n,s),this.transmissionDepthTarget?.setSize(n*this._pixelRatio/2,s*this._pixelRatio/2),this.pipeline.resize(n,s,a))},this._superDispose=this.dispose,this.dispose=this._currentDispose}createAORenderTarget(){this.aoRenderTarget===void 0&&(this.aoRenderTarget=new Mr(this.viewportWidth*this._pixelRatio,this.viewportHeight*this._pixelRatio,{generateMipmaps:!1,minFilter:nr,magFilter:nr,wrapS:kn,wrapT:kn,depthBuffer:!1}))}_resizeTransmission(t,e){this.transmissionRenderTarget?.setSize(t*this._pixelRatio/(this.hdTransmission?1:2),e*this._pixelRatio/(this.hdTransmission?1:2)),this.aoRenderTarget?.setSize(t*this._pixelRatio/1,e*this._pixelRatio/1)}get hdTransmission(){return Ri.transmissionLod.value===1}set hdTransmission(t){Ri.transmissionLod.value=t===!0?1:2,this._resizeTransmission(this.viewportWidth,this.viewportHeight)}createTransmissionRenderTarget(){this.transmissionRenderTarget===void 0&&(this.transmissionRenderTarget=new Mr(this.viewportWidth*this._pixelRatio/(this.hdTransmission?1:2),this.viewportHeight*this._pixelRatio/(this.hdTransmission?1:2),{generateMipmaps:!0,minFilter:j1,magFilter:nr,wrapS:kn,wrapT:kn,depthBuffer:!1}),this.transmissionDepthTarget=new Mr(this.viewportWidth*this._pixelRatio/2,this.viewportHeight*this._pixelRatio/2,{minFilter:mr,magFilter:mr,depthBuffer:!1}))}createNormalRenderTarget(){this.normalRenderTarget===void 0&&(this.normalRenderTarget=new Mr(this.viewportWidth*this._pixelRatio,this.viewportHeight*this._pixelRatio,{generateMipmaps:!1,minFilter:mr,magFilter:mr,type:cn,depthTexture:new H1(this.viewportWidth*this._pixelRatio,this.viewportHeight*this._pixelRatio)}))}renderNormal(t,e,i){this.normalRenderTarget&&(this.setClearColor(0),i.layers.enable(8),i.layers.disable(0),i.layers.disable(3),e.traverseEntity(r=>{r.layers.isEnabled(8)&&(r.copyPreviousMatrix=!1)}),this.setRenderTarget(this.normalRenderTarget),this.clear(),i instanceof Gs?s4.uniforms.depthContrast.value=(i.far-i.near)/1e4:s4.uniforms.depthContrast.value=1,e.overrideMaterial=s4,this.render(e,i),this.setClearColor(e.bgColor,e.bgColor.a),this.setRenderTarget(null),e.overrideMaterial=t.wireframeState?dV:null,i.layers.enable(0),i.layers.enable(3),e.traverseEntity(r=>{r.layers.isEnabled(8)&&(r.copyPreviousMatrix=!0)}))}renderSplineSceneWithDummyCamera(t,e,i=1){this.dummyCamera.updateCameraState(e.dataPatched),this.dummyCamera.matrix.copy(e.matrixWorld);let r=e.height,n=e.width,s=this.viewportWidth/this.viewportHeight;n<r?n=r*s:r=n/s,this.dummyCamera.setViewplaneSize(n,r);for(let a=0;a<i;a++)this.renderSplineScene(t,this.dummyCamera)}renderSplineScene(t,e,{sceneHelpers:i=this.sceneHelpers,sceneHelpersOnTop:r=this.sceneHelpersOnTop,overrideTransmission:n=void 0,overrideNormal:s=void 0}={}){let a=t instanceof A8?t.activePage:t,o=a.visible;a.visible=!0;let l=a.scene;this.xr.enabled&&(this.isXRCopyPassSet===!1&&this.getRenderTarget()!==null&&(this.pipeline.setCopyPass(this.getRenderTarget()),this.isXRCopyPassSet=!0),this.xr.updateCamera(e)),this.setClearColor(a.bgColor,a.bgColor.a),a.penumbraSizeArray.forEach((d,f)=>{Ri.penumbraSize.value[f]=d}),Ri.pixelRatioNode.value=this.getPixelRatio(),this.resolution.x!==0&&this.resolution.y!==0?Ri.resolution.value.set(this.resolution.x,this.resolution.y):Ri.resolution.value.set(this.viewportWidth*this._pixelRatio,this.viewportHeight*this._pixelRatio),s!==void 0?(Ri.normalRenderTarget.value=s,Ri.normalRenderTargetDepth.value=Kte):l.needsNormal()&&(this.createNormalRenderTarget(),Ri.normalRenderTarget.value=this.normalRenderTarget.texture,Ri.normalRenderTargetDepth.value=this.normalRenderTarget.depthTexture,this.renderNormal(l,a,e));let c=a.data.ao,u=c.occlusion;if(u&&(this.createAORenderTarget(),Ri.aoRenderTarget.value=this.aoRenderTarget.texture),Ri.aoEnabled.value=u,this.pipeline.setAmbientOcclusionParams(c.occlusion,c.radius,c.bias,a.aoColor,a.fog!==null,a.backupFog.near,a.backupFog.far,c.aoFullRes&&!L_),this.pipeline.aoPass.setBlueNoiseTexture(this.pipeline.blueNoiseTexture),this.pipeline.isUIOverlayEnabled&&a.uiCanvas?.enabled&&a.uiCanvas.texture&&a.uiCanvas.texture.image.width>0){let d=this.getSize(Zte),f=this.getPixelRatio();(a.uiCanvas.width!==this.viewportWidth||a.uiCanvas.height!==this.viewportHeight||a.uiCanvas.dpr!==f)&&a.uiCanvas.applySize({width:this.viewportWidth,height:this.viewportHeight},f),a.uiCanvas.render(this),this.pipeline.uiOverlayPass.uiCanvas=a.uiCanvas,this.pipeline.uiOverlayPass.enabled=!0,this.pipeline.uiOverlayPass.setResolution(d.x,d.y,f),this.pipeline.updateRenderToScreen()}else this.pipeline.uiOverlayPass.enabled=!1,this.pipeline.updateRenderToScreen();if(this.pipeline.logoOverlayPass.enabled){let d=this.getSize(Zte),f=this.getPixelRatio();this.pipeline.logoOverlayPass.uniforms.uResolution.value.set(d.x,d.y),this.pipeline.logoOverlayPass.uniforms.uDPR.value=f}let h=!1;if(n!==void 0)Ri.transmissionRenderTarget.value=n,Ri.transmissionRenderTargetDepth.value=Kte,this.pipeline.setTransmissionPassEnabled(!1);else{let d=l.needsTransmission();d&&(this.transmissionRenderTarget===void 0&&(h=!0),this.createTransmissionRenderTarget(),Ri.transmissionRenderTarget.value=this.transmissionRenderTarget.texture,Ri.aspectRatio.value=uot(this.viewportWidth,this.viewportHeight),Ri.transmissionRenderTargetDepth.value=this.transmissionDepthTarget.texture),this.pipeline.setTransmissionPassEnabled(d)}e.layers.enable(3),e.layers.enable(8),this.pipeline.sceneHelpers=i,this.pipeline.sceneHelpersOnTop=r,this.pipeline.scene=a,this.pipeline.camera=e,h&&this.pipeline.transmissionPass.updatePasses(this),this.pipeline.postprocessingState!==a.postprocessing&&(this.pipeline.updatePostprocessing(a.postprocessing),!i&&!r&&this.pipeline.disableHelpers()),this.clearAlphaOverride!==void 0&&this.setClearAlpha(this.clearAlphaOverride),l.shapeBlendIntances.forEach(d=>{d.onBeforeShadowPass(this)}),a.overrideMaterial=l.wireframeState?dV:null,this.pipeline.render(),Ri.frameIndex.value=(Ri.frameIndex.value+1)%16,e instanceof Gs&&e.copyHistory(),a.visible=o}renderFromSceneForSceneTransitionPass(t,e,i){this.pipeline.renderToScreen=!1,this.pipeline.renderTarget,this.renderSplineScene(t,e),this.pipeline.sceneTransitionFromTexture=this.pipeline.renderTarget.texture,this.sceneTransitionDuration=i,this.sceneTransitionTimeRemaining=i,this.pipeline.renderToScreen=!0;let r=this.pipeline.sceneTransitionPass.uniforms;r.uDPR.value=window.devicePixelRatio,r.uResolution.value.set(this.domElement.width,this.domElement.height).divideScalar(window.devicePixelRatio)}_currentDispose(){this._superDispose(),this.pipeline.dispose(),this.aoRenderTarget?.dispose(),this.transmissionRenderTarget?.dispose(),this.transmissionDepthTarget?.dispose(),this.normalRenderTarget?.dispose(),this.normalRenderTarget?.depthTexture?.dispose()}},sme=class extends VT(uqe){constructor(t,e=15,i=10066329){super(t,e,i),this.object=t,this.added=!1,this.name=`DirectionalLightHelper: ${t.uuid}`}raycast(t,e){HT(this.object,sme.geometryHelper,t,e)}},ame=class extends VT(cqe){constructor(t,e=15,i=6710886){super(t,e,i),this.object=t,this.name=`PointLightHelper: ${t.uuid}`}raycast(t,e){HT(this.object,ame.geometryHelper,t,e)}},aV=class extends VT(lqe){constructor(t,e=6710886){super(t,e),this.object=t,this.name=`SpotLightHelper: ${t.uuid}`}raycast(t,e){HT(this.object,aV.geometryHelper,t,e)}update(){if(this.object!==void 0){let t=aV._vector,e=this.object.distance?this.object.distance:1e3,i=e*Math.tan(this.object.angle);this.cone.scale.set(i,i,e),t.setFromMatrixPosition(this.object.target.matrixWorld),this.cone.lookAt(t);let r=this.color!==void 0?this.color:this.light.color;if(this.cone.material instanceof Array)for(let n=0,s=this.cone.material.length;n<s;n++)this.cone.material[n].color.set(r);else this.cone.material.color.set(r)}}},ome=aV;ome._vector=new W;var lme=class extends Tp{constructor(){super(),this.caretIndex=0,this._caretVisibleAlpha=1,this._selectionVisibleAlpha=.3,this.current={start:0,end:void 0},this.matrixAutoUpdate=!1,this.caretMesh=new En(new ef(1,1),new Xp({transparent:!0,opacity:0,side:jo})),this.add(this.caretMesh),this.selectionMesh=new En(new ef(1,1),new Xp({color:2857471,transparent:!0,depthTest:!1,depthWrite:!1,opacity:0,side:jo})),this.add(this.selectionMesh),this.hide()}get caretHeight(){return this.object?.AD??0}show(t){this.visible=!0,this.object=t,this.caretMesh.scale.set(1,this.caretHeight,1),this.caretMesh.position.y=-this.caretHeight*.5,this.setCaretPosition(this.caretIndex),this.update()}hide(){this.visible=!1}update(){if(this.object===void 0)return;this.updateHelperMatrix();let{depth:t}=this.object.geometry.userData.parameters;this.caretMesh.position.z=t,this.selectionMesh.position.z=t}updateHelperMatrix(){if(this.object===void 0)return;let t=this.object,e=t.parent;e!==null&&e.updateWorldMatrix(!0,!1),t.matrixAutoUpdate&&t.updateMatrix(),e!==null?(this.matrixWorld.multiplyMatrices(e.matrixWorld,t.hiddenMatrix),this.matrixWorld.multiplyMatrices(this.matrixWorld,t.matrix)):this.matrixWorld.multiplyMatrices(t.hiddenMatrix,t.matrix),this.matrix.copy(this.matrixWorld);for(let i of this.children)i.matrixWorld.copy(this.matrixWorld);t.updateWorldMatrix(!0,!0)}setCaretColor(t){let e=this.caretMesh.material;e.color.setRGB(t.r,t.g,t.b);let i=this._caretVisibleAlpha===e.opacity;this._caretVisibleAlpha=t.a,i&&(e.opacity=this._caretVisibleAlpha)}setSelectionColor(t){this.selectionMesh.material.color.setRGB(t.r,t.g,t.b)}setCaretPosition(t,e={}){if(this.object===void 0)return;this.caretIndex=t;let i=this.object.wrappedText,[r,n]=j3(i,t),[s,a]=t>0?j3(i,t-1):[null,null];(t>0&&i.length?i[s].charAt(a):null)===`
`&&(r++,n=0),this.current.start=t,this.current.end=void 0;let[o,l]=a4(this.object,r,n),{AD:c,descender:u}=this.object,h=u+c*.5,{width:d,height:f,depth:p}=this.object.geometry.userData.parameters,g=typeof d=="string"?0:d,m=typeof f=="string"?0:f;this.caretMesh.scale.set(1,this.caretHeight,1),this.caretMesh.position.set(o-g*.5,l+h+m*.5,p),this.hideSelectionMesh(),this.showCaretMesh()}setSelection(t,e){if(this.object===void 0)return;let i=this.object.wrappedText;this.current.start=t,this.current.end=e;let r=[],n=[],s=bht(i,t,e),{lineHeight:a,AD:o,descender:l}=this.object,c=l+o*.5-a*.5;for(let[m,y,b]of s)if(y!==b){let[w,E]=a4(this.object,m,y),[M,A]=a4(this.object,m,b);E+=c,A+=c,A+=a;let P=r.length/3;r.push(w,E,0),r.push(M,E,0),r.push(M,A,0),r.push(w,A,0),n.push(P+0,P+1,P+2),n.push(P+2,P+3,P+0)}let u=new oi;u.setIndex(n),u.setAttribute("position",new Gt(r,3));let{width:h,height:d,depth:f}=this.object.geometry.userData.parameters,p=typeof h=="string"?0:h,g=typeof d=="string"?0:d;this.selectionMesh.geometry.dispose(),this.selectionMesh.geometry=u,this.selectionMesh.position.x=-p*.5,this.selectionMesh.position.y=g*.5,this.selectionMesh.position.z=f,this.showSelectionMesh(),this.hideCaretMesh()}getSelectionFromPosition(t,e,i="previous"){if(this.object===void 0||this.object.font===void 0)return;let r=this.object.wrappedText,n=r.length,s=this.object.lineHeight,a=n*s,{height:o,verticalAlign:l}=this.object.geometry.userData.parameters,c=typeof o=="string"?0:o,u=0;l===3?u=c-a:l===2&&(u=c*.5-a*.5);let h=Math.min(Math.floor(Math.max(Math.min(-e-u,a),0)/s),n-1),d=this.object.charCoords[h],f=this.object.charWidths[h],p=0,g=!1;if(i==="previous"){for(let m=0;m<d.length;m++)if(d[m][0]+f[m]*.5-t>0){p=m,g=!0;break}}else if(i==="closest"){let m=1/0;for(let y=0;y<d.length;y++){let b=d[y][0]+f[y]*.5,w=Math.abs(b-t);w<m&&(m=w,p=y,g=!0)}}else for(let m=0;m<d.length;m++){let y=d[m][0],b=d[m][0]+f[m];if(t>=y&&t<b){p=m,g=!0;break}}return g||(p=d.length),{index:this.getGlobalIndexFromLineAndCharIndexes(r,h,p),lineIndex:h,characterIndex:p}}getGlobalIndexFromLineAndCharIndexes(t,e,i){return t.slice(0,e).reduce((r,n)=>r+=n.length,0)+i}showSelectionMesh(){this.selectionMesh.material.opacity=this._selectionVisibleAlpha}hideSelectionMesh(){this.selectionMesh.material.opacity=0}showCaretMesh(){this.caretMesh.material.opacity=this._caretVisibleAlpha}hideCaretMesh(){this.caretMesh.material.opacity=0}};function a4(t,e,i){let{charCoords:r,charWidths:n,initialOffsetY:s,lineHeight:a}=t;if(r[e]&&r[e].length===0||r.length===0){let u=0,{horizontalAlign:h}=t.data.geometry,d=t.wrappedText,{width:f}=t.geometry.userData.parameters;return d.length===1&&d[0].length===0&&(h===3?u=f*.5:h===2&&(u=f)),[u,s-a*e]}let o=r[e];if(o===void 0||o.length===0)return[0,0];let[l,c]=o[Math.min(i,o.length-1)];return i>=o.length&&(l+=n[e][i-1]),[l,c]}function j3(t,e){let i=0;for(let r=0;r<t.length;r++){let n=t[r],s=e-i;if(s<=n.length)return[r,s];i+=n.length}return[Math.max(0,t.length-1),t[t.length-1]?.length??0]}function bht(t,e,i){let[r,n]=j3(t,e),[s,a]=j3(t,i),o=[];n>=t[r].length&&(r++,n=0);for(let l=r;l<=s;l++){let c=t[l],u=l===r?n:0,h=l===s?a:c.length;o.push([l,u,h])}return o}function wht(t,e){let i=ca.fromHex(3223857),r=.8;for(let n of t.layers){if(n.data.type==="light"||n.data.type==="displace"||n.data.type==="fresnel"||n.data.type==="matcap"||n.data.type==="texture"||n.data.type==="toon"||n.data.type==="outline"||n.data.type==="transmission"||n.data.type==="noise")continue;let s=typeof n.data.alpha=="string"?Number(e.getVariable(n.data.alpha)):n.data.alpha;if(n.data.type==="color"&&s>.3){i=_ht(n.data.color,e),r=s;break}else if((n.data.type==="depth"||n.data.type==="gradient")&&s>.3){let a=Sht(n.data);i={r:a[0],g:a[1],b:a[2]},r=typeof n.data.alpha=="string"?1:n.data.alpha;break}}return{...i,a:r}}function _ht(t,e){return typeof t=="string"?e.data.colors[t]:t}function Sht(t){return t.colors[0]}function Eht(t,e){t.shadow.camera.right=e/2,t.shadow.camera.left=-e/2,t.shadow.camera.top=e/2,t.shadow.camera.bottom=-e/2,t.shadow.needsUpdate=!0}var IL=class extends m8(X7e,sme){constructor(t,e,i){super(),this.super_Entity(t,e),this.castShadow=!0,this.shadow.mapSize.width=2048,this.shadow.mapSize.height=2048,this.shadow.normalBias=1,this.layers.enable(3);let r=this.shadow.camera;r.top=1250,r.bottom=-1250,r.right=1250,r.left=-1250,r.near=-1e4,r.far=2500;let n=new KD(this.shadow.camera);n.visible=!1,this.gizmos.shadowmap=n}update(){this.shadow.camera.updateProjectionMatrix();for(let t in this.gizmos){let e=this.gizmos[t];e instanceof KD&&e.update()}}updateMatrixWorld(t){super.updateMatrixWorld(t),this.objectHelper&&this.objectHelper.update()}updateState(t,e){this.updateState_Light(t,e);let i=t.depth!==void 0&&t.depth!==this.shadow.camera.far||t.size!==void 0&&t.size/2!==this.shadow.camera.right;t.size!==void 0&&Eht(this,t.size),t.shadowRadius!==void 0&&(this.shadow.radius=t.shadowRadius),t.shadowResolution!==void 0&&(this.shadow.mapSize.set(t.shadowResolution,t.shadowResolution),this.shadow.map&&(this.shadow.map.dispose(),this.shadow.map=null)),t.penumbraSize!==void 0&&e.scene.markPenumbraSizeDirty(),i&&this.update()}},Qte=new W,Jte=new W,eie=new Ii,DL=class extends m8(H7e,ome){constructor(t,e,i){super(),this.super_Entity(t,e),this.castShadow=!0,this.shadow.mapSize.width=1024,this.shadow.mapSize.height=1024,this.shadow.normalBias=1,this.layers.enable(3);let r=this.shadow.camera;r.fov=Ht.RAD2DEG*2*this.angle,r.aspect=1,r.near=100,r.far=2500;let n=new KD(this.shadow.camera);n.visible=!1,this.gizmos.shadowmap=n,this.update()}update(){this.shadow.camera.updateProjectionMatrix();for(let t in this.gizmos){let e=this.gizmos[t];e instanceof KD&&e.update()}}updateMatrixWorld(t){super.updateMatrixWorld(t),Jte.setFromMatrixPosition(this.matrixWorld),eie.setFromRotationMatrix(this.matrixWorld),Qte.copy(this.up).applyQuaternion(eie).negate().multiplyScalar(this.distance),this.target.position.copy(Jte).add(Qte),this.target.updateMatrixWorld(),this.objectHelper&&this.objectHelper.update()}updateState(t,e){this.updateState_Light(t,e),t.distance!==void 0&&(this.distance=t.distance),t.decay!==void 0&&(this.decay=t.decay),t.angle!==void 0&&(this.angle=t.angle),t.penumbra!==void 0&&(this.penumbra=t.penumbra),t.shadowRadius!==void 0&&(this.shadow.radius=t.shadowRadius),t.penumbraSize!==void 0&&e.scene.markPenumbraSizeDirty(),t.shadowResolution!==void 0&&(this.shadow.mapSize.set(t.shadowResolution,t.shadowResolution),this.shadow.map&&(this.shadow.map.dispose(),this.shadow.map=null))}};function Aht(t){let e=(t[0][0]+t[1][1])/2,i=(t[0][0]-t[1][1])/2,r=(t[1][0]+t[0][1])/2,n=(t[1][0]-t[0][1])/2,s=Math.sqrt(e*e+n*n),a=Math.sqrt(i*i+r*r),o=s+a,l=s-a,c=Math.atan2(r,i),u=Math.atan2(n,e),h=(u-c)/2,d=(u+c)/2,f=[[Math.cos(d),Math.sin(d)],[-Math.sin(d),Math.cos(d)]],p=[[o,0],[0,l]],g=[[Math.cos(h),Math.sin(h)],[-Math.sin(h),Math.cos(h)]];return f[0][0]*=-1,f[0][1]*=-1,g[0][0]*=-1,g[1][0]*=-1,[f,p,g]}function hI(t,e){return[[t[0][0]*e[0][0]+t[0][1]*e[1][0],t[0][0]*e[0][1]+t[0][1]*e[1][1]],[t[1][0]*e[0][0]+t[1][1]*e[1][0],t[1][0]*e[0][1]+t[1][1]*e[1][1]]]}function tie(t){return[[t[0][0],t[1][0]],[t[0][1],t[1][1]]]}function Mht(t){let[e,i,r]=Aht(t),n=hI(e,tie(r)),s=hI(hI(r,i),tie(r)),a=Math.atan2(n[1][0],n[0][0]),o=[s[0][0],s[1][1]],l=[s[0][1]/s[1][1],s[1][0]/s[0][0]];return{rotation:a,scale:o,shear:l}}function Tht({rotation:t,scale:e,shear:i}){let r=Math.cos(t),n=Math.sin(t),s=[[r,-n],[n,r]],a=[[e[0],i[0]*e[1]],[i[1]*e[0],e[1]]],o=hI(s,a);return[o[0][0],o[1][0],o[0][1],o[1][1]]}var Or;(t=>{function e(){return[1,0,0,0,1,0,0,0,1]}t.identity=e;function i(A,P=t.identity()){for(let C=0,R=A.length;C<R;C++)P[C]=A[C];return P}t.copy=i;function r(A,P,C,R,I,k){return t.setAbcdef(t.identity(),A,P,C,R,I,k)}t.create=r;function n(A,P,C,R,I,k,z){return A[0]=P,A[1]=R,A[2]=k,A[3]=C,A[4]=I,A[5]=z,A}t.setAbcdef=n;function s(A,P){let[C,R,I,k,z,V]=o(A),[F,$,K,X,U,Y]=o(P),Z=F*C+$*I,j=F*R+$*k,ee=K*C+X*I,pe=K*R+X*k,fe=U*C+Y*I+z,se=U*R+Y*k+V;return t.create(Z,j,ee,pe,fe,se)}t.append=s;function a(A,P){let[C,R,I,k,z,V]=o(A),[F,$,K,X,U,Y]=o(P),Z=C,j=R,ee=I,pe=k;(F!==1||$!==0||K!==0||X!==1)&&(Z=C*F+R*K,j=C*$+R*X,ee=I*F+k*K,pe=I*$+k*X);let fe=z*F+V*K+U,se=z*$+V*X+Y;return t.create(Z,j,ee,pe,fe,se)}t.prepend=a;function o(A){return[A[0],A[3],A[1],A[4],A[2],A[5]]}t.getAbcdef=o;function l(A){let[P,C,R,I,k,z]=t.getAbcdef(A),V=P*I-C*R,F=I/V,$=-C/V,K=-R/V,X=P/V,U=(R*z-I*k)/V,Y=-(P*z-C*k)/V;return t.create(F,$,K,X,U,Y)}t.invert=l;function c([A,P],C){let[R,I,k,z,V,F]=t.getAbcdef(C);return[R*A+k*P+V,I*A+z*P+F]}t.apply=c;function u(A,P){let[C,R,I,k,z,V]=t.getAbcdef(P),F=1/(C*k+I*-R),[$,K]=A;return[k*F*$+-I*F*K+(V*I-z*k)*F,C*F*K+-R*F*$+(-V*C+z*R)*F]}t.applyInverse=u;function h(A,P,C=P){let[R,I,k,z,V,F]=t.getAbcdef(A);return t.setAbcdef(A,R*P,I*C,k*P,z*C,V*P,F*C),A}t.scale=h;function d(A,P){let C=Math.cos(P),R=Math.sin(P),[I,k,z,V,F,$]=t.getAbcdef(A);return t.setAbcdef(A,I*C-k*R,I*R+k*C,z*C-V*R,z*R+V*C,F*C-$*R,F*R+$*C),A}t.rotate=d;function f(A,P,C){let[R,I]=C,k=t.translate(A,-R,-I);return k=t.rotate(k,P),k=t.translate(k,R,I),k}t.rotateAround=f;function p(A,P,C){let[R,I,k,z,V,F]=t.getAbcdef(A);return t.setAbcdef(A,R,I,k,z,V+P,F+C),A}t.translate=p;function g(A,P,C){let[R,I,k,z]=t.getAbcdef(A);return t.setAbcdef(A,R,I,k,z,P,C),A}t.setTranslate=g;function m(A,P,C){let[R,I,k,z]=t.getAbcdef(A);return t.setAbcdef(A,R,I,k,z,P,C),A}t.setPosition=m;function y(A){let[P,C,R,I]=t.getAbcdef(A),k=Math.sqrt(P*P+C*C),z=Math.sqrt(R*R+I*I);return[k,z]}t.getScale=y;function b(A){let[,,,,P,C]=t.getAbcdef(A);return[P,C]}t.getPosition=b;function w(A,P){return t.decompose(A,P).rotation}t.getRotation=w;function E(A,P){let[C,R,I,k,z,V]=t.getAbcdef(A),{rotation:F,scale:$,shear:K}=Mht([[C,I],[R,k]]);return{position:[z+(P[0]*C+P[1]*I)-P[0],V+(P[0]*R+P[1]*k)-P[1]],scale:$,rotation:F,shear:K,pivot:P}}t.decompose=E;function M(A,P,C,R,I=[0,0]){let[k,z]=A,[V,F]=R,[$,K,X,U]=Tht({rotation:C,scale:P,shear:I}),Y=k-(V*$+F*X)+V,Z=z-(V*K+F*U)+F;return t.create($,K,X,U,Y,Z)}t.compose=M})(Or||(Or={}));var Cht=Math.PI/180;function Pht(t,e,i,r,n,s){let a=t-i,o=e-r;return a*a/(n*n)+o*o/(s*s)<=1}function Rht(t){return t*Cht}var Ka=class{constructor(t,e,i){this.uuid=t,this.data=e,this.localMatrix=Or.identity(),this.worldMatrix=Or.identity(),this.ignoreCameraZoom=!1,this.visible=!0,this._singleBBox=new oV,this._recursiveBBox=new oV,this.singleBBoxNeedsUpdate=!0,this.recursiveBBoxNeedsUpdate=!0,this.stateSelection=null,this.prevState=null,this.currentState=null,this.reversibleToState=null,this.currentTransitionEvent=null,this.previousAction=null,this.name="",this.position=[0,0],this.scale=[1,1],this.rotation=0,this.shear=[0,0],this.emitter=TL(),this.dpr=i.dpr??1,this.dataPatched=e}project(t,e){let i=this.worldMatrix;return e&&(i=Or.append(e.worldMatrix,i)),Or.applyInverse(t,i)}intersects(t,e,i,r=!1){return this.visible&&!this.data.raycastLock&&this.intersectsInLocalSpace(...this.project([t,e],i),r)}intersectsInLocalSpace(t,e,i=!1){let{min:r,max:n}=i?this.recursiveBBox:this.singleBBox;return t>=r[0]&&t<=n[0]&&e>=r[1]&&e<=n[1]}applyTransforms(t){t.setTransform(this.worldMatrix,this.ignoreCameraZoom)}get singleBBox(){return this.singleBBoxNeedsUpdate&&(this.singleBBoxNeedsUpdate=!1,this._singleBBox.setFromObjectSize(this,!1),this._singleBBox.computeVertices(),this._singleBBox.computeEdges()),this._singleBBox}get recursiveBBox(){return this.recursiveBBoxNeedsUpdate&&(this.recursiveBBoxNeedsUpdate=!1,this._recursiveBBox.setFromObjectSize(this,!0),this._recursiveBBox.computeVertices(),this._recursiveBBox.computeEdges()),this._recursiveBBox}updateLocalMatrix(){this.localMatrix=Or.compose(this.position,this.scale,Rht(this.rotation),b0.getPivot(this.dataPatched),this.shear)}updateWorldMatrix(t,e,i){let r=this.parent;e&&r!==null&&r!==void 0&&r.updateWorldMatrix(t,!0,!1),t&&this.updateLocalMatrix(),this.parent?this.worldMatrix=Or.append(this.parent.worldMatrix,this.localMatrix):this.worldMatrix=Or.copy(this.localMatrix),this.singleBBoxNeedsUpdate=!0,this.recursiveBBoxNeedsUpdate=!0}get pivot(){return b0.getPivot(this.data)}getCenter(){return[0,0]}getHalfSize(){return[0,0]}get id(){return this.uuid}resetBBoxNeedsUpdateSelf(){this.singleBBoxNeedsUpdate=!0,this.recursiveBBoxNeedsUpdate=!0}resetBBoxNeedsUpdate(){this.resetBBoxNeedsUpdateSelf(),this.traverseAncestors(t=>{t.resetBBoxNeedsUpdateSelf()})}updateTransformState(t){let e=!1;t.position!==void 0&&(e=!0,this.position=t.position),t.rotation!==void 0&&(e=!0,this.rotation=t.rotation),t.scale!==void 0&&(e=!0,this.scale=t.scale),t.shear!==void 0&&(e=!0,this.shear=t.shear),e&&(this.updateWorldMatrix(!0,!1,!0),this.resetBBoxNeedsUpdate())}updateByOp(t,e,i){t.type===0&&t.props.visible!==void 0&&(this.visible=t.props.visible),this.data=e,this.data=e;let r=t,n=yn(t.path,["states","*"]);if(n!==null){if(t.type===0){let[s]=n;if(this?.stateSelection===s){let a={...t.props};if(delete a.name,Object.values(t.props).some(o=>o===void 0)){let o=this.data;if(o!==void 0){let l=fa.zoom(o,t.path.slice(2));if(l)for(let c in t.props)t.props[c]===void 0&&c in l&&(a[c]=l[c])}}r={...t,props:a,path:t.path.slice(2)}}}}else if(t.type===0){let s=this.stateSelection?this.data.states.data(this.stateSelection):void 0;if(s!==void 0){if(t.props.name!==void 0&&s.name){let{name:o,...l}=s;s=l}let a=fa.removeOverridden(t.path,t.props,s);r={...t,props:a}}}this.updateByPatchedOpBase(r,r0.patch(this.data,this.stateSelection?this.data.states.data(this.stateSelection):void 0),i)}changeSelectedState(t,e,i=!1){if(!(this.data.states.length===0&&!i)){for(let r of this.data.states)r0.toOps(this.data,r.data).forEach(n=>{let s=o3.replaceProps(n,this.data);this.dataPatched=this.data,this.updateByPatchedOp(s,this.data,e)});if(t!==null){let r=this.data.states.data(t);r&&(this.dataPatched=r0.patch(this.data,r),r0.toOps(this.data,r).forEach(n=>{this.updateByPatchedOp(n,this.dataPatched,e)}))}i&&this.updateTransformState(this.dataPatched),this.stateSelection=t}}updateState(t,e){t.name!==void 0&&(this.name=t.name),t.visible!==void 0&&(this.visible=t.visible),this.updateTransformState(t)}updateByPatchedOpBase(t,e,i){this.dataPatched=e,this.updateByPatchedOp(t,e,i)}updateByPatchedOp(t,e,i){t.path.length===0&&t.type===0&&this.updateState(t.props,i),this.requestRender()}traverseFrameAncestors(t){this.traverseAncestors(e=>{e.data.type==="frame2d"&&t(e)})}traverseAncestors(t){let e=this.parent;for(;e;)t(e),e=e.parent}requestRender(){this.traverseFrameAncestors(t=>{t.requestRender()})}clone(t){let e=new Ka(this.uuid,this.data,t);return e.parent=void 0,e}addEventListener(t,e){this.emitter.on(t,e)}removeEventListener(t,e){this.emitter.off(t,e)}dispatchEvent(t){this.emitter.emit(t.type,{...t,target:t.target??this})}traverseSortNextHelper(){let t=this.parent;if(t){let e=t.children;if(e){let i=e.indexOf(this)+1;return e[i]?e[i]:t.traverseSortNextHelper()}}}sortNext(){let t=this.children;return t&&t.length>0&&t[0]?t[0]:this.traverseSortNextHelper()}isDescendantOf(t){t instanceof Ka&&(t=t.uuid);let e=this;for(;e.parent;){if(e.parent.uuid===t)return!0;e=e.parent}return!1}},vh=class extends Ka{constructor(t,e,i){super(t,e,i),this.uuid=t,this.data=e,this.context=i,this.children=[]}add(t){t.parent&&t.parent instanceof vh&&t.parent.remove(t),this.children.push(t),t.parent=this}remove(t){let e=this.children.indexOf(t);e>=0&&(this.children.splice(e,1),t.parent=void 0)}traverse(t){let e=t(this);if(e!==!0)for(let i of this.children)i instanceof vh?i.traverse(t):e=t(i)}intersectsChildrenHelper(t,e,i,r,n){for(let s of this.children)if(s.intersects(t,e,i,!1)&&(n.push(s),r)||s instanceof vh&&s.intersectsChildrenHelper(t,e,i,r,n))return!0;return!1}intersectsChildren(t,e,i,r=!1,n=[],s=!1){return this.intersectsChildrenHelper(t,e,i,r,n),n}intersectsChildrenHelperReverse(t,e,i,r,n){for(let s of this.children)if(s instanceof vh&&s.intersectsChildrenHelperReverse(t,e,i,r,n)||s.intersects(t,e,i,!1)&&(n.push(s),r))return!0;return!1}intersectsChildrenReverse(t,e,i,r=!1,n=[],s=!1){return this.intersectsChildrenHelperReverse(t,e,i,r,n),n}updateWorldMatrix(t,e,i){if(super.updateWorldMatrix(t,e,i),i&&this.children)for(let r of this.children)r.updateWorldMatrix(t,!1,!0)}find(t){let e;return this.traverse(i=>{i.uuid===t&&(e=i)}),e}innerDrawChildren(t){for(let e=this.children.length-1;e>=0;e--)this.children[e].draw(t)}resetBBoxNeedsUpdate(){super.resetBBoxNeedsUpdate(),this.traverse(t=>{t.resetBBoxNeedsUpdateSelf()})}clone(t){let e=new vh(this.uuid,this.data,t);e.parent=void 0;for(let i of this.children)e.add(i.clone(t));return e}},av=class extends vh{constructor(t,e,i){super(t,e,i),this.uuid=t,this.data=e,this.updateState(e,i)}draw(t){!this.visible||(t.save(),this.applyTransforms(t),this.innerDrawChildren(t),t.restore())}clone(t){let e=new av(this.uuid,this.data,t);e.parent=void 0;for(let i of this.children)e.add(i.clone(t));return e}};function Iht(t,e){let[[i,r],[n,s]]=t,[[a,o],[l,c]]=e,u=(i-n)*(o-c)-(r-s)*(a-l);if(u===0)return!1;let h=((i-a)*(o-c)-(r-o)*(a-l))/u,d=-((i-n)*(r-o)-(r-s)*(i-a))/u;return h>=0&&h<=1&&d>=0&&d<=1}var cme=[[-1,1],[-1,-1],[1,-1],[1,1]],iie=(t,e,i)=>{let r=t.getCenter(),n=t.getHalfSize(),s=Or.append(e,t.worldMatrix);n[0]===0&&n[1]===0?i.push(Or.apply(r,s)):cme.forEach(a=>{let o=[a[0]*n[0]+r[0],a[1]*n[1]+r[1]];i.push(Or.apply(o,s))})},oV=class{constructor(){this.matrix=Or.identity(),this.min=[1/0,1/0],this.max=[-1/0,-1/0],this.vertices=[],this.edges=[]}setFromObjectSize(t,e=!1){t.updateWorldMatrix(),this.makeEmpty(),Or.copy(t.worldMatrix,this.matrix);let i=Or.invert(t.worldMatrix);this.expandByObjectSize(t,i,e)}expandByObjectSize(t,e,i=!1){let r=[];i===!0&&t instanceof vh?t.traverse(n=>{n.visible&&iie(n,e,r)}):iie(t,e,r),this.setFromPoints(r)}setFromSize(t,e,i){this.makeEmpty(),Or.copy(i,this.matrix),this.expandBySize(t,e,i)}expandBySize(t,e,i){[Or.apply([0,0],i),Or.apply([0,e],i),Or.apply([t,e],i),Or.apply([t,0],i)].forEach(r=>this.expandByPoint(r))}getCenter(){let[t,e]=this.min,[i,r]=this.getHalfSize();return Or.apply([t+i,e+r],this.matrix)}getSize(){return[this.max[0]-this.min[0],this.max[1]-this.min[1]]}getHalfSize(){return[(this.max[0]-this.min[0])*.5,(this.max[1]-this.min[1])*.5]}makeEmpty(){this.min=[1/0,1/0],this.max=[-1/0,-1/0]}setFromPoints(t){this.makeEmpty();for(let e of t)this.expandByPoint(e)}expandByPoint(t){this.min=[Math.min(this.min[0],t[0]),Math.min(this.min[1],t[1])],this.max=[Math.max(this.max[0],t[0]),Math.max(this.max[1],t[1])]}computeVertices(){let[t,e]=this.getHalfSize(),i=this.getCenter(),[r,n,s,a]=Or.getAbcdef(this.matrix),o=Or.create(r,n,s,a,i[0],i[1]);this.vertices=cme.map(([l,c])=>Or.apply([l*t,c*e],o))}computeEdges(){this.edges=[];for(let t=0,e=this.vertices.length;t<e;++t)this.edges.push([this.vertices[t],this.vertices[(t+1)%e]])}project(t,e){let i=this.matrix;return e&&(i=Or.append(e.worldMatrix,i)),Or.applyInverse(t,i)}intersects(t,e,i){return this.intersectsInLocalSpace(...this.project([t,e],i))}intersectsInLocalSpace(t,e){let{min:i,max:r}=this;return t>=i[0]&&t<=r[0]&&e>=i[1]&&e<=r[1]}containsPoint(t){let[e,i]=t,[r,n]=this.min,[s,a]=this.max;return e>=r&&e<=s&&i>=n&&i<=a}intersectsBBox2D(t){for(let e=0,i=this.edges.length;e<i;e++){let r=this.edges[e];for(let n=0,s=t.edges.length;n<s;n++){let a=t.edges[n];if(Iht(r,a))return!0}}for(let e=0,i=t.vertices.length;e<i;e++){let r=t.vertices[e];if(this.containsPoint(r))return!0}return!1}ensureMinMax(){let t=this.min,e=this.max;this.min=[Math.min(t[0],e[0]),Math.min(t[1],e[1])],this.max=[Math.max(t[0],e[0]),Math.max(t[1],e[1])]}copy(t){this.min=[...t.min],this.max=[...t.max],Or.copy(t.matrix,this.matrix),this.computeVertices(),this.computeEdges()}clone(){let t=new oV;return t.copy(this),t}},ume,Dht=new Promise(t=>{ume=t}),rie=!1,TR;function Oht(){if(rie)return;if(TR)return TR;async function t(){let e=await Bc(()=>import("./ui-TxDVmkgT.js"),[]);ume(e.default??e),rie=!0}return TR=t(),TR}function nie(t){let e=!1;return t.scene.objects.traverse((i,r)=>{(r.type==="Mesh"&&r.geometry.type==="UIGeometry"||r.type==="Page"&&r.uiFrame!==void 0)&&(e=!0)}),e}var Gi,o4;async function Lht(t){let e=await Dht;Gi||(o4||(o4=e({locateFile:()=>t})),Gi=await o4)}var sie=Or.identity(),hme=class{constructor(t,e=1){this.canvas=t,this._dpr=e,this._width=0,this._height=0,this._strokeMode="inside",this._layerBlur=0,this._backgroundBlur=0,this._dropShadowBlur=0,this._dropShadowOffsetX=0,this._dropShadowOffsetY=0,this._dropShadowColor=Xr.transparent,this._innerShadowBlur=0,this._innerShadowOffsetX=0,this._innerShadowOffsetY=0,this._innerShadowSpread=0,this._innerShadowColor=Xr.transparent,this._fonts=new Map,this._isSizeDirty=!1;try{let i=t.getBoundingClientRect();t.width=i.width*e,t.height=i.height*e}catch{console.log(t.width,e)}this._currentM3Transform=sie,this._currentTransform=new Float32Array(sie)}get dpr(){return this._dpr}set dpr(t){this._dpr=t,this._isSizeDirty=!0}async init(){if(!this.wasmURL)throw Error("Your must set the wasm binary url with renderer.wasmURL = ... before you can call renderer.init");await Lht(this.wasmURL),this._surface=Gi.MakeWebGLCanvasSurface(this.canvas),this.ctx=this._surface?.getCanvas(),this._paint=new Gi.Paint,this._paint.setAntiAlias(!0),this._paintFill=this._paint.copy(),this._paintFill.setStyle(Gi.PaintStyle.Fill),this._paintStroke=this._paint.copy(),this._paintStroke.setStyle(Gi.PaintStyle.Stroke),this.ctx?.scale(this.dpr,this.dpr)}get currentTransform(){return this._currentM3Transform}get currentTransformBuffer(){return this._currentTransform}set currentTransform(t){this._currentM3Transform=t,this._currentTransform.set(t)}async loadFont(t,e){let i=await(await fetch(t)).arrayBuffer();this.registerFont(i,e)}registerFont(t,e){if(this._fonts.has(e))return;let i=Gi.FontMgr.FromData(t);if(i)this._fonts.set(e,i);else throw new Error("Invalid font data for "+e)}get width(){return this._width}get height(){return this._height}set strokeColor(t){this._paintStroke&&this._paintStroke.setColor(CR(t),Gi.ColorSpace.DISPLAY_P3)}set fillColor(t){this._paintFill&&this._paintFill.setColor(CR(t),Gi.ColorSpace.DISPLAY_P3)}set lineWidth(t){this._paintStroke&&this._paintStroke.setStrokeWidth(this._strokeMode==="center"?t:t*2)}set strokeMode(t){this._strokeMode=t}set dropShadowBlur(t){this._dropShadowBlur=t}set dropShadowColor(t){this._dropShadowColor=t}set dropShadowOffsetX(t){this._dropShadowOffsetX=t}set dropShadowOffsetY(t){this._dropShadowOffsetY=t}set innerShadowBlur(t){this._innerShadowBlur=t}set innerShadowColor(t){this._innerShadowColor=t}set innerShadowOffsetX(t){this._innerShadowOffsetX=t}set innerShadowOffsetY(t){this._innerShadowOffsetY=t}set innerShadowSpread(t){this._innerShadowSpread=t}set layerBlur(t){this._layerBlur=t}set backgroundBlur(t){this._backgroundBlur=t}clear(){this.ctx?.clear(Gi.TRANSPARENT)}save(){this.ctx?.save()}restore(){this.ctx?.restore()}beginPath(){this._currentPath?.delete(),this._currentPath=new Gi.Path}closePath(){let t=this._currentPath;if(t){if(t.isEmpty())return;let e=t.getBounds();(e[3]-e[1]||e[2]-e[0])&&t.close()}}fill(){this._paintInner(this._paintFill,!0)}stroke(){this._paintInner(this._paintStroke,!1)}clipRect(t,e,i,r,n=0,s=0,a=0,o=0){let l=Gi.XYWHRect(t,e,i,r);if(n===0&&s===0&&o===0&&a===0)this.ctx?.clipRect(l,Gi.ClipOp.Intersect,!0);else{let c=Gi.RRectXY(l,n,n);c[4]=c[5]=n,c[6]=c[7]=s,c[8]=c[9]=a,c[10]=c[11]=o,this.ctx?.clipRRect(c,Gi.ClipOp.Intersect,!0)}}_applyShadowOffsetMatrix(){if(this.ctx){let t=Or.invert(this.currentTransform);this.ctx.concat(t);let e=Or.translate(Or.identity(),this._dropShadowOffsetX,this._dropShadowOffsetY);this.ctx.concat(e),this.ctx.concat(this._currentTransform)}}_applyEffectsToPaint(t,e,i=!0){if(this.ctx&&this._currentPath){let r,n=!1;if(i&&this._hasDropShadow()){let s=t.copy();s.setColor(CR(this._dropShadowColor));let a;this._dropShadowBlur>0&&(a=Gi.MaskFilter.MakeBlur(Gi.BlurStyle.Normal,this._dropShadowBlur*this.dpr*(this.camera?.scale??1),!1),s.setMaskFilter(a)),this.ctx.save(),this.ctx.clipPath(this._currentPath,Gi.ClipOp.Difference,!0),this._applyShadowOffsetMatrix(),e(s),this.ctx.restore(),s.delete(),a?.delete()}if(this._backgroundBlur>0&&i){this.ctx.save(),this.ctx.clipPath(this._currentPath,Gi.ClipOp.Intersect,!0);let s=Gi.ImageFilter.MakeBlur(this._backgroundBlur,this._backgroundBlur,Gi.TileMode.Clamp,null),a=t.copy();a.setImageFilter(s),a.setAlphaf(1);let o=this._currentPath.computeTightBounds();this.ctx.saveLayer(a,o,null,Gi.SaveLayerInitWithPrevious),this.ctx.drawColor(t.getColor()),this.ctx.restore(),this.ctx.restore(),a.delete(),s.delete(),n=!0}if(this._layerBlur>0){let s=t.copy();r=Gi.MaskFilter.MakeBlur(Gi.BlurStyle.Normal,this._layerBlur*this.dpr*(this.camera?.scale??1),!1),s.setMaskFilter(r),e(s),s.delete(),r.delete(),n=!0}if(n||e(t),i&&this._hasInnerShadow()){let s=new Gi.Paint;s.setAntiAlias(!0),s.setStyle(Gi.PaintStyle.Fill),s.setColor(CR(this._innerShadowColor));let a;this._innerShadowBlur>0&&(a=Gi.MaskFilter.MakeBlur(Gi.BlurStyle.Normal,this._innerShadowBlur*this.dpr*(this.camera?.scale??1),!1),s.setMaskFilter(a));let o=this._currentPath.computeTightBounds(),[l,c,u,h]=o,d=u-l,f=h-c;this.ctx.save(),this.ctx.clipPath(this._currentPath,Gi.ClipOp.Intersect,!0),this.ctx.saveLayer(s,o,null,Gi.SaveLayerInitWithPrevious),this.ctx?.translate(this._innerShadowOffsetX,this._innerShadowOffsetY),this.ctx.drawRect(Gi.XYWHRect(-1e3-this._innerShadowOffsetX,-1e3-this._innerShadowOffsetY,2e3+d+Math.abs(this._innerShadowOffsetX*2),2e3+f+Math.abs(this._innerShadowOffsetY*2)),s),s.setBlendMode(Gi.BlendMode.Clear),this.ctx.drawPath(this._currentPath,s),this.ctx.restore(),this.ctx.restore(),s.delete(),a?.delete()}}}_paintInner(t,e=!0){if(this.ctx&&this._currentPath&&t){let i=this.ctx,r=this._currentPath;this._applyEffectsToPaint(t,n=>{let s=!1;!e&&this._strokeMode!=="center"&&(i.save(),i.clipPath(r,this._strokeMode==="outside"?Gi.ClipOp.Difference:Gi.ClipOp.Intersect,!0),s=!0),i.drawPath(r,n),s&&i.restore()},e)}}_hasDropShadow(){return this._dropShadowColor?.a>0}_hasInnerShadow(){return this._innerShadowColor?.a>0}path(t){this._currentPath?.addPath(Gi.Path.MakeFromSVGString(t))}ellipse(t,e,i,r,n,s,a,o){if(!aie([t,e,i,r])||!this._currentPath)return;if(i<0||r<0)throw Error("radii cannot be negative");let l=Gi.XYWHRect(t-i,e-r,i*2,r*2);this._currentPath?.addOval(l)}rect(t,e,i,r,n=0,s=0,a=0,o=0){let l=Gi.XYWHRect(t,e,i,r);if(aie(l))if(n===0&&s===0&&o===0&&a===0)this._currentPath?.addRect(l);else{let c=Gi.RRectXY(l,n,n);c[4]=c[5]=n,c[6]=c[7]=s,c[8]=c[9]=a,c[10]=c[11]=o,this._currentPath?.addRRect(c)}}getHorizontalAlign(t){switch(t){case 2:return Gi.TextAlign.Right;case 3:return Gi.TextAlign.Center;case 4:return Gi.TextAlign.Justify;case 1:default:return Gi.TextAlign.Left}}drawTextInner(t,e,i,[r,n,s,a],o,l,c=!0){let u=0,{ctx:h}=this;if(!h)return u;let d=l.copy(),f=l.copy();return f.setAlphaf(0),this._applyEffectsToPaint(d,p=>{e.pushPaintStyle(i,p,f),e.addText(t);let g=e.build();g.layout(s);let m=n;o===2?m+=(a-g.getHeight())/2:o===3&&(m+=a-g.getHeight()),h.drawParagraph(g,r,m),u=g.getHeight(),e.reset(),g.delete()},c),d.delete(),f.delete(),u}drawText(t,e){let i=0,r=this._fonts.get(e.font),{ctx:n,_paintFill:s,_paintStroke:a}=this;if(r&&n){let o=new Gi.TextStyle({fontFamilies:[e.font],fontSize:e.fontSize,heightMultiplier:e.lineHeight,letterSpacing:e.letterSpacing}),l=new Gi.ParagraphStyle({textStyle:o,textAlign:this.getHorizontalAlign(e.horizontalAlign)}),c=Gi.XYWHRect(e.x,e.y,e.width,e.height),u=Gi.ParagraphBuilder.Make(l,r);s&&(i=this.drawTextInner(t,u,o,c,e.verticalAlign,s,!0)),a&&(i=this.drawTextInner(t,u,o,c,e.verticalAlign,a,!1)),u.delete()}return{height:i}}render(){this._surface?.flush()}moveTo(t,e){this._currentPath?.moveTo(t,e)}lineTo(t,e){this._currentPath?.lineTo(t,e)}bezierCurveTo(t,e,i,r,n,s){this._currentPath?.cubicTo(t,e,i,r,n,s)}quadraticCurveTo(t,e,i,r){this._currentPath?.quadTo(t,e,i,r)}setTransform(t,e=!1){if(!this.ctx)return;let i=this.ctx.getTotalMatrix(),r=Or.invert(i);if(r&&this.ctx.concat(r),this.ctx?.scale(this.dpr,this.dpr),this.camera?.enabled&&(this.ctx?.concat(this.camera.worldMatrix),e)){let n=Or.getScale(this.camera.worldMatrix);this.ctx?.scale(1/n[0],1/n[1])}this.ctx?.concat(t),this.currentTransform=t}transform(t){this.ctx?.concat(t)}setSize(t,e){!this._isSizeDirty&&t===this._width&&e===this._height||(this._isSizeDirty=!1,this._width=t,this._height=e,this.canvas.style.width=t+"px",this.canvas.style.height=e+"px",this.canvas.width=t*this.dpr,this.canvas.height=e*this.dpr,this._surface&&(this._surface=Gi.MakeWebGLCanvasSurface(this.canvas),this.ctx=this._surface?.getCanvas()))}};function aie(t){for(let e=0;e<t.length;e++)if(t[e]!==void 0&&!Number.isFinite(t[e]))return!1;return!0}function CR({r:t,g:e,b:i,a:r}){return Gi.Color4f(t,e,i,r)}var oie=class{constructor(t,e,i){this.uuid=t,this.data=e,this.enabled=!1,this.color=Xr.transparent,this.blurRadius=0,this.offset=[0,0],this.spread=0,this.update(e)}update(t){t.color!==void 0&&(this.color=t.color),t.enabled!==void 0&&(this.enabled=t.enabled),t.blurRadius!==void 0&&(this.blurRadius=t.blurRadius),t.offset!==void 0&&(this.offset=t.offset),t.spread!==void 0&&(this.spread=t.spread)}},lie=class{constructor(t,e,i){this.uuid=t,this.data=e,this.enabled=!1,this.radius=0,this.update(e)}update(t){t.enabled!==void 0&&(this.enabled=t.enabled),t.radius!==void 0&&(this.radius=t.radius)}},kht=class{constructor(t,e,i){this.uuid=t,this.data=e,this.enabled=!1,this.color=Xr.transparent,this.update(e)}update(t){t.enabled!==void 0&&(this.enabled=t.enabled),t.color!==void 0&&(this.color=t.color)}},Nht=class{constructor(t,e,i){this.uuid=t,this.data=e,this.enabled=!1,this.color=Xr.transparent,this.thickness=0,this.mode="inside",this.update(e)}update(t){t.enabled!==void 0&&(this.enabled=t.enabled),t.color!==void 0&&(this.color=t.color),t.thickness!==void 0&&(this.thickness=t.thickness),t.mode!==void 0&&(this.mode=t.mode)}},Va=class extends Ka{constructor(t,e,i){super(t,e,i),this.uuid=t,this.data=e,this.autoClose=!0,this.fill=new kht(t+"-fill",e.fill,i),this.stroke=new Nht(t+"-stroke",e.stroke,i),this.dropShadow=new oie(t+"-dropShadow",e.dropShadow,i),this.innerShadow=new oie(t+"-innerShadow",e.innerShadow,i),this.backgroundBlur=new lie(t+"-backgroundBlur",e.backgroundBlur,i),this.layerBlur=new lie(t+"-layerBlur",e.layerBlur,i)}applyFillStroke(t){t.fillColor=this.fill.enabled?this.fill.color:Xr.transparent,t.strokeColor=this.stroke.enabled&&this.stroke.thickness>0?this.stroke.color:Xr.transparent,t.strokeMode=this.stroke.mode,t.lineWidth=this.stroke.thickness}applyFilters(t){this.layerBlur.enabled?t.layerBlur=this.layerBlur.radius*5:t.layerBlur=0,this.backgroundBlur.enabled?t.backgroundBlur=this.backgroundBlur.radius*5:t.backgroundBlur=0,this.dropShadow.enabled?(t.dropShadowBlur=this.dropShadow.blurRadius*5,t.dropShadowColor=this.dropShadow.color,t.dropShadowOffsetX=this.dropShadow.offset[0],t.dropShadowOffsetY=this.dropShadow.offset[1]):t.dropShadowColor=Xr.transparent,this.innerShadow.enabled?(t.innerShadowSpread=this.innerShadow.spread,t.innerShadowBlur=this.innerShadow.blurRadius*5,t.innerShadowColor=this.innerShadow.color,t.innerShadowOffsetX=this.innerShadow.offset[0],t.innerShadowOffsetY=this.innerShadow.offset[1]):t.innerShadowColor=Xr.transparent}innerDraw(t){}draw(t){!this.visible||(t.save(),this.applyTransforms(t),this.applyFilters(t),this.applyFillStroke(t),t.beginPath(),this.innerDraw(t),this.autoClose&&t.closePath(),this.fill.enabled&&t.fill(),this.stroke.enabled&&t.stroke(),t.restore())}updateByPatchedOp(t,e,i){super.updateByPatchedOp(t,e,i),t.type===0&&(yn(t.path,["fill"])?this.fill.update(t.props):yn(t.path,["stroke"])?this.stroke.update(t.props):yn(t.path,["dropShadow"])?this.dropShadow.update(t.props):yn(t.path,["innerShadow"])?this.innerShadow.update(t.props):yn(t.path,["layerBlur"])?this.layerBlur.update(t.props):yn(t.path,["backgroundBlur"])?this.backgroundBlur.update(t.props):this.resetBBoxNeedsUpdate())}updateState(t,e){super.updateState(t,e),t.fill!==void 0&&this.fill.update(t.fill),t.stroke!==void 0&&this.stroke.update(t.stroke),t.dropShadow!==void 0&&this.dropShadow.update(t.dropShadow),t.innerShadow!==void 0&&this.innerShadow.update(t.innerShadow),t.layerBlur!==void 0&&this.layerBlur.update(t.layerBlur),t.backgroundBlur!==void 0&&this.backgroundBlur.update(t.backgroundBlur)}clone(t){let e=new Va(this.uuid,this.data,t);return e.parent=void 0,e}},y8=class extends Va{constructor(t,e,i){super(t,e,i),this.uuid=t,this.data=e,this.width=0,this.height=0,this.updateState(e,i)}innerDraw(t){t.ellipse(this.width*.5,this.height*.5,this.width*.5,this.height*.5,0,0,Math.PI*2)}intersectsInLocalSpace(t,e){return Pht(t,e,this.width*.5,this.height*.5,this.width*.5,this.height*.5)}getCenter(){return[this.width*.5,this.height*.5]}getHalfSize(){return[this.width*.5,this.height*.5]}updateSizeState(t){let e=!1;t.width!==void 0&&(this.width=typeof t.width=="number"?t.width:this.width,e=!0),t.height!==void 0&&(this.height=typeof t.height=="number"?t.height:this.height,e=!0),e&&this.updateWorldMatrix(!0,!1,!0)}updateState(t,e){super.updateState(t,e),this.updateSizeState(t)}clone(t){let e=new y8(this.uuid,this.data,t);return e.parent=void 0,e}},qT=class extends Va{constructor(t,e,i){super(t,e,i),this.uuid=t,this.data=e,this.width=0,this.height=0,this.cornerRadius=[0,0,0,0],this.updateState(e,i)}innerDraw(t){t.rect(0,0,this.width,this.height,...this.cornerRadius)}getCenter(){return[this.width*.5,this.height*.5]}getHalfSize(){return[this.width*.5,this.height*.5]}updateCornerState(t){t.cornerRadius!==void 0&&(this.cornerRadius=t.cornerRadius)}updateSizeState(t){let e=!1;t.width!==void 0&&(this.width=typeof t.width=="number"?t.width:this.width,e=!0),t.height!==void 0&&(this.height=typeof t.height=="number"?t.height:this.height,e=!0),e&&this.updateWorldMatrix(!0,!1,!0)}updateState(t,e){super.updateState(t,e),this.updateSizeState(t),this.updateCornerState(t)}clone(t){let e=new qT(this.uuid,this.data,t);return e.parent=void 0,e}},x8=class extends Va{constructor(t,e,i){super(t,e,i),this.uuid=t,this.data=e,this._textHeight=0,this._textHeightDirty=!0,this.width=0,this.height=0,this.updateState(e,i)}get textHeight(){return this._textHeight}applyFillStroke(t){t.fillColor=this.fill.enabled?this.fill.color:Xr.transparent,t.strokeColor=this.stroke.enabled&&this.stroke.thickness>0?this.stroke.color:Xr.transparent,t.strokeMode="center",t.lineWidth=this.stroke.thickness}innerDraw(t){this._fontHolder?.arrayBuffer&&this._fontHolder.arrayBuffer.byteLength>1&&this.data.font&&t.registerFont(this._fontHolder.arrayBuffer,this.data.font);let e=this.data.textTransform,i=this.data.text.textValue.toString(),r=e===2?i.toUpperCase():e===3?i.toLowerCase():i,{height:n}=t.drawText(r,{x:0,y:0,width:this.width,height:this.height,fontSize:this.data.fontSize,lineHeight:this.data.lineHeight??1,letterSpacing:this.data.letterSpacing??0,horizontalAlign:this.data.horizontalAlign,verticalAlign:this.data.verticalAlign,font:this.data.font});this._textHeight=n}getCenter(){return[this.width*.5,this.height*.5]}getHalfSize(){return[this.width*.5,this.height*.5]}updateSizeState(t){let e=!1;t.width!==void 0&&(this.width=typeof t.width=="number"?t.width:this.width,e=!0),t.height!==void 0&&(this.height=typeof t.height=="number"?t.height:this.height,e=!0),e&&this.updateWorldMatrix(!0,!1,!0)}updateFontState(t,{shared:e}){t.font!==void 0&&(this._fontHolder=e.getFont(t.font),this._fontHolder&&!this._fontHolder.isLoaded&&this._fontHolder.loadingPromise.then(()=>{this.requestRender()}))}updateState(t,e){super.updateState(t,e),this.updateSizeState(t),this.updateFontState(t,e)}clone(t){let e=new x8(this.uuid,this.data,t);return e.parent=void 0,e}},dme=class extends Va{constructor(t,e,i){super(t,e,i),this.uuid=t,this.data=e,this.curves=[],this.extremasBBox={min:[0,0],max:[0,0]},this.updateState(e,i)}computeExtremas(){this.curves.length===0&&this.computeCurves();let t=this.curves.map(r=>V3.extremas(r)),e=[1/0,1/0],i=[-1/0,-1/0];for(let r=0,n=t.length;r<n;r++){let s=t[r];s[0][0]<e[0]&&(e[0]=s[0][0]),s[0][1]<e[1]&&(e[1]=s[0][1]),s[1][0]>i[0]&&(i[0]=s[1][0]),s[1][1]>i[1]&&(i[1]=s[1][1])}return this.extremasBBox.min=[e[0],e[1]],this.extremasBBox.max=[i[0],i[1]],this.extremasBBox}computeCurves(){this.curves=[];for(let i=1,r=this.data.points.length;i<r;i++){let n=this.data.points[i].data,s=this.data.points[i-1].data,a={start:s.position,cp1:s.controlNext.position,cp2:n.controlPrevious.position,end:n.position};this.curves.push(a)}let t=this.data.points[0].data,e=this.data.points[this.data.points.length-1].data;if(this.data.isClosed){let i={start:e.position,cp1:e.controlNext.position,cp2:t.controlPrevious.position,end:t.position};this.curves.push(i)}}getCenter(){let[t,e]=this.extremasBBox.min,[i,r]=this.getHalfSize();return[t+i,e+r]}getHalfSize(){let{min:t,max:e}=this.extremasBBox;return[(e[0]-t[0])*.5,(e[1]-t[1])*.5]}innerDraw(t){for(let r=0,n=this.data.points.length;r<n;r++){let s=this.data.points[r].data;if(r===0){let[a,o]=s.position;t.moveTo(a,o)}else{let a=this.data.points[r-1].data,[o,l]=a.controlNext.position,[c,u]=s.controlPrevious.position,[h,d]=s.position,f={start:a.position,cp1:a.controlNext.position,cp2:s.controlPrevious.position,end:s.position};V3.derive(f),t.bezierCurveTo(o,l,c,u,h,d)}}let e=this.data.points[0].data,i=this.data.points[this.data.points.length-1].data;if(this.data.isClosed){let[r,n]=i.controlNext.position,[s,a]=e.controlPrevious.position,[o,l]=e.position;t.bezierCurveTo(r,n,s,a,o,l)}}updateState(t,e){super.updateState(t,e),this.computeExtremas()}clone(t){let e=new dme(this.uuid,this.data,t);return e.parent=void 0,e}},V3;(t=>{function e(a){let o=a.start,l=a.cp1,c=a.cp2,u=a.end,h=[3*(l[0]-o[0]),3*(l[1]-o[1])],d=[3*(c[0]-l[0]),3*(c[1]-l[1])],f=[3*(u[0]-c[0]),3*(u[1]-c[1])],p={start:h,cp:d,end:f};return a.derivative=p,p.derivative=lV.derive(p),p}t.derive=e;function i(a,o,l,c=!1){let u=a-2*o+l;if(u!==0){let h=-Math.sqrt(Math.abs(o*o-a*l)),d=-a+o,f=-(h+d)/u,p=-(-h+d)/u;return[f,p]}else if(o!==l&&u===0)return[(2*o-l)/(2*(o-l))];return[]}function r(a){let o=a.derivative??t.derive(a),l=o.start,c=o.cp,u=o.end;return[i(l[0],c[0],u[0]),i(l[1],c[1],u[1])]}t.droot=r;function n(a){let[o,l]=t.droot(a),c=[a.start[0],a.end[0]],u=[a.start[1],a.end[1]];for(let h of o)c.push(t.compute(a,Math.min(1,Math.max(0,h)))[0]);for(let h of l)u.push(t.compute(a,Math.min(1,Math.max(0,h)))[1]);return c.sort((h,d)=>h-d),u.sort((h,d)=>h-d),[[c[0],u[0]],[c[c.length-1],u[u.length-1]]]}t.extremas=n;function s(a,o){if(o===0)return[...a.start];if(o===1)return[...a.end];let l=1-o,c=l*l,u=o*o,h=c*l,d=c*o*3,f=l*u*3,p=o*u;return[h*a.start[0]+d*a.cp1[0]+f*a.cp2[0]+p*a.end[0],h*a.start[1]+d*a.cp1[1]+f*a.cp2[1]+p*a.end[1]]}t.compute=s})(V3||(V3={}));var lV;(t=>{function e(n){let s=n.start,a=n.cp,o=n.end,l=[2*(a[0]-s[0]),2*(a[1]-s[1])],c=[2*(o[0]-a[0]),2*(o[1]-a[1])],u={start:l,end:c};return u.derivative=cV.derive(u),n.derivative=u,u}t.derive=e;function i(n){let s=n.derivative??t.derive(n),a=s.start,o=s.end;return[a[0]!==o[0]?a[0]/(a[0]-o[0]):0,a[1]!==o[1]?a[1]/(a[1]-o[1]):0]}t.droot=i;function r(n,s){if(s===0)return[...n.start];if(s===1)return[...n.end];let a=1-s,o=a*a,l=s*s,c=o,u=a*s*2,h=l;return[c*n.start[0]+u*n.cp[0]+h*n.end[0],c*n.start[1]+u*n.cp[1]+h*n.end[1]]}t.compute=r})(lV||(lV={}));var cV;(t=>{function e(r){let n=r.start,s=r.end,a=[s[0]-n[0],s[1]-n[1]];return r.derivative=a,r.derivative}t.derive=e;function i(r,n){if(n===0)return[...r.start];if(n===1)return[...r.end];let s=r.start,a=r.end;return[s[0]+(a[0]-s[0])*n,s[1]+(a[1]-s[1])*n]}t.compute=i})(cV||(cV={}));var Xd=class extends vh{constructor(t,e,i){super(t,e,i),this.uuid=t,this.width=0,this.height=0,this.clipped=!0,this.background=new qT(t+"-background",GM.defaultData,i),this.background.parent=this,this.updateState(e,i)}get fill(){return this.background.fill}get stroke(){return this.background.stroke}get backgroundBlur(){return this.background.backgroundBlur}get layerBlur(){return this.background.layerBlur}get dropShadow(){return this.background.dropShadow}get innerShadow(){return this.background.innerShadow}get cornerRadius(){return this.background.cornerRadius}set cornerRadius(t){this.background.cornerRadius=t}updateLocalMatrix(){super.updateLocalMatrix(),this.background?.updateLocalMatrix()}updateWorldMatrix(t,e,i){super.updateWorldMatrix(t,e,i),this.background?.updateWorldMatrix(t,e,i)}draw(t){if(!this.visible)return;t.save();let e=this.width,i=this.height;this.applyTransforms(t),this.background.width=e,this.background.height=i,this.background.draw(t),this.clipped&&t.clipRect(0,0,e,i,...this.cornerRadius),this.innerDrawChildren(t),t.restore()}getCenter(){return[this.width*.5,this.height*.5]}getHalfSize(){return[this.width*.5,this.height*.5]}updateCornerState(t){t.cornerRadius!==void 0&&(this.cornerRadius=t.cornerRadius)}updateSizeState(t){let e=!1;t.width!==void 0&&(this.width=typeof t.width=="number"?t.width:this.width,e=!0),t.height!==void 0&&(this.height=typeof t.height=="number"?t.height:this.height,e=!0),e&&this.updateWorldMatrix(!0,!1,!0)}updateState(t,e){super.updateState(t,e),this.updateSizeState(t),this.updateCornerState(t),t.fill!==void 0&&this.fill.update(t.fill),t.stroke!==void 0&&this.stroke.update(t.stroke),t.dropShadow!==void 0&&this.dropShadow.update(t.dropShadow),t.innerShadow!==void 0&&this.innerShadow.update(t.innerShadow),t.layerBlur!==void 0&&this.layerBlur.update(t.layerBlur),t.backgroundBlur!==void 0&&this.backgroundBlur.update(t.backgroundBlur),t.clipped!==void 0&&(this.clipped=t.clipped)}requestRender(){super.requestRender(),this.dispatchEvent({type:"render"})}dispose(){this.removeEventListener("render")}updateByPatchedOp(t,e,i){super.updateByPatchedOp(t,e,i),t.type===0&&(yn(t.path,["fill"])?this.fill.update(t.props):yn(t.path,["stroke"])?this.stroke.update(t.props):yn(t.path,["dropShadow"])?this.dropShadow.update(t.props):yn(t.path,["innerShadow"])?this.innerShadow.update(t.props):yn(t.path,["layerBlur"])?this.layerBlur.update(t.props):yn(t.path,["backgroundBlur"])?this.backgroundBlur.update(t.props):this.resetBBoxNeedsUpdate())}clone(t){let e=new Xd(this.uuid,this.data,t);e.parent=void 0;for(let i of this.children)e.add(i.clone(t));return e}},Uht=gv(Kue(),1),OL=class extends Va{constructor(t,e,i){super(t,e,i),this.uuid=t,this.data=e,this._pathBBox=new DOMRect,this.path="",this.updateState(e,i),this.autoClose=!1,this.computeSVGBBox()}computeSVGBBox(){let t=document.createElementNS("http://www.w3.org/2000/svg","svg"),e=document.createElementNS("http://www.w3.org/2000/svg","path");document.body.appendChild(t),e.setAttribute("d",this.path),t.appendChild(e),this._pathBBox=e.getBBox(),t.remove()}innerDraw(t){t.path(this.path)}intersectsInLocalSpace(t,e){return t>=this._pathBBox.x&&t<=this._pathBBox.x+this._pathBBox.width&&e>=this._pathBBox.y&&e<=this._pathBBox.y+this._pathBBox.height}getCenter(){return[(this._pathBBox.x+this._pathBBox.width)/2,(this._pathBBox.y+this._pathBBox.height)/2]}getHalfSize(){return[(this._pathBBox.x+this._pathBBox.width)/2,(this._pathBBox.y+this._pathBBox.height)/2]}updateState(t,e){super.updateState(t,e),t.path!==void 0&&(this.path=t.path,this.computeSVGBBox())}clone(t){let e=new OL(this.uuid,this.data,t);return e.parent=void 0,e}};function Bht(t,e=1,i=1){if(e<=0||i<=0)return t;let r=(0,Uht.parseSVG)(t).map(n=>{let s={...n};return"x"in s&&(s.x=s.x*e),"y"in s&&(s.y=s.y*i),"x1"in s&&(s.x1=s.x1*e),"x2"in s&&(s.x2=s.x2*e),"y1"in s&&(s.y1=s.y1*i),"y2"in s&&(s.y2=s.y2*i),"rx"in s&&(s.rx=s.rx*e),"ry"in s&&(s.ry=s.ry*i),s});return Fht(r)}function Fht(t){let e=["rx","ry","xAxisRotation","largeArc","sweep","x1","y1","x2","y2","x","y"],i;return t.map(r=>{let n=[];e.forEach(a=>{if(a in r){let o=r[a]*1;n.length&&o>=0&&n.push(","),n.push(o)}});let s=(i===r.code?n[0]<0?"":",":r.code)+n.join("");return i=r.code,s}).join("")}function zht(t,e,i){switch(e.type){case"ellipse2d":return new y8(t,e,i);case"rectangle2d":return new qT(t,e,i);case"text2d":return new x8(t,e,i);case"vector2d":return new dme(t,e,i);case"path2d":return new OL(t,e,i);case"frame2d":return new Xd(t,e,i);case"group2d":default:return new av(t,e,i)}}var fme=class{constructor(t,e,i){this.uuid=t,this.data=e,this.group=new av(fme.GROUP_ID,{...C3.defaultData},i),this.createChildrenObjects(e.objects,this.group,i)}createObject(t,e,i,r,n,s){let a=zht(t,e,s);a&&(r.add(a),r.children.splice(n,0,r.children.pop()),a.updateWorldMatrix(),i.length>0&&(a instanceof av||a instanceof Xd)&&this.createChildrenObjects(i,a,s))}createChildrenObjects(t,e,i){let r=0;for(let n of t)this.createObject(n.id,n.data,n.children,e,r,i),r+=1}draw(t){this.group.draw(t)}updateEntityByOp(t,e,i,r){let n=this.find(t);if(n)try{n.updateByOp(e,i,{shared:r})}catch(s){console.error(s)}}updateTreeByOp(t,e){if(t.path.length===0&&t.type===7){let i=t.parent===null?this.group:this.find(t.parent);i!==void 0&&i instanceof vh&&(this.createObject(t.id,t.data,t.children,i,t.localIndex,e),i.requestRender())}else if(t.path.length===0&&t.type===8){let i=this.find(t.id);if(i!==void 0&&i.parent!==void 0&&i.parent instanceof vh){let r=i.parent;i.resetBBoxNeedsUpdate(),r?.remove(i),r?.requestRender()}}else if(t.path.length===0&&t.type===9){let i=this.find(t.id);if(i!==void 0){let r=i.parent,n=t.parent===null?this:this.find(t.parent);if(n instanceof vh||n===this){n.add(i);let s=t.localIndex;n.children.splice(s,0,n.children.pop()),i.updateWorldMatrix(!0,!1,!0),r?.requestRender(),i.requestRender()}i.resetBBoxNeedsUpdate()}}}add(t){this.group.add(t)}remove(t){this.group.remove(t)}traverse(t){this.group.traverse(e=>{e!==this.group&&t(e)})}intersectsChildren(t,e,i,r=!1,n=[]){return this.group.intersectsChildren(t,e,i,r,n,!0)}intersectsChildrenReverse(t,e,i,r=!1,n=[]){return this.group.intersectsChildrenReverse(t,e,i,r,n,!0)}find(t){return this.group.find(t)}get children(){return this.group.children}project(t,e){return this.group.project(t,e)}getWithSortKey(t){let e=this.find(t);if(e===void 0)return;let i=[],r=e;for(;r!==this.group;){let n=r;r=r.parent;let s=r.children.indexOf(n);i.splice(0,0,s)}return{entity:e,sortKey:i}}getAllSorted(t){let e=[];for(let i of t){let r=this.getWithSortKey(i.id);r!==void 0&&e.push(r)}return e.sort((i,r)=>Bde(i.sortKey,r.sortKey)),e.map(i=>i.entity)}},b8=fme;b8.GROUP_ID="scene2d";function pme({constraints:t,newParentWidth:e,newParentHeight:i,initialParentWidth:r,initialParentHeight:n,objectInitialWidth:s,objectInitialHeight:a,objectInitialPosition:o}){let{horizontalConstraint:l,verticalConstraint:c}=t,u=e-r,h=i-n,d=s,f=a,p=o[0],g=o[1];if(l!==0){if(l===1)p+=u;else if(l===3)p+=u/2;else if(l===2)d=Math.max(1,d+u);else if(l===4){let m=e/r;d*=m,p*=m}}if(c!==0){if(c===1)g+=h;else if(c===3)g+=h/2;else if(c===2)f=Math.max(1,f+h);else if(c===4){let m=i/n;f*=m,g*=m}}return{width:d,height:f,position:[p,g]}}gv(Kue(),1);var jht=`
	varying vec2 vUv;
	void main() {
		vUv = uv;
		gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
	}`,Vht=`
	uniform sampler2D tDiffuse;
	varying vec2 vUv;
	void main() {
		vec4 texel = texture2D( tDiffuse, vUv );
		gl_FragColor = texel;
	}`,Hht=new aL(-1,1,1,-1,0,1),Ght=class extends oi{constructor(){super(),this.setAttribute("position",new Gt([-1,3,0,-1,-1,0,3,-1,0],3)),this.setAttribute("uv",new Gt([0,2,0,0,2,0],2))}},Wht=new Ght,qht=class{constructor(t){this._mesh=new En(Wht,t)}dispose(){this._mesh.geometry.dispose()}render(t){t.render(this._mesh,Hht)}get material(){return this._mesh.material}set material(t){this._mesh.material=t}},mme=new Tr({defines:{},uniforms:{tDiffuse:new xt(null)},vertexShader:jht,fragmentShader:Vht}),Xht=new qht(mme),l4=null,c4=null,$ht=()=>(l4===null&&(l4=document.createElement("canvas")),l4),Yht=t=>(c4===null&&(c4=new hme(t)),c4),Kht=Or.identity(),gme=class{constructor(t,e,i,r){this.uuid=t,this.width=e,this.height=i,this.context=r,this.enabled=!0,this.isScreenSpace=!1,this.dpr=window.devicePixelRatio,this.isFrameDirty=!1,this.onRenderRequestedDownstream=()=>{this.isFrameDirty=!0,this.context.shared.requestRender()},this._innerApplySize=()=>{let n=this.width,s=this.height,a=this.dpr;this.renderer.dpr=this.isScreenSpace?a:Math.floor(2048/Math.max(n,s)),this.renderer.setSize(n,s)},this.onFrameOverrideObjectEvent=n=>{if(n.target?.uuid!==void 0){let s=this.frameRoot?.find(n.target.uuid);s&&s.dispatchEvent({...n,target:s})}},this.scene2d=new b8(Ht.generateUUID(),R5.defaultData,{dpr:window.devicePixelRatio,shared:r.shared}),this.canvas=$ht(),this.renderer=Yht(this.canvas),this.promise=this.init(),this.renderTarget=new Mr(1,1,{type:qp,stencilBuffer:!1,depthBuffer:!1}),r.shared.addUIBuffer(this.uuid,this.renderTarget),this.textureHolder=r.shared.uiBuffer(this.uuid)}get canvasTexture(){return this._canvasTexture||(this._canvasTexture=new t7e(this.canvas)),this._canvasTexture}async init(){this.renderer instanceof hme&&(this.renderer.wasmURL=jpe.skiaWasmUrl),await this.renderer.init()}render(t){if(this.isFrameDirty){this.isFrameDirty=!1,this._innerApplySize(),this.renderer.clear(),this.frameOverride?.draw(this.renderer),this.renderer.render(),mme.uniforms.tDiffuse.value=this.canvasTexture,this.canvasTexture.needsUpdate=!0;let e=t.getRenderTarget();t.setRenderTarget(this.renderTarget),t.clear(),Xht.render(t),t.setRenderTarget(e),this.textureHolder?.setNeedsUpdate(!0)}}updateEntity2DByOp(t,e,i,r){this.scene2d.updateEntityByOp(t,e,i,r),this.applySize()}updateTreeByOp(t,e){this.scene2d.updateTreeByOp(t,e),this.applySize()}applyOverrides(t){if(this.frameOverride&&this.frameRoot){this.frameOverride.position=[0,0],this.frameOverride.rotation=0;let e=t?.width??this.width,i=t?.height??this.height;this.frameOverride.width=e,this.frameOverride.height=i,this.frameOverride.localMatrix=Kht,this.isScreenSpace&&(this.frameOverride.fill.color=Xr.from0to1([0,0,0,0])),this.frameOverride.data={...this.frameOverride.data,width:e,height:i},vme({objectOverride:this.frameOverride,objectRoot:this.frameRoot,newParentWidth:this.frameOverride.width,newParentHeight:this.frameOverride.height,initialParentWidth:this.frameRoot.width,initialParentHeight:this.frameRoot.height}),this.frameOverride.updateWorldMatrix(!0,!1,!0)}}applySize(t,e=window.devicePixelRatio){let i=Math.max(1,t?.width??this.width),r=Math.max(1,t?.height??this.height);this.dpr=e,this.width=i,this.height=r,this._innerApplySize();let n=1,s=512,a=512;(i*e<s||r*e<a)&&(n=Math.max(s/(i*e),a/(r*e))),this.renderTarget.setSize(i*e*n,r*e*n),this._canvasTexture?.dispose(),this._canvasTexture=void 0,this.applyOverrides(t),this.frameOverride?.requestRender()}applyFrame(t){let e=this.context.scene.find2D(t);if(!(!e||!(e instanceof Xd)))return this.disposeFrameOverride(),this.frameRoot=e,this.frameOverride=e.clone({dpr:this.renderer.dpr,shared:this.context.shared}),this.scene2d.add(this.frameOverride),this.applySize(),this.frame?.addEventListener("render",this.onRenderRequestedDownstream),this.frameOverride.traverse(i=>{i.addEventListener("beginState",this.onFrameOverrideObjectEvent)}),this.frameOverride.traverse(i=>{i.addEventListener("completeState",this.onFrameOverrideObjectEvent)}),this.frame?.requestRender(),e}get frame(){return this.frameOverride}get frameId(){return this.frame?.uuid}find(t){return this.scene2d.find(t)}get texture(){return this.textureHolder?.getTexture(1001)}disposeFrameOverride(){this.frameOverride?.removeEventListener("render",this.onRenderRequestedDownstream),this.frameOverride?.traverse(t=>{t.removeEventListener("beginStateChange",this.onFrameOverrideObjectEvent)}),this.frameOverride?.traverse(t=>{t.removeEventListener("completeState",this.onFrameOverrideObjectEvent)}),this.frameOverride&&this.scene2d.remove(this.frameOverride)}};function vme({objectOverride:t,objectRoot:e,newParentWidth:i,newParentHeight:r,initialParentWidth:n,initialParentHeight:s}){if(t instanceof Xd&&e instanceof Xd||t instanceof av&&e instanceof av)for(let a=0,o=t.children.length;a<o;a++){let l=t.children[a],c=e.children[a];l&&c&&l.uuid===c.uuid&&Qht({objectOverride:l,objectRoot:c,newParentWidth:i,newParentHeight:r,initialParentWidth:n,initialParentHeight:s})}}function Zht(t){if(uV(t))return[t.width,t.height];if(t instanceof OL){let[e,i]=t.getHalfSize();return[e*2,i*2]}else if(t instanceof av){let[e,i]=t.recursiveBBox.getHalfSize();return[e*2,i*2]}return[0,0]}function Qht({objectOverride:t,objectRoot:e,newParentWidth:i,newParentHeight:r,initialParentWidth:n,initialParentHeight:s}){let[a,o]=Zht(e),{width:l,height:c,position:u}=pme({constraints:t.data,newParentWidth:i,newParentHeight:r,initialParentWidth:n,initialParentHeight:s,objectInitialWidth:a,objectInitialHeight:o,objectInitialPosition:e.position});if(t.position=u,t.data={...t.data,position:u},t.states)for(let h in t.states)Jht({stateId:h,objectOverride:t,objectRoot:e,newParentWidth:i,newParentHeight:r,initialParentWidth:n,initialParentHeight:s});if(uV(t)||t instanceof av)uV(t)&&(t.width=l,t.height=c,t.data={...t.data,width:l,height:c}),vme({objectOverride:t,objectRoot:e,newParentWidth:l,newParentHeight:c,initialParentWidth:a,initialParentHeight:o});else if(t instanceof OL){let h=e,d=a!==0?l/a:1,f=o!==0?c/o:1;t.path=Bht(h.path,d,f),t.data={...t.data,path:t.path}}}function Jht({stateId:t,objectOverride:e,objectRoot:i,newParentWidth:r,newParentHeight:n,initialParentWidth:s,initialParentHeight:a}){let o=e.states?.[t],l=i.states?.[t];if(o&&l){let{width:c,height:u,position:h}=pme({constraints:e.data,newParentWidth:r,newParentHeight:n,initialParentWidth:s,initialParentHeight:a,objectInitialWidth:b0.isResizeable(l)?l.width:0,objectInitialHeight:b0.isResizeable(l)?l.height:0,objectInitialPosition:l.position});Object.assign(e.states[t],{position:h}),b0.isResizeable(o)&&Object.assign(e.states[t],{width:c,height:u})}}function uV(t){return t instanceof qT||t instanceof Xd||t instanceof y8||t instanceof x8}var Fa=class extends KG(ac){constructor(t,e,i){super(),this.data=e,this.bgColor=new Ya(1,1,1,1),this.fog=null,this.backupFog=new _he(16777215,.1,2e3),this.fogUseBGColor=!1,this.isActive=!1,this.aoColor=new Ai,this.penumbraSizeArrayCache=null,this.super_Entity(t,e),this.personalCamera=new Gs(N_,{...jM.defaultData,...e.camera,name:"Personal Camera"}),this.personalCamera.objectHelper.visible=!1,this.add(this.personalCamera),this.activeCamera=this.personalCamera,this.ambientLight=new j7e(13882323,8553090,.75),this.ambientLight.name="Default Ambient Light",this.ambientLight.layers.enable(3),this.ambientLight.removeFromParent(),this.add(this.ambientLight),e.uiScene?this.uiScene=new b8((Array.isArray(t)?t[0]:t)+"-ui",e.uiScene,{dpr:window.devicePixelRatio,shared:i.shared}):e.uiFrame&&this.createUICanvas(e.uiFrame,i)}get scene(){return this.parent}get postprocessing(){return this.data.postprocessing}get frameId(){return this.data.uiFrame}get frame(){return this.uiCanvas?.frame}createUICanvas(t,e){this.uiCanvas=new gme(this.uuid+"-uiscreen",window.innerWidth,window.innerHeight,e),this.uiCanvas.isScreenSpace=!0,this.uiCanvas.promise.then(()=>{this.uiCanvas?.applyFrame(t),this.uiCanvas?.applySize()})}updateVisible(){}setBackgroundColor(t){this.bgColor=t,this.fogUseBGColor===!0&&(this.backupFog.color=t)}entityChildrenCount(){return this.uiScene?this.uiScene.children.length:super.entityChildrenCount()}updateAmbientLight(t,e){t.color!==void 0&&(this.ambientLight.color=xl(t.color,e)),t.intensity!==void 0&&(this.ambientLight.intensity=t.intensity),t.enabled!==void 0&&(t.enabled?this.add(this.ambientLight):this.remove(this.ambientLight))}onDeactive(){this.isActive=!1}onActive(t){this.isActive=!0,t.fog=this.fog,this.traverseEntity(e=>{e instanceof j0&&e.recomputeBoolean()}),this.updateShadow(this.data.shadow)}forceMaterialsUpdate(){this.traverseEntity(t=>{if(t instanceof sv)if(Array.isArray(t.material))for(let e of t.material)e.needsUpdate=!0;else t.material.needsUpdate=!0,t.material.dispose()})}updateShadow(t){t.softShadowQuality!==void 0&&this.isActive&&ght(t.softShadowQuality)&&this.forceMaterialsUpdate()}updateFog(t,e){if(t.enabled?this.fog=this.backupFog:this.fog=null,this.isActive){let i=this.scene;i.fog=this.fog}this.fogUseBGColor=t.useBackgroundColor,t.useBackgroundColor?this.backupFog.color.set(this.bgColor):this.backupFog.color=xl(t.color,e),this.backupFog.near=t.near,this.backupFog.far=t.far}updateAo(t,e){t.aoColor!==void 0&&(this.aoColor=xl(t.aoColor,e))}updateByOp(t,e,i,r){let n=this.data.uiFrame;super.updateByOp(t,e,i,r);let s=e;yn(t.path,["fog"])?this.updateFog(s.fog,i.shared):yn(t.path,["ao"])?this.updateAo(s.ao,i.shared):yn(t.path,["ambient"])?this.updateAmbientLight(s.ambient,i.shared):yn(t.path,["shadow"])?this.updateShadow(s.shadow):t.type===0&&t.path.length===0&&(t.props.uiFrame!==void 0||n!==s.uiFrame)&&this.updateUIFrame(t.props.uiFrame,i)}updateUIFrame(t,e){t?(this.uiCanvas||this.createUICanvas(t,e),this.uiCanvas.enabled=!0,this.uiCanvas.applyFrame(t)):this.uiCanvas&&(this.uiCanvas.enabled=!1)}updateState(t,e){this.updateState_Entity(t,e),t.backgroundColor!==void 0&&this.setBackgroundColor(xl(t.backgroundColor,e.shared)),t.fog!==void 0&&this.updateFog(t.fog,e.shared),t.ambient!==void 0&&this.updateAmbientLight(t.ambient,e.shared),t.ao!==void 0&&this.updateAo(t.ao,e.shared),t.shadow!==void 0&&this.updateShadow(t.shadow)}createFrame(t,e){}raycast(t,e){super.raycast(t,e)}switchActiveCamera(t){t&&t.isDescendantOf(this)&&(this.activeCamera!==this.personalCamera&&(this.activeCamera.objectHelper.visible=!0),this.activeCamera=t,t.objectHelper.visible=!1)}get playCamera(){return this.scene?.find(this.data.publish.playCamera)??this.personalCamera}switchToPlayCamera(){this.switchActiveCamera(this.playCamera)}get penumbraSizeArray(){return this.penumbraSizeArrayCache===null&&this.updatePenumbraSizeArray(),this.penumbraSizeArrayCache}updatePenumbraSizeArray(){this.penumbraSizeArrayCache=new Array(5).fill(.5);let t=0,e=0;this.traverseEntity(i=>{if(!i.visible)return!0;i instanceof IL&&i.visible&&t<3&&(this.penumbraSizeArrayCache[t]=i.data.penumbraSize??.5,t+=1),i instanceof DL&&i.visible&&t<2&&(this.penumbraSizeArrayCache[3+e]=i.data.penumbraSize??.5,e+=1)})}raycastWithClones(t){let e=[],i=r=>{for(let n of r.children){let s=n.cloner;Er.is(n)&&(n.visible||s?.object.data.visible)&&((Cd(n)||eV(n)&&this.scene.enableHelpers&&n.objectHelper.visible)&&(t.intersectObject(n,!1,e),hV(n,t,e,!0)),i(n))}};return i(this),e}updateEntity2DByOp(t,e,i,r){this.uiCanvas?.updateEntity2DByOp(t,e,i,r)}},w8=class extends m8(W7e,ame){constructor(t,e,i){super(),this.super_Entity(t,e),this.castShadow=!0,this.shadow.mapSize.width=1024,this.shadow.mapSize.height=1024,this.shadow.normalBias=1,this.layers.enable(3);let r=this.shadow.camera;r.fov=90,r.aspect=1,r.near=100,r.far=2500;let n=new W(-r.far+this.position.x,-r.far+this.position.y,-r.far+this.position.z),s=new W(r.far+this.position.x,r.far+this.position.y,r.far+this.position.z),a=new Ss(n,s),o=new ZD(a,new Ai(16755200));o.visible=!1,this.gizmos.shadowmap=o,this.update()}update(){if(this.shadow&&(this.shadow.camera.updateProjectionMatrix(),this.gizmos))for(let t in this.gizmos){let e=this.gizmos[t];if(e instanceof ZD){let i=this.shadow.camera,r=new W(-i.far+this.position.x,-i.far+this.position.y,-i.far+this.position.z),n=new W(i.far+this.position.x,i.far+this.position.y,i.far+this.position.z);e.box.set(r,n),e.updateMatrixWorld(!0)}}}updateMatrixWorld(t){super.updateMatrixWorld(t),this.objectHelper&&this.objectHelper.update()}updateState(t,e){this.updateState_Light(t,e),t.distance!==void 0&&(this.distance=t.distance),t.decay!==void 0&&(this.decay=t.decay),t.shadowRadius!==void 0&&(this.shadow.radius=t.shadowRadius),t.shadowResolution!==void 0&&(this.shadow.mapSize.set(t.shadowResolution,t.shadowResolution),this.shadow.map&&(this.shadow.map.dispose(),this.shadow.map=null))}},edt=class extends bs{get forceComputeSize(){return!0}get shape(){return this.geometry.userData.shape}updateEntityBoxSize(t,e){let i=this.geometry.getAttribute("position");i!==void 0?n8(i,this.geometry.drawRange.start,this.geometry.drawRange.count<1/0?this.geometry.drawRange.count:i.count,t,e):super.updateEntityBoxSize(t,e)}},LL=class extends bs{constructor(t,e,i){super(t,e,i),this._shapeId=null,this._context=i}updateState(t,e){super.updateState(t,e),this.updateShape(),this.refreshAttachedCloners(e)}updateShape(){let t={...this.data.geometry.extrusion.shape};for(let r in t)typeof t[r]=="string"&&(t[r]=this._context.shared.getVariable(t[r],[this.uuid,"geometry","extrusion","shape",r]));let e;if(t.type==="Custom"){let r=t.shapeId;if(r!==this._shapeId&&this.detachShape(),r){this._shapeId=r;let n=this._context.scene.find(r);n?.data&&(n.attachedPaths.add(this),e=n.geometry.userData?.shape),e||this._context.scene.addPendingCommand(()=>this.updateShape())}}else{let r;switch(t.type){case"Rectangle":r=r8;break;case"Ellipse":r=i8;break;case"Polygon":r=rpe;break;case"Star":r=npe;break;default:throw new Error(`Unknown shape type: ${t.type}`)}e=r.create({parameters:t}).userData.shape}let i=this.geometry;e&&i.inputs&&(i.inputs.shapeData=e,i.build())}detachShape(){this._shapeId!==null&&this._context.scene.find(this._shapeId)?.attachedPaths.delete(this)}createGeometryDelayed(t){this.geometryCreateDeleyed=t.shared,this.updateShape(),this.refreshAttachedPaths(t)}updateTransformState(t,e){return super.updateTransformState(t,e)}updateGeometryInteractions(t,e){super.updateGeometryInteractions(t,e),this.updateShape()}updateEntityBoxSize(t,e){let i=this.geometry.getAttribute("position");i!==void 0?n8(i,this.geometry.drawRange.start,this.geometry.drawRange.count<1/0?this.geometry.drawRange.count:i.count,t,e):super.updateEntityBoxSize(t,e)}},_8=class extends p8{constructor(t,e,i){super(t,e,i),this.data=e}},g1=class extends F_(Tp,GT){constructor(t,e,i){super(),e.type==="Instance"&&typeof t=="string"&&(e=this.transformAssignData(e,i)),this.super_Entity(t,e),this.objectHelper.update()}get isComponentRoot(){return this.data.type==="Component"&&typeof this.identity=="string"}get isInstanceRoot(){return this.data.type==="Instance"&&typeof this.identity=="string"}transformAssignData(t,e){let i=E3.getComponentData({scene:e.scene.data,shared:e.shared.data},t.component);if(i){let r,n;for(let s of Dg.rootOverrideProps)t[s]===void 0?(r===void 0&&(r={...t}),r[s]=i.data[s]):(n===void 0&&(n={}),n[s]=t[s],r===void 0&&(r={...t}),r[s]=jg.apply(i.data[s],t[s]));return this.overrideData=n,r}else return{...pa.defaultData,...t,...Wd(pa.defaultData,Dg.rootOverrideProps)}}updateByOp(t,e,i,r){let n;if(this.isInstanceRoot&&!r){if(e=this.transformAssignData(e,i),t.type===0&&t.path.length===0&&this.component)for(let s of Dg.rootOverrideProps)s in t.props&&t.props[s]===void 0&&(n===void 0&&(n={...t,props:{...t.props}}),n.props[s]=this.component.data[s]);else if(t.type===0&&t.path.length>0&&Dg.rootOverrideProps.includes(t.path[0])){let s=t.path[0];n===void 0&&(n={...t,path:[],props:{[s]:e[s]}})}}super.updateByOp(n??t,e,i,r)}updateState(t,e){this.updateState_Entity(t,e)}expandInstanceChildren(t){let e=this.data;if(this.component===void 0){let i=t.scene.find(e.component)??null,r=!1;if(i!==this.oldComponent){if(this.oldComponent){let n=0;for(let s of this.children)if(Er.is(s))t.scene.disposeAndUnregisterEntityRecursivelyIfNotReregistered(s),S8(s),n+=1;else break;this.children.splice(0,n)}r=!0}if(i){let n={};yme(t,[this.uuid],e.overrides,this,i,i,0,r,n);for(let s of this.children)if(Er.is(s)){let a=s.data;a.type==="Empty"&&a.animations&&s.traverseEntity(o=>{let l=o.dataPatched;if(o instanceof bs&&l.bones&&l.boneInverses){let c=o.dataPatched;if(c.bones&&c.boneInverses){let u=c.bones.map(f=>t.scene.find(n[f])),h=c.boneInverses.map(f=>new St().fromArray(f)),d=new $H(u,h);o.bind(d,o.bindMatrix)}}else o.matrixAutoUpdate=!0})}}this.oldComponent=this.component}}};function S8(t){if(t.component){let e=t.component.instances.indexOf(t);e>=0&&t.component.instances.splice(e,1);for(let i of t.children)Er.is(i)&&S8(i)}}function cie(t,e,i,r){return t.component===e&&bG(t.identity,r)?t.overrideData===i?2:1:0}function yme(t,e,i,r,n,s,a,o,l){if(a>50)return!1;if(r.component!==n){if(r.component){let u=r.component.instances.indexOf(r);u>=0&&r.component.instances.splice(u,1)}n.instances.find(u=>u===r)||n.instances.push(r),r.component=n}n instanceof g1&&n.isInstanceRoot&&n.expandInstanceChildren(t);let c=0;for(let u of n.children)if(Er.is(u)){let h=[...e,...typeof u.identity=="string"?[u.identity]:u.identity],d=b3.resolve(i,h,1);d!=null&&!(d instanceof cs)&&(Object.setPrototypeOf(d,cs.prototype),console.error("wrong prototype"));let f=null,p;if(!o){let g=r.children[c];if(f=Er.is(g)?g:null,f!==null){let m=cie(f,u,d,h);p=m>=1?f.stateSelection:void 0,m!==2&&(f=null)}if(f===null&&(f=t.scene.findInstance(h)??null,f!==null)){let m=cie(f,u,d,h);if(p=m>=1?f.stateSelection:void 0,m!==2)f=null;else{let y=f.parent.children.indexOf(f);f.parent.children.splice(y,1),r.children.splice(c,0,f),f.parent===r?y<=c&&console.error("not possible"):(f.parent=r,f.matrixWorldNeedsUpdate=!0,f.resetBBoxNeedsUpdate(),f.updateVisible(),t.pendingDeletes.delete(f))}}}if(f===null){let g=d?jg.apply(u.data,d):u.data;B0.is(g.type)&&(g={...g,type:"Empty"}),f=Lg.createEntity(h,g,t),f.overrideData=d,r.add(f),r.children.splice(r.children.length-1,1),r.children.splice(c,0,f),f.updateState(f.data,t),p&&f.changeSelectedState(p,t),t.scene.registerInstanceAndSetUuid(f)}if(f.isBone){let g=f.identity[f.identity.length-1];l[g]=f.uuid}c+=1,yme(t,e,i,f,u,s,a+1,o,l)}if(!o){let u=c;for(;;){let h=r.children[c];if(Er.is(h))t.pendingDeletes.add(h);else break;c+=1}r.children.splice(u,c-u)}return!0}var tdt=class extends F_(She,GT){constructor(t,e){super(),this.super_Entity(t,e),this.objectHelper.update(),this.matrixAutoUpdate=!0}updateState(t,e){this.updateState_Entity(t,e)}},Fo=class extends bs{constructor(t,e,i){super(t,e,i),this.onBeforeRender=r=>{this.uiCanvas.render(r)},this.uiCanvas=new gme(t+"-canvas",e.geometry.width,e.geometry.height,i),this.uiCanvas.promise.then(()=>{this.applyFrame(this.dataPatched.geometry.frame,i.shared)})}updateByPatchedOpGeometry(t,e,i){super.updateByPatchedOpGeometry(t,e,i),t.type===0&&(t.props.frame!==void 0&&this.applyFrame(t.props.frame,i.shared),(t.props.width!==void 0||t.props.height!==void 0)&&this.applySize(t.props,i.shared))}applySize(t,e){let i=t?.width??this.dataPatched.geometry.width,r=t?.height??this.dataPatched.geometry.height;this.uiCanvas.applySize({width:i,height:r}),this.applyGeometryParametersFromFrame(e)}applyFrame(t,e){this.uiCanvas.applyFrame(t),this.applyGeometryParametersFromFrame(e),this.applyMaterialParametersFromFrame({shared:e})}applyGeometryParametersFromFrame(t){let e=this.frame;e&&(Object.assign(this.data,{geometry:Object.assign(this.data.geometry,{cornerRadius:e.cornerRadius,cornerType:0})}),Object.assign(this.dataPatched,{geometry:Object.assign(this.dataPatched.geometry,{cornerRadius:e.cornerRadius,cornerType:0})}),this.localGeometry?.dispose(),this.localGeometry=$M(this.dataPatched.geometry,t,this.data.flatShading,this))}applyMaterialParametersFromFrame(t){let e=this.frame;if(e){let i=e.data.backgroundBlur;Object.assign(this.data.material.layers[0].data.texture,{image:this.uiCanvas.uuid}),Object.assign(this.data.material.layers[1].data,{roughness:i.radius,alpha:i.enabled?1:0}),Object.assign(this.dataPatched.material.layers[0].data.texture,{image:this.uiCanvas.uuid}),Object.assign(this.dataPatched.material.layers[1].data,{roughness:i.radius,alpha:i.enabled?1:0}),this.material.reset(this.dataPatched.material,t,!0)}}updateEntity2DByOp(t,e,i,r){this.uiCanvas.updateEntity2DByOp(t,e,i,r),t===this.frameId&&e.type===0&&(e.props.cornerRadius!==void 0?this.applyGeometryParametersFromFrame(r):yn(e.path,["backgroundBlur"])&&this.applyMaterialParametersFromFrame({shared:r}))}get frame(){return this.uiCanvas.frame}get frameId(){return this.frame?.uuid}removeInteractionGeometry(t){super.removeInteractionGeometry(t),this.applySize({},t)}updateGeometryInteractions(t,e){super.updateGeometryInteractions(t,e),this.applySize({width:t.width,height:t.height},e)}},idt=class{constructor(t,e,i){this.variables=[],this.currentTextureIndex=0;let r=cn,n=new ac,s=new vv;s.position.z=1;let a={passThruTexture:{value:null}},o=u(d(),a),l=new En(new ef(2,2),o);n.add(l),this.setDataType=function(f){return r=f,this},this.addVariable=function(f,p,g){let m=this.createShaderMaterial(p),y={name:f,initialValueTexture:g,material:m,dependencies:null,renderTargets:[],wrapS:null,wrapT:null,minFilter:mr,magFilter:mr};return this.variables.push(y),y},this.setVariableDependencies=function(f,p){f.dependencies=p},this.init=function(){if(i.capabilities.isWebGL2===!1&&i.extensions.has("OES_texture_float")===!1)return"No OES_texture_float support for float textures.";if(i.capabilities.maxVertexTextures===0)return"No support for vertex shader textures.";for(let f=0;f<this.variables.length;f++){let p=this.variables[f];p.renderTargets[0]=this.createRenderTarget(t,e,p.wrapS,p.wrapT,p.minFilter,p.magFilter),p.renderTargets[1]=this.createRenderTarget(t,e,p.wrapS,p.wrapT,p.minFilter,p.magFilter),this.renderTexture(p.initialValueTexture,p.renderTargets[0]),this.renderTexture(p.initialValueTexture,p.renderTargets[1]);let g=p.material,m=g.uniforms;if(p.dependencies!==null)for(let y=0;y<p.dependencies.length;y++){let b=p.dependencies[y];if(b.name!==p.name){let w=!1;for(let E=0;E<this.variables.length;E++)if(b.name===this.variables[E].name){w=!0;break}if(!w)return"Variable dependency not found. Variable="+p.name+", dependency="+b.name}m[b.name]={value:null},g.fragmentShader=`
uniform sampler2D `+b.name+`;
`+g.fragmentShader}}return this.currentTextureIndex=0,null},this.compute=function(){let f=this.currentTextureIndex,p=this.currentTextureIndex===0?1:0;for(let g=0,m=this.variables.length;g<m;g++){let y=this.variables[g];if(y.dependencies!==null){let b=y.material.uniforms;for(let w=0,E=y.dependencies.length;w<E;w++){let M=y.dependencies[w];b[M.name].value=M.renderTargets[f].texture}}this.doRenderTarget(y.material,y.renderTargets[p])}this.currentTextureIndex=p},this.getCurrentRenderTarget=function(f){return f.renderTargets[this.currentTextureIndex]},this.getAlternateRenderTarget=function(f){return f.renderTargets[this.currentTextureIndex===0?1:0]},this.dispose=function(){l.geometry.dispose(),l.material.dispose();let f=this.variables;for(let p=0;p<f.length;p++){let g=f[p];g.initialValueTexture&&g.initialValueTexture.dispose();let m=g.renderTargets;for(let y=0;y<m.length;y++)m[y].dispose()}};function c(f){f.defines.resolution="vec2( "+t.toFixed(1)+", "+e.toFixed(1)+" )"}this.addResolutionDefine=c;function u(f,p){p=p||{};let g=new Tr({uniforms:p,vertexShader:h(),fragmentShader:f});return c(g),g}this.createShaderMaterial=u,this.createRenderTarget=function(f,p,g,m,y,b){return f=f||t,p=p||e,g=g||kn,m=m||kn,y=y||mr,b=b||mr,new Mr(f,p,{wrapS:g,wrapT:m,minFilter:y,magFilter:b,format:Vn,type:r,depthBuffer:!1})},this.createTexture=function(){let f=new Float32Array(t*e*4),p=new yl(f,t,e,Vn,cn);return p.needsUpdate=!0,p},this.renderTexture=function(f,p){a.passThruTexture.value=f,this.doRenderTarget(o,p),a.passThruTexture.value=null},this.doRenderTarget=function(f,p){let g=i.getRenderTarget(),m=i.xr.enabled,y=i.shadowMap.autoUpdate,b=i.outputEncoding,w=i.toneMapping;i.xr.enabled=!1,i.shadowMap.autoUpdate=!1,i.outputEncoding=Dh,i.toneMapping=Gd,l.material=f,i.setRenderTarget(p),i.render(n,s),l.material=o,i.xr.enabled=m,i.shadowMap.autoUpdate=y,i.outputEncoding=b,i.toneMapping=w,i.setRenderTarget(g)};function h(){return`void main()	{

	gl_Position = vec4( position, 1.0 );

}
`}function d(){return`uniform sampler2D passThruTexture;

void main() {

	vec2 uv = gl_FragCoord.xy / resolution.xy;

	gl_FragColor = texture2D( passThruTexture, uv );

}
`}}},co=new vo,PR=new W,rdt=class{constructor(t){let e=t.geometry;if(!e.isBufferGeometry||e.attributes.position.itemSize!==3)throw new Error("THREE.MeshSurfaceSampler: Requires BufferGeometry triangle mesh.");e.index&&(console.warn("THREE.MeshSurfaceSampler: Converting geometry to non-indexed BufferGeometry."),e=e.toNonIndexed()),this.geometry=e,this.randomFunction=Math.random,this.positionAttribute=this.geometry.getAttribute("position"),this.colorAttribute=this.geometry.getAttribute("color"),this.weightAttribute=null,this.distribution=null}setWeightAttribute(t){return this.weightAttribute=t?this.geometry.getAttribute(t):null,this}build(){let t=this.positionAttribute,e=this.weightAttribute,i=new Float32Array(t.count/3);for(let n=0;n<t.count;n+=3){let s=1;e&&(s=e.getX(n)+e.getX(n+1)+e.getX(n+2)),co.a.fromBufferAttribute(t,n),co.b.fromBufferAttribute(t,n+1),co.c.fromBufferAttribute(t,n+2),s*=co.getArea(),i[n/3]=s}this.distribution=new Float32Array(t.count/3);let r=0;for(let n=0;n<i.length;n++)r+=i[n],this.distribution[n]=r;return this}setRandomGenerator(t){return this.randomFunction=t,this}sample(t,e,i){let r=this.distribution[this.distribution.length-1],n=this.binarySearch(this.randomFunction()*r);return this.sampleFace(n,t,e,i)}binarySearch(t){let e=this.distribution,i=0,r=e.length-1,n=-1;for(;i<=r;){let s=Math.ceil((i+r)/2);if(s===0||e[s-1]<=t&&e[s]>t){n=s;break}else t<e[s]?r=s-1:i=s+1}return n}sampleFace(t,e,i,r){let n=this.randomFunction(),s=this.randomFunction();return n+s>1&&(n=1-n,s=1-s),co.a.fromBufferAttribute(this.positionAttribute,t*3),co.b.fromBufferAttribute(this.positionAttribute,t*3+1),co.c.fromBufferAttribute(this.positionAttribute,t*3+2),e.set(0,0,0).addScaledVector(co.a,n).addScaledVector(co.b,s).addScaledVector(co.c,1-(n+s)),i!==void 0&&co.getNormal(i),r!==void 0&&this.colorAttribute!==void 0&&(co.a.fromBufferAttribute(this.colorAttribute,t*3),co.b.fromBufferAttribute(this.colorAttribute,t*3+1),co.c.fromBufferAttribute(this.colorAttribute,t*3+2),PR.set(0,0,0).addScaledVector(co.a,n).addScaledVector(co.b,s).addScaledVector(co.c,1-(n+s)),r.r=PR.x,r.g=PR.y,r.b=PR.z),this}};function ndt(t){let e=new Float32Array(t*t*2);for(let i=0;i<t;i++)for(let r=0;r<t;r++){let n=i*t+r;e[n*2+0]=i/(t-1),e[n*2+1]=r/(t-1)}return e}function sdt(t){let e=Math.ceil(Math.sqrt(t));return Math.max(e,1)}function adt(t,e){let i=new En(t.geometry,t.material),r=[],n=[],s=new W,a=new W;i.geometry.index!==null&&(i.geometry=i.geometry.toNonIndexed());let o=new rdt(i).build();for(let u=0;u<e;u++)o.sample(s,a),r.push(s.x,s.y,s.z),n.push(a.x,a.y,a.z);let l=new Float32Array(r),c=new Float32Array(n);return{positions:l,normals:c}}function uie(t,e){let i=t,r=new Float32Array(4*e*e);for(let s=0;s<e*e;s++)r[4*s]=i[3*s],r[4*s+1]=i[3*s+1],r[4*s+2]=i[3*s+2],r[4*s+3]=0;let n=new yl(r,e,e,Vn,cn);return n.needsUpdate=!0,n}function odt({size:t}){let e=new Float32Array(4*t*t);for(let r=0;r<t*t;r++)e[4*r]=r,e[4*r+1]=0,e[4*r+2]=0,e[4*r+3]=0;let i=new yl(e,t,t,Vn,cn);return i.needsUpdate=!0,i}function ldt(t){let e=new Float32Array(4*t*t);for(let r=0;r<t*t;r++)e[4*r]=0,e[4*r+1]=0,e[4*r+2]=0,e[4*r+3]=0;let i=new yl(e,t,t,Vn,cn);return i.needsUpdate=!0,i}var cdt=`
// uniform sampler2D uCurrentPosition; // Pass in the variable from GPGPU
// uniform sampler2D uCurrentVelocity; // Pass in the variable from GPGPU
// uniform sampler2D uCurrentEmissionRate; // Pass in the variable from GPGPU
uniform sampler2D uOriginalPosition;
uniform float uTime;
uniform float uSpeed;     // update speed of the particles
uniform vec3 uWorldOffset;    
uniform vec4 uWorldQuaternion;
uniform float uMaxLifeTime;
uniform vec3 uEmitterSize;
uniform float uFPSRatio;     // 1  for 60 FPS

float random (vec2 st) {
    return fract(sin(dot(st.xy,
        vec2(12.9898,78.233)))*
        43758.5453123);
}
vec3 applyQuaternionToVector( vec4 q, vec3 v ){
    return v + 2.0 * cross( q.xyz, cross( q.xyz, v ) + q.w * v );
}

vec3 applyForce(vec3 force, float mass) {
    vec3 acceleration = force / mass;
    
    return acceleration;
  }
  

void main() {
    vec2 vUv = gl_FragCoord.xy / resolution.xy;
    vec3 position = texture2D( uCurrentPosition, vUv ).xyz;
    float currentLife = texture2D( uCurrentPosition, vUv ).w;   // from 1 to 0
    float isSpawning = texture2D( uCurrentEmissionRate, vUv ).r;        // 1. = spawning, 0. = not spawning
    float isActive = texture2D( uCurrentEmissionRate, vUv ).g;          // 1. = active, 0. = not active
    float timeStart = texture2D( uCurrentEmissionRate, vUv ).b;         // timeStart in seconds when the particle was emitted
    vec3 originalPosition = ((texture2D( uOriginalPosition, vUv ).xyz) * uEmitterSize);
    vec3 velocity = texture2D( uCurrentVelocity, vUv ).xyz;
    float collisionFlag = texture2D( uCurrentVelocity, vUv ).w;             // 1. = collided, 0. = not collided
    float lifeTime = uMaxLifeTime;

    // Calculate the position adjustment based on collision
    //     if (collisionFlag > .5) {  
    float isColliding = step(0.5, collisionFlag); // 1.0 if collisionFlag > 0.5, otherwise 0.0
    float bounceOffset = 3.0 * isColliding; // Becomes 3.0 if colliding, 0.0 otherwise
    vec3 collisionAdjustedVelocity = velocity * (1.0 + bounceOffset);

    // Update position based on collision or normal movement
    vec3 fpsVelocity = velocity * min(uFPSRatio, 5.0);
    position += mix(fpsVelocity, collisionAdjustedVelocity, isColliding);

    // EMISSION RATE - BIRTH
    // if (isSpawning == 1.0) {
    // Better Approach to avoid If statement
    vec3 newPosition = applyQuaternionToVector(uWorldQuaternion, originalPosition) + uWorldOffset;
    originalPosition = mix(originalPosition, newPosition, isSpawning);
    position = mix(position, originalPosition, isSpawning);;
    timeStart = mix(timeStart, uTime, isSpawning);

    // Calculate timeLeft for life normalization
    float timeLeft = max(lifeTime - (uTime - timeStart), 0.0);
    float life_Normalize = timeLeft / lifeTime;

    // Use isActive to blend between the calculated color and black
    vec4 activeColor = vec4(position, life_Normalize);
    // if (isActive == 1.0) {
    gl_FragColor = mix(vec4(0.0), activeColor, isActive);

}
`,udt=`

    vec3 mod289(vec3 x) {
      return x - floor(x * (1.0 / 289.0)) * 289.0;
    }
    
    vec4 mod289(vec4 x) {
    return x - floor(x * (1.0 / 289.0)) * 289.0;
    }
    
    vec4 permute(vec4 x) {
        return mod289(((x*34.0)+1.0)*x);
    }
    
    vec4 taylorInvSqrt(vec4 r)
    {
    return 1.79284291400159 - 0.85373472095314 * r;
    }
    
    vec3 fade(vec3 t) {
  return t*t*t*(t*(t*6.0-15.0)+10.0);
}

    float snoise(vec3 v)
    {
    const vec2  C = vec2(1.0/6.0, 1.0/3.0) ;
    const vec4  D = vec4(0.0, 0.5, 1.0, 2.0);
    vec3 i  = floor(v + dot(v, C.yyy) );
    vec3 x0 =   v - i + dot(i, C.xxx) ;
    vec3 g = step(x0.yzx, x0.xyz);
    vec3 l = 1.0 - g;
    vec3 i1 = min( g.xyz, l.zxy );
    vec3 i2 = max( g.xyz, l.zxy );
    vec3 x1 = x0 - i1 + C.xxx;
    vec3 x2 = x0 - i2 + C.yyy; // 2.0*C.x = 1/3 = C.y
    vec3 x3 = x0 - D.yyy;      // -1.0+3.0*C.x = -0.5 = -D.y
    
    // Permutations
    i = mod289(i);
    vec4 p = permute( permute( permute(
                i.z + vec4(0.0, i1.z, i2.z, 1.0 ))
              + i.y + vec4(0.0, i1.y, i2.y, 1.0 ))
              + i.x + vec4(0.0, i1.x, i2.x, 1.0 ));
    
    // Gradients: 7x7 points over a square, mapped onto an octahedron.
    // The ring size 17*17 = 289 is close to a multiple of 49 (49*6 = 294)
    float n_ = 0.142857142857; // 1.0/7.0
    vec3  ns = n_ * D.wyz - D.xzx;
    
    vec4 j = p - 49.0 * floor(p * ns.z * ns.z);  //  mod(p,7*7)
    
    vec4 x_ = floor(j * ns.z);
    vec4 y_ = floor(j - 7.0 * x_ );    // mod(j,N)
    
    vec4 x = x_ *ns.x + ns.yyyy;
    vec4 y = y_ *ns.x + ns.yyyy;
    vec4 h = 1.0 - abs(x) - abs(y);
    
    vec4 b0 = vec4( x.xy, y.xy );
    vec4 b1 = vec4( x.zw, y.zw );
    
    vec4 s0 = floor(b0)*2.0 + 1.0;
    vec4 s1 = floor(b1)*2.0 + 1.0;
    vec4 sh = -step(h, vec4(0.0));
    
    vec4 a0 = b0.xzyw + s0.xzyw*sh.xxyy ;
    vec4 a1 = b1.xzyw + s1.xzyw*sh.zzww ;
    
    vec3 p0 = vec3(a0.xy,h.x);
    vec3 p1 = vec3(a0.zw,h.y);
    vec3 p2 = vec3(a1.xy,h.z);
    vec3 p3 = vec3(a1.zw,h.w);
    
    //Normalise gradients
    vec4 norm = taylorInvSqrt(vec4(dot(p0,p0), dot(p1,p1), dot(p2, p2), dot(p3,p3)));
    p0 *= norm.x;
    p1 *= norm.y;
    p2 *= norm.z;
    p3 *= norm.w;
    
    // Mix final noise value
    vec4 m = max(0.6 - vec4(dot(x0,x0), dot(x1,x1), dot(x2,x2), dot(x3,x3)), 0.0);
    m = m * m;
    return 42.0 * dot( m*m, vec4( dot(p0,x0), dot(p1,x1),
                                  dot(p2,x2), dot(p3,x3) ) );
    }
    
    vec3 snoiseVec3( vec3 x ){
    
      float s  = snoise(vec3( x ));
      float s1 = snoise(vec3( x.y - 19.1 , x.z + 33.4 , x.x + 47.2 ));
      float s2 = snoise(vec3( x.z + 74.2 , x.x - 124.5 , x.y + 99.4 ));
      vec3 c = vec3( s , s1 , s2 );
      return c;
    
    }
    
      
    vec3 curlNoise( vec3 p, float seed){
      p += seed;
      const float e = .1;
      vec3 dx = vec3( e   , 0.0 , 0.0 );
      vec3 dy = vec3( 0.0 , e   , 0.0 );
      vec3 dz = vec3( 0.0 , 0.0 , e   );
    
      vec3 p_x0 = snoiseVec3( p - dx );
      vec3 p_x1 = snoiseVec3( p + dx );
      vec3 p_y0 = snoiseVec3( p - dy );
      vec3 p_y1 = snoiseVec3( p + dy );
      vec3 p_z0 = snoiseVec3( p - dz );
      vec3 p_z1 = snoiseVec3( p + dz );
    
      float x = p_y1.z - p_y0.z - p_z1.y + p_z0.y;
      float y = p_z1.x - p_z0.x - p_x1.z + p_x0.z;
      float z = p_x1.y - p_x0.y - p_y1.x + p_y0.x;
    
      const float divisor = 1.0 / ( 2.0 * e );
      return normalize( vec3( x , y , z ) * divisor );
    
    }


// Classic Perlin noise
float cnoise(vec3 P)
{
  vec3 Pi0 = floor(P); // Integer part for indexing
  vec3 Pi1 = Pi0 + vec3(1.0); // Integer part + 1
  Pi0 = mod289(Pi0);
  Pi1 = mod289(Pi1);
  vec3 Pf0 = fract(P); // Fractional part for interpolation
  vec3 Pf1 = Pf0 - vec3(1.0); // Fractional part - 1.0
  vec4 ix = vec4(Pi0.x, Pi1.x, Pi0.x, Pi1.x);
  vec4 iy = vec4(Pi0.yy, Pi1.yy);
  vec4 iz0 = Pi0.zzzz;
  vec4 iz1 = Pi1.zzzz;

  vec4 ixy = permute(permute(ix) + iy);
  vec4 ixy0 = permute(ixy + iz0);
  vec4 ixy1 = permute(ixy + iz1);

  vec4 gx0 = ixy0 * (1.0 / 7.0);
  vec4 gy0 = fract(floor(gx0) * (1.0 / 7.0)) - 0.5;
  gx0 = fract(gx0);
  vec4 gz0 = vec4(0.5) - abs(gx0) - abs(gy0);
  vec4 sz0 = step(gz0, vec4(0.0));
  gx0 -= sz0 * (step(0.0, gx0) - 0.5);
  gy0 -= sz0 * (step(0.0, gy0) - 0.5);

  vec4 gx1 = ixy1 * (1.0 / 7.0);
  vec4 gy1 = fract(floor(gx1) * (1.0 / 7.0)) - 0.5;
  gx1 = fract(gx1);
  vec4 gz1 = vec4(0.5) - abs(gx1) - abs(gy1);
  vec4 sz1 = step(gz1, vec4(0.0));
  gx1 -= sz1 * (step(0.0, gx1) - 0.5);
  gy1 -= sz1 * (step(0.0, gy1) - 0.5);

  vec3 g000 = vec3(gx0.x,gy0.x,gz0.x);
  vec3 g100 = vec3(gx0.y,gy0.y,gz0.y);
  vec3 g010 = vec3(gx0.z,gy0.z,gz0.z);
  vec3 g110 = vec3(gx0.w,gy0.w,gz0.w);
  vec3 g001 = vec3(gx1.x,gy1.x,gz1.x);
  vec3 g101 = vec3(gx1.y,gy1.y,gz1.y);
  vec3 g011 = vec3(gx1.z,gy1.z,gz1.z);
  vec3 g111 = vec3(gx1.w,gy1.w,gz1.w);

  vec4 norm0 = taylorInvSqrt(vec4(dot(g000, g000), dot(g010, g010), dot(g100, g100), dot(g110, g110)));
  g000 *= norm0.x;
  g010 *= norm0.y;
  g100 *= norm0.z;
  g110 *= norm0.w;
  vec4 norm1 = taylorInvSqrt(vec4(dot(g001, g001), dot(g011, g011), dot(g101, g101), dot(g111, g111)));
  g001 *= norm1.x;
  g011 *= norm1.y;
  g101 *= norm1.z;
  g111 *= norm1.w;

  float n000 = dot(g000, Pf0);
  float n100 = dot(g100, vec3(Pf1.x, Pf0.yz));
  float n010 = dot(g010, vec3(Pf0.x, Pf1.y, Pf0.z));
  float n110 = dot(g110, vec3(Pf1.xy, Pf0.z));
  float n001 = dot(g001, vec3(Pf0.xy, Pf1.z));
  float n101 = dot(g101, vec3(Pf1.x, Pf0.y, Pf1.z));
  float n011 = dot(g011, vec3(Pf0.x, Pf1.yz));
  float n111 = dot(g111, Pf1);

  vec3 fade_xyz = fade(Pf0);
  vec4 n_z = mix(vec4(n000, n100, n010, n110), vec4(n001, n101, n011, n111), fade_xyz.z);
  vec2 n_yz = mix(n_z.xy, n_z.zw, fade_xyz.y);
  float n_xyz = mix(n_yz.x, n_yz.y, fade_xyz.x); 
  return 2.2 * n_xyz;
}


vec3 fbm_vec3(vec3 p, float frequency, float offset)
{
  return vec3(
    cnoise((p+vec3(offset))*frequency),
    cnoise((p+vec3(offset+20.0))*frequency),
    cnoise((p+vec3(offset-30.0))*frequency)
  );
}

`,hdt=`
  #ifdef USE_COLLIDER
    float restitution = max(uBounce * 2., .01); // Energy Loss
    // SPHERE COLLIDER
    // **************************************************************
    #ifdef USE_SPHERE_COLLIDER       
      // Convert collider size to radii (assuming uColliderSize is the diameter in each axis)
      vec3 radii = uColliderSize;
      // Adjust position relative to collider
      vec3 relPos = position - uColliderPos;
      // Apply rotation of the collider to the relative position
      relPos = applyQuaternionToVector(uColliderQuaternionInvert, relPos);            
      // Scale relative position by radii (for ellipsoid collision detection)
      vec3 scaledPos = relPos / radii;
      // Calculate ellipsoidal distance
      float dist = length(scaledPos); // Distance in terms of ellipsoid
      
      // Check for collision
      if (dist <= 1. + particleSize / length(radii) && collisionFlag == 0.0) {
          // Compute the normal at the collision point, accounting for particle size
        vec3 adjustedPos = scaledPos * (1.0 + particleSize / length(radii));          
        // Compute the normal at the collision point
        vec3 normal = ellipsoidNormal(adjustedPos, radii);
        // Rotate the normal back to world space
        normal = applyQuaternionToVector(uColliderQuaternion, normal);
        // Reflect the velocity vector off the normal
        velocity = reflect(velocity, normal) * restitution;

        collisionFlag = 1.0;
      } else {
        collisionFlag = 0.0;
      }
    #endif

    // BOX COLLIDER or PLANE COLLIDER 
    // **************************************************************
    #ifdef USE_BOX_COLLIDER
      // Box dimensions and repulsion variables
      vec3 boxHalfSize = uColliderSize / 2.0;
      // Convert world position to box's local space
      vec3 localPos = applyQuaternionToVector(uColliderQuaternionInvert, position - uColliderPos);      
      // Collision detection
      vec3 localDistance = abs(localPos) - boxHalfSize;
      float distToSurface = max(localDistance.x, max(localDistance.y, localDistance.z));    

      // Collision Detected
      if (distToSurface <= particleSize * 0.5 && collisionFlag == 0.0) {      
        // Find the nearest face normal for bounce direction
        vec3 normal;
        if (localDistance.x > localDistance.y && localDistance.x > localDistance.z) {
            normal = vec3(sign(localPos.x), 0.0, 0.0);
        } else if (localDistance.y > localDistance.z) {
            normal = vec3(0.0, sign(localPos.y), 0.0);
        } else {
            normal = vec3(0.0, 0.0, sign(localPos.z));
        }            
        // Rotate normal back to world space
        normal = applyQuaternionToVector(uColliderQuaternion, normal);      
        // Reflect velocity and apply repulsion force
        velocity = reflect(velocity, normal) * restitution;
        
        collisionFlag = 1.0;
      } else {
        collisionFlag = 0.0;
      }
    #endif      
  #endif      
  // END COLLIDER    
`,ddt=`
  #ifdef USE_ATTRACTOR

      #ifdef USE_SPHERE_COLLIDER      
        // Convert collider size to radii (assuming uColliderSize is the diameter in each axis)
        vec3 radii = uColliderSize;
        // Adjust position relative to collider
        vec3 relPos = position - uColliderPos;
        // Apply rotation of the collider to the relative position
        relPos = applyQuaternionToVector(uColliderQuaternionInvert, relPos);            
        // Scale relative position by radii (for ellipsoid collision detection)
        vec3 scaledPos = relPos / radii;
        // Calculate ellipsoidal distance
        float distToSurface = length(scaledPos); // Distance in terms of ellipsoid
        float insideCheck = 1.0;

      #endif


      #ifdef USE_BOX_COLLIDER
        // Box dimensions
        vec3 boxHalfSize = uColliderSize / 2.0;
        // Convert world position to box's local space
        vec3 localPos = applyQuaternionToVector(uColliderQuaternionInvert, position - uColliderPos);      
        vec3 localDistance = abs(localPos) - boxHalfSize;
        float distToSurface = max(localDistance.x, max(localDistance.y, localDistance.z));
        float insideCheck = particleSize;
      #endif      
  
      // Apply vortex force inside the Helper
      #ifdef USE_FORCE_LOCAL_SPACE
        if (distToSurface <= insideCheck ) {    
            // Define parameters for the attractor field
            #ifdef USE_SPHERE_COLLIDER      
              float attractorStrength = (1.0 - distToSurface ) * uForceIntensity; // Adjust as needed
            #endif

            #ifdef USE_BOX_COLLIDER
              float attractorStrength = max((1.0 - insideCheck / distToSurface), 0.) * uForceIntensity; // Adjust as needed
              #endif

            float attractorDamping = uForceDamping;  // Adjust as needed (higher values will attenuate velocity more)
          
            // Use the same radii calculation code as for the collider
            vec3 attractorRadii = uColliderSize;
            // Adjust position relative to attractor center
            vec3 relPos = position - uColliderPos;
            // Apply rotation of the collider to the relative position
            relPos = applyQuaternionToVector(uColliderQuaternionInvert, relPos);            
            // Scale relative position by radii (for ellipsoid attraction)
            vec3 scaledPos = relPos / attractorRadii;

            // Calculate ellipsoidal distance as attractor radius
            float attractorRadius = length(scaledPos);
            // Calculate the distance from the attractor center
            vec3 relativePosition = position - uColliderPos;
            // Calculate the force vector towards the attractor center
            vec3 attractorForce = normalize(relativePosition) * attractorStrength;
            // Apply the attractor force to the particle
            velocity -= attractorForce;
            // Attenuate the particle's velocity
            velocity *= attractorDamping;
        }
      #else 
            // Calculate the distance from the attractor center
            vec3 relativePosition = position - uColliderPos;
            // Calculate the force vector towards the attractor center
            vec3 attractorForce = normalize(relativePosition) * uForceIntensity;
            // Apply the attractor force to the particle
            velocity -= attractorForce;
            // Attenuate the particle's velocity
            velocity *= uForceDamping;
      #endif    
  #endif      
`,fdt=`
  #ifdef USE_VORTEX
    // Box dimensions
    vec3 boxHalfSize = uColliderSize / 2.0;
    // Convert world position to box's local space
    vec3 localPos = applyQuaternionToVector(uColliderQuaternionInvert, position - uColliderPos);      
    vec3 localDistance = abs(localPos) - boxHalfSize;
    float distToSurface = max(localDistance.x, max(localDistance.y, localDistance.z));

    // Apply vortex force inside the box
    if (distToSurface <= particleSize) {
      float vortexStrength = uForceIntensity;
      vec3 localTopCenter = vec3(0.0, 0., 0.0);

      // Transform the local top center to the world space
      vec3 vortexCenter = uColliderPos + applyQuaternionToVector(uColliderQuaternion, localTopCenter);
      // Calculate the vector from particle to vortex center
      vec3 vortexVector = vortexCenter - position;

      // Calculate the rotation axis from the inverse of the collider's quaternion and the fixed up vector
      // Note: important to add a tiny z component to the up vector to avoid instability
      vec3 upVector = vec3(0.0, 1.0, 0.01);
      vec3 rotationAxis = cross(upVector, applyQuaternionToVector(uColliderQuaternion, vortexVector));
      rotationAxis = normalize(rotationAxis);

      // Add rotational component to velocity
      float rotationSpeed = length(vortexVector * vortexStrength * 3.0) ; 

      vec3 rotationVelocity = rotationAxis * rotationSpeed;
      // velocity += rotationVelocity * 0.005 ;
      velocity = rotationVelocity * 0.005 ;

      // Calculate vortex force
      // vec3 vortexForce = normalize(vortexVector) * uSpeed * .1 ;
      // Apply the vortex force to the particle
      vec3 originDirection = applyQuaternionToVector(uWorldQuaternion, directions);
      velocity += applyForce( originDirection * uSpeed * (1. - uForceDamping) , mass * .5);
    }
  #endif      
`,pdt=`
// uniform sampler2D uCurrentPosition; // Pass in the variable from GPGPU
// uniform sampler2D uCurrentVelocity; // Pass in the variable from GPGPU
// uniform sampler2D uCurrentEmissionRate; // Pass in the variable from GPGPU
uniform sampler2D uOriginalPosition;
uniform sampler2D uDirections;     
uniform vec3 uDirectionsAxis;
uniform vec4 uWorldQuaternion;
uniform vec3 uGravity;        
uniform float uNoiseStrength;     // Variation of the noise
uniform float uNoiseScale;        // Scale of the noise
uniform float uNoiseSeed;         // Seed of the noise
uniform float particleSize;
uniform float uSpeed;     // update speed of the particles
uniform float uRandomMassFactor;

// COLLIDER
uniform vec3 uColliderPos;                // Collider Position
uniform vec3 uColliderSize;               // Collider Dimension
uniform vec4 uColliderQuaternion;         // Collider Rotation
uniform vec4 uColliderQuaternionInvert;   // Collider Rotation
uniform float uBounce;                    // Bounce factor
uniform float uForceDamping;
uniform float uForceIntensity;


`+udt+`
float rand(vec2 co){
    return fract(sin(dot(co, vec2(12.9898, 78.233))) * 43758.5453);
}
vec3 applyQuaternionToVector( vec4 q, vec3 v ){
    return v + 2.0 * cross( q.xyz, cross( q.xyz, v ) + q.w * v );
 } 
vec3 applyForce(vec3 force, float mass) {
  vec3 acceleration = force / mass;
  
  return acceleration;
}

vec4 conjugate(vec4 q) {
  return vec4(q.w, -q.x, -q.y, -q.z);
}

// Function to compute the normal of the ellipsoid at a given point
vec3 ellipsoidNormal(vec3 p, vec3 radii) {
  return normalize(p / (radii * radii));
}

float friction = .3;

void main() {
    vec2 vUv = gl_FragCoord.xy / resolution.xy;
    vec3 position = texture2D( uCurrentPosition, vUv ).xyz;
    vec3 originalPosition = texture2D( uOriginalPosition, vUv ).xyz;
    float timeLeft = texture2D( uCurrentPosition, vUv ).w;
    vec3 directions = texture2D( uDirections, vUv ).xyz;    
    vec3 velocity = texture2D( uCurrentVelocity, vUv ).xyz;
    float mass = rand(originalPosition.xy) * 0.5 + 0.5;
    float isSpawning = texture2D( uCurrentEmissionRate, vUv ).x;        // 1. = spawning, 0. = not spawning
    float isActive = texture2D( uCurrentEmissionRate, vUv ).y;          // 1. = active, 0. = not active
    float collisionFlag =texture2D( uCurrentVelocity, vUv ).w;          // Indicate collision

    // Randomness Mass
    mass = (1.0 - (uRandomMassFactor * mass));
    
    if (isActive == 1.0) {
      // **************************************************************
      // FORCES NOISES
      // **************************************************************
      #ifdef USE_CURL_NOISE
        if (uNoiseScale > 0.0 ) {
          velocity = curlNoise(position * uNoiseScale * .002, uNoiseSeed) * ( uNoiseStrength + 1.0) * .05 * uSpeed;
        }
        // Variation of the noise Over Time
        if (uNoiseStrength > 0.0 && uNoiseScale == 0.0 ) {
          velocity += curlNoise( position, uNoiseSeed)  * uNoiseStrength * 0.05 * uSpeed;
        }
      #endif
      // **************************************************************
      #ifdef USE_SIMPLEX_NOISE
        if (uNoiseScale > 0.0 ) {
          velocity = vec3(snoise(position * uNoiseScale * .001) * ( uNoiseStrength + 1.0) * .1);
          velocity *= uSpeed;
        }
        // Variation of the noise Over Time
        if (uNoiseStrength > 0.0 && uNoiseScale == 0.0) {
          velocity += vec3(snoise(position * uNoiseStrength * .001) * .05 * uSpeed);
        }
      #endif
      // ************************************************************** 
      #ifdef USE_FBM_NOISE
        if (uNoiseScale > 0.0 ) {
          velocity = fbm_vec3(position * uNoiseScale * .001, ( uNoiseStrength + 1.0), uNoiseSeed);
          velocity *= uSpeed;
        }
        // Variation of the noise Over Time
        if (uNoiseStrength > 0.0 && uNoiseScale == 0.0 ) {      
          velocity += fbm_vec3(position * uNoiseStrength * .001, ( uNoiseStrength + 1.0), uNoiseSeed) * .1 * uSpeed;
        }
      #endif

      // COLLIDER
      ${hdt}
      // ATTRACTION
      ${ddt}  
      // VORTEX
      ${fdt}
    } 
    // End isActive

    // SPAWN BIRTH 
    // **************************************************************
    // if (isSpawning == 1.)
    #ifdef USE_NORMALS
      velocity = mix(velocity, applyQuaternionToVector(uWorldQuaternion, directions) * uSpeed, isSpawning);
    #else
      velocity = mix(velocity, applyQuaternionToVector(uWorldQuaternion, uDirectionsAxis) * uSpeed, isSpawning);    
    #endif
    
    // if (collisionFlag == 0.0)
    velocity += applyForce(uGravity, mass * .5) * (1.0 - collisionFlag);

    gl_FragColor = vec4(velocity, collisionFlag);
}
`,xme=`

  // Linear Fade In
  float linearFadeIn(float t) {
    return t;
  }


  // linear fade out
  float linearFadeOut(float t) {
    return 1.0 - t;
  }
  
  float linearInOut(float t) {
    return t < 0.5 ? t :  (1.0 - t);  
  }

    // lerp
    float lerp(float a, float b, float t) {
      return a + (b - a) * t;
    }

  // Ease In Out Quart
  float exponentialInOut(float t) {
    return t < 0.4 ? lerp(0.0, 1.0, t / 0.4) :
    t > 0.6 ? lerp(1.0, 0.0, (t - 0.6) / 0.4) :
    1.0;
   }

  // constant
  float constant(float t) {
    return 1.0;
  } 
`,mdt=`

float rand(vec3 co){
  return fract(sin(dot(co.xy ,vec2(12.9898,78.233))) * 43758.5453);
}

vec3 applyQuaternionToVector( vec4 q, vec3 v ){
  return v + 2.0 * cross( q.xyz, cross( q.xyz, v ) + q.w * v );
}

vec3 applyForce(vec3 force, float mass) {
  vec3 acceleration = force / mass;
    
  return acceleration;
}
`,gdt=`
vec3 rgb2xyz (in vec3 rgb) {
    float r = rgb.r;
	float g = rgb.g;
	float b = rgb.b;

	r = r > 0.04045 ? pow(((r + 0.055) / 1.055), 2.4) : (r / 12.92);
	g = g > 0.04045 ? pow(((g + 0.055) / 1.055), 2.4) : (g / 12.92);
	b = b > 0.04045 ? pow(((b + 0.055) / 1.055), 2.4) : (b / 12.92);

	float x = (r * 0.4124) + (g * 0.3576) + (b * 0.1805);
	float y = (r * 0.2126) + (g * 0.7152) + (b * 0.0722);
	float z = (r * 0.0193) + (g * 0.1192) + (b * 0.9505);
    
    vec3 xyz = vec3(
        (r * 0.4124) + (g * 0.3576) + (b * 0.1805) * 100.0,
        (r * 0.2126) + (g * 0.7152) + (b * 0.0722) * 100.0,
        (r * 0.0193) + (g * 0.1192) + (b * 0.9505) * 100.0
    );
    return(xyz);
}

vec3 xyz2lab (in vec3 xyz) {
	float x = xyz.x / 95.047;
	float y = xyz.y / 100.0;
	float z = xyz.z / 108.883;

	x = x > 0.008856 ? pow(x, 1.0 / 3.0) : (7.787 * x) + (16.0 / 116.0);
	y = y > 0.008856 ? pow(y, 1.0 / 3.0) : (7.787 * y) + (16.0 / 116.0);
	z = z > 0.008856 ? pow(z, 1.0 / 3.0) : (7.787 * z) + (16.0 / 116.0);

    vec3 lab = vec3((116.0 * y) - 16.0, 500.0 * (x - y), 200.0 * (y - z));
    return(lab);
}

vec3 rgb2lab(in vec3 rgb) {
    vec3 xyz = rgb2xyz(rgb);
    vec3 lab = xyz2lab(xyz);
    return(lab);
}

vec3 xyz2rgb (in vec3 xyz) {
	float x = xyz.x / 100.0;
	float y = xyz.y / 100.0;
	float z = xyz.z / 100.0;
	
    
	float r = (x *  3.2406) + (y * -1.5372) + (z * -0.4986);
	float g = (x * -0.9689) + (y *  1.8758) + (z *  0.0415);
	float b = (x *  0.0557) + (y * -0.2040) + (z *  1.0570);

	r = r > 0.0031308 ? ((1.055 * pow(r, 1.0 / 2.4)) - 0.055) : r * 12.92;
	g = g > 0.0031308 ? ((1.055 * pow(g, 1.0 / 2.4)) - 0.055) : g * 12.92;
	b = b > 0.0031308 ? ((1.055 * pow(b, 1.0 / 2.4)) - 0.055) : b * 12.92;

	r = min(max(0.0, r), 1.0);
	g = min(max(0.0, g), 1.0);
	b = min(max(0.0, b), 1.0);

	return(vec3(r, g, b));
}

vec3 lab2xyz (in vec3 lab) {
    float l = lab.x;
	float a = lab.y;
	float b = lab.z;

  	float y = (l + 16.0) / 116.0;
	float x = a / 500.0 + y;
	float z = y - b / 200.0;

	float y2 = pow(y, 3.0);
	float x2 = pow(x, 3.0);
	float z2 = pow(z, 3.0);

  	y = y2 > 0.008856 ? y2 : (y - 16.0 / 116.0) / 7.787;
	x = x2 > 0.008856 ? x2 : (x - 16.0 / 116.0) / 7.787;
	z = z2 > 0.008856 ? z2 : (z - 16.0 / 116.0) / 7.787;

	x *= 95.047;
	y *= 100.0;
	z *= 108.883;

	return(vec3(x, y, z));
}
vec3 lab2rgb (in vec3 lab) {
    vec3 xyz = lab2xyz(lab);
    vec3 rgb = xyz2rgb(xyz);
    return(rgb);
}

`,vdt=`
  uniform sampler2D uPosition;
  uniform float uSize;
  uniform float uSizeEnd;
  uniform vec3 uWorldOffset;
  uniform vec4 uWorldQuaternion;
  // Billboard Behavior - Currently at Zero, but we can change that
  uniform float uRotation;
  uniform float uRotationEnd;
  uniform vec2 center;

  // Randomness
  uniform float uRandScaleFactor;
  uniform float uRandRotationFactor;

  attribute vec2 ref;

  varying float v_LifeLeft;    // normalized lifetime 1 to 0
  varying vec2 vUv;
  varying vec2 vRef;

  ${mdt}
  ${xme}
`,ydt=({easeSize:t="linearFadeOut"})=>`
  vUv = uv;  
  vRef = ref;
  // Normalized LifeTime 1 to 0
  float lifeLeft = texture2D(uPosition, ref).w;
  v_LifeLeft = lifeLeft;
  // Position From DataTexture Simulation
  vec3 pos = texture2D(uPosition, ref).rgb - uWorldOffset;
  // Apply World Quaternion
  pos = applyQuaternionToVector(uWorldQuaternion, pos);  
            
  #ifdef  USE_SIZE_END
    // Scaled Over Time
    float t = 1. - lifeLeft;
    float currentSize = mix(uSize, uSizeEnd, t); // Linearly interpolate between uSize and uSizeEnd
    vec3 scaledPosition = position * vec3(currentSize);
  #else
    // Change Size Behavior over LifeTime
    float easeSize = ${t}(1. - lifeLeft);
    // Scaled Over Time
    vec3 scaledPosition = position * vec3(uSize * easeSize);
  #endif

  // Billboard Behavior
  vec2 scale;
  scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );
  scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );    
  // Randomness 
  float randRef = rand(ref);
  scale *= (1.0 - (uRandScaleFactor * randRef));
  // Rotation
  float randRotation =  2.0 * PI * ( uRandRotationFactor * randRef);
  float originalRotation = (1.0 - uRotation) * 2.0 * PI;
  float originalRotationEnd = (1.0 - uRotationEnd) * 2.0 * PI;
  // OverTime
  float finalRotation = mix(originalRotation + randRotation, originalRotationEnd + randRotation, lifeLeft);

  vec2 alignedPosition = ( scaledPosition.xy - ( center - vec2( 0.5 ) ) ) * scale;
  vec2 rotatedPosition;
  rotatedPosition.x = cos( finalRotation ) * alignedPosition.x - sin( finalRotation ) * alignedPosition.y;
  rotatedPosition.y = sin( finalRotation ) * alignedPosition.x + cos( finalRotation ) * alignedPosition.y;
  
  mat4 instanceMatrix = mat4(
    vec4(1.0, 0.0, 0.0, 0.0),
    vec4(0.0, 1.0, 0.0, 0.0),
    vec4(0.0, 0.0, 1.0, 0.0),
    vec4(pos.x, pos.y, pos.z, 1.0)
  );  

  mvPosition = modelViewMatrix * instanceMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );
  mvPosition.xy += rotatedPosition;
  gl_Position = projectionMatrix  * mvPosition;   
`,xdt=`
  uniform vec4 uColor;                // start color
  uniform vec4 uColor2;               // end color
  uniform sampler2D uTexture;         // texture
  varying float v_LifeLeft;   // normalized lifetime 1 to 0
  varying vec2 vUv;
  varying vec2 vRef;

  float random(vec2 co) {
    return fract(sin(dot(co.xy, vec2(12.9898, 78.233))) * 43758.5453);
  }
  `+xme+`  
  ${gdt}

`,bdt=({easeOpacity:t="linearFadeOut"})=>`  
  // if Particle is dead, hide it
  if (v_LifeLeft <= 0.005 ) {
    discard;
  }

  #ifdef USE_RANDOM_COLORING
    float randVal = random(vRef); // Generate a random value based on the reference
    vec4 color = mix(uColor, uColor2, randVal); // Interpolate between the two colors
  #else
    vec4 color = mix(uColor, uColor2, 1. - v_LifeLeft);
  #endif

  // Opacity over Life Time
  float finalAlpha = ${t}(1. - v_LifeLeft);  
  vec4 textureColor = texture2D(uTexture, vUv).rgba; 
  finalColor = textureColor.rgb * color.rgb;
  finalAlpha = color.a * textureColor.a * finalAlpha;
  
  gl_FragColor = vec4(finalColor, finalAlpha);     

`,wdt=class extends Tr{constructor(t,e){super(),this.needsJitter=!0,this.type="ParticleMaterial",this.easeOpacity="linearFadeIn",this.easeSize="linearFadeIn",this.useSizeEnd=!1,this.isColoringRandom=!1,this.init(t,e),this.context=e}reset(){}init(t,e){this.transparent=!0,this.depthTest=!0,this.depthWrite=!1,this.easeOpacity=t.ease,this.easeSize=t.easeSize,this.layers=[],da.startContext(da.globalContext),this.lightLayer=new xd(0,"",{...Ba.defaultData("light","phong"),visible:!1},new l8,{},e.shared),da.endContext(da.globalContext),this.build()}updateState(t){t.coloring!==void 0&&(this.isColoringRandom=t.coloring==="random"),t.color!==void 0&&(t.color instanceof Array?this.uniforms.uColor.value=t.color:this.uniforms.uColor.value=this.context.shared.color(t.color)),t.color2!==void 0&&(t.color2 instanceof Array?this.uniforms.uColor2.value=t.color2:this.uniforms.uColor2.value=this.context.shared.color(t.color2)),t.size!==void 0&&(this.uniforms.uSize.value=t.size[0],this.uniforms.uSizeEnd.value=t.size[1],t.size[0]!==t.size[1]?this.useSizeEnd=!0:this.useSizeEnd=!1),t.ease!==void 0&&(this.easeOpacity=t.ease,this.build()),t.easeSize!==void 0&&(this.easeSize=t.easeSize,this.build()),this.needsUpdate=!0}onBeforeCompile(t){this.build(),t.defines=this.defines,t.uniforms=this.uniforms,t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader}build(){let t=new xpe;return t.needsJitter=this.needsJitter,t.addFragmentParsCode(tot),t.buildShader("vertex",this.fragment),t.buildShader("fragment",this.fragment),t.addFragmentFinalCode(iot),this.isColoringRandom&&t.define("USE_RANDOM_COLORING"),this.useSizeEnd&&t.define("USE_SIZE_END"),t.addVertexParsCode(vdt),t.addFragmentParsCode(xdt),t.addVertexFinalCode(ydt({easeSize:this.easeSize})),t.addFragmentFinalCode(bdt({easeOpacity:this.easeOpacity})),this.vertexShader=t.getCode("vertex"),this.fragmentShader=t.getCode("fragment"),this.defines=t.defines,this.uniforms={...t.uniforms,...this.uniforms},this.extensions=t.extensions,this}get nodeMaterial(){return this}get fragment(){return this.lightLayer.node}getDefines(){return this.defines}nodeMaterialDispose(){this.layers.forEach(t=>t.dispose()),super.dispose()}},u4=class{constructor(t,e,i,r){this.type="SphereEmitterShape",this.targetMesh=void 0,this.size=t,this.type=i,this.textureSize=sdt(e);let n=1;this.targetMesh=r?.geometry.type==="BufferGeometry"||r?.type==="Mesh"&&r&&r.geometry.hasAttribute("position")&&r.geometry.hasAttribute("normal")?r:this.getMesh(i,n);let{positions:s,dataTexture:a,dataTextureNormals:o}=this.createPositions(this.textureSize,this.targetMesh??this.getMesh(i,n));this.positionsTexture=a,this.positionsAttribute=s,this.directionsTexture=o}createPositions(t,e){let{positions:i,normals:r}=adt(e,t*t),n=uie(i,t),s=uie(r,t);return{dataTexture:n,positions:i,dataTextureNormals:s}}getMesh(t,e){let i=null;switch(t){case"SphereEmitterShape":{i=new a1(e*.5,32,32);break}case"TorusEmitterShape":{i=new Ohe(e*.5,.3,15,40);break}case"ConeEmitterShape":{i=new QH(e,e,15);break}case"BoxEmitterShape":{i=new Oh(e,e,e);break}case"PlaneEmitterShape":{i=new ef(e,e),i.rotateX(-Math.PI/2);break}case"MeshEmitterShape":{i=new a1(e,32,32);break}default:{i=new a1(e,32,32);break}}return new En(i,new Xp({color:16711680}))}applyToShader(t,e){this.size=new W().fromArray(e.size),t.uEmitterSize.value=this.size}dispose(){this.positionsTexture.dispose(),this.directionsTexture.dispose(),this.positionsAttribute=new Float32Array}};function Dw(t){let e={...t},i=p3.defaultData;e.forceFieldObjectId&&(e.colliderEntityId=e.forceFieldObjectId);let r={...i.shape,...e.shape},n={...i.renderMaterial,...e.renderMaterial};return{...i,...e,shape:r,renderMaterial:n}}var _dt=`
// uniform sampler2D uCurrentPosition; // Pass in the variable from GPGPU
// uniform sampler2D uCurrentVelocity; // Pass in the variable from GPGPU
// uniform sampler2D uCurrentEmissionRate; // Pass in the variable from GPGPU

uniform sampler2D uIndex; // Texture with corresponding index
uniform float uLastIndexEmitted; // Last emitted index
uniform float uParticlesToEmit; // Number of particles to emit on that frame
uniform float uTime;

void main() {
    vec2 vUv = gl_FragCoord.xy / resolution.xy;
    float particleIndex = texture(uIndex, vUv).x;
    float timeLeft = texture2D( uCurrentPosition, vUv ).w;
    float isActive = texture2D( uCurrentEmissionRate, vUv ).g;    // 1. = active, 0. = not active
    float timeStart = texture2D( uCurrentEmissionRate, vUv ).b;


    // ********** Detect Colision to Create a flag and use it in position **********
    // We are doing this here, so

    // ********** Emit Particles **********
    // X = isSpawning 0.0 or 1.0
    // Y = isActive 0.0 or 1.0
    // Check if the vertex index is between the first value and the last value
    // if (particleIndex >= uLastIndexEmitted && particleIndex < uLastIndexEmitted + uParticlesToEmit) {
    //     // Emit a particle by writing 1 to the red channel of the color output
    //     // r: 1. == emit the particle
    //     // g: 1. == particle is now active
    //     timeStart = uTime;
    //     gl_FragColor = vec4(1.0, 1.0, timeStart, 1.0);
    // } else {
    //     // The Particle is either already emitted or not in the range of the particles to emit
    //     // Do not emit a particle by writing 0 to the red channel of the color output        
    //     gl_FragColor = vec4(0.0, isActive, timeStart, 1.0);
    // }
    // Determine if the particle is within the emission range
    float emitLowerBound = step(uLastIndexEmitted, particleIndex);
    float emitUpperBound = step(particleIndex, uLastIndexEmitted + uParticlesToEmit - 1.0);
    float emitParticle = emitLowerBound * emitUpperBound; // 1.0 if in range, 0.0 otherwise

    // Set timeStart and color
    timeStart = mix(timeStart, uTime, emitParticle);
    gl_FragColor = vec4(emitParticle, mix(isActive, 1.0, emitParticle), timeStart, 1.0);


}
`,h4=10,Sdt=class extends tn{constructor(t,e){super(),this.type="ParticleEmitter",this.debugMode=!1,this.worldSpace=!0,this.rootObject=null,this.gpuCompute=null,this.positionSimRT=null,this.velocitySimRT=null,this.emissionRateSimRT=null,this.emitterShape=void 0,this.isEmitting=!1,this.hasBeenReset=!1,this.emittedParticlesAmount=0,this.lastEmitTime=0,this.globalTime=0,this.targetFPS=60,this.previousRatio=1,this.lerpFactor=.4,this.particlesAmount=0,this.noiseStrength=0,this.noiseScale=0,this.isBillboardBased=!0,this.simFeaturesDefinition={USE_COLLIDER:!1,USE_ATTRACTOR:!1,USE_VORTEX:!1,USE_SPHERE_COLLIDER:!1,USE_BOX_COLLIDER:!1,USE_FORCE_LOCAL_SPACE:!1,USE_NORMALS:!1,USE_CURL_NOISE:!0,USE_SIMPLEX_NOISE:!1,USE_FBM_NOISE:!1},this.textureLoader=new z7e,this.currentWorldPosition=new W,this.systemQuaternion=new Ii,this.worldGravity=new W(0,0,0),this.directionAxis=new W(0,0,0),this.colliderV3=new W(0,0,0),this.colliderQuaternion=new Ii(0,0,0,1),this.matrixAutoUpdate=!0,this.renderer=t,this.system=e,this.shared=e.context.shared;let i=e.data;this.material=new wdt(i.renderMaterial,e.context),this.material.uniforms={uSize:{value:0},uSizeEnd:{value:0},uColor:{value:i.renderMaterial.color},uColor2:{value:i.renderMaterial.color2},uPosition:{value:new W(0,0,0)},uEmissionData:{value:new W(0,0,0)},uTexture:{value:this.defaultTexture},uWorldOffset:{value:new W(0,0,0)},uWorldQuaternion:{value:new Ui(0,0,0,1)},uRandScaleFactor:{value:i.randomScale??0},uRandRotationFactor:{value:i.randomRotation??0},uRotation:{value:i.renderMaterial.spriteRotation[0]??0},uRotationEnd:{value:i.renderMaterial.spriteRotation[1]??0}},this.setTexture(this.material.uniforms,i.renderMaterial.texture),this.init(i)}setTexture(t,e){let i=e.data;if(typeof e=="string"){let r=this.shared.image(e),n=new Kn(r.img);n.needsUpdate=!0,t.uTexture.value=n;return}if(typeof i!="string"){let r=new Image;r.onload=()=>{let a=new Kn(r);a.needsUpdate=!0,t.uTexture.value=a};let n=new Blob([i],{type:"image/*"}),s=URL.createObjectURL(n);r.src=s}}updateGeometryAttributes(t,e){let i=ndt(e);!this.emitterShape?.positionsAttribute||t.geometry.setAttribute("ref",new PM(i,2))}applyWorldSpace(){if(!this.system.started||!this.worldSpace||!this.positionSimRT||!this.velocitySimRT)return;let t=this.system;t.getWorldQuaternion(this.systemQuaternion),this.systemQuaternion.invert(),t.getWorldPosition(this.currentWorldPosition),this.material.uniforms.uWorldOffset.value=this.currentWorldPosition,this.material.uniforms.uWorldQuaternion.value.copy(this.systemQuaternion.normalize()),this.positionSimRT.material.uniforms.uWorldOffset.value=this.currentWorldPosition,this.systemQuaternion.invert(),this.positionSimRT.material.uniforms.uWorldQuaternion.value.copy(this.systemQuaternion.normalize()),this.velocitySimRT.material.uniforms.uWorldQuaternion.value.copy(this.systemQuaternion.normalize())}update(t,e){if(!this.gpuCompute||!this.positionSimRT||!this.velocitySimRT||!this.emissionRateSimRT||this.hasBeenReset)return;if(this.checkIfAllParticlesAreDead()&&!this.hasBeenReset){this.reset();return}this.applyWorldSpace(),this.globalTime=t,this.positionSimRT.material.uniforms.uTime.value=t,this.emissionRateSimRT.material.uniforms.uTime.value=t;let i=1e3/e,r=this.targetFPS/i,n=this.previousRatio+(r-this.previousRatio)*this.lerpFactor;this.positionSimRT.material.uniforms.uFPSRatio.value=n,this.previousRatio=n;let s=this.isEmitting?this.GoEmitSomeParticles(t,this.system.data.birthRatePerSec):0;this.emissionRateSimRT.material.uniforms.uLastIndexEmitted.value=this.emittedParticlesAmount,this.emissionRateSimRT.material.uniforms.uParticlesToEmit.value=s,this.material.uniforms.uPosition.value=this.gpuCompute.getCurrentRenderTarget(this.positionSimRT)?.texture,this.system.colliderEntities.length>0&&this.renderColliders(),this.gpuCompute.compute()}renderColliders(){if(!this.velocitySimRT)return;let t=this.system.colliderEntities[0],e=this.simFeaturesDefinition.USE_COLLIDER||this.simFeaturesDefinition.USE_ATTRACTOR||this.simFeaturesDefinition.USE_VORTEX;if(t.destroyedInAction&&e&&this.init(Dw({...this.system.data,colliderEntityId:null})),!t||t.destroyedInAction)return;t.getWorldPosition(this.colliderV3),this.colliderV3.y===0&&(this.colliderV3.y=1e-4),this.velocitySimRT.material.uniforms.uColliderPos.value.copy(this.colliderV3);let i=t.data.size;this.colliderV3.fromArray(i),this.velocitySimRT.material.uniforms.uColliderSize.value.copy(this.simFeaturesDefinition.USE_SPHERE_COLLIDER?this.colliderV3.multiplyScalar(.5):this.colliderV3),t.getWorldQuaternion(this.colliderQuaternion),this.velocitySimRT.material.uniforms.uColliderQuaternion.value.copy(this.colliderQuaternion.normalize()),this.velocitySimRT.material.uniforms.uColliderQuaternionInvert.value.copy(this.colliderQuaternion.normalize().invert())}updateState(t){!this.velocitySimRT||!this.positionSimRT||(t.renderMaterial&&this.updateMaterialState(t.renderMaterial),this.updateParticleState(t))}updateVariableState(t,e){if(!this.velocitySimRT||!this.positionSimRT)return;e[2]==="size"&&this.material.updateState({size:[t,this.material.uniforms.uSizeEnd.value]}),e[2]==="sizeEnd"&&this.material.updateState({size:[this.material.uniforms.uSize.value,t]});let i=(r,n)=>{let s=[...this.system.data.shape.size];s[r]=n,this.updateParticleState({shape:{...this.system.data.shape,size:s}})};e[2]==="shape_size_0"&&i(0,t),e[2]==="shape_size_1"&&i(1,t),e[2]==="shape_size_2"&&i(2,t),e[2]==="speed"&&(this.velocitySimRT.material.uniforms.uSpeed.value=t/h4),e[2]==="gravity"&&this.worldGravity.set(0,t/100,0),e[2]==="noiseStrength"&&(this.noiseStrength=t,this.velocitySimRT.material.uniforms.uNoiseStrength.value=this.noiseStrength),e[2]==="noiseScale"&&(this.noiseScale=t,this.velocitySimRT.material.uniforms.uNoiseScale.value=this.noiseScale),e[2]==="direction_x"&&(this.directionAxis=this.getDirectionAxis([Number(t),this.system.data.direction[1],this.system.data.direction[2]])),e[2]==="direction_y"&&(this.directionAxis=this.getDirectionAxis([this.system.data.direction[0],Number(t),this.system.data.direction[2]])),e[2]==="direction_z"&&(this.directionAxis=this.getDirectionAxis([this.system.data.direction[0],this.system.data.direction[1],Number(t)]))}updateMaterialState(t){this.material.updateState({...t,size:t.size?[Number(this.shared.getVariable(t.size[0],[this.uuid,"particles","size"])),Number(this.shared.getVariable(t.size[1],[this.uuid,"particles","sizeEnd"]))]:[0,0]}),t.texture&&(this.setTexture(this.material.uniforms,t.texture),this.material.needsUpdate=!0)}updateParticleState(t){if(!(!this.positionSimRT||!this.velocitySimRT)){if(this.shouldReInitGPUCompute(t)&&this.init(Dw(this.system.data)),t.life!==void 0&&(this.positionSimRT.material.uniforms.uMaxLifeTime.value=t.life),t.speed!==void 0&&(this.velocitySimRT.material.uniforms.uSpeed.value=Number(this.shared.getVariable(t.speed,[this.uuid,"particles","speed"]))/h4),t.collisionBounce!==void 0&&(this.velocitySimRT.material.uniforms.uBounce.value=t.collisionBounce),t.noiseStrength!==void 0&&(this.noiseStrength=Number(this.shared.getVariable(t.noiseStrength,[this.uuid,"particles","noiseStrength"])),this.velocitySimRT.material.uniforms.uNoiseStrength.value=this.noiseStrength),t.noiseScale!==void 0&&(this.noiseScale=Number(this.shared.getVariable(t.noiseScale,[this.uuid,"particles","noiseScale"])),this.velocitySimRT.material.uniforms.uNoiseScale.value=this.noiseScale),t.noiseSeed!==void 0&&(this.velocitySimRT.material.uniforms.uNoiseSeed.value=t.noiseSeed),t.randomMass!==void 0&&(this.velocitySimRT.material.uniforms.uRandomMassFactor.value=t.randomMass),t.renderMaterial?.size!==void 0){let e=this.shared.getVariable(t.renderMaterial.size[0],[this.uuid,"particles","size"]);this.velocitySimRT.material.uniforms.particleSize.value=Number(e)}if(t.renderMaterial?.spriteRotation!==void 0&&(this.material.uniforms.uRotation.value=t.renderMaterial.spriteRotation[0],this.material.uniforms.uRotationEnd.value=t.renderMaterial.spriteRotation[1]),t.shape!==void 0){let e=t.shape.size??this.system.data.shape.size,i=[Number(this.shared.getVariable(e[0],[this.uuid,"particles","shape_size_0"])),Number(this.shared.getVariable(e[1],[this.uuid,"particles","shape_size_1"])),Number(this.shared.getVariable(e[2],[this.uuid,"particles","shape_size_2"]))],r={...Dw(this.system.data).shape,size:i};this.emitterShape?.applyToShader(this.positionSimRT.material.uniforms,r)}if(t.gravity!==void 0&&(this.worldGravity.set(0,Number(this.shared.getVariable(this.system.data.gravity,[this.uuid,"particles","gravity"]))/100,0),this.velocitySimRT.material.uniforms.uGravity={value:this.worldGravity}),t.direction!==void 0){let e=this.getDirectionFromVariable(t.direction);this.directionAxis=this.getDirectionAxis(e),this.velocitySimRT.material.uniforms.uDirectionsAxis.value=this.directionAxis}t.randomRotation!==void 0&&(this.material.uniforms.uRandRotationFactor.value=t.randomRotation),t.randomScale!==void 0&&(this.material.uniforms.uRandScaleFactor.value=t.randomScale)}}updateForceFieldParameters(t){!this.velocitySimRT||(t.forceIntensity!==void 0&&(this.velocitySimRT.material.uniforms.uForceIntensity.value=t.forceIntensity),t.forceDambing!==void 0&&(this.velocitySimRT.material.uniforms.uForceDamping.value=t.forceDambing))}getDirectionAxis(t){let e=[Number(t[0])*Ht.DEG2RAD,Number(t[1])*Ht.DEG2RAD,Number(t[2])*Ht.DEG2RAD],i=new xs(e[0],e[1],e[2],"XYZ");return this.directionAxis.set(0,1,0).applyEuler(i).normalize(),this.velocitySimRT&&(this.velocitySimRT.material.uniforms.uDirectionsAxis.value=this.directionAxis),this.directionAxis}shouldReInitGPUCompute(t){let{birthRatePerSec:e,rootObjectType:i,colliderEntityId:r,shape:n,emitTimeDuration:s,emitTimeCycle:a,life:o,directionMode:l,noiseType:c}=t;return e!==void 0||i!==void 0||r||r===null||a!==void 0||n!==void 0||o!==void 0||s!==void 0||l!==void 0||c!==void 0}init(t){this.dispose(),this.particlesAmount=this.getMaxParticlesAmount({birthRatePerSecond:t.birthRatePerSec,particleMaxLifeTime:t.life,loopDuration:t.emitTimeCycle==="infinity"?0:t.emitTimeDuration}),this.particlesAmount>1e5&&(console.warn("The maximum number of particles is limited to 100000."),this.particlesAmount=1e5),this.emitterShape=this.createShape(t.shape,this.particlesAmount);let e=setInterval(()=>{if(this.emitterShape)if(isNaN(this.emitterShape.positionsTexture.source.data.data[0])){this.init(t);return}else clearInterval(e)},100);if(!this.emitterShape)return;let i=new idt(this.emitterShape.textureSize,this.emitterShape.textureSize,this.renderer),r=this.updateSimulationDefinition(t),n=i.addVariable("uCurrentPosition",r+cdt,this.emitterShape.positionsTexture),s=i.addVariable("uCurrentVelocity",r+pdt,this.emitterShape.directionsTexture),a=i.addVariable("uCurrentEmissionRate",_dt,ldt(this.emitterShape.textureSize));i.setVariableDependencies(n,[n,s,a]),i.setVariableDependencies(s,[n,s,a]),i.setVariableDependencies(a,[n,s,a]);let o=odt({size:this.emitterShape.textureSize}),l={uOriginalPosition:{value:this.emitterShape.positionsTexture},uWorldOffset:{value:new W(0,0,0)},uWorldQuaternion:{value:new Ui(0,0,0,1)},uTime:{value:0},uFPSRatio:{value:1},uMaxLifeTime:{value:t.life},uEmitterSize:{value:new W(Number(this.shared.getVariable(t.shape.size[0],[this.uuid,"particles","shape_size_0"])),Number(this.shared.getVariable(t.shape.size[1],[this.uuid,"particles","shape_size_1"])),Number(this.shared.getVariable(t.shape.size[2],[this.uuid,"particles","shape_size_2"])))},particleSize:{value:0}};n.material.uniforms=l;let c=this.getDirectionFromVariable(t.direction);this.directionAxis=this.getDirectionAxis(c),this.worldGravity.set(0,Number(this.shared.getVariable(this.system.data.gravity,[this.uuid,"particles","gravity"]))/100,0),this.noiseStrength=Number(this.shared.getVariable(t.noiseStrength,[this.uuid,"particles","noiseStrength"])),this.noiseScale=Number(this.shared.getVariable(t.noiseScale,[this.uuid,"particles","noiseScale"]));let u=t.colliderEntityId&&this.system.getColliderData(t.colliderEntityId),h={uOriginalPosition:{value:this.emitterShape.positionsTexture},uDirections:{value:this.emitterShape.directionsTexture},uDirectionsAxis:{value:this.directionAxis},uWorldQuaternion:{value:new Ui(0,0,0,1)},uColliderPos:{value:new W(0,0,0)},uColliderSize:{value:new W(0,0,0)},uForceIntensity:{value:u?u.forceIntensity:0},uForceDamping:{value:u?u.forceDambing:0},uColliderQuaternion:{value:new Ui(0,0,0,1)},uColliderQuaternionInvert:{value:new Ui(0,0,0,1)},particleSize:{value:0},uGravity:{value:this.worldGravity},uNoiseStrength:{value:this.noiseStrength},uNoiseScale:{value:this.noiseScale},uNoiseSeed:{value:t.noiseSeed},uRandomMassFactor:{value:t.randomMass},uBounce:{value:t.collisionBounce},uSpeed:{value:Number(this.shared.getVariable(t.speed,[this.uuid,"particles","speed"]))/h4}};s.material.uniforms=h;let d={uIndex:{value:o},uTime:{value:0},uLastIndexEmitted:{value:0},uParticlesToEmit:{value:0}};a.material.uniforms=d;let f=[Number(this.shared.getVariable(t.shape.size[0],[this.uuid,"particles","shape_size_0"])),Number(this.shared.getVariable(t.shape.size[1],[this.uuid,"particles","shape_size_1"])),Number(this.shared.getVariable(t.shape.size[2],[this.uuid,"particles","shape_size_2"]))],p={...Dw(this.system.data).shape,size:f};this.emitterShape.applyToShader(n.material.uniforms,p),i.init(),this.gpuCompute=i,this.positionSimRT=n,this.velocitySimRT=s,this.emissionRateSimRT=a,this.rootObject=this.createPrimaryEmitter(this.emitterShape.textureSize),this.add(this.rootObject),this.material.needsUpdate=!0}getDirectionFromVariable(t){let e=Number(this.shared.getVariable(t[0],[this.uuid,"particles","direction_x"])),i=Number(this.shared.getVariable(t[1],[this.uuid,"particles","direction_y"])),r=Number(this.shared.getVariable(t[2],[this.uuid,"particles","direction_z"]));return[e,i,r]}updateSimulationDefinition(t){if(this.simFeaturesDefinition.USE_COLLIDER=!1,this.simFeaturesDefinition.USE_ATTRACTOR=!1,this.simFeaturesDefinition.USE_VORTEX=!1,this.simFeaturesDefinition.USE_SPHERE_COLLIDER=!1,this.simFeaturesDefinition.USE_BOX_COLLIDER=!1,this.simFeaturesDefinition.USE_FORCE_LOCAL_SPACE=!1,this.simFeaturesDefinition.USE_NORMALS=!1,this.simFeaturesDefinition.USE_CURL_NOISE=!1,this.simFeaturesDefinition.USE_SIMPLEX_NOISE=!1,this.simFeaturesDefinition.USE_FBM_NOISE=!1,t.colliderEntityId&&this.system.colliderEntities.length>0){let i=this.system.getColliderData(t.colliderEntityId);switch(i?.forceType){case"attractor":this.simFeaturesDefinition.USE_ATTRACTOR=!0;break;case"collider":this.simFeaturesDefinition.USE_COLLIDER=!0;break;case"vortex":this.simFeaturesDefinition.USE_VORTEX=!0;break}let r=i?.colliderType;r==="sphere"&&(this.simFeaturesDefinition.USE_SPHERE_COLLIDER=!0),r==="box"&&(this.simFeaturesDefinition.USE_BOX_COLLIDER=!0),i?.forceRange==="helper"&&(this.simFeaturesDefinition.USE_FORCE_LOCAL_SPACE=!0)}t.directionMode==="normals"&&(this.simFeaturesDefinition.USE_NORMALS=!0),t.noiseType==="curl"&&(this.simFeaturesDefinition.USE_CURL_NOISE=!0),t.noiseType==="simplex"&&(this.simFeaturesDefinition.USE_SIMPLEX_NOISE=!0),t.noiseType==="fbm"&&(this.simFeaturesDefinition.USE_FBM_NOISE=!0);let e="";for(let[i,r]of Object.entries(this.simFeaturesDefinition))r&&(e+=`#define ${i}
`);return e}createShape(t,e){this.emitterShape&&this.emitterShape.dispose();let i=new W(Number(this.shared.getVariable(t.size[0],[this.uuid,"particles","shape_size_0"])),Number(this.shared.getVariable(t.size[1],[this.uuid,"particles","shape_size_1"])),Number(this.shared.getVariable(t.size[2],[this.uuid,"particles","shape_size_2"])));if(t.type==="MeshEmitterShape"){let r=null;return this.system.context.scene.traverseEntity(n=>{n.uuid===t.fromMeshId&&(r=n)}),r?new u4(i,e,t.type,r):new u4(i,e,"SphereEmitterShape")}else return new u4(i,e,t.type)}createPrimaryEmitter(t){let e,i=t*t;return e=new J9e(new ef(1,1,1),this.material,i),this.updateGeometryAttributes(e,t),this.material.needsUpdate=!0,e.onBeforeRender=()=>{this.applyWorldSpace()},e}getMaxParticlesAmount({birthRatePerSecond:t,particleMaxLifeTime:e,loopDuration:i=0}){return Math.ceil(t*(e+i))}dispose(){!this.gpuCompute||(this.rootObject?.parent?.remove(this.rootObject),this.gpuCompute.dispose(),this.material.nodeMaterialDispose(),this.emitterShape?.dispose())}GoEmitSomeParticles(t,e){let i=t-this.lastEmitTime,r=1/e;if(i>=r){let n=Math.max(1,Math.floor(i/r));return this.lastEmitTime=t,this.emittedParticlesAmount+n>this.particlesAmount&&(this.emittedParticlesAmount=0),this.emittedParticlesAmount+=n,n}return 0}checkIfAllParticlesAreDead(){return this.lastEmitTime+this.system.data.life+1<this.globalTime}reset(){this.hasBeenReset=!0,this.lastEmitTime=0,this.emittedParticlesAmount=0,this.gpuCompute&&this.init(Dw(this.system.data))}startEmitting(t){this.isEmitting=!0,this.hasBeenReset=!1,this.lastEmitTime=t}stopEmitting(){this.isEmitting=!1}},UA=class extends So{constructor(t,e,i){super(t,e),this.type="ParticleSystem",this.geometry=new oi,this.actualTime=0,this.currentLoopTime=0,this.started=!1,this.stopped=!1,this.timeoutId=void 0,this.isFrozen=!1,this.isIdle=!0,this.emitter=null,this.colliderEntities=[],this.renderer=null,this.isPreWarm=!1,this._hasOnAfterRenderBeenCalled=!1,this.onAfterRender=r=>{this._hasOnAfterRenderBeenCalled||(this._hasOnAfterRenderBeenCalled=!0,this.init(r))},this.context=i,this.data={...e,...Dw(e)},this.geometry.setAttribute("position",new Gt([],3)),this.material=new Xp({colorWrite:!1}),this.frustumCulled=!1}init(t){this.renderer=t,this.emitter=new Sdt(t,this),this.add(this.emitter),this.updateParticleState(this.data)}update(t){if(!this.isReady||!this.started||this.isFrozen||this.isIdle)return;this.actualTime+=t,this.stopped||(this.currentLoopTime+=t);let e=this.data.emitTimeCycle==="one_time";if((this.data.emitTimeCycle==="loop"||e)&&this.currentLoopTime>this.data.emitTimeDuration*1e3&&(this.stopped||(this.stop(),e||this.start(this.data.emitTimeDelay*1e3))),this.emitter&&this.started){let i=this.actualTime/1e3;this.emitter.update(i,t)}this.scale.set(1,1,1),this.updateMatrix()}isReady(){return!!this.emitter}hasCollider(t){return this.colliderEntities.some(e=>e.identity===t)}getColliderData(t){let e=this.colliderEntities.find(i=>i.identity===t);return e?e.data:null}updateByPatchedOp(t,e,i){super.updateByPatchedOp(t,e,i),yn(t.path,["renderMaterial"])&&this.updateParticleState({renderMaterial:{...this.data.renderMaterial,...Ha.drop(t,1).props}}),yn(t.path,["shape"])&&this.updateParticleState({shape:{...this.data.shape,...Ha.drop(t,1).props}})}updateState(t,e){super.updateState(t,e),this.updateParticleState(t)}updateParticleState(t){if(this.emitter){if(t.colliderEntityId!==void 0&&t.colliderEntityId!==null){let e=this.context.scene.find(t.colliderEntityId);this.colliderEntities=e?[e]:[]}t.colliderEntityId===null&&(this.colliderEntities=[]),this.emitter.updateState(t),t.emitTimeCycle&&this.started&&this.start()}}updateFromColliderEntity(t){!this.emitter||(this.emitter.updateForceFieldParameters(t),this.stop(),this.start())}start(t=0){if(this.currentLoopTime=0,t){this.timeoutId=window.setTimeout(()=>{this.start(0)},t);return}this.started=!0,this.stopped=!1,this.isFrozen=!1,this.emitter?.startEmitting(this.actualTime/1e3)}froze(){this.isFrozen=!0}unFroze(){this.isFrozen=!1}stop(){this.stopped=!0,this.currentLoopTime=0,this.emitter?.stopEmitting(),clearTimeout(this.timeoutId)}reset(){this.started=!1,this.stopped=!1,this.emitter?.reset()}wakeUp(){this.isIdle=!1}sleep(){this.isIdle=!0,this.reset()}};function Edt(){try{let t=window.location.href;if(t.includes("reducesubdiv=")){let e=t.indexOf("reducesubdiv=")+13;return parseInt(t.slice(e,e+1))}}catch{}}var d4=Edt();function Adt(t,e,i){d4!==void 0&&(e?.geometry?.subdivisions??0)>d4&&(console.log("reducing subdivisions",e.name,e.geometry.subdivisions),e.geometry.subdivisions=d4);let r;return e.geometry.type==="TextGeometry"?new p8(t,e,i):e.geometry.type==="InputGeometry"?new _8(t,e,i):(e.geometry.type==="SubdivGeometry"?r=new YM(t,e,i):e.geometry.type==="PathGeometry"?r=new LL(t,e,i):e.geometry.type==="VectorGeometry"?r=new edt(t,e,i):e.geometry.type==="BooleanGeometry"?r=new j0(t,e,i):e.geometry.type==="ShapeBlendGeometry"?r=new V0(t,e,i):e.geometry.type==="UIGeometry"?r=new Fo(t,e,i):r=new bs(t,e,i),r)}function E8(t,e,i){return console.assert(e.type!==void 0),e.type==="Mesh"?Adt(t,e,i):e.type==="Empty"?new m1(t,e):e.type==="Particle"?new UA(t,e,i):e.type==="ParticleCollider"?new NA(t,e,i):e.type==="Splat"?new m1(t,e):e.type==="Bone"?new tdt(t,e):e.type==="Page"?new Fa(t,e,i):e.type==="PointLight"?new w8(t,e,i):e.type==="SpotLight"?new DL(t,e,i):e.type==="DirectionalLight"?new IL(t,e,i):e.type==="Component"||e.type==="Instance"?new g1(t,e,i):B0.is(e.type)?new Gs(t,e):(console.error(e),new m1(t,e))}Lg.createEntity=E8;function Mdt(t,e,i){let r=E8(t.identity,e,i),n=t.children,s=t.attachedPaths,a=t.parent,o=t.component,l=t.instances,c=t.overrideData,u=t.uuid,h=t.stateSelection;t.dispose();for(let d of Object.keys(t))delete t[d];Object.setPrototypeOf(t,Object.getPrototypeOf(r));for(let d of Object.keys(r))t[d]=r[d];t.children=[...t.children,...n],t.attachedPaths=s,t.parent=a,t.component=o,t.instances=l,t.uuid=u,t.overrideData=c,t.updateState(t.data,i),h&&t.changeSelectedState(h,i),t.resetBBoxNeedsUpdate()}Lg.changeEntityProptotype=Mdt;Lg.Cloner=vu;function Tdt(t,e,i,r){t.updateByOp(e,i,r,!1)}var Xy=5,BA=new oi;BA.setAttribute("position",new Mi(new Float32Array([-1,-1,0,3,-1,0,-1,3,0]),3));var dI=class extends R7e{constructor(t){super({...t,depthTest:!1,depthWrite:!1,glslVersion:Ej,vertexShader:`
				precision highp float;
				in vec3 position;
				void main() {
					gl_Position = vec4(position, 1);
				}
			`})}customProgramCacheKey(){return""}};function Cdt(){return{shapeInput:()=>`
			const float posRowCoord = ${.5/Xy};  // vec4: px py pz opType
			const float quatRowCoord = ${1.5/Xy};  // vec4: qx qy qz qw
			const float param1RowCoord = ${2.5/Xy};// vec4: type param1 param2 param3
			const float param2RowCoord = ${3.5/Xy};// vec4: blendRange roundness scale param4
			const float colorRowCoord = ${4.5/Xy}; // vec4: r g b a
			uniform sampler2D shapesDataTexture;
			vec4 shapePos(float iin) { 
				vec4 r = texture(shapesDataTexture, vec2(iin, posRowCoord));
				return r;
			}
			vec4 shapeQuat(float iin) {
				vec4 r = texture(shapesDataTexture, vec2(iin, quatRowCoord));
				return r;
			}
			vec4 shapeParams1(float iin) {
				vec4 r = texture(shapesDataTexture, vec2(iin, param1RowCoord));
				return r;
			}
			vec4 shapeParams2(float iin) {
				vec4 r = texture(shapesDataTexture, vec2(iin, param2RowCoord));
				return r;
			}
			vec4 shapeColor(float iin) {
				vec4 r = texture(shapesDataTexture, vec2(iin, colorRowCoord));
				return r;
			}
		`,getxyzi:`
			// this code must complement lookup
			float xi = mod(gl_FragCoord.x - 0.5, VOXEL_RESOLUTION);
			float yi = mod(gl_FragCoord.y - 0.5, VOXEL_RESOLUTION);
			float zi = floor((gl_FragCoord.x - 0.5) * INV_VOXEL_RESOLUTION) + floor((gl_FragCoord.y - 0.5) * INV_VOXEL_RESOLUTION) * Z_LAYERS_PER_ROW;
		`,lookup:`
			uniform sampler2D potentialPassTexture;
			uniform sampler2D voxelPassTexture; // includes normal (in xyz) and key (in w)
			
			// box or marching cube lookup value in value texture, integer box coord inputs
			// this code must complement codebits.getxyzi
			vec4 look(float xi, float yi, float zi, sampler2D rt) {// range 0 .. numv etc
				vec2 uv = vec2(
					mod(zi, Z_LAYERS_PER_ROW) + (xi + 0.5) / VOXEL_RESOLUTION,
					floor(zi / Z_LAYERS_PER_ROW) + (yi + 0.5) / VOXEL_RESOLUTION
				); 
				uv /= Z_LAYERS_PER_ROW;
				return texture(rt, uv);
			}
		`,getpart:`
			float getpart(inout float a, float b) {
				float t = floor(a/b);
				float r = a - t*b;
				a = t;
				return r;
			}
		`,triTable:new Float32Array([-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,8,0,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,1,0,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,8,1,1,8,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,10,2,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,8,0,10,2,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,10,2,9,9,2,0,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,8,2,8,10,2,8,9,10,-1,-1,-1,-1,-1,-1,-1,2,11,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,11,0,0,11,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,9,1,11,3,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,11,1,11,9,1,11,8,9,-1,-1,-1,-1,-1,-1,-1,1,10,3,3,10,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,10,0,10,8,0,10,11,8,-1,-1,-1,-1,-1,-1,-1,0,9,3,9,11,3,9,10,11,-1,-1,-1,-1,-1,-1,-1,10,8,9,11,8,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,7,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,3,4,4,3,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,1,0,7,4,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,1,4,1,7,4,1,3,7,-1,-1,-1,-1,-1,-1,-1,10,2,1,7,4,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,4,3,4,0,3,10,2,1,-1,-1,-1,-1,-1,-1,-1,10,2,9,2,0,9,7,4,8,-1,-1,-1,-1,-1,-1,-1,9,10,2,7,9,2,3,7,2,4,9,7,-1,-1,-1,-1,7,4,8,2,11,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,4,11,4,2,11,4,0,2,-1,-1,-1,-1,-1,-1,-1,1,0,9,7,4,8,11,3,2,-1,-1,-1,-1,-1,-1,-1,11,7,4,11,4,9,2,11,9,1,2,9,-1,-1,-1,-1,1,10,3,10,11,3,4,8,7,-1,-1,-1,-1,-1,-1,-1,10,11,1,11,4,1,4,0,1,4,11,7,-1,-1,-1,-1,8,7,4,11,0,9,10,11,9,3,0,11,-1,-1,-1,-1,11,7,4,9,11,4,10,11,9,-1,-1,-1,-1,-1,-1,-1,4,5,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,5,9,3,8,0,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,5,0,0,5,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,5,8,5,3,8,5,1,3,-1,-1,-1,-1,-1,-1,-1,10,2,1,4,5,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,0,3,10,2,1,5,9,4,-1,-1,-1,-1,-1,-1,-1,10,2,5,2,4,5,2,0,4,-1,-1,-1,-1,-1,-1,-1,5,10,2,5,2,3,4,5,3,8,4,3,-1,-1,-1,-1,4,5,9,11,3,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,11,0,11,8,0,5,9,4,-1,-1,-1,-1,-1,-1,-1,4,5,0,5,1,0,11,3,2,-1,-1,-1,-1,-1,-1,-1,5,1,2,8,5,2,11,8,2,5,8,4,-1,-1,-1,-1,11,3,10,3,1,10,4,5,9,-1,-1,-1,-1,-1,-1,-1,5,9,4,1,8,0,1,10,8,10,11,8,-1,-1,-1,-1,0,4,5,11,0,5,10,11,5,3,0,11,-1,-1,-1,-1,8,4,5,10,8,5,11,8,10,-1,-1,-1,-1,-1,-1,-1,8,7,9,9,7,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,3,9,3,5,9,3,7,5,-1,-1,-1,-1,-1,-1,-1,8,7,0,7,1,0,7,5,1,-1,-1,-1,-1,-1,-1,-1,3,5,1,7,5,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,7,9,7,5,9,2,1,10,-1,-1,-1,-1,-1,-1,-1,2,1,10,0,5,9,0,3,5,3,7,5,-1,-1,-1,-1,2,0,8,5,2,8,7,5,8,2,5,10,-1,-1,-1,-1,5,10,2,3,5,2,7,5,3,-1,-1,-1,-1,-1,-1,-1,5,9,7,9,8,7,2,11,3,-1,-1,-1,-1,-1,-1,-1,7,5,9,2,7,9,0,2,9,11,7,2,-1,-1,-1,-1,11,3,2,8,1,0,8,7,1,7,5,1,-1,-1,-1,-1,1,2,11,7,1,11,5,1,7,-1,-1,-1,-1,-1,-1,-1,8,5,9,7,5,8,3,1,10,11,3,10,-1,-1,-1,-1,0,7,5,9,0,5,0,11,7,10,0,1,0,10,11,-1,0,10,11,3,0,11,0,5,10,7,0,8,0,7,5,-1,5,10,11,5,11,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,5,6,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,8,0,6,10,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,0,9,6,10,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,8,1,8,9,1,6,10,5,-1,-1,-1,-1,-1,-1,-1,5,6,1,1,6,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,5,6,1,6,2,1,8,0,3,-1,-1,-1,-1,-1,-1,-1,5,6,9,6,0,9,6,2,0,-1,-1,-1,-1,-1,-1,-1,8,9,5,2,8,5,6,2,5,8,2,3,-1,-1,-1,-1,11,3,2,5,6,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,0,11,0,2,11,5,6,10,-1,-1,-1,-1,-1,-1,-1,9,1,0,11,3,2,6,10,5,-1,-1,-1,-1,-1,-1,-1,6,10,5,2,9,1,2,11,9,11,8,9,-1,-1,-1,-1,11,3,6,3,5,6,3,1,5,-1,-1,-1,-1,-1,-1,-1,11,8,0,5,11,0,1,5,0,6,11,5,-1,-1,-1,-1,6,11,3,6,3,0,5,6,0,9,5,0,-1,-1,-1,-1,9,5,6,11,9,6,8,9,11,-1,-1,-1,-1,-1,-1,-1,6,10,5,8,7,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,3,4,3,7,4,10,5,6,-1,-1,-1,-1,-1,-1,-1,0,9,1,6,10,5,7,4,8,-1,-1,-1,-1,-1,-1,-1,5,6,10,7,9,1,3,7,1,4,9,7,-1,-1,-1,-1,2,1,6,1,5,6,8,7,4,-1,-1,-1,-1,-1,-1,-1,5,2,1,6,2,5,4,0,3,7,4,3,-1,-1,-1,-1,7,4,8,5,0,9,5,6,0,6,2,0,-1,-1,-1,-1,9,3,7,4,9,7,9,2,3,6,9,5,9,6,2,-1,2,11,3,4,8,7,5,6,10,-1,-1,-1,-1,-1,-1,-1,6,10,5,2,7,4,0,2,4,11,7,2,-1,-1,-1,-1,9,1,0,8,7,4,11,3,2,6,10,5,-1,-1,-1,-1,1,2,9,2,11,9,11,4,9,4,11,7,6,10,5,-1,7,4,8,5,11,3,1,5,3,6,11,5,-1,-1,-1,-1,11,1,5,6,11,5,11,0,1,4,11,7,11,4,0,-1,9,5,0,5,6,0,6,3,0,3,6,11,7,4,8,-1,9,5,6,11,9,6,9,7,4,9,11,7,-1,-1,-1,-1,9,4,10,10,4,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,6,10,4,10,9,4,3,8,0,-1,-1,-1,-1,-1,-1,-1,1,0,10,0,6,10,0,4,6,-1,-1,-1,-1,-1,-1,-1,1,3,8,6,1,8,4,6,8,10,1,6,-1,-1,-1,-1,9,4,1,4,2,1,4,6,2,-1,-1,-1,-1,-1,-1,-1,8,0,3,9,2,1,9,4,2,4,6,2,-1,-1,-1,-1,4,2,0,6,2,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,3,8,4,2,8,6,2,4,-1,-1,-1,-1,-1,-1,-1,9,4,10,4,6,10,3,2,11,-1,-1,-1,-1,-1,-1,-1,2,8,0,11,8,2,10,9,4,6,10,4,-1,-1,-1,-1,2,11,3,6,1,0,4,6,0,10,1,6,-1,-1,-1,-1,1,4,6,10,1,6,1,8,4,11,1,2,1,11,8,-1,4,6,9,6,3,9,3,1,9,3,6,11,-1,-1,-1,-1,1,11,8,0,1,8,1,6,11,4,1,9,1,4,6,-1,6,11,3,0,6,3,4,6,0,-1,-1,-1,-1,-1,-1,-1,8,4,6,8,6,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,6,10,7,10,8,7,10,9,8,-1,-1,-1,-1,-1,-1,-1,3,7,0,7,10,0,10,9,0,10,7,6,-1,-1,-1,-1,7,6,10,7,10,1,8,7,1,0,8,1,-1,-1,-1,-1,7,6,10,1,7,10,3,7,1,-1,-1,-1,-1,-1,-1,-1,6,2,1,8,6,1,9,8,1,7,6,8,-1,-1,-1,-1,9,6,2,1,9,2,9,7,6,3,9,0,9,3,7,-1,0,8,7,6,0,7,2,0,6,-1,-1,-1,-1,-1,-1,-1,2,3,7,2,7,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,3,2,8,6,10,9,8,10,7,6,8,-1,-1,-1,-1,7,0,2,11,7,2,7,9,0,10,7,6,7,10,9,-1,0,8,1,8,7,1,7,10,1,10,7,6,11,3,2,-1,1,2,11,7,1,11,1,6,10,1,7,6,-1,-1,-1,-1,6,9,8,7,6,8,6,1,9,3,6,11,6,3,1,-1,1,9,0,7,6,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,7,6,0,7,0,11,3,0,6,11,-1,-1,-1,-1,6,11,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,6,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,0,3,6,7,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,1,0,6,7,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,1,8,1,3,8,6,7,11,-1,-1,-1,-1,-1,-1,-1,2,1,10,7,11,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,10,2,1,8,0,3,7,11,6,-1,-1,-1,-1,-1,-1,-1,0,9,2,9,10,2,7,11,6,-1,-1,-1,-1,-1,-1,-1,7,11,6,3,10,2,3,8,10,8,9,10,-1,-1,-1,-1,3,2,7,7,2,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,0,7,0,6,7,0,2,6,-1,-1,-1,-1,-1,-1,-1,6,7,2,7,3,2,9,1,0,-1,-1,-1,-1,-1,-1,-1,2,6,1,6,8,1,8,9,1,6,7,8,-1,-1,-1,-1,6,7,10,7,1,10,7,3,1,-1,-1,-1,-1,-1,-1,-1,6,7,10,10,7,1,7,8,1,8,0,1,-1,-1,-1,-1,7,3,0,10,7,0,9,10,0,7,10,6,-1,-1,-1,-1,10,6,7,8,10,7,9,10,8,-1,-1,-1,-1,-1,-1,-1,4,8,6,6,8,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,6,3,6,0,3,6,4,0,-1,-1,-1,-1,-1,-1,-1,11,6,8,6,4,8,1,0,9,-1,-1,-1,-1,-1,-1,-1,6,4,9,3,6,9,1,3,9,6,3,11,-1,-1,-1,-1,4,8,6,8,11,6,1,10,2,-1,-1,-1,-1,-1,-1,-1,10,2,1,11,0,3,11,6,0,6,4,0,-1,-1,-1,-1,8,11,4,11,6,4,9,2,0,9,10,2,-1,-1,-1,-1,3,9,10,2,3,10,3,4,9,6,3,11,3,6,4,-1,3,2,8,2,4,8,2,6,4,-1,-1,-1,-1,-1,-1,-1,2,4,0,2,6,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,9,1,4,3,2,6,4,2,8,3,4,-1,-1,-1,-1,4,9,1,2,4,1,6,4,2,-1,-1,-1,-1,-1,-1,-1,3,1,8,1,6,8,6,4,8,1,10,6,-1,-1,-1,-1,0,1,10,6,0,10,4,0,6,-1,-1,-1,-1,-1,-1,-1,3,6,4,8,3,4,3,10,6,9,3,0,3,9,10,-1,4,9,10,4,10,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,5,9,4,11,6,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,8,0,5,9,4,6,7,11,-1,-1,-1,-1,-1,-1,-1,1,0,5,0,4,5,11,6,7,-1,-1,-1,-1,-1,-1,-1,6,7,11,4,3,8,4,5,3,5,1,3,-1,-1,-1,-1,4,5,9,2,1,10,11,6,7,-1,-1,-1,-1,-1,-1,-1,7,11,6,10,2,1,3,8,0,5,9,4,-1,-1,-1,-1,11,6,7,10,4,5,10,2,4,2,0,4,-1,-1,-1,-1,8,4,3,4,5,3,5,2,3,2,5,10,6,7,11,-1,3,2,7,2,6,7,9,4,5,-1,-1,-1,-1,-1,-1,-1,4,5,9,6,8,0,2,6,0,7,8,6,-1,-1,-1,-1,2,6,3,6,7,3,0,5,1,0,4,5,-1,-1,-1,-1,8,2,6,7,8,6,8,1,2,5,8,4,8,5,1,-1,4,5,9,6,1,10,6,7,1,7,3,1,-1,-1,-1,-1,10,6,1,6,7,1,7,0,1,0,7,8,4,5,9,-1,10,0,4,5,10,4,10,3,0,7,10,6,10,7,3,-1,10,6,7,8,10,7,10,4,5,10,8,4,-1,-1,-1,-1,5,9,6,9,11,6,9,8,11,-1,-1,-1,-1,-1,-1,-1,11,6,3,3,6,0,6,5,0,5,9,0,-1,-1,-1,-1,8,11,0,11,5,0,5,1,0,11,6,5,-1,-1,-1,-1,3,11,6,5,3,6,1,3,5,-1,-1,-1,-1,-1,-1,-1,10,2,1,11,5,9,8,11,9,6,5,11,-1,-1,-1,-1,3,11,0,11,6,0,6,9,0,9,6,5,10,2,1,-1,5,8,11,6,5,11,5,0,8,2,5,10,5,2,0,-1,3,11,6,5,3,6,3,10,2,3,5,10,-1,-1,-1,-1,9,8,5,8,2,5,2,6,5,2,8,3,-1,-1,-1,-1,6,5,9,0,6,9,2,6,0,-1,-1,-1,-1,-1,-1,-1,8,5,1,0,8,1,8,6,5,2,8,3,8,2,6,-1,6,5,1,6,1,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,6,3,1,10,6,1,6,8,3,9,6,5,6,9,8,-1,0,1,10,6,0,10,0,5,9,0,6,5,-1,-1,-1,-1,8,3,0,10,6,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,6,5,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,10,5,11,11,5,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,10,5,11,5,7,11,0,3,8,-1,-1,-1,-1,-1,-1,-1,7,11,5,11,10,5,0,9,1,-1,-1,-1,-1,-1,-1,-1,5,7,10,7,11,10,1,8,9,1,3,8,-1,-1,-1,-1,2,1,11,1,7,11,1,5,7,-1,-1,-1,-1,-1,-1,-1,3,8,0,7,2,1,5,7,1,11,2,7,-1,-1,-1,-1,5,7,9,7,2,9,2,0,9,7,11,2,-1,-1,-1,-1,2,5,7,11,2,7,2,9,5,8,2,3,2,8,9,-1,10,5,2,5,3,2,5,7,3,-1,-1,-1,-1,-1,-1,-1,0,2,8,2,5,8,5,7,8,5,2,10,-1,-1,-1,-1,1,0,9,3,10,5,7,3,5,2,10,3,-1,-1,-1,-1,2,8,9,1,2,9,2,7,8,5,2,10,2,5,7,-1,5,3,1,5,7,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,8,0,1,7,0,5,7,1,-1,-1,-1,-1,-1,-1,-1,3,0,9,5,3,9,7,3,5,-1,-1,-1,-1,-1,-1,-1,7,8,9,7,9,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,8,5,8,10,5,8,11,10,-1,-1,-1,-1,-1,-1,-1,4,0,5,0,11,5,11,10,5,0,3,11,-1,-1,-1,-1,9,1,0,10,4,8,11,10,8,5,4,10,-1,-1,-1,-1,4,11,10,5,4,10,4,3,11,1,4,9,4,1,3,-1,1,5,2,5,8,2,8,11,2,8,5,4,-1,-1,-1,-1,11,4,0,3,11,0,11,5,4,1,11,2,11,1,5,-1,5,2,0,9,5,0,5,11,2,8,5,4,5,8,11,-1,5,4,9,3,11,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,10,5,2,2,5,3,5,4,3,4,8,3,-1,-1,-1,-1,2,10,5,4,2,5,0,2,4,-1,-1,-1,-1,-1,-1,-1,2,10,3,10,5,3,5,8,3,8,5,4,9,1,0,-1,2,10,5,4,2,5,2,9,1,2,4,9,-1,-1,-1,-1,5,4,8,3,5,8,1,5,3,-1,-1,-1,-1,-1,-1,-1,5,4,0,5,0,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,5,4,8,3,5,8,5,0,9,5,3,0,-1,-1,-1,-1,5,4,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,11,4,11,9,4,11,10,9,-1,-1,-1,-1,-1,-1,-1,3,8,0,7,9,4,7,11,9,11,10,9,-1,-1,-1,-1,11,10,1,4,11,1,0,4,1,11,4,7,-1,-1,-1,-1,4,1,3,8,4,3,4,10,1,11,4,7,4,11,10,-1,7,11,4,4,11,9,11,2,9,2,1,9,-1,-1,-1,-1,4,7,9,7,11,9,11,1,9,1,11,2,3,8,0,-1,4,7,11,2,4,11,0,4,2,-1,-1,-1,-1,-1,-1,-1,4,7,11,2,4,11,4,3,8,4,2,3,-1,-1,-1,-1,10,9,2,9,7,2,7,3,2,9,4,7,-1,-1,-1,-1,7,10,9,4,7,9,7,2,10,0,7,8,7,0,2,-1,10,7,3,2,10,3,10,4,7,0,10,1,10,0,4,-1,2,10,1,4,7,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,9,4,7,1,4,3,1,7,-1,-1,-1,-1,-1,-1,-1,1,9,4,7,1,4,1,8,0,1,7,8,-1,-1,-1,-1,3,0,4,3,4,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,8,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,10,9,8,11,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,0,3,11,9,3,10,9,11,-1,-1,-1,-1,-1,-1,-1,10,1,0,8,10,0,11,10,8,-1,-1,-1,-1,-1,-1,-1,10,1,3,10,3,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,2,1,9,11,1,8,11,9,-1,-1,-1,-1,-1,-1,-1,9,0,3,11,9,3,9,2,1,9,11,2,-1,-1,-1,-1,11,2,0,11,0,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,2,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,3,2,10,8,2,9,8,10,-1,-1,-1,-1,-1,-1,-1,2,10,9,2,9,0,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,3,2,10,8,2,8,1,0,8,10,1,-1,-1,-1,-1,2,10,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,3,1,8,1,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,9,0,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,3,0,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1]),numTrisTable:new Float32Array([0,1,1,2,1,2,2,3,1,2,2,3,2,3,3,2,1,2,2,3,2,3,3,4,2,3,3,4,3,4,4,3,1,2,2,3,2,3,3,4,2,3,3,4,3,4,4,3,2,3,3,2,3,4,4,3,3,4,4,3,4,5,5,2,1,2,2,3,2,3,3,4,2,3,3,4,3,4,4,3,2,3,3,4,3,4,4,5,3,4,4,5,4,5,5,4,2,3,3,4,3,4,2,3,3,4,4,5,4,5,3,2,3,4,4,3,4,5,3,2,4,5,5,4,5,2,4,1,1,2,2,3,2,3,3,4,2,3,3,4,3,4,4,3,2,3,3,4,3,4,4,5,3,2,4,3,4,3,5,2,2,3,3,4,3,4,4,5,3,4,4,5,4,5,5,4,3,4,4,3,4,5,5,4,4,3,5,2,5,4,2,1,2,3,3,4,3,4,4,5,3,4,4,5,2,3,3,2,3,4,4,5,4,5,5,2,4,3,5,4,3,2,4,1,3,4,4,5,4,5,3,4,4,5,5,2,3,4,2,1,2,3,3,2,3,4,2,1,3,2,4,1,2,1,1,0])}}var fI=new vv,Pdt=class{constructor(){this.pyramidPassScene=new ac,this.pyramidPassMaterial=new dI({name:"PyramidPass"}),this.pyramidPassUniforms={inputTexture:{value:void 0},inputWidth:{value:0},inputHeight:{value:0},inputShiftX:{value:0},outputShiftX:{value:0}},this.pyramidTopLevelReadPixelBuffer=new Float32Array(4);let t=`
			precision highp float;
			precision highp sampler2D;
			layout(location = 0) out vec4 pc_FragColor;
			uniform sampler2D inputTexture;
			uniform float inputWidth;
			uniform float inputHeight;
			uniform float inputShiftX;
			uniform float outputShiftX;
			const vec2 half_unit_coord = vec2(0.5);
			const vec4 one = vec4(1.0);
			void main() {
				vec2 inputSize = vec2(inputWidth, inputHeight);
				vec2 input_pixel_uv = 1. / inputSize;
				vec2 coord = gl_FragCoord.xy - half_unit_coord;
				coord.x -= outputShiftX;
				coord = coord * 2. + half_unit_coord;
				coord.x += inputShiftX;

				// sample bottom left corner
				vec2 input_uv = coord / inputSize;
				float bl = texture(inputTexture, input_uv).r;

				// sample bottom right corner
				input_uv.x += input_pixel_uv.x;
				float br = texture(inputTexture, input_uv).r;

				// sample top right corner
				input_uv.y += input_pixel_uv.y;
				float tr = texture(inputTexture, input_uv).r;

				// sample top left corner
				input_uv.x -= input_pixel_uv.x;
				float tl = texture(inputTexture, input_uv).r;

				pc_FragColor.a = bl;
				pc_FragColor.b = pc_FragColor.a + br;
				pc_FragColor.g = pc_FragColor.b + tr;
				pc_FragColor.r = pc_FragColor.g + tl; 
			}
		`;this.pyramidPassMaterial.fragmentShader=t,this.pyramidPassMaterial.uniforms=this.pyramidPassUniforms,this.pyramidPassMaterial.depthTest=!1,this.pyramidPassMaterial.depthWrite=!1;let e=new En(BA,this.pyramidPassMaterial);e.frustumCulled=!1,this.pyramidPassScene.add(e)}renderPyramid(t,e,i,r,n){new rG().min.setScalar(0);let s=e.length-1,a=new Ui;i.getViewport(a),this.pyramidPassUniforms.inputShiftX.value=0,this.pyramidPassUniforms.outputShiftX.value=0;let o=s-1;for(let c=o;c>=0;c--){let u=c%2===o%2?n[0]:n[1],h=c===o?r:c%2===o%2?n[1]:n[0];this.pyramidPassUniforms.inputTexture.value=Array.isArray(h.texture)?h.texture[1]:h.texture,this.pyramidPassUniforms.inputWidth.value=h.width,this.pyramidPassUniforms.inputHeight.value=h.height,i.setRenderTarget(u);let d=e[c],f=i.getPixelRatio();i.setViewport(this.pyramidPassUniforms.outputShiftX.value/f,0,d/f,d/f),c===2&&t%2!==0&&i.setViewport(this.pyramidPassUniforms.outputShiftX.value/f,0,3/f,3/f),i.render(this.pyramidPassScene,fI);let p=this.pyramidPassUniforms.inputShiftX.value;this.pyramidPassUniforms.inputShiftX.value=this.pyramidPassUniforms.outputShiftX.value,this.pyramidPassUniforms.outputShiftX.value=p,c<o&&(this.pyramidPassUniforms.outputShiftX.value+=e[c+1])}i.setViewport(a);let l=e.length%2===0?0:1;return i.readRenderTargetPixelsAsync(n[l],n[l].width-1,0,1,1,this.pyramidTopLevelReadPixelBuffer).then(()=>this.pyramidTopLevelReadPixelBuffer[0])}},oh=24,po=96,ud=Cdt(),np=2,bme=class extends bs{constructor(t,e,i){super(t,e,i),this.data=e,this.needsRebuild=!0,this.customDepthMaterialNeedsUpdate=!1,this._npart=-1,this.spatialn=1,this.drawRangeNeedsForceUpdate=!0,this._resolutionLevel=-1,this.resolution=64,this.spatialDivisions=25,this.zLayersPerRow=8,this.basePyramidSize=512,this.pyramidTexture1Width=341,this.pyramidTexture1Height=256,this.pyramidTexture2Width=170,this.pyramidTexture2Height=128,this.numLevels=9,this.pyramidLevelSizes=[1,2,4,8,16,32,64,128,256,512],this.bboxSize=0,this.bboxOffset=0,this.shapesDataTexture={value:void 0},this.spatialscene=new ac,this.potentialPassScene=new ac,this.voxelPassScene=new ac,this._spatialPassRenderTargets=[],this._potentialPassRenderTargets=[],this._voxelPassRenderTargets=[],this._pyramidRenderTargets=[],this.geometry=new oi,this.geometry.drawRange.count=0,this.spatialPassUniforms={span:{value:-1},shapesDataTexture:this.shapesDataTexture,npart:{value:this.npart},spatialn:{value:this.spatialn}},this.spatialMesh=new En(BA,this.spatialPassMaterial()),this.spatialMesh.frustumCulled=!1,this.spatialscene.add(this.spatialMesh);let r=new yl(ud.triTable,16,256,tI,cn);r.needsUpdate=!0;let n=new yl(ud.numTrisTable,256,1,tI,cn);n.needsUpdate=!0,this.voxelPassUniforms={potentialPassTexture:{value:void 0},numTrisTable:{value:n}},this.voxelMesh=new En(BA,this.voxelPassMaterial()),this.voxelMesh.frustumCulled=!1,this.voxelPassScene.add(this.voxelMesh),this.potentialPassUniforms={shapesDataTexture:this.shapesDataTexture,spatialPassTexture:{value:void 0},npart:{value:this.npart},spatialn:{value:this.spatialn}},this.potentialMesh=new En(BA,this.potentialPassMaterial()),this.potentialMesh.frustumCulled=!1,this.potentialPassScene.add(this.potentialMesh),this.marchPassUniforms={triTable:{value:r},potentialPassTexture:{value:void 0},voxelPassTexture:{value:void 0},pyramidTexture1:{value:void 0},pyramidTexture1Size:{value:void 0},pyramidTexture2:{value:void 0},pyramidTexture2Size:{value:void 0}},this.frustumCulled=!1,this.onBeforeShadowPass=s=>{if(Ldt.call(this),this.npart===0){this.geometry.drawRange.count=0;return}let a=this.material.root;if(!a.shadersPatchedForShapeBlend)this.patchVertexShaderForShapeBlend(a),a.shadersPatchedForShapeBlend=!0,this.customDepthMaterialNeedsUpdate=!0;else if(this.customDepthMaterialNeedsUpdate){this.customDepthMaterialNeedsUpdate=!1,this.customDepthMaterial=new Tr({vertexShader:a.vertexShader,fragmentShader:`
						#include <packing>
						void main()
						{
							gl_FragColor = packDepthToRGBA(gl_FragCoord.z);
						}
					`,uniforms:a.uniforms,defines:this.material.defines}),this.isMeshDepthMaterial=!0,this.customDistanceMaterial=new Tr({vertexShader:a.vertexShader,fragmentShader:`
					#include <common>
					#include <packing>
					uniform vec3 referencePosition;
					uniform float nearDistance;
					uniform float farDistance;
					// World-space position
					varying vec3 vWPosition;
					void main()
					{
						float dist = length(vWPosition - referencePosition);
						dist = (dist - nearDistance) / (farDistance - nearDistance);
						dist = saturate(dist);
						// Required by Three.js for this to work
						gl_FragColor = packDepthToRGBA( dist );
					}`,uniforms:{nearDistance:{value:0},farDistance:{value:0},referencePosition:{value:new W},opacity:{value:0},...a.uniforms},defines:this.material.defines});let c=this.customDistanceMaterial;c.referencePosition=new W,c.nearDistance=0,c.farDistance=0,c.opacity=1,c.isMeshDistanceMaterial=!0}if(this.spatialPassUniforms.npart.value=this.npart,this.spatialPassUniforms.spatialn.value=this.spatialn,this.potentialPassUniforms.npart.value=this.npart,this.potentialPassUniforms.spatialn.value=this.spatialn,this.needsRebuild){this.needsRebuild=!1,this.spatialMesh.material.defines.RES=this.resolutionLevel,this.spatialMesh.material.needsUpdate=!0,this.potentialMesh.material.defines.RES=this.resolutionLevel,this.potentialPassUniforms.spatialPassTexture.value=this.spatialPassRenderTarget.texture,this.potentialMesh.material.needsUpdate=!0,this.voxelMesh.material.defines.RES=this.resolutionLevel,this.voxelMesh.material.needsUpdate=!0,this.voxelPassUniforms.potentialPassTexture.value=this.potentialPassRenderTarget.texture,this.marchPassUniforms.potentialPassTexture.value=this.potentialPassRenderTarget.texture,this.marchPassUniforms.voxelPassTexture.value=this.voxelPassRenderTarget.texture[0],this.material.defines.RES=this.resolutionLevel,this.material.defines.LEVELS=this.pyramidLevelSizes.length,this.material.defines.LOOP=this.pyramidLevelSizes.length%2===0?this.pyramidLevelSizes.length-3:this.pyramidLevelSizes.length-2,this.material.defines.HALF=this.pyramidLevelSizes.length%2===0?1:0,this.material.needsUpdate=!0;let c=this.pyramidLevelSizes.length%2===0?0:1,u=this.pyramidLevelSizes.length%2===0?1:0;this.marchPassUniforms.pyramidTexture2.value=this.pyramidRenderTarget[c].texture,this.marchPassUniforms.pyramidTexture2Size.value=new Ae(this.pyramidRenderTarget[c].width,this.pyramidRenderTarget[c].height),this.marchPassUniforms.pyramidTexture1.value=this.pyramidRenderTarget[u].texture,this.marchPassUniforms.pyramidTexture1Size.value=new Ae(this.pyramidRenderTarget[u].width,this.pyramidRenderTarget[u].height),Object.assign(this.material.uniforms,this.marchPassUniforms)}let o=s.shadowMap.enabled;s.shadowMap.enabled=!1;let l=s.getRenderTarget();s.setRenderTarget(this.spatialPassRenderTarget),s.render(this.spatialscene,fI),s.setRenderTarget(this.potentialPassRenderTarget),s.render(this.potentialPassScene,fI),s.setRenderTarget(this.voxelPassRenderTarget),s.render(this.voxelPassScene,fI),bme.streamCompaction.renderPyramid(this.resolutionLevel,this.pyramidLevelSizes,s,this.voxelPassRenderTarget,this.pyramidRenderTarget).then(c=>{this.material.wireframe&&(c*3>this.geometry.attributes.position.count||this.drawRangeNeedsForceUpdate)&&(this.geometry.dispose(),this.geometry=new oi,this.geometry.userData.parameters={width:this.bboxSize,height:this.bboxSize,depth:this.bboxSize,centerOffset:[this.bboxOffset,this.bboxOffset,this.bboxOffset]},this.geometry.attributes.position=new Mi(new Float32Array(c*3*2),3)),(c*3>this.geometry.drawRange.count||this.drawRangeNeedsForceUpdate)&&(this.geometry.drawRange.count=Math.floor(c*1.2)*3),this.drawRangeNeedsForceUpdate=!1}),s.shadowMap.enabled=o,s.setRenderTarget(l)}}set npart(t){t!==this._npart&&(this.drawRangeNeedsForceUpdate=!0,this._npart=t,this.spatialn=Math.ceil(t/(4*oh)))}get npart(){return this._npart}set resolutionLevel(t){let e=Math.min(8,Math.max(5,t));if(e!==this._resolutionLevel){switch(this._resolutionLevel=e,this.resolution=Math.pow(2,e),this.resolutionLevel){case 5:this.pyramidLevelSizes=[1,2,4,6,12,24,48,96,192],this.bboxSize=248*np,this.bboxOffset=8*np*-1/2;break;case 6:this.pyramidLevelSizes=[1,2,4,8,16,32,64,128,256,512],this.bboxSize=252*np,this.bboxOffset=4*np*-1/2;break;case 7:this.pyramidLevelSizes=[1,2,4,6,12,24,48,96,192,384,768,1536],this.bboxSize=254*np,this.bboxOffset=2*np*-1/2;break;case 8:this.pyramidLevelSizes=[1,2,4,8,16,32,64,128,256,512,1024,2048,4096],this.bboxSize=255*np,this.bboxOffset=np*-1/2;break}this.pyramidTexture1Width=0,this.pyramidTexture2Width=0,this.pyramidTexture1Height=this.pyramidLevelSizes[this.pyramidLevelSizes.length-2],this.pyramidTexture2Height=this.pyramidLevelSizes[this.pyramidLevelSizes.length-3];for(let i=this.pyramidLevelSizes.length-2;i>=0;i--)(this.pyramidLevelSizes.length-2)%2===i%2?this.pyramidTexture1Width+=this.pyramidLevelSizes[i]:this.pyramidTexture2Width+=this.pyramidLevelSizes[i];this.basePyramidSize=this.pyramidLevelSizes[this.pyramidLevelSizes.length-1],this.zLayersPerRow=this.basePyramidSize/this.resolution,this.numLevels=this.pyramidLevelSizes.length-1,this.geometry.userData.parameters={width:this.bboxSize,height:this.bboxSize,depth:this.bboxSize,centerOffset:[this.bboxOffset,this.bboxOffset,this.bboxOffset]},this.needsRebuild=!0,this.customDepthMaterialNeedsUpdate=!0}}get resolutionLevel(){return this._resolutionLevel}get spatialPassRenderTarget(){let t=this._spatialPassRenderTargets[this.resolutionLevel];return t||(t=new Mr(this.spatialDivisions*this.spatialn,this.spatialDivisions**2,{format:Vn,type:cn,stencilBuffer:!1,depthBuffer:!1,generateMipmaps:!1,minFilter:mr,magFilter:mr}),this._spatialPassRenderTargets[this.resolutionLevel]=t),t}get potentialPassRenderTarget(){let t=this._potentialPassRenderTargets[this.resolutionLevel];return t||(t=new Mr(this.basePyramidSize,this.basePyramidSize,{format:Vn,type:cn,stencilBuffer:!1,depthBuffer:!1,generateMipmaps:!1,minFilter:mr,magFilter:mr}),this._potentialPassRenderTargets[this.resolutionLevel]=t),t}get voxelPassRenderTarget(){let t=this._voxelPassRenderTargets[this.resolutionLevel];return t||(t=new dhe(this.basePyramidSize,this.basePyramidSize,2,{stencilBuffer:!1,depthBuffer:!1,generateMipmaps:!1,minFilter:mr,magFilter:mr}),t.texture[0].format=Vn,t.texture[0].type=cn,t.texture[1].format=tI,t.texture[1].type=cn,this._voxelPassRenderTargets[this.resolutionLevel]=t),t}get pyramidRenderTarget(){let t=this._pyramidRenderTargets[this.resolutionLevel];if(!t){let e=new Mr(this.pyramidTexture1Width,this.pyramidTexture1Height,{format:Vn,type:cn,stencilBuffer:!1,depthBuffer:!1,magFilter:mr,minFilter:mr}),i=new Mr(this.pyramidTexture2Width,this.pyramidTexture2Height,{format:Vn,type:cn,stencilBuffer:!1,depthBuffer:!1,magFilter:mr,minFilter:mr});t=[e,i],this._pyramidRenderTargets[this.resolutionLevel]=t}return t}updateState(t,e){let i=this.material;super.updateState(t,e),i!==this.material&&(this.needsRebuild=!0),t.geometry&&(this.resolutionLevel=t.geometry.resolutionLevel,this.geometry.userData.parameters={width:this.bboxSize,height:this.bboxSize,depth:this.bboxSize,centerOffset:[this.bboxOffset,this.bboxOffset,this.bboxOffset]}),t.wireframe&&!this.geometry.getAttribute("position")?this.geometry.setAttribute("position",new Mi(new Float32Array(this.geometry.drawRange.count*3),3)):!t.wireframe&&this.geometry.getAttribute("position")&&this.geometry.deleteAttribute("position")}spatialPassMaterial(){let t=`
			precision highp float;
			out vec4 pc_FragColor;
			const float spatialDivisions = ${this.spatialDivisions}.;
			uniform float span;
			uniform float npart;
			uniform float spatialn;
			${ud.shapeInput()}

			vec3 low, high;     // range of current div; subset of -1 .. 1 with span border

			// lookup one element/channel's worth of spheres for current division
			// stating with low sphere number lowi
			// gives a key to which spheres from lowi..lowi+23 are active within given div (low..high)
			float spatialKey(float lowi) {
				float t = 0.;
				for (float ii = ${oh-1}.; ii >= 0.; ii--) {
					float i = ii + lowi;
					float iin = (i + 0.5) / ${po}.;
					vec4 shape = shapePos(iin);
					vec3 d = shape.xyz;
					float op = shape.w;
	
					t *= 2.;
					t += (
						low.x < d.x && d.x < high.x &&
						low.y < d.y && d.y < high.y &&
						low.z < d.z && d.z < high.z &&
						i < npart || op == -2. // always include if op is -2, which is the intersection operation
					) ? 1. : 0.;
				}
				return t;
			}

			${ud.getpart}

			void main() {               // spatialial fragment shader
				// find active div
				vec3 div;                               // which div is current
				// out holds x=> x, lowi faster moving and y=> z, y faster moving
				float yz = float(gl_FragCoord.y - 0.5);     // contains  z, y faster moving
				div.y = getpart(yz, spatialDivisions);
				div.z = yz; // getpart(yz, spatialDivisions.z); // what's left, should be the same as getpart

				float lx = float(gl_FragCoord.x - 0.5);     // contains x, lowi faster moving
				float lowi = getpart(lx, spatialn) * ${4*oh}.;
				div.x = lx;

				low = div / spatialDivisions * 2. - 1. - span;
				high = (div+1.) / spatialDivisions * 2. - 1. + span;

				// find active range of spheres
				pc_FragColor.x = spatialKey(lowi);
				pc_FragColor.y = spatialKey(lowi+${oh}.);
				pc_FragColor.z = spatialKey(lowi+${2*oh}.);
				pc_FragColor.w = spatialKey(lowi+${3*oh}.);
			}
		`;return new dI({name:"Spatial Pass",fragmentShader:t,uniforms:this.spatialPassUniforms})}potentialPassMaterial(){let t=`
			precision highp float;
			out vec4 pc_FragColor;

			${ud.shapeInput()}
			uniform sampler2D spatialPassTexture;

			const float res = float(RES);
			const float VOXEL_RESOLUTION = pow(2., res);
			const float Z_LAYERS_PER_ROW = ceil(pow(2., res / 2.));
			const float VOXEL_RESOLUTION_SUB1 = VOXEL_RESOLUTION - 1.;
			const float INV_VOXEL_RESOLUTION = 1.0 / VOXEL_RESOLUTION;

			uniform float npart;
			uniform float spatialn;
			const float spatialDivisions = ${this.spatialDivisions}.;
			const float spatialDivisions2 = spatialDivisions * spatialDivisions;
			const float spatialDivisionsSub1 = spatialDivisions - 1.;

			${ud.getpart}

			vec3 packRGBAToVec3(vec4 color) {
				uint r = uint(color.r * 255.);
				uint g = uint(color.g * 255.);
				uint combined = (r << 8) | g; 
				return vec3(float(combined) * 0.00001525902, color.b, color.a); // 1/65535
			}

			void applyQuaternionToVector(in vec4 q, inout vec3 v) {
				v += 2.0 * cross(q.xyz, cross(q.xyz, v) + q.w * v);
			}

			/**
			 * SDF functions (reference: https://iquilezles.org/articles/distfunctions/)
			 */

			// branchless version of "Smooth Union, Subtraction and Intersection - bound, bound, bound" in above reference
			float smoothOperation(float op, float sdf, float d, float k) {
			  //        union: op =  1 => signSubtract =  1, signIntersection =  1
			  //     subtract: op = -1 => signSubtract = -1, signIntersection =  1
				// intersection: op = -2 => signSubtract = -1, signIntersection = -1

				float signSubtract = clamp(op, -1., 1.);
				float signIntersection = 2. * (op - signSubtract) + 1.;
				float h = clamp(
					0.5 + signSubtract * 0.5 * (sdf - signSubtract * signIntersection * d) / k,
					0.0,
					1.0
				);
				return mix(sdf, signSubtract * signIntersection * d, h) - 
							 signSubtract * k * h * (1.0 - h);
			}

			float sdSphere( vec3 p, float s )
			{
				return length(p)-s;
			}

			float sdEllipsoid( vec3 p, vec3 r )
			{
				float k0 = length(p/r);
				float k1 = length(p/(r*r));
				return k0*(k0-1.0)/k1;
			}

			float sdBox( vec3 p, vec3 b )
			{
				vec3 q = abs(p) - b;
				return length(max(q,0.0)) + min(max(q.x,max(q.y,q.z)),0.0);
			}

			float sdTorus( vec3 p, vec2 t )
			{
				vec2 q = vec2(length(p.xy)-t.x,p.z);
				return length(q)-t.y;
			}

			float sdCappedTorus( vec3 p, vec2 sc, float ra, float rb)
			{
				p.x = abs(p.x);
				float k = (sc.y*p.x>sc.x*p.y) ? dot(p.xy,sc) : length(p.xy);
				return sqrt( dot(p,p) + ra*ra - 2.0*ra*k ) - rb;
			}

			float dot2( in vec2 v ) { return dot(v,v); }
			float sdCappedCone( vec3 p, float h, float r1, float r2 )
			{
				vec2 q = vec2( length(p.xz), p.y );
				vec2 k1 = vec2(r2,h);
				vec2 k2 = vec2(r2-r1,2.0*h);
				vec2 ca = vec2(q.x-min(q.x,(q.y<0.0)?r1:r2), abs(q.y)-h);
				vec2 cb = q - k1 + k2*clamp( dot(k1-q,k2)/dot2(k2), 0.0, 1.0 );
				float s = (cb.x<0.0 && ca.y<0.0) ? -1.0 : 1.0;
				return s*sqrt( min(dot2(ca),dot2(cb)) );
			}

			float sdCappedCylinder( vec3 p, float h, float r )
			{
				vec2 d = abs(vec2(length(p.xz),p.y)) - vec2(r,h);
				return min(max(d.x,d.y),0.0) + length(max(d,0.0));
			}

			float maxBlend = 0.0;
			// compute potential from A (=24) spheres, using the bit flags in 'activeKey'
			// to avoid lookup/compute for inactive spheres
			// return field potential, side effect updates track,
			// compute and return +ve and -ve values separately
			void fillSpatialInner(
				float ii,
				float activeKey,
				vec3 corner,
				inout float sdf,
				inout float colorDivisor,
				inout vec4 trackColor
			) {
				for (float i = 0.; i < ${oh}.; i++) {
					if (activeKey < 1.) break; // activeKey exhausted, no more active spheres
					activeKey *= 0.5;
					if (fract(activeKey) < 0.5) continue;

					float iin = (i + ii + 0.5) * ${1/po};
					vec4 shape = shapePos(iin);
					vec4 quat = shapeQuat(iin);
					vec4 params1 = shapeParams1(iin);
					vec4 params2 = shapeParams2(iin);

					vec3 p = corner - shape.xyz;
					applyQuaternionToVector(quat, p);
					p /= params2.z; // scale
					float d; // d in -1..1 coordinates
					switch (int(params1.x)) {
						case 0: d = sdSphere(p, params1.y); break;
						case 1: d = sdEllipsoid(p, params1.yzw); break;
						case 2: d = sdBox(p, params1.yzw); break;
						case 3: d = sdCappedCylinder(p, params1.y, params1.z); break;
						case 4: d = sdCappedCone(p, params1.y, params1.z, params1.w); break;
						case 5: d = sdTorus(p, params1.yz); break;
						case 6: d = sdCappedTorus(p, params1.yz, params1.w, params2.w); break;
					}
					d -= params2.y; // rounded edge
					d *= params2.z; // scale

					float k = params2.x;
					float op = shape.w;

					sdf = smoothOperation(shape.w, sdf, d, k);

					float isNegativeOne = step(-1.5, op) * step(op, -0.5); // 1 when op == -1, 0 otherwise
					float colorCull = smoothstep(maxBlend, 0., -d);
					float cullFactor = mix(1.0, colorCull, isNegativeOne);
					trackColor *= cullFactor;
					colorDivisor *= cullFactor;

					maxBlend = max(maxBlend, k);

					k += 2. * INV_VOXEL_RESOLUTION; // avoid division by zero, and other color artifacts with very small k
					float nearness = smoothstep(k, 0., d);

					vec4 color = shapeColor(iin);
					nearness *= float(color.a >= 0.);

					colorDivisor += nearness;
					trackColor += color * nearness;
				}
			}

			vec3 div;
			// compute potential from all spheres; collect +ve and =ve values separately
			// work in blocks of A*4 (=96) spheres, using the bit flags in 4 float channel 'activeKey' values
			// TODO check if extra vec3 output useful, not really used at present
			float fillSpatial(vec3 corner, inout vec4 trackColor) {
				float sdf = 1e3; // hack: initialize to large value
				float colorDivisor = 0.;
				// spatialPassTexture holds x=> lowi, x faster moving and y=> z, y faster moving
				float divyz = (div.y + div.z * spatialDivisions + 0.5) / (spatialDivisions2);
				for (float ii = 0.; ii < spatialn; ii++) {
					float i = ii * ${4*oh}.;

					vec4 activeKey = texture(spatialPassTexture, vec2((div.x * spatialn + ii + 0.5)/(spatialn * spatialDivisions), divyz));
					fillSpatialInner(i, activeKey.x, corner, sdf, colorDivisor, trackColor);
					fillSpatialInner(i+${oh}., activeKey.y, corner, sdf, colorDivisor, trackColor);
					fillSpatialInner(i+${2*oh}., activeKey.z, corner, sdf, colorDivisor, trackColor);
					fillSpatialInner(i+${3*oh}., activeKey.w, corner, sdf, colorDivisor, trackColor);
				}

				trackColor /= colorDivisor;
				return mix(sdf, 0.0, step(1e20 - 0.1, sdf));
			}

			void main() {
				${ud.getxyzi}    // get xi yi zi from 2d position

				vec3 xyzi = vec3(xi,yi,zi);
				vec3 corner = xyzi / VOXEL_RESOLUTION_SUB1 * 2. - 1.;  // -1..1 coords

				div = floor(xyzi / VOXEL_RESOLUTION_SUB1 * spatialDivisionsSub1);

				vec4 c = vec4(0.);
				float t = fillSpatial(corner, c);

				pc_FragColor = vec4(t, packRGBAToVec3(c)); // RGB texture
			}
		`;return new dI({name:"PotentialPass",fragmentShader:t,uniforms:this.potentialPassUniforms})}voxelPassMaterial(){let t=`
			precision highp float;
			layout(location = 0) out vec4 pc_FragColor;
			layout(location = 1) out vec4 numTris;

			const float res = float(RES);
			const float VOXEL_RESOLUTION = pow(2., res);
			const float VOXEL_RESOLUTION_SUB1 = VOXEL_RESOLUTION - 1.; 
			const float Z_LAYERS_PER_ROW = ceil(pow(2., res / 2.));
			const float INV_VOXEL_RESOLUTION = 1.0 / VOXEL_RESOLUTION;
			uniform sampler2D numTrisTable; // 256 x 1

			float keyi(float f000, float f100, float f010, float f110, float f001, float f101, float f011, float f111) {
				return (float(f000 < 0.) * 1.) +
							 (float(f100 < 0.) * 2.) +
							 (float(f010 < 0.) * 8.) +
							 (float(f110 < 0.) * 4.) +
							 (float(f001 < 0.) * 16.) +
							 (float(f101 < 0.) * 32.) +
							 (float(f011 < 0.) * 128.) +
							 (float(f111 < 0.) * 64.);
			}

			${ud.lookup}

			vec3 compNormi(float xi, float yi, float zi) {
				float dx = look(xi + 1., yi, zi, potentialPassTexture).r - look(xi - 1., yi, zi, potentialPassTexture).r;
				float dy = look(xi, yi + 1., zi, potentialPassTexture).r - look(xi, yi - 1., zi, potentialPassTexture).r;
				float dz = look(xi, yi, zi + 1., potentialPassTexture).r - look(xi, yi, zi - 1., potentialPassTexture).r;
				// if we allow (common) 0,0,0 case through then NaN can spread
				// eg r = vec4(compNorm i(???), 1.) will pollute r.w
				if (dx == 0.0 && dy == 0.0 && dz == 0.0) {
					return vec3(0.199, 0.299, 0.399);
				}
				return normalize(vec3(dx, dy, dz));
			}

			void main() {
				${ud.getxyzi}    // get xi yi zi from 2d

				vec3 normal = compNormi(xi, yi, zi);  // even if our key is -1 this may be needed by a neighbouring voxel

				if (xi >= VOXEL_RESOLUTION_SUB1 || yi >= VOXEL_RESOLUTION_SUB1 || zi >= VOXEL_RESOLUTION_SUB1) {
					pc_FragColor = vec4(normal, 0.);
					numTris = vec4(0.);
					return;
				}

				float
					f000 = look(xi, yi, zi, potentialPassTexture).r,
					f100 = look(xi+1., yi, zi, potentialPassTexture).r,
					f010 = look(xi, yi+1., zi, potentialPassTexture).r,
					f110 = look(xi+1., yi+1., zi, potentialPassTexture).r,
					f001 = look(xi, yi, zi+1., potentialPassTexture).r,
					f101 = look(xi+1., yi, zi+1., potentialPassTexture).r,
					f011 = look(xi, yi+1., zi+1., potentialPassTexture).r,
					f111 = look(xi+1., yi+1., zi+1., potentialPassTexture).r;
				float key = keyi(f000, f100, f010, f110, f001, f101, f011, f111);

				pc_FragColor = vec4(normal, key);

				numTris = texture(numTrisTable, vec2((key + 0.5) / 256., 0.5));
			}
		`;return new dI({name:"VoxelPass",fragmentShader:t,uniforms:this.voxelPassUniforms})}patchVertexShaderForShapeBlend(t){let e=`
		#ifdef SHAPEBLEND 
			precision highp sampler2D;

			uniform float isol;

			uniform sampler2D triTable;     // 256 x 16
			uniform sampler2D pyramidTexture1;
			uniform vec2 pyramidTexture1Size;
			uniform sampler2D pyramidTexture2;
			uniform vec2 pyramidTexture2Size;

			const vec2 halfPixelOffset = vec2(0.5, 0.5);

			const vec2 rShift = vec2(0., 1.);
			const vec2 gShift = vec2(1., 1.);
			const vec2 bShift = vec2(1., 0.);

			const float res = float(RES);
			const float VOXEL_RESOLUTION = pow(2., res);
			const float Z_LAYERS_PER_ROW = ceil(pow(2., res / 2.));
			const float INV_VOXEL_RESOLUTION = 1.0 / VOXEL_RESOLUTION;

			const float scale_factor = ${np}.;

			#if SHAPEBLEND == 5
				const float levelShiftX[7] = float[7](4., 6., 12., 24., 48., 96., 192.);
				const float scale = 8. * scale_factor;
				const vec3 originOffset = vec3(16.);
			#elif SHAPEBLEND == 7
				const float levelShiftX[10] = float[10](4., 6., 12., 24., 48., 96., 192., 384., 768., 1536.); 
				const float scale = 2. * scale_factor;
				const vec3 originOffset = vec3(64.);
			#elif SHAPEBLEND == 8
				const float levelShiftX[11] = float[11](4., 8., 16., 32., 64., 128., 256., 512., 1024., 2048., 4096.);
				const float scale = scale_factor;
				const vec3 originOffset = vec3(128.);
			#else
				const float levelShiftX[8] = float[8](4., 8., 16., 32., 64., 128., 256., 512.);
				const float scale = 4. * scale_factor;
				const vec3 originOffset = vec3(32.);
			#endif

			${ud.lookup}

			const vec3 offsets[24] = vec3[](
				vec3(0., 0., 0.), vec3(1., 0., 0.),
				vec3(1., 0., 0.), vec3(1., 1., 0.),
				vec3(0., 1., 0.), vec3(1., 1., 0.),
				vec3(0., 0., 0.), vec3(0., 1., 0.),
				vec3(0., 0., 1.), vec3(1., 0., 1.),
				vec3(1., 0., 1.), vec3(1., 1., 1.),
				vec3(0., 1., 1.), vec3(1., 1., 1.),
				vec3(0., 0., 1.), vec3(0., 1., 1.),
				vec3(0., 0., 0.), vec3(0., 0., 1.),
				vec3(1., 0., 0.), vec3(1., 0., 1.),
				vec3(1., 1., 0.), vec3(1., 1., 1.),
				vec3(0., 1., 0.), vec3(0., 1., 1.)
			);

			vec2 computeShiftedPosition1(vec2 xy, float levelOriginX) {
				vec2 xyShifted = xy;
				xyShifted.x += levelOriginX;
				return (xyShifted + halfPixelOffset) / pyramidTexture1Size;
			}

			vec2 computeShiftedPosition2(vec2 xy, float levelOriginX) {
				vec2 xyShifted = xy;
				xyShifted.x += levelOriginX;
				return (xyShifted + halfPixelOffset) / pyramidTexture2Size;
			}

			vec4 unpackVec3ToRGBA(vec3 vec) {
				uint combined = uint(vec.x * 65535.0 + 0.5); // Add 0.5 for rounding
				float g = float(combined & uint(0xFF)) * 0.00392156862; // 1/255
				float r = float((combined >> 8) & uint(0xFF)) * 0.00392156862; 
		
				return vec4(r, g, vec.y, vec.z);
			}

			out vec4 marchColor;
			// end of marchvertPre
		#endif
		`,i=`
		#ifdef SHAPEBLEND
			float triIndex = floor(float(gl_VertexID/3));
			float vertexIndex = float(gl_VertexID);
			
			// Initial pyramid lookup
			float levelOriginX1 = pyramidTexture1Size.x - 2.;
			float levelOriginX2 = pyramidTexture2Size.x - 1.;
			vec2 xy = vec2(0.);
			vec4 lookUp = texture(pyramidTexture2, computeShiftedPosition2(xy, levelOriginX2));
			
			// Early exit check
			if (triIndex >= lookUp.r) return;
			
			// Optimize loop variables
			float start = 0.;
			vec4 triIndexVec = vec4(triIndex);
			
			// Main position computation loop
			for (int i = 0; i < LOOP;) {
				// Compute boundaries
				vec4 ends = lookUp + vec4(start);
				vec4 starts = vec4(ends.gba, start);
				vec4 check = vec4(greaterThanEqual(triIndexVec, starts)) * 
											vec4(lessThan(triIndexVec, ends));
				
				// Update position
				xy *= 2.;
				xy += check.r * rShift + check.g * gShift + check.b * bShift;
				
				// Update loop variables
				start = dot(check, starts);
				levelOriginX2 -= levelShiftX[i];
				
				// Update lookup
				lookUp = texture(pyramidTexture1, computeShiftedPosition1(xy, levelOriginX1));
				i++;

				ends = lookUp + vec4(start);
				starts = vec4(ends.gba, start);
				check = vec4(greaterThanEqual(triIndexVec, starts)) * 
											vec4(lessThan(triIndexVec, ends));
				
				// Update position
				xy *= 2.;
				xy += check.r * rShift + check.g * gShift + check.b * bShift;
				
				// Update loop variables
				start = dot(check, starts);
				levelOriginX1 -= levelShiftX[i];
				
				// Update lookup
				lookUp = texture(pyramidTexture2, computeShiftedPosition2(xy, levelOriginX2));

				i++;
			}

			#if HALF == 1
				vec4 ends = lookUp + vec4(start);
				vec4 starts = vec4(ends.gba, start);
				vec4 check = vec4(greaterThanEqual(triIndexVec, starts)) * vec4(lessThan(triIndexVec, ends));
			
				// Update position
				xy *= 2.;
				xy += check.r * rShift + check.g * gShift + check.b * bShift;
			
				// Update loop variables
				start = dot(check, starts);
			#endif
			
			// Compute final coordinates
			vec3 gridPos;
			gridPos.x = mod(xy.x, VOXEL_RESOLUTION);
			gridPos.y = mod(xy.y, VOXEL_RESOLUTION);
			gridPos.z = floor(xy.x * INV_VOXEL_RESOLUTION) + 
									floor(xy.y * INV_VOXEL_RESOLUTION) * Z_LAYERS_PER_ROW;
			
			// Vertex key computation
			vertexIndex -= start * 3.;
			float vk = vertexIndex * 0.0625 + 0.03125; // Optimized division by 16 and addition of 1/32
			
			// Voxel lookup and edge computation
			vec4 voxel = look(gridPos.x, gridPos.y, gridPos.z, voxelPassTexture);
			float key = (voxel.w + 0.5) * 0.00390625; // Optimized division by 256
			
			// Edge lookup and offset computation
			float edgeNum = texture(triTable, vec2(vk, key)).x;
			int edgeIndex = int(edgeNum) * 2;
			
			// Compute edge positions
			vec3 p1 = gridPos + offsets[edgeIndex];
			vec3 p2 = gridPos + offsets[edgeIndex + 1];
			
			// Compute potentials and normals
			vec4 potential1 = look(p1.x, p1.y, p1.z, potentialPassTexture);
			vec4 potential2 = look(p2.x, p2.y, p2.z, potentialPassTexture);
			
			// Final position and normal computation
			float mu = potential1.r / (potential1.r - potential2.r);

			marchColor = mix(
				unpackVec3ToRGBA(potential1.gba),
				unpackVec3ToRGBA(potential2.gba),
				mu
			);

			transformed = p1 + (p2 - p1) * mu;
			transformed -= originOffset;
			transformed *= scale;
			vec4 data1 = look(p1.x, p1.y, p1.z, voxelPassTexture);
			vec4 data2 = look(p2.x, p2.y, p2.z, voxelPassTexture);
			objectNormal = normalize(mix(data1.xyz, data2.xyz, mu));
			transformedNormal = normalMatrix * objectNormal;
			#ifndef FLAT_SHADED
				vNormal = transformedNormal;
			#endif
		#endif
		`;t.vertexShader=e+t.vertexShader.replace("#include <project_vertex>",i+`
#include <project_vertex>`);let r=t.fragmentShader.match(/vec3 diffuseColor[^\n]*\n/);if(!r)return;let n=`
		#ifdef SHAPEBLEND_C
			#if SHAPEBLEND_C == 1
				${r[0].replace(/nodeU0,/g,"marchColor.rgb,").replace(/nodeU\d+(?=,g_uid\d+_calpha\))/g,"marchColor.a")}
			#else
				${r[0]}
			#endif
		#else
			${r[0]}
		#endif
		`;t.fragmentShader=`in vec4 marchColor;
`+t.fragmentShader.replace(r[0],n),Object.assign(t.uniforms,this.marchPassUniforms)}initDebugPass(t){console.log("fboToDebug.width",t.width,t.height),this.geometry=new ef(t.width,t.height),this.geometry.userData={parameters:{width:4,height:4}};let e={inputTexture:{value:Array.isArray(t.texture)?t.texture[1]:t.texture},pyramidTextureSize:{value:void 0}},i=r=>{r.vertexShader=`
				precision highp float;

				varying vec2 vUv;

				void main() {
						gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
						vUv = uv;
				}
			`,r.fragmentShader=`
				layout(location = 1) out vec4 gVelocity;

				precision highp float;
				
				uniform sampler2D inputTexture;
				varying vec2 vUv;

				uniform vec2 pyramidTextureSize;

				void main() {
						// Sample the input texture using UV coordinates
						gl_FragColor = texture(inputTexture, vUv);
						gVelocity = vec4(0.0);
				}
			`,e.pyramidTextureSize.value=new Ae(this.pyramidRenderTarget.width,this.pyramidRenderTarget.height),Object.assign(r.uniforms,e)};this.material.shapeBlendhack=i,this.material.root.shapeBlendhack=i}},V0=bme;V0.streamCompaction=new Pdt;var Rdt=new St,Idt=new St,fw=new Ii,tg=new W,RR=new W,Ddt=new Ii;function Odt(t,e=0){let i=this.children.length;for(;i--;){let r=this.children[i];F0.is(r)&&wme.call(r,t,e+1)}}function wme(t,e=0){if(t(this,e)!==!0){let i=this.children.length;for(;i--;){let r=this.children[i];F0.is(r)&&wme.call(r,t,e+1)}}}function Ldt(){if(this.shapesDataTexture.value===void 0){let a=new yl(new Float32Array(4*po*Xy),po,Xy,Vn,cn);this.shapesDataTexture.value=a}let t=this.shapesDataTexture.value,e=t.image.data;t.needsUpdate=!0;let i=0,r=this.data.geometry.blendRange,n=Rdt.copy(this.matrixWorld).invert(),s=0;Odt.call(this,a=>{if(a.visible===!1)return!0;let o;if(a instanceof vu||a instanceof NA||a instanceof UA)return;a instanceof bo?o=a.object:o=a;let l=a.data?.cloner;if(Er.is(a)&&l&&!l.hideBase&&l.type!=="radial"&&l.disabled!==!0||!(o instanceof bs))return;let c=o.geometry.userData.parameters,u=c.shapeBlendNode;if(u===void 0)return;if(Idt.multiplyMatrices(n,a.matrixWorld).decompose(RR,fw,tg),c.type==="TorusGeometry"&&c.arc!==360){let y=c.arc*Math.PI/180;y=y/4,fw.multiply(Ddt.set(0,0,Math.sin(y),Math.cos(y)))}let h=u.overrideGlobalBlend?u.blendRange:r;h=h/this.bboxSize*2,e[s*4]=(RR.x-this.bboxOffset)/this.bboxSize*2,e[s*4+1]=(RR.y-this.bboxOffset)/this.bboxSize*2,e[s*4+2]=(RR.z-this.bboxOffset)/this.bboxSize*2,e[s*4+3]=u.operation===0?1:u.operation===2?-1:-2,e[po*4+s*4]=-fw.x,e[po*4+s*4+1]=-fw.y,e[po*4+s*4+2]=-fw.z,e[po*4+s*4+3]=fw.w;let d=new Float32Array(4),f=0;if(c.type==="SphereGeometry")c.width===c.height&&c.width===c.depth?d[0]=0:d[0]=1,d[1]=c.width/this.bboxSize,d[2]=c.height/this.bboxSize,d[3]=c.depth/this.bboxSize,i=Math.max(i,d[1]*tg.x+h,d[2]*tg.x+h,d[3]*tg.x+h);else if(c.type==="CubeGeometry"){f=c.cornerRadius;let y=c.width,b=c.height,w=c.depth;d[0]=2,d[1]=(y-2*f)/this.bboxSize,d[2]=(b-2*f)/this.bboxSize,d[3]=(w-2*f)/this.bboxSize,i=Math.max(i,Math.sqrt(y**2+b**2+w**2)/this.bboxSize*tg.x+h)}else if(c.type==="CylinderGeometry"){f=c.cornerRadius;let y=c.height,b=c.radiusBottom,w=c.radiusTop;if(w>=b){let E=Math.atan2(w-b,y),M=(Math.PI/2-E)/2;w-=f/Math.tan(M),b-=f*Math.tan(M)}else if(b>w){let E=Math.atan2(b-w,y),M=(Math.PI/2-E)/2;w-=f*Math.tan(M),b-=f/Math.tan(M)}d[1]=(c.height-2*f)/this.bboxSize,b===w?(d[0]=3,d[2]=b/this.bboxSize*2):(d[0]=4,d[2]=b/this.bboxSize*2,d[3]=w/this.bboxSize*2),i=Math.max(i,d[1]*4*tg.x+h)}else if(c.type==="TorusGeometry"){if(d[0]=5,d[1]=(c.width-c.depth)/this.bboxSize,d[2]=c.depth/this.bboxSize,c.arc!==360){d[0]=6,d[3]=d[1],e[po*12+s*4+3]=d[2];let y=2*Math.atan2(d[2]/2,d[1]),b=c.arc*Math.PI/180/2-y;d[1]=Math.sin(b),d[2]=Math.cos(b)}i=Math.max(i,c.width*tg.x/this.bboxSize+h)}e.set(d,po*8+s*4),e[po*12+s*4]=h,e[po*12+s*4+1]=f/this.bboxSize*2,e[po*12+s*4+2]=tg.x;let p=o.material,g=p.uniforms.nodeU0.node.value,m=p.uniforms.nodeU1.value;u.operation!==0&&!u.useColor&&(m=-1),e[po*16+s*4]=g.r,e[po*16+s*4+1]=g.g,e[po*16+s*4+2]=g.b,e[po*16+s*4+3]=m,m<1&&this.material.defines.SHAPEBLEND_C===1&&(this.material.transparent=!0),s++}),this.npart=s,this.spatialPassUniforms.span.value=i*1.4}var _me=512;function hie(t,e){let i=!1,r=t.layers.mask&_me,n=e.getLayersOfType("transmission"),s=e.getLayersOfType("outline");return s.length>0&&(t.layers.set(8),n.length>0&&t.layers.enable(3),i=!0,f8(t),d8(t)),n.length===0&&s.length===0&&t.layers.set(0),r&&t.layers.set(9),t instanceof sv&&t.needsAO&&t.layers.enable(5),i}function die(t,e){if(!e.layers)return!1;let i=t.layers.mask&_me,r=!1,n=e.getLayersOfType("transmission").filter(a=>a.data.visible),s=e.getLayersOfType("outline").filter(a=>a.data.visible);return n.length>0&&(t.layers.set(3),s.length>0&&t.layers.enable(8),r=!0),n.length===0&&s.length===0&&t.layers.set(0),i&&t.layers.set(9),t.needsAO&&t.layers.enable(5),r}function kdt(t){let e=!1;return t.traverseEntity(i=>{if(i instanceof sv)if(Array.isArray(i.material))for(let r=0;r<i.material.length;r++)hie(i,i.material[r])&&(e=!0);else hie(i,i.material)&&(e=!0)}),e}function Ndt(t){let e=!1;return t.traverseEntity(i=>{if(i instanceof sv)if(Array.isArray(i.material))for(let r=0;r<i.material.length;r++)die(i,i.material[r])&&(e=!0);else die(i,i.material)&&(e=!0)}),e}var Udt=new Vhe,Bdt=new St,Fdt=new E_;function hV(t,e,i,r=!1){let n=t.cloner;if(n)for(let s of n.children){let a=Bdt.copy(s.matrixWorld).invert(),o=Fdt.copy(e.ray).applyMatrix4(a),l=t.matrixWorld;o.applyMatrix4(l);let c=Udt;c.set(o.origin,o.direction),c.near=e.near,c.far=e.far;let u=c.intersectObject(t,!1);u.length>0&&i.push({...u[0],object:r?s:t})}}var zdt=class{constructor(){this._constraints=new Map}setConstraint(t,e){e===null?this._constraints.delete(t):this._constraints.set(t,e)}removeDependencies(t){this._constraints.delete(t)}applyConstraints(t){let e=new Set;this._constraints.forEach((i,r)=>{let n=[r,i],s=i;for(;this._constraints.has(s);){if(s=this._constraints.get(s),n.includes(s)){console.warn(`circular dependency detected: ${n.join(" -> ")}`);break}e.has(s)||n.push(s)}for(let a=n.length-2;a>=0;a--)if(!e.has(n[a])){let o=t.find(n[a]);o?o.applyPathSnapping(t):console.warn(`missing entity ${n[a]}`),e.add(n[a])}})}findDependency(t,e){let i=t;for(;this._constraints.has(i);)if(i=this._constraints.get(i),i===e)return!0;return!1}},jdt="AGFzbQEAAAAADwhkeWxpbmsuMAEEAAAAAAETA2AAAGAIf39/f39/f38AYAABfwISAQNlbnYGbWVtb3J5AgMAgIAEAwQDAAECBzkDEV9fd2FzbV9jYWxsX2N0b3JzAAALc29ydEluZGV4ZXMAARNlbXNjcmlwdGVuX3Rsc19pbml0AAIK3gMDAwABC9IDAwF/BnwBfgJAIAdFDQAgAysDUCEMIAMrAzAhDSADKwMQIQ5BACEDRP///////+9/IQtEAAAAAAAAEAAhCgNAIAIgA0ECdGoCfyAOIAEgA0EMbGoiCCoCALuiIA0gCCoCBLuioCAMIAgqAgi7oqBEAAAAAAAAsECiIgmZRAAAAAAAAOBBYwRAIAmqDAELQYCAgIB4CzYCACAJIAsgCSALYxshCyAJIAogCSAKZBshCiADQQFqIgMgB0cNAAsgB0UNACAGuCAKIAuhoyEJQQAhAwNAAn8gCSACIANBAnRqIgEoAgC3IAuhoiIKmUQAAAAAAADgQWMEQCAKqgwBC0GAgICAeAshCCABIAg2AgAgBCAIQQJ0aiIBIAEoAgBBAWo2AgAgA0EBaiIDIAdHDQALCyAGQQJPBEAgBCgCACEIQQEhAwNAIAQgA0ECdGoiASABKAIAIAhqIgg2AgAgA0EBaiIDIAZHDQALCyAHQQFrIgGtIQ8DQCAEIAIgD6dBAnQiA2ooAgBBAnRqIgcgBygCAEEBayIHNgIAIAUgASAHa0ECdGogACADaigCADYCACAPUCEDIA9CAX0hDyADRQ0ACyAGBEAgBEEAIAZBAnT8CwALCwQAQQAL",Ng=class{};HE(Ng,"DepthMapRange",65536),HE(Ng,"MemoryPageSize",65536),HE(Ng,"BytesPerFloat",4),HE(Ng,"BytesPerInt",4);function Vdt(t){let e,i,r,n,s,a,o,l,c,u,h,d,f,p,g,m;function y(k){let z=new Float64Array(u,a,16);for(let F=0;F<16;F++)z[F]=k[F];let V;if(r>1){e.exports.sortIndexes(n,s,c,a,o,l,d.DepthMapRange,r);let F=new Uint32Array(r);V=F.buffer,F.set(new Uint32Array(u,l,r))}else if(r===1){let F=new Uint32Array(r);F[0]=new Uint32Array(u,n,i)[0],V=F.buffer}else V=new ArrayBuffer(0);t.postMessage({sortDone:!0,indexesBuffer:V},[V])}function b(k,z,V){let F=new Float32Array(u,s,i*3);r=0;let $=new Uint32Array(u,n,i);for(let K=0;K<V.length-1;K++){let X=z[K],U=k[K].elements,Y=X.filter(j=>j.enabled&&j.mode==="Include").map(j=>j.type==="Box"?A(j):R(j)),Z=X.filter(j=>j.enabled&&j.mode==="Exclude").map(j=>j.type==="Box"?A(j):R(j));for(let j=V[K];j<V[K+1];j++){let ee=f[j*3],pe=f[j*3+1],fe=f[j*3+2];if((Y.length===0||E(ee,pe,fe,Y))&&(Z.length===0||!E(ee,pe,fe,Z))){let se=1/(U[3]*ee+U[7]*pe+U[11]*fe+U[15]);F[r*3]=(U[0]*ee+U[4]*pe+U[8]*fe+U[12])*se,F[r*3+1]=(U[1]*ee+U[5]*pe+U[9]*fe+U[13])*se,F[r*3+2]=(U[2]*ee+U[6]*pe+U[10]*fe+U[14])*se,$[r]=j,r++}}}}function w(k,z){let V=[],F=z.filter(X=>X.enabled&&X.mode==="Include").map(X=>X.type==="Box"?A(X):R(X)),$=z.filter(X=>X.enabled&&X.mode==="Exclude").map(X=>X.type==="Box"?A(X):R(X)),K=k.length;for(let X=0;X<K;X+=3){let U=k[X],Y=k[X+1],Z=k[X+2];(F.length===0||E(U,Y,Z,F))&&($.length===0||!E(U,Y,Z,$))||V.push(X/3)}return V}function E(k,z,V,F,$){return F[$==="Intersect"?"every":"some"](K=>{let X=M(k,z,V,K.invRotationMatrix,K.cropCenter);return Array.isArray(K)?C(X.x,X.y,X.z,K):I(X.x,X.y,X.z,K)})}function M(k,z,V,F,$){let K=k-$[0],X=z-$[1],U=V-$[2],Y=1/(F[3]*K+F[7]*X+F[11]*U+F[15]);return{x:(F[0]*K+F[4]*X+F[8]*U+F[12])*Y+$[0],y:(F[1]*K+F[5]*X+F[9]*U+F[13])*Y+$[1],z:(F[2]*K+F[6]*X+F[10]*U+F[14])*Y+$[2]}}function A(k){let z=k.cropSize[0]/2,V=k.cropSize[1]/2,F=k.cropSize[2]/2,$=[k.cropCenter[0]-z,k.cropCenter[1]-V,k.cropCenter[2]-F,k.cropCenter[0]+z,k.cropCenter[1]+V,k.cropCenter[2]+F],K=P(k.cropRotation);return Object.assign($,{invRotationMatrix:K,cropCenter:k.cropCenter})}function P(k){let z=[],V=k[0]*Math.PI/180,F=k[1]*Math.PI/180,$=k[2]*Math.PI/180,K=Math.cos(V),X=Math.sin(V),U=Math.cos(F),Y=Math.sin(F),Z=Math.cos($),j=Math.sin($),ee=K*Z,pe=K*j,fe=X*Z,se=X*j;return z[0]=U*Z,z[1]=-U*j,z[2]=Y,z[4]=pe+fe*Y,z[5]=ee-se*Y,z[6]=-X*U,z[8]=se-ee*Y,z[9]=fe+pe*Y,z[10]=K*U,z[12]=0,z[13]=0,z[14]=0,z[3]=0,z[7]=0,z[11]=0,z[15]=1,z}function C(k,z,V,F){return k>=F[0]&&k<=F[3]&&z>=F[1]&&z<=F[4]&&V>=F[2]&&V<=F[5]}function R(k){let z=2/k.cropSize[0],V=2/k.cropSize[1],F=2/k.cropSize[2],$=P(k.cropRotation);return{invRadiusX:z,invRadiusY:V,invRadiusZ:F,cropCenter:k.cropCenter,invRotationMatrix:$}}function I(k,z,V,F){let $=(k-F.cropCenter[0])*F.invRadiusX,K=(z-F.cropCenter[1])*F.invRadiusY,X=(V-F.cropCenter[2])*F.invRadiusZ;return $*$+K*K+X*X<=1}t.onmessage=k=>{if(k.data.getCroppedIndexes){let z=new Uint32Array(w(new Float32Array(k.data.positions),k.data.crops)).buffer;t.postMessage({outOfBoundsIndexes:z},[z])}else if(k.data.positions)h=k.data.positions,f=new Float32Array(h),g=k.data.meshMatrixWorlds,m=k.data.cropsArray,p=k.data.meshIndexIntervals,b(g,m,p),t.postMessage({sortSetupComplete:!0});else if(k.data.sort||k.data.newMatrixWorlds||k.data.newCropsArray)(k.data.newMatrixWorlds||k.data.newCropsArray)&&(m=k.data.newCropsArray||m,g=k.data.newMatrixWorlds||g,b(g,m,p)),y(k.data.sort.view,k.data.sort.cameraPosition);else if(k.data.init){d=k.data.init.Constants,i=k.data.init.splatCount;let z=d.BytesPerInt,V=d.BytesPerFloat*3,F=new Uint8Array(k.data.init.sorterWasmBytes),$=z+V,K=i*$,X=i*d.BytesPerInt*2+d.DepthMapRange*d.BytesPerInt*2,U=d.MemoryPageSize*32,Y=K+X+U,Z=Math.floor(Y/d.MemoryPageSize)+1,j={module:{},env:{memory:new WebAssembly.Memory({initial:Z*2,maximum:Z*3,shared:!0})}};WebAssembly.compile(F).then(ee=>WebAssembly.instantiate(ee,j)).then(ee=>{e=ee,n=0,s=i*z,a=s+i*V,c=a+16*d.BytesPerFloat*2,o=c+i*d.BytesPerInt,l=o+d.DepthMapRange*d.BytesPerInt,u=j.env.memory.buffer,t.postMessage({sortSetupPhase1Complete:!0})})}}}function Hdt(t){let e=new Worker(URL.createObjectURL(new Blob(["(",Vdt.toString(),")(self)"],{type:"application/javascript"}))),i=atob(jdt),r=new Uint8Array(i.length);for(let n=0;n<i.length;n++)r[n]=i.charCodeAt(n);return e.postMessage({init:{sorterWasmBytes:r.buffer,splatCount:t,Constants:{BytesPerFloat:Ng.BytesPerFloat,BytesPerInt:Ng.BytesPerInt,DepthMapRange:Ng.DepthMapRange,MemoryPageSize:Ng.MemoryPageSize}}}),e}var f4=(function(){let t=new Float32Array(1),e=new Int32Array(t.buffer);return function(i){return t[0]=i,e[0]}})(),Gdt=function(t,e,i,r){return t+(e<<8)+(i<<16)+(r<<24)},IR=new Ae;function fie(t){let e=!1;return t.scene.objects.traverse((i,r)=>{if(r.visible===!1)return!0;r.type==="Splat"&&(e=!0)}),e}var pI=class extends En{constructor(t,e,i,r,n=!1,s=1,a,o){super(i,r),this.splatCount=e,this.meshIndexIntervals=a,this.meshMatrixWorlds=o,this.splatBuffers=t,this.geometry=i,this.material=r,this.splatDataTextures=null,this.halfPrecisionCovariancesOnGPU=n,this.devicePixelRatio=s,this.resetLocalSplatDataAndTexturesFromSplatBuffer()}static buildMesh(t,e,i=!1,r=1,n,s){let a=pI.buildGeomtery(e),o=pI.buildMaterial(n);return new pI(t,e,a,o,i,r,n,s)}static buildMaterial(t){let e=`
            precision highp float;
            #include <common>

            attribute uint splatIndex;

            uniform highp sampler2D covariancesTexture;
            uniform highp usampler2D centersColorsTexture;
            uniform vec2 focal;
            uniform vec2 viewport;
            uniform vec2 basisViewport;
            uniform vec2 covariancesTextureSize;
            uniform vec2 centersColorsTextureSize;
						uniform highp sampler2D meshMatrixWorldsTexture;
						uniform uint meshIndexIntervals[257];
						uniform float orthoZoom;

            varying vec4 vColor;
            varying vec2 vUv;

            varying vec2 vPosition;

            const vec4 encodeNorm4 = vec4(1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0);
            const uvec4 mask4 = uvec4(uint(0x000000FF), uint(0x0000FF00), uint(0x00FF0000), uint(0xFF000000));
            const uvec4 shift4 = uvec4(0, 8, 16, 24);
            vec4 uintToRGBAVec (uint u) {
               uvec4 urgba = mask4 & u;
               urgba = urgba >> shift4;
               vec4 rgba = vec4(urgba) * encodeNorm4;
               return rgba;
            }

            vec2 getDataUV(in int stride, in int offset, in vec2 dimensions) {
                vec2 samplerUV = vec2(0.0, 0.0);
                float d = float(splatIndex * uint(stride) + uint(offset)) / dimensions.x;
                samplerUV.y = float(floor(d)) / dimensions.y;
                samplerUV.x = fract(d);
                return samplerUV;
            }

            void main () {
                uvec4 sampledCenterColor = texture(centersColorsTexture, getDataUV(1, 0, centersColorsTextureSize));
                vec3 splatCenter = uintBitsToFloat(uvec3(sampledCenterColor.gba));
                vColor = uintToRGBAVec(sampledCenterColor.r);

                vPosition = position.xy * 2.0;

								uint meshIndex;
								for (int i = 1; i < 257; i++) {
									if (splatIndex < meshIndexIntervals[i]) {
										meshIndex = uint(i - 1);
										break;
									}
								}

								float strideMulmeshIndex = float(4u*meshIndex);
								float meshMatrixWorldsTextureLength = float(256*4);

								mat4 modelMat = mat4(
									texture(meshMatrixWorldsTexture, vec2((strideMulmeshIndex+0.0)/meshMatrixWorldsTextureLength, 0)),
									texture(meshMatrixWorldsTexture, vec2((strideMulmeshIndex+1.0)/meshMatrixWorldsTextureLength, 0)),
									texture(meshMatrixWorldsTexture, vec2((strideMulmeshIndex+2.0)/meshMatrixWorldsTextureLength, 0)),
									texture(meshMatrixWorldsTexture, vec2((strideMulmeshIndex+3.0)/meshMatrixWorldsTextureLength, 0))
								);
								mat4 modelViewMat = viewMatrix * modelMat;
								vec4 viewCenter = modelViewMat * vec4(splatCenter, 1.0); 
                vec4 clipCenter = projectionMatrix * viewCenter;

                vec2 sampledCovarianceA = texture(covariancesTexture, getDataUV(3, 0, covariancesTextureSize)).rg;
                vec2 sampledCovarianceB = texture(covariancesTexture, getDataUV(3, 1, covariancesTextureSize)).rg;
                vec2 sampledCovarianceC = texture(covariancesTexture, getDataUV(3, 2, covariancesTextureSize)).rg;

                vec3 cov3D_M11_M12_M13 = vec3(sampledCovarianceA.rg, sampledCovarianceB.r);
                vec3 cov3D_M22_M23_M33 = vec3(sampledCovarianceB.g, sampledCovarianceC.rg);

                // Compute the 2D covariance matrix from the upper-right portion of the 3D covariance matrix
                mat3 Vrk = mat3(
                    cov3D_M11_M12_M13.x, cov3D_M11_M12_M13.y, cov3D_M11_M12_M13.z,
                    cov3D_M11_M12_M13.y, cov3D_M22_M23_M33.x, cov3D_M22_M23_M33.y,
                    cov3D_M11_M12_M13.z, cov3D_M22_M23_M33.y, cov3D_M22_M23_M33.z
                );
                float s = 1.0 / (viewCenter.z * viewCenter.z);

                mat3 W = transpose(mat3(modelViewMat));
                mat3 T = orthoZoom > 0.0 ? W : W * mat3(
									focal.x / viewCenter.z, 0., -(focal.x * viewCenter.x) * s,
									0., focal.y / viewCenter.z, -(focal.y * viewCenter.y) * s,
									0., 0., 0.
								);
                mat3 cov2Dm = transpose(T) * Vrk * T;
                cov2Dm[0][0] += 0.3;
                cov2Dm[1][1] += 0.3;

                // We are interested in the upper-left 2x2 portion of the projected 3D covariance matrix because
                // we only care about the X and Y values. We want the X-diagonal, cov2Dm[0][0],
                // the Y-diagonal, cov2Dm[1][1], and the correlation between the two cov2Dm[0][1]. We don't
                // need cov2Dm[1][0] because it is a symetric matrix.
                vec3 cov2Dv = vec3(cov2Dm[0][0], cov2Dm[0][1], cov2Dm[1][1]);

                vec3 ndcCenter = clipCenter.xyz / clipCenter.w;

                // We now need to solve for the eigen-values and eigen vectors of the 2D covariance matrix
                // so that we can determine the 2D basis for the splat. This is done using the method described
                // here: https://people.math.harvard.edu/~knill/teaching/math21b2004/exhibits/2dmatrices/index.html
                //
                // This is a different approach than in the original work at INRIA. In that work they compute the
                // max extents of the 2D covariance matrix in screen space to form an axis aligned bounding rectangle
                // which forms the geometry that is actually rasterized. They then use the inverse 2D covariance
                // matrix (called 'conic') to determine fragment opacity.
                float a = cov2Dv.x;
                float d = cov2Dv.z;
                float b = cov2Dv.y;
                float D = a * d - b * b;
                float trace = a + d;
                float traceOver2 = 0.5 * trace;
                float term2 = sqrt(trace * trace / 4.0 - D);
                float eigenValue1 = traceOver2 + term2;
								float eigenValue2 = max(traceOver2 - term2, 0.00); // prevent negative eigen value

                const float maxSplatSize = 1024.0;
                vec2 eigenVector1 = normalize(vec2(b, eigenValue1 - a));
                // since the eigen vectors are orthogonal, we derive the second one from the first
                vec2 eigenVector2 = vec2(eigenVector1.y, -eigenVector1.x);
                vec2 basisVector1 = eigenVector1 * min(sqrt(2.0 * eigenValue1), maxSplatSize);
                vec2 basisVector2 = eigenVector2 * min(sqrt(2.0 * eigenValue2), maxSplatSize);

                vec2 ndcOffset = vec2(vPosition.x * basisVector1 + vPosition.y * basisVector2) * basisViewport;

								if (orthoZoom > 0.0) {
									ndcOffset *= orthoZoom;
								}

                gl_Position = vec4(ndcCenter.xy + ndcOffset, ndcCenter.z, 1.0);
            }`,i=`
            precision highp float;
            #include <common>

            uniform vec3 debugColor;

            varying vec4 vColor;
            varying vec2 vUv;

            varying vec2 vPosition;
						layout(location = 1) out vec4 gVelocity; 

            void main () {
                // compute the negative squared distance from the center of the splat to the
                // current fragment in the splat's local space.
                float A = -dot(vPosition, vPosition);
                if (A < -4.0) discard;
                vec3 color = vColor.rgb;
                A = exp(A) * vColor.a;
                gl_FragColor = vec4(color.rgb, A);
								gVelocity = vec4(0.0); // so it is ignored by TAA
            }`,r={covariancesTexture:{type:"t",value:null},centersColorsTexture:{type:"t",value:null},meshIndexIntervals:{value:t},meshMatrixWorldsTexture:{type:"t",value:null},focal:{type:"v2",value:new Ae},viewport:{type:"v2",value:new Ae},basisViewport:{type:"v2",value:new Ae},debugColor:{type:"v3",value:new Ai},covariancesTextureSize:{type:"v2",value:new Ae(1024,1024)},centersColorsTextureSize:{type:"v2",value:new Ae(1024,1024)},orthoZoom:{type:"f",value:-1}};return new Tr({uniforms:r,vertexShader:e,fragmentShader:i,transparent:!0,alphaTest:1,blending:g0,depthTest:!0,depthWrite:!1,side:jo})}static buildGeomtery(t){let e=new oi;e.setIndex([0,1,2,0,2,3]);let i=new Float32Array(12),r=new Mi(i,3);e.setAttribute("position",r),r.setXYZ(0,-1,-1,0),r.setXYZ(1,-1,1,0),r.setXYZ(2,1,1,0),r.setXYZ(3,1,-1,0),r.needsUpdate=!0;let n=new zhe().copy(e),s=new Uint32Array(t),a=new PM(s,1,!1);return a.setUsage(B6e),n.setAttribute("splatIndex",a),n.instanceCount=t,n}resetLocalSplatDataAndTexturesFromSplatBuffer(){this.updateLocalSplatDataFromSplatBuffer(),this.allocateAndStoreLocalSplatDataInTextures()}updateLocalSplatDataFromSplatBuffer(){this.splatBuffers.forEach(r=>r.buildPreComputedBuffers()),this.covariances=new Float32Array(this.splatCount*6),this.colors=new Uint8Array(this.splatCount*4),this.centers=new Float32Array(this.splatCount*3);let t=0,e=0,i=0;for(let r of this.splatBuffers){let n=r.nsplats;this.colors.subarray(t,t+n*4).set(r.colorsA),t+=n*4,this.centers.subarray(e,e+n*3).set(r.decoded.xyz.denormDequant().data),e+=n*3,this.covariances.subarray(i,i+n*6).set(new Float32Array(r.precomputedCovarianceBufferData)),i+=n*6}}allocateAndStoreLocalSplatDataInTextures(){let t=this.splatCount,e=new Ae(4096,1024);for(;e.x*e.y*2<t*6;)e.y*=2;let i=new Ae(4096,1024);for(;i.x*i.y*4<t*4;)i.y*=2;let r,n;if(this.halfPrecisionCovariancesOnGPU){n=new Uint16Array(e.x*e.y*2);for(let u=0;u<this.covariances.length;u++)n[u]=mqe.toHalfFloat(this.covariances[u]);r=new yl(n,e.x,e.y,BD,qp)}else n=new Float32Array(e.x*e.y*2),n.set(this.covariances),r=new yl(n,e.x,e.y,BD,cn);r.needsUpdate=!0,this.material.uniforms.covariancesTexture.value=r,this.material.uniforms.covariancesTextureSize.value.copy(e);let s=new Uint32Array(i.x*i.y*4);for(let u=0;u<t;u++){let h=u*4,d=u*3,f=u*4;s[f]=Gdt(this.colors[h],this.colors[h+1],this.colors[h+2],this.colors[h+3]),s[f+1]=f4(this.centers[d]),s[f+2]=f4(this.centers[d+1]),s[f+3]=f4(this.centers[d+2])}let a=new yl(s,i.x,i.y,ihe,Ap);a.internalFormat="RGBA32UI",a.needsUpdate=!0,this.material.uniforms.centersColorsTexture.value=a,this.material.uniforms.centersColorsTextureSize.value.copy(i);let o=256*4,l=new Float32Array(256*16);for(let u=0;u<this.meshMatrixWorlds.length;u++)l.set(this.meshMatrixWorlds[u].elements,u*16);let c=new yl(l,o,1,Vn,cn);c.needsUpdate=!0,this.material.uniforms.meshMatrixWorldsTexture.value=c,this.material.uniformsNeedUpdate=!0,this.splatDataTextures={covariances:{data:n,texture:r,size:e},centerColors:{data:s,texture:a,size:i},meshMatrixWorlds:{data:l,texture:c}}}updateIndexes(t){let e=this.geometry;e.attributes.splatIndex.set(t),e.attributes.splatIndex.needsUpdate=!0,e.instanceCount=t.length}updateUniforms(t,e,i,r){this.splatCount>0&&(IR.set(t.x*this.devicePixelRatio,t.y*this.devicePixelRatio),this.material.uniforms.viewport.value.copy(IR),this.material.uniforms.basisViewport.value.set(2/IR.x,2/IR.y),this.material.uniforms.focal.value.set(e,i),this.material.uniforms.orthoZoom.value=r,this.material.uniformsNeedUpdate=!0)}getSplatDataTextures(){return this.splatDataTextures}getSplatCount(){return this.splatCount}getCenters(){return this.centers}getColors(){return this.colors}getCovariances(){return this.covariances}dispose(){this.geometry.dispose(),this.material.dispose(),this.splatDataTextures&&(this.splatDataTextures.covariances.texture.dispose(),this.splatDataTextures.centerColors.texture.dispose(),this.splatDataTextures.meshMatrixWorlds.texture.dispose()),this.removeFromParent()}},Sme,Wdt=new Promise(t=>{Sme=t}),pie=!1,DR;function qdt(){if(pie)return;if(DR)return DR;async function t(){let e=await Bc(()=>import("./gaussian-splat-compression-CH16aANn.js"),[]);Sme(e),pie=!0}return DR=t(),DR}var Eme;Wdt.then(t=>Eme=t);var Xdt=class{constructor(t={}){HE(this,"updateView",(function(){let e=new St,i=[],r=new W(0,0,-1),n=new W(0,0,-1),s=new W,a=new W;return function(o=!1,l){let c=this.updateMatrixWorldsInWorkerIfNeeded(),u=this.cropsChanged();if(!o){n.set(0,0,-1).applyQuaternion(l.quaternion);let d=!1,f=!1;if(n.dot(r)<=.95&&(d=!0),a.copy(l.position).sub(s).length()>=1&&(f=!0),!d&&!f&&!c&&!u&&!this.needsInitialRender)return}this.needsInitialRender=!1,s.copy(l.position),r.copy(n),e.copy(l.matrixWorld).invert(),e.premultiply(this.dummyPerspectiveMatrix),i[0]=l.position.x,i[1]=l.position.y,i[2]=l.position.z;let h={sort:{view:e.elements,cameraPosition:i,splatRenderCount:this.splatRenderCount,splatSortCount:this.splatRenderCount},...c?{newMatrixWorlds:this.meshMatrixWorlds}:{},...u?{newCropsArray:this.cropsArray}:{}};this.sortRunning?this.queuedMessage=h:(this.queuedMessage=null,this.sortRunning=!0,this.sortWorker.postMessage(h))}})()),this.scene=t.scene,this.currentPage=null,this.devicePixelRatio=window.devicePixelRatio,this.sortWorker=null,this.splatRenderCount=0,this.splatSortCount=0,this.splatMesh=null,this.sortRunning=!1,this.meshMatrixWorlds=null,this.meshMatrixWorldsOld=null,this.cropsArray=null,this.splatEntries=null,this.queuedMessage=null,this.needsInitialRender=!0,this.dummyPerspectiveMatrix=new St().makePerspective(-1,1,-1,1,.1,1e3)}updateSplatMeshUniforms(t,e){let i=new Ae;this.splatMesh!==null&&this.splatMesh.getSplatCount()>0&&(t.getSize(i),this.cameraFocalLengthX=e.projectionMatrix.elements[0]*this.devicePixelRatio*i.x*.45,this.cameraFocalLengthY=e.projectionMatrix.elements[5]*this.devicePixelRatio*i.y*.45,this.splatMesh.updateUniforms(i,this.cameraFocalLengthX,this.cameraFocalLengthY,e.isPerspectiveCamera?-1:e.zoom*this.devicePixelRatio))}loadSplat(t={}){this.activePage=this.scene.activePage,t.position&&(t.position=new W().fromArray(t.position)),t.orientation&&(t.orientation=new Ii().fromArray(t.orientation)),t.halfPrecisionCovariances=!!t.halfPrecisionCovariances;let e=[];if(this.splatEntries=e,this.activePage.traverseVisibleEntity(s=>{s.data.type==="Splat"&&e.push(s)}),this.splatMesh&&this.splatMesh.dispose(),e.length===0)return this.splatMesh=null,!1;this.meshMatrixWorlds=e.map(s=>s.matrixWorld),this.meshMatrixWorldsOld=e.map(s=>s.matrixWorld.clone()),this.cropsArray=e.map(s=>s.data.crops.map(a=>a.data));let i=e.map(s=>new Eme.GSplineBuffer(new Uint8Array(s.data.buffer).buffer)),r=0,n=[0];for(let s of i)r+=s.getSplatCount(),n.push(r);return this.setupSplatMesh(i,r,t.position,t.orientation,t.halfPrecisionCovariances,this.devicePixelRatio,n,this.meshMatrixWorlds),this.setupSortWorker(r),!0}updateMatrixWorldsInWorkerIfNeeded(){let t=this.splatDataTextures.meshMatrixWorlds.data;for(let e=0;e<this.meshMatrixWorlds.length;e++)t.set(this.meshMatrixWorlds[e].elements,e*16);return this.splatDataTextures.meshMatrixWorlds.texture.needsUpdate=!0,this.meshMatrixWorlds.every((e,i)=>e.equals(this.meshMatrixWorldsOld[i]))?!1:(this.meshMatrixWorldsOld=this.meshMatrixWorlds.map(e=>e.clone()),!0)}cropsChanged(){let t=!1;return this.splatEntries.forEach((e,i)=>{e.data.crops.forEach((r,n)=>{this.cropsArray[i][n]===void 0?(t=!0,this.cropsArray[i][n]=r.data):Object.entries(r.data).forEach(([s,a])=>{Array.isArray(a)&&a.some((o,l)=>o!==this.cropsArray[i][n][s][l])?(t=!0,this.cropsArray[i][n][s]=a):a!==this.cropsArray[i][n]?.[s]&&(t=!0,this.cropsArray[i][n][s]=a)})}),e.data.crops.length!==this.cropsArray[i]?.length&&(this.cropsArray[i].length=e.data.crops.length,t=!0)}),t}setupSplatMesh(t,e,i=new W,r=new Ii,n=!1,s=1,a,o){this.splatMesh=pI.buildMesh(t,e,n,s,a,o),this.splatMesh.position.copy(i),this.splatMesh.quaternion.copy(r),this.splatMesh.frustumCulled=!1,this.splatMesh.renderOrder=99999,this.splatRenderCount=e,this.splatMesh.onBeforeRender=(l,c,u)=>this.update(l,u)}setupSortWorker(t){this.sortWorker=Hdt(t),this.sortWorker.onmessage=e=>{e.data.sortDone?(this.sortRunning=!1,this.splatMesh?.updateIndexes(new Uint32Array(e.data.indexesBuffer)),this.lastSortTime=e.data.sortTime,this.queuedMessage&&(this.sortWorker.postMessage(this.queuedMessage),this.queuedMessage=null)):e.data.sortCanceled?this.sortRunning=!1:e.data.sortSetupPhase1Complete?this.sortWorker.postMessage({positions:this.splatMesh.getCenters().buffer,meshMatrixWorlds:this.splatMesh.meshMatrixWorlds,meshIndexIntervals:this.splatMesh.meshIndexIntervals,cropsArray:this.cropsArray}):e.data.sortSetupComplete&&(this.splatDataTextures=this.splatMesh.getSplatDataTextures(),this.scene.activePage.add(this.splatMesh),this.needsInitialRender=!0)}}update(t,e){this.splatMesh!==null&&(this.updateSplatMeshUniforms(t,e),this.updateView(!1,e))}getSplatMesh(){return this.splatMesh}},dV=new Xp;dV.wireframe=!0;var mie=new W,A8=class extends ac{constructor(t,e){super(),this.data=t,this.sharedAssets=e,this.enableHelpers=!1,this.wireframeState=!1,this.needsTransmissionDirty=!0,this.needsNormalDirty=!0,this._needsTransmission=!1,this._needsNormal=!1,this.geometryCacheChanged=!1,this.splatViewer=null,this.shapeBlendIntances=[],this.entityByUuid={},this.entityIdentityToEntity={},this.toExpandCloner=new Set,this.toUpdateCloner=new Set,this.pendingCommands=[],this.pathConstraints=new zdt,this.invisibleObjects=new m1("jflkdsafjasdifjaslk",{...g5.defaultData,visible:!1,name:"buildin invisible"}),this.needsRecomputeInstances=!1,this.init(t,e),this.matrixAutoUpdate=!1,this.errorPage=new Fa("fdasfa",{...Q1.defaultData,name:""},{shared:e,scene:this})}markGeometryCacheDirty(){this.geometryCacheChanged=!0}markNeedsUpdateRendererDirty(){this.needsTransmissionDirty=!0,this.needsNormalDirty=!0}needsTransmission(){return this.needsTransmissionDirty&&(this._needsTransmission=Ndt(this),this.needsTransmissionDirty=!1),this._needsTransmission}needsNormal(){return this.needsNormalDirty&&(this._needsNormal=kdt(this),this.needsNormalDirty=!1),this._needsNormal}registerInstanceAndSetUuid(t){let e=t.identity.join("-"),i=this.entityIdentityToEntity[e];i&&(t.uuid=i.uuid),this.entityIdentityToEntity[e]=t,this.entityByUuid[t.uuid]=t}markPenumbraSizeDirty(){for(let t of this.children)t instanceof Fa&&(t.penumbraSizeArrayCache=null)}findInstance(t){return this.entityIdentityToEntity[t.join("-")]}get bgColor(){return this.activePage.bgColor}get postprocessing(){return this.activePage.data.postprocessing}getWithSortKey(t){let e=this.find(t);if(e===void 0)return;let i=[],r=e;for(;r!==this;){let n=r;r=r.parent;let s=r.children.indexOf(n);i.splice(0,0,s)}return{entity:e,sortKey:i}}getAllSorted(t){let e=[];for(let i of t){let r=this.getWithSortKey(i.id);r!==void 0&&e.push(r)}return e.sort((i,r)=>Bde(i.sortKey,r.sortKey)),e.map(i=>i.entity)}nonExistOrDescendantOf(t,e){let i=this.find(t);if(i===void 0)return!0;for(;i;){if(i.uuid===e)return!0;i=i.parent}return!1}find(t){if(this.activePage&&this.activePage.personalCamera.parent){if(t==="f23858d0-4a3b-4bd8-8173-66ed0af7f6fb-personalCamera")return this.activePage.personalCamera;if(t===N_)return this.activePage.personalCamera}if(t===""||t===void 0)return;let e=this.entityByUuid[t];return e===void 0?this.getObjectByProperty("uuid",t):e}find2D(t){for(let e of this.children)if(e instanceof Fa&&e.uiScene){let i=e.uiScene.find(t);if(i)return i}}findScene2DfromObject2D(t){for(let e of this.children)if(e instanceof Fa&&e.uiScene&&e.uiScene.find(t))return e.uiScene}find2DInUIObjects(t){let e;return this.traverseEntity(i=>{e===void 0&&i instanceof Fo&&(e=i.uiCanvas.find(t))}),e}traverse2D(t){for(let e of this.children)e instanceof Fa&&e.uiScene&&e.uiScene.traverse(t)}debugEnsureEntity(t){let e=this.find(t);if(e){if(Array.isArray(e.identity)&&this.findInstance(e.identity)===void 0){console.error("not found instance");debugger}}else{console.error("not found");debugger}}addPendingExpandCloner(t){this.toExpandCloner.add(t)}addPendingUpdateCloner(t){this.toUpdateCloner.add(t)}markToExpandCloner(t){this.toExpandCloner.add(t),t.traverseEntityAncestors(e=>{this.toExpandCloner.add(e)})}doPendingExpandCloner(){this.toExpandCloner.forEach(t=>{t.expandCloner(this)}),this.toExpandCloner.clear()}doPendingUpdateCloner(){this.toUpdateCloner.forEach(t=>{t.cloner?.update()}),this.toUpdateCloner.clear()}doPendingUpdates(){this.doPendingExpandCloner(),this.doPendingUpdateCloner(),this.applyPendingCommands()}addPendingCommand(t){this.pendingCommands.push(t)}applyPendingCommands(){this.pendingCommands.forEach(t=>t()),this.pendingCommands.length=0}updateByLibOp(t,e){t.path.length===1&&t.path[0]==="components"&&t.type===1&&this.createChildrenObjects([{...t.data.asset,id:t.id}],this.invisibleObjects,e)}updateTreeByOp(t,e){if(t.path.length===0&&t.type===7){let i=t.parent===null?this:this.find(t.parent);if(i===void 0)throw new Error("unexpected");let r=this.createObject(t.id,t.data,t.children,i,t.localIndex,e);r.updateVisible(this),r.resetBBoxNeedsUpdate(),Cd(r)&&Pp(r.parent)&&(r.invalidateUpstreamBooleanData(),r.parent.invalidateDownstreamBooleanData().recomputeBoolean()),this.markNeedsRecomputeInstancesForAncessors(i),this.markNeedsRecomputeInstancesForChildren(r),this.markToExpandCloner(r),this.markPenumbraSizeDirty(),r.updatePathSnapping()}else if(t.path.length===0&&t.type===8){let i=this.find(t.id);if(i===void 0)throw new Error("unexpected");i.traverseEntity(n=>{n instanceof V0&&(this.shapeBlendIntances=this.shapeBlendIntances.filter(s=>s!==n))}),this.markToExpandCloner(i),i.resetBBoxNeedsUpdate(),this.unregisterObject(i);let r=i.parent;this.markNeedsRecomputeInstancesForAncessors(r),this.markNeedsRecomputeInstancesForChildren(i),this.markPenumbraSizeDirty(),i.parent.remove(i),Pp(i.parent)&&(i.parent.invalidateUpstreamBooleanData(),i.parent.invalidateDownstreamBooleanData().recomputeBoolean()),Cd(i)&&(i.freeBooleanPointer(),r instanceof j0&&r.invalidateDownstreamBooleanData().recomputeBoolean()),i instanceof LL&&i.detachShape(),this.disposeAndUnregisterEntityRecursivelyIfNotReregistered(i),this.pathConstraints.removeDependencies(i.uuid),i.updatePathSnapping()}else if(t.path.length===0&&t.type===9){let i=this.find(t.id);if(i===void 0)throw new Error("unexpected");this.markNeedsRecomputeInstancesForChildren(i);let r=i.parent;this.markNeedsRecomputeInstancesForAncessors(r),i.cloner?.resetOnMove(),this.markToExpandCloner(i);let n=t.parent===null?this:this.find(t.parent);if(n===void 0)throw new Error("unexpected");n.add(i),this.markNeedsRecomputeInstancesForAncessors(n),this.markToExpandCloner(i),i.invalidateClonerTransform(i),i.updateVisible(this),i.resetBBoxNeedsUpdate(),this.markPenumbraSizeDirty();let s=t.localIndex;n.children.splice(s,0,n.children.pop()),Cd(i)&&(i.invalidateUpstreamBooleanData(),Pp(i.parent)?i.parent.invalidateDownstreamBooleanData().recomputeBoolean():r instanceof j0&&r.invalidateDownstreamBooleanData().recomputeBoolean()),i.updatePathSnapping()}this.markNeedsUpdateRendererDirty(),this.markGeometryCacheDirty()}get playPage(){return this.find(this.data.publish.playPage)??this.errorPage}updatePage(t){this.activePage&&this.activePage.onDeactive(),this.activePage=this.errorPage;for(let e of this.children)e instanceof Fa&&(e.visible=e.uuid===t,e.visible&&(this.activePage=e,this.activePage.onActive(this)));this.activePage!==this.splatViewer?.activePage&&this.reloadSplats()}updateEntityByOp(t,e,i,r){if(e.type===0){if(("overrides"in e.props||"component"in e.props)&&this.markNeedsRecomputeInstances(),"visible"in e.props&&this.markPenumbraSizeDirty(),e.path.includes("overrides")&&"states"in e.props){let{rest:s}=e.props;e={...e,props:s},this.markNeedsRecomputeInstances()}e.path[0]==="pathSnapping"&&e.props.pathId!==void 0&&this.pathConstraints.setConstraint(t,e.props.pathId)}let n=this.find(t);if(n)try{Tdt(n,e,i,{scene:this,shared:r}),n instanceof bs&&n.updateGeometryGroupsIfNeeded()}catch(s){console.error(s)}}updateEntity2DByOp(t,e,i,r,n,s=[]){t.updateEntityByOp(e,i,r,n),this.traverseEntity(a=>{(a instanceof Fo||a instanceof Fa)&&(s.includes(a.frameId??"")||a.frameId===e)&&a.updateEntity2DByOp(e,i,r,n)})}get activeCamera(){return this.activePage.activeCamera}switchActiveCamera(t){this.activePage.switchActiveCamera(t)}isInvisibleObjects(t){return t===this.invisibleObjects||t.hasAnccestor(this.invisibleObjects)}init(t,e){let i=Object.entries(e.data.lib.components).map((r,n)=>({data:r[1].asset.data,children:r[1].asset.children,id:r[0],fi:n}));this.invisibleObjects.updateState(this.invisibleObjects.data,{scene:this,shared:e}),this.add(this.invisibleObjects),this.createChildrenObjects(i,this.invisibleObjects,e),this.createChildrenObjects(t.objects,this,e),this.updatePage(t.publish.playPage),this.activePage.switchToPlayCamera(),this.expandInstances(e,!0),this.traverseEntity(r=>{r instanceof Gs&&r.updateUp()}),this.doPendingExpandCloner(),this.applyPendingCommands()}markNeedsRecomputeInstances(){this.needsRecomputeInstances=!0}markNeedsRecomputeInstancesForChildren(t){t.traverseEntity(e=>{(e.data.type==="Component"||e.data.type==="Instance")&&this.markNeedsRecomputeInstances()})}markNeedsRecomputeInstancesForAncessors(t){Er.is(t)&&(t.data.type==="Component"&&this.markNeedsRecomputeInstances(),t.traverseAncestors(e=>{Er.is(e)&&e.data.type==="Component"&&this.markNeedsRecomputeInstances()}))}relativeizeInner(t,e,i,r,n,s,a){if(t){let o=r.find(t);o&&o!==r&&n.forInstancesRec(l=>{l.data=FM(l.data,c=>{let u=c.events.data(a.id),h=l.goUp(s);if(h){let d=[...Ude(h.identity),t].join("-"),f=this.entityIdentityToEntity[d];if(f){let p=f.uuid,g=fa.zoom(u,e);g[i]=p}else console.warn("cannot find instance")}}).data})}}rewriteActions(t,e,i,r,n,s){t.forEach(a=>{a.data.type==="Transition"?this.relativeizeInner(a.data.object,[...e,a.id],"object",i,r,n,s):a.data.type==="Animation"?this.relativeizeInner(a.data.object,[...e,a.id],"object",i,r,n,s):a.data.type==="Conditional"&&(this.rewriteActions(a.data.ifActions,[...e,a.id,"ifActions"],i,r,n,s),this.rewriteActions(a.data.elseActions,[...e,a.id,"elseActions"],i,r,n,s))})}rewriteEventsBeforeGoToPlayMode(){this.traverseEntity(t=>{if(t instanceof g1&&typeof t.identity=="string"&&t.data.type==="Component")return t.traverseEntity((e,i)=>{e.data.events.forEach(r=>{if(r.data.type==="GameControl"){let n=!1;if(e.forInstancesRec(s=>{s.data=FM(s.data,a=>{s.isInstanceRoot||(a.events.delete(r.id),n=!0)}).data}),n===!1)for(let s of _3.list)this.rewriteActions(r.data.gameActions[s],["gameActions",s],t,e,i,r)}else r.data.type==="Conditional"?(r.data.condition.type==="Distance"?(this.relativeizeInner(r.data.condition.fromObject,["condition"],"fromObject",t,e,i,r),this.relativeizeInner(r.data.condition.toObject,["condition"],"toObject",t,e,i,r)):r.data.condition.type==="State"?this.relativeizeInner(r.data.condition.object,["condition"],"object",t,e,i,r):r.data.condition.type==="Comparison"&&(r.data.condition.lOperand.type==="Property"&&this.relativeizeInner(r.data.condition.lOperand.value[0],["condition","lOperand","value"],0,t,e,i,r),r.data.condition.rOperand.type==="Property"&&this.relativeizeInner(r.data.condition.rOperand.value[0],["condition","rOperand","value"],0,t,e,i,r)),this.rewriteActions(r.data.inActions,["inActions"],t,e,i,r),this.rewriteActions(r.data.outActions,["outActions"],t,e,i,r)):"actions"in r.data&&this.rewriteActions(r.data.actions,["actions"],t,e,i,r)})}),!0})}expandInstances(t,e,i){let r=new Set;this.traverseEntity(n=>{if(n instanceof g1&&n.isInstanceRoot)return n.expandInstanceChildren({scene:this,shared:t,pendingDeletes:r}),e||n.resetBBoxNeedsUpdate(),i&&n.traverseEntity(s=>{i.addClip(s)}),!0});for(let n of r)this.disposeAndUnregisterEntityRecursivelyIfNotReregistered(n),S8(n)}recomputeInstances(t,e){this.needsRecomputeInstances&&(this.needsRecomputeInstances=!1,this.traverseEntity(i=>{i instanceof g1&&i.isInstanceRoot&&(i.component=void 0)}),this.expandInstances(t,!1,e))}disposeAndUnregisterEntityRecursivelyIfNotReregistered(t){t.traverseEntity(e=>{let i=typeof e.identity=="string"?e.identity:e.identity.join("-");this.entityIdentityToEntity[i]===e&&(delete this.entityByUuid[e.uuid],delete this.entityIdentityToEntity[i]),e.dispose()})}clearScene(){for(let t of this.children)Er.is(t)&&t.disposeRecursively();this.children.length=0}resetAfterClear(t,e){this.init(t,e)}raycast(t){return this.raycast1(t,!1)}raycast1(t,e){let i=[],r=n=>{for(let s of n.children){let a=s.cloner;if(Er.is(s)&&!s.raycastLock&&(s.visible||a?.object.data.visible))if(e===!0&&s.isInstanceRoot){let o=[];if(t.intersectObject(s,!0,o),o.length){let l=o[0];l.object=s,l.point.applyMatrix4(l.object.matrixWorld);let c=s.matrixWorld.clone().invert();l.point.applyMatrix4(c),i.push(l)}}else(Cd(s)||eV(s)&&this.enableHelpers&&s.objectHelper.visible)&&(t.intersectObject(s,!1,i),hV(s,t,i)),r(s)}};return r(this.activePage),i}raycastWithClones(t){let e=[],i=r=>{for(let n of r.children){let s=n.cloner;Er.is(n)&&(n.visible||s?.object.data.visible)&&((Cd(n)||eV(n)&&this.enableHelpers&&n.objectHelper.visible)&&(t.intersectObject(n,!1,e),hV(n,t,e,!0)),i(n))}};return i(this),e}forEachEntity(t){for(let e of this.children)Er.is(e)&&t(e)}traverseConcreteEntity(t){for(let e of this.children)Er.is(e)&&e.isConcreteEntity&&e.traverseEntity(t)}traverseEntity(t){for(let e of this.children)Er.is(e)&&e.traverseEntity(t)}updateFont(t,e){this.traverseEntity(i=>{if(i instanceof bs&&i.data.type==="Mesh"&&(i.data.geometry.type==="TextGeometry"||i.data.geometry.type==="InputGeometry")&&i.data.geometry.font===t){let r=i.geometry,n=i.data.geometry;r.updateFont(t,e).then(()=>{r.update(n,e);let s=i.invalidateDownstreamBooleanData();Pp(s)&&s.recomputeBoolean()})}})}traverseObject(t){for(let e of this.children)F0.is(e)&&e.traverseObject(t)}traverseVisibleEntity(t){for(let e of this.children)Er.is(e)&&e.visible&&e.traverseVisibleEntity(t)}dispose(){this.clearScene()}createChildrenObjects(t,e,i){let r=0;for(let n of t)this.createObject(n.id,n.data,n.children,e,r,i),r+=1}registerObjectCreatedInLegacy(t){this.entityByUuid[t.uuid]=t}unregisterObject(t){delete this.entityByUuid[t.uuid];for(let e of t.children)this.unregisterObject(e)}createObject(t,e,i,r,n,s){let a={scene:this,shared:s},o=E8(t,e,a);return o instanceof V0&&this.shapeBlendIntances.push(o),o&&(this.entityByUuid[t]=o,r.add(o),r.children.splice(n,0,r.children.pop()),i.length>0&&(o.isInstanceRoot?console.error("instance should not have children!"):this.createChildrenObjects(i,o,s)),o.updateState(e,a),o instanceof bs&&o.updateGeometryGroupsIfNeeded(),o.updateVisible(this),o.cloner&&this.toExpandCloner.add(o),e.pathSnapping?.pathId&&this.pathConstraints.setConstraint(t,e.pathSnapping.pathId)),e.type==="Empty"&&e.animations&&o.traverseEntity(l=>{let c=l.dataPatched;if(l instanceof bs&&c.bones&&c.boneInverses){let u=c.bones.map(f=>this.find(f)),h=c.boneInverses.map(f=>new St().fromArray(f)),d=new $H(u,h);l.bind(d,l.bindMatrix)}else l.matrixAutoUpdate=!0}),o}getCenter(t){let e=[];for(let r=0,n=t.length;r<n;++r){let{id:s,recursive:a}=t[r],o=this.find(s),l=a?o.recursiveBBox:o.singleBBox;e.push(...l.vertices)}let i=new Ss;return i.setFromPoints(e),i.getCenter(mie),mie}copyMatrixWorld(t,e){if(t===null){e.identity();return}let i=this.find(t);i?e.copy(i.matrixWorld):e.identity()}copyParentMatrixWorld(t,e){if(t===null){e.identity();return}let i=this.find(t)?.parent;i?e.copy(i.matrixWorld):e.identity()}traverseMaterial(t){this.traverseEntity(e=>{if(e instanceof So)if(Array.isArray(e.material))for(let i=0;i<e.material.length;i++)e.material[i]instanceof Qp&&t(e.material[i]);else e.material instanceof Qp&&t(e.material)})}updateViewPlaneSize(t,e,i=!1){this.traverseConcreteEntity(r=>{r instanceof Gs&&r.setViewplaneSize(t,e,i)})}initializeSplatViewer(){this.splatViewer=new Xdt({scene:this}),this.reloadSplats()}reloadSplats(){this.splatViewer?.loadSplat()}},mI=(t,e)=>{let i=e.x-t.x,r=e.y-t.y;return Math.sqrt(i*i+r*r)},$dt=(t,e)=>{let i=e.x-t.x,r=e.y-t.y;return Kdt(Math.atan2(r,i))},Ydt=(t,e,i)=>{let r={x:0,y:0};return i=fV(i),r.x=t.x-e*Math.cos(i),r.y=t.y-e*Math.sin(i),r},fV=t=>t*(Math.PI/180),Kdt=t=>t*(180/Math.PI),Zdt=t=>isNaN(t.buttons)?t.pressure!==0:t.buttons!==0,p4=new Map,gie=t=>{p4.has(t)&&clearTimeout(p4.get(t)),p4.set(t,setTimeout(t,100))},H3=(t,e,i)=>{let r=e.split(/[ ,]+/g),n;for(let s=0;s<r.length;s+=1)n=r[s],t.addEventListener?t.addEventListener(n,i,!1):t.attachEvent&&t.attachEvent(n,i)},vie=(t,e,i)=>{let r=e.split(/[ ,]+/g),n;for(let s=0;s<r.length;s+=1)n=r[s],t.removeEventListener?t.removeEventListener(n,i):t.detachEvent&&t.detachEvent(n,i)},Ame=t=>(t.preventDefault(),t.type.match(/^touch/)?t.changedTouches:t),yie=()=>{if(typeof window>"u")return;let t=window.pageXOffset!==void 0?window.pageXOffset:(document.documentElement||document.body.parentNode||document.body).scrollLeft,e=window.pageYOffset!==void 0?window.pageYOffset:(document.documentElement||document.body.parentNode||document.body).scrollTop;return{x:t,y:e}},pV=(t,e)=>{e.top||e.right||e.bottom||e.left?(t.style.top=e.top,t.style.right=e.right,t.style.bottom=e.bottom,t.style.left=e.left):(t.style.left=e.x+"px",t.style.top=e.y+"px")},M8=(t,e,i)=>{let r=Mme(t);for(let n in r)if(r.hasOwnProperty(n))if(typeof e=="string")r[n]=e+" "+i;else{let s="";for(let a=0,o=e.length;a<o;a+=1)s+=e[a]+" "+i+", ";r[n]=s.slice(0,-2)}return r},Qdt=(t,e)=>{let i=Mme(t);for(let r in i)i.hasOwnProperty(r)&&(i[r]=e);return i},Mme=t=>{let e={};return e[t]="",["webkit","Moz","o"].forEach(function(i){e[i+t.charAt(0).toUpperCase()+t.slice(1)]=""}),e},m4=(t,e)=>{for(let i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);return t},Jdt=(t,e)=>{let i={};for(let r in t)t.hasOwnProperty(r)&&e.hasOwnProperty(r)?i[r]=e[r]:t.hasOwnProperty(r)&&(i[r]=t[r]);return i},mV=(t,e)=>{if(t.length)for(let i=0,r=t.length;i<r;i+=1)e(t[i]);else e(t)},eft=(t,e,i)=>({x:Math.min(Math.max(t.x,e.x-i),e.x+i),y:Math.min(Math.max(t.y,e.y-i),e.y+i)});typeof window<"u"&&(Tme="ontouchstart"in window,Cme=!!window.PointerEvent,Pme=!!window.MSPointerEvent);var Tme,Cme,Pme,TE={touch:{start:"touchstart",move:"touchmove",end:"touchend, touchcancel"},mouse:{start:"mousedown",move:"mousemove",end:"mouseup"},pointer:{start:"pointerdown",move:"pointermove",end:"pointerup, pointercancel"},MSPointer:{start:"MSPointerDown",move:"MSPointerMove",end:"MSPointerUp"}},Jw,KM={};Cme?Jw=TE.pointer:Pme?Jw=TE.MSPointer:Tme?(Jw=TE.touch,KM=TE.mouse):Jw=TE.mouse;function J0(){}J0.prototype.on=function(t,e){var i=this,r=t.split(/[ ,]+/g),n;i._handlers_=i._handlers_||{};for(var s=0;s<r.length;s+=1)n=r[s],i._handlers_[n]=i._handlers_[n]||[],i._handlers_[n].push(e);return i};J0.prototype.off=function(t,e){var i=this;return i._handlers_=i._handlers_||{},t===void 0?i._handlers_={}:e===void 0?i._handlers_[t]=null:i._handlers_[t]&&i._handlers_[t].indexOf(e)>=0&&i._handlers_[t].splice(i._handlers_[t].indexOf(e),1),i};J0.prototype.trigger=function(t,e){var i=this,r=t.split(/[ ,]+/g),n;i._handlers_=i._handlers_||{};for(var s=0;s<r.length;s+=1)n=r[s],i._handlers_[n]&&i._handlers_[n].length&&i._handlers_[n].forEach(function(a){a.call(i,{type:n,target:i},e)})};J0.prototype.config=function(t){var e=this;e.options=e.defaults||{},t&&(e.options=Jdt(e.options,t))};J0.prototype.bindEvt=function(t,e){var i=this;return i._domHandlers_=i._domHandlers_||{},i._domHandlers_[e]=function(){typeof i["on"+e]=="function"?i["on"+e].apply(i,arguments):console.warn('[WARNING] : Missing "on'+e+'" handler.')},H3(t,Jw[e],i._domHandlers_[e]),KM[e]&&H3(t,KM[e],i._domHandlers_[e]),i};J0.prototype.unbindEvt=function(t,e){var i=this;return i._domHandlers_=i._domHandlers_||{},vie(t,Jw[e],i._domHandlers_[e]),KM[e]&&vie(t,KM[e],i._domHandlers_[e]),delete i._domHandlers_[e],this};var T8=J0;function _a(t,e){return this.identifier=e.identifier,this.position=e.position,this.frontPosition=e.frontPosition,this.collection=t,this.defaults={size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:1,mode:"dynamic",zone:document.body,lockX:!1,lockY:!1,shape:"circle"},this.config(e),this.options.mode==="dynamic"&&(this.options.restOpacity=0),this.id=_a.id,_a.id+=1,this.buildEl().stylize(),this.instance={el:this.ui.el,on:this.on.bind(this),off:this.off.bind(this),show:this.show.bind(this),hide:this.hide.bind(this),add:this.addToDom.bind(this),remove:this.removeFromDom.bind(this),destroy:this.destroy.bind(this),setPosition:this.setPosition.bind(this),resetDirection:this.resetDirection.bind(this),computeDirection:this.computeDirection.bind(this),trigger:this.trigger.bind(this),position:this.position,frontPosition:this.frontPosition,ui:this.ui,identifier:this.identifier,id:this.id,options:this.options},this.instance}_a.prototype=new T8;_a.constructor=_a;_a.id=0;_a.prototype.buildEl=function(t){return this.ui={},this.options.dataOnly?this:(this.ui.el=document.createElement("div"),this.ui.back=document.createElement("div"),this.ui.front=document.createElement("div"),this.ui.el.className="nipple collection_"+this.collection.id,this.ui.back.className="back",this.ui.front.className="front",this.ui.el.setAttribute("id","nipple_"+this.collection.id+"_"+this.id),this.ui.el.appendChild(this.ui.back),this.ui.el.appendChild(this.ui.front),this)};_a.prototype.stylize=function(){if(this.options.dataOnly)return this;var t=this.options.fadeTime+"ms",e=Qdt("borderRadius","50%"),i=M8("transition","opacity",t),r={};return r.el={position:"absolute",opacity:this.options.restOpacity,display:"block",zIndex:999},r.back={position:"absolute",display:"block",width:this.options.size+"px",height:this.options.size+"px",marginLeft:-this.options.size/2+"px",marginTop:-this.options.size/2+"px",background:"rgba(255, 255, 255, .4)",border:"solid 2px rgba(0, 0, 0, .1)"},r.front={width:this.options.size/2+"px",height:this.options.size/2+"px",position:"absolute",display:"block",marginLeft:-this.options.size/4+"px",marginTop:-this.options.size/4+"px",background:"rgba(255, 255, 255, .8)",border:"solid 2px rgba(0, 0, 0, .1)"},m4(r.el,i),this.options.shape==="circle"&&m4(r.back,e),m4(r.front,e),this.applyStyles(r),this};_a.prototype.applyStyles=function(t){for(var e in this.ui)if(this.ui.hasOwnProperty(e))for(var i in t[e])this.ui[e].style[i]=t[e][i];return this};_a.prototype.addToDom=function(){return this.options.dataOnly||document.body.contains(this.ui.el)?this:(this.options.zone.appendChild(this.ui.el),this)};_a.prototype.removeFromDom=function(){return this.options.dataOnly||!document.body.contains(this.ui.el)?this:(this.options.zone.removeChild(this.ui.el),this)};_a.prototype.destroy=function(){clearTimeout(this.removeTimeout),clearTimeout(this.showTimeout),clearTimeout(this.restTimeout),this.trigger("destroyed",this.instance),this.removeFromDom(),this.off()};_a.prototype.show=function(t){var e=this;return e.options.dataOnly||(clearTimeout(e.removeTimeout),clearTimeout(e.showTimeout),clearTimeout(e.restTimeout),e.addToDom(),e.restCallback(),setTimeout(function(){e.ui.el.style.opacity=1},0),e.showTimeout=setTimeout(function(){e.trigger("shown",e.instance),typeof t=="function"&&t.call(this)},e.options.fadeTime)),e};_a.prototype.hide=function(t){var e=this;if(e.options.dataOnly)return e;if(e.ui.el.style.opacity=e.options.restOpacity,clearTimeout(e.removeTimeout),clearTimeout(e.showTimeout),clearTimeout(e.restTimeout),e.removeTimeout=setTimeout(function(){var i=e.options.mode==="dynamic"?"none":"block";e.ui.el.style.display=i,typeof t=="function"&&t.call(e),e.trigger("hidden",e.instance)},e.options.fadeTime),e.options.restJoystick){let i=e.options.restJoystick,r={};r.x=i===!0||i.x!==!1?0:e.instance.frontPosition.x,r.y=i===!0||i.y!==!1?0:e.instance.frontPosition.y,e.setPosition(t,r)}return e};_a.prototype.setPosition=function(t,e){var i=this;i.frontPosition={x:e.x,y:e.y};var r=i.options.fadeTime+"ms",n={};n.front=M8("transition",["top","left"],r);var s={front:{}};s.front={left:i.frontPosition.x+"px",top:i.frontPosition.y+"px"},i.applyStyles(n),i.applyStyles(s),i.restTimeout=setTimeout(function(){typeof t=="function"&&t.call(i),i.restCallback()},i.options.fadeTime)};_a.prototype.restCallback=function(){var t=this,e={};e.front=M8("transition","none",""),t.applyStyles(e),t.trigger("rested",t.instance)};_a.prototype.resetDirection=function(){this.direction={x:!1,y:!1,angle:!1}};_a.prototype.computeDirection=function(t){var e=t.angle.radian,i=Math.PI/4,r=Math.PI/2,n,s,a;if(e>i&&e<i*3&&!t.lockX?n="up":e>-i&&e<=i&&!t.lockY?n="left":e>-i*3&&e<=-i&&!t.lockX?n="down":t.lockY||(n="right"),t.lockY||(e>-r&&e<r?s="left":s="right"),t.lockX||(e>0?a="up":a="down"),t.force>this.options.threshold){var o={},l;for(l in this.direction)this.direction.hasOwnProperty(l)&&(o[l]=this.direction[l]);var c={};this.direction={x:s,y:a,angle:n},t.direction=this.direction;for(l in o)o[l]===this.direction[l]&&(c[l]=!0);if(c.x&&c.y&&c.angle)return t;(!c.x||!c.y)&&this.trigger("plain",t),c.x||this.trigger("plain:"+s,t),c.y||this.trigger("plain:"+a,t),c.angle||this.trigger("dir dir:"+n,t)}else this.resetDirection();return t};var tft=_a;function Es(t,e){var i=this;i.nipples=[],i.idles=[],i.actives=[],i.ids=[],i.pressureIntervals={},i.manager=t,i.id=Es.id,Es.id+=1,i.defaults={zone:document.body,multitouch:!1,maxNumberOfNipples:10,mode:"dynamic",position:{top:0,left:0},catchDistance:200,size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:1,lockX:!1,lockY:!1,shape:"circle",dynamicPage:!1,follow:!1},i.config(e),(i.options.mode==="static"||i.options.mode==="semi")&&(i.options.multitouch=!1),i.options.multitouch||(i.options.maxNumberOfNipples=1);let r=getComputedStyle(i.options.zone.parentElement);return r&&r.display==="flex"&&(i.parentIsFlex=!0),i.updateBox(),i.prepareNipples(),i.bindings(),i.begin(),i.nipples}Es.prototype=new T8;Es.constructor=Es;Es.id=0;Es.prototype.prepareNipples=function(){var t=this,e=t.nipples;e.on=t.on.bind(t),e.off=t.off.bind(t),e.options=t.options,e.destroy=t.destroy.bind(t),e.ids=t.ids,e.id=t.id,e.processOnMove=t.processOnMove.bind(t),e.processOnEnd=t.processOnEnd.bind(t),e.get=function(i){if(i===void 0)return e[0];for(var r=0,n=e.length;r<n;r+=1)if(e[r].identifier===i)return e[r];return!1}};Es.prototype.bindings=function(){var t=this;t.bindEvt(t.options.zone,"start"),t.options.zone.style.touchAction="none",t.options.zone.style.msTouchAction="none"};Es.prototype.begin=function(){var t=this,e=t.options;if(e.mode==="static"){var i=t.createNipple(e.position,t.manager.getIdentifier());i.add(),t.idles.push(i)}};Es.prototype.createNipple=function(t,e){var i=this,r=i.manager.scroll,n={},s=i.options,a={x:i.parentIsFlex?r.x:r.x+i.box.left,y:i.parentIsFlex?r.y:r.y+i.box.top};if(t.x&&t.y)n={x:t.x-a.x,y:t.y-a.y};else if(t.top||t.right||t.bottom||t.left){var o=document.createElement("DIV");o.style.display="hidden",o.style.top=t.top,o.style.right=t.right,o.style.bottom=t.bottom,o.style.left=t.left,o.style.position="absolute",s.zone.appendChild(o);var l=o.getBoundingClientRect();s.zone.removeChild(o),n=t,t={x:l.left+r.x,y:l.top+r.y}}var c=new tft(i,{color:s.color,size:s.size,threshold:s.threshold,fadeTime:s.fadeTime,dataOnly:s.dataOnly,restJoystick:s.restJoystick,restOpacity:s.restOpacity,mode:s.mode,identifier:e,position:t,zone:s.zone,frontPosition:{x:0,y:0},shape:s.shape});return s.dataOnly||(pV(c.ui.el,n),pV(c.ui.front,c.frontPosition)),i.nipples.push(c),i.trigger("added "+c.identifier+":added",c),i.manager.trigger("added "+c.identifier+":added",c),i.bindNipple(c),c};Es.prototype.updateBox=function(){var t=this;t.box=t.options.zone.getBoundingClientRect()};Es.prototype.bindNipple=function(t){var e=this,i,r=function(n,s){i=n.type+" "+s.id+":"+n.type,e.trigger(i,s)};t.on("destroyed",e.onDestroyed.bind(e)),t.on("shown hidden rested dir plain",r),t.on("dir:up dir:right dir:down dir:left",r),t.on("plain:up plain:right plain:down plain:left",r)};Es.prototype.pressureFn=function(t,e,i){var r=this,n=0;clearInterval(r.pressureIntervals[i]),r.pressureIntervals[i]=setInterval(function(){var s=t.force||t.pressure||t.webkitForce||0;s!==n&&(e.trigger("pressure",s),r.trigger("pressure "+e.identifier+":pressure",s),n=s)}.bind(r),100)};Es.prototype.onstart=function(t){var e=this,i=e.options,r=t;t=Ame(t),e.updateBox();var n=function(s){e.actives.length<i.maxNumberOfNipples?e.processOnStart(s):r.type.match(/^touch/)&&(Object.keys(e.manager.ids).forEach(function(a){if(Object.values(r.touches).findIndex(function(l){return l.identifier===a})<0){var o=[t[0]];o.identifier=a,e.processOnEnd(o)}}),e.actives.length<i.maxNumberOfNipples&&e.processOnStart(s))};return mV(t,n),e.manager.bindDocument(),!1};Es.prototype.processOnStart=function(t){var e=this,i=e.options,r,n=e.manager.getIdentifier(t),s=t.force||t.pressure||t.webkitForce||0,a={x:t.pageX,y:t.pageY},o=e.getOrCreate(n,a);o.identifier!==n&&e.manager.removeIdentifier(o.identifier),o.identifier=n;var l=function(u){u.trigger("start",u),e.trigger("start "+u.id+":start",u),u.show(),s>0&&e.pressureFn(t,u,u.identifier),e.processOnMove(t)};if((r=e.idles.indexOf(o))>=0&&e.idles.splice(r,1),e.actives.push(o),e.ids.push(o.identifier),i.mode!=="semi")l(o);else{var c=mI(a,o.position);if(c<=i.catchDistance)l(o);else{o.destroy(),e.processOnStart(t);return}}return o};Es.prototype.getOrCreate=function(t,e){var i=this,r=i.options,n;return/(semi|static)/.test(r.mode)?(n=i.idles[0],n?(i.idles.splice(0,1),n):r.mode==="semi"?i.createNipple(e,t):(console.warn("Coudln't find the needed nipple."),!1)):(n=i.createNipple(e,t),n)};Es.prototype.processOnMove=function(t){var e=this,i=e.options,r=e.manager.getIdentifier(t),n=e.nipples.get(r),s=e.manager.scroll;if(!Zdt(t)){this.processOnEnd(t);return}if(!n){console.error("Found zombie joystick with ID "+r),e.manager.removeIdentifier(r);return}if(i.dynamicPage){var a=n.el.getBoundingClientRect();n.position={x:s.x+a.left,y:s.y+a.top}}n.identifier=r;var o=n.options.size/2,l={x:t.pageX,y:t.pageY};i.lockX&&(l.y=n.position.y),i.lockY&&(l.x=n.position.x);var c=mI(l,n.position),u=$dt(l,n.position),h=fV(u),d=c/o,f={distance:c,position:l},p,g;if(n.options.shape==="circle"?(p=Math.min(c,o),g=Ydt(n.position,p,u)):(g=eft(l,n.position,o),p=mI(g,n.position)),i.follow){if(c>o){let w=l.x-g.x,E=l.y-g.y;n.position.x+=w,n.position.y+=E,n.el.style.top=n.position.y-(e.box.top+s.y)+"px",n.el.style.left=n.position.x-(e.box.left+s.x)+"px",c=mI(l,n.position)}}else l=g,c=p;var m=l.x-n.position.x,y=l.y-n.position.y;n.frontPosition={x:m,y},i.dataOnly||pV(n.ui.front,n.frontPosition);var b={identifier:n.identifier,position:l,force:d,pressure:t.force||t.pressure||t.webkitForce||0,distance:c,angle:{radian:h,degree:u},vector:{x:m/o,y:-y/o},raw:f,instance:n,lockX:i.lockX,lockY:i.lockY};b=n.computeDirection(b),b.angle={radian:fV(180-u),degree:180-u},n.trigger("move",b),e.trigger("move "+n.id+":move",b)};Es.prototype.processOnEnd=function(t){var e=this,i=e.options,r=e.manager.getIdentifier(t),n=e.nipples.get(r),s=e.manager.removeIdentifier(n.identifier);!n||(i.dataOnly||n.hide(function(){i.mode==="dynamic"&&(n.trigger("removed",n),e.trigger("removed "+n.id+":removed",n),e.manager.trigger("removed "+n.id+":removed",n),n.destroy())}),clearInterval(e.pressureIntervals[n.identifier]),n.resetDirection(),n.trigger("end",n),e.trigger("end "+n.id+":end",n),e.ids.indexOf(n.identifier)>=0&&e.ids.splice(e.ids.indexOf(n.identifier),1),e.actives.indexOf(n)>=0&&e.actives.splice(e.actives.indexOf(n),1),/(semi|static)/.test(i.mode)?e.idles.push(n):e.nipples.indexOf(n)>=0&&e.nipples.splice(e.nipples.indexOf(n),1),e.manager.unbindDocument(),/(semi|static)/.test(i.mode)&&(e.manager.ids[s.id]=s.identifier))};Es.prototype.onDestroyed=function(t,e){var i=this;i.nipples.indexOf(e)>=0&&i.nipples.splice(i.nipples.indexOf(e),1),i.actives.indexOf(e)>=0&&i.actives.splice(i.actives.indexOf(e),1),i.idles.indexOf(e)>=0&&i.idles.splice(i.idles.indexOf(e),1),i.ids.indexOf(e.identifier)>=0&&i.ids.splice(i.ids.indexOf(e.identifier),1),i.manager.removeIdentifier(e.identifier),i.manager.unbindDocument()};Es.prototype.destroy=function(){var t=this;t.unbindEvt(t.options.zone,"start"),t.nipples.forEach(function(i){i.destroy()});for(var e in t.pressureIntervals)t.pressureIntervals.hasOwnProperty(e)&&clearInterval(t.pressureIntervals[e]);t.trigger("destroyed",t.nipples),t.manager.unbindDocument(),t.off()};var ift=Es;function Za(t){var e=this;e.ids={},e.index=0,e.collections=[],e.scroll=yie(),e.config(t),e.prepareCollections();var i=function(){var n;e.collections.forEach(function(s){s.forEach(function(a){n=a.el.getBoundingClientRect(),a.position={x:e.scroll.x+n.left,y:e.scroll.y+n.top}})})};if(typeof window>"u")return e.collections;H3(window,"resize",function(){gie(i)});var r=function(){e.scroll=yie()};return H3(window,"scroll",function(){gie(r)}),e.collections}Za.prototype=new T8;Za.constructor=Za;Za.prototype.prepareCollections=function(){var t=this;t.collections.create=t.create.bind(t),t.collections.on=t.on.bind(t),t.collections.off=t.off.bind(t),t.collections.destroy=t.destroy.bind(t),t.collections.get=function(e){var i;return t.collections.every(function(r){return i=r.get(e),!i}),i}};Za.prototype.create=function(t){return this.createCollection(t)};Za.prototype.createCollection=function(t){var e=this,i=new ift(e,t);return e.bindCollection(i),e.collections.push(i),i};Za.prototype.bindCollection=function(t){var e=this,i,r=function(n,s){i=n.type+" "+s.id+":"+n.type,e.trigger(i,s)};t.on("destroyed",e.onDestroyed.bind(e)),t.on("shown hidden rested dir plain",r),t.on("dir:up dir:right dir:down dir:left",r),t.on("plain:up plain:right plain:down plain:left",r)};Za.prototype.bindDocument=function(){var t=this;t.binded||(t.bindEvt(document,"move").bindEvt(document,"end"),t.binded=!0)};Za.prototype.unbindDocument=function(t){var e=this;(!Object.keys(e.ids).length||t===!0)&&(e.unbindEvt(document,"move").unbindEvt(document,"end"),e.binded=!1)};Za.prototype.getIdentifier=function(t){var e;return t?(e=t.identifier===void 0?t.pointerId:t.identifier,e===void 0&&(e=this.latest||0)):e=this.index,this.ids[e]===void 0&&(this.ids[e]=this.index,this.index+=1),this.latest=e,this.ids[e]};Za.prototype.removeIdentifier=function(t){var e={};for(var i in this.ids)if(this.ids[i]===t){e.id=i,e.identifier=this.ids[i],delete this.ids[i];break}return e};Za.prototype.onmove=function(t){var e=this;return e.onAny("move",t),!1};Za.prototype.onend=function(t){var e=this;return e.onAny("end",t),!1};Za.prototype.oncancel=function(t){var e=this;return e.onAny("end",t),!1};Za.prototype.onAny=function(t,e){var i=this,r,n="processOn"+t.charAt(0).toUpperCase()+t.slice(1);e=Ame(e);var s=function(o,l,c){c.ids.indexOf(l)>=0&&(c[n](o),o._found_=!0)},a=function(o){r=i.getIdentifier(o),mV(i.collections,s.bind(null,o,r)),o._found_||i.removeIdentifier(r)};return mV(e,a),!1};Za.prototype.destroy=function(){var t=this;t.unbindDocument(!0),t.ids={},t.index=0,t.collections.forEach(function(e){e.destroy()}),t.off()};Za.prototype.onDestroyed=function(t,e){var i=this;if(i.collections.indexOf(e)<0)return!1;i.collections.splice(i.collections.indexOf(e),1)};var rft=Za,xie=new rft,nft={create:function(t){return xie.create(t)},factory:xie},Rme=new Map,FA=new Map,s0=class{constructor(t,e,i,r){this.data=e;let{audio:n,volume:s,delay:a,loop:o}=e;if(!n)throw new Error("Missing property");let l=typeof n=="string"?r.getAudio(n).src:n.data;this.audioPlayer=new JE({src:l,volume:s,delay:a,loop:o}),FA.has(i.uuid)?FA.get(i.uuid).push(this):FA.set(i.uuid,[this]),Rme.set(t,this)}playByToggle(){this.data.toggle==="stop"?this.audioPlayer.status==="playing"?this.audioPlayer.stop():(this.audioPlayer.stop(),this.audioPlayer.play()):this.data.toggle==="pause"?this.audioPlayer.status==="playing"?this.audioPlayer.pause():this.audioPlayer.play():(this.audioPlayer.stop(),this.audioPlayer.play())}dispose(){this.audioPlayer.stop()}},gV=class{constructor(t){this.data=t}dispatch(){this.data.playAudio?this.pauseAudio(this.data.playAudio):this.data.object?this.pauseAllAudiosFromObject(this.data.object):this.pauseAllAudios()}pauseAudio(t){let e=Rme.get(t);!e||(this.data.delay>0?(this.disposeDelay(),this.timeoutId=window.setTimeout(()=>{e.audioPlayer[this.data.interaction](),this.disposeDelay()},this.data.delay)):e.audioPlayer[this.data.interaction]())}pauseAllAudiosFromObject(t){let e=FA.get(t);!e?.length||(this.data.delay>0?(this.disposeDelay(),this.timeoutId=window.setTimeout(()=>{e.forEach(i=>i.audioPlayer[this.data.interaction]()),this.disposeDelay()},this.data.delay)):e.forEach(i=>i.audioPlayer[this.data.interaction]()))}pauseAllAudios(){let t=[...FA.values()];!t.length||(this.data.delay>0?(this.disposeDelay(),this.timeoutId=window.setTimeout(()=>{t.forEach(e=>{e.forEach(i=>{i.audioPlayer[this.data.interaction]()})}),this.disposeDelay()},this.data.delay)):t.forEach(e=>{e.forEach(i=>{i.audioPlayer[this.data.interaction]()})}))}disposeDelay(){clearTimeout(this.timeoutId),delete this.timeoutId}dispose(){clearTimeout(this.timeoutId),delete this.timeoutId}},Ime=class{constructor(t,e,i,r,n){if(this.data=e,this.shared=r,this.condition=n,e.interaction==="play")this.interaction=new s0(t,e,i,r);else if(e.interaction==="pause"||e.interaction==="stop")this.interaction=new gV(e);else throw new Error("Missing property")}dispatchBasic(){if(Rn(this.shared,this.condition)===!1)return!1;this.interaction instanceof s0?this.interaction.playByToggle():this.interaction.dispatch()}dispatchConditional(){if(Rn(this.shared,this.condition)===!1)return!1;this.interaction instanceof s0?this.interaction.audioPlayer.play():this.interaction.dispatch()}dispatchGameControl(t){if(Rn(this.shared,this.condition)===!1)return!1;this.interaction instanceof s0&&(t==="start"?this.interaction.audioPlayer.play():this.interaction.audioPlayer.stop())}dispose(){this.interaction.dispose()}},Dme=class{constructor(t,e,i,r){this.data=t,this.page=e,this.shared=i,this.condition=r,this.delay=0,this.emission=t.emission,t.delay!==void 0&&(this.delay=t.delay),this.particleSystem=this.page.scene.find(this.data.emitterObjectId)}toggleEmitting(){this.particleSystem.started&&!this.particleSystem.stopped?this.stop(this.delay):this.start(this.delay)}toggleFroze(){this.particleSystem.started&&!this.particleSystem.isFrozen?this.freeze(this.delay):this.unFreeze(this.delay)}start(t=0){if(t){this.delayTimerId=window.setTimeout(()=>{this.start(0),this.clearDelay()},t);return}this.particleSystem.start()}stop(t=0){if(t){this.delayTimerId=window.setTimeout(()=>{this.stop(0),this.clearDelay()},t);return}this.particleSystem.stop()}freeze(t=0){if(t){this.delayTimerId=window.setTimeout(()=>{this.freeze(0),this.clearDelay()},t);return}this.particleSystem.froze()}unFreeze(t=0){if(t){this.delayTimerId=window.setTimeout(()=>{this.unFreeze(0),this.clearDelay()},t);return}this.particleSystem.unFroze()}reset(t=0){if(t){this.delayTimerId=window.setTimeout(()=>{this.reset(0),this.clearDelay()},t);return}this.particleSystem.reset()}reverseFromCurrent(){switch(this.emission){case"emitToggle":this.toggleEmitting();break;case"pauseToggle":this.toggleFroze();break}}dispatchBasic(){if(Rn(this.shared,this.condition)===!1||!this.particleSystem)return!1;switch(this.emission){case"start":this.start(this.delay);break;case"emitToggle":this.toggleEmitting();break;case"pause":this.freeze(this.delay);break;case"pauseToggle":this.toggleFroze();break;case"stop":this.stop(this.delay);break;case"reset":this.reset(this.delay);break}}dispatchConditional(){if(Rn(this.shared,this.condition)===!1||!this.particleSystem)return!1;switch(this.emission){case"start":this.start(this.delay);break;case"stop":this.stop(this.delay);break;case"reset":this.reset(this.delay);break}}dispatchGameControl(t){if(Rn(this.shared,this.condition)===!1||!this.particleSystem)return!1;t==="start"?this.start(this.delay):this.stop(this.delay)}dispose(){!this.particleSystem||(this.particleSystem.reset(),this.clearDelay())}clearDelay(){this.delayTimerId&&(clearTimeout(this.delayTimerId),delete this.delayTimerId)}},sft="text/plain",aft="us-ascii",bie=(t,e)=>e.some(i=>i instanceof RegExp?i.test(t):i===t),oft=(t,{stripHash:e})=>{let i=/^data:(?<type>[^,]*?),(?<data>[^#]*?)(?:#(?<hash>.*))?$/.exec(t);if(!i)throw new Error(`Invalid URL: ${t}`);let{type:r,data:n,hash:s}=i.groups,a=r.split(";");s=e?"":s;let o=!1;a[a.length-1]==="base64"&&(a.pop(),o=!0);let l=(a.shift()||"").toLowerCase(),c=[...a.map(u=>{let[h,d=""]=u.split("=").map(f=>f.trim());return h==="charset"&&(d=d.toLowerCase(),d===aft)?"":`${h}${d?`=${d}`:""}`}).filter(Boolean)];return o&&c.push("base64"),(c.length>0||l&&l!==sft)&&c.unshift(l),`data:${c.join(";")},${o?n.trim():n}${s?`#${s}`:""}`};function lft(t,e){if(e={defaultProtocol:"http:",normalizeProtocol:!0,forceHttp:!1,forceHttps:!1,stripAuthentication:!0,stripHash:!1,stripTextFragment:!0,stripWWW:!0,removeQueryParameters:[/^utm_\w+/i],removeTrailingSlash:!0,removeSingleSlash:!0,removeDirectoryIndex:!1,sortQueryParameters:!0,...e},t=t.trim(),/^data:/i.test(t))return oft(t,e);if(/^view-source:/i.test(t))throw new Error("`view-source:` is not supported as it is a non-standard protocol");let i=t.startsWith("//");!i&&/^\.*\//.test(t)||(t=t.replace(/^(?!(?:\w+:)?\/\/)|^\/\//,e.defaultProtocol));let r=new URL(t);if(e.forceHttp&&e.forceHttps)throw new Error("The `forceHttp` and `forceHttps` options cannot be used together");if(e.forceHttp&&r.protocol==="https:"&&(r.protocol="http:"),e.forceHttps&&r.protocol==="http:"&&(r.protocol="https:"),e.stripAuthentication&&(r.username="",r.password=""),e.stripHash?r.hash="":e.stripTextFragment&&(r.hash=r.hash.replace(/#?:~:text.*?$/i,"")),r.pathname){let s=/\b[a-z][a-z\d+\-.]{1,50}:\/\//g,a=0,o="";for(;;){let c=s.exec(r.pathname);if(!c)break;let u=c[0],h=c.index,d=r.pathname.slice(a,h);o+=d.replace(/\/{2,}/g,"/"),o+=u,a=h+u.length}let l=r.pathname.slice(a,r.pathname.length);o+=l.replace(/\/{2,}/g,"/"),r.pathname=o}if(r.pathname)try{r.pathname=decodeURI(r.pathname)}catch{}if(e.removeDirectoryIndex===!0&&(e.removeDirectoryIndex=[/^index\.[a-z]+$/]),Array.isArray(e.removeDirectoryIndex)&&e.removeDirectoryIndex.length>0){let s=r.pathname.split("/"),a=s[s.length-1];bie(a,e.removeDirectoryIndex)&&(s=s.slice(0,-1),r.pathname=s.slice(1).join("/")+"/")}if(r.hostname&&(r.hostname=r.hostname.replace(/\.$/,""),e.stripWWW&&/^www\.(?!www\.)[a-z\-\d]{1,63}\.[a-z.\-\d]{2,63}$/.test(r.hostname)&&(r.hostname=r.hostname.replace(/^www\./,""))),Array.isArray(e.removeQueryParameters))for(let s of[...r.searchParams.keys()])bie(s,e.removeQueryParameters)&&r.searchParams.delete(s);if(e.removeQueryParameters===!0&&(r.search=""),e.sortQueryParameters){r.searchParams.sort();try{r.search=decodeURIComponent(r.search)}catch{}}e.removeTrailingSlash&&(r.pathname=r.pathname.replace(/\/$/,""));let n=t;return t=r.toString(),!e.removeSingleSlash&&r.pathname==="/"&&!n.endsWith("/")&&r.hash===""&&(t=t.replace(/\/$/,"")),(e.removeTrailingSlash||r.pathname==="/")&&r.hash===""&&e.removeSingleSlash&&(t=t.replace(/\/$/,"")),i&&!e.normalizeProtocol&&(t=t.replace(/^http:\/\//,"//")),e.stripProtocol&&(t=t.replace(/^(?:https?:)?\/\//,"")),t}var cft=class{constructor({url:t,context:e},i,r,n){if(this.controlsManager=i,this.shared=r,this.condition=n,!t)throw new Error("Missing property");this.url=t.startsWith("mailto:")?t:lft(t,{removeTrailingSlash:!1,removeSingleSlash:!1,stripWWW:!1}),this.context=e??"tab"}dispatch(){if(Rn(this.shared,this.condition)===!1)return!1;L_?window.location.assign(this.url):(this.context==="tab"||Nde&&this.context==="none"?window.open(this.url,"_blank"):this.context==="window"?window.open(this.url,"_blank",`width=${window.innerWidth}, height=${window.innerHeight}`):window.open(this.url,"_parent"),this.controlsManager.orbitControls?.onPointerUp(Di[0]),Ctt())}},Ome=class{constructor(t,e,i,r,n){this.data=t,this.page=e,this.controlsManager=i,this.shared=r,this.condition=n,this.timeoutIdQueue=[],this.dispatchInner=()=>{this.objects.forEach(this.destroyCallback)},this.destroyCallback=s=>{this.timeoutIdQueue.shift();let a=this.page.scene.find(s);if(a===void 0)return;let o=this.controlsManager.sharedGameControlGlobals.rapierWorld,l=o?a.dataPatched.physics?.fusedBody:!0;if(a.cloner){for(let c of a.cloner.children)l?(c.playModeVisible=!1,c.rigidBody&&a.dataPatched.physics?.rigidBody==="positioned"&&(this.controlsManager.sharedGameControlGlobals.colliderToEntity.delete(c.rigidBody.collider(0).handle),o.removeRigidBody(c.rigidBody),c.rigidBody=void 0),c.bvhGeometry&&(c.bvhGeometry=void 0)):this.clone===void 0||this.clone===c?(c.playModeVisible=!1,c.rigidBody&&(this.controlsManager.sharedGameControlGlobals.colliderToEntity.delete(c.rigidBody.collider(0).handle),o.removeRigidBody(c.rigidBody),c.rigidBody=void 0)):c.playModeVisible===void 0&&(c.playModeVisible=!0);(l||this.clone===void 0||this.clone===!1)&&(a.visible=!1,a.rigidBody&&(this.controlsManager.sharedGameControlGlobals.colliderToEntity.delete(a.rigidBody.collider(0).handle),o.removeRigidBody(a.rigidBody),a.rigidBody=void 0),a.bvhGeometry&&(a.bvhGeometry=void 0))}else a.rigidBody&&(this.controlsManager.sharedGameControlGlobals.colliderToEntity.delete(a.rigidBody.collider(0).handle),o.removeRigidBody(a.rigidBody),a.rigidBody=void 0),a.bvhGeometry&&(a.bvhGeometry=void 0),a.visible=!1;o===void 0?this.controlsManager.sharedGameControlGlobals.entitiesWithTransformAnim=this.controlsManager.sharedGameControlGlobals.entitiesWithTransformAnim.filter(c=>c.bvhGeometry!==void 0):this.controlsManager.sharedGameControlGlobals.entitiesWithTransformAnim=this.controlsManager.sharedGameControlGlobals.entitiesWithTransformAnim.filter(c=>c.rigidBody!==void 0),a.destroyedInAction=!0,this.controlsManager.requestRender()},this.objects=[...t.objects]}dispatch(t){if(Rn(this.shared,this.condition)===!1)return!1;this.clone=t,this.data.delay?this.timeoutIdQueue.push(window.setTimeout(this.dispatchInner,this.data.delay*1e3)):this.dispatchInner()}dispatchFromStart(){if(Rn(this.shared,this.condition)===!1)return!1;this.timeoutIdQueue.push(window.setTimeout(this.dispatchInner,this.data.delay*1e3))}dispose(){this.timeoutIdQueue.forEach(t=>window.clearTimeout(t))}},Lme=class{constructor(t,e,i,r,n){this.data=t,this.page=e,this.shared=i,this.eventManager=r,this.condition=n,this.shared=i}dispatch(){if(Rn(this.shared,this.condition)===!1)return!1;clearTimeout(this.timeoutId),delete this.timeoutId,this.timeoutId=window.setTimeout(()=>{this.shared.reset(this.shared.data,!0),C8(this.page,this.shared,!0),this.eventManager.reset(),this.eventManager.controlsManager.gameControl?.reset(!0),this.page.switchToPlayCamera(),this.eventManager.controlsManager.requestRender(),delete this.timeoutId},(this.data.delay??0)*1e3)}dispose(){clearTimeout(this.timeoutId),delete this.timeoutId}};function uft(t,e,i,r){let n=[],s=t.cameraType==="OrthographicCamera"?e.orthographic?.zoom:e.perspective?.zoom,a=t.cameraType==="OrthographicCamera"?i.orthographic?.zoom:i.perspective?.zoom;if(a!==void 0){let o=s??t.zoom,l=a;o!==l&&n.push({update:c=>{t.zoom=Ht.lerp(o,l,c),t.updateProjectionMatrix()},start:()=>{t.zoom=o,t.updateProjectionMatrix()},end:()=>{t.zoom=l,t.updateProjectionMatrix()}})}if(i.targetOffset!==void 0){let o=go("targetOffset",t,e,i,r);o&&n.push(o)}return n}function hft(t,e,i,r){if(i.scaleBaked===void 0)return;let n=(e.scaleBaked??t.data.geometry.scaleBaked).map(o=>typeof o=="string"?Number(r.getVariable(o)??0):o),s=i.scaleBaked.map(o=>typeof o=="string"?Number(r.getVariable(o)??0):o);if(Hg.isEqual(n,s))return;let a=[];return a.push({update:o=>{t.updateGeometryInteractions({scaleBaked:[Ht.lerp(n[0],s[0],o),Ht.lerp(n[1],s[1],o),Ht.lerp(n[2],s[2],o)]},r),t.invalidateDownstreamBooleanData(),t.refreshAttachedClonersInteractions()},start:()=>{t.updateGeometryInteractions({scaleBaked:n},r),t.invalidateDownstreamBooleanData(),t.refreshAttachedClonersInteractions()},end:()=>{t.updateGeometryInteractions({scaleBaked:s},r),t.invalidateDownstreamBooleanData(),t.refreshAttachedClonersInteractions()}}),a}function dft(t,e,i,r){if(!i.extrusion)return;let n=t.extrusion,s=e.extrusion??{},a=i.extrusion,o=[];return NG.forEach(l=>{let c=xv(l,n,s,a,r);c&&o.push(c)}),o}function fft(t,e,i,r){let n=[];if(!("geometry"in i))return n;let s=t.geometry.userData.parameters,a="geometry"in e?e.geometry:{},o=i.geometry;if(t instanceof YM){let l=hft(t,a,o,r);l&&n.push(...l)}else{let l={};if(Object.assign(l,Wd(s,wF),Wd(a,wF)),wF.forEach(c=>{let u=xv(c,l,a,o,r);u&&n.push(u)}),t instanceof LL){Object.assign(l,{extrusion:{...s.extrusion}});let c=dft(l,a,o,r);c&&n.push(...c)}n.length&&n.push({update:c=>{t.updateGeometryInteractions(l,r),t.updateGeometryGroupsIfNeeded(),t.refreshAttachedClonersInteractions()},start:c=>{t.updateGeometryInteractions(l,r),t.updateGeometryGroupsIfNeeded(),t.refreshAttachedClonersInteractions()},end:c=>{t.updateGeometryInteractions(l,r),t.updateGeometryGroupsIfNeeded(),t.refreshAttachedClonersInteractions()}})}return n}function pft(t,e,i,r){let n=t.geometry.userData.parameters.extrusion;if(n)return NG.forEach(s=>{Sg(s,n,e,i,r)}),n}function mft(t,e,i,r){let n=t.updatedPathSnapping;if(n)return cit.forEach(s=>{Sg(s,n,e,i,r)}),n}function gft(t,e,i,r){let n=[];if(i.intensity!==void 0){let s=go("intensity",t,e,i,r);s&&n.push(s)}if(i.color!==void 0){let s=Nrt("color",t,e,i,r);s&&n.push(s)}return n}function vft(t,e,i,r){let n=[];if(Array.isArray(t.material)){if(!("materials"in i&&i.materials))return n;let s="materials"in e&&e.materials?e.materials:[],a=i.materials;t.material.forEach((o,l)=>{if(!a[l])return;let c=s[l]??{},u=a[l];typeof c=="string"||typeof u=="string"||n.push(...wie(o,c,u,r))})}else{if(!("material"in i&&i.material))return n;let s="material"in e&&e.material?e.material:{},a=i.material;if(typeof s=="string"||typeof a=="string")return n;n.push(...wie(t.material,s,a,r))}return n}function wie(t,e,i,r){let n=[],s=Qw(i,r)||!!e.layers&&Qw(e,r);n.push(yft(t,s));for(let a of t.layers){let o=e.layers?.data(a.uuid),l=i.layers.data(a.uuid);if(!l||a.type!=="light"&&(!(a.visible??!0)||!(l.visible??!0)))continue;let c=a.getNames().filter(u=>!hfe.some(h=>u.includes(h)));for(let u of c)try{let h=a.getValue(u),d;if(u==="colors")d=jme(a,o,l,u);else if(Array.isArray(h))u==="steps"&&(d=zme(a,o,l,u));else if(typeof h=="number")d=kme(a,o,l,u,r);else{if(typeof h=="boolean")continue;h instanceof Ae?d=Nme(a,o,l,u):h instanceof W?d=Ume(a,o,l,u,r):h instanceof Ya?d=Fme(a,o,l,u,r):h instanceof Ai?d=Bme(a,o,l,u,r):"isTexture"in h&&(d=Vme(a,o,l,u))}d&&(Array.isArray(d)?n.push(...d):n.push(d))}catch(h){console.error(`lerpMaterial: unexpected material layer for ${u}`,h)}}return n}function kme(t,e,i,r,n){if(!t.hasValue(r)||!(r in i))return;let s=e?e[r]:t.getValue(r),a=i[r],o=typeof s=="string"?Number(n.getVariable(s)??0):s,l=typeof a=="string"?Number(n.getVariable(a)??0):a;if(o!==l)return{update:c=>{t.setValue(r,Ht.lerp(o,l,c))},start:()=>{t.setValue(r,o)},end:()=>{t.setValue(r,l)}}}function Nme(t,e,i,r){if(!t.hasValue(r)||!(r in i))return;let n=t.getValue(r),s=e?new Ae().fromArray(e[r]):n.clone(),a=new Ae().fromArray(i[r]);if(!s.equals(a))return{update:o=>{n.lerpVectors(s,a,o)},start:()=>{n.copy(s)},end:()=>{n.copy(a)}}}function Ume(t,e,i,r,n){if(!t.hasValue(r)||!(r in i))return;let s=t.getValue(r),a=e?e[r]:void 0,o=i[r],l=a?R3(new W,a,n):s.clone(),c=R3(new W,o,n);if(!l.equals(c))return{update:u=>{s.lerpVectors(l,c,u)},start:()=>{s.copy(l)},end:()=>{s.copy(c)}}}function Bme(t,e,i,r,n){if(!t.hasValue(r)||!(r in i))return;let s=e?e[r]:void 0,a=i[r],o=t.getValue(r),l=s?typeof s=="string"?n.getColor(s).clone():new Ai().setRGB(s.r,s.g,s.b):o.clone(),c=typeof a=="string"?n.getColor(a).clone():new Ai().setRGB(a.r,a.g,a.b);if(l.equals(c))return;let u=o.clone();return{update:h=>{t.getValue(r)!==u&&t.setValue(r,u),u.lerpColors(l,c,h)},start:()=>{u.copy(l)},end:()=>{u.copy(c)}}}function Fme(t,e,i,r,n){if(!t.hasValue(r)||!(r in i))return;let s=e?e[r]:void 0,a=i[r],o=t.getValue(r),l=s?typeof s=="string"?n.color(s).clone():new Ai().setRGB(s.r,s.g,s.b):o.clone(),c=typeof a=="string"?n.getColor(a).clone():new Ya(a.r,a.g,a.b,a.a);if(l.equals(c))return;let u=o.clone();return{update:h=>{t.getValue(r)!==u&&t.setValue(r,u),u.lerpColors(l,c,h)},start:()=>{u.copy(l)},end:()=>{u.copy(c)}}}function zme(t,e,i,r="steps"){if(!t.hasValue(r)||!(r in i))return;let n=[],s=t.getValue(r),a=e?e[r]:s,o=i[r];return bG(a,o)||n.push({update:l=>{let c=[...s];for(let u=0;u<s.length;++u){let h=a[u],d=o[u];c[u]=Ht.lerp(h,d,l)}t.setValue(r,c)},start:()=>{t.setValue(r,a)},end:()=>{t.setValue(r,o)}}),n.length?n:void 0}function jme(t,e,i,r="colors"){if(!t.hasValue(r)||!(r in i))return;let n=[],s=t.getValue(r),a=e?e[r]:s.map(l=>l.toArray()),o=i[r];for(let l=0;l<s.length;++l){let c=[...a[l]],u=[...o[l]];zM.isEqual(c,u)||n.push({update:h=>{s[l].fromArray(zM.lerp(c,u,h))},start:()=>{s[l].fromArray(c)},end:()=>{s[l].fromArray(u)}})}return n.length?n:void 0}function Vme(t,e,i,r="texture"){if(!t.hasValue(r)||!(r in i))return;let n=t.getNode("rotation"),s=e?.[r]?.rotation??0,a=i[r]?.rotation??0;if(n&&s!==a)return{update:m=>{n.value=Ht.lerp(s,a,m)*Ht.DEG2RAD},start:()=>{n.value=s*Ht.DEG2RAD},end:()=>{n.value=a*Ht.DEG2RAD}};let o=t.getNode("mat");if(!o)return;let l=e?e[r]:o,c=i[r],u=[...l.repeat],h=[...l.offset],d=[...c.repeat],f=[...c.offset],p=l.rotation??0,g=c.rotation??0;if(!kd.isEqual(u,d)||!kd.isEqual(h,f)||p!==g)return{update:m=>{o.repeat=kd.lerp(u,d,m),o.offset=kd.lerp(h,f,m),o.rotation=Ht.lerp(p,g,m),o.updateMatrix()},start:()=>{o.repeat=[...u],o.offset=[...h],o.rotation=p,o.updateMatrix()},end:()=>{o.repeat=[...d],o.offset=[...f],o.rotation=g,o.updateMatrix()}}}function _ie(t,e,i,r,n,s,a){if(t==="colors")jme(e,i,r,t)?.forEach(o=>o.update(n));else if(Array.isArray(s))t==="steps"&&zme(e,i,r,t)?.forEach(o=>o.update(n));else if(typeof s=="number")kme(e,i,r,t,a)?.update(n);else{if(typeof s=="boolean")return;s instanceof Ae?Nme(e,i,r,t)?.update(n):s instanceof W?Ume(e,i,r,t,a)?.update(n):s instanceof Ya&&a?Fme(e,i,r,t,a)?.update(n):s instanceof Ai&&a?Bme(e,i,r,t,a)?.update(n):"isTexture"in s&&Vme(e,i,r,t)?.update(n)}}function yft(t,e){return{update:()=>{t.transparent=e}}}var g4=new W,Sie=new xs;function xft(t,e,i,r,n){let s=[],a,o,l,c,u,h,d,f;if(t instanceof Ka?(a=I3("position",t,e,i,n),a&&s.push(a),l=go("rotation",t,e,i,n),l&&s.push(l),c=I3("shear",t,e,i,n),c&&s.push(c)):(f={slide:e.pathSnapping?.slide??t.updatedPathSnapping?.slide??t.dataPatched.pathSnapping?.slide??0,offset:e.pathSnapping?.offset??t.updatedPathSnapping?.offset??t.dataPatched.pathSnapping?.offset??0},h=go("slide",f,e.pathSnapping??t.updatedPathSnapping??t.dataPatched.pathSnapping,i.pathSnapping??t.dataPatched.pathSnapping,n),h&&s.push(h),d=go("offset",f,e.pathSnapping??t.updatedPathSnapping??t.dataPatched.pathSnapping,i.pathSnapping??t.dataPatched.pathSnapping,n),d&&s.push(d),!h&&!d&&(a=gee("position",t,e,i,n),a&&s.push(a),o=gee("scale",t,e,i,n),o&&s.push(o),l=bft(t,e,i,r,n),l&&s.push(l),u=krt("hiddenMatrix",t,e,i),u&&s.push(u))),a||o||l||u||h||d){let p=t instanceof Ka?()=>{t.updateWorldMatrix(!0,!1,!0),t.resetBBoxNeedsUpdate()}:()=>{t.updateMatrix(),t.hasNonUniformScale&&(t.updateMatrixWorld(),t.updateMatrixWorldSVD()),t.parent?.matrixWorldFusedFalse&&(t.matrixWorld.multiplyMatrices(t.parent.matrixWorldFusedFalse,t.matrix),t.matrixWorldNeedsUpdate=!1),Cd(t)&&Pp(t.parent)&&t.invalidateDownstreamBooleanData(!0),t.updatePathSnapping(Object.assign({},e.pathSnapping,f))};s.push({update:p,start:p,end:p})}return s}function bft(t,e,i,r,n){let s=e?.rotation?e.rotation.map(u=>(typeof u=="string"?Number(n.getVariable(u)??0):u)*Ht.DEG2RAD):void 0,a=i.rotation?.map(u=>(typeof u=="string"?Number(n.getVariable(u)??0):u)*Ht.DEG2RAD);if(!a)return;let o=s?new W().fromArray(s):new W().setFromEuler(t.rotation),l=new W().fromArray(a);if(o.equals(l))return;let c=g4.subVectors(l,o);if(r&&c.toArray().every(u=>Math.abs(u)<2*Math.PI)){let u=new Ii().setFromEuler(Sie.setFromVector3(o)),h=new Ii().setFromEuler(Sie.setFromVector3(l));return{update:d=>{Lrt(u,h,t.quaternion,d)},start:()=>{t.rotation.setFromVector3(o)},end:()=>{t.rotation.setFromVector3(l)}}}else return{update:u=>{g4.lerpVectors(o,l,u),t.rotation.setFromVector3(g4)},start:()=>{t.rotation.setFromVector3(o)},end:()=>{t.rotation.setFromVector3(l)}}}function wft(t,e){return{update:()=>{t instanceof Va&&(t.fill.enabled=e)}}}function _ft(t,e){return{update:()=>{t instanceof Va&&(t.stroke.enabled=e)}}}function Sft(t,e){return{update:()=>{t instanceof Va&&(t.dropShadow.enabled=e)}}}function Eft(t,e){return{update:()=>{t instanceof Va&&(t.innerShadow.enabled=e)}}}function Aft(t,e){return{update:()=>{t instanceof Va&&(t.backgroundBlur.enabled=e)}}}function Mft(t,e){return{update:()=>{t instanceof Va&&(t.layerBlur.enabled=e)}}}function Tft(t,e,i,r,n){let s=[],a,o,l,c,u,h,d,f,p,g,m,y,b,w,E;if("width"in t&&(a=go("width",t,e,i,n),a&&s.push(a)),"height"in t&&(o=go("height",t,e,i,n),o&&s.push(o)),t instanceof Va||t instanceof Xd){let M={...e.fill},A={...i.fill};M.enabled!==void 0&&M.enabled!==A.enabled&&(s.push(wft(t,!0)),M.enabled||Object.assign(M,{enabled:!0,color:{...M.color,a:0}}),A.enabled||Object.assign(A,{enabled:!0,color:{...A.color,a:0}})),l=YP("color",t.fill,M,A,n),l&&s.push(l)}if(t instanceof Va){let M={...e.stroke},A={...i.stroke};(M.enabled||A.enabled)&&(s.push(_ft(t,!0)),M.enabled||Object.assign(M,{enabled:!0,color:{...M.color,a:0}}),A.enabled||Object.assign(A,{enabled:!0,color:{...A.color,a:0}})),c=YP("color",t.stroke,M,A,n),c&&s.push(c),u=go("thickness",t.stroke,M,A,n),u&&s.push(u)}if(t instanceof Va){let M={...e.dropShadow},A={...i.dropShadow};(M.enabled||A.enabled)&&(s.push(Sft(t,!0)),M.enabled||Object.assign(M,{enabled:!0,color:{...M.color,a:0}}),A.enabled||Object.assign(A,{enabled:!0,color:{...A.color,a:0}})),h=YP("color",t.dropShadow,M,A,n),h&&s.push(h),d=go("blurRadius",t.dropShadow,M,A,n),d&&s.push(d),p=go("spread",t.dropShadow,M,A,n),p&&s.push(p),f=I3("offset",t.dropShadow,M,A,n),f&&s.push(f)}if(t instanceof Va){let M={...e.innerShadow},A={...i.innerShadow};(M.enabled||A.enabled)&&(s.push(Eft(t,!0)),M.enabled||Object.assign(M,{enabled:!0,color:{...M.color,a:0}}),A.enabled||Object.assign(A,{enabled:!0,color:{...A.color,a:0}})),g=YP("color",t.innerShadow,M,A,n),g&&s.push(g),m=go("blurRadius",t.innerShadow,M,A,n),m&&s.push(m),b=go("spread",t.innerShadow,M,A,n),b&&s.push(b),y=I3("offset",t.innerShadow,M,A,n),y&&s.push(y)}if(t instanceof Va||t instanceof Xd){let M={...e.backgroundBlur},A={...i.backgroundBlur};(M.enabled||A.enabled)&&(s.push(Aft(t,!0)),M.enabled||Object.assign(M,{enabled:!0,radius:0}),A.enabled||Object.assign(A,{enabled:!0,radius:0})),w=go("radius",t.backgroundBlur,M,A,n),w&&s.push(w)}if(t instanceof Va){let M={...e.layerBlur},A={...i.layerBlur};(M.enabled||A.enabled)&&(s.push(Mft(t,!0)),M.enabled||Object.assign(M,{enabled:!0,radius:0}),A.enabled||Object.assign(A,{enabled:!0,radius:0})),E=go("radius",t.layerBlur,M,A,n),E&&s.push(E)}if(t instanceof Xd||t instanceof qT){let M=qG("cornerRadius",t,e,i,n);M&&s.push(M)}return s}function Eie(t,e,i,r,n){let s=[];return t.data.visible&&s.push(...xft(t,e,i,n,r)),t instanceof Ka?s.push(...Tft(t,e,i,n,r)):(t.data.visible&&s.push(...Brt(t,e,i,r)),t instanceof So?(t instanceof bs&&t.data.visible&&s.push(...fft(t,e,i,r)),t.data.visible&&s.push(...vft(t,e,i,r))):F3.is(t)?t.data.visible&&s.push(...gft(t,e,i,r)):t instanceof Gs&&s.push(...uft(t,e,i,r))),s.length?{update:a=>{s.forEach(o=>o.update(a))},start:a=>{s.forEach(o=>o.start?.(a))},end:a=>{s.forEach(o=>o.end?.(a))}}:void 0}function Cft(t,e){return{position(i){Object.assign(t.position,i),i.z!==void 0&&(t.updateMatrix(),t.resetBBoxNeedsUpdate(),t.dispatchEvent({type:"requestRender"}))},rotation(i){let r=Object.keys(i)[0];t.rotation[r]=i[r]*Ht.DEG2RAD,i.z!==void 0&&(t.updateMatrix(),t.resetBBoxNeedsUpdate(),t.dispatchEvent({type:"requestRender"}))},scale(i){Object.assign(t.scale,i),i.z!==void 0&&(t.updateMatrix(),t.resetBBoxNeedsUpdate(),t.dispatchEvent({type:"requestRender"}))},shapeSize(i){t instanceof bs&&(t.userData.value={...t.userData.value,...i},i.z!==void 0&&(t.updateGeometryInteractions({width:t.userData.value.x,height:t.userData.value.y,depth:t.userData.value.z},e),t.resetBBoxNeedsUpdate(),t.invalidateDownstreamBooleanData(),t.dispatchEvent({type:"requestRender"})))},material(i,r,n){n&&(Object.entries(n).forEach(([s,{start:a,end:o,t:l}])=>{let c=r.getValue(s);c!==void 0&&_ie(s,r,a,o,l,c,e)}),t.dispatchEvent({type:"requestRender"}))},opacity(i){if(t instanceof So&&!Array.isArray(t.material)){let r=t.material.getLayersOfType("light")[0];t.material.transparent=!0,_ie("alphaOverride",r,{alphaOverride:i},{alphaOverride:i+1},0,i,e),t.dispatchEvent({type:"requestRender"})}},light(i,r){(t instanceof IL||t instanceof w8||t instanceof DL)&&(t[i]=r,t.dispatchEvent({type:"requestRender"}))},cloner(i){i.cloner?.update(),i.dispatchEvent({type:"requestRender"})},pathExtrusion(i,r){i.geometry.userData.parameters.extrusion={...i.geometry.userData.parameters.extrusion,...r},i.updateGeometryInteractions({extrusion:{...i.geometry.userData.parameters.extrusion}},e),i.resetBBoxNeedsUpdate(),i.invalidateDownstreamBooleanData(),i.dispatchEvent({type:"requestRender"})},pathSnapping(i){t.userData.pathSnapping={...t.userData.pathSnapping,...i},t.updatePathSnapping(t.userData.pathSnapping),t.dispatchEvent({type:"requestRender"})}}}var Aie=new W;function C8(t,e,i=!1){let r=[],n=s=>{let a=s.data;delete s.states,s.currentState=null,s.reversibleToState=null,s.currentTransitionEvent=null;for(let o of a.states){let l={...o.data};s.states||(s.states={}),s.states[o.id]=r0.patch(a,l)}Tie(t.scene,s,null,e,a.events.find(o=>o.data.type==="Follow"||o.data.type==="LookAt")!==void 0),Mie(t)};t.scene.traverse2D(n),t.traverseChildren(s=>{if(i&&(s.rigidBody?.setTranslation(s.position0,!0),s.rigidBody?.setRotation(s.rotation0,!0),s.rigidBody?.setLinvel(Aie,!0),s.rigidBody?.setAngvel(Aie,!0)),!Er.is(s))return;let a=s.uuid,o=s.data;if(delete s.states,s.uuid===N_)return;let l=!1;r.some(c=>t.scene.find(a)?.isDescendantOf(c))?l=!0:o.physics?.fusedBody===!0&&o.physics.rigidBody==="dynamic"&&r.push(a),s.data=o,s.currentState=null,s.reversibleToState=null,s.currentTransitionEvent=null;for(let c of o.states){let u={...c.data};t.data.globalPhysics.usePhysics===!0&&o.physics&&(o.physics.rigidBody==="dynamic"||l)&&(c.data.position!==void 0&&delete u.position,c.data.rotation!==void 0&&delete u.rotation,c.data.hiddenMatrix!==void 0&&delete u.hiddenMatrix),s.states||(s.states={}),s.states[c.id]=Og.patch(o,u)}Tie(t.scene,s,null,e,o.events.find(c=>c.data.type==="Follow"||c.data.type==="LookAt")!==void 0),s instanceof Fo&&s.frame&&(s.frame.traverse(c=>n(c)),s.uiCanvas?.applySize())}),Mie(t),t.frame&&(t.frame.traverse(s=>n(s)),t.uiCanvas?.applySize())}function Mie(t){t.traverseEntity(e=>{for(let i of e.data.events){let r=[];switch(i.data.type){case"Follow":case"MouseHover":case"Scroll":case"MouseDown":case"MouseUp":case"MousePress":case"KeyUp":case"KeyDown":case"KeyPress":case"Collision":r.push(...i.data.actions);break;case"GameControl":for(let n of Object.values(i.data.gameActions))r.push(...n);break;case"DragDrop":r.push(...i.data.dragDropActions.drag,...i.data.dragDropActions.drop);break;case"Conditional":r.push(...i.data.inActions,...i.data.outActions);break}for(let n of r)if(n.data.type==="Create"&&n.data.hideBase==="Yes"){let s=t.scene.find(n.data.object);s&&(s.visible=!1)}}})}function Tie(t,e,i,r,n=!1){if(e instanceof bs&&!(e instanceof V0)&&e.removeInteractionGeometry(r),e instanceof Ka?e.changeSelectedState(i,{shared:r},n):e.changeSelectedState(i,{scene:t,shared:r},n),e instanceof bs&&e.updateGeometryGroupsIfNeeded(),e instanceof Gs&&e.updateCameraState(e.dataPatched,{scene:t,shared:r}),!(e instanceof Ka)){if(e.cloner)for(let s of e.cloner.children)s.playModeVisible=void 0;e.updateVisible()}}function Hme(t){let e;if(t.easing===5){let{control1:i,control2:r}=t;e=`cubicBezier(
			${i[0]}, ${i[1]}, ${r[0]}, ${r[1]}
		)`}else if(t.easing===6){let{mass:i,stiffness:r,damping:n,velocity:s}=t;e=`spring( ${i}, ${r}, ${n}, ${s} )`}else{let i;switch(t.easing){case 0:i=pg.linear;break;case 1:i=pg.ease;break;case 2:i=pg.easeIn;break;case 3:i=pg.easeOut;break;case 4:i=pg.easeInOut;break;default:i=pg.linear}let[r,n,s,a]=i;e=`cubicBezier( ${r}, ${n}, ${s}, ${a} )`}return{duration:Math.max(t.duration,1e-4),easing:e}}function G3(t){let e={delay:0,loop:t.repeat===-1?!0:t.repeat+1};if(t.repeat===0)e.direction="normal",e.rewind=!1;else switch(t.direction){case"pingpong":e.direction="alternate",e.rewind=!1;break;case"pingpong-rewind":e.direction="alternate",e.rewind=!0;break;default:e.direction="normal",e.rewind=!1;break}switch(e.delay=0,e.endDelay=0,e.startOnceDelay=0,e.pingPongDelayCorrection=0,e.pingPongEndDelayCorrection=0,t.delayDirection){case"start-once":e.startOnceDelay=t.delay;break;case"start":e.delay=t.delay;break;case"end":e.endDelay=t.delay;break;case"start-end":case void 0:e.delay=t.delay,e.endDelay=t.delay;break}return e.direction==="alternate"&&(e.delay/=2,e.endDelay/=2,t.delayDirection==="start"?(e.pingPongDelayCorrection=e.delay,typeof e.loop=="number"&&e.loop%2===0&&(e.pingPongEndDelayCorrection=e.delay)):t.delayDirection==="end"?typeof e.loop=="number"&&e.loop%2!==0&&(e.pingPongEndDelayCorrection=e.endDelay):t.delayDirection==="start-end"&&(e.pingPongDelayCorrection=e.delay,e.pingPongEndDelayCorrection=e.endDelay)),e}var Gme={type:"beginState"},Wme={type:"completeState",isfromEntity:!1},vV=class{constructor(t,e,i,r,n,s){if(this.object=t,this.data=r,this.sharedAssets=n,this.allowSlerp=s,this.targets={t:0},this.firstLoop=!0,this._changeBegan=!1,this._changeCompleted=!0,this.onChange=()=>{this.callback&&(this.callback.update(this.targets.t),this.object.requestRender()),this.targets.t===0||this.targets.t===1?this._changeCompleted||(this._changeCompleted=!0,this._changeBegan=!1,this.onChangeComplete()):(this._changeCompleted&&(this._changeCompleted=!1),this._changeBegan||(this._changeBegan=!0,this.onChangeBegin()))},this.onChangeBegin=()=>{this.object.reversibleToState=this.to.id;let a=this.targets.t>.5?this.from.id:this.to.id;this.object.prevState!==this.object.currentState&&(this.object.prevState=this.object.currentState),this.object.currentState=a,this.object.dispatchEvent({type:"beginState",state:a}),this.object instanceof Ka||this.object.traverseEntity(o=>{o!==this.object&&o instanceof Gs&&o.dispatchEvent(Gme)})},this.onChangeComplete=()=>{this.firstLoop&&(this.onFirstLoop(),this.firstLoop=!1),this.object.reversibleToState=this.to.id;let a=this.targets.t<.5?this.from.id:this.to.id;this.object.prevState!==this.object.currentState&&(this.object.prevState=this.object.currentState),this.object.currentState=a,this.object.dispatchEvent({type:"completeState",state:a}),this.object instanceof Ka||this.object.traverseEntity(o=>{o!==this.object&&o instanceof Gs&&o.dispatchEvent(Wme)})},this.onFirstLoop=()=>{this.useCurrentState&&(this.callback=Eie(this.object,this.from.data,this.to.data,this.sharedAssets,this.allowSlerp))},e===void 0){let a=gI(this.object,this.object.currentState===i?this.object.prevState:this.object.currentState);if(!a)throw new Error("Missing property");this.from=a}else{let a=gI(this.object,e);if(!a)throw new Error("Missing property");this.from=a}if(i===void 0)throw new Error("Missing property");{let a=gI(this.object,i);if(!a)throw new Error("Missing property");this.to=a}this.useCurrentState=e===void 0||i===void 0,this.params={targets:this.targets,t:1,autoplay:!1,...G3(r),...Hme(r),change:this.onChange},this.callback=Eie(this.object,e===void 0?{}:this.from.data,i===void 0?{}:this.to.data,this.sharedAssets,this.allowSlerp)}get changeBegan(){return this._changeBegan}get changeCompleted(){return this._changeCompleted}},yV=class extends Qa{constructor(t,e,i,r,n){if(super(),this.eventType=t,this.data=e,this.page=i,this.shared=r,this.condition=n,this.toggleIsForward=!1,this.timelineNeedsRebuild=!1,this.hasPlayedOnce=!1,this.onTimelineChangeComplete=()=>{this.data.tweens[0].data.direction!=="normal"&&(this.toggleIsForward=!this.toggleIsForward),this.timelineNeedsRebuild!==!1&&(this.timeline?.pause(),this.buildTimeline({isForward:this.toggleIsForward,needsRebuild:!1,isRebuild:!0}),this.timeline.play())},!e.object)throw new Error("Missing property");let s=this.page.scene.find(e.object)??this.page.uiCanvas?.find(e.object)??this.page.scene.find2DInUIObjects(e.object);if(!s)throw new Error("Missing property");if(!s.states)throw new Error("Missing property");if(this.object=s,e.tweens.length<2)throw new Error("Missing property");this.tweens=Array(this.data.tweens.length-1),this.startOnceDelay=e.tweens[0].data.delayDirection==="start-once"?e.tweens[0].data.delay:0,this.init()}get playing(){return this.timeline?.paused===!1}get changeBegan(){return this.tweens.some(t=>t.changeBegan)??!1}init(){this.initialCurrentState=gI(this.object,this.object.currentState).id,this.toggleIsForward=!1}get currentState(){return this.data.runMode==="Toggle"&&xJ(this.eventType)?this.initialCurrentState:this.object.currentState}buildTimeline({isForward:t=!0,needsRebuild:e=!1,isRebuild:i=!1}={}){try{let r=G3(this.data.tweens[0].data);i&&typeof r.loop=="number"&&r.loop--,this.timeline?.pause(),this.timeline=Gg.timeline({autoplay:!1,...r,...r.loop===!0||r.loop>1?{timelineChangeComplete:this.onTimelineChangeComplete}:{}});let n=this.tweens.findIndex(s=>s?.changeBegan);if(e===!0&&(this.timelineNeedsRebuild=!0),t){let s=n===-1?0:n;for(let a=s;a<this.data.tweens.length-1;a++){let o=this.data.tweens[a],l=this.data.tweens[a+1],c;a===s&&(this.object.wasMovedByUser===!0||this.object.previousAction?.changeBegan===!0)?(c=void 0,this.object instanceof Gs&&(this.object.wasMovedByUser=!1)):c=o.data.state===void 0?this.currentState:o.data.state;let u=new vV(this.object,c,l.data.state===void 0?this.currentState:l.data.state,l.data,this.shared,this.data.allowSlerp??!1);n!==-1&&a===s&&Object.assign(u.params,{startOnceDelay:0}),this.tweens[a]=u,this.timeline.add(u.params,this.timeline.duration+(a===s?r.delay:0))}this.timeline.duration+=r.endDelay}else{let s=n===-1?this.data.tweens.length-1:n+1;for(let a=s;a>0;a--){let o=this.data.tweens[a],l=this.data.tweens[a-1],c;a===s&&(this.object.wasMovedByUser===!0||this.object.previousAction?.changeBegan===!0)?(c=void 0,this.object instanceof Gs&&(this.object.wasMovedByUser=!1)):c=o.data.state===void 0?this.currentState:o.data.state;let u=new vV(this.object,c,l.data.state===void 0?this.currentState:l.data.state,o.data,this.shared,this.data.allowSlerp??!1);n!==-1&&a===s&&Object.assign(u.params,{startOnceDelay:0}),this.tweens[a-1]=u,this.timeline.add(u.params,this.timeline.duration+(a===s?r.endDelay:0))}this.timeline.duration+=r.delay}}catch(r){r instanceof Error&&console.error(r.message)}this.object.previousAction?.playing===!0&&this.object.previousAction.pause(),this.object.previousAction=this}play(){if(Rn(this.shared,this.condition)===!1||xJ(this.eventType)&&this.data.runMode==="Once"&&this.hasPlayedOnce||(this.hasPlayedOnce=!0,this.playing))return!1;this.startTimeout?.pause();let t=G3(this.data.tweens[0].data).pingPongDelayCorrection;Gg({targets:{},duration:this.startOnceDelay+t,easing:"linear",complete:()=>{try{this.buildTimeline(),this.timeline.play()}catch(e){e instanceof Error&&console.error(e.message)}}})}pause(){this.timeline?.pause(),this.startTimeout?.pause(),this.tweens=Array(this.data.tweens.length-1),delete this.startTimeout}stop(){this.pause();let t=this.data.tweens[0].data.state===void 0?this.initialCurrentState:this.data.tweens[0].data.state;this.object instanceof Ka?this.object.changeSelectedState(t,{shared:this.shared}):this.object.changeSelectedState(t,{scene:this.page.scene,shared:this.shared}),this.object.currentState=t}seek(t){if(Rn(this.shared,this.condition)===!1)return!1;this.timeline===void 0&&this.buildTimeline(),this.timeline?.seek(t*this.timeline.duration,!0)}toggle(t){if(Rn(this.shared,this.condition)===!1)return!1;this.startTimeout?.pause(),this.toggleIsForward=t??!this.toggleIsForward,this.playing?(this.timeline?.pause(),this.buildTimeline({isForward:this.toggleIsForward,needsRebuild:!0}),this.timeline.play()):Gg({targets:{},duration:this.startOnceDelay,easing:"linear",complete:()=>{this.timeline?.pause(),this.buildTimeline({isForward:this.toggleIsForward}),this.timeline.play()}})}playFromCurrent(){this.toggle(!0)}reverseFromCurrent(){this.toggle(!1)}dispose(){this.pause()}};function gI(t,e){let i,r;if(typeof e=="string"?(i=e,r=t.states?.[i]):e===null&&(i=null,r=t.data),!(i===void 0||r===void 0))return{id:i,data:r}}var Pft={type:"beginState"},Cie={type:"completeState",isfromEntity:!1},Pie={type:"requestRender"},qme=class extends Qa{constructor(t,e,i,r){super(),this.data=t,this.page=e,this.shared=i,this.condition=r,this.toggleIsForward=!1,this.posStart=new W,this.posEnd=new W,this.qStart=new Ii,this.qEnd=new Ii,this.zoomStart=1,this.zoomEnd=1}init(){}get playing(){return this.animation&&this.animation.began&&!this.animation.completed}buildAnimation(t=!1){if(!this.data.animate)return;let e=this.page.scene.find(this.data.targetCamera);if(!e||!e.visible)throw new ReferenceError("Target camera not founded or not visible");let i={t:0};this.posStart.copy(this.page.activeCamera.position),this.qStart.copy(this.page.activeCamera.quaternion),this.zoomStart=this.page.activeCamera.zoom,this.animation=Gg({targets:i,t:1,...Hme(this.data),update:()=>{i.t===0&&(this.data.runMode==="Toggle"&&!this.toggleIsForward?this.fromCamera&&(this.posEnd.copy(this.fromCamera.position),this.qEnd.copy(this.fromCamera.quaternion),this.zoomEnd=this.fromCamera.zoom,this.switchCamera(this.fromCamera.uuid)):(this.posEnd.copy(e.position),this.qEnd.copy(e.quaternion),this.zoomEnd=e.zoom,this.fromCamera=this.page.activeCamera,this.switchCamera(e.uuid)),this.page.activeCamera.dispatchEvent(Pft));let r=this.page.activeCamera;r.position.lerpVectors(this.posStart,this.posEnd,i.t),r.quaternion.slerpQuaternions(this.qStart,this.qEnd,i.t),r.zoom=this.zoomStart+(this.zoomEnd-this.zoomStart)*i.t,r.wasMovedBySwitchCameraAction=!0,r.updateMatrix(),r.updateMatrixWorld(),r.updateProjectionMatrix(),r.dispatchEvent(Pie),i.t===1&&r.dispatchEvent(Cie)}})}switchCamera(t){let e=this.page.activeCamera,i=this.page.scene.find(t);if(!i||!i.visible)throw new ReferenceError("Target camera not founded or not visible");this.page.switchActiveCamera(i),e.dispatchEvent({type:"cameraChange",camera:i})}play(){if(Rn(this.shared,this.condition)===!1)return!1;if(!this.playing&&this.page.activeCamera.uuid!==this.data.targetCamera)try{clearTimeout(this.timeoutId),this.timeoutId=window.setTimeout(()=>{delete this.timeoutId,this.data.animate?(this.buildAnimation(),this.animation?.play()):this.switchCamera(this.data.targetCamera)},this.data.delay*1e3)}catch{}}pause(){this.animation?.pause(),clearTimeout(this.timeoutId),delete this.timeoutId}toggle(t){if(Rn(this.shared,this.condition)===!1)return!1;if(window.clearTimeout(this.timeoutId),delete this.timeoutId,t!==this.toggleIsForward)try{this.playing?(this.animation?.pause(),this.toggleIsForward=t??!this.toggleIsForward,this.buildAnimation(!0),this.animation?.play()):this.timeoutId=window.setTimeout(()=>{this.toggleIsForward=t??!this.toggleIsForward,this.data.animate?(this.animation?.pause(),this.buildAnimation(),this.animation?.play()):(this.toggleIsForward?(this.fromCamera=this.page.activeCamera,this.switchCamera(this.data.targetCamera)):this.fromCamera&&this.switchCamera(this.fromCamera.uuid),this.page.activeCamera.dispatchEvent(Cie),this.page.activeCamera.dispatchEvent(Pie))},this.data.delay*1e3)}catch{}}playFromCurrent(){this.toggle(!0)}reverseFromCurrent(){this.toggle(!1)}dispose(){this.pause(),this.toggleIsForward=!1}},Xme=class extends Qa{constructor(t,e,i,r){super(),this.id=t,this.data=e,this.scene=i,this.sharedAssets=r,this._finished=!1;try{this.timeline=Gg.timeline({...G3(this.data),autoplay:!1});let n=this.sharedAssets.data.timelineAnimations[this.data.timeline].mapping;Object.entries(n).forEach(([s,a])=>{let o=this.scene.find(s);if(!o)return;let l=o.data.timelineAnimations[a];if(!l)return;let c=O5.addKeyframesToTimeline(o,{...l},Cft(o,this.sharedAssets),this.sharedAssets),u=(this.data.delayDirection==="start"?this.data.delay:0)+(this.data.delayDirection==="start-end"?this.data.delay:0);c.forEach(h=>{this.timeline?.add(h,u)}),this.timeline.duration=l.to*1e3+u}),this.timeline.delay=0,this.timeline.duration+=(this.data.delayDirection==="start"?this.data.delay:0)+(this.data.delayDirection==="end"?this.data.delay:0)+(this.data.delayDirection==="start-end"?this.data.delay*2:0),this.core=this.timeline,this.core.finished.then(()=>{Object.keys(n).forEach(s=>{let a=this.scene.find(s);a instanceof Gs&&a.dispatchEvent(Wme)}),this._finished=!0}),this.startOnceDelay=this.data.delayDirection==="start-once"?this.data.delay:0}catch{throw new Error("Missing property")}}get finished(){return this._finished}get paused(){return this.core.paused}play(){this._finished||(this.startTimeout?.pause(),this.startTimeout=Gg({targets:{},duration:this.startOnceDelay,easing:"linear",complete:()=>{let t=this.sharedAssets.data.timelineAnimations[this.data.timeline].mapping;Object.keys(t).forEach(e=>{let i=this.scene.find(e);i instanceof Gs&&i.dispatchEvent(Gme)}),this.core.play()}}))}pause(){this.core.pause(),this.startTimeout?.pause(),delete this.startTimeout}stop(){this.pause(),this.seek(0),this.core.reset(),this._finished=!1}seek(t){let e=t*this.core.duration;this.core.seek(e)}toggle(t){this.core.pause(),this.startTimeout?.pause(),this.core=this.timeline,this.core.finished.then(()=>{this._finished=!0,this.core.reverse()}),this.core.play()}playFromCurrent(){this.toggle(!0)}reverseFromCurrent(){this.toggle(!1)}dispose(){this.pause()}};function $me(t){let e=t?.tracks.filter(i=>i.ValueTypeName==="vector"||i.ValueTypeName==="quaternion").map(i=>i.times.length);if(e?.length){let i=$et(e);return i&&i>2?i:2}return 2}var Yme=class extends Qa{constructor(t,e,i,r,n){super(),this.data=t,this.page=e,this.animationControls=i,this.shared=r,this.condition=n,this.startOnceDelay=0,this.toggleIsForward=!1;let s=t.object,a=e.scene.find(t.object);a&&Array.isArray(a.identity)&&(s=a.identity[0]),this.data={...t,object:s};let o=this.animationControls.clipIdToAction[t.clipId+"/"+s];if(this.duration=o?.getClip()?.duration??1,this.data.crop2){let l=$me(o?.getClip());this.leftFrameTime=this.data.crop2[0]/(l-1)*this.duration,this.rightFrameTime=this.data.crop2[1]/(l-1)*this.duration}else{let l=o?.getClip()?.tracks[0]?.times.length;l&&l>1?(this.leftFrameTime=this.data.crop[0]/l*this.duration,this.rightFrameTime=this.data.crop[1]/l*this.duration):(this.leftFrameTime=0,this.rightFrameTime=this.duration)}this.startOnceDelay=t.delay}get playing(){return this.threeAnimAction?.isRunning()??!1}play(t=!1){if(Rn(this.shared,this.condition)===!1)return!1;window.clearTimeout(this.timeoutId),this.timeoutId=window.setTimeout(()=>{if(this.threeAnimAction=this.animationControls.play(this.data),!this.threeAnimAction)return;this.threeAnimAction.reset(),this.threeAnimAction.time=this.leftFrameTime,this.threeAnimAction._clip.start=this.leftFrameTime,this.threeAnimAction._clip.duration=this.rightFrameTime;let e=this.data.object;Object.entries(this.animationControls.clipIdToAction).forEach(([i,r])=>{let n=i.split("/")[1];this.threeAnimAction!==r&&n===e&&r.isRunning()&&(t?r.fadeOut(.2):r.stop())}),t&&this.threeAnimAction?.fadeIn(.2)},this.startOnceDelay)}pause(){this.threeAnimAction&&(this.threeAnimAction.paused=!0),window.clearTimeout(this.timeoutId),delete this.timeoutId}stop(){this.threeAnimAction?.fadeOut(.2)}seek(t){this.threeAnimAction=this.animationControls.play(this.data),this.threeAnimAction&&(this.threeAnimAction.paused=!0,this.threeAnimAction.time=Ht.clamp(this.threeAnimAction.time+1/60*t,this.leftFrameTime,this.rightFrameTime-16e-5),this.animationControls.needsUpdate=!0,this.animationControls.requestRender())}toggle(t,e=!1){if(Rn(this.shared,this.condition)===!1)return!1;this.toggleIsForward=t??!this.toggleIsForward,this.threeAnimAction&&(this.threeAnimAction._loopCount=0),this.playing?this.threeAnimAction&&(this.threeAnimAction.timeScale=this.toggleIsForward?1:-1,this.toggleIsForward?(this.threeAnimAction._clip.start=this.leftFrameTime,this.threeAnimAction._clip.duration=this.rightFrameTime):(this.threeAnimAction._clip.start=this.rightFrameTime,this.threeAnimAction._clip.duration=this.leftFrameTime)):this.timeoutId=window.setTimeout(()=>{if(this.threeAnimAction=this.animationControls.play(this.data),this.threeAnimAction){this.toggleIsForward?(this.threeAnimAction.time=this.leftFrameTime,this.threeAnimAction._clip.start=this.leftFrameTime,this.threeAnimAction._clip.duration=this.rightFrameTime):(this.threeAnimAction.time=this.rightFrameTime,this.threeAnimAction._clip.start=this.rightFrameTime,this.threeAnimAction._clip.duration=this.leftFrameTime),this.threeAnimAction.paused=!1,this.threeAnimAction.timeScale=this.toggleIsForward?1:-1;let i=this.data.clipId.split("/")[1];Object.entries(this.animationControls.clipIdToAction).forEach(([r,n])=>{let s=r.split("/")[1];this.threeAnimAction!==n&&s===i&&n.isRunning()&&(e?n.fadeOut(.2):n.stop())}),e&&this.threeAnimAction?.fadeIn(.2)}},this.startOnceDelay)}playFromCurrent(){this.toggle(!0)}reverseFromCurrent(){this.toggle(!1)}dispose(){let t=this.animationControls.clipIdToAction[this.data.clipId+"/"+this.data.object]?.getClip();t&&(t.duration=this.duration),this.pause()}},Kme=class{constructor(t,e,i,r,n){this.data=t,this.page=e,this.eventManager=i,this.shared=r,this.condition=n,this.timeOutId=-1,this.scene=e.scene}dispatch(){if(Rn(this.shared,this.condition)===!1)return!1;this.data.target!==this.page.uuid&&(window.clearTimeout(this.timeOutId),this.timeOutId=window.setTimeout(()=>{this.play()},this.data.delay*1e3))}dispose(){window.clearTimeout(this.timeOutId)}play(){if(this.scene.children.every(e=>e.uuid!==this.data.target||e.data.uiScene))return;this.data.transition==="fade"&&this.data.duration>0&&this.eventManager.eventContext.renderer.renderFromSceneForSceneTransitionPass(this.scene,this.scene.activeCamera,this.data.duration*1e3),this.eventManager.deactivate(),this.eventManager.controlsManager.deactivate();let t=this.scene.activeCamera;this.scene.updatePage(this.data.target),this.scene.traverseVisibleEntity(e=>{e.type==="ParticleSystem"&&(e.sleep(),e.wakeUp(),e.data.autoPlay?e.start():e.stop())}),this.scene.activePage.switchToPlayCamera(),this.scene.activeCamera.copyViewPlaneSize(t),C8(this.scene.activePage,this.shared),this.eventManager.activate(),this.eventManager.controlsManager.activate(this.eventManager)}},Zme=class{constructor(t,e,i,r){this.data=t,this.page=e,this.shared=i,this.condition=r,this.evaluatedCondition=!1}checkConditions(){this.evaluatedCondition=Rn(this.shared,this.condition)}dispatch(){if(this.evaluatedCondition===!1)return!1;let t=this.shared.getVariable(this.data.variableId),e=ope(this.data.expression,this.shared,xo.typeOfVariable(t));e!==void 0&&this.shared.updateVariable(this.data.variableId,typeof e=="string"?{textValue:e}:e)}dispose(){}},Qme=class{constructor(t,e,i,r){this.data=t,this.page=e,this.shared=i,this.condition=r,this.timeoutId=null}dispatchInner(){if(Rn(this.shared,this.condition)===!1)return!1;let t=this.shared.getDynamicVariablePlayState(this.data.variableId);if(this.data.mode==="PlayPause")this.shared.getDynamicVariableToggleIsForward(this.data.variableId)===void 0&&this.shared.setDynamicVariableToggleIsForward(this.data.variableId,!0),this.shared.setDynamicVariablePlayState(this.data.variableId,t==="Playing"?"Paused":"Playing");else if(this.data.mode==="Play"&&t!=="Playing")this.shared.getDynamicVariableToggleIsForward(this.data.variableId)===void 0&&this.shared.setDynamicVariableToggleIsForward(this.data.variableId,!0),this.shared.setDynamicVariablePlayState(this.data.variableId,"Playing");else if(this.data.mode==="Stop"&&t!=="Stopped")this.shared.setDynamicVariablePlayState(this.data.variableId,"Stopped");else if(this.data.mode==="Pause"&&t!=="Paused")this.shared.setDynamicVariablePlayState(this.data.variableId,"Paused");else if(this.data.mode==="Restart")this.shared.setDynamicVariablePlayState(this.data.variableId,"Restarted");else if(this.data.mode==="Toggle"){let e=this.shared.getDynamicVariableToggleIsForward(this.data.variableId);t==="Playing"?this.shared.setDynamicVariableToggleIsForward(this.data.variableId,e===void 0?!1:!e):(this.shared.setDynamicVariableToggleIsForward(this.data.variableId,!e),this.shared.setDynamicVariablePlayState(this.data.variableId,"Playing"))}}dispatch(){let t=this.data.delay,e=this.shared.getDynamicVariablePlayState(this.data.variableId);this.data.mode==="PlayPause"&&e==="Playing"&&(t=this.data.pauseDelay),t!==0?(this.timeoutId&&window.clearTimeout(this.timeoutId),this.timeoutId=window.setTimeout(()=>{this.timeoutId=null,this.dispatchInner()},t)):this.dispatchInner()}dispose(){this.timeoutId&&window.clearTimeout(this.timeoutId)}},Rft=class{constructor(t,e,i,r){this.data=t,this.page=e,this.shared=i,this.condition=r}dispatch(){if(Rn(this.shared,this.condition)===!1)return!1;(this.data.target==="single"?this.data.variableId?[this.data.variableId]:[]:Object.keys(this.shared.getVariables())).forEach(t=>{this.shared.getVariable(t);let e=this.shared.data.variables.data(t)?.value;e!==void 0&&this.shared.updateVariable(t,e),this.shared.enableLocalStorageForPersistentVariables&&localStorage.removeItem(Q5(t))})}dispose(){}},Ift=class{constructor(t,e,i,r){this.data=t,this.page=e,this.shared=i,this.condition=r}dispatch(){if(Rn(this.shared,this.condition)===!1)return!1;this.data.userAPIId&&this.shared.getUserAPI(this.data.userAPIId)?.callUserAPI(this.shared)}dispose(){}};function Rn(t,e){if(e===void 0)return!0;if(e.expression.length===0)return!1;let i=ope(e.expression,t,"boolean");return e.negate?!i:!!i}function Xs(t,e,i,r,n,s){let a={Audio:[],Video:[],Particles:[],Link:[],Destroy:[],Create:[],Reset:[],Transition:[],TimelineAnimation:[],SwitchCamera:[],Animation:[],SceneTransition:[],SetVariable:[],DynamicVariablePlay:[],ClearLocalStorage:[],UserAPI:[]},o=l=>({id:c,data:u})=>{try{u.type==="Audio"?lo[t.type].includes("Audio")&&a.Audio.push(new Ime(c,u,s,r,l)):u.type==="Video"&&!(s instanceof Ka)?lo[t.type].includes("Video")&&a.Video.push(new ege(c,u,s,r,l)):u.type==="Particles"?lo[t.type].includes("Particles")&&a.Particles.push(new Dme(u,i,r,l)):u.type==="Link"?lo[t.type].includes("Link")&&a.Link.push(new cft(u,n.controlsManager,r,l)):u.type==="Create"?lo[t.type].includes("Create")&&a.Create.push(new tge(u,i,n.controlsManager,r,l)):u.type==="Destroy"?lo[t.type].includes("Destroy")&&a.Destroy.push(new Ome(u,i,n.controlsManager,r,l)):u.type==="Reset"?lo[t.type].includes("Reset")&&a.Reset.push(new Lme(u,i,r,n,l)):u.type==="Transition"?lo[t.type].includes("Transition")&&a.Transition.push(new yV(t.type,u,i,r,l)):u.type==="SwitchCamera"?lo[t.type].includes("SwitchCamera")&&a.SwitchCamera.push(new qme(u,i,r,l)):u.type==="SceneTransition"?lo[t.type].includes("SceneTransition")&&a.SceneTransition.push(new Kme(u,i,n,r,l)):u.type==="Animation"?lo[t.type].includes("Animation")&&a.Animation.push(new Yme(u,i,n.animationControls,r,l)):u.type==="SetVariable"?lo[t.type].includes("SetVariable")&&a.SetVariable.push(new Zme(u,i,r,l)):u.type==="DynamicVariablePlay"?lo[t.type].includes("DynamicVariablePlay")&&a.DynamicVariablePlay.push(new Qme(u,i,r,l)):u.type==="Conditional"?lo[t.type].includes("Conditional")&&(u.ifActions.forEach(o({expression:u.condition,negate:!1})),u.elseActions.forEach(o({expression:u.condition,negate:!0}))):u.type==="ClearLocalStorage"?lo[t.type].includes("ClearLocalStorage")&&a.ClearLocalStorage.push(new Rft(u,i,r,l)):u.type==="UserAPI"?lo[t.type].includes("UserAPI")&&a.UserAPI.push(new Ift(u,i,r,l)):u.type==="TimelineAnimation"&&lo[t.type].includes("TimelineAnimation")&&a.TimelineAnimation.push(new Xme(c,u,i.scene,r))}catch{}};return e.forEach(o()),a}function Xa(t){Object.values(t).forEach(e=>{e.forEach(i=>{(i instanceof Ime||i instanceof ege||i instanceof yV||i instanceof Xme||i instanceof Dme||i instanceof Yme||i instanceof yV||i instanceof tge||i instanceof Ome||i instanceof qme||i instanceof Kme||i instanceof Lme||i instanceof Zme||i instanceof Qme)&&i.dispose()})})}function Dft(t,e){let i;if("material"in t){let r=t.material;Array.isArray(r)?i=t.material[0].layers.find(n=>n.uuid===e):i=t.material.layers.find(n=>n.uuid===e)}if(i)return i.color.texture.image.img instanceof HTMLVideoElement?i.color.texture.image.img:void 0}var Jme=new Map,zA=new Map,Ug=class{constructor(t,e,i){this.data=e,this.delay=0,this.status="stopped";let{layerId:r,loop:n,volume:s,delay:a}=e;if(this.object=i,r===void 0)throw new Error("Missing property");let o=Dft(i,r);o&&(this.videoElement=o,this.videoElement.loop=n===1/0,L_&&(this.videoElement.autoplay=!0),s!==void 0&&(this.videoElement.volume=s)),a!==void 0&&(this.delay=a),zA.has(i.uuid)?zA.get(i.uuid).push(this):zA.set(i.uuid,[this]),Jme.set(t,this),this.pause()}mute(){!this.videoElement||(this.videoElement.muted=!0)}unMute(){!this.videoElement||(this.videoElement.muted=!1)}play(t){if(!this.videoElement)return;let e=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);t?(this.mute(),this.delay+=150):e?(this.mute(),window.setTimeout(()=>{this.unMute()},100)):this.unMute(),this.delayTimerId=window.setTimeout(()=>{if(!this.videoElement)return;let i=this.videoElement.play();i!==void 0&&i.then(r=>{}).catch(r=>{this.play()}),this.clearDelay()},this.delay),this.status="playing"}clearDelay(){this.delayTimerId&&(clearTimeout(this.delayTimerId),delete this.delayTimerId)}pause(){!this.videoElement||(this.videoElement.pause(),this.status="paused")}stop(){!this.videoElement||(this.videoElement.pause(),this.videoElement.currentTime=0,this.status="stopped",this.clearDelay())}seek(t){return new Promise((e,i)=>{if(!this.videoElement)return i();let r=this.videoElement.duration;if(r>0){let n=t%r;this.videoElement.currentTime=n}this.videoElement.addEventListener("seeked",()=>e(),{once:!0})})}playByToggle(){this.data.toggle==="stop"?this.status==="playing"?this.stop():(this.stop(),this.play()):this.data.toggle==="pause"?this.status==="playing"?this.pause():this.play():(this.stop(),this.play())}dispose(){!this.videoElement||(this.stop(),this.videoElement.muted=!0)}},xV=class{constructor(t){this.data=t}dispatch(){this.data.playVideo?this.pauseVideo(this.data.playVideo):this.data.object?this.pauseAllVideosFromObject(this.data.object):this.pauseAllVideos()}pauseVideo(t){let e=Jme.get(t);!e||(this.data.delay>0?(this.disposeDelay(),this.timeoutId=window.setTimeout(()=>{e[this.data.interaction](),this.disposeDelay()},this.data.delay)):e[this.data.interaction]())}pauseAllVideosFromObject(t){let e=zA.get(t);!e?.length||(this.data.delay>0?(this.disposeDelay(),this.timeoutId=window.setTimeout(()=>{e.forEach(i=>i[this.data.interaction]()),this.disposeDelay()},this.data.delay)):e.forEach(i=>i[this.data.interaction]()))}pauseAllVideos(){let t=[...zA.values()];!t.length||(this.data.delay>0?(this.disposeDelay(),this.timeoutId=window.setTimeout(()=>{t.forEach(e=>{e.forEach(i=>{i[this.data.interaction]()})}),this.disposeDelay()},this.data.delay)):t.forEach(e=>{e.forEach(i=>{i[this.data.interaction]()})}))}disposeDelay(){clearTimeout(this.timeoutId),delete this.timeoutId}dispose(){clearTimeout(this.timeoutId),delete this.timeoutId}},ege=class{constructor(t,e,i,r,n){if(this.data=e,this.shared=r,this.condition=n,e.interaction==="play")this.interaction=new Ug(t,e,i);else if(e.interaction==="pause"||e.interaction==="stop")this.interaction=new xV(e);else throw new Error("Missing property")}dispatchBasic(){if(Rn(this.shared,this.condition)===!1)return!1;this.interaction instanceof Ug?this.interaction.playByToggle():this.interaction.dispatch()}dispatchConditional(){if(Rn(this.shared,this.condition)===!1)return!1;this.interaction instanceof Ug?this.interaction.play():this.interaction.dispatch()}dispose(){this.interaction.dispose()}},Rie=(()=>{let t,e,i,r;function n(o){!t&&!Iie()&&e?.sharedGameControlGlobals.createdObjects.length>0&&(t=requestAnimationFrame(s)),o&&(e=o,r=o.requestRender)}function s(o){let l=i?o-i:0,c=e.sharedGameControlGlobals.createdObjects,u=e.sharedGameControlGlobals.nCreatedPerAction,h=c.length,d=0;for(;d<h;){let f=c[d];f.userData.createdTime===void 0&&(f.userData.createdTime=o),f.userData.lifetime===void 0&&f.userData.quantity===void 0||f.userData.lifetime&&o-f.userData.createdTime<f.userData.lifetime||f.userData.quantity&&u[f.userData.actionId]<=f.userData.quantity?(f.userData.velocity&&(f.position.addScaledVector(f.userData.velocity,l/1e3),f.updateMatrix(),r()),d++):(u[f.userData.actionId]>f.userData.quantity&&u[f.userData.actionId]--,c.splice(d,1),f.removeFromParent(),e.sharedGameControlGlobals.rapierWorld&&f.rigidBody?(e.sharedGameControlGlobals.colliderToEntity.delete(f.rigidBody.collider(0).handle),e.sharedGameControlGlobals.rapierWorld.removeRigidBody(f.rigidBody)):(f.bvhGeometry=void 0,e.sharedGameControlGlobals.entitiesWithTransformAnim=e.sharedGameControlGlobals.entitiesWithTransformAnim.filter(p=>p.bvhGeometry!==void 0)),h--,r())}t=d>0?requestAnimationFrame(s):void 0,i=d>0?o:void 0}function a(){Iie()?t&&(cancelAnimationFrame(t),t=void 0,i=void 0):n()}return typeof document<"u"&&document.addEventListener("visibilitychange",a),n})();function Iie(){return!!document&&document.hidden}var Die=new Ii,Oft=new W,Lft=new W,tge=class{constructor(t,e,i,r,n){this.data=t,this.page=e,this.controlsManager=i,this.shared=r,this.condition=n,this.intervalId=null,this.timeoutIdQueue=[],this.uniqueId=Ht.generateUUID(),this.dispatch=()=>{if(Rn(this.shared,this.condition)===!1)return!1;this.data.delay?this.timeoutIdQueue.push(window.setTimeout(this.dispatchInner,this.data.delay*1e3)):this.dispatchInner()},this.dispatchFromStart=()=>{if(Rn(this.shared,this.condition)===!1)return!1;this.timeoutIdQueue.push(window.setTimeout(this.dispatchInner,this.data.delay*1e3))},this.dispatchThrottled=dtt(this.dispatch,1e3/this.data.creationSpeed),this.dispatchStart=()=>{this.intervalId===null&&(this.intervalId=window.setInterval(this.dispatch,1e3/this.data.creationSpeed))},this.dispatchStop=()=>{this.intervalId!==null&&(window.clearInterval(this.intervalId),this.intervalId=null)},this.dispatchInner=()=>{this.timeoutIdQueue.shift();let a=new bo(this.object);if(a.playModeVisible=!0,a.expand(),this.data.coordinateSystem!=="world"){let l=this.data.coordinateSystem,c=this.page.scene.find(l);c&&(c.updateMatrixWorldSVD(),a.hiddenMatrix.copy(c.matrixWorldRigid))}a.scale.copy(this.object.scale),a.position.fromArray(this.data.position),a.rotation.fromArray(this.data.rotation),a.updateMatrix(),this.page.add(a);let o=this.controlsManager.sharedGameControlGlobals;o.createdObjects.push(a),o.nCreatedPerAction[this.uniqueId]===void 0?o.nCreatedPerAction[this.uniqueId]=1:o.nCreatedPerAction[this.uniqueId]++,a.updateWorldMatrix(!0,!0),a.traverseObject(this.traverseObjectCB),Rie(),this.controlsManager.requestRender()},this.traverseObjectCB=a=>{a.hasNonUniformScale&&a.updateMatrixWorldSVD();let o;if(this.controlsManager.sharedGameControlGlobals.rapierWorld){if(a instanceof vu)if(a.objectForSample){if(a.objectForSample.dataPatched.physics.fusedBody)return;o=a.object}else return a.object.dataPatched.physics.fusedBody===!0&&a.object.dataPatched.physics.rigidBody==="dynamic"?!0:void 0;else if(a instanceof bo)o=a.object;else if(o=a,o.dataPatched.cloner?.hideBase)return!0}else{if(a instanceof vu)return;a instanceof bo?o=a.object:o=a}this.data.destroy==="Time"?a.userData.lifetime=this.data.lifetime*1e3:this.data.destroy==="Quantity"&&(a.userData.quantity=this.data.destroyAfterQuantity,a.userData.actionId=this.uniqueId);let l=new W().fromArray(this.data.velocity),c=o.dataPatched;if(!(c.physics.enabled==="visibility"?!c.visible:!c.physics.enabled)&&(this.controlsManager.sharedGameControlGlobals.rapierWorld?(this.controlsManager.addRigidBody(a,o,{fromCreate:!0,dynamic:this.data.dynamic}),this.data.destroy==="Collision"&&(a.rigidBody?.collider(0).setActiveEvents(1),a.userData.hasCollisionDestroy=!0),a.matrixWorld.decompose(Oft,Die,Lft),l.applyQuaternion(Die),this.data.velocity.some(u=>u!==0)&&this.data.dynamic&&a.rigidBody?.setLinvel(l.divideScalar(this.controlsManager.pixelsPerMeter),!0)):("geometry"in a.object&&this.controlsManager.addBoundsTree(a),this.data.velocity.some(u=>u!==0)&&this.data.dynamic&&(a.userData.velocity=l)),o.dataPatched.physics?.fusedBody===!0))return!0};let s=this.page.scene.find(this.data.object);if(!s)throw new Error("Missing Property");if(this.object=s,this.data.coordinateSystem!=="world"&&!this.page.scene.find(this.data.coordinateSystem))throw new Error("Missing Property");Rie(i)}dispose(){this.intervalId!==null&&(window.clearInterval(this.intervalId),this.intervalId=null),this.timeoutIdQueue.forEach(t=>window.clearTimeout(t)),this.dispatchThrottled.cancel(),this.page.remove(...this.controlsManager.sharedGameControlGlobals.createdObjects),this.controlsManager.sharedGameControlGlobals.createdObjects=[]}},ige=200,v4=.02,y4=.3,kft=65,Oie=new W,Lie=new W,Nft=new W,ll=new W,zl=new W,ig=new W,x4=new St,kie=new St,Uft=new St;new St;var lh=new Ii,sp=new Ii,hd=new xs(0,0,0,"YXZ"),Bft=new W(1,0,0),ch=new W(0,1,0),Fft=new W(0,0,1),Nie=new W(1,1,1);new oc;var zft=1,jft=.025,Vft=16e-6,Uie=12,Hft=20,ka=new xu,ru=new Ss,Gft={type:"requestRender"},Wft={type:"updateMatrix"},Bie=Math.PI/6,bV=class extends Qa{constructor(t,e,i,r,n,s,a,o,l){super(),this.object=t,this.domElement=e,this.data=i,this.gloabalPhysics=r,this.controlsManager=n,this.cameraFollow=s,this.camera=a,this.page=o,this.sharedAssets=l,this.enableDamping=!0,this.hiddenMatrix0=new St,this.target0=new W,this.zoom0=1,this.rotForce=1,this.moveForce=1,this.pixelsPerMeter=ige,this.euler0=new xs(0,0,0,"YXZ"),this.position0Cam=new W,this.quat0Cam=new Ii,this.scale0Cam=new W,this.hiddenMatrix0Cam=new St,this.threshEndTranslate=.01,this.threshEndRotate=1e-8,this.threshEndRotVel=.005,this.collider={type:"capsule",radius:40,segment:new xu(new W(0,-40,0),new W(0,40,0)),matrix:new St,position:new W,rotation:new Ii},this.euler=new xs(0,0,0,"YXZ"),this.eulerDelta=new W,this.lastPosition=new W,this.lastCameraQuaternion=new Ii,this.lastCameraPosition=new W,this.PI_2=Math.PI/2,this.prevMouse=new Ae,this.velocityTarget=new W,this.velocity=new W,this.directionXZ=new W,this.rotVelocityStick=new W,this.rotVelocityTarget=new W,this.rotVelocity=new W,this.rotDirection=new W,this.nonColliderRotOffset=new St,this.nonColliderPosOffset=new St,this.firstPointerId=-1,this.rot=new W,this.path=[],this.movementState={moveNegZ:0,movePosZ:0,moveNegX:0,movePosX:0,moveNegY:0,movePosY:0,rotPosX:0,rotNegX:0,rotPosY:0,rotNegY:0,jump:0,run:0},this.vrEulerYOffset=0,this.onObject=!1,this.actionState={},this.keyAssignments=[["moveNegZ","W"],["moveNegX","A"],["movePosZ","S"],["movePosX","D"],["rotPosX","ArrowUp"],["rotPosY","ArrowLeft"],["rotNegX","ArrowDown"],["rotNegY","ArrowRight"],["jump"," "]],this.collisionEnabled=!0,this.offsetMatrix=new St,this.objectToTarget=new W,this.objectToTarget0=new W,this.objectToCamXZ=new W,this.objectToCamXZ0=new W,this.targetToCamera=new W,this.targetToCamera0=new W,this.cameraPolarAxis0=new W,this.targetPos=new W,this.targetQuat=new Ii,this.lerpFactorPos=new W().setScalar(.3),this.lerpFactorPosStart=.3,this.lerpFactorPosEnd=.3,this.lerpFactorRotStart=.3,this.lerpFactorRotEnd=.3,this.lerpFactorPosCamera=.3,this.lerpFactorRotCamera=.3,this.objXZQuat=new Ii,this.objXZQuatInv=new Ii,this.objXZRotMat=new St,this.isFirstPerson=!1,this.didHit=!1,this.groundVelocity=new W,this.pushedVelocity=new W,this.groundYRotation=0,this.objectRealQuat=new Ii,this.colliderWorldQuat=new Ii,this.groundNormal=new W,this.groundTilt=new Ii,this.groundTiltInv=new Ii,this.lastHitObj=null,this.isFirstFrame=!0,this.rotationAccumWhenOrientWithCamera=0,this.navMeshPathDest=null,this.position=new W,this.quaternion=new Ii,this.scale=new W,this.initialAction=!0,this.onPointerDown=p=>{!(p.target===this.domElement||p.target instanceof HTMLElement&&p.target.tagName==="SPLINE-VIEWER"&&p.target.shadowRoot?.contains(this.domElement))||this.firstPointerId!==-1||(this.firstPointerId=p.pointerId,this.domElement.ownerDocument.addEventListener("pointermove",this.onPointerMove),this.domElement.ownerDocument.addEventListener("pointerup",this.onPointerUp),this.rotBy!=="keys"&&!Pc&&!nJ&&this.domElement.requestPointerLock(),this.prevMouse.set(p.clientX,p.clientY))},this.onPointerUp=p=>{this.firstPointerId=-1,this.domElement.ownerDocument.removeEventListener("pointermove",this.onPointerMove),this.domElement.ownerDocument.removeEventListener("pointerup",this.onPointerUp),p.pointerType==="mouse"&&this.domElement.ownerDocument.exitPointerLock()},this.onPointerMove=p=>{if(p.pointerId!==this.firstPointerId)return;let g=p.clientX-this.prevMouse.x,m=p.clientY-this.prevMouse.y;this.prevMouse.set(p.clientX,p.clientY),p.pointerType==="mouse"&&this.rotBy!=="keys"&&(nJ&&Mtt<15.5&&!Pc?(this.eulerDelta.y=-g*this.mouseOrbitSensitivity,this.eulerDelta.x=-m*this.mouseOrbitSensitivity):(this.eulerDelta.y=-p.movementX*this.mouseOrbitSensitivity,this.eulerDelta.x=-p.movementY*this.mouseOrbitSensitivity)),p.pointerType!=="mouse"&&this.rotByTouch==="drag"&&(this.eulerDelta.y=-g*this.mouseOrbitSensitivity*5,this.eulerDelta.x=-m*this.mouseOrbitSensitivity*5),this.controlsManager.requestRender()},this.onPointerlockChange=p=>{this.domElement.ownerDocument.pointerLockElement===this.domElement?bV.isLocked=!0:bV.isLocked=!1},this.onPointerlockError=()=>{console.error("SPE.GameControls: Unable to use Pointer Lock API")},this.handleVisibilityChange=()=>{if(document?.hidden)for(let p in this.movementState)this.movementState[p]=0},this.onKeyDown=p=>{!(p.target instanceof HTMLInputElement)&&(p.code==="ArrowLeft"||p.code==="ArrowUp"||p.code==="ArrowRight"||p.code==="ArrowDown"||p.code==="Space")&&p.preventDefault();for(let g of this.keyAssignments)if(p.key.toUpperCase()===g[1]||p.key===g[1]){this.movementState[g[0]]=1;break}this.controlsManager.requestRender()},this.onKeyUp=p=>{for(let g of this.keyAssignments)if(p.key.toUpperCase()===g[1]||p.key===g[1]||p.code.slice(3,p.code.length).toUpperCase()===g[1]){this.movementState[g[0]]=0;break}},this.copyVRGamePadValues=(p,g)=>{for(let m=2;m<4;m++){let y=p.axes[m];g===0?m===2?this.movementState.movePosX=y:this.movementState.movePosZ=y:(p.buttons[3].pressed?this.movementState.jump=1:this.movementState.jump=0,m===2?(Math.abs(this.movementState.rotPosY)<.3&&Math.abs(y)>=.3&&(this.vrEulerYOffset+=y<0?1:-1),this.movementState.rotPosY=y):this.moveMode==="fly"&&(this.movementState.moveNegY=y))}},this.sharedGameControlGlobals=n.sharedGameControlGlobals,t===a&&(this.isFirstPerson=!0),this.hiddenMatrix0.copy(this.object.hiddenMatrix),this.object.parent?this.object.hiddenMatrix.copy(this.object.parent.matrixWorld).invert():this.object.hiddenMatrix.identity(),this.object.matrix.copy(this.object.matrixWorld),this.object.matrix.decompose(this.position,this.quaternion,this.scale),this.euler0.setFromQuaternion(this.quaternion,"YXZ");let c=this.euler0.clone(),u=c.y;if(this.objectRealQuat.copy(this.quaternion),c.y=0,this.quaternion.setFromEuler(c),this.objXZQuat.copy(this.quaternion),this.objXZQuatInv.copy(this.objXZQuat).invert(),this.objXZRotMat.makeRotationFromQuaternion(this.quaternion),c.set(0,u,0),this.quaternion.setFromEuler(c),this.rot.setFromEuler(c),this.object.matrixAutoUpdate=!1,(this.isFirstPerson||this.cameraFollow===!0)&&(this.target0.copy(this.camera.getTarget()),this.zoom0=this.camera.zoom),this.cameraFollow===!0){this.position0Cam.copy(this.camera.position),this.quat0Cam.copy(this.camera.quaternion),this.scale0Cam.copy(this.camera.scale),this.hiddenMatrix0Cam.copy(this.camera.hiddenMatrix),this.camera.parent?(this.camera.hiddenMatrix.copy(this.camera?.parent.matrixWorld),this.camera.matrix.copy(this.camera.matrixWorld)):this.camera.hiddenMatrix.identity(),this.camera.matrix.copy(this.camera.matrixWorld),this.camera.matrix.decompose(this.camera.position,this.camera.quaternion,this.camera.scale),this.camera.matrixAutoUpdate=!1,this.offsetMatrix.copy(this.object.matrix).invert().multiply(this.camera.matrix);let p=new W(0,0,-1).applyQuaternion(this.camera.quaternion),g=new W().subVectors(this.position,this.camera.position);this.objectToCamXZ.copy(g),this.objectToCamXZ.y=0,this.objectToCamXZ0.copy(this.objectToCamXZ);let m,y;Math.abs(p.y)<1e-6?(g.y=0,p.y=0,y=g.projectOnVector(p)):g.y/p.y>0?y=p.multiplyScalar(g.y/p.y):y=p.multiplyScalar(g.length()),this.targetToCamera0.copy(y).negate(),m=this.camera.position.clone().add(y),this.objectToTarget0.subVectors(m,this.position);let b=new xs().setFromQuaternion(this.camera.quaternion,"YXZ");this.cameraPolarOffset=-b.x,b.x=0,b.z=0,b.y-=Math.PI/2,this.cameraPolarAxis0.set(0,0,-1).applyEuler(b)}if(this.object instanceof Gs&&(this.object.matrixAutoUpdate=!1),this.euler.setFromQuaternion(this.quaternion,"YXZ"),this.rotByTouch=i.rotByTouch??"joystick",this.rotBy=i.rotBy??"keys",this.rotationMode=i.rotationMode??"normal",this.moveMode=i.moveMode??"walk",this.collisionEnabled=i.collisionEnabled,this.speedTranslate=(i.speedTranslate??250)*zft,this.speedOrbit=(i.speedRotate??100)*jft,this.mouseOrbitSensitivity=(i.speedRotate??100)*Vft,this.keyAssignments=i.keyAssignments.map(p=>{let g=[p[0],p[1]];return g[1]===""?g[1]="ArrowUp":g[1]===""?g[1]="ArrowLeft":g[1]===""?g[1]="ArrowDown":g[1]===""?g[1]="ArrowRight":g[1]===""?g[1]="Shift":g[1]===""?g[1]="Enter":g[1]==="Space"?g[1]=" ":g[1]===""?g[1]="Meta":g[1]==="Ctrl"?g[1]="Control":g[1]==="Esc"&&(g[1]="Escape"),g}),i.rotBy==="mouse"){let p;p=this.keyAssignments.findIndex(g=>g[0]==="rotNegX"),p!==-1&&(this.keyAssignments[p][1]=""),p=this.keyAssignments.findIndex(g=>g[0]==="rotPosX"),p!==-1&&(this.keyAssignments[p][1]=""),p=this.keyAssignments.findIndex(g=>g[0]==="rotPosY"),p!==-1&&(this.keyAssignments[p][1]=""),p=this.keyAssignments.findIndex(g=>g[0]==="rotNegY"),p!==-1&&(this.keyAssignments[p][1]="")}this.lerpFactorPosStart=1-.02**(1/((i.delayPos[0]??.3)*60)),this.lerpFactorPosEnd=1-.02**(1/((i.delayPos[1]??.3)*60)),this.lerpFactorPos.setScalar(this.lerpFactorPosStart),this.lerpFactorRotStart=1-.02**(1/((i.delayRot[0]??.3)*60)),this.lerpFactorRotEnd=1-.02**(1/((i.delayRot[1]??.3)*60)),this.lerpFactorPosCamera=1-.02**(1/((i.delayPosCamera??.3)*60)),this.lerpFactorRotCamera=1-.02**(1/((i.delayRotCamera??.3)*60)),this.gravity=(this.gloabalPhysics.gravity??K1.defaultData.gravity)*Uie,this.usePhysics=this.gloabalPhysics.usePhysics??K1.defaultData.usePhysics,this.jumpPower=i.jumpPower*Hft,this.resetYPosition=this.position.y+Math.abs(i.resetYPosition)*(this.gravity>0?1:-1),this.alignToGround=i.alignToGround??!1,this.orientMode=i.autoOrientMove?i.orientMode:"none",this.orientWith=i.orientWith??S3.defaultDataThirdPerson.orientWith,this.slopeThresh=kft*Math.PI/180,i.collider.type==="capsule"?(this.collider.radius=i.collider.radius,this.collider.segment.start.y=i.collider.height/2-i.collider.radius,this.collider.segment.end.y=-this.collider.segment.start.y,this.offset=i.collider.height*v4/this.pixelsPerMeter,this.stepThresh=i.collider.height*y4/this.pixelsPerMeter,this.colliderHeight=i.collider.height):i.collider.type==="sphere"?(this.collider.radius=i.collider.radius,this.collider.segment.start.y=0,this.collider.segment.end.y=0,this.offset=2*i.collider.radius*v4/this.pixelsPerMeter,this.stepThresh=2*i.collider.radius*y4/this.pixelsPerMeter,this.colliderHeight=i.collider.radius*2):(this.offset=i.collider.height*v4/this.pixelsPerMeter,this.stepThresh=i.collider.height*y4/this.pixelsPerMeter,this.colliderHeight=i.collider.height),this.collider.type=i.collider.type;let h=new W().fromArray(i.collider.position),d=new Ii().setFromEuler(new xs().fromArray([...i.collider.rotation,"XYZ"]));this.collider.position.copy(h).multiply(this.scale),this.collider.rotation.copy(d),this.collider.matrix.compose(h,d,Nie),i.cameraXAxis!==void 0&&(this.cameraXAxis=i.cameraXAxis,this.cameraYAxis=i.cameraYAxis,this.minPolarAngle=i.cameraRotXLimits[0],this.maxPolarAngle=i.cameraRotXLimits[1],this.minAzimuthAngleRel=i.cameraRotYLimits[0],this.maxAzimuthAngleRel=i.cameraRotYLimits[1]),this.forwardDir=i.forwardDirection??"-z",this.isFirstPerson&&(this.forwardDir="-z"),this.runMultiplier=i.runMultiplier??2;let f=i.navmesh.destinationHelperRadius*2;if(f>0){let p=new ni;p.push({fi:0,data:{...Ba.defaultData("light","phong"),alpha:0},id:"layer1"}),p.push({fi:0,data:{...Ba.defaultData("color"),color:i.navmesh.destinationHelperColor,alpha:i.navmesh.destinationHelperColor.a},id:"layer2"});let g=new c8({layers:p},{scene:this.page.scene,shared:this.sharedAssets});this.navMeshPathDest=new En(Ffe.create({parameters:{width:f,height:f/10,hollow:.7}}),g),this.navMeshPathDest.material.userData.opacity0=i.navmesh.destinationHelperColor.a}this.activate()}reset(t=!1){if(this.object.hiddenMatrix.copy(this.hiddenMatrix0),t){this.object.updateMatrix(),this.object.updateMatrixWorld(),this.object.matrix.copy(this.object.matrixWorld),this.object.matrix.decompose(this.position,this.quaternion,this.scale),this.object.parent?this.object.hiddenMatrix.copy(this.object.parent.matrixWorld).invert():this.object.hiddenMatrix.identity();let e=new xs().setFromQuaternion(this.quaternion,"YXZ"),i=e.y;this.objectRealQuat.copy(this.quaternion),e.y=0,this.quaternion.setFromEuler(e),this.objXZQuat.copy(this.quaternion),this.objXZQuatInv.copy(this.objXZQuat).invert(),this.objXZRotMat.makeRotationFromQuaternion(this.quaternion),e.set(0,i,0),this.quaternion.setFromEuler(e),this.rot.setFromEuler(e),this.euler.setFromQuaternion(this.quaternion,"YXZ"),this.velocityTarget.set(0,0,0),this.velocity.set(0,0,0)}else this.object instanceof Gs?this.object.matrixAutoUpdate=!0:this.object.updateMatrix();this.cameraFollow===!0&&(this.camera.quaternion.copy(this.quat0Cam),this.camera.position.copy(this.position0Cam),this.camera.scale.copy(this.scale0Cam),this.camera.hiddenMatrix.copy(this.hiddenMatrix0Cam),this.camera.matrixAutoUpdate=!0),this.controlsManager.requestRender()}activate(){this.instantiateActions(),this.domElement.ownerDocument.addEventListener("pointerdown",this.onPointerDown),this.domElement.ownerDocument.addEventListener("keydown",this.onKeyDown),this.domElement.ownerDocument.addEventListener("keyup",this.onKeyUp),this.domElement.ownerDocument.addEventListener("pointerlockchange",this.onPointerlockChange),this.domElement.ownerDocument.addEventListener("pointerlockerror",this.onPointerlockError),this.domElement.ownerDocument.addEventListener("visibilitychange",this.handleVisibilityChange)}deactivate(){this.disposeActions(),this.domElement.ownerDocument.removeEventListener("pointerdown",this.onPointerDown),this.domElement.ownerDocument.removeEventListener("keydown",this.onKeyDown),this.domElement.ownerDocument.removeEventListener("keyup",this.onKeyUp),this.domElement.ownerDocument.removeEventListener("pointerlockchange",this.onPointerlockChange),this.domElement.ownerDocument.removeEventListener("pointerlockerror",this.onPointerlockError),this.domElement.ownerDocument.removeEventListener("visibilitychange",this.handleVisibilityChange)}dispose(){this.deactivate(),this.navMeshPathDest?.parent&&this.page.remove(this.navMeshPathDest)}instantiateActions(){let t=this.data,e=this.sharedAssets;t.gameActions!==void 0&&(this.actions={},_3.list.forEach(i=>{this.actions[i]=Xs({...t,disabled:!1,type:"GameControl"},t.gameActions[i],this.page,e,this.controlsManager.eventManager,this.object)})),this.dispatchStopEvent("move"),this.dispatchStopEvent("run"),this.dispatchStopEvent("jump"),this.dispatchStartEvent("idle"),this.initialAction&&(this.initialAction=!1)}disposeActions(){this.initialAction=!1,this.dispatchStopEvent("idle"),this.dispatchStopEvent("move"),this.dispatchStopEvent("run"),this.dispatchStopEvent("jump"),Xa(this.actions.idle),Xa(this.actions.move),Xa(this.actions.run),Xa(this.actions.jump)}dispatchStartEvent(t){this.actions[t]!==void 0&&(this.actionState[t]||(this.actionState[t]=!0,this.actions[t].Transition.forEach(e=>{e.play()}),this.actions[t].Animation.forEach(e=>{e.play(this.initialAction===!1)}),this.actions[t].TimelineAnimation.forEach(e=>{e.play()}),this.actions[t].Create.forEach(e=>{e.dispatchStart()}),this.actions[t].Audio.forEach(e=>{e.dispatchGameControl("start")}),this.actions[t].Particles.forEach(e=>{e.dispatchGameControl("start")})))}dispatchStopEvent(t){this.actions[t]!==void 0&&(!this.actionState[t]||(this.actionState[t]=!1,this.actions[t].Transition.forEach(e=>{e.stop(),e.object.currentState!==null&&e.object.changeSelectedState(null,{scene:this.page.scene,shared:this.sharedAssets})}),this.actions[t].TimelineAnimation.forEach(e=>{e.stop()}),this.actions[t].Create.forEach(e=>{e.dispatchStop()}),this.actions[t].Audio.forEach(e=>{e.dispatchGameControl("stop")}),this.actions[t].Particles.forEach(e=>{e.dispatchGameControl("stop")})))}get colliderWorldPosition(){return ll.copy(this.collider.position).applyQuaternion(this.objectRealQuat).add(this.position)}update(t,e,i){if(this.gravity<0?this.position.y<this.resetYPosition:this.position.y>this.resetYPosition)return this.reset(!0),!0;this.sharedGameControlGlobals.gamePads.forEach(this.copyVRGamePadValues);let r=(this.isFirstFrame?16.6:t)/1e3;this.isFirstFrame&&(this.isFirstFrame=!1);let n=r*60,s=!1;if(this.usePhysics&&this.collisionEnabled){let o=zl.set(0,(this.velocity.y===0?this.pixelsPerMeter*Math.max(Math.abs(this.gravity)/(10*Uie),1)*(this.gravity>0?1:-1):this.velocity.y)*r,0).divideScalar(this.pixelsPerMeter),l=this.sharedGameControlGlobals.rapierWorld.castShape(this.colliderWorldPosition.divideScalar(this.pixelsPerMeter),this.colliderWorldQuat,o,this.object.rigidBody?.collider(0).shape,1,!1,16,void 0,void 0,this.object.rigidBody);if(l){this.onObject=!0,this.groundNormal.set(l.normal2.x,l.normal2.y,l.normal2.z).applyQuaternion(this.colliderWorldQuat).negate(),this.alignToGround&&this.groundTiltAdjustment(this.groundNormal),Math.acos(this.groundNormal.y)<this.slopeThresh&&(s=!0),l.collider.parent()?.bodyType()===0&&Math.acos(this.groundNormal.y)*(180/Math.PI)>45&&(this.onObject=!1);let c=l.collider.parent();this.groundYRotation=0,this.groundVelocity.set(0,0,0);for(let u of this.sharedGameControlGlobals.entitiesWithTransformAnim)if(u.rigidBody===c&&u.userData.isFollowingObj!==this.object.uuid){(u.hasNonUniformScale?u.matrixWorldRigid:u.matrixWorld).decompose(ll,sp,zl),this.groundVelocity.subVectors(ll,u.prevT),this.object.getWorldPosition(zl).add(this.collider.position).sub(ll),this.groundYRotation=hd.setFromQuaternion(sp).y-u.prevR.y,ig.copy(zl).applyAxisAngle(ch,this.groundYRotation),this.groundVelocity.add(ig.sub(zl)).divideScalar(r);break}}else this.onObject=!1}if(this.moveMode==="walk"&&this.collisionEnabled&&(this.movementState.jump===1&&this.onObject&&(this.velocityTarget.y=this.jumpPower,this.movementState.jump=0,this.dispatchStopEvent("idle"),this.dispatchStopEvent("move"),this.dispatchStopEvent("run"),this.dispatchStopEvent("jump"),this.dispatchStartEvent("jump"),this.onObject=!1),this.onObject?this.velocityTarget.y/=2:this.velocityTarget.y+=this.gravity*n),this.moveMode==="fly"&&(this.velocityTarget.y=(this.movementState.movePosY-this.movementState.moveNegY)*this.speedTranslate),this.directionXZ.z=this.movementState.movePosZ-this.movementState.moveNegZ,this.directionXZ.x=this.movementState.movePosX-this.movementState.moveNegX,this.forwardDir==="+z"&&this.directionXZ.multiplyScalar(-1),this.directionXZ.manhattanLength()>0&&(this.path=[]),this.navMeshPathDest){let o=this.navMeshPathDest.material;if(this.moveMode==="walk"&&this.path.length>1){this.navMeshPathDest.position.copy(this.path[this.path.length-1]),this.navMeshPathDest.parent||this.page.add(this.navMeshPathDest);let l=ll.subVectors(this.path[1],this.position),c=zl.subVectors(this.path[1],this.path[0]);l.dot(c)<0?this.path.shift():(this.directionXZ.x=c.x,this.directionXZ.z=c.z),o.opacity=o.userData.opacity0}else o.opacity-=.05*o.userData.opacity0,this.navMeshPathDest.material.opacity<=0&&this.navMeshPathDest.parent&&this.page.remove(this.navMeshPathDest)}this.directionXZ.normalize(),this.movementState.run?this.moveForce=this.runMultiplier:this.moveForce=1,this.velocityTarget.z=this.directionXZ.z*this.speedTranslate*this.moveForce,this.velocityTarget.x=this.directionXZ.x*this.speedTranslate*this.moveForce,(this.moveMode==="walk"?this.velocityTarget.x+this.velocityTarget.z===0:this.velocityTarget.manhattanLength()===0)?this.lerpFactorPos.setScalar(this.lerpFactorPosEnd):this.lerpFactorPos.setScalar(this.lerpFactorPosStart),this.moveMode==="walk"&&(this.lerpFactorPos.y=1),this.didHit===!1&&this.pushedVelocity.manhattanLength()===0||this.usePhysics===!1?(this.velocity.x+=(this.velocityTarget.x-this.velocity.x)*(1-(1-this.lerpFactorPos.x)**n),this.velocity.y+=(this.velocityTarget.y-this.velocity.y)*(1-(1-this.lerpFactorPos.y)**n),this.velocity.z+=(this.velocityTarget.z-this.velocity.z)*(1-(1-this.lerpFactorPos.z)**n)):this.velocity.copy(this.velocityTarget),(this.moveMode==="walk"?this.velocity.x**2+this.velocity.z**2<this.speedTranslate:this.velocity.lengthSq()<this.speedTranslate)?(this.dispatchStopEvent("move"),this.dispatchStopEvent("run"),this.onObject&&(this.dispatchStopEvent("jump"),this.dispatchStartEvent("idle"))):(this.dispatchStopEvent("idle"),(this.onObject||this.moveMode==="fly")&&(this.dispatchStopEvent("jump"),this.movementState.run?(this.dispatchStopEvent("move"),this.dispatchStartEvent("run")):(this.dispatchStopEvent("run"),this.dispatchStartEvent("move"))));let a=Nft.copy(this.velocity);if(this.orientMode!=="none"&&this.isFirstPerson===!1){let o=zl.copy(a);o.y=0,a.set(0,a.y,o.length()*(this.forwardDir==="+z"?1:-1))}if(this.directionXZ.manhattanLength()>0&&this.orientMode!=="none"&&this.isFirstPerson===!1)if(this.orientWith==="camera"&&this.path.length<=1){let o=ll;this.camera.getWorldDirection(o);let l=ig.copy(ch).multiplyScalar(o.dot(ch));o.sub(l);let c=zl.copy(this.directionXZ);c.x*=-1,this.rot.y=o.angleTo(c)*(o.cross(c).y>0?-1:1)+this.rotationAccumWhenOrientWithCamera}else this.rot.y=(this.path.length>1?0:this.euler.y)+Math.atan2(-this.directionXZ.z,this.directionXZ.x)+Math.PI/2*(this.forwardDir==="+z"?1:-1);if(hd.setFromVector3(this.rot),this.moveMode==="walk"&&(hd.x=0),a.applyEuler(hd),s&&(sp.setFromUnitVectors(ch,this.groundNormal),a.applyQuaternion(sp)),i){let o=hd.set(0,this.vrEulerYOffset*Bie,0);i.applyEuler(o),a.x+=i.x,a.z+=i.z,this.nonColliderPosOffset.elements[13]+=i.y*r}if(this.usePhysics===!0){let o=zl;this.pushedVelocity.set(0,0,0);for(let l of this.sharedGameControlGlobals.entitiesWithTransformAnim){let c=ig.setFromMatrixPosition(l.matrixWorld).sub(l.prevT).divideScalar(r).divideScalar(this.pixelsPerMeter),u=l.rigidBody.collider(0).castCollider(c,this.object.rigidBody.collider(0),ll.copy(a).divideScalar(this.pixelsPerMeter),r,!1);c.multiplyScalar(this.pixelsPerMeter);let h=Er.is(l)?l:l.object;if(u!==null&&this.lastHitObj!==h){let d;l instanceof bo&&(d=l);let f=this.sharedGameControlGlobals.entityToCollisionEvents[h.uuid];if(f)for(let p of f)p.data.target==="character"&&(p.dispatch(d),h.dispatchEvent(_V));this.lastHitObj=h}if(u!==null){this.pushedVelocity.copy(c),o.copy(u.normal1).applyQuaternion(l.quaternion);break}}if(this.pushedVelocity.manhattanLength()!==0){let l=o.dot(a);l<0&&a.addScaledVector(o,-l),a.add(this.pushedVelocity)}else a.add(this.groundVelocity)}if(this.rotDirection.y=Number(this.movementState.rotPosY)-Number(this.movementState.rotNegY),this.rotDirection.x=Number(this.movementState.rotPosX)-Number(this.movementState.rotNegX),this.rotDirection.normalize(),this.rotationMode==="normal"&&(this.movementState.rotPosX||this.movementState.rotNegX)||this.rotationMode==="steer"&&(this.movementState.rotPosX||this.movementState.rotNegX)&&(this.movementState.movePosZ||this.movementState.moveNegZ||this.moveMode==="walk")?this.rotVelocityStick.x=-this.rotDirection.x*this.speedOrbit*this.rotForce:this.rotVelocityStick.x=0,this.rotationMode==="normal"&&(this.movementState.rotPosY||this.movementState.rotNegY)||this.rotationMode==="steer"&&(this.movementState.rotPosY||this.movementState.rotNegY)&&(this.movementState.movePosZ||this.movementState.moveNegZ)?this.rotVelocityStick.y=-this.rotDirection.y*this.speedOrbit*this.rotForce:this.rotVelocityStick.y=0,this.rotVelocityTarget.subVectors(this.eulerDelta.divideScalar(r),this.rotVelocityStick),this.rotVelocityTarget.manhattanLength()===0?this.rotVelocity.lerp(this.rotVelocityTarget,1-(1-this.lerpFactorRotEnd)**n):this.rotVelocity.lerp(this.rotVelocityTarget,1-(1-this.lerpFactorRotStart)**n),this.euler.x+=this.rotVelocity.x*r,this.euler.y+=this.rotVelocity.y*r+this.groundYRotation,this.rotVelocityTarget.y===0&&this.directionXZ.manhattanLength()===0?this.rotationAccumWhenOrientWithCamera=0:(this.cameraFollow===!1||this.cameraYAxis==="Locked")&&(this.rotationAccumWhenOrientWithCamera+=this.rotVelocity.y*r),this.isFirstPerson===!1&&this.orientMode!=="none"&&this.directionXZ.manhattanLength()>0){if(this.orientMode==="radial"){this.objectToCamXZ.copy(this.objectToCamXZ0).applyAxisAngle(ch,this.euler.y-this.euler0.y);let o=zl.copy(this.objectToCamXZ).normalize(),l=ig.copy(a).multiplyScalar(r);l.y=0;let c=l.sub(ll.copy(o).multiplyScalar(l.dot(o))).cross(o).y;this.euler.y-=Math.atan2(c,this.objectToCamXZ.length())}}else this.rot.y+=this.rotVelocity.y*r+this.groundYRotation,this.rotVelocityTarget.y!==0&&(this.cameraFollow===!1||this.cameraYAxis==="Locked")&&(this.euler.y=this.rot.y);if(this.cameraFollow===!0&&(this.moveMode==="walk"?this.cameraXAxis==="Limit"?this.euler.x=Ht.clamp(this.euler.x,-this.maxPolarAngle+this.cameraPolarOffset+1e-6,-this.minPolarAngle+this.cameraPolarOffset-1e-6):this.euler.x=Ht.clamp(this.euler.x,-this.PI_2+this.cameraPolarOffset,this.PI_2+this.cameraPolarOffset):this.cameraXAxis==="Limit"&&(this.euler.x=Ht.clamp(this.euler.x,-this.PI_2,this.PI_2))),this.moveMode==="fly"?this.rot.x=this.euler.x:this.isFirstPerson&&(e?(hd.copy(e),hd.y=0):(hd.copy(this.euler),hd.y=0),this.nonColliderRotOffset.makeRotationFromEuler(hd)),e&&(this.moveMode==="walk"?(this.rot.y=e.y,this.rot.x=0,this.rot.z=0):this.rot.setFromEuler(e),this.rot.y+=this.vrEulerYOffset*Bie),lh.setFromAxisAngle(Bft,this.rot.x),sp.setFromAxisAngle(ch,this.rot.y),sp.multiply(lh),lh.setFromAxisAngle(Fft,this.rot.z),sp.multiply(lh),this.quaternion.copy(sp),this.objectRealQuat.multiplyQuaternions(this.quaternion,this.objXZQuat),this.colliderWorldQuat.copy(this.objectRealQuat).multiply(this.collider.rotation),this.collisionEnabled)if(this.usePhysics){let o=zl.copy(a).multiplyScalar(r/this.pixelsPerMeter),l=null;this.didHit=!1;let c=new W;for(let u=0;u<5;u++){let h=o.length(),d=ig.copy(o).normalize();if(l=this.sharedGameControlGlobals.rapierWorld.castShape(this.colliderWorldPosition.divideScalar(this.pixelsPerMeter).add(c),this.colliderWorldQuat,d,this.object.rigidBody?.collider(0).shape,h,!1,24,void 0,void 0,this.object.rigidBody),l!==null){this.didHit=!0;let f=this.sharedGameControlGlobals.colliderToEntity.get(l.collider.handle);if(f!==this.lastHitObj&&u===0){this.lastHitObj=f;let y=this.sharedGameControlGlobals.entityToCollisionEvents[f?.uuid];if(y){for(let b of y)if(b.data.target==="character"){let w=(this.sharedGameControlGlobals.rapierWorld?.getCollider(l.collider.handle))._parent,E;if(f.cloner){for(let M of f.cloner.children)if(M.rigidBody===w){E=M;break}}b.dispatch(E),f.dispatchEvent(_V)}}}let p=Oie.set(l.normal2.x,l.normal2.y,l.normal2.z).applyQuaternion(this.colliderWorldQuat),g=Lie.copy(d).multiplyScalar(l.toi).dot(p),m=l.toi;if(m===0&&(this.position.y+=this.offset*this.pixelsPerMeter),g>this.offset&&(m=l.toi*(g-this.offset)/g,c.addScaledVector(d,m)),o.copy(d).multiplyScalar(h-m),Math.acos(-p.y)>this.slopeThresh){let y=this.colliderWorldPosition.divideScalar(this.pixelsPerMeter).add(c),b=ig.copy(l.witness2).applyQuaternion(this.colliderWorldQuat);b.y=0;let w=y.add(b);w.y+=this.stepThresh;let E=this.sharedGameControlGlobals.rapierWorld.castShape(w,this.colliderWorldQuat,o,this.object.rigidBody?.collider(0).shape,1,!1,24,void 0,void 0,this.object.rigidBody);E!==null&&E.toi===0&&(p.y=0,p.normalize())}o.addScaledVector(p,-o.dot(p))}else{u===0&&this.directionXZ.manhattanLength()!==0&&(this.lastHitObj=null),c.add(o);break}}this.position.addScaledVector(c,this.pixelsPerMeter),this.object.rigidBody?.setTranslation(ll.copy(this.position).divideScalar(this.pixelsPerMeter),!0),this.object.rigidBody?.setRotation(lh.copy(this.quaternion).premultiply(this.groundTilt).multiply(this.objXZQuat),!0)}else{let o=this.onObject?1:5,l=a.multiplyScalar(r/o);for(let c=0;c<o;c++)this.position.add(l),this.collisionAdjustment(r/o)}else this.position.addScaledVector(a,r);if(this.moveMode==="walk"&&this.onObject&&(this.velocityTarget.y=0,this.velocity.y=0),this.quaternion.premultiply(this.groundTilt).multiply(this.objXZQuat),this.object.matrix.compose(this.position,this.quaternion,this.scale),this.object.matrixWorldNeedsUpdate=!0,this.object.matrix.multiply(this.nonColliderPosOffset).multiply(this.nonColliderRotOffset),this.quaternion.premultiply(this.groundTiltInv).multiply(this.objXZQuatInv),this.cameraFollow===!0){this.updateFollowArms();let o=this.objectToTarget.add(this.position),l=this.targetToCamera.add(o);x4.lookAt(l,o,ch).setPosition(l),x4.decompose(this.targetPos,this.targetQuat,ll),this.camera.quaternion.slerp(this.targetQuat,1-(1-this.lerpFactorRotCamera)**n),this.camera.position.lerp(this.targetPos,1-(1-this.lerpFactorPosCamera)**n),this.camera.updateMatrix(),this.camera.updateMatrixWorld(),this.cameraYAxis==="Limit"&&this.orientMode==="cartesian"&&(this.euler.y=Ht.clamp(this.euler.y,this.minAzimuthAngleRel,this.maxAzimuthAngleRel)),this.euler.x=Ht.clamp(this.euler.x,-this.PI_2+(this.cameraPolarOffset<0?this.cameraPolarOffset:0),this.PI_2+(this.cameraPolarOffset>0?this.cameraPolarOffset:0))}return this.eulerDelta.set(0,0,0),this.object.dispatchEvent(Wft),this.path.length<2&&this.lastPosition.distanceToSquared(this.position)<this.threshEndTranslate&&Math.abs(this.rotVelocity.x)<this.threshEndRotVel&&Math.abs(this.rotVelocity.y)<this.threshEndRotVel&&(this.camera===void 0||this.isFirstPerson||this.lastCameraPosition.distanceToSquared(this.camera.position)<this.threshEndTranslate&&8*(1-this.lastCameraQuaternion.dot(this.camera.quaternion))<this.threshEndRotate)&&(this.moveMode==="fly"||this.onObject===!0||this.collisionEnabled===!1)&&(this.navMeshPathDest===null||this.navMeshPathDest.material.opacity<-.04*this.navMeshPathDest?.material?.userData.opacity0)?!1:(this.camera&&(this.lastCameraPosition.copy(this.camera.position),this.lastCameraQuaternion.copy(this.camera.quaternion)),this.lastPosition.copy(this.position),this.object.dispatchEvent(Gft),!0)}updateFollowArms(){this.objectToTarget.copy(this.objectToTarget0),this.targetToCamera.copy(this.targetToCamera0);let t=lh.setFromAxisAngle(ch,this.cameraYAxis==="Limit"&&this.orientMode!=="radial"?Ht.clamp(this.euler.y-this.euler0.y,this.minAzimuthAngleRel,this.maxAzimuthAngleRel):this.euler.y-this.euler0.y);(this.cameraYAxis!=="Locked"||this.orientMode==="radial")&&this.objectToTarget.applyQuaternion(t);let e;this.cameraXAxis==="Limit"?e=Ht.clamp(this.euler.x,-this.maxPolarAngle+this.cameraPolarOffset+1e-6,-this.minPolarAngle+this.cameraPolarOffset-1e-6):e=Ht.clamp(this.euler.x,-this.PI_2+this.cameraPolarOffset+1e-6,this.PI_2+this.cameraPolarOffset-1e-6);let i=ll.copy(this.cameraPolarAxis0);(this.cameraYAxis!=="Locked"||this.orientMode==="radial")&&i.applyQuaternion(t);let r=sp.setFromAxisAngle(i,e);this.cameraYAxis!=="Locked"&&this.targetToCamera.applyQuaternion(t),this.cameraXAxis!=="Locked"&&this.targetToCamera.applyQuaternion(r)}groundTiltAdjustment(t){ch.angleTo(t)*180/Math.PI<15||ch.angleTo(t)*180/Math.PI>85?lh.identity():lh.setFromUnitVectors(ch,t),this.groundTilt.slerp(lh,.06),this.groundTiltInv.copy(this.groundTilt).invert()}collisionAdjustment(t){let e=Lie.set(0,0,0);this.object.matrix.compose(this.position,this.quaternion,this.scale);let i=x4.multiplyMatrices(this.object.matrix,this.objXZRotMat).multiply(this.collider.matrix).decompose(ll,lh,zl).compose(ll,lh,Nie);this.sharedGameControlGlobals.entitiesWithTransformAnim.forEach(n=>{if(n===this.object||n.isDescendantOf(this.object))return;ru.makeEmpty(),n.updateMatrixWorldSVD();let s=n.matrixWorldRigid,a=kie.copy(s).invert(),o=Uft.copy(kie).multiply(i);ka.copy(this.collider.segment),ka.start.applyMatrix4(o),ka.end.applyMatrix4(o);let l=Oie.copy(this.position).applyMatrix4(a);ru.expandByPoint(ka.start),ru.expandByPoint(ka.end),ru.min.addScalar(-this.collider.radius),ru.max.addScalar(this.collider.radius),n.bvhGeometry.boundsTree.shapecast({traverseBoundsOrder(c){return c.distanceToPoint(ka.end)},intersectsBounds:c=>c.intersectsBox(ru),intersectsTriangle:c=>{let u=ll,h=zl,d=c.closestPointToSegment(ka,u,h);if(d<this.collider.radius){let f=this.collider.radius-d,p=h.sub(u).normalize(),g=ig.copy(l);g.addScaledVector(p,f);let m=g.applyMatrix4(s).sub(this.position);e.add(m),ka.start.addScaledVector(p,f),ka.end.addScaledVector(p,f)}}})}),ru.makeEmpty(),ka.copy(this.collider.segment),ka.start.applyMatrix4(i),ka.end.applyMatrix4(i),ru.expandByPoint(ka.start),ru.expandByPoint(ka.end),ru.min.addScalar(-this.collider.radius),ru.max.addScalar(this.collider.radius),this.sharedGameControlGlobals.staticMeshBVH?.shapecast({traverseBoundsOrder(n){return n.distanceToPoint(ka.end)},intersectsBounds:n=>n.intersectsBox(ru),intersectsTriangle:n=>{let s=ll,a=zl,o=n.closestPointToSegment(ka,s,a);if(o<this.collider.radius){let l=this.collider.radius-o,c=a.sub(s).normalize();this.alignToGround&&this.groundTiltAdjustment(c),e.addScaledVector(c,l),ka.start.addScaledVector(c,l),ka.end.addScaledVector(c,l)}}}),this.onObject=Math.abs(e.y)>Math.abs(t*this.velocity.y*.25),this.onObject&&this.dispatchStopEvent("jump");let r=Math.max(0,e.length()-1e-5);e.normalize().multiplyScalar(r),this.position.add(e)}pause(){this.firstPointerId=-1,this.movementState={moveNegZ:0,movePosZ:0,moveNegX:0,movePosX:0,moveNegY:0,movePosY:0,rotPosX:0,rotNegX:0,rotPosY:0,rotNegY:0,jump:0,run:0},this.deactivate()}resume(){this.activate()}},rge=bV;rge.isLocked=!1;var qft=gv(Yue());function nge(t){let e=t.elements,i=e[0]**2+e[1]**2+e[2]**2,r=e[4]**2+e[5]**2+e[6]**2,n=e[8]**2+e[9]**2+e[10]**2,s=e[0]**2+e[4]**2+e[8]**2,a=e[1]**2+e[5]**2+e[9]**2,o=e[2]**2+e[6]**2+e[10]**2,l=1e-8;return i<l||r<l||n<l||s<l||a<l||o<l}function vp(t,e){let i=new oi;if(e&&nge(e))return i.setAttribute("position",new Gt([],3)),i.setIndex([]),i;if(!t.getAttribute("position"))return i.setAttribute("position",new Gt([],3)),i.setIndex([]),i;let{positions:r,triIndices:n}=CL(t.getAttribute("position"),t.getIndex());return i.setAttribute("position",new Gt(r,3)),i.setIndex(n),e&&i.applyMatrix4(e),i}var Xft=new St,$ft=new St,dd=[[0,0,0],[0,0,0],[0,0,0]];function sge(t){let e=t.elements;dd[0][0]=e[0],dd[0][1]=e[4],dd[0][2]=e[8],dd[1][0]=e[1],dd[1][1]=e[5],dd[1][2]=e[9],dd[2][0]=e[2],dd[2][1]=e[6],dd[2][2]=e[10];let{u:i,v:r}=(0,qft.SVD)(dd),n=Xft.set(i[0][0],i[0][1],i[0][2],0,i[1][0],i[1][1],i[1][2],0,i[2][0],i[2][1],i[2][2],0,0,0,0,1),s=$ft.set(r[0][0],r[0][1],r[0][2],0,r[1][0],r[1][1],r[1][2],0,r[2][0],r[2][1],r[2][2],0,0,0,0,1);return n.multiply(s.transpose())}var Yft=class extends Vhe{constructor(){super(),this.layers.enable(3),this.layers.enable(8),this.layers.enable(9)}setFromCamera(t,e){e.isOrthographicCamera?(this.ray.origin.set(t.x,t.y,-1).unproject(e),this.ray.direction.set(0,0,-1).transformDirection(e.matrixWorld),this.camera=e):e.isPerspectiveCamera?(this.ray.origin.set(t.x,t.y,-1).unproject(e),this.ray.direction.set(t.x,t.y,.5).unproject(e).sub(this.ray.origin).normalize(),this.camera=e):console.error("Raycaster: Unsupported camera type.")}intersectVisibleObjects(t,e=!0,i=[]){return t.forEach(r=>{r.visible&&this.intersectObject(r,e,i)}),i}createRaycastLineHelper(){let t=new yv({color:65280,linewidth:10}),e=new W(this.ray.origin.x,this.ray.origin.y,this.ray.origin.z),i=new W(this.ray.direction.x,this.ray.direction.y,this.ray.direction.z),r=this.camera.far-this.camera.near,n=new W().addVectors(e,i.multiplyScalar(r)),s=new oi;return s.setFromPoints([e,n]),new GD(s,t)}},age=t=>t instanceof m1||t instanceof g1;function Kft(t,e){return t.distance-e.distance}function oge(t,e,i){if(!(!gp(e)||!e.visible)){Cd(e)&&e.raycast(t,i);for(let r of e.children)oge(t,r,i)}}function vI(t,e,i,r=!1){if(!r&&!i.some(s=>W3(t,s)!==void 0))return[];let n=[];return e.children.forEach(s=>oge(t,s,n)),n.sort(Kft),n}function wV(t){let e=[];if(t.length){let i=t[0].object;gp(i)&&e.push(i);let r=i.parent;for(;r;)age(r)&&e.push(r),r=r.parent}return e}function yp(t,e,i,r){let n=t.frame;if(n){let s=e[0]*n.width,a=(1-e[1])*n.height;for(let o of i){let l=o===n.uuid?n:n.find(o);if(l?.intersects(s,a))return r(l),!0}}return!1}function W3(t,e){if(Cd(e)){if(e.visible){let i=[];return e.raycast(t,i),i.length?i[0]:void 0}}else if(age(e))return lge(t,e)}function lge(t,e){if(!(!gp(e)||!e.visible)){if(Cd(e)){let i=[];if(e.raycast(t,i),i.length)return i[0]}for(let i of e.children){let r=lge(t,i);if(r)return r}}}function Zft(t,e,i){return{x:(t-(i.left+window.scrollX))/i.width*2-1,y:-((e-(i.top+window.scrollY))/i.height)*2+1}}function Qft(t,e,i){return{x:(t-(i.left+window.scrollX))/i.width,y:1-(e-(i.top+window.scrollY))/i.height}}var Jft=class{constructor(t,e,i,r,n,s,a,o){this.renderer=t,this.publish=e,this.scene=i,this.getCamera=r,this.sharedAssets=n,this.requestRender=s,this.isExport=a,this.frame=o,this.raycaster=new Yft,this._useWindowEvents=!1,this.pointerWorld={x:0,y:0},this.pointerScreen={x:0,y:0},this._useWindowEvents=e.mouseEventTarget==="window",this.domElement=t.domElement,this.eventElement=this._useWindowEvents?window:t.domElement,this._domRect=this.domElement.getBoundingClientRect()}get stopRaycast(){return this.publish.stopRaycast}get page(){return this.scene.activePage}set useWindowEvents(t){this._useWindowEvents=t,this.eventElement=t?window:this.renderer.domElement}get useWindowEvents(){return this._useWindowEvents}set domRect(t){this._domRect=t}get domRect(){return this._domRect}updateRaycaster(t){let{pageX:e,pageY:i}=t.touches?.length>0?t.touches[0]:t;this.pointerWorld=Zft(e,i,this._domRect),this.pointerScreen=Qft(e,i,this._domRect),this.raycaster.setFromCamera(this.pointerWorld,this.getCamera())}},Wo=class{constructor(t){this.eventContext=t,this.domEventsNeeded=new Set,this.hasVideoAction=!1}connect(){}disconnect(){}},P8=[["start","Start"],["keyDown","KeyDown"],["keyUp","KeyUp"],["mouseDown","MouseDown"],["mouseUp","MouseUp"],["mouseHover","MouseHover"],["collision","Collision"],["lookAt","LookAt"],["follow","Follow"],["scroll","Scroll"]],cge=t=>P8.find(([e,i])=>i===t)?.[0],XT=t=>P8.find(([e])=>e===t)?.[1],ept=(t,e)=>{let i=cge(t);if(i){let r=new CustomEvent(i,{bubbles:!0});return Object.defineProperty(r,"target",{writable:!1,value:e}),r}},tpt=class extends Wo{constructor(){super(...arguments),this.objectsPerEvents=new Map,this.splineEvents={},this.onBeginEvent=t=>{if(!t.eventName||!t.target||t.eventName==="Scroll")return;let e=this.splineEvents[cge(t.eventName)]?.[t.target.uuid];if(!e)return;t.eventName==="Scroll"&&t.deltaY!==void 0&&Object.assign(e,{deltaY:t.deltaY});let{domElement:i}=this.eventContext;i.dispatchEvent(e)}}connect(){let{page:t}=this.eventContext;t.traverseEntity(e=>{if(e.data?.events.length){for(let[i,r]of P8)if(e.data.events.some(n=>n.data.type===r&&!n.data.disabled)){this.objectsPerEvents.has(i)?this.objectsPerEvents.get(i)?.push(e):this.objectsPerEvents.set(i,[e]);let n={id:e.uuid,name:e.name},s=ept(r,n),a=this.splineEvents[i];a?a[e.uuid]=s:this.splineEvents[i]={[e.uuid]:s}}}}),this.objectsPerEvents.forEach(e=>{e.forEach(i=>{i.addEventListener("beginEvent",this.onBeginEvent)})})}disconnect(){this.objectsPerEvents.forEach(t=>{t.forEach(e=>{e.removeEventListener("beginEvent",this.onBeginEvent)})})}},ipt=class{constructor(t,e,i,r,n,s){if(this.id=t,this.data=e,this.object=i,this.entered=!1,(e.type==="KeyDown"||e.type==="KeyUp"||e.type==="KeyPress")&&!e.key)throw new Error("Missing property");this.actions=Xs(e,e.actions,r,n,s,i)}disconnect(){Xa(this.actions)}dispatchHeld(t){this.actions.Create.forEach(e=>{t&&e.dispatchThrottled.cancel(),e.dispatchThrottled()})}dispatch(t=!1){this.actions.Transition.forEach(e=>{e.object.currentTransitionEvent!==this&&(e.object.currentTransitionEvent=this,e.init())}),this.data.type==="MousePress"||this.data.type==="KeyPress"?this.entered||(this.entered=!0,this.actions.Transition.forEach(e=>e.playFromCurrent()),this.actions.Animation.forEach(e=>e.playFromCurrent()),this.actions.TimelineAnimation.forEach(e=>e.toggle(!0)),this.actions.SwitchCamera.forEach(e=>e.playFromCurrent()),this.actions.Create.forEach(e=>e.dispatchStart())):(this.actions.Transition.some(e=>e.playing&&e.data.runMode!=="Toggle")||this.actions.Transition.forEach(e=>{e.data.runMode==="Toggle"?e.toggle():e.play()}),this.actions.SwitchCamera.some(e=>e.playing&&e.data.runMode!=="Toggle")||this.actions.SwitchCamera.forEach(e=>{e.data.runMode==="Toggle"?e.toggle():e.play()}),this.actions.Animation.forEach(e=>{e.data.runMode==="Toggle"?e.toggle():e.play()}),this.actions.TimelineAnimation.forEach(e=>{e.play()})),this.actions.Link.forEach(e=>{e.dispatch()}),this.actions.SceneTransition.forEach(e=>{e.dispatch()}),t===!1&&this.actions.Create.forEach(e=>{e.dispatch()}),this.actions.Destroy.forEach(e=>{e.dispatch()}),this.actions.Reset.forEach(e=>{e.dispatch()}),this.actions.Audio.forEach(e=>{e.dispatchBasic()}),this.actions.Video.forEach(e=>{e.dispatchBasic()}),this.actions.Particles.forEach(e=>{e.dispatchBasic()}),this.actions.SetVariable.forEach(e=>e.checkConditions()),this.actions.SetVariable.forEach(e=>e.dispatch()),this.actions.DynamicVariablePlay.forEach(e=>e.dispatch()),this.actions.ClearLocalStorage.forEach(e=>e.dispatch()),this.actions.UserAPI.forEach(e=>e.dispatch())}dispatchRelease(){this.entered&&(this.entered=!1,this.actions.Transition.forEach(t=>t.reverseFromCurrent()),this.actions.Particles.forEach(t=>t.reverseFromCurrent()),this.actions.Animation.forEach(t=>t.reverseFromCurrent()),this.actions.SwitchCamera.forEach(t=>t.reverseFromCurrent()),this.actions.Create.forEach(t=>t.dispatchStop()))}dispatchUserEvent(t){this.actions.Transition.forEach(e=>{e.object.currentTransitionEvent!==this&&(e.object.currentTransitionEvent=this,e.init())}),t?(this.actions.Transition.forEach(e=>e.reverseFromCurrent()),this.actions.Animation.forEach(e=>e.reverseFromCurrent()),this.actions.TimelineAnimation.forEach(e=>e.reverseFromCurrent()),this.actions.SwitchCamera.forEach(e=>e.reverseFromCurrent())):(this.actions.Transition.forEach(e=>e.playFromCurrent()),this.actions.Animation.forEach(e=>e.playFromCurrent()),this.actions.TimelineAnimation.forEach(e=>e.playFromCurrent()),this.actions.SwitchCamera.forEach(e=>e.playFromCurrent())),this.actions.Link.forEach(e=>{e.dispatch()}),this.actions.SceneTransition.forEach(e=>{e.dispatch()}),this.actions.Create.forEach(e=>{e.dispatch()}),this.actions.Destroy.forEach(e=>{e.dispatch()}),this.actions.Reset.forEach(e=>{e.dispatch()}),this.actions.Audio.forEach(e=>{e.dispatchBasic()}),this.actions.Video.forEach(e=>{e.dispatchBasic()}),this.actions.Particles.forEach(e=>{e.dispatchBasic()}),this.actions.SetVariable.forEach(e=>e.checkConditions()),this.actions.SetVariable.forEach(e=>e.dispatch()),this.actions.DynamicVariablePlay.forEach(e=>e.dispatch()),this.actions.ClearLocalStorage.forEach(e=>e.dispatch()),this.actions.UserAPI.forEach(e=>e.dispatch())}},rpt=class extends Wo{constructor(t,e,i){super(t),this.eventManager=e,this.useForRaycastProperty=i,this.objectsPerTypes={MouseDown:[],MouseUp:[],MousePress:[],KeyDown:[],KeyUp:[],KeyPress:[]},this.canvasMouseEvents=[],this.eventsPerObjects={MouseDown:{},MouseUp:{},MousePress:{},KeyDown:{},KeyUp:{},KeyPress:{}},this.heldKeys={},this.heldKeysPress={},this._prevObjects=[],this.sceneInterects=null,this.onCanvasRaycast=r=>{if(this.useForRaycastProperty===!0&&this.sceneInterects===null){this.eventContext.updateRaycaster(r);let{raycaster:n,page:s}=this.eventContext,a=vI(n,s,[],!0);this.sceneInterects=a,a.length&&(this.eventContext.sharedAssets.raycastProperty={x:a[0].point.x,y:a[0].point.y,z:a[0].point.z,objX:a[0].object.matrixWorld.elements[12],objY:a[0].object.matrixWorld.elements[13],objZ:a[0].object.matrixWorld.elements[14]})}},this.onCanvasMouseDown=r=>{(r.target===this.eventContext.domElement||r.target.tagName==="SPLINE-VIEWER")&&this.canvasMouseEvents.forEach(n=>{(n.data.type==="MouseDown"||n.data.type==="MousePress")&&(this.onCanvasRaycast(r),n.dispatch())})},this.onCanvasMouseUp=r=>{(r.target===this.eventContext.domElement||r.target.tagName==="SPLINE-VIEWER")&&this.canvasMouseEvents.forEach(n=>{n.data.type==="MouseUp"?(this.onCanvasRaycast(r),n.dispatch()):n.data.type==="MousePress"&&n.dispatchRelease()})},this.onMouseDown=r=>{Di.length>1||(this.eventContext.updateRaycaster(r),this.handleMouseEvent("MouseDown"))},this.onMouseUp=r=>{Di.length>1||(this.eventContext.updateRaycaster(r),this.handleMouseEvent("MouseUp"))},this.onMousePressDown=r=>{Di.length>1||(this.eventContext.updateRaycaster(r),this.handleMousePressEvent())},this.onMousePressRelease=r=>{Di.length>1||(this.eventContext.updateRaycaster(r),this.handleMousePressEvent(!0))},this.onKeyDown=r=>{this.heldKeys[r.key]||(this.handleKeyEvent(r,"KeyDown"),this.handleKeyEventHeld(r,"KeyDown",!0)),this.heldKeys[r.key]=!0},this.onKeyUp=r=>{this.handleKeyEvent(r,"KeyUp"),this.handleKeyEventHeld(r,"KeyUp",!0)},this.onKeyPressDown=r=>{this.heldKeysPress[r.key]?this.handleKeyEventHeld(r,"KeyPress"):(this.handleKeyEvent(r,"KeyPress"),this.handleKeyEventHeld(r,"KeyPress",!0)),this.heldKeysPress[r.key]=!0},this.onKeyPressUp=r=>{this.handleKeyEvent(r,"KeyPress",!0)},this.releaseHeldKey=r=>{delete this.heldKeys[r.key]},this.releaseHeldKeyPress=r=>{delete this.heldKeysPress[r.key]},this._onUserEvent=({eventName:r,target:n,reverse:s})=>{if(!r||!n)return;let a=XT(r);a&&(a==="MouseDown"||a==="MouseUp"||a==="MousePress"?(n.dispatchEvent({type:"beginEvent",eventName:a}),this.eventsPerObjects[a]?.[n.uuid]?.forEach(o=>{o.dispatchUserEvent(s)})):(a==="KeyDown"||a==="KeyUp"||a==="KeyPress")&&(n.dispatchEvent({type:"beginEvent",eventName:a}),this.eventsPerObjects[a]?.[n.uuid]?.forEach(o=>{o.dispatchUserEvent()})))}}connect(){let{page:t,sharedAssets:e,domElement:i}=this.eventContext,r=(n,s)=>{if(!n.data?.events.length)return;let a=["MouseDown","MouseUp","MousePress","KeyDown","KeyUp","KeyPress"];for(let o of a){let l=this.eventsPerObjects[o];if(n.data.events.filter(({data:c})=>c.type===o&&c.disabled!==!0).forEach(({id:c,data:u})=>{try{let h=new ipt(c,u,n,t,e,this.eventManager);h.actions.Video.length&&(this.hasVideoAction=!0),(u.type==="MouseDown"||u.type==="MouseUp"||u.type==="MousePress")&&(u.mode==="Canvas"||u.mode==="Window")?this.canvasMouseEvents.push(h):(l[n.uuid]?l[n.uuid].some(d=>d.id===h.id)||l[n.uuid].push(h):l[n.uuid]=[h],n instanceof V0&&n.traverseChildren(d=>{if(!d.visible)return!0;d instanceof bs&&"shapeBlendNode"in d.data.geometry&&d.data.geometry.shapeBlendNode?.operation!==2&&(l[d.uuid]?l[d.uuid].push(h):l[d.uuid]=[h])}))}catch{}}),l[n.uuid]?.length&&(this.objectsPerTypes[o].push(n instanceof Ka&&(o==="MouseDown"||o==="MouseUp"||o==="MousePress")?s:n),n instanceof V0)){let c=this.objectsPerTypes[o];n.traverseChildren(u=>{if(!u.visible)return!0;u instanceof bs&&c.indexOf(u)===-1&&c.push(u)})}}};t.traverseEntity(n=>{(n instanceof Fo||n instanceof Fa)&&n.frame?.traverse(s=>{r(s,n)}),r(n)}),this.heldKeys={},this.heldKeysPress={},this.domEventsNeeded.clear(),i.addEventListener("pointerdown",this.onCanvasMouseDown),i.addEventListener("pointerup",this.onCanvasMouseUp),(this.objectsPerTypes.MouseDown?.length||this.useForRaycastProperty)&&(this.domEventsNeeded.add("pointerdown"),i.addEventListener("pointerdown",this.onMouseDown)),this.objectsPerTypes.MouseUp?.length&&(this.domEventsNeeded.add("pointerup"),i.addEventListener("pointerup",this.onMouseUp)),this.objectsPerTypes.MousePress?.length&&(this.domEventsNeeded.add("pointerdown"),i.addEventListener("pointerdown",this.onMousePressDown),this.domEventsNeeded.add("pointerup"),i.addEventListener("pointerup",this.onMousePressRelease)),this.objectsPerTypes.KeyDown?.length&&(this.domEventsNeeded.add("keydown"),document.addEventListener("keydown",this.onKeyDown),document.addEventListener("keyup",this.releaseHeldKey)),this.objectsPerTypes.KeyUp?.length&&(this.domEventsNeeded.add("keyup"),document.addEventListener("keyup",this.onKeyUp)),this.objectsPerTypes.KeyPress?.length&&(this.domEventsNeeded.add("keydown"),document.addEventListener("keydown",this.onKeyPressDown),document.addEventListener("keyup",this.releaseHeldKeyPress),this.domEventsNeeded.add("keyup"),document.addEventListener("keyup",this.onKeyPressUp)),Object.entries(this.objectsPerTypes).forEach(([n,s])=>{s.forEach(a=>{a.addEventListener("userEvent",this._onUserEvent)})})}disconnect(){let{domElement:t}=this.eventContext;this.domEventsNeeded.clear(),this.heldKeys={},this.heldKeysPress={},t.removeEventListener("pointerdown",this.onCanvasMouseDown),t.removeEventListener("pointerup",this.onCanvasMouseUp),t.removeEventListener("pointerdown",this.onMouseDown),t.removeEventListener("pointerdown",this.onMousePressDown),t.removeEventListener("pointerup",this.onMouseUp),t.removeEventListener("pointerup",this.onMousePressRelease),document.removeEventListener("keydown",this.onKeyDown),document.removeEventListener("keyup",this.onKeyUp),document.removeEventListener("keydown",this.onKeyPressDown),document.removeEventListener("keyup",this.onKeyPressUp),document.removeEventListener("keyup",this.releaseHeldKey),Object.values(this.eventsPerObjects).forEach(e=>{Object.values(e).forEach(i=>{i.forEach(r=>{r.disconnect()})})}),this.canvasMouseEvents.forEach(e=>{e.disconnect()}),Object.entries(this.objectsPerTypes).forEach(([e,i])=>{i.forEach(r=>{r.removeEventListener("userEvent",this._onUserEvent)})})}handleMouseEvent(t){let{stopRaycast:e,raycaster:i,page:r,pointerScreen:n}=this.eventContext,s=this.objectsPerTypes[t],a=s.filter(o=>!(o instanceof Ka));if(!(!s.length&&!this.useForRaycastProperty)&&!(r.uiCanvas&&yp(r,[n.x,n.y],Object.keys(this.eventsPerObjects[t]),o=>{this.handleObjectMouseEventDispatch(o,t)}))){if(e||this.useForRaycastProperty){let o;if(this.sceneInterects===null?o=vI(i,r,a,this.useForRaycastProperty):(o=this.sceneInterects,this.sceneInterects=null),this.useForRaycastProperty&&o.length&&(this.eventContext.sharedAssets.raycastProperty={x:o[0].point.x,y:o[0].point.y,z:o[0].point.z,objX:o[0].object.matrixWorld.elements[12],objY:o[0].object.matrixWorld.elements[13],objZ:o[0].object.matrixWorld.elements[14]}),e){let l=[o[0]?.uv?.x??0,o[0]?.uv?.y??0];wV(o).forEach(c=>{c instanceof Fo&&yp(c,l,Object.keys(this.eventsPerObjects[t]),u=>{this.handleObjectMouseEventDispatch(u,t)}),this.eventsPerObjects[t][c.uuid]&&this.handleObjectMouseEventDispatch(c,t)})}}e||a.forEach(o=>{let l=W3(i,o);l&&(this.handleObjectMouseEventDispatch(o,t),o instanceof Fo&&yp(o,[l?.uv?.x??0,l?.uv?.y??0],Object.keys(this.eventsPerObjects[t]),c=>{this.handleObjectMouseEventDispatch(c,t)}))})}}handleMousePressEvent(t=!1){let e="MousePress",i=this.objectsPerTypes[e],r=i.filter(s=>!(s instanceof Ka)),n=[];if(i.length){if(!t){let{stopRaycast:s,raycaster:a,page:o,pointerScreen:l}=this.eventContext,c=!1;if(o.uiCanvas&&(c=yp(o,[l.x,l.y],Object.keys(this.eventsPerObjects[e]),u=>{n.push(u)})),s&&!c){let u=vI(a,o,r);n=wV(u),u.forEach(h=>{h.object instanceof Fo&&yp(h.object,[h?.uv?.x??0,h?.uv?.y??0],Object.keys(this.eventsPerObjects[e]),d=>{n.push(d)})})}else r.forEach(u=>{let h=W3(a,u);h&&(n.push(u),u instanceof Fo&&yp(u,[h?.uv?.x??0,h?.uv?.y??0],Object.keys(this.eventsPerObjects[e]),d=>{n.push(d)}))})}this._prevObjects.length&&this._prevObjects.forEach(s=>{n.includes(s)||this.handleObjectMouseEventDispatchRelease(s,e)}),n.length&&n.forEach(s=>{this.handleObjectMouseEventDispatch(s,e)}),this._prevObjects=n}}handleObjectMouseEventDispatch(t,e){t.dispatchEvent({type:"beginEvent",eventName:e}),this.eventsPerObjects[e]?.[t.uuid]?.forEach(i=>{i.dispatch()})}handleObjectMouseEventDispatchRelease(t,e){t.dispatchEvent({type:"beginEvent",eventName:e}),this.eventsPerObjects[e]?.[t.uuid]?.forEach(i=>{i.dispatchRelease()})}handleKeyEvent(t,e,i=!1){this.objectsPerTypes[e].forEach(r=>{let n=this.eventsPerObjects[e][r.uuid];n.some(({data:s})=>"key"in s&&s.key===t.key)&&r.dispatchEvent({type:"beginEvent",eventName:e}),n.forEach(s=>{"key"in s.data&&s.data.key===t.key&&(i?s.dispatchRelease():s.dispatch(!0))})})}handleKeyEventHeld(t,e,i=!1){this.objectsPerTypes[e].forEach(r=>{this.eventsPerObjects[e][r.uuid].forEach(n=>{"key"in n.data&&n.data.key===t.key&&n.dispatchHeld(i)})})}},npt=new W,spt=new W,uge=class{constructor(t,e,i,r,n){this.actionsIn=Xs(t,t.inActions,i,r,n,e),this.actionsOut=Xs(t,t.outActions,i,r,n,e)}disconnect(){Xa(this.actionsIn),Xa(this.actionsOut)}},apt=class extends uge{constructor(t,e,i,r,n,s){super(e,i,r,n,s),this.id=t,this.data=e,this.object=i,this.stage="out",this.objects=[],this.onUpdateMatrixWorld=()=>{for(let d of this.objects)if(!d.visible)return;let c=npt.setFromMatrixPosition(this.objects[0].matrixWorld),u=spt.setFromMatrixPosition(this.objects[1].matrixWorld),h=c.distanceTo(u)<=this.distance?"in":"out";if(this.stage!==h){this.stage=h;let d=h==="in"?this.actionsIn:this.actionsOut;d.Audio.forEach(f=>f.dispatchConditional()),d.Particles.forEach(f=>f.dispatchConditional()),d.Video.forEach(f=>f.dispatchConditional()),d.Link.forEach(f=>f.dispatch()),d.Create.forEach(f=>f.dispatch()),d.Destroy.forEach(f=>f.dispatch()),d.Reset.forEach(f=>f.dispatch()),d.Transition.forEach(f=>{f.object.currentTransitionEvent!==this&&(f.object.currentTransitionEvent=this),f.init()}),d.Transition.forEach(f=>f.play()),d.Animation.forEach(f=>f.play()),d.TimelineAnimation.forEach(f=>f.play()),d.SwitchCamera.forEach(f=>f.play()),d.SceneTransition.forEach(f=>f.dispatch()),d.SetVariable.forEach(f=>f.checkConditions()),d.SetVariable.forEach(f=>f.dispatch()),d.DynamicVariablePlay.forEach(f=>f.dispatch()),d.ClearLocalStorage.forEach(f=>f.dispatch()),d.UserAPI.forEach(f=>f.dispatch())}};let{distance:a,fromObject:o,toObject:l}=e.condition;this.distance=a;for(let c of[o,l]){if(!c)throw new Error("Missing property");let u=r.find(c);if(!u)throw new Error("Missing property");this.objects.push(u)}}connect(){window.setTimeout(()=>{this.objects.forEach(t=>{t.addEventListener("updateMatrixWorld",this.onUpdateMatrixWorld)}),this.onUpdateMatrixWorld()},0)}disconnect(){super.disconnect(),this.stage="out",this.objects.forEach(t=>{t.removeEventListener("updateMatrixWorld",this.onUpdateMatrixWorld)})}},opt=class extends uge{constructor(t,e,i,r,n,s){super(e,i,r,n,s),this.id=t,this.data=e,this.object=i,this.onBegin=({target:l,state:c})=>{this.toState!==c&&(this.actionsOut.Audio.forEach(u=>u.dispatchConditional()),this.actionsOut.Particles.forEach(u=>u.dispatchConditional()),this.actionsOut.Video.forEach(u=>u.dispatchConditional()),this.actionsOut.Link.forEach(u=>u.dispatch()),this.actionsOut.Create.forEach(u=>u.dispatch()),this.actionsOut.Destroy.forEach(u=>u.dispatch()),this.actionsOut.Reset.forEach(u=>u.dispatch()),this.actionsIn.Transition.forEach(u=>u.pause()),this.object.currentTransitionEvent=this,this.actionsOut.Transition.forEach(u=>u.play()),this.actionsOut.Animation.forEach(u=>u.play()),this.actionsOut.TimelineAnimation.forEach(u=>u.play()),this.actionsIn.SwitchCamera.forEach(u=>u.pause()),this.actionsOut.SwitchCamera.forEach(u=>u.play()),this.actionsOut.SceneTransition.forEach(u=>u.dispatch()),this.actionsOut.SetVariable.forEach(u=>u.checkConditions()),this.actionsOut.SetVariable.forEach(u=>u.dispatch()),this.actionsOut.DynamicVariablePlay.forEach(u=>u.dispatch()),this.actionsOut.ClearLocalStorage.forEach(u=>u.dispatch()),this.actionsOut.UserAPI.forEach(u=>u.dispatch()))},this.onComplete=({target:l,state:c})=>{this.toState===c&&(this.actionsIn.Audio.forEach(u=>u.dispatchConditional()),this.actionsIn.Particles.forEach(u=>u.dispatchConditional()),this.actionsIn.Video.forEach(u=>u.dispatchConditional()),this.actionsIn.Link.forEach(u=>u.dispatch()),this.actionsIn.Create.forEach(u=>u.dispatch()),this.actionsIn.Destroy.forEach(u=>u.dispatch()),this.actionsIn.Reset.forEach(u=>u.dispatch()),this.actionsOut.Transition.forEach(u=>u.pause()),this.actionsOut.Transition.forEach(u=>u.pause()),this.object.currentTransitionEvent=this,this.actionsIn.Transition.forEach(u=>u.play()),this.actionsIn.Animation.forEach(u=>u.play()),this.actionsIn.TimelineAnimation.forEach(u=>u.play()),this.actionsOut.SwitchCamera.forEach(u=>u.pause()),this.actionsIn.SwitchCamera.forEach(u=>u.play()),this.actionsIn.SceneTransition.forEach(u=>u.dispatch()),this.actionsIn.SetVariable.forEach(u=>u.checkConditions()),this.actionsIn.SetVariable.forEach(u=>u.dispatch()),this.actionsIn.DynamicVariablePlay.forEach(u=>u.dispatch()),this.actionsOut.ClearLocalStorage.forEach(u=>u.dispatch()),this.actionsOut.UserAPI.forEach(u=>u.dispatch()))};let{condition:a}=e;if(!a.object)throw new Error("Missing property");let o=r.find(a.object)??r.scene.find2D(a.object);if(!o)throw new Error("Missing property");if(this.toObject=o,a.state&&!this.toObject.states?.[a.state])throw new Error("Missing property");this.toState=a.state}connect(){e0(this.actionsOut).forEach(t=>{this.actionsOut[t]?.length&&this.toObject.addEventListener("beginState",this.onBegin)}),e0(this.actionsIn).forEach(t=>{this.actionsIn[t]?.length&&this.toObject.addEventListener("completeState",this.onComplete)})}disconnect(){super.disconnect(),e0(this.actionsOut).forEach(t=>{this.actionsIn[t]?.length&&this.toObject.removeEventListener("beginState",this.onBegin)}),e0(this.actionsIn).forEach(t=>{this.actionsIn[t]?.length&&this.toObject.removeEventListener("completeState",this.onComplete)})}},lpt=class extends Wo{constructor(t,e){super(t),this.eventManager=e,this.eventsPerConditions={Comparison:[],Distance:[],State:[]},this.hasVideoAction=!1}connect(){super.connect();let{page:t,sharedAssets:e}=this.eventContext;t.traverseEntity(i=>{if(i.data?.events.length){for(let{id:r,data:n}of i.data.events)if(!n.disabled&&n.type==="Conditional")try{let s;n.condition.type==="Comparison"||(n.condition.type==="Distance"?s=new apt(r,n,i,t,e,this.eventManager):n.condition.type==="State"&&(s=new opt(r,n,i,t,e,this.eventManager))),s&&(this.eventsPerConditions[n.condition.type].push(s),(s.actionsIn.Video.length||s.actionsOut.Video.length)&&(this.hasVideoAction=!0))}catch{}}}),Object.values(this.eventsPerConditions).forEach(i=>i.forEach(r=>r.connect()))}disconnect(){super.disconnect(),Object.values(this.eventsPerConditions).forEach(t=>t.forEach(e=>e.disconnect()))}},CE=new W,rg=new W,Py=new W,Fie=new $l,cpt=.01,Wr=new W,aa=new W,zie=new W,a0=new Ii,b4=new xs,upt=new St,w4=new Vs,pw=new W,fd=new W,mw=.2;function _4(t,e){!e||(e[0]<e[1]&&(t.x=Math.min(Math.max(t.x,e[0]),e[1])),e[2]<e[3]&&(t.y=Math.min(Math.max(t.y,e[2]),e[3])),e[4]<e[5]&&(t.z=Math.min(Math.max(t.z,e[4]),e[5])))}var hpt=(function(){let t=new St;return(e,i,r)=>{let n=e.obj;t.copy(n.hiddenMatrix),n.parent!==null&&t.premultiply(n.parent.matrixWorld),t.invert(),n.position.copy(i),e.reference==="global"&&_4(n.position,e.limits),n.position.applyMatrix4(t),e.reference==="parent"?_4(n.position,e.limits):e.reference==="local"&&(a0.copy(e.quat0).invert(),n.position.sub(e.position0),n.position.applyQuaternion(a0),_4(n.position,e.limits),a0.invert(),n.position.applyQuaternion(a0),n.position.add(e.position0)),t.multiply(r??n.matrixWorld).decompose(Wr,n.quaternion,aa),n.updateMatrix(),n.hasNonUniformScale&&(n.updateMatrixWorld(),n.updateMatrixWorldSVD()),n instanceof So&&Pp(n.parent)&&n.invalidateDownstreamBooleanData(!0)}})(),dpt=class{constructor(t,e,i,r,n,s,a){this.object=t,this.id=e,this.data=i,this.dropDestIds=[],this.activeIdx=null,this.wasDragEventTriggered=!1,this.resetDampingFactor=this.data.resetSpeed===0?1:8/this.data.resetSpeed+1,this.snapDampingFactor=this.data.snapSpeed===0?1:8/this.data.snapSpeed+1,this.actionsDrag=Xs(i,i.dragDropActions.drag,r,n,s,this.object),this.actionsDrop=Xs(i,i.dragDropActions.drop,r,n,s,this.object);let o=[];this.data.objects.forEach(l=>{let c=r.find(l);!c||c.data.visible!==!1&&(o.push(c),a[c.uuid]&&a[c.uuid].forEach(u=>{let h=r.find(u);!h||h.data.visible!==!1&&o.push(h)}))}),this.data.dropDestinations.forEach(l=>{let c=r.find(l);!c||c.data.visible!==!1&&(this.dropDestIds.push(c.uuid),a[c.uuid]&&a[c.uuid].forEach(u=>{let h=r.find(u);!h||h.data.visible!==!1&&this.dropDestIds.push(h.uuid)}))}),this.dragItems=o.map(l=>(this.data.planeMode==="locked"&&(l.userData.lockedPlane=!0),l.userData.worldPosition0=new W().setFromMatrixPosition(l.matrixWorld),{obj:l,fromPosition:new W().setFromMatrixPosition(l.matrixWorld),pointStart:new W,pointEnd:new W,paused:!0,currentDampingFactor:this.data.dampingFactor,reset:!1,position0:new W().copy(l.position),quat0:new Ii().copy(l.quaternion),snapped:!1,orientationMatrix:new St,limits:this.data.limits,reference:this.data.referenceFrame}))}get activeDragItem(){return this.activeIdx!==null?this.dragItems[this.activeIdx]:null}dispose(){Xa(this.actionsDrag),Xa(this.actionsDrop),this.dragItems.forEach(t=>{t.fromPosition.copy(t.obj.userData.worldPosition0),t.pointStart.copy(t.fromPosition),t.pointEnd.copy(t.pointStart),t.obj.recursiveBBoxNeedsUpdate=!0,t.obj.userData.lockedPlane=void 0,t.obj.position.copy(t.position0),t.obj.quaternion.copy(t.quat0),t.obj.updateMatrix()})}},fpt=class extends Wo{constructor(t,e){super(t),this.eventManager=e,this.events=[],this.lastDropDestination=null,this.dragTimeout=null,this.onPointerDown=i=>{if(Di.length>1)return;this.eventContext.updateRaycaster(i);let{raycaster:r,page:n}=this.eventContext,s=n.raycastWithClones(r);if(this.lastDropDestination=null,s.length===0){this.activeEvent=null;return}for(let a of this.events){let o=0;for(let{obj:l,pointEnd:c,pointStart:u}of a.dragItems){if(l===s[0].object||l===s[0].object.object||Er.is(l)&&l.isAncestorOf(s[0].object.uuid)){if(a.activeIdx=o,a.activeDragItem.reset=!1,a.activeDragItem.currentDampingFactor=a.data.dampingFactor,a.activeDragItem.snapped=!1,a.data.cursor==="hand"&&this.setCursor("grabbing"),this.eventManager.controlsManager.usePhysics){a.activeDragItem.obj.rigidBody&&a.activeDragItem.obj.rigidBody.setBodyType(2,!0);let h=a.activeDragItem.obj;l.hasNonUniformScale&&l.updateMatrixWorldSVD(),(h.hasNonUniformScale?h.matrixWorldRigid:h.matrixWorld).decompose(Wr,a0,aa),b4.setFromQuaternion(a0),h.prevR===void 0?(h.prevR=b4.clone(),h.prevT=Wr.clone()):(h.prevR.copy(b4),h.prevT.copy(Wr)),this.eventManager.controlsManager.sharedGameControlGlobals.entitiesWithTransformAnim.push(a.activeDragItem.obj)}this.calcPlaneIntersectPos(l,u,a.data.plane,a.data.referenceFrame),c.copy(u),(this.eventManager.controlsManager.usePhysics&&l.data.physics?.rigidBody==="dynamic"||a.data.drop===!1||a.data.resetOnSnapFail===!1)&&a.activeDragItem.fromPosition.setFromMatrixPosition(a.activeDragItem.obj.matrixWorld),this.activeEvent=a,this.eventManager.controlsManager.orbitControls&&(this.eventManager.controlsManager.orbitControls.enabled=!1);return}o++}}this.activeEvent=null},this.onPointerMove=i=>{if(Di.length>1)return;this.eventContext.updateRaycaster(i);let{raycaster:r,page:n}=this.eventContext,s=n.raycastWithClones(r);if(Di.length===0){let a=!1;for(let o of this.events){for(let{obj:l}of o.dragItems)if(l===s[0]?.object||l===s[0]?.object?.object||Er.is(l)&&l.isAncestorOf(s[0]?.object.uuid)){switch(a=!0,o.data.cursor){case"hand":this.setCursor("grab");break;case"move":this.setCursor("move");break}break}if(a)break}a||this.setCursor("default");return}if(this.activeEvent&&this.activeEvent.activeDragItem){let a=this.activeEvent.activeDragItem;a.snapped=!1;let o;if(this.activeEvent.data.drop&&(o=s.filter(l=>a.obj!==l.object&&!a.obj.isAncestorOf(l.object.uuid)&&!(l.object instanceof m1)&&(this.activeEvent.data.dropOn==="all"||this.activeEvent.dropDestIds.some(c=>c===l.object.uuid||n.scene.find(c).isAncestorOf(l.object.uuid))))[0]),o){let l=zie.copy(o.face.normal).applyMatrix3(w4.getNormalMatrix(o.object.matrixWorld));if(this.activeEvent.data.snapTo==="center")a.fromPosition.setFromMatrixPosition(o.object.matrixWorld);else if(this.activeEvent.data.snapTo==="surface"){if(a.fromPosition.copy(o.point),this.activeEvent.data.snapSurfaceMode==="bbox"){Wr.copy(l).applyMatrix3(w4.setFromMatrix4(a.obj.matrixWorld).transpose());let c=a.obj;Wr.x>mw?aa.x=-c.recursiveBBox.min.x:Wr.x<-mw&&(aa.x=-c.recursiveBBox.max.x),Wr.y>mw?aa.y=-c.recursiveBBox.min.y:Wr.y<-mw&&(aa.y=-c.recursiveBBox.max.y),Wr.z>mw?aa.z=-c.recursiveBBox.min.z:Wr.z<-mw&&(aa.z=-c.recursiveBBox.max.z),aa.applyMatrix3(w4.invert())}else aa.copy(l).multiplyScalar(this.activeEvent.data.snapSurfaceOffset);a.fromPosition.add(aa)}this.activeEvent.data.autoOrient&&(Wr.set(0,1,0).cross(l),Wr.length()<1e-4&&Wr.set(-1,0,0).cross(l),aa.crossVectors(zie,Wr),a.orientationMatrix.makeBasis(Wr,aa,l)),a.pointStart.copy(a.fromPosition),a.pointEnd.copy(a.pointStart),a.currentDampingFactor=this.activeEvent.snapDampingFactor,a.snapped=!0,this.lastDropDestination!==o.object&&(this.lastDropDestination=o.object,this.activeEvent.actionsDrop.Transition.forEach(c=>{c.play()}),this.activeEvent.actionsDrop.Animation.forEach(c=>{c.play()}),this.activeEvent.actionsDrop.Audio.forEach(c=>{c.dispatchGameControl("start")}),this.activeEvent.actionsDrop.Particles.forEach(c=>{c.dispatchGameControl("start")}),this.activeEvent.actionsDrop.Create.forEach(c=>{c.dispatchThrottled()}))}else a.orientationMatrix.makeRotationFromQuaternion(a.quat0),this.lastDropDestination=null,a.currentDampingFactor=this.activeEvent.data.dampingFactor,this.calcPlaneIntersectPos(a.obj,a.pointEnd,this.activeEvent.data.plane,this.activeEvent.data.referenceFrame),this.activeEvent.actionsDrop.Transition.forEach(l=>{l.stop(),l.object.currentState!==null&&l.object.changeSelectedState(null,{scene:this.eventContext.page.scene,shared:this.eventContext.sharedAssets})}),this.activeEvent.actionsDrop.Animation.forEach(l=>{l.stop()}),this.activeEvent.actionsDrop.Audio.forEach(l=>{l.dispatchGameControl("stop")}),this.activeEvent.actionsDrop.Particles.forEach(l=>{l.dispatchGameControl("stop")});this.activeEvent.actionsDrag.Create.forEach(l=>{l.dispatchThrottled()}),this.activeEvent.actionsDrag.SetVariable.forEach(l=>l.checkConditions()),this.activeEvent.actionsDrag.SetVariable.forEach(l=>l.dispatch()),this.activeEvent.actionsDrag.DynamicVariablePlay.forEach(l=>l.dispatch()),this.activeEvent.actionsDrag.ClearLocalStorage.forEach(l=>l.dispatch()),this.activeEvent.actionsDrag.UserAPI.forEach(l=>l.dispatch()),this.activeEvent.wasDragEventTriggered===!1&&(this.activeEvent.wasDragEventTriggered=!0,this.activeEvent.actionsDrag.Transition.forEach(l=>{l.play()}),this.activeEvent.actionsDrag.Animation.forEach(l=>{l.play()}),this.activeEvent.actionsDrag.Audio.forEach(l=>{l.dispatchGameControl("start")}),this.activeEvent.actionsDrag.Particles.forEach(l=>{l.dispatchGameControl("start")})),this.dragTimeout&&window.clearTimeout(this.dragTimeout),this.dragTimeout=window.setTimeout(()=>{!this.activeEvent||(this.activeEvent.wasDragEventTriggered=!1,this.activeEvent.actionsDrag.Audio.forEach(l=>{l.dispatchGameControl("stop")}),this.activeEvent.actionsDrag.Particles.forEach(l=>{l.dispatchGameControl("stop")}),this.activeEvent.actionsDrag.Transition.forEach(l=>{l.stop(),l.object.currentState!==null&&l.object.changeSelectedState(null,{scene:this.eventContext.page.scene,shared:this.eventContext.sharedAssets})}),this.activeEvent.actionsDrag.Animation.forEach(l=>{l.stop()}))},500),this.updateDragItem(a),a.obj.dispatchEvent({type:"requestRender"})}},this.onPointerUp=i=>{if(this.activeEvent&&this.activeEvent.activeDragItem){this.activeEvent.data.cursor==="hand"&&this.setCursor("grab");let r=this.activeEvent.activeDragItem.obj.data.physics?.rigidBody==="dynamic";this.activeEvent.activeDragItem.snapped===!1&&this.activeEvent.data.drop&&this.activeEvent.data.resetOnSnapFail&&(this.eventManager.controlsManager.usePhysics===!1||!r)&&(this.activeEvent.activeDragItem.reset=this.activeEvent.data.resetOnSnapFail,this.activeEvent.activeDragItem.paused=!1,this.activeEvent.activeDragItem.currentDampingFactor=this.activeEvent.resetDampingFactor),this.eventManager.controlsManager.usePhysics&&r&&(this.eventManager.controlsManager.sharedGameControlGlobals.entitiesWithTransformAnim.pop(),this.activeEvent.activeDragItem.obj.rigidBody.setBodyType(0,!0),this.activeEvent.activeDragItem.paused=!0),this.activeEvent.wasDragEventTriggered===!0&&(this.activeEvent.wasDragEventTriggered=!1,this.activeEvent.actionsDrag.Transition.forEach(n=>{n.stop(),n.object.currentState!==null&&n.object.changeSelectedState(null,{scene:this.eventContext.page.scene,shared:this.eventContext.sharedAssets})}),this.activeEvent.actionsDrag.Animation.forEach(n=>{n.stop()}),this.activeEvent.actionsDrag.Audio.forEach(n=>{n.dispatchGameControl("stop")}),this.activeEvent.actionsDrag.Particles.forEach(n=>{n.dispatchGameControl("stop")}),this.activeEvent.actionsDrop.SetVariable.forEach(n=>n.checkConditions()),this.activeEvent.actionsDrop.SetVariable.forEach(n=>n.dispatch()),this.activeEvent.actionsDrop.DynamicVariablePlay.forEach(n=>n.dispatch()),this.activeEvent.actionsDrop.ClearLocalStorage.forEach(n=>n.dispatch()),this.activeEvent.actionsDrop.UserAPI.forEach(n=>n.dispatch())),this.eventManager.controlsManager.orbitControls&&(this.eventManager.controlsManager.orbitControls.enabled=!0)}}}connect(){let t={};if(this.eventContext.page.traverseEntity(i=>{i.component&&(t[i.component.uuid]?t[i.component.uuid].push(i.uuid):t[i.component.uuid]=[i.uuid])}),this.eventContext.page.traverseEntity(i=>{i.data?.events.filter(r=>r.data.type==="DragDrop"&&!r.data.disabled).forEach(r=>{this.events.push(new dpt(i,r.id,r.data,this.eventContext.page,this.eventContext.sharedAssets,this.eventManager,t))})}),!this.events.length)return;this.domEventsNeeded.clear(),this.domEventsNeeded.add("pointerdown");let e=this.eventContext.domElement;e.addEventListener("pointerdown",this.onPointerDown),e.addEventListener("pointermove",this.onPointerMove),e.addEventListener("pointerup",this.onPointerUp),this.domEventsNeeded.add("pointermove")}disconnect(){if(!this.events.length)return;this.domEventsNeeded.clear();let t=this.eventContext.domElement;t.removeEventListener("pointerdown",this.onPointerDown),t.removeEventListener("pointermove",this.onPointerMove),t.removeEventListener("pointerup",this.onPointerUp),this.events.forEach(e=>e.dispose())}setCursor(t){this.eventContext.domElement.style.cursor=t}onAnimationFrameDamping(){for(let t of this.events)for(let e of t.dragItems)e.paused||this.updateDragItem(e,!0)}calcPlaneIntersectPos(t,e,i,r){let{getCamera:n,raycaster:s}=this.eventContext;n().getWorldDirection(rg),rg.negate();let a=a0.identity();switch(r==="parent"?upt.multiplyMatrices(t.parent.matrixWorld,t.hiddenMatrix).decompose(Wr,a,aa):r==="local"&&t.matrixWorld.decompose(Wr,a,aa),i){case"x":Wr.set(1,0,0).applyQuaternion(a),pw.copy(rg).cross(Wr),fd.copy(Wr).cross(pw);break;case"y":Wr.set(0,1,0).applyQuaternion(a),pw.copy(rg).cross(Wr),fd.copy(Wr).cross(pw);break;case"z":Wr.set(0,0,1).applyQuaternion(a),pw.copy(rg).cross(Wr),fd.copy(Wr).cross(pw);break;case"xy":fd.set(0,0,1).applyQuaternion(a);break;case"yz":fd.set(1,0,0).applyQuaternion(a);break;case"xz":fd.set(0,1,0).applyQuaternion(a);break;case"adaptive":rg.angleTo(aa.set(0,1,0))>Math.PI/6?(Wr.crossVectors(aa.set(0,1,0),rg),fd.crossVectors(Wr,aa)):fd.set(0,1,0);break;default:fd.copy(rg);break}Py.setFromMatrixPosition(t.matrixWorld);let o=t.userData.lockedPlane?t.userData.worldPosition0:Py;if(Fie.setFromNormalAndCoplanarPoint(fd,o),!!s.ray.intersectPlane(Fie,e)&&(i==="x"||i==="y"||i==="z")){let l=aa.subVectors(e,o).dot(Wr);e.copy(o).addScaledVector(Wr,l)}}updateDragItem(t,e=!1){Py.setFromMatrixPosition(t.obj.matrixWorld),t.reset==="current"?CE.subVectors(t.fromPosition,Py).divideScalar(t.currentDampingFactor):t.reset==="original"?(CE.subVectors(t.obj.userData.worldPosition0,Py).divideScalar(t.currentDampingFactor),t.fromPosition.copy(t.obj.userData.worldPosition0),t.pointStart.copy(t.fromPosition),t.pointEnd.copy(t.pointStart)):CE.subVectors(t.pointEnd,t.pointStart).add(t.fromPosition).sub(Py).divideScalar(t.currentDampingFactor),t.paused=t.currentDampingFactor>1?CE.length()<cpt:!0,(this.activeEvent&&this.activeEvent.data.dampingFactor===1||e)&&hpt(t,CE.add(Py),this.activeEvent?.data.drop&&this.activeEvent?.data.autoOrient?t.orientationMatrix:null),t.obj.dispatchEvent({type:"beginEvent",eventName:"DragDrop"}),this.eventManager.requestRender()}},gw=new W,S4=new W,ap=new W,op=new W,jie=new $l,ppt=.01,mpt={type:"requestRender"},gpt=(function(){let t=new W,e=new W;return(i,r,n)=>n>0?(t.subVectors(i,r),t.length()<=n?i:e.copy(r).add(t.normalize().multiplyScalar(n))):r})(),Vie=(function(){let t=new St;return(e,i)=>{e.position.copy(i),e.parent!==null&&(t.copy(e.parent.matrixWorld).invert(),e.position.applyMatrix4(t)),t.copy(e.hiddenMatrix).invert(),e.position.applyMatrix4(t),e.updateMatrix(),e.hasNonUniformScale&&(e.updateMatrixWorld(),e.updateMatrixWorldSVD()),e instanceof So&&Pp(e.parent)&&e.invalidateDownstreamBooleanData(!0)}})(),vpt=class{constructor(t,e,i,r,n,s){this.data=t,this.id=e,this.object=i,this.paused=!1,this.currentDampingFactor=1,this.snapComplete=!1,this.isReset=!1,this.worldPosition0=new W,this.timeoutId=null,this.delayFinished=!0,this.wasOutside=!1,this.data={...Kj.defaultData,...t,...t.resetOnPointerLeave===void 0&&{resetOnPointerLeave:!1}},t.target===void 0||t.target==="cursor"||(this.target=r.find(t.target)),this.data.dampingFactor&&(this.currentDampingFactor=this.data.dampingFactor),this.resetDampingFactor=80/this.data.resetSpeed+1,this.object.getWorldPosition(this.worldPosition0),this.actions=Xs(t,t.actions,r,n,s,i)}},ypt=class extends Wo{constructor(t,e){super(t),this.eventManager=e,this.events=[],this.pairOfEventListeners=[],this.onMouseMove=i=>{if(!(Di.length>1)){this.eventContext.updateRaycaster(i);for(let r of this.events)r.target===void 0&&this.updateSingleEvent(r)}},this.onMouseEnter=i=>{for(let r of this.events)r.target===void 0&&(r.isReset=!1,r.currentDampingFactor=r.data.dampingFactor)},this.onMouseLeave=i=>{for(let r of this.events)r.target===void 0&&(r.data.resetOnPointerLeave&&(r.isReset=!0,r.currentDampingFactor=r.resetDampingFactor),this.updateSingleEvent(r))},this.onTargetChange=i=>()=>{this.updateSingleEvent(i)}}connect(){let{page:t}=this.eventContext;if(t.traverseEntity(r=>{let n=r.data?.events.find(s=>s.data.type==="Follow"&&!s.data.disabled);n&&(!t.data.globalPhysics.usePhysics||r.dataPatched.physics?.rigidBody!=="dynamic")&&this.events.push(new vpt(n.data,n.id,r,t,this.eventContext.sharedAssets,this.eventManager))}),!this.events.length)return;let{domElement:e,eventElement:i}=this.eventContext;this.domEventsNeeded.clear(),Pc&&(this.domEventsNeeded.add("pointerdown"),e.addEventListener("pointerdown",this.onMouseMove)),this.domEventsNeeded.add("pointermove"),i.addEventListener("pointermove",this.onMouseMove),this.eventContext.useWindowEvents||(e.addEventListener("pointerenter",this.onMouseEnter),e.addEventListener("pointerleave",this.onMouseLeave));for(let r of this.events)if(r.target!==void 0){let n=r.target,s=this.onTargetChange(r);this.pairOfEventListeners.push([n,s]),n.addEventListener("requestRender",s)}}disconnect(){if(!this.events.length)return;let{domElement:t,eventElement:e}=this.eventContext;this.domEventsNeeded.clear(),Pc&&t.removeEventListener("pointerdown",this.onMouseMove),e.removeEventListener("pointermove",this.onMouseMove),t.removeEventListener("pointerenter",this.onMouseEnter),t.removeEventListener("pointerleave",this.onMouseLeave);for(let[i,r]of this.pairOfEventListeners)i.removeEventListener("requestRender",r);for(let i of this.events)i.paused=!0,i.isReset=!1,Xa(i.actions)}onAnimationFrameDamping(){for(let t of this.events)t.paused||this.updateSingleEvent(t,!0)}updateSingleEvent(t,e=!1){this.events.forEach(a=>{a.actions.Create.forEach(o=>{o.dispatchThrottled()})});let{plane:i,limitDistance:r,limitDistanceEnabled:n}=t.data;if(t.object.getWorldPosition(ap),t.isReset)op.copy(t.worldPosition0);else if(t.target)t.target.getWorldPosition(op);else{let{getCamera:a,raycaster:o}=this.eventContext;if(i==="custom"?(a().getWorldDirection(S4),S4.negate(),gw.copy(S4)):i==="xy"?gw.set(0,0,1):i==="xz"?gw.set(0,1,0):i==="yz"&&gw.set(1,0,0),jie.setFromNormalAndCoplanarPoint(gw,ap),!o.ray.intersectPlane(jie,op))return}if(!t.isReset){if(op.distanceTo(t.worldPosition0)>r&&n&&t.target)if(t.snapComplete=!1,t.data.snapDelay&&(t.delayFinished=!1,typeof window<"u"&&t.timeoutId!==null&&(window.clearTimeout(t.timeoutId),t.timeoutId=null)),t.wasOutside=!0,t.data.resetAfterDistanceLimit)op.copy(t.worldPosition0),t.currentDampingFactor=t.resetDampingFactor;else return;else if(t.wasOutside&&(t.data.snapDelay&&typeof window<"u"&&(t.timeoutId=window.setTimeout(()=>{t.delayFinished=!0,t.paused=!1,this.updateSingleEvent(t)},t.data.snapDelay*1e3)),t.currentDampingFactor=t.data.dampingFactor,t.wasOutside=!1),t.delayFinished===!1)return}t.data.enabledTranslation[0]===!1&&(op.x=ap.x),t.data.enabledTranslation[1]===!1&&(op.y=ap.y),t.data.enabledTranslation[2]===!1&&(op.z=ap.z);let s=gpt(ap,op,t.wasOutside?0:t.data.maxDelta);if(t.currentDampingFactor>1){let a=gw.subVectors(s,ap).divideScalar(t.currentDampingFactor);ap.add(a),e&&Vie(t.object,ap),t.paused=a.length()<ppt}else Vie(t.object,s),t.paused=!0;t.object?.dispatchEvent({type:"beginEvent",eventName:"Follow"}),t.object.dispatchEvent(mpt)}},PE=new W,OR=new W,RE=new St,vw=new Ii,ng=new Ii,IE=new W,DE=new W,Ry=new W,lp=new W,E4=new $l,xpt=1e-6,bpt={type:"requestRender"},wpt={type:"changeRotation"},Hie=(function(){let t=new St;return function(e,i){e.parent!==null?t.multiplyMatrices(e.parent.matrixWorld,e.hiddenMatrix):t.copy(e.hiddenMatrix),i.premultiply(sge(t).invert()),e.rotation.setFromRotationMatrix(i),e.updateMatrix(),e instanceof So&&Pp(e.parent)&&e.invalidateDownstreamBooleanData(!0)}})(),_pt=class{constructor(t,e,i,r){this.id=e,this.object=i,this.paused=!1,this.currentDampingFactor=1,this.isReset=!1,this.worldQuaternion0=new Ii,this.timeoutId=null,this.delayFinished=!0,this.wasOutside=!1,this.data={...Zj.defaultData,...t,...t.resetOnPointerLeave===void 0&&{resetOnPointerLeave:!1}},t.target===void 0||t.target==="cursor"||(this.target=r.find(t.target)),this.data.dampingFactor&&(this.currentDampingFactor=this.data.dampingFactor),this.object.getWorldQuaternion(this.worldQuaternion0),this.resetDampingFactor=80/this.data.resetSpeed+1}},Spt=class extends Wo{constructor(){super(...arguments),this.events=[],this.pairOfEventListeners=[],this.pairOfUserEventListeners=[],this.onMouseMove=t=>{if(!(Di.length>1)){this._lastMouseEvent=t,this.eventContext.updateRaycaster(t);for(let e of this.events)e.target===void 0&&this.updateSingleEvent(e)}},this.onMouseEnter=t=>{for(let e of this.events)e.target===void 0&&(e.isReset=!1,e.currentDampingFactor=e.data.dampingFactor)},this.onMouseLeave=t=>{for(let e of this.events)e.target===void 0&&(e.data.resetOnPointerLeave&&(e.isReset=!0,e.currentDampingFactor=e.resetDampingFactor),this.updateSingleEvent(e))},this.onScroll=t=>{if(this._lastMouseEvent){let e=new PointerEvent("pointermove",{clientX:this._lastMouseEvent.clientX,clientY:this._lastMouseEvent.clientY,bubbles:!0,cancelable:!0,view:window});this.eventContext.eventElement.dispatchEvent(e)}},this.onTargetChange=t=>()=>{this.updateSingleEvent(t)},this.createUserEventListener=t=>({eventName:e,target:i})=>{if(!e||!i)return;let r=XT(e);r&&r==="LookAt"&&this.updateSingleEvent(t)}}connect(){let{page:t}=this.eventContext;if(t.traverseEntity(r=>{let n=r.data?.events.find(s=>s.data.type==="LookAt"&&!s.data.disabled);n&&(!t.data.globalPhysics.usePhysics||r.dataPatched.physics?.rigidBody!=="dynamic")&&this.events.push(new _pt(n.data,n.id,r,t))}),!this.events.length)return;let{domElement:e,eventElement:i}=this.eventContext;this.domEventsNeeded.clear(),Pc&&(this.domEventsNeeded.add("pointerdown"),e.addEventListener("pointerdown",this.onMouseMove)),this.domEventsNeeded.add("pointermove"),i.addEventListener("pointermove",this.onMouseMove),this.eventContext.useWindowEvents?i.addEventListener("scroll",this.onScroll):(e.addEventListener("pointerenter",this.onMouseEnter),e.addEventListener("pointerleave",this.onMouseLeave));for(let r of this.events){if(r.target!==void 0){let a=this.onTargetChange(r),o=r.target;this.pairOfEventListeners.push([o,a]),o.addEventListener("requestRender",a)}let n=this.createUserEventListener(r),s=r.object;this.pairOfUserEventListeners.push([s,n]),s.addEventListener("userEvent",n)}}disconnect(){if(!this.events.length)return;let{domElement:t,eventElement:e}=this.eventContext;this.domEventsNeeded.clear(),Pc&&t.removeEventListener("pointerdown",this.onMouseMove),e.removeEventListener("pointermove",this.onMouseMove),t.removeEventListener("pointerenter",this.onMouseEnter),t.removeEventListener("pointerleave",this.onMouseLeave),e.removeEventListener("scroll",this.onScroll);for(let[i,r]of this.pairOfEventListeners)i.removeEventListener("requestRender",r);for(let[i,r]of this.pairOfUserEventListeners)i.removeEventListener("userEvent",r);for(let i of this.events)i.paused=!0,i.isReset=!1}onAnimationFrameDamping(){for(let t of this.events)t.paused||this.updateSingleEvent(t)}updateSingleEvent(t){let{tilt:e,axis:i,distance:r,plane:n,limitDistance:s,enabledRotation:a,limitDistanceEnabled:o}=t.data,{getCamera:l,raycaster:c}=this.eventContext,{object:u,target:h}=t;if(u.getWorldPosition(IE),!t.isReset)if(t.target)t.target.getWorldPosition(DE);else{if(n==="custom"?(l().getWorldDirection(OR),OR.negate(),E4.setFromNormalAndCoplanarPoint(OR,IE)):(n==="xy"?PE.set(0,0,1):n==="xz"?PE.set(0,1,0):n==="yz"&&PE.set(1,0,0),E4.setFromNormalAndCoplanarPoint(PE,IE)),!c.ray.intersectPlane(E4,DE))return;r>0&&(n==="custom"||n===void 0)&&DE.addScaledVector(OR,r)}if(t.isReset||(h?e==="target"?Ry.copy(h.up).applyMatrix4(RE.extractRotation(h.matrixWorld)).normalize():a.some(d=>d===!1)?(i==="x"?(lp.set(0,0,1),a[2]===!1&&lp.set(0,1,0)):i==="y"?(lp.set(1,0,0),a[0]===!1&&lp.set(0,0,1)):(lp.set(0,1,0),a[1]===!1&&lp.set(1,0,0)),Ry.copy(lp).applyQuaternion(t.worldQuaternion0).normalize()):Ry.set(0,1,0):n==="custom"?Ry.set(0,1,0):Ry.copy(PE)),t.isReset)ng.copy(t.worldQuaternion0);else if(IE.distanceTo(DE)>s&&o&&h)if(t.data.snapDelay&&(t.delayFinished=!1,typeof window<"u"&&t.timeoutId!==null&&(window.clearTimeout(t.timeoutId),t.timeoutId=null)),t.wasOutside=!0,t.data.resetAfterDistanceLimit)ng.copy(t.worldQuaternion0),t.currentDampingFactor=t.resetDampingFactor;else return;else{if(t.wasOutside&&(t.data.snapDelay&&typeof window<"u"&&(t.timeoutId=window.setTimeout(()=>{t.delayFinished=!0,t.paused=!1,this.updateSingleEvent(t)},t.data.snapDelay*1e3)),t.currentDampingFactor=t.data.dampingFactor,t.wasOutside=!1),t.delayFinished===!1)return;Ept(RE,DE,IE,Ry,i,lp),ng.setFromRotationMatrix(RE),vw.setFromUnitVectors(lp.applyQuaternion(ng),Ry),a.some(d=>d===!1)&&e!=="target"&&ng.premultiply(vw).normalize()}t.currentDampingFactor>1?(u.updateWorldMatrix(!0,!1),vw.setFromRotationMatrix(sge(u.matrixWorld)),vw.slerp(ng,1/t.currentDampingFactor),Hie(u,RE.makeRotationFromQuaternion(vw)),t.paused=8*(1-vw.dot(ng))<xpt):(Hie(u,RE.makeRotationFromQuaternion(ng)),t.paused=!0),t.object?.dispatchEvent({type:"beginEvent",eventName:"LookAt"}),u.dispatchEvent(bpt),u.dispatchEvent(wpt)}},nu=new W,na=new W,vs=new W;function Ept(t,e,i,r,n,s){let a=t.elements;vs.subVectors(e,i),vs.lengthSq()===0&&(vs.z=1),vs.normalize(),na.crossVectors(r,vs),na.lengthSq()===0&&(Math.abs(r.z)===1?vs.x+=1e-4:vs.z+=1e-4,vs.normalize(),na.crossVectors(r,vs)),na.normalize(),nu.crossVectors(vs,na),n==="x"?s.z===1?[na,nu,vs]=[vs,na,nu]:(na.negate(),[na,vs]=[vs,na]):n==="y"?s.x===1?[na,nu,vs]=[nu,vs,na]:(na.negate(),[nu,vs]=[vs,nu]):s.x===1&&(na.negate(),[na,nu]=[nu,na]),a[0]=na.x,a[4]=nu.x,a[8]=vs.x,a[1]=na.y,a[5]=nu.y,a[9]=vs.y,a[2]=na.z,a[6]=nu.z,a[10]=vs.z}var Apt=class{constructor(t,e,i,r,n,s){this.id=t,this.data=e,this.object=i,this.entered=!1,this.actions=Xs(e,e.actions,r,n,s,i)}disconnect(){Xa(this.actions)}dispatchEnter(){this.actions.Transition.forEach(t=>{t.object.currentTransitionEvent!==this&&(t.object.currentTransitionEvent=this,t.init())}),this.entered||(this.entered=!0,this.actions.TimelineAnimation.forEach(t=>t.toggle(!0)),this.actions.Transition.forEach(t=>t.playFromCurrent()),this.actions.Animation.forEach(t=>t.play()),this.actions.Create.forEach(t=>t.dispatchStart()),this.actions.Particles.forEach(t=>t.dispatchBasic()),this.actions.Destroy.forEach(t=>t.dispatch()),this.actions.SwitchCamera.forEach(t=>t.playFromCurrent()),this.actions.SceneTransition.forEach(t=>t.dispatch()),this.actions.SetVariable.forEach(t=>t.checkConditions()),this.actions.SetVariable.forEach(t=>t.dispatch()),this.actions.DynamicVariablePlay.forEach(t=>t.dispatch()),this.actions.ClearLocalStorage.forEach(t=>t.dispatch()),this.actions.UserAPI.forEach(t=>t.dispatch()))}dispatchLeave(){this.actions.Transition.forEach(t=>{t.object.currentTransitionEvent!==this&&(t.object.currentTransitionEvent=this,t.init())}),this.entered&&(this.entered=!1,this.actions.TimelineAnimation.forEach(t=>t.toggle(!1)),this.actions.Create.forEach(t=>t.dispatchStop()),this.actions.Transition.forEach(t=>t.reverseFromCurrent()),this.actions.Particles.forEach(t=>t.reverseFromCurrent()),this.actions.SwitchCamera.forEach(t=>t.reverseFromCurrent()))}dispatchUserEvent(t){this.actions.Transition.forEach(e=>{e.object.currentTransitionEvent!==this&&(e.object.currentTransitionEvent=this,e.init())}),t?(this.actions.Transition.forEach(e=>e.reverseFromCurrent()),this.actions.Particles.forEach(e=>e.reverseFromCurrent()),this.actions.Animation.forEach(e=>e.reverseFromCurrent()),this.actions.TimelineAnimation.forEach(e=>e.reverseFromCurrent()),this.actions.SwitchCamera.forEach(e=>e.reverseFromCurrent())):(this.actions.Transition.forEach(e=>e.playFromCurrent()),this.actions.Animation.forEach(e=>e.playFromCurrent()),this.actions.TimelineAnimation.forEach(e=>e.playFromCurrent()),this.actions.Create.forEach(e=>e.dispatch()),this.actions.Particles.forEach(e=>e.dispatchBasic()),this.actions.Destroy.forEach(e=>e.dispatch()),this.actions.SwitchCamera.forEach(e=>e.playFromCurrent())),this.actions.SceneTransition.forEach(e=>e.dispatch()),this.actions.SetVariable.forEach(e=>e.checkConditions()),this.actions.SetVariable.forEach(e=>e.dispatch()),this.actions.DynamicVariablePlay.forEach(e=>e.dispatch()),this.actions.ClearLocalStorage.forEach(e=>e.dispatch()),this.actions.UserAPI.forEach(e=>e.dispatch())}},Mpt=class extends Wo{constructor(t,e){super(t),this.eventManager=e,this.eventsPerObjects={},this.objects=[],this.objects2D=[],this._prevObjects=[],this.onMouseDown=i=>{Di.length>1||(this.eventContext.updateRaycaster(i),this.handleMouseHoverEvent())},this.onMouseUp=i=>{Di.length>1||this.handleMouseHoverEvent(!0)},this.onMouseMove=i=>{Di.length>1||(this.eventContext.updateRaycaster(i),this.handleMouseHoverEvent())},this.onUserEvent=({eventName:i,target:r,reverse:n})=>{if(!i||!r)return;let s=XT(i);s&&s==="MouseHover"&&(r.dispatchEvent({type:"beginEvent",eventName:"MouseHover"}),this.eventsPerObjects[r.uuid]?.forEach(a=>a.dispatchUserEvent(n)))}}connect(){let{page:t,sharedAssets:e}=this.eventContext,i=(n,s)=>{if(!(!n.visible||!n.data?.events.length)){for(let{id:a,data:o}of n.data.events)if(!o.disabled&&o.type==="MouseHover")try{let l=new Apt(a,o,n,t,e,this.eventManager);this.eventsPerObjects[n.uuid]?this.eventsPerObjects[n.uuid].push(l):this.eventsPerObjects[n.uuid]=[l]}catch{}this.eventsPerObjects[n.uuid]?.length&&this.objects.push(n instanceof Ka?s:n)}};if(t.traverseEntity(n=>{(n instanceof Fo||n instanceof Fa)&&n.frame?.traverse(s=>{i(s,n)}),i(n)}),!this.objects.length)return;let{domElement:r}=this.eventContext;this.domEventsNeeded.clear(),Pc&&(this.domEventsNeeded.add("pointerdown"),r.addEventListener("pointerdown",this.onMouseDown),this.domEventsNeeded.add("pointerup"),r.addEventListener("pointerup",this.onMouseUp)),this.domEventsNeeded.add("pointermove"),r.addEventListener("pointermove",this.onMouseMove),this.objects.forEach(n=>{n.addEventListener("userEvent",this.onUserEvent)})}disconnect(){if(!this.objects.length)return;let{domElement:t}=this.eventContext;this.domEventsNeeded.clear(),Pc&&(t.removeEventListener("pointerdown",this.onMouseDown),t.removeEventListener("pointerup",this.onMouseUp)),t.removeEventListener("pointermove",this.onMouseMove),Object.values(this.eventsPerObjects).forEach(e=>{e.forEach(i=>{i.disconnect()})}),this.objects.forEach(e=>{e.removeEventListener("userEvent",this.onUserEvent)})}handleMouseHoverEvent(t=!1){let e=[];if(!t){let{stopRaycast:i,raycaster:r,page:n,pointerScreen:s}=this.eventContext,a=!1;if(n.uiCanvas&&(a=yp(n,[s.x,s.y],Object.keys(this.eventsPerObjects),o=>{e.push(o)})),i&&!a){let o=vI(r,n,this.objects);e=wV(o),o.forEach(l=>{l.object instanceof Fo&&yp(l.object,[l?.uv?.x??0,l?.uv?.y??0],Object.keys(this.eventsPerObjects),c=>{e.push(c)})})}else this.objects.forEach(o=>{let l=W3(r,o);l&&(e.push(o),o instanceof Fo&&yp(o,[l?.uv?.x??0,l?.uv?.y??0],Object.keys(this.eventsPerObjects),c=>{e.push(c)}))})}this._prevObjects.length&&this._prevObjects.forEach(i=>{e.includes(i)||(i.dispatchEvent({type:"beginEvent",eventName:"MouseHover"}),this.eventsPerObjects[i.uuid]?.forEach(r=>r.dispatchLeave()))}),e.length&&e.forEach(i=>{i.dispatchEvent({type:"beginEvent",eventName:"MouseHover"}),this.eventsPerObjects[i.uuid]?.forEach(r=>r.dispatchEnter())}),this._prevObjects=e}},Tpt=class{constructor(t,e,i,r,n,s){this.id=t,this.data=e,this.object=i,this.scrollCounter=0,this.actions=Xs(e,e.actions,r,n,s,i)}connect(){this.scrollCounter=0}disconnect(){Xa(this.actions)}dispatch(t){this.actions.Transition.forEach(r=>{r.object.currentTransitionEvent!==this&&(r.object.currentTransitionEvent=this,r.init())});let e=t>0?1:-1;this.scrollCounter+=e,this.scrollCounter=Math.min(Math.max(this.scrollCounter,0),this.data.steps);let i=this.scrollCounter/this.data.steps;this.actions.Transition.forEach(r=>r.seek(i)),this.actions.Animation.forEach(r=>r.seek(e)),this.actions.TimelineAnimation.forEach(r=>r.seek(i)),this.actions.Create.forEach(r=>r.dispatchThrottled()),this.actions.SetVariable.forEach(r=>r.checkConditions()),this.actions.SetVariable.forEach(r=>r.dispatch()),this.actions.DynamicVariablePlay.forEach(r=>r.dispatch()),this.actions.ClearLocalStorage.forEach(r=>r.dispatch()),this.actions.UserAPI.forEach(r=>r.dispatch())}dispatchUserEvent(t){this.actions.Transition.forEach(e=>{e.object.currentTransitionEvent!==this&&(e.object.currentTransitionEvent=this,e.init())}),t?(this.actions.Transition.forEach(e=>e.reverseFromCurrent()),this.actions.Animation.forEach(e=>e.reverseFromCurrent()),this.actions.TimelineAnimation.forEach(e=>e.reverseFromCurrent())):(this.actions.Transition.forEach(e=>{e.playFromCurrent()}),this.actions.Animation.forEach(e=>{e.playFromCurrent()}),this.actions.TimelineAnimation.forEach(e=>{e.playFromCurrent()})),this.actions.Create.forEach(e=>e.dispatchThrottled()),this.actions.SetVariable.forEach(e=>e.checkConditions()),this.actions.SetVariable.forEach(e=>e.dispatch()),this.actions.DynamicVariablePlay.forEach(e=>e.dispatch()),this.actions.ClearLocalStorage.forEach(e=>e.dispatch()),this.actions.UserAPI.forEach(e=>e.dispatch())}},Cpt=class{constructor(t,e,i,r,n,s,a){this.id=t,this.data=e,this.object=i,this.domElement=s,this.eventManager=a,this.scrollStart=0,this.scrollEnd=0,this.actions=Xs(e,e.actions,r,n,a,i)}getStickyParentElement(){let t=this.domElement;for(;t;){if(window.getComputedStyle(t).position==="sticky")return t;t=t.parentElement}return null}computeScrollBounds(){let t=this.getStickyParentElement(),e=t?.parentElement,i=this.domElement.getBoundingClientRect(),r={top:i.top,bottom:i.bottom,left:i.left,right:i.right,width:i.width,height:i.height};if(e){let c=e.getBoundingClientRect(),u=window.getComputedStyle(t),h=parseFloat(u.marginTop)+parseFloat(u.marginBottom),d=parseFloat(u.top),f=parseFloat(u.bottom),p=c.height-h;if(!isNaN(d))i.top===d?(r.top+=c.top-d,r.bottom+=c.top-d):i.top<0&&(r.top-=p-i.height,r.bottom-=p-i.height);else if(!isNaN(f)){let g=document.body.clientHeight??window.innerHeight,m=window.innerWidth-(document.documentElement.clientWidth??window.innerWidth);i.bottom===g-f?(r.top+=c.top-i.height+f+m,r.bottom+=c.top-i.height+f+m):i.bottom<g-f&&(r.top-=p-i.height,r.bottom-=p-i.height)}}let n=document.body,s=document.documentElement,a=window.pageYOffset||s.scrollTop||n.scrollTop,o=s.clientTop||n.clientTop||0,l=Math.round(r.top+a-o);if(this.data.startFrom==="enter"){let c=window.innerHeight,u=r.height,h=this.data.enterAnchor,d=h==="top"?c:h==="bottom"?c-u:c-u*.5;this.scrollStart=l-d}else this.scrollStart=0;this.scrollStart+=this.data.startOffset??0,this.scrollEnd=this.scrollStart+(this.data.endAfter??400),this.box=r,this.computeScroll({x:window.scrollX,y:window.scrollY})}connect(){this.computeScrollBounds()}disconnect(){Xa(this.actions)}handleResize(){this.computeScrollBounds()}get isInvalidBox(){return this.box===void 0||this.box.width===0&&this.box.height===0&&this.box.top===0&&this.box.bottom===0}computeScroll({x:t,y:e}){this.actions.Transition.forEach(n=>{n.object.currentTransitionEvent!==this&&(n.object.currentTransitionEvent=this,n.init())});let i=this.scrollEnd-this.scrollStart,r=Math.min(1,Math.max(0,(e-this.scrollStart)/i));this.actions.Transition.forEach(n=>n.seek(r)),this.actions.Animation.forEach(n=>n.seek(r)),this.actions.Create.forEach(n=>n.dispatchThrottled()),this.actions.SetVariable.forEach(n=>n.checkConditions()),this.actions.SetVariable.forEach(n=>n.dispatch()),this.actions.DynamicVariablePlay.forEach(n=>n.dispatch()),this.actions.ClearLocalStorage.forEach(n=>n.dispatch()),this.actions.UserAPI.forEach(n=>n.dispatch())}dispatch(t){this.isInvalidBox&&this.computeScrollBounds(),this.computeScroll(t)}dispatchUserEvent(t){this.actions.Transition.forEach(e=>{e.object.currentTransitionEvent!==this&&(e.object.currentTransitionEvent=this,e.init())}),t?(this.actions.Transition.forEach(e=>e.reverseFromCurrent()),this.actions.Animation.forEach(e=>e.reverseFromCurrent())):(this.actions.Transition.forEach(e=>{e.playFromCurrent()}),this.actions.Animation.forEach(e=>{e.playFromCurrent()})),this.actions.Create.forEach(e=>e.dispatchThrottled()),this.actions.SetVariable.forEach(e=>e.checkConditions()),this.actions.SetVariable.forEach(e=>e.dispatch()),this.actions.DynamicVariablePlay.forEach(e=>e.dispatch()),this.actions.ClearLocalStorage.forEach(e=>e.dispatch()),this.actions.UserAPI.forEach(e=>e.dispatch())}},Ppt=class extends Wo{constructor(t,e){super(t),this.managers=e,this.wheelEventsPerObject=new Map,this.scrollEventsPerObject=new Map,this.isInview=!0,this.handleResize=()=>{[...this.scrollEventsPerObject.entries()].forEach(([i,r])=>{r.forEach(n=>n.handleResize())})},this.onScroll=i=>{if(!this.isInview)return;let r={y:window.scrollY,x:window.scrollX};[...this.scrollEventsPerObject.entries()].forEach(([n,s])=>{n.dispatchEvent({type:"beginEvent",eventName:"Scroll",scroll:r}),s.forEach(a=>a.dispatch(r))})},this.onWheel=i=>{!this.isInview||i.ctrlKey||[...this.wheelEventsPerObject.entries()].forEach(([r,n])=>{r.dispatchEvent({type:"beginEvent",eventName:"Scroll",deltaY:i.deltaY}),n.forEach(s=>s.dispatch(i.deltaY))})},this.onUserEvent=({eventName:i,target:r,reverse:n})=>{if(!i||!r)return;let s=XT(i);s&&s==="Scroll"&&(r.dispatchEvent({type:"beginEvent",eventName:"Scroll"}),this.wheelEventsPerObject.get(r)?.forEach(a=>{a.dispatchUserEvent(n)}))}}connect(){let{page:t,sharedAssets:e,domElement:i,isExport:r}=this.eventContext,n=s=>{if(s.data?.events.length){for(let{id:a,data:o}of s.data.events)if(!o.disabled&&o.type==="Scroll")if(o.trigger==="load"||!r){let l=new Tpt(a,o,s,t,e,this.managers);this.wheelEventsPerObject.has(s)?this.wheelEventsPerObject.get(s)?.push(l):this.wheelEventsPerObject.set(s,[l])}else{let l=new Cpt(a,o,s,t,e,i,this.managers);this.scrollEventsPerObject.has(s)?this.scrollEventsPerObject.get(s)?.push(l):this.scrollEventsPerObject.set(s,[l])}}};t.traverseEntity(s=>{(s instanceof Fo||s instanceof Fa)&&s.frame?.traverse(a=>{n(a)}),n(s)}),this.intersectionObserver=new IntersectionObserver(s=>{let a=s[0];a&&(this.isInview=a.isIntersecting)},{root:null}),this.intersectionObserver.observe(this.eventContext.domElement),[...this.wheelEventsPerObject.entries()].forEach(([s,a])=>{a.forEach(o=>o.connect()),s.addEventListener("userEvent",this.onUserEvent)}),[...this.scrollEventsPerObject.entries()].forEach(([s,a])=>{a.forEach(o=>o.connect()),s.addEventListener("userEvent",this.onUserEvent)}),[...this.wheelEventsPerObject.values()].some(s=>s.length)&&(this.domEventsNeeded.add("wheel"),window.addEventListener("wheel",this.onWheel)),[...this.scrollEventsPerObject.values()].some(s=>s.length)&&(this.domEventsNeeded.add("scroll"),window.addEventListener("scroll",this.onScroll),window.addEventListener("resize",this.handleResize))}disconnect(){window.removeEventListener("wheel",this.onWheel),window.removeEventListener("scroll",this.onScroll),window.removeEventListener("resize",this.handleResize),this.intersectionObserver.unobserve(this.eventContext.domElement),this.domEventsNeeded.clear(),[...this.wheelEventsPerObject.entries()].forEach(([t,e])=>{e.forEach(i=>i.disconnect()),t.removeEventListener("userEvent",this.onUserEvent)}),[...this.scrollEventsPerObject.entries()].forEach(([t,e])=>{e.forEach(i=>i.disconnect()),t.removeEventListener("userEvent",this.onUserEvent)})}},Rpt=class{constructor(t,e,i,r,n,s){this.id=t,this.data=e,this.object=i,this.actions=Xs(e,e.actions,r,n,s,i)}disconnect(){Xa(this.actions)}dispatch(){this.actions.Transition.forEach(t=>{t.play()}),this.actions.Animation.forEach(t=>{t.play()}),this.actions.TimelineAnimation.forEach(t=>{t.play()}),this.actions.SwitchCamera.forEach(t=>{t.play()}),this.actions.SceneTransition.forEach(t=>{t.dispatch()}),this.actions.Reset.forEach(t=>t.dispatch()),this.actions.SetVariable.forEach(t=>t.checkConditions()),this.actions.SetVariable.forEach(t=>t.dispatch()),this.actions.DynamicVariablePlay.forEach(t=>t.dispatch()),this.actions.ClearLocalStorage.forEach(t=>t.dispatch()),this.actions.UserAPI.forEach(t=>t.dispatch()),this.actions.Create.forEach(t=>{t.dispatchFromStart()}),this.actions.Destroy.forEach(t=>{t.dispatchFromStart()})}dispatchAfter(t){this.actions.Audio.forEach(e=>{(e.interaction.data.triggerAfter??"any")===t&&(e.interaction instanceof s0?e.interaction.audioPlayer.play():e.interaction instanceof gV&&e.interaction.dispatch())}),this.actions.Video.forEach(e=>{let i=e.interaction.data.triggerAfter??"autoplay";i===t&&(e.interaction instanceof Ug?e.interaction.play(i==="autoplay"):e.interaction instanceof xV&&e.interaction.dispatch())}),this.actions.Particles.forEach(e=>{(e.data.triggerAfter??"any")===t&&e.dispatchBasic()})}async seekVideos(t){let e=[];this.actions.Video.forEach(i=>{(i.interaction.data.triggerAfter??"autoplay")==="autoplay"&&i.interaction instanceof Ug&&e.push(i.interaction.seek(t))}),await Promise.all(e)}pauseVideos(){this.actions.Video.forEach(t=>{t.interaction instanceof Ug&&t.interaction.pause()})}dispatchUserEvent(t){this.actions.Transition.forEach(e=>{e.object.currentTransitionEvent!==this&&(e.object.currentTransitionEvent=this,e.init())}),t?(this.actions.Transition.forEach(e=>e.reverseFromCurrent()),this.actions.Animation.forEach(e=>e.reverseFromCurrent()),this.actions.TimelineAnimation.forEach(e=>e.reverseFromCurrent()),this.actions.SwitchCamera.forEach(e=>e.reverseFromCurrent())):(this.actions.Transition.forEach(e=>e.playFromCurrent()),this.actions.Animation.forEach(e=>e.playFromCurrent()),this.actions.TimelineAnimation.forEach(e=>e.playFromCurrent()),this.actions.SwitchCamera.forEach(e=>e.playFromCurrent())),this.actions.SceneTransition.forEach(e=>e.dispatch()),this.actions.Reset.forEach(e=>e.dispatch()),this.actions.SetVariable.forEach(e=>e.checkConditions()),this.actions.SetVariable.forEach(e=>e.dispatch()),this.actions.DynamicVariablePlay.forEach(e=>e.dispatch()),this.actions.ClearLocalStorage.forEach(e=>e.dispatch()),this.actions.UserAPI.forEach(e=>e.dispatch()),this.actions.Create.forEach(e=>{e.dispatch()}),this.actions.Destroy.forEach(e=>{e.dispatch()}),this.actions.Audio.forEach(e=>{e.interaction instanceof s0?e.interaction.audioPlayer.play():e.interaction instanceof gV&&e.interaction.dispatch()}),this.actions.Video.forEach(e=>{e.interaction instanceof Ug?e.interaction.play():e.interaction instanceof xV&&e.interaction.dispatch()}),this.actions.Particles.forEach(e=>{e.dispatchBasic()})}},Ipt=class extends Wo{constructor(t,e){super(t),this.eventManager=e,this.eventsPerObject=new Map,this.eventsAfterPerObject=new Map,this.onMouseDown=()=>{[...this.eventsAfterPerObject.entries()].forEach(([i,r])=>{i.dispatchEvent({type:"beginEvent",eventName:"Start"}),r.forEach(n=>{n.dispatchAfter("mouseDown")})})},this.onKeyDown=()=>{[...this.eventsAfterPerObject.entries()].forEach(([i,r])=>{i.dispatchEvent({type:"beginEvent",eventName:"Start"}),r.forEach(n=>{n.dispatchAfter("keyDown")})})},this.onAny=()=>{let{domElement:i,isExport:r}=this.eventContext,n=r?document:i;n.removeEventListener("pointerdown",this.onAny),n.removeEventListener("mousedown",this.onAny),document.removeEventListener("keydown",this.onAny),[...this.eventsAfterPerObject.entries()].forEach(([s,a])=>{s.dispatchEvent({type:"beginEvent",eventName:"Start"}),a.forEach(o=>{o.dispatchAfter("any")})})},this.onSceneTransitionAudioVideoPlay=()=>{[...this.eventsAfterPerObject.entries()].forEach(([i,r])=>{i.dispatchEvent({type:"beginEvent",eventName:"Start"}),r.forEach(n=>{n.actions.Audio.forEach(s=>{s.interaction instanceof s0&&s.interaction.audioPlayer.play()}),n.actions.Video.forEach(s=>{let a=s.interaction.data.triggerAfter??"autoplay";s.interaction instanceof Ug&&s.interaction.play(a==="autoplay")}),n.actions.Particles.forEach(s=>{s.dispatchBasic()})})})},this.onPlay=()=>{[...this.eventsAfterPerObject.entries()].forEach(([i,r])=>{i.dispatchEvent({type:"beginEvent",eventName:"Start"}),r.forEach(n=>{n.dispatchAfter("autoplay")})})},this.seekVideos=async i=>{let r=[];[...this.eventsAfterPerObject.entries()].forEach(([n,s])=>{s.forEach(a=>{r.push(a.seekVideos(i))})}),await Promise.all(r)},this.pauseVideos=()=>{[...this.eventsAfterPerObject.entries()].forEach(([i,r])=>{r.forEach(n=>{n.pauseVideos()})})},this.onUserEvent=({eventName:i,target:r,reverse:n})=>{if(!i||!r)return;let s=XT(i);s&&s==="Start"&&(r instanceof Ka||r.dispatchEvent({type:"beginEvent",eventName:"Start"}),this.eventsPerObject.get(r)?.forEach(a=>{a.dispatchUserEvent(n)}),this.eventsAfterPerObject.get(r)?.forEach(a=>{a.dispatchUserEvent(n)}))}}connect(){let{sharedAssets:t,page:e}=this.eventContext,i=r=>{if(r.data?.events.length)for(let{id:n,data:s}of r.data.events){if(s.disabled||s.type!=="Start")continue;let a=new Rpt(n,s,r,e,t,this.eventManager);(a.actions.Transition.length||a.actions.TimelineAnimation.length||a.actions.Animation.length||a.actions.SwitchCamera.length||a.actions.Create.length||a.actions.Destroy.length||a.actions.SceneTransition.length||a.actions.Reset.length||a.actions.SetVariable.length||a.actions.DynamicVariablePlay.length||a.actions.ClearLocalStorage.length||a.actions.UserAPI.length)&&(this.eventsPerObject.has(r)?this.eventsPerObject.get(r)?.push(a):this.eventsPerObject.set(r,[a])),a.actions.Audio.length&&(this.eventsAfterPerObject.has(r)?this.eventsAfterPerObject.get(r)?.push(a):this.eventsAfterPerObject.set(r,[a])),a.actions.Video.length&&(this.hasVideoAction=!0,this.eventsAfterPerObject.has(r)?this.eventsAfterPerObject.get(r)?.push(a):this.eventsAfterPerObject.set(r,[a])),a.actions.Particles.length&&(this.eventsAfterPerObject.has(r)?this.eventsAfterPerObject.get(r)?.push(a):this.eventsAfterPerObject.set(r,[a]))}};if(e.traverseEntity(r=>{(r instanceof Fo||r instanceof Fa)&&r.frame?.traverse(n=>{i(n)}),i(r)}),[...this.eventsAfterPerObject.values()].some(r=>r.length)){if(this.eventManager.activateCount===0){let{domElement:r,isExport:n}=this.eventContext,s=n?document:r;s.addEventListener("pointerdown",this.onMouseDown,{once:!0}),s.addEventListener("mousedown",this.onMouseDown,{once:!0}),document.addEventListener("keydown",this.onKeyDown,{once:!0}),s.addEventListener("pointerdown",this.onAny),s.addEventListener("mousedown",this.onAny),document.addEventListener("keydown",this.onAny),[...this.eventsAfterPerObject.entries()].forEach(([a,o])=>{a.addEventListener("userEvent",this.onUserEvent)})}else this.onSceneTransitionAudioVideoPlay();this.onPlay()}[...this.eventsPerObject.entries()].forEach(([r,n])=>{r.dispatchEvent({type:"beginEvent",eventName:"Start"}),n.forEach(s=>s.dispatch()),r.addEventListener("userEvent",this.onUserEvent)})}disconnect(){if([...this.eventsAfterPerObject.values()].some(t=>t.length)){let{domElement:t,isExport:e}=this.eventContext,i=e?document:t;i.removeEventListener("pointerdown",this.onMouseDown),i.removeEventListener("mousedown",this.onMouseDown),document.removeEventListener("keydown",this.onKeyDown),i.removeEventListener("pointerdown",this.onAny),i.removeEventListener("mousedown",this.onAny),document.removeEventListener("keydown",this.onAny),[...this.eventsAfterPerObject.entries()].forEach(([r,n])=>{r.removeEventListener("userEvent",this.onUserEvent),n.forEach(s=>s.disconnect())})}[...this.eventsPerObject.entries()].forEach(([t,e])=>{t.removeEventListener("userEvent",this.onUserEvent),e.forEach(i=>i.disconnect())}),this.eventsPerObject.clear(),this.eventsAfterPerObject.clear()}},Dpt=class{constructor(t,e,i,r,n,s){this.id=t,this.data=e,this.object=i,this.initialDisabled=!1,this.actions=Xs(e,e.actions,r,n,s,i),this.target=e.target}disconnect(){Xa(this.actions)}dispatch(t){this.initialDisabled||(this.actions.Transition.forEach(e=>{e.object.currentTransitionEvent!==this&&(e.object.currentTransitionEvent=this,e.init())}),this.object.dispatchEvent({type:"beginEvent",eventName:"Collision"}),this.actions.Transition.forEach(e=>{e.data.runMode==="Toggle"?e.toggle():e.play()}),this.actions.Animation.forEach(e=>{e.data.runMode==="Toggle"?e.toggle():e.play()}),this.actions.TimelineAnimation.forEach(e=>{e.data.runMode==="Toggle"?e.toggle():e.play()}),this.actions.Reset.forEach(e=>{e.dispatch()}),this.actions.Link.forEach(e=>{e.dispatch()}),this.actions.Reset.forEach(e=>{e.dispatch()}),this.actions.Create.forEach(e=>{e.dispatch()}),this.actions.Destroy.forEach(e=>{e.dispatch(t??!1)}),this.actions.SetVariable.forEach(e=>e.checkConditions()),this.actions.SetVariable.forEach(e=>e.dispatch()),this.actions.DynamicVariablePlay.forEach(e=>e.dispatch()),this.actions.Audio.forEach(e=>{e.dispatchBasic()}),this.actions.Particles.forEach(e=>{e.dispatchBasic()}),this.actions.Video.forEach(e=>{e.dispatchBasic()}),this.actions.ClearLocalStorage.forEach(e=>e.dispatch()),this.actions.UserAPI.forEach(e=>e.dispatch()))}},Opt=class extends Wo{constructor(t,e,i,r,n){super(t),this.sharedVariables=e,this.eventManager=i,this.needsMouse=r,this.needsRaycast=n,this.dynamicVars=[],this.variablesToWatch=[],this.prevMouseProperty=null,this.prevRaycastProperty=null,this.pauseTime=0,this.isOutOfFocus=!1,this.events=[],this.onFrame=s=>{let a=this.eventContext.sharedAssets;if(this.rafId=window.requestAnimationFrame(this.onFrame),this.isOutOfFocus)return;let o=new Date,l=[],c=[];for(let d=0;d<this.propertiesToWatch.length;d++){let{objectId:f,property:p,prevValue:g}=this.propertiesToWatch[d],m=this.eventContext.scene.find(f),y=Jj.propertyPaths[p];if(y[0]==="width"||y[0]==="height"||y[0]==="depth")m=m.geometry.userData.parameters[y[0]];else for(let b=0;b<y.length;b++)m=m[y[b]];g===null?this.propertiesToWatch[d].prevValue=m instanceof W?m.clone():m:(m instanceof W?!m.equals(g):g!==m)&&(c.push({objId:f,property:p}),m instanceof W?this.propertiesToWatch[d].prevValue.copy(m):this.propertiesToWatch[d].prevValue=m)}for(let d=0;d<this.variablesToWatch.length;d++){let{id:f,prevValue:p}=this.variablesToWatch[d],g=a.getVariable(f);g!==p&&(l.push(f),this.variablesToWatch[d].prevValue=g)}for(let d=0;d<this.dynamicVars.length;d++){let{id:f,expectedTime:p,last:g,data:m,timerSeconds:y,startValue:b}=this.dynamicVars[d],w=1e3;if((m.dynamicVariableType==="timer"||m.dynamicVariableType==="stopwatch")&&m.format==="number3decimal"?w=1:m.dynamicVariableType==="counter"?w=m.updateInterval:m.dynamicVariableType==="random"&&(w=m.isStatic?1/0:m.updateInterval),p===-1){this.dynamicVars[d].last=s,this.dynamicVars[d].expectedTime=s+w;continue}if(!((a.getDynamicVariablePlayState(f)==="Stopped"||a.getDynamicVariablePlayState(f)==="Restarted")&&(this.dynamicVars[d].last=s,this.dynamicVars[d].expectedTime=s+w,m.dynamicVariableType==="counter"&&a.getVariable(f)!==b&&(a.updateVariable(f,b),this.eventManager.requestRender()),(m.dynamicVariableType==="timer"||m.dynamicVariableType==="stopwatch")&&this.dynamicVars[d].timerSeconds!==b&&(this.dynamicVars[d].timerSeconds=b,a.updateVariable(f,hu.getFormattedTimerTime(b,m)),this.eventManager.requestRender()),a.getDynamicVariablePlayState(f)==="Restarted"&&a.setDynamicVariablePlayState(f,"Playing"),a.getDynamicVariablePlayState(f)==="Stopped"))){if(a.getDynamicVariablePlayState(f)==="Paused"){this.dynamicVars[d].deltaToExpectedTime===void 0&&(this.dynamicVars[d].deltaToExpectedTime=Math.max(this.dynamicVars[d].expectedTime-s,0)),this.dynamicVars[d].last=s-(w-this.dynamicVars[d].deltaToExpectedTime),this.dynamicVars[d].expectedTime=s+this.dynamicVars[d].deltaToExpectedTime;continue}else this.dynamicVars[d].deltaToExpectedTime=void 0;if(s>=p)if(this.dynamicVars[d].last=s,this.dynamicVars[d].expectedTime+=w,m.dynamicVariableType==="random"){let E=m.min+Math.random()*(m.max-m.min),M=m.decimals;E=Math.round(E*Math.pow(10,M))/Math.pow(10,M),a.updateVariable(f,E),l.push(f),this.eventManager.requestRender()}else if(m.dynamicVariableType==="counter"){let E=a.getVariable(f),M=a.getDynamicVariableToggleIsForward(f)??!0,A=a.getVariable(f)+m.increment*(M?1:-1);m.hasEnd&&(A=m.increment>0?Ht.clamp(A,b,m.endValue):Ht.clamp(A,m.endValue,b),A===b&&a.setDynamicVariableToggleIsForward(f,void 0),m.repeat?A===m.endValue&&(A=b):(A===b||A===m.endValue)&&a.setDynamicVariablePlayState(f,"Paused")),A!==E&&(l.push(f),a.updateVariable(f,A),this.eventManager.requestRender())}else if(m.dynamicVariableType==="time"){let E=a.getVariable(f),M=fte(o,m);if(typeof E=="object"&&"textValue"in E&&typeof M=="object"&&"textValue"in M){if(Array.isArray(E.textValue)&&Array.isArray(M.textValue)){if(E.textValue.every((A,P)=>A===M.textValue[P]))continue}else if(E.textValue===M.textValue)continue}else if(E===M)continue;a.updateVariable(f,M),l.push(f),this.eventManager.requestRender()}else{let E=xo.isTextValue(m.endValue)?Gie(m.endValue.textValue):m.endValue,M=a.getDynamicVariableToggleIsForward(f)??!0,A=y+(s-g)/1e3*(m.dynamicVariableType==="timer"?-1:1)*(M?1:-1);A=Math.max(A,0),m.hasEnd&&(A=m.dynamicVariableType==="stopwatch"?Ht.clamp(A,b,E):Ht.clamp(A,E,b),A===b&&a.setDynamicVariableToggleIsForward(f,void 0),m.repeat?Math.abs(A-E)<(m.format==="number3decimal"?1e-4:.1)&&(A=b):(Math.abs(A-b)<(m.format==="number3decimal"?1e-4:.1)||Math.abs(A-E)<(m.format==="number3decimal"?1e-4:.1))&&a.setDynamicVariablePlayState(f,"Paused")),A!==y&&(l.push(f),this.dynamicVars[d].timerSeconds=A,a.updateVariable(f,hu.getFormattedTimerTime(A,m)),this.eventManager.requestRender())}}}let u=!1;a.mouseProperty!==this.prevMouseProperty&&(this.prevMouseProperty=a.mouseProperty,u=!0);let h=!1;a.raycastProperty!==this.prevRaycastProperty&&(this.prevRaycastProperty=a.raycastProperty,h=!0),this.events.forEach(d=>{(l.includes(d.data.variableId)||c.find(f=>f.objId===d.data.objectId&&f.property===d.data.property)||d.data.variableId==="mouseProperty"&&u||d.data.variableId==="raycastProperty"&&h)&&(d.dispatch(),this.eventManager.requestRender())})},this.onBlur=()=>{this.pause()},this.onFocus=()=>{this.resume()}}pause(){this.isOutOfFocus||(this.isOutOfFocus=!0,this.pauseTime=Date.now())}resume(){if(!this.isOutOfFocus)return;this.isOutOfFocus=!1;let t=Date.now()-this.pauseTime;for(let e=0;e<this.dynamicVars.length;e++)this.dynamicVars[e].last+=t,this.dynamicVars[e].expectedTime+=t}connect(){this.eventContext.page.traverseEntity(e=>{e.data?.events.filter(i=>i.data.type==="VariableChange"&&!i.data.disabled).forEach(i=>{this.events.push(new Lpt(i.id,i.data,e,this.eventContext.page,this.eventContext.sharedAssets,this.eventManager))})}),this.propertiesToWatch=this.events.filter(e=>e.data.variableId==="objectProperty"&&e.data.objectId!==null).map(e=>({objectId:e.data.objectId,property:e.data.property,prevValue:null}));let t=this.eventContext.sharedAssets;this.sharedVariables.forEach(({id:e,data:i})=>{if(!("dynamicVariableType"in i)){this.events.find(n=>n.data.variableId===e)&&this.variablesToWatch.push({id:e,prevValue:t.getVariable(e)});return}let r;if(i.dynamicVariableType==="timer"||i.dynamicVariableType==="stopwatch"){let n;if(xo.isTextValue(i.value)&&Array.isArray(i.value.textValue)){let s=i.value.textValue;s.length===3?n=s[2]+s[1]*60+s[0]*3600:n=s[1]+s[0]*60}else n=i.value;r=n,this.dynamicVars.push({id:e,last:-1,expectedTime:-1,data:i,timerSeconds:n,startValue:r})}else i.dynamicVariableType==="time"&&t.updateVariable(e,fte(new Date,i)),i.dynamicVariableType==="counter"&&(r=xo.isTextValue(i.value)?Gie(i.value.textValue):i.value),this.dynamicVars.push({id:e,last:-1,expectedTime:-1,data:i,startValue:r})}),this.rafId=window.requestAnimationFrame(this.onFrame),window.addEventListener("blur",this.onBlur),window.addEventListener("focus",this.onFocus)}disconnect(){window.removeEventListener("blur",this.onBlur),window.removeEventListener("focus",this.onFocus),this.rafId&&(window.cancelAnimationFrame(this.rafId),this.rafId=void 0),this.events.forEach(t=>t.dispose())}},Lpt=class{constructor(t,e,i,r,n,s){this.id=t,this.data=e,this.object=i,this.actions=Xs(e,e.actions,r,n,s,i)}dispatch(){let t=this.actions;t.Audio.forEach(e=>e.dispatchConditional()),t.Particles.forEach(e=>e.dispatchConditional()),t.Video.forEach(e=>e.dispatchConditional()),t.Create.forEach(e=>e.dispatch()),t.Destroy.forEach(e=>e.dispatch()),t.Reset.forEach(e=>e.dispatch()),t.Transition.forEach(e=>{e.object.currentTransitionEvent!==this&&(e.object.currentTransitionEvent=this),e.init()}),t.Transition.forEach(e=>e.play()),t.Animation.forEach(e=>e.play()),t.SwitchCamera.forEach(e=>e.play()),t.SceneTransition.forEach(e=>e.dispatch()),t.SetVariable.forEach(e=>e.checkConditions()),t.SetVariable.forEach(e=>e.dispatch()),t.DynamicVariablePlay.forEach(e=>e.dispatch()),t.ClearLocalStorage.forEach(e=>e.dispatch()),t.UserAPI.forEach(e=>e.dispatch())}dispose(){Xa(this.actions)}};function Gie(t){return t.length===3?t[2]+t[1]*60+t[0]*3600:t[1]+t[0]*60}var kpt="https://unpkg.com/@splinetool/runtime@1.10.72/build/",Npt="https://unpkg.com/@splinetool/navmesh-wasm@1.10.72/build/",Upt=`
(async function() {
	const [wasmImport, wasmBinary] = await Promise.all([
		import('${kpt}' + 'navmesh.js'),
		fetch('${Npt}' + 'navmesh.wasm').then((res) => res.arrayBuffer()),
	]);
	const wasmModule = wasmImport.default;
	self.module = await wasmModule({ wasmBinary });
	postMessage('ready');
})();
`,Bpt=`
(async function() {
	const [wasmImport, wasmBinary] = await Promise.all([
		import(self.location.origin + '/_libraries/navmesh.js'),
		fetch(self.location.origin + '/_libraries/navmesh.wasm').then((res) => res.arrayBuffer()),
	]);
	const wasmModule = wasmImport.default;
	self.module = await wasmModule({ wasmBinary });
	postMessage('ready');
})();
`,Fpt=`

onmessage = function(messageEvent) {
	const meshData = messageEvent.data;
	const positions = meshData[0];
	const offset = meshData[1];
	const indices = meshData[2];
	const indicesLength = meshData[3];
	const parameters = meshData[4];

	const module = self.module;
	const rc = new module.rcConfig();
	rc.cs = parameters.cs;
	rc.ch = parameters.ch;
	rc.borderSize = parameters.borderSize ? parameters.borderSize : 0;
	rc.tileSize = parameters.tileSize ? parameters.tileSize : 0;
	rc.walkableSlopeAngle = parameters.walkableSlopeAngle;
	rc.walkableHeight = parameters.walkableHeight;
	rc.walkableClimb = parameters.walkableClimb;
	rc.walkableRadius = parameters.walkableRadius;
	rc.maxEdgeLen = parameters.maxEdgeLen;
	rc.maxSimplificationError = parameters.maxSimplificationError;
	rc.minRegionArea = parameters.minRegionArea;
	rc.mergeRegionArea = parameters.mergeRegionArea;
	rc.maxVertsPerPoly = parameters.maxVertsPerPoly;
	rc.detailSampleDist = parameters.detailSampleDist;
	rc.detailSampleMaxError = parameters.detailSampleMaxError;

	if (!self.navMesh) {
		self.navMesh = new module.NavMesh();
	}
	self.navMesh.build(positions, offset, indices, indicesLength, rc);

	const navmeshData = navMesh.getNavmeshData();
	const arrView = new Uint8Array(module.HEAPU8.buffer, navmeshData.dataPointer, navmeshData.size);
	const ret = new Uint8Array(navmeshData.size);
	ret.set(arrView);
	navMesh.freeNavmeshData(navmeshData);

	postMessage(ret);
}
`,zpt=.001,jpt={cs:6,ch:2,walkableSlopeAngle:90,walkableHeight:20,walkableClimb:5,walkableRadius:0,maxEdgeLen:12,maxSimplificationError:1.3,minRegionArea:8,mergeRegionArea:20,maxVertsPerPoly:6,detailSampleDist:6,detailSampleMaxError:1},hge,br,fo;Itt.then(t=>{hge=t,br=new t.Vec3,fo=new t.Vec3});var Vpt=new W,Hpt=class{constructor(t=!1,e=!1){this.usePhysics=t,this.isExport=e,this.onPointerDown=i=>{if(Di.length!==1)return;let{raycaster:r,page:n}=this.eventContext;this.eventContext.updateRaycaster(i);let s=n.raycastWithClones(r);if(s.length!==0){if(this.gameControl){let a=Vpt.copy(this.gameControl.colliderWorldPosition);a.y-=this.gameControl.colliderHeight/2,this.gameControl.path=this.computePath(a,s[0].point)}this.eventContext.requestRender()}},this.traverseWithPhysics=(i,r)=>n=>{let s;if(n instanceof vu)if(n.objectForSample){if(n.objectForSample.dataPatched.physics.fusedBody)return;s=n.object}else return n.object.dataPatched.physics.fusedBody===!0&&n.object.dataPatched.physics.rigidBody==="dynamic"?!0:void 0;else if(n instanceof bo)s=n.object;else if(s=n,s.dataPatched.cloner?.disabled===!1&&s.dataPatched.cloner?.hideBase&&s.dataPatched.physics?.fusedBody!==!0)return!0;if(r&&!s.userData.navmesh)return;let a=s.dataPatched;if(!a.visible&&a.physics?.enabled!==!0)return!0;n.updateMatrixWorldSVD();let o=q3(a),l=s.userData.hasDestroy,c=s.userData.hasDrag,u=!1,h=!1;for(let d of a.events)d.data.disabled!==!0&&(d.data.type==="GameControl"?u=!0:d.data.type==="Follow"&&(h=!0));if(u||o||h||l||c)return!0;if(this.usePhysics&&a.physics?.rigidBody==="dynamic"){if(this.usePhysics&&a.physics?.fusedBody)return!0}else if("geometry"in n&&n.geometry&&i.push(vp(n.geometry,n.matrixWorld)),this.usePhysics&&a.physics?.fusedBody)return n.traverseObject((d,f)=>{if(f===0)return;let p;if(d instanceof vu)if(d.objectForSample){if(d.objectForSample.dataPatched.physics.fusedBody)return;p=d.object}else return d.object.dataPatched.physics.fusedBody===!0&&d.object.dataPatched.physics.rigidBody==="dynamic"?!0:void 0;else if(d instanceof bo)p=d.object;else if(p=d,d.dataPatched.cloner?.hideBase)return!0;let g=p.dataPatched;if(!g.visible&&g.physics?.enabled!==!0)return!0;"geometry"in d&&d.geometry&&i.push(vp(d.geometry,d.matrixWorld))}),!0},this.traverseNoPhysics=(i,r)=>n=>{let s;if(n instanceof vu)return;n instanceof bo?s=n.object:s=n;let a=s.dataPatched;if(a.physics.enabled==="visibility"?!a.visible:!a.physics.enabled)return!0;if(r&&!s.userData.navmesh)return;let o=n.geometry,l=s.userData.hasDestroy===!0,c=s.userData.hasDrag===!0;if(q3(a)||l||c||s.dataPatched.events.some(u=>u.data.disabled!==!0&&u.data.type==="GameControl"))return!0;o&&i.push(vp(o,n.matrixWorld))},this.navmeshWasm=hge,this.navMesh=new this.navmeshWasm.NavMesh,this._workerURL=URL.createObjectURL(new Blob([(e?Upt:Bpt)+Fpt])),this._worker=new Worker(this._workerURL)}init(t,e,i){this.gameControl=e,this.eventContext=i,this.setDefaultQueryExtent(new W().setScalar(t.ch*t.walkableRadius*1.2)),this._worker.onmessage=()=>{this.createNavMesh(i.page,t,r=>{this.buildFromNavmeshData(r.data)})},this.eventContext.renderer.domElement.addEventListener("pointerdown",this.onPointerDown)}createNavMesh(t,e,i){e.objects.forEach(l=>{let c=t.scene.find(l);c.traverseEntity(u=>{u.userData.navmesh=!0}),c.cloner?.traverseObject(u=>{u.userData.navmesh=!0})});let r=[],n=(this.usePhysics?this.traverseWithPhysics:this.traverseNoPhysics)(r,e.zones==="custom");if(t.traverseChildren(n),e.objects.forEach(l=>{let c=t.scene.find(l);c.traverseEntity(u=>{u.userData.navmesh=void 0}),c.cloner?.traverseObject(u=>{u.userData.navmesh=void 0})}),r.length===0)return!1;let s=n0(r),{positions:a,triIndices:o}=CL(s.getAttribute("position"),s.getIndex());return this._worker.postMessage([a,a.length/3,o,o.length,{...jpt,...e}]),this._worker.onmessage=i,!0}createDebugNavGeometry(){let t,e,i=this.navMesh.getDebugNavMesh(),r=i.getTriangleCount(),n=new Uint32Array(r*3),s=new Float32Array(r*3*3);for(t=0;t<r*3;t++)n[t]=t;for(t=0;t<r;t++)for(e=0;e<3;e++){let o=i.getTriangle(t).getPoint(e);s[t*9+e*3+0]=o.x,s[t*9+e*3+1]=o.y,s[t*9+e*3+2]=o.z}let a=new oi;return a.setIndex(new Mi(n,1)),a.setAttribute("position",new Mi(s,3)),a}getClosestPoint(t){return br.x=t.x,br.y=t.y,br.z=t.z,this.navMesh.getClosestPoint(br)}getClosestPointToRef(t,e){br.x=t.x,br.y=t.y,br.z=t.z;let i=this.navMesh.getClosestPoint(br);e.set(i.x,i.y,i.z)}getRandomPointAround(t,e){return br.x=t.x,br.y=t.y,br.z=t.z,this.navMesh.getRandomPointAround(br,e)}getRandomPointAroundToRef(t,e,i){br.x=t.x,br.y=t.y,br.z=t.z;let r=this.navMesh.getRandomPointAround(br,e);i.set(r.x,r.y,r.z)}moveAlong(t,e){return br.x=t.x,br.y=t.y,br.z=t.z,fo.x=e.x,fo.y=e.y,fo.z=e.z,this.navMesh.moveAlong(br,fo)}moveAlongToRef(t,e,i){return br.x=t.x,br.y=t.y,br.z=t.z,fo.x=e.x,fo.y=e.y,fo.z=e.z,this.navMesh.moveAlong(br,fo)}computePath(t,e){let i=this.getClosestPoint(e);if(fo.x=i.x,fo.y=i.y,fo.z=i.z,Math.sqrt(Math.pow(e.x-i.x,2)+Math.pow(e.y-i.y,2)+Math.pow(e.z-i.z,2))>this.getDefaultQueryExtent().y)return[];this.getClosestPoint(t);let r=this.navMesh.computePath(br,fo),n=r.getPointCount(),s=[];for(let a=0;a<n;a++){let o=r.getPoint(a);s.push(new W(o.x,o.y,o.z))}return s}createCrowd(t,e){return new Gpt(this,t,e)}setDefaultQueryExtent(t){br.x=t.x,br.y=t.y,br.z=t.z,this.navMesh.setDefaultQueryExtent(br)}getDefaultQueryExtent(){return this.navMesh.getDefaultQueryExtent()}buildFromNavmeshData(t){let e=t.length*t.BYTES_PER_ELEMENT,i=this.navmeshWasm._malloc(e),r=new Uint8Array(this.navmeshWasm.HEAPU8.buffer,i,e);r.set(t);let n=new this.navmeshWasm.NavmeshData;n.dataPointer=r.byteOffset,n.size=t.length,this.navMesh.buildFromNavmeshData(n),this.navmeshWasm._free(r.byteOffset)}getNavmeshData(){let t=this.navMesh.getNavmeshData(),e=new Uint8Array(this.navmeshWasm.HEAPU8.buffer,t.dataPointer,t.size),i=new Uint8Array(t.size);return i.set(e),this.navMesh.freeNavmeshData(t),i}getDefaultQueryExtentToRef(t){let e=this.navMesh.getDefaultQueryExtent();t.set(e.x,e.y,e.z)}dispose(){this.navMesh.destroy(),this._worker.terminate(),URL.revokeObjectURL(this._workerURL),this.eventContext?.renderer.domElement.removeEventListener("pointerdown",this.onPointerDown)}addCylinderObstacle(t,e,i){return br.x=t.x,br.y=t.y,br.z=t.z,this.navMesh.addCylinderObstacle(br,e,i)}addBoxObstacle(t,e,i){return br.x=t.x,br.y=t.y,br.z=t.z,fo.x=e.x,fo.y=e.y,fo.z=e.z,this.navMesh.addBoxObstacle(br,fo,i)}removeObstacle(t){this.navMesh.removeObstacle(t)}isSupported(){return this.navmeshWasm!==void 0}},Gpt=class{constructor(t,e,i){this.navmeshWasmWrapper=t,this.transforms=[],this.agents=new Array,this.reachRadii=new Array,this._agentDestinationArmed=new Array,this._agentDestination=new Array,this.crowd=new this.navmeshWasmWrapper.navmeshWasm.Crowd(e,i,this.navmeshWasmWrapper.navMesh.getNavMesh())}onReachTarget(t,e){}addAgent(t,e,i){let r=new this.navmeshWasmWrapper.navmeshWasm.dtCrowdAgentParams;r.radius=e.radius,r.height=e.height,r.maxAcceleration=e.maxAcceleration,r.maxSpeed=e.maxSpeed,r.collisionQueryRange=e.collisionQueryRange,r.pathOptimizationRange=e.pathOptimizationRange,r.separationWeight=e.separationWeight,r.updateFlags=7,r.obstacleAvoidanceType=0,r.queryFilterType=0,r.userData=0;let n=this.crowd.addAgent(new this.navmeshWasmWrapper.navmeshWasm.Vec3(t.x,t.y,t.z),r);return this.transforms.push(i),this.agents.push(n),this.reachRadii.push(e.reachRadius?e.reachRadius:e.radius),this._agentDestinationArmed.push(!1),this._agentDestination.push(new W(0,0,0)),n}getAgentPosition(t){return this.crowd.getAgentPosition(t)}getAgentPositionToRef(t,e){let i=this.crowd.getAgentPosition(t);e.set(i.x,i.y,i.z)}getAgentVelocity(t){return this.crowd.getAgentVelocity(t)}getAgentVelocityToRef(t,e){let i=this.crowd.getAgentVelocity(t);e.set(i.x,i.y,i.z)}getAgentNextTargetPath(t){return this.crowd.getAgentNextTargetPath(t)}getAgentNextTargetPathToRef(t,e){let i=this.crowd.getAgentNextTargetPath(t);e.set(i.x,i.y,i.z)}getAgentState(t){return this.crowd.getAgentState(t)}overOffmeshConnection(t){return this.crowd.overOffmeshConnection(t)}agentGoto(t,e){this.crowd.agentGoto(t,new this.navmeshWasmWrapper.navmeshWasm.Vec3(e.x,e.y,e.z));let i=this.agents.indexOf(t);i>-1&&(this._agentDestinationArmed[i]=!0,this._agentDestination[i].set(e.x,e.y,e.z))}agentTeleport(t,e){this.crowd.agentTeleport(t,new this.navmeshWasmWrapper.navmeshWasm.Vec3(e.x,e.y,e.z))}updateAgentParameters(t,e){let i=this.crowd.getAgentParameters(t);e.radius!==void 0&&(i.radius=e.radius),e.height!==void 0&&(i.height=e.height),e.maxAcceleration!==void 0&&(i.maxAcceleration=e.maxAcceleration),e.maxSpeed!==void 0&&(i.maxSpeed=e.maxSpeed),e.collisionQueryRange!==void 0&&(i.collisionQueryRange=e.collisionQueryRange),e.pathOptimizationRange!==void 0&&(i.pathOptimizationRange=e.pathOptimizationRange),e.separationWeight!==void 0&&(i.separationWeight=e.separationWeight),this.crowd.setAgentParameters(t,i)}removeAgent(t){this.crowd.removeAgent(t);let e=this.agents.indexOf(t);e>-1&&(this.agents.splice(e,1),this.transforms.splice(e,1),this.reachRadii.splice(e,1),this._agentDestinationArmed.splice(e,1),this._agentDestination.splice(e,1))}getAgents(){return this.agents}update(t){if(this.navmeshWasmWrapper.navMesh.update(),t<=zpt)return;let e=1/60,i=10;{let r=Math.floor(t/e);r>i&&(r=i),r<1&&(r=1);let n=t/r;for(let s=0;s<r;s++)this.crowd.update(n)}for(let r=0;r<this.agents.length;r++){let n=this.agents[r],s=this.getAgentPosition(n);if(this.transforms[r].copy(s),this._agentDestinationArmed[r]){let a=s.x-this._agentDestination[r].x,o=s.z-this._agentDestination[r].z,l=this.reachRadii[r],c=this._agentDestination[r].y-this.reachRadii[r],u=this._agentDestination[r].y+this.reachRadii[r],h=a*a+o*o;s.y>c&&s.y<u&&h<l*l&&(this.onReachTarget(n,this._agentDestination[r]),this._agentDestinationArmed[r]=!1)}}}setDefaultQueryExtent(t){let e=new this.navmeshWasmWrapper.navmeshWasm.Vec3(t.x,t.y,t.z);this.crowd.setDefaultQueryExtent(e)}getDefaultQueryExtent(){return this.crowd.getDefaultQueryExtent()}getDefaultQueryExtentToRef(t){let e=this.crowd.getDefaultQueryExtent();t.set(e.x,e.y,e.z)}getCorners(t){let e,i=this.crowd.getCorners(t),r=i.getPointCount(),n=[];for(e=0;e<r;e++){let s=i.getPoint(e);n.push(new W(s.x,s.y,s.z))}return n}dispose(){this.crowd.destroy()}};function Wpt(t){let e=!1;return t.scene.objects.forEach(i=>{i.data.type==="Page"&&!e&&i.data.publish.gameControlObject&&VM.traverseModuleInstances(t,i.id,(r,n,s)=>{for(let a of s)a.data.type==="GameControl"&&a.data.navmesh.enabled&&(e=!0)})}),e}var qpt={type:"change"},Wie={type:"changeZoom"},Xpt={type:"changePan"},Iy={type:"start"},yw={type:"end",changed:!0,nonOrbit:!0},$pt={type:"end",changed:!0,nonOrbit:!1},Ypt={type:"end",changed:!1},A4=new Ii,qie=new Ae,Kpt=2*Math.PI,Zpt=1e-8,Qpt=.01,M4=new W,LR=new Ae,T4=new W,kR=new Ii,Xie=new St,Jpt={type:"requestRender"},dge=class extends Qa{constructor(t,e,i={isPlayMode:!1,isExport:!1}){super(),this.object=t,this.domElement=e,this.options=i,this.enabled=!0,this.useKeyEvents=!0,this.enableDamping=!1,this.enableZoom=!0,this.enableRotate=!0,this.enablePan=!0,this.autoRotate=!1,this.rotationLimitsMode=0,this.panLimitsMode=0,this.rotationSoftLimit=2,this.panSoftLimit=2,this.hoverRotatePanMode=0,this.zoomLimitsEnabled=!1,this.mouseButtons=[0,5],this.mouseButtonsPlay=[3,4,5],this.touches=[null,Jc.DOLLY_ROTATE,Jc.PAN],this.offset=new W,this.eye=new W,this.lastPosition=new W,this.lastQuaternion=new Ii,this.current=new Ae,this.overShoot=new Ae,this.overRatio=new Ae,this.spherical=new mQ,this.sphericalDelta=new mQ,this.panOffset=new W,this.panLeftV=new W,this.panUpV=new W,this.panV=new W,this.rotateStart=new Ae,this.rotateEnd=new Ae,this.rotateDelta=new Ae,this.panStart=new Ae,this.panEnd=new Ae,this.panDelta=new Ae,this.dollyStart=new Ae,this.dollyEnd=new Ae,this.dollyDelta=new Ae,this.rotationRangeFactor=new Ae,this.panRangeFactor=new Ae,this.state=-1,this.zoomChanged=!1,this.isPointerDown=!1,this.isThetaFlipped=!1,this.prevScale=0,this.scale=1,this.gesture=!1,this.timer=-1,this.timerHover=-1,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minPhi=0,this.maxPhi=Math.PI,this.minTheta=-1/0,this.maxTheta=1/0,this.minH=0,this.maxH=Math.PI,this.minV=-1/0,this.maxV=1/0,this.autoRotateClockwise=!0,this.isPanOverShoot=!1,this.isRotateOverShoot=!1,this.resetHoverEffectOnPointerLeave=!1,this.hasChange=!1,this.useWindowEvents=!1,this.isTouchZoom=!0,this.autoRotateSpeed=2,this.dampingFactor=.125,this.zoomSpeed=2,this.rotateSpeed=1,this.panSpeed=1,this.hoverRotatePanStrength=.1,this.hoverRotateDamping=this.dampingFactor,this.isCurrentlyDamping=!1,this.thetaIsFree=!1,this.phiIsFree=!1,this.needsUpdate=!0,this.onCameraChange=r=>{this.object.removeEventListener("beginState",this.onBeginState),this.object.removeEventListener("completeState",this.onCompleteState),this.object.removeEventListener("cameraChange",this.onCameraChange),this.object=r.camera,this.object.addEventListener("beginState",this.onBeginState),this.object.addEventListener("completeState",this.onCompleteState),this.object.addEventListener("cameraChange",this.onCameraChange)},this.update=()=>{this.object.updateWorldMatrix(!0,!1),this.object.matrixWorld.decompose(T4,kR,M4),this.offset.copy(T4).sub(this.target),this.spherical.setFromVector3(this.offset),this.object.isUpVectorFlipped&&(this.spherical.phi*=-1,this.spherical.theta-=Math.PI),this.autoRotate&&this.state===-1&&this.rotateLeft((this.autoRotateClockwise===!0?1:-1)*this.getAutoRotationAngle()),this.rotationLimitsMode!==0&&this.applyLimits(this.sphericalDelta,this.rotationLimitsMode,this.rotationSoftLimit,this.maxTheta,this.minTheta,this.maxPhi,this.minPhi,this.rotationRangeFactor),this.rotationLimitsMode!==2&&(this.spherical.phi+=this.sphericalDelta.phi),(this.rotationLimitsMode!==1||this.autoRotate===!0)&&(this.spherical.theta+=this.sphericalDelta.theta),this.spherical.radius*=this.scale,this.zoomLimitsEnabled&&this.object.isPerspectiveCamera&&(this.spherical.radius=Math.max(this.minDistance,Math.min(this.maxDistance,this.spherical.radius))),this.panLimitsMode!==0&&(this.target.applyQuaternion(A4.copy(kR).invert()),this.panOffset.applyQuaternion(A4),this.applyLimits(this.panOffset,this.panLimitsMode,this.panSoftLimit,this.maxH,this.minH,this.maxV,this.minV,this.panRangeFactor),this.target.applyQuaternion(kR),this.panOffset.applyQuaternion(kR)),this.panLimitsMode===2&&(this.panOffset.y=0),this.panLimitsMode===1&&(this.panOffset.x=0),this.state===-1&&!this.gesture?(this.panOffset.multiplyScalar(1-this.dampingFactor),this.target.add(this.panOffset)):(this.target.add(this.panOffset),this.panOffset.set(0,0,0)),this.offset.setFromSpherical(this.spherical),T4.copy(this.target).add(this.offset),this.object.position.copy(this.target).add(this.offset),this.object.parent&&(Xie.copy(this.object.parent.matrixWorld).invert(),this.object.position.applyMatrix4(Xie));let r=this.spherical.phi%Kpt;if(this.eye.copy(this.offset).normalize(),this.object.up.copy(tn.DEFAULT_UP).applyAxisAngle(this.eye,this.object.angleOffsetFromUp),r>0&&r>Math.PI||r<0&&r>-Math.PI?(this.object.up.negate(),this.object.lookAt(this.target),this.object.isUpVectorFlipped=!0):(this.object.lookAt(this.target),this.object.isUpVectorFlipped=!1),this.state===-1||this.enableDamping===!0){let n=this.hoverRotatePanMode===1?this.hoverRotateDamping:this.dampingFactor;this.sphericalDelta.theta*=1-n,this.sphericalDelta.phi*=1-n}else this.sphericalDelta.set(0,0,0);if(this.scale=1,this.zoomChanged||this.lastPosition.distanceToSquared(this.object.position)>Qpt||8*(1-this.lastQuaternion.dot(this.object.quaternion))>Zpt){this.dispatchEvent(qpt),this.object.dispatchEvent(Jpt),this.lastPosition.copy(this.object.position),this.lastQuaternion.copy(this.object.quaternion),this.zoomChanged=!1,this.isCurrentlyDamping=!0;return}this.isPanOverShoot=!1,this.isRotateOverShoot=!1,this.object.wasMovedBySwitchCameraAction=!1,this.sphericalDelta.set(0,0,0),this.panOffset.set(0,0,0),this.isCurrentlyDamping=!1},this.onPointerDown=r=>{this.enabled!==!1&&(r.pointerType==="touch"||r.pointerType==="pen"&&Pc?this.onPointerDownTouch(r):this.onPointerDownMouse(r),this.state!==-1&&(this.isPointerDown=!0,this.dispatchEvent(Iy),this.domElement.addEventListener("pointermove",this.onPointerMove),this.domElement.addEventListener("pointerup",this.onPointerUp),r.stopPropagation(),r.pointerType==="touch"||r.pointerType==="pen"&&Pc||this.domElement.setPointerCapture(r.pointerId)))},this.onPointerLeave=r=>{this.resetHoverEffectOnPointerLeave&&!this.useWindowEvents?(this.hoverRotatePanMode===1?(this.sphericalDelta.theta=-this.spherical.theta,this.sphericalDelta.phi=-this.spherical.phi,M4.subVectors(this.position0,this.target0),this.spherical.setFromVector3(M4),this.sphericalDelta.theta+=this.spherical.theta,this.sphericalDelta.phi+=this.spherical.phi,this.sphericalDelta.theta/=8,this.sphericalDelta.phi/=8):this.hoverRotatePanMode===2&&this.panOffset.subVectors(this.target0,this.target).divideScalar(8),this.update()):this.pointerLeaveEvent=r},this.onPointerEnter=r=>{this.resetHoverEffectOnPointerLeave||this.pointerLeaveEvent===void 0?LR.set(r.clientX-this.domElement.clientWidth/2,r.clientY-this.domElement.clientHeight/2):LR.set(r.clientX-this.pointerLeaveEvent.clientX,r.clientY-this.pointerLeaveEvent.clientY),this.hoverRotatePanMode===1?(this.rotateDelta.copy(LR).multiplyScalar(this.rotateSpeed*this.hoverRotatePanStrength).rotateAround(qie,-this.object.angleOffsetFromUp),this.rotateLeft(2*Math.PI*this.rotateDelta.x/this.domElement.clientHeight),this.rotateUp(2*Math.PI*this.rotateDelta.y/this.domElement.clientHeight),this.rotateStart.set(r.clientX,r.clientY)):this.hoverRotatePanMode===2&&(this.panDelta.copy(LR).multiplyScalar(this.panSpeed*this.hoverRotatePanStrength),this.pan(this.panDelta.x,this.panDelta.y),this.panStart.set(r.clientX,r.clientY)),this.update()},this.onPointerMove=r=>{this.enabled!==!1&&(this.checkRaycastLock()||(r.pointerType==="touch"||r.pointerType==="pen"&&Pc?this.onPointerMoveTouch(r):this.onPointerMoveMouse(r),r.stopPropagation()))},this.onPointerUp=r=>{this.isPointerDown=!1,Di.length===0&&(this.domElement.removeEventListener("pointermove",this.onPointerMove),this.domElement.removeEventListener("pointerup",this.onPointerUp)),Di.length>1&&r.preventDefault(),this.hasChange?this.dispatchEvent(this.state===0?$pt:yw):this.dispatchEvent(Ypt),this.state=-1,r&&(r.stopPropagation(),r.pointerType==="touch"||r.pointerType==="pen"&&Pc||this.domElement.releasePointerCapture(r.pointerId))},this.onPointerDownMouse=r=>{let n;switch(this.useKeyEvents?n=this.mouseButtons[r.button]:n=this.mouseButtonsPlay[r.button],n){case 0:if(r.altKey===!0&&!r.shiftKey&&!WP(r)){if(this.enableRotate===!1)return;this.handleMouseDownRotate(r),this.state=0}else if(this.key===" "){if(this.enablePan===!1)return;this.handleMouseDownPan(r),this.state=2}break;case 4:if(this.enablePan===!1)return;this.handleMouseDownPan(r),this.state=2;break;case 3:if(WP(r)||r.shiftKey){if(this.enablePan===!1)return;this.handleMouseDownPan(r),this.state=2}else{if(this.enableRotate===!1)return;this.handleMouseDownRotate(r),this.state=0}break;case 5:if(WP(r)||r.shiftKey){if(this.enableRotate===!1)return;this.handleMouseDownRotate(r),this.state=0}else{if(this.enablePan===!1)return;this.handleMouseDownPan(r),this.state=2}break;default:this.state=-1}},this.onPointerMoveMouse=r=>{switch(this.state){case 0:if(this.enableRotate===!1)return;this.handleMouseMoveRotate(r);break;case 1:if(this.enableZoom===!1)return;this.handleMouseMoveDolly(r);break;case 2:if(this.enablePan===!1)return;this.handleMouseMovePan(r);break}this.object.wasMovedByUser=!0},this.onPointerDownTouch=r=>{switch(Di.length>1&&r.preventDefault(),this.touches[Di.length-1]){case Jc.ROTATE:if(this.enableRotate===!1){this.state=-1;return}this.handleTouchStartRotate(),this.state=3;break;case Jc.PAN:if(this.enablePan===!1){this.state=-1;return}this.handleTouchStartPan(),this.state=4;break;case Jc.DOLLY_PAN:if(this.enableZoom===!1&&this.enablePan===!1)return;this.handleTouchStartDollyPan(),this.state=5;break;case Jc.DOLLY_ROTATE:if(this.enableZoom===!1&&this.enableRotate===!1)return;this.handleTouchStartDollyRotate(),this.state=6;break;default:this.state=-1}},this.onPointerMoveTouch=r=>{switch(Di.length>1&&r.preventDefault(),this.state){case 3:if(this.enableRotate===!1)return;this.handleTouchMoveRotate(r),this.update();break;case 4:if(this.enablePan===!1)return;this.handleTouchMovePan(r),this.update();break;case 5:if(this.enableZoom===!1&&this.enablePan===!1)return;this.handleTouchMoveDollyPan(r),this.update();break;case 6:if(this.enableZoom===!1&&this.enableRotate===!1)return;this.handleTouchMoveDollyRotate(r),this.update();break;default:this.state=-1}this.object.wasMovedByUser=!0},this.dispatchEndDebounced=NM(()=>this.dispatchEvent(yw),33),this.onMouseWheel=r=>{this.enabled===!1||this.enableZoom===!1&&this.enablePan===!1||this.checkRaycastLock()||(!this.options.isExport&&this.domElement.clientHeight===document.body.clientHeight&&this.domElement.clientWidth===document.body.clientWidth&&r.preventDefault(),this.dispatchEvent(Iy),this.handleMouseWheel(r),this.dispatchEndDebounced(),this.object.wasMovedByUser=!0)},this.onGesture=r=>{if(r.preventDefault(),this.enabled!==!1&&!this.checkRaycastLock()&&!L_)if(r.type==="gesturechange"){if(this.enableZoom===!1||this.isTouchZoom===!1)return;this.dispatchEvent(Iy),r.scale>this.prevScale?this.dollyIn(this.getZoomScale()):r.scale<this.prevScale&&this.dollyOut(this.getZoomScale()),this.prevScale=r.scale,this.update(),this.object.wasMovedByUser=!0}else this.dispatchEvent({type:"end",nonOrbit:!0})},this.onContextMenu=r=>{r.preventDefault()},this.onTouchEnd=r=>{r.preventDefault()},this.onKeyDown=r=>{this.enabled!==!1&&(this.key=r.key,r.key===" "&&this.dispatchEvent(Iy))},this.onKeyUp=r=>{this.enabled!==!1&&(this.key=void 0,this.state!==-1&&r.key==="Alt"&&this.onPointerUp(Di[0]),r.key===" "&&this.dispatchEvent({type:"end",nonOrbit:!0}))},this.onPointerHover=r=>{r.pointerType!=="mouse"||this.enabled===!1||this.state!==-1||this.hoverRotatePanMode===2&&this.isPanOverShoot||this.hoverRotatePanMode===1&&this.isRotateOverShoot||(this.isPointerDown=!0,this.hoverRotatePanMode===2?this.handleMouseMovePan(r,this.hoverRotatePanStrength):this.hoverRotatePanMode===1&&this.handleMouseMoveRotate(r,this.hoverRotatePanStrength))},this.onBeginState=()=>{this.enabled=!1,this.needsUpdate=!1},this.onCompleteState=r=>{r.isfromEntity&&this.options.isPlayMode||(this.enabled=!0,this.needsUpdate=!0,this.object.updateUp(),this.object.getTarget(this.target))},this.target=this.object.getTarget(),this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this.quat0=this.object.quaternion.clone(),this.isUpVectorFlipped0=this.object.isUpVectorFlipped,this.offset.copy(this.object.position).sub(this.target),this.spherical.setFromVector3(this.offset),this.object.isUpVectorFlipped&&(this.spherical.phi*=-1,this.spherical.theta-=Math.PI),this.initialSphericalRadius=this.spherical.radius,this.addEventListenersToCamera()}dispatchEvent(t){t.type==="start"?this.hasChange=!1:this.hasChange=!0,super.dispatchEvent(t)}addEventListenersToCamera(){this.object.addEventListener("beginState",this.onBeginState),this.object.addEventListener("completeState",this.onCompleteState),this.object.addEventListener("cameraChange",this.onCameraChange)}removeEventListenersFromCamera(){this.object.removeEventListener("beginState",this.onBeginState),this.object.removeEventListener("completeState",this.onCompleteState),this.object.removeEventListener("cameraChange",this.onCameraChange)}updateUseWindowEvents(t){if(window.removeEventListener("pointermove",this.onPointerHover),this.domElement.removeEventListener("pointermove",this.onPointerHover),this.useWindowEvents=t,this.hoverRotatePanMode!==0&&(this.useWindowEvents?window.addEventListener("pointermove",this.onPointerHover):this.domElement.addEventListener("pointermove",this.onPointerHover)),this.domElement.removeEventListener("pointerleave",this.onPointerLeave),this.domElement.removeEventListener("pointerenter",this.onPointerEnter),window.removeEventListener("pointerleave",this.onPointerLeave),window.removeEventListener("pointerenter",this.onPointerEnter),this.hoverRotatePanMode!==0&&!this.useWindowEvents){let e=this.useWindowEvents?window:this.domElement;e.addEventListener("pointerleave",this.onPointerLeave),e.addEventListener("pointerenter",this.onPointerEnter)}}fromJSON(t,e){this.setEnableDampingSpeed(t.enableDamping),this.enablePan=t.enablePan,this.enableZoom=t.enableZoom,this.enableRotate=t.enableRotate,this.rotationLimitsMode=t.rotationLimitsMode,this.thetaIsFree=t.rotationHorizontalOffset.min===t.rotationHorizontalOffset.max&&t.rotationHorizontalOffset.min===Math.PI,this.phiIsFree=t.rotationVerticalOffset.min===t.rotationVerticalOffset.max&&t.rotationVerticalOffset.min===Math.PI,this.panLimitsMode=t.panLimitsMode,this.panSoftLimit=t.panSoftLimit,this.rotationSoftLimit=t.rotationSoftLimit,this.hoverRotatePanMode=t.hoverRotatePanMode,this.hoverRotateDamping=t.hoverRotateDamping??this.dampingFactor,this.useWindowEvents=e==="window",this.hoverRotatePanMode!==0&&(this.useWindowEvents?window.addEventListener("pointermove",this.onPointerHover):this.domElement.addEventListener("pointermove",this.onPointerHover));let i=t.hoverRotatePanStrength/100;this.hoverRotatePanStrength=i**2,this.zoomLimitsEnabled=t.zoomLimitsEnabled,this.minZoom=t.zoomLimits.min,this.maxZoom=Math.max(t.zoomLimits.min,t.zoomLimits.max),this.minDistance=1e3/this.maxZoom,this.maxDistance=Math.max(this.minDistance,1e3/t.zoomLimits.min),this.autoRotate=t.autoRotate,this.autoRotateSpeed=t.autoRotateSpeed,this.autoRotateClockwise=t.autoRotateClockwise;let r=this.object.getTarget().applyQuaternion(A4.copy(this.object.quaternion).invert());this.minV=-t.panVerticalOffset.min+r.y,this.maxV=t.panVerticalOffset.max+r.y,this.minH=-t.panHorizontalOffset.min+r.x,this.maxH=t.panHorizontalOffset.max+r.x,this.panRangeFactor.set(this.maxH-this.minH,this.maxV-this.minV).divideScalar(2),this.rotationRangeFactor.setScalar(Math.PI).divideScalar(4),this.minPhi=pd(this.spherical.phi-t.rotationVerticalOffset.min),this.maxPhi=pd(this.spherical.phi+t.rotationVerticalOffset.max),this.minTheta=pd(pd(this.spherical.theta)-t.rotationHorizontalOffset.min),this.maxTheta=pd(pd(this.spherical.theta)+t.rotationHorizontalOffset.max),this.isThetaFlipped=this.minTheta>this.maxTheta,t.orbitTouches===1&&(this.touches[0]=Jc.ROTATE),t.panTouches===1&&(this.touches[0]=Jc.PAN),t.orbitTouches===2&&(this.touches[1]=Jc.DOLLY_ROTATE),t.panTouches===2&&(this.touches[1]=Jc.DOLLY_PAN),t.orbitTouches===3&&(this.touches[2]=Jc.ROTATE),t.panTouches===3&&(this.touches[2]=Jc.PAN),this.isTouchZoom=t.isTouchZoom,this.resetHoverEffectOnPointerLeave=t.resetHoverEffectOnPointerLeave??!1}connect(){if(this.domElement.addEventListener("contextmenu",this.onContextMenu),this.domElement.addEventListener("pointerdown",this.onPointerDown),this.domElement.addEventListener("wheel",this.onMouseWheel),window.addEventListener("keydown",this.onKeyDown,!1),window.addEventListener("keyup",this.onKeyUp,!1),this.domElement.addEventListener("gesturestart",this.onGesture),this.domElement.addEventListener("gesturechange",this.onGesture),this.domElement.addEventListener("gestureend",this.onGesture),this.domElement.addEventListener("touchend",this.onTouchEnd),this.hoverRotatePanMode!==0&&!this.useWindowEvents){let t=this.useWindowEvents?window:this.domElement;t.addEventListener("pointerleave",this.onPointerLeave),t.addEventListener("pointerenter",this.onPointerEnter)}this.pointerLeaveEvent=void 0}dispose(){this.removeEventListenersFromCamera(),this.domElement.removeEventListener("contextmenu",this.onContextMenu),this.domElement.removeEventListener("pointerdown",this.onPointerDown),this.domElement.removeEventListener("wheel",this.onMouseWheel),window.removeEventListener("keydown",this.onKeyDown,!1),window.removeEventListener("keyup",this.onKeyUp,!1),this.domElement.removeEventListener("pointermove",this.onPointerHover),window.removeEventListener("pointermove",this.onPointerHover),this.domElement.removeEventListener("gesturestart",this.onGesture),this.domElement.removeEventListener("gesturechange",this.onGesture),this.domElement.removeEventListener("gestureend",this.onGesture),this.domElement.removeEventListener("touchend",this.onTouchEnd),this.domElement.removeEventListener("pointerleave",this.onPointerLeave),this.domElement.removeEventListener("pointerenter",this.onPointerEnter),window.removeEventListener("pointerleave",this.onPointerLeave),window.removeEventListener("pointerenter",this.onPointerEnter),this.domElement.removeEventListener("pointermove",this.onPointerMove),this.domElement.removeEventListener("pointerup",this.onPointerUp)}applyLimits(t,e,i,r,n,s,a,o){this.overShoot.set(0,0);let l,c,u;t instanceof W?(l=t.x,c=t.y,this.current.set(this.target.x,this.target.y),u=!0):(l=t.theta,c=t.phi,this.current.set(pd(this.spherical.theta),pd(this.spherical.phi)),u=!1),i===0&&(this.current.x+=l,this.current.y+=c),(e===3||e===2)&&(!u&&this.isThetaFlipped?this.current.x>r&&this.current.x<0?this.overShoot.x=r-this.current.x:this.current.x<n&&this.current.x>0&&(this.overShoot.x=n-this.current.x):this.current.x>r?this.overShoot.x=r-this.current.x:this.current.x<n&&(this.overShoot.x=n-this.current.x)),(e===3||e===1)&&(this.current.y>s?this.overShoot.y=s-this.current.y:this.current.y<a&&(this.overShoot.y=a-this.current.y)),u||(this.overShoot.x=pd(this.overShoot.x),this.overShoot.y=pd(this.overShoot.y)),i!==0?(this.overRatio.copy(this.overShoot).divide(o),this.overRatio.x=Math.min(Math.abs(this.overRatio.x),1),this.overRatio.y=Math.min(Math.abs(this.overRatio.y),1),i===1&&(this.overRatio.x=$ie(Math.abs(this.overRatio.x)),this.overRatio.y=$ie(Math.abs(this.overRatio.y))),this.isPointerDown||i===1?i===2&&(this.overRatio.x>.9&&!this.thetaIsFree||this.overRatio.y>.9&&!this.phiIsFree)?this.isPointerDown=!1:(l*this.overShoot.x<0&&!this.thetaIsFree&&(l*=1-this.overRatio.x),c*this.overShoot.y<0&&!this.phiIsFree&&(c*=1-this.overRatio.y)):i===2&&(!u&&(this.overRatio.x>.002&&!this.thetaIsFree||this.overRatio.y>.002&&!this.phiIsFree)||u&&(Math.abs(this.overShoot.x)>2||Math.abs(this.overShoot.y)>2)?(this.thetaIsFree||(l=this.overShoot.x*.05),this.phiIsFree||(c=this.overShoot.y*.05),u?this.isPanOverShoot=!0:this.isRotateOverShoot=!0):u?this.isPanOverShoot=!1:this.isRotateOverShoot=!1)):(l+=this.overShoot.x,c+=this.overShoot.y),t instanceof W?(t.x=l,t.y=c):(this.thetaIsFree||(t.theta=l),this.phiIsFree||(t.phi=c))}setEnableDampingSpeed(t){this.enableDamping=t,this.rotateSpeed=t===!0?.2:1}stopDamping(){this.sphericalDelta.theta=0,this.sphericalDelta.phi=0}getAutoRotationAngle(){return 2*Math.PI/60/60*this.autoRotateSpeed}getZoomScale(){return Math.pow(.95,this.zoomSpeed)}rotateLeft(t){this.sphericalDelta.theta-=t}rotateUp(t){this.sphericalDelta.phi-=t}panLeft(t,e){this.panLeftV.setFromMatrixColumn(e,0),this.panLeftV.multiplyScalar(-t),this.panOffset.add(this.panLeftV)}panUp(t,e){this.panUpV.setFromMatrixColumn(e,1),this.panUpV.multiplyScalar(t),this.panOffset.add(this.panUpV)}pan(t,e){let i=this.domElement;if(i&&this.object.isPerspectiveCamera){let r=this.object.position;this.panV.copy(r).sub(this.target);let n=this.panV.length();n*=Math.tan(this.object.fov/2*Math.PI/180),this.panLeft(2*t*n/i.clientHeight,this.object.matrixWorld),this.panUp(2*e*n/i.clientHeight,this.object.matrixWorld)}else i&&this.object.isOrthographicCamera&&(this.panLeft(t*(this.object.right-this.object.left)/this.object.zoom/i.clientWidth,this.object.matrixWorld),this.panUp(e*(this.object.top-this.object.bottom)/this.object.zoom/i.clientHeight,this.object.matrixWorld));this.dispatchEvent(Xpt)}dollyOut(t){this.object.isPerspectiveCamera?this.scale/=t:this.object.isOrthographicCamera&&(this.object.zoom*=t,this.zoomLimitsEnabled&&(this.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom))),this.object.updateProjectionMatrix(),this.zoomChanged=!0),this.dispatchEvent(Wie)}dollyIn(t){this.object.isPerspectiveCamera?this.scale*=t:this.object.isOrthographicCamera&&(this.object.zoom/=t,this.zoomLimitsEnabled&&(this.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom))),this.object.updateProjectionMatrix(),this.zoomChanged=!0),this.dispatchEvent(Wie)}zoomOut(t=this.getZoomScale()){this.dispatchEvent(Iy),this.dollyOut(t),this.dispatchEvent(yw)}zoomIn(t=this.getZoomScale()){this.dispatchEvent(Iy),this.dollyIn(t),this.dispatchEvent(yw)}setZoom(t){if(this.dispatchEvent(Iy),this.object.isPerspectiveCamera){let e=this.initialSphericalRadius/t/this.spherical.radius;this.scale=e}else this.object.isOrthographicCamera&&(this.object.zoom=t,this.zoomLimitsEnabled&&(this.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom))),this.object.updateProjectionMatrix(),this.zoomChanged=!0);this.dispatchEvent(yw)}handleMouseDownRotate(t){this.rotateStart.set(t.clientX,t.clientY)}handleMouseDownDolly(t){this.dollyStart.set(t.clientX,t.clientY)}handleMouseDownPan(t){this.panStart.set(t.clientX,t.clientY)}handleMouseMoveRotate(t,e=1){t.movementX!==void 0?this.rotateDelta.set(t.movementX,t.movementY):(this.rotateEnd.set(t.clientX,t.clientY),this.rotateDelta.subVectors(this.rotateEnd,this.rotateStart),this.rotateStart.copy(this.rotateEnd)),this.rotateDelta.multiplyScalar(this.rotateSpeed*e).rotateAround(qie,-this.object.angleOffsetFromUp);let i=this.domElement,r=this.useWindowEvents?window.innerHeight:i.clientHeight,n=2*Math.PI*this.rotateDelta.x/r,s=2*Math.PI*this.rotateDelta.y/r;this.rotateLeft(n),this.rotateUp(s),this.update()}handleMouseMoveDolly(t){this.dollyEnd.set(t.clientX,t.clientY),this.dollyDelta.subVectors(this.dollyEnd,this.dollyStart),this.dollyDelta.y>0?this.dollyOut(this.getZoomScale()):this.dollyDelta.y<0&&this.dollyIn(this.getZoomScale()),this.dollyStart.copy(this.dollyEnd),this.update()}handleMouseMovePan(t,e=1){t.movementX!==void 0?this.panDelta.set(t.movementX,t.movementY):(this.panEnd.set(t.clientX,t.clientY),this.panDelta.subVectors(this.panEnd,this.panStart),this.panStart.copy(this.panEnd)),this.panDelta.multiplyScalar(this.panSpeed*e),this.pan(this.panDelta.x,this.panDelta.y),this.update()}handleMouseWheel(t){if(Att===!1&&WP(t)===!1&&Ttt(t)===!0){if(this.enablePan===!1)return;this.gesture?(this.panDelta.set(-t.deltaX,-t.deltaY).multiplyScalar(this.panSpeed),this.panDelta.x=Math.min(Math.abs(this.panDelta.x),100)*(this.panDelta.x<0?-1:1),this.panDelta.y=Math.min(Math.abs(this.panDelta.y),100)*(this.panDelta.y<0?-1:1),t.altKey?this.pan(0,this.panDelta.y):t.shiftKey?this.pan(this.panDelta.x,0):this.pan(this.panDelta.x,this.panDelta.y),this.update()):(this.gesture=!0,this.isPointerDown=!0),window.clearTimeout(this.timer),this.timer=window.setTimeout(()=>{this.gesture=!1,this.isPointerDown=!1,this.dispatchEvent(yw)},30)}else{if(this.enableZoom===!1||this.gesture)return;t.deltaY===0?t.deltaX<0?this.dollyIn(this.getZoomScale()):t.deltaX>0&&this.dollyOut(this.getZoomScale()):t.deltaY<0?this.dollyIn(this.getZoomScale()):t.deltaY>0&&this.dollyOut(this.getZoomScale()),this.update(),this.gesture=!1,this.isPointerDown=!1}}handleTouchStartRotate(){if(Di.length===2){let t=.5*(Di[0].pageX+Di[1].pageX),e=.5*(Di[0].pageY+Di[1].pageY);this.rotateStart.set(t,e)}else this.rotateStart.set(Di[0].pageX,Di[0].pageY)}handleTouchStartPan(){if(Di.length===2){let t=.5*(Di[0].pageX+Di[1].pageX),e=.5*(Di[0].pageY+Di[1].pageY);this.panStart.set(t,e)}else this.panStart.set(Di[0].pageX,Di[0].pageY)}handleTouchStartDolly(){let t=Di[0].pageX-Di[1].pageX,e=Di[0].pageY-Di[1].pageY,i=Math.sqrt(t*t+e*e);this.dollyStart.set(0,i)}handleTouchStartDollyPan(){this.enableZoom&&this.isTouchZoom===!0&&this.handleTouchStartDolly(),this.enablePan&&this.handleTouchStartPan()}handleTouchStartDollyRotate(){this.enableZoom&&this.isTouchZoom===!0&&this.handleTouchStartDolly(),this.enableRotate&&this.handleTouchStartRotate()}handleTouchMoveRotate(t){if(Di.length===2){let i=gF(t),r=.5*(t.pageX+i.x),n=.5*(t.pageY+i.y);this.rotateEnd.set(r,n)}else{if(t.pointerId!==Di[0].pointerId)return;this.rotateEnd.set(t.pageX,t.pageY)}this.rotateDelta.subVectors(this.rotateEnd,this.rotateStart).multiplyScalar(this.rotateSpeed);let e=this.domElement;e&&(this.rotateLeft(2*Math.PI*this.rotateDelta.x/e.clientHeight),this.rotateUp(2*Math.PI*this.rotateDelta.y/e.clientHeight)),this.rotateStart.copy(this.rotateEnd)}handleTouchMovePan(t){if(Di.length===2){let e=gF(t),i=.5*(t.pageX+e.x),r=.5*(t.pageY+e.y);this.panEnd.set(i,r)}else{if(t.pointerId!==Di[0].pointerId)return;this.panEnd.set(t.pageX,t.pageY)}this.panDelta.subVectors(this.panEnd,this.panStart).multiplyScalar(this.panSpeed),this.pan(this.panDelta.x,this.panDelta.y),this.panStart.copy(this.panEnd)}handleTouchMoveDolly(t){let e=gF(t),i=t.pageX-e.x,r=t.pageY-e.y,n=Math.sqrt(i*i+r*r);this.dollyEnd.set(0,n),this.dollyDelta.set(0,Math.pow(this.dollyEnd.y/this.dollyStart.y,this.zoomSpeed)),this.dollyOut(this.dollyDelta.y),this.dollyStart.copy(this.dollyEnd)}handleTouchMoveDollyPan(t){this.enableZoom&&this.isTouchZoom===!0&&this.handleTouchMoveDolly(t),this.enablePan&&this.handleTouchMovePan(t)}handleTouchMoveDollyRotate(t){this.enableZoom&&this.isTouchZoom===!0&&this.handleTouchMoveDolly(t),this.enableRotate&&this.handleTouchMoveRotate(t)}checkRaycastLock(){if(this.object.data.raycastLock){if(this.options.isPlayMode)return!1;{let t=this.options?.showCameraLock;return t&&t(),!0}}else return!1}};function pd(t){let e=Math.PI*2;for(;t<=-Math.PI;)t+=e;for(;t>Math.PI;)t-=e;return t}function $ie(t){return 1-Math.pow(1-t,4)}var Yie=class{constructor(t,e,i,r,n,s){this.id=t,this.data=e,this.object=i,this.page=r,this.currentIntersectedObjects=[],this.actions=Xs(e,e.actions,r,n,s,i),this.target=e.target,this.triggeringObjects=[];for(let a of e.triggeringObjects){let o=r.scene.find(a);o&&this.triggeringObjects.push(o)}}isValidTriggeringObject(t){return this.target==="all"?!0:this.triggeringObjects.some(e=>e===t||e.isAncestorOf(t.uuid)||t.isAncestorOf(e.uuid))}disconnect(){Xa(this.actions)}dispatch(){this.object.destroyedInAction||(this.actions.Transition.forEach(t=>{t.object.currentTransitionEvent!==this&&(t.object.currentTransitionEvent=this,t.init())}),this.object.dispatchEvent({type:"beginEvent",eventName:"Trigger"}),this.actions.Transition.forEach(t=>{t.data.runMode==="Toggle"?t.toggle():t.play()}),this.actions.SwitchCamera.forEach(t=>{t.data.runMode==="Toggle"?t.toggle():t.play()}),this.actions.Link.forEach(t=>{t.dispatch()}),this.actions.Reset.forEach(t=>{t.dispatch()}),this.actions.Create.forEach(t=>{t.dispatch()}),this.actions.Destroy.forEach(t=>{t.dispatch(!1)}),this.actions.Audio.forEach(t=>{t.dispatchBasic()}),this.actions.Particles.forEach(t=>{t.dispatchBasic()}),this.actions.Video.forEach(t=>{t.dispatchBasic()}),this.actions.SceneTransition.forEach(t=>{t.dispatch()}),this.actions.SetVariable.forEach(t=>t.checkConditions()),this.actions.SetVariable.forEach(t=>t.dispatch()),this.actions.DynamicVariablePlay.forEach(t=>t.dispatch()),this.actions.ClearLocalStorage.forEach(t=>t.dispatch()),this.actions.UserAPI.forEach(t=>t.dispatch()))}},Pr;Ott.then(t=>Pr=t);var Ls=new W,uh=new Ii,sg=new W,C4=new xs(0,0,0,"YXZ"),Kie=new xs(0,0,0,"XYZ"),hh=new W,P4=new W,R4=new W(1,1,1),xw=new Ii,NR=new St,Zie=new St,emt={type:"updateMatrix"},Qie=new Ii,I4=new oc,_V={type:"beginEvent",eventName:"Collision"},tmt={type:"beginEvent",eventName:"Trigger"};function imt(t){if(VM.physicsEnabled(t.scene.objects))return!0;let e=!1;return t.scene.objects.traverse((i,r)=>{if(r.events){if(Array.isArray(r.events)){for(let n of r.events)if(n.data.disabled!==!0&&n.data.type==="GameControl"&&n.data.collisionEnabled){e=!0;break}}else for(let n of Object.values(r.events))if(n.disabled!==!0&&n.type==="GameControl"&&n.collisionEnabled){e=!0;break}}}),e}var q3=t=>t.states.some(e=>e.data.position!==void 0||e.data.rotation!==void 0||e.data.hiddenMatrix!==void 0||e.data.cloner!==void 0||e.data.pathSnapping!==void 0),rmt=class{constructor(t){this.eventContext=t,this.isEnabled=!1,this.gameControl=null,this.joysticks=[],this.joystickToGameControls=[],this.sharedGameControlGlobals={entitiesWithTransformAnim:[],entityToCollisionEvents:{},colliderToEntity:new Map,triggers:[],gamePads:[],createdObjects:[],nCreatedPerAction:{}},this.sensorToTriggerEvent={},this.eventManager=void 0,this.needsCollisionDetection=!1,this.initializationCounter=-1,this.rigidBodyToMesh=new Map,this.nActiveRigidBodies=0,this.collisionEvents=[],this.isExport=!1,this.skipRender=!0,this.processRigidBody=e=>{if(e.bodyType()!==Pr.RigidBodyType.Dynamic)return;e.isSleeping()||this.nActiveRigidBodies++;let[i,r,n]=this.rigidBodyToMesh.get(e.handle);if(Ls.copy(e.translation()).multiplyScalar(this.pixelsPerMeter),uh.copy(e.rotation()),i.matrixWorld.compose(Ls,uh,r),i.hasNonUniformScale&&i.matrixWorld.multiply(i.shearScale),i.dispatchEvent(emt),n){let s=i.cloner;if(s&&s.objectForSample===void 0){s.matrixWorld.copy(i.matrixWorld);for(let a of s.children)a.updateMatrixWorld(!0)}for(let a of i.children)a.updateMatrixWorld(!0)}},this.accumulator=0,this.handleCollisionEvents=(e,i,r)=>{if(r===!1)return;let n,s;if(this.sensorToTriggerEvent[e]?(n=this.sensorToTriggerEvent[e],s=this.sharedGameControlGlobals.colliderToEntity.get(i)):this.sensorToTriggerEvent[i]&&(n=this.sensorToTriggerEvent[i],s=this.sharedGameControlGlobals.colliderToEntity.get(e)),n&&s&&n.isValidTriggeringObject(s)){n.dispatch();return}for(let a=this.sharedGameControlGlobals.createdObjects.length-1;a>=0;a--){let o=this.sharedGameControlGlobals.createdObjects[a];if(o.userData.hasCollisionDestroy&&(o.rigidBody?.collider(0).handle===e||o.rigidBody?.collider(0).handle===i)){this.sharedGameControlGlobals.createdObjects.splice(a,1),o.removeFromParent(),requestAnimationFrame(()=>this.sharedGameControlGlobals.rapierWorld?.removeRigidBody(o.rigidBody));break}}if(this.gameControl?.object!==void 0&&this.gameControl.object===this.sharedGameControlGlobals.colliderToEntity.get(e)){let a=this.sharedGameControlGlobals.colliderToEntity.get(i),o=this.sharedGameControlGlobals.entityToCollisionEvents[a.uuid];if(o===void 0)return;for(let l of o)l.data.target==="character"&&this.dispatchCollisionEvent(l,a,i)}else if(this.gameControl?.object!==void 0&&this.gameControl.object===this.sharedGameControlGlobals.colliderToEntity.get(i)){let a=this.sharedGameControlGlobals.colliderToEntity.get(e),o=this.sharedGameControlGlobals.entityToCollisionEvents[a.uuid];if(o===void 0)return;for(let l of o)l.data.target==="character"&&this.dispatchCollisionEvent(l,a,e)}else{let a=this.sharedGameControlGlobals.colliderToEntity.get(e),o=this.sharedGameControlGlobals.entityToCollisionEvents[a.uuid];if(o!==void 0)for(let u of o)u.data.target==="scene"&&this.dispatchCollisionEvent(u,a,e);let l=this.sharedGameControlGlobals.colliderToEntity.get(i),c=this.sharedGameControlGlobals.entityToCollisionEvents[l?.uuid];if(c!==void 0)for(let u of c)u.data.target==="scene"&&this.dispatchCollisionEvent(u,l,i)}},this.isExport=t.isExport,this.sharedAssets=t.sharedAssets,this.renderer=t.renderer,this.requestRender=t.requestRender,this.domElement=this.renderer.domElement,this.pixelsPerMeter=ige,this.gravity=this.page.data.globalPhysics.gravity}get page(){return this.eventContext.page}attachVRControllers(t){t.forEach(e=>{e.addEventListener("connected",i=>{"gamepad"in i.data&&"axes"in i.data.gamepad&&this.sharedGameControlGlobals.gamePads.push(i.data.gamepad)})})}markIsDestroyTarget(){this.page.traverseVisibleEntity(t=>{let e=t.dataPatched;for(let i of e.events){if(i.data.disabled===!0)continue;let r=i.data.actions?.find(n=>n.data.type==="Destroy")?.data;if(r)for(let n of r.objects){let s=this.page.scene.find(n);s&&(s.userData.hasDestroy=!0)}}})}markIsDragObject(){this.page.traverseVisibleEntity(t=>{let e=t.dataPatched;for(let i of e.events)if(!(i.data.disabled===!0||i.data.type!=="DragDrop"))for(let r of i.data.objects){let n=this.page.scene.find(r);n&&(n.userData.hasDrag=!0)}})}initBVH(){let t=[];if(this.page.traverseChildren(e=>{let i,r=e instanceof NA,n=e instanceof UA;if(e instanceof vu||r||n)return;e instanceof bo?i=e.object:i=e;let s=i.dataPatched;if(s.physics?.enabled==="visibility"?!s.visible:!s.physics?.enabled)return!0;let a=e.geometry,o=i.userData.hasDestroy===!0,l=i.userData.hasDrag===!0;if(q3(s)||o||l||i.dataPatched.events.some(c=>c.data.disabled!==!0&&(c.data.type==="GameControl"||c.data.type==="Follow")))return e.updateMatrixWorldSVD(),this.addBoundsTree(e),!0;a&&a.getAttribute("position").count>0&&t.push(vp(a,e.matrixWorld))}),t.length>0){let e=n0(t,!1);this.sharedGameControlGlobals.staticMeshBVH=new LA(e)}}addRigidBody(t,e,i){if(nge(t.matrixWorld))return;let r=[],n="geometry"in t?t.geometry:void 0,s=e.dataPatched;if(n?.getAttribute("position")!==void 0&&r.push(vp(n,t.shearScale)),s.physics.fusedBody){let a=this.gatherChildrenGeom(t,r);t.traverseObject(a),t.children.forEach(l=>l.updateMatrixWorld(!0));let o=t.cloner;o&&o.objectForSample===void 0&&s.physics.rigidBody==="dynamic"&&(o.traverseObject(a),o.children.forEach(l=>l.updateMatrixWorld(!0)))}if(r.length>0){let a,o=!i.fromCreate&&s.physics.rigidBody==="dynamic"||i.fromCreate&&i.dynamic;o?(a=Pr.RigidBodyDesc.dynamic(),a.setLinearDamping(s.physics.damping).setAngularDamping(s.physics.damping).setAdditionalMass(1e-9).setGravityScale(s.physics.gravityScale).enabledRotations(...s.physics.enabledRotation).enabledTranslations(...s.physics.enabledTranslation)):(i.hasTransformAnim||i.hasFollow||i.hasDrag)&&!i.fromCreate?(a=Pr.RigidBodyDesc.kinematicPositionBased(),this.sharedGameControlGlobals.entitiesWithTransformAnim.push(t)):a=Pr.RigidBodyDesc.fixed();let l=n0(r);(t.hasNonUniformScale?t.matrixWorldRigid:t.matrixWorld).decompose(Ls,uh,sg),t.position0=Ls.clone().divideScalar(this.pixelsPerMeter),t.rotation0=uh.clone(),Ls.divideScalar(this.pixelsPerMeter),a.setTranslation(Ls.x,Ls.y,Ls.z).setRotation(uh),n?l?.scale(1/this.pixelsPerMeter,1/this.pixelsPerMeter,1/this.pixelsPerMeter):l?.scale(sg.x/this.pixelsPerMeter,sg.y/this.pixelsPerMeter,sg.z/this.pixelsPerMeter);let c=this.sharedGameControlGlobals.rapierWorld.createRigidBody(a);o&&this.rigidBodyToMesh.set(c.handle,[t,sg.clone(),s.physics.fusedBody]);let u=!(s.geometry===void 0||s.geometry.type==="SubdivGeometry"||s.geometry.type==="NonParametricGeometry"||s.geometry.type==="BooleanGeometry"||s.geometry.type==="VectorGeometry"||s.geometry.type==="StarGeometry"||s.geometry.type==="RectangleGeometry"||s.geometry.type==="EllipseGeometry"||s.geometry.type==="TriangleGeometry"||s.geometry.type==="TorusGeometry"||s.geometry.type==="HelixGeometry");try{this.addCollider(c,s.physics,l,e,u)}catch{try{this.addCollider(c,s.physics,l,e,!1)}catch(h){console.error(h)}}t.rigidBody=c}}addBoundsTree(t){let e=[];if(t.geometry?.getAttribute("position")!==void 0&&t.geometry?.getAttribute("position").count>0&&e.push(vp(t.geometry,t.shearScale)),t.traverseObject(this.gatherChildrenGeom(t,e)),t.children.forEach(i=>i.updateMatrixWorld(!0)),e.length>0){let i=n0(e,!1);t.bvhGeometry=i,i.getAttribute("position").count>0&&(t.bvhGeometry.boundsTree=new LA(i),this.sharedGameControlGlobals.entitiesWithTransformAnim.push(t))}}addCollider(t,e,i,r,n=!0){if(i?.getAttribute("position").count===0||i?.getIndex()?.count===0)return;let s;i&&(e.colliderType==="trimesh"?s=Pr.ColliderDesc.trimesh(i.getAttribute("position").array,i.getIndex().array):s=Pr.ColliderDesc.convexMesh(i.getAttribute("position").array,n?i.getIndex().array:void 0)),s.setFrictionCombineRule(Pr.CoefficientCombineRule.Average).setRestitutionCombineRule(Pr.CoefficientCombineRule.Average).setDensity(e.density).setFriction(e.friction).setRestitution(e.restitution);let a=this.sharedGameControlGlobals.rapierWorld.createCollider(s,t);this.sharedGameControlGlobals.colliderToEntity.set(a.handle,r),this.sharedGameControlGlobals.entityToCollisionEvents[r.uuid]?.some(o=>o.target==="scene")&&a.setActiveEvents(Pr.ActiveEvents.COLLISION_EVENTS)}gatherChildrenGeom(t,e){return(i,r)=>{if(r===0)return;let n;if(i instanceof vu)if(i.objectForSample){if(i.objectForSample.dataPatched.physics.fusedBody)return;n=i.object}else return i.object.dataPatched.physics.fusedBody===!0&&i.object.dataPatched.physics.rigidBody==="dynamic"?!0:void 0;else if(i instanceof bo)n=i.object;else if(n=i,n.dataPatched.cloner?.hideBase)return!0;let s=n.dataPatched;if(s.physics.enabled==="visibility"?!s.visible:!s.physics.enabled)return!0;r===1?t.hasNonUniformScale?i.matrixWorld.multiplyMatrices(t.shearScale,i.hiddenMatrix):i.matrixWorld.copy(i.hiddenMatrix):i.matrixWorld.multiplyMatrices(i.parent.matrixWorld,i.hiddenMatrix),i.matrixWorld.multiply(i.matrix);let a=i.geometry;a?.getAttribute("position")!==void 0&&e.push(vp(a,i.matrixWorld))}}activate(t){if(this.isEnabled)return;this.isEnabled=!0,this.eventManager=t,this.usePhysics=this.page.data.globalPhysics.usePhysics;let e=this.page.playCamera,i=!1,r=5,n=8,s=9,a="drag",o=this.page.data.publish.gameControlObject,l=o!==null?this.page.find(o):null,c=null;if(l)for(let d of l.data.events){if(d.data.disabled||d.data.type!=="GameControl")continue;let f=l;for(;this.usePhysics&&(f=f.parent)?.parent!==null;)f.data.physics?.fusedBody;d.data.collisionEnabled&&(this.needsCollisionDetection=!0),c===null&&(c=d.data)}if(this.page.traverseEntity(d=>{for(let f of d.dataPatched.events)if(f.data.disabled===!1&&f.data.type==="Trigger")return this.needsCollisionDetection=!0,!0}),l&&c&&(l.data.visible===!0||l.data.physics.enabled===!0)){i=i||c.camera===e.uuid||l.uuid===e.uuid;let d=new rge(l,this.renderer.domElement,c,this.eventContext.page.data.globalPhysics,this,l.uuid!==e.uuid&&c.camera===e.uuid,e,this.page,this.sharedAssets);this.gameControl=d,r=c.joystickPosLoc,n=c.joystickRotLoc,s=c.jumpTouchButtonLoc,a=c.rotByTouch,Pc&&c.touchControl&&(this.joystickToGameControls[r]="pos",c.moveMode==="walk"&&(this.joystickToGameControls[s]="jmp"),a==="joystick"&&(this.joystickToGameControls[n]="rot"))}if(this.gameControl&&this.gameControl.data.navmesh.enabled){let d=this.gameControl.data;if(!this.navigationMeshWrapper){this.navigationMeshWrapper=new Hpt(this.usePhysics,this.isExport);let f;d.collider.type==="sphere"?f=d.collider.radius*2:f=d.collider.height,f=Math.floor(f/d.navmesh.ch-1),this.navigationMeshWrapper.init({...d.navmesh,walkableHeight:f},this.gameControl,this.eventContext)}}if(i===!1){let{enableRotate:d,enablePan:f,enableZoom:p,autoRotate:g,hoverRotatePanMode:m}=this.eventManager.publish.orbitControls;(d||f||p||g||m!==0)&&(this.orbitControls=new dge(e,this.renderer.domElement,{isExport:this.isExport,isPlayMode:!0}),this.orbitControls.addEventListener("change",this.requestRender),this.orbitControls.addEventListener("end",this.requestRender),this.orbitControls.addEventListener("start",this.requestRender),this.orbitControls.fromJSON(this.eventManager.publish.orbitControls,this.eventManager.publish.mouseEventTarget),this.orbitControls.useKeyEvents=!1,this.orbitControls.addEventListenersToCamera(),this.orbitControls.connect(),this.orbitControls.update())}let u=this.renderer.domElement.width/this.renderer.getPixelRatio(),h=this.renderer.domElement.height/this.renderer.getPixelRatio();this.joystickToGameControls.forEach((d,f)=>{let p=document.body.appendChild(document.createElement("div")),[g,m,y]=this.eventManager.eventContext.publish.joystickSizeAndXYOffset[f],b=(u-5*g)/4+g,w={},E=d==="jmp",M=E?0:g;f<10?(f<5?w.top=M/2:w.bottom=M/2,w.left=M/2+f%5*b):f===10?(w.left=M/2,w.top=h/2):(w.right=M/2,w.top=h/2),w.top?w.top-=m[1]:w.bottom+=m[1],w.left?w.left+=m[0]:w.right-=m[0];for(let C in w)w[C]+="px";if(E){let C=p.appendChild(document.createElement("div"));Object.assign(C.style,w,{position:"absolute",width:g+"px",height:g+"px",backgroundColor:`rgba(255,255,255,${y==="show"?.4:0})`,zIndex:"9999",borderRadius:g+"px",border:y==="show"?"solid 2px rgba(0, 0, 0, .1)":"none",display:"flex",alignItems:"center",justifyContent:"center",touchAction:"none"});let R=g/16*16*.4;y==="show"&&(C.innerHTML=`
						<svg width="${R}" height="${g*.4}" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
							<path d="M2 10L8 4L14 10" stroke="black" stroke-opacity="40%" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
						</svg>
					`),C.addEventListener("pointerdown",()=>{this.gameControl.movementState.jump=1,this.requestRender()}),C.addEventListener("touchend",I=>I.preventDefault()),this.joysticks[f]=[void 0,p];return}let A={zone:p,mode:"static",position:w,size:g};y==="hide"&&(A.restOpacity=0);let P=nft.create(A);P.on("move",(C,R)=>{let I=this.gameControl;d==="pos"?R.force<.2?I.moveForce=0:(I.movementState.movePosZ=Math.sin(-R.angle.radian),I.movementState.movePosX=Math.cos(-R.angle.radian),R.force>1.2?I.movementState.run=1:I.movementState.run=0,R.force<.3?I.moveForce=(R.force-.2)/.1:I.moveForce=1):d==="rot"&&(R.force<.2?I.rotForce=0:(I.movementState.rotPosX=R.vector.y,I.movementState.rotPosY=-R.vector.x,R.force<.3?I.rotForce=(R.force-.2)/.1:I.rotForce=1)),this.requestRender()}),P.on("end",(C,R)=>{let I=this.gameControl;d==="pos"?(I.movementState.movePosZ=0,I.movementState.movePosX=0,I.moveForce=1):d==="rot"&&(I.movementState.rotPosX=0,I.movementState.rotPosY=0,I.rotForce=1)}),this.joysticks[f]=[P,p]}),this.markIsDestroyTarget(),this.markIsDragObject(),this.rebuildBVH(),this.initializationCounter++,window.setTimeout(()=>{this.collisionEvents.forEach(d=>d.initialDisabled=!1)},80)}initPhysics(){this.sharedGameControlGlobals.rapierWorld?.free(),this.sharedGameControlGlobals.rapierWorld=new Pr.World(new Pr.Vector3(0,this.gravity,0)),this.events=new Pr.EventQueue(!0);let t=[],e=[];if(this.page.traverseChildren(a=>{let o;if(a instanceof vu)if(a.objectForSample){if(a.objectForSample.dataPatched.physics.fusedBody)return;o=a.object}else return a.object.dataPatched.physics.fusedBody===!0&&a.object.dataPatched.physics.rigidBody==="dynamic"?!0:void 0;else if(a instanceof bo)o=a.object;else{if(a instanceof UA||a instanceof NA)return;if(o=a,o.dataPatched.cloner?.disabled===!1&&o.dataPatched.cloner?.hideBase&&o.dataPatched.physics?.fusedBody!==!0)return!0}let l=o.dataPatched,c;for(let m of l.events)m.data.disabled!==!0&&m.data.type==="GameControl"&&(c=m.data);if(!l.physics||(l.physics.enabled==="visibility"?!l.visible:!l.physics.enabled))return!0;a.updateMatrixWorldSVD();let u=q3(l),h=!1,d=o.userData.hasDestroy,f=o.userData.hasDrag,p=!1;for(let m of l.events)if(m.data.disabled!==!0){if(m.data.type==="Collision"){h=!0;let y=new Dpt(m.id,m.data,o,this.page,this.sharedAssets,this.eventManager);y.initialDisabled=!0,this.collisionEvents.push(y),this.sharedGameControlGlobals.entityToCollisionEvents[o.uuid]&&this.sharedGameControlGlobals.entityToCollisionEvents[o.uuid].every(b=>b.id!==m.id)?this.sharedGameControlGlobals.entityToCollisionEvents[o.uuid].push(y):this.sharedGameControlGlobals.entityToCollisionEvents[o.uuid]=[y]}else if(m.data.type==="Follow"){p=!0;let y=m.data.target;a.traverseVisible(b=>{b.userData.isFollowingObj=y})}}l.physics.rigidBody==="dynamic"&&l.physics.fusedBody===!1&&(a.matrixWorldFusedFalse=a.matrixWorld.clone());let g=a.geometry;if(c!==void 0){let m=Pr.RigidBodyDesc.kinematicPositionBased();(a.hasNonUniformScale?a.matrixWorldRigid:a.matrixWorld).decompose(Ls,uh,sg),a.position0=Ls.clone().divideScalar(this.pixelsPerMeter),a.rotation0=uh.clone(),Ls.divideScalar(this.pixelsPerMeter),m.setTranslation(Ls.x,Ls.y,Ls.z).setRotation(uh);let y=this.sharedGameControlGlobals.rapierWorld.createRigidBody(m);a.rigidBody=y;let b;c.collider.type==="sphere"?b=Pr.ColliderDesc.ball(c.collider.radius/this.pixelsPerMeter):c.collider.type==="capsule"?b=Pr.ColliderDesc.capsule((c.collider.height/2-c.collider.radius)/this.pixelsPerMeter,c.collider.radius/this.pixelsPerMeter):b=Pr.ColliderDesc.cuboid(c.collider.width/this.pixelsPerMeter/2,c.collider.height/this.pixelsPerMeter/2,c.collider.depth/this.pixelsPerMeter/2),b.setFrictionCombineRule(Pr.CoefficientCombineRule.Average).setRestitutionCombineRule(Pr.CoefficientCombineRule.Average).setDensity(l.physics.density).setFriction(l.physics.friction).setRestitution(l.physics.restitution);let w=this.sharedGameControlGlobals.rapierWorld.createCollider(b,y);this.sharedGameControlGlobals.colliderToEntity.set(w.handle,o),Ls.fromArray(c.collider.position).multiply(sg.setFromMatrixScale(o.matrixWorld)).divideScalar(this.pixelsPerMeter),w.setTranslationWrtParent(Ls);let E=new Ii().setFromEuler(new xs().setFromVector3(new W().fromArray(c.collider.rotation)));w.setRotationWrtParent(E),w.setActiveEvents(Pr.ActiveEvents.COLLISION_EVENTS),this.generateSensorColliderDescs(o,!0)}else l.physics.rigidBody==="dynamic"||u||p||d||f||h?(this.addRigidBody(a,o,{hasFollow:p,hasTransformAnim:u,hasDrag:f}),this.generateSensorColliderDescs(o,l.physics.fusedBody)):(g&&t.push(vp(g,a.matrixWorld)),l.physics.fusedBody&&a.traverseObject((m,y)=>{if(y===0)return;let b;if(m instanceof vu)if(m.objectForSample){if(m.objectForSample.dataPatched.physics.fusedBody)return;b=m.object}else return m.object.dataPatched.physics.fusedBody===!0&&m.object.dataPatched.physics.rigidBody==="dynamic"?!0:void 0;else{if(m instanceof UA||m instanceof NA)return;if(m instanceof bo)b=m.object;else if(b=m,b.dataPatched.cloner?.hideBase)return!0}let w=b.dataPatched;if(w.physics.enabled==="visibility"?!w.visible:!w.physics.enabled)return!0;let E=m.geometry;E?.getAttribute("position")!==void 0&&t.push(vp(E,m.matrixWorld))}),this.generateSensorColliderDescs(o,l.physics.fusedBody,e));if(l.physics?.fusedBody===!0||c)return!0}),t.length===0)return;let i=n0(t);i.scale(1/this.pixelsPerMeter,1/this.pixelsPerMeter,1/this.pixelsPerMeter);let r=Pr.RigidBodyDesc.fixed(),n=this.sharedGameControlGlobals.rapierWorld.createRigidBody(r),s=Pr.ColliderDesc.trimesh(i.getAttribute("position").array,i.getIndex().array).setFrictionCombineRule(Pr.CoefficientCombineRule.Multiply).setRestitutionCombineRule(Pr.CoefficientCombineRule.Multiply).setFriction(1).setRestitution(1);this.sharedGameControlGlobals.rapierWorld.createCollider(s,n);for(let[a,o]of e){let l=this.sharedGameControlGlobals.rapierWorld.createCollider(a,n);this.sensorToTriggerEvent[l.handle]=o}}updatePositions(){return this.nActiveRigidBodies=0,this.sharedGameControlGlobals.rapierWorld.forEachRigidBody(this.processRigidBody),this.nActiveRigidBodies>0}rebuildBVH(){this.usePhysics?this.initPhysics():(this.page.traverseEntity(t=>{for(let e of t.dataPatched.events)if(e.data.type==="Trigger"&&e.data.disabled!==!0){let i=new Yie(e.id,e.data,t,this.page,this.sharedAssets,this.eventManager),r=new St().compose(hh.fromArray(e.data.position),xw.setFromEuler(Kie.fromArray(e.data.rotation)),R4);if(e.data.triggerZone==="box"){let n=new Ss;n.min.fromArray(e.data.size).multiplyScalar(-.5),n.max.fromArray(e.data.size).multiplyScalar(.5),this.sharedGameControlGlobals.triggers.push([n,r,t,i])}else this.sharedGameControlGlobals.triggers.push([e.data.radius,r,t,i])}}),this.needsCollisionDetection&&this.initBVH())}disconnectEvents(){this.collisionEvents.forEach(t=>t.disconnect()),this.sharedGameControlGlobals.triggers.forEach(t=>t[3].disconnect()),this.sharedGameControlGlobals.triggers.length=0}deactivate(){if(this.isEnabled){this.isEnabled=!1,this.page.traverse(t=>{let e=t;e.matrixWorldFusedFalse&&(e.matrixWorldFusedFalse=void 0),e.rigidBody&&(e.rigidBody=void 0),e.position0&&(e.position0=void 0),e.rotation0&&(e.rotation0=void 0)}),this.sharedGameControlGlobals.rapierWorld?.free(),this.sharedGameControlGlobals.rapierWorld=void 0,this.sharedGameControlGlobals.staticMeshBVH=void 0,this.accumulator=0,this.sharedGameControlGlobals.entitiesWithTransformAnim=[],this.disconnectEvents(),this.gameControl?.reset(),this.gameControl?.dispose(),this.gameControl=null,this.initializationCounter=-1,this.joysticks.forEach(([t,e])=>{t?.destroy(),e.remove()}),this.joystickToGameControls=[],this.joysticks=[],this.orbitControls&&(this.orbitControls.dispose(),this.orbitControls=void 0),this.navigationMeshWrapper?.dispose(),this.navigationMeshWrapper=void 0;for(let t of Object.values(this.sharedGameControlGlobals.entityToCollisionEvents))t.forEach(e=>e.disconnect());this.sharedGameControlGlobals.entityToCollisionEvents={},this.page.updateMatrixWorld(!0)}}update(t,e,i){if(!this.isEnabled)return!0;let r=!0;if(this.orbitControls!==void 0&&this.orbitControls.needsUpdate&&(this.orbitControls.update(),r=!this.orbitControls.isCurrentlyDamping),this.initializationCounter>=0&&this.initializationCounter<2?(this.initializationCounter++,r=!1):this.initializationCounter===2&&this.gameControl&&(r=!this.gameControl.update(t,e,i)&&r),this.usePhysics===!1&&this.checkTrigger(),this.usePhysics){let n=.016666666666666666;if(t===0)r=this.stepPhysics()&&r;else{let s=t/1e3;s<n&&s>n*.55&&(s=n),this.accumulator+=s;let a=performance.now(),o=0,l=6;for(;this.accumulator>=n&&o<l&&(r=this.stepPhysics()&&r,this.accumulator-=n,o++,!(performance.now()-a>n*1e3)););this.accumulator=this.accumulator%n}}this.skipRender=r}stepPhysics(){for(let t of this.sharedGameControlGlobals.entitiesWithTransformAnim){(t.hasNonUniformScale?t.matrixWorldRigid:t.matrixWorld).decompose(Ls,uh,sg),C4.setFromQuaternion(uh);let e=t;e.prevR===void 0?(e.prevR=C4.clone(),e.prevT=Ls.clone()):(e.prevR.copy(C4),e.prevT.copy(Ls)),t.rigidBody&&(t.rigidBody.setNextKinematicTranslation(Ls.divideScalar(this.pixelsPerMeter)),t.rigidBody.setNextKinematicRotation(uh))}return this.sharedGameControlGlobals.rapierWorld.step(this.events),this.events?.drainCollisionEvents(this.handleCollisionEvents),!this.updatePositions()}dispatchCollisionEvent(t,e,i){let r=(this.sharedGameControlGlobals.rapierWorld?.getCollider(i))._parent,n;if(e.cloner){for(let s of e.cloner.children)if(s.rigidBody===r){n=s;break}}t.dispatch(n),e.dispatchEvent(_V)}updateUseWindowEvents(t){this.orbitControls?.updateUseWindowEvents(t)}generateSensorColliderDescs(t,e,i){let r=Zie.copy(t.matrixWorld).invert();t.traverseEntity((n,s)=>{if(e===!1&&s===1)return!0;for(let a of n.dataPatched.events)if(a.data.type==="Trigger"&&a.data.disabled!==!0){let o=new Yie(a.id,a.data,n,this.page,this.sharedAssets,this.eventManager),l;if(a.data.triggerZone==="box"?l=Pr.ColliderDesc.cuboid(...a.data.size.map(c=>c/(2*this.pixelsPerMeter))):l=Pr.ColliderDesc.ball(a.data.radius/this.pixelsPerMeter),l.setDensity(0).setSensor(!0).setActiveEvents(Pr.ActiveEvents.COLLISION_EVENTS),hh.fromArray(a.data.position),xw.setFromEuler(Kie.fromArray(a.data.rotation)),NR.compose(hh,xw,R4).premultiply(n.matrixWorld),i?(NR.decompose(hh,xw,P4),l.setActiveCollisionTypes(Pr.ActiveCollisionTypes.KINEMATIC_FIXED|Pr.ActiveCollisionTypes.DYNAMIC_FIXED)):(NR.premultiply(r).decompose(hh,xw,P4),t.rigidBody.bodyType()===Pr.RigidBodyType.Dynamic||(t.rigidBody.bodyType()===Pr.RigidBodyType.Fixed?l.setActiveCollisionTypes(Pr.ActiveCollisionTypes.KINEMATIC_FIXED|Pr.ActiveCollisionTypes.DYNAMIC_FIXED):l.setActiveCollisionTypes(Pr.ActiveCollisionTypes.KINEMATIC_KINEMATIC|Pr.ActiveCollisionTypes.DYNAMIC_KINEMATIC))),hh.divideScalar(this.pixelsPerMeter),l.setTranslation(hh.x,hh.y,hh.z),l.setRotation(xw),i)i.push([l,o]);else{let c=this.sharedGameControlGlobals.rapierWorld.createCollider(l,t.rigidBody);this.sensorToTriggerEvent[c.handle]=o}}})}checkTrigger(){let t;for(let e=0;e<this.sharedGameControlGlobals.triggers.length;e++){let[i,r,n,s]=this.sharedGameControlGlobals.triggers[e];for(let a=0;a<this.sharedGameControlGlobals.entitiesWithTransformAnim.length;a++){let o=this.sharedGameControlGlobals.entitiesWithTransformAnim[a];if(n===o||s.isValidTriggeringObject(Er.is(o)?o:o.object)===!1)continue;let l=Zie.copy(n.matrixWorld).decompose(hh,Qie,P4).compose(hh,Qie,R4).multiply(r),c=NR.copy(o.matrixWorld).invert().multiply(l);i instanceof Ss?t=o.bvhGeometry.boundsTree.intersectsBox(i,c):(I4.radius=i,I4.center.setFromMatrixPosition(c),t=o.bvhGeometry.boundsTree.intersectsSphere(I4)),t?s.currentIntersectedObjects.indexOf(o)===-1&&(s.currentIntersectedObjects.push(o),s.dispatch(),n.dispatchEvent(tmt)):s.currentIntersectedObjects=s.currentIntersectedObjects.filter(u=>u!==o)}}}};function nmt(t){let e=this._clip.duration,i=this._clip.start??0,r=this.loop,n=this.time+t,s=this._loopCount,a=r===jH;if(t===0)return s===-1?n:a&&(s&1)===1?e-(n-i):n;if(r===rhe){s===-1&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(n>=e)n=e;else if(n<0)n=0;else{this.time=n;break e}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=n,this._mixer.dispatchEvent({type:"finished",action:this,direction:t<0?-1:1})}}else{if(s===-1&&(t>=0?(s=0,this._setEndings(!0,this.repetitions===0,a)):this._setEndings(this.repetitions===0,!0,a)),n>=e||n<i){let o=Math.floor((n-i)/(e-i));n-=(e-i)*o,s+=Math.abs(o);let l=this.repetitions-s;if(l<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,a||(n=t>0?e:i,this.repetitions===1&&(n=e)),this.time=n,this._mixer.dispatchEvent({type:"finished",action:this,direction:t>0?1:-1});else{if(l===1){let c=t<0;this._setEndings(c,!c,a)}else this._setEndings(!1,!1,a);this._loopCount=s,this.time=n,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:o})}}else this.time=n;if(a&&(s&1)===1)return e-(n-i)}return n}var Jie=!1,smt=class{constructor(t,e,i,r){this.scene=t,this.requestRender=e,this.updateDisplayProgress=i,this.animationInspectorState=r,this.clipIdToAction={},this.activeClip=null,this.needsUpdate=!1,this.addClip=n=>{n.data.type==="Empty"&&n.data.animations&&n.data.animations.forEach((s,a)=>{let o=s[0]+"/";if(Array.isArray(n.identity)?o+=n.identity[0]:o+=n.uuid,this.clipIdToAction[o])return;let l=Ij.parse(JSON.parse(s[2]));n.animations[a]=l;let c=this.mixer.clipAction(l,n);Jie===!1&&(Object.getPrototypeOf(c)._updateTime=nmt,Jie=!0),c.clampWhenFinished=!0,this.clipIdToAction[o]=c})},this.mixer=new oqe(t),this.scene.traverseEntity(this.addClip)}deleteClip(t,e){let i=this.scene.find(e);if(!i)return;let r=i.animations.find(s=>s.uuid===t);if(!r)return;let n=this.clipIdToAction[t];!n||(n.stop(),this.mixer.uncacheClip(r),delete this.clipIdToAction[t],i.animations=i.animations.filter(s=>s.uuid!==t))}get isPlaying(){return Object.values(this.clipIdToAction).some(t=>t.isRunning())}playFromInspector(t){this.mixer.stopAllAction();let e=this.clipIdToAction[t];!e||(e.play(),this.activeClip=e.getClip(),this.requestRender())}onExitPlayMode(){Object.values(this.clipIdToAction).forEach(t=>{t.repetitions=1/0,t.loop=nhe}),this.mixer.stopAllAction(),this.requestRender()}play(t){let e=t.clipId+"/"+t.object,i=this.clipIdToAction[e];if(i)return t&&(t.repeat>=0&&(i.repetitions=t.repeat+1),t.direction==="pingpong"&&t.repeat!==0&&(i.loop=jH)),i.play(),i.paused=!1,this.requestRender(),i}resumeFromInspector(t){let e=this.clipIdToAction[t];!e||(e.play(),e.paused=!1,this.requestRender())}pauseFromInspector(t){let e=this.clipIdToAction[t];!e||(e.paused=!0)}stop(){this.mixer.stopAllAction(),this.requestRender()}update(t){if(this.needsUpdate)this.needsUpdate=!1;else if(this.isPlaying===!1||this.animationInspectorState?.isScrubbing)return;this.mixer.update(t/1e3),this.activeClip&&this.updateDisplayProgress(Math.round(this.mixer.time/this.activeClip.duration*(this.maxFrames-1)%(this.maxFrames-1))),this.requestRender()}get maxFrames(){return $me(this.activeClip??void 0)}setProgressFromInspector(t,e){if(!this.clipIdToAction[e])return;this.activeClip!==this.clipIdToAction[e].getClip()&&this.playFromInspector(e);let i=this.clipIdToAction[e].paused;this.clipIdToAction[e].paused=!1,this.mixer.setTime(Math.min(t/(this.maxFrames-1),.9999)*this.activeClip.duration),this.requestRender(),i&&(this.clipIdToAction[e].paused=!0)}},D4=new WeakMap,amt=class extends NT{constructor(t){super(t),this.decoderPath="",this.decoderConfig={},this.decoderBinary=null,this.decoderPending=null,this.workerLimit=4,this.workerPool=[],this.workerNextTaskID=1,this.workerSourceURL="",this.defaultAttributeIDs={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"},this.defaultAttributeTypes={position:"Float32Array",normal:"Float32Array",color:"Float32Array",uv:"Float32Array"}}setDecoderPath(t){return this.decoderPath=t,this}setDecoderConfig(t){return this.decoderConfig=t,this}setWorkerLimit(t){return this.workerLimit=t,this}load(t,e,i,r){let n=new Dj(this.manager);n.setPath(this.path),n.setResponseType("arraybuffer"),n.setRequestHeader(this.requestHeader),n.setWithCredentials(this.withCredentials),n.load(t,s=>{this.decodeDracoFile(s,e).catch(r)},i,r)}decodeDracoFile(t,e,i,r){let n={attributeIDs:i||this.defaultAttributeIDs,attributeTypes:r||this.defaultAttributeTypes,useUniqueIDs:!!i};return this.decodeGeometry(t,n).then(e)}decodeGeometry(t,e){let i=JSON.stringify(e);if(D4.has(t)){let o=D4.get(t);if(o.key===i)return o.promise;if(t.byteLength===0)throw new Error("THREE.DRACOLoader: Unable to re-decode a buffer with different settings. Buffer has already been transferred.")}let r,n=this.workerNextTaskID++,s=t.byteLength,a=this._getWorker(n,s).then(o=>(r=o,new Promise((l,c)=>{r._callbacks[n]={resolve:l,reject:c},r.postMessage({type:"decode",id:n,taskConfig:e,buffer:t},[t])}))).then(o=>this._createGeometry(o.geometry));return a.catch(()=>!0).then(()=>{r&&n&&this._releaseTask(r,n)}),D4.set(t,{key:i,promise:a}),a}_createGeometry(t){let e=new oi;t.index&&e.setIndex(new Mi(t.index.array,1));for(let i=0;i<t.attributes.length;i++){let r=t.attributes[i],n=r.name,s=r.array,a=r.itemSize;e.setAttribute(n,new Mi(s,a))}return e}_loadLibrary(t,e){let i=new Dj(this.manager);return i.setPath(this.decoderPath),i.setResponseType(e),i.setWithCredentials(this.withCredentials),new Promise((r,n)=>{i.load(t,r,void 0,n)})}preload(){return this._initDecoder(),this}_initDecoder(){if(this.decoderPending)return this.decoderPending;let t=typeof WebAssembly!="object"||this.decoderConfig.type==="js",e=[];return t?e.push(this._loadLibrary("draco_decoder.js","text")):(e.push(this._loadLibrary("draco_wasm_wrapper.js","text")),e.push(this._loadLibrary("draco_decoder.wasm","arraybuffer"))),this.decoderPending=Promise.all(e).then(i=>{let r=i[0];t||(this.decoderConfig.wasmBinary=i[1]);let n=omt.toString(),s=["/* draco decoder */",r,"","/* worker */",n.substring(n.indexOf("{")+1,n.lastIndexOf("}"))].join(`
`);this.workerSourceURL=URL.createObjectURL(new Blob([s]))}),this.decoderPending}_getWorker(t,e){return this._initDecoder().then(()=>{if(this.workerPool.length<this.workerLimit){let r=new Worker(this.workerSourceURL);r._callbacks={},r._taskCosts={},r._taskLoad=0,r.postMessage({type:"init",decoderConfig:this.decoderConfig}),r.onmessage=function(n){let s=n.data;switch(s.type){case"decode":r._callbacks[s.id].resolve(s);break;case"error":r._callbacks[s.id].reject(s);break;default:console.error('THREE.DRACOLoader: Unexpected message, "'+s.type+'"')}},this.workerPool.push(r)}else this.workerPool.sort(function(r,n){return r._taskLoad>n._taskLoad?-1:1});let i=this.workerPool[this.workerPool.length-1];return i._taskCosts[t]=e,i._taskLoad+=e,i})}_releaseTask(t,e){t._taskLoad-=t._taskCosts[e],delete t._callbacks[e],delete t._taskCosts[e]}debug(){console.log("Task load: ",this.workerPool.map(t=>t._taskLoad))}dispose(){for(let t=0;t<this.workerPool.length;++t)this.workerPool[t].terminate();return this.workerPool.length=0,this.workerSourceURL!==""&&URL.revokeObjectURL(this.workerSourceURL),this}};function omt(){let t,e;onmessage=function(a){let o=a.data;switch(o.type){case"init":t=o.decoderConfig,e=new Promise(function(u){t.onModuleLoaded=function(h){u({draco:h})},DracoDecoderModule(t)});break;case"decode":let l=o.buffer,c=o.taskConfig;e.then(u=>{let h=u.draco,d=new h.Decoder,f=new h.DecoderBuffer;f.Init(new Int8Array(l),l.byteLength);try{let p=i(h,d,f,c),g=p.attributes.map(m=>m.array.buffer);p.index&&g.push(p.index.array.buffer),self.postMessage({type:"decode",id:o.id,geometry:p},g)}catch(p){console.error(p),self.postMessage({type:"error",id:o.id,error:p.message})}finally{h.destroy(f),h.destroy(d)}});break}};function i(a,o,l,c){let u=c.attributeIDs,h=c.attributeTypes,d,f,p=o.GetEncodedGeometryType(l);if(p===a.TRIANGULAR_MESH)d=new a.Mesh,f=o.DecodeBufferToMesh(l,d);else if(p===a.POINT_CLOUD)d=new a.PointCloud,f=o.DecodeBufferToPointCloud(l,d);else throw new Error("THREE.DRACOLoader: Unexpected geometry type.");if(!f.ok()||d.ptr===0)throw new Error("THREE.DRACOLoader: Decoding failed: "+f.error_msg());let g={index:null,attributes:[]};for(let m in u){let y=self[h[m]],b,w;if(c.useUniqueIDs)w=u[m],b=o.GetAttributeByUniqueId(d,w);else{if(w=o.GetAttributeId(d,a[u[m]]),w===-1)continue;b=o.GetAttribute(d,w)}g.attributes.push(n(a,o,d,m,y,b))}return p===a.TRIANGULAR_MESH&&(g.index=r(a,o,d)),a.destroy(d),g}function r(a,o,l){let c=l.num_faces()*3,u=c*4,h=a._malloc(u);o.GetTrianglesUInt32Array(l,u,h);let d=new Uint32Array(a.HEAPF32.buffer,h,c).slice();return a._free(h),{array:d,itemSize:1}}function n(a,o,l,c,u,h){let d=h.num_components(),f=l.num_points()*d,p=f*u.BYTES_PER_ELEMENT,g=s(a,u),m=a._malloc(p);o.GetAttributeDataArrayForAllPoints(l,h,g,p,m);let y=new u(a.HEAPF32.buffer,m,f).slice();return a._free(m),{name:c,array:y,itemSize:d}}function s(a,o){switch(o){case Float32Array:return a.DT_FLOAT32;case Int8Array:return a.DT_INT8;case Int16Array:return a.DT_INT16;case Int32Array:return a.DT_INT32;case Uint8Array:return a.DT_UINT8;case Uint16Array:return a.DT_UINT16;case Uint32Array:return a.DT_UINT32}}}var Bg;function ere(t){return Bg||(Bg=new amt,Bg.setDecoderPath(t?`${t}/`:"https://www.gstatic.com/draco/versioned/decoders/1.5.2/").preload()),Bg.decoderPending}async function lmt(t){if(Bg){let e={attributeIDs:Bg.defaultAttributeIDs,attributeTypes:Bg.defaultAttributeTypes,useUniqueIDs:!1},i;try{i=await Bg.decodeGeometry(new Int8Array(t).buffer,e)}catch(r){console.error(r)}if(i)return{index:i.index?{array:i.index.array}:void 0,attributes:Object.entries(i.attributes).map(([r,n])=>({name:r,itemSize:n.itemSize,array:n.array}))}}return null}async function cmt(t,e){let[i,r]=Zde(u3.deserialize(new Uint8Array(t)));return gfe(i),r.result().data}function umt(t){let e=[];return t.scene.objects.traverse((i,r)=>{r.type==="Mesh"&&r.geometry.type==="NonParametricGeometry"&&r.geometry.data.draco!==void 0&&e.push(r)}),e}async function tre(t){for(let e of t){let i=await lmt(e.geometry.data.draco);if(i){let r=e.geometry.data;i.index&&(r.index={array:i.index.array,itemSize:1,normalized:!1,type:"Uint32Array"});let n={};i.attributes.forEach(({name:s,array:a,itemSize:o})=>{n[s]={array:a,itemSize:o,type:"Float32Array",normalized:!1}}),r.attributes=n,r.draco=void 0}}}var hmt=class{constructor(){this._clickCount=0,this._lastTime=0,this._lastPosition=[0,0],this._delay=500,this._distance=2,this._onMouseDown=t=>{let e=[t.clientX,t.clientY],i=new Date().getTime();if(this._clickCount>0){let r=e[0]-this._lastPosition[0],n=e[1]-this._lastPosition[1];Math.sqrt(r*r+n*n)>this._distance&&(this._clickCount=0)}this._lastPosition=e,this._clickCount=i-this._lastTime>this._delay?1:this._clickCount+1,this._lastTime=i},this._onMouseUp=t=>{}}start(t,e=500,i=2){this._target&&this.stop(),this.reset(),this._delay=e,this._distance=i,this._target=t,this._target.addEventListener("pointerdown",this._onMouseDown,!1),this._target.addEventListener("pointerup",this._onMouseUp,!1)}stop(){this._target&&(this._target.removeEventListener("pointerdown",this._onMouseDown,!1),this._target.removeEventListener("pointerup",this._onMouseUp,!1),this._target=void 0)}get clickCount(){return this._clickCount}reset(){this._clickCount=0,this._lastTime=0,this._lastPosition=[0,0]}},dmt=class{constructor(t,e,i,r,n,s,a,o){this.eventId=t,this.id=e,this.data=i,this.dataEvent=r,this.object=n,this.stage=!1,this.actions=Xs(r,i.actions,s,a,o,n)}disconnect(){Xa(this.actions)}dispatchIn(){this.actions.Audio.forEach(t=>t.dispatchBasic()),this.actions.Particles.forEach(t=>t.dispatchBasic()),this.actions.Video.forEach(t=>t.dispatchBasic()),this.actions.Create.forEach(t=>t.dispatch()),this.actions.Destroy.forEach(t=>t.dispatch()),this.actions.Reset.forEach(t=>t.dispatch()),this.actions.Link.forEach(t=>t.dispatch()),this.actions.Transition.forEach(t=>{t.object.currentTransitionEvent!==this&&(t.object.currentTransitionEvent=this,t.init())}),this.actions.Transition.forEach(t=>t.toggle()),this.actions.Animation.forEach(t=>t.play()),this.actions.SwitchCamera.forEach(t=>t.play()),this.actions.SceneTransition.forEach(t=>t.dispatch()),this.actions.SetVariable.forEach(t=>t.checkConditions()),this.actions.SetVariable.forEach(t=>t.dispatch()),this.actions.DynamicVariablePlay.forEach(t=>t.dispatch()),this.actions.ClearLocalStorage.forEach(t=>t.dispatch()),this.actions.UserAPI.forEach(t=>t.dispatch())}dispatchOut(){this.actions.Transition.forEach(t=>{t.toggle()})}},fmt=class extends Wo{constructor(t,e){super(t),this.eventManager=e,this.breakpoints=[],this.resize=(i,r)=>{this.breakpoints.forEach(n=>{let s=Qj.deviceToSize(n.data.size),a=n.dataEvent.orientation==="horizontal"?i:r,o;switch(n.data.operator){case"<":o=a<s[0];break;case">":o=a>s[0];break;case"<>":o=a>s[0]&&a<s[1];break}n.stage!==o&&(n.stage=o,n.stage?n.dispatchIn():n.dispatchOut())})},this.onResizeObserver=new ResizeObserver(i=>{for(let r of i){let{width:n,height:s}=r.contentRect;this.resize(n,s)}})}connect(){let{page:t,sharedAssets:e,domElement:i}=this.eventContext;this.onResizeObserver.observe(i);let r=n=>{if(!(!n.visible||!n.data?.events.length))for(let{data:s,id:a}of n.data.events)s.disabled||s.type==="Resize"&&s.breakpoints.forEach(({data:o,id:l})=>{try{let c=new dmt(a,l,o,s,n,t,e,this.eventManager);this.breakpoints.push(c)}catch{}})};t.traverseEntity(n=>{(n instanceof Fo||n instanceof Fa)&&n.frame?.traverse(s=>{r(s)}),r(n)})}disconnect(){this.onResizeObserver.disconnect(),this.breakpoints.forEach(t=>{t.disconnect()}),this.breakpoints=[]}},pmt=class extends Wo{constructor(t,e){super(t),this.eventManager=e,this.userAPIs={},this.events=[],this.onSuccess=({userAPIId:i})=>{this.events.forEach(r=>{r.data.userAPIId===i&&r.dispatchSuccess()})},this.onError=({userAPIId:i})=>{this.events.forEach(r=>{r.data.userAPIId===i&&r.dispatchError()})},this.userAPIs=t.sharedAssets.getUserAPIs()}connect(){this.eventContext.page.traverseEntity(t=>{t.data?.events.filter(e=>e.data.type==="API"&&!e.data.disabled).forEach(e=>{this.events.push(new mmt(e.id,e.data,t,this.eventContext.page,this.eventContext.sharedAssets,this.eventManager))})}),Object.entries(this.userAPIs).forEach(([t,e])=>{e.on("success",this.onSuccess),e.on("error",this.onError),e.autostart&&e.callUserAPI(this.eventContext.sharedAssets)})}disconnect(){Object.entries(this.userAPIs).forEach(([t,e])=>{e.off("success",this.onSuccess),e.off("error",this.onError)})}},mmt=class{constructor(t,e,i,r,n,s){this.id=t,this.data=e,this.object=i,this.successActions=Xs(e,e.successActions,r,n,s,i),this.errorActions=Xs(e,e.errorActions,r,n,s,i)}dispatchSuccess(){this.dispatchActions(this.successActions)}dispatchError(){this.dispatchActions(this.errorActions)}dispatchActions(t){t.Audio.forEach(e=>e.dispatchConditional()),t.Particles.forEach(e=>e.dispatchConditional()),t.Video.forEach(e=>e.dispatchConditional()),t.Create.forEach(e=>e.dispatch()),t.Destroy.forEach(e=>e.dispatch()),t.Reset.forEach(e=>e.dispatch()),t.Transition.forEach(e=>{e.object.currentTransitionEvent!==this&&(e.object.currentTransitionEvent=this),e.init()}),t.Transition.forEach(e=>e.play()),t.Animation.forEach(e=>e.play()),t.SwitchCamera.forEach(e=>e.play()),t.SceneTransition.forEach(e=>e.dispatch()),t.SetVariable.forEach(e=>e.checkConditions()),t.SetVariable.forEach(e=>e.dispatch()),t.DynamicVariablePlay.forEach(e=>e.dispatch()),t.ClearLocalStorage.forEach(e=>e.dispatch()),t.UserAPI.forEach(e=>e.dispatch())}},gmt=class extends Wo{constructor(t,e){super(t),this.eventManager=e,this.userWebhooks={},this.events=[],this.onMessage=({userWebhookId:i})=>{this.events.forEach(r=>{r.data.userWebhookId===i&&r.dispatch()})},this.userWebhooks=t.sharedAssets.getUserWebhooks()}connect(){this.eventContext.page.traverseEntity(t=>{t.data?.events.filter(e=>e.data.type==="WEBHOOK"&&!e.data.disabled).forEach(e=>{this.events.push(new vmt(e.id,e.data,t,this.eventContext.page,this.eventContext.sharedAssets,this.eventManager))})}),Object.entries(this.userWebhooks).forEach(([t,e])=>{e.connect(),e.on("message",this.onMessage)})}disconnect(){Object.entries(this.userWebhooks).forEach(([t,e])=>{e.off("message",this.onMessage),e.disconnect()})}},vmt=class{constructor(t,e,i,r,n,s){this.id=t,this.data=e,this.object=i,this.actions=Xs(e,e.actions,r,n,s,i)}dispatch(){let t=this.actions;t.Audio.forEach(e=>e.dispatchConditional()),t.Particles.forEach(e=>e.dispatchConditional()),t.Video.forEach(e=>e.dispatchConditional()),t.Create.forEach(e=>e.dispatch()),t.Destroy.forEach(e=>e.dispatch()),t.Reset.forEach(e=>e.dispatch()),t.Transition.forEach(e=>{e.object.currentTransitionEvent!==this&&(e.object.currentTransitionEvent=this),e.init()}),t.Transition.forEach(e=>e.play()),t.Animation.forEach(e=>e.play()),t.SwitchCamera.forEach(e=>e.play()),t.SceneTransition.forEach(e=>e.dispatch()),t.SetVariable.forEach(e=>e.checkConditions()),t.SetVariable.forEach(e=>e.dispatch()),t.DynamicVariablePlay.forEach(e=>e.dispatch()),t.ClearLocalStorage.forEach(e=>e.dispatch()),t.UserAPI.forEach(e=>e.dispatch())}};function ymt(){let t=document.createElement("textarea");return t.style.position="fixed",t.style.top="200px",t.style.left="400px",t.style.zIndex="-1",t.style.border="1px solid rgba(255,0,0,0.5)",t.style.width="10px",t.style.height="500px",t.style.color="white",t.style.opacity="0.5",t.style.background="transparent",t.style.display="none",t.style.margin="0px",t.style.padding="0px",t.style.boxSizing="content-box",t.style.pointerEvents="none",t}var xmt=new W(0,0,1),ire=new W,rre=new W,nre=new Vs,bmt=class{constructor(t,e,i,r,n){this.containerScene=t,this.raycaster=e,this.sharedAssets=i,this.requestRender=r,this.onExit=n,this.htmlInput=null,this.virtualInput=null,this.helper=new lme,this.doubleClickHandler=new hmt,this.isDragging=!1,this.plane=new $l,this.caretInterval=0,this.planeIntersection=new W,this.projected=new Ae,this._lastIndex=0,this._isFirstDragMove=!1,this.selectionOnDragStart=0,this.onTextMaterialChanged=()=>{let s=this.virtualInput?.data;if(this.virtualInput!==void 0&&s){let a=s.material,o=typeof a=="string"?this.sharedAssets.data.materials[a]:a,l=wht(o,this.sharedAssets);this.helper.setCaretColor(l)}},this.stopAnimateTextCursor=()=>{clearInterval(this.caretInterval),this.helper&&(this.helper.caretMesh.visible=!1)},this.startAnimateTextCursor=()=>{this.stopAnimateTextCursor(),this.helper&&(this.helper.caretMesh.visible=!0,this.caretInterval=setInterval(()=>{this.helper&&(this.helper.caretMesh.visible=!this.helper.caretMesh.visible),this.requestRender()},600))},this.handleCaretUpdate=s=>{if(!this.htmlInput||!this.virtualInput)return;let a=this.helper,o=s?.key==="ArrowLeft"||s?.key==="ArrowRight",l=s?.key==="ArrowUp"||s?.key==="ArrowDown";this.htmlInput.selectionStart===this.htmlInput.selectionEnd?(a.setCaretPosition(this.htmlInput.selectionStart,{horizontalKeyMove:o,verticalKeyMove:l}),this.startAnimateTextCursor()):a.setSelection(this.htmlInput.selectionStart,this.htmlInput.selectionEnd),this.requestRender()},this.containerScene.add(this.helper)}createInput(){return this.htmlInput=ymt(),this.htmlInput}connect(){}disconnect(){this.stopAnimateTextCursor(),this.helper.hide(),this.htmlInput?.remove(),this.doubleClickHandler.stop()}handleMouseDown(){if(!this.htmlInput||!this.virtualInput)return!0;this.getPointOnPlane();let t=this.doubleClickHandler.clickCount,{index:e,lineIndex:i,characterIndex:r}=this.helper.getSelectionFromPosition(this.projected.x,this.projected.y,t>1?"inside":"previous")??{index:0,lineIndex:0,characterIndex:0};this.virtualInput?.wrappedText?.length&&this.virtualInput.wrappedText[i][Math.max(0,r-1)]===`
`&&(e--,r--),this._lastIndex=e,this._isFirstDragMove=!0;let n=this.checkClickedObject();if(t===1){if(n===null)return this.onExit(this.virtualInput),!0;this.selectionOnDragStart=e,this.isDragging=!0,this.setInputSelection(e)}else n===this.virtualInput&&(t===2?this.selectClosestWord(i,r):t>2&&(this.setInputSelection(0,this.htmlInput.value.length),this.doubleClickHandler.reset()))}handleMouseUp(){this.applyRangeToTextInput(),this.isDragging=!1,this._isFirstDragMove=!1}handleMouseMove(){!this.virtualInput||(this._isFirstDragMove&&this.doubleClickHandler.clickCount>1&&(this.selectionOnDragStart=this._lastIndex,this.isDragging=!0,this.setInputSelection(this._lastIndex)),this._isFirstDragMove=!1,this.getPointOnPlane(),this.applyRangeToTextInput())}focus(t){if(this.virtualInput=t,this.updateTextInputStyles(),this.htmlInput)if(t){let e=this.data?.geometry.text;this.htmlInput.value=typeof e=="string"?"":e?.textValue.toString()??""}else this.htmlInput.value=""}blur(){}get data(){let{virtualInput:t}=this;if(t)return t.dataPatched}applyRangeToTextInput(){if(!this.isDragging||!this.virtualInput||!this.htmlInput)return;let t=this.selectionOnDragStart,{index:e,lineIndex:i,characterIndex:r}=this.helper.getSelectionFromPosition(this.projected.x,this.projected.y,this.doubleClickHandler.clickCount>2?"inside":"previous")??{index:0};i!==void 0&&r!==void 0&&this.virtualInput?.wrappedText[i][r-1]===`
`&&e--,this.htmlInput.setSelectionRange(Math.min(t,e),Math.max(t,e))}checkClickedObject(){if(this.virtualInput){let t=this.raycaster.intersectObject(this.virtualInput,!1);if(t.length>0){let e=t[0];if(e.object instanceof _8)return e.object}}return null}selectClosestWord(t,e){if(!this.virtualInput)return;let i=this.virtualInput.wrappedText,r=i[t],n=e+1,s=e;r[e]!==" "&&(n=this.findNextCharOccurence(r,e,"forward"," "),s=this.findNextCharOccurence(r,e,"backward"," "),s>0&&s++,n>=r.length-1&&t===i.length-1&&n++);let a=this.helper,o=a.getGlobalIndexFromLineAndCharIndexes(i,t,s),l=a.getGlobalIndexFromLineAndCharIndexes(i,t,n);this.setInputSelection(o,l)}findNextCharOccurence(t,e,i,r=" "){let n=Math.max(0,t.length-1),s=i==="forward"?n:0,a=i==="forward"?1:-1,o=Math.max(Math.min(e,n),0);for(;o!==s;)if(o+=a,t.charAt(o)===r)return o;return s}getPointOnPlane(){let t=this.virtualInput?.data;if(!(!this.virtualInput||!t)&&this.raycaster.ray.intersectsPlane(this.plane)){this.planeIntersection===null&&(this.planeIntersection=new W);let e=this.raycaster.ray.intersectPlane(this.plane,this.planeIntersection);if(e){this.planeIntersection.copy(this.virtualInput.worldToLocal(e));let i=typeof t.geometry.width=="number"?t.geometry.width:1,r=typeof t.geometry.height=="number"?t.geometry.height:1;this.projected.set(e.x+i*.5,e.y-r*.5)}}}updatePlane(){let t=this.virtualInput?.data;this.virtualInput&&t&&(nre.getNormalMatrix(this.virtualInput.matrixWorld),ire.copy(xmt).applyMatrix3(nre).normalize(),this.virtualInput.localToWorld(rre.set(0,0,t.geometry.depth)),this.plane.setFromNormalAndCoplanarPoint(ire,rre))}setInputSelection(t,e=t){this.htmlInput?.setSelectionRange(t,e),L_&&this.htmlInput?.focus(),setTimeout(()=>{this.htmlInput?.focus()})}updateTextInputStyles(){let t=this.virtualInput?.data;this.virtualInput&&t&&this.htmlInput&&(this.htmlInput.style.fontSize=t.geometry.fontSize+"px",this.htmlInput.style.letterSpacing=t.geometry.letterSpacing*t.geometry.fontSize+"px",this.htmlInput.style.lineHeight=t.geometry.fontSize*t.geometry.lineHeight+"px",this.htmlInput.style.width=t.geometry.width+"px",this.htmlInput.style.height=t.geometry.height+"px",this.htmlInput.style.textAlign=wmt(t.geometry.horizontalAlign))}};function wmt(t){return t===4?"justify":t===2?"right":t===3?"center":"left"}var fge=(t,e)=>{if(typeof t=="string"){let i=e.data(t);if(i)return fge(i.value,e)}return xo.getDisplayedValue(t)};function sre(t,e){let i=t.text,r="";if(typeof i=="string"){let n=e.variables.data(r);n&&(r=fge(n.value,e.variables))}else r=i.textValue.toString();return r}var _mt=class extends Wo{constructor(t,e){super(t),this.eventManager=e,this._textInputs=[],this.sceneHelpers=new ac,this.helper=new lme,this._onMouseDownFocusIn=i=>{if(Di.length>1)return;this.eventContext.updateRaycaster(i);let r=null;if(this.eventContext.raycaster){for(let n of this._textInputs)if(this.eventContext.raycaster.intersectObject(n,!0).length>0){r=n;break}}this.focusOnTextInput(r),this._onCaretUpdate(),this._onMouseUp(),this.textInputManager.doubleClickHandler.start(this.eventContext.domElement),this.textInputManager.doubleClickHandler._onMouseDown(i),this._onMouseDown(i)},this.onExit=()=>{let{virtualInput:i}=this.textInputManager;if(i===null)return;let r=this.textInputManager.htmlInput;this.helper.hide(),r?.setSelectionRange(r.value.length,r.value.length),this.eventManager.controlsManager.orbitControls&&(this.eventManager.controlsManager.orbitControls.enabled=!0);let{domElement:n}=this.eventContext;n.removeEventListener("pointerdown",this._onMouseDown,!1),n.removeEventListener("pointerup",this._onMouseUp,!1),n.removeEventListener("pointermove",this._onMouseMove,!1),window.removeEventListener("keydown",this._onKeyPress),this.textInputManager.doubleClickHandler.reset(),n.addEventListener("pointerdown",this._onMouseDownFocusIn),this.eventContext.renderer.sceneHelpersOnTop=void 0,this.eventContext.renderer.pipeline.disableHelpers()},this._onMouseDown=i=>{this.eventContext.updateRaycaster(i),this.textInputManager.handleMouseDown(),this.textInputManager.virtualInput&&this.eventContext.raycaster.intersectObject(this.textInputManager.virtualInput,!0).length>0&&this.eventManager.controlsManager.orbitControls&&(this.eventManager.controlsManager.orbitControls.enabled=!1)},this._onMouseUp=()=>{this.textInputManager.handleMouseUp(),this.eventManager.controlsManager.orbitControls&&!this.eventManager.controlsManager.orbitControls.enabled&&(this.eventManager.controlsManager.orbitControls.enabled=!0)},this._onMouseMove=i=>{this.eventContext.updateRaycaster(i),this.textInputManager.handleMouseMove()},this._onTextEdit=i=>{let{htmlInput:r,virtualInput:n,helper:s}=this.textInputManager;if(!r||!n)return;let a=r.value;n.textGeometry.setText(a,this.eventContext.sharedAssets).then(()=>{this.eventContext.requestRender()});let o=n.data;s.update();let l=o.geometry.text;if(typeof l=="string"){let c=l;this.eventContext.sharedAssets.updateVariable(c,{textValue:a})}this.textInputManager.updateTextInputStyles(),this._onCaretUpdate()},this._onCaretUpdate=i=>{this.textInputManager.handleCaretUpdate(i)},this._onKeyPress=i=>{i.key==="Escape"&&this.onExit()},this.textInputManager=new bmt(this.sceneHelpers,t.raycaster,t.sharedAssets,t.requestRender,this.onExit)}connect(){let t=[];if(this.eventContext.scene.traverseEntity(r=>{r instanceof _8&&t.push(r)}),this._textInputs=t,t.length===0)return;let{domElement:e}=this.eventContext;e.addEventListener("pointerdown",this._onMouseDownFocusIn),this.textInputManager.connect();let i=this.textInputManager.createInput();document.body.appendChild(i),i.style.display="none",i.addEventListener("keyup",this._onCaretUpdate),i.addEventListener("keydown",this._onCaretUpdate),i.addEventListener("beforeinput",this._onCaretUpdate),i.addEventListener("paste",this._onCaretUpdate),i.addEventListener("cut",this._onCaretUpdate),i.addEventListener("select",this._onCaretUpdate),i.addEventListener("selectstart",this._onCaretUpdate)}disconnect(){let t=this.textInputManager.htmlInput,{domElement:e,sharedAssets:i}=this.eventContext;e.removeEventListener("pointerdown",this._onMouseDownFocusIn),t?.removeEventListener("keyup",this._onCaretUpdate),t?.removeEventListener("keydown",this._onCaretUpdate),t?.removeEventListener("beforeinput",this._onCaretUpdate),t?.removeEventListener("paste",this._onCaretUpdate),t?.removeEventListener("cut",this._onCaretUpdate),t?.removeEventListener("select",this._onCaretUpdate),t?.removeEventListener("selectstart",this._onCaretUpdate),this._textInputs.forEach(r=>{let n=sre(r.data.geometry,this.eventContext.sharedAssets.data);r.textGeometry.setText(n,i)}),e.removeEventListener("pointerdown",this._onMouseDown,!1),e.removeEventListener("pointerup",this._onMouseUp,!1),e.removeEventListener("pointermove",this._onMouseMove,!1),window.addEventListener("keydown",this._onKeyPress),this.eventContext.renderer.sceneHelpersOnTop=void 0,this.eventContext.renderer.pipeline.disableHelpers(),this.textInputManager.disconnect()}focusOnTextInput(t){this.textInputManager.focus(t),this.textInputManager.onTextMaterialChanged();let e=this.textInputManager.htmlInput;if(!e||t===null)return;this.textInputManager.updateTextInputStyles(),this.eventContext.renderer.sceneHelpersOnTop=this.sceneHelpers,this.eventContext.renderer.pipeline.enableHelpers(),this.textInputManager.isDragging=!1;let i=sre(t.textGeometry.userData.parameters,this.eventContext.sharedAssets.data);e.value=i,e.setSelectionRange(0,0),this.textInputManager.helper.show(t),e.style.display="block",e.addEventListener("input",this._onTextEdit),this.textInputManager.updatePlane();let{domElement:r}=this.eventContext;r.removeEventListener("pointerdown",this._onMouseDownFocusIn),r.addEventListener("pointerdown",this._onMouseDown,!1),r.addEventListener("pointerup",this._onMouseUp,!1),r.addEventListener("pointermove",this._onMouseMove,!1),window.addEventListener("keydown",this._onKeyPress)}},Smt=class extends Wo{constructor(t,e){super(t),this.eventManager=e,this.events=[],this.onVoice=({value:i,frequencies:r})=>{this.events.forEach(n=>{n.dispatch()})}}connect(){this.openAIRealtime=this.eventContext.sharedAssets.openAIRealtime,this.openAIRealtime&&(this.eventContext.page.traverseEntity(t=>{t.data?.events.filter(e=>e.data.type==="AIAssistantListener"&&!e.data.disabled).forEach(e=>{this.events.push(new Emt(e.id,e.data,t,this.eventContext.page,this.eventContext.sharedAssets,this.eventManager))})}),this.openAIRealtime.on("voice",this.onVoice))}disconnect(){this.openAIRealtime?.off("voice",this.onVoice)}},Emt=class{constructor(t,e,i,r,n,s){this.id=t,this.data=e,this.object=i,this.actions=Xs(e,e.actions,r,n,s,i)}dispatch(){this.dispatchActions(this.actions)}dispatchActions(t){t.Audio.forEach(e=>e.dispatchConditional()),t.Particles.forEach(e=>e.dispatchConditional()),t.Video.forEach(e=>e.dispatchConditional()),t.Create.forEach(e=>e.dispatch()),t.Destroy.forEach(e=>e.dispatch()),t.Reset.forEach(e=>e.dispatch()),t.Transition.forEach(e=>{e.object.currentTransitionEvent!==this&&(e.object.currentTransitionEvent=this),e.init()}),t.Transition.forEach(e=>e.play()),t.Animation.forEach(e=>e.play()),t.SwitchCamera.forEach(e=>e.play()),t.SceneTransition.forEach(e=>e.dispatch()),t.SetVariable.forEach(e=>e.checkConditions()),t.SetVariable.forEach(e=>e.dispatch()),t.DynamicVariablePlay.forEach(e=>e.dispatch()),t.ClearLocalStorage.forEach(e=>e.dispatch()),t.UserAPI.forEach(e=>e.dispatch())}},Amt=class extends Wo{constructor(t,e){super(t),this.eventManager=e,this.events=[],this.onTriggerEvent=({description:i,direction:r})=>{let n=this.events.find(s=>s.data.description===i);n&&(r==="backward"?n.dispatchReverse():n.dispatch())}}connect(){this.openAIRealtime=this.eventContext.sharedAssets.openAIRealtime,this.openAIRealtime&&(this.eventContext.page.traverseEntity(t=>{t.data?.events.filter(e=>e.data.type==="AIAssistantTrigger"&&!e.data.disabled).forEach(e=>{this.events.push(new Mmt(e.id,e.data,t,this.eventContext.page,this.eventContext.sharedAssets,this.eventManager))})}),this.openAIRealtime.on("trigger_event",this.onTriggerEvent))}disconnect(){this.openAIRealtime?.off("trigger_event",this.onTriggerEvent)}},Mmt=class{constructor(t,e,i,r,n,s){this.id=t,this.data=e,this.object=i,this.actions=Xs(e,e.actions,r,n,s,i)}dispatch(){let t=this.actions;t.Audio.forEach(e=>e.dispatchConditional()),t.Particles.forEach(e=>e.dispatchConditional()),t.Video.forEach(e=>e.dispatchConditional()),t.Create.forEach(e=>e.dispatch()),t.Destroy.forEach(e=>e.dispatch()),t.Reset.forEach(e=>e.dispatch()),t.Transition.forEach(e=>{e.object.currentTransitionEvent!==this&&(e.object.currentTransitionEvent=this),e.init()}),t.Transition.forEach(e=>e.play()),t.Animation.forEach(e=>e.play()),t.SwitchCamera.forEach(e=>e.play()),t.SceneTransition.forEach(e=>e.dispatch()),t.SetVariable.forEach(e=>e.checkConditions()),t.SetVariable.forEach(e=>e.dispatch()),t.DynamicVariablePlay.forEach(e=>e.dispatch()),t.ClearLocalStorage.forEach(e=>e.dispatch()),t.UserAPI.forEach(e=>e.dispatch())}dispatchReverse(){let t=this.actions;t.Transition.forEach(e=>e.reverseFromCurrent()),t.Particles.forEach(e=>e.reverseFromCurrent()),t.Animation.forEach(e=>e.reverseFromCurrent()),t.SwitchCamera.forEach(e=>e.reverseFromCurrent()),t.Create.forEach(e=>e.dispatchStop())}},Tmt=class{constructor(t,e,i,r,n){this.publish=t,this.controlsManager=e,this.animationControls=i,this.eventContext=r,this.sharedVariables=n,this.isEnabled=!1,this.activateCount=0,this.needsMouse=!1,this.needsRaycast=!1,this.onTouchMovePreventScroll=s=>{let a=window.parent!==window,o=document.documentElement.scrollHeight>document.documentElement.clientHeight||document.documentElement.scrollWidth>document.documentElement.clientWidth;(s.touches.length>1||this.preventTouchScroll||a===!1&&o===!1)&&s.preventDefault()},this.onMouseWheelPreventScroll=s=>{this.preventScroll&&s.preventDefault()},this.onMouseMove=s=>{this.eventContext.sharedAssets.mouseProperty={...this.getMousePosition(s),pressed:s.buttons>0}},this.onMouseDown=s=>{this.eventContext.sharedAssets.mouseProperty={...this.getMousePosition(s),pressed:!0}},this.onMouseUp=s=>{this.eventContext.sharedAssets.mouseProperty={...this.getMousePosition(s),pressed:!1}},this.getMousePosition=s=>{let{domRect:a}=this.eventContext,{pageX:o,pageY:l}=s.touches?.length>0?s.touches[0]:s;return{x:o-(a.left+window.scrollX),y:l-(a.top+window.scrollY)}},this.stopRaycast=t.stopRaycast,this.preventScroll=t.preventScroll,this.preventTouchScroll=t.preventTouchScroll,this.hideCursor=t.hideCursor,this.requestRender=r.requestRender}activate(t=!1){if(this.isEnabled)return;this.isEnabled=!0,this.initializeActionsDependentStates(),this.needsMouse&&(this.eventContext.domElement.addEventListener("pointermove",this.onMouseMove),this.eventContext.domElement.addEventListener("pointerdown",this.onMouseDown)),this.handlers={Spline:new tpt(this.eventContext),VariableChange:new Opt(this.eventContext,this.sharedVariables,this,this.needsMouse,this.needsRaycast),API:new pmt(this.eventContext,this),WEBHOOK:new gmt(this.eventContext,this),AIAssistantListener:new Smt(this.eventContext,this),AIAssistantTrigger:new Amt(this.eventContext,this),Conditional:new lpt(this.eventContext,this),Start:new Ipt(this.eventContext,this),Basic:new rpt(this.eventContext,this,this.needsRaycast),MouseHover:new Mpt(this.eventContext,this),Scroll:new Ppt(this.eventContext,this),Follow:new ypt(this.eventContext,this),DragDrop:new fpt(this.eventContext,this),LookAt:new Spt(this.eventContext),Resize:new fmt(this.eventContext,this),Textfields:new _mt(this.eventContext,this)};let{page:e,domElement:i}=this.eventContext;this.hideCursor&&(i.style.cursor="none"),e.traverseEntity(r=>{r.addEventListener("requestRender",this.requestRender)}),Object.values(this.handlers).forEach(r=>r.connect()),i.addEventListener("wheel",this.onMouseWheelPreventScroll),i.addEventListener("touchmove",this.onTouchMovePreventScroll),this.activateCount++,t||this.eventContext.sharedAssets.openAIRealtime?.connect()}deactivate(t=!1){if(!this.isEnabled)return;this.isEnabled=!1,this.eventContext.domElement.removeEventListener("pointermove",this.onMouseMove),this.eventContext.domElement.removeEventListener("pointerdown",this.onMouseDown),this.eventContext.domElement.removeEventListener("pointerup",this.onMouseUp),this.eventContext.sharedAssets.mouseProperty=null,this.eventContext.sharedAssets.raycastProperty=null;let{page:e,domElement:i}=this.eventContext;i.style.cursor="",Object.values(this.handlers).forEach(r=>r.disconnect()),this.controlsManager.gameControl?.disposeActions(),this.controlsManager.disconnectEvents(),e.traverseEntity(r=>{r.removeEventListener("requestRender",this.requestRender),r.destroyedInAction=!1}),i.removeEventListener("touchmove",this.onTouchMovePreventScroll),i.removeEventListener("wheel",this.onMouseWheelPreventScroll),this.animationControls.onExitPlayMode(),t||this.eventContext.sharedAssets.openAIRealtime?.disconnect()}get isPaused(){return this.isEnabled}pause(){this.deactivate()}resume(){this.activate()}reset(){this.deactivate(!0),this.activate(!0),this.controlsManager.deactivate(),this.controlsManager.activate(this),this.controlsManager.page.updateMatrixWorld(!0),this.controlsManager.rebuildBVH()}updateUseWindowEvents(t){let e=this.isEnabled;e&&this.deactivate(),this.eventContext.useWindowEvents=t,e&&this.activate()}initializeActionsDependentStates(){let t=this.eventContext.sharedAssets;t.resetDynamicVariablePlayState();let e=i=>{if(i.data.type==="Conditional"&&(i.data.ifActions.forEach(e),i.data.elseActions.forEach(e)),i.data.type==="Conditional"||i.data.type==="SetVariable")for(let r of i.data.type==="Conditional"?i.data.condition:i.data.expression)"id"in r&&Array.isArray(r.id)&&(r.id[0]==="mouse"&&(this.needsMouse=!0),r.id[0]==="raycast"&&(this.needsRaycast=!0));i.data.type==="DynamicVariablePlay"&&i.data.variableId!==""&&(i.data.mode==="Play"||i.data.mode==="PlayPause"||i.data.mode==="Toggle")&&t.setDynamicVariablePlayState(i.data.variableId,"Stopped")};this.eventContext.page.traverseEntity(i=>{if(i.data?.events.length)for(let r of i.data.events)if(r.data.type==="VariableChange"&&(r.data.variableId==="mouseProperty"&&(this.needsMouse=!0),r.data.variableId==="raycastProperty"&&(this.needsRaycast=!0)),r.data.type==="Conditional")for(let n of["inActions","outActions"])r.data[n].forEach(e);else if(r.data.type==="DragDrop")for(let n of["drag","drop"])r.data.dragDropActions[n].forEach(e);else if(r.data.type==="GameControl")for(let n of["idle","move","jump","run"])r.data.gameActions[n].forEach(e);else if(r.data.type==="Resize")for(let n of r.data.breakpoints)n.data.actions.forEach(e);else r.data.type==="LookAt"||r.data.type==="API"||r.data.actions.forEach(e)})}},Cmt=class{constructor(t,e,i,r,n){this._aspect=1,this.enableResponsive=!1,this._renderer=t,this._camera=e,this._frameSize=new Ae().copy(i),this._editorSize=new Ae().copy(r),this._aspect=e.aspect,this._fov=n??e.fov}set frameSize(t){this._frameSize.copy(t)}updateRenderer(){!this._renderer||this._renderer.setSize(this._frameSize.x,this._frameSize.y)}updateViewport(){if(!this._renderer||!this._camera||this._camera.cameraType!=="PerspectiveCamera")return;let t=this._frameSize.x,e=this._frameSize.y,i=this._editorSize.y;this._aspect=t/e,e<=i&&(this._camera.zoom*=i/e),this._renderer.setViewport(0,0,t,e)}updateCamera(t=!0){if(this._camera)if(this._camera.cameraType==="PerspectiveCamera"){let e=this._frameSize.y,i=this._editorSize.y,r=this._fov;if(t&&e>i){let n=Pmt(e,1080,2160,1,15)/100;r*=e/i,r*=1-n}this._camera.aspect=this._aspect,this._camera.fov=r,this._camera.updateProjectionMatrix()}else this._camera.setViewplaneSize(this._frameSize.x,this._frameSize.y,this.enableResponsive)}setCamera(t){this._camera=t,this._aspect=t.aspect,this._fov=t.fov}revert(){let t=window.innerWidth,e=window.innerHeight;this._renderer&&(this._renderer.setViewport(0,0,t,e),this._renderer.setSize(t,e)),this._camera&&(this._camera.aspect=t/e,this._camera.fov=this._fov,this._camera.setViewplaneSize(t,e,this.enableResponsive),this._camera.updateProjectionMatrix())}};function Pmt(t,e,i,r,n){return(t-e)/(i-e)*(n-r)+r}var Rmt=class{get sharedAssets(){return this.shared}constructor(t,e={},i=!0){this.shared=new h8(t.shared,e,!0,i),this.scene=new A8(t.scene,this.sharedAssets),this.shared.setEntityOpContext({scene:this.scene,shared:this.shared})}reset(t,e){this.scene.clearScene(),this.sharedAssets.reset(t.shared),this.scene.resetAfterClear(t.scene,this.sharedAssets)}resetPersonalCameraFromDocumentData(){for(let t of this.scene.children)t instanceof Fa&&!t.uiScene&&t.personalCamera.updateState(t.data.camera,{scene:this.scene,shared:this.shared})}dispose(){this.scene.dispose(),this.shared.dispose()}gc(){this.shared.geometryCache.startGc(),this.shared.geometryCache2.startGc(),this.scene.traverseEntity(t=>{t instanceof bs&&t.markGeometryAsReachable(this.shared)}),this.shared.geometryCache.endGc(),this.shared.geometryCache2.endGc()}},Imt=class{constructor({x:t=10,y:e=10}){this._startTime=0;let i=document.getElementById("spe-perfs");i?this.element=i:(this.element=document.createElement("div"),document.body.appendChild(this.element),this.element.style.position="absolute",this.element.style.zIndex="10000",this.element.style.fontFamily="monospace",this.element.style.background="black",this.element.style.color="white",this.element.style.padding="10px",this.element.style.opacity="0.5",this.element.style.fontSize="11px",this.element.setAttribute("id","spe-perfs")),this.element.style.left=`${t}px`,this.element.style.top=`${e}px`}dispose(){this.element.parentElement?.removeChild(this.element)}start(){this._startTime=performance.now()}end(){let t=performance.now()-this._startTime;this.element.innerHTML=t.toFixed(3)+" ms"}};function Dmt(t){let e;if(t.index)for(let i=0;i<t.index.array.length;i+=3)e=t.index.array[i],t.index.array[i]=t.index.array[i+2],t.index.array[i+2]=e}function jA(t){return t instanceof YM?"SubdivObject":t.geometry.type==="NonParametricGeometry"?"NonParametric":"Mesh"}function Omt(t,e){let i={};return t.traverseEntity(r=>{if(!r.visible||!(r instanceof So)||r.type!=="Mesh"||Array.isArray(r.material)||r.states&&Object.keys(r.states).length)return;let n=r.parent;for(;n;){if(n instanceof So&&r.states&&Object.keys(r.states).length)return;n=n.parent}let s=r.material.uuid,a=e.shared.materials[s];if(a){if(!Ga.isMergable(a))return}else{let l=e.scene.objects.get(r.uuid)?.data;if(l&&"material"in l&&typeof l.material!="string"){if(!Ga.isMergable(l.material))return;s=Ga.getHash(l.material)}}i[s]||(i[s]={});let o=i[s][jA(r)];if(o){if(o.push(r),r.cloner)for(let l of r.cloner.children)o.push(l)}else if(i[s][jA(r)]=[r],r.cloner)for(let l of r.cloner.children)i[s][jA(r)].push(l)}),i}function Lmt(t){let e=0;return Object.values(t).forEach(i=>{Object.values(i).forEach(r=>{let n=r.length;n>e&&(e=n)})}),e}function kmt(t,e){let i=Omt(e,t),r=Lmt(i),n=new Array(r),s=0,a=new Array(r),o=0,l=new Array(r),c=0,u=new Array(r),h=0;for(let[d,f]of Object.entries(i))for(let p of Object.values(f)){if(o=0,c=0,p.forEach(m=>{m instanceof So&&(a[o++]=m.geometry.clone(),l[c++]=m)}),c<2)continue;for(let m=0;m<c;m++)l[m].updateWorldMatrix(!0,!1),a[m].applyMatrix4(l[m].matrixWorld),l[m].matrixWorld.determinant()<0&&Dmt(a[m]);let g=n0(a.slice(0,o),!1);if(g){let m;switch(d){case"SubdivObject":{console.warn("Turning subdiv object into mesh"),m=new En(g,l[0].material);break}default:{m=new En(g,l[0].material);break}}m.castShadow=l[0].castShadow,m.receiveShadow=l[0].receiveShadow,e.add(m);let y=b=>{h=0;for(let w of b)w.children&&y(w.children),w instanceof So&&(Array.isArray(w.material)||i[w.material.uuid]&&i[w.material.uuid][jA(w)]&&i[w.material.uuid][jA(w)].length>1||(u[h++]=w));for(let w=0;w<h;w++)e.attach(u[w])};for(let b=0;b<c;b++){let w=l[b];y(w.children),n[s++]=w}}}for(let d=0;d<s;d++)n[d].removeFromParent()}var Nmt=gv(WVe(),1),Umt=new Ae;function Bmt(t){let e="The Spline Runtime only accepts .splinecode files that are generated from Spline export panel.";t.endsWith(".spline")?console.warn(e+" The .spline files are only meant to be used by the Editor."):t.endsWith(".splinecode")||console.warn(e)}function are(t){let e=new Ya(0,0,0,1);try{e.setStyle(t)}catch(i){console.error(i)}finally{return e}}var Fmt=class{constructor(t,{renderOnDemand:e,renderMode:i="auto",wasmPath:r}={}){this._viewportMode=1,this._viewportWidth=window.innerWidth,this._viewportHeight=window.innerHeight,this._proxyObjectCache=new Map,this._variablesCache=new Map,this._isPaused=!1,this._renderRequested=!1,this._skipRender=!1,this.time=performance.now(),this.dt=0,this.currentTAAFrame=0,this.disposed=!1,this._requestRenderAutoMode=()=>{this._skipRender=!1},this.requestRender=()=>{this._renderRequested=!0},this.render=n=>{if(this.time=n,this._lastTime&&(this.dt=this.time-this._lastTime),this._lastTime=this.time,this._perfs?.start(),!this._renderer){this._perfs?.end();return}if(!this._isPaused&&(this.renderMode==="manual"&&!this._renderRequested||this.renderMode==="auto"&&this._skipRender)){this._perfs?.end();return}if(this._renderRequested=!1,this._skipRender=!0,this._controls&&(this._skipRender=this._controls.update(this.dt)??!1),this._eventManager&&(this._eventManager.handlers?.Start.hasVideoAction||this._eventManager.handlers?.Basic.hasVideoAction||this._eventManager.handlers?.Conditional.hasVideoAction)&&(this._skipRender=!1),this._animationControls?.update(this.dt),this._skipRender?(this.currentTAAFrame++,this.currentTAAFrame<32?this._skipRender=!1:this.currentTAAFrame=0):this.currentTAAFrame=0,this._scene?.traverseVisibleEntity(s=>{s.type==="ParticleSystem"&&(s.update(this.dt),this._skipRender=!1)}),this._scene&&this._scene.activeCamera!==this._camera&&(this._camera=this._scene.activeCamera),this._eventManager?.isEnabled&&((this._eventManager.handlers?.Follow).onAnimationFrameDamping(),(this._eventManager.handlers?.LookAt).onAnimationFrameDamping(),(this._eventManager.handlers?.DragDrop).onAnimationFrameDamping()),this._scene&&this._camera){if(this._scene.pathConstraints.applyConstraints(this._scene),this._renderer.sceneTransitionTimeRemaining>0){this._renderer.sceneTransitionTimeRemaining-=this.dt;let s=1-this._renderer.sceneTransitionTimeRemaining/this._renderer.sceneTransitionDuration;this._renderer.pipeline.sceneTransitionPass.uniforms.mixRatio.value=s,this._skipRender=!1}else this._renderer.pipeline.sceneTransitionFromTexture=null;this._renderer.renderSplineScene(this._scene,this._camera)}this.canvas.dispatchEvent(this._renderedEvent),this._perfs?.end()},this._resize=n=>{if(this._renderer){if(this._viewportMode===1&&this._frameView&&(this._frameView.frameSize=Umt.set(this._viewportWidth,this._viewportHeight)),n){let s=this._viewportWidth,a=this._viewportHeight;this._renderer.setSize(s-1,a-1,!1),this._renderer.setSize(s,a,!1)}else this._renderer.setSize(this._viewportWidth,this._viewportHeight,!1);if(this._camera=this._scene?.activeCamera,this._scene?.updateViewPlaneSize(this._frameView?.frameSize?.x??this._viewportWidth,this._frameView?.frameSize?.y??this._viewportHeight,this._frameView?.enableResponsive??!1),this._camera){let s=Object.values(this._data?.frames??{})[0].preset??"fullscreen";this._frameView?.setCamera(this._camera),this._frameView?.updateCamera(s!=="fullscreen"),this._camera.cameraType==="PerspectiveCamera"&&(this._camera.aspect=this._viewportWidth/this._viewportHeight),this._camera.updateProjectionMatrix()}this.eventManager&&(this.eventManager.eventContext.domRect=this.canvas.getBoundingClientRect()),this._requestRenderAutoMode()}},this._debouncedResize=NM(this._resize,10),this._onScroll=n=>{this.eventManager&&(this.eventManager.eventContext.domRect=this.canvas.getBoundingClientRect())},this.canvas=t,this.renderMode=e?"auto":i,r&&(this._wasmPath=gtt(r,"/")),this._renderedEvent=new CustomEvent("rendered",{bubbles:!0}),Object.defineProperty(this._renderedEvent,"target",{writable:!1,value:this}),window.location.search.includes("perfs")&&(this._perfs=new Imt({x:10,y:10})),Ptt(t)}async load(t,e,i){Bmt(t),this.disposed=!1;let r=await(await fetch(t,i)).arrayBuffer();await this.start(r,{variables:e})}async start(t,{interactive:e=!0,variables:i}={}){if(this.disposed)return;let r=await cmt(t);this._data=r;let n=umt(r);r.version&&(0,Nmt.default)(r.version,"1.10.72")>0&&console.warn("Your .splinecode file is more recent than the library. Please upgrade @splinetool/runtime to the latest version."),this._wasmPath&&this.setUIWasmUrl(`${this._wasmPath}/ui.wasm`),await Promise.all([n.length&&ere(this._wasmPath),Ute(r)&&Oat(this._wasmPath),Blt(r)&&Pat(this._wasmPath),VM.physicsEnabled(r.scene.objects)&&Ltt(),Ote(r)&&plt(),fie(r)&&qdt(),dlt(r)&&hlt(),nie(r)&&Oht(),Wpt(r)&&Dtt(this._wasmPath)].filter(Boolean)),n.length&&await tre(n),this._eventManager?.deactivate(),this._controls?.deactivate(),this._scene?.dispose();let s=new Rmt(r);if(s.resetPersonalCameraFromDocumentData(),this._scene=s.scene,this._sharedAssetsManager=s.sharedAssets,this._camera=this._scene.activeCamera,window.location.search.includes("merge-geometries")){let l=performance.now();kmt(r,s.scene);let c=performance.now();console.log("Merged geometries in ",c-l," ms")}Ute(r)&&this._scene.traverse(l=>{Pp(l)&&l.recomputeBoolean()}),this._sharedAssetsManager.setRequestRender(()=>{this._requestRenderAutoMode(),this._scene?.traverse(l=>{l instanceof vu&&l.pendingMediaLoad&&l.update()})}),this._scene?.traverse(l=>{l.type==="ParticleSystem"&&(l.wakeUp(),l.data.autoPlay?l.start():l.stop())});let a=Object.keys(r.shared.fonts).map(l=>this._sharedAssetsManager.getFont(l).loadingPromise);if(Promise.all(a).then(()=>{s.scene.markNeedsUpdateRendererDirty(),this._requestRenderAutoMode()}),Ote(r)&&imt(r)&&await Promise.all(a),nie(r)){let l=[];this._scene.traverseEntity(c=>{(c instanceof Fo||c instanceof Fa)&&c.uiCanvas&&l.push(c.uiCanvas)}),await Promise.all(l.map(c=>c.promise))}if(this._scene.rewriteEventsBeforeGoToPlayMode(),C8(this._scene.activePage,this._sharedAssetsManager),!this._renderer){this._renderer=new xht({canvas:this.canvas,antialias:!1,alpha:!0,stencil:!1,depth:!1,powerPreference:"high-performance"}),this._renderer.hdTransmission=r.scene.publish.hdTransmission===!0;let l=()=>/Mobi|Android|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent),c=this._getPixelRatio(l()?r.scene.publish.settings.web.pixelRatioMobile:r.scene.publish.settings.web.pixelRatioDesktop);if(this._renderer.setPixelRatio(c),this._renderer.pipeline.enableUIOverlay(),this._renderer.pipeline.addEventListener("smaaloaded",this._requestRenderAutoMode),r.shared.images.SplineWatermark){let u=this._sharedAssetsManager.getImage("SplineWatermark");await u.loadPromise;let h=u.getTexture(1001);this._renderer.pipeline.setWatermark(h)}}fie(r)&&this._scene.initializeSplatViewer(),r.scene.blueNoiseTextureData!==void 0&&this._renderer.pipeline.updateBlueNoiseTexture(r.scene.blueNoiseTextureData);let o=Object.values(r.frames)[0];if(this._frameView?this._frameView.setCamera(this._camera):(o.preset==="fullscreen"?(this._viewportMode=1,this.canvas.style.display="block",this.canvas.parentElement&&(this._viewportWidth=this.canvas.parentElement.clientWidth||300,this.canvas.style.width="100%"),this.canvas.parentElement&&(this._viewportHeight=this.canvas.parentElement.clientHeight||150,this.canvas.style.height="100%")):(this._viewportMode=2,this._viewportWidth=o.size[0],this._viewportHeight=o.size[1],this.canvas.style.width=`${this._viewportWidth}px`,this.canvas.style.height=`${this._viewportHeight}px`),this._renderer.setSize(this._viewportWidth,this._viewportHeight,!1),this._frameView=new Cmt(this._renderer,this._camera,new Ae(this._viewportWidth,this._viewportHeight),new Ae(window.innerWidth,window.innerHeight)),this._frameView.enableResponsive=(o.allowResponsive??!1)&&o.preset==="fullscreen"),e){let l=new Jft(this._renderer,this.data.scene.publish,this._scene,()=>this._scene.activeCamera,this._sharedAssetsManager,this._requestRenderAutoMode,!0,o);this._scene.updateMatrixWorld(!0),this._controls=new rmt(l),this._animationControls=new smt(this._scene,this._requestRenderAutoMode),this._eventManager=new Tmt(r.scene.publish,this._controls,this._animationControls,l,r.shared.variables),this._eventManager.activate(),this._controls.activate(this._eventManager)}this._resize(),this._scene.activePage.data.postprocessing.depthOfField.enabled&&Promise.all(this._sharedAssetsManager.getImageLoadPromises()).then(()=>{this._resize(!0)}),i!==void 0&&this.setVariables(i),this.dt===0&&(this.render(performance.now()),setTimeout(()=>{this._renderer?.setAnimationLoop(this.render)},0)),this._resizeObserverTimeout=setTimeout(()=>{!this._resizeObserver&&this.canvas.parentElement&&(this._resizeObserver=new ResizeObserver(()=>{this._viewportWidth=this.canvas.clientWidth,this._viewportHeight=this.canvas.clientHeight,this._debouncedResize()}),this._resizeObserver.observe(this.canvas.parentElement))},300),document.addEventListener("scroll",this._onScroll)}setVariables(t){if(this._data!==void 0){let e=Object.entries(t);for(let[i,r]of e)this.setVariable(i,r)}}setVariable(t,e){let i=this._getVariableByName(t);if(i&&!("dynamicVariableType"in i.data)){let r=e;typeof i.data.value=="number"?r=typeof e=="number"?e:typeof e=="boolean"?e===!0?1:0:parseFloat(e):typeof i.data.value=="boolean"?r=typeof e=="number"?!!e:typeof e=="boolean"?e:e.toLocaleLowerCase()==="false"?!1:!!e:typeof i.data.value!="string"&&i.data.value.textValue!==void 0&&(r=e.toString());let n=typeof r=="string"?{textValue:r}:r;this._sharedAssetsManager?.updateVariable(i.id,n),this.requestRender(),this._requestRenderAutoMode()}else i===void 0?console.warn(`No variable named ${t} was found in your Spline file. Make sure to create it from Spline editor.`):"dynamicVariableType"in i.data&&console.warn(`Dynamic variables like ${t} cannot be updated from code.`)}getVariables(){let t={};return this._data&&this._data.shared.variables.forEach(e=>{t[e.data.name]===void 0&&(t[e.data.name]=this._getVariableValue(this._sharedAssetsManager.getVariable(e.id)))}),t}getVariable(t){let e=this._getVariableByName(t);if(e){let i=this._sharedAssetsManager.getVariable(e.id);return this._getVariableValue(i)}}_getVariableValue(t){return typeof t!="string"&&xo.isTextValue(t)?xo.getDisplayedValue(t):t}_getVariableByName(t){if(this._data){if(this._variablesCache.has(t))return this._variablesCache.get(t);let e=this._data.shared.variables.find(i=>i.data.name===t);return e&&this._variablesCache.set(t,e),e}}_getPixelRatio(t){switch(t){case 0:return window.devicePixelRatio;case 1:return 1;case 2:return 2}}findObjectById(t){let e=this._scene?.getObjectByProperty("uuid",t);return this._createProxyObject(e)}findObjectByName(t){let e=this._scene?.getObjectByName(t);return this._createProxyObject(e)}getAllObjects(){let t=[];return this._scene?.traverseEntity(e=>{if(e.uuid!==N_&&!this._scene.isInvisibleObjects(e)&&!(e instanceof Fa)){let i=this._createProxyObject(e);i&&t.push(i)}}),t}getSplineEvents(){return(this._eventManager?.handlers?.Spline).splineEvents}emitEvent(t,e){(this.findObjectById(e)||this.findObjectByName(e))?.emitEvent(t)}emitEventReverse(t,e){(this.findObjectById(e)||this.findObjectByName(e))?.emitEventReverse(t)}addEventListener(t,e){this.canvas.addEventListener(t,e)}removeEventListener(t,e){this.canvas.removeEventListener(t,e)}setZoom(t){this._controls?.orbitControls instanceof dge&&this._controls?.orbitControls.setZoom(t)}get eventManager(){return this._eventManager}get controls(){return this._controls}setSize(t,e){this._viewportWidth=t,this._viewportHeight=e,this._viewportMode=2,this._resize()}setBackgroundColor(t){let e=are(t);this._scene?.activePage.setBackgroundColor(e),this._requestRenderAutoMode()}dispose(){this.disposed=!0,this._eventManager?.deactivate(),this._scene?.dispose(),this._sharedAssetsManager?.dispose(),this._proxyObjectCache.forEach(t=>{AQ.unsubscribe(t)}),this._variablesCache.clear(),this._renderer?.setAnimationLoop(null),this._renderer?.dispose(),this._renderer=void 0,this._sharedAssetsManager?.dispose(),this._resizeObserver&&(this._resizeObserver.disconnect(),this._resizeObserver=void 0),this._resizeObserverTimeout!==void 0&&clearTimeout(this._resizeObserverTimeout),this.canvas.style.width="",this.canvas.style.height="",this.canvas.removeAttribute("width"),this.canvas.removeAttribute("height"),this._frameView&&(this._frameView=void 0),this._controls?.deactivate(),this.dt=0,Rtt(this.canvas),document.removeEventListener("scroll",this._onScroll)}get isStopped(){return this._isPaused}stop(){this._isPaused||(this._renderer?.setAnimationLoop(null),this._isPaused=!0,this._eventManager?.pause(),this._controls?.orbitControls&&(this._controls.orbitControls.enabled=!1))}play(){!this._isPaused||(this._isPaused=!1,this._eventManager?.resume(),this._controls?.orbitControls&&(this._controls.orbitControls.enabled=!0),this._renderer?.setAnimationLoop(this.render))}setGlobalEvents(t){this._eventManager?.updateUseWindowEvents(t)}get data(){return this._data}_createProxyObject(t){if(!this._scene||t==null)return;if(this._proxyObjectCache.has(t.uuid))return this._proxyObjectCache.get(t.uuid);let e;t.traverseAncestors(o=>{o instanceof Fa&&(e=o.name)});let i=this._sharedAssetsManager,r={shared:i,scene:this._scene},n=o=>{if(o===null||o==="Base State")return null;if(o&&t.data.states){let l=t.data.states.find(c=>c.data.name===o);return l?l.id:void 0}},s={name:t.name,uuid:t.uuid,visible:t.visible,intensity:t.intensity,position:t.position,rotation:t.rotation,scale:t.scale,type:t.data.type,page:e,parentUuid:t.parent instanceof Fa||t instanceof A8?void 0:t.parent?.uuid,emitEvent(o){t.dispatchEvent({type:"userEvent",eventName:o})},emitEventReverse(o){t.dispatchEvent({type:"userEvent",eventName:o,reverse:!0})},hide(){t.visible&&(t.visible=!1,r.shared.requestRender())},show(){t.visible||(t.visible=!0,r.shared.requestRender())},get state(){let o=t.stateSelection;if(o!==null)return t.data.states.find(({id:l})=>l===o)?.data.name},set state(o){let l;if(o!==void 0){let c=typeof o=="string"?t.data.states.find(({id:u})=>u===o):t.data.states[o];if(c)l=c.id;else{let u=typeof o=="string"?n(o):void 0;u&&(l=u)}}t.changeSelectedState(l??null,r),t.currentState=l??null,t.dispatchEvent({type:"completeState",state:l??null}),r.shared.requestRender()},transition(o){let l=this,c,u=Gg.timeline({autoplay:o.autoPlay??!0}),h={transition({from:d,to:f,duration:p,delay:g,...m}){let y=n(d);y===void 0&&(y=c);let b=n(f);c=b;let w=new vV(t,y,b,{state:b,repeat:0,delay:g??0,delayDirection:"start-once",direction:"normal",duration:p??1e3,...m,...m.easing===6?d3.defaultData:m.easing===5?f3.defaultData:{}},i,!1);return u.add({...w.params,begin:()=>{(d&&y||d==="Base State"&&!y)&&(l.state=y??void 0)},complete:()=>{l.state=b??void 0}},u.duration),this},play(){return u.play(),this},pause(){return u.pause(),this},reset(){return u.reset(),this},seek(d){return u.seek(d),this}};return h.transition(o),h},set color(o){let l=are(o);if(F3.is(t)){t.color=l;return}else if(t.type!=="Mesh"||!("material"in t)||!(t instanceof sv))return;let c={r:l.r,g:l.g,b:l.b,a:l.a},u=Array.isArray(t.material)?t.material[0]:t.material,h=u.data.layers.find(d=>d.data.type==="color")?.id;h&&u.updateByOp({type:0,path:["layers",h],props:{color:{...c}}},u.data,r)}},a=AQ(s,(o,l)=>{typeof t[o]!="object"&&Object.getOwnPropertyDescriptor(t,o)?.writable&&(t[o]=l),this._requestRenderAutoMode(),t.updateMatrix()});return this._proxyObjectCache.set(t.uuid,a),a}setUIWasmUrl(t){jpe.skiaWasmUrl=t}pauseGameControls(){this._eventManager?.controlsManager.gameControl?.pause()}resumeGameControls(){this._eventManager?.controlsManager.gameControl?.resume()}async swapGeometry(t,e){let i;if(typeof e=="string")if(e.endsWith(".splinegeometry")){let l=await(await fetch(e)).arrayBuffer();i=new Uint8Array(l)}else throw new Error("Only .splinegeometry format is supported");else i=e;let r=u3.deserialize(i),n="data"in r&&r.data.draco!==void 0;n&&await ere(this._wasmPath);let s=this._scene?.getObjectByProperty("uuid",t)??this._scene?.getObjectByName(t);if(!s){console.warn(`Object ${t} not found`);return}if(s.data.type!=="Mesh"||!(s instanceof sv)){console.warn(`Object ${t} is not a mesh`);return}let a=s,o={...a.data,geometry:r};n&&await tre([o]),a.updateByOp({type:0,path:[],props:{geometry:o.geometry}},o,{shared:this._sharedAssetsManager,scene:this._scene},!1);for(let l of a.data.states){let c={...l.data};a.states||(a.states={}),a.states[l.id]=Og.patch(o,c)}return i}},O4,ore;function zmt(){if(ore)return O4;ore=1;var t="Expected a function",e=NaN,i="[object Symbol]",r=/^\s+|\s+$/g,n=/^[-+]0x[0-9a-f]+$/i,s=/^0b[01]+$/i,a=/^0o[0-7]+$/i,o=parseInt,l=typeof zC=="object"&&zC&&zC.Object===Object&&zC,c=typeof self=="object"&&self&&self.Object===Object&&self,u=l||c||Function("return this")(),h=Object.prototype,d=h.toString,f=Math.max,p=Math.min,g=function(){return u.Date.now()};function m(M,A,P){var C,R,I,k,z,V,F=0,$=!1,K=!1,X=!0;if(typeof M!="function")throw new TypeError(t);A=E(A)||0,y(P)&&($=!!P.leading,K="maxWait"in P,I=K?f(E(P.maxWait)||0,A):I,X="trailing"in P?!!P.trailing:X);function U(le){var he=C,ve=R;return C=R=void 0,F=le,k=M.apply(ve,he),k}function Y(le){return F=le,z=setTimeout(ee,A),$?U(le):k}function Z(le){var he=le-V,ve=le-F,xe=A-he;return K?p(xe,I-ve):xe}function j(le){var he=le-V,ve=le-F;return V===void 0||he>=A||he<0||K&&ve>=I}function ee(){var le=g();if(j(le))return pe(le);z=setTimeout(ee,Z(le))}function pe(le){return z=void 0,X&&C?U(le):(C=R=void 0,k)}function fe(){z!==void 0&&clearTimeout(z),F=0,C=V=R=z=void 0}function se(){return z===void 0?k:pe(g())}function re(){var le=g(),he=j(le);if(C=arguments,R=this,V=le,he){if(z===void 0)return Y(V);if(K)return z=setTimeout(ee,A),U(V)}return z===void 0&&(z=setTimeout(ee,A)),k}return re.cancel=fe,re.flush=se,re}function y(M){var A=typeof M;return!!M&&(A=="object"||A=="function")}function b(M){return!!M&&typeof M=="object"}function w(M){return typeof M=="symbol"||b(M)&&d.call(M)==i}function E(M){if(typeof M=="number")return M;if(w(M))return e;if(y(M)){var A=typeof M.valueOf=="function"?M.valueOf():M;M=y(A)?A+"":A}if(typeof M!="string")return M===0?M:+M;M=M.replace(r,"");var P=s.test(M);return P||a.test(M)?o(M.slice(2),P?2:8):n.test(M)?e:+M}return O4=m,O4}var jmt=zmt();const Vmt=Lh(jmt);function Hmt(t){return e=>{t.forEach(i=>{typeof i=="function"?i(e):i!=null&&(i.current=e)})}}const Gmt=[],Wmt={width:"100%",height:"100%"},qmt=J.forwardRef(function({className:t,children:e,debounceTime:i=300,ignoreDimensions:r=Gmt,parentSizeStyles:n,enableDebounceLeadingCall:s=!0,resizeObserverPolyfill:a,...o},l){const c=J.useRef(null),u=J.useRef(0),[h,d]=J.useState({width:0,height:0,top:0,left:0}),f=J.useMemo(()=>{const p=Array.isArray(r)?r:[r];return Vmt(g=>{d(m=>Object.keys(m).filter(y=>m[y]!==g[y]).every(y=>p.includes(y))?m:g)},i,{leading:s})},[i,s,r]);return J.useEffect(()=>{const p=a||window.ResizeObserver,g=new p(m=>{m.forEach(y=>{const{left:b,top:w,width:E,height:M}=y?.contentRect??{};u.current=window.requestAnimationFrame(()=>{f({width:E,height:M,top:w,left:b})})})});return c.current&&g.observe(c.current),()=>{window.cancelAnimationFrame(u.current),g.disconnect(),f.cancel()}},[f,a]),O.jsx("div",{style:{...Wmt,...n},ref:Hmt([l,c]),className:t,...o,children:e({...h,ref:c.current,resize:f})})}),Xmt=J.forwardRef(({scene:t,style:e,onSplineMouseDown:i,onSplineMouseUp:r,onSplineMouseHover:n,onSplineKeyDown:s,onSplineKeyUp:a,onSplineStart:o,onSplineLookAt:l,onSplineFollow:c,onSplineScroll:u,onLoad:h,renderOnDemand:d=!0,wasmPath:f,children:p,...g},m)=>{const y=J.useRef(null),[b,w]=J.useState(!0),[E,M]=J.useState();if(E)throw E;return J.useEffect(()=>{w(!0);let A;const P=[{name:"mouseDown",cb:i},{name:"mouseUp",cb:r},{name:"mouseHover",cb:n},{name:"keyDown",cb:s},{name:"keyUp",cb:a},{name:"start",cb:o},{name:"lookAt",cb:l},{name:"follow",cb:c},{name:"scroll",cb:u}];if(y.current){A=new Fmt(y.current,{renderOnDemand:d,wasmPath:f});async function C(){await A.load(t);for(let R of P)R.cb&&A.addEventListener(R.name,R.cb);w(!1),h?.(A)}C().catch(R=>{M(R)})}return()=>{for(let C of P)C.cb&&A.removeEventListener(C.name,C.cb);A.dispose()}},[t]),O.jsx(qmt,{ref:m,parentSizeStyles:{overflow:"hidden",...e},debounceTime:50,...g,children:()=>O.jsxs(O.Fragment,{children:[b&&p,O.jsx("canvas",{ref:y,style:{display:b?"none":"block"}})]})})});function $mt(){const t={bgDarkClass:"bg-gradient-to-b from-[#0a0e27] via-[#0f1420] to-[#1a1f3a]",textLight:"text-gray-200",cardBg:"bg-gradient-to-br from-blue-950/30 to-slate-900/30 backdrop-blur-md border border-blue-500/20"},e=[{id:1,title:"Seamless Data Ingestion",description:"Effortlessly upload diverse research data formats  papers, images, audio  or connect directly to NASA's vast archives.",icon:o6,details:["Multi-modal input support (PDF, DOCX, JPG, PNG, MP3, WAV)","Direct integration with NASA Open Science Data Repository","Secure and encrypted data handling","Intelligent pre-processing for various data types"],color:"from-blue-400 to-cyan-400"},{id:2,title:"Advanced AI Core Analysis",description:"Our proprietary AI engine, trained on millions of NASA documents, performs deep contextual analysis.",icon:ss,details:["Specialized Natural Language Processing (NLP) for scientific texts","Computer Vision for interpreting astronomical and geological imagery","Semantic understanding and entity extraction","Cross-referencing across diverse NASA datasets"],color:"from-indigo-400 to-blue-400"},{id:3,title:"Perspective-Driven Insights",description:"Tailor your analysis by choosing a persona: Scientist, Investor/Manager, or Mission Architect, to receive relevant insights.",icon:w1,details:["Scientist: Hypotheses, methodologies, data correlations, experimental design suggestions","Investor/Manager: Market potential, commercial applications, risk assessment, funding opportunities","Mission Architect: Feasibility studies, logistical challenges, safety protocols, resource optimization","Customizable output formats for each role"],color:"from-cyan-400 to-teal-400"},{id:4,title:"Interactive Q&A & Visualization",description:"Engage with the AI through chat, ask follow-up questions, and explore findings via rich, interactive visualizations.",icon:SI,details:["Real-time conversational AI for iterative exploration","Dynamic charts, graphs, and 3D models of data","Exportable reports and data sets","Contextual links to original NASA source documents"],color:"from-sky-400 to-blue-500"}],i=[{name:"Kartavya",role:"RAG System & Frontend Lead",avatar:"",description:"Architects scalable Retrieval-Augmented Generation systems and crafts intuitive, high-performance user interfaces.",skills:["RAG","React","TypeScript","LangChain","Frontend Dev"],icon:ss},{name:"Surya Shrivastav",role:"Knowledge Graph Architect",avatar:"",description:"Designs and builds sophisticated knowledge graphs, turning unstructured data into semantic, queryable intelligence.",skills:["Knowledge Graphs","Neo4j","Python","Graph DBs","Ontology"],icon:Mh},{name:"Saksham Sethia",role:"Backend & Infrastructure",avatar:"",description:"Develops robust backend APIs, data pipelines, and manages scalable cloud infrastructure for core services.",skills:["Node.js","Python","APIs","PostgreSQL","Docker","AWS"],icon:y1e},{name:"Yash Sharma",role:"Data Scientist & ML Engineer",avatar:"",description:"Applies advanced statistical and machine learning techniques to extract critical insights and validate AI models.",skills:["Data Science","ML","Python","Pandas","Model Eval","Numpy"],icon:SI},{name:"Sapphire",role:"Semantic Data Modeler",avatar:"",description:"Focuses on data modeling and semantic structuring to enable contextual understanding of complex research data.",skills:["Ontology Design","GraphQL","Data Modeling","Linked Data"],icon:mu},{name:"Sanvi",role:"UI/UX Designer",avatar:"",description:"Crafts engaging, user-centric interfaces that simplify access to complex scientific knowledge for diverse users.",skills:["UI/UX Design","Figma","Prototyping","Design Systems"],icon:pse}],r=[{label:"NASA Datasets Integrated",value:"8+",icon:Mh},{label:"AI Models Deployed",value:"5+",icon:ss},{label:"Research Areas Covered",value:"20+",icon:J3},{label:"Active Team Members",value:"6",icon:w1}],{scrollYProgress:n}=twe();nwe(n,{stiffness:100,damping:30,restDelta:.001});const s={hidden:{opacity:0,y:60},visible:{opacity:1,y:0,transition:{duration:.6,ease:"easeOut"}}};return O.jsxs("div",{className:`relative min-h-screen ${t.bgDarkClass} ${t.textLight} overflow-visible`,style:{position:"relative",zIndex:1},children:[O.jsx("section",{className:"relative flex flex-col items-center justify-center text-center min-h-screen px-6 py-20",style:{zIndex:10},children:O.jsx(Rt.div,{initial:{opacity:0,y:0},animate:{opacity:1,y:0},transition:{duration:.8},className:"space-y-8",children:O.jsx("div",{className:"flex justify-center mb-6",children:O.jsx(Xmt,{scene:"https://draft.spline.design/01k1AO1jMFy7JJm5/scene.splinecode"})})})}),O.jsx("section",{id:"how-it-works",className:"relative py-20 px-6",children:O.jsxs("div",{className:"max-w-7xl mx-auto space-y-16",children:[O.jsxs(Rt.div,{initial:"hidden",whileInView:"visible",viewport:{once:!1,amount:.3},variants:s,className:"text-center space-y-4 bg-white/10 backdrop-blur-md border border-white/20 rounded-xl p-10 shadow-lg hover:shadow-cyan-500/20 transition-all duration-300",children:[O.jsx("div",{className:"inline-block px-4 py-2 text-sm bg-blue-500/20 border border-blue-400 text-blue-300 rounded-full",children:"THE PROCESS"}),O.jsx("h2",{className:"text-5xl font-extrabold text-white",children:"How AstroNots Works"}),O.jsx("p",{className:"text-xl text-gray-300 max-w-3xl mx-auto",children:"Our streamlined process is designed to bring you the most relevant and insightful information from NASA's vast knowledge base."})]}),O.jsxs("div",{className:"relative",children:[O.jsx("div",{className:"absolute left-1/2 -translate-x-1/2 h-full w-1 bg-gradient-to-b from-blue-500 via-cyan-500 to-indigo-500 rounded-full opacity-20 hidden md:block"}),e.map((a,o)=>{const l=a.icon,c=o%2===0;return O.jsxs(Rt.div,{initial:"hidden",whileInView:"visible",viewport:{once:!1,amount:.3},variants:{hidden:{opacity:0,x:c?-100:100},visible:{opacity:1,x:0,transition:{duration:.7,delay:o*.1}}},className:"relative md:grid md:grid-cols-2 gap-12 items-center my-16 md:my-24",children:[O.jsx("div",{className:c?"md:col-start-1":"md:col-start-2",children:O.jsxs("div",{className:"bg-white/10 backdrop-blur-md border border-white/20 rounded-xl p-8 space-y-6 hover:shadow-xl hover:shadow-cyan-500/10 transition-all duration-300",children:[O.jsxs("div",{className:"flex items-center gap-5 mb-4",children:[O.jsx("div",{className:`w-16 h-16 bg-gradient-to-r ${a.color} rounded-full flex items-center justify-center flex-shrink-0 shadow-lg`,children:O.jsx(l,{className:"w-8 h-8 text-white"})}),O.jsxs("div",{children:[O.jsxs("div",{className:"mb-2 inline-block px-3 py-1 bg-blue-500/20 text-blue-300 border border-blue-400/30 rounded-full text-sm",children:["Step ",a.id]}),O.jsx("h3",{className:"text-3xl font-bold text-white leading-tight",children:a.title})]})]}),O.jsx("p",{className:"text-gray-300 text-lg",children:a.description}),O.jsx("ul",{className:"space-y-3",children:a.details.map((u,h)=>O.jsxs(Rt.li,{initial:{opacity:0,x:-10},whileInView:{opacity:1,x:0},viewport:{once:!1,amount:.2},transition:{delay:.3+h*.05},className:"flex items-center gap-3 text-gray-400 text-base",children:[O.jsx("div",{className:"w-2.5 h-2.5 bg-cyan-400 rounded-full flex-shrink-0 shadow-sm shadow-cyan-400/50"}),u]},h))})]})}),O.jsx("div",{className:`hidden md:flex justify-center items-center ${c?"md:col-start-2":"md:col-start-1"}`,children:O.jsx(Rt.div,{animate:{rotate:[0,10,-10,0],scale:[1,1.03,.97,1]},transition:{duration:8,repeat:1/0,ease:"easeInOut",delay:o*.8},className:`w-56 h-56 lg:w-72 lg:h-72 bg-gradient-to-br ${a.color} rounded-3xl flex items-center justify-center opacity-20 border border-blue-400/20 shadow-lg`,children:O.jsx(l,{className:"w-28 h-28 text-white opacity-80"})})})]},a.id)})]})]})}),O.jsx("section",{id:"about-team",className:"relative py-20 px-6",children:O.jsxs("div",{className:"max-w-7xl mx-auto space-y-16",children:[O.jsxs(Rt.div,{initial:"hidden",whileInView:"visible",viewport:{once:!1,amount:.3},variants:s,className:"text-center space-y-4 bg-white/10 backdrop-blur-md border border-white/20 rounded-xl p-10 shadow-lg hover:shadow-cyan-500/20 transition-all duration-300",children:[O.jsx("div",{className:"inline-block px-4 py-2 text-sm bg-cyan-500/20 border border-cyan-400 text-cyan-300 rounded-full",children:"OUR CREATORS"}),O.jsx("h2",{className:"text-5xl font-extrabold text-white",children:"Meet the AstroNots Team"}),O.jsx("p",{className:"text-xl text-gray-300 max-w-3xl mx-auto",children:"We are a diverse group of passionate innovators, united by our mission to explore the cosmos through cutting-edge AI."})]}),O.jsx(Rt.div,{initial:"hidden",whileInView:"visible",viewport:{once:!1,amount:.3},variants:s,children:O.jsx("div",{className:"bg-white/10 backdrop-blur-md border border-white/20 rounded-xl shadow-2xl p-8",children:O.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-6",children:r.map((a,o)=>{const l=a.icon;return O.jsxs(Rt.div,{initial:{opacity:0,scale:.8},whileInView:{opacity:1,scale:1},viewport:{once:!1,amount:.5},transition:{delay:.1+o*.1},className:"text-center space-y-2",children:[O.jsx("div",{className:"w-16 h-16 bg-gradient-to-r from-blue-500 to-cyan-500 rounded-full flex items-center justify-center mx-auto mb-3 shadow-lg",children:O.jsx(l,{className:"w-8 h-8 text-white"})}),O.jsx("div",{className:"text-3xl font-bold text-white",children:a.value}),O.jsx("div",{className:"text-gray-400 text-sm",children:a.label})]},o)})})})}),O.jsx("div",{className:"grid md:grid-cols-2 lg:grid-cols-3 gap-8 pt-10",children:i.map((a,o)=>{const l=a.icon;return O.jsx(Rt.div,{initial:"hidden",whileInView:"visible",viewport:{once:!1,amount:.2},variants:{hidden:{opacity:0,y:60},visible:{opacity:1,y:0,transition:{duration:.6,delay:o*.1}}},className:"h-full",children:O.jsxs("div",{className:"bg-white/10 backdrop-blur-md border border-white/20 rounded-xl h-full flex flex-col hover:shadow-xl hover:shadow-cyan-500/10 transition-all duration-300 p-6",children:[O.jsxs("div",{className:"flex items-center gap-4 mb-4",children:[O.jsx("div",{className:"text-5xl flex-shrink-0",children:a.avatar}),O.jsxs("div",{className:"flex-grow",children:[O.jsx("h3",{className:"text-2xl font-bold text-white",children:a.name}),O.jsxs("div",{className:"flex items-center gap-2 text-gray-400",children:[O.jsx(l,{className:"w-4 h-4"}),O.jsx("p",{className:"text-base",children:a.role})]})]})]}),O.jsx("p",{className:"text-gray-300 text-sm mb-4 flex-grow",children:a.description}),O.jsxs("div",{className:"mb-4",children:[O.jsx("h4",{className:"text-white font-medium mb-2 text-lg",children:"Skills"}),O.jsx("div",{className:"flex flex-wrap gap-2",children:a.skills.map((c,u)=>O.jsx("span",{className:"inline-block bg-blue-500/20 text-blue-200 border border-blue-400/30 text-xs px-3 py-1 rounded-full",children:c},u))})]}),O.jsxs("div",{className:"mt-auto flex gap-2 pt-4 border-t border-blue-500/20",children:[O.jsx("button",{className:"p-2 border border-blue-400/30 text-gray-300 hover:text-white hover:bg-blue-500/20 hover:border-blue-400 transition-colors rounded-md","aria-label":`GitHub profile of ${a.name}`,children:O.jsx(hse,{className:"w-5 h-5"})}),O.jsx("button",{className:"p-2 border border-blue-400/30 text-gray-300 hover:text-white hover:bg-blue-500/20 hover:border-blue-400 transition-colors rounded-md","aria-label":`LinkedIn profile of ${a.name}`,children:O.jsx(fse,{className:"w-5 h-5"})}),O.jsx("button",{className:"p-2 border border-blue-400/30 text-gray-300 hover:text-white hover:bg-blue-500/20 hover:border-blue-400 transition-colors rounded-md","aria-label":`Email ${a.name}`,children:O.jsx(az,{className:"w-5 h-5"})})]})]})},o)})}),O.jsx(Rt.div,{initial:"hidden",whileInView:"visible",viewport:{once:!1,amount:.3},variants:s,className:"pt-10",children:O.jsxs("div",{className:`${t.cardBg} rounded-xl shadow-2xl shadow-blue-500/10 p-8 text-center`,children:[O.jsx("h3",{className:"text-3xl font-bold text-white mb-4",children:"Our Collective Mission"}),O.jsx("p",{className:"text-lg text-gray-300 max-w-4xl mx-auto leading-relaxed",children:"At AstroNots, we are driven by the belief that critical space research should be universally accessible. Our AI-driven platform acts as a bridge, transforming complex scientific data into clear, actionable insights. We empower scientists to formulate novel hypotheses, guide investors to identify pioneering opportunities, and enable mission architects to design safer, more efficient journeys beyond Earth."}),O.jsx("div",{className:"mt-8",children:O.jsx("span",{className:"inline-block bg-blue-500/20 border border-blue-400/30 text-blue-200 text-lg px-6 py-2 rounded-full shadow-lg",children:"Democratizing Space Science with AI"})})]})})]})}),O.jsx("footer",{className:"relative py-12 bg-gradient-to-t from-[#0a0e27] via-[#0f1420]/50 to-transparent mt-20 pb-32",style:{zIndex:10},children:O.jsxs("div",{className:"max-w-7xl mx-auto text-center px-6",children:[O.jsxs("p",{className:"text-gray-500 text-sm",children:[" ",new Date().getFullYear()," AstroNots  Exploring the Cosmos with AI"]}),O.jsxs("div",{className:"mt-4 flex justify-center space-x-4",children:[O.jsx("a",{href:"#",className:"text-gray-400 hover:text-cyan-300 transition-colors text-sm",children:"Privacy Policy"}),O.jsx("a",{href:"#",className:"text-gray-400 hover:text-cyan-300 transition-colors text-sm",children:"Terms of Service"})]})]})}),O.jsx(Rt.div,{className:"fixed bottom-8 left-1/2 -translate-x-1/2",initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},transition:{delay:.5,duration:.5},style:{zIndex:1e5},children:O.jsxs("button",{onClick:()=>alert("Get Started!"),className:"px-12 py-6 text-xl font-bold rounded-full shadow-2xl transition-all duration-300 ease-in-out bg-gradient-to-r from-blue-500 to-cyan-500 hover:from-blue-600 hover:to-cyan-600 text-white hover:shadow-blue-500/50 hover:scale-105 pointer-events-auto cursor-pointer flex items-center gap-2",children:[O.jsx(mu,{className:"w-6 h-6"}),"Explore Now"]})}),O.jsx(Rt.button,{initial:{opacity:0,scale:0},animate:{opacity:1,scale:1},transition:{duration:.5,delay:1},whileHover:{scale:1.1},whileTap:{scale:.9},onClick:()=>window.scrollTo({top:0,behavior:"smooth"}),className:"fixed bottom-8 right-8 p-4 rounded-full shadow-lg text-white bg-gradient-to-r from-blue-500 to-cyan-500 hover:from-blue-600 hover:to-cyan-600 hover:shadow-blue-500/50 focus:outline-none focus:ring-4 focus:ring-blue-400/50 pointer-events-auto cursor-pointer",style:{zIndex:99998},"aria-label":"Scroll to top",children:O.jsx(s6,{className:"w-6 h-6"})})]})}const Ymt=({onClick:t})=>O.jsx(Rt.div,{style:{position:"fixed",bottom:"2.5rem",left:"45%",transform:"translateX(-50%)",zIndex:99999},initial:{opacity:0,scale:0},animate:{opacity:1,scale:1},transition:{duration:.5,delay:.2},children:O.jsxs(Rt.button,{onClick:t,whileHover:{scale:1.1},whileTap:{scale:.95},className:`\r
          flex items-center justify-center\r
          min-w-[240px] px-6 py-5\r
          text-lg font-bold rounded-full shadow-2xl\r
          bg-gradient-to-r from-blue-500 to-cyan-500\r
          text-white hover:from-blue-600 hover:to-cyan-600\r
          hover:shadow-blue-500/50\r
          pointer-events-auto\r
        `,children:[O.jsx(mu,{className:"w-5 h-6 mr-2"})," ","Explore Now"]})});var Kmt=(t,e,i,r,n,s,a,o)=>{let l=document.documentElement,c=["light","dark"];function u(f){(Array.isArray(t)?t:[t]).forEach(p=>{let g=p==="class",m=g&&s?n.map(y=>s[y]||y):n;g?(l.classList.remove(...m),l.classList.add(s&&s[f]?s[f]:f)):l.setAttribute(p,f)}),h(f)}function h(f){o&&c.includes(f)&&(l.style.colorScheme=f)}function d(){return window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"}if(r)u(r);else try{let f=localStorage.getItem(e)||i,p=a&&f==="system"?d():f;u(p)}catch{}},Zmt=J.createContext(void 0),Qmt={setTheme:t=>{},themes:[]},Jmt=()=>{var t;return(t=J.useContext(Zmt))!=null?t:Qmt};J.memo(({forcedTheme:t,storageKey:e,attribute:i,enableSystem:r,enableColorScheme:n,defaultTheme:s,value:a,themes:o,nonce:l,scriptProps:c})=>{let u=JSON.stringify([i,e,s,t,o,a,r,n]).slice(1,-1);return J.createElement("script",{...c,suppressHydrationWarning:!0,nonce:typeof window>"u"?l:"",dangerouslySetInnerHTML:{__html:`(${Kmt.toString()})(${u})`}})});const lre=({...t})=>{const{theme:e="system"}=Jmt();return O.jsx(XEe,{theme:e,className:"toaster group",style:{"--normal-bg":"var(--popover)","--normal-text":"var(--popover-foreground)","--normal-border":"var(--border)"},...t})};function egt(){console.log(" App component rendering...");const{session:t,loading:e,signOut:i}=Bse(),[r,n]=J.useState("scientist"),[s,a]=J.useState(!0);console.log("App state:",{hasSession:!!t,hasUser:!!t?.user,loading:e,showHome:s,userEmail:t?.user?.email}),J.useEffect(()=>{if(t?.user){console.log(" User logged in, hiding home page"),a(!1);const l=t.user.user_metadata;l?.user_type&&n(l.user_type)}else console.log(" No session, showing home page")},[t]);const o=async()=>{console.log(" Signing out..."),await i(),a(!0)};return e?(console.log(" Loading..."),O.jsxs(O.Fragment,{children:[O.jsx(jE,{}),O.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 via-purple-900 to-slate-900 flex items-center justify-center",children:O.jsx(Rt.div,{animate:{rotate:360},transition:{duration:2,repeat:1/0,ease:"linear"},className:"w-16 h-16 border-4 border-blue-500 border-t-transparent rounded-full"})})]})):s&&!t?(console.log(" Showing home page"),O.jsxs(O.Fragment,{children:[O.jsx(jE,{}),O.jsx($mt,{onGetStarted:()=>a(!1)}),O.jsx(Ymt,{onClick:()=>a(!1)})]})):t?.user?(console.log(" Showing dashboard"),O.jsxs(O.Fragment,{children:[O.jsx(jE,{}),O.jsx(DVe,{user:t?.user,userType:r,onUserTypeChange:n,onSignOut:o}),O.jsx(lre,{})]})):(console.log(" Showing login page"),O.jsxs(O.Fragment,{children:[O.jsx(jE,{}),O.jsx($Ee,{}),O.jsx(lre,{})]}))}function tgt(){return O.jsx(Use,{children:O.jsx(egt,{})})}$ge.createRoot(document.getElementById("root")).render(O.jsx(kt.StrictMode,{children:O.jsx(Use,{children:O.jsx(hAe,{children:O.jsx(tgt,{})})})}));export{zC as c,Lh as g};
